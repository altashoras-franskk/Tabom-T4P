const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/music3DRenderer-6pXnPp4v.js","assets/three-vendor-D35H-43L.js"])))=>i.map(i=>d[i]);
(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function r(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(s){if(s.ep)return;s.ep=!0;const l=r(s);fetch(s.href,l)}})();function MC(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Z1={exports:{}},cf={},J1={exports:{}},wr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var w4;function $A(){if(w4)return wr;w4=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),i=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),f=Symbol.iterator;function g(Q){return Q===null||typeof Q!="object"?null:(Q=f&&Q[f]||Q["@@iterator"],typeof Q=="function"?Q:null)}var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,v={};function b(Q,ae,we){this.props=Q,this.context=ae,this.refs=v,this.updater=we||m}b.prototype.isReactComponent={},b.prototype.setState=function(Q,ae){if(typeof Q!="object"&&typeof Q!="function"&&Q!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Q,ae,"setState")},b.prototype.forceUpdate=function(Q){this.updater.enqueueForceUpdate(this,Q,"forceUpdate")};function S(){}S.prototype=b.prototype;function C(Q,ae,we){this.props=Q,this.context=ae,this.refs=v,this.updater=we||m}var k=C.prototype=new S;k.constructor=C,y(k,b.prototype),k.isPureReactComponent=!0;var R=Array.isArray,j=Object.prototype.hasOwnProperty,T={current:null},_={key:!0,ref:!0,__self:!0,__source:!0};function P(Q,ae,we){var Re,ge={},Ae=null,tt=null;if(ae!=null)for(Re in ae.ref!==void 0&&(tt=ae.ref),ae.key!==void 0&&(Ae=""+ae.key),ae)j.call(ae,Re)&&!_.hasOwnProperty(Re)&&(ge[Re]=ae[Re]);var We=arguments.length-2;if(We===1)ge.children=we;else if(1<We){for(var J=Array(We),ke=0;ke<We;ke++)J[ke]=arguments[ke+2];ge.children=J}if(Q&&Q.defaultProps)for(Re in We=Q.defaultProps,We)ge[Re]===void 0&&(ge[Re]=We[Re]);return{$$typeof:e,type:Q,key:Ae,ref:tt,props:ge,_owner:T.current}}function I(Q,ae){return{$$typeof:e,type:Q.type,key:ae,ref:Q.ref,props:Q.props,_owner:Q._owner}}function $(Q){return typeof Q=="object"&&Q!==null&&Q.$$typeof===e}function q(Q){var ae={"=":"=0",":":"=2"};return"$"+Q.replace(/[=:]/g,function(we){return ae[we]})}var L=/\/+/g;function H(Q,ae){return typeof Q=="object"&&Q!==null&&Q.key!=null?q(""+Q.key):ae.toString(36)}function G(Q,ae,we,Re,ge){var Ae=typeof Q;(Ae==="undefined"||Ae==="boolean")&&(Q=null);var tt=!1;if(Q===null)tt=!0;else switch(Ae){case"string":case"number":tt=!0;break;case"object":switch(Q.$$typeof){case e:case t:tt=!0}}if(tt)return tt=Q,ge=ge(tt),Q=Re===""?"."+H(tt,0):Re,R(ge)?(we="",Q!=null&&(we=Q.replace(L,"$&/")+"/"),G(ge,ae,we,"",function(ke){return ke})):ge!=null&&($(ge)&&(ge=I(ge,we+(!ge.key||tt&&tt.key===ge.key?"":(""+ge.key).replace(L,"$&/")+"/")+Q)),ae.push(ge)),1;if(tt=0,Re=Re===""?".":Re+":",R(Q))for(var We=0;We<Q.length;We++){Ae=Q[We];var J=Re+H(Ae,We);tt+=G(Ae,ae,we,J,ge)}else if(J=g(Q),typeof J=="function")for(Q=J.call(Q),We=0;!(Ae=Q.next()).done;)Ae=Ae.value,J=Re+H(Ae,We++),tt+=G(Ae,ae,we,J,ge);else if(Ae==="object")throw ae=String(Q),Error("Objects are not valid as a React child (found: "+(ae==="[object Object]"?"object with keys {"+Object.keys(Q).join(", ")+"}":ae)+"). If you meant to render a collection of children, use an array instead.");return tt}function oe(Q,ae,we){if(Q==null)return Q;var Re=[],ge=0;return G(Q,Re,"","",function(Ae){return ae.call(we,Ae,ge++)}),Re}function le(Q){if(Q._status===-1){var ae=Q._result;ae=ae(),ae.then(function(we){(Q._status===0||Q._status===-1)&&(Q._status=1,Q._result=we)},function(we){(Q._status===0||Q._status===-1)&&(Q._status=2,Q._result=we)}),Q._status===-1&&(Q._status=0,Q._result=ae)}if(Q._status===1)return Q._result.default;throw Q._result}var pe={current:null},ce={transition:null},te={ReactCurrentDispatcher:pe,ReactCurrentBatchConfig:ce,ReactCurrentOwner:T};function F(){throw Error("act(...) is not supported in production builds of React.")}return wr.Children={map:oe,forEach:function(Q,ae,we){oe(Q,function(){ae.apply(this,arguments)},we)},count:function(Q){var ae=0;return oe(Q,function(){ae++}),ae},toArray:function(Q){return oe(Q,function(ae){return ae})||[]},only:function(Q){if(!$(Q))throw Error("React.Children.only expected to receive a single React element child.");return Q}},wr.Component=b,wr.Fragment=r,wr.Profiler=s,wr.PureComponent=C,wr.StrictMode=o,wr.Suspense=c,wr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=te,wr.act=F,wr.cloneElement=function(Q,ae,we){if(Q==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Q+".");var Re=y({},Q.props),ge=Q.key,Ae=Q.ref,tt=Q._owner;if(ae!=null){if(ae.ref!==void 0&&(Ae=ae.ref,tt=T.current),ae.key!==void 0&&(ge=""+ae.key),Q.type&&Q.type.defaultProps)var We=Q.type.defaultProps;for(J in ae)j.call(ae,J)&&!_.hasOwnProperty(J)&&(Re[J]=ae[J]===void 0&&We!==void 0?We[J]:ae[J])}var J=arguments.length-2;if(J===1)Re.children=we;else if(1<J){We=Array(J);for(var ke=0;ke<J;ke++)We[ke]=arguments[ke+2];Re.children=We}return{$$typeof:e,type:Q.type,key:ge,ref:Ae,props:Re,_owner:tt}},wr.createContext=function(Q){return Q={$$typeof:i,_currentValue:Q,_currentValue2:Q,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Q.Provider={$$typeof:l,_context:Q},Q.Consumer=Q},wr.createElement=P,wr.createFactory=function(Q){var ae=P.bind(null,Q);return ae.type=Q,ae},wr.createRef=function(){return{current:null}},wr.forwardRef=function(Q){return{$$typeof:u,render:Q}},wr.isValidElement=$,wr.lazy=function(Q){return{$$typeof:h,_payload:{_status:-1,_result:Q},_init:le}},wr.memo=function(Q,ae){return{$$typeof:d,type:Q,compare:ae===void 0?null:ae}},wr.startTransition=function(Q){var ae=ce.transition;ce.transition={};try{Q()}finally{ce.transition=ae}},wr.unstable_act=F,wr.useCallback=function(Q,ae){return pe.current.useCallback(Q,ae)},wr.useContext=function(Q){return pe.current.useContext(Q)},wr.useDebugValue=function(){},wr.useDeferredValue=function(Q){return pe.current.useDeferredValue(Q)},wr.useEffect=function(Q,ae){return pe.current.useEffect(Q,ae)},wr.useId=function(){return pe.current.useId()},wr.useImperativeHandle=function(Q,ae,we){return pe.current.useImperativeHandle(Q,ae,we)},wr.useInsertionEffect=function(Q,ae){return pe.current.useInsertionEffect(Q,ae)},wr.useLayoutEffect=function(Q,ae){return pe.current.useLayoutEffect(Q,ae)},wr.useMemo=function(Q,ae){return pe.current.useMemo(Q,ae)},wr.useReducer=function(Q,ae,we){return pe.current.useReducer(Q,ae,we)},wr.useRef=function(Q){return pe.current.useRef(Q)},wr.useState=function(Q){return pe.current.useState(Q)},wr.useSyncExternalStore=function(Q,ae,we){return pe.current.useSyncExternalStore(Q,ae,we)},wr.useTransition=function(){return pe.current.useTransition()},wr.version="18.3.1",wr}var C4;function zb(){return C4||(C4=1,J1.exports=$A()),J1.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var M4;function qA(){if(M4)return cf;M4=1;var e=zb(),t=Symbol.for("react.element"),r=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function i(u,c,d){var h,f={},g=null,m=null;d!==void 0&&(g=""+d),c.key!==void 0&&(g=""+c.key),c.ref!==void 0&&(m=c.ref);for(h in c)o.call(c,h)&&!l.hasOwnProperty(h)&&(f[h]=c[h]);if(u&&u.defaultProps)for(h in c=u.defaultProps,c)f[h]===void 0&&(f[h]=c[h]);return{$$typeof:t,type:u,key:g,ref:m,props:f,_owner:s.current}}return cf.Fragment=r,cf.jsx=i,cf.jsxs=i,cf}var k4;function WA(){return k4||(k4=1,Z1.exports=qA()),Z1.exports}var a=WA(),w=zb();const Yt=MC(w);var Mm={},Q1={exports:{}},ps={},e2={exports:{}},t2={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var R4;function HA(){return R4||(R4=1,(function(e){function t(ce,te){var F=ce.length;ce.push(te);e:for(;0<F;){var Q=F-1>>>1,ae=ce[Q];if(0<s(ae,te))ce[Q]=te,ce[F]=ae,F=Q;else break e}}function r(ce){return ce.length===0?null:ce[0]}function o(ce){if(ce.length===0)return null;var te=ce[0],F=ce.pop();if(F!==te){ce[0]=F;e:for(var Q=0,ae=ce.length,we=ae>>>1;Q<we;){var Re=2*(Q+1)-1,ge=ce[Re],Ae=Re+1,tt=ce[Ae];if(0>s(ge,F))Ae<ae&&0>s(tt,ge)?(ce[Q]=tt,ce[Ae]=F,Q=Ae):(ce[Q]=ge,ce[Re]=F,Q=Re);else if(Ae<ae&&0>s(tt,F))ce[Q]=tt,ce[Ae]=F,Q=Ae;else break e}}return te}function s(ce,te){var F=ce.sortIndex-te.sortIndex;return F!==0?F:ce.id-te.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;e.unstable_now=function(){return l.now()}}else{var i=Date,u=i.now();e.unstable_now=function(){return i.now()-u}}var c=[],d=[],h=1,f=null,g=3,m=!1,y=!1,v=!1,b=typeof setTimeout=="function"?setTimeout:null,S=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function k(ce){for(var te=r(d);te!==null;){if(te.callback===null)o(d);else if(te.startTime<=ce)o(d),te.sortIndex=te.expirationTime,t(c,te);else break;te=r(d)}}function R(ce){if(v=!1,k(ce),!y)if(r(c)!==null)y=!0,le(j);else{var te=r(d);te!==null&&pe(R,te.startTime-ce)}}function j(ce,te){y=!1,v&&(v=!1,S(P),P=-1),m=!0;var F=g;try{for(k(te),f=r(c);f!==null&&(!(f.expirationTime>te)||ce&&!q());){var Q=f.callback;if(typeof Q=="function"){f.callback=null,g=f.priorityLevel;var ae=Q(f.expirationTime<=te);te=e.unstable_now(),typeof ae=="function"?f.callback=ae:f===r(c)&&o(c),k(te)}else o(c);f=r(c)}if(f!==null)var we=!0;else{var Re=r(d);Re!==null&&pe(R,Re.startTime-te),we=!1}return we}finally{f=null,g=F,m=!1}}var T=!1,_=null,P=-1,I=5,$=-1;function q(){return!(e.unstable_now()-$<I)}function L(){if(_!==null){var ce=e.unstable_now();$=ce;var te=!0;try{te=_(!0,ce)}finally{te?H():(T=!1,_=null)}}else T=!1}var H;if(typeof C=="function")H=function(){C(L)};else if(typeof MessageChannel<"u"){var G=new MessageChannel,oe=G.port2;G.port1.onmessage=L,H=function(){oe.postMessage(null)}}else H=function(){b(L,0)};function le(ce){_=ce,T||(T=!0,H())}function pe(ce,te){P=b(function(){ce(e.unstable_now())},te)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(ce){ce.callback=null},e.unstable_continueExecution=function(){y||m||(y=!0,le(j))},e.unstable_forceFrameRate=function(ce){0>ce||125<ce?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<ce?Math.floor(1e3/ce):5},e.unstable_getCurrentPriorityLevel=function(){return g},e.unstable_getFirstCallbackNode=function(){return r(c)},e.unstable_next=function(ce){switch(g){case 1:case 2:case 3:var te=3;break;default:te=g}var F=g;g=te;try{return ce()}finally{g=F}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(ce,te){switch(ce){case 1:case 2:case 3:case 4:case 5:break;default:ce=3}var F=g;g=ce;try{return te()}finally{g=F}},e.unstable_scheduleCallback=function(ce,te,F){var Q=e.unstable_now();switch(typeof F=="object"&&F!==null?(F=F.delay,F=typeof F=="number"&&0<F?Q+F:Q):F=Q,ce){case 1:var ae=-1;break;case 2:ae=250;break;case 5:ae=1073741823;break;case 4:ae=1e4;break;default:ae=5e3}return ae=F+ae,ce={id:h++,callback:te,priorityLevel:ce,startTime:F,expirationTime:ae,sortIndex:-1},F>Q?(ce.sortIndex=F,t(d,ce),r(c)===null&&ce===r(d)&&(v?(S(P),P=-1):v=!0,pe(R,F-Q))):(ce.sortIndex=ae,t(c,ce),y||m||(y=!0,le(j))),ce},e.unstable_shouldYield=q,e.unstable_wrapCallback=function(ce){var te=g;return function(){var F=g;g=te;try{return ce.apply(this,arguments)}finally{g=F}}}})(t2)),t2}var A4;function GA(){return A4||(A4=1,e2.exports=HA()),e2.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var j4;function VA(){if(j4)return ps;j4=1;var e=zb(),t=GA();function r(p){for(var x="https://reactjs.org/docs/error-decoder.html?invariant="+p,M=1;M<arguments.length;M++)x+="&args[]="+encodeURIComponent(arguments[M]);return"Minified React error #"+p+"; visit "+x+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function l(p,x){i(p,x),i(p+"Capture",x)}function i(p,x){for(s[p]=x,p=0;p<x.length;p++)o.add(x[p])}var u=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),c=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,h={},f={};function g(p){return c.call(f,p)?!0:c.call(h,p)?!1:d.test(p)?f[p]=!0:(h[p]=!0,!1)}function m(p,x,M,A){if(M!==null&&M.type===0)return!1;switch(typeof x){case"function":case"symbol":return!0;case"boolean":return A?!1:M!==null?!M.acceptsBooleans:(p=p.toLowerCase().slice(0,5),p!=="data-"&&p!=="aria-");default:return!1}}function y(p,x,M,A){if(x===null||typeof x>"u"||m(p,x,M,A))return!0;if(A)return!1;if(M!==null)switch(M.type){case 3:return!x;case 4:return x===!1;case 5:return isNaN(x);case 6:return isNaN(x)||1>x}return!1}function v(p,x,M,A,O,B,Y){this.acceptsBooleans=x===2||x===3||x===4,this.attributeName=A,this.attributeNamespace=O,this.mustUseProperty=M,this.propertyName=p,this.type=x,this.sanitizeURL=B,this.removeEmptyString=Y}var b={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(p){b[p]=new v(p,0,!1,p,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(p){var x=p[0];b[x]=new v(x,1,!1,p[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(p){b[p]=new v(p,2,!1,p.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(p){b[p]=new v(p,2,!1,p,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(p){b[p]=new v(p,3,!1,p.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(p){b[p]=new v(p,3,!0,p,null,!1,!1)}),["capture","download"].forEach(function(p){b[p]=new v(p,4,!1,p,null,!1,!1)}),["cols","rows","size","span"].forEach(function(p){b[p]=new v(p,6,!1,p,null,!1,!1)}),["rowSpan","start"].forEach(function(p){b[p]=new v(p,5,!1,p.toLowerCase(),null,!1,!1)});var S=/[\-:]([a-z])/g;function C(p){return p[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(p){var x=p.replace(S,C);b[x]=new v(x,1,!1,p,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(p){var x=p.replace(S,C);b[x]=new v(x,1,!1,p,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(p){var x=p.replace(S,C);b[x]=new v(x,1,!1,p,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(p){b[p]=new v(p,1,!1,p.toLowerCase(),null,!1,!1)}),b.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(p){b[p]=new v(p,1,!1,p.toLowerCase(),null,!0,!0)});function k(p,x,M,A){var O=b.hasOwnProperty(x)?b[x]:null;(O!==null?O.type!==0:A||!(2<x.length)||x[0]!=="o"&&x[0]!=="O"||x[1]!=="n"&&x[1]!=="N")&&(y(x,M,O,A)&&(M=null),A||O===null?g(x)&&(M===null?p.removeAttribute(x):p.setAttribute(x,""+M)):O.mustUseProperty?p[O.propertyName]=M===null?O.type===3?!1:"":M:(x=O.attributeName,A=O.attributeNamespace,M===null?p.removeAttribute(x):(O=O.type,M=O===3||O===4&&M===!0?"":""+M,A?p.setAttributeNS(A,x,M):p.setAttribute(x,M))))}var R=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,j=Symbol.for("react.element"),T=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),P=Symbol.for("react.strict_mode"),I=Symbol.for("react.profiler"),$=Symbol.for("react.provider"),q=Symbol.for("react.context"),L=Symbol.for("react.forward_ref"),H=Symbol.for("react.suspense"),G=Symbol.for("react.suspense_list"),oe=Symbol.for("react.memo"),le=Symbol.for("react.lazy"),pe=Symbol.for("react.offscreen"),ce=Symbol.iterator;function te(p){return p===null||typeof p!="object"?null:(p=ce&&p[ce]||p["@@iterator"],typeof p=="function"?p:null)}var F=Object.assign,Q;function ae(p){if(Q===void 0)try{throw Error()}catch(M){var x=M.stack.trim().match(/\n( *(at )?)/);Q=x&&x[1]||""}return`
`+Q+p}var we=!1;function Re(p,x){if(!p||we)return"";we=!0;var M=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(x)if(x=function(){throw Error()},Object.defineProperty(x.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(x,[])}catch(ot){var A=ot}Reflect.construct(p,[],x)}else{try{x.call()}catch(ot){A=ot}p.call(x.prototype)}else{try{throw Error()}catch(ot){A=ot}p()}}catch(ot){if(ot&&A&&typeof ot.stack=="string"){for(var O=ot.stack.split(`
`),B=A.stack.split(`
`),Y=O.length-1,ve=B.length-1;1<=Y&&0<=ve&&O[Y]!==B[ve];)ve--;for(;1<=Y&&0<=ve;Y--,ve--)if(O[Y]!==B[ve]){if(Y!==1||ve!==1)do if(Y--,ve--,0>ve||O[Y]!==B[ve]){var Pe=`
`+O[Y].replace(" at new "," at ");return p.displayName&&Pe.includes("<anonymous>")&&(Pe=Pe.replace("<anonymous>",p.displayName)),Pe}while(1<=Y&&0<=ve);break}}}finally{we=!1,Error.prepareStackTrace=M}return(p=p?p.displayName||p.name:"")?ae(p):""}function ge(p){switch(p.tag){case 5:return ae(p.type);case 16:return ae("Lazy");case 13:return ae("Suspense");case 19:return ae("SuspenseList");case 0:case 2:case 15:return p=Re(p.type,!1),p;case 11:return p=Re(p.type.render,!1),p;case 1:return p=Re(p.type,!0),p;default:return""}}function Ae(p){if(p==null)return null;if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case _:return"Fragment";case T:return"Portal";case I:return"Profiler";case P:return"StrictMode";case H:return"Suspense";case G:return"SuspenseList"}if(typeof p=="object")switch(p.$$typeof){case q:return(p.displayName||"Context")+".Consumer";case $:return(p._context.displayName||"Context")+".Provider";case L:var x=p.render;return p=p.displayName,p||(p=x.displayName||x.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case oe:return x=p.displayName||null,x!==null?x:Ae(p.type)||"Memo";case le:x=p._payload,p=p._init;try{return Ae(p(x))}catch{}}return null}function tt(p){var x=p.type;switch(p.tag){case 24:return"Cache";case 9:return(x.displayName||"Context")+".Consumer";case 10:return(x._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return p=x.render,p=p.displayName||p.name||"",x.displayName||(p!==""?"ForwardRef("+p+")":"ForwardRef");case 7:return"Fragment";case 5:return x;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ae(x);case 8:return x===P?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof x=="function")return x.displayName||x.name||null;if(typeof x=="string")return x}return null}function We(p){switch(typeof p){case"boolean":case"number":case"string":case"undefined":return p;case"object":return p;default:return""}}function J(p){var x=p.type;return(p=p.nodeName)&&p.toLowerCase()==="input"&&(x==="checkbox"||x==="radio")}function ke(p){var x=J(p)?"checked":"value",M=Object.getOwnPropertyDescriptor(p.constructor.prototype,x),A=""+p[x];if(!p.hasOwnProperty(x)&&typeof M<"u"&&typeof M.get=="function"&&typeof M.set=="function"){var O=M.get,B=M.set;return Object.defineProperty(p,x,{configurable:!0,get:function(){return O.call(this)},set:function(Y){A=""+Y,B.call(this,Y)}}),Object.defineProperty(p,x,{enumerable:M.enumerable}),{getValue:function(){return A},setValue:function(Y){A=""+Y},stopTracking:function(){p._valueTracker=null,delete p[x]}}}}function Le(p){p._valueTracker||(p._valueTracker=ke(p))}function K(p){if(!p)return!1;var x=p._valueTracker;if(!x)return!0;var M=x.getValue(),A="";return p&&(A=J(p)?p.checked?"true":"false":p.value),p=A,p!==M?(x.setValue(p),!0):!1}function et(p){if(p=p||(typeof document<"u"?document:void 0),typeof p>"u")return null;try{return p.activeElement||p.body}catch{return p.body}}function dt(p,x){var M=x.checked;return F({},x,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:M??p._wrapperState.initialChecked})}function Rt(p,x){var M=x.defaultValue==null?"":x.defaultValue,A=x.checked!=null?x.checked:x.defaultChecked;M=We(x.value!=null?x.value:M),p._wrapperState={initialChecked:A,initialValue:M,controlled:x.type==="checkbox"||x.type==="radio"?x.checked!=null:x.value!=null}}function Wt(p,x){x=x.checked,x!=null&&k(p,"checked",x,!1)}function Zt(p,x){Wt(p,x);var M=We(x.value),A=x.type;if(M!=null)A==="number"?(M===0&&p.value===""||p.value!=M)&&(p.value=""+M):p.value!==""+M&&(p.value=""+M);else if(A==="submit"||A==="reset"){p.removeAttribute("value");return}x.hasOwnProperty("value")?Ze(p,x.type,M):x.hasOwnProperty("defaultValue")&&Ze(p,x.type,We(x.defaultValue)),x.checked==null&&x.defaultChecked!=null&&(p.defaultChecked=!!x.defaultChecked)}function $e(p,x,M){if(x.hasOwnProperty("value")||x.hasOwnProperty("defaultValue")){var A=x.type;if(!(A!=="submit"&&A!=="reset"||x.value!==void 0&&x.value!==null))return;x=""+p._wrapperState.initialValue,M||x===p.value||(p.value=x),p.defaultValue=x}M=p.name,M!==""&&(p.name=""),p.defaultChecked=!!p._wrapperState.initialChecked,M!==""&&(p.name=M)}function Ze(p,x,M){(x!=="number"||et(p.ownerDocument)!==p)&&(M==null?p.defaultValue=""+p._wrapperState.initialValue:p.defaultValue!==""+M&&(p.defaultValue=""+M))}var Fe=Array.isArray;function Xe(p,x,M,A){if(p=p.options,x){x={};for(var O=0;O<M.length;O++)x["$"+M[O]]=!0;for(M=0;M<p.length;M++)O=x.hasOwnProperty("$"+p[M].value),p[M].selected!==O&&(p[M].selected=O),O&&A&&(p[M].defaultSelected=!0)}else{for(M=""+We(M),x=null,O=0;O<p.length;O++){if(p[O].value===M){p[O].selected=!0,A&&(p[O].defaultSelected=!0);return}x!==null||p[O].disabled||(x=p[O])}x!==null&&(x.selected=!0)}}function jt(p,x){if(x.dangerouslySetInnerHTML!=null)throw Error(r(91));return F({},x,{value:void 0,defaultValue:void 0,children:""+p._wrapperState.initialValue})}function hn(p,x){var M=x.value;if(M==null){if(M=x.children,x=x.defaultValue,M!=null){if(x!=null)throw Error(r(92));if(Fe(M)){if(1<M.length)throw Error(r(93));M=M[0]}x=M}x==null&&(x=""),M=x}p._wrapperState={initialValue:We(M)}}function an(p,x){var M=We(x.value),A=We(x.defaultValue);M!=null&&(M=""+M,M!==p.value&&(p.value=M),x.defaultValue==null&&p.defaultValue!==M&&(p.defaultValue=M)),A!=null&&(p.defaultValue=""+A)}function it(p){var x=p.textContent;x===p._wrapperState.initialValue&&x!==""&&x!==null&&(p.value=x)}function kt(p){switch(p){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function On(p,x){return p==null||p==="http://www.w3.org/1999/xhtml"?kt(x):p==="http://www.w3.org/2000/svg"&&x==="foreignObject"?"http://www.w3.org/1999/xhtml":p}var sn,Xn=(function(p){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(x,M,A,O){MSApp.execUnsafeLocalFunction(function(){return p(x,M,A,O)})}:p})(function(p,x){if(p.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in p)p.innerHTML=x;else{for(sn=sn||document.createElement("div"),sn.innerHTML="<svg>"+x.valueOf().toString()+"</svg>",x=sn.firstChild;p.firstChild;)p.removeChild(p.firstChild);for(;x.firstChild;)p.appendChild(x.firstChild)}});function Pt(p,x){if(x){var M=p.firstChild;if(M&&M===p.lastChild&&M.nodeType===3){M.nodeValue=x;return}}p.textContent=x}var zt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},jn=["Webkit","ms","Moz","O"];Object.keys(zt).forEach(function(p){jn.forEach(function(x){x=x+p.charAt(0).toUpperCase()+p.substring(1),zt[x]=zt[p]})});function En(p,x,M){return x==null||typeof x=="boolean"||x===""?"":M||typeof x!="number"||x===0||zt.hasOwnProperty(p)&&zt[p]?(""+x).trim():x+"px"}function lt(p,x){p=p.style;for(var M in x)if(x.hasOwnProperty(M)){var A=M.indexOf("--")===0,O=En(M,x[M],A);M==="float"&&(M="cssFloat"),A?p.setProperty(M,O):p[M]=O}}var ht=F({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function _t(p,x){if(x){if(ht[p]&&(x.children!=null||x.dangerouslySetInnerHTML!=null))throw Error(r(137,p));if(x.dangerouslySetInnerHTML!=null){if(x.children!=null)throw Error(r(60));if(typeof x.dangerouslySetInnerHTML!="object"||!("__html"in x.dangerouslySetInnerHTML))throw Error(r(61))}if(x.style!=null&&typeof x.style!="object")throw Error(r(62))}}function Ie(p,x){if(p.indexOf("-")===-1)return typeof x.is=="string";switch(p){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var at=null;function St(p){return p=p.target||p.srcElement||window,p.correspondingUseElement&&(p=p.correspondingUseElement),p.nodeType===3?p.parentNode:p}var ye=null,xe=null,gt=null;function Ge(p){if(p=Sa(p)){if(typeof ye!="function")throw Error(r(280));var x=p.stateNode;x&&(x=To(x),ye(p.stateNode,p.type,x))}}function Ye(p){xe?gt?gt.push(p):gt=[p]:xe=p}function Ve(){if(xe){var p=xe,x=gt;if(gt=xe=null,Ge(p),x)for(p=0;p<x.length;p++)Ge(x[p])}}function Oe(p,x){return p(x)}function Gt(){}var Kt=!1;function fn(p,x,M){if(Kt)return p(x,M);Kt=!0;try{return Oe(p,x,M)}finally{Kt=!1,(xe!==null||gt!==null)&&(Gt(),Ve())}}function zn(p,x){var M=p.stateNode;if(M===null)return null;var A=To(M);if(A===null)return null;M=A[x];e:switch(x){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(A=!A.disabled)||(p=p.type,A=!(p==="button"||p==="input"||p==="select"||p==="textarea")),p=!A;break e;default:p=!1}if(p)return null;if(M&&typeof M!="function")throw Error(r(231,x,typeof M));return M}var rt=!1;if(u)try{var mt={};Object.defineProperty(mt,"passive",{get:function(){rt=!0}}),window.addEventListener("test",mt,mt),window.removeEventListener("test",mt,mt)}catch{rt=!1}function yt(p,x,M,A,O,B,Y,ve,Pe){var ot=Array.prototype.slice.call(arguments,3);try{x.apply(M,ot)}catch(Lt){this.onError(Lt)}}var Et=!1,Ft=null,me=!1,cn=null,Xt={onError:function(p){Et=!0,Ft=p}};function Dt(p,x,M,A,O,B,Y,ve,Pe){Et=!1,Ft=null,yt.apply(Xt,arguments)}function ne(p,x,M,A,O,B,Y,ve,Pe){if(Dt.apply(this,arguments),Et){if(Et){var ot=Ft;Et=!1,Ft=null}else throw Error(r(198));me||(me=!0,cn=ot)}}function Ne(p){var x=p,M=p;if(p.alternate)for(;x.return;)x=x.return;else{p=x;do x=p,(x.flags&4098)!==0&&(M=x.return),p=x.return;while(p)}return x.tag===3?M:null}function Ke(p){if(p.tag===13){var x=p.memoizedState;if(x===null&&(p=p.alternate,p!==null&&(x=p.memoizedState)),x!==null)return x.dehydrated}return null}function Ct(p){if(Ne(p)!==p)throw Error(r(188))}function ft(p){var x=p.alternate;if(!x){if(x=Ne(p),x===null)throw Error(r(188));return x!==p?null:p}for(var M=p,A=x;;){var O=M.return;if(O===null)break;var B=O.alternate;if(B===null){if(A=O.return,A!==null){M=A;continue}break}if(O.child===B.child){for(B=O.child;B;){if(B===M)return Ct(O),p;if(B===A)return Ct(O),x;B=B.sibling}throw Error(r(188))}if(M.return!==A.return)M=O,A=B;else{for(var Y=!1,ve=O.child;ve;){if(ve===M){Y=!0,M=O,A=B;break}if(ve===A){Y=!0,A=O,M=B;break}ve=ve.sibling}if(!Y){for(ve=B.child;ve;){if(ve===M){Y=!0,M=B,A=O;break}if(ve===A){Y=!0,A=B,M=O;break}ve=ve.sibling}if(!Y)throw Error(r(189))}}if(M.alternate!==A)throw Error(r(190))}if(M.tag!==3)throw Error(r(188));return M.stateNode.current===M?p:x}function At(p){return p=ft(p),p!==null?bt(p):null}function bt(p){if(p.tag===5||p.tag===6)return p;for(p=p.child;p!==null;){var x=bt(p);if(x!==null)return x;p=p.sibling}return null}var nn=t.unstable_scheduleCallback,Bt=t.unstable_cancelCallback,Jt=t.unstable_shouldYield,Qt=t.unstable_requestPaint,en=t.unstable_now,vn=t.unstable_getCurrentPriorityLevel,Wn=t.unstable_ImmediatePriority,Gn=t.unstable_UserBlockingPriority,cr=t.unstable_NormalPriority,pr=t.unstable_LowPriority,br=t.unstable_IdlePriority,hr=null,or=null;function uo(p){if(or&&typeof or.onCommitFiberRoot=="function")try{or.onCommitFiberRoot(hr,p,void 0,(p.current.flags&128)===128)}catch{}}var fr=Math.clz32?Math.clz32:jo,Tr=Math.log,Ir=Math.LN2;function jo(p){return p>>>=0,p===0?32:31-(Tr(p)/Ir|0)|0}var bo=64,vo=4194304;function Zo(p){switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return p&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return p}}function Jo(p,x){var M=p.pendingLanes;if(M===0)return 0;var A=0,O=p.suspendedLanes,B=p.pingedLanes,Y=M&268435455;if(Y!==0){var ve=Y&~O;ve!==0?A=Zo(ve):(B&=Y,B!==0&&(A=Zo(B)))}else Y=M&~O,Y!==0?A=Zo(Y):B!==0&&(A=Zo(B));if(A===0)return 0;if(x!==0&&x!==A&&(x&O)===0&&(O=A&-A,B=x&-x,O>=B||O===16&&(B&4194240)!==0))return x;if((A&4)!==0&&(A|=M&16),x=p.entangledLanes,x!==0)for(p=p.entanglements,x&=A;0<x;)M=31-fr(x),O=1<<M,A|=p[M],x&=~O;return A}function Ua(p,x){switch(p){case 1:case 2:case 4:return x+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return x+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Na(p,x){for(var M=p.suspendedLanes,A=p.pingedLanes,O=p.expirationTimes,B=p.pendingLanes;0<B;){var Y=31-fr(B),ve=1<<Y,Pe=O[Y];Pe===-1?((ve&M)===0||(ve&A)!==0)&&(O[Y]=Ua(ve,x)):Pe<=x&&(p.expiredLanes|=ve),B&=~ve}}function sa(p){return p=p.pendingLanes&-1073741825,p!==0?p:p&1073741824?1073741824:0}function So(){var p=bo;return bo<<=1,(bo&4194240)===0&&(bo=64),p}function Oo(p){for(var x=[],M=0;31>M;M++)x.push(p);return x}function U(p,x,M){p.pendingLanes|=x,x!==536870912&&(p.suspendedLanes=0,p.pingedLanes=0),p=p.eventTimes,x=31-fr(x),p[x]=M}function je(p,x){var M=p.pendingLanes&~x;p.pendingLanes=x,p.suspendedLanes=0,p.pingedLanes=0,p.expiredLanes&=x,p.mutableReadLanes&=x,p.entangledLanes&=x,x=p.entanglements;var A=p.eventTimes;for(p=p.expirationTimes;0<M;){var O=31-fr(M),B=1<<O;x[O]=0,A[O]=-1,p[O]=-1,M&=~B}}function W(p,x){var M=p.entangledLanes|=x;for(p=p.entanglements;M;){var A=31-fr(M),O=1<<A;O&x|p[A]&x&&(p[A]|=x),M&=~O}}var X=0;function Te(p){return p&=-p,1<p?4<p?(p&268435455)!==0?16:536870912:4:1}var He,he,fe,be,Ee,Me=!1,_e=[],Je=null,Vt=null,rn=null,pn=new Map,re=new Map,de=[],Se="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function qe(p,x){switch(p){case"focusin":case"focusout":Je=null;break;case"dragenter":case"dragleave":Vt=null;break;case"mouseover":case"mouseout":rn=null;break;case"pointerover":case"pointerout":pn.delete(x.pointerId);break;case"gotpointercapture":case"lostpointercapture":re.delete(x.pointerId)}}function st(p,x,M,A,O,B){return p===null||p.nativeEvent!==B?(p={blockedOn:x,domEventName:M,eventSystemFlags:A,nativeEvent:B,targetContainers:[O]},x!==null&&(x=Sa(x),x!==null&&he(x)),p):(p.eventSystemFlags|=A,x=p.targetContainers,O!==null&&x.indexOf(O)===-1&&x.push(O),p)}function $t(p,x,M,A,O){switch(x){case"focusin":return Je=st(Je,p,x,M,A,O),!0;case"dragenter":return Vt=st(Vt,p,x,M,A,O),!0;case"mouseover":return rn=st(rn,p,x,M,A,O),!0;case"pointerover":var B=O.pointerId;return pn.set(B,st(pn.get(B)||null,p,x,M,A,O)),!0;case"gotpointercapture":return B=O.pointerId,re.set(B,st(re.get(B)||null,p,x,M,A,O)),!0}return!1}function Tt(p){var x=ur(p.target);if(x!==null){var M=Ne(x);if(M!==null){if(x=M.tag,x===13){if(x=Ke(M),x!==null){p.blockedOn=x,Ee(p.priority,function(){fe(M)});return}}else if(x===3&&M.stateNode.current.memoizedState.isDehydrated){p.blockedOn=M.tag===3?M.stateNode.containerInfo:null;return}}}p.blockedOn=null}function Ut(p){if(p.blockedOn!==null)return!1;for(var x=p.targetContainers;0<x.length;){var M=Eo(p.domEventName,p.eventSystemFlags,x[0],p.nativeEvent);if(M===null){M=p.nativeEvent;var A=new M.constructor(M.type,M);at=A,M.target.dispatchEvent(A),at=null}else return x=Sa(M),x!==null&&he(x),p.blockedOn=M,!1;x.shift()}return!0}function ln(p,x,M){Ut(p)&&M.delete(x)}function wt(){Me=!1,Je!==null&&Ut(Je)&&(Je=null),Vt!==null&&Ut(Vt)&&(Vt=null),rn!==null&&Ut(rn)&&(rn=null),pn.forEach(ln),re.forEach(ln)}function mn(p,x){p.blockedOn===x&&(p.blockedOn=null,Me||(Me=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,wt)))}function un(p){function x(O){return mn(O,p)}if(0<_e.length){mn(_e[0],p);for(var M=1;M<_e.length;M++){var A=_e[M];A.blockedOn===p&&(A.blockedOn=null)}}for(Je!==null&&mn(Je,p),Vt!==null&&mn(Vt,p),rn!==null&&mn(rn,p),pn.forEach(x),re.forEach(x),M=0;M<de.length;M++)A=de[M],A.blockedOn===p&&(A.blockedOn=null);for(;0<de.length&&(M=de[0],M.blockedOn===null);)Tt(M),M.blockedOn===null&&de.shift()}var $n=R.ReactCurrentBatchConfig,It=!0;function dn(p,x,M,A){var O=X,B=$n.transition;$n.transition=null;try{X=1,Sn(p,x,M,A)}finally{X=O,$n.transition=B}}function gn(p,x,M,A){var O=X,B=$n.transition;$n.transition=null;try{X=4,Sn(p,x,M,A)}finally{X=O,$n.transition=B}}function Sn(p,x,M,A){if(It){var O=Eo(p,x,M,A);if(O===null)kn(p,x,A,nr,M),qe(p,A);else if($t(O,p,x,M,A))A.stopPropagation();else if(qe(p,A),x&4&&-1<Se.indexOf(p)){for(;O!==null;){var B=Sa(O);if(B!==null&&He(B),B=Eo(p,x,M,A),B===null&&kn(p,x,A,nr,M),B===O)break;O=B}O!==null&&A.stopPropagation()}else kn(p,x,A,null,M)}}var nr=null;function Eo(p,x,M,A){if(nr=null,p=St(A),p=ur(p),p!==null)if(x=Ne(p),x===null)p=null;else if(M=x.tag,M===13){if(p=Ke(x),p!==null)return p;p=null}else if(M===3){if(x.stateNode.current.memoizedState.isDehydrated)return x.tag===3?x.stateNode.containerInfo:null;p=null}else x!==p&&(p=null);return nr=p,null}function ro(p){switch(p){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(vn()){case Wn:return 1;case Gn:return 4;case cr:case pr:return 16;case br:return 536870912;default:return 16}default:return 16}}var Bn=null,ar=null,_o=null;function Ar(){if(_o)return _o;var p,x=ar,M=x.length,A,O="value"in Bn?Bn.value:Bn.textContent,B=O.length;for(p=0;p<M&&x[p]===O[p];p++);var Y=M-p;for(A=1;A<=Y&&x[M-A]===O[B-A];A++);return _o=O.slice(p,1<A?1-A:void 0)}function Nn(p){var x=p.keyCode;return"charCode"in p?(p=p.charCode,p===0&&x===13&&(p=13)):p=x,p===10&&(p=13),32<=p||p===13?p:0}function Vn(){return!0}function ir(){return!1}function mr(p){function x(M,A,O,B,Y){this._reactName=M,this._targetInst=O,this.type=A,this.nativeEvent=B,this.target=Y,this.currentTarget=null;for(var ve in p)p.hasOwnProperty(ve)&&(M=p[ve],this[ve]=M?M(B):B[ve]);return this.isDefaultPrevented=(B.defaultPrevented!=null?B.defaultPrevented:B.returnValue===!1)?Vn:ir,this.isPropagationStopped=ir,this}return F(x.prototype,{preventDefault:function(){this.defaultPrevented=!0;var M=this.nativeEvent;M&&(M.preventDefault?M.preventDefault():typeof M.returnValue!="unknown"&&(M.returnValue=!1),this.isDefaultPrevented=Vn)},stopPropagation:function(){var M=this.nativeEvent;M&&(M.stopPropagation?M.stopPropagation():typeof M.cancelBubble!="unknown"&&(M.cancelBubble=!0),this.isPropagationStopped=Vn)},persist:function(){},isPersistent:Vn}),x}var Gr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(p){return p.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Dr=mr(Gr),Rr=F({},Gr,{view:0,detail:0}),Ho=mr(Rr),yn,Vr,pi,Us=F({},Rr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Zi,button:0,buttons:0,relatedTarget:function(p){return p.relatedTarget===void 0?p.fromElement===p.srcElement?p.toElement:p.fromElement:p.relatedTarget},movementX:function(p){return"movementX"in p?p.movementX:(p!==pi&&(pi&&p.type==="mousemove"?(yn=p.screenX-pi.screenX,Vr=p.screenY-pi.screenY):Vr=yn=0,pi=p),yn)},movementY:function(p){return"movementY"in p?p.movementY:Vr}}),Ml=mr(Us),mi=F({},Us,{dataTransfer:0}),Lh=mr(mi),Bd=F({},Rr,{relatedTarget:0}),Oa=mr(Bd),wn=F({},Gr,{animationName:0,elapsedTime:0,pseudoElement:0}),zh=mr(wn),Ys=F({},Gr,{clipboardData:function(p){return"clipboardData"in p?p.clipboardData:window.clipboardData}}),wo=mr(Ys),ia=F({},Gr,{data:0}),is=mr(ia),_a={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},oc={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},$d={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Bh(p){var x=this.nativeEvent;return x.getModifierState?x.getModifierState(p):(p=$d[p])?!!x[p]:!1}function Zi(){return Bh}var _p=F({},Rr,{key:function(p){if(p.key){var x=_a[p.key]||p.key;if(x!=="Unidentified")return x}return p.type==="keypress"?(p=Nn(p),p===13?"Enter":String.fromCharCode(p)):p.type==="keydown"||p.type==="keyup"?oc[p.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Zi,charCode:function(p){return p.type==="keypress"?Nn(p):0},keyCode:function(p){return p.type==="keydown"||p.type==="keyup"?p.keyCode:0},which:function(p){return p.type==="keypress"?Nn(p):p.type==="keydown"||p.type==="keyup"?p.keyCode:0}}),$h=mr(_p),Dp=F({},Us,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),l0=mr(Dp),Ts=F({},Rr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Zi}),qh=mr(Ts),qd=F({},Gr,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ji=mr(qd),c0=F({},Us,{deltaX:function(p){return"deltaX"in p?p.deltaX:"wheelDeltaX"in p?-p.wheelDeltaX:0},deltaY:function(p){return"deltaY"in p?p.deltaY:"wheelDeltaY"in p?-p.wheelDeltaY:"wheelDelta"in p?-p.wheelDelta:0},deltaZ:0,deltaMode:0}),ac=mr(c0),sc=[9,13,27,32],gi=u&&"CompositionEvent"in window,kl=null;u&&"documentMode"in document&&(kl=document.documentMode);var ic=u&&"TextEvent"in window&&!kl,Wh=u&&(!gi||kl&&8<kl&&11>=kl),Qi=" ",Hh=!1;function d0(p,x){switch(p){case"keyup":return sc.indexOf(x.keyCode)!==-1;case"keydown":return x.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function lc(p){return p=p.detail,typeof p=="object"&&"data"in p?p.data:null}var Da=!1;function Wd(p,x){switch(p){case"compositionend":return lc(x);case"keypress":return x.which!==32?null:(Hh=!0,Qi);case"textInput":return p=x.data,p===Qi&&Hh?null:p;default:return null}}function u0(p,x){if(Da)return p==="compositionend"||!gi&&d0(p,x)?(p=Ar(),_o=ar=Bn=null,Da=!1,p):null;switch(p){case"paste":return null;case"keypress":if(!(x.ctrlKey||x.altKey||x.metaKey)||x.ctrlKey&&x.altKey){if(x.char&&1<x.char.length)return x.char;if(x.which)return String.fromCharCode(x.which)}return null;case"compositionend":return Wh&&x.locale!=="ko"?null:x.data;default:return null}}var Hd={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function cc(p){var x=p&&p.nodeName&&p.nodeName.toLowerCase();return x==="input"?!!Hd[p.type]:x==="textarea"}function Gd(p,x,M,A){Ye(A),x=Zn(x,"onChange"),0<x.length&&(M=new Dr("onChange","change",null,M,A),p.push({event:M,listeners:x}))}var el=null,Rl=null;function Gh(p){Ce(p,0)}function yi(p){var x=Lr(p);if(K(x))return p}function Vd(p,x){if(p==="change")return x}var h0=!1;if(u){var f0;if(u){var xa="oninput"in document;if(!xa){var Is=document.createElement("div");Is.setAttribute("oninput","return;"),xa=typeof Is.oninput=="function"}f0=xa}else f0=!1;h0=f0&&(!document.documentMode||9<document.documentMode)}function p0(){el&&(el.detachEvent("onpropertychange",Ks),Rl=el=null)}function Ks(p){if(p.propertyName==="value"&&yi(Rl)){var x=[];Gd(x,Rl,p,St(p)),fn(Gh,x)}}function Tn(p,x,M){p==="focusin"?(p0(),el=x,Rl=M,el.attachEvent("onpropertychange",Ks)):p==="focusout"&&p0()}function m0(p){if(p==="selectionchange"||p==="keyup"||p==="keydown")return yi(Rl)}function g0(p,x){if(p==="click")return yi(x)}function y0(p,x){if(p==="input"||p==="change")return yi(x)}function Ud(p,x){return p===x&&(p!==0||1/p===1/x)||p!==p&&x!==x}var Ya=typeof Object.is=="function"?Object.is:Ud;function Al(p,x){if(Ya(p,x))return!0;if(typeof p!="object"||p===null||typeof x!="object"||x===null)return!1;var M=Object.keys(p),A=Object.keys(x);if(M.length!==A.length)return!1;for(A=0;A<M.length;A++){var O=M[A];if(!c.call(x,O)||!Ya(p[O],x[O]))return!1}return!0}function dc(p){for(;p&&p.firstChild;)p=p.firstChild;return p}function x0(p,x){var M=dc(p);p=0;for(var A;M;){if(M.nodeType===3){if(A=p+M.textContent.length,p<=x&&A>=x)return{node:M,offset:x-p};p=A}e:{for(;M;){if(M.nextSibling){M=M.nextSibling;break e}M=M.parentNode}M=void 0}M=dc(M)}}function Yd(p,x){return p&&x?p===x?!0:p&&p.nodeType===3?!1:x&&x.nodeType===3?Yd(p,x.parentNode):"contains"in p?p.contains(x):p.compareDocumentPosition?!!(p.compareDocumentPosition(x)&16):!1:!1}function Kd(){for(var p=window,x=et();x instanceof p.HTMLIFrameElement;){try{var M=typeof x.contentWindow.location.href=="string"}catch{M=!1}if(M)p=x.contentWindow;else break;x=et(p.document)}return x}function jl(p){var x=p&&p.nodeName&&p.nodeName.toLowerCase();return x&&(x==="input"&&(p.type==="text"||p.type==="search"||p.type==="tel"||p.type==="url"||p.type==="password")||x==="textarea"||p.contentEditable==="true")}function Vh(p){var x=Kd(),M=p.focusedElem,A=p.selectionRange;if(x!==M&&M&&M.ownerDocument&&Yd(M.ownerDocument.documentElement,M)){if(A!==null&&jl(M)){if(x=A.start,p=A.end,p===void 0&&(p=x),"selectionStart"in M)M.selectionStart=x,M.selectionEnd=Math.min(p,M.value.length);else if(p=(x=M.ownerDocument||document)&&x.defaultView||window,p.getSelection){p=p.getSelection();var O=M.textContent.length,B=Math.min(A.start,O);A=A.end===void 0?B:Math.min(A.end,O),!p.extend&&B>A&&(O=A,A=B,B=O),O=x0(M,B);var Y=x0(M,A);O&&Y&&(p.rangeCount!==1||p.anchorNode!==O.node||p.anchorOffset!==O.offset||p.focusNode!==Y.node||p.focusOffset!==Y.offset)&&(x=x.createRange(),x.setStart(O.node,O.offset),p.removeAllRanges(),B>A?(p.addRange(x),p.extend(Y.node,Y.offset)):(x.setEnd(Y.node,Y.offset),p.addRange(x)))}}for(x=[],p=M;p=p.parentNode;)p.nodeType===1&&x.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof M.focus=="function"&&M.focus(),M=0;M<x.length;M++)p=x[M],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var Uh=u&&"documentMode"in document&&11>=document.documentMode,tl=null,b0=null,El=null,v0=!1;function Xd(p,x,M){var A=M.window===M?M.document:M.nodeType===9?M:M.ownerDocument;v0||tl==null||tl!==et(A)||(A=tl,"selectionStart"in A&&jl(A)?A={start:A.selectionStart,end:A.selectionEnd}:(A=(A.ownerDocument&&A.ownerDocument.defaultView||window).getSelection(),A={anchorNode:A.anchorNode,anchorOffset:A.anchorOffset,focusNode:A.focusNode,focusOffset:A.focusOffset}),El&&Al(El,A)||(El=A,A=Zn(b0,"onSelect"),0<A.length&&(x=new Dr("onSelect","select",null,x,M),p.push({event:x,listeners:A}),x.target=tl)))}function uc(p,x){var M={};return M[p.toLowerCase()]=x.toLowerCase(),M["Webkit"+p]="webkit"+x,M["Moz"+p]="moz"+x,M}var nl={animationend:uc("Animation","AnimationEnd"),animationiteration:uc("Animation","AnimationIteration"),animationstart:uc("Animation","AnimationStart"),transitionend:uc("Transition","TransitionEnd")},Ps={},rl={};u&&(rl=document.createElement("div").style,"AnimationEvent"in window||(delete nl.animationend.animation,delete nl.animationiteration.animation,delete nl.animationstart.animation),"TransitionEvent"in window||delete nl.transitionend.transition);function ba(p){if(Ps[p])return Ps[p];if(!nl[p])return p;var x=nl[p],M;for(M in x)if(x.hasOwnProperty(M)&&M in rl)return Ps[p]=x[M];return p}var la=ba("animationend"),Xs=ba("animationiteration"),S0=ba("animationstart"),Zd=ba("transitionend"),w0=new Map,C0="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Z(p,x){w0.set(p,x),l(x,[p])}for(var Ue=0;Ue<C0.length;Ue++){var ut=C0[Ue],E=ut.toLowerCase(),D=ut[0].toUpperCase()+ut.slice(1);Z(E,"on"+D)}Z(la,"onAnimationEnd"),Z(Xs,"onAnimationIteration"),Z(S0,"onAnimationStart"),Z("dblclick","onDoubleClick"),Z("focusin","onFocus"),Z("focusout","onBlur"),Z(Zd,"onTransitionEnd"),i("onMouseEnter",["mouseout","mouseover"]),i("onMouseLeave",["mouseout","mouseover"]),i("onPointerEnter",["pointerout","pointerover"]),i("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var z="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ee=new Set("cancel close invalid load scroll toggle".split(" ").concat(z));function ue(p,x,M){var A=p.type||"unknown-event";p.currentTarget=M,ne(A,x,void 0,p),p.currentTarget=null}function Ce(p,x){x=(x&4)!==0;for(var M=0;M<p.length;M++){var A=p[M],O=A.event;A=A.listeners;e:{var B=void 0;if(x)for(var Y=A.length-1;0<=Y;Y--){var ve=A[Y],Pe=ve.instance,ot=ve.currentTarget;if(ve=ve.listener,Pe!==B&&O.isPropagationStopped())break e;ue(O,ve,ot),B=Pe}else for(Y=0;Y<A.length;Y++){if(ve=A[Y],Pe=ve.instance,ot=ve.currentTarget,ve=ve.listener,Pe!==B&&O.isPropagationStopped())break e;ue(O,ve,ot),B=Pe}}}if(me)throw p=cn,me=!1,cn=null,p}function ze(p,x){var M=x[Go];M===void 0&&(M=x[Go]=new Set);var A=p+"__bubble";M.has(A)||(on(x,p,2,!1),M.add(A))}function De(p,x,M){var A=0;x&&(A|=4),on(M,p,A,x)}var ct="_reactListening"+Math.random().toString(36).slice(2);function pt(p){if(!p[ct]){p[ct]=!0,o.forEach(function(M){M!=="selectionchange"&&(ee.has(M)||De(M,!1,p),De(M,!0,p))});var x=p.nodeType===9?p:p.ownerDocument;x===null||x[ct]||(x[ct]=!0,De("selectionchange",!1,x))}}function on(p,x,M,A){switch(ro(x)){case 1:var O=dn;break;case 4:O=gn;break;default:O=Sn}M=O.bind(null,x,M,p),O=void 0,!rt||x!=="touchstart"&&x!=="touchmove"&&x!=="wheel"||(O=!0),A?O!==void 0?p.addEventListener(x,M,{capture:!0,passive:O}):p.addEventListener(x,M,!0):O!==void 0?p.addEventListener(x,M,{passive:O}):p.addEventListener(x,M,!1)}function kn(p,x,M,A,O){var B=A;if((x&1)===0&&(x&2)===0&&A!==null)e:for(;;){if(A===null)return;var Y=A.tag;if(Y===3||Y===4){var ve=A.stateNode.containerInfo;if(ve===O||ve.nodeType===8&&ve.parentNode===O)break;if(Y===4)for(Y=A.return;Y!==null;){var Pe=Y.tag;if((Pe===3||Pe===4)&&(Pe=Y.stateNode.containerInfo,Pe===O||Pe.nodeType===8&&Pe.parentNode===O))return;Y=Y.return}for(;ve!==null;){if(Y=ur(ve),Y===null)return;if(Pe=Y.tag,Pe===5||Pe===6){A=B=Y;continue e}ve=ve.parentNode}}A=A.return}fn(function(){var ot=B,Lt=St(M),Ht=[];e:{var Nt=w0.get(p);if(Nt!==void 0){var Cn=Dr,Pn=p;switch(p){case"keypress":if(Nn(M)===0)break e;case"keydown":case"keyup":Cn=$h;break;case"focusin":Pn="focus",Cn=Oa;break;case"focusout":Pn="blur",Cn=Oa;break;case"beforeblur":case"afterblur":Cn=Oa;break;case"click":if(M.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Cn=Ml;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Cn=Lh;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Cn=qh;break;case la:case Xs:case S0:Cn=zh;break;case Zd:Cn=Ji;break;case"scroll":Cn=Ho;break;case"wheel":Cn=ac;break;case"copy":case"cut":case"paste":Cn=wo;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Cn=l0}var _n=(x&4)!==0,zo=!_n&&p==="scroll",Qe=_n?Nt!==null?Nt+"Capture":null:Nt;_n=[];for(var Be=ot,nt;Be!==null;){nt=Be;var tn=nt.stateNode;if(nt.tag===5&&tn!==null&&(nt=tn,Qe!==null&&(tn=zn(Be,Qe),tn!=null&&_n.push(xn(Be,tn,nt)))),zo)break;Be=Be.return}0<_n.length&&(Nt=new Cn(Nt,Pn,null,M,Lt),Ht.push({event:Nt,listeners:_n}))}}if((x&7)===0){e:{if(Nt=p==="mouseover"||p==="pointerover",Cn=p==="mouseout"||p==="pointerout",Nt&&M!==at&&(Pn=M.relatedTarget||M.fromElement)&&(ur(Pn)||Pn[ls]))break e;if((Cn||Nt)&&(Nt=Lt.window===Lt?Lt:(Nt=Lt.ownerDocument)?Nt.defaultView||Nt.parentWindow:window,Cn?(Pn=M.relatedTarget||M.toElement,Cn=ot,Pn=Pn?ur(Pn):null,Pn!==null&&(zo=Ne(Pn),Pn!==zo||Pn.tag!==5&&Pn.tag!==6)&&(Pn=null)):(Cn=null,Pn=ot),Cn!==Pn)){if(_n=Ml,tn="onMouseLeave",Qe="onMouseEnter",Be="mouse",(p==="pointerout"||p==="pointerover")&&(_n=l0,tn="onPointerLeave",Qe="onPointerEnter",Be="pointer"),zo=Cn==null?Nt:Lr(Cn),nt=Pn==null?Nt:Lr(Pn),Nt=new _n(tn,Be+"leave",Cn,M,Lt),Nt.target=zo,Nt.relatedTarget=nt,tn=null,ur(Lt)===ot&&(_n=new _n(Qe,Be+"enter",Pn,M,Lt),_n.target=nt,_n.relatedTarget=zo,tn=_n),zo=tn,Cn&&Pn)t:{for(_n=Cn,Qe=Pn,Be=0,nt=_n;nt;nt=dr(nt))Be++;for(nt=0,tn=Qe;tn;tn=dr(tn))nt++;for(;0<Be-nt;)_n=dr(_n),Be--;for(;0<nt-Be;)Qe=dr(Qe),nt--;for(;Be--;){if(_n===Qe||Qe!==null&&_n===Qe.alternate)break t;_n=dr(_n),Qe=dr(Qe)}_n=null}else _n=null;Cn!==null&&Ur(Ht,Nt,Cn,_n,!1),Pn!==null&&zo!==null&&Ur(Ht,zo,Pn,_n,!0)}}e:{if(Nt=ot?Lr(ot):window,Cn=Nt.nodeName&&Nt.nodeName.toLowerCase(),Cn==="select"||Cn==="input"&&Nt.type==="file")var Dn=Vd;else if(cc(Nt))if(h0)Dn=y0;else{Dn=m0;var Un=Tn}else(Cn=Nt.nodeName)&&Cn.toLowerCase()==="input"&&(Nt.type==="checkbox"||Nt.type==="radio")&&(Dn=g0);if(Dn&&(Dn=Dn(p,ot))){Gd(Ht,Dn,M,Lt);break e}Un&&Un(p,Nt,ot),p==="focusout"&&(Un=Nt._wrapperState)&&Un.controlled&&Nt.type==="number"&&Ze(Nt,"number",Nt.value)}switch(Un=ot?Lr(ot):window,p){case"focusin":(cc(Un)||Un.contentEditable==="true")&&(tl=Un,b0=ot,El=null);break;case"focusout":El=b0=tl=null;break;case"mousedown":v0=!0;break;case"contextmenu":case"mouseup":case"dragend":v0=!1,Xd(Ht,M,Lt);break;case"selectionchange":if(Uh)break;case"keydown":case"keyup":Xd(Ht,M,Lt)}var Yn;if(gi)e:{switch(p){case"compositionstart":var rr="onCompositionStart";break e;case"compositionend":rr="onCompositionEnd";break e;case"compositionupdate":rr="onCompositionUpdate";break e}rr=void 0}else Da?d0(p,M)&&(rr="onCompositionEnd"):p==="keydown"&&M.keyCode===229&&(rr="onCompositionStart");rr&&(Wh&&M.locale!=="ko"&&(Da||rr!=="onCompositionStart"?rr==="onCompositionEnd"&&Da&&(Yn=Ar()):(Bn=Lt,ar="value"in Bn?Bn.value:Bn.textContent,Da=!0)),Un=Zn(ot,rr),0<Un.length&&(rr=new is(rr,p,null,M,Lt),Ht.push({event:rr,listeners:Un}),Yn?rr.data=Yn:(Yn=lc(M),Yn!==null&&(rr.data=Yn)))),(Yn=ic?Wd(p,M):u0(p,M))&&(ot=Zn(ot,"onBeforeInput"),0<ot.length&&(Lt=new is("onBeforeInput","beforeinput",null,M,Lt),Ht.push({event:Lt,listeners:ot}),Lt.data=Yn))}Ce(Ht,x)})}function xn(p,x,M){return{instance:p,listener:x,currentTarget:M}}function Zn(p,x){for(var M=x+"Capture",A=[];p!==null;){var O=p,B=O.stateNode;O.tag===5&&B!==null&&(O=B,B=zn(p,M),B!=null&&A.unshift(xn(p,B,O)),B=zn(p,x),B!=null&&A.push(xn(p,B,O))),p=p.return}return A}function dr(p){if(p===null)return null;do p=p.return;while(p&&p.tag!==5);return p||null}function Ur(p,x,M,A,O){for(var B=x._reactName,Y=[];M!==null&&M!==A;){var ve=M,Pe=ve.alternate,ot=ve.stateNode;if(Pe!==null&&Pe===A)break;ve.tag===5&&ot!==null&&(ve=ot,O?(Pe=zn(M,B),Pe!=null&&Y.unshift(xn(M,Pe,ve))):O||(Pe=zn(M,B),Pe!=null&&Y.push(xn(M,Pe,ve)))),M=M.return}Y.length!==0&&p.push({event:x,listeners:Y})}var oo=/\r\n?/g,Do=/\u0000|\uFFFD/g;function Lo(p){return(typeof p=="string"?p:""+p).replace(oo,`
`).replace(Do,"")}function vt(p,x,M){if(x=Lo(x),Lo(p)!==x&&M)throw Error(r(425))}function Mt(){}var xt=null,Mn=null;function Rn(p,x){return p==="textarea"||p==="noscript"||typeof x.children=="string"||typeof x.children=="number"||typeof x.dangerouslySetInnerHTML=="object"&&x.dangerouslySetInnerHTML!==null&&x.dangerouslySetInnerHTML.__html!=null}var Hn=typeof setTimeout=="function"?setTimeout:void 0,In=typeof clearTimeout=="function"?clearTimeout:void 0,sr=typeof Promise=="function"?Promise:void 0,bn=typeof queueMicrotask=="function"?queueMicrotask:typeof sr<"u"?function(p){return sr.resolve(null).then(p).catch(Yr)}:Hn;function Yr(p){setTimeout(function(){throw p})}function Kr(p,x){var M=x,A=0;do{var O=M.nextSibling;if(p.removeChild(M),O&&O.nodeType===8)if(M=O.data,M==="/$"){if(A===0){p.removeChild(O),un(x);return}A--}else M!=="$"&&M!=="$?"&&M!=="$!"||A++;M=O}while(M);un(x)}function ho(p){for(;p!=null;p=p.nextSibling){var x=p.nodeType;if(x===1||x===3)break;if(x===8){if(x=p.data,x==="$"||x==="$!"||x==="$?")break;if(x==="/$")return null}}return p}function M0(p){p=p.previousSibling;for(var x=0;p;){if(p.nodeType===8){var M=p.data;if(M==="$"||M==="$!"||M==="$?"){if(x===0)return p;x--}else M==="/$"&&x++}p=p.previousSibling}return null}var fo=Math.random().toString(36).slice(2),va="__reactFiber$"+fo,xi="__reactProps$"+fo,ls="__reactContainer$"+fo,Go="__reactEvents$"+fo,Lp="__reactListeners$"+fo,zp="__reactHandles$"+fo;function ur(p){var x=p[va];if(x)return x;for(var M=p.parentNode;M;){if(x=M[ls]||M[va]){if(M=x.alternate,x.child!==null||M!==null&&M.child!==null)for(p=M0(p);p!==null;){if(M=p[va])return M;p=M0(p)}return x}p=M,M=p.parentNode}return null}function Sa(p){return p=p[va]||p[ls],!p||p.tag!==5&&p.tag!==6&&p.tag!==13&&p.tag!==3?null:p}function Lr(p){if(p.tag===5||p.tag===6)return p.stateNode;throw Error(r(33))}function To(p){return p[xi]||null}var ol=[],Fs=-1;function La(p){return{current:p}}function ao(p){0>Fs||(p.current=ol[Fs],ol[Fs]=null,Fs--)}function Zr(p,x){Fs++,ol[Fs]=p.current,p.current=x}var hc={},za=La(hc),cs=La(!1),k0=hc;function Jd(p,x){var M=p.type.contextTypes;if(!M)return hc;var A=p.stateNode;if(A&&A.__reactInternalMemoizedUnmaskedChildContext===x)return A.__reactInternalMemoizedMaskedChildContext;var O={},B;for(B in M)O[B]=x[B];return A&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=x,p.__reactInternalMemoizedMaskedChildContext=O),O}function ds(p){return p=p.childContextTypes,p!=null}function Bp(){ao(cs),ao(za)}function Hv(p,x,M){if(za.current!==hc)throw Error(r(168));Zr(za,x),Zr(cs,M)}function Gv(p,x,M){var A=p.stateNode;if(x=x.childContextTypes,typeof A.getChildContext!="function")return M;A=A.getChildContext();for(var O in A)if(!(O in x))throw Error(r(108,tt(p)||"Unknown",O));return F({},M,A)}function $p(p){return p=(p=p.stateNode)&&p.__reactInternalMemoizedMergedChildContext||hc,k0=za.current,Zr(za,p),Zr(cs,cs.current),!0}function Vv(p,x,M){var A=p.stateNode;if(!A)throw Error(r(169));M?(p=Gv(p,x,k0),A.__reactInternalMemoizedMergedChildContext=p,ao(cs),ao(za),Zr(za,p)):ao(cs),Zr(cs,M)}var Tl=null,qp=!1,Kg=!1;function Uv(p){Tl===null?Tl=[p]:Tl.push(p)}function sA(p){qp=!0,Uv(p)}function fc(){if(!Kg&&Tl!==null){Kg=!0;var p=0,x=X;try{var M=Tl;for(X=1;p<M.length;p++){var A=M[p];do A=A(!0);while(A!==null)}Tl=null,qp=!1}catch(O){throw Tl!==null&&(Tl=Tl.slice(p+1)),nn(Wn,fc),O}finally{X=x,Kg=!1}}return null}var Qd=[],eu=0,Wp=null,Hp=0,Zs=[],Js=0,R0=null,Il=1,Pl="";function A0(p,x){Qd[eu++]=Hp,Qd[eu++]=Wp,Wp=p,Hp=x}function Yv(p,x,M){Zs[Js++]=Il,Zs[Js++]=Pl,Zs[Js++]=R0,R0=p;var A=Il;p=Pl;var O=32-fr(A)-1;A&=~(1<<O),M+=1;var B=32-fr(x)+O;if(30<B){var Y=O-O%5;B=(A&(1<<Y)-1).toString(32),A>>=Y,O-=Y,Il=1<<32-fr(x)+O|M<<O|A,Pl=B+p}else Il=1<<B|M<<O|A,Pl=p}function Xg(p){p.return!==null&&(A0(p,1),Yv(p,1,0))}function Zg(p){for(;p===Wp;)Wp=Qd[--eu],Qd[eu]=null,Hp=Qd[--eu],Qd[eu]=null;for(;p===R0;)R0=Zs[--Js],Zs[Js]=null,Pl=Zs[--Js],Zs[Js]=null,Il=Zs[--Js],Zs[Js]=null}var Ns=null,Os=null,po=!1,bi=null;function Kv(p,x){var M=ni(5,null,null,0);M.elementType="DELETED",M.stateNode=x,M.return=p,x=p.deletions,x===null?(p.deletions=[M],p.flags|=16):x.push(M)}function Xv(p,x){switch(p.tag){case 5:var M=p.type;return x=x.nodeType!==1||M.toLowerCase()!==x.nodeName.toLowerCase()?null:x,x!==null?(p.stateNode=x,Ns=p,Os=ho(x.firstChild),!0):!1;case 6:return x=p.pendingProps===""||x.nodeType!==3?null:x,x!==null?(p.stateNode=x,Ns=p,Os=null,!0):!1;case 13:return x=x.nodeType!==8?null:x,x!==null?(M=R0!==null?{id:Il,overflow:Pl}:null,p.memoizedState={dehydrated:x,treeContext:M,retryLane:1073741824},M=ni(18,null,null,0),M.stateNode=x,M.return=p,p.child=M,Ns=p,Os=null,!0):!1;default:return!1}}function Jg(p){return(p.mode&1)!==0&&(p.flags&128)===0}function Qg(p){if(po){var x=Os;if(x){var M=x;if(!Xv(p,x)){if(Jg(p))throw Error(r(418));x=ho(M.nextSibling);var A=Ns;x&&Xv(p,x)?Kv(A,M):(p.flags=p.flags&-4097|2,po=!1,Ns=p)}}else{if(Jg(p))throw Error(r(418));p.flags=p.flags&-4097|2,po=!1,Ns=p}}}function Zv(p){for(p=p.return;p!==null&&p.tag!==5&&p.tag!==3&&p.tag!==13;)p=p.return;Ns=p}function Gp(p){if(p!==Ns)return!1;if(!po)return Zv(p),po=!0,!1;var x;if((x=p.tag!==3)&&!(x=p.tag!==5)&&(x=p.type,x=x!=="head"&&x!=="body"&&!Rn(p.type,p.memoizedProps)),x&&(x=Os)){if(Jg(p))throw Jv(),Error(r(418));for(;x;)Kv(p,x),x=ho(x.nextSibling)}if(Zv(p),p.tag===13){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(r(317));e:{for(p=p.nextSibling,x=0;p;){if(p.nodeType===8){var M=p.data;if(M==="/$"){if(x===0){Os=ho(p.nextSibling);break e}x--}else M!=="$"&&M!=="$!"&&M!=="$?"||x++}p=p.nextSibling}Os=null}}else Os=Ns?ho(p.stateNode.nextSibling):null;return!0}function Jv(){for(var p=Os;p;)p=ho(p.nextSibling)}function tu(){Os=Ns=null,po=!1}function e1(p){bi===null?bi=[p]:bi.push(p)}var iA=R.ReactCurrentBatchConfig;function Yh(p,x,M){if(p=M.ref,p!==null&&typeof p!="function"&&typeof p!="object"){if(M._owner){if(M=M._owner,M){if(M.tag!==1)throw Error(r(309));var A=M.stateNode}if(!A)throw Error(r(147,p));var O=A,B=""+p;return x!==null&&x.ref!==null&&typeof x.ref=="function"&&x.ref._stringRef===B?x.ref:(x=function(Y){var ve=O.refs;Y===null?delete ve[B]:ve[B]=Y},x._stringRef=B,x)}if(typeof p!="string")throw Error(r(284));if(!M._owner)throw Error(r(290,p))}return p}function Vp(p,x){throw p=Object.prototype.toString.call(x),Error(r(31,p==="[object Object]"?"object with keys {"+Object.keys(x).join(", ")+"}":p))}function Qv(p){var x=p._init;return x(p._payload)}function e3(p){function x(Qe,Be){if(p){var nt=Qe.deletions;nt===null?(Qe.deletions=[Be],Qe.flags|=16):nt.push(Be)}}function M(Qe,Be){if(!p)return null;for(;Be!==null;)x(Qe,Be),Be=Be.sibling;return null}function A(Qe,Be){for(Qe=new Map;Be!==null;)Be.key!==null?Qe.set(Be.key,Be):Qe.set(Be.index,Be),Be=Be.sibling;return Qe}function O(Qe,Be){return Qe=Sc(Qe,Be),Qe.index=0,Qe.sibling=null,Qe}function B(Qe,Be,nt){return Qe.index=nt,p?(nt=Qe.alternate,nt!==null?(nt=nt.index,nt<Be?(Qe.flags|=2,Be):nt):(Qe.flags|=2,Be)):(Qe.flags|=1048576,Be)}function Y(Qe){return p&&Qe.alternate===null&&(Qe.flags|=2),Qe}function ve(Qe,Be,nt,tn){return Be===null||Be.tag!==6?(Be=G1(nt,Qe.mode,tn),Be.return=Qe,Be):(Be=O(Be,nt),Be.return=Qe,Be)}function Pe(Qe,Be,nt,tn){var Dn=nt.type;return Dn===_?Lt(Qe,Be,nt.props.children,tn,nt.key):Be!==null&&(Be.elementType===Dn||typeof Dn=="object"&&Dn!==null&&Dn.$$typeof===le&&Qv(Dn)===Be.type)?(tn=O(Be,nt.props),tn.ref=Yh(Qe,Be,nt),tn.return=Qe,tn):(tn=gm(nt.type,nt.key,nt.props,null,Qe.mode,tn),tn.ref=Yh(Qe,Be,nt),tn.return=Qe,tn)}function ot(Qe,Be,nt,tn){return Be===null||Be.tag!==4||Be.stateNode.containerInfo!==nt.containerInfo||Be.stateNode.implementation!==nt.implementation?(Be=V1(nt,Qe.mode,tn),Be.return=Qe,Be):(Be=O(Be,nt.children||[]),Be.return=Qe,Be)}function Lt(Qe,Be,nt,tn,Dn){return Be===null||Be.tag!==7?(Be=O0(nt,Qe.mode,tn,Dn),Be.return=Qe,Be):(Be=O(Be,nt),Be.return=Qe,Be)}function Ht(Qe,Be,nt){if(typeof Be=="string"&&Be!==""||typeof Be=="number")return Be=G1(""+Be,Qe.mode,nt),Be.return=Qe,Be;if(typeof Be=="object"&&Be!==null){switch(Be.$$typeof){case j:return nt=gm(Be.type,Be.key,Be.props,null,Qe.mode,nt),nt.ref=Yh(Qe,null,Be),nt.return=Qe,nt;case T:return Be=V1(Be,Qe.mode,nt),Be.return=Qe,Be;case le:var tn=Be._init;return Ht(Qe,tn(Be._payload),nt)}if(Fe(Be)||te(Be))return Be=O0(Be,Qe.mode,nt,null),Be.return=Qe,Be;Vp(Qe,Be)}return null}function Nt(Qe,Be,nt,tn){var Dn=Be!==null?Be.key:null;if(typeof nt=="string"&&nt!==""||typeof nt=="number")return Dn!==null?null:ve(Qe,Be,""+nt,tn);if(typeof nt=="object"&&nt!==null){switch(nt.$$typeof){case j:return nt.key===Dn?Pe(Qe,Be,nt,tn):null;case T:return nt.key===Dn?ot(Qe,Be,nt,tn):null;case le:return Dn=nt._init,Nt(Qe,Be,Dn(nt._payload),tn)}if(Fe(nt)||te(nt))return Dn!==null?null:Lt(Qe,Be,nt,tn,null);Vp(Qe,nt)}return null}function Cn(Qe,Be,nt,tn,Dn){if(typeof tn=="string"&&tn!==""||typeof tn=="number")return Qe=Qe.get(nt)||null,ve(Be,Qe,""+tn,Dn);if(typeof tn=="object"&&tn!==null){switch(tn.$$typeof){case j:return Qe=Qe.get(tn.key===null?nt:tn.key)||null,Pe(Be,Qe,tn,Dn);case T:return Qe=Qe.get(tn.key===null?nt:tn.key)||null,ot(Be,Qe,tn,Dn);case le:var Un=tn._init;return Cn(Qe,Be,nt,Un(tn._payload),Dn)}if(Fe(tn)||te(tn))return Qe=Qe.get(nt)||null,Lt(Be,Qe,tn,Dn,null);Vp(Be,tn)}return null}function Pn(Qe,Be,nt,tn){for(var Dn=null,Un=null,Yn=Be,rr=Be=0,ua=null;Yn!==null&&rr<nt.length;rr++){Yn.index>rr?(ua=Yn,Yn=null):ua=Yn.sibling;var Or=Nt(Qe,Yn,nt[rr],tn);if(Or===null){Yn===null&&(Yn=ua);break}p&&Yn&&Or.alternate===null&&x(Qe,Yn),Be=B(Or,Be,rr),Un===null?Dn=Or:Un.sibling=Or,Un=Or,Yn=ua}if(rr===nt.length)return M(Qe,Yn),po&&A0(Qe,rr),Dn;if(Yn===null){for(;rr<nt.length;rr++)Yn=Ht(Qe,nt[rr],tn),Yn!==null&&(Be=B(Yn,Be,rr),Un===null?Dn=Yn:Un.sibling=Yn,Un=Yn);return po&&A0(Qe,rr),Dn}for(Yn=A(Qe,Yn);rr<nt.length;rr++)ua=Cn(Yn,Qe,rr,nt[rr],tn),ua!==null&&(p&&ua.alternate!==null&&Yn.delete(ua.key===null?rr:ua.key),Be=B(ua,Be,rr),Un===null?Dn=ua:Un.sibling=ua,Un=ua);return p&&Yn.forEach(function(wc){return x(Qe,wc)}),po&&A0(Qe,rr),Dn}function _n(Qe,Be,nt,tn){var Dn=te(nt);if(typeof Dn!="function")throw Error(r(150));if(nt=Dn.call(nt),nt==null)throw Error(r(151));for(var Un=Dn=null,Yn=Be,rr=Be=0,ua=null,Or=nt.next();Yn!==null&&!Or.done;rr++,Or=nt.next()){Yn.index>rr?(ua=Yn,Yn=null):ua=Yn.sibling;var wc=Nt(Qe,Yn,Or.value,tn);if(wc===null){Yn===null&&(Yn=ua);break}p&&Yn&&wc.alternate===null&&x(Qe,Yn),Be=B(wc,Be,rr),Un===null?Dn=wc:Un.sibling=wc,Un=wc,Yn=ua}if(Or.done)return M(Qe,Yn),po&&A0(Qe,rr),Dn;if(Yn===null){for(;!Or.done;rr++,Or=nt.next())Or=Ht(Qe,Or.value,tn),Or!==null&&(Be=B(Or,Be,rr),Un===null?Dn=Or:Un.sibling=Or,Un=Or);return po&&A0(Qe,rr),Dn}for(Yn=A(Qe,Yn);!Or.done;rr++,Or=nt.next())Or=Cn(Yn,Qe,rr,Or.value,tn),Or!==null&&(p&&Or.alternate!==null&&Yn.delete(Or.key===null?rr:Or.key),Be=B(Or,Be,rr),Un===null?Dn=Or:Un.sibling=Or,Un=Or);return p&&Yn.forEach(function(BA){return x(Qe,BA)}),po&&A0(Qe,rr),Dn}function zo(Qe,Be,nt,tn){if(typeof nt=="object"&&nt!==null&&nt.type===_&&nt.key===null&&(nt=nt.props.children),typeof nt=="object"&&nt!==null){switch(nt.$$typeof){case j:e:{for(var Dn=nt.key,Un=Be;Un!==null;){if(Un.key===Dn){if(Dn=nt.type,Dn===_){if(Un.tag===7){M(Qe,Un.sibling),Be=O(Un,nt.props.children),Be.return=Qe,Qe=Be;break e}}else if(Un.elementType===Dn||typeof Dn=="object"&&Dn!==null&&Dn.$$typeof===le&&Qv(Dn)===Un.type){M(Qe,Un.sibling),Be=O(Un,nt.props),Be.ref=Yh(Qe,Un,nt),Be.return=Qe,Qe=Be;break e}M(Qe,Un);break}else x(Qe,Un);Un=Un.sibling}nt.type===_?(Be=O0(nt.props.children,Qe.mode,tn,nt.key),Be.return=Qe,Qe=Be):(tn=gm(nt.type,nt.key,nt.props,null,Qe.mode,tn),tn.ref=Yh(Qe,Be,nt),tn.return=Qe,Qe=tn)}return Y(Qe);case T:e:{for(Un=nt.key;Be!==null;){if(Be.key===Un)if(Be.tag===4&&Be.stateNode.containerInfo===nt.containerInfo&&Be.stateNode.implementation===nt.implementation){M(Qe,Be.sibling),Be=O(Be,nt.children||[]),Be.return=Qe,Qe=Be;break e}else{M(Qe,Be);break}else x(Qe,Be);Be=Be.sibling}Be=V1(nt,Qe.mode,tn),Be.return=Qe,Qe=Be}return Y(Qe);case le:return Un=nt._init,zo(Qe,Be,Un(nt._payload),tn)}if(Fe(nt))return Pn(Qe,Be,nt,tn);if(te(nt))return _n(Qe,Be,nt,tn);Vp(Qe,nt)}return typeof nt=="string"&&nt!==""||typeof nt=="number"?(nt=""+nt,Be!==null&&Be.tag===6?(M(Qe,Be.sibling),Be=O(Be,nt),Be.return=Qe,Qe=Be):(M(Qe,Be),Be=G1(nt,Qe.mode,tn),Be.return=Qe,Qe=Be),Y(Qe)):M(Qe,Be)}return zo}var nu=e3(!0),t3=e3(!1),Up=La(null),Yp=null,ru=null,t1=null;function n1(){t1=ru=Yp=null}function r1(p){var x=Up.current;ao(Up),p._currentValue=x}function o1(p,x,M){for(;p!==null;){var A=p.alternate;if((p.childLanes&x)!==x?(p.childLanes|=x,A!==null&&(A.childLanes|=x)):A!==null&&(A.childLanes&x)!==x&&(A.childLanes|=x),p===M)break;p=p.return}}function ou(p,x){Yp=p,t1=ru=null,p=p.dependencies,p!==null&&p.firstContext!==null&&((p.lanes&x)!==0&&(us=!0),p.firstContext=null)}function Qs(p){var x=p._currentValue;if(t1!==p)if(p={context:p,memoizedValue:x,next:null},ru===null){if(Yp===null)throw Error(r(308));ru=p,Yp.dependencies={lanes:0,firstContext:p}}else ru=ru.next=p;return x}var j0=null;function a1(p){j0===null?j0=[p]:j0.push(p)}function n3(p,x,M,A){var O=x.interleaved;return O===null?(M.next=M,a1(x)):(M.next=O.next,O.next=M),x.interleaved=M,Fl(p,A)}function Fl(p,x){p.lanes|=x;var M=p.alternate;for(M!==null&&(M.lanes|=x),M=p,p=p.return;p!==null;)p.childLanes|=x,M=p.alternate,M!==null&&(M.childLanes|=x),M=p,p=p.return;return M.tag===3?M.stateNode:null}var pc=!1;function s1(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function r3(p,x){p=p.updateQueue,x.updateQueue===p&&(x.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,effects:p.effects})}function Nl(p,x){return{eventTime:p,lane:x,tag:0,payload:null,callback:null,next:null}}function mc(p,x,M){var A=p.updateQueue;if(A===null)return null;if(A=A.shared,(Pr&2)!==0){var O=A.pending;return O===null?x.next=x:(x.next=O.next,O.next=x),A.pending=x,Fl(p,M)}return O=A.interleaved,O===null?(x.next=x,a1(A)):(x.next=O.next,O.next=x),A.interleaved=x,Fl(p,M)}function Kp(p,x,M){if(x=x.updateQueue,x!==null&&(x=x.shared,(M&4194240)!==0)){var A=x.lanes;A&=p.pendingLanes,M|=A,x.lanes=M,W(p,M)}}function o3(p,x){var M=p.updateQueue,A=p.alternate;if(A!==null&&(A=A.updateQueue,M===A)){var O=null,B=null;if(M=M.firstBaseUpdate,M!==null){do{var Y={eventTime:M.eventTime,lane:M.lane,tag:M.tag,payload:M.payload,callback:M.callback,next:null};B===null?O=B=Y:B=B.next=Y,M=M.next}while(M!==null);B===null?O=B=x:B=B.next=x}else O=B=x;M={baseState:A.baseState,firstBaseUpdate:O,lastBaseUpdate:B,shared:A.shared,effects:A.effects},p.updateQueue=M;return}p=M.lastBaseUpdate,p===null?M.firstBaseUpdate=x:p.next=x,M.lastBaseUpdate=x}function Xp(p,x,M,A){var O=p.updateQueue;pc=!1;var B=O.firstBaseUpdate,Y=O.lastBaseUpdate,ve=O.shared.pending;if(ve!==null){O.shared.pending=null;var Pe=ve,ot=Pe.next;Pe.next=null,Y===null?B=ot:Y.next=ot,Y=Pe;var Lt=p.alternate;Lt!==null&&(Lt=Lt.updateQueue,ve=Lt.lastBaseUpdate,ve!==Y&&(ve===null?Lt.firstBaseUpdate=ot:ve.next=ot,Lt.lastBaseUpdate=Pe))}if(B!==null){var Ht=O.baseState;Y=0,Lt=ot=Pe=null,ve=B;do{var Nt=ve.lane,Cn=ve.eventTime;if((A&Nt)===Nt){Lt!==null&&(Lt=Lt.next={eventTime:Cn,lane:0,tag:ve.tag,payload:ve.payload,callback:ve.callback,next:null});e:{var Pn=p,_n=ve;switch(Nt=x,Cn=M,_n.tag){case 1:if(Pn=_n.payload,typeof Pn=="function"){Ht=Pn.call(Cn,Ht,Nt);break e}Ht=Pn;break e;case 3:Pn.flags=Pn.flags&-65537|128;case 0:if(Pn=_n.payload,Nt=typeof Pn=="function"?Pn.call(Cn,Ht,Nt):Pn,Nt==null)break e;Ht=F({},Ht,Nt);break e;case 2:pc=!0}}ve.callback!==null&&ve.lane!==0&&(p.flags|=64,Nt=O.effects,Nt===null?O.effects=[ve]:Nt.push(ve))}else Cn={eventTime:Cn,lane:Nt,tag:ve.tag,payload:ve.payload,callback:ve.callback,next:null},Lt===null?(ot=Lt=Cn,Pe=Ht):Lt=Lt.next=Cn,Y|=Nt;if(ve=ve.next,ve===null){if(ve=O.shared.pending,ve===null)break;Nt=ve,ve=Nt.next,Nt.next=null,O.lastBaseUpdate=Nt,O.shared.pending=null}}while(!0);if(Lt===null&&(Pe=Ht),O.baseState=Pe,O.firstBaseUpdate=ot,O.lastBaseUpdate=Lt,x=O.shared.interleaved,x!==null){O=x;do Y|=O.lane,O=O.next;while(O!==x)}else B===null&&(O.shared.lanes=0);I0|=Y,p.lanes=Y,p.memoizedState=Ht}}function a3(p,x,M){if(p=x.effects,x.effects=null,p!==null)for(x=0;x<p.length;x++){var A=p[x],O=A.callback;if(O!==null){if(A.callback=null,A=M,typeof O!="function")throw Error(r(191,O));O.call(A)}}}var Kh={},al=La(Kh),Xh=La(Kh),Zh=La(Kh);function E0(p){if(p===Kh)throw Error(r(174));return p}function i1(p,x){switch(Zr(Zh,x),Zr(Xh,p),Zr(al,Kh),p=x.nodeType,p){case 9:case 11:x=(x=x.documentElement)?x.namespaceURI:On(null,"");break;default:p=p===8?x.parentNode:x,x=p.namespaceURI||null,p=p.tagName,x=On(x,p)}ao(al),Zr(al,x)}function au(){ao(al),ao(Xh),ao(Zh)}function s3(p){E0(Zh.current);var x=E0(al.current),M=On(x,p.type);x!==M&&(Zr(Xh,p),Zr(al,M))}function l1(p){Xh.current===p&&(ao(al),ao(Xh))}var Co=La(0);function Zp(p){for(var x=p;x!==null;){if(x.tag===13){var M=x.memoizedState;if(M!==null&&(M=M.dehydrated,M===null||M.data==="$?"||M.data==="$!"))return x}else if(x.tag===19&&x.memoizedProps.revealOrder!==void 0){if((x.flags&128)!==0)return x}else if(x.child!==null){x.child.return=x,x=x.child;continue}if(x===p)break;for(;x.sibling===null;){if(x.return===null||x.return===p)return null;x=x.return}x.sibling.return=x.return,x=x.sibling}return null}var c1=[];function d1(){for(var p=0;p<c1.length;p++)c1[p]._workInProgressVersionPrimary=null;c1.length=0}var Jp=R.ReactCurrentDispatcher,u1=R.ReactCurrentBatchConfig,T0=0,Mo=null,Qo=null,ca=null,Qp=!1,Jh=!1,Qh=0,lA=0;function Ba(){throw Error(r(321))}function h1(p,x){if(x===null)return!1;for(var M=0;M<x.length&&M<p.length;M++)if(!Ya(p[M],x[M]))return!1;return!0}function f1(p,x,M,A,O,B){if(T0=B,Mo=x,x.memoizedState=null,x.updateQueue=null,x.lanes=0,Jp.current=p===null||p.memoizedState===null?hA:fA,p=M(A,O),Jh){B=0;do{if(Jh=!1,Qh=0,25<=B)throw Error(r(301));B+=1,ca=Qo=null,x.updateQueue=null,Jp.current=pA,p=M(A,O)}while(Jh)}if(Jp.current=nm,x=Qo!==null&&Qo.next!==null,T0=0,ca=Qo=Mo=null,Qp=!1,x)throw Error(r(300));return p}function p1(){var p=Qh!==0;return Qh=0,p}function sl(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ca===null?Mo.memoizedState=ca=p:ca=ca.next=p,ca}function ei(){if(Qo===null){var p=Mo.alternate;p=p!==null?p.memoizedState:null}else p=Qo.next;var x=ca===null?Mo.memoizedState:ca.next;if(x!==null)ca=x,Qo=p;else{if(p===null)throw Error(r(310));Qo=p,p={memoizedState:Qo.memoizedState,baseState:Qo.baseState,baseQueue:Qo.baseQueue,queue:Qo.queue,next:null},ca===null?Mo.memoizedState=ca=p:ca=ca.next=p}return ca}function ef(p,x){return typeof x=="function"?x(p):x}function m1(p){var x=ei(),M=x.queue;if(M===null)throw Error(r(311));M.lastRenderedReducer=p;var A=Qo,O=A.baseQueue,B=M.pending;if(B!==null){if(O!==null){var Y=O.next;O.next=B.next,B.next=Y}A.baseQueue=O=B,M.pending=null}if(O!==null){B=O.next,A=A.baseState;var ve=Y=null,Pe=null,ot=B;do{var Lt=ot.lane;if((T0&Lt)===Lt)Pe!==null&&(Pe=Pe.next={lane:0,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null}),A=ot.hasEagerState?ot.eagerState:p(A,ot.action);else{var Ht={lane:Lt,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null};Pe===null?(ve=Pe=Ht,Y=A):Pe=Pe.next=Ht,Mo.lanes|=Lt,I0|=Lt}ot=ot.next}while(ot!==null&&ot!==B);Pe===null?Y=A:Pe.next=ve,Ya(A,x.memoizedState)||(us=!0),x.memoizedState=A,x.baseState=Y,x.baseQueue=Pe,M.lastRenderedState=A}if(p=M.interleaved,p!==null){O=p;do B=O.lane,Mo.lanes|=B,I0|=B,O=O.next;while(O!==p)}else O===null&&(M.lanes=0);return[x.memoizedState,M.dispatch]}function g1(p){var x=ei(),M=x.queue;if(M===null)throw Error(r(311));M.lastRenderedReducer=p;var A=M.dispatch,O=M.pending,B=x.memoizedState;if(O!==null){M.pending=null;var Y=O=O.next;do B=p(B,Y.action),Y=Y.next;while(Y!==O);Ya(B,x.memoizedState)||(us=!0),x.memoizedState=B,x.baseQueue===null&&(x.baseState=B),M.lastRenderedState=B}return[B,A]}function i3(){}function l3(p,x){var M=Mo,A=ei(),O=x(),B=!Ya(A.memoizedState,O);if(B&&(A.memoizedState=O,us=!0),A=A.queue,y1(u3.bind(null,M,A,p),[p]),A.getSnapshot!==x||B||ca!==null&&ca.memoizedState.tag&1){if(M.flags|=2048,tf(9,d3.bind(null,M,A,O,x),void 0,null),da===null)throw Error(r(349));(T0&30)!==0||c3(M,x,O)}return O}function c3(p,x,M){p.flags|=16384,p={getSnapshot:x,value:M},x=Mo.updateQueue,x===null?(x={lastEffect:null,stores:null},Mo.updateQueue=x,x.stores=[p]):(M=x.stores,M===null?x.stores=[p]:M.push(p))}function d3(p,x,M,A){x.value=M,x.getSnapshot=A,h3(x)&&f3(p)}function u3(p,x,M){return M(function(){h3(x)&&f3(p)})}function h3(p){var x=p.getSnapshot;p=p.value;try{var M=x();return!Ya(p,M)}catch{return!0}}function f3(p){var x=Fl(p,1);x!==null&&Ci(x,p,1,-1)}function p3(p){var x=sl();return typeof p=="function"&&(p=p()),x.memoizedState=x.baseState=p,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ef,lastRenderedState:p},x.queue=p,p=p.dispatch=uA.bind(null,Mo,p),[x.memoizedState,p]}function tf(p,x,M,A){return p={tag:p,create:x,destroy:M,deps:A,next:null},x=Mo.updateQueue,x===null?(x={lastEffect:null,stores:null},Mo.updateQueue=x,x.lastEffect=p.next=p):(M=x.lastEffect,M===null?x.lastEffect=p.next=p:(A=M.next,M.next=p,p.next=A,x.lastEffect=p)),p}function m3(){return ei().memoizedState}function em(p,x,M,A){var O=sl();Mo.flags|=p,O.memoizedState=tf(1|x,M,void 0,A===void 0?null:A)}function tm(p,x,M,A){var O=ei();A=A===void 0?null:A;var B=void 0;if(Qo!==null){var Y=Qo.memoizedState;if(B=Y.destroy,A!==null&&h1(A,Y.deps)){O.memoizedState=tf(x,M,B,A);return}}Mo.flags|=p,O.memoizedState=tf(1|x,M,B,A)}function g3(p,x){return em(8390656,8,p,x)}function y1(p,x){return tm(2048,8,p,x)}function y3(p,x){return tm(4,2,p,x)}function x3(p,x){return tm(4,4,p,x)}function b3(p,x){if(typeof x=="function")return p=p(),x(p),function(){x(null)};if(x!=null)return p=p(),x.current=p,function(){x.current=null}}function v3(p,x,M){return M=M!=null?M.concat([p]):null,tm(4,4,b3.bind(null,x,p),M)}function x1(){}function S3(p,x){var M=ei();x=x===void 0?null:x;var A=M.memoizedState;return A!==null&&x!==null&&h1(x,A[1])?A[0]:(M.memoizedState=[p,x],p)}function w3(p,x){var M=ei();x=x===void 0?null:x;var A=M.memoizedState;return A!==null&&x!==null&&h1(x,A[1])?A[0]:(p=p(),M.memoizedState=[p,x],p)}function C3(p,x,M){return(T0&21)===0?(p.baseState&&(p.baseState=!1,us=!0),p.memoizedState=M):(Ya(M,x)||(M=So(),Mo.lanes|=M,I0|=M,p.baseState=!0),x)}function cA(p,x){var M=X;X=M!==0&&4>M?M:4,p(!0);var A=u1.transition;u1.transition={};try{p(!1),x()}finally{X=M,u1.transition=A}}function M3(){return ei().memoizedState}function dA(p,x,M){var A=bc(p);if(M={lane:A,action:M,hasEagerState:!1,eagerState:null,next:null},k3(p))R3(x,M);else if(M=n3(p,x,M,A),M!==null){var O=Xa();Ci(M,p,A,O),A3(M,x,A)}}function uA(p,x,M){var A=bc(p),O={lane:A,action:M,hasEagerState:!1,eagerState:null,next:null};if(k3(p))R3(x,O);else{var B=p.alternate;if(p.lanes===0&&(B===null||B.lanes===0)&&(B=x.lastRenderedReducer,B!==null))try{var Y=x.lastRenderedState,ve=B(Y,M);if(O.hasEagerState=!0,O.eagerState=ve,Ya(ve,Y)){var Pe=x.interleaved;Pe===null?(O.next=O,a1(x)):(O.next=Pe.next,Pe.next=O),x.interleaved=O;return}}catch{}finally{}M=n3(p,x,O,A),M!==null&&(O=Xa(),Ci(M,p,A,O),A3(M,x,A))}}function k3(p){var x=p.alternate;return p===Mo||x!==null&&x===Mo}function R3(p,x){Jh=Qp=!0;var M=p.pending;M===null?x.next=x:(x.next=M.next,M.next=x),p.pending=x}function A3(p,x,M){if((M&4194240)!==0){var A=x.lanes;A&=p.pendingLanes,M|=A,x.lanes=M,W(p,M)}}var nm={readContext:Qs,useCallback:Ba,useContext:Ba,useEffect:Ba,useImperativeHandle:Ba,useInsertionEffect:Ba,useLayoutEffect:Ba,useMemo:Ba,useReducer:Ba,useRef:Ba,useState:Ba,useDebugValue:Ba,useDeferredValue:Ba,useTransition:Ba,useMutableSource:Ba,useSyncExternalStore:Ba,useId:Ba,unstable_isNewReconciler:!1},hA={readContext:Qs,useCallback:function(p,x){return sl().memoizedState=[p,x===void 0?null:x],p},useContext:Qs,useEffect:g3,useImperativeHandle:function(p,x,M){return M=M!=null?M.concat([p]):null,em(4194308,4,b3.bind(null,x,p),M)},useLayoutEffect:function(p,x){return em(4194308,4,p,x)},useInsertionEffect:function(p,x){return em(4,2,p,x)},useMemo:function(p,x){var M=sl();return x=x===void 0?null:x,p=p(),M.memoizedState=[p,x],p},useReducer:function(p,x,M){var A=sl();return x=M!==void 0?M(x):x,A.memoizedState=A.baseState=x,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:x},A.queue=p,p=p.dispatch=dA.bind(null,Mo,p),[A.memoizedState,p]},useRef:function(p){var x=sl();return p={current:p},x.memoizedState=p},useState:p3,useDebugValue:x1,useDeferredValue:function(p){return sl().memoizedState=p},useTransition:function(){var p=p3(!1),x=p[0];return p=cA.bind(null,p[1]),sl().memoizedState=p,[x,p]},useMutableSource:function(){},useSyncExternalStore:function(p,x,M){var A=Mo,O=sl();if(po){if(M===void 0)throw Error(r(407));M=M()}else{if(M=x(),da===null)throw Error(r(349));(T0&30)!==0||c3(A,x,M)}O.memoizedState=M;var B={value:M,getSnapshot:x};return O.queue=B,g3(u3.bind(null,A,B,p),[p]),A.flags|=2048,tf(9,d3.bind(null,A,B,M,x),void 0,null),M},useId:function(){var p=sl(),x=da.identifierPrefix;if(po){var M=Pl,A=Il;M=(A&~(1<<32-fr(A)-1)).toString(32)+M,x=":"+x+"R"+M,M=Qh++,0<M&&(x+="H"+M.toString(32)),x+=":"}else M=lA++,x=":"+x+"r"+M.toString(32)+":";return p.memoizedState=x},unstable_isNewReconciler:!1},fA={readContext:Qs,useCallback:S3,useContext:Qs,useEffect:y1,useImperativeHandle:v3,useInsertionEffect:y3,useLayoutEffect:x3,useMemo:w3,useReducer:m1,useRef:m3,useState:function(){return m1(ef)},useDebugValue:x1,useDeferredValue:function(p){var x=ei();return C3(x,Qo.memoizedState,p)},useTransition:function(){var p=m1(ef)[0],x=ei().memoizedState;return[p,x]},useMutableSource:i3,useSyncExternalStore:l3,useId:M3,unstable_isNewReconciler:!1},pA={readContext:Qs,useCallback:S3,useContext:Qs,useEffect:y1,useImperativeHandle:v3,useInsertionEffect:y3,useLayoutEffect:x3,useMemo:w3,useReducer:g1,useRef:m3,useState:function(){return g1(ef)},useDebugValue:x1,useDeferredValue:function(p){var x=ei();return Qo===null?x.memoizedState=p:C3(x,Qo.memoizedState,p)},useTransition:function(){var p=g1(ef)[0],x=ei().memoizedState;return[p,x]},useMutableSource:i3,useSyncExternalStore:l3,useId:M3,unstable_isNewReconciler:!1};function vi(p,x){if(p&&p.defaultProps){x=F({},x),p=p.defaultProps;for(var M in p)x[M]===void 0&&(x[M]=p[M]);return x}return x}function b1(p,x,M,A){x=p.memoizedState,M=M(A,x),M=M==null?x:F({},x,M),p.memoizedState=M,p.lanes===0&&(p.updateQueue.baseState=M)}var rm={isMounted:function(p){return(p=p._reactInternals)?Ne(p)===p:!1},enqueueSetState:function(p,x,M){p=p._reactInternals;var A=Xa(),O=bc(p),B=Nl(A,O);B.payload=x,M!=null&&(B.callback=M),x=mc(p,B,O),x!==null&&(Ci(x,p,O,A),Kp(x,p,O))},enqueueReplaceState:function(p,x,M){p=p._reactInternals;var A=Xa(),O=bc(p),B=Nl(A,O);B.tag=1,B.payload=x,M!=null&&(B.callback=M),x=mc(p,B,O),x!==null&&(Ci(x,p,O,A),Kp(x,p,O))},enqueueForceUpdate:function(p,x){p=p._reactInternals;var M=Xa(),A=bc(p),O=Nl(M,A);O.tag=2,x!=null&&(O.callback=x),x=mc(p,O,A),x!==null&&(Ci(x,p,A,M),Kp(x,p,A))}};function j3(p,x,M,A,O,B,Y){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(A,B,Y):x.prototype&&x.prototype.isPureReactComponent?!Al(M,A)||!Al(O,B):!0}function E3(p,x,M){var A=!1,O=hc,B=x.contextType;return typeof B=="object"&&B!==null?B=Qs(B):(O=ds(x)?k0:za.current,A=x.contextTypes,B=(A=A!=null)?Jd(p,O):hc),x=new x(M,B),p.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,x.updater=rm,p.stateNode=x,x._reactInternals=p,A&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=O,p.__reactInternalMemoizedMaskedChildContext=B),x}function T3(p,x,M,A){p=x.state,typeof x.componentWillReceiveProps=="function"&&x.componentWillReceiveProps(M,A),typeof x.UNSAFE_componentWillReceiveProps=="function"&&x.UNSAFE_componentWillReceiveProps(M,A),x.state!==p&&rm.enqueueReplaceState(x,x.state,null)}function v1(p,x,M,A){var O=p.stateNode;O.props=M,O.state=p.memoizedState,O.refs={},s1(p);var B=x.contextType;typeof B=="object"&&B!==null?O.context=Qs(B):(B=ds(x)?k0:za.current,O.context=Jd(p,B)),O.state=p.memoizedState,B=x.getDerivedStateFromProps,typeof B=="function"&&(b1(p,x,B,M),O.state=p.memoizedState),typeof x.getDerivedStateFromProps=="function"||typeof O.getSnapshotBeforeUpdate=="function"||typeof O.UNSAFE_componentWillMount!="function"&&typeof O.componentWillMount!="function"||(x=O.state,typeof O.componentWillMount=="function"&&O.componentWillMount(),typeof O.UNSAFE_componentWillMount=="function"&&O.UNSAFE_componentWillMount(),x!==O.state&&rm.enqueueReplaceState(O,O.state,null),Xp(p,M,O,A),O.state=p.memoizedState),typeof O.componentDidMount=="function"&&(p.flags|=4194308)}function su(p,x){try{var M="",A=x;do M+=ge(A),A=A.return;while(A);var O=M}catch(B){O=`
Error generating stack: `+B.message+`
`+B.stack}return{value:p,source:x,stack:O,digest:null}}function S1(p,x,M){return{value:p,source:null,stack:M??null,digest:x??null}}function w1(p,x){try{console.error(x.value)}catch(M){setTimeout(function(){throw M})}}var mA=typeof WeakMap=="function"?WeakMap:Map;function I3(p,x,M){M=Nl(-1,M),M.tag=3,M.payload={element:null};var A=x.value;return M.callback=function(){dm||(dm=!0,D1=A),w1(p,x)},M}function P3(p,x,M){M=Nl(-1,M),M.tag=3;var A=p.type.getDerivedStateFromError;if(typeof A=="function"){var O=x.value;M.payload=function(){return A(O)},M.callback=function(){w1(p,x)}}var B=p.stateNode;return B!==null&&typeof B.componentDidCatch=="function"&&(M.callback=function(){w1(p,x),typeof A!="function"&&(yc===null?yc=new Set([this]):yc.add(this));var Y=x.stack;this.componentDidCatch(x.value,{componentStack:Y!==null?Y:""})}),M}function F3(p,x,M){var A=p.pingCache;if(A===null){A=p.pingCache=new mA;var O=new Set;A.set(x,O)}else O=A.get(x),O===void 0&&(O=new Set,A.set(x,O));O.has(M)||(O.add(M),p=EA.bind(null,p,x,M),x.then(p,p))}function N3(p){do{var x;if((x=p.tag===13)&&(x=p.memoizedState,x=x!==null?x.dehydrated!==null:!0),x)return p;p=p.return}while(p!==null);return null}function O3(p,x,M,A,O){return(p.mode&1)===0?(p===x?p.flags|=65536:(p.flags|=128,M.flags|=131072,M.flags&=-52805,M.tag===1&&(M.alternate===null?M.tag=17:(x=Nl(-1,1),x.tag=2,mc(M,x,1))),M.lanes|=1),p):(p.flags|=65536,p.lanes=O,p)}var gA=R.ReactCurrentOwner,us=!1;function Ka(p,x,M,A){x.child=p===null?t3(x,null,M,A):nu(x,p.child,M,A)}function _3(p,x,M,A,O){M=M.render;var B=x.ref;return ou(x,O),A=f1(p,x,M,A,B,O),M=p1(),p!==null&&!us?(x.updateQueue=p.updateQueue,x.flags&=-2053,p.lanes&=~O,Ol(p,x,O)):(po&&M&&Xg(x),x.flags|=1,Ka(p,x,A,O),x.child)}function D3(p,x,M,A,O){if(p===null){var B=M.type;return typeof B=="function"&&!H1(B)&&B.defaultProps===void 0&&M.compare===null&&M.defaultProps===void 0?(x.tag=15,x.type=B,L3(p,x,B,A,O)):(p=gm(M.type,null,A,x,x.mode,O),p.ref=x.ref,p.return=x,x.child=p)}if(B=p.child,(p.lanes&O)===0){var Y=B.memoizedProps;if(M=M.compare,M=M!==null?M:Al,M(Y,A)&&p.ref===x.ref)return Ol(p,x,O)}return x.flags|=1,p=Sc(B,A),p.ref=x.ref,p.return=x,x.child=p}function L3(p,x,M,A,O){if(p!==null){var B=p.memoizedProps;if(Al(B,A)&&p.ref===x.ref)if(us=!1,x.pendingProps=A=B,(p.lanes&O)!==0)(p.flags&131072)!==0&&(us=!0);else return x.lanes=p.lanes,Ol(p,x,O)}return C1(p,x,M,A,O)}function z3(p,x,M){var A=x.pendingProps,O=A.children,B=p!==null?p.memoizedState:null;if(A.mode==="hidden")if((x.mode&1)===0)x.memoizedState={baseLanes:0,cachePool:null,transitions:null},Zr(lu,_s),_s|=M;else{if((M&1073741824)===0)return p=B!==null?B.baseLanes|M:M,x.lanes=x.childLanes=1073741824,x.memoizedState={baseLanes:p,cachePool:null,transitions:null},x.updateQueue=null,Zr(lu,_s),_s|=p,null;x.memoizedState={baseLanes:0,cachePool:null,transitions:null},A=B!==null?B.baseLanes:M,Zr(lu,_s),_s|=A}else B!==null?(A=B.baseLanes|M,x.memoizedState=null):A=M,Zr(lu,_s),_s|=A;return Ka(p,x,O,M),x.child}function B3(p,x){var M=x.ref;(p===null&&M!==null||p!==null&&p.ref!==M)&&(x.flags|=512,x.flags|=2097152)}function C1(p,x,M,A,O){var B=ds(M)?k0:za.current;return B=Jd(x,B),ou(x,O),M=f1(p,x,M,A,B,O),A=p1(),p!==null&&!us?(x.updateQueue=p.updateQueue,x.flags&=-2053,p.lanes&=~O,Ol(p,x,O)):(po&&A&&Xg(x),x.flags|=1,Ka(p,x,M,O),x.child)}function $3(p,x,M,A,O){if(ds(M)){var B=!0;$p(x)}else B=!1;if(ou(x,O),x.stateNode===null)am(p,x),E3(x,M,A),v1(x,M,A,O),A=!0;else if(p===null){var Y=x.stateNode,ve=x.memoizedProps;Y.props=ve;var Pe=Y.context,ot=M.contextType;typeof ot=="object"&&ot!==null?ot=Qs(ot):(ot=ds(M)?k0:za.current,ot=Jd(x,ot));var Lt=M.getDerivedStateFromProps,Ht=typeof Lt=="function"||typeof Y.getSnapshotBeforeUpdate=="function";Ht||typeof Y.UNSAFE_componentWillReceiveProps!="function"&&typeof Y.componentWillReceiveProps!="function"||(ve!==A||Pe!==ot)&&T3(x,Y,A,ot),pc=!1;var Nt=x.memoizedState;Y.state=Nt,Xp(x,A,Y,O),Pe=x.memoizedState,ve!==A||Nt!==Pe||cs.current||pc?(typeof Lt=="function"&&(b1(x,M,Lt,A),Pe=x.memoizedState),(ve=pc||j3(x,M,ve,A,Nt,Pe,ot))?(Ht||typeof Y.UNSAFE_componentWillMount!="function"&&typeof Y.componentWillMount!="function"||(typeof Y.componentWillMount=="function"&&Y.componentWillMount(),typeof Y.UNSAFE_componentWillMount=="function"&&Y.UNSAFE_componentWillMount()),typeof Y.componentDidMount=="function"&&(x.flags|=4194308)):(typeof Y.componentDidMount=="function"&&(x.flags|=4194308),x.memoizedProps=A,x.memoizedState=Pe),Y.props=A,Y.state=Pe,Y.context=ot,A=ve):(typeof Y.componentDidMount=="function"&&(x.flags|=4194308),A=!1)}else{Y=x.stateNode,r3(p,x),ve=x.memoizedProps,ot=x.type===x.elementType?ve:vi(x.type,ve),Y.props=ot,Ht=x.pendingProps,Nt=Y.context,Pe=M.contextType,typeof Pe=="object"&&Pe!==null?Pe=Qs(Pe):(Pe=ds(M)?k0:za.current,Pe=Jd(x,Pe));var Cn=M.getDerivedStateFromProps;(Lt=typeof Cn=="function"||typeof Y.getSnapshotBeforeUpdate=="function")||typeof Y.UNSAFE_componentWillReceiveProps!="function"&&typeof Y.componentWillReceiveProps!="function"||(ve!==Ht||Nt!==Pe)&&T3(x,Y,A,Pe),pc=!1,Nt=x.memoizedState,Y.state=Nt,Xp(x,A,Y,O);var Pn=x.memoizedState;ve!==Ht||Nt!==Pn||cs.current||pc?(typeof Cn=="function"&&(b1(x,M,Cn,A),Pn=x.memoizedState),(ot=pc||j3(x,M,ot,A,Nt,Pn,Pe)||!1)?(Lt||typeof Y.UNSAFE_componentWillUpdate!="function"&&typeof Y.componentWillUpdate!="function"||(typeof Y.componentWillUpdate=="function"&&Y.componentWillUpdate(A,Pn,Pe),typeof Y.UNSAFE_componentWillUpdate=="function"&&Y.UNSAFE_componentWillUpdate(A,Pn,Pe)),typeof Y.componentDidUpdate=="function"&&(x.flags|=4),typeof Y.getSnapshotBeforeUpdate=="function"&&(x.flags|=1024)):(typeof Y.componentDidUpdate!="function"||ve===p.memoizedProps&&Nt===p.memoizedState||(x.flags|=4),typeof Y.getSnapshotBeforeUpdate!="function"||ve===p.memoizedProps&&Nt===p.memoizedState||(x.flags|=1024),x.memoizedProps=A,x.memoizedState=Pn),Y.props=A,Y.state=Pn,Y.context=Pe,A=ot):(typeof Y.componentDidUpdate!="function"||ve===p.memoizedProps&&Nt===p.memoizedState||(x.flags|=4),typeof Y.getSnapshotBeforeUpdate!="function"||ve===p.memoizedProps&&Nt===p.memoizedState||(x.flags|=1024),A=!1)}return M1(p,x,M,A,B,O)}function M1(p,x,M,A,O,B){B3(p,x);var Y=(x.flags&128)!==0;if(!A&&!Y)return O&&Vv(x,M,!1),Ol(p,x,B);A=x.stateNode,gA.current=x;var ve=Y&&typeof M.getDerivedStateFromError!="function"?null:A.render();return x.flags|=1,p!==null&&Y?(x.child=nu(x,p.child,null,B),x.child=nu(x,null,ve,B)):Ka(p,x,ve,B),x.memoizedState=A.state,O&&Vv(x,M,!0),x.child}function q3(p){var x=p.stateNode;x.pendingContext?Hv(p,x.pendingContext,x.pendingContext!==x.context):x.context&&Hv(p,x.context,!1),i1(p,x.containerInfo)}function W3(p,x,M,A,O){return tu(),e1(O),x.flags|=256,Ka(p,x,M,A),x.child}var k1={dehydrated:null,treeContext:null,retryLane:0};function R1(p){return{baseLanes:p,cachePool:null,transitions:null}}function H3(p,x,M){var A=x.pendingProps,O=Co.current,B=!1,Y=(x.flags&128)!==0,ve;if((ve=Y)||(ve=p!==null&&p.memoizedState===null?!1:(O&2)!==0),ve?(B=!0,x.flags&=-129):(p===null||p.memoizedState!==null)&&(O|=1),Zr(Co,O&1),p===null)return Qg(x),p=x.memoizedState,p!==null&&(p=p.dehydrated,p!==null)?((x.mode&1)===0?x.lanes=1:p.data==="$!"?x.lanes=8:x.lanes=1073741824,null):(Y=A.children,p=A.fallback,B?(A=x.mode,B=x.child,Y={mode:"hidden",children:Y},(A&1)===0&&B!==null?(B.childLanes=0,B.pendingProps=Y):B=ym(Y,A,0,null),p=O0(p,A,M,null),B.return=x,p.return=x,B.sibling=p,x.child=B,x.child.memoizedState=R1(M),x.memoizedState=k1,p):A1(x,Y));if(O=p.memoizedState,O!==null&&(ve=O.dehydrated,ve!==null))return yA(p,x,Y,A,ve,O,M);if(B){B=A.fallback,Y=x.mode,O=p.child,ve=O.sibling;var Pe={mode:"hidden",children:A.children};return(Y&1)===0&&x.child!==O?(A=x.child,A.childLanes=0,A.pendingProps=Pe,x.deletions=null):(A=Sc(O,Pe),A.subtreeFlags=O.subtreeFlags&14680064),ve!==null?B=Sc(ve,B):(B=O0(B,Y,M,null),B.flags|=2),B.return=x,A.return=x,A.sibling=B,x.child=A,A=B,B=x.child,Y=p.child.memoizedState,Y=Y===null?R1(M):{baseLanes:Y.baseLanes|M,cachePool:null,transitions:Y.transitions},B.memoizedState=Y,B.childLanes=p.childLanes&~M,x.memoizedState=k1,A}return B=p.child,p=B.sibling,A=Sc(B,{mode:"visible",children:A.children}),(x.mode&1)===0&&(A.lanes=M),A.return=x,A.sibling=null,p!==null&&(M=x.deletions,M===null?(x.deletions=[p],x.flags|=16):M.push(p)),x.child=A,x.memoizedState=null,A}function A1(p,x){return x=ym({mode:"visible",children:x},p.mode,0,null),x.return=p,p.child=x}function om(p,x,M,A){return A!==null&&e1(A),nu(x,p.child,null,M),p=A1(x,x.pendingProps.children),p.flags|=2,x.memoizedState=null,p}function yA(p,x,M,A,O,B,Y){if(M)return x.flags&256?(x.flags&=-257,A=S1(Error(r(422))),om(p,x,Y,A)):x.memoizedState!==null?(x.child=p.child,x.flags|=128,null):(B=A.fallback,O=x.mode,A=ym({mode:"visible",children:A.children},O,0,null),B=O0(B,O,Y,null),B.flags|=2,A.return=x,B.return=x,A.sibling=B,x.child=A,(x.mode&1)!==0&&nu(x,p.child,null,Y),x.child.memoizedState=R1(Y),x.memoizedState=k1,B);if((x.mode&1)===0)return om(p,x,Y,null);if(O.data==="$!"){if(A=O.nextSibling&&O.nextSibling.dataset,A)var ve=A.dgst;return A=ve,B=Error(r(419)),A=S1(B,A,void 0),om(p,x,Y,A)}if(ve=(Y&p.childLanes)!==0,us||ve){if(A=da,A!==null){switch(Y&-Y){case 4:O=2;break;case 16:O=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:O=32;break;case 536870912:O=268435456;break;default:O=0}O=(O&(A.suspendedLanes|Y))!==0?0:O,O!==0&&O!==B.retryLane&&(B.retryLane=O,Fl(p,O),Ci(A,p,O,-1))}return W1(),A=S1(Error(r(421))),om(p,x,Y,A)}return O.data==="$?"?(x.flags|=128,x.child=p.child,x=TA.bind(null,p),O._reactRetry=x,null):(p=B.treeContext,Os=ho(O.nextSibling),Ns=x,po=!0,bi=null,p!==null&&(Zs[Js++]=Il,Zs[Js++]=Pl,Zs[Js++]=R0,Il=p.id,Pl=p.overflow,R0=x),x=A1(x,A.children),x.flags|=4096,x)}function G3(p,x,M){p.lanes|=x;var A=p.alternate;A!==null&&(A.lanes|=x),o1(p.return,x,M)}function j1(p,x,M,A,O){var B=p.memoizedState;B===null?p.memoizedState={isBackwards:x,rendering:null,renderingStartTime:0,last:A,tail:M,tailMode:O}:(B.isBackwards=x,B.rendering=null,B.renderingStartTime=0,B.last=A,B.tail=M,B.tailMode=O)}function V3(p,x,M){var A=x.pendingProps,O=A.revealOrder,B=A.tail;if(Ka(p,x,A.children,M),A=Co.current,(A&2)!==0)A=A&1|2,x.flags|=128;else{if(p!==null&&(p.flags&128)!==0)e:for(p=x.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&G3(p,M,x);else if(p.tag===19)G3(p,M,x);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===x)break e;for(;p.sibling===null;){if(p.return===null||p.return===x)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}A&=1}if(Zr(Co,A),(x.mode&1)===0)x.memoizedState=null;else switch(O){case"forwards":for(M=x.child,O=null;M!==null;)p=M.alternate,p!==null&&Zp(p)===null&&(O=M),M=M.sibling;M=O,M===null?(O=x.child,x.child=null):(O=M.sibling,M.sibling=null),j1(x,!1,O,M,B);break;case"backwards":for(M=null,O=x.child,x.child=null;O!==null;){if(p=O.alternate,p!==null&&Zp(p)===null){x.child=O;break}p=O.sibling,O.sibling=M,M=O,O=p}j1(x,!0,M,null,B);break;case"together":j1(x,!1,null,null,void 0);break;default:x.memoizedState=null}return x.child}function am(p,x){(x.mode&1)===0&&p!==null&&(p.alternate=null,x.alternate=null,x.flags|=2)}function Ol(p,x,M){if(p!==null&&(x.dependencies=p.dependencies),I0|=x.lanes,(M&x.childLanes)===0)return null;if(p!==null&&x.child!==p.child)throw Error(r(153));if(x.child!==null){for(p=x.child,M=Sc(p,p.pendingProps),x.child=M,M.return=x;p.sibling!==null;)p=p.sibling,M=M.sibling=Sc(p,p.pendingProps),M.return=x;M.sibling=null}return x.child}function xA(p,x,M){switch(x.tag){case 3:q3(x),tu();break;case 5:s3(x);break;case 1:ds(x.type)&&$p(x);break;case 4:i1(x,x.stateNode.containerInfo);break;case 10:var A=x.type._context,O=x.memoizedProps.value;Zr(Up,A._currentValue),A._currentValue=O;break;case 13:if(A=x.memoizedState,A!==null)return A.dehydrated!==null?(Zr(Co,Co.current&1),x.flags|=128,null):(M&x.child.childLanes)!==0?H3(p,x,M):(Zr(Co,Co.current&1),p=Ol(p,x,M),p!==null?p.sibling:null);Zr(Co,Co.current&1);break;case 19:if(A=(M&x.childLanes)!==0,(p.flags&128)!==0){if(A)return V3(p,x,M);x.flags|=128}if(O=x.memoizedState,O!==null&&(O.rendering=null,O.tail=null,O.lastEffect=null),Zr(Co,Co.current),A)break;return null;case 22:case 23:return x.lanes=0,z3(p,x,M)}return Ol(p,x,M)}var U3,E1,Y3,K3;U3=function(p,x){for(var M=x.child;M!==null;){if(M.tag===5||M.tag===6)p.appendChild(M.stateNode);else if(M.tag!==4&&M.child!==null){M.child.return=M,M=M.child;continue}if(M===x)break;for(;M.sibling===null;){if(M.return===null||M.return===x)return;M=M.return}M.sibling.return=M.return,M=M.sibling}},E1=function(){},Y3=function(p,x,M,A){var O=p.memoizedProps;if(O!==A){p=x.stateNode,E0(al.current);var B=null;switch(M){case"input":O=dt(p,O),A=dt(p,A),B=[];break;case"select":O=F({},O,{value:void 0}),A=F({},A,{value:void 0}),B=[];break;case"textarea":O=jt(p,O),A=jt(p,A),B=[];break;default:typeof O.onClick!="function"&&typeof A.onClick=="function"&&(p.onclick=Mt)}_t(M,A);var Y;M=null;for(ot in O)if(!A.hasOwnProperty(ot)&&O.hasOwnProperty(ot)&&O[ot]!=null)if(ot==="style"){var ve=O[ot];for(Y in ve)ve.hasOwnProperty(Y)&&(M||(M={}),M[Y]="")}else ot!=="dangerouslySetInnerHTML"&&ot!=="children"&&ot!=="suppressContentEditableWarning"&&ot!=="suppressHydrationWarning"&&ot!=="autoFocus"&&(s.hasOwnProperty(ot)?B||(B=[]):(B=B||[]).push(ot,null));for(ot in A){var Pe=A[ot];if(ve=O!=null?O[ot]:void 0,A.hasOwnProperty(ot)&&Pe!==ve&&(Pe!=null||ve!=null))if(ot==="style")if(ve){for(Y in ve)!ve.hasOwnProperty(Y)||Pe&&Pe.hasOwnProperty(Y)||(M||(M={}),M[Y]="");for(Y in Pe)Pe.hasOwnProperty(Y)&&ve[Y]!==Pe[Y]&&(M||(M={}),M[Y]=Pe[Y])}else M||(B||(B=[]),B.push(ot,M)),M=Pe;else ot==="dangerouslySetInnerHTML"?(Pe=Pe?Pe.__html:void 0,ve=ve?ve.__html:void 0,Pe!=null&&ve!==Pe&&(B=B||[]).push(ot,Pe)):ot==="children"?typeof Pe!="string"&&typeof Pe!="number"||(B=B||[]).push(ot,""+Pe):ot!=="suppressContentEditableWarning"&&ot!=="suppressHydrationWarning"&&(s.hasOwnProperty(ot)?(Pe!=null&&ot==="onScroll"&&ze("scroll",p),B||ve===Pe||(B=[])):(B=B||[]).push(ot,Pe))}M&&(B=B||[]).push("style",M);var ot=B;(x.updateQueue=ot)&&(x.flags|=4)}},K3=function(p,x,M,A){M!==A&&(x.flags|=4)};function nf(p,x){if(!po)switch(p.tailMode){case"hidden":x=p.tail;for(var M=null;x!==null;)x.alternate!==null&&(M=x),x=x.sibling;M===null?p.tail=null:M.sibling=null;break;case"collapsed":M=p.tail;for(var A=null;M!==null;)M.alternate!==null&&(A=M),M=M.sibling;A===null?x||p.tail===null?p.tail=null:p.tail.sibling=null:A.sibling=null}}function $a(p){var x=p.alternate!==null&&p.alternate.child===p.child,M=0,A=0;if(x)for(var O=p.child;O!==null;)M|=O.lanes|O.childLanes,A|=O.subtreeFlags&14680064,A|=O.flags&14680064,O.return=p,O=O.sibling;else for(O=p.child;O!==null;)M|=O.lanes|O.childLanes,A|=O.subtreeFlags,A|=O.flags,O.return=p,O=O.sibling;return p.subtreeFlags|=A,p.childLanes=M,x}function bA(p,x,M){var A=x.pendingProps;switch(Zg(x),x.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return $a(x),null;case 1:return ds(x.type)&&Bp(),$a(x),null;case 3:return A=x.stateNode,au(),ao(cs),ao(za),d1(),A.pendingContext&&(A.context=A.pendingContext,A.pendingContext=null),(p===null||p.child===null)&&(Gp(x)?x.flags|=4:p===null||p.memoizedState.isDehydrated&&(x.flags&256)===0||(x.flags|=1024,bi!==null&&(B1(bi),bi=null))),E1(p,x),$a(x),null;case 5:l1(x);var O=E0(Zh.current);if(M=x.type,p!==null&&x.stateNode!=null)Y3(p,x,M,A,O),p.ref!==x.ref&&(x.flags|=512,x.flags|=2097152);else{if(!A){if(x.stateNode===null)throw Error(r(166));return $a(x),null}if(p=E0(al.current),Gp(x)){A=x.stateNode,M=x.type;var B=x.memoizedProps;switch(A[va]=x,A[xi]=B,p=(x.mode&1)!==0,M){case"dialog":ze("cancel",A),ze("close",A);break;case"iframe":case"object":case"embed":ze("load",A);break;case"video":case"audio":for(O=0;O<z.length;O++)ze(z[O],A);break;case"source":ze("error",A);break;case"img":case"image":case"link":ze("error",A),ze("load",A);break;case"details":ze("toggle",A);break;case"input":Rt(A,B),ze("invalid",A);break;case"select":A._wrapperState={wasMultiple:!!B.multiple},ze("invalid",A);break;case"textarea":hn(A,B),ze("invalid",A)}_t(M,B),O=null;for(var Y in B)if(B.hasOwnProperty(Y)){var ve=B[Y];Y==="children"?typeof ve=="string"?A.textContent!==ve&&(B.suppressHydrationWarning!==!0&&vt(A.textContent,ve,p),O=["children",ve]):typeof ve=="number"&&A.textContent!==""+ve&&(B.suppressHydrationWarning!==!0&&vt(A.textContent,ve,p),O=["children",""+ve]):s.hasOwnProperty(Y)&&ve!=null&&Y==="onScroll"&&ze("scroll",A)}switch(M){case"input":Le(A),$e(A,B,!0);break;case"textarea":Le(A),it(A);break;case"select":case"option":break;default:typeof B.onClick=="function"&&(A.onclick=Mt)}A=O,x.updateQueue=A,A!==null&&(x.flags|=4)}else{Y=O.nodeType===9?O:O.ownerDocument,p==="http://www.w3.org/1999/xhtml"&&(p=kt(M)),p==="http://www.w3.org/1999/xhtml"?M==="script"?(p=Y.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild)):typeof A.is=="string"?p=Y.createElement(M,{is:A.is}):(p=Y.createElement(M),M==="select"&&(Y=p,A.multiple?Y.multiple=!0:A.size&&(Y.size=A.size))):p=Y.createElementNS(p,M),p[va]=x,p[xi]=A,U3(p,x,!1,!1),x.stateNode=p;e:{switch(Y=Ie(M,A),M){case"dialog":ze("cancel",p),ze("close",p),O=A;break;case"iframe":case"object":case"embed":ze("load",p),O=A;break;case"video":case"audio":for(O=0;O<z.length;O++)ze(z[O],p);O=A;break;case"source":ze("error",p),O=A;break;case"img":case"image":case"link":ze("error",p),ze("load",p),O=A;break;case"details":ze("toggle",p),O=A;break;case"input":Rt(p,A),O=dt(p,A),ze("invalid",p);break;case"option":O=A;break;case"select":p._wrapperState={wasMultiple:!!A.multiple},O=F({},A,{value:void 0}),ze("invalid",p);break;case"textarea":hn(p,A),O=jt(p,A),ze("invalid",p);break;default:O=A}_t(M,O),ve=O;for(B in ve)if(ve.hasOwnProperty(B)){var Pe=ve[B];B==="style"?lt(p,Pe):B==="dangerouslySetInnerHTML"?(Pe=Pe?Pe.__html:void 0,Pe!=null&&Xn(p,Pe)):B==="children"?typeof Pe=="string"?(M!=="textarea"||Pe!=="")&&Pt(p,Pe):typeof Pe=="number"&&Pt(p,""+Pe):B!=="suppressContentEditableWarning"&&B!=="suppressHydrationWarning"&&B!=="autoFocus"&&(s.hasOwnProperty(B)?Pe!=null&&B==="onScroll"&&ze("scroll",p):Pe!=null&&k(p,B,Pe,Y))}switch(M){case"input":Le(p),$e(p,A,!1);break;case"textarea":Le(p),it(p);break;case"option":A.value!=null&&p.setAttribute("value",""+We(A.value));break;case"select":p.multiple=!!A.multiple,B=A.value,B!=null?Xe(p,!!A.multiple,B,!1):A.defaultValue!=null&&Xe(p,!!A.multiple,A.defaultValue,!0);break;default:typeof O.onClick=="function"&&(p.onclick=Mt)}switch(M){case"button":case"input":case"select":case"textarea":A=!!A.autoFocus;break e;case"img":A=!0;break e;default:A=!1}}A&&(x.flags|=4)}x.ref!==null&&(x.flags|=512,x.flags|=2097152)}return $a(x),null;case 6:if(p&&x.stateNode!=null)K3(p,x,p.memoizedProps,A);else{if(typeof A!="string"&&x.stateNode===null)throw Error(r(166));if(M=E0(Zh.current),E0(al.current),Gp(x)){if(A=x.stateNode,M=x.memoizedProps,A[va]=x,(B=A.nodeValue!==M)&&(p=Ns,p!==null))switch(p.tag){case 3:vt(A.nodeValue,M,(p.mode&1)!==0);break;case 5:p.memoizedProps.suppressHydrationWarning!==!0&&vt(A.nodeValue,M,(p.mode&1)!==0)}B&&(x.flags|=4)}else A=(M.nodeType===9?M:M.ownerDocument).createTextNode(A),A[va]=x,x.stateNode=A}return $a(x),null;case 13:if(ao(Co),A=x.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(po&&Os!==null&&(x.mode&1)!==0&&(x.flags&128)===0)Jv(),tu(),x.flags|=98560,B=!1;else if(B=Gp(x),A!==null&&A.dehydrated!==null){if(p===null){if(!B)throw Error(r(318));if(B=x.memoizedState,B=B!==null?B.dehydrated:null,!B)throw Error(r(317));B[va]=x}else tu(),(x.flags&128)===0&&(x.memoizedState=null),x.flags|=4;$a(x),B=!1}else bi!==null&&(B1(bi),bi=null),B=!0;if(!B)return x.flags&65536?x:null}return(x.flags&128)!==0?(x.lanes=M,x):(A=A!==null,A!==(p!==null&&p.memoizedState!==null)&&A&&(x.child.flags|=8192,(x.mode&1)!==0&&(p===null||(Co.current&1)!==0?ea===0&&(ea=3):W1())),x.updateQueue!==null&&(x.flags|=4),$a(x),null);case 4:return au(),E1(p,x),p===null&&pt(x.stateNode.containerInfo),$a(x),null;case 10:return r1(x.type._context),$a(x),null;case 17:return ds(x.type)&&Bp(),$a(x),null;case 19:if(ao(Co),B=x.memoizedState,B===null)return $a(x),null;if(A=(x.flags&128)!==0,Y=B.rendering,Y===null)if(A)nf(B,!1);else{if(ea!==0||p!==null&&(p.flags&128)!==0)for(p=x.child;p!==null;){if(Y=Zp(p),Y!==null){for(x.flags|=128,nf(B,!1),A=Y.updateQueue,A!==null&&(x.updateQueue=A,x.flags|=4),x.subtreeFlags=0,A=M,M=x.child;M!==null;)B=M,p=A,B.flags&=14680066,Y=B.alternate,Y===null?(B.childLanes=0,B.lanes=p,B.child=null,B.subtreeFlags=0,B.memoizedProps=null,B.memoizedState=null,B.updateQueue=null,B.dependencies=null,B.stateNode=null):(B.childLanes=Y.childLanes,B.lanes=Y.lanes,B.child=Y.child,B.subtreeFlags=0,B.deletions=null,B.memoizedProps=Y.memoizedProps,B.memoizedState=Y.memoizedState,B.updateQueue=Y.updateQueue,B.type=Y.type,p=Y.dependencies,B.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),M=M.sibling;return Zr(Co,Co.current&1|2),x.child}p=p.sibling}B.tail!==null&&en()>cu&&(x.flags|=128,A=!0,nf(B,!1),x.lanes=4194304)}else{if(!A)if(p=Zp(Y),p!==null){if(x.flags|=128,A=!0,M=p.updateQueue,M!==null&&(x.updateQueue=M,x.flags|=4),nf(B,!0),B.tail===null&&B.tailMode==="hidden"&&!Y.alternate&&!po)return $a(x),null}else 2*en()-B.renderingStartTime>cu&&M!==1073741824&&(x.flags|=128,A=!0,nf(B,!1),x.lanes=4194304);B.isBackwards?(Y.sibling=x.child,x.child=Y):(M=B.last,M!==null?M.sibling=Y:x.child=Y,B.last=Y)}return B.tail!==null?(x=B.tail,B.rendering=x,B.tail=x.sibling,B.renderingStartTime=en(),x.sibling=null,M=Co.current,Zr(Co,A?M&1|2:M&1),x):($a(x),null);case 22:case 23:return q1(),A=x.memoizedState!==null,p!==null&&p.memoizedState!==null!==A&&(x.flags|=8192),A&&(x.mode&1)!==0?(_s&1073741824)!==0&&($a(x),x.subtreeFlags&6&&(x.flags|=8192)):$a(x),null;case 24:return null;case 25:return null}throw Error(r(156,x.tag))}function vA(p,x){switch(Zg(x),x.tag){case 1:return ds(x.type)&&Bp(),p=x.flags,p&65536?(x.flags=p&-65537|128,x):null;case 3:return au(),ao(cs),ao(za),d1(),p=x.flags,(p&65536)!==0&&(p&128)===0?(x.flags=p&-65537|128,x):null;case 5:return l1(x),null;case 13:if(ao(Co),p=x.memoizedState,p!==null&&p.dehydrated!==null){if(x.alternate===null)throw Error(r(340));tu()}return p=x.flags,p&65536?(x.flags=p&-65537|128,x):null;case 19:return ao(Co),null;case 4:return au(),null;case 10:return r1(x.type._context),null;case 22:case 23:return q1(),null;case 24:return null;default:return null}}var sm=!1,qa=!1,SA=typeof WeakSet=="function"?WeakSet:Set,An=null;function iu(p,x){var M=p.ref;if(M!==null)if(typeof M=="function")try{M(null)}catch(A){Io(p,x,A)}else M.current=null}function T1(p,x,M){try{M()}catch(A){Io(p,x,A)}}var X3=!1;function wA(p,x){if(xt=It,p=Kd(),jl(p)){if("selectionStart"in p)var M={start:p.selectionStart,end:p.selectionEnd};else e:{M=(M=p.ownerDocument)&&M.defaultView||window;var A=M.getSelection&&M.getSelection();if(A&&A.rangeCount!==0){M=A.anchorNode;var O=A.anchorOffset,B=A.focusNode;A=A.focusOffset;try{M.nodeType,B.nodeType}catch{M=null;break e}var Y=0,ve=-1,Pe=-1,ot=0,Lt=0,Ht=p,Nt=null;t:for(;;){for(var Cn;Ht!==M||O!==0&&Ht.nodeType!==3||(ve=Y+O),Ht!==B||A!==0&&Ht.nodeType!==3||(Pe=Y+A),Ht.nodeType===3&&(Y+=Ht.nodeValue.length),(Cn=Ht.firstChild)!==null;)Nt=Ht,Ht=Cn;for(;;){if(Ht===p)break t;if(Nt===M&&++ot===O&&(ve=Y),Nt===B&&++Lt===A&&(Pe=Y),(Cn=Ht.nextSibling)!==null)break;Ht=Nt,Nt=Ht.parentNode}Ht=Cn}M=ve===-1||Pe===-1?null:{start:ve,end:Pe}}else M=null}M=M||{start:0,end:0}}else M=null;for(Mn={focusedElem:p,selectionRange:M},It=!1,An=x;An!==null;)if(x=An,p=x.child,(x.subtreeFlags&1028)!==0&&p!==null)p.return=x,An=p;else for(;An!==null;){x=An;try{var Pn=x.alternate;if((x.flags&1024)!==0)switch(x.tag){case 0:case 11:case 15:break;case 1:if(Pn!==null){var _n=Pn.memoizedProps,zo=Pn.memoizedState,Qe=x.stateNode,Be=Qe.getSnapshotBeforeUpdate(x.elementType===x.type?_n:vi(x.type,_n),zo);Qe.__reactInternalSnapshotBeforeUpdate=Be}break;case 3:var nt=x.stateNode.containerInfo;nt.nodeType===1?nt.textContent="":nt.nodeType===9&&nt.documentElement&&nt.removeChild(nt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(r(163))}}catch(tn){Io(x,x.return,tn)}if(p=x.sibling,p!==null){p.return=x.return,An=p;break}An=x.return}return Pn=X3,X3=!1,Pn}function rf(p,x,M){var A=x.updateQueue;if(A=A!==null?A.lastEffect:null,A!==null){var O=A=A.next;do{if((O.tag&p)===p){var B=O.destroy;O.destroy=void 0,B!==void 0&&T1(x,M,B)}O=O.next}while(O!==A)}}function im(p,x){if(x=x.updateQueue,x=x!==null?x.lastEffect:null,x!==null){var M=x=x.next;do{if((M.tag&p)===p){var A=M.create;M.destroy=A()}M=M.next}while(M!==x)}}function I1(p){var x=p.ref;if(x!==null){var M=p.stateNode;switch(p.tag){case 5:p=M;break;default:p=M}typeof x=="function"?x(p):x.current=p}}function Z3(p){var x=p.alternate;x!==null&&(p.alternate=null,Z3(x)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(x=p.stateNode,x!==null&&(delete x[va],delete x[xi],delete x[Go],delete x[Lp],delete x[zp])),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}function J3(p){return p.tag===5||p.tag===3||p.tag===4}function Q3(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||J3(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function P1(p,x,M){var A=p.tag;if(A===5||A===6)p=p.stateNode,x?M.nodeType===8?M.parentNode.insertBefore(p,x):M.insertBefore(p,x):(M.nodeType===8?(x=M.parentNode,x.insertBefore(p,M)):(x=M,x.appendChild(p)),M=M._reactRootContainer,M!=null||x.onclick!==null||(x.onclick=Mt));else if(A!==4&&(p=p.child,p!==null))for(P1(p,x,M),p=p.sibling;p!==null;)P1(p,x,M),p=p.sibling}function F1(p,x,M){var A=p.tag;if(A===5||A===6)p=p.stateNode,x?M.insertBefore(p,x):M.appendChild(p);else if(A!==4&&(p=p.child,p!==null))for(F1(p,x,M),p=p.sibling;p!==null;)F1(p,x,M),p=p.sibling}var wa=null,Si=!1;function gc(p,x,M){for(M=M.child;M!==null;)e4(p,x,M),M=M.sibling}function e4(p,x,M){if(or&&typeof or.onCommitFiberUnmount=="function")try{or.onCommitFiberUnmount(hr,M)}catch{}switch(M.tag){case 5:qa||iu(M,x);case 6:var A=wa,O=Si;wa=null,gc(p,x,M),wa=A,Si=O,wa!==null&&(Si?(p=wa,M=M.stateNode,p.nodeType===8?p.parentNode.removeChild(M):p.removeChild(M)):wa.removeChild(M.stateNode));break;case 18:wa!==null&&(Si?(p=wa,M=M.stateNode,p.nodeType===8?Kr(p.parentNode,M):p.nodeType===1&&Kr(p,M),un(p)):Kr(wa,M.stateNode));break;case 4:A=wa,O=Si,wa=M.stateNode.containerInfo,Si=!0,gc(p,x,M),wa=A,Si=O;break;case 0:case 11:case 14:case 15:if(!qa&&(A=M.updateQueue,A!==null&&(A=A.lastEffect,A!==null))){O=A=A.next;do{var B=O,Y=B.destroy;B=B.tag,Y!==void 0&&((B&2)!==0||(B&4)!==0)&&T1(M,x,Y),O=O.next}while(O!==A)}gc(p,x,M);break;case 1:if(!qa&&(iu(M,x),A=M.stateNode,typeof A.componentWillUnmount=="function"))try{A.props=M.memoizedProps,A.state=M.memoizedState,A.componentWillUnmount()}catch(ve){Io(M,x,ve)}gc(p,x,M);break;case 21:gc(p,x,M);break;case 22:M.mode&1?(qa=(A=qa)||M.memoizedState!==null,gc(p,x,M),qa=A):gc(p,x,M);break;default:gc(p,x,M)}}function t4(p){var x=p.updateQueue;if(x!==null){p.updateQueue=null;var M=p.stateNode;M===null&&(M=p.stateNode=new SA),x.forEach(function(A){var O=IA.bind(null,p,A);M.has(A)||(M.add(A),A.then(O,O))})}}function wi(p,x){var M=x.deletions;if(M!==null)for(var A=0;A<M.length;A++){var O=M[A];try{var B=p,Y=x,ve=Y;e:for(;ve!==null;){switch(ve.tag){case 5:wa=ve.stateNode,Si=!1;break e;case 3:wa=ve.stateNode.containerInfo,Si=!0;break e;case 4:wa=ve.stateNode.containerInfo,Si=!0;break e}ve=ve.return}if(wa===null)throw Error(r(160));e4(B,Y,O),wa=null,Si=!1;var Pe=O.alternate;Pe!==null&&(Pe.return=null),O.return=null}catch(ot){Io(O,x,ot)}}if(x.subtreeFlags&12854)for(x=x.child;x!==null;)n4(x,p),x=x.sibling}function n4(p,x){var M=p.alternate,A=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:if(wi(x,p),il(p),A&4){try{rf(3,p,p.return),im(3,p)}catch(_n){Io(p,p.return,_n)}try{rf(5,p,p.return)}catch(_n){Io(p,p.return,_n)}}break;case 1:wi(x,p),il(p),A&512&&M!==null&&iu(M,M.return);break;case 5:if(wi(x,p),il(p),A&512&&M!==null&&iu(M,M.return),p.flags&32){var O=p.stateNode;try{Pt(O,"")}catch(_n){Io(p,p.return,_n)}}if(A&4&&(O=p.stateNode,O!=null)){var B=p.memoizedProps,Y=M!==null?M.memoizedProps:B,ve=p.type,Pe=p.updateQueue;if(p.updateQueue=null,Pe!==null)try{ve==="input"&&B.type==="radio"&&B.name!=null&&Wt(O,B),Ie(ve,Y);var ot=Ie(ve,B);for(Y=0;Y<Pe.length;Y+=2){var Lt=Pe[Y],Ht=Pe[Y+1];Lt==="style"?lt(O,Ht):Lt==="dangerouslySetInnerHTML"?Xn(O,Ht):Lt==="children"?Pt(O,Ht):k(O,Lt,Ht,ot)}switch(ve){case"input":Zt(O,B);break;case"textarea":an(O,B);break;case"select":var Nt=O._wrapperState.wasMultiple;O._wrapperState.wasMultiple=!!B.multiple;var Cn=B.value;Cn!=null?Xe(O,!!B.multiple,Cn,!1):Nt!==!!B.multiple&&(B.defaultValue!=null?Xe(O,!!B.multiple,B.defaultValue,!0):Xe(O,!!B.multiple,B.multiple?[]:"",!1))}O[xi]=B}catch(_n){Io(p,p.return,_n)}}break;case 6:if(wi(x,p),il(p),A&4){if(p.stateNode===null)throw Error(r(162));O=p.stateNode,B=p.memoizedProps;try{O.nodeValue=B}catch(_n){Io(p,p.return,_n)}}break;case 3:if(wi(x,p),il(p),A&4&&M!==null&&M.memoizedState.isDehydrated)try{un(x.containerInfo)}catch(_n){Io(p,p.return,_n)}break;case 4:wi(x,p),il(p);break;case 13:wi(x,p),il(p),O=p.child,O.flags&8192&&(B=O.memoizedState!==null,O.stateNode.isHidden=B,!B||O.alternate!==null&&O.alternate.memoizedState!==null||(_1=en())),A&4&&t4(p);break;case 22:if(Lt=M!==null&&M.memoizedState!==null,p.mode&1?(qa=(ot=qa)||Lt,wi(x,p),qa=ot):wi(x,p),il(p),A&8192){if(ot=p.memoizedState!==null,(p.stateNode.isHidden=ot)&&!Lt&&(p.mode&1)!==0)for(An=p,Lt=p.child;Lt!==null;){for(Ht=An=Lt;An!==null;){switch(Nt=An,Cn=Nt.child,Nt.tag){case 0:case 11:case 14:case 15:rf(4,Nt,Nt.return);break;case 1:iu(Nt,Nt.return);var Pn=Nt.stateNode;if(typeof Pn.componentWillUnmount=="function"){A=Nt,M=Nt.return;try{x=A,Pn.props=x.memoizedProps,Pn.state=x.memoizedState,Pn.componentWillUnmount()}catch(_n){Io(A,M,_n)}}break;case 5:iu(Nt,Nt.return);break;case 22:if(Nt.memoizedState!==null){a4(Ht);continue}}Cn!==null?(Cn.return=Nt,An=Cn):a4(Ht)}Lt=Lt.sibling}e:for(Lt=null,Ht=p;;){if(Ht.tag===5){if(Lt===null){Lt=Ht;try{O=Ht.stateNode,ot?(B=O.style,typeof B.setProperty=="function"?B.setProperty("display","none","important"):B.display="none"):(ve=Ht.stateNode,Pe=Ht.memoizedProps.style,Y=Pe!=null&&Pe.hasOwnProperty("display")?Pe.display:null,ve.style.display=En("display",Y))}catch(_n){Io(p,p.return,_n)}}}else if(Ht.tag===6){if(Lt===null)try{Ht.stateNode.nodeValue=ot?"":Ht.memoizedProps}catch(_n){Io(p,p.return,_n)}}else if((Ht.tag!==22&&Ht.tag!==23||Ht.memoizedState===null||Ht===p)&&Ht.child!==null){Ht.child.return=Ht,Ht=Ht.child;continue}if(Ht===p)break e;for(;Ht.sibling===null;){if(Ht.return===null||Ht.return===p)break e;Lt===Ht&&(Lt=null),Ht=Ht.return}Lt===Ht&&(Lt=null),Ht.sibling.return=Ht.return,Ht=Ht.sibling}}break;case 19:wi(x,p),il(p),A&4&&t4(p);break;case 21:break;default:wi(x,p),il(p)}}function il(p){var x=p.flags;if(x&2){try{e:{for(var M=p.return;M!==null;){if(J3(M)){var A=M;break e}M=M.return}throw Error(r(160))}switch(A.tag){case 5:var O=A.stateNode;A.flags&32&&(Pt(O,""),A.flags&=-33);var B=Q3(p);F1(p,B,O);break;case 3:case 4:var Y=A.stateNode.containerInfo,ve=Q3(p);P1(p,ve,Y);break;default:throw Error(r(161))}}catch(Pe){Io(p,p.return,Pe)}p.flags&=-3}x&4096&&(p.flags&=-4097)}function CA(p,x,M){An=p,r4(p)}function r4(p,x,M){for(var A=(p.mode&1)!==0;An!==null;){var O=An,B=O.child;if(O.tag===22&&A){var Y=O.memoizedState!==null||sm;if(!Y){var ve=O.alternate,Pe=ve!==null&&ve.memoizedState!==null||qa;ve=sm;var ot=qa;if(sm=Y,(qa=Pe)&&!ot)for(An=O;An!==null;)Y=An,Pe=Y.child,Y.tag===22&&Y.memoizedState!==null?s4(O):Pe!==null?(Pe.return=Y,An=Pe):s4(O);for(;B!==null;)An=B,r4(B),B=B.sibling;An=O,sm=ve,qa=ot}o4(p)}else(O.subtreeFlags&8772)!==0&&B!==null?(B.return=O,An=B):o4(p)}}function o4(p){for(;An!==null;){var x=An;if((x.flags&8772)!==0){var M=x.alternate;try{if((x.flags&8772)!==0)switch(x.tag){case 0:case 11:case 15:qa||im(5,x);break;case 1:var A=x.stateNode;if(x.flags&4&&!qa)if(M===null)A.componentDidMount();else{var O=x.elementType===x.type?M.memoizedProps:vi(x.type,M.memoizedProps);A.componentDidUpdate(O,M.memoizedState,A.__reactInternalSnapshotBeforeUpdate)}var B=x.updateQueue;B!==null&&a3(x,B,A);break;case 3:var Y=x.updateQueue;if(Y!==null){if(M=null,x.child!==null)switch(x.child.tag){case 5:M=x.child.stateNode;break;case 1:M=x.child.stateNode}a3(x,Y,M)}break;case 5:var ve=x.stateNode;if(M===null&&x.flags&4){M=ve;var Pe=x.memoizedProps;switch(x.type){case"button":case"input":case"select":case"textarea":Pe.autoFocus&&M.focus();break;case"img":Pe.src&&(M.src=Pe.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(x.memoizedState===null){var ot=x.alternate;if(ot!==null){var Lt=ot.memoizedState;if(Lt!==null){var Ht=Lt.dehydrated;Ht!==null&&un(Ht)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(r(163))}qa||x.flags&512&&I1(x)}catch(Nt){Io(x,x.return,Nt)}}if(x===p){An=null;break}if(M=x.sibling,M!==null){M.return=x.return,An=M;break}An=x.return}}function a4(p){for(;An!==null;){var x=An;if(x===p){An=null;break}var M=x.sibling;if(M!==null){M.return=x.return,An=M;break}An=x.return}}function s4(p){for(;An!==null;){var x=An;try{switch(x.tag){case 0:case 11:case 15:var M=x.return;try{im(4,x)}catch(Pe){Io(x,M,Pe)}break;case 1:var A=x.stateNode;if(typeof A.componentDidMount=="function"){var O=x.return;try{A.componentDidMount()}catch(Pe){Io(x,O,Pe)}}var B=x.return;try{I1(x)}catch(Pe){Io(x,B,Pe)}break;case 5:var Y=x.return;try{I1(x)}catch(Pe){Io(x,Y,Pe)}}}catch(Pe){Io(x,x.return,Pe)}if(x===p){An=null;break}var ve=x.sibling;if(ve!==null){ve.return=x.return,An=ve;break}An=x.return}}var MA=Math.ceil,lm=R.ReactCurrentDispatcher,N1=R.ReactCurrentOwner,ti=R.ReactCurrentBatchConfig,Pr=0,da=null,Vo=null,Ca=0,_s=0,lu=La(0),ea=0,of=null,I0=0,cm=0,O1=0,af=null,hs=null,_1=0,cu=1/0,_l=null,dm=!1,D1=null,yc=null,um=!1,xc=null,hm=0,sf=0,L1=null,fm=-1,pm=0;function Xa(){return(Pr&6)!==0?en():fm!==-1?fm:fm=en()}function bc(p){return(p.mode&1)===0?1:(Pr&2)!==0&&Ca!==0?Ca&-Ca:iA.transition!==null?(pm===0&&(pm=So()),pm):(p=X,p!==0||(p=window.event,p=p===void 0?16:ro(p.type)),p)}function Ci(p,x,M,A){if(50<sf)throw sf=0,L1=null,Error(r(185));U(p,M,A),((Pr&2)===0||p!==da)&&(p===da&&((Pr&2)===0&&(cm|=M),ea===4&&vc(p,Ca)),fs(p,A),M===1&&Pr===0&&(x.mode&1)===0&&(cu=en()+500,qp&&fc()))}function fs(p,x){var M=p.callbackNode;Na(p,x);var A=Jo(p,p===da?Ca:0);if(A===0)M!==null&&Bt(M),p.callbackNode=null,p.callbackPriority=0;else if(x=A&-A,p.callbackPriority!==x){if(M!=null&&Bt(M),x===1)p.tag===0?sA(l4.bind(null,p)):Uv(l4.bind(null,p)),bn(function(){(Pr&6)===0&&fc()}),M=null;else{switch(Te(A)){case 1:M=Wn;break;case 4:M=Gn;break;case 16:M=cr;break;case 536870912:M=br;break;default:M=cr}M=g4(M,i4.bind(null,p))}p.callbackPriority=x,p.callbackNode=M}}function i4(p,x){if(fm=-1,pm=0,(Pr&6)!==0)throw Error(r(327));var M=p.callbackNode;if(du()&&p.callbackNode!==M)return null;var A=Jo(p,p===da?Ca:0);if(A===0)return null;if((A&30)!==0||(A&p.expiredLanes)!==0||x)x=mm(p,A);else{x=A;var O=Pr;Pr|=2;var B=d4();(da!==p||Ca!==x)&&(_l=null,cu=en()+500,F0(p,x));do try{AA();break}catch(ve){c4(p,ve)}while(!0);n1(),lm.current=B,Pr=O,Vo!==null?x=0:(da=null,Ca=0,x=ea)}if(x!==0){if(x===2&&(O=sa(p),O!==0&&(A=O,x=z1(p,O))),x===1)throw M=of,F0(p,0),vc(p,A),fs(p,en()),M;if(x===6)vc(p,A);else{if(O=p.current.alternate,(A&30)===0&&!kA(O)&&(x=mm(p,A),x===2&&(B=sa(p),B!==0&&(A=B,x=z1(p,B))),x===1))throw M=of,F0(p,0),vc(p,A),fs(p,en()),M;switch(p.finishedWork=O,p.finishedLanes=A,x){case 0:case 1:throw Error(r(345));case 2:N0(p,hs,_l);break;case 3:if(vc(p,A),(A&130023424)===A&&(x=_1+500-en(),10<x)){if(Jo(p,0)!==0)break;if(O=p.suspendedLanes,(O&A)!==A){Xa(),p.pingedLanes|=p.suspendedLanes&O;break}p.timeoutHandle=Hn(N0.bind(null,p,hs,_l),x);break}N0(p,hs,_l);break;case 4:if(vc(p,A),(A&4194240)===A)break;for(x=p.eventTimes,O=-1;0<A;){var Y=31-fr(A);B=1<<Y,Y=x[Y],Y>O&&(O=Y),A&=~B}if(A=O,A=en()-A,A=(120>A?120:480>A?480:1080>A?1080:1920>A?1920:3e3>A?3e3:4320>A?4320:1960*MA(A/1960))-A,10<A){p.timeoutHandle=Hn(N0.bind(null,p,hs,_l),A);break}N0(p,hs,_l);break;case 5:N0(p,hs,_l);break;default:throw Error(r(329))}}}return fs(p,en()),p.callbackNode===M?i4.bind(null,p):null}function z1(p,x){var M=af;return p.current.memoizedState.isDehydrated&&(F0(p,x).flags|=256),p=mm(p,x),p!==2&&(x=hs,hs=M,x!==null&&B1(x)),p}function B1(p){hs===null?hs=p:hs.push.apply(hs,p)}function kA(p){for(var x=p;;){if(x.flags&16384){var M=x.updateQueue;if(M!==null&&(M=M.stores,M!==null))for(var A=0;A<M.length;A++){var O=M[A],B=O.getSnapshot;O=O.value;try{if(!Ya(B(),O))return!1}catch{return!1}}}if(M=x.child,x.subtreeFlags&16384&&M!==null)M.return=x,x=M;else{if(x===p)break;for(;x.sibling===null;){if(x.return===null||x.return===p)return!0;x=x.return}x.sibling.return=x.return,x=x.sibling}}return!0}function vc(p,x){for(x&=~O1,x&=~cm,p.suspendedLanes|=x,p.pingedLanes&=~x,p=p.expirationTimes;0<x;){var M=31-fr(x),A=1<<M;p[M]=-1,x&=~A}}function l4(p){if((Pr&6)!==0)throw Error(r(327));du();var x=Jo(p,0);if((x&1)===0)return fs(p,en()),null;var M=mm(p,x);if(p.tag!==0&&M===2){var A=sa(p);A!==0&&(x=A,M=z1(p,A))}if(M===1)throw M=of,F0(p,0),vc(p,x),fs(p,en()),M;if(M===6)throw Error(r(345));return p.finishedWork=p.current.alternate,p.finishedLanes=x,N0(p,hs,_l),fs(p,en()),null}function $1(p,x){var M=Pr;Pr|=1;try{return p(x)}finally{Pr=M,Pr===0&&(cu=en()+500,qp&&fc())}}function P0(p){xc!==null&&xc.tag===0&&(Pr&6)===0&&du();var x=Pr;Pr|=1;var M=ti.transition,A=X;try{if(ti.transition=null,X=1,p)return p()}finally{X=A,ti.transition=M,Pr=x,(Pr&6)===0&&fc()}}function q1(){_s=lu.current,ao(lu)}function F0(p,x){p.finishedWork=null,p.finishedLanes=0;var M=p.timeoutHandle;if(M!==-1&&(p.timeoutHandle=-1,In(M)),Vo!==null)for(M=Vo.return;M!==null;){var A=M;switch(Zg(A),A.tag){case 1:A=A.type.childContextTypes,A!=null&&Bp();break;case 3:au(),ao(cs),ao(za),d1();break;case 5:l1(A);break;case 4:au();break;case 13:ao(Co);break;case 19:ao(Co);break;case 10:r1(A.type._context);break;case 22:case 23:q1()}M=M.return}if(da=p,Vo=p=Sc(p.current,null),Ca=_s=x,ea=0,of=null,O1=cm=I0=0,hs=af=null,j0!==null){for(x=0;x<j0.length;x++)if(M=j0[x],A=M.interleaved,A!==null){M.interleaved=null;var O=A.next,B=M.pending;if(B!==null){var Y=B.next;B.next=O,A.next=Y}M.pending=A}j0=null}return p}function c4(p,x){do{var M=Vo;try{if(n1(),Jp.current=nm,Qp){for(var A=Mo.memoizedState;A!==null;){var O=A.queue;O!==null&&(O.pending=null),A=A.next}Qp=!1}if(T0=0,ca=Qo=Mo=null,Jh=!1,Qh=0,N1.current=null,M===null||M.return===null){ea=1,of=x,Vo=null;break}e:{var B=p,Y=M.return,ve=M,Pe=x;if(x=Ca,ve.flags|=32768,Pe!==null&&typeof Pe=="object"&&typeof Pe.then=="function"){var ot=Pe,Lt=ve,Ht=Lt.tag;if((Lt.mode&1)===0&&(Ht===0||Ht===11||Ht===15)){var Nt=Lt.alternate;Nt?(Lt.updateQueue=Nt.updateQueue,Lt.memoizedState=Nt.memoizedState,Lt.lanes=Nt.lanes):(Lt.updateQueue=null,Lt.memoizedState=null)}var Cn=N3(Y);if(Cn!==null){Cn.flags&=-257,O3(Cn,Y,ve,B,x),Cn.mode&1&&F3(B,ot,x),x=Cn,Pe=ot;var Pn=x.updateQueue;if(Pn===null){var _n=new Set;_n.add(Pe),x.updateQueue=_n}else Pn.add(Pe);break e}else{if((x&1)===0){F3(B,ot,x),W1();break e}Pe=Error(r(426))}}else if(po&&ve.mode&1){var zo=N3(Y);if(zo!==null){(zo.flags&65536)===0&&(zo.flags|=256),O3(zo,Y,ve,B,x),e1(su(Pe,ve));break e}}B=Pe=su(Pe,ve),ea!==4&&(ea=2),af===null?af=[B]:af.push(B),B=Y;do{switch(B.tag){case 3:B.flags|=65536,x&=-x,B.lanes|=x;var Qe=I3(B,Pe,x);o3(B,Qe);break e;case 1:ve=Pe;var Be=B.type,nt=B.stateNode;if((B.flags&128)===0&&(typeof Be.getDerivedStateFromError=="function"||nt!==null&&typeof nt.componentDidCatch=="function"&&(yc===null||!yc.has(nt)))){B.flags|=65536,x&=-x,B.lanes|=x;var tn=P3(B,ve,x);o3(B,tn);break e}}B=B.return}while(B!==null)}h4(M)}catch(Dn){x=Dn,Vo===M&&M!==null&&(Vo=M=M.return);continue}break}while(!0)}function d4(){var p=lm.current;return lm.current=nm,p===null?nm:p}function W1(){(ea===0||ea===3||ea===2)&&(ea=4),da===null||(I0&268435455)===0&&(cm&268435455)===0||vc(da,Ca)}function mm(p,x){var M=Pr;Pr|=2;var A=d4();(da!==p||Ca!==x)&&(_l=null,F0(p,x));do try{RA();break}catch(O){c4(p,O)}while(!0);if(n1(),Pr=M,lm.current=A,Vo!==null)throw Error(r(261));return da=null,Ca=0,ea}function RA(){for(;Vo!==null;)u4(Vo)}function AA(){for(;Vo!==null&&!Jt();)u4(Vo)}function u4(p){var x=m4(p.alternate,p,_s);p.memoizedProps=p.pendingProps,x===null?h4(p):Vo=x,N1.current=null}function h4(p){var x=p;do{var M=x.alternate;if(p=x.return,(x.flags&32768)===0){if(M=bA(M,x,_s),M!==null){Vo=M;return}}else{if(M=vA(M,x),M!==null){M.flags&=32767,Vo=M;return}if(p!==null)p.flags|=32768,p.subtreeFlags=0,p.deletions=null;else{ea=6,Vo=null;return}}if(x=x.sibling,x!==null){Vo=x;return}Vo=x=p}while(x!==null);ea===0&&(ea=5)}function N0(p,x,M){var A=X,O=ti.transition;try{ti.transition=null,X=1,jA(p,x,M,A)}finally{ti.transition=O,X=A}return null}function jA(p,x,M,A){do du();while(xc!==null);if((Pr&6)!==0)throw Error(r(327));M=p.finishedWork;var O=p.finishedLanes;if(M===null)return null;if(p.finishedWork=null,p.finishedLanes=0,M===p.current)throw Error(r(177));p.callbackNode=null,p.callbackPriority=0;var B=M.lanes|M.childLanes;if(je(p,B),p===da&&(Vo=da=null,Ca=0),(M.subtreeFlags&2064)===0&&(M.flags&2064)===0||um||(um=!0,g4(cr,function(){return du(),null})),B=(M.flags&15990)!==0,(M.subtreeFlags&15990)!==0||B){B=ti.transition,ti.transition=null;var Y=X;X=1;var ve=Pr;Pr|=4,N1.current=null,wA(p,M),n4(M,p),Vh(Mn),It=!!xt,Mn=xt=null,p.current=M,CA(M),Qt(),Pr=ve,X=Y,ti.transition=B}else p.current=M;if(um&&(um=!1,xc=p,hm=O),B=p.pendingLanes,B===0&&(yc=null),uo(M.stateNode),fs(p,en()),x!==null)for(A=p.onRecoverableError,M=0;M<x.length;M++)O=x[M],A(O.value,{componentStack:O.stack,digest:O.digest});if(dm)throw dm=!1,p=D1,D1=null,p;return(hm&1)!==0&&p.tag!==0&&du(),B=p.pendingLanes,(B&1)!==0?p===L1?sf++:(sf=0,L1=p):sf=0,fc(),null}function du(){if(xc!==null){var p=Te(hm),x=ti.transition,M=X;try{if(ti.transition=null,X=16>p?16:p,xc===null)var A=!1;else{if(p=xc,xc=null,hm=0,(Pr&6)!==0)throw Error(r(331));var O=Pr;for(Pr|=4,An=p.current;An!==null;){var B=An,Y=B.child;if((An.flags&16)!==0){var ve=B.deletions;if(ve!==null){for(var Pe=0;Pe<ve.length;Pe++){var ot=ve[Pe];for(An=ot;An!==null;){var Lt=An;switch(Lt.tag){case 0:case 11:case 15:rf(8,Lt,B)}var Ht=Lt.child;if(Ht!==null)Ht.return=Lt,An=Ht;else for(;An!==null;){Lt=An;var Nt=Lt.sibling,Cn=Lt.return;if(Z3(Lt),Lt===ot){An=null;break}if(Nt!==null){Nt.return=Cn,An=Nt;break}An=Cn}}}var Pn=B.alternate;if(Pn!==null){var _n=Pn.child;if(_n!==null){Pn.child=null;do{var zo=_n.sibling;_n.sibling=null,_n=zo}while(_n!==null)}}An=B}}if((B.subtreeFlags&2064)!==0&&Y!==null)Y.return=B,An=Y;else e:for(;An!==null;){if(B=An,(B.flags&2048)!==0)switch(B.tag){case 0:case 11:case 15:rf(9,B,B.return)}var Qe=B.sibling;if(Qe!==null){Qe.return=B.return,An=Qe;break e}An=B.return}}var Be=p.current;for(An=Be;An!==null;){Y=An;var nt=Y.child;if((Y.subtreeFlags&2064)!==0&&nt!==null)nt.return=Y,An=nt;else e:for(Y=Be;An!==null;){if(ve=An,(ve.flags&2048)!==0)try{switch(ve.tag){case 0:case 11:case 15:im(9,ve)}}catch(Dn){Io(ve,ve.return,Dn)}if(ve===Y){An=null;break e}var tn=ve.sibling;if(tn!==null){tn.return=ve.return,An=tn;break e}An=ve.return}}if(Pr=O,fc(),or&&typeof or.onPostCommitFiberRoot=="function")try{or.onPostCommitFiberRoot(hr,p)}catch{}A=!0}return A}finally{X=M,ti.transition=x}}return!1}function f4(p,x,M){x=su(M,x),x=I3(p,x,1),p=mc(p,x,1),x=Xa(),p!==null&&(U(p,1,x),fs(p,x))}function Io(p,x,M){if(p.tag===3)f4(p,p,M);else for(;x!==null;){if(x.tag===3){f4(x,p,M);break}else if(x.tag===1){var A=x.stateNode;if(typeof x.type.getDerivedStateFromError=="function"||typeof A.componentDidCatch=="function"&&(yc===null||!yc.has(A))){p=su(M,p),p=P3(x,p,1),x=mc(x,p,1),p=Xa(),x!==null&&(U(x,1,p),fs(x,p));break}}x=x.return}}function EA(p,x,M){var A=p.pingCache;A!==null&&A.delete(x),x=Xa(),p.pingedLanes|=p.suspendedLanes&M,da===p&&(Ca&M)===M&&(ea===4||ea===3&&(Ca&130023424)===Ca&&500>en()-_1?F0(p,0):O1|=M),fs(p,x)}function p4(p,x){x===0&&((p.mode&1)===0?x=1:(x=vo,vo<<=1,(vo&130023424)===0&&(vo=4194304)));var M=Xa();p=Fl(p,x),p!==null&&(U(p,x,M),fs(p,M))}function TA(p){var x=p.memoizedState,M=0;x!==null&&(M=x.retryLane),p4(p,M)}function IA(p,x){var M=0;switch(p.tag){case 13:var A=p.stateNode,O=p.memoizedState;O!==null&&(M=O.retryLane);break;case 19:A=p.stateNode;break;default:throw Error(r(314))}A!==null&&A.delete(x),p4(p,M)}var m4;m4=function(p,x,M){if(p!==null)if(p.memoizedProps!==x.pendingProps||cs.current)us=!0;else{if((p.lanes&M)===0&&(x.flags&128)===0)return us=!1,xA(p,x,M);us=(p.flags&131072)!==0}else us=!1,po&&(x.flags&1048576)!==0&&Yv(x,Hp,x.index);switch(x.lanes=0,x.tag){case 2:var A=x.type;am(p,x),p=x.pendingProps;var O=Jd(x,za.current);ou(x,M),O=f1(null,x,A,p,O,M);var B=p1();return x.flags|=1,typeof O=="object"&&O!==null&&typeof O.render=="function"&&O.$$typeof===void 0?(x.tag=1,x.memoizedState=null,x.updateQueue=null,ds(A)?(B=!0,$p(x)):B=!1,x.memoizedState=O.state!==null&&O.state!==void 0?O.state:null,s1(x),O.updater=rm,x.stateNode=O,O._reactInternals=x,v1(x,A,p,M),x=M1(null,x,A,!0,B,M)):(x.tag=0,po&&B&&Xg(x),Ka(null,x,O,M),x=x.child),x;case 16:A=x.elementType;e:{switch(am(p,x),p=x.pendingProps,O=A._init,A=O(A._payload),x.type=A,O=x.tag=FA(A),p=vi(A,p),O){case 0:x=C1(null,x,A,p,M);break e;case 1:x=$3(null,x,A,p,M);break e;case 11:x=_3(null,x,A,p,M);break e;case 14:x=D3(null,x,A,vi(A.type,p),M);break e}throw Error(r(306,A,""))}return x;case 0:return A=x.type,O=x.pendingProps,O=x.elementType===A?O:vi(A,O),C1(p,x,A,O,M);case 1:return A=x.type,O=x.pendingProps,O=x.elementType===A?O:vi(A,O),$3(p,x,A,O,M);case 3:e:{if(q3(x),p===null)throw Error(r(387));A=x.pendingProps,B=x.memoizedState,O=B.element,r3(p,x),Xp(x,A,null,M);var Y=x.memoizedState;if(A=Y.element,B.isDehydrated)if(B={element:A,isDehydrated:!1,cache:Y.cache,pendingSuspenseBoundaries:Y.pendingSuspenseBoundaries,transitions:Y.transitions},x.updateQueue.baseState=B,x.memoizedState=B,x.flags&256){O=su(Error(r(423)),x),x=W3(p,x,A,M,O);break e}else if(A!==O){O=su(Error(r(424)),x),x=W3(p,x,A,M,O);break e}else for(Os=ho(x.stateNode.containerInfo.firstChild),Ns=x,po=!0,bi=null,M=t3(x,null,A,M),x.child=M;M;)M.flags=M.flags&-3|4096,M=M.sibling;else{if(tu(),A===O){x=Ol(p,x,M);break e}Ka(p,x,A,M)}x=x.child}return x;case 5:return s3(x),p===null&&Qg(x),A=x.type,O=x.pendingProps,B=p!==null?p.memoizedProps:null,Y=O.children,Rn(A,O)?Y=null:B!==null&&Rn(A,B)&&(x.flags|=32),B3(p,x),Ka(p,x,Y,M),x.child;case 6:return p===null&&Qg(x),null;case 13:return H3(p,x,M);case 4:return i1(x,x.stateNode.containerInfo),A=x.pendingProps,p===null?x.child=nu(x,null,A,M):Ka(p,x,A,M),x.child;case 11:return A=x.type,O=x.pendingProps,O=x.elementType===A?O:vi(A,O),_3(p,x,A,O,M);case 7:return Ka(p,x,x.pendingProps,M),x.child;case 8:return Ka(p,x,x.pendingProps.children,M),x.child;case 12:return Ka(p,x,x.pendingProps.children,M),x.child;case 10:e:{if(A=x.type._context,O=x.pendingProps,B=x.memoizedProps,Y=O.value,Zr(Up,A._currentValue),A._currentValue=Y,B!==null)if(Ya(B.value,Y)){if(B.children===O.children&&!cs.current){x=Ol(p,x,M);break e}}else for(B=x.child,B!==null&&(B.return=x);B!==null;){var ve=B.dependencies;if(ve!==null){Y=B.child;for(var Pe=ve.firstContext;Pe!==null;){if(Pe.context===A){if(B.tag===1){Pe=Nl(-1,M&-M),Pe.tag=2;var ot=B.updateQueue;if(ot!==null){ot=ot.shared;var Lt=ot.pending;Lt===null?Pe.next=Pe:(Pe.next=Lt.next,Lt.next=Pe),ot.pending=Pe}}B.lanes|=M,Pe=B.alternate,Pe!==null&&(Pe.lanes|=M),o1(B.return,M,x),ve.lanes|=M;break}Pe=Pe.next}}else if(B.tag===10)Y=B.type===x.type?null:B.child;else if(B.tag===18){if(Y=B.return,Y===null)throw Error(r(341));Y.lanes|=M,ve=Y.alternate,ve!==null&&(ve.lanes|=M),o1(Y,M,x),Y=B.sibling}else Y=B.child;if(Y!==null)Y.return=B;else for(Y=B;Y!==null;){if(Y===x){Y=null;break}if(B=Y.sibling,B!==null){B.return=Y.return,Y=B;break}Y=Y.return}B=Y}Ka(p,x,O.children,M),x=x.child}return x;case 9:return O=x.type,A=x.pendingProps.children,ou(x,M),O=Qs(O),A=A(O),x.flags|=1,Ka(p,x,A,M),x.child;case 14:return A=x.type,O=vi(A,x.pendingProps),O=vi(A.type,O),D3(p,x,A,O,M);case 15:return L3(p,x,x.type,x.pendingProps,M);case 17:return A=x.type,O=x.pendingProps,O=x.elementType===A?O:vi(A,O),am(p,x),x.tag=1,ds(A)?(p=!0,$p(x)):p=!1,ou(x,M),E3(x,A,O),v1(x,A,O,M),M1(null,x,A,!0,p,M);case 19:return V3(p,x,M);case 22:return z3(p,x,M)}throw Error(r(156,x.tag))};function g4(p,x){return nn(p,x)}function PA(p,x,M,A){this.tag=p,this.key=M,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=x,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=A,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ni(p,x,M,A){return new PA(p,x,M,A)}function H1(p){return p=p.prototype,!(!p||!p.isReactComponent)}function FA(p){if(typeof p=="function")return H1(p)?1:0;if(p!=null){if(p=p.$$typeof,p===L)return 11;if(p===oe)return 14}return 2}function Sc(p,x){var M=p.alternate;return M===null?(M=ni(p.tag,x,p.key,p.mode),M.elementType=p.elementType,M.type=p.type,M.stateNode=p.stateNode,M.alternate=p,p.alternate=M):(M.pendingProps=x,M.type=p.type,M.flags=0,M.subtreeFlags=0,M.deletions=null),M.flags=p.flags&14680064,M.childLanes=p.childLanes,M.lanes=p.lanes,M.child=p.child,M.memoizedProps=p.memoizedProps,M.memoizedState=p.memoizedState,M.updateQueue=p.updateQueue,x=p.dependencies,M.dependencies=x===null?null:{lanes:x.lanes,firstContext:x.firstContext},M.sibling=p.sibling,M.index=p.index,M.ref=p.ref,M}function gm(p,x,M,A,O,B){var Y=2;if(A=p,typeof p=="function")H1(p)&&(Y=1);else if(typeof p=="string")Y=5;else e:switch(p){case _:return O0(M.children,O,B,x);case P:Y=8,O|=8;break;case I:return p=ni(12,M,x,O|2),p.elementType=I,p.lanes=B,p;case H:return p=ni(13,M,x,O),p.elementType=H,p.lanes=B,p;case G:return p=ni(19,M,x,O),p.elementType=G,p.lanes=B,p;case pe:return ym(M,O,B,x);default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case $:Y=10;break e;case q:Y=9;break e;case L:Y=11;break e;case oe:Y=14;break e;case le:Y=16,A=null;break e}throw Error(r(130,p==null?p:typeof p,""))}return x=ni(Y,M,x,O),x.elementType=p,x.type=A,x.lanes=B,x}function O0(p,x,M,A){return p=ni(7,p,A,x),p.lanes=M,p}function ym(p,x,M,A){return p=ni(22,p,A,x),p.elementType=pe,p.lanes=M,p.stateNode={isHidden:!1},p}function G1(p,x,M){return p=ni(6,p,null,x),p.lanes=M,p}function V1(p,x,M){return x=ni(4,p.children!==null?p.children:[],p.key,x),x.lanes=M,x.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},x}function NA(p,x,M,A,O){this.tag=x,this.containerInfo=p,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Oo(0),this.expirationTimes=Oo(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Oo(0),this.identifierPrefix=A,this.onRecoverableError=O,this.mutableSourceEagerHydrationData=null}function U1(p,x,M,A,O,B,Y,ve,Pe){return p=new NA(p,x,M,ve,Pe),x===1?(x=1,B===!0&&(x|=8)):x=0,B=ni(3,null,null,x),p.current=B,B.stateNode=p,B.memoizedState={element:A,isDehydrated:M,cache:null,transitions:null,pendingSuspenseBoundaries:null},s1(B),p}function OA(p,x,M){var A=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:T,key:A==null?null:""+A,children:p,containerInfo:x,implementation:M}}function y4(p){if(!p)return hc;p=p._reactInternals;e:{if(Ne(p)!==p||p.tag!==1)throw Error(r(170));var x=p;do{switch(x.tag){case 3:x=x.stateNode.context;break e;case 1:if(ds(x.type)){x=x.stateNode.__reactInternalMemoizedMergedChildContext;break e}}x=x.return}while(x!==null);throw Error(r(171))}if(p.tag===1){var M=p.type;if(ds(M))return Gv(p,M,x)}return x}function x4(p,x,M,A,O,B,Y,ve,Pe){return p=U1(M,A,!0,p,O,B,Y,ve,Pe),p.context=y4(null),M=p.current,A=Xa(),O=bc(M),B=Nl(A,O),B.callback=x??null,mc(M,B,O),p.current.lanes=O,U(p,O,A),fs(p,A),p}function xm(p,x,M,A){var O=x.current,B=Xa(),Y=bc(O);return M=y4(M),x.context===null?x.context=M:x.pendingContext=M,x=Nl(B,Y),x.payload={element:p},A=A===void 0?null:A,A!==null&&(x.callback=A),p=mc(O,x,Y),p!==null&&(Ci(p,O,Y,B),Kp(p,O,Y)),Y}function bm(p){if(p=p.current,!p.child)return null;switch(p.child.tag){case 5:return p.child.stateNode;default:return p.child.stateNode}}function b4(p,x){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var M=p.retryLane;p.retryLane=M!==0&&M<x?M:x}}function Y1(p,x){b4(p,x),(p=p.alternate)&&b4(p,x)}function _A(){return null}var v4=typeof reportError=="function"?reportError:function(p){console.error(p)};function K1(p){this._internalRoot=p}vm.prototype.render=K1.prototype.render=function(p){var x=this._internalRoot;if(x===null)throw Error(r(409));xm(p,x,null,null)},vm.prototype.unmount=K1.prototype.unmount=function(){var p=this._internalRoot;if(p!==null){this._internalRoot=null;var x=p.containerInfo;P0(function(){xm(null,p,null,null)}),x[ls]=null}};function vm(p){this._internalRoot=p}vm.prototype.unstable_scheduleHydration=function(p){if(p){var x=be();p={blockedOn:null,target:p,priority:x};for(var M=0;M<de.length&&x!==0&&x<de[M].priority;M++);de.splice(M,0,p),M===0&&Tt(p)}};function X1(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)}function Sm(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11&&(p.nodeType!==8||p.nodeValue!==" react-mount-point-unstable "))}function S4(){}function DA(p,x,M,A,O){if(O){if(typeof A=="function"){var B=A;A=function(){var ot=bm(Y);B.call(ot)}}var Y=x4(x,A,p,0,null,!1,!1,"",S4);return p._reactRootContainer=Y,p[ls]=Y.current,pt(p.nodeType===8?p.parentNode:p),P0(),Y}for(;O=p.lastChild;)p.removeChild(O);if(typeof A=="function"){var ve=A;A=function(){var ot=bm(Pe);ve.call(ot)}}var Pe=U1(p,0,!1,null,null,!1,!1,"",S4);return p._reactRootContainer=Pe,p[ls]=Pe.current,pt(p.nodeType===8?p.parentNode:p),P0(function(){xm(x,Pe,M,A)}),Pe}function wm(p,x,M,A,O){var B=M._reactRootContainer;if(B){var Y=B;if(typeof O=="function"){var ve=O;O=function(){var Pe=bm(Y);ve.call(Pe)}}xm(x,Y,p,O)}else Y=DA(M,x,p,O,A);return bm(Y)}He=function(p){switch(p.tag){case 3:var x=p.stateNode;if(x.current.memoizedState.isDehydrated){var M=Zo(x.pendingLanes);M!==0&&(W(x,M|1),fs(x,en()),(Pr&6)===0&&(cu=en()+500,fc()))}break;case 13:P0(function(){var A=Fl(p,1);if(A!==null){var O=Xa();Ci(A,p,1,O)}}),Y1(p,1)}},he=function(p){if(p.tag===13){var x=Fl(p,134217728);if(x!==null){var M=Xa();Ci(x,p,134217728,M)}Y1(p,134217728)}},fe=function(p){if(p.tag===13){var x=bc(p),M=Fl(p,x);if(M!==null){var A=Xa();Ci(M,p,x,A)}Y1(p,x)}},be=function(){return X},Ee=function(p,x){var M=X;try{return X=p,x()}finally{X=M}},ye=function(p,x,M){switch(x){case"input":if(Zt(p,M),x=M.name,M.type==="radio"&&x!=null){for(M=p;M.parentNode;)M=M.parentNode;for(M=M.querySelectorAll("input[name="+JSON.stringify(""+x)+'][type="radio"]'),x=0;x<M.length;x++){var A=M[x];if(A!==p&&A.form===p.form){var O=To(A);if(!O)throw Error(r(90));K(A),Zt(A,O)}}}break;case"textarea":an(p,M);break;case"select":x=M.value,x!=null&&Xe(p,!!M.multiple,x,!1)}},Oe=$1,Gt=P0;var LA={usingClientEntryPoint:!1,Events:[Sa,Lr,To,Ye,Ve,$1]},lf={findFiberByHostInstance:ur,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},zA={bundleType:lf.bundleType,version:lf.version,rendererPackageName:lf.rendererPackageName,rendererConfig:lf.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:R.ReactCurrentDispatcher,findHostInstanceByFiber:function(p){return p=At(p),p===null?null:p.stateNode},findFiberByHostInstance:lf.findFiberByHostInstance||_A,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Cm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Cm.isDisabled&&Cm.supportsFiber)try{hr=Cm.inject(zA),or=Cm}catch{}}return ps.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=LA,ps.createPortal=function(p,x){var M=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!X1(x))throw Error(r(200));return OA(p,x,null,M)},ps.createRoot=function(p,x){if(!X1(p))throw Error(r(299));var M=!1,A="",O=v4;return x!=null&&(x.unstable_strictMode===!0&&(M=!0),x.identifierPrefix!==void 0&&(A=x.identifierPrefix),x.onRecoverableError!==void 0&&(O=x.onRecoverableError)),x=U1(p,1,!1,null,null,M,!1,A,O),p[ls]=x.current,pt(p.nodeType===8?p.parentNode:p),new K1(x)},ps.findDOMNode=function(p){if(p==null)return null;if(p.nodeType===1)return p;var x=p._reactInternals;if(x===void 0)throw typeof p.render=="function"?Error(r(188)):(p=Object.keys(p).join(","),Error(r(268,p)));return p=At(x),p=p===null?null:p.stateNode,p},ps.flushSync=function(p){return P0(p)},ps.hydrate=function(p,x,M){if(!Sm(x))throw Error(r(200));return wm(null,p,x,!0,M)},ps.hydrateRoot=function(p,x,M){if(!X1(p))throw Error(r(405));var A=M!=null&&M.hydratedSources||null,O=!1,B="",Y=v4;if(M!=null&&(M.unstable_strictMode===!0&&(O=!0),M.identifierPrefix!==void 0&&(B=M.identifierPrefix),M.onRecoverableError!==void 0&&(Y=M.onRecoverableError)),x=x4(x,null,p,1,M??null,O,!1,B,Y),p[ls]=x.current,pt(p),A)for(p=0;p<A.length;p++)M=A[p],O=M._getVersion,O=O(M._source),x.mutableSourceEagerHydrationData==null?x.mutableSourceEagerHydrationData=[M,O]:x.mutableSourceEagerHydrationData.push(M,O);return new vm(x)},ps.render=function(p,x,M){if(!Sm(x))throw Error(r(200));return wm(null,p,x,!1,M)},ps.unmountComponentAtNode=function(p){if(!Sm(p))throw Error(r(40));return p._reactRootContainer?(P0(function(){wm(null,null,p,!1,function(){p._reactRootContainer=null,p[ls]=null})}),!0):!1},ps.unstable_batchedUpdates=$1,ps.unstable_renderSubtreeIntoContainer=function(p,x,M,A){if(!Sm(M))throw Error(r(200));if(p==null||p._reactInternals===void 0)throw Error(r(38));return wm(p,x,M,!1,A)},ps.version="18.3.1-next-f1338f8080-20240426",ps}var E4;function kC(){if(E4)return Q1.exports;E4=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),Q1.exports=VA(),Q1.exports}var T4;function UA(){if(T4)return Mm;T4=1;var e=kC();return Mm.createRoot=e.createRoot,Mm.hydrateRoot=e.hydrateRoot,Mm}var YA=UA(),KA=kC();const XA=MC(KA);function ZA(e){if(typeof document>"u")return;let t=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",t.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}const JA=e=>{switch(e){case"success":return tj;case"info":return rj;case"warning":return nj;case"error":return oj;default:return null}},QA=Array(12).fill(0),ej=({visible:e,className:t})=>Yt.createElement("div",{className:["sonner-loading-wrapper",t].filter(Boolean).join(" "),"data-visible":e},Yt.createElement("div",{className:"sonner-spinner"},QA.map((r,o)=>Yt.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${o}`})))),tj=Yt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Yt.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),nj=Yt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},Yt.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),rj=Yt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Yt.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),oj=Yt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Yt.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),aj=Yt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},Yt.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),Yt.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),sj=()=>{const[e,t]=Yt.useState(document.hidden);return Yt.useEffect(()=>{const r=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",r),()=>window.removeEventListener("visibilitychange",r)},[]),e};let Mx=1;class ij{constructor(){this.subscribe=t=>(this.subscribers.push(t),()=>{const r=this.subscribers.indexOf(t);this.subscribers.splice(r,1)}),this.publish=t=>{this.subscribers.forEach(r=>r(t))},this.addToast=t=>{this.publish(t),this.toasts=[...this.toasts,t]},this.create=t=>{var r;const{message:o,...s}=t,l=typeof(t==null?void 0:t.id)=="number"||((r=t.id)==null?void 0:r.length)>0?t.id:Mx++,i=this.toasts.find(c=>c.id===l),u=t.dismissible===void 0?!0:t.dismissible;return this.dismissedToasts.has(l)&&this.dismissedToasts.delete(l),i?this.toasts=this.toasts.map(c=>c.id===l?(this.publish({...c,...t,id:l,title:o}),{...c,...t,id:l,dismissible:u,title:o}):c):this.addToast({title:o,...s,dismissible:u,id:l}),l},this.dismiss=t=>(t?(this.dismissedToasts.add(t),requestAnimationFrame(()=>this.subscribers.forEach(r=>r({id:t,dismiss:!0})))):this.toasts.forEach(r=>{this.subscribers.forEach(o=>o({id:r.id,dismiss:!0}))}),t),this.message=(t,r)=>this.create({...r,message:t}),this.error=(t,r)=>this.create({...r,message:t,type:"error"}),this.success=(t,r)=>this.create({...r,type:"success",message:t}),this.info=(t,r)=>this.create({...r,type:"info",message:t}),this.warning=(t,r)=>this.create({...r,type:"warning",message:t}),this.loading=(t,r)=>this.create({...r,type:"loading",message:t}),this.promise=(t,r)=>{if(!r)return;let o;r.loading!==void 0&&(o=this.create({...r,promise:t,type:"loading",message:r.loading,description:typeof r.description!="function"?r.description:void 0}));const s=Promise.resolve(t instanceof Function?t():t);let l=o!==void 0,i;const u=s.then(async d=>{if(i=["resolve",d],Yt.isValidElement(d))l=!1,this.create({id:o,type:"default",message:d});else if(cj(d)&&!d.ok){l=!1;const f=typeof r.error=="function"?await r.error(`HTTP error! status: ${d.status}`):r.error,g=typeof r.description=="function"?await r.description(`HTTP error! status: ${d.status}`):r.description,y=typeof f=="object"&&!Yt.isValidElement(f)?f:{message:f};this.create({id:o,type:"error",description:g,...y})}else if(d instanceof Error){l=!1;const f=typeof r.error=="function"?await r.error(d):r.error,g=typeof r.description=="function"?await r.description(d):r.description,y=typeof f=="object"&&!Yt.isValidElement(f)?f:{message:f};this.create({id:o,type:"error",description:g,...y})}else if(r.success!==void 0){l=!1;const f=typeof r.success=="function"?await r.success(d):r.success,g=typeof r.description=="function"?await r.description(d):r.description,y=typeof f=="object"&&!Yt.isValidElement(f)?f:{message:f};this.create({id:o,type:"success",description:g,...y})}}).catch(async d=>{if(i=["reject",d],r.error!==void 0){l=!1;const h=typeof r.error=="function"?await r.error(d):r.error,f=typeof r.description=="function"?await r.description(d):r.description,m=typeof h=="object"&&!Yt.isValidElement(h)?h:{message:h};this.create({id:o,type:"error",description:f,...m})}}).finally(()=>{l&&(this.dismiss(o),o=void 0),r.finally==null||r.finally.call(r)}),c=()=>new Promise((d,h)=>u.then(()=>i[0]==="reject"?h(i[1]):d(i[1])).catch(h));return typeof o!="string"&&typeof o!="number"?{unwrap:c}:Object.assign(o,{unwrap:c})},this.custom=(t,r)=>{const o=(r==null?void 0:r.id)||Mx++;return this.create({jsx:t(o),id:o,...r}),o},this.getActiveToasts=()=>this.toasts.filter(t=>!this.dismissedToasts.has(t.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}}const Ms=new ij,lj=(e,t)=>{const r=(t==null?void 0:t.id)||Mx++;return Ms.addToast({title:e,...t,id:r}),r},cj=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",dj=lj,uj=()=>Ms.toasts,hj=()=>Ms.getActiveToasts(),Kn=Object.assign(dj,{success:Ms.success,info:Ms.info,warning:Ms.warning,error:Ms.error,custom:Ms.custom,message:Ms.message,promise:Ms.promise,dismiss:Ms.dismiss,loading:Ms.loading},{getHistory:uj,getToasts:hj});ZA("[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}[data-sonner-toaster][data-lifted=true]{transform:translateY(-8px)}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}");function km(e){return e.label!==void 0}const fj=3,pj="24px",mj="16px",I4=4e3,gj=356,yj=14,xj=45,bj=200;function ll(...e){return e.filter(Boolean).join(" ")}function vj(e){const[t,r]=e.split("-"),o=[];return t&&o.push(t),r&&o.push(r),o}const Sj=e=>{var t,r,o,s,l,i,u,c,d;const{invert:h,toast:f,unstyled:g,interacting:m,setHeights:y,visibleToasts:v,heights:b,index:S,toasts:C,expanded:k,removeToast:R,defaultRichColors:j,closeButton:T,style:_,cancelButtonStyle:P,actionButtonStyle:I,className:$="",descriptionClassName:q="",duration:L,position:H,gap:G,expandByDefault:oe,classNames:le,icons:pe,closeButtonAriaLabel:ce="Close toast"}=e,[te,F]=Yt.useState(null),[Q,ae]=Yt.useState(null),[we,Re]=Yt.useState(!1),[ge,Ae]=Yt.useState(!1),[tt,We]=Yt.useState(!1),[J,ke]=Yt.useState(!1),[Le,K]=Yt.useState(!1),[et,dt]=Yt.useState(0),[Rt,Wt]=Yt.useState(0),Zt=Yt.useRef(f.duration||L||I4),$e=Yt.useRef(null),Ze=Yt.useRef(null),Fe=S===0,Xe=S+1<=v,jt=f.type,hn=f.dismissible!==!1,an=f.className||"",it=f.descriptionClassName||"",kt=Yt.useMemo(()=>b.findIndex(Ye=>Ye.toastId===f.id)||0,[b,f.id]),On=Yt.useMemo(()=>{var Ye;return(Ye=f.closeButton)!=null?Ye:T},[f.closeButton,T]),sn=Yt.useMemo(()=>f.duration||L||I4,[f.duration,L]),Xn=Yt.useRef(0),Pt=Yt.useRef(0),zt=Yt.useRef(0),jn=Yt.useRef(null),[En,lt]=H.split("-"),ht=Yt.useMemo(()=>b.reduce((Ye,Ve,Oe)=>Oe>=kt?Ye:Ye+Ve.height,0),[b,kt]),_t=sj(),Ie=f.invert||h,at=jt==="loading";Pt.current=Yt.useMemo(()=>kt*G+ht,[kt,ht]),Yt.useEffect(()=>{Zt.current=sn},[sn]),Yt.useEffect(()=>{Re(!0)},[]),Yt.useEffect(()=>{const Ye=Ze.current;if(Ye){const Ve=Ye.getBoundingClientRect().height;return Wt(Ve),y(Oe=>[{toastId:f.id,height:Ve,position:f.position},...Oe]),()=>y(Oe=>Oe.filter(Gt=>Gt.toastId!==f.id))}},[y,f.id]),Yt.useLayoutEffect(()=>{if(!we)return;const Ye=Ze.current,Ve=Ye.style.height;Ye.style.height="auto";const Oe=Ye.getBoundingClientRect().height;Ye.style.height=Ve,Wt(Oe),y(Gt=>Gt.find(fn=>fn.toastId===f.id)?Gt.map(fn=>fn.toastId===f.id?{...fn,height:Oe}:fn):[{toastId:f.id,height:Oe,position:f.position},...Gt])},[we,f.title,f.description,y,f.id]);const St=Yt.useCallback(()=>{Ae(!0),dt(Pt.current),y(Ye=>Ye.filter(Ve=>Ve.toastId!==f.id)),setTimeout(()=>{R(f)},bj)},[f,R,y,Pt]);Yt.useEffect(()=>{if(f.promise&&jt==="loading"||f.duration===1/0||f.type==="loading")return;let Ye;return k||m||_t?(()=>{if(zt.current<Xn.current){const Gt=new Date().getTime()-Xn.current;Zt.current=Zt.current-Gt}zt.current=new Date().getTime()})():(()=>{Zt.current!==1/0&&(Xn.current=new Date().getTime(),Ye=setTimeout(()=>{f.onAutoClose==null||f.onAutoClose.call(f,f),St()},Zt.current))})(),()=>clearTimeout(Ye)},[k,m,f,jt,_t,St]),Yt.useEffect(()=>{f.delete&&St()},[St,f.delete]);function ye(){var Ye;if(pe!=null&&pe.loading){var Ve;return Yt.createElement("div",{className:ll(le==null?void 0:le.loader,f==null||(Ve=f.classNames)==null?void 0:Ve.loader,"sonner-loader"),"data-visible":jt==="loading"},pe.loading)}return Yt.createElement(ej,{className:ll(le==null?void 0:le.loader,f==null||(Ye=f.classNames)==null?void 0:Ye.loader),visible:jt==="loading"})}const xe=f.icon||(pe==null?void 0:pe[jt])||JA(jt);var gt,Ge;return Yt.createElement("li",{tabIndex:0,ref:Ze,className:ll($,an,le==null?void 0:le.toast,f==null||(t=f.classNames)==null?void 0:t.toast,le==null?void 0:le.default,le==null?void 0:le[jt],f==null||(r=f.classNames)==null?void 0:r[jt]),"data-sonner-toast":"","data-rich-colors":(gt=f.richColors)!=null?gt:j,"data-styled":!(f.jsx||f.unstyled||g),"data-mounted":we,"data-promise":!!f.promise,"data-swiped":Le,"data-removed":ge,"data-visible":Xe,"data-y-position":En,"data-x-position":lt,"data-index":S,"data-front":Fe,"data-swiping":tt,"data-dismissible":hn,"data-type":jt,"data-invert":Ie,"data-swipe-out":J,"data-swipe-direction":Q,"data-expanded":!!(k||oe&&we),style:{"--index":S,"--toasts-before":S,"--z-index":C.length-S,"--offset":`${ge?et:Pt.current}px`,"--initial-height":oe?"auto":`${Rt}px`,..._,...f.style},onDragEnd:()=>{We(!1),F(null),jn.current=null},onPointerDown:Ye=>{at||!hn||($e.current=new Date,dt(Pt.current),Ye.target.setPointerCapture(Ye.pointerId),Ye.target.tagName!=="BUTTON"&&(We(!0),jn.current={x:Ye.clientX,y:Ye.clientY}))},onPointerUp:()=>{var Ye,Ve,Oe;if(J||!hn)return;jn.current=null;const Gt=Number(((Ye=Ze.current)==null?void 0:Ye.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),Kt=Number(((Ve=Ze.current)==null?void 0:Ve.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),fn=new Date().getTime()-((Oe=$e.current)==null?void 0:Oe.getTime()),zn=te==="x"?Gt:Kt,rt=Math.abs(zn)/fn;if(Math.abs(zn)>=xj||rt>.11){dt(Pt.current),f.onDismiss==null||f.onDismiss.call(f,f),ae(te==="x"?Gt>0?"right":"left":Kt>0?"down":"up"),St(),ke(!0);return}else{var mt,yt;(mt=Ze.current)==null||mt.style.setProperty("--swipe-amount-x","0px"),(yt=Ze.current)==null||yt.style.setProperty("--swipe-amount-y","0px")}K(!1),We(!1),F(null)},onPointerMove:Ye=>{var Ve,Oe,Gt;if(!jn.current||!hn||((Ve=window.getSelection())==null?void 0:Ve.toString().length)>0)return;const fn=Ye.clientY-jn.current.y,zn=Ye.clientX-jn.current.x;var rt;const mt=(rt=e.swipeDirections)!=null?rt:vj(H);!te&&(Math.abs(zn)>1||Math.abs(fn)>1)&&F(Math.abs(zn)>Math.abs(fn)?"x":"y");let yt={x:0,y:0};const Et=Ft=>1/(1.5+Math.abs(Ft)/20);if(te==="y"){if(mt.includes("top")||mt.includes("bottom"))if(mt.includes("top")&&fn<0||mt.includes("bottom")&&fn>0)yt.y=fn;else{const Ft=fn*Et(fn);yt.y=Math.abs(Ft)<Math.abs(fn)?Ft:fn}}else if(te==="x"&&(mt.includes("left")||mt.includes("right")))if(mt.includes("left")&&zn<0||mt.includes("right")&&zn>0)yt.x=zn;else{const Ft=zn*Et(zn);yt.x=Math.abs(Ft)<Math.abs(zn)?Ft:zn}(Math.abs(yt.x)>0||Math.abs(yt.y)>0)&&K(!0),(Oe=Ze.current)==null||Oe.style.setProperty("--swipe-amount-x",`${yt.x}px`),(Gt=Ze.current)==null||Gt.style.setProperty("--swipe-amount-y",`${yt.y}px`)}},On&&!f.jsx&&jt!=="loading"?Yt.createElement("button",{"aria-label":ce,"data-disabled":at,"data-close-button":!0,onClick:at||!hn?()=>{}:()=>{St(),f.onDismiss==null||f.onDismiss.call(f,f)},className:ll(le==null?void 0:le.closeButton,f==null||(o=f.classNames)==null?void 0:o.closeButton)},(Ge=pe==null?void 0:pe.close)!=null?Ge:aj):null,(jt||f.icon||f.promise)&&f.icon!==null&&((pe==null?void 0:pe[jt])!==null||f.icon)?Yt.createElement("div",{"data-icon":"",className:ll(le==null?void 0:le.icon,f==null||(s=f.classNames)==null?void 0:s.icon)},f.promise||f.type==="loading"&&!f.icon?f.icon||ye():null,f.type!=="loading"?xe:null):null,Yt.createElement("div",{"data-content":"",className:ll(le==null?void 0:le.content,f==null||(l=f.classNames)==null?void 0:l.content)},Yt.createElement("div",{"data-title":"",className:ll(le==null?void 0:le.title,f==null||(i=f.classNames)==null?void 0:i.title)},f.jsx?f.jsx:typeof f.title=="function"?f.title():f.title),f.description?Yt.createElement("div",{"data-description":"",className:ll(q,it,le==null?void 0:le.description,f==null||(u=f.classNames)==null?void 0:u.description)},typeof f.description=="function"?f.description():f.description):null),Yt.isValidElement(f.cancel)?f.cancel:f.cancel&&km(f.cancel)?Yt.createElement("button",{"data-button":!0,"data-cancel":!0,style:f.cancelButtonStyle||P,onClick:Ye=>{km(f.cancel)&&hn&&(f.cancel.onClick==null||f.cancel.onClick.call(f.cancel,Ye),St())},className:ll(le==null?void 0:le.cancelButton,f==null||(c=f.classNames)==null?void 0:c.cancelButton)},f.cancel.label):null,Yt.isValidElement(f.action)?f.action:f.action&&km(f.action)?Yt.createElement("button",{"data-button":!0,"data-action":!0,style:f.actionButtonStyle||I,onClick:Ye=>{km(f.action)&&(f.action.onClick==null||f.action.onClick.call(f.action,Ye),!Ye.defaultPrevented&&St())},className:ll(le==null?void 0:le.actionButton,f==null||(d=f.classNames)==null?void 0:d.actionButton)},f.action.label):null)};function P4(){if(typeof window>"u"||typeof document>"u")return"ltr";const e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}function wj(e,t){const r={};return[e,t].forEach((o,s)=>{const l=s===1,i=l?"--mobile-offset":"--offset",u=l?mj:pj;function c(d){["top","right","bottom","left"].forEach(h=>{r[`${i}-${h}`]=typeof d=="number"?`${d}px`:d})}typeof o=="number"||typeof o=="string"?c(o):typeof o=="object"?["top","right","bottom","left"].forEach(d=>{o[d]===void 0?r[`${i}-${d}`]=u:r[`${i}-${d}`]=typeof o[d]=="number"?`${o[d]}px`:o[d]}):c(u)}),r}const Cj=Yt.forwardRef(function(t,r){const{invert:o,position:s="bottom-right",hotkey:l=["altKey","KeyT"],expand:i,closeButton:u,className:c,offset:d,mobileOffset:h,theme:f="light",richColors:g,duration:m,style:y,visibleToasts:v=fj,toastOptions:b,dir:S=P4(),gap:C=yj,icons:k,containerAriaLabel:R="Notifications"}=t,[j,T]=Yt.useState([]),_=Yt.useMemo(()=>Array.from(new Set([s].concat(j.filter(Q=>Q.position).map(Q=>Q.position)))),[j,s]),[P,I]=Yt.useState([]),[$,q]=Yt.useState(!1),[L,H]=Yt.useState(!1),[G,oe]=Yt.useState(f!=="system"?f:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),le=Yt.useRef(null),pe=l.join("+").replace(/Key/g,"").replace(/Digit/g,""),ce=Yt.useRef(null),te=Yt.useRef(!1),F=Yt.useCallback(Q=>{T(ae=>{var we;return(we=ae.find(Re=>Re.id===Q.id))!=null&&we.delete||Ms.dismiss(Q.id),ae.filter(({id:Re})=>Re!==Q.id)})},[]);return Yt.useEffect(()=>Ms.subscribe(Q=>{if(Q.dismiss){requestAnimationFrame(()=>{T(ae=>ae.map(we=>we.id===Q.id?{...we,delete:!0}:we))});return}setTimeout(()=>{XA.flushSync(()=>{T(ae=>{const we=ae.findIndex(Re=>Re.id===Q.id);return we!==-1?[...ae.slice(0,we),{...ae[we],...Q},...ae.slice(we+1)]:[Q,...ae]})})})}),[j]),Yt.useEffect(()=>{if(f!=="system"){oe(f);return}if(f==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?oe("dark"):oe("light")),typeof window>"u")return;const Q=window.matchMedia("(prefers-color-scheme: dark)");try{Q.addEventListener("change",({matches:ae})=>{oe(ae?"dark":"light")})}catch{Q.addListener(({matches:we})=>{try{oe(we?"dark":"light")}catch(Re){console.error(Re)}})}},[f]),Yt.useEffect(()=>{j.length<=1&&q(!1)},[j]),Yt.useEffect(()=>{const Q=ae=>{var we;if(l.every(Ae=>ae[Ae]||ae.code===Ae)){var ge;q(!0),(ge=le.current)==null||ge.focus()}ae.code==="Escape"&&(document.activeElement===le.current||(we=le.current)!=null&&we.contains(document.activeElement))&&q(!1)};return document.addEventListener("keydown",Q),()=>document.removeEventListener("keydown",Q)},[l]),Yt.useEffect(()=>{if(le.current)return()=>{ce.current&&(ce.current.focus({preventScroll:!0}),ce.current=null,te.current=!1)}},[le.current]),Yt.createElement("section",{ref:r,"aria-label":`${R} ${pe}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},_.map((Q,ae)=>{var we;const[Re,ge]=Q.split("-");return j.length?Yt.createElement("ol",{key:Q,dir:S==="auto"?P4():S,tabIndex:-1,ref:le,className:c,"data-sonner-toaster":!0,"data-sonner-theme":G,"data-y-position":Re,"data-lifted":$&&j.length>1&&!i,"data-x-position":ge,style:{"--front-toast-height":`${((we=P[0])==null?void 0:we.height)||0}px`,"--width":`${gj}px`,"--gap":`${C}px`,...y,...wj(d,h)},onBlur:Ae=>{te.current&&!Ae.currentTarget.contains(Ae.relatedTarget)&&(te.current=!1,ce.current&&(ce.current.focus({preventScroll:!0}),ce.current=null))},onFocus:Ae=>{Ae.target instanceof HTMLElement&&Ae.target.dataset.dismissible==="false"||te.current||(te.current=!0,ce.current=Ae.relatedTarget)},onMouseEnter:()=>q(!0),onMouseMove:()=>q(!0),onMouseLeave:()=>{L||q(!1)},onDragEnd:()=>q(!1),onPointerDown:Ae=>{Ae.target instanceof HTMLElement&&Ae.target.dataset.dismissible==="false"||H(!0)},onPointerUp:()=>H(!1)},j.filter(Ae=>!Ae.position&&ae===0||Ae.position===Q).map((Ae,tt)=>{var We,J;return Yt.createElement(Sj,{key:Ae.id,icons:k,index:tt,toast:Ae,defaultRichColors:g,duration:(We=b==null?void 0:b.duration)!=null?We:m,className:b==null?void 0:b.className,descriptionClassName:b==null?void 0:b.descriptionClassName,invert:o,visibleToasts:v,closeButton:(J=b==null?void 0:b.closeButton)!=null?J:u,interacting:L,position:Q,style:b==null?void 0:b.style,unstyled:b==null?void 0:b.unstyled,classNames:b==null?void 0:b.classNames,cancelButtonStyle:b==null?void 0:b.cancelButtonStyle,actionButtonStyle:b==null?void 0:b.actionButtonStyle,closeButtonAriaLabel:b==null?void 0:b.closeButtonAriaLabel,removeToast:F,toasts:j.filter(ke=>ke.position==Ae.position),heights:P.filter(ke=>ke.position==Ae.position),setHeights:I,expandByDefault:i,gap:C,expanded:$,swipeDirections:t.swipeDirections})})):null}))});/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mj=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),kj=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,r,o)=>o?o.toUpperCase():r.toLowerCase()),F4=e=>{const t=kj(e);return t.charAt(0).toUpperCase()+t.slice(1)},RC=(...e)=>e.filter((t,r,o)=>!!t&&t.trim()!==""&&o.indexOf(t)===r).join(" ").trim();/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Rj={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aj=w.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:o,className:s="",children:l,iconNode:i,...u},c)=>w.createElement("svg",{ref:c,...Rj,width:t,height:t,stroke:e,strokeWidth:o?Number(r)*24/Number(t):r,className:RC("lucide",s),...u},[...i.map(([d,h])=>w.createElement(d,h)),...Array.isArray(l)?l:[l]]));/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=(e,t)=>{const r=w.forwardRef(({className:o,...s},l)=>w.createElement(Aj,{ref:l,iconNode:t,className:RC(`lucide-${Mj(F4(e))}`,`lucide-${e}`,o),...s}));return r.displayName=F4(e),r};/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jj=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Dc=Ot("activity",jj);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ej=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],Tj=Ot("archive",Ej);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ij=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Pj=Ot("arrow-left",Ij);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fj=[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M11 12h4",key:"q8tih4"}],["path",{d:"M11 16h7",key:"uosisv"}],["path",{d:"M11 20h10",key:"jvxblo"}]],Nj=Ot("arrow-up-narrow-wide",Fj);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oj=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["path",{d:"M20.2 20.2c2.04-2.03.02-7.36-4.5-11.9-4.54-4.52-9.87-6.54-11.9-4.5-2.04 2.03-.02 7.36 4.5 11.9 4.54 4.52 9.87 6.54 11.9 4.5Z",key:"1l2ple"}],["path",{d:"M15.7 15.7c4.52-4.54 6.54-9.87 4.5-11.9-2.03-2.04-7.36-.02-11.9 4.5-4.52 4.54-6.54 9.87-4.5 11.9 2.03 2.04 7.36.02 11.9-4.5Z",key:"1wam0m"}]],_j=Ot("atom",Oj);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dj=[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]],Lj=Ot("award",Dj);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zj=[["circle",{cx:"11",cy:"13",r:"9",key:"hd149"}],["path",{d:"M14.35 4.65 16.3 2.7a2.41 2.41 0 0 1 3.4 0l1.6 1.6a2.4 2.4 0 0 1 0 3.4l-1.95 1.95",key:"jp4j1b"}],["path",{d:"m22 2-1.5 1.5",key:"ay92ug"}]],Bj=Ot("bomb",zj);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $j=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],Rp=Ot("book-open",$j);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qj=[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}],["path",{d:"M8 11h8",key:"vwpz6n"}],["path",{d:"M8 7h6",key:"1f0q6e"}]],AC=Ot("book-text",qj);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wj=[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]],N4=Ot("book",Wj);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hj=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]],Bb=Ot("bookmark",Hj);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gj=[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]],Y5=Ot("box",Gj);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vj=[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]],jC=Ot("brain",Vj);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uj=[["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M9 7.13v-1a3.003 3.003 0 1 1 6 0v1",key:"d7y7pr"}],["path",{d:"M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6",key:"xs1cw7"}],["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M6.53 9C4.6 8.8 3 7.1 3 5",key:"32zzws"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"M3 21c0-2.1 1.7-3.9 3.8-4",key:"4p0ekp"}],["path",{d:"M20.97 5c0 2.1-1.6 3.8-3.5 4",key:"18gb23"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M17.2 17c2.1.1 3.8 1.9 3.8 4",key:"k3fwyw"}]],Rm=Ot("bug",Uj);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yj=[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],EC=Ot("camera",Yj);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kj=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],kx=Ot("check",Kj);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xj=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Pa=Ot("chevron-down",Xj);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zj=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],Ap=Ot("chevron-left",Zj);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jj=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],aa=Ot("chevron-right",Jj);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qj=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],e9=Ot("chevron-up",Qj);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t9=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],n9=Ot("circle-alert",t9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r9=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],K5=Ot("circle-check-big",r9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o9=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]],a9=Ot("circle-dot",o9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s9=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],TC=Ot("circle-help",s9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i9=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],l9=Ot("circle",i9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c9=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],IC=Ot("clock",c9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d9=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],PC=Ot("copy",d9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u9=[["rect",{width:"16",height:"16",x:"4",y:"4",rx:"2",key:"14l7u7"}],["rect",{width:"6",height:"6",x:"9",y:"9",rx:"1",key:"5aljv4"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]],h9=Ot("cpu",u9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f9=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]],O4=Ot("crosshair",f9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p9=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],n2=Ot("database",p9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m9=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M16 8h.01",key:"cr5u4v"}],["path",{d:"M8 8h.01",key:"1e4136"}],["path",{d:"M8 16h.01",key:"18s6g9"}],["path",{d:"M16 16h.01",key:"1f9h7w"}],["path",{d:"M12 12h.01",key:"1mp3jc"}]],g9=Ot("dice-5",m9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y9=[["path",{d:"m10 16 1.5 1.5",key:"11lckj"}],["path",{d:"m14 8-1.5-1.5",key:"1ohn8i"}],["path",{d:"M15 2c-1.798 1.998-2.518 3.995-2.807 5.993",key:"80uv8i"}],["path",{d:"m16.5 10.5 1 1",key:"696xn5"}],["path",{d:"m17 6-2.891-2.891",key:"xu6p2f"}],["path",{d:"M2 15c6.667-6 13.333 0 20-6",key:"1pyr53"}],["path",{d:"m20 9 .891.891",key:"3xwk7g"}],["path",{d:"M3.109 14.109 4 15",key:"q76aoh"}],["path",{d:"m6.5 12.5 1 1",key:"cs35ky"}],["path",{d:"m7 18 2.891 2.891",key:"1sisit"}],["path",{d:"M9 22c1.798-1.998 2.518-3.995 2.807-5.993",key:"q3hbxp"}]],X5=Ot("dna",y9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x9=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],FC=Ot("download",x9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b9=[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]],_4=Ot("droplets",b9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v9=[["path",{d:"M6 8.5a6.5 6.5 0 1 1 13 0c0 6-6 6-6 10a3.5 3.5 0 1 1-7 0",key:"1dfaln"}],["path",{d:"M15 8.5a2.5 2.5 0 0 0-5 0v1a2 2 0 1 1 0 4",key:"1qnva7"}]],S9=Ot("ear",v9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w9=[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21",key:"182aya"}],["path",{d:"M22 21H7",key:"t4ddhn"}],["path",{d:"m5 11 9 9",key:"1mo9qw"}]],j5=Ot("eraser",w9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C9=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],$b=Ot("external-link",C9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M9=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Ag=Ot("eye-off",M9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k9=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],vl=Ot("eye",k9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R9=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],A9=Ot("file-text",R9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j9=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]],E9=Ot("film",j9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T9=[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]],I9=Ot("flame",T9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P9=[["path",{d:"M14 2v6a2 2 0 0 0 .245.96l5.51 10.08A2 2 0 0 1 18 22H6a2 2 0 0 1-1.755-2.96l5.51-10.08A2 2 0 0 0 10 8V2",key:"18mbvz"}],["path",{d:"M6.453 15h11.094",key:"3shlmq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}]],F9=Ot("flask-conical",P9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N9=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],ph=Ot("folder",N9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O9=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],NC=Ot("funnel",O9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _9=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],D9=Ot("grid-3x3",_9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L9=[["path",{d:"M18 11V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2",key:"1fvzgz"}],["path",{d:"M14 10V4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v2",key:"1kc0my"}],["path",{d:"M10 10.5V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2v8",key:"10h0bg"}],["path",{d:"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"1s1gnw"}]],z9=Ot("hand",L9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B9=[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]],OC=Ot("heart",B9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $9=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],q9=Ot("image",$9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W9=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],H9=Ot("info",W9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G9=[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]],V9=Ot("key-round",G9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U9=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],Y9=Ot("key",U9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K9=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],mh=Ot("layers",K9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X9=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],Z9=Ot("layout-grid",X9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J9=[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]],r2=Ot("leaf",J9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q9=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],_C=Ot("link-2",Q9);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eE=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],tE=Ot("loader",eE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nE=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]],rE=Ot("lock-open",nE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oE=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],Rx=Ot("lock",oE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aE=[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]],sE=Ot("log-in",aE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iE=[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]],DC=Ot("maximize-2",iE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lE=[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],cE=Ot("mic",lE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dE=[["path",{d:"M5 12h14",key:"1ays0h"}]],uE=Ot("minus",dE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hE=[["path",{d:"M4.037 4.688a.495.495 0 0 1 .651-.651l16 6.5a.5.5 0 0 1-.063.947l-6.124 1.58a2 2 0 0 0-1.438 1.435l-1.579 6.126a.5.5 0 0 1-.947.063z",key:"edeuup"}]],fE=Ot("mouse-pointer-2",hE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pE=[["path",{d:"M18 8L22 12L18 16",key:"1r0oui"}],["path",{d:"M2 12H22",key:"1m8cig"}]],mE=Ot("move-right",pE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gE=[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]],yE=Ot("move",gE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xE=[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]],o2=Ot("music",xE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bE=[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]],vE=Ot("network",bE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SE=[["path",{d:"m14.622 17.897-10.68-2.913",key:"vj2p1u"}],["path",{d:"M18.376 2.622a1 1 0 1 1 3.002 3.002L17.36 9.643a.5.5 0 0 0 0 .707l.944.944a2.41 2.41 0 0 1 0 3.408l-.944.944a.5.5 0 0 1-.707 0L8.354 7.348a.5.5 0 0 1 0-.707l.944-.944a2.41 2.41 0 0 1 3.408 0l.944.944a.5.5 0 0 0 .707 0z",key:"18tc5c"}],["path",{d:"M9 8c-1.804 2.71-3.97 3.46-6.583 3.948a.507.507 0 0 0-.302.819l7.32 8.883a1 1 0 0 0 1.185.204C12.735 20.405 16 16.792 16 15",key:"ytzfxy"}]],wE=Ot("paintbrush",SE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CE=[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]],ME=Ot("palette",CE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kE=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]],s0=Ot("pause",kE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RE=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],AE=Ot("pencil",RE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jE=[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]],LC=Ot("pin",jE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EE=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],wl=Ot("play",EE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TE=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],jg=Ot("plus",TE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IE=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Ch=Ot("refresh-cw",IE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PE=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Wi=Ot("rotate-ccw",PE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FE=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],NE=Ot("search",FE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OE=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],_d=Ot("settings",OE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _E=[["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 18h1.973a4 4 0 0 0 3.3-1.7l5.454-8.6a4 4 0 0 1 3.3-1.7H22",key:"1ailkh"}],["path",{d:"M2 6h1.972a4 4 0 0 1 3.6 2.2",key:"km57vx"}],["path",{d:"M22 18h-6.041a4 4 0 0 1-3.3-1.8l-.359-.45",key:"os18l9"}]],DE=Ot("shuffle",_E);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LE=[["line",{x1:"4",x2:"4",y1:"21",y2:"14",key:"1p332r"}],["line",{x1:"4",x2:"4",y1:"10",y2:"3",key:"gb41h5"}],["line",{x1:"12",x2:"12",y1:"21",y2:"12",key:"hf2csr"}],["line",{x1:"12",x2:"12",y1:"8",y2:"3",key:"1kfi7u"}],["line",{x1:"20",x2:"20",y1:"21",y2:"16",key:"1lhrwl"}],["line",{x1:"20",x2:"20",y1:"12",y2:"3",key:"16vvfq"}],["line",{x1:"2",x2:"6",y1:"14",y2:"14",key:"1uebub"}],["line",{x1:"10",x2:"14",y1:"8",y2:"8",key:"1yglbp"}],["line",{x1:"18",x2:"22",y1:"16",y2:"16",key:"1jxqpz"}]],zE=Ot("sliders-vertical",LE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BE=[["path",{d:"m10 20-1.25-2.5L6 18",key:"18frcb"}],["path",{d:"M10 4 8.75 6.5 6 6",key:"7mghy3"}],["path",{d:"m14 20 1.25-2.5L18 18",key:"1chtki"}],["path",{d:"m14 4 1.25 2.5L18 6",key:"1b4wsy"}],["path",{d:"m17 21-3-6h-4",key:"15hhxa"}],["path",{d:"m17 3-3 6 1.5 3",key:"11697g"}],["path",{d:"M2 12h6.5L10 9",key:"kv9z4n"}],["path",{d:"m20 10-1.5 2 1.5 2",key:"1swlpi"}],["path",{d:"M22 12h-6.5L14 15",key:"1mxi28"}],["path",{d:"m4 10 1.5 2L4 14",key:"k9enpj"}],["path",{d:"m7 21 3-6-1.5-3",key:"j8hb9u"}],["path",{d:"m7 3 3 6h4",key:"1otusx"}]],$E=Ot("snowflake",BE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qE=[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]],Yi=Ot("sparkles",qE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WE=[["path",{d:"M7 20h10",key:"e6iznv"}],["path",{d:"M10 20c5.5-2.5.8-6.4 3-10",key:"161w41"}],["path",{d:"M9.5 9.4c1.1.8 1.8 2.2 2.3 3.7-2 .4-3.5.4-4.8-.3-1.2-.6-2.3-1.9-3-4.2 2.8-.5 4.4 0 5.5.8z",key:"9gtqwd"}],["path",{d:"M14.1 6a7 7 0 0 0-1.1 4c1.9-.1 3.3-.6 4.3-1.4 1-1 1.6-2.3 1.7-4.6-2.7.1-4 1-4.9 2z",key:"bkxnd2"}]],Am=Ot("sprout",WE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HE=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],GE=Ot("square",HE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VE=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],UE=Ot("star",VE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YE=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],KE=Ot("tag",YE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XE=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],lp=Ot("target",XE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZE=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],o0=Ot("trash-2",ZE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JE=[["path",{d:"m17 14 3 3.3a1 1 0 0 1-.7 1.7H4.7a1 1 0 0 1-.7-1.7L7 14h-.3a1 1 0 0 1-.7-1.7L9 9h-.2A1 1 0 0 1 8 7.3L12 3l4 4.3a1 1 0 0 1-.8 1.7H15l3 3.3a1 1 0 0 1-.7 1.7H17Z",key:"cpyugq"}],["path",{d:"M12 22v-3",key:"kmzjlo"}]],QE=Ot("tree-pine",JE);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eT=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],tT=Ot("triangle-alert",eT);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nT=[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]],Ax=Ot("trophy",nT);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rT=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],oT=Ot("undo-2",rT);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aT=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],sT=Ot("upload",aT);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iT=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],lT=Ot("user-plus",iT);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cT=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],dT=Ot("video",cT);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uT=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],hT=Ot("volume-2",uT);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fT=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],ya=Ot("x",fT);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pT=[["path",{d:"M10.513 4.856 13.12 2.17a.5.5 0 0 1 .86.46l-1.377 4.317",key:"193nxd"}],["path",{d:"M15.656 10H20a1 1 0 0 1 .78 1.63l-1.72 1.773",key:"27a7lr"}],["path",{d:"M16.273 16.273 10.88 21.83a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14H4a1 1 0 0 1-.78-1.63l4.507-4.643",key:"1e0qe9"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],mT=Ot("zap-off",pT);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gT=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],Es=Ot("zap",gT);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yT=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],zC=Ot("zoom-in",yT);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xT=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],BC=Ot("zoom-out",xT),bT=[{id:"tension",label:"T",title:"Tensao",color:"#ff4444"},{id:"cohesion",label:"C",title:"Coesao",color:"#4488ff"},{id:"scarcity",label:"N",title:"Nutricao",color:"#44ff88"},{id:"novelty",label:"E",title:"Entropia",color:"#ffaa44"}],vT="'Doto', monospace",Za="'IBM Plex Mono', monospace",D4={complexityLife:"#ffd400",metaArtLab:"#ff0084",musicLab:"#37b2da",rhizomeLab:"#10d45b",alchemyLab:"#d6552d",treeOfLife:"#601480",sociogenesis:"#601480",psycheLab:"#8b5cf6",languageLab:"#c8bfaa",asimovTheater:"#7c6fcd",physicsSandbox:"#22d3ee",milPlatos:"#6366f1"},ST={complexityLife:"",metaArtLab:"",musicLab:"",rhizomeLab:"",alchemyLab:"",treeOfLife:"",sociogenesis:"",psycheLab:"",languageLab:"",asimovTheater:"",physicsSandbox:"",milPlatos:""},wT=({running:e,speed:t,fps:r,trails:o,fieldHeatmap:s,fieldLayer:l="tension",canUndo:i,particleCount:u,speciesCount:c,mode:d,regime:h,circularDependency:f,dnaString:g,simQuality:m,achievementCount:y=0,simMs:v,renderMs:b,neighborsChecked:S,interactionsApplied:C,narrativeStatus:k,activeLab:R,hideUI:j=!1,socioStats:T,viewMode:_,onLabChange:P,onGoHome:I,availableLabs:$,adminMode:q=!1,onOpenAdmin:L,onTogglePlay:H,onStep:G,onSetSpeed:oe,onReset:le,onToggleTrails:pe,onToggleFieldHeatmap:ce,onFieldLayerChange:te,onUndo:F,onOpenGuide:Q,onOpenAchievements:ae,onOpenWorldLog:we,onOpenChronicle:Re,onToggleHideUI:ge,onViewModeToggle:Ae})=>{var ke,Le;const tt=[{id:"complexityLife",label:"Complexity Life"},{id:"metaArtLab",label:"Meta-Gen-Art"},{id:"musicLab",label:"Music Lab"},{id:"rhizomeLab",label:"Rhizome"},{id:"alchemyLab",label:"Alchemy"},{id:"treeOfLife",label:"Tree of Life"},{id:"sociogenesis",label:"Sociogenesis"},{id:"psycheLab",label:"Psyche"},{id:"milPlatos",label:"Mil Plats"},{id:"languageLab",label:"Language"},{id:"asimovTheater",label:"Asimov"},{id:"physicsSandbox",label:"Physics"}],We=$&&$.length?tt.filter(K=>$.includes(K.id)):tt,J=D4[R]||"#ffd400";return a.jsxs("div",{className:"fixed top-0 left-0 right-0 z-10 pointer-events-none",style:{fontFamily:Za},children:[a.jsxs("div",{className:"flex items-stretch pointer-events-auto",style:{borderBottom:"1px dashed rgba(255,255,255,0.06)",background:"rgba(0,0,0,0.94)"},children:[I&&a.jsxs("button",{onClick:I,title:"Voltar para Labs",className:"flex items-center gap-2 px-4 py-2 transition-all shrink-0",style:{background:"transparent",borderRight:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.40)",fontFamily:vT,fontSize:"10px",fontWeight:400,letterSpacing:"1.5px",textTransform:"uppercase"},children:[a.jsx(Z9,{size:10,strokeWidth:1.5}),a.jsx("span",{className:"hidden sm:inline",children:"TOOLS"})]}),a.jsx("div",{className:"flex items-stretch overflow-x-auto flex-1",style:{scrollbarWidth:"none"},children:We.map(K=>{const et=R===K.id,dt=D4[K.id]||"#fff";return a.jsxs("button",{onClick:()=>P(K.id),title:K.label,className:"flex items-center gap-1.5 px-3 py-2 transition-all whitespace-nowrap shrink-0 relative",style:{color:et?dt:"rgba(255,255,255,0.25)",fontFamily:Za,fontSize:"10px",fontWeight:et?400:200,letterSpacing:"0.5px",textTransform:"uppercase",background:et?`${dt}06`:"transparent",borderRight:"1px dashed rgba(255,255,255,0.03)"},children:[a.jsx("span",{style:{fontSize:"13px",lineHeight:1},children:ST[K.id]}),a.jsx("span",{className:"hidden lg:inline",children:K.label}),et&&a.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-px",style:{background:dt+"55"}})]},K.id)})}),L&&a.jsxs("button",{onClick:L,title:q?"Admin Mode (ativado)":"Admin Mode (senha)",className:"flex items-center gap-1 px-3 py-2 transition-all shrink-0",style:{borderLeft:"1px dashed rgba(255,255,255,0.06)",background:q?"rgba(245,158,11,0.10)":"transparent",color:q?"#f59e0b":"rgba(255,255,255,0.25)",fontFamily:Za,fontSize:"9px",fontWeight:300,letterSpacing:"1px",textTransform:"uppercase"},children:[a.jsx(V9,{size:10,strokeWidth:1.5}),a.jsx("span",{className:"hidden sm:inline",children:"ADMIN"})]}),Ae&&a.jsxs("button",{onClick:Ae,title:_==="3D"?"Voltar para 2D":"Modo 3D",className:"flex items-center gap-1 px-3 py-2 transition-all shrink-0",style:{borderLeft:"1px dashed rgba(255,255,255,0.06)",background:_==="3D"?"rgba(139,92,246,0.06)":"transparent",color:_==="3D"?"#a78bfa":"rgba(255,255,255,0.25)",fontFamily:Za,fontSize:"9px",fontWeight:300,letterSpacing:"1px",textTransform:"uppercase"},children:[a.jsx(Y5,{size:10,strokeWidth:1.5}),"3D"]})]}),R!=="psycheLab"&&R!=="musicLab"&&R!=="alchemyLab"&&R!=="metaArtLab"&&R!=="rhizomeLab"&&R!=="asimovTheater"&&R!=="languageLab"&&R!=="treeOfLife"&&R!=="physicsSandbox"&&R!=="milPlatos"&&a.jsxs("div",{className:"flex items-center justify-between px-3 py-1.5 gap-2 pointer-events-auto",style:{background:"rgba(0,0,0,0.92)",borderBottom:"1px dashed rgba(255,255,255,0.06)"},children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("button",{onClick:H,className:"p-1.5 transition-all",title:e?"Pausar":"Reproduzir","data-guide":"play-button",style:{color:e?J:"rgba(255,255,255,0.7)",background:e?`${J}10`:"transparent",border:e?`1px dashed ${J}30`:"1px dashed transparent"},children:e?a.jsx(s0,{size:12,strokeWidth:1.5}):a.jsx(wl,{size:12,strokeWidth:1.5})}),a.jsx("div",{className:"w-px h-3",style:{borderLeft:"1px dashed rgba(255,255,255,0.12)"}}),a.jsx("div",{"data-guide":"speed-control",children:a.jsx("select",{value:t,onChange:K=>oe(Number(K.target.value)),className:"cursor-pointer transition-colors focus:outline-none",style:{fontFamily:Za,fontSize:"10px",fontWeight:300,color:"rgba(255,255,255,0.7)",background:"rgba(255,255,255,0.04)",border:"1px dashed rgba(255,255,255,0.08)",padding:"2px 4px"},children:[1,2,3,4,5,6,7,8,9,10].map(K=>a.jsxs("option",{value:K,style:{background:"#000",color:"#fff"},children:[K,"x"]},K))})}),a.jsx("div",{className:"w-px h-3",style:{borderLeft:"1px dashed rgba(255,255,255,0.12)"}}),a.jsx("button",{onClick:le,className:"p-1.5 transition-colors",title:"Reiniciar",style:{color:"rgba(255,255,255,0.45)"},children:a.jsx(Wi,{size:11,strokeWidth:1.5})}),a.jsx("button",{onClick:F,className:"p-1.5 transition-colors disabled:opacity-20",title:"Desfazer",disabled:!i,style:{color:"rgba(255,255,255,0.45)"},children:a.jsx(oT,{size:11,strokeWidth:1.5})}),R==="complexityLife"&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-px h-3",style:{borderLeft:"1px dashed rgba(255,255,255,0.12)"}}),a.jsxs("button",{onClick:ce,className:"flex items-center gap-1 p-1.5 transition-all",title:"Campo de Energia",style:{color:s?"#ffaa44":"rgba(255,255,255,0.30)",background:s?"rgba(255,170,68,0.06)":"transparent",border:s?"1px dashed rgba(255,170,68,0.25)":"1px dashed transparent",fontFamily:Za,fontSize:"9px",fontWeight:200,letterSpacing:"0.5px",textTransform:"uppercase"},children:[a.jsx(mh,{size:10,strokeWidth:1.5}),a.jsx("span",{className:"hidden sm:inline",children:"CAMPO"})]}),s&&te&&a.jsx("div",{className:"flex items-center gap-0.5",children:bT.map(K=>a.jsx("button",{onClick:()=>te(K.id),title:K.title,className:"w-5 h-5 transition-all flex items-center justify-center",style:{fontSize:"8px",fontFamily:Za,fontWeight:l===K.id?400:200,color:l===K.id?K.color:"rgba(255,255,255,0.25)",background:l===K.id?`${K.color}0c`:"transparent",border:l===K.id?`1px dashed ${K.color}35`:"1px dashed transparent"},children:K.label},K.id))})]}),Q&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-px h-3",style:{borderLeft:"1px dashed rgba(255,255,255,0.12)"}}),a.jsx("button",{onClick:Q,className:"p-1.5 transition-colors",title:"Tour Guiado","data-guide-button":!0,style:{color:"#ffd400"},children:a.jsx(Rp,{size:11,strokeWidth:1.5})})]}),ae&&a.jsxs("button",{onClick:ae,className:"relative p-1.5 transition-colors",title:"Conquistas",style:{color:"#ffd400"},children:[a.jsx(Ax,{size:11,strokeWidth:1.5}),y>0&&a.jsx("div",{className:"absolute -top-0.5 -right-0.5 w-3 h-3 flex items-center justify-center",style:{background:"#ffd400"},children:a.jsx("span",{style:{fontSize:"7px",fontWeight:600,color:"#000"},children:y>9?"9+":y})})]}),we&&a.jsx("button",{onClick:we,className:"p-1.5 transition-colors",title:"World Log",style:{color:"#37b2da"},children:a.jsx(A9,{size:11,strokeWidth:1.5})}),Re&&a.jsx("button",{onClick:Re,className:"p-1.5 transition-colors",title:"Chronicle",style:{color:"#8b5cf6"},children:a.jsx(AC,{size:11,strokeWidth:1.5})}),ge&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-px h-3",style:{borderLeft:"1px dashed rgba(255,255,255,0.12)"}}),a.jsx("button",{onClick:ge,className:"p-1.5 transition-colors",title:"Modo Cinematico (H)",style:{color:j?"#37b2da":"rgba(255,255,255,0.30)"},children:j?a.jsx(Ag,{size:11,strokeWidth:1.5}):a.jsx(vl,{size:11,strokeWidth:1.5})})]})]}),a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx("span",{style:{fontFamily:Za,fontSize:"9px",fontWeight:300,color:"rgba(255,255,255,0.4)"},children:r}),(v!==void 0||b!==void 0)&&a.jsxs(a.Fragment,{children:[a.jsx("span",{style:{color:"rgba(255,255,255,0.15)"},children:"/"}),a.jsxs("span",{style:{fontFamily:Za,fontSize:"9px",fontWeight:200,color:"rgba(255,255,255,0.3)"},children:[((ke=v==null?void 0:v.toFixed)==null?void 0:ke.call(v,1))??"-","+",((Le=b==null?void 0:b.toFixed)==null?void 0:Le.call(b,1))??"-","ms"]})]}),m&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-px h-3",style:{borderLeft:"1px dashed rgba(255,255,255,0.08)"}}),a.jsx("span",{style:{fontFamily:Za,fontSize:"9px",fontWeight:200,color:"rgba(255,255,255,0.25)",textTransform:"uppercase",letterSpacing:"0.5px"},children:m})]}),a.jsx("div",{className:"w-px h-3",style:{borderLeft:"1px dashed rgba(255,255,255,0.08)"}}),a.jsxs("span",{style:{fontFamily:Za,fontSize:"9px",fontWeight:300,color:"rgba(255,255,255,0.5)"},children:[u,a.jsx("span",{style:{color:"rgba(255,255,255,0.2)",margin:"0 2px"},children:"/"}),a.jsx("span",{style:{color:J},children:c})]}),a.jsx("div",{className:"w-px h-3",style:{borderLeft:"1px dashed rgba(255,255,255,0.08)"}}),a.jsx("span",{style:{fontFamily:Za,fontSize:"9px",fontWeight:300,color:J,textTransform:"uppercase",letterSpacing:"1px"},children:h}),k&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-px h-3",style:{borderLeft:"1px dashed rgba(255,255,255,0.08)"}}),a.jsx("span",{style:{fontFamily:Za,fontSize:"9px",fontWeight:200,color:"#37b2da",fontStyle:"italic"},children:k})]}),f>0&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-px h-3",style:{borderLeft:"1px dashed rgba(255,255,255,0.08)"}}),a.jsxs("span",{style:{fontFamily:Za,fontSize:"9px",fontWeight:300,color:"rgba(255,255,255,0.5)"},children:["CIRCULAR ",Math.round(f*100),"%"]})]}),T&&R==="sociogenesis"&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-px h-3",style:{borderLeft:"1px dashed rgba(255,255,255,0.08)"}}),a.jsxs("span",{style:{fontFamily:Za,fontSize:"9px",fontWeight:300},children:[a.jsxs("span",{style:{color:"#37b2da"},children:["T",T.totems]})," ",a.jsxs("span",{style:{color:"#ff4444"},children:["X",T.taboos]})," ",a.jsxs("span",{style:{color:"#8b5cf6"},children:["R",T.rituals]}),T.tribes>0&&a.jsxs(a.Fragment,{children:[" ",a.jsxs("span",{style:{color:"#10d45b"},children:["G",T.tribes]})]})]})]})]})]})]})},Nf=[{id:"crystal_lattice",name:"Crystal Lattice",description:"Grades peridicas cristalizam. Alta coeso, entropia zero.",category:"stable",tags:["crystal","stable","grid"],seed:7777,particleCount:600,typesCount:3,micro:{force:.65,drag:2.4,entropy:0,rmax:.26,beta:.48,coreRepel:1.2,speedClamp:.05},field:{diffusionRate:.55,decayRate:.008},reconfig:{detectionInterval:6},matrix:{style:"harmonic"}},{id:"orbital_dance",name:"Orbital Dance",description:"Clusters orbitam em ciclos estveis. Dependncia circular cria rbitas.",category:"stable",tags:["orbit","cyclic","rotation"],seed:3141,particleCount:500,typesCount:4,micro:{force:1.15,drag:1.45,entropy:.04,rmax:.19,circularDependency:.65,speedClamp:.12},field:{diffusionRate:.68,decayRate:.014},reconfig:{detectionInterval:4.5},matrix:{style:"ring"}},{id:"membrane_world",name:"Membrane World",description:"Cascas celulares ocas colidem e fundem. Padro biolgico emergente.",category:"stable",tags:["membrane","shells","cell-like"],seed:2718,particleCount:550,typesCount:4,micro:{force:.85,drag:1.9,entropy:.02,rmax:.21,beta:.42,coreRepel:.95},field:{diffusionRate:.62,decayRate:.011},reconfig:{detectionInterval:5},matrix:{style:"mitosis"}},{id:"predator_wave",name:"Predator Wave",description:"Ondas ecolgicas: populaes oscilam em ciclos Lotka-Volterra.",category:"living",tags:["predator","prey","ecology","cycles"],seed:2002,particleCount:700,typesCount:4,micro:{force:1.45,drag:1.05,entropy:.09,rmax:.2,foodEnabled:!0,foodRatio:.22},field:{diffusionRate:.78,decayRate:.02},reconfig:{detectionInterval:3.5},matrix:{style:"predator"}},{id:"cell_division",name:"Cell Division",description:"Clulas com energia reproduzem por diviso. Observe a populao crescer.",category:"living",tags:["mitosis","energy","reproduction","growth"],seed:2001,particleCount:200,typesCount:3,micro:{force:.95,drag:1.5,entropy:.02,rmax:.16,energyEnabled:!0,energyDecay:8e-4,energyFeedRate:.1,energyReproThreshold:1.6},field:{diffusionRate:.58,decayRate:.018},reconfig:{detectionInterval:3},matrix:{style:"mitosis"}},{id:"symbiotic_web",name:"Symbiotic Web",description:"Espcies co-dependentes tecem redes de cooperao mtua.",category:"living",tags:["symbiosis","cooperation","clusters"],seed:2003,particleCount:600,typesCount:5,micro:{force:1.05,drag:1.65,entropy:.03,rmax:.24,beta:.36},field:{diffusionRate:.66,decayRate:.013},reconfig:{detectionInterval:4.5},matrix:{style:"symbiotic"}},{id:"spiral_galaxy",name:"Spiral Galaxy",description:"Braos espirais giram como uma galxia. Dependncia circular mxima.",category:"wild",tags:["spiral","galaxy","rotation"],seed:9001,particleCount:800,typesCount:5,micro:{force:1.25,drag:1.2,entropy:.06,rmax:.22,circularDependency:.72},field:{diffusionRate:.74,decayRate:.016},reconfig:{detectionInterval:4},matrix:{style:"cyclic"}},{id:"reaction_diffusion",name:"Reaction Diffusion",description:"Padres de Turing: ondas, manchas e listras auto-organizam.",category:"wild",tags:["turing","patterns","waves"],seed:1618,particleCount:750,typesCount:2,micro:{force:1.8,drag:.85,entropy:.28,rmax:.14,beta:.25,speedClamp:.18},field:{diffusionRate:.92,decayRate:.03},reconfig:{detectionInterval:3},matrix:{style:"sparse"}}],th=[...Nf,{id:"pollock",name:"Pollock Drip",description:"Chaotic splatter patterns, high entropy expressionism",seed:1001,particleCount:800,typesCount:6,micro:{force:2,drag:.8,entropy:.25,rmax:.18,speedClamp:.15},field:{diffusionRate:.85,decayRate:.02},reconfig:{detectionInterval:4},matrix:{style:"chaotic"}},{id:"kandinsky",name:"Kandinsky Circles",description:"Geometric balance, harmonic color orbits",seed:1002,particleCount:600,typesCount:5,micro:{force:1.2,drag:1.5,entropy:.05,rmax:.25,beta:.4,coreRepel:.8},field:{diffusionRate:.7,decayRate:.015},reconfig:{detectionInterval:5},matrix:{style:"harmonic"}},{id:"mondrian",name:"Mondrian Grid",description:"Orthogonal structure, minimal palette",seed:1003,particleCount:400,typesCount:3,micro:{force:.8,drag:2,entropy:0,rmax:.3,beta:.5},field:{diffusionRate:.5,decayRate:.01},reconfig:{detectionInterval:6},matrix:{style:"harmonic"}},{id:"miro",name:"Mir Dream",description:"Surreal slow drift, biomorphic shapes",seed:1004,particleCount:500,typesCount:4,micro:{force:.6,drag:1.8,entropy:.1,rmax:.22,circularDependency:.3},field:{diffusionRate:.9,decayRate:.005},reconfig:{detectionInterval:5.5},matrix:{style:"symbiotic"}},{id:"rothko",name:"Rothko Fields",description:"Color field meditation, soft boundaries",seed:1005,particleCount:350,typesCount:3,micro:{force:.4,drag:2.2,entropy:.02,rmax:.35,beta:.3},field:{diffusionRate:.95,decayRate:.004},reconfig:{detectionInterval:7},matrix:{style:"harmonic"}},{id:"klee",name:"Klee Mosaic",description:"Tiled patterns, playful geometry",seed:1006,particleCount:550,typesCount:7,micro:{force:1,drag:1.6,entropy:.08,rmax:.2,beta:.4},field:{diffusionRate:.72,decayRate:.016},reconfig:{detectionInterval:4.8},matrix:{style:"block"}},{id:"malevich",name:"Malevich Supremacy",description:"Pure geometric abstraction, minimal forms",seed:1007,particleCount:300,typesCount:2,micro:{force:.7,drag:2.1,entropy:0,rmax:.28,beta:.5},field:{diffusionRate:.55,decayRate:.008},reconfig:{detectionInterval:8},matrix:{style:"harmonic"}},{id:"dekooning",name:"De Kooning Gesture",description:"Violent brush strokes, abstract expressionism",seed:1008,particleCount:750,typesCount:5,micro:{force:2.3,drag:.85,entropy:.22,rmax:.16,speedClamp:.14},field:{diffusionRate:.88,decayRate:.028},reconfig:{detectionInterval:3.5},matrix:{style:"chaotic"}},{id:"mitosis",name:"Mitosis",description:"Cell division cascade, exponential growth",seed:2001,particleCount:200,typesCount:3,micro:{force:1,drag:1.4,entropy:.02,rmax:.15,energyEnabled:!0,energyDecay:.001,energyFeedRate:.08,energyReproThreshold:1.8},field:{diffusionRate:.6,decayRate:.02},reconfig:{detectionInterval:3},matrix:{style:"mitosis"}},{id:"predator_prey",name:"Predator-Prey",description:"Ecological cycles, population waves",seed:2002,particleCount:700,typesCount:4,micro:{force:1.5,drag:1.1,entropy:.08,rmax:.2,foodEnabled:!0,foodRatio:.2},field:{diffusionRate:.75,decayRate:.018},reconfig:{detectionInterval:3.5},matrix:{style:"predator"}},{id:"symbiosis",name:"Symbiosis",description:"Mutual cooperation, stable clusters",seed:2003,particleCount:600,typesCount:5,micro:{force:1.1,drag:1.6,entropy:.03,rmax:.24,beta:.35},field:{diffusionRate:.65,decayRate:.012},reconfig:{detectionInterval:4.5},matrix:{style:"symbiotic"}},{id:"parasitism",name:"Parasitism",description:"One-sided exploitation, chase dynamics",seed:2004,particleCount:800,typesCount:6,micro:{force:1.8,drag:.9,entropy:.12,rmax:.19,circularDependency:.5},field:{diffusionRate:.8,decayRate:.025},reconfig:{detectionInterval:3},matrix:{style:"predator"}},{id:"coral_reef",name:"Coral Reef",description:"Sessile organisms, branching structures",seed:2005,particleCount:650,typesCount:6,micro:{force:.9,drag:2,entropy:.04,rmax:.22,beta:.4},field:{diffusionRate:.68,decayRate:.01},reconfig:{detectionInterval:5.2},matrix:{style:"symbiotic"}},{id:"mycelium",name:"Mycelium Network",description:"Fungal threads, underground intelligence",seed:2006,particleCount:900,typesCount:4,micro:{force:.7,drag:1.8,entropy:.06,rmax:.28,circularDependency:.2},field:{diffusionRate:.82,decayRate:.009},reconfig:{detectionInterval:4.8},matrix:{style:"sparse"}},{id:"slime_mold",name:"Slime Mold",description:"Collective intelligence, path optimization",seed:2007,particleCount:750,typesCount:3,micro:{force:1.2,drag:1.3,entropy:.07,rmax:.25,beta:.3},field:{diffusionRate:.78,decayRate:.014},reconfig:{detectionInterval:4.2},matrix:{style:"symbiotic"}},{id:"bacteria",name:"Bacterial Colony",description:"Rapid reproduction, biofilm formation",seed:2008,particleCount:1e3,typesCount:5,micro:{force:1.3,drag:1,entropy:.1,rmax:.18,energyEnabled:!0,energyDecay:.002,energyFeedRate:.1,energyReproThreshold:1.5},field:{diffusionRate:.85,decayRate:.022},reconfig:{detectionInterval:2.8},matrix:{style:"mitosis"}},{id:"virus",name:"Viral Outbreak",description:"Infection spread, exponential cascade",seed:2009,particleCount:500,typesCount:4,micro:{force:2,drag:.8,entropy:.15,rmax:.2,speedClamp:.16},field:{diffusionRate:.9,decayRate:.03},reconfig:{detectionInterval:2.5},matrix:{style:"predator"}},{id:"immune",name:"Immune Response",description:"White cells hunting pathogens",seed:2010,particleCount:800,typesCount:6,micro:{force:1.7,drag:1.1,entropy:.09,rmax:.21},field:{diffusionRate:.76,decayRate:.02},reconfig:{detectionInterval:3.3},matrix:{style:"predator"}},{id:"nebula",name:"Nebula",description:"Gas cloud swirls, slow gravitational dance",seed:3001,particleCount:1e3,typesCount:4,micro:{force:.5,drag:2.5,entropy:.15,rmax:.35,beta:.2,coreRepel:.3},field:{diffusionRate:.95,decayRate:.003},reconfig:{detectionInterval:6},matrix:{style:"harmonic"}},{id:"supernova",name:"Supernova",description:"Explosive expansion, shock waves",seed:3002,particleCount:600,typesCount:5,micro:{force:3,drag:.6,entropy:.3,rmax:.12,speedClamp:.2},field:{diffusionRate:.92,decayRate:.04},reconfig:{detectionInterval:2.5},matrix:{style:"chaotic"}},{id:"black_hole",name:"Black Hole",description:"Gravitational collapse, accretion disk",seed:3003,particleCount:700,typesCount:3,micro:{force:2.5,drag:1,entropy:.05,rmax:.28,beta:.1,coreRepel:2},field:{diffusionRate:.6,decayRate:.008},reconfig:{detectionInterval:4},matrix:{style:"cyclic"}},{id:"galaxy",name:"Galaxy Spiral",description:"Rotating arms, orbital mechanics",seed:3004,particleCount:900,typesCount:6,micro:{force:1.3,drag:1.4,entropy:.07,rmax:.26,circularDependency:.7},field:{diffusionRate:.7,decayRate:.01},reconfig:{detectionInterval:5},matrix:{style:"cyclic"}},{id:"pulsar",name:"Pulsar Beacon",description:"Rhythmic pulses, radio waves",seed:3005,particleCount:450,typesCount:3,micro:{force:1.8,drag:1.2,entropy:.12,rmax:.24,beta:.5},field:{diffusionRate:.88,decayRate:.025},reconfig:{detectionInterval:3.2},matrix:{style:"ring"}},{id:"quasar",name:"Quasar Jet",description:"High-energy beams, relativistic speeds",seed:3006,particleCount:550,typesCount:4,micro:{force:2.8,drag:.7,entropy:.2,rmax:.15,speedClamp:.18},field:{diffusionRate:.9,decayRate:.035},reconfig:{detectionInterval:2.8},matrix:{style:"chaotic"}},{id:"asteroid",name:"Asteroid Belt",description:"Orbital debris, collision dynamics",seed:3007,particleCount:800,typesCount:5,micro:{force:1.1,drag:1.5,entropy:.11,rmax:.23},field:{diffusionRate:.73,decayRate:.015},reconfig:{detectionInterval:4.5},matrix:{style:"sparse"}},{id:"comet",name:"Comet Tail",description:"Solar wind trails, ice sublimation",seed:3008,particleCount:650,typesCount:4,micro:{force:1.6,drag:1,entropy:.16,rmax:.2,speedClamp:.12},field:{diffusionRate:.86,decayRate:.027},reconfig:{detectionInterval:3.6},matrix:{style:"chaotic"}},{id:"revolution",name:"Revolution",description:"Uprising waves, regime change cycles",seed:4001,particleCount:800,typesCount:5,micro:{force:2.2,drag:.85,entropy:.18,rmax:.17,speedClamp:.12},field:{diffusionRate:.88,decayRate:.03},reconfig:{detectionInterval:2.8,speciationThreshold:.6},matrix:{style:"chaotic"}},{id:"harmony",name:"Harmony",description:"Peaceful coexistence, balanced equilibrium",seed:4002,particleCount:600,typesCount:4,micro:{force:.9,drag:1.7,entropy:.01,rmax:.27,beta:.4},field:{diffusionRate:.65,decayRate:.01},reconfig:{detectionInterval:6},matrix:{style:"harmonic"}},{id:"market",name:"Market Chaos",description:"Economic fluctuations, boom-bust cycles",seed:4003,particleCount:750,typesCount:6,micro:{force:1.6,drag:1,entropy:.14,rmax:.21},field:{diffusionRate:.78,decayRate:.022},reconfig:{detectionInterval:3.2},matrix:{style:"chaotic"}},{id:"tribe",name:"Tribal Clusters",description:"Group formation, territorial boundaries",seed:4004,particleCount:700,typesCount:5,micro:{force:1.4,drag:1.3,entropy:.06,rmax:.23,beta:.35,coreRepel:1.2},field:{diffusionRate:.68,decayRate:.015},reconfig:{detectionInterval:4.5},matrix:{style:"symbiotic"}},{id:"propaganda",name:"Propaganda Spread",description:"Information cascade, viral memes",seed:4005,particleCount:850,typesCount:4,micro:{force:1.9,drag:.9,entropy:.17,rmax:.19},field:{diffusionRate:.91,decayRate:.032},reconfig:{detectionInterval:2.9},matrix:{style:"predator"}},{id:"migration",name:"Migration",description:"Mass movement, cultural diffusion",seed:4006,particleCount:700,typesCount:5,micro:{force:1.3,drag:1.2,entropy:.1,rmax:.22},field:{diffusionRate:.8,decayRate:.019},reconfig:{detectionInterval:3.8},matrix:{style:"chaotic"}},{id:"quantum",name:"Quantum Foam",description:"Uncertainty principle, probabilistic motion",seed:5001,particleCount:500,typesCount:7,micro:{force:1,drag:1.2,entropy:.35,rmax:.16,speedClamp:.08},field:{diffusionRate:.92,decayRate:.035},reconfig:{detectionInterval:2.5},matrix:{style:"chaotic"}},{id:"plasma",name:"Plasma Storm",description:"Ionized gas, electromagnetic chaos",seed:5002,particleCount:900,typesCount:6,micro:{force:2.1,drag:.8,entropy:.23,rmax:.17,speedClamp:.14},field:{diffusionRate:.89,decayRate:.029},reconfig:{detectionInterval:3},matrix:{style:"chaotic"}},{id:"superconductor",name:"Superconductor",description:"Zero resistance, perfect flow",seed:5003,particleCount:550,typesCount:3,micro:{force:1.5,drag:.1,entropy:0,rmax:.26,beta:.5},field:{diffusionRate:.98,decayRate:.001},reconfig:{detectionInterval:7},matrix:{style:"harmonic"}},{id:"ferrofluid",name:"Ferrofluid",description:"Magnetic liquid, spike formations",seed:5004,particleCount:650,typesCount:4,micro:{force:1.4,drag:1.4,entropy:.08,rmax:.21,coreRepel:1.5},field:{diffusionRate:.7,decayRate:.013},reconfig:{detectionInterval:4},matrix:{style:"block"}},{id:"crystal",name:"Crystal Growth",description:"Lattice formation, periodic structure",seed:5005,particleCount:700,typesCount:5,micro:{force:1,drag:1.9,entropy:.02,rmax:.24,beta:.45},field:{diffusionRate:.62,decayRate:.008},reconfig:{detectionInterval:5.5},matrix:{style:"harmonic"}},{id:"turbulence",name:"Turbulence",description:"Chaotic fluid flow, vortex cascade",seed:5006,particleCount:850,typesCount:6,micro:{force:1.8,drag:.95,entropy:.2,rmax:.19,circularDependency:.6},field:{diffusionRate:.87,decayRate:.026},reconfig:{detectionInterval:3.1},matrix:{style:"chaotic"}},{id:"bose_einstein",name:"Bose-Einstein",description:"Quantum condensate, collective state",seed:5007,particleCount:400,typesCount:2,micro:{force:.6,drag:2.3,entropy:0,rmax:.32,beta:.5},field:{diffusionRate:.97,decayRate:.002},reconfig:{detectionInterval:8},matrix:{style:"harmonic"}},{id:"sonoluminescence",name:"Sonoluminescence",description:"Sound-to-light, bubble collapse",seed:5008,particleCount:550,typesCount:4,micro:{force:2.4,drag:1.1,entropy:.13,rmax:.18,coreRepel:1.8},field:{diffusionRate:.84,decayRate:.024},reconfig:{detectionInterval:3.4},matrix:{style:"ring"}},{id:"fractal",name:"Fractal Bloom",description:"Self-similar patterns, recursive emergence",seed:6001,particleCount:650,typesCount:5,micro:{force:1.1,drag:1.5,entropy:.04,rmax:.2,beta:.3},field:{diffusionRate:.72,decayRate:.012},reconfig:{detectionInterval:4,speciationThreshold:.7},matrix:{style:"cyclic"}},{id:"neural",name:"Neural Net",description:"Synaptic connections, learning dynamics",seed:6002,particleCount:800,typesCount:6,micro:{force:1.3,drag:1.1,entropy:.09,rmax:.24,circularDependency:.4},field:{diffusionRate:.75,decayRate:.018},reconfig:{detectionInterval:3.5},matrix:{style:"cyclic"}},{id:"emergence",name:"Pure Emergence",description:"Minimal rules, maximum complexity",seed:6003,particleCount:700,typesCount:4,micro:{force:1.4,drag:1.2,entropy:.11,rmax:.22},field:{diffusionRate:.8,decayRate:.02},reconfig:{detectionInterval:3.8},matrix:{style:"symbiotic"}},{id:"swarm",name:"Swarm Intelligence",description:"Collective behavior, stigmergy",seed:6004,particleCount:950,typesCount:5,micro:{force:1.2,drag:1.3,entropy:.1,rmax:.21,circularDependency:.3},field:{diffusionRate:.77,decayRate:.017},reconfig:{detectionInterval:3.9},matrix:{style:"symbiotic"}},{id:"autopilot",name:"Autopilot",description:"Self-organization, spontaneous order",seed:6005,particleCount:600,typesCount:4,micro:{force:1.1,drag:1.4,entropy:.06,rmax:.23,beta:.35},field:{diffusionRate:.7,decayRate:.014},reconfig:{detectionInterval:4.3},matrix:{style:"harmonic"}},{id:"cascade",name:"Cascade",description:"Chain reactions, avalanche dynamics",seed:6006,particleCount:750,typesCount:6,micro:{force:1.9,drag:.95,entropy:.16,rmax:.2},field:{diffusionRate:.85,decayRate:.028},reconfig:{detectionInterval:2.9},matrix:{style:"predator"}},{id:"attractor",name:"Strange Attractor",description:"Chaotic orbits, sensitive dependence",seed:6007,particleCount:550,typesCount:5,micro:{force:1.5,drag:1.1,entropy:.19,rmax:.22,circularDependency:.8},field:{diffusionRate:.82,decayRate:.021},reconfig:{detectionInterval:3.3},matrix:{style:"chaotic"}},{id:"percolation",name:"Percolation",description:"Threshold transition, critical point",seed:6008,particleCount:650,typesCount:4,micro:{force:1.2,drag:1.4,entropy:.12,rmax:.25},field:{diffusionRate:.75,decayRate:.019},reconfig:{detectionInterval:3.7},matrix:{style:"sparse"}},{id:"resonance",name:"Resonance",description:"Harmonic coupling, synchronized oscillation",seed:6009,particleCount:600,typesCount:5,micro:{force:1.1,drag:1.5,entropy:.05,rmax:.24,beta:.4},field:{diffusionRate:.71,decayRate:.013},reconfig:{detectionInterval:4.6},matrix:{style:"harmonic"}},{id:"bifurcation",name:"Bifurcation",description:"Period doubling, route to chaos",seed:6010,particleCount:700,typesCount:6,micro:{force:1.6,drag:1,entropy:.14,rmax:.21},field:{diffusionRate:.79,decayRate:.023},reconfig:{detectionInterval:3.4},matrix:{style:"chaotic"}},{id:"aurora",name:"Aurora Borealis",description:"Magnetic curtains, solar wind dance",seed:7001,particleCount:750,typesCount:5,micro:{force:1.4,drag:1.6,entropy:.11,rmax:.23,beta:.35},field:{diffusionRate:.88,decayRate:.016},reconfig:{detectionInterval:4.2},matrix:{style:"harmonic"}},{id:"volcano",name:"Volcanic Eruption",description:"Magma plumes, pyroclastic flow",seed:7002,particleCount:850,typesCount:6,micro:{force:2.1,drag:.9,entropy:.18,rmax:.19,speedClamp:.15},field:{diffusionRate:.83,decayRate:.026},reconfig:{detectionInterval:3.1},matrix:{style:"chaotic"}},{id:"tornado",name:"Tornado Vortex",description:"Spiral winds, destructive rotation",seed:7003,particleCount:700,typesCount:4,micro:{force:1.8,drag:1,entropy:.13,rmax:.21,circularDependency:.9},field:{diffusionRate:.81,decayRate:.023},reconfig:{detectionInterval:3.4},matrix:{style:"cyclic"}},{id:"tsunami",name:"Tsunami Wave",description:"Tidal surge, underwater earthquake",seed:7004,particleCount:900,typesCount:5,micro:{force:1.6,drag:1.3,entropy:.14,rmax:.22},field:{diffusionRate:.86,decayRate:.021},reconfig:{detectionInterval:3.6},matrix:{style:"chaotic"}},{id:"lightning",name:"Lightning Storm",description:"Electric discharge, fractal branching",seed:7005,particleCount:600,typesCount:4,micro:{force:2.3,drag:.8,entropy:.21,rmax:.17,speedClamp:.17},field:{diffusionRate:.91,decayRate:.031},reconfig:{detectionInterval:2.7},matrix:{style:"sparse"}},{id:"earthquake",name:"Earthquake",description:"Tectonic shift, seismic waves",seed:7006,particleCount:800,typesCount:5,micro:{force:1.9,drag:1.1,entropy:.16,rmax:.2},field:{diffusionRate:.79,decayRate:.024},reconfig:{detectionInterval:3.3},matrix:{style:"chaotic"}},{id:"sandstorm",name:"Sandstorm",description:"Desert winds, dust devils",seed:7007,particleCount:950,typesCount:6,micro:{force:1.5,drag:1.2,entropy:.19,rmax:.21},field:{diffusionRate:.87,decayRate:.027},reconfig:{detectionInterval:3.2},matrix:{style:"chaotic"}},{id:"avalanche",name:"Avalanche",description:"Snow cascade, critical slope",seed:7008,particleCount:750,typesCount:4,micro:{force:1.7,drag:1,entropy:.15,rmax:.22},field:{diffusionRate:.82,decayRate:.025},reconfig:{detectionInterval:3.1},matrix:{style:"predator"}},{id:"geyser",name:"Geyser",description:"Periodic eruption, hydrothermal pressure",seed:7009,particleCount:550,typesCount:3,micro:{force:2.2,drag:1,entropy:.12,rmax:.19,coreRepel:1.6},field:{diffusionRate:.84,decayRate:.022},reconfig:{detectionInterval:3.5},matrix:{style:"ring"}},{id:"wildfire",name:"Wildfire",description:"Forest blaze, exponential spread",seed:7010,particleCount:850,typesCount:5,micro:{force:1.8,drag:.95,entropy:.17,rmax:.2},field:{diffusionRate:.89,decayRate:.029},reconfig:{detectionInterval:2.9},matrix:{style:"predator"}},{id:"symphony",name:"Symphony",description:"Orchestral harmony, multi-voice counterpoint",seed:8001,particleCount:800,typesCount:7,micro:{force:1.1,drag:1.6,entropy:.04,rmax:.25,beta:.42},field:{diffusionRate:.72,decayRate:.011},reconfig:{detectionInterval:5},matrix:{style:"harmonic"}},{id:"jazz",name:"Jazz Improvisation",description:"Syncopated rhythms, spontaneous creation",seed:8002,particleCount:650,typesCount:5,micro:{force:1.4,drag:1.2,entropy:.14,rmax:.22,circularDependency:.5},field:{diffusionRate:.8,decayRate:.02},reconfig:{detectionInterval:3.7},matrix:{style:"chaotic"}},{id:"techno",name:"Techno Pulse",description:"Repetitive beats, hypnotic loops",seed:8003,particleCount:700,typesCount:4,micro:{force:1.3,drag:1.3,entropy:.08,rmax:.23,beta:.38},field:{diffusionRate:.74,decayRate:.017},reconfig:{detectionInterval:4.1},matrix:{style:"cyclic"}},{id:"ambient",name:"Ambient Drift",description:"Atmospheric textures, slow evolution",seed:8004,particleCount:500,typesCount:3,micro:{force:.7,drag:2.1,entropy:.06,rmax:.29,beta:.3},field:{diffusionRate:.93,decayRate:.006},reconfig:{detectionInterval:6.5},matrix:{style:"harmonic"}},{id:"drum_circle",name:"Drum Circle",description:"Polyrhythms, tribal synchronization",seed:8005,particleCount:750,typesCount:6,micro:{force:1.5,drag:1.1,entropy:.1,rmax:.21},field:{diffusionRate:.77,decayRate:.019},reconfig:{detectionInterval:3.8},matrix:{style:"ring"}},{id:"glitch",name:"Glitch",description:"Digital artifacts, broken transmission",seed:8006,particleCount:600,typesCount:5,micro:{force:1.6,drag:1,entropy:.26,rmax:.18,speedClamp:.11},field:{diffusionRate:.85,decayRate:.028},reconfig:{detectionInterval:2.8},matrix:{style:"chaotic"}},{id:"dubstep",name:"Dubstep Drop",description:"Bass wobbles, half-time breaks",seed:8007,particleCount:700,typesCount:5,micro:{force:1.9,drag:.95,entropy:.15,rmax:.2,coreRepel:1.3},field:{diffusionRate:.83,decayRate:.024},reconfig:{detectionInterval:3.3},matrix:{style:"block"}},{id:"choir",name:"Choir",description:"Vocal harmonics, layered voices",seed:8008,particleCount:650,typesCount:6,micro:{force:1,drag:1.7,entropy:.03,rmax:.26,beta:.45},field:{diffusionRate:.68,decayRate:.012},reconfig:{detectionInterval:5.2},matrix:{style:"harmonic"}},{id:"metal",name:"Metal Blast",description:"Distorted power, aggressive energy",seed:8009,particleCount:800,typesCount:6,micro:{force:2,drag:.85,entropy:.2,rmax:.18,speedClamp:.13},field:{diffusionRate:.86,decayRate:.027},reconfig:{detectionInterval:3},matrix:{style:"chaotic"}},{id:"binaural",name:"Binaural Beats",description:"Phase interference, brain entrainment",seed:8010,particleCount:550,typesCount:4,micro:{force:1.2,drag:1.5,entropy:.07,rmax:.24,beta:.4},field:{diffusionRate:.75,decayRate:.014},reconfig:{detectionInterval:4.4},matrix:{style:"harmonic"}},{id:"hilma_af_klint",name:"Hilma af Klint",description:"Spiritual geometry, theosophical abstraction",seed:9001,particleCount:650,typesCount:5,micro:{force:1,drag:1.7,entropy:.03,rmax:.26,beta:.42,circularDependency:.4},field:{diffusionRate:.68,decayRate:.009},reconfig:{detectionInterval:5.5},matrix:{style:"harmonic"}},{id:"agnes_martin",name:"Agnes Martin",description:"Minimal grids, meditative repetition",seed:9002,particleCount:400,typesCount:3,micro:{force:.65,drag:2.2,entropy:.01,rmax:.3,beta:.5},field:{diffusionRate:.55,decayRate:.006},reconfig:{detectionInterval:7.5},matrix:{style:"harmonic"}},{id:"cy_twombly",name:"Cy Twombly",description:"Calligraphic gestures, scratched surfaces",seed:9003,particleCount:700,typesCount:6,micro:{force:1.6,drag:1,entropy:.18,rmax:.19,speedClamp:.13},field:{diffusionRate:.85,decayRate:.024},reconfig:{detectionInterval:3.4},matrix:{style:"chaotic"}},{id:"yayoi_kusama",name:"Yayoi Kusama",description:"Infinity nets, obsessive dots",seed:9004,particleCount:900,typesCount:7,micro:{force:1.1,drag:1.6,entropy:.06,rmax:.22,beta:.35},field:{diffusionRate:.72,decayRate:.012},reconfig:{detectionInterval:4.6},matrix:{style:"block"}},{id:"gerhard_richter",name:"Gerhard Richter",description:"Squeegee abstraction, color blur",seed:9005,particleCount:750,typesCount:6,micro:{force:1.4,drag:1.3,entropy:.12,rmax:.21,beta:.3},field:{diffusionRate:.88,decayRate:.018},reconfig:{detectionInterval:4},matrix:{style:"chaotic"}},{id:"kazimir_malevich_black",name:"Malevich Black Square",description:"Ultimate reduction, void suprematism",seed:9006,particleCount:250,typesCount:2,micro:{force:.5,drag:2.4,entropy:0,rmax:.32,beta:.5},field:{diffusionRate:.5,decayRate:.005},reconfig:{detectionInterval:9},matrix:{style:"harmonic"}},{id:"bridget_riley",name:"Bridget Riley",description:"Op art waves, optical vibration",seed:9007,particleCount:600,typesCount:4,micro:{force:1.3,drag:1.4,entropy:.05,rmax:.23,beta:.45,circularDependency:.6},field:{diffusionRate:.7,decayRate:.013},reconfig:{detectionInterval:4.8},matrix:{style:"cyclic"}},{id:"franz_kline",name:"Franz Kline",description:"Bold black strokes, architectural gesture",seed:9008,particleCount:550,typesCount:3,micro:{force:2.1,drag:.9,entropy:.15,rmax:.18,speedClamp:.14},field:{diffusionRate:.82,decayRate:.026},reconfig:{detectionInterval:3.2},matrix:{style:"chaotic"}},{id:"ellsworth_kelly",name:"Ellsworth Kelly",description:"Hard edge color fields, pure shape",seed:9009,particleCount:450,typesCount:4,micro:{force:.8,drag:1.9,entropy:.02,rmax:.28,beta:.48},field:{diffusionRate:.6,decayRate:.008},reconfig:{detectionInterval:6.2},matrix:{style:"block"}},{id:"robert_motherwell",name:"Robert Motherwell",description:"Spanish elegies, existential abstraction",seed:9010,particleCount:650,typesCount:5,micro:{force:1.5,drag:1.2,entropy:.1,rmax:.22,beta:.35},field:{diffusionRate:.78,decayRate:.017},reconfig:{detectionInterval:4.2},matrix:{style:"harmonic"}},{id:"bond_sigil",name:" Bond Archetype",description:"Cohesive attraction sigils, stable species bonds",seed:9101,particleCount:600,typesCount:4,micro:{force:1.2,drag:1.4,entropy:.15,rmax:.22,beta:.35,metamorphosisEnabled:!0,mutationRate:.002},field:{diffusionRate:.75,decayRate:.015},reconfig:{detectionInterval:3.5,speciationThreshold:.65},matrix:{style:"symbiotic"}},{id:"rift_sigil",name:" Rift Archetype",description:"Conflict repulsion sigils, fractured territories",seed:9102,particleCount:700,typesCount:5,micro:{force:1.6,drag:1.1,entropy:.18,rmax:.2,beta:.25,metamorphosisEnabled:!0,mutationRate:.0025},field:{diffusionRate:.8,decayRate:.02},reconfig:{detectionInterval:3,speciationThreshold:.7},matrix:{style:"predator"}},{id:"bloom_sigil",name:" Bloom Archetype",description:"Growth and feeding sigils, flourishing populations",seed:9103,particleCount:550,typesCount:4,micro:{force:1.1,drag:1.5,entropy:.12,rmax:.24,beta:.38,foodEnabled:!0,foodRatio:.25,metamorphosisEnabled:!0,mutationRate:.0018},field:{diffusionRate:.7,decayRate:.012},reconfig:{detectionInterval:4,speciationThreshold:.6},matrix:{style:"symbiotic"}},{id:"oath_sigil",name:" Oath Archetype",description:"Ritual path sigils, cyclic ceremonies",seed:9104,particleCount:650,typesCount:5,micro:{force:1.3,drag:1.3,entropy:.16,rmax:.23,beta:.4,circularDependency:.5,metamorphosisEnabled:!0,mutationRate:.002},field:{diffusionRate:.73,decayRate:.016},reconfig:{detectionInterval:3.8,speciationThreshold:.68},matrix:{style:"cyclic"}},{id:"genesis_sigils",name:" Genesis Sigils",description:"All sigils emerge together, primordial chaos",seed:9105,particleCount:750,typesCount:6,micro:{force:1.4,drag:1.2,entropy:.2,rmax:.21,beta:.32,metamorphosisEnabled:!0,mutationRate:.003},field:{diffusionRate:.82,decayRate:.018},reconfig:{detectionInterval:3.2,speciationThreshold:.72},matrix:{style:"chaotic"}},{id:"symbiotic_sigils",name:" Symbiotic Archetypes",description:"Mutual bond sigils, cooperative species emergence",seed:9106,particleCount:600,typesCount:5,micro:{force:1,drag:1.6,entropy:.14,rmax:.25,beta:.36,circularDependency:.3,metamorphosisEnabled:!0,mutationRate:.0015},field:{diffusionRate:.68,decayRate:.013},reconfig:{detectionInterval:4.5,speciationThreshold:.62},matrix:{style:"symbiotic"}},{id:"warring_sigils",name:" Warring Archetypes",description:"Rift-dominated sigils, eternal conflicts between species",seed:9107,particleCount:800,typesCount:6,micro:{force:1.7,drag:1,entropy:.19,rmax:.19,beta:.28,metamorphosisEnabled:!0,mutationRate:.0028},field:{diffusionRate:.85,decayRate:.022},reconfig:{detectionInterval:2.9,speciationThreshold:.74},matrix:{style:"predator"}},{id:"harmonic_sigils",name:" Harmonic Archetypes",description:"Resonant sigils, species in perfect balance",seed:9108,particleCount:500,typesCount:4,micro:{force:.9,drag:1.7,entropy:.08,rmax:.26,beta:.42,metamorphosisEnabled:!0,mutationRate:.001},field:{diffusionRate:.65,decayRate:.01},reconfig:{detectionInterval:5,speciationThreshold:.58},matrix:{style:"harmonic"}},{id:"cascade_sigils",name:" Cascade Archetypes",description:"Chain-reaction sigils, avalanche of new species",seed:9109,particleCount:700,typesCount:5,micro:{force:1.5,drag:1.1,entropy:.22,rmax:.2,beta:.3,metamorphosisEnabled:!0,mutationRate:.0032},field:{diffusionRate:.88,decayRate:.024},reconfig:{detectionInterval:2.7,speciationThreshold:.76},matrix:{style:"chaotic"}},{id:"eternal_sigils",name:" Eternal Archetypes",description:"Persistent sigils, ancient species that never fade",seed:9110,particleCount:450,typesCount:3,micro:{force:.8,drag:1.9,entropy:.06,rmax:.28,beta:.45,metamorphosisEnabled:!0,mutationRate:8e-4},field:{diffusionRate:.62,decayRate:.008},reconfig:{detectionInterval:5.5,speciationThreshold:.55},matrix:{style:"harmonic"}}],CT=(e,t,r,o=.2)=>{const s=t,l=[],i=[],u=[];for(let c=0;c<s;c++)l[c]=new Array(s),i[c]=new Array(s),u[c]=new Array(s);switch(e){case"pollock":case"chaotic":for(let c=0;c<s;c++)for(let d=0;d<s;d++)l[c][d]=r.next()*2-1,i[c][d]=o*(.8+r.next()*.4),u[c][d]=.5+r.next()*1.5;break;case"kandinsky":case"harmonic":for(let c=0;c<s;c++)for(let d=0;d<s;d++){const h=(c-d)/s*Math.PI*2;l[c][d]=Math.cos(h)*.8,i[c][d]=o*(1+Math.abs(Math.sin(h))*.2),u[c][d]=1}break;case"mitosis":for(let c=0;c<s;c++)for(let d=0;d<s;d++)c===d?(l[c][d]=.7,i[c][d]=o*1.2,u[c][d]=.8):(l[c][d]=-.5,i[c][d]=o*.8,u[c][d]=1.2);break;case"predator":for(let c=0;c<s;c++){const d=(c+1)%s,h=(c-1+s)%s;for(let f=0;f<s;f++)f===d?(l[c][f]=.9,i[c][f]=o*1.3,u[c][f]=.7):f===h?(l[c][f]=-.8,i[c][f]=o*1.1,u[c][f]=1.5):(l[c][f]=(r.next()-.5)*.4,i[c][f]=o,u[c][f]=1)}break;case"symbiotic":for(let c=0;c<s;c++)for(let d=0;d<s;d++){const h=Math.min(Math.abs(c-d),s-Math.abs(c-d));l[c][d]=.6-h*.2,i[c][d]=o*(.9+h*.1),u[c][d]=.8+h*.1}break;case"cyclic":for(let c=0;c<s;c++)for(let d=0;d<s;d++){const h=(d-c+s)%s;h===1?(l[c][d]=.8,i[c][d]=o*1.2,u[c][d]=.9):h===s-1?(l[c][d]=-.7,i[c][d]=o*1.1,u[c][d]=1.3):(l[c][d]=(r.next()-.5)*.3,i[c][d]=o,u[c][d]=1)}break;case"sparse":for(let c=0;c<s;c++)for(let d=0;d<s;d++)r.next()<.3?(l[c][d]=r.next()*1.6-.3,i[c][d]=o*(1+r.next()*.5),u[c][d]=.6+r.next()*.8):(l[c][d]=(r.next()-.5)*.2,i[c][d]=o*.9,u[c][d]=1.2);break;case"block":for(let c=0;c<s;c++)for(let d=0;d<s;d++){const h=Math.floor(c/(s/3)),f=Math.floor(d/(s/3));h===f?(l[c][d]=.5+r.next()*.4,i[c][d]=o*1.1,u[c][d]=.9):(l[c][d]=-.3+r.next()*.2,i[c][d]=o*.9,u[c][d]=1.1)}break;case"ring":for(let c=0;c<s;c++)for(let d=0;d<s;d++){const h=Math.min(Math.abs(c-d),s-Math.abs(c-d));h<=1?(l[c][d]=.7,i[c][d]=o*1.2,u[c][d]=.8):h===Math.floor(s/2)?(l[c][d]=-.6,i[c][d]=o*1,u[c][d]=1.4):(l[c][d]=(r.next()-.5)*.3,i[c][d]=o,u[c][d]=1)}break;default:for(let c=0;c<s;c++)for(let d=0;d<s;d++)l[c][d]=r.next()*2-1,i[c][d]=o*(.8+r.next()*.4),u[c][d]=.5+r.next()*1.5}return{attract:l,radius:i,falloff:u}};class $C{constructor(t){this.seed=t}next(){return this.seed=(this.seed*9301+49297)%233280,this.seed/233280}range(t,r){return t+this.next()*(r-t)}int(t,r){return Math.floor(this.range(t,r+1))}}const MT=(e,t,r)=>{e=e%360,t=Math.max(0,Math.min(100,t))/100,r=Math.max(0,Math.min(100,r))/100;const o=(1-Math.abs(2*r-1))*t,s=o*(1-Math.abs(e/60%2-1)),l=r-o/2;let i=0,u=0,c=0;return e>=0&&e<60?(i=o,u=s,c=0):e>=60&&e<120?(i=s,u=o,c=0):e>=120&&e<180?(i=0,u=o,c=s):e>=180&&e<240?(i=0,u=s,c=o):e>=240&&e<300?(i=s,u=0,c=o):(i=o,u=0,c=s),[i+l,u+l,c+l]},kT=e=>{const t=e.range(0,360),r=e.range(70,95);e.range(50,65);const o=[],s=[30,40,50,60,70,45,55,65],l=[0,-10,5,-5,-15,10,-20,15];for(let d=0;d<8;d++)o.push({h:t+e.range(-3,3),s:Math.max(50,Math.min(100,r+l[d])),l:s[d]});const i=(t+180)%360,u=[30,40,50,60,70,45,55,65],c=[0,-10,5,-5,-15,10,-20,15];for(let d=0;d<8;d++)o.push({h:i+e.range(-3,3),s:Math.max(50,Math.min(100,r+c[d])),l:u[d]});return o},RT=e=>{const t=e.range(0,360),r=e.range(70,90),o=e.range(50,65),s=e.range(20,35),l=[],i=[-3,-2,-1,0,1,2,3,4];for(let u of i){const c=(t+u*s)%360;l.push({h:c,s:Math.max(60,Math.min(100,r+e.range(-10,10))),l:Math.max(40,Math.min(65,o+e.range(-5,5)))}),l.push({h:c,s:Math.max(50,Math.min(100,r-15)),l:Math.max(55,Math.min(75,o+15))})}return l},AT=e=>{const t=e.range(0,360),r=e.range(70,95),o=e.range(50,65),s=[],l=[{s:0,l:-20},{s:-10,l:-10},{s:0,l:0},{s:-5,l:10},{s:-15,l:20}];for(let i=0;i<3;i++){const u=(t+i*120)%360;for(let c of l)s.push({h:u+e.range(-3,3),s:Math.max(50,Math.min(100,r+c.s)),l:Math.max(30,Math.min(75,o+c.l))})}return s.push({h:(t+60)%360,s:r-20,l:55}),s},jT=e=>{const t=e.range(0,360),r=e.range(70,90),o=e.range(50,62),s=[],l=[{s:0,l:0},{s:-10,l:-15},{s:-5,l:12},{s:-20,l:20}];for(let i=0;i<4;i++){const u=(t+i*90)%360;for(let c of l)s.push({h:u+e.range(-2,2),s:Math.max(50,Math.min(100,r+c.s)),l:Math.max(30,Math.min(75,o+c.l))})}return s},ET=e=>{const t=e.range(0,360),r=e.range(75,95);e.range(50,62);const o=e.range(25,35),s=[],l=(t+180)%360,i=[35,45,55,65,50,60];for(let f=0;f<6;f++)s.push({h:t+e.range(-3,3),s:Math.max(60,Math.min(100,r-f*5)),l:i[f]});const u=(l-o+360)%360,c=[35,45,55,65,50];for(let f=0;f<5;f++)s.push({h:u+e.range(-3,3),s:Math.max(60,Math.min(100,r-f*5)),l:c[f]});const d=(l+o)%360,h=[35,45,55,65,50];for(let f=0;f<5;f++)s.push({h:d+e.range(-3,3),s:Math.max(60,Math.min(100,r-f*5)),l:h[f]});return s},TT=e=>{const t=e.range(0,360),r=e.range(70,95),o=[],s=[{s:0,l:25},{s:-10,l:35},{s:5,l:40},{s:-5,l:45},{s:0,l:50},{s:-15,l:55},{s:10,l:60},{s:-20,l:65},{s:0,l:70},{s:-5,l:75},{s:5,l:42},{s:-10,l:52},{s:15,l:58},{s:-25,l:68},{s:0,l:38},{s:-15,l:48}];for(let l of s)o.push({h:t+e.range(-5,5),s:Math.max(40,Math.min(100,r+l.s)),l:l.l});return o},IT=e=>{const t=e.range(0,360),r=e.range(75,95),o=e.range(50,65),s=[],l=360/16;for(let i=0;i<16;i++){const u=(t+i*l)%360,c=e.range(-10,10),d=e.range(-8,8);s.push({h:u,s:Math.max(65,Math.min(100,r+c)),l:Math.max(45,Math.min(70,o+d))})}return s},PT=e=>{const t=e.range(0,360),r=(t+90)%360,o=e.range(75,95);e.range(50,65);const s=[],l=[35,45,55,65,50,60,40,70],i=[0,-10,5,-5,-15,10,-20,15];for(let u=0;u<4;u++)s.push({h:t+e.range(-3,3),s:Math.max(60,Math.min(100,o+i[u])),l:l[u]});for(let u=0;u<4;u++)s.push({h:(t+180)%360+e.range(-3,3),s:Math.max(60,Math.min(100,o+i[u+4])),l:l[u+4]});for(let u=0;u<4;u++)s.push({h:r+e.range(-3,3),s:Math.max(60,Math.min(100,o+i[u])),l:l[u]});for(let u=0;u<4;u++)s.push({h:(r+180)%360+e.range(-3,3),s:Math.max(60,Math.min(100,o+i[u+4])),l:l[u+4]});return s},FT=(e,t=16)=>{const r=new $C(e),o=["complementary","analogous","triadic","tetradic","split-complementary","monochromatic","rainbow","double-complementary"],s=r.int(0,o.length-1),l=o[s];let i=[];switch(l){case"complementary":i=kT(r);break;case"analogous":i=RT(r);break;case"triadic":i=AT(r);break;case"tetradic":i=jT(r);break;case"split-complementary":i=ET(r);break;case"monochromatic":i=TT(r);break;case"rainbow":i=IT(r);break;case"double-complementary":i=PT(r);break}const u=Math.max(t,16);for(;i.length<u;){const d=i.length%(i.length>0?i.length:1),h=i[d]||{h:0,s:70,l:50};i.push({h:(h.h+r.range(10,20))%360,s:Math.max(50,Math.min(100,h.s+r.range(-10,10))),l:Math.max(30,Math.min(75,h.l+r.range(-10,10)))})}const c=[];for(let d=0;d<u;d++){const h=i[d%i.length];c.push(MT(h.h,h.s,h.l))}return console.log(` Generated ${l} palette with ${c.length} colors (seed ${e})`),c},NT=e=>{const t=new $C(e),r=["complementary","analogous","triadic","tetradic","split-complementary","monochromatic","rainbow","double-complementary"],o=t.int(0,r.length-1),s=r[o];return{complementary:"Complementar",analogous:"Anloga",triadic:"Tridica",tetradic:"Tetrdica","split-complementary":"Complementar Dividida",monochromatic:"Monocromtica",rainbow:"Arco-ris (Mximo Contraste)","double-complementary":"Dupla Complementar"}[s]},N=e=>{const t=parseInt(e.slice(1,3),16)/255,r=parseInt(e.slice(3,5),16)/255,o=parseInt(e.slice(5,7),16)/255;return[t,r,o]},ci=[{name:"Classic",colors:[N("#FF4444"),N("#44FF44"),N("#4444FF"),N("#FFFF44"),N("#FF44FF"),N("#44FFFF"),N("#FF8844"),N("#8844FF"),N("#44FF88"),N("#FF4488"),N("#88FF44"),N("#4488FF"),N("#FFAA44"),N("#AA44FF"),N("#44FFAA"),N("#FF44AA")]},{name:"Neon Bio",colors:[N("#00FFAA"),N("#FF00AA"),N("#AAFF00"),N("#FF6600"),N("#0066FF"),N("#FF0066"),N("#66FF00"),N("#FF00FF"),N("#00FFFF"),N("#FFFF00"),N("#FF0099"),N("#99FF00"),N("#00FF99"),N("#9900FF"),N("#FF9900"),N("#0099FF")]},{name:"Alien Dusk",colors:[N("#FF6B9D"),N("#C44569"),N("#FFA07A"),N("#FA8072"),N("#E17055"),N("#FDCB6E"),N("#6C5CE7"),N("#A29BFE"),N("#74B9FF"),N("#00B894"),N("#00CEC9"),N("#81ECEC"),N("#55EFC4"),N("#FD79A8"),N("#E84393"),N("#D63031")]},{name:"Fungal",colors:[N("#8B4513"),N("#A0522D"),N("#CD853F"),N("#DEB887"),N("#F0E68C"),N("#9ACD32"),N("#6B8E23"),N("#556B2F"),N("#2F4F4F"),N("#8FBC8F"),N("#20B2AA"),N("#48D1CC"),N("#40E0D0"),N("#7FFFD4"),N("#98FB98"),N("#90EE90")]},{name:"Oceanic",colors:[N("#001F3F"),N("#0074D9"),N("#7FDBFF"),N("#39CCCC"),N("#3D9970"),N("#2ECC40"),N("#01FF70"),N("#FFDC00"),N("#FF851B"),N("#FF4136"),N("#85144B"),N("#F012BE"),N("#B10DC9"),N("#111111"),N("#AAAAAA"),N("#DDDDDD")]},{name:"Plasma",colors:[N("#FF00FF"),N("#FF00CC"),N("#FF0099"),N("#FF0066"),N("#FF3300"),N("#FF6600"),N("#FF9900"),N("#FFCC00"),N("#FFFF00"),N("#CCFF00"),N("#99FF00"),N("#66FF00"),N("#33FF00"),N("#00FF33"),N("#00FF66"),N("#00FF99")]},{name:"Sunset",colors:[N("#FF6B35"),N("#F7931E"),N("#FDC830"),N("#F37335"),N("#FE4A49"),N("#D63447"),N("#FF5733"),N("#C70039"),N("#900C3F"),N("#FF8C42"),N("#FFA351"),N("#FFB85C"),N("#FF9966"),N("#E85D75"),N("#FF4500"),N("#B33000")]},{name:"Cherry Blossom",colors:[N("#FFB7C5"),N("#FFC0CB"),N("#FFD1DC"),N("#E6A8D7"),N("#D291BC"),N("#957DAD"),N("#FEA3AA"),N("#F0B7A4"),N("#FFC8A2"),N("#D3D0CB"),N("#A997DF"),N("#F7CAC9"),N("#FFAAC1"),N("#E8B4D0"),N("#C89FBB"),N("#B57FA6")]},{name:"Northern Lights",colors:[N("#00FFC6"),N("#00FFE7"),N("#00E4FF"),N("#00C5FF"),N("#00A6FF"),N("#4D88FF"),N("#8B5CF6"),N("#A78BFA"),N("#C4B5FD"),N("#7DD3FC"),N("#38BDF8"),N("#0EA5E9"),N("#00FFB3"),N("#5D9FFF"),N("#9B73F7"),N("#60D8F8")]},{name:"Desert",colors:[N("#EDC9AF"),N("#E6BC98"),N("#D2A76E"),N("#C19A6B"),N("#AA8B5C"),N("#9C6F46"),N("#F4A460"),N("#DAA520"),N("#CD853F"),N("#8B7355"),N("#A0826D"),N("#C2B280"),N("#D4A373"),N("#B8956A"),N("#E8C4A0"),N("#967554")]},{name:"Toxic",colors:[N("#39FF14"),N("#00FF41"),N("#0FFF50"),N("#7FFF00"),N("#ADFF2F"),N("#CCFF00"),N("#DFFF00"),N("#F0FF00"),N("#FFFF00"),N("#FF00FF"),N("#FF10F0"),N("#FF1493"),N("#00FF7F"),N("#BBFF00"),N("#FF00DD"),N("#FF3399")]},{name:"Galaxy",colors:[N("#2C003E"),N("#512B58"),N("#9D44C0"),N("#EC53B0"),N("#FFA0D2"),N("#FF6FCF"),N("#C724B1"),N("#8B2FC9"),N("#5C2E7E"),N("#2E1F3B"),N("#1C0F2A"),N("#0F0520"),N("#B83FD8"),N("#D967E8"),N("#3D1A52"),N("#FF88DD")]},{name:"Cyberpunk",colors:[N("#FF006E"),N("#FB5607"),N("#FFBE0B"),N("#8338EC"),N("#3A86FF"),N("#00F5FF"),N("#FF00FF"),N("#00FFFF"),N("#FFFF00"),N("#FF0080"),N("#0080FF"),N("#80FF00"),N("#FF3399"),N("#AA00FF"),N("#00FFAA"),N("#FFAA00")]},{name:"Retro Wave",colors:[N("#FF6EC7"),N("#FF10F0"),N("#BF00FF"),N("#8000FF"),N("#4000FF"),N("#0040FF"),N("#0080FF"),N("#00C0FF"),N("#00FFFF"),N("#FF007F"),N("#FF00BF"),N("#FF0050"),N("#9F00FF"),N("#6000FF"),N("#0060FF"),N("#00A0FF")]},{name:"Coral Reef",colors:[N("#FF7F50"),N("#FF6347"),N("#FFB347"),N("#FFA07A"),N("#FA8072"),N("#E9967A"),N("#00CED1"),N("#48D1CC"),N("#40E0D0"),N("#7FFFD4"),N("#66CDAA"),N("#20B2AA"),N("#FF9966"),N("#FF8866"),N("#5FE5E0"),N("#8FFFEE")]},{name:"Midnight",colors:[N("#191970"),N("#000080"),N("#00008B"),N("#0000CD"),N("#0000FF"),N("#1E90FF"),N("#4169E1"),N("#6495ED"),N("#87CEEB"),N("#4682B4"),N("#5F9EA0"),N("#708090"),N("#0C0C50"),N("#0000AA"),N("#2E7FE1"),N("#7AB8ED")]},{name:"Lava",colors:[N("#8B0000"),N("#A52A2A"),N("#B22222"),N("#DC143C"),N("#FF0000"),N("#FF4500"),N("#FF6347"),N("#FF7F50"),N("#FFA500"),N("#FF8C00"),N("#FFD700"),N("#FFFF00"),N("#990000"),N("#EE1111"),N("#FF5522"),N("#FFB800")]},{name:"Ice",colors:[N("#E0FFFF"),N("#AFEEEE"),N("#B0E0E6"),N("#ADD8E6"),N("#87CEEB"),N("#87CEFA"),N("#00BFFF"),N("#1E90FF"),N("#6495ED"),N("#4682B4"),N("#5F9EA0"),N("#B0C4DE"),N("#CCFFFF"),N("#99DDEE"),N("#77D8FF"),N("#A0D4EE")]},{name:"Forest",colors:[N("#228B22"),N("#32CD32"),N("#00FF00"),N("#7CFC00"),N("#7FFF00"),N("#ADFF2F"),N("#9ACD32"),N("#6B8E23"),N("#556B2F"),N("#8FBC8F"),N("#90EE90"),N("#98FB98"),N("#3DA83D"),N("#5FCC5F"),N("#88DD00"),N("#A0E8A0")]},{name:"Pastel Dream",colors:[N("#FFB3BA"),N("#FFDFBA"),N("#FFFFBA"),N("#BAFFC9"),N("#BAE1FF"),N("#E0BBE4"),N("#FFDFD3"),N("#FEC8D8"),N("#D4A5A5"),N("#C9E4DE"),N("#FFCCF9"),N("#FCCBCB"),N("#FFC8D0"),N("#FFE8C8"),N("#D8FFE8"),N("#F0D8FF")]},{name:"Volcano",colors:[N("#610000"),N("#8B0000"),N("#B22222"),N("#DC143C"),N("#FF0000"),N("#FF4500"),N("#FFA500"),N("#FFD700"),N("#FFFF00"),N("#696969"),N("#808080"),N("#A9A9A9"),N("#450000"),N("#CC1111"),N("#FF6611"),N("#555555")]},{name:"Cotton Candy",colors:[N("#FFB3D9"),N("#FFC9E6"),N("#FFDFF2"),N("#E6B3FF"),N("#D9B3FF"),N("#CCB3FF"),N("#B3D9FF"),N("#B3E6FF"),N("#B3F2FF"),N("#FFB3E6"),N("#FFB3D9"),N("#FFB3CC"),N("#FFA8D4"),N("#DDA8FF"),N("#BFC8FF"),N("#FFC0DC")]},{name:"Autumn",colors:[N("#8B4513"),N("#A0522D"),N("#D2691E"),N("#CD5C5C"),N("#F08080"),N("#FA8072"),N("#FFA07A"),N("#FFB347"),N("#FFC04C"),N("#FADA5E"),N("#FFD700"),N("#DAA520"),N("#B8621E"),N("#E8775F"),N("#FFD466"),N("#CC9933")]},{name:"Spring",colors:[N("#FFB7CE"),N("#FFC9E6"),N("#FFE5F1"),N("#E6FFE6"),N("#CCFFCC"),N("#B3FFB3"),N("#FFFFCC"),N("#FFFFE0"),N("#FFFACD"),N("#D4F1F4"),N("#B4E5E7"),N("#9FD8DB"),N("#FFCCE0"),N("#DDFFD0"),N("#FFFFD8"),N("#C8ECEE")]},{name:"Deep Sea",colors:[N("#001F3F"),N("#003B5C"),N("#005C7A"),N("#007A99"),N("#0099B8"),N("#00B8D7"),N("#1BD4E4"),N("#36E4F2"),N("#51F4FF"),N("#012840"),N("#013A5A"),N("#014C73"),N("#00334D"),N("#008AAA"),N("#00CCEE"),N("#025E88")]},{name:"Candy",colors:[N("#FF69B4"),N("#FF1493"),N("#FF00FF"),N("#DA70D6"),N("#BA55D3"),N("#9370DB"),N("#8A2BE2"),N("#9400D3"),N("#8B008B"),N("#FF00FF"),N("#EE82EE"),N("#DDA0DD"),N("#FF4FB8"),N("#CC44EE"),N("#AA22DD"),N("#F090E8")]},{name:"Mint",colors:[N("#00FA9A"),N("#00FF7F"),N("#3CB371"),N("#2E8B57"),N("#8FBC8F"),N("#90EE90"),N("#98FB98"),N("#AFEEEE"),N("#7FFFD4"),N("#40E0D0"),N("#48D1CC"),N("#00CED1"),N("#11DD88"),N("#66EE99"),N("#99FFCC"),N("#55E8D8")]},{name:"Fire",colors:[N("#FF0000"),N("#FF4500"),N("#FF6347"),N("#FF7F50"),N("#FFA500"),N("#FFB347"),N("#FFC04C"),N("#FFD700"),N("#FFFF00"),N("#FF8C00"),N("#FF6600"),N("#FF4400"),N("#FF1100"),N("#FF5522"),N("#FF9933"),N("#FFEE11")]},{name:"Neon Nights",colors:[N("#FF00FF"),N("#FF00AA"),N("#FF0055"),N("#00FFFF"),N("#00AAFF"),N("#0055FF"),N("#00FF00"),N("#00FF55"),N("#00FFAA"),N("#FFFF00"),N("#FFAA00"),N("#FF5500"),N("#DD00DD"),N("#0088DD"),N("#11FF11"),N("#FFCC00")]},{name:"Lavender",colors:[N("#E6E6FA"),N("#D8BFD8"),N("#DDA0DD"),N("#EE82EE"),N("#DA70D6"),N("#FF00FF"),N("#BA55D3"),N("#9370DB"),N("#8A2BE2"),N("#9400D3"),N("#9932CC"),N("#8B008B"),N("#CCC8E8"),N("#B088E8"),N("#AA44EE"),N("#7700BB")]},{name:"Earth",colors:[N("#8B7355"),N("#A0826D"),N("#C2B280"),N("#DEB887"),N("#D2B48C"),N("#F5DEB3"),N("#8B4513"),N("#A0522D"),N("#BC8F8F"),N("#CD853F"),N("#D2691E"),N("#DAA520"),N("#9A8066"),N("#CCB090"),N("#B86F30"),N("#E0C080")]},{name:"Tropical",colors:[N("#00CED1"),N("#20B2AA"),N("#48D1CC"),N("#40E0D0"),N("#00FA9A"),N("#00FF7F"),N("#FFD700"),N("#FFA500"),N("#FF8C00"),N("#FF69B4"),N("#FF1493"),N("#C71585"),N("#00E4E8"),N("#22DD88"),N("#FFCC22"),N("#FF3388")]},{name:"Rainbow",colors:[N("#FF0000"),N("#FF7F00"),N("#FFFF00"),N("#00FF00"),N("#0000FF"),N("#4B0082"),N("#9400D3"),N("#FF00FF"),N("#FF007F"),N("#FF00BF"),N("#7F00FF"),N("#00FFFF"),N("#FF4400"),N("#AAFF00"),N("#0088FF"),N("#CC00FF")]},{name:"Mono Chrome",colors:[N("#000000"),N("#1A1A1A"),N("#333333"),N("#4D4D4D"),N("#666666"),N("#808080"),N("#999999"),N("#B3B3B3"),N("#CCCCCC"),N("#E6E6E6"),N("#F2F2F2"),N("#FFFFFF")]},{name:"Blood Moon",colors:[N("#8B0000"),N("#A00000"),N("#B50000"),N("#CA0000"),N("#E00000"),N("#FF0000"),N("#330000"),N("#4D0000"),N("#660000"),N("#800000"),N("#990000"),N("#B30000"),N("#700000"),N("#DD0000"),N("#550000"),N("#AA0000")]},{name:"Aurora",colors:[N("#00FFC6"),N("#00FFE7"),N("#00FFFF"),N("#00E4FF"),N("#00C5FF"),N("#00A6FF"),N("#4D88FF"),N("#8B5CF6"),N("#A855F7"),N("#C084FC"),N("#D8B4FE"),N("#E9D5FF"),N("#00FFB8"),N("#00D4FF"),N("#6A77FF"),N("#B877F9")]},{name:"Hilma af Klint",colors:[N("#FFD700"),N("#FDB931"),N("#FFA500"),N("#FF69B4"),N("#FF1493"),N("#FF85C1"),N("#4169E1"),N("#6495ED"),N("#87CEEB"),N("#9370DB"),N("#8A2BE2"),N("#9932CC"),N("#FFCC00"),N("#FF4488"),N("#5588EE"),N("#AA55DD")]},{name:"Cosmic Dust",colors:[N("#1A1A2E"),N("#16213E"),N("#0F3460"),N("#533483"),N("#9D4EDD"),N("#C77DFF"),N("#E0AAFF"),N("#F72585"),N("#B5179E"),N("#7209B7"),N("#560BAD"),N("#3C096C"),N("#202038"),N("#6644AA"),N("#DD88FF"),N("#EE3399")]},{name:"Bioluminescence",colors:[N("#00FF41"),N("#00FF88"),N("#00FFCC"),N("#00FFFF"),N("#00CCFF"),N("#0088FF"),N("#0044FF"),N("#4400FF"),N("#8800FF"),N("#00FF00"),N("#88FF00"),N("#FFFF00"),N("#00FF66"),N("#00AAFF"),N("#6600FF"),N("#AAFF00")]},{name:"Steampunk",colors:[N("#8B4513"),N("#A0522D"),N("#CD853F"),N("#D2691E"),N("#B8860B"),N("#DAA520"),N("#696969"),N("#708090"),N("#778899"),N("#2F4F4F"),N("#556B2F"),N("#8B7355"),N("#996633"),N("#CC9944"),N("#8899AA"),N("#445544")]},{name:"Prismatic",colors:[N("#FF0000"),N("#FF3300"),N("#FF6600"),N("#FF9900"),N("#FFCC00"),N("#FFFF00"),N("#CCFF00"),N("#99FF00"),N("#66FF00"),N("#33FF00"),N("#00FF00"),N("#00FF33"),N("#FF1100"),N("#FF7711"),N("#AAFF00"),N("#11FF11")]},{name:"Void",colors:[N("#000000"),N("#0D0D0D"),N("#1A1A1A"),N("#2A0A2E"),N("#3F0F4F"),N("#5A145F"),N("#7A1A7F"),N("#8B008B"),N("#9400D3"),N("#4B0082"),N("#2E0854"),N("#1A0033"),N("#111111"),N("#440E55"),N("#6A1170"),N("#220044")]},{name:"Sakura Night",colors:[N("#FFB7D5"),N("#FFA6C9"),N("#FF95BE"),N("#2A1A3D"),N("#3E2856"),N("#52366F"),N("#1C1035"),N("#2D1B4E"),N("#3E2667"),N("#FFD6E8"),N("#FFC2DC"),N("#FFAED0"),N("#FFCCDD"),N("#342047"),N("#462C60"),N("#FFB8CC")]},{name:"Ancient Gold",colors:[N("#FFD700"),N("#FFC700"),N("#FFB700"),N("#FFA700"),N("#FF9700"),N("#FF8700"),N("#8B7355"),N("#A0826D"),N("#B8956A"),N("#D4AF37"),N("#E6BE5A"),N("#F8CD7D"),N("#FFEE00"),N("#FFAA00"),N("#9A8066"),N("#CCAA44")]},{name:"Nebula",colors:[N("#FF006E"),N("#FB5607"),N("#FFBE0B"),N("#8338EC"),N("#3A86FF"),N("#06FFA5"),N("#FF1654"),N("#FF477E"),N("#FF87AB"),N("#B5E48C"),N("#76C893"),N("#52B69A"),N("#FF3388"),N("#9944FF"),N("#4499FF"),N("#88DD88")]},{name:"Vaporwave",colors:[N("#FF71CE"),N("#01CDFE"),N("#05FFA1"),N("#B967FF"),N("#FFFB96"),N("#FF6AD5"),N("#C774E8"),N("#94D0FF"),N("#8795E8"),N("#FF10F0"),N("#00D9FF"),N("#00FFC8"),N("#FF88DD"),N("#22DDFF"),N("#AA77FF"),N("#FFEE88")]},{name:"Random (Color Theory)",colors:[]}],E5=new Map;let Of=Date.now();const a2=e=>{Of=e,E5.clear(),console.log(` Random palette seed set to: ${e}`),typeof window<"u"&&window.dispatchEvent(new CustomEvent("palette-changed"))},OT=e=>{const t=Math.max(e,16);if(!E5.has(Of)){const r=FT(Of,t);E5.set(Of,r)}return E5.get(Of)},qC=(e,t,r=16)=>{const o=e%ci.length,s=ci[o];if(o===ci.length-1){const i=OT(r);return i[t%i.length]}return s.colors[t%s.colors.length]},Eg=(e,t=0,r=16)=>{const[o,s,l]=qC(t,e,r);return`rgb(${Math.floor(o*255)}, ${Math.floor(s*255)}, ${Math.floor(l*255)})`},$c="'IBM Plex Mono', monospace",qr=({label:e,value:t,min:r,max:o,step:s,onChange:l,unit:i})=>{const u=t??r??0,c=s>=1?0:s>=.1?1:s>=.01?2:3,d=(u-r)/(o-r)*100;return a.jsxs("div",{className:"flex flex-col gap-1 group",children:[a.jsxs("div",{className:"flex items-baseline justify-between",children:[a.jsx("label",{style:{fontFamily:$c,fontSize:"9px",fontWeight:200,letterSpacing:"0.5px",color:"rgba(255,255,255,0.35)",textTransform:"uppercase"},children:e}),a.jsxs("span",{style:{fontFamily:$c,fontSize:"9px",fontWeight:300,color:"rgba(255,255,255,0.5)",fontVariantNumeric:"tabular-nums"},children:[u.toFixed(c),i]})]}),a.jsxs("div",{className:"relative h-3 flex items-center",children:[a.jsx("div",{className:"absolute left-0 right-0 h-px",style:{background:"rgba(255,255,255,0.08)"}}),a.jsx("div",{className:"absolute left-0 h-px",style:{width:`${d}%`,background:"rgba(255,212,0,0.3)"}}),a.jsx("input",{type:"range",min:r,max:o,step:s,value:u,onChange:h=>l(parseFloat(h.target.value)),className:`absolute w-full h-3 appearance-none cursor-pointer bg-transparent
            [&::-webkit-slider-thumb]:appearance-none
            [&::-webkit-slider-thumb]:w-1.5
            [&::-webkit-slider-thumb]:h-3
            [&::-webkit-slider-thumb]:bg-white/50
            [&::-webkit-slider-thumb]:transition-colors
            [&::-moz-range-thumb]:w-1.5
            [&::-moz-range-thumb]:h-3
            [&::-moz-range-thumb]:bg-white/50
            [&::-moz-range-thumb]:border-0
            [&::-moz-range-thumb]:transition-colors`,style:{zIndex:1}})]})]})},_T=({microConfig:e,fieldConfig:t,reconfigConfig:r,targetParticleCount:o,onMicroChange:s,onFieldChange:l,onReconfigChange:i,onTargetParticleCountChange:u,onRandomizeAll:c,life:d,onLifeChange:h,lifeStats:f,pointSize:g=4,fadeFactor:m=.92,glowIntensity:y=.5,paletteIndex:v=0,onPointSizeChange:b,onFadeFactorChange:S,onGlowIntensityChange:C,onPaletteIndexChange:k,trails:R=!0,fieldHeatmap:j=!1,onToggleTrails:T,onToggleFieldHeatmap:_,onApplyRecipe:P,onNewUniverse:I,onChaosSeed:$,onLoadPreset:q,renderMode:L="dots",streakLength:H=8,onRenderModeChange:G,onStreakLengthChange:oe,simQuality:le="HIGH",dotSize:pe=2,onSimQualityChange:ce,onDotSizeChange:te,spawnPattern:F="random",onSpawnPatternChange:Q,onBackgroundClick:ae,showBonds:we=!1,bondsDistance:Re=50,bondsOpacity:ge=.3,showTrails:Ae=!1,trailsLength:tt=20,trailsOpacity:We=.6,onShowBondsChange:J,onBondsDistanceChange:ke,onBondsOpacityChange:Le,onShowTrailsChange:K,onTrailsLengthChange:et,onTrailsOpacityChange:dt,sigilConfig:Rt,onSigilConfigChange:Wt,archetypesDetected:Zt,onClearSigils:$e})=>{var Ze;return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"space-y-2 pb-3",style:{borderBottom:"1px dashed rgba(255,255,255,0.08)"},children:[a.jsxs("h2",{style:{fontFamily:"'Doto', monospace",fontSize:"11px",fontWeight:400,letterSpacing:"0.1em",color:"#ffd400",textTransform:"uppercase"},children:[""," Algoritmo"]}),a.jsx("p",{style:{fontFamily:$c,fontSize:"9px",fontWeight:200,color:"rgba(255,255,255,0.35)",lineHeight:1.4},children:"Motor central do MetaLifeLab. Controle a fisica, quimica e estetica do universo."})]}),(P||I||$||Q)&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"space-y-3",children:[a.jsx("h3",{style:{fontFamily:"'Doto', monospace",fontSize:10,color:"rgba(255,255,255,0.55)",letterSpacing:"0.1em",textTransform:"uppercase",paddingBottom:5,borderBottom:"1px dashed rgba(255,255,255,0.05)"},children:"Ecossistema"}),a.jsx("p",{className:"text-white/30 text-[9px] font-light italic leading-relaxed",children:"Gere universos com o sistema WorldDNA"}),Q&&a.jsxs("div",{children:[a.jsx("label",{className:"text-white/40 text-[9px] tracking-wide uppercase font-light block mb-1.5",children:"Padro Inicial"}),a.jsxs("select",{value:F,onChange:Fe=>Q(Fe.target.value),style:{fontFamily:$c,fontSize:10,border:"1px dashed rgba(255,255,255,0.08)",background:"transparent",color:"rgba(255,255,255,0.55)",padding:"5px 8px"},className:"w-full focus:outline-none transition-colors",children:[a.jsxs("optgroup",{label:"Bsicos",className:"bg-black",children:[a.jsx("option",{value:"random",className:"bg-black",children:"Random Chaos"}),a.jsx("option",{value:"center_cluster",className:"bg-black",children:"Center Cluster"}),a.jsx("option",{value:"grid",className:"bg-black",children:"Grid"}),a.jsx("option",{value:"perimeter",className:"bg-black",children:"Perimeter"})]}),a.jsxs("optgroup",{label:"Circulares",className:"bg-black",children:[a.jsx("option",{value:"ring",className:"bg-black",children:"Ring"}),a.jsx("option",{value:"concentric_rings",className:"bg-black",children:"Concentric Rings"}),a.jsx("option",{value:"spiral",className:"bg-black",children:"Spiral"}),a.jsx("option",{value:"vortex",className:"bg-black",children:"Vortex"})]}),a.jsxs("optgroup",{label:"Geomtricos",className:"bg-black",children:[a.jsx("option",{value:"triangle",className:"bg-black",children:"Triangle"}),a.jsx("option",{value:"cross",className:"bg-black",children:"Cross"}),a.jsx("option",{value:"checkerboard",className:"bg-black",children:"Checkerboard"}),a.jsx("option",{value:"corners",className:"bg-black",children:"Four Corners"})]}),a.jsxs("optgroup",{label:"Bandas",className:"bg-black",children:[a.jsx("option",{value:"vertical_bands",className:"bg-black",children:"Vertical Bands"}),a.jsx("option",{value:"horizontal_bands",className:"bg-black",children:"Horizontal Bands"})]}),a.jsxs("optgroup",{label:"Especiais",className:"bg-black",children:[a.jsx("option",{value:"two_clusters",className:"bg-black",children:"Two Clusters"}),a.jsx("option",{value:"double_helix",className:"bg-black",children:"Double Helix"}),a.jsx("option",{value:"sunburst",className:"bg-black",children:"Sunburst"}),a.jsx("option",{value:"wave",className:"bg-black",children:"Wave"}),a.jsx("option",{value:"fractal_dust",className:"bg-black",children:"Fractal Dust"}),a.jsx("option",{value:"yin_yang",className:"bg-black",children:"Yin Yang"})]})]})]}),(I||$)&&a.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[I&&a.jsx("button",{onClick:I,className:"text-[10px] py-1.5 px-2 transition-all uppercase",style:{border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.45)",fontFamily:"'IBM Plex Mono', monospace",letterSpacing:"0.06em"},children:"Novo Universo"}),$&&a.jsx("button",{onClick:$,className:"text-[10px] py-1.5 px-2 transition-all uppercase",style:{border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.45)",fontFamily:"'IBM Plex Mono', monospace",letterSpacing:"0.06em"},children:"Semente do Caos"})]}),P&&a.jsxs("div",{children:[a.jsx("label",{className:"text-white/40 text-[9px] tracking-wide uppercase font-light block mb-1.5",children:"Receitas"}),a.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[a.jsx("button",{onClick:()=>P("pollock"),className:"text-[10px] py-1.5 px-2 transition-all uppercase",style:{border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.40)",fontFamily:"'IBM Plex Mono', monospace"},title:"Chaotic streaking patterns",children:"Pollock"}),a.jsx("button",{onClick:()=>P("mitosis"),className:"text-[10px] py-1.5 px-2 transition-all uppercase",style:{border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.40)",fontFamily:"'IBM Plex Mono', monospace"},title:"Self-dividing clusters",children:"Mitosis"}),a.jsx("button",{onClick:()=>P("alliances"),className:"text-[10px] py-1.5 px-2 transition-all uppercase",style:{border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.40)",fontFamily:"'IBM Plex Mono', monospace"},title:"Symbiotic coalitions",children:"Alliances"}),a.jsx("button",{onClick:()=>P("planets"),className:"text-[10px] py-1.5 px-2 transition-all uppercase",style:{border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.40)",fontFamily:"'IBM Plex Mono', monospace"},title:"Orbital ring structures",children:"Planets"}),a.jsx("button",{onClick:()=>P("field"),className:"text-[10px] py-1.5 px-2 transition-all uppercase",style:{border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.40)",fontFamily:"'IBM Plex Mono', monospace"},title:"Sparse high-energy field",children:"Field"}),a.jsx("button",{onClick:()=>P("gems"),className:"text-[10px] py-1.5 px-2 transition-all uppercase",style:{border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.40)",fontFamily:"'IBM Plex Mono', monospace"},title:"Dense crystalline clusters",children:"Gems"}),a.jsx("button",{onClick:()=>P("drift"),className:"text-[10px] py-1.5 px-2 transition-all uppercase",style:{border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.40)",fontFamily:"'IBM Plex Mono', monospace"},title:"Flowing sparse patterns",children:"Drift"}),a.jsx("button",{onClick:()=>P("simplify"),className:"text-[10px] py-1.5 px-2 transition-all uppercase",style:{border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.40)",fontFamily:"'IBM Plex Mono', monospace"},title:"Minimal stable structures",children:"Simplify"}),a.jsx("button",{onClick:()=>P("darwin"),className:"text-[10px] py-1.5 px-2 transition-all uppercase",style:{border:"1px dashed rgba(16,212,91,0.20)",color:"rgba(16,212,91,0.70)",fontFamily:"'IBM Plex Mono', monospace"},title:"Evolution with mutations and adaptations",children:"Darwin"})]})]}),q&&a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("label",{className:"text-white/50 text-[9px] tracking-wide uppercase font-light",children:[" Featured (",Nf.length,")"]})}),["stable","living","wild"].map(Fe=>{const Xe=Nf.filter(it=>it.category===Fe),jt=Fe==="stable"?" Stable Forms":Fe==="living"?" Living Systems":" Wild / Oracle",hn=Fe==="stable"?"text-cyan-400/70":Fe==="living"?"text-green-400/70":"text-purple-400/70",an=Fe==="stable"?"border-cyan-500/20 hover:border-cyan-500/40":Fe==="living"?"border-green-500/20 hover:border-green-500/40":"border-purple-500/20 hover:border-purple-500/40";return a.jsxs("div",{className:"space-y-1",children:[a.jsx("div",{className:`text-[8px] tracking-widest uppercase font-light ${hn} pl-0.5`,children:jt}),Xe.map(it=>a.jsxs("button",{onClick:()=>q(it.id),className:`w-full border ${an} text-white/60 hover:text-white/90 text-left py-2 px-2.5 transition-all group`,children:[a.jsxs("div",{className:"flex items-baseline justify-between gap-1",children:[a.jsx("span",{className:"text-[10px] font-medium text-white/80",children:it.name}),a.jsxs("span",{className:"text-[8px] text-white/25 font-mono shrink-0",children:[it.particleCount,"p/",it.typesCount,"t"]})]}),a.jsx("div",{className:"text-[8px] text-white/40 leading-tight mt-0.5 line-clamp-2",children:it.description}),it.tags&&a.jsx("div",{className:"flex flex-wrap gap-0.5 mt-1",children:it.tags.slice(0,3).map(kt=>a.jsx("span",{className:"text-[7px] px-1 py-px bg-white/5 text-white/30 border border-white/[0.06]",children:kt},kt))})]},it.id))]},Fe)}),a.jsxs("details",{className:"group",children:[a.jsxs("summary",{className:"cursor-pointer text-white/30 text-[9px] tracking-wide uppercase font-light py-1 hover:text-white/50 transition-colors select-none",children:[" All Presets (",th.length-Nf.length," more)"]}),a.jsx("div",{className:`mt-1.5 grid grid-cols-2 gap-1 max-h-[300px] overflow-y-auto pr-1
                    [&::-webkit-scrollbar]:w-1 [&::-webkit-scrollbar-track]:bg-white/5
                    [&::-webkit-scrollbar-thumb]:bg-white/20`,children:th.filter(Fe=>!Nf.find(Xe=>Xe.id===Fe.id)).map(Fe=>a.jsxs("button",{onClick:()=>q(Fe.id),className:"text-white/50 hover:text-white/80 text-[9px] py-1.5 px-2 transition-all text-left",style:{border:"1px dashed rgba(255,255,255,0.05)",fontFamily:"'IBM Plex Mono', monospace"},title:Fe.description,children:[a.jsx("div",{className:"truncate font-medium",children:Fe.name}),a.jsxs("div",{className:"text-[7px] text-white/25 mt-0.5",children:[Fe.typesCount," types"]})]},Fe.id))})]})]})]}),a.jsx("div",{className:"h-px bg-white/[0.04]"})]}),c&&a.jsxs(a.Fragment,{children:[a.jsx("div",{children:a.jsx("button",{onClick:c,className:"w-full text-[10px] py-2 px-2 transition-all uppercase",style:{border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.45)",fontFamily:"'IBM Plex Mono', monospace",letterSpacing:"0.06em"},children:"Aleatorizar Tudo"})}),a.jsx("div",{className:"h-px bg-white/[0.04]"})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("h3",{className:"text-[10px] uppercase pb-1.5",style:{fontFamily:"'Doto', monospace",color:"rgba(255,255,255,0.50)",letterSpacing:"0.08em",borderBottom:"1px dashed rgba(255,255,255,0.05)"},children:"Visual"}),T&&a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx("input",{type:"checkbox",id:"enableTrails",checked:R,onChange:T,className:"w-2.5 h-2.5 bg-transparent border border-white/15 checked:bg-white/20 cursor-pointer"}),a.jsx("label",{htmlFor:"enableTrails",className:"text-white/40 text-[10px] font-light cursor-pointer uppercase tracking-wide",children:"Rastros (Trails)"})]}),_&&a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx("input",{type:"checkbox",id:"enableFieldHeatmap",checked:j,onChange:_,className:"w-2.5 h-2.5 bg-transparent border border-white/15 checked:bg-white/20 cursor-pointer"}),a.jsx("label",{htmlFor:"enableFieldHeatmap",className:"text-white/40 text-[10px] font-light cursor-pointer uppercase tracking-wide",children:"Campo (Heatmap)"})]})]}),a.jsx("div",{className:"h-px bg-white/[0.04]"}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("h3",{className:"text-[10px] uppercase pb-1.5",style:{fontFamily:"'Doto', monospace",color:"rgba(255,255,255,0.50)",letterSpacing:"0.08em",borderBottom:"1px dashed rgba(255,255,255,0.05)"},children:"Populao"}),a.jsx(qr,{label:"Agentes",value:o,min:100,max:5e3,step:100,onChange:u}),a.jsx(qr,{label:"Espcies",value:e.typesCount,min:2,max:16,step:1,onChange:Fe=>s({typesCount:Fe})}),a.jsxs("div",{className:"flex items-center gap-1.5 pt-1",children:[a.jsx("input",{type:"checkbox",id:"foodEnabled",checked:e.foodEnabled,onChange:Fe=>s({foodEnabled:Fe.target.checked}),className:"w-2.5 h-2.5 bg-transparent border border-white/15 checked:bg-white/20 cursor-pointer"}),a.jsx("label",{htmlFor:"foodEnabled",className:"text-white/40 text-[10px] font-light cursor-pointer uppercase tracking-wide",children:"Ativar Partculas de Alimento"})]}),e.foodEnabled&&a.jsx(qr,{label:"Proporo de Alimento",value:e.foodRatio,min:.05,max:.5,step:.05,onChange:Fe=>s({foodRatio:Fe}),unit:"%"})]}),a.jsx("div",{className:"h-px bg-white/[0.04]"}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("h3",{className:"text-[10px] uppercase pb-1.5",style:{fontFamily:"'Doto', monospace",color:"rgba(255,255,255,0.50)",letterSpacing:"0.08em",borderBottom:"1px dashed rgba(255,255,255,0.05)"},children:"Fsica"}),a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx("input",{type:"checkbox",id:"wrapBoundaries",checked:e.wrap,onChange:Fe=>s({wrap:Fe.target.checked}),className:"w-2.5 h-2.5 bg-transparent border border-white/15 checked:bg-white/20 cursor-pointer"}),a.jsx("label",{htmlFor:"wrapBoundaries",className:"text-white/40 text-[10px] font-light cursor-pointer uppercase tracking-wide",children:e.wrap?"Universo Infinito (Wrap)":"Bordas Fechadas"})]}),a.jsx(qr,{label:"Alcance de Interao",value:e.rmax,min:.1,max:.5,step:.01,onChange:Fe=>s({rmax:Fe})}),a.jsx(qr,{label:"Ganho de Fora",value:e.force,min:.2,max:4,step:.1,onChange:Fe=>s({force:Fe})}),a.jsx(qr,{label:"Arrasto (Viscosidade)",value:e.drag,min:.1,max:5,step:.1,onChange:Fe=>s({drag:Fe})}),a.jsx(qr,{label:"Limite de Velocidade",value:e.speedClamp,min:.02,max:.5,step:.01,onChange:Fe=>s({speedClamp:Fe})}),a.jsx(qr,{label:"Entropia (Caos)",value:e.entropy,min:0,max:1,step:.01,onChange:Fe=>s({entropy:Fe})}),a.jsx(qr,{label:"Repulso Central (Beta)",value:e.beta,min:.05,max:.95,step:.01,onChange:Fe=>s({beta:Fe})})]}),a.jsx("div",{className:"h-px bg-white/[0.04]"}),d&&h&&a.jsxs("div",{className:"space-y-3",children:[a.jsx("h3",{className:"text-[10px] uppercase pb-1.5",style:{fontFamily:"'Doto', monospace",color:"rgba(255,255,255,0.50)",letterSpacing:"0.08em",borderBottom:"1px dashed rgba(255,255,255,0.05)"},children:"VIDA (4.5)"}),a.jsx("p",{className:"text-white/30 text-[9px] font-light italic leading-relaxed",children:"Sistema unificado de energia, mutao e evoluo"}),a.jsxs("div",{children:[a.jsx("label",{className:"text-white/40 text-[9px] tracking-wide uppercase font-light block mb-1.5",children:"Modo"}),a.jsxs("select",{value:d.mode,onChange:Fe=>h({mode:Fe.target.value}),className:"w-full text-white/70 text-[10px] py-1.5 px-2 focus:outline-none transition-colors",style:{background:"rgba(0,0,0,0.4)",border:"1px dashed rgba(255,255,255,0.08)",fontFamily:"'IBM Plex Mono', monospace"},children:[a.jsx("option",{value:"OFF",children:"OFF (Esttico)"}),a.jsx("option",{value:"METABOLIC",children:"METABLICO (Apenas energia)"}),a.jsx("option",{value:"EVOLUTIVE",children:"EVOLUTIVO (Apenas mutao)"}),a.jsx("option",{value:"FULL",children:"COMPLETO (Todos os sistemas)"})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx("input",{type:"checkbox",id:"foodEnabled",checked:d.foodEnabled,onChange:Fe=>h({foodEnabled:Fe.target.checked}),className:"w-2.5 h-2.5 bg-transparent border border-white/15 checked:bg-white/20 cursor-pointer"}),a.jsx("label",{htmlFor:"foodEnabled",className:"text-white/40 text-[10px] font-light cursor-pointer uppercase tracking-wide",children:"Comida Ativada"})]}),d.foodEnabled&&a.jsx(qr,{label:"Proporo de Comida",value:d.foodRatio,min:.05,max:.5,step:.05,onChange:Fe=>h({foodRatio:Fe})})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx("input",{type:"checkbox",id:"energyEnabled",checked:d.energyEnabled,onChange:Fe=>h({energyEnabled:Fe.target.checked}),className:"w-2.5 h-2.5 bg-transparent border border-white/15 checked:bg-white/20 cursor-pointer"}),a.jsx("label",{htmlFor:"energyEnabled",className:"text-white/40 text-[10px] font-light cursor-pointer uppercase tracking-wide",children:"Energia Ativada"})]}),d.energyEnabled&&a.jsxs(a.Fragment,{children:[a.jsx(qr,{label:"Decaimento de Energia",value:d.energyDecay,min:1e-4,max:.01,step:1e-4,onChange:Fe=>h({energyDecay:Fe})}),a.jsx(qr,{label:"Taxa de Alimentao",value:d.energyFeedRate,min:.01,max:.2,step:.01,onChange:Fe=>h({energyFeedRate:Fe})}),a.jsx(qr,{label:"Limiar de Reproduo",value:d.energyReproThreshold,min:1.5,max:3,step:.1,onChange:Fe=>h({energyReproThreshold:Fe})})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(qr,{label:"Dial de Mutao",value:d.mutationDial,min:0,max:1,step:.01,onChange:Fe=>h({mutationDial:Fe})}),a.jsxs("div",{className:"space-y-0.5 p-2 bg-white/[0.02]",style:{border:"1px dashed rgba(255,255,255,0.04)"},children:[a.jsxs("div",{className:"flex justify-between text-[9px]",children:[a.jsx("span",{className:"text-white/30",children:"Taxa de Mutao:"}),a.jsx("span",{className:"text-white/60 font-mono",children:d.mutationRate.toFixed(5)})]}),a.jsxs("div",{className:"flex justify-between text-[9px]",children:[a.jsx("span",{className:"text-white/30",children:"Estabilidade de Tipo:"}),a.jsx("span",{className:"text-white/60 font-mono",children:d.typeStability.toFixed(3)})]}),a.jsxs("div",{className:"flex justify-between text-[9px]",children:[a.jsx("span",{className:"text-white/30",children:"Intensidade de Mutao:"}),a.jsx("span",{className:"text-white/60 font-mono",children:d.mutationAmount.toFixed(3)})]}),a.jsxs("div",{className:"flex justify-between text-[9px]",children:[a.jsx("span",{className:"text-white/30",children:"Taxa de Reconfigurao:"}),a.jsx("span",{className:"text-white/60 font-mono",children:d.reconfigRate.toFixed(3)})]})]})]}),a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx("input",{type:"checkbox",id:"reconfigEnabled",checked:d.reconfigEnabled,onChange:Fe=>h({reconfigEnabled:Fe.target.checked}),className:"w-2.5 h-2.5 bg-transparent border border-white/15 checked:bg-white/20 cursor-pointer"}),a.jsx("label",{htmlFor:"reconfigEnabled",className:"text-white/40 text-[10px] font-light cursor-pointer uppercase tracking-wide",children:"Mutao Macro (Reconfig)"})]}),f&&a.jsxs("div",{className:"space-y-1 p-2",style:{background:"rgba(16,212,91,0.04)",border:"1px dashed rgba(16,212,91,0.10)"},children:[a.jsx("div",{className:"text-white/50 text-[9px] uppercase tracking-wide mb-1",children:"Estatsticas ao Vivo"}),a.jsxs("div",{className:"grid grid-cols-2 gap-x-2 gap-y-0.5 text-[9px]",children:[a.jsx("span",{className:"text-white/30",children:"Nascimentos:"}),a.jsx("span",{className:"text-green-400/80 font-mono text-right",children:f.births}),a.jsx("span",{className:"text-white/30",children:"Mortes:"}),a.jsx("span",{className:"text-red-400/80 font-mono text-right",children:f.deaths}),a.jsx("span",{className:"text-white/30",children:"Mutaes:"}),a.jsx("span",{className:"text-purple-400/80 font-mono text-right",children:f.mutations}),a.jsx("span",{className:"text-white/30",children:"Especiao:"}),a.jsx("span",{className:"text-blue-400/80 font-mono text-right",children:f.speciation})]}),f.lastEvent&&a.jsx("div",{className:"text-white/40 text-[9px] mt-1 italic",children:f.lastEvent})]})]}),a.jsx("div",{className:"h-px bg-white/[0.04]"}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("h3",{className:"text-[10px] uppercase pb-1.5",style:{fontFamily:"'Doto', monospace",color:"rgba(255,255,255,0.50)",letterSpacing:"0.08em",borderBottom:"1px dashed rgba(255,255,255,0.05)"},children:"Campo"}),a.jsx(qr,{label:"Difuso (Espalha)",value:t.diffusionRate,min:.3,max:.99,step:.01,onChange:Fe=>l({diffusionRate:Fe})}),a.jsx(qr,{label:"Decaimento (Evap.)",value:t.decayRate,min:0,max:.2,step:.001,onChange:Fe=>l({decayRate:Fe})})]}),a.jsx("div",{className:"h-px bg-white/[0.04]"}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("h3",{className:"text-[10px] uppercase pb-1.5",style:{fontFamily:"'Doto', monospace",color:"rgba(255,255,255,0.50)",letterSpacing:"0.08em",borderBottom:"1px dashed rgba(255,255,255,0.05)"},children:"Renderizao"}),ce&&a.jsxs("div",{children:[a.jsx("label",{className:"text-white/40 text-[9px] tracking-wide uppercase font-light block mb-1.5",children:"Qualidade"}),a.jsx("div",{className:"grid grid-cols-3 gap-1.5",children:["FAST","HIGH","ULTRA"].map(Fe=>a.jsx("button",{onClick:()=>ce(Fe),className:"text-[10px] py-1 px-1.5 transition-all uppercase",style:{fontFamily:$c,border:le===Fe?"1px dashed rgba(255,212,0,0.25)":"1px dashed rgba(255,255,255,0.06)",color:le===Fe?"#ffd400":"rgba(255,255,255,0.40)",background:le===Fe?"rgba(255,212,0,0.04)":"transparent"},children:Fe},Fe))})]}),te&&a.jsx(qr,{label:"Tamanho do Ponto",value:pe,min:1,max:6,step:.5,onChange:te,unit:"px"}),b&&a.jsx(qr,{label:"Brilho do Ponto",value:g,min:1,max:12,step:.5,onChange:b,unit:"px"}),C&&a.jsx(qr,{label:"Intensidade Glow",value:y,min:0,max:2,step:.1,onChange:C}),k&&a.jsxs("div",{className:"space-y-1.5",children:[a.jsxs("div",{className:"flex items-baseline justify-between",children:[a.jsx("label",{className:"text-white/40 text-[9px] tracking-wide uppercase font-light",children:"Paleta de Cores"}),a.jsx("span",{className:"text-white/80 text-[11px] font-mono font-semibold",children:((Ze=ci[v%ci.length])==null?void 0:Ze.name)||`#${v}`})]}),a.jsx("button",{type:"button",onClick:Fe=>{Fe.preventDefault(),Fe.stopPropagation();const Xe=Math.floor(Math.random()*ci.length);console.log("[Patchboard] Randomizing palette:",{old:v,new:Xe}),k(Xe)},className:"w-full text-[10px] py-2.5 px-2 transition-all uppercase cursor-pointer",style:{border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.45)",fontFamily:$c,letterSpacing:"0.06em"},children:"Randomizar Cores"})]}),a.jsx("div",{children:a.jsx("button",{onClick:()=>{ae&&ae()},className:"w-full text-[10px] py-2.5 px-2 transition-all uppercase cursor-pointer",style:{border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.45)",fontFamily:$c,letterSpacing:"0.06em"},children:"Fundo do Canvas"})})]}),a.jsx("div",{className:"h-px bg-white/[0.04]"}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("h3",{className:"text-[10px] uppercase pb-1.5",style:{fontFamily:"'Doto', monospace",color:"rgba(255,255,255,0.50)",letterSpacing:"0.08em",borderBottom:"1px dashed rgba(255,255,255,0.05)"},children:"Overlays"}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[a.jsx("input",{type:"checkbox",id:"showBonds",checked:we,onChange:Fe=>J==null?void 0:J(Fe.target.checked),className:"w-3 h-3 border-white/15 bg-white/[0.05] checked:bg-cyan-500/50 cursor-pointer"}),a.jsx("label",{htmlFor:"showBonds",className:"text-white/70 text-[10px] font-light cursor-pointer",children:"Conexes (Bonds)"})]}),we&&a.jsxs("div",{className:"space-y-2 pl-4",children:[ke&&a.jsx(qr,{label:"Distncia",value:Re,min:.01,max:.5,step:.01,onChange:ke}),Le&&a.jsx(qr,{label:"Opacidade",value:ge,min:.05,max:1,step:.05,onChange:Le})]})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[a.jsx("input",{type:"checkbox",id:"showTrails",checked:Ae,onChange:Fe=>K==null?void 0:K(Fe.target.checked),className:"w-3 h-3 border-white/15 bg-white/[0.05] checked:bg-cyan-500/50 cursor-pointer"}),a.jsx("label",{htmlFor:"showTrails",className:"text-white/70 text-[10px] font-light cursor-pointer",children:"Rastros (Trails)"})]}),Ae&&a.jsxs("div",{className:"space-y-2 pl-4",children:[et&&a.jsx(qr,{label:"Comprimento",value:tt,min:5,max:60,step:5,onChange:et,unit:" pts"}),dt&&a.jsx(qr,{label:"Opacidade",value:We,min:.1,max:1,step:.05,onChange:dt})]})]})]})]}),a.jsx("div",{className:"h-px bg-white/[0.04]"}),Rt&&Wt&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"space-y-3",children:[a.jsx("h3",{className:"text-[10px] uppercase pb-1.5",style:{fontFamily:"'Doto', monospace",color:"rgba(255,255,255,0.50)",letterSpacing:"0.08em",borderBottom:"1px dashed rgba(255,255,255,0.05)"},children:"SIGILS (RecursiveLab)"}),a.jsx("p",{className:"text-white/30 text-[9px] font-light italic leading-relaxed",children:"Sistema de deteco de arqutipos baseado em smbolos depositados por interaes locais."}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"checkbox",id:"sigilsEnabled",checked:Rt.enabled,onChange:Fe=>Wt({enabled:Fe.target.checked}),className:"w-3 h-3 border-white/15 bg-white/[0.05] checked:bg-cyan-500/50 cursor-pointer"}),a.jsx("label",{htmlFor:"sigilsEnabled",className:"text-white/70 text-[10px] font-light cursor-pointer",children:"Sistema de Sigils Ativo"})]}),Rt.enabled&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center gap-2 pl-4",children:[a.jsx("input",{type:"checkbox",id:"sigilsShowOverlay",checked:Rt.showOverlay,onChange:Fe=>Wt({showOverlay:Fe.target.checked}),className:"w-3 h-3 border-white/15 bg-white/[0.05] checked:bg-cyan-500/50 cursor-pointer"}),a.jsx("label",{htmlFor:"sigilsShowOverlay",className:"text-white/70 text-[10px] font-light cursor-pointer",children:"Mostrar Overlay (Tecla: S)"})]}),a.jsxs("div",{className:"space-y-2 pl-4",children:[a.jsx(qr,{label:"Influncia",value:Rt.influence,min:0,max:1,step:.05,onChange:Fe=>Wt({influence:Fe})}),a.jsx(qr,{label:"Depsito",value:Rt.deposit,min:0,max:2,step:.1,onChange:Fe=>Wt({deposit:Fe})}),a.jsx(qr,{label:"Difuso",value:Rt.diffusion,min:0,max:.3,step:.01,onChange:Fe=>Wt({diffusion:Fe})}),a.jsx(qr,{label:"Decaimento",value:Rt.decay,min:0,max:2,step:.05,onChange:Fe=>Wt({decay:Fe})})]}),$e&&a.jsx("div",{className:"pl-4 space-y-1.5",children:a.jsx("button",{onClick:$e,className:"w-full text-[10px] py-1.5 px-2 transition-all uppercase cursor-pointer",style:{border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.35)",fontFamily:$c,letterSpacing:"0.06em"},children:"Limpar Sigils"})}),a.jsxs("div",{className:"space-y-1.5 pl-4",children:[a.jsx("div",{className:"text-white/40 text-[9px] tracking-wide uppercase font-light",children:"Smbolos:"}),a.jsxs("div",{className:"grid grid-cols-2 gap-1 text-[10px]",children:[a.jsx("div",{className:"text-cyan-400/70",children:" Vnculo"}),a.jsx("div",{className:"text-red-400/70",children:" Ruptura"}),a.jsx("div",{className:"text-green-400/70",children:" Florescer"}),a.jsx("div",{className:"text-purple-400/70",children:" Juramento"})]})]}),a.jsxs("div",{className:"space-y-1.5 pl-4",children:[a.jsxs("div",{className:"text-white/40 text-[9px] tracking-wide uppercase font-light border-b border-white/[0.06] pb-1",children:["Arqutipos Detectados (",(Zt==null?void 0:Zt.length)||0,")"]}),Zt&&Zt.length>0?a.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:Zt.slice(0,8).map(Fe=>a.jsxs("div",{className:"text-[9px] text-white/50 flex items-center gap-1.5",children:[a.jsx("span",{className:"text-[11px]",children:Fe.sigil}),a.jsx("span",{className:"font-mono",children:Fe.name}),a.jsxs("span",{className:"text-white/30 text-[8px]",children:["(",Fe.particleCount||"?","p)"]})]},Fe.id))}):a.jsx("div",{className:"text-[9px] text-white/30 italic",children:"Nenhum arqutipo emergiu ainda  aumente entropia e aguarde"})]}),a.jsxs("div",{className:"pl-4 space-y-1.5 p-2 text-[9px] text-white/40 leading-relaxed",style:{background:"rgba(255,255,255,0.02)",border:"1px dashed rgba(255,255,255,0.04)"},children:[a.jsx("div",{className:"text-white/60 font-semibold uppercase tracking-wide text-[8px]",children:"COMO FUNCIONA:"}),a.jsxs("div",{children:[" ",a.jsx("strong",{children:"Mutao:"})," genes mudam com entropia (se metamorphosis on)"]}),a.jsxs("div",{children:[" ",a.jsx("strong",{children:"Especiao:"})," quando padres divergem, arqutipo emerge"]}),a.jsxs("div",{children:[" ",a.jsx("strong",{children:"Sigils:"})," smbolos depositados por interaes e decaem/difundem"]})]})]})]}),a.jsx("div",{className:"h-px bg-white/[0.04]"})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("h3",{className:"text-[10px] uppercase pb-1.5",style:{fontFamily:"'Doto', monospace",color:"rgba(255,255,255,0.50)",letterSpacing:"0.08em",borderBottom:"1px dashed rgba(255,255,255,0.05)"},children:"Reconfiguration"}),a.jsx("p",{className:"text-white/30 text-[9px] font-light italic leading-relaxed",children:"Detection interval controls when macro mutations can occur. Mutation rate/amount now controlled by Life Dial."}),a.jsx(qr,{label:"Detection Interval",value:r.detectionInterval,min:1,max:10,step:.5,onChange:Fe=>i({detectionInterval:Fe}),unit:"s"})]})]})},L4="'IBM Plex Mono', monospace",DT=({matrix:e,typesCount:t,onMatrixChange:r,onRandomize:o,onSoften:s,onSymmetrize:l,onInvert:i,onNormalize:u})=>{const[c,d]=w.useState("attract"),[h,f]=w.useState(!1),g=(S,C,k)=>{const R={...e};c==="attract"?R.attract[S][C]=Math.max(-1,Math.min(1,e.attract[S][C]+k)):c==="radius"?R.radius[S][C]=Math.max(0,Math.min(.3,e.radius[S][C]+k*.01)):c==="falloff"&&(R.falloff[S][C]=Math.max(.5,Math.min(3,e.falloff[S][C]+k*.1))),r(R)},m=(S,C)=>c==="attract"?e.attract[S][C]:c==="radius"?e.radius[S][C]:e.falloff[S][C],y=S=>{if(c==="attract")if(S>0){const k=Math.floor(S*255);return`rgb(${k}, 255, ${k})`}else{const k=Math.floor(-S*255);return`rgb(255, ${k}, ${k})`}const C=Math.floor(S/3*255);return`rgb(${C}, ${C}, 255)`},v=S=>({fontFamily:L4,fontSize:9,padding:"3px 10px",textTransform:"uppercase",letterSpacing:"0.06em",cursor:"pointer",transition:"all 0.15s",border:S?"1px dashed rgba(255,212,0,0.25)":"1px dashed rgba(255,255,255,0.06)",color:S?"#ffd400":"rgba(255,255,255,0.40)",background:S?"rgba(255,212,0,0.04)":"transparent"}),b={fontFamily:L4,fontSize:9,padding:"6px 10px",textTransform:"uppercase",letterSpacing:"0.06em",cursor:"pointer",transition:"all 0.15s",border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.40)",background:"transparent"};return a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"flex gap-2",children:["attract","radius","falloff"].map(S=>a.jsx("button",{onClick:()=>d(S),style:v(c===S),children:S},S))}),a.jsx("div",{className:"overflow-auto max-h-96",children:a.jsx("div",{className:"grid gap-1",style:{gridTemplateColumns:`repeat(${t}, 1fr)`},onMouseLeave:()=>f(!1),children:Array.from({length:t}).map((S,C)=>Array.from({length:t}).map((k,R)=>{const j=m(C,R);return a.jsx("div",{className:"aspect-square cursor-pointer transition-all",style:{backgroundColor:y(j),border:"1px dashed rgba(255,255,255,0.08)"},onMouseDown:()=>f(!0),onMouseUp:()=>f(!1),onMouseEnter:T=>{h&&g(C,R,T.shiftKey?-.1:.1)},onClick:T=>g(C,R,T.shiftKey?-.1:.1),title:`${C}  ${R}: ${j.toFixed(2)}`},`${C}-${R}`)}))})}),a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsx("button",{onClick:o,style:b,children:"Randomize"}),a.jsx("button",{onClick:s,style:b,children:"Soften"}),a.jsx("button",{onClick:l,style:b,children:"Symmetrize"}),a.jsx("button",{onClick:i,style:b,children:"Invert"}),a.jsx("button",{onClick:u,style:{...b,gridColumn:"span 2"},children:"Normalize"})]})]})},LT="'Doto', monospace",_f="'IBM Plex Mono', monospace",s2={fontFamily:LT,fontSize:10,color:"rgba(255,255,255,0.50)",letterSpacing:"0.08em",textTransform:"uppercase",paddingBottom:5,borderBottom:"1px dashed rgba(255,255,255,0.05)",marginBottom:6},df={fontFamily:_f,fontSize:9,cursor:"pointer",transition:"all 0.15s",border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.45)",background:"transparent",textTransform:"uppercase",letterSpacing:"0.06em"},zT=({currentSeed:e,onLoadSeed:t})=>{const[r,o]=w.useState(""),[s,l]=w.useState(!1),[i,u]=w.useState(()=>{try{const m=localStorage.getItem("metalife-saved-seeds");return m?JSON.parse(m):[]}catch{return[]}}),c=async()=>{try{await navigator.clipboard.writeText(e.toString()),l(!0),Kn.success("Seed copiado!"),setTimeout(()=>l(!1),2e3)}catch{const m=document.createElement("textarea");m.value=e.toString(),document.body.appendChild(m),m.select();try{document.execCommand("copy"),l(!0),Kn.success("Seed copiado!"),setTimeout(()=>l(!1),2e3)}catch{Kn.error("Erro ao copiar seed")}document.body.removeChild(m)}},d=()=>{if(i.includes(e)){Kn.info("Seed j salvo");return}const m=[...i,e];u(m),localStorage.setItem("metalife-saved-seeds",JSON.stringify(m)),Kn.success("Seed salvo!")},h=()=>{const m=parseInt(r);if(isNaN(m)){Kn.error("Seed invlido");return}t(m),o(""),Kn.success("Seed carregado!")},f=m=>{t(m),Kn.success("Seed carregado!")},g=m=>{const y=i.filter(v=>v!==m);u(y),localStorage.setItem("metalife-saved-seeds",JSON.stringify(y)),Kn.success("Seed removido")};return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("h3",{style:s2,children:"Seed Atual"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("div",{style:{fontFamily:_f,fontSize:11,color:"rgba(255,255,255,0.55)",padding:"5px 10px",border:"1px dashed rgba(255,255,255,0.06)",flex:1},children:e}),a.jsx("button",{onClick:c,style:{...df,padding:"5px 10px"},children:s?a.jsx(kx,{size:12,style:{color:"#10d45b"}}):a.jsx(PC,{size:12})}),a.jsx("button",{onClick:d,style:{...df,padding:"5px 10px"},children:"Salvar"})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("h3",{style:s2,children:"Carregar Seed"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"text",value:r,onChange:m=>o(m.target.value),onKeyDown:m=>m.key==="Enter"&&h(),placeholder:"Cole um seed...",className:"flex-1 focus:outline-none",style:{fontFamily:_f,fontSize:10,color:"rgba(255,255,255,0.55)",padding:"5px 10px",border:"1px dashed rgba(255,255,255,0.06)",background:"transparent"}}),a.jsx("button",{onClick:h,disabled:!r,className:"disabled:opacity-30 disabled:cursor-not-allowed",style:{...df,padding:"5px 10px"},children:"Carregar"})]})]}),i.length>0&&a.jsxs("div",{className:"space-y-2",children:[a.jsx("h3",{style:s2,children:"Seeds Salvos"}),a.jsx("div",{className:"space-y-1 max-h-64 overflow-auto",children:i.map(m=>a.jsxs("div",{className:"flex items-center gap-2 p-2 transition-colors",style:{background:"rgba(255,255,255,0.02)",border:"1px dashed rgba(255,255,255,0.04)"},children:[a.jsx("span",{style:{flex:1,fontFamily:_f,fontSize:10,color:"rgba(255,255,255,0.45)"},children:m}),a.jsx("button",{onClick:()=>f(m),style:{...df,padding:"3px 8px"},children:"Carregar"}),a.jsx("button",{onClick:()=>g(m),style:{...df,padding:"3px 8px",color:"rgba(255,80,80,0.55)"},children:""})]},m))})]}),a.jsx("div",{style:{paddingTop:8,borderTop:"1px dashed rgba(255,255,255,0.04)"},children:a.jsx("p",{style:{fontFamily:_f,fontSize:9,color:"rgba(255,255,255,0.22)",lineHeight:1.5},children:"Seeds determinam o universo gerado. Compartilhe seeds para recriar mundos idnticos!"})})]})},BT=({organisms:e,onSpawnOrganism:t,onDeleteOrganism:r,onRenameOrganism:o,captureMode:s,onCaptureModeChange:l,brushRadius:i,onBrushRadiusChange:u})=>{const[c,d]=w.useState(null),[h,f]=w.useState(null),[g,m]=w.useState(""),y=v=>{g.trim()&&o(v,g.trim()),f(null),m("")};return a.jsxs("div",{className:"space-y-3 overflow-y-auto max-h-[calc(100vh-200px)]",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h2",{className:"text-white/80 text-[11px] tracking-[0.15em] uppercase font-light",children:"Codex"}),a.jsxs("div",{className:"text-white/40 text-[9px] font-mono",children:[e.length," organisms"]})]}),a.jsxs("div",{className:"p-3 space-y-3",style:{border:"1px dashed rgba(255,255,255,0.04)",background:"rgba(0,0,0,0.05)"},children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-white/60 text-[10px] uppercase tracking-wide font-light",children:"Capture Mode"}),a.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:s,onChange:v=>l(v.target.checked),className:"sr-only peer"}),a.jsx("div",{className:"w-9 h-5 bg-white/10 peer-focus:outline-none peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white/40 after:border-white/20 after:border after:h-4 after:w-4 after:transition-all peer-checked:bg-yellow-500/30 peer-checked:after:bg-yellow-400"})]})]}),s&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"space-y-1.5",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("label",{className:"text-white/50 text-[9px] uppercase tracking-wide font-light",children:"Brush Radius"}),a.jsxs("span",{className:"text-white/40 text-[9px] font-mono",children:[i,"px"]})]}),a.jsx("input",{type:"range",min:20,max:200,step:5,value:i,onChange:v=>u(Number(v.target.value)),className:"w-full h-1.5 bg-white/10 appearance-none cursor-pointer accent-yellow-500"})]}),a.jsx("div",{className:"text-white/40 text-[9px] leading-relaxed p-2",style:{background:"rgba(255,212,0,0.03)",border:"1px dashed rgba(255,212,0,0.08)"},children:a.jsxs("div",{className:"flex items-start gap-1.5",children:[a.jsx("span",{className:"text-yellow-400/80",children:""}),a.jsxs("div",{children:[a.jsx("div",{className:"font-medium text-yellow-400/90 mb-0.5",children:"Capture Instructions:"}),a.jsx("div",{children:" Click on canvas to capture organism"}),a.jsx("div",{children:" Adjust brush radius to control area"}),a.jsx("div",{children:" Captured organisms appear below"})]})]})})]})]}),e.length===0?a.jsxs("div",{className:"text-white/30 text-[10px] text-center py-8 space-y-2",style:{border:"1px dashed rgba(255,255,255,0.04)"},children:[a.jsx("p",{children:"No organisms captured yet"}),a.jsx("p",{className:"text-white/20 text-[9px]",children:"Enable capture mode and click on canvas"})]}):a.jsx("div",{className:"grid grid-cols-2 gap-2",children:e.map(v=>a.jsxs("div",{className:`
                relative border p-2 cursor-pointer transition-all
                ${c===v.id?"border-white/30 bg-white/[0.04]":"border-white/10 hover:border-white/20"}
              `,onClick:()=>d(v.id),children:[a.jsx("div",{className:"flex justify-center mb-2 bg-black/10 overflow-hidden",children:v.thumbnail?a.jsx("img",{src:v.thumbnail,alt:v.name,className:"w-full h-auto",style:{imageRendering:"pixelated"}}):a.jsx("div",{className:"w-full aspect-square flex items-center justify-center text-white/20 text-[8px]",children:"No preview"})}),h===v.id?a.jsx("input",{type:"text",value:g,onChange:b=>m(b.target.value),onBlur:()=>y(v.id),onKeyDown:b=>{b.key==="Enter"&&y(v.id),b.key==="Escape"&&(f(null),m(""))},className:"w-full bg-white/5 px-1 py-0.5 text-white text-[9px] font-mono focus:outline-none",style:{border:"1px dashed rgba(255,255,255,0.10)"},autoFocus:!0}):a.jsx("div",{className:"text-white/70 text-[9px] font-mono text-center truncate mb-1",onDoubleClick:()=>{f(v.id),m(v.name)},children:v.name}),a.jsxs("div",{className:"text-white/40 text-[8px] text-center mb-2",children:[v.particles.length," particles"]}),a.jsxs("div",{className:"flex gap-1",children:[a.jsx("button",{onClick:b=>{b.stopPropagation(),t(v.id)},className:"flex-1 text-white/60 hover:text-white text-[8px] uppercase py-1 transition-all",style:{border:"1px dashed rgba(255,255,255,0.06)"},children:"Summon"}),a.jsx("button",{onClick:b=>{b.stopPropagation(),window.confirm(`Delete ${v.name}?`)&&(r(v.id),c===v.id&&d(null))},className:"text-red-400/60 hover:text-red-400 text-[8px] uppercase px-2 py-1 transition-all",style:{border:"1px dashed rgba(255,80,80,0.15)"},children:""})]})]},v.id))}),c&&e.find(v=>v.id===c)&&a.jsx("div",{className:"border-t border-white/[0.06] pt-3 mt-3",children:(()=>{const v=e.find(b=>b.id===c);return a.jsxs("div",{className:"space-y-2 text-[9px] text-white/50 font-mono",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Size:"}),a.jsxs("span",{children:[v.width.toFixed(2),"  ",v.height.toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Captured:"}),a.jsx("span",{children:new Date(v.timestamp).toLocaleTimeString()})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Types:"}),a.jsx("span",{children:v.captureContext.typesCount})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Seed:"}),a.jsxs("span",{children:["#",v.captureContext.seed.toString(16).slice(0,6)]})]})]})})()})]})},$T=({fps:e,particleCount:t,fieldCellCount:r,artifactCount:o,speciesCount:s,avgTension:l,avgCohesion:i,avgScarcity:u,diversity:c,stats:d})=>{const[h,f]=w.useState([]),[g,m]=w.useState(0);w.useEffect(()=>{if(f(R=>{const j=[...R,e];return j.length>60&&j.shift(),j}),performance&&performance.memory){const j=performance.memory.usedJSHeapSize/(1024*1024);m(j)}},[e]);const y=h.length>0?h.reduce((R,j)=>R+j,0)/h.length:e,v=h.length>0?Math.min(...h):e,b=h.length>0?Math.max(...h):e,S=({icon:R,label:j,value:T,color:_="text-white/60"})=>a.jsxs("div",{className:"flex items-center justify-between py-1",children:[a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx("div",{className:"text-white/40",children:R}),a.jsx("span",{className:"text-white/40 text-[10px] uppercase tracking-wide",children:j})]}),a.jsx("span",{className:`font-mono text-[10px] ${_}`,children:T})]}),C=({label:R,value:j,max:T=1,color:_})=>{const P=Math.min(100,j/T*100);return a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-white/40 text-[10px] uppercase tracking-wide",children:R}),a.jsx("span",{className:"text-white/60 text-[10px] font-mono",children:j.toFixed(2)})]}),a.jsx("div",{className:"w-full h-1 bg-white/5 overflow-hidden",children:a.jsx("div",{className:`h-full ${_} transition-all duration-300`,style:{width:`${P}%`}})})]})},k=R=>R>=55?"text-white/80":R>=30?"text-white/60":"text-white/40";return a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"bg-white/[0.02] p-2.5",style:{border:"1px dashed rgba(255,255,255,0.04)"},children:[a.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[a.jsx(Dc,{size:12,className:"text-white/50",strokeWidth:1.5}),a.jsx("h3",{className:"text-white/70 text-[10px] uppercase tracking-wider",children:"Taxa de Quadros"})]}),a.jsxs("div",{className:"space-y-1.5",children:[a.jsx(S,{icon:a.jsx(Es,{size:11,strokeWidth:1.5}),label:"Atual",value:`${e}`,color:k(e)}),a.jsx(S,{icon:a.jsx(Dc,{size:11,strokeWidth:1.5}),label:"Mdia",value:`${y.toFixed(1)}`,color:k(y)}),a.jsxs("div",{className:"flex items-center justify-between text-[9px] pt-0.5",children:[a.jsxs("span",{className:"text-white/30",children:["Mn: ",v.toFixed(0)]}),a.jsxs("span",{className:"text-white/30",children:["Mx: ",b.toFixed(0)]})]})]}),a.jsx("div",{className:"mt-2 h-10 flex items-end gap-[1px]",children:h.slice(-30).map((R,j)=>{const T=Math.max(2,R/60*100),_=R>=55?"bg-white/40":R>=30?"bg-white/25":"bg-white/15";return a.jsx("div",{className:`flex-1 ${_} transition-all`,style:{height:`${T}%`}},j)})})]}),a.jsxs("div",{className:"bg-white/[0.02] p-2.5",style:{border:"1px dashed rgba(255,255,255,0.04)"},children:[a.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[a.jsx(h9,{size:12,className:"text-white/50",strokeWidth:1.5}),a.jsx("h3",{className:"text-white/70 text-[10px] uppercase tracking-wider",children:"Carga do Sistema"})]}),a.jsxs("div",{className:"space-y-1.5",children:[a.jsx(S,{icon:a.jsx(n2,{size:11,strokeWidth:1.5}),label:"Partculas",value:t.toLocaleString(),color:"text-white/70"}),a.jsx(S,{icon:a.jsx(mh,{size:11,strokeWidth:1.5}),label:"Clulas Campo",value:r.toLocaleString(),color:"text-white/60"}),a.jsx(S,{icon:a.jsx(Es,{size:11,strokeWidth:1.5}),label:"Artefatos",value:o.toString(),color:"text-white/60"}),a.jsx(S,{icon:a.jsx(Dc,{size:11,strokeWidth:1.5}),label:"Espcies",value:s.toString(),color:"text-white/70"}),g>0&&a.jsx(S,{icon:a.jsx(n2,{size:11,strokeWidth:1.5}),label:"Memria",value:`${g.toFixed(1)} MB`,color:"text-white/60"})]})]}),a.jsxs("div",{className:"bg-white/[0.02] p-2.5",style:{border:"1px dashed rgba(255,255,255,0.04)"},children:[a.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[a.jsx(mh,{size:12,className:"text-white/50",strokeWidth:1.5}),a.jsx("h3",{className:"text-white/70 text-[10px] uppercase tracking-wider",children:"Mtricas de Campo"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(C,{label:"Tenso",value:l,color:"bg-white/60"}),a.jsx(C,{label:"Coeso",value:i,color:"bg-white/50"}),a.jsx(C,{label:"Escassez",value:u,color:"bg-white/40"}),a.jsx(C,{label:"Diversidade",value:c,color:"bg-white/30"})]})]}),d&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"bg-white/[0.02] p-2.5",style:{border:"1px dashed rgba(255,255,255,0.04)"},children:[a.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[a.jsx(Dc,{size:12,className:"text-yellow-400/70",strokeWidth:1.5}),a.jsx("h3",{className:"text-white/70 text-[10px] uppercase tracking-wider",children:"Eventos Emergentes"})]}),a.jsxs("div",{className:"space-y-1.5",children:[a.jsx(S,{icon:a.jsx("span",{className:"text-[10px]",children:""}),label:"Total Beats",value:d.totalBeats.toString(),color:"text-yellow-400/80"}),a.jsx(S,{icon:a.jsx("span",{className:"text-[10px]",children:""}),label:"Especiaes",value:d.totalSpeciations.toString(),color:"text-green-400/80"}),a.jsx(S,{icon:a.jsx("span",{className:"text-[10px]",children:""}),label:"Instituies",value:d.totalInstitutions.toString(),color:"text-purple-400/80"}),a.jsx(S,{icon:a.jsx(Es,{size:11,strokeWidth:1.5}),label:"Mutaes",value:d.totalMutations.toString(),color:"text-blue-400/80"}),a.jsx(S,{icon:a.jsx("span",{className:"text-[10px]",children:""}),label:"Mitose",value:d.totalMitosis.toString(),color:"text-pink-400/80"})]})]}),a.jsxs("div",{className:"bg-white/[0.02] p-2.5",style:{border:"1px dashed rgba(255,255,255,0.04)"},children:[a.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[a.jsx(Es,{size:12,className:"text-orange-400/70",strokeWidth:1.5}),a.jsx("h3",{className:"text-white/70 text-[10px] uppercase tracking-wider",children:"Recordes da Sesso"})]}),a.jsxs("div",{className:"space-y-1.5",children:[a.jsx(S,{icon:a.jsx(n2,{size:11,strokeWidth:1.5}),label:"Pico de Partculas",value:d.peakParticleCount.toLocaleString(),color:"text-orange-400/80"}),a.jsx(S,{icon:a.jsx(mh,{size:11,strokeWidth:1.5}),label:"Pico de Diversidade",value:d.peakDiversity.toFixed(3),color:"text-cyan-400/80"}),a.jsx(S,{icon:a.jsx(Es,{size:11,strokeWidth:1.5}),label:"Pico de Tenso",value:d.peakTension.toFixed(3),color:"text-red-400/80"}),a.jsx(S,{icon:a.jsx(Dc,{size:11,strokeWidth:1.5}),label:"Pico de Coeso",value:d.peakCohesion.toFixed(3),color:"text-green-400/80"})]})]}),a.jsxs("div",{className:"bg-white/[0.02] p-2.5",style:{border:"1px dashed rgba(255,255,255,0.04)"},children:[a.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[a.jsx(Dc,{size:12,className:"text-white/50",strokeWidth:1.5}),a.jsx("h3",{className:"text-white/70 text-[10px] uppercase tracking-wider",children:"Tempo de Simulao"})]}),a.jsx("div",{className:"text-white/60 text-[11px] font-mono text-center",children:(()=>{const R=Math.floor((Date.now()-d.simulationStartTime)/1e3),j=Math.floor(R/60),T=R%60;return`${j}m ${T}s`})()})]})]}),e<30&&a.jsx("div",{className:"bg-white/[0.02] p-2.5",style:{border:"1px dashed rgba(255,255,255,0.06)"},children:a.jsxs("div",{className:"flex items-start gap-1.5",children:[a.jsx(Dc,{size:11,className:"text-white/50 mt-0.5 flex-shrink-0",strokeWidth:1.5}),a.jsxs("div",{className:"space-y-0.5",children:[a.jsx("p",{className:"text-white/60 text-[10px] uppercase tracking-wide",children:"Aviso de Performance"}),a.jsx("p",{className:"text-white/40 text-[9px] leading-relaxed",children:"FPS baixo. Tente reduzir a contagem de partculas ou desativar rastros."})]})]})})]})},qT=({archetypesDetected:e,microState:t,microConfig:r,paletteIndex:o,sigilConfig:s,onSigilConfigChange:l,archetypeRegistry:i,lifeStats:u})=>{const c=w.useMemo(()=>{const d=new Array(r.typesCount).fill(0);for(let h=0;h<t.count;h++){const f=t.type[h];f>=0&&f<r.typesCount&&d[f]++}return d},[t.count,t.type,r.typesCount]);return a.jsxs("div",{className:"space-y-5",children:[a.jsxs("div",{className:"space-y-2 pb-3 border-b border-white/[0.06]",children:[a.jsxs("h2",{className:"text-white/90 text-[11px] tracking-[0.2em] uppercase font-light flex items-center gap-2",children:[a.jsx(a9,{size:12,strokeWidth:1.5}),"Tipos de Partculas"]}),a.jsx("p",{className:"text-white/50 text-[9px] font-light leading-relaxed",children:"Legenda das cores e populao de cada tipo de agente na simulao."})]}),u&&(u.births>0||u.deaths>0)&&a.jsxs("div",{className:"p-3 space-y-2",style:{background:"rgba(255,255,255,0.02)",border:"1px dashed rgba(255,255,255,0.04)"},children:[a.jsxs("div",{className:"flex items-center gap-2 text-white/90",children:[a.jsx(Dc,{size:12,strokeWidth:2}),a.jsx("span",{className:"text-[9px] uppercase tracking-wider font-medium",children:"Dinmica Populacional (ltimos 15s)"})]}),a.jsxs("div",{className:"grid grid-cols-3 gap-3 text-center",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"text-green-400 text-[16px] font-mono font-bold",children:["+",u.births]}),a.jsx("div",{className:"text-white/50 text-[8px] uppercase tracking-wide",children:"Nascimentos"})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"text-red-400 text-[16px] font-mono font-bold",children:["-",u.deaths]}),a.jsx("div",{className:"text-white/50 text-[8px] uppercase tracking-wide",children:"Mortes"})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:`text-[16px] font-mono font-bold ${u.births-u.deaths>=0?"text-cyan-400":"text-orange-400"}`,children:[u.births-u.deaths>=0?"+":"",u.births-u.deaths]}),a.jsx("div",{className:"text-white/50 text-[8px] uppercase tracking-wide",children:"Saldo"})]})]})]}),i.list.length>0&&a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-white/[0.06]",children:[a.jsx(X5,{size:12,strokeWidth:1.5}),a.jsx("h3",{className:"text-white/80 text-[9px] tracking-[0.15em] uppercase font-light",children:"Especiao Gentica"}),a.jsxs("span",{className:"text-white/40 text-[9px] font-mono ml-auto",children:[i.list.length," espcies"]})]}),a.jsx("div",{className:`space-y-2 max-h-[200px] overflow-y-auto pr-1
            [&::-webkit-scrollbar]:w-1 
            [&::-webkit-scrollbar-track]:bg-white/5 
            [&::-webkit-scrollbar-thumb]:bg-white/20 
            [&::-webkit-scrollbar-thumb]:bg-white/15
            [&::-webkit-scrollbar-thumb:hover]:bg-white/30`,children:i.list.slice(0,10).map(d=>a.jsxs("div",{className:"bg-white/[0.02] p-2.5 hover:bg-white/[0.04] transition-all",style:{border:"1px dashed rgba(255,255,255,0.04)"},children:[a.jsxs("div",{className:"flex items-start gap-2 mb-1.5",children:[a.jsx("div",{className:"text-xl leading-none",children:d.sigil}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"text-white/80 text-[10px] font-medium truncate",children:d.name}),d.notes.length>0&&a.jsx("div",{className:"text-white/50 text-[8px] mt-0.5",children:d.notes[0]})]})]}),a.jsxs("div",{className:"grid grid-cols-4 gap-1 text-[7px] text-white/40 font-mono",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-white/60",children:d.genes.a.toFixed(2)}),a.jsx("div",{children:"A"})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-white/60",children:d.genes.b.toFixed(2)}),a.jsx("div",{children:"B"})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-white/60",children:d.genes.c.toFixed(2)}),a.jsx("div",{children:"C"})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-white/60",children:d.genes.d.toFixed(2)}),a.jsx("div",{children:"D"})]})]})]},d.id))})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-baseline justify-between",children:[a.jsx("h3",{className:"text-white/80 text-[9px] tracking-[0.15em] uppercase font-light border-b border-white/[0.06] pb-1.5",children:"Tipos Ativos"}),a.jsxs("span",{className:"text-white/40 text-[9px] font-mono",children:[r.typesCount," tipos"]})]}),a.jsx("div",{className:`space-y-2 max-h-[300px] overflow-y-auto pr-1
          [&::-webkit-scrollbar]:w-1 
          [&::-webkit-scrollbar-track]:bg-white/5 
          [&::-webkit-scrollbar-thumb]:bg-white/20 
          [&::-webkit-scrollbar-thumb]:bg-white/15
          [&::-webkit-scrollbar-thumb:hover]:bg-white/30`,children:Array.from({length:r.typesCount}).map((d,h)=>{const f=c[h],g=t.count>0?(f/t.count*100).toFixed(1):"0.0",m=Eg(h,o,r.typesCount);return a.jsxs("div",{className:"bg-white/[0.02] p-3 hover:bg-white/[0.04] transition-all",style:{border:"1px dashed rgba(255,255,255,0.04)"},children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsx("div",{className:"w-4 h-4",style:{backgroundColor:m,border:"1px dashed rgba(255,255,255,0.15)"}}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"text-white/80 text-[11px] font-medium",children:["Tipo ",h]}),a.jsxs("div",{className:"text-white/40 text-[9px] font-mono",children:[f.toLocaleString()," partculas (",g,"%)"]})]})]}),a.jsx("div",{className:"h-1.5 bg-white/[0.06] overflow-hidden",children:a.jsx("div",{className:"h-full transition-all duration-300",style:{width:`${g}%`,backgroundColor:m}})})]},h)})})]}),a.jsxs("div",{className:"space-y-3 pt-4 border-t border-white/[0.06]",children:[a.jsxs("h3",{className:"text-white/80 text-[9px] tracking-[0.15em] uppercase font-light border-b border-white/[0.06] pb-1.5 flex items-center gap-2",children:[a.jsx(Yi,{size:10,strokeWidth:1.5}),"Sistema de Sigils (Padres)"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"checkbox",id:"sigilsEnabled",checked:s.enabled,onChange:d=>l({enabled:d.target.checked}),className:"w-3 h-3 border-white/15 bg-white/[0.05] checked:bg-cyan-500/50 cursor-pointer"}),a.jsx("label",{htmlFor:"sigilsEnabled",className:"text-white/70 text-[10px] font-light cursor-pointer",children:"Deteco de Padres Ativa"})]}),s.enabled&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center gap-2 pl-4",children:[a.jsx("input",{type:"checkbox",id:"showSigilOverlay",checked:s.showOverlay,onChange:d=>l({showOverlay:d.target.checked}),className:"w-3 h-3 border-white/15 bg-white/[0.05] checked:bg-cyan-500/50 cursor-pointer"}),a.jsx("label",{htmlFor:"showSigilOverlay",className:"text-white/60 text-[10px] font-light cursor-pointer",children:"Mostrar Overlay (Tecla: S)"})]}),e.length>0&&a.jsxs("div",{className:"mt-3 space-y-2",children:[a.jsxs("div",{className:"text-white/60 text-[9px] font-light",children:["Padres detectados: ",e.length]}),a.jsxs("div",{className:"bg-white/[0.02] p-2 space-y-1",style:{border:"1px dashed rgba(255,255,255,0.04)"},children:[e.slice(0,5).map(d=>a.jsxs("div",{className:"flex items-center gap-2 text-[9px]",children:[a.jsx("span",{className:"text-lg",children:d.sigil}),a.jsx("span",{className:"text-white/60 flex-1",children:d.name}),a.jsx("span",{className:"text-white/40 font-mono",children:d.kind})]},d.id)),e.length>5&&a.jsxs("div",{className:"text-white/30 text-[8px] text-center pt-1",children:["+",e.length-5," mais..."]})]})]})]})]}),a.jsxs("div",{className:"p-3 space-y-2",style:{background:"rgba(34,211,238,0.03)",border:"1px dashed rgba(34,211,238,0.12)"},children:[a.jsxs("div",{className:"flex items-center gap-2 text-cyan-400/80",children:[a.jsx(lp,{size:12,strokeWidth:2}),a.jsx("span",{className:"text-[9px] uppercase tracking-wider font-medium",children:"Sobre Tipos"})]}),a.jsxs("div",{className:"text-[8px] text-white/50 font-light leading-relaxed space-y-1",children:[a.jsxs("p",{children:[" ",a.jsx("strong",{className:"text-white/70",children:"Cada cor"})," representa um tipo diferente de partcula"]}),a.jsxs("p",{children:[" ",a.jsx("strong",{className:"text-white/70",children:"Tipos interagem"})," de acordo com a matriz de foras"]}),a.jsxs("p",{children:[" ",a.jsx("strong",{className:"text-white/70",children:"Populao"})," muda dinamicamente com spawn/decay"]})]})]})]})},WT="'Doto', monospace",nh="'IBM Plex Mono', monospace",jm=({label:e,value:t,min:r,max:o,step:s,onChange:l,unit:i,accent:u})=>{const c=t??r??0,d=s>=1?0:s>=.1?1:s>=.01?2:3,h=(c-r)/(o-r)*100;return a.jsxs("div",{className:"flex flex-col gap-1 group",children:[a.jsxs("div",{className:"flex items-baseline justify-between",children:[a.jsx("label",{style:{fontFamily:nh,fontSize:"9px",fontWeight:200,letterSpacing:"0.5px",color:"rgba(255,255,255,0.35)",textTransform:"uppercase"},children:e}),a.jsxs("span",{style:{fontFamily:nh,fontSize:"9px",fontWeight:300,color:u||"rgba(255,255,255,0.5)",fontVariantNumeric:"tabular-nums"},children:[c.toFixed(d),i]})]}),a.jsxs("div",{className:"relative h-3 flex items-center",children:[a.jsx("div",{className:"absolute left-0 right-0 h-px",style:{background:"rgba(255,255,255,0.08)"}}),a.jsx("div",{className:"absolute left-0 h-px",style:{width:`${h}%`,background:u||"rgba(255,255,255,0.25)"}}),a.jsx("input",{type:"range",min:r,max:o,step:s,value:c,onChange:f=>l(parseFloat(f.target.value)),className:`absolute w-full h-3 appearance-none cursor-pointer bg-transparent
            [&::-webkit-slider-thumb]:appearance-none
            [&::-webkit-slider-thumb]:w-1.5
            [&::-webkit-slider-thumb]:h-3
            [&::-webkit-slider-thumb]:bg-white/50
            [&::-webkit-slider-thumb]:transition-colors
            [&::-moz-range-thumb]:w-1.5
            [&::-moz-range-thumb]:h-3
            [&::-moz-range-thumb]:bg-white/50
            [&::-moz-range-thumb]:border-0
            [&::-moz-range-thumb]:transition-colors`,style:{zIndex:1}})]})]})},HT=e=>{var c,d;const[t,r]=w.useState(!1),[o,s]=w.useState("patchboard"),[l,i]=w.useState(!0);if(w.useEffect(()=>{const h=setTimeout(()=>i(!1),3e3);return()=>clearTimeout(h)},[]),t)return a.jsx("div",{className:"fixed right-0 top-0 bottom-0 z-10 pointer-events-none",children:a.jsx("div",{className:"h-full flex items-center",children:a.jsx("button",{onClick:()=>r(!1),className:"pointer-events-auto p-2 transition-all",style:{background:"rgba(0,0,0,0.92)",borderLeft:"1px dashed rgba(255,255,255,0.06)",borderTop:"1px dashed rgba(255,255,255,0.06)",borderBottom:"1px dashed rgba(255,255,255,0.06)",borderRight:"none",color:"rgba(255,255,255,0.35)"},children:a.jsx(Ap,{size:12,strokeWidth:1.5})})})});const u=[{id:"patchboard",label:"ALGO",num:"01"},{id:"archetypes",label:"ARCH",num:"02"},{id:"powers",label:"PWR",num:"03"},{id:"matrix",label:"MTX",num:"04"},{id:"seed",label:"SEED",num:"05"},{id:"stats",label:"STAT",num:"06"},{id:"codex",label:"CDX",num:"07"}];return a.jsx("div",{className:"fixed right-0 top-0 bottom-0 z-10 pointer-events-none",style:{width:"320px",fontFamily:nh},"data-right-dock":!0,children:a.jsxs("div",{className:"h-full flex pointer-events-auto",children:[a.jsx("div",{className:"flex items-center",children:a.jsx("button",{onClick:()=>r(!0),className:"p-1.5 transition-colors",title:"Minimizar painel",style:{color:"rgba(255,255,255,0.25)",background:"rgba(0,0,0,0.80)",border:"1px dashed rgba(255,255,255,0.06)",borderRight:"none"},children:a.jsx(aa,{size:10,strokeWidth:1.5})})}),a.jsx("div",{className:"flex flex-col gap-0 py-2",style:{background:"rgba(0,0,0,0.94)",borderLeft:"1px dashed rgba(255,255,255,0.06)"},children:u.map(h=>{const f=o===h.id;return a.jsxs("button",{onClick:()=>s(h.id),className:"relative px-1.5 py-3 transition-all whitespace-nowrap",style:{writingMode:"vertical-rl",fontFamily:nh,fontSize:"8px",fontWeight:f?400:200,letterSpacing:"1.5px",textTransform:"uppercase",color:f?"#ffd400":"rgba(255,255,255,0.20)",background:f?"rgba(255,212,0,0.04)":"transparent",borderRight:f?"1px dashed rgba(255,212,0,0.25)":"1px dashed transparent"},children:[h.label,l&&h.id==="patchboard"&&a.jsx("div",{className:"absolute top-1 right-0.5 w-1 h-1 animate-pulse",style:{background:"#ffd400"}})]},h.id)})}),a.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",style:{background:"rgba(0,0,0,0.94)",borderLeft:"1px dashed rgba(255,255,255,0.06)"},children:[a.jsxs("div",{className:"px-3 py-2 flex items-center justify-between",style:{borderBottom:"1px dashed rgba(255,255,255,0.06)"},children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("span",{style:{fontFamily:nh,fontSize:"8px",fontWeight:200,color:"rgba(255,255,255,0.18)"},children:[(c=u.find(h=>h.id===o))==null?void 0:c.num,"."]}),a.jsx("span",{style:{fontFamily:WT,fontSize:"10px",fontWeight:400,color:"rgba(255,255,255,0.55)",letterSpacing:"1px",textTransform:"uppercase"},children:(d=u.find(h=>h.id===o))==null?void 0:d.label})]}),a.jsx("span",{style:{fontFamily:nh,fontSize:"7px",fontWeight:200,color:"rgba(255,255,255,0.12)",letterSpacing:"0.08em",textTransform:"uppercase"},children:"COMPLEXITY LAB"})]}),a.jsxs("div",{className:"flex-1 overflow-auto p-3",style:{scrollbarWidth:"thin",scrollbarColor:"rgba(255,255,255,0.1) transparent"},children:[o==="patchboard"&&a.jsx(_T,{microConfig:e.microConfig,fieldConfig:e.fieldConfig,reconfigConfig:e.reconfigConfig,targetParticleCount:e.targetParticleCount,onMicroChange:e.onMicroChange,onFieldChange:e.onFieldChange,onReconfigChange:e.onReconfigChange,onTargetParticleCountChange:e.onTargetParticleCountChange,onRandomizeAll:e.onRandomizeAll,life:e.life,onLifeChange:e.onLifeChange,lifeStats:e.lifeStats,pointSize:e.pointSize,fadeFactor:e.fadeFactor,glowIntensity:e.glowIntensity,paletteIndex:e.paletteIndex,onPointSizeChange:e.onPointSizeChange,onFadeFactorChange:e.onFadeFactorChange,onGlowIntensityChange:e.onGlowIntensityChange,onPaletteIndexChange:e.onPaletteIndexChange,onBackgroundClick:e.onBackgroundClick,trails:e.trails,fieldHeatmap:e.fieldHeatmap,onToggleTrails:e.onToggleTrails,onToggleFieldHeatmap:e.onToggleFieldHeatmap,onApplyRecipe:e.onApplyRecipe,onNewUniverse:e.onNewUniverse,onChaosSeed:e.onChaosSeed,onLoadPreset:e.onLoadCreativePreset,renderMode:e.renderMode,streakLength:e.streakLength,onRenderModeChange:e.onRenderModeChange,onStreakLengthChange:e.onStreakLengthChange,simQuality:e.simQuality,dotSize:e.dotSize,onSimQualityChange:e.onSimQualityChange,onDotSizeChange:e.onDotSizeChange,spawnPattern:e.spawnPattern,onSpawnPatternChange:e.onSpawnPatternChange,showBonds:e.showBonds,bondsDistance:e.bondsDistance,bondsOpacity:e.bondsOpacity,showTrails:e.showTrails,trailsLength:e.trailsLength,trailsOpacity:e.trailsOpacity,onShowBondsChange:e.onShowBondsChange,onBondsDistanceChange:e.onBondsDistanceChange,onBondsOpacityChange:e.onBondsOpacityChange,onShowTrailsChange:e.onShowTrailsChange,onTrailsLengthChange:e.onTrailsLengthChange,onTrailsOpacityChange:e.onTrailsOpacityChange,sigilConfig:e.sigilConfig,onSigilConfigChange:e.onSigilConfigChange,archetypesDetected:e.archetypesDetected,onClearSigils:e.onClearSigils}),o==="powers"&&a.jsx("div",{className:"space-y-5",children:a.jsxs("div",{className:"space-y-3",children:[a.jsx("div",{className:"space-y-2",children:(()=>{const h=[{id:"pulse",icon:"",label:"Pulso",desc:"Expansao radial",color:"#37b2da"},{id:"white-hole",icon:"O",label:"White Hole",desc:"Mega-repulsao quadratica",color:"#ffd400"},{id:"black-hole",icon:"",label:"Black Hole",desc:"Mega-atracao quadratica",color:"#8b5cf6"},{id:"wind",icon:"~",label:"Vento",desc:"Arrasta na direcao",color:"#37b2da"},{id:"vortex",icon:"",label:"Vortice",desc:"Rotacao tangencial",color:"#10d45b"},{id:"freeze",icon:"*",label:"Congelar",desc:"Drena energia cinetica",color:"#60a5fa"},{id:"chaos",icon:"!",label:"Caos",desc:"Injeta ruido aleatorio",color:"#d6552d"},{id:"quake",icon:"",label:"Quake",desc:"Ondas de pressao",color:"#ffaa44"},{id:"nova",icon:"+",label:"Nova",desc:"Implosao / explosao",color:"#ff4444"},{id:"magnetize",icon:"",label:"Magnetizar",desc:"Converte especie proxima",color:"#ff0084"}],f=h.find(g=>g.id===e.selectedPower);return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"grid grid-cols-5 gap-1",children:h.map(g=>{const m=e.selectedPower===g.id;return a.jsxs("button",{onClick:()=>e.onSelectedPowerChange(g.id),title:g.label+"  "+g.desc,className:"flex flex-col items-center justify-center py-2 px-0.5 transition-all",style:{border:`1px dashed ${m?g.color+"50":"rgba(255,255,255,0.05)"}`,background:m?g.color+"08":"transparent",color:m?g.color:"rgba(255,255,255,0.30)"},children:[a.jsx("span",{style:{fontSize:"14px",lineHeight:1,marginBottom:"3px"},children:g.icon}),a.jsx("span",{style:{fontSize:"7px",textTransform:"uppercase",letterSpacing:"0.3px",fontWeight:200,lineHeight:1},children:g.label})]},g.id)})}),f&&a.jsxs("div",{className:"flex items-start gap-2 px-2 py-1.5",style:{border:`1px dashed ${f.color}25`,background:`${f.color}04`},children:[a.jsx("span",{style:{fontSize:"16px",lineHeight:1,color:f.color,marginTop:"2px"},children:f.icon}),a.jsxs("div",{children:[a.jsx("div",{style:{fontSize:"9px",textTransform:"uppercase",letterSpacing:"0.8px",fontWeight:300,color:f.color,marginBottom:"2px"},children:f.label}),a.jsx("div",{style:{fontSize:"9px",fontWeight:200,color:"rgba(255,255,255,0.35)",lineHeight:1.3},children:f.desc})]})]})]})})()}),a.jsx("div",{className:"h-px",style:{borderBottom:"1px dashed rgba(255,255,255,0.06)"}}),a.jsxs("div",{className:"grid grid-cols-2 gap-x-3 gap-y-0.5",style:{fontSize:"8px",fontWeight:200,color:"rgba(255,255,255,0.2)"},children:[a.jsx("span",{children:"Click  poder instantaneo"}),a.jsx("span",{children:"Arrastar  poder continuo"}),a.jsx("span",{children:"Shift+drag  semear"}),a.jsx("span",{children:"Alt+drag  apagar"})]}),a.jsx("div",{className:"h-px",style:{borderBottom:"1px dashed rgba(255,255,255,0.06)"}}),a.jsxs("div",{className:"space-y-2 pt-1",children:[a.jsxs("div",{className:"flex flex-col gap-1.5",children:[a.jsxs("div",{className:"flex items-baseline justify-between",children:[a.jsx("label",{style:{fontSize:"9px",fontWeight:200,letterSpacing:"0.5px",color:"rgba(255,255,255,0.35)",textTransform:"uppercase"},children:"Especie"}),a.jsx("span",{style:{fontSize:"9px",fontWeight:300,color:"rgba(255,255,255,0.5)",fontVariantNumeric:"tabular-nums"},children:e.selectedType})]}),a.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:Array.from({length:e.microConfig.typesCount}).map((h,f)=>a.jsx("button",{onClick:()=>e.onSelectedTypeChange(f),className:"transition-all",style:{width:"20px",height:"20px",border:e.selectedType===f?"1px solid rgba(255,255,255,0.65)":"1px dashed rgba(255,255,255,0.12)",backgroundColor:`hsl(${f*360/e.microConfig.typesCount}, 70%, 60%)`,transform:e.selectedType===f?"scale(1.10)":"scale(1)"}},f))})]}),a.jsx("div",{className:"h-px",style:{borderBottom:"1px dashed rgba(255,255,255,0.06)"}}),a.jsx(jm,{label:"Raio",value:e.brushRadius,min:20,max:220,step:5,onChange:e.onBrushRadiusChange,unit:"px"}),a.jsx(jm,{label:"Forca",value:e.brushStrength,min:0,max:100,step:1,onChange:e.onBrushStrengthChange}),a.jsx(jm,{label:"Taxa Semeadura",value:e.seedRate,min:0,max:200,step:5,onChange:e.onSeedRateChange,unit:"/s"}),a.jsx(jm,{label:"Taxa Apagamento",value:e.eraseRate,min:0,max:1,step:.05,onChange:e.onEraseRateChange})]})]})}),o==="matrix"&&a.jsx(DT,{matrix:e.matrix,typesCount:e.microConfig.typesCount,onMatrixChange:e.onMatrixChange,onRandomize:e.onMatrixRandomize,onSoften:e.onMatrixSoften,onSymmetrize:e.onMatrixSymmetrize,onInvert:e.onMatrixInvert,onNormalize:e.onMatrixNormalize}),o==="seed"&&a.jsx(zT,{currentSeed:e.currentSeed||Date.now(),onLoadSeed:e.onLoadSeed||(()=>{})}),o==="stats"&&a.jsx($T,{fps:e.fps,particleCount:e.particleCount,fieldCellCount:e.fieldCellCount,artifactCount:e.artifactCount,speciesCount:e.speciesCount,avgTension:e.avgTension,avgCohesion:e.avgCohesion,avgScarcity:e.avgScarcity,diversity:e.diversity,stats:e.stats}),o==="codex"&&e.organisms&&a.jsx(BT,{organisms:e.organisms,onSpawnOrganism:e.onSpawnOrganism||(()=>{}),onDeleteOrganism:e.onDeleteOrganism||(()=>{}),onRenameOrganism:e.onRenameOrganism||(()=>{}),captureMode:e.captureMode||!1,onCaptureModeChange:e.onCaptureModeChange||(()=>{}),brushRadius:e.brushRadius,onBrushRadiusChange:e.onBrushRadiusChange}),o==="archetypes"&&e.archetypesDetected&&e.sigilConfig&&e.onSigilConfigChange&&a.jsx(qT,{archetypesDetected:e.archetypesDetected,microState:e.microState,microConfig:e.microConfig,paletteIndex:e.paletteIndex||0,sigilConfig:e.sigilConfig,onSigilConfigChange:e.onSigilConfigChange,archetypeRegistry:e.archetypeRegistry||{nextId:100,list:[]},lifeStats:e.lifeStats})]})]})]})})};class cd{constructor(t){this.seed=t}next(){return this.seed=(this.seed*9301+49297)%233280,this.seed/233280}range(t,r){return t+this.next()*(r-t)}int(t,r){return Math.floor(this.range(t,r+1))}getSeed(){return this.seed}setSeed(t){this.seed=t}}const GT=()=>({running:!0,speed:1,accumulator:0,tick:0,elapsed:0,lastFrameTime:0,frameCount:0,fps:60,fieldAccumulator:0,reconfigAccumulator:0,maxStepsPerFrame:10}),Kl=1/120,VT=.1,z4=1/20,UT=(e,t,r)=>{const o=e.lastFrameTime===0?Kl:(t-e.lastFrameTime)/1e3,s=Math.min(o,VT);if(e.lastFrameTime=t,e.frameCount++,e.frameCount%30===0&&(e.fps=Math.round(1/s)),!e.running)return{stepCount:0,fieldTick:!1,reconfigTick:!1};e.accumulator+=s*e.speed;let l=0;for(;e.accumulator>=Kl&&l<e.maxStepsPerFrame;)l++,e.accumulator-=Kl,e.tick++,e.elapsed+=Kl;l>=e.maxStepsPerFrame&&(e.accumulator=0),e.fieldAccumulator+=s*e.speed;const i=e.fieldAccumulator>=z4;i&&(e.fieldAccumulator-=z4),e.reconfigAccumulator+=s*e.speed;const u=e.reconfigAccumulator>=r;return u&&(e.reconfigAccumulator=0),{stepCount:l,fieldTick:i,reconfigTick:u}},YT=e=>{switch(e){case"FAST":return 10;case"HIGH":return 12;case"ULTRA":return 15}},KT=e=>{switch(e){case"FAST":return 2;case"HIGH":return 1;case"ULTRA":return 1}},XT=()=>({simQuality:"FAST",renderQuality:"FAST",maxStepsPerFrame:10,fieldSampleRate:2,resolutionScale:.75}),ZT=(e,t)=>{switch(e.simQuality=t,e.maxStepsPerFrame=YT(t),e.fieldSampleRate=KT(t),e.renderQuality=t,t){case"FAST":e.resolutionScale=.75;break;case"HIGH":e.resolutionScale=1;break;case"ULTRA":e.resolutionScale=1;break}},JT=(e,t,r,o,s)=>{if(t-r<3e4)return r;if(e<10&&o>300){const l=Math.floor(o*.1),i=Math.max(300,o-l);return s(i,l),t}if(e<14&&o>1200){const l=Math.floor(o*.05),i=Math.max(600,o-l);return s(i,l),t}return r},Jl=255,B4=8,QT=e=>{const t=[],r=[];for(let o=0;o<B4;o++)t.push(new Float32Array(e)),r.push(new Float32Array(e));return{count:0,maxCount:e,capacity:e,x:new Float32Array(e),y:new Float32Array(e),vx:new Float32Array(e),vy:new Float32Array(e),type:new Uint8Array(e),energy:new Float32Array(e),historyX:t,historyY:r,historyLength:B4,historyIndex:0,age:new Uint32Array(e),mutationPotential:new Float32Array(e),size:new Float32Array(e).fill(1),geneA:new Float32Array(e),geneB:new Float32Array(e),geneC:new Float32Array(e),geneD:new Float32Array(e),archetypeId:new Uint16Array(e)}},eI=()=>({wrap:!0,rmax:.24,friction:.9,drag:1,useDrag:!0,force:1.8,dt:1/60,speedClamp:.15,entropy:0,typesCount:4,foodEnabled:!1,foodRatio:.15,circularDependency:0,beta:.3,coreRepel:1,kernelMode:"classic",softening:1e-4,energyEnabled:!1,energyDecay:.002,energyFeedRate:.04,energyReproThreshold:2,metamorphosisEnabled:!0,mutationRate:8e-4,typeStability:.985}),i2=(e,t,r,o,s=!1,l=.15)=>{e.count=Math.min(t,e.maxCount);const i=s?Math.floor(e.count*l):0;for(let u=0;u<e.count;u++)e.x[u]=r.next()*2-1,e.y[u]=r.next()*2-1,e.vx[u]=0,e.vy[u]=0,u<i?e.type[u]=Jl:e.type[u]=r.int(0,o-1),e.energy[u]=1,e.age[u]=0,e.mutationPotential[u]=0,e.size[u]=1,e.geneA[u]=r.next(),e.geneB[u]=r.next(),e.geneC[u]=r.next(),e.geneD[u]=r.next(),e.archetypeId[u]=e.type[u]},$4=(e,t,r,o)=>{if(e.count>=e.maxCount)return!1;const s=e.count++;return e.x[s]=t,e.y[s]=r,e.vx[s]=0,e.vy[s]=0,e.type[s]=o,e.energy[s]=1,e.age[s]=0,e.mutationPotential[s]=0,e.size[s]=1,e.geneA[s]=Math.random(),e.geneB[s]=Math.random(),e.geneC[s]=Math.random(),e.geneD[s]=Math.random(),e.archetypeId[s]=o,!0},q4=(e,t,r,o,s=1,l={next:()=>Math.random()})=>{let i=0;for(let u=e.count-1;u>=0;u--){const c=e.x[u]-t,d=e.y[u]-r;if(c*c+d*d<o*o&&l.next()<s){const f=e.count-1;u!==f&&(e.x[u]=e.x[f],e.y[u]=e.y[f],e.vx[u]=e.vx[f],e.vy[u]=e.vy[f],e.type[u]=e.type[f],e.energy[u]=e.energy[f],e.age[u]=e.age[f],e.mutationPotential[u]=e.mutationPotential[f],e.size[u]=e.size[f],e.geneA[u]=e.geneA[f],e.geneB[u]=e.geneB[f],e.geneC[u]=e.geneC[f],e.geneD[u]=e.geneD[f],e.archetypeId[u]=e.archetypeId[f]),e.count--,i++}}return i},W4=(e,t,r,o,s,l=!1,i=.15)=>{e.count=Math.min(t,e.maxCount);const u=l?Math.floor(e.count*i):0;for(let c=0;c<e.count;c++){let d=0,h=0,f=0,g=0,m;switch(c<u?m=Jl:m=o.int(0,s-1),r){case"random":d=o.next()*2-1,h=o.next()*2-1;break;case"circle":const y=c/e.count*Math.PI*2,v=.7+(o.next()-.5)*.1;d=Math.cos(y)*v,h=Math.sin(y)*v;break;case"rings":const b=Math.min(5,Math.max(2,s)),C=(m%b+1)/b*.85,k=c/(e.count/b)*Math.PI*2+o.next()*.5;d=Math.cos(k)*C,h=Math.sin(k)*C;break;case"clusters":const R=m/s*Math.PI*2,j=.4+o.next()*.2,T=(o.next()-.5)*.25,_=o.next()*Math.PI*2;d=Math.cos(R)*j+Math.cos(_)*T,h=Math.sin(R)*j+Math.sin(_)*T;break;case"grid":const P=Math.ceil(Math.sqrt(e.count)),I=c%P/P,$=Math.floor(c/P)/P;d=I*1.8-.9+(o.next()-.5)*.1,h=$*1.8-.9+(o.next()-.5)*.1;break;case"center":const q=o.next()*o.next()*.3,L=o.next()*Math.PI*2;d=Math.cos(L)*q,h=Math.sin(L)*q,f=Math.cos(L)*.02,g=Math.sin(L)*.02;break;case"spray":d=(o.next()-.5)*1.5,h=-.9+o.next()*.3,f=(o.next()-.5)*.01,g=.01+o.next()*.02;break;case"islands":const H=Math.min(8,Math.max(3,s*2)),oe=c%H/H*Math.PI*2,le=.5+o.next()*.3,pe=o.next()*.15,ce=o.next()*Math.PI*2;d=Math.cos(oe)*le+Math.cos(ce)*pe,h=Math.sin(oe)*le+Math.sin(ce)*pe;break;case"columns":d=m/s*2-1+(o.next()-.5)*.25,h=o.next()*2-1;break;case"web":const F=Math.max(4,s),ae=m%F/F*Math.PI*2,we=o.next()*.85,Re=.04+o.next()*.04;d=Math.cos(ae)*we+(o.next()-.5)*Re,h=Math.sin(ae)*we+(o.next()-.5)*Re;break;case"spiral":const ge=3,Ae=c/e.count,tt=Ae*Math.PI*2*ge,We=Ae*.85;d=Math.cos(tt)*We+(o.next()-.5)*.1,h=Math.sin(tt)*We+(o.next()-.5)*.1;break;case"double-ring":const J=c<e.count/2,ke=J?c:c-Math.floor(e.count/2),Le=J?Math.floor(e.count/2):e.count-Math.floor(e.count/2),K=ke/Le*Math.PI*2,et=J?.45:.75;d=Math.cos(K)*et,h=Math.sin(K)*et;const dt=.015;f=-Math.sin(K)*dt*(J?1:-1),g=Math.cos(K)*dt*(J?1:-1);break}e.x[c]=d,e.y[c]=h,e.vx[c]=f,e.vy[c]=g,e.type[c]=m,e.energy[c]=1,e.age[c]=0,e.mutationPotential[c]=0,e.size[c]=1,e.geneA[c]=o.next(),e.geneB[c]=o.next(),e.geneC[c]=o.next(),e.geneD[c]=o.next(),e.archetypeId[c]=m}},Mi=e=>{const t=[],r=[],o=[];for(let s=0;s<e;s++)t[s]=new Array(e).fill(0),r[s]=new Array(e).fill(1),o[s]=new Array(e).fill(1);return{attract:t,radius:r,falloff:o}},l2=(e,t,r)=>{const o=e.attract.length;for(let s=0;s<o;s++)for(let l=0;l<o;l++)e.attract[s][l]=t.range(-1,1),e.radius[s][l]=t.range(.3,1)*r,e.falloff[s][l]=t.range(.8,2)},tI=e=>{const t=e.attract.length;for(let r=0;r<t;r++)for(let o=0;o<t;o++)e.attract[r][o]*=.7},c2=e=>{const t=e.attract.length;for(let r=0;r<t;r++)for(let o=r+1;o<t;o++){const s=(e.attract[r][o]+e.attract[o][r])/2;e.attract[r][o]=s,e.attract[o][r]=s;const l=(e.radius[r][o]+e.radius[o][r])/2;e.radius[r][o]=l,e.radius[o][r]=l}},nI=e=>{const t=e.attract.length;for(let r=0;r<t;r++)for(let o=0;o<t;o++)e.attract[r][o]*=-1},rI=e=>{const t=e.attract.length;let r=0;for(let o=0;o<t;o++)for(let s=0;s<t;s++)r=Math.max(r,Math.abs(e.attract[o][s]));if(r>0)for(let o=0;o<t;o++)for(let s=0;s<t;s++)e.attract[o][s]/=r},rs=(e,t)=>{var o,s;const r=e.attract.length;(!t.attract||t.attract.length!==r)&&(t.attract=Array(r).fill(0).map(()=>Array(r).fill(0))),(!t.radius||t.radius.length!==r)&&(t.radius=Array(r).fill(0).map(()=>Array(r).fill(0))),(!t.falloff||t.falloff.length!==r)&&(t.falloff=Array(r).fill(0).map(()=>Array(r).fill(1.2)));for(let l=0;l<r;l++)if(t.attract[l]||(t.attract[l]=Array(r).fill(0)),t.radius[l]||(t.radius[l]=Array(r).fill(0)),t.falloff[l]||(t.falloff[l]=Array(r).fill(1.2)),!!e.attract[l]&&e.radius[l])for(let i=0;i<r;i++)t.attract[l][i]=e.attract[l][i]??0,t.radius[l][i]=e.radius[l][i]??0,t.falloff[l][i]=((s=(o=e.falloff)==null?void 0:o[l])==null?void 0:s[i])??1.2},jx=(e,t,r,o)=>{const s=e.attract.length;if(!(t<=s)){for(let l=0;l<s;l++){e.attract[l]||(e.attract[l]=[]),e.radius[l]||(e.radius[l]=[]),e.falloff[l]||(e.falloff[l]=[]);for(let i=s;i<t;i++)e.attract[l][i]=r.range(-.5,.5),e.radius[l][i]=r.range(.3,1)*o,e.falloff[l][i]=1.2}for(let l=s;l<t;l++){e.attract[l]=new Array(t),e.radius[l]=new Array(t),e.falloff[l]=new Array(t);for(let i=0;i<t;i++)e.attract[l][i]=r.range(-.5,.5),e.radius[l][i]=r.range(.3,1)*o,e.falloff[l][i]=1.2}}},ki=(e,t)=>{const r=e.attract.length;if(!(r<2||t<=0))for(let o=0;o<r;o++){const s=(o+1)%r,l=(o-1+r)%r;e.attract[o][s]=e.attract[o][s]*(1-t)+.7*t,e.attract[o][l]=e.attract[o][l]*(1-t)+-.3*t}},WC=(e,t,r)=>{const o=Math.ceil(t/e),s=Math.ceil(t/e),l=o*s;return{cellSize:e,gridWidth:o,gridHeight:s,head:new Int32Array(l).fill(-1),next:new Int32Array(r).fill(-1),maxParticles:r}},HC=e=>{e.head.fill(-1)},GC=(e,t,r,o)=>{const s=Math.floor((r+1)/e.cellSize),l=Math.floor((o+1)/e.cellSize);if(s>=0&&s<e.gridWidth&&l>=0&&l<e.gridHeight){const i=l*e.gridWidth+s;e.next[t]=e.head[i],e.head[i]=t}},VC=(e,t,r,o)=>{const s=Math.floor((t+1)/e.cellSize),l=Math.floor((r+1)/e.cellSize);for(let i=-1;i<=1;i++)for(let u=-1;u<=1;u++){const c=s+u,d=l+i;if(c>=0&&c<e.gridWidth&&d>=0&&d<e.gridHeight){const h=d*e.gridWidth+c;let f=e.head[h];for(;f!==-1;)o(f),f=e.next[f]}}};let Ex=null,Tx=null,Ix=null;function oI(e){Ex=e}function aI(e){Tx=e}function sI(e){Ix=e}function Em(e,t,r,o){Ix&&Ix(e,t,r,o)}function Tm(e,t){const r=Ex?Ex(e,t):{nutrient:.5,tension:0,memory:0,entropy:0,scarcity:.5,cohesion:0,volatility:0},o=Tx?Tx(e,t):{bond:0,rift:0,bloom:0,oath:0};return{...r,sigilBond:o.bond,sigilRift:o.rift,sigilBloom:o.bloom,sigilOath:o.oath}}const iI=(e,t,r,o,s,l,i)=>{const u=t.mutationRate,c=t.typeStability;for(let d=0;d<e.count;d++){const h=e.type[d];if(h===Jl||h<0||h>=t.typesCount)continue;e.age[d]++;const f=o(e.x[d],e.y[d]),g=f.entropy||0,m=f.volatility||0,y=f.nutrient||.5,v=.7+e.energy[d]*.6,b=.02;e.size[d]+=(v-e.size[d])*b,e.size[d]=Math.max(.5,Math.min(2,e.size[d]));const S=Math.max(0,(e.energy[d]-1.5)/1.5),C=(g*.5+m*.3)*.3,k=Math.min(1,e.age[d]/3600),R=S*.4+C*.3+k*.3;e.mutationPotential[d]+=R*.01,e.mutationPotential[d]*=c,e.mutationPotential[d]=Math.max(0,Math.min(1,e.mutationPotential[d]));const j=u*(1+e.mutationPotential[d]*10);if(s.next()<j){const T=h;let _=T;e.energy[d]>1.5?_=(T+1)%t.typesCount:e.energy[d]<.5?_=Math.max(0,T-1):g>.6||m>.6?_=s.int(0,t.typesCount-1):e.age[d]>1800&&(_=s.int(0,t.typesCount-1),e.energy[d]=1),_!==T&&(e.type[d]=_,e.mutationPotential[d]=0,e.age[d]=0,e.energy[d]*=.7,e.size[d]=Math.min(2,e.size[d]*1.3))}y>.6&&(e.energy[d]+=(y-.6)*.002),t.energyEnabled&&(e.energy[d]*=1-t.energyDecay),e.energy[d]=Math.max(.1,Math.min(3,e.energy[d]))}};let uu=null,H4=0,Cc=null,hu=null,Px=0,Fx=0;const UC=()=>({neighborsChecked:Px,interactionsApplied:Fx}),lI=(e,t,r)=>{let o=r+e*374761393+t*668265263;return o=(o^o>>>13)*1274126177,o=o^o>>>16,(o>>>0)/4294967296},Uf=(e,t,r,o,s,l)=>{let i=t.rmax;if(r.radius&&r.radius.length>=t.typesCount){for(let c=0;c<t.typesCount;c++)if(r.radius[c]&&r.radius[c].length>=t.typesCount)for(let d=0;d<t.typesCount;d++)r.radius[c][d]!==void 0&&(i=Math.max(i,r.radius[c][d]))}i=Math.max(i,.08),(!uu||Math.abs(uu.cellSize-i)>.01||e.maxCount!==H4)&&(uu=WC(i,2,e.maxCount),H4=e.maxCount),(!Cc||Cc.length!==e.maxCount)&&(Cc=new Float32Array(e.maxCount),hu=new Float32Array(e.maxCount)),Cc.fill(0),hu.fill(0),Px=0,Fx=0,HC(uu);for(let c=0;c<e.count;c++)GC(uu,c,e.x[c],e.y[c]);for(let c=0;c<e.count;c++){const d=e.x[c],h=e.y[c],f=e.type[c];if(f!==Jl&&(f<0||f>=t.typesCount))continue;const g=Tm(d,h),m=o(d,h),y=g.scarcity||m.scarcity||0,v=g.cohesion||m.cohesion||0,b=g.volatility||0,S=g.nutrient||.5,C=g.entropy||0,k=g.sigilBond||0,R=g.sigilRift||0,j=g.sigilOath||0;let T=t.beta*(1+(y-.5)*.25);T=Math.max(.05,Math.min(.95,T)),t.drag*(1+b*.35-v*.2+R*.22-j*.14),VC(uu,d,h,P=>{var Q,ae,we,Re;if(c===P)return;let I=e.x[P]-d,$=e.y[P]-h;t.wrap&&(I>1&&(I-=2),I<-1&&(I+=2),$>1&&($-=2),$<-1&&($+=2)),Px++;const q=I*I+$*$;if(q<1e-8)return;const L=e.type[P];if(L!==Jl&&(L<0||L>=t.typesCount)||!((Q=r.radius)!=null&&Q[f])||r.radius[f][L]===void 0||!((ae=r.attract)!=null&&ae[f])||r.attract[f][L]===void 0)return;let H=r.radius[f][L];H=H*(1+y*.2);const G=H*H;if(q>=G)return;const oe=Math.sqrt(q);if(oe<1e-4)return;const le=r.attract[f][L];let pe=0;if(t.kernelMode==="classic"){const ge=oe/H;ge<T?pe=(ge/T-1)*t.coreRepel:pe=le*(1-Math.abs(1+T-2*ge)/(1-T))}else{const ge=((Re=(we=r.falloff)==null?void 0:we[f])==null?void 0:Re[L])??1.2,Ae=oe/H;pe=le*Math.pow(1-Ae,ge)}const ce=1+(S-.5)*.35-b*.2+k*.25-R*.18;pe*=ce;const te=Math.abs(pe);pe>.08&&te<.6&&Em("bond",d,h,.01*te),pe<-.1&&Em("rift",d,h,.01*te);const F=1/(oe+t.softening);Cc[c]+=I*F*pe,hu[c]+=$*F*pe,Fx++});const _=(C+R*.1-k*.05)*.015;if(Cc[c]+=(s.next()-.5)*_,hu[c]+=(s.next()-.5)*_,y>.3){const P=l+c*12345,I=lI(Math.floor(d*100),Math.floor(h*100),P)*Math.PI*2;Cc[c]+=Math.cos(I)*y*.004,hu[c]+=Math.sin(I)*y*.004}}for(let c=0;c<e.count;c++){const d=e.type[c];if(d!==Jl&&(d<0||d>=t.typesCount))continue;if(d===Jl)e.energy[c]=Math.max(.1,e.energy[c]*.999);else{if(e.vx[c]+=Cc[c]*t.force*t.dt,e.vy[c]+=hu[c]*t.force*t.dt,t.entropy>0&&(e.vx[c]+=(s.next()-.5)*t.entropy,e.vy[c]+=(s.next()-.5)*t.entropy),t.useDrag){const y=Tm(e.x[c],e.y[c]),v=y.cohesion||0,b=y.volatility||0,S=t.drag*(1+b*.35-v*.2),C=Math.exp(-S*t.dt);e.vx[c]*=C,e.vy[c]*=C}else e.vx[c]*=t.friction,e.vy[c]*=t.friction;const f=e.vx[c]*e.vx[c]+e.vy[c]*e.vy[c];if(f>t.speedClamp*t.speedClamp){const y=Math.sqrt(f);e.vx[c]=e.vx[c]/y*t.speedClamp,e.vy[c]=e.vy[c]/y*t.speedClamp}e.x[c]+=e.vx[c]*t.dt,e.y[c]+=e.vy[c]*t.dt;const g=Tm(e.x[c],e.y[c]),m=Math.sqrt(e.vx[c]*e.vx[c]+e.vy[c]*e.vy[c]);g.nutrient&&g.nutrient>.62&&m<.06&&Em("bloom",e.x[c],e.y[c],.006),(g.memory&&g.memory>.58||g.cohesion&&g.cohesion>.58)&&m<.045&&Em("oath",e.x[c],e.y[c],.006)}t.wrap?(e.x[c]>1&&(e.x[c]-=2),e.x[c]<-1&&(e.x[c]+=2),e.y[c]>1&&(e.y[c]-=2),e.y[c]<-1&&(e.y[c]+=2)):(e.x[c]>1&&(e.x[c]=1,e.vx[c]*=-.5),e.x[c]<-1&&(e.x[c]=-1,e.vx[c]*=-.5),e.y[c]>1&&(e.y[c]=1,e.vy[c]*=-.5),e.y[c]<-1&&(e.y[c]=-1,e.vy[c]*=-.5))}const u=e.historyIndex;for(let c=0;c<e.count;c++)e.historyX[u][c]=e.x[c],e.historyY[u][c]=e.y[c];e.historyIndex=(e.historyIndex+1)%e.historyLength,t.metamorphosisEnabled&&iI(e,t,r,(c,d)=>{const h=Tm(c,d);return{entropy:h.entropy||0,volatility:h.volatility||0,nutrient:h.nutrient||.5}},s)},d2=(e,t,r,o,s)=>{for(let l=0;l<e.count;l++){const i=e.x[l]-t,u=e.y[l]-r,c=i*i+u*u;if(c<o*o&&c>1e-4){const d=Math.sqrt(c),h=s*(1-d/o);e.vx[l]+=i/d*h,e.vy[l]+=u/d*h}}},cI=(e,t,r,o,s,l)=>{for(let i=0;i<e.count;i++){const u=e.x[i]-t,c=e.y[i]-r,d=u*u+c*c;if(d<o*o){const f=1-Math.sqrt(d)/o;e.vx[i]+=s*f*.01,e.vy[i]+=l*f*.01}}},G4=(e,t,r,o,s)=>{for(let l=0;l<e.count;l++){const i=e.x[l]-t,u=e.y[l]-r,c=i*i+u*u;if(c<o*o&&c>1e-4){const d=Math.sqrt(c),h=s*(1-d/o)*(1-d/o);e.vx[l]+=i/d*h,e.vy[l]+=u/d*h}}},V4=(e,t,r,o,s)=>{for(let l=0;l<e.count;l++){const i=e.x[l]-t,u=e.y[l]-r,c=i*i+u*u;if(c<o*o&&c>1e-4){const d=Math.sqrt(c),h=s*(1-d/o)*(1-d/o);e.vx[l]-=i/d*h,e.vy[l]-=u/d*h}}},U4=(e,t,r,o,s)=>{for(let l=0;l<e.count;l++){const i=e.x[l]-t,u=e.y[l]-r,c=i*i+u*u;if(c<o*o&&c>1e-4){const d=Math.sqrt(c),h=1-d/o;e.vx[l]+=-u/d*s*h,e.vy[l]+=i/d*s*h}}},Y4=(e,t,r,o,s)=>{for(let l=0;l<e.count;l++){const i=e.x[l]-t,u=e.y[l]-r,c=i*i+u*u;if(c<o*o){const d=Math.sqrt(c),h=s*(1-d/o);e.vx[l]*=1-h,e.vy[l]*=1-h}}},K4=(e,t,r,o,s)=>{for(let l=0;l<e.count;l++){const i=e.x[l]-t,u=e.y[l]-r,c=i*i+u*u;if(c<o*o){const h=1-Math.sqrt(c)/o,f=Math.random()*Math.PI*2;e.vx[l]+=Math.cos(f)*s*h,e.vy[l]+=Math.sin(f)*s*h}}},X4=(e,t,r,o,s,l)=>{for(let i=0;i<e.count;i++){const u=e.x[i]-t,c=e.y[i]-r,d=u*u+c*c;if(d<o*o&&d>1e-4){const h=Math.sqrt(d),f=Math.sin(h/o*Math.PI*6-l*10),g=s*f*(1-h/o);e.vx[i]+=u/h*g,e.vy[i]+=c/h*g}}},Z4=(e,t,r,o,s,l)=>{const i=l===0?-1:1,u=l===1?2.5:1.5;for(let c=0;c<e.count;c++){const d=e.x[c]-t,h=e.y[c]-r,f=d*d+h*h;if(f<o*o&&f>1e-4){const g=Math.sqrt(f),m=Math.pow(1-g/o,u);e.vx[c]+=i*(d/g)*s*m,e.vy[c]+=i*(h/g)*s*m}}},J4=(e,t,r,o,s,l)=>{for(let i=0;i<e.count;i++){if(e.type[i]===255)continue;const u=e.x[i]-t,c=e.y[i]-r,d=u*u+c*c;if(d<o*o){const h=Math.sqrt(d),f=s*(1-h/o);Math.random()<f&&(e.type[i]=l)}}};function Q4(){return{enabled:!0,gridW:96,gridH:96,writeGain:.08,decay:.04,diffusion:.18,influenceGain:.22,globalMix:.04,clampMax:1}}function dI(e){const t=e.gridW*e.gridH;return{C:new Float32Array(t),A:new Float32Array(t),S:new Float32Array(t),tmp:new Float32Array(t),w:e.gridW,h:e.gridH}}function dd(e,t,r,o){const s=(e%r+r)%r;return(t%o+o)%o*r+s}function uI(e,t,r,o){if(!t.enabled)return{c:0,a:0,s:0};const s=(r+1)/2*e.w,l=(o+1)/2*e.h,i=Math.floor(s),u=Math.floor(l),c=dd(i,u,e.w,e.h);return{c:e.C[c],a:e.A[c],s:e.S[c]}}function hI(e,t,r,o,s,l,i,u=1){if(!t.enabled)return;const c=Math.floor((r+1)/2*e.w),d=Math.floor((o+1)/2*e.h),h=u*u;for(let f=-u;f<=u;f++)for(let g=-u;g<=u;g++){const m=g*g+f*f;if(m>h)continue;const y=1-Math.sqrt(m/h),v=dd(c+g,d+f,e.w,e.h);e.C[v]=Math.min(t.clampMax,e.C[v]+s*y),e.A[v]=Math.min(t.clampMax,e.A[v]+l*y),e.S[v]=Math.min(t.clampMax,e.S[v]+i*y)}}function fI(e,t,r){if(!t.enabled)return;const o=e.w,s=e.h,l=o*s,i=Math.exp(-t.decay*r);for(let c=0;c<l;c++)e.C[c]*=i,e.A[c]*=i,e.S[c]*=i;const u=t.diffusion*r;if(u2(e.C,e.tmp,o,s,u),u2(e.A,e.tmp,o,s,u),u2(e.S,e.tmp,o,s,u),t.globalMix>0){const c=t.globalMix*r;let d=0,h=0,f=0;for(let g=0;g<l;g++)d+=e.C[g],h+=e.A[g],f+=e.S[g];d/=l,h/=l,f/=l;for(let g=0;g<l;g++)e.C[g]=T5(e.C[g],d,c),e.A[g]=T5(e.A[g],h,c),e.S[g]=T5(e.S[g],f,c)}}function u2(e,t,r,o,s){for(let l=0;l<e.length;l++)t[l]=e[l];for(let l=0;l<o;l++)for(let i=0;i<r;i++){const u=dd(i,l,r,o),c=t[dd(i,l-1,r,o)],d=t[dd(i,l+1,r,o)],h=t[dd(i+1,l,r,o)],f=t[dd(i-1,l,r,o)],g=(c+d+h+f)/4;e[u]=T5(t[u],g,s)}}function T5(e,t,r){return e+(t-e)*r}function e8(e,t,r,o,s,l,i){if(!i.cfg.enabled){Uf(e,t,r,o,s,l);return}if(!r||!r.attract||!Array.isArray(r.attract)||r.attract.length===0){Uf(e,t,r,o,s,l);return}const u=pI(e,i),c=r.attract.length,d=Array(c);for(let f=0;f<c;f++)if(Array.isArray(r.attract[f])){d[f]=Array(r.attract[f].length);for(let g=0;g<r.attract[f].length;g++)d[f][g]=r.attract[f][g],r.attract[f][g]*=u}Uf(e,t,r,o,s,l),UC().interactionsApplied>0&&mI(e,t,r,i),fI(i.field,i.cfg,t.dt);for(let f=0;f<c;f++)if(d[f])for(let g=0;g<d[f].length;g++)r.attract[f][g]=d[f][g]}function pI(e,t){let o=0,s=0;for(let u=0;u<16;u++){const c=Math.floor(u/16*e.count);if(c>=e.count)continue;const{a:d,s:h}=uI(t.field,t.cfg,e.x[c],e.y[c]);o+=d,s+=h}const l=o/16,i=s/16;return Math.max(.7,Math.min(1.3,1+t.cfg.influenceGain*(l-i)))}function mI(e,t,r,o){var i;const l=Math.max(1,Math.floor(10));for(let u=0;u<e.count;u+=l){const c=e.x[u],d=e.y[u],h=e.type[u];for(let f=u+1;f<Math.min(u+10,e.count);f++){const g=e.x[f]-c,m=e.y[f]-d;if(g*g+m*m>.25*.25)continue;const v=e.type[f],b=((i=r.attract[h])==null?void 0:i[v])??0,S=(c+e.x[f])/2,C=(d+e.y[f])/2,k=Math.min(1,Math.abs(b)*.5),R=o.cfg.writeGain*k,j=h===v&&b>0?o.cfg.writeGain*k:0,T=h!==v&&b<0?o.cfg.writeGain*k*.8:0;hI(o.field,o.cfg,S,C,R,j,T,1)}}}const gI=[{name:"Orbit",typesCount:3,particleCount:1200,config:{rmax:.12,force:1.2,friction:.92,speedClamp:.1},matrixInit:e=>{e.attract[0][0]=-.3,e.attract[0][1]=.5,e.attract[0][2]=-.2,e.attract[1][0]=-.5,e.attract[1][1]=-.3,e.attract[1][2]=.6,e.attract[2][0]=.6,e.attract[2][1]=-.5,e.attract[2][2]=-.3;for(let t=0;t<3;t++)for(let r=0;r<3;r++)e.radius[t][r]=.1,e.falloff[t][r]=1.2}},{name:"Flocks",typesCount:4,particleCount:1500,config:{rmax:.15,force:.8,friction:.88,speedClamp:.12},matrixInit:e=>{for(let t=0;t<4;t++)for(let r=0;r<4;r++)t===r?e.attract[t][r]=.4:e.attract[t][r]=-.2,e.radius[t][r]=.12,e.falloff[t][r]=1.5}},{name:"Borders",typesCount:5,particleCount:2e3,config:{rmax:.1,force:1,friction:.9,speedClamp:.12},matrixInit:e=>{for(let t=0;t<5;t++)for(let r=0;r<5;r++)t===r?e.attract[t][r]=.6:e.attract[t][r]=-.7,e.radius[t][r]=.08,e.falloff[t][r]=1}},{name:"Mitosis",typesCount:2,particleCount:800,config:{rmax:.2,force:1.5,friction:.85,speedClamp:.16},matrixInit:e=>{e.attract[0][0]=.7,e.attract[0][1]=-.9,e.attract[1][0]=-.9,e.attract[1][1]=.7,e.radius[0][0]=.15,e.radius[0][1]=.18,e.radius[1][0]=.18,e.radius[1][1]=.15,e.falloff[0][0]=1,e.falloff[0][1]=.8,e.falloff[1][0]=.8,e.falloff[1][1]=1}},{name:"Ritual",typesCount:6,particleCount:2500,config:{rmax:.14,force:.9,friction:.93,speedClamp:.1},matrixInit:e=>{for(let t=0;t<6;t++)for(let r=0;r<6;r++){const o=(r-t+6)%6;o===0?e.attract[t][r]=.3:o===1?e.attract[t][r]=.5:o===5?e.attract[t][r]=-.6:e.attract[t][r]=-.2,e.radius[t][r]=.11,e.falloff[t][r]=1.3}}},{name:"Crisis",typesCount:3,particleCount:1e3,config:{rmax:.08,force:2,friction:.8,speedClamp:.1,entropy:.002},matrixInit:e=>{e.attract[0][0]=.8,e.attract[0][1]=-.9,e.attract[0][2]=.6,e.attract[1][0]=.6,e.attract[1][1]=-.5,e.attract[1][2]=-.8,e.attract[2][0]=-.9,e.attract[2][1]=.7,e.attract[2][2]=.5;for(let t=0;t<3;t++)for(let r=0;r<3;r++)e.radius[t][r]=.06,e.falloff[t][r]=.7}},{name:"Symbiosis",typesCount:4,particleCount:1800,config:{rmax:.16,force:1.1,friction:.91,speedClamp:.12},matrixInit:e=>{e.attract[0][0]=.2,e.attract[0][1]=.8,e.attract[0][2]=-.3,e.attract[0][3]=-.4,e.attract[1][0]=.8,e.attract[1][1]=.2,e.attract[1][2]=-.4,e.attract[1][3]=-.3,e.attract[2][0]=-.3,e.attract[2][1]=-.4,e.attract[2][2]=.2,e.attract[2][3]=.8,e.attract[3][0]=-.4,e.attract[3][1]=-.3,e.attract[3][2]=.8,e.attract[3][3]=.2;for(let t=0;t<4;t++)for(let r=0;r<4;r++)e.radius[t][r]=.13,e.falloff[t][r]=1.4}},{name:"Anomaly",typesCount:7,particleCount:2800,config:{rmax:.13,force:1.3,friction:.87,speedClamp:.14,entropy:.003},matrixInit:e=>{for(let t=0;t<7;t++)for(let r=0;r<7;r++){const o=Math.sin(t*1.7+r*2.3)*.9;e.attract[t][r]=o,e.radius[t][r]=.1+Math.abs(Math.cos(t+r))*.05,e.falloff[t][r]=.9+Math.abs(Math.sin(t*r))*.8}}},{name:"Nested",typesCount:6,particleCount:2200,config:{rmax:.14,force:1,friction:.92,speedClamp:.12,entropy:.001},matrixInit:e=>{for(let t=0;t<6;t++){const r=Math.floor(t/2);for(let o=0;o<6;o++){const s=Math.floor(o/2);t===o?e.attract[t][o]=.5:r===s?e.attract[t][o]=.7:(s-r+3)%3===1?e.attract[t][o]=.2:(s-r+3)%3===2?e.attract[t][o]=-.6:e.attract[t][o]=-.1,e.radius[t][o]=.11,e.falloff[t][o]=1.3}}}},{name:"Particle Life",typesCount:6,particleCount:2e3,config:{rmax:.25,force:1.5,drag:1.3,useDrag:!0,beta:.3,coreRepel:1,kernelMode:"classic",speedClamp:.15,entropy:0,softening:1e-4},matrixInit:e=>{for(let r=0;r<6;r++)for(let o=0;o<6;o++){const s=r*1.3+o*2.7;e.attract[r][o]=Math.sin(s)*.8,e.radius[r][o]=.18+Math.cos(r+o)*.08,e.falloff[r][o]=1.2}e.attract[0][1]=.7,e.attract[1][0]=-.6,e.attract[2][3]=.6,e.attract[3][2]=-.5,e.attract[1][1]=.5,e.attract[3][3]=.4}},{name:"Membranes",typesCount:5,particleCount:2e3,config:{rmax:.14,force:1.1,friction:.91,speedClamp:.12},matrixInit:e=>{for(let t=0;t<5;t++)for(let r=0;r<5;r++)t===r?e.attract[t][r]=.7:e.attract[t][r]=-.8,e.radius[t][r]=.12,e.falloff[t][r]=1.2}},{name:"Predators",typesCount:4,particleCount:1600,config:{rmax:.16,force:1.3,friction:.89,speedClamp:.14},matrixInit:e=>{for(let t=0;t<4;t++){const r=(t+1)%4,o=(t-1+4)%4;for(let s=0;s<4;s++)s===r?e.attract[t][s]=.7:s===o?e.attract[t][s]=-.6:t===s?e.attract[t][s]=.3:e.attract[t][s]=-.2,e.radius[t][s]=.14,e.falloff[t][s]=1.4}}},{name:"Parasites",typesCount:6,particleCount:2200,config:{rmax:.13,force:1,friction:.9,speedClamp:.12},matrixInit:e=>{for(let t=0;t<6;t++)for(let r=0;r<6;r++)t===r?e.attract[t][r]=.4:t%2===0&&r%2===1?e.attract[t][r]=-.5:t%2===1&&r%2===0?e.attract[t][r]=.6:e.attract[t][r]=-.2,e.radius[t][r]=.11,e.falloff[t][r]=1.3}},{name:"Orbits",typesCount:5,particleCount:1800,config:{rmax:.15,force:1.2,friction:.92,speedClamp:.12},matrixInit:e=>{for(let r=0;r<5;r++)for(let o=0;o<5;o++)r===0?o===0?e.attract[r][o]=.5:e.attract[r][o]=-.3:o===0?e.attract[r][o]=.6:r===o?e.attract[r][o]=.2:e.attract[r][o]=-.4,e.radius[r][o]=.13,e.falloff[r][o]=1.3}},{name:" Genesis Pool",typesCount:3,particleCount:600,showSigils:!0,config:{rmax:.18,force:1,friction:.88,speedClamp:.12,entropy:.004,beta:.15,drag:1.2,useDrag:!0},matrixInit:e=>{for(let t=0;t<3;t++)for(let r=0;r<3;r++)e.attract[t][r]=(t+r)%2===0?.3:-.3,e.radius[t][r]=.14,e.falloff[t][r]=1.2}},{name:" Bond Ritual",typesCount:4,particleCount:1e3,showSigils:!0,config:{rmax:.16,force:1.4,friction:.9,speedClamp:.1,entropy:.002,beta:.25},matrixInit:e=>{for(let t=0;t<4;t++)for(let r=0;r<4;r++)t===r?e.attract[t][r]=.8:e.attract[t][r]=.4,e.radius[t][r]=.12,e.falloff[t][r]=1}},{name:" Rift Storm",typesCount:5,particleCount:1400,showSigils:!0,config:{rmax:.14,force:1.6,friction:.85,speedClamp:.14,entropy:.005,beta:.1},matrixInit:e=>{for(let t=0;t<5;t++)for(let r=0;r<5;r++)t===r?e.attract[t][r]=.3:e.attract[t][r]=-.7,e.radius[t][r]=.1,e.falloff[t][r]=.9}},{name:" Bloom Garden",typesCount:4,particleCount:1200,showSigils:!0,config:{rmax:.2,force:.9,friction:.92,speedClamp:.12,entropy:.003,beta:.2,drag:1.4,useDrag:!0},matrixInit:e=>{e.attract[0][0]=.5,e.attract[0][1]=.6,e.attract[0][2]=-.3,e.attract[0][3]=-.2,e.attract[1][0]=-.4,e.attract[1][1]=.4,e.attract[1][2]=.7,e.attract[1][3]=-.3,e.attract[2][0]=.6,e.attract[2][1]=-.5,e.attract[2][2]=.3,e.attract[2][3]=.5,e.attract[3][0]=-.3,e.attract[3][1]=.6,e.attract[3][2]=-.4,e.attract[3][3]=.4;for(let t=0;t<4;t++)for(let r=0;r<4;r++)e.radius[t][r]=.16,e.falloff[t][r]=1.3}},{name:" Oath Paths",typesCount:3,particleCount:800,showSigils:!0,config:{rmax:.18,force:.8,friction:.95,speedClamp:.08,entropy:.001,beta:.3},matrixInit:e=>{const t=[1,2,0];for(let r=0;r<3;r++)for(let o=0;o<3;o++)o===t[r]?e.attract[r][o]=.7:r===o?e.attract[r][o]=.2:e.attract[r][o]=-.4,e.radius[r][o]=.15,e.falloff[r][o]=1.4}},{name:" Speciation Vortex",typesCount:6,particleCount:1800,showSigils:!0,config:{rmax:.15,force:1.2,friction:.88,speedClamp:.13,entropy:.006,beta:.18,drag:1.3,useDrag:!0},matrixInit:e=>{for(let t=0;t<6;t++)for(let r=0;r<6;r++){const o=t*2.1+r*1.7;e.attract[t][r]=Math.sin(o)*.7,e.radius[t][r]=.12+Math.abs(Math.cos(t-r))*.04,e.falloff[t][r]=1.1}}},{name:" Crystal Archive",typesCount:4,particleCount:1e3,showSigils:!0,config:{rmax:.12,force:1,friction:.94,speedClamp:.08,entropy:.001,beta:.25},matrixInit:e=>{for(let t=0;t<4;t++)for(let r=0;r<4;r++)t===r?e.attract[t][r]=.6:(t+r)%2===0?e.attract[t][r]=.3:e.attract[t][r]=-.5,e.radius[t][r]=.1,e.falloff[t][r]=1}},{name:" Mutation Forge",typesCount:7,particleCount:2e3,showSigils:!0,config:{rmax:.14,force:1.4,friction:.86,speedClamp:.14,entropy:.008,beta:.12,drag:1.1,useDrag:!0},matrixInit:e=>{for(let t=0;t<7;t++)for(let r=0;r<7;r++){const o=Math.sin(t*3.14+r*1.618)*.9;e.attract[t][r]=o,e.radius[t][r]=.11,e.falloff[t][r]=.95}}},{name:" Sigil Mandala",typesCount:5,particleCount:1500,showSigils:!0,config:{rmax:.17,force:1.1,friction:.91,speedClamp:.11,entropy:.003,beta:.22,drag:1.25,useDrag:!0},matrixInit:e=>{for(let t=0;t<5;t++)for(let r=0;r<5;r++){const o=(r-t+5)%5*(2*Math.PI/5);e.attract[t][r]=Math.cos(o)*.6,e.radius[t][r]=.14,e.falloff[t][r]=1.2}}},{name:" Primordial Soup",typesCount:8,particleCount:2400,showSigils:!0,config:{rmax:.16,force:1,friction:.89,speedClamp:.13,entropy:.004,beta:.16,drag:1.2,useDrag:!0},matrixInit:e=>{for(let t=0;t<8;t++)for(let r=0;r<8;r++)t===r?e.attract[t][r]=.4:Math.abs(t-r)===1||Math.abs(t-r)===7?e.attract[t][r]=.5:Math.abs(t-r)===4?e.attract[t][r]=-.6:e.attract[t][r]=Math.sin(t+r)*.3,e.radius[t][r]=.13,e.falloff[t][r]=1.15}}],yI=()=>({enabled:!1,baseDecay:.003,motionCost:.005,feedRadius:.03,feedRate:.04,reproductionThreshold:2,reproductionCost:.8,childEnergyRatio:.5,mutationChance:.05,deathThreshold:.2,startEnergy:1.2});let uf=null,t8=0,n8=0;const xI=(e,t,r,o,s)=>{if(!r.enabled)return{births:0,deaths:0};let l=0,i=0;if(!e.energy||e.energy.length<s){e.energy=new Float32Array(s);for(let m=0;m<e.count;m++)e.energy[m]=r.startEnergy}for(let m=0;m<e.count;m++){e.energy[m]-=r.baseDecay;const y=Math.sqrt(e.vx[m]*e.vx[m]+e.vy[m]*e.vy[m]);e.energy[m]-=y*r.motionCost}(!uf||Math.abs(t8-r.feedRadius)>.001||n8!==s)&&(uf=WC(r.feedRadius,2,s),t8=r.feedRadius,n8=s),HC(uf);for(let m=0;m<e.count;m++)GC(uf,m,e.x[m],e.y[m]);const u=r.feedRadius*r.feedRadius,c=t.attract.length,d=[];for(let m=0;m<e.count;m++){const y=e.type[m];if(!(y>=c)){d.length=0,VC(uf,e.x[m],e.y[m],v=>{d.push(v)});for(const v of d){if(v<=m)continue;const b=e.x[v]-e.x[m],S=e.y[v]-e.y[m],C=b*b+S*S;if(C<u&&C>1e-6){const k=e.type[v];if(k>=c)continue;t.attract[y]&&t.attract[y][k]!==void 0&&t.attract[y][k]>.3&&(e.energy[m]+=r.feedRate*t.attract[y][k]*.5),t.attract[k]&&t.attract[k][y]!==void 0&&t.attract[k][y]>.3&&(e.energy[v]+=r.feedRate*t.attract[k][y]*.5)}}}}const h=r.reproductionThreshold*3;for(let m=0;m<e.count;m++)e.energy[m]>h&&(e.energy[m]=h);const f=Math.max(1,Math.floor(e.count*.05)),g=[];for(let m=0;m<e.count&&g.length<f;m++)if(e.energy[m]>=r.reproductionThreshold&&e.count+g.length<s){e.energy[m]-=r.reproductionCost;const y=o.next()*Math.PI*2,v=.01+o.next()*.02;let b=e.type[m];if(o.next()<r.mutationChance){const S=t.attract.length;b=o.int(0,S-1)}g.push({x:e.x[m]+Math.cos(y)*v,y:e.y[m]+Math.sin(y)*v,vx:e.vx[m]*.5,vy:e.vy[m]*.5,type:b,energy:e.energy[m]*r.childEnergyRatio}),l++}for(const m of g){if(e.count>=s)break;const y=e.count;e.x[y]=m.x,e.y[y]=m.y,e.vx[y]=m.vx,e.vy[y]=m.vy,e.type[y]=m.type,e.energy[y]=m.energy,e.geneA&&(e.geneA[y]=e.geneA[Math.floor(o.next()*e.count)]||0),e.geneB&&(e.geneB[y]=e.geneB[Math.floor(o.next()*e.count)]||0),e.geneC&&(e.geneC[y]=e.geneC[Math.floor(o.next()*e.count)]||0),e.geneD&&(e.geneD[y]=e.geneD[Math.floor(o.next()*e.count)]||0),e.archetypeId&&(e.archetypeId[y]=e.archetypeId[Math.floor(o.next()*e.count)]||0),e.age&&(e.age[y]=0),e.size&&(e.size[y]=1),e.count++}for(let m=e.count-1;m>=0;m--)if(e.energy[m]<r.deathThreshold){const y=e.count-1;m!==y&&(e.x[m]=e.x[y],e.y[m]=e.y[y],e.vx[m]=e.vx[y],e.vy[m]=e.vy[y],e.type[m]=e.type[y],e.energy[m]=e.energy[y],e.geneA&&(e.geneA[m]=e.geneA[y]),e.geneB&&(e.geneB[m]=e.geneB[y]),e.geneC&&(e.geneC[m]=e.geneC[y]),e.geneD&&(e.geneD[m]=e.geneD[y]),e.archetypeId&&(e.archetypeId[m]=e.archetypeId[y]),e.age&&(e.age[m]=e.age[y]),e.size&&(e.size[m]=e.size[y])),e.count--,i++}return{births:l,deaths:i}},hf=(e,t)=>{const r=e*t;return{width:e,height:t,tension:new Float32Array(r),cohesion:new Float32Array(r),scarcity:new Float32Array(r),novelty:new Float32Array(r),mythic:new Float32Array(r)}},bI=()=>({diffusion:.15,decay:.02,depositStrength:1,influenceStrength:.5}),Tg=(e,t,r,o)=>{const s=Math.floor((e+1)/2*r),l=Math.floor((t+1)/2*o),i=Math.max(0,Math.min(r-1,s));return Math.max(0,Math.min(o-1,l))*r+i},Df=(e,t,r)=>{const o=Tg(t,r,e.width,e.height);return{tension:e.tension[o],cohesion:e.cohesion[o],scarcity:e.scarcity[o],novelty:e.novelty[o],mythic:e.mythic[o]}},Lf=(e,t,r,o,s)=>{const l=Tg(t,r,e.width,e.height);l>=0&&l<e[o].length&&(e[o][l]=Math.min(1,e[o][l]+s))},Im=(e,t,r,o,s,l,i,u,c)=>{const d=Math.max(3,Math.floor(o*e.width*.5));for(let h=0;h<d;h++){const f=h/d*Math.PI*2,g=o*Math.random(),m=t+Math.cos(f)*g,y=r+Math.sin(f)*g,v=Tg(m,y,e.width,e.height);if(v>=0&&v<e.tension.length){const b=1-g/o;s!==0&&(e.tension[v]=Math.min(1,e.tension[v]+s*b)),l!==0&&(e.cohesion[v]=Math.min(1,e.cohesion[v]+l*b))}}},ff=(e,t,r,o,s)=>{for(let l=0;l<o;l++)for(let i=0;i<r;i++){const u=l*r+i;let c=e[u]*(1-s);i>0&&(c+=e[u-1]*s*.25),i<r-1&&(c+=e[u+1]*s*.25),l>0&&(c+=e[u-r]*s*.25),l<o-1&&(c+=e[u+r]*s*.25),t[u]=c}},pf=(e,t)=>{for(let r=0;r<e.length;r++)e[r]=Math.max(0,e[r]-t)},h2=new Map,vI=(e,t)=>{const r=e.width*e.height;h2.has(r)||h2.set(r,new Float32Array(r));const o=h2.get(r);ff(e.tension,o,e.width,e.height,t.diffusion),e.tension.set(o),ff(e.cohesion,o,e.width,e.height,t.diffusion),e.cohesion.set(o),ff(e.scarcity,o,e.width,e.height,t.diffusion),e.scarcity.set(o),ff(e.novelty,o,e.width,e.height,t.diffusion),e.novelty.set(o),ff(e.mythic,o,e.width,e.height,t.diffusion),e.mythic.set(o),pf(e.tension,t.decay),pf(e.cohesion,t.decay),pf(e.scarcity,t.decay),pf(e.novelty,t.decay),pf(e.mythic,t.decay)},SI=(e,t,r)=>{const o=t.width*t.height,s=new Float32Array(o),l=new Map,i=new Float32Array(o);for(let c=0;c<e.count;c++){const d=e.type[c];(d===255||d>=0&&d<16)&&(l.has(d)||l.set(d,new Uint32Array(o)))}for(let c=0;c<e.count;c++){const d=e.type[c];if(d!==255&&(d<0||d>=16))continue;const h=Tg(e.x[c],e.y[c],t.width,t.height);s[h]+=1;const f=l.get(d);f&&(f[h]+=1);const g=Math.sqrt(e.vx[c]*e.vx[c]+e.vy[c]*e.vy[c]);i[h]+=g}const u=e.count/o;for(let c=0;c<o;c++){const d=s[c];if(d>u*2){const f=c%t.width/t.width*2-1,g=Math.floor(c/t.width)/t.height*2-1;Lf(t,f,g,"tension",.05*r)}let h=0;if(l.forEach(f=>{h=Math.max(h,f[c])}),h>d*.7&&d>5){const f=c%t.width/t.width*2-1,g=Math.floor(c/t.width)/t.height*2-1;Lf(t,f,g,"cohesion",.04*r)}if(d<u*.3){const f=c%t.width/t.width*2-1,g=Math.floor(c/t.width)/t.height*2-1;Lf(t,f,g,"scarcity",.03*r)}if(i[c]>.1&&d>3){const f=c%t.width/t.width*2-1,g=Math.floor(c/t.width)/t.height*2-1;Lf(t,f,g,"novelty",.06*r)}}},wI=()=>({cooldown:0,lastOperatorTime:0,artifacts:[]}),CI=()=>({interval:3,mutationStrength:.15,speciationRate:.6,institutionRate:.25,operatorCooldown:2}),MI=(e,t)=>{for(let r=e.artifacts.length-1;r>=0;r--)e.artifacts[r].elapsed+=t,e.artifacts[r].elapsed>=e.artifacts[r].duration&&e.artifacts.splice(r,1)};let kI=0;const RI=(e,t,r,o,s)=>({id:`artifact-${kI++}`,name:e,x:t,y:r,radius:.2,duration:15,elapsed:0,effect:o,sigil:s}),AI=(e,t)=>{let r=0,o=0,s=0,l=0,i=0;for(let C=0;C<t.tension.length;C++)r+=t.tension[C],o+=t.cohesion[C],s+=t.scarcity[C],l+=t.novelty[C],i+=t.mythic[C];const u=t.tension.length,c=r/u,d=o/u,h=s/u,f=l/u,g=i/u;let m=0;for(let C=0;C<u;C++)t.cohesion[C]>.4&&m++;let y=0;for(let C=0;C<u;C++)t.tension[C]>.3&&(y+=t.tension[C]);y/=u;const v=Math.abs(c-d),b=h>.25,S=f>.3;return{stableClusters:m,borderStrength:y,oscillation:v,scarcityCrisis:b,noveltyBurst:S,avgTension:c,avgCohesion:d,avgScarcity:h,avgNovelty:f,avgMythic:g}},f2=(e,t)=>{const r=new Array(t).fill(0);for(let s=0;s<e.count;s++)r[e.type[s]]++;let o=0;for(let s=0;s<t;s++)if(r[s]>0){const l=r[s]/e.count;o-=l*Math.log2(l)}return o/Math.log2(t)},jI=(e,t,r,o,s,l,i,u,c,d)=>{if(d-o.lastOperatorTime<3)return null;const h=c.next();if(s.borderStrength>.15&&s.avgTension>.2&&h<l){o.lastOperatorTime=d;const f=c.int(2,4);for(let g=0;g<f;g++){const m=c.int(0,t.typesCount-1),y=c.int(0,t.typesCount-1),v=c.range(-.2,.2);r.attract[m][y]=Math.max(-1,Math.min(1,r.attract[m][y]+v))}return{time:d,type:"mutation",message:"Contact patterns shift",sigil:""}}if(s.stableClusters>20&&h<i&&t.typesCount<16){o.lastOperatorTime=d;const f=t.typesCount,g=f+1;t.typesCount=g,jx(r,g,c,t.rmax);const m=c.int(0,f-1);let y=0;const v=Math.floor(e.count*(.1+c.next()*.1));for(let b=0;b<e.count&&y<v;b++)e.type[b]===m&&c.next()<.5&&(e.type[b]=f,y++);return{time:d,type:"speciation",message:` Speciation! ${f}  ${t.typesCount} (${y} converted)`,sigil:""}}if((s.oscillation>.2||s.avgMythic>.2)&&h<u){o.lastOperatorTime=d;let f=0,g=0,m=0;for(let v=0;v<16;v++)for(let b=0;b<16;b++)s.avgMythic>f&&(f=s.avgMythic,g=b/16*2-1,m=v/16*2-1);const y=RI("Taboo",g,m,{type:"field",fieldMod:{layer:"mythic",delta:.1}},"");return o.artifacts.push(y),{time:d,type:"institution",message:"A taboo spreads",sigil:""}}return null},EI=()=>({beats:[],maxBeats:50}),fu=(e,t)=>{e.beats.unshift(t),e.beats.length>e.maxBeats&&e.beats.pop()},TI=()=>({snapshots:[],maxSnapshots:20,currentIndex:-1}),Pm=(e,t,r,o,s,l)=>{var d,h;const i={attract:r.attract.map(f=>[...f]),radius:r.radius.map(f=>[...f]),falloff:((d=r.falloff)==null?void 0:d.map(f=>[...f]))??Array(r.attract.length).fill(0).map(()=>Array(r.attract.length).fill(1.2))},u={attract:o.attract.map(f=>[...f]),radius:o.radius.map(f=>[...f]),falloff:((h=o.falloff)==null?void 0:h.map(f=>[...f]))??Array(o.attract.length).fill(0).map(()=>Array(o.attract.length).fill(1.2))},c={timestamp:l,microConfig:{...t},matrix:i,baseMatrix:u,artifacts:s.artifacts.map(f=>({...f}))};e.snapshots.push(c),e.snapshots.length>e.maxSnapshots&&e.snapshots.shift(),e.currentIndex=e.snapshots.length-1},YC=e=>e.snapshots.length>1,II=(e,t,r,o,s)=>{if(!YC(e))return!1;e.snapshots.pop(),e.currentIndex=e.snapshots.length-1;const l=e.snapshots[e.currentIndex];return Object.assign(t,l.microConfig),rs(l.matrix,r),rs(l.baseMatrix,o),s.artifacts=l.artifacts.map(i=>({...i})),!0},PI=(e,t,r,o,s,l,i,u,c,d="Snapshot")=>({version:"1.0",timestamp:Date.now(),name:d,microState:{count:e.count,x:Array.from(e.x.slice(0,e.count)),y:Array.from(e.y.slice(0,e.count)),vx:Array.from(e.vx.slice(0,e.count)),vy:Array.from(e.vy.slice(0,e.count)),type:Array.from(e.type.slice(0,e.count))},microConfig:{...t},matrix:{size:r.size,data:r.data.map(h=>[...h])},baseMatrix:{size:o.size,data:o.data.map(h=>[...h])},fieldState:{width:s.width,height:s.height,tension:Array.from(s.tension),cohesion:Array.from(s.cohesion),scarcity:Array.from(s.scarcity),novelty:Array.from(s.novelty),mythic:Array.from(s.mythic)},fieldConfig:{...l},reconfigState:{artifacts:i.artifacts.map(h=>({...h}))},reconfigConfig:{...u},chronicle:{beats:c.beats.map(h=>({...h}))}}),FI=(e,t,r,o,s,l,i,u,c,d)=>{if(t.count=e.microState.count,t.x.set(e.microState.x),t.y.set(e.microState.y),t.vx.set(e.microState.vx),t.vy.set(e.microState.vy),t.type.set(e.microState.type),t.historyX&&t.historyY){for(let h=0;h<t.historyLength;h++)t.historyX[h].fill(0),t.historyY[h].fill(0);t.historyIndex=0}Object.assign(r,e.microConfig),o.size=e.matrix.size;for(let h=0;h<e.matrix.size;h++)for(let f=0;f<e.matrix.size;f++)o.data[h][f]=e.matrix.data[h][f];if(e.baseMatrix){s.size=e.baseMatrix.size;for(let h=0;h<e.baseMatrix.size;h++)for(let f=0;f<e.baseMatrix.size;f++)s.data[h][f]=e.baseMatrix.data[h][f]}else{s.size=e.matrix.size;for(let h=0;h<e.matrix.size;h++)for(let f=0;f<e.matrix.size;f++)s.data[h][f]=e.matrix.data[h][f]}l.width=e.fieldState.width,l.height=e.fieldState.height,l.tension.set(e.fieldState.tension),l.cohesion.set(e.fieldState.cohesion),l.scarcity.set(e.fieldState.scarcity),l.novelty.set(e.fieldState.novelty),l.mythic.set(e.fieldState.mythic),Object.assign(i,e.fieldConfig),u.artifacts=e.reconfigState.artifacts.map(h=>({...h})),Object.assign(c,e.reconfigConfig),d.beats=e.chronicle.beats.map(h=>({...h}))},NI=`#version 300 es
precision highp float;

in vec2 a_position;
in float a_type;
in float a_size; // Per-particle size multiplier
in float a_mutationGlow; // Mutation potential glow (0-1)

uniform float u_pointSize;
uniform float u_typeCount;

out float v_type;
out float v_mutationGlow;

void main() {
  gl_Position = vec4(a_position, 0.0, 1.0);
  gl_PointSize = u_pointSize * a_size; // Scale by particle size
  v_type = a_type;
  v_mutationGlow = a_mutationGlow;
}
`,OI=`#version 300 es
precision highp float;

in float v_type;
in float v_mutationGlow;
uniform float u_typeCount;
uniform float u_glow; // G) Glow intensity
uniform vec3 u_palette[16]; // G) Color palette (max 16 types)

out vec4 fragColor;

void main() {
  // Circular point with smooth edge
  vec2 coord = gl_PointCoord - 0.5;
  float dist = length(coord) * 2.0; // normalize to 0-1
  
  if (dist > 1.0) discard;
  
  // Smooth antialiased edge
  float edge = 1.0 - smoothstep(0.9, 1.0, dist);
  
  // Radial gradient (soft center)
  float gradient = 1.0 - (dist * dist * 0.5);
  float alpha = edge * gradient * 0.85;
  
  // Get color from palette
  int typeIndex = int(v_type);
  if (typeIndex < 0 || typeIndex >= 16) typeIndex = 0;
  vec3 color = u_palette[typeIndex];
  
  // Optional glow: brighten center
  if (u_glow > 0.01) {
    float glowFactor = exp(-dist * dist * 3.0);
    color *= (1.0 + glowFactor * u_glow * 0.5);
    alpha += glowFactor * u_glow * 0.1;
  }
  
  // Mutation glow: pulsing white ring when mutating
  if (v_mutationGlow > 0.01) {
    float ringDist = abs(dist - 0.6); // Ring at 60% radius
    float ringIntensity = exp(-ringDist * 15.0) * v_mutationGlow;
    color = mix(color, vec3(1.0, 0.95, 0.8), ringIntensity * 0.7); // Golden glow
    alpha += ringIntensity * 0.3;
  }
  
  fragColor = vec4(color, clamp(alpha, 0.0, 1.0));
}
`,Fm=(e,t,r)=>{const o=e.createShader(t);return o?(e.shaderSource(o,r),e.compileShader(o),e.getShaderParameter(o,e.COMPILE_STATUS)?o:(console.error("Shader compile error:",e.getShaderInfoLog(o)),e.deleteShader(o),null)):null},r8=(e,t,r)=>{const o=e.createProgram();return o?(e.attachShader(o,t),e.attachShader(o,r),e.linkProgram(o),e.getProgramParameter(o,e.LINK_STATUS)?o:(console.error("Program link error:",e.getProgramInfoLog(o)),e.deleteProgram(o),null)):null},_I=e=>{const t=e.getContext("webgl2",{alpha:!1,antialias:!1,preserveDrawingBuffer:!0});if(!t)return null;const r=Fm(t,t.VERTEX_SHADER,NI),o=Fm(t,t.FRAGMENT_SHADER,OI);if(!r||!o)return null;const s=r8(t,r,o);if(!s)return null;const l=t.createBuffer(),i=t.createBuffer(),u=t.createBuffer(),c=t.createBuffer(),d=t.createVertexArray();if(!l||!i||!u||!c||!d)return null;t.bindVertexArray(d),t.bindBuffer(t.ARRAY_BUFFER,l);const h=t.getAttribLocation(s,"a_position");t.enableVertexAttribArray(h),t.vertexAttribPointer(h,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,i);const f=t.getAttribLocation(s,"a_type");t.enableVertexAttribArray(f),t.vertexAttribPointer(f,1,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,u);const g=t.getAttribLocation(s,"a_size");t.enableVertexAttribArray(g),t.vertexAttribPointer(g,1,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,c);const m=t.getAttribLocation(s,"a_mutationGlow");t.enableVertexAttribArray(m),t.vertexAttribPointer(m,1,t.FLOAT,!1,0,0),t.bindVertexArray(null);const y={pointSize:t.getUniformLocation(s,"u_pointSize"),typeCount:t.getUniformLocation(s,"u_typeCount"),glow:t.getUniformLocation(s,"u_glow"),palette:t.getUniformLocation(s,"u_palette")},v={index:-1,typesCount:-1,array:new Float32Array(48)};let b=null,S=null,C=null;const k=`#version 300 es
in vec2 a_position;
out vec2 v_texCoord;
void main(){v_texCoord=a_position*0.5+0.5;gl_Position=vec4(a_position,0.0,1.0);}`,R=`#version 300 es
precision mediump float;
in vec2 v_texCoord;
out vec4 fragColor;
uniform float u_fade;
void main(){float alpha=1.0-u_fade;fragColor=vec4(0.02,0.02,0.05,alpha);}`,j=Fm(t,t.VERTEX_SHADER,k),T=Fm(t,t.FRAGMENT_SHADER,R);if(j&&T&&(C=r8(t,j,T),C&&(b=t.createVertexArray(),S=t.createBuffer(),b&&S))){t.bindVertexArray(b),t.bindBuffer(t.ARRAY_BUFFER,S),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),t.STATIC_DRAW);const _=t.getAttribLocation(C,"a_position");t.enableVertexAttribArray(_),t.vertexAttribPointer(_,2,t.FLOAT,!1,0,0),t.bindVertexArray(null)}return{gl:t,canvas:e,program:s,fadeProgram:C,positionBuffer:l,typeBuffer:i,sizeBuffer:u,mutationGlowBuffer:c,vao:d,fadeVao:b,quadBuffer:S,config:{pointSize:4,fade:.96,glow:.5,paletteIndex:0},positionsArray:null,typesArray:null,sizesArray:null,mutationGlowsArray:null,maxParticles:0,uniforms:y,paletteCache:v,lastCount:-1,cachedW:0,cachedH:0}},DI=e=>{const{canvas:t,gl:r}=e,o=window.devicePixelRatio||1,s=t.getBoundingClientRect(),l=Math.floor(s.width*o),i=Math.floor(s.height*o);(t.width!==l||t.height!==i)&&(t.width=l,t.height=i,e.cachedW=l,e.cachedH=i),r.viewport(0,0,t.width,t.height)},LI=(e,t)=>{Object.assign(e.config,t)},zI=(e,t)=>{const{paletteCache:r,config:o}=e;if(r.index===o.paletteIndex&&r.typesCount===t)return;r.index=o.paletteIndex,r.typesCount=t;const s=r.array;for(let l=0;l<Math.min(t,16);l++){const i=qC(o.paletteIndex,l,t);s[l*3]=i[0],s[l*3+1]=i[1],s[l*3+2]=i[2]}},BI=(e,t,r,o,s,l)=>{const{gl:i,program:u,positionBuffer:c,typeBuffer:d,sizeBuffer:h,mutationGlowBuffer:f,vao:g,uniforms:m}=e;DI(e),i.clearColor(0,0,0,1),i.clear(i.COLOR_BUFFER_BIT),(!e.positionsArray||e.maxParticles<t.maxCount)&&(e.positionsArray=new Float32Array(t.maxCount*2),e.typesArray=new Float32Array(t.maxCount),e.sizesArray=new Float32Array(t.maxCount),e.mutationGlowsArray=new Float32Array(t.maxCount),e.maxParticles=t.maxCount,e.lastCount=-1),i.enable(i.BLEND),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA);const y=e.positionsArray,v=e.typesArray,b=e.sizesArray,S=e.mutationGlowsArray,C=t.count;for(let P=0;P<C;P++){y[P*2]=t.x[P],y[P*2+1]=t.y[P],v[P]=t.type[P],b[P]=t.size[P];const I=t.mutationPotential[P];S[P]=Math.sin(I*Math.PI)*I}const k=y.subarray(0,C*2),R=v.subarray(0,C),j=b.subarray(0,C),T=S.subarray(0,C);e.lastCount===C?(i.bindBuffer(i.ARRAY_BUFFER,c),i.bufferSubData(i.ARRAY_BUFFER,0,k),i.bindBuffer(i.ARRAY_BUFFER,d),i.bufferSubData(i.ARRAY_BUFFER,0,R),i.bindBuffer(i.ARRAY_BUFFER,h),i.bufferSubData(i.ARRAY_BUFFER,0,j),i.bindBuffer(i.ARRAY_BUFFER,f),i.bufferSubData(i.ARRAY_BUFFER,0,T)):(i.bindBuffer(i.ARRAY_BUFFER,c),i.bufferData(i.ARRAY_BUFFER,k,i.DYNAMIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,d),i.bufferData(i.ARRAY_BUFFER,R,i.DYNAMIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,h),i.bufferData(i.ARRAY_BUFFER,j,i.DYNAMIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,f),i.bufferData(i.ARRAY_BUFFER,T,i.DYNAMIC_DRAW),e.lastCount=C),i.useProgram(u),i.bindVertexArray(g);const _=window.devicePixelRatio||1;i.uniform1f(m.pointSize,e.config.pointSize*_),i.uniform1f(m.typeCount,r),i.uniform1f(m.glow,e.config.glow),zI(e,r),i.uniform3fv(m.palette,e.paletteCache.array),i.blendFunc(i.SRC_ALPHA,i.ONE),i.drawArrays(i.POINTS,0,C),i.bindVertexArray(null)};let ud=null,$r=null,o8=0,a8=0;const sd=new Map,p2=new Map,Hu=e=>{if(!p2.has(e)){const t=Eg(e);p2.set(e,{solid:t,transparent:t.replace("rgb","rgba").replace(")",", 0.05)"),glow:t.replace("rgb","rgba").replace(")",", 0.15)")})}return p2.get(e)},s8=(e,t,r,o,s,l)=>{const i=`${l}_${Math.round(o-t)}_${Math.round(s-r)}`;if(!sd.has(i)){const u=e.createLinearGradient(0,0,o-t,s-r),c=Hu(l);if(u.addColorStop(0,c.transparent),u.addColorStop(.5,c.solid.replace("rgb","rgba").replace(")",", 0.4)")),u.addColorStop(1,c.solid),sd.set(i,u),sd.size>50){const d=sd.keys().next().value;sd.delete(d)}}return sd.get(i)},$I=(e,t)=>{(!ud||o8!==e||a8!==t)&&(ud=document.createElement("canvas"),ud.width=e,ud.height=t,$r=ud.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!1}),$r&&($r.fillStyle="rgb(5, 5, 13)",$r.fillRect(0,0,e,t)),o8=e,a8=t,sd.clear())},qI=(e,t,r,o,s,l="dots",i=8,u="HIGH",c=2)=>{const d=r/2,h=o/2,f=r/2,g=o/2,m=t.count,y=m>600?"FAST":m>400?"HIGH":u;if(s){if($I(r,o),$r&&ud){if($r.globalCompositeOperation="source-over",$r.fillStyle="rgba(5, 5, 13, 0.08)",$r.fillRect(0,0,r,o),l==="streaks"&&y!=="FAST"){$r.lineCap="round";const v=new Map;for(let b=0;b<t.count;b++){const S=t.type[b],C=t.vx[b],k=t.vy[b],R=Math.sqrt(C*C+k*k);v.has(S)||v.set(S,[]),v.get(S).push({x:t.x[b]*d+f,y:t.y[b]*h+g,vx:C,vy:k,speed:R})}v.forEach((b,S)=>{const C=Hu(S);for(const k of b){const R=Math.max(2,Math.min(24,k.speed*i*1e3)),j=Math.max(.8,Math.min(3.5,k.speed*800)),T=k.x-k.vx*R*d,_=k.y-k.vy*R*h;$r.save(),$r.translate(T,_),$r.strokeStyle=s8($r,T,_,k.x,k.y,S),$r.lineWidth=j,$r.beginPath(),$r.moveTo(0,0),$r.lineTo(k.x-T,k.y-_),$r.stroke(),$r.restore(),k.speed>.03&&y==="ULTRA"&&($r.globalCompositeOperation="lighter",$r.strokeStyle=C.glow,$r.lineWidth=j*1.8,$r.beginPath(),$r.moveTo(T,_),$r.lineTo(k.x,k.y),$r.stroke(),$r.globalCompositeOperation="source-over")}})}else for(let v=0;v<t.count;v++){const b=t.x[v]*d+f,S=t.y[v]*h+g,C=t.type[v];$r.fillStyle=Hu(C).solid,$r.fillRect(b-c/2,S-c/2,c,c)}e.drawImage(ud,0,0)}if(y!=="FAST"&&t.count<500)for(let v=0;v<t.count;v++){const b=t.x[v]*d+f,S=t.y[v]*h+g,C=t.type[v];e.fillStyle=Hu(C).solid,e.beginPath(),e.arc(b,S,c*.75,0,Math.PI*2),e.fill()}}else if(e.fillStyle="rgb(5, 5, 13)",e.fillRect(0,0,r,o),l==="streaks"&&y!=="FAST"){e.lineCap="round";const v=new Map;for(let b=0;b<t.count;b++){const S=t.type[b],C=t.vx[b],k=t.vy[b],R=Math.sqrt(C*C+k*k);v.has(S)||v.set(S,[]),v.get(S).push({x:t.x[b]*d+f,y:t.y[b]*h+g,vx:C,vy:k,speed:R})}v.forEach((b,S)=>{const C=Hu(S);for(const k of b){const R=Math.max(2,Math.min(24,k.speed*i*1e3)),j=Math.max(.8,Math.min(3.5,k.speed*800)),T=k.x-k.vx*R*d,_=k.y-k.vy*R*h;e.save(),e.translate(T,_),e.strokeStyle=s8(e,T,_,k.x,k.y,S),e.lineWidth=j,e.beginPath(),e.moveTo(0,0),e.lineTo(k.x-T,k.y-_),e.stroke(),e.restore(),k.speed>.03&&y==="ULTRA"&&(e.globalCompositeOperation="lighter",e.strokeStyle=C.glow,e.lineWidth=j*1.8,e.beginPath(),e.moveTo(T,_),e.lineTo(k.x,k.y),e.stroke(),e.globalCompositeOperation="source-over"),e.fillStyle=C.solid,e.beginPath(),e.arc(k.x,k.y,c,0,Math.PI*2),e.fill()}})}else for(let v=0;v<t.count;v++){const b=t.x[v]*d+f,S=t.y[v]*h+g,C=t.type[v];e.fillStyle=Hu(C).solid,y==="FAST"?e.fillRect(b-c/2,S-c/2,c,c):(e.beginPath(),e.arc(b,S,c,0,Math.PI*2),e.fill())}},WI={nutrient:"#34d399",tension:"#f87171",memory:"#60a5fa",entropy:"#fbbf24",sigilBond:"#5ac8fa",sigilRift:"#ff6b6b",sigilBloom:"#78ff8c",sigilOath:"#c084fc"},HI=(e,t,r,o,s,l)=>{const i=t.size,u=t.layers[r];if(!u)return;const c=WI[r]??"#ffffff",d=parseInt(c.slice(1,3),16),h=parseInt(c.slice(3,5),16),f=parseInt(c.slice(5,7),16),g=Math.min(o,256),m=Math.min(s,256),y=e.createImageData(g,m),v=y.data;for(let C=0;C<m;C++)for(let k=0;k<g;k++){const R=k/g*i,j=C/m*i,T=Math.min(Math.floor(R),i-1),_=Math.min(Math.floor(j),i-1),P=Math.min(T+1,i-1),I=Math.min(_+1,i-1),$=R-T,q=j-_,L=(u[_*i+T]*(1-$)+u[_*i+P]*$)*(1-q)+(u[I*i+T]*(1-$)+u[I*i+P]*$)*q;if(L>.02){const H=Math.pow(Math.min(1,L*l),.7),G=(C*g+k)*4;v[G]=d*H,v[G+1]=h*H,v[G+2]=f*H,v[G+3]=H*255}}e.save(),e.globalAlpha=.75;const b=document.createElement("canvas");b.width=g,b.height=m,b.getContext("2d").putImageData(y,0,0),e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="low",e.drawImage(b,0,0,o,s),e.restore()},GI=(e,t,r,o)=>{const s=r/2,l=o/2,i=r/2,u=o/2;for(const c of t){const d=c.x*s+i,h=c.y*l+u,f=c.radius*s,g=1-c.elapsed/c.duration;e.strokeStyle=`rgba(255, 100, 255, ${g*.6})`,e.lineWidth=2,e.beginPath(),e.arc(d,h,f*(1+Math.sin(c.elapsed*3)*.1),0,Math.PI*2),e.stroke(),e.fillStyle=`rgba(255, 150, 255, ${g})`,e.font="24px monospace",e.textAlign="center",e.textBaseline="middle",e.fillText(c.sigil,d,h)}},VI=(e,t,r,o,s,l,i)=>{let u="rgba(255, 255, 255, 0.5)";s==="CAPTURE"?u="rgba(255, 200, 0, 0.8)":s==="ERASE"?u="rgba(255, 100, 100, 0.6)":s==="SEED"&&(u="rgba(100, 255, 100, 0.6)"),e.strokeStyle=u,e.lineWidth=s==="CAPTURE"?2.5:1.5,e.setLineDash(s==="CAPTURE"?[2,2]:[4,4]),e.beginPath(),e.arc(t,r,o,0,Math.PI*2),e.stroke(),e.setLineDash([]);let c="rgba(255, 255, 255, 0.8)";s==="CAPTURE"&&(c="rgba(255, 220, 0, 1)"),e.fillStyle=c,e.font="11px monospace",e.textAlign="center",e.textBaseline="bottom",e.fillText(s,t,r-o-8),s==="CAPTURE"&&(e.strokeStyle="rgba(255, 220, 0, 0.6)",e.lineWidth=1,e.beginPath(),e.moveTo(t-6,r),e.lineTo(t+6,r),e.moveTo(t,r-6),e.lineTo(t,r+6),e.stroke())},UI=(e,t,r,o,s,l)=>{e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(10,l-70,200,60),e.fillStyle="rgba(255, 255, 255, 0.9)",e.font="11px monospace",e.textAlign="left",e.textBaseline="top",e.fillText(`Particles: ${t}`,15,l-65),e.fillText(`Species: ${r}`,15,l-50),e.fillText(`Last: ${o}`,15,l-35)},YI=(e,t,r,o)=>{const s=r/2,l=o/2,i=r/2,u=o/2;e.save();for(const c of t){const d=c.x*s+i,h=c.y*l+u,f=parseInt(c.color.slice(1,3),16),g=parseInt(c.color.slice(3,5),16),m=parseInt(c.color.slice(5,7),16),y=c.intensity,b=Date.now()/1e3-c.spawnTime,S=1+Math.sin(b*2.8)*.1,C=2;for(let T=0;T<C;T++){const _=(b*1.6+T*.5)%2;if(_<1){const P=22+_*55,I=(1-_)*y*.35;e.globalAlpha=I,e.strokeStyle=`rgb(${f},${g},${m})`,e.lineWidth=1.5,e.beginPath(),e.arc(d,h,P,0,Math.PI*2),e.stroke()}}const k=36*S,R=e.createRadialGradient(d,h,0,d,h,k);R.addColorStop(0,`rgba(${f},${g},${m},${(y*.3).toFixed(3)})`),R.addColorStop(1,`rgba(${f},${g},${m},0)`),e.globalAlpha=1,e.fillStyle=R,e.beginPath(),e.arc(d,h,k,0,Math.PI*2),e.fill();const j=Math.round(28*S);if(e.globalAlpha=y,e.font=`${j}px serif, sans-serif`,e.textAlign="center",e.textBaseline="middle",e.shadowColor=`rgba(${f},${g},${m},${y*.9})`,e.shadowBlur=14,e.fillStyle=`rgb(${f},${g},${m})`,e.fillText(c.sigil,d,h),e.shadowBlur=0,y>.3){const T=Math.min(1,y*1.4),_=Math.max(9,Math.round(10*S));e.font=`${_}px monospace`,e.textAlign="center",e.textBaseline="middle";const P=h+j*.75+10,I=e.measureText(c.name).width,$=3,q=7;e.globalAlpha=T*.55,e.fillStyle="rgba(4,2,12,0.80)",e.beginPath(),e.roundRect(d-I/2-q,P-_/2-$,I+q*2,_+$*2,4),e.fill(),e.globalAlpha=T*.35,e.strokeStyle=`rgb(${f},${g},${m})`,e.lineWidth=.8,e.stroke(),e.globalAlpha=T,e.fillStyle=`rgba(${f},${g},${m},${T})`,e.fillText(c.name,d,P)}e.globalAlpha=1,e.shadowBlur=0}e.restore()},Yf=new Map;function KI(e,t){for(let r=0;r<e.count;r++){Yf.has(r)||Yf.set(r,{positions:[]});const o=Yf.get(r);o.positions.push({x:e.x[r],y:e.y[r]}),o.positions.length>t&&o.positions.shift()}}function i8(){Yf.clear()}function XI(e,t,r,o){const s=r.maxDistance*r.maxDistance,l=e.canvas.getBoundingClientRect(),i=l.width,u=l.height,c=i/2,d=u/2,h=i/2,f=u/2;e.save(),e.globalAlpha=r.opacity,e.lineWidth=r.thickness;for(let g=0;g<t.count;g++){const m=t.x[g],y=t.y[g],v=t.type[g];for(let b=g+1;b<t.count;b++){const S=t.x[b],C=t.y[b],k=S-m,R=C-y,j=k*k+R*R;if(j<s&&j>0&&Math.abs(k)<1&&Math.abs(R)<1){e.strokeStyle=Eg(v,o);const T=m*c+h,_=-y*d+f,P=S*c+h,I=-C*d+f;e.beginPath(),e.moveTo(T,_),e.lineTo(P,I),e.stroke()}}}e.restore()}function ZI(e,t,r,o){const s=e.canvas.getBoundingClientRect(),l=s.width,i=s.height,u=l/2,c=i/2,d=l/2,h=i/2;e.save(),e.lineWidth=2,e.lineCap="round",e.lineJoin="round";for(let f=0;f<t.count;f++){const g=Yf.get(f);if(!g||g.positions.length<2)continue;const m=t.type[f],y=Eg(m,o);e.strokeStyle=y;for(let v=1;v<g.positions.length;v++){const b=g.positions[v-1],S=g.positions[v],C=S.x-b.x,k=S.y-b.y;if(Math.abs(C)>1||Math.abs(k)>1)continue;{const P=v/g.positions.length*r.opacity;e.globalAlpha=P}const R=b.x*u+d,j=-b.y*c+h,T=S.x*u+d,_=-S.y*c+h;e.beginPath(),e.moveTo(R,j),e.lineTo(T,_),e.stroke()}}e.restore()}const Nm={bond:"",rift:"",bloom:"",oath:""},Om={bond:"rgba(100, 200, 255, ",rift:"rgba(255, 100, 120, ",bloom:"rgba(120, 255, 140, ",oath:"rgba(200, 180, 255, "};function JI(e,t,r,o,s){if(!r.enabled||!r.showOverlay)return;const l=t.width,i=t.height,u=3;e.save(),e.font="16px monospace",e.textAlign="center",e.textBaseline="middle";for(let c=0;c<i;c+=u)for(let d=0;d<l;d+=u){const h=c*l+d,f=t.bond[h],g=t.rift[h],m=t.bloom[h],y=t.oath[h],v=Math.max(f,g,m,y);if(v<.25)continue;let b="",S="";f===v?(b=Nm.bond,S=Om.bond):g===v?(b=Nm.rift,S=Om.rift):m===v?(b=Nm.bloom,S=Om.bloom):y===v&&(b=Nm.oath,S=Om.oath);const C=d/l*2-1,k=c/i*2-1,R=(C+1)/2*o,j=(k+1)/2*s,T=Math.min(.6,v*.8);e.fillStyle=S+T+")",e.fillText(b,R,j)}e.restore()}function KC(e,t,r,o){const s=t.w,l=t.h,i=r/s,u=o/l,c=.08;for(let d=0;d<l;d++)for(let h=0;h<s;h++){const f=d*s+h,g=t.A[f],m=t.S[f],y=g-m;if(Math.abs(y)<c)continue;const v=h*i,b=d*u;y>0?e.fillStyle=`rgba(100, 200, 255, ${Math.min(.3,y*.4)})`:e.fillStyle=`rgba(255, 100, 120, ${Math.min(.3,-y*.4)})`,e.fillRect(v,b,i,u)}}typeof window<"u"&&(window.renderRecursiveFieldHeatmap=KC);function QI(e,t){switch(e.type){case"speciation":return{title:" Nova Espcie Emergiu",description:`${e.message} - Uma nova forma de vida surgiu da sopa primordial! As interaes complexas levaram  diferenciao espontnea.`,mood:"discovery",significance:.8};case"institution":return{title:" Instituio Estabelecida",description:`${e.message} - Padres de comportamento coletivo cristalizaram-se em estruturas duradouras. Uma nova ordem social emerge.`,mood:"harmony",significance:.9};case"mutation":return{title:" Mutao Detectada",description:`${e.message} - As foras caticas causaram uma mudana fundamental nas regras do universo. Nada ser como antes.`,mood:"tension",significance:.7};default:return{title:e.message,description:"Algo interessante aconteceu no universo.",mood:"wonder",significance:.5}}}function eP(e,t,r){const o=Math.min(1,e.avgCohesion),s=Math.min(1,e.stableClusters/5),l=Math.abs(e.avgTension-.5)*2,i=e.avgNovelty,u=Math.max(0,Math.min(1,o*.4+s*.3-l*.2-i*.1)),c=Math.max(0,Math.min(1,e.avgScarcity*.4+Math.abs(e.avgTension-.5)*.3+(e.noveltyBurst?.3:0))),d=Math.min(1,e.avgNovelty*.5+(e.stableClusters>0?.3:0)+(e.borderStrength>.5?.2:0)),h=Math.min(1,Math.sqrt(r/120));return{score:u,entropy:c,complexity:d,resilience:h}}function tP(e,t,r){return t>=4?{title:" Exploso Reprodutiva",description:`Um organismo massivo se fragmentou em ${t} descendentes! A vida encontra um caminho atravs da diviso explosiva.`,mood:"chaos",significance:.9}:t===2?{title:" Diviso Celular",description:"Um organismo atingiu massa crtica e se dividiu em dois. A reproduo atravs da mitose  a base da vida multicelular.",mood:"wonder",significance:.7}:{title:" Fragmentao",description:`Um cluster instvel se fragmentou em ${t} partes. s vezes o caos  necessrio para criar ordem.`,mood:"tension",significance:.6}}function nP(e){return e.score>.8&&e.entropy<.3?" Equilbrio Perfeito - O universo encontrou harmonia":e.entropy>.7&&e.score<.3?" Caos Primordial - Foras destrutivas dominam":e.complexity>.7?" Complexidade Emergente - Padres intrincados se formam":e.resilience>.8?" Sistema Resiliente - Ordem resistente s perturbaes":" Fluxo Dinmico - Criao e destruio em equilbrio"}let rP=0;const oP=(e=200)=>({events:[],max:e});function aP(e,t){const r={id:`ev_${rP++}`,ts:Date.now(),...t};return e.events.unshift(r),e.events.length>e.max&&e.events.pop(),r}function pu(e){if(e<60)return`${e.toFixed(1)}s`;const t=Math.floor(e/60),r=Math.floor(e%60);return`${t}m ${r}s`}const sP=()=>{const[e]=w.useState(()=>oP(250)),[,t]=w.useState(0),r=w.useCallback(s=>{const l=aP(e,s);return t(i=>i+1),l},[e]),o=w.useCallback(()=>{e.events=[],t(s=>s+1)},[e]);return{log:e,push:r,clear:o,events:e.events}},l8={beat:{label:"Beat",color:"#60a5fa"},achievement:{label:"Achievement",color:"#fbbf24"},challenge:{label:"Challenge",color:"#a78bfa"},organism_capture:{label:"Capture",color:"#34d399"},mitosis:{label:"Mitosis",color:"#f472b6"},metamorphosis:{label:"Evolution",color:"#22d3ee"},pattern:{label:"Pattern",color:"#fb923c"},system:{label:"System",color:"#94a3b8"}},iP=({events:e,visible:t,onClose:r})=>{const[o,s]=w.useState("all"),[l,i]=w.useState(null);if(!t)return null;const u=o==="all"?e:e.filter(h=>h.type===o),c=()=>{const h=u.slice(0,50).map(f=>`[${pu(f.t)}] ${f.sigil||""} ${f.title}${f.detail?` - ${f.detail}`:""}`).join(`
`);navigator.clipboard.writeText(h)},d={lastSpeciation:e.find(h=>{var f;return h.type==="beat"&&((f=h.meta)==null?void 0:f.beatType)==="speciation"}),lastInstitution:e.find(h=>{var f;return h.type==="beat"&&((f=h.meta)==null?void 0:f.beatType)==="institution"}),lastAchievement:e.find(h=>h.type==="achievement"),lastCapture:e.find(h=>h.type==="organism_capture")};return a.jsxs("div",{className:"fixed top-20 right-4 w-[480px] max-h-[calc(100vh-120px)] bg-black/90 backdrop-blur-md border border-white/10 rounded-lg shadow-2xl flex flex-col z-50",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-xl",children:""}),a.jsx("h2",{className:"text-white font-light text-sm tracking-wider uppercase",children:"World Log"}),a.jsxs("span",{className:"text-white/40 text-xs",children:["(",u.length,")"]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:c,className:"p-1.5 hover:bg-white/10 rounded transition-colors",title:"Copy log to clipboard",children:a.jsx(PC,{size:14,className:"text-white/60"})}),r&&a.jsx("button",{onClick:r,className:"p-1.5 hover:bg-white/10 rounded transition-colors",children:a.jsx(ya,{size:14,className:"text-white/60"})})]})]}),a.jsxs("div",{className:"p-3 border-b border-white/10 flex flex-wrap gap-1.5",children:[a.jsxs("button",{onClick:()=>s("all"),className:`px-2 py-1 text-[10px] uppercase tracking-wider rounded transition-all ${o==="all"?"bg-white/20 text-white border border-white/30":"bg-white/5 text-white/50 border border-white/10 hover:bg-white/10"}`,children:["All (",e.length,")"]}),Object.entries(l8).map(([h,f])=>{const g=e.filter(m=>m.type===h).length;return g===0?null:a.jsxs("button",{onClick:()=>s(h),className:`px-2 py-1 text-[10px] uppercase tracking-wider rounded transition-all ${o===h?"text-white border":"bg-white/5 text-white/50 border border-white/10 hover:bg-white/10"}`,style:{backgroundColor:o===h?f.color+"20":void 0,borderColor:o===h?f.color+"40":void 0,color:o===h?f.color:void 0},children:[f.label," (",g,")"]},h)})]}),o==="all"&&a.jsxs("div",{className:"p-3 border-b border-white/10 space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-2 text-white/40 text-[9px] uppercase tracking-wider mb-2",children:[a.jsx(NC,{size:10}),a.jsx("span",{children:"Highlights"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[d.lastSpeciation&&a.jsxs("div",{className:"p-2 bg-blue-500/10 border border-blue-500/20 rounded",children:[a.jsx("div",{className:"text-blue-400 text-[9px] uppercase tracking-wider mb-0.5",children:"Last Speciation"}),a.jsxs("div",{className:"text-white/80 text-[11px]",children:[d.lastSpeciation.sigil," ",d.lastSpeciation.title]}),a.jsx("div",{className:"text-white/40 text-[9px] mt-0.5",children:pu(d.lastSpeciation.t)})]}),d.lastAchievement&&a.jsxs("div",{className:"p-2 bg-yellow-500/10 border border-yellow-500/20 rounded",children:[a.jsx("div",{className:"text-yellow-400 text-[9px] uppercase tracking-wider mb-0.5",children:"Last Achievement"}),a.jsx("div",{className:"text-white/80 text-[11px]",children:d.lastAchievement.title}),a.jsx("div",{className:"text-white/40 text-[9px] mt-0.5",children:pu(d.lastAchievement.t)})]}),d.lastCapture&&a.jsxs("div",{className:"p-2 bg-green-500/10 border border-green-500/20 rounded",children:[a.jsx("div",{className:"text-green-400 text-[9px] uppercase tracking-wider mb-0.5",children:"Last Capture"}),a.jsxs("div",{className:"text-white/80 text-[11px]",children:[d.lastCapture.sigil," ",d.lastCapture.title]}),a.jsx("div",{className:"text-white/40 text-[9px] mt-0.5",children:pu(d.lastCapture.t)})]}),d.lastInstitution&&a.jsxs("div",{className:"p-2 bg-purple-500/10 border border-purple-500/20 rounded",children:[a.jsx("div",{className:"text-purple-400 text-[9px] uppercase tracking-wider mb-0.5",children:"Last Institution"}),a.jsxs("div",{className:"text-white/80 text-[11px]",children:[d.lastInstitution.sigil," ",d.lastInstitution.title]}),a.jsx("div",{className:"text-white/40 text-[9px] mt-0.5",children:pu(d.lastInstitution.t)})]})]})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-1.5",children:[u.length===0&&a.jsx("div",{className:"text-white/40 text-xs text-center py-8",children:"No events yet. Keep simulating!"}),u.map(h=>{const f=l8[h.type],g=l===h.id;return a.jsxs("div",{className:"p-2 bg-white/5 hover:bg-white/10 border border-white/10 rounded transition-all cursor-pointer",onClick:()=>i(g?null:h.id),children:[a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-lg leading-none",children:h.sigil||""}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-baseline gap-2",children:[a.jsx("span",{className:"text-white/80 text-[11px] font-medium",children:h.title}),a.jsx("span",{className:"text-[9px] px-1.5 py-0.5 rounded uppercase tracking-wider",style:{backgroundColor:f.color+"15",color:f.color},children:f.label})]}),h.detail&&a.jsx("div",{className:"text-white/50 text-[10px] mt-0.5",children:h.detail}),a.jsx("div",{className:"text-white/30 text-[9px] mt-1",children:pu(h.t)})]})]}),g&&h.meta&&a.jsxs("div",{className:"mt-2 pt-2 border-t border-white/10",children:[a.jsx("div",{className:"text-white/40 text-[9px] uppercase tracking-wider mb-1",children:"Metadata"}),a.jsx("pre",{className:"text-white/60 text-[9px] font-mono overflow-x-auto",children:JSON.stringify(h.meta,null,2)})]})]},h.id)})]})]})},lP=({isOpen:e,onClose:t,paragraphs:r,currentArc:o,tone:s,setTone:l})=>{const[i,u]=w.useState("");if(!e)return null;const c=i?r.filter(h=>h.tags.includes(i)):r,d=Array.from(new Set(r.flatMap(h=>h.tags)));return a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:a.jsxs("div",{className:"bg-black/90 border border-white/10 rounded-lg shadow-2xl w-full max-w-3xl max-h-[80vh] flex flex-col",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(AC,{size:20,className:"text-cyan-400"}),a.jsx("h2",{className:"text-lg font-mono text-white",children:"CHRONICLE"}),a.jsxs("span",{className:"text-xs text-cyan-400/60 font-mono",children:["Arc: ",o]})]}),a.jsx("button",{onClick:t,className:"p-1 hover:bg-white/5 rounded transition-colors",children:a.jsx(ya,{size:18,className:"text-white/60"})})]}),a.jsxs("div",{className:"p-3 border-b border-white/5 flex items-center gap-2",children:[a.jsx("span",{className:"text-xs text-white/40 font-mono",children:"TONE:"}),["poetic","clinical","mythic","brutalist"].map(h=>a.jsx("button",{onClick:()=>l(h),className:`px-2 py-1 rounded text-xs font-mono transition-colors ${s===h?"bg-cyan-400/20 text-cyan-400":"text-white/40 hover:bg-white/5"}`,children:h},h))]}),a.jsxs("div",{className:"p-3 border-b border-white/5 flex items-center gap-2 flex-wrap",children:[a.jsx(NC,{size:12,className:"text-white/40"}),a.jsx("button",{onClick:()=>u(""),className:`px-2 py-0.5 rounded text-xs transition-colors ${i?"text-white/40 hover:bg-white/5":"bg-white/10 text-white"}`,children:"all"}),d.slice(0,8).map(h=>a.jsx("button",{onClick:()=>u(h===i?"":h),className:`px-2 py-0.5 rounded text-xs transition-colors ${i===h?"bg-cyan-400/20 text-cyan-400":"text-white/40 hover:bg-white/5"}`,children:h},h))]}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[c.length===0&&a.jsx("div",{className:"text-center text-white/30 text-sm py-8",children:"Nenhum pargrafo ainda. A histria est comeando..."}),c.map((h,f)=>a.jsxs("div",{className:"border-l-2 border-cyan-400/30 pl-3 py-2 hover:border-cyan-400/60 transition-colors",children:[a.jsxs("div",{className:"flex items-baseline justify-between mb-1",children:[a.jsx("h3",{className:"text-sm font-mono text-white/90",children:h.title}),a.jsxs("span",{className:"text-xs text-white/30 font-mono",children:[h.t.toFixed(1),"s"]})]}),a.jsx("p",{className:"text-sm text-white/70 leading-relaxed",children:h.text}),a.jsx("div",{className:"flex gap-1 mt-2",children:h.tags.map((g,m)=>a.jsx("span",{className:"text-[10px] text-cyan-400/50 font-mono px-1.5 py-0.5 bg-cyan-400/5 rounded",children:g},m))})]},f))]}),a.jsxs("div",{className:"p-3 border-t border-white/5 text-xs text-white/30 font-mono text-center",children:[r.length," paragraphs recorded"]})]})})};function cP(e="poetic"){return{tone:e,motifs:{nutrient:"seiva",tension:"presso",memory:"trilha",entropy:"nvoa"},currentArc:"Gnese",arcSince:0,lastParagraphAt:-999,paragraphCooldown:6}}function _m(e,t){const r=Math.floor(Math.abs(Math.sin(t)*9999)%e.length);return e[r]}function dP(e,t){const r=["seiva","po","ouro","nctar","caldo","luz"],o=["presso","ferrugem","raiva","atrito","carga","cisma"],s=["trilha","arquivo","cicatriz","rito","mapa","hbito"],l=["nvoa","rudo","fogo","sal","tempestade","fasca"];e.motifs={nutrient:_m(r,t*1.3),tension:_m(o,t*2.1),memory:_m(s,t*3.7),entropy:_m(l,t*4.9)}}function uP(e,t){const{t:r,loops:o,events:s}=e;if(r-t.lastParagraphAt<t.paragraphCooldown)return null;const l=s[0],i=l&&(l.type==="beat"||l.type==="mitosis"||l.type==="achievement"),u=o.volatility<.2,c=o.volatility>.6,d=o.scarcity>.65,h=o.cohesion>.6;if(!(i||c&&o.avgTension>.55||d&&o.avgNutrient<.35||h&&o.avgMemory>.55||u&&r-t.lastParagraphAt>t.paragraphCooldown*2))return null;t.lastParagraphAt=r;const g=t.motifs,m=i?l.sigil?`${l.sigil} ${l.title}`:l.title:c?"Tempestade de Interaes":d?"Era da Escassez":h?"Pacto de Coeso":"Respirao do Sistema",y=hP(t.tone,o,g,l),v=fP(t.tone,o,g);return{t:r,title:m,text:v?`${y} ${v}`:y,tags:[t.currentArc,c?"storm":u?"calm":"living",d?"scarcity":"",h?"cohesion":"",i?l.type:""].filter(Boolean)}}function hP(e,t,r,o){const s=t.scarcity,l=t.volatility,i=t.cohesion;if(e==="clinical")return`Regime: volatilidade ${l*100|0}%, escassez ${s*100|0}%, coeso ${i*100|0}%.`;if(e==="brutalist")return`A ${r.tension} sobe. A ${r.entropy} morde. O campo responde sem pedir licena.`;const u=[];return s>.65?u.push(`A ${r.nutrient} rareia, e o mundo aprende a economizar o gesto.`):u.push(`A ${r.nutrient} circula como promessa: atrai, separa, reagrupa.`),l>.6?u.push(`A ${r.entropy} cresce; formas quebram para nascer de novo.`):l<.2?u.push("Tudo parece calmo  mas calma  s outro tipo de fora."):u.push("H vida no meio: pequenas alianas, pequenas frices."),(o==null?void 0:o.type)==="beat"&&u.push(`Um sinal: ${o.title.toLowerCase()}.`),u.join(" ")}function fP(e,t,r){if(e==="clinical")return"";const o=t.cohesion,s=t.avgTension;return o>.6&&s<.4?`As ${r.memory}s se alinham  territrio vira linguagem.`:s>.6?`Onde a ${r.tension} encosta, surgem fronteiras: instituies improvisadas.`:`A ${r.memory} deixa marcas e a ${r.entropy} tenta apag-las.`}function pP(e,t,r){const{scarcity:o,cohesion:s,volatility:l}=t;return o>.7&&r.name!=="Era da Escassez"?{name:"Era da Escassez",since:e,reason:"Scarcity > 0.70"}:l>.65&&r.name!=="Guerra de Vrtices"?{name:"Guerra de Vrtices",since:e,reason:"Volatility > 0.65"}:s>.65&&l<.45&&r.name!=="Consolidao"?{name:"Consolidao",since:e,reason:"High cohesion + moderate volatility"}:l<.18&&r.name!=="Dormncia"?{name:"Dormncia",since:e,reason:"Volatility < 0.18"}:r.name!=="Vida Corrente"&&o<=.7&&l<=.65&&l>=.18?{name:"Vida Corrente",since:e,reason:"Back to baseline"}:null}const mP=[{id:"random",name:"Random Chaos",description:"Uniform random distribution, no structure",pattern:"random"},{id:"center_cluster",name:"Center Cluster",description:"Dense core formation, explosive potential",pattern:"center",params:{radius:.15,density:2}},{id:"ring",name:"Ring",description:"Circular boundary, inward pressure",pattern:"ring",params:{radius:.4,thickness:.1}},{id:"spiral",name:"Spiral",description:"Galaxy-like arms, rotational momentum",pattern:"spiral",params:{arms:3,twist:2.5}},{id:"grid",name:"Grid",description:"Orthogonal lattice, crystalline order",pattern:"grid",params:{spacing:.05}},{id:"two_clusters",name:"Two Clusters",description:"Binary collision, merger dynamics",pattern:"two_clusters",params:{separation:.5,radius:.15}},{id:"perimeter",name:"Perimeter",description:"Edge boundary, centripetal flow",pattern:"perimeter",params:{margin:.05}},{id:"vertical_bands",name:"Vertical Bands",description:"Striped layers, mixing zones",pattern:"vertical_bands",params:{bands:5,width:.15}},{id:"horizontal_bands",name:"Horizontal Bands",description:"Horizontal layers, stratification",pattern:"horizontal_bands",params:{bands:5,width:.15}},{id:"checkerboard",name:"Checkerboard",description:"Alternating cells, territorial conflict",pattern:"checkerboard",params:{cells:6}},{id:"triangle",name:"Triangle",description:"Triangular formation, apex dynamics",pattern:"triangle",params:{size:.6}},{id:"corners",name:"Four Corners",description:"Corner clusters, diagonal flows",pattern:"corners",params:{radius:.12}},{id:"cross",name:"Cross",description:"Plus sign, axial symmetry",pattern:"cross",params:{width:.15,length:.7}},{id:"double_helix",name:"Double Helix",description:"DNA-like twist, intertwined strands",pattern:"double_helix",params:{radius:.2,turns:3}},{id:"sunburst",name:"Sunburst",description:"Radial rays, explosive symmetry",pattern:"sunburst",params:{rays:8,length:.4}},{id:"concentric_rings",name:"Concentric Rings",description:"Nested circles, wave interference",pattern:"concentric_rings",params:{rings:4,spacing:.12}},{id:"wave",name:"Wave",description:"Sinusoidal distribution, periodic structure",pattern:"wave",params:{frequency:3,amplitude:.3}},{id:"vortex",name:"Vortex",description:"Logarithmic spiral, rotational seed",pattern:"vortex",params:{tightness:.15,rotation:1.5}},{id:"fractal_dust",name:"Fractal Dust",description:"Clustered random, self-similar distribution",pattern:"fractal_dust",params:{iterations:3,clusterSize:.08}},{id:"yin_yang",name:"Yin Yang",description:"Dual swirl, complementary balance",pattern:"yin_yang",params:{radius:.35}}],gP=(e,t,r,o,s)=>{var h,f,g,m,y,v,b,S,C,k,R,j,T,_,P,I,$,q,L,H,G,oe,le,pe,ce,te,F,Q,ae;const l=new Float32Array(t*2),i=new Uint8Array(t),u=o/2,c=s/2,d=Math.min(o,s);switch(e.pattern){case"random":for(let we=0;we<t;we++)l[we*2]=Math.random()*o,l[we*2+1]=Math.random()*s,i[we]=Math.floor(Math.random()*r);break;case"center":{const we=(((h=e.params)==null?void 0:h.radius)||.15)*d;for(let Re=0;Re<t;Re++){const ge=Math.random()*Math.PI*2,Ae=Math.sqrt(Math.random())*we;l[Re*2]=u+Math.cos(ge)*Ae,l[Re*2+1]=c+Math.sin(ge)*Ae,i[Re]=Math.floor(Math.random()*r)}}break;case"ring":{const we=(((f=e.params)==null?void 0:f.radius)||.4)*d,Re=(((g=e.params)==null?void 0:g.thickness)||.1)*d;for(let ge=0;ge<t;ge++){const Ae=Math.random()*Math.PI*2,tt=we+(Math.random()-.5)*Re;l[ge*2]=u+Math.cos(Ae)*tt,l[ge*2+1]=c+Math.sin(Ae)*tt,i[ge]=Math.floor(Math.random()*r)}}break;case"spiral":{const we=((m=e.params)==null?void 0:m.arms)||3,Re=((y=e.params)==null?void 0:y.twist)||2.5;for(let ge=0;ge<t;ge++){const Ae=ge/t,tt=Math.floor(Math.random()*we),J=tt/we*Math.PI*2+Ae*Math.PI*Re,ke=Ae*d*.4;l[ge*2]=u+Math.cos(J)*ke+(Math.random()-.5)*20,l[ge*2+1]=c+Math.sin(J)*ke+(Math.random()-.5)*20,i[ge]=tt%r}}break;case"grid":{const we=(((v=e.params)==null?void 0:v.spacing)||.05)*d,Re=Math.ceil(Math.sqrt(t)),ge=Re*we,Ae=u-ge/2,tt=c-ge/2;for(let We=0;We<t;We++){const J=We%Re,ke=Math.floor(We/Re);l[We*2]=Ae+J*we+(Math.random()-.5)*5,l[We*2+1]=tt+ke*we+(Math.random()-.5)*5,i[We]=(J+ke)%r}}break;case"two_clusters":{const we=(((b=e.params)==null?void 0:b.separation)||.5)*d,Re=(((S=e.params)==null?void 0:S.radius)||.15)*d,ge=Math.floor(t/2);for(let Ae=0;Ae<t;Ae++){const tt=Ae<ge,We=u+(tt?-we/2:we/2),J=Math.random()*Math.PI*2,ke=Math.sqrt(Math.random())*Re;l[Ae*2]=We+Math.cos(J)*ke,l[Ae*2+1]=c+Math.sin(J)*ke,i[Ae]=tt?0:r>1?1:0}}break;case"perimeter":{const we=(((C=e.params)==null?void 0:C.margin)||.05)*d;for(let Re=0;Re<t;Re++){const ge=Math.floor(Math.random()*4);ge===0?(l[Re*2]=Math.random()*o,l[Re*2+1]=we):ge===1?(l[Re*2]=o-we,l[Re*2+1]=Math.random()*s):ge===2?(l[Re*2]=Math.random()*o,l[Re*2+1]=s-we):(l[Re*2]=we,l[Re*2+1]=Math.random()*s),i[Re]=ge%r}}break;case"vertical_bands":{const we=((k=e.params)==null?void 0:k.bands)||5,Re=o/we;for(let ge=0;ge<t;ge++){const Ae=Math.floor(Math.random()*we);l[ge*2]=Ae*Re+Math.random()*Re,l[ge*2+1]=Math.random()*s,i[ge]=Ae%r}}break;case"horizontal_bands":{const we=((R=e.params)==null?void 0:R.bands)||5,Re=s/we;for(let ge=0;ge<t;ge++){const Ae=Math.floor(Math.random()*we);l[ge*2]=Math.random()*o,l[ge*2+1]=Ae*Re+Math.random()*Re,i[ge]=Ae%r}}break;case"checkerboard":{const we=((j=e.params)==null?void 0:j.cells)||6,Re=o/we,ge=s/we;for(let Ae=0;Ae<t;Ae++){const tt=Math.floor(Math.random()*we),We=Math.floor(Math.random()*we);l[Ae*2]=tt*Re+Math.random()*Re,l[Ae*2+1]=We*ge+Math.random()*ge,i[Ae]=(tt+We)%2%r}}break;case"triangle":{const we=(((T=e.params)==null?void 0:T.size)||.6)*d;for(let Re=0;Re<t;Re++){let ge=Math.random(),Ae=Math.random();ge+Ae>1&&(ge=1-ge,Ae=1-Ae);const tt=u-we/2+ge*we,We=c-we/2+Ae*we;l[Re*2]=tt,l[Re*2+1]=We,i[Re]=Math.floor((ge+Ae)/2*r)%r}}break;case"corners":{const we=(((_=e.params)==null?void 0:_.radius)||.12)*d,Re=we*2,ge=[{x:Re,y:Re},{x:o-Re,y:Re},{x:Re,y:s-Re},{x:o-Re,y:s-Re}];for(let Ae=0;Ae<t;Ae++){const tt=ge[Math.floor(Math.random()*4)],We=Math.random()*Math.PI*2,J=Math.sqrt(Math.random())*we;l[Ae*2]=tt.x+Math.cos(We)*J,l[Ae*2+1]=tt.y+Math.sin(We)*J,i[Ae]=Math.floor(Math.random()*r)}}break;case"cross":{const we=(((P=e.params)==null?void 0:P.width)||.15)*d,Re=(((I=e.params)==null?void 0:I.length)||.7)*d;for(let ge=0;ge<t;ge++){const Ae=Math.random()<.5;Ae?(l[ge*2]=u+(Math.random()-.5)*we,l[ge*2+1]=c+(Math.random()-.5)*Re):(l[ge*2]=u+(Math.random()-.5)*Re,l[ge*2+1]=c+(Math.random()-.5)*we),i[ge]=Ae?0:r>1?1:0}}break;case"double_helix":{const we=((($=e.params)==null?void 0:$.radius)||.2)*d,Re=((q=e.params)==null?void 0:q.turns)||3,ge=d*.6;for(let Ae=0;Ae<t;Ae++){const tt=Ae/t,We=tt*Math.PI*2*Re,J=Ae%2===0,ke=J?0:Math.PI;l[Ae*2]=u+Math.cos(We+ke)*we,l[Ae*2+1]=c-ge/2+tt*ge,i[Ae]=J?0:r>1?1:0}}break;case"sunburst":{const we=((L=e.params)==null?void 0:L.rays)||8,Re=(((H=e.params)==null?void 0:H.length)||.4)*d;for(let ge=0;ge<t;ge++){const Ae=Math.floor(Math.random()*we),tt=Ae/we*Math.PI*2,We=Math.random()*Re;l[ge*2]=u+Math.cos(tt)*We+(Math.random()-.5)*10,l[ge*2+1]=c+Math.sin(tt)*We+(Math.random()-.5)*10,i[ge]=Ae%r}}break;case"concentric_rings":{const we=((G=e.params)==null?void 0:G.rings)||4,Re=(((oe=e.params)==null?void 0:oe.spacing)||.12)*d;for(let ge=0;ge<t;ge++){const Ae=Math.floor(Math.random()*we),tt=(Ae+1)*Re,We=Math.random()*Math.PI*2;l[ge*2]=u+Math.cos(We)*tt,l[ge*2+1]=c+Math.sin(We)*tt,i[ge]=Ae%r}}break;case"wave":{const we=((le=e.params)==null?void 0:le.frequency)||3,Re=(((pe=e.params)==null?void 0:pe.amplitude)||.3)*d;for(let ge=0;ge<t;ge++){const Ae=Math.random()*o,tt=Ae/o*Math.PI*2*we,We=c+Math.sin(tt)*Re+(Math.random()-.5)*20;l[ge*2]=Ae,l[ge*2+1]=We,i[ge]=Math.floor(Ae/o*r)%r}}break;case"vortex":{const we=((ce=e.params)==null?void 0:ce.tightness)||.15,Re=((te=e.params)==null?void 0:te.rotation)||1.5;for(let ge=0;ge<t;ge++){const Ae=Math.sqrt(ge/t),tt=Ae*Math.PI*2*Re*5,We=Ae*d*.45;l[ge*2]=u+Math.cos(tt)*We*(1+Ae*we),l[ge*2+1]=c+Math.sin(tt)*We*(1+Ae*we),i[ge]=Math.floor(Ae*r)%r}}break;case"fractal_dust":{const we=((F=e.params)==null?void 0:F.iterations)||3,Re=(((Q=e.params)==null?void 0:Q.clusterSize)||.08)*d;for(let ge=0;ge<t;ge++){let Ae=Math.random()*o,tt=Math.random()*s;for(let We=0;We<we;We++)Ae+=(Math.random()-.5)*Re/(We+1),tt+=(Math.random()-.5)*Re/(We+1);l[ge*2]=Math.max(0,Math.min(o,Ae)),l[ge*2+1]=Math.max(0,Math.min(s,tt)),i[ge]=Math.floor(Math.random()*r)}}break;case"yin_yang":{const we=(((ae=e.params)==null?void 0:ae.radius)||.35)*d;for(let Re=0;Re<t;Re++){const ge=Math.random()<.5,Ae=Math.random()*Math.PI*2,tt=Math.sqrt(Math.random())*we;if(ge){const We=Math.PI/2+Ae/2;l[Re*2]=u-we/2+Math.cos(We)*tt,l[Re*2+1]=c+Math.sin(We)*tt,i[Re]=0}else{const We=-Math.PI/2+Ae/2;l[Re*2]=u+we/2+Math.cos(We)*tt,l[Re*2+1]=c+Math.sin(We)*tt,i[Re]=r>1?1:0}}}break;default:for(let we=0;we<t;we++)l[we*2]=Math.random()*o,l[we*2+1]=Math.random()*s,i[we]=Math.floor(Math.random()*r)}return{positions:l,types:i}},yP=(e,t,r,o,s)=>{const l={attract:Array(e).fill(0).map(()=>Array(e).fill(0)),radius:Array(e).fill(0).map(()=>Array(e).fill(0)),falloff:Array(e).fill(0).map(()=>Array(e).fill(1.2))},i=.22;switch(t){case"sparse":xP(l,e,r,o,i,s);break;case"block":bP(l,e,o,i,s);break;case"ring":vP(l,e,o,i,s);break;case"predator-prey":SP(l,e,o,i,s);break;case"symbiosis":wP(l,e,o,i,s);break;case"random":default:CP(l,e,o,i,s);break}return MP(l,e),kP(l,e,.65),l},xP=(e,t,r,o,s,l)=>{for(let i=0;i<t;i++)for(let u=0;u<t;u++)l.next()>r?(e.attract[i][u]=l.range(-1,1),e.radius[i][u]=s*l.range(1-o,1+o)):(e.attract[i][u]=l.range(-.15,.15),e.radius[i][u]=s*l.range(.8,1.2))},bP=(e,t,r,o,s)=>{const l=Math.max(2,Math.min(4,Math.floor(t/3))),i=Array(l).fill(0).map(()=>[]);for(let u=0;u<t;u++)i[u%l].push(u);for(let u=0;u<t;u++){const c=i.findIndex(d=>d.includes(u));for(let d=0;d<t;d++){const h=i.findIndex(f=>f.includes(d));c===h?(e.attract[u][d]=s.range(.4,.9),e.radius[u][d]=o*s.range(1,1+r*.5)):(e.attract[u][d]=s.range(-.8,-.3),e.radius[u][d]=o*s.range(.8,1))}}},vP=(e,t,r,o,s)=>{for(let l=0;l<t;l++)for(let i=0;i<t;i++){const u=(l+1)%t,c=(l-1+t)%t;i===u?(e.attract[l][i]=s.range(.5,1),e.radius[l][i]=o*s.range(1,1+r)):i===c?(e.attract[l][i]=s.range(-.9,-.4),e.radius[l][i]=o*s.range(.8,1)):(e.attract[l][i]=s.range(-.25,.25),e.radius[l][i]=o*s.range(.9,1.1))}},SP=(e,t,r,o,s)=>{for(let l=0;l<t;l++){const i=Math.floor(l/2),u=l%2===0;for(let c=0;c<t;c++){const d=Math.floor(c/2);i===d&&l!==c?u?(e.attract[l][c]=s.range(.5,.8),e.radius[l][c]=o*s.range(1,1+r)):(e.attract[l][c]=s.range(-.6,-.3),e.radius[l][c]=o*s.range(1+r*.5,1+r)):l===c?(e.attract[l][c]=s.range(-.3,.3),e.radius[l][c]=o):(e.attract[l][c]=s.range(-.2,.2),e.radius[l][c]=o*s.range(.9,1.1))}}},wP=(e,t,r,o,s)=>{const l=Math.max(2,Math.min(4,Math.floor(t/4))),i=Array(l).fill(0).map(()=>[]);for(let c=0;c<t;c++)i[c%l].push(c);const u=new Set;for(let c=0;c<l;c++){const d=s.int(1,Math.min(2,l-1));for(let h=0;h<d;h++){const f=(c+1+h)%l;u.add(`${c}-${f}`),u.add(`${f}-${c}`)}}for(let c=0;c<t;c++){const d=i.findIndex(h=>h.includes(c));for(let h=0;h<t;h++){const f=i.findIndex(g=>g.includes(h));d===f?(e.attract[c][h]=s.range(.4,.7),e.radius[c][h]=o*s.range(1,1+r*.4)):u.has(`${d}-${f}`)?(e.attract[c][h]=s.range(.2,.5),e.radius[c][h]=o*s.range(1,1+r*.6)):(e.attract[c][h]=s.range(-.3,.1),e.radius[c][h]=o*s.range(.9,1.1))}}},CP=(e,t,r,o,s)=>{for(let l=0;l<t;l++)for(let i=0;i<t;i++)e.attract[l][i]=s.range(-.9,.9),e.radius[l][i]=o*s.range(1-r,1+r)},MP=(e,t)=>{for(let r=0;r<t;r++)for(let o=0;o<t;o++)e.attract[r][o]=Math.max(-.9,Math.min(.9,e.attract[r][o])),e.radius[r][o]=Math.max(.08,Math.min(.42,e.radius[r][o]))},kP=(e,t,r)=>{let o=0,s=0;for(let i=0;i<t;i++)for(let u=0;u<t;u++)o+=Math.abs(e.attract[i][u]),s++;const l=o/s;if(l>.01){const i=r/l;for(let u=0;u<t;u++)for(let c=0;c<t;c++)e.attract[u][c]*=i,e.attract[u][c]=Math.max(-.9,Math.min(.9,e.attract[u][c]))}},Nx=e=>{const t=new cd(e),r=t.range(Math.log(60),Math.log(200)),o=Math.round(Math.exp(r)),s=t.next()<.7?t.int(3,6):t.int(2,8),l=s*o;let i=s,u=o;if(l>1200){const c=Math.sqrt(1200/l);i=Math.max(2,Math.round(s*c)),u=Math.floor(1200/i)}return{speciesCount:i,particlesPerSpecies:u,beta:t.range(.22,.4),coreRepel:t.range(.8,1.3),rmax:t.range(.16,.36),forceGain:t.range(1.2,2.8),drag:t.range(.9,1.7),speedClamp:t.range(.09,.16),matrixMode:["sparse","block","ring","predator-prey","symbiosis","random"][t.int(0,5)],matrixSparsity:t.range(.2,.8),radiusSpread:t.range(.05,.5),spawnPattern:["random","circle","rings","clusters","grid","center","islands","columns","web","spiral","double-ring"][t.int(0,10)],renderMode:t.next()<.3?"streaks":"dots",trailsFade:t.range(.9,.985),paletteId:t.int(0,5),energyEnabled:t.next()<.2,mitosisRate:t.range(0,.12)}},RP=(e,t)=>{const r=new cd(t);switch(e){case"pollock":return{speciesCount:r.int(4,6),particlesPerSpecies:r.int(100,160),beta:r.range(.24,.36),coreRepel:r.range(.9,1.2),rmax:r.range(.2,.32),forceGain:r.range(1.4,2.4),drag:r.range(.9,1.3),speedClamp:r.range(.09,.14),matrixMode:r.next()<.5?"sparse":"symbiosis",matrixSparsity:r.range(.4,.7),radiusSpread:r.range(.2,.45),spawnPattern:"spray",renderMode:"streaks",trailsFade:r.range(.975,.985),paletteId:r.int(0,5),energyEnabled:!1,mitosisRate:0};case"mitosis":return{speciesCount:r.int(3,5),particlesPerSpecies:r.int(120,200),beta:r.range(.26,.36),coreRepel:r.range(.95,1.25),rmax:r.range(.17,.28),forceGain:r.range(1,1.8),drag:r.range(1.1,1.7),speedClamp:r.range(.07,.12),matrixMode:"block",matrixSparsity:r.range(.3,.6),radiusSpread:r.range(.1,.3),spawnPattern:r.next()<.5?"rings":"islands",renderMode:"dots",trailsFade:r.range(.93,.97),paletteId:r.int(0,5),energyEnabled:!1,mitosisRate:r.range(.04,.12)};case"alliances":return{speciesCount:r.int(3,5),particlesPerSpecies:r.int(80,150),beta:r.range(.2,.35),coreRepel:r.range(.8,1.2),rmax:r.range(.16,.3),forceGain:r.range(1,2),drag:r.range(.8,1.5),speedClamp:r.range(.08,.14),matrixMode:"symbiosis",matrixSparsity:r.range(.3,.6),radiusSpread:r.range(.15,.4),spawnPattern:"islands",renderMode:"dots",trailsFade:r.range(.94,.98),paletteId:r.int(0,5),energyEnabled:!1,mitosisRate:0};case"planets":return{speciesCount:r.int(2,4),particlesPerSpecies:r.int(120,220),beta:r.range(.24,.38),coreRepel:r.range(1,1.4),rmax:r.range(.2,.35),forceGain:r.range(.8,1.4),drag:r.range(1.2,2),speedClamp:r.range(.06,.1),matrixMode:"ring",matrixSparsity:r.range(.2,.5),radiusSpread:r.range(.2,.45),spawnPattern:"rings",renderMode:"dots",trailsFade:r.range(.92,.96),paletteId:r.int(0,5),energyEnabled:!1,mitosisRate:0};case"field":return{speciesCount:r.int(5,8),particlesPerSpecies:r.int(60,120),beta:r.range(.18,.3),coreRepel:r.range(.7,1.1),rmax:r.range(.14,.26),forceGain:r.range(1.4,2.4),drag:r.range(.6,1),speedClamp:r.range(.1,.16),matrixMode:"sparse",matrixSparsity:r.range(.5,.8),radiusSpread:r.range(.3,.55),spawnPattern:"spray",renderMode:"dots",trailsFade:r.range(.96,.98),paletteId:r.int(0,5),energyEnabled:!1,mitosisRate:0};case"gems":return{speciesCount:r.int(3,5),particlesPerSpecies:r.int(80,150),beta:r.range(.28,.4),coreRepel:r.range(1.1,1.4),rmax:r.range(.12,.22),forceGain:r.range(.8,1.6),drag:r.range(1.4,2.2),speedClamp:r.range(.06,.1),matrixMode:"block",matrixSparsity:r.range(.2,.4),radiusSpread:r.range(.05,.2),spawnPattern:"center",renderMode:"dots",trailsFade:r.range(.9,.94),paletteId:r.int(0,5),energyEnabled:!1,mitosisRate:0};case"drift":return{speciesCount:r.int(4,6),particlesPerSpecies:r.int(60,140),beta:r.range(.2,.32),coreRepel:r.range(.7,1),rmax:r.range(.18,.3),forceGain:r.range(1.6,2.6),drag:r.range(.6,1.2),speedClamp:r.range(.12,.18),matrixMode:"sparse",matrixSparsity:r.range(.6,.85),radiusSpread:r.range(.35,.55),spawnPattern:"web",renderMode:r.next()<.4?"streaks":"dots",trailsFade:r.range(.97,.985),paletteId:r.int(0,5),energyEnabled:!1,mitosisRate:0};case"simplify":return{speciesCount:r.int(2,4),particlesPerSpecies:r.int(120,220),beta:r.range(.25,.35),coreRepel:r.range(.9,1.2),rmax:r.range(.18,.28),forceGain:r.range(1,1.8),drag:r.range(1,1.6),speedClamp:r.range(.08,.12),matrixMode:"block",matrixSparsity:r.range(.2,.4),radiusSpread:r.range(.1,.25),spawnPattern:"rings",renderMode:"dots",trailsFade:r.range(.92,.96),paletteId:r.int(0,5),energyEnabled:!1,mitosisRate:0};case"darwin":return{speciesCount:5,particlesPerSpecies:r.int(80,140),beta:r.range(.3,.4),coreRepel:r.range(1,1.3),rmax:r.range(.2,.28),forceGain:r.range(1.4,2),drag:r.range(1,1.4),speedClamp:r.range(.1,.14),matrixMode:"predator-prey",matrixSparsity:r.range(.3,.5),radiusSpread:r.range(.15,.3),spawnPattern:r.next()<.5?"clusters":"islands",renderMode:"dots",trailsFade:r.range(.94,.97),paletteId:r.int(0,5),energyEnabled:!0,mitosisRate:0,metamorphosisEnabled:!0,mutationRate:r.range(.0015,.0025),typeStability:r.range(.975,.985)};default:return Nx(t)}},AP=(e,t)=>{const r={...e};if(t.next()<.7&&(r.speciesCount=t.int(4,24)),t.next()<.6){const o=["sparse","block","ring","predator-prey","symbiosis","random"];r.matrixMode=o[t.int(0,o.length-1)]}if(t.next()<.5&&(r.radiusSpread=t.range(.2,.55)),t.next()<.5){const o=["spray","rings","islands","columns","center","web"];r.spawnPattern=o[t.int(0,o.length-1)]}return t.next()<.4&&(r.renderMode=t.next()<.5?"streaks":"dots"),t.next()<.4&&(r.paletteId=t.int(0,5)),r.forceGain*=t.range(.7,1.4),r.drag*=t.range(.8,1.3),r},Dm=e=>{const t=[];return t.push(`species=${e.speciesCount}`),t.push(`p/s=${e.particlesPerSpecies}`),t.push(`mode=${e.matrixMode}`),e.renderMode==="streaks"&&t.push("streaks=on"),e.mitosisRate>.01&&t.push(`mitosis=${e.mitosisRate.toFixed(2)}`),t.push(`palette=${e.paletteId}`),t.join(", ")},jP=(e=.06)=>({enabled:e>.01,rate:e,impulse:1.2,splitFraction:.2,mutationSize:.08}),EP=(e,t,r=50)=>{const o=[];for(let s=0;s<t;s++){const l=[];for(let g=0;g<e.count;g++)e.type[g]===s&&l.push(g);if(l.length<r)continue;let i=0,u=0;for(const g of l)i+=e.x[g],u+=e.y[g];const c=i/l.length,d=u/l.length;let h=0;for(const g of l){let m=e.x[g]-c,y=e.y[g]-d;m>1&&(m-=2),m<-1&&(m+=2),y>1&&(y-=2),y<-1&&(y+=2),h+=Math.sqrt(m*m+y*y)}const f=h/l.length;f<.15&&o.push({typeId:s,indices:l,centerX:c,centerY:d,radius:f})}return o.sort((s,l)=>l.indices.length-s.indices.length),o},TP=(e,t,r,o)=>{if(!r.enabled)return{success:!1};if(o.next()>r.rate)return{success:!1};const s=EP(e,t.attract.length,50);if(s.length===0)return{success:!1};const l=s[0],i=Math.floor(l.indices.length*r.splitFraction);if(i<10)return{success:!1};if(e.count+i>e.maxCount)return{success:!1};const u=[],c=[...l.indices].sort(()=>o.next()-.5);for(let g=0;g<i&&g<c.length;g++)u.push(c[g]);const d=o.next()*Math.PI*2,h=Math.cos(d)*r.impulse*.01,f=Math.sin(d)*r.impulse*.01;for(const g of u){const m=e.count;e.x[m]=e.x[g]+h*.5,e.y[m]=e.y[g]+f*.5,e.type[m]=e.type[g],e.vx[m]=h,e.vy[m]=f,e.vx[g]-=h*.3,e.vy[g]-=f*.3,e.energy&&(e.energy[m]=e.energy[g]*.5,e.energy[g]*=.5),e.count++}return IP(t,l.typeId,r.mutationSize,o),{success:!0,message:`Cluster #${l.typeId} divided (${i} new particles)`}},IP=(e,t,r,o)=>{const s=e.attract.length;if(!(t<0||t>=s)){for(let l=0;l<s;l++){const i=o.range(-r,r);e.attract[t][l]+=i,e.attract[t][l]=Math.max(-.9,Math.min(.9,e.attract[t][l]))}for(let l=0;l<s;l++){const i=o.range(-r*.5,r*.5);e.radius[t][l]*=1+i,e.radius[t][l]=Math.max(.08,Math.min(.42,e.radius[t][l]))}}},PP=()=>({organisms:[],nextId:1}),FP=(e,t,r,o,s,l,i,u,c)=>{const d=[];for(let k=0;k<t.count;k++){const R=t.x[k]-r,j=t.y[k]-o;R*R+j*j<=s*s&&d.push({type:t.type[k],x:R,y:j,vx:t.vx[k],vy:t.vy[k],energy:t.energy[k]})}if(d.length===0)return null;let h=1/0,f=-1/0,g=1/0,m=-1/0;for(const k of d)h=Math.min(h,k.x),f=Math.max(f,k.x),g=Math.min(g,k.y),m=Math.max(m,k.y);const y=f-h,v=m-g,b=(h+f)/2,S=(g+m)/2;for(const k of d)k.x-=b,k.y-=S;const C={id:`org_${e.nextId}`,name:`Organism ${e.nextId}`,timestamp:Date.now(),particles:d,width:y,height:v,captureContext:{typesCount:l,paletteIndex:i,seed:u},thumbnail:c};return e.organisms.push(C),e.nextId++,C},NP=(e,t,r,o,s=1)=>{let l=0;for(const i of e.particles){if(t.count>=t.maxCount)break;const u=t.count;t.x[u]=r+i.x*s,t.y[u]=o+i.y*s,t.vx[u]=i.vx,t.vy[u]=i.vy,t.type[u]=i.type,t.energy[u]=i.energy,t.count++,l++}return l},OP=(e,t)=>{const r=e.organisms.findIndex(o=>o.id===t);return r===-1?!1:(e.organisms.splice(r,1),!0)},_P=(e,t,r)=>{const o=e.organisms.find(s=>s.id===t);return o?(o.name=r,!0):!1},m2={observer:{id:"observer",name:"Observador",icon:"",description:"Voc v os agentes"},field_whisperer:{id:"field_whisperer",name:"Sussurrador de Campos",icon:"",description:"Voc revelou o invisvel"},pattern_hunter:{id:"pattern_hunter",name:"Caador de Padres",icon:"",description:"Voc entende a emergncia"},butterfly_hand:{id:"butterfly_hand",name:"Mo Borboleta",icon:"",description:"Seu gesto mudou o destino"},worldsmith:{id:"worldsmith",name:"Forjador de Mundos",icon:"",description:"Voc comanda universos"}};class DP{constructor(t){this.listeners=new Set,this.steps=t,this.progress={currentStep:0,completedSteps:new Set,xp:0,badges:[],startTime:Date.now()}}getSteps(){return this.steps}getCurrentStep(){return this.steps[this.progress.currentStep]||null}getProgress(){return{...this.progress,completedSteps:new Set(this.progress.completedSteps)}}nextStep(){const t=this.getCurrentStep();if(t&&(this.progress.completedSteps.add(t.id),this.progress.xp+=10,t.rewardBadge&&!this.progress.badges.includes(t.rewardBadge)&&this.progress.badges.push(t.rewardBadge),t.onExit&&t.onExit()),this.progress.currentStep<this.steps.length-1){this.progress.currentStep++;const r=this.getCurrentStep();return r!=null&&r.onEnter&&r.onEnter(),this.notifyListeners(),!0}return this.notifyListeners(),!1}previousStep(){if(this.progress.currentStep>0){const t=this.getCurrentStep();t!=null&&t.onExit&&t.onExit(),this.progress.currentStep--;const r=this.getCurrentStep();return r!=null&&r.onEnter&&r.onEnter(),this.notifyListeners(),!0}return!1}skipToEnd(){this.progress.currentStep=this.steps.length,this.notifyListeners()}reset(){this.progress={currentStep:0,completedSteps:new Set,xp:0,badges:[],startTime:Date.now()},this.notifyListeners()}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}notifyListeners(){const t=this.getProgress();this.listeners.forEach(r=>r(t))}}const XC="metalife_guide_completed_v1",I5=()=>{localStorage.setItem(XC,"true")},LP=()=>{localStorage.removeItem(XC)},zP=e=>{const t=[];return t.push({id:"welcome",title:"O Campo",copy:"Voc est olhando para um campo. Agentes se movem por regras de atrao e repulso  observe antes de agir.",targetSelector:null,actionType:"observe",rewardBadge:"observer"}),t.push({id:"agents",title:"Espcies",copy:"Cada cor  uma espcie. Cada espcie reage de forma diferente s outras  simbiose, predao, indiferena.",targetSelector:e.selectors.canvas,actionType:"observe"}),t.push({id:"patterns",title:"Emergncia",copy:"Quando as foras se equilibram, formas surgem: anis, membranas, organismos. Quando conflitam, caos. Nada foi programado para acontecer.",targetSelector:e.selectors.canvas,actionType:"observe",rewardBadge:"pattern_hunter"}),e.selectors.speedControl&&t.push({id:"speed",title:"Tempo",copy:"Velocidade muda percepo. Lento revela negociaes locais. Rpido revela estrutura macro.",targetSelector:e.selectors.speedControl,actionType:"observe"}),e.selectors.overlayField&&t.push({id:"field",title:"O Invisvel",copy:"O campo  o ambiente por trs dos agentes  tenso, nutrio, memria. Ative overlays para ver por que os padres se formam onde se formam.",targetSelector:e.selectors.overlayField,actionType:"observe",rewardBadge:"field_whisperer"}),t.push({id:"gesture",title:"Interferncia",copy:"Clique e arraste no canvas para aplicar uma fora. Observe como o sistema responde e se reorganiza.",targetSelector:e.selectors.canvas,actionType:"drag",rewardBadge:"butterfly_hand"}),e.selectors.presetsPanel&&t.push({id:"presets",title:"Presets",copy:"Cada preset reconfigura a matriz de foras e gera um mundo com personalidade prpria.",targetSelector:e.selectors.presetsPanel,actionType:"observe"}),(e.selectors.newUniverseButton||e.selectors.seedButton)&&t.push({id:"seed",title:"DNA",copy:"Seed  o cdigo gentico do universo. Novo universo = novas relaes, novas possibilidades.",targetSelector:e.selectors.newUniverseButton||e.selectors.seedButton,actionType:"observe"}),t.push({id:"complete",title:"Explore",copy:"Agora observe, intervenha pouco, deixe o sistema encontrar suas prprias instituies. Tudo que surge, surge de baixo.",targetSelector:null,actionType:"finish",rewardBadge:"worldsmith"}),t},BP=e=>{const[t,r]=w.useState("hidden"),o=w.useRef(null);w.useEffect(()=>{},[]);const s=()=>{if(o.current)o.current.reset();else{const c=zP(e);o.current=new DP(c)}r("active")},l=()=>{I5(),r("hidden")},i=()=>{LP(),o.current&&o.current.reset(),s()},u=()=>{r("hidden")};return{mode:t,guideState:o.current,startGuide:s,skipGuide:l,restartGuide:i,hideGuide:u}};function g2(e){const t=()=>new Float32Array(e*e);return{size:e,layers:{nutrient:t(),tension:t(),memory:t(),entropy:t(),sigilBond:t(),sigilRift:t(),sigilBloom:t(),sigilOath:t()},next:{nutrient:t(),tension:t(),memory:t(),entropy:t(),sigilBond:t(),sigilRift:t(),sigilBloom:t(),sigilOath:t()},scratch:t()}}function $P(e,t,r){return t*r+e}function ZC(e,t,r){const o=Math.max(0,Math.min(.9999,(e+1)*.5)),s=Math.max(0,Math.min(.9999,(t+1)*.5)),l=Math.min(r-1,o*r|0),i=Math.min(r-1,s*r|0);return{gx:l,gy:i,gi:$P(l,i,r)}}function ms(e,t,r,o){const{gi:s}=ZC(r,o,e.size);return e.layers[t][s]}function Lm(e,t,r,o,s){const{gi:l}=ZC(r,o,e.size);e.layers[t][l]+=s}function qP(e,t,r){const o=e.size,s=o*o,l=["nutrient","tension","memory","entropy","sigilBond","sigilRift","sigilBloom","sigilOath"];for(const i of l){const u=e.layers[i],c=e.next[i],d=t.diffusion[i],h=t.decay[i];for(let y=0;y<o;y++){const v=y===0?0:y-1,b=y===o-1?o-1:y+1;for(let S=0;S<o;S++){const C=S===0?0:S-1,k=S===o-1?o-1:S+1,R=y*o+S,j=u[R],T=u[v*o+S],_=u[b*o+S],P=u[y*o+C],I=u[y*o+k],$=T+_+P+I-4*j,L=(j+d*$)*Math.exp(-h*r);c[R]=L}}const f=t.delays[i];if(f>1e-4){const y=1-Math.exp(-r/f);for(let v=0;v<s;v++)u[v]=u[v]+(c[v]-u[v])*y}else u.set(c);const{min:g,max:m}=t.clamps[i];for(let y=0;y<s;y++){const v=u[y];u[y]=v<g?g:v>m?m:v}}}function c8(e){const t=e.size*e.size;let r=0,o=0,s=0,l=0;const i=e.layers.nutrient,u=e.layers.tension,c=e.layers.memory,d=e.layers.entropy;for(let m=0;m<t;m++)r+=i[m],o+=u[m],s+=c[m],l+=d[m];r/=t,o/=t,s/=t,l/=t;const h=y2(1-r),f=y2(s*.9-l*.7),g=y2(o*.8+l*.8);return{avgNutrient:r,avgTension:o,avgMemory:s,avgEntropy:l,scarcity:h,cohesion:f,volatility:g}}function y2(e){return e<0?0:e>1?1:e}const WP=e=>({selectors:{playButton:'[data-guide="play-button"]',speedControl:'[data-guide="speed-control"]',seedButton:'[data-guide="seed-button"]',presetsPanel:'[data-guide="presets-panel"]',overlayField:'[data-guide="overlay-field"]',overlayTrails:'[data-guide="overlay-trails"]',overlayInstitutions:null,canvas:"canvas",newUniverseButton:'[data-guide="new-universe"]'},actions:{setSpeed:t=>e.onSpeedChange?(e.onSpeedChange(t),!0):!1,pause:()=>{var t;return e.onPauseToggle&&!((t=e.isPaused)!=null&&t.call(e))?(e.onPauseToggle(),!0):!1},resume:()=>{var t;return e.onPauseToggle&&((t=e.isPaused)!=null&&t.call(e))?(e.onPauseToggle(),!0):!1},toggleOverlay:(t,r)=>t==="field"&&e.setFieldHeatmap?(e.setFieldHeatmap(r),!0):t==="trails"&&e.setTrails?(e.setTrails(r),!0):!1,applyPreset:t=>e.onApplyRecipe?(e.onApplyRecipe(t),!0):!1,newUniverse:()=>e.onNewUniverse?(e.onNewUniverse(),!0):!1,isOverlayEnabled:t=>t==="field"?e.fieldHeatmap??!1:t==="trails"?e.trails??!1:!1,getSpeed:()=>e.timeSpeed??1,isPaused:()=>{var t;return((t=e.isPaused)==null?void 0:t.call(e))??!1}},canvasInteractionDetector:{startListening:t=>{var d;const r=(d=e.canvasRef)==null?void 0:d.current;if(!r)return()=>{};let o=0,s=0,l=!1;const i=h=>{o=h.clientX,s=h.clientY,l=!0},u=h=>{if(!l)return;const f=h.clientX-o,g=h.clientY-s,m=Math.sqrt(f*f+g*g);t(m)},c=()=>{l=!1};return r.addEventListener("pointerdown",i),r.addEventListener("pointermove",u),r.addEventListener("pointerup",c),()=>{r.removeEventListener("pointerdown",i),r.removeEventListener("pointermove",u),r.removeEventListener("pointerup",c)}}}}),qb=w.createContext({});function Wb(e){const t=w.useRef(null);return t.current===null&&(t.current=e()),t.current}const JC=typeof window<"u",QC=JC?w.useLayoutEffect:w.useEffect,Ig=w.createContext(null);function Hb(e,t){e.indexOf(t)===-1&&e.push(t)}function Z5(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}const Cl=(e,t,r)=>r>t?t:r<e?e:r;let Gb=()=>{};const ec={},eM=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e);function tM(e){return typeof e=="object"&&e!==null}const nM=e=>/^0[^.\s]+$/u.test(e);function rM(e){let t;return()=>(t===void 0&&(t=e()),t)}const hi=e=>e,HP=(e,t)=>r=>t(e(r)),jp=(...e)=>e.reduce(HP),cp=(e,t,r)=>{const o=t-e;return o===0?1:(r-e)/o};class Vb{constructor(){this.subscriptions=[]}add(t){return Hb(this.subscriptions,t),()=>Z5(this.subscriptions,t)}notify(t,r,o){const s=this.subscriptions.length;if(s)if(s===1)this.subscriptions[0](t,r,o);else for(let l=0;l<s;l++){const i=this.subscriptions[l];i&&i(t,r,o)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Hi=e=>e*1e3,di=e=>e/1e3;function oM(e,t){return t?e*(1e3/t):0}const aM=(e,t,r)=>(((1-3*r+3*t)*e+(3*r-6*t))*e+3*t)*e,GP=1e-7,VP=12;function UP(e,t,r,o,s){let l,i,u=0;do i=t+(r-t)/2,l=aM(i,o,s)-e,l>0?r=i:t=i;while(Math.abs(l)>GP&&++u<VP);return i}function Ep(e,t,r,o){if(e===t&&r===o)return hi;const s=l=>UP(l,0,1,e,r);return l=>l===0||l===1?l:aM(s(l),t,o)}const sM=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,iM=e=>t=>1-e(1-t),lM=Ep(.33,1.53,.69,.99),Ub=iM(lM),cM=sM(Ub),dM=e=>(e*=2)<1?.5*Ub(e):.5*(2-Math.pow(2,-10*(e-1))),Yb=e=>1-Math.sin(Math.acos(e)),uM=iM(Yb),hM=sM(Yb),YP=Ep(.42,0,1,1),KP=Ep(0,0,.58,1),fM=Ep(.42,0,.58,1),XP=e=>Array.isArray(e)&&typeof e[0]!="number",pM=e=>Array.isArray(e)&&typeof e[0]=="number",ZP={linear:hi,easeIn:YP,easeInOut:fM,easeOut:KP,circIn:Yb,circInOut:hM,circOut:uM,backIn:Ub,backInOut:cM,backOut:lM,anticipate:dM},JP=e=>typeof e=="string",d8=e=>{if(pM(e)){Gb(e.length===4);const[t,r,o,s]=e;return Ep(t,r,o,s)}else if(JP(e))return ZP[e];return e},zm=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function QP(e,t){let r=new Set,o=new Set,s=!1,l=!1;const i=new WeakSet;let u={delta:0,timestamp:0,isProcessing:!1};function c(h){i.has(h)&&(d.schedule(h),e()),h(u)}const d={schedule:(h,f=!1,g=!1)=>{const y=g&&s?r:o;return f&&i.add(h),y.has(h)||y.add(h),h},cancel:h=>{o.delete(h),i.delete(h)},process:h=>{if(u=h,s){l=!0;return}s=!0,[r,o]=[o,r],r.forEach(c),r.clear(),s=!1,l&&(l=!1,d.process(h))}};return d}const eF=40;function mM(e,t){let r=!1,o=!0;const s={delta:0,timestamp:0,isProcessing:!1},l=()=>r=!0,i=zm.reduce((k,R)=>(k[R]=QP(l),k),{}),{setup:u,read:c,resolveKeyframes:d,preUpdate:h,update:f,preRender:g,render:m,postRender:y}=i,v=()=>{const k=ec.useManualTiming?s.timestamp:performance.now();r=!1,ec.useManualTiming||(s.delta=o?1e3/60:Math.max(Math.min(k-s.timestamp,eF),1)),s.timestamp=k,s.isProcessing=!0,u.process(s),c.process(s),d.process(s),h.process(s),f.process(s),g.process(s),m.process(s),y.process(s),s.isProcessing=!1,r&&t&&(o=!1,e(v))},b=()=>{r=!0,o=!0,s.isProcessing||e(v)};return{schedule:zm.reduce((k,R)=>{const j=i[R];return k[R]=(T,_=!1,P=!1)=>(r||b(),j.schedule(T,_,P)),k},{}),cancel:k=>{for(let R=0;R<zm.length;R++)i[zm[R]].cancel(k)},state:s,steps:i}}const{schedule:no,cancel:a0,state:Ta,steps:x2}=mM(typeof requestAnimationFrame<"u"?requestAnimationFrame:hi,!0);let P5;function tF(){P5=void 0}const as={now:()=>(P5===void 0&&as.set(Ta.isProcessing||ec.useManualTiming?Ta.timestamp:performance.now()),P5),set:e=>{P5=e,queueMicrotask(tF)}},gM=e=>t=>typeof t=="string"&&t.startsWith(e),yM=gM("--"),nF=gM("var(--"),Kb=e=>nF(e)?rF.test(e.split("/*")[0].trim()):!1,rF=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu;function u8(e){return typeof e!="string"?!1:e.split("/*")[0].includes("var(--")}const Ih={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},dp={...Ih,transform:e=>Cl(0,1,e)},Bm={...Ih,default:1},Kf=e=>Math.round(e*1e5)/1e5,Xb=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function oF(e){return e==null}const aF=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Zb=(e,t)=>r=>!!(typeof r=="string"&&aF.test(r)&&r.startsWith(e)||t&&!oF(r)&&Object.prototype.hasOwnProperty.call(r,t)),xM=(e,t,r)=>o=>{if(typeof o!="string")return o;const[s,l,i,u]=o.match(Xb);return{[e]:parseFloat(s),[t]:parseFloat(l),[r]:parseFloat(i),alpha:u!==void 0?parseFloat(u):1}},sF=e=>Cl(0,255,e),b2={...Ih,transform:e=>Math.round(sF(e))},bd={test:Zb("rgb","red"),parse:xM("red","green","blue"),transform:({red:e,green:t,blue:r,alpha:o=1})=>"rgba("+b2.transform(e)+", "+b2.transform(t)+", "+b2.transform(r)+", "+Kf(dp.transform(o))+")"};function iF(e){let t="",r="",o="",s="";return e.length>5?(t=e.substring(1,3),r=e.substring(3,5),o=e.substring(5,7),s=e.substring(7,9)):(t=e.substring(1,2),r=e.substring(2,3),o=e.substring(3,4),s=e.substring(4,5),t+=t,r+=r,o+=o,s+=s),{red:parseInt(t,16),green:parseInt(r,16),blue:parseInt(o,16),alpha:s?parseInt(s,16)/255:1}}const Ox={test:Zb("#"),parse:iF,transform:bd.transform},Tp=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),Lc=Tp("deg"),Sl=Tp("%"),Fn=Tp("px"),lF=Tp("vh"),cF=Tp("vw"),h8={...Sl,parse:e=>Sl.parse(e)/100,transform:e=>Sl.transform(e*100)},rh={test:Zb("hsl","hue"),parse:xM("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:r,alpha:o=1})=>"hsla("+Math.round(e)+", "+Sl.transform(Kf(t))+", "+Sl.transform(Kf(r))+", "+Kf(dp.transform(o))+")"},Xo={test:e=>bd.test(e)||Ox.test(e)||rh.test(e),parse:e=>bd.test(e)?bd.parse(e):rh.test(e)?rh.parse(e):Ox.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?bd.transform(e):rh.transform(e),getAnimatableNone:e=>{const t=Xo.parse(e);return t.alpha=0,Xo.transform(t)}},dF=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function uF(e){var t,r;return isNaN(e)&&typeof e=="string"&&(((t=e.match(Xb))==null?void 0:t.length)||0)+(((r=e.match(dF))==null?void 0:r.length)||0)>0}const bM="number",vM="color",hF="var",fF="var(",f8="${}",pF=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function up(e){const t=e.toString(),r=[],o={color:[],number:[],var:[]},s=[];let l=0;const u=t.replace(pF,c=>(Xo.test(c)?(o.color.push(l),s.push(vM),r.push(Xo.parse(c))):c.startsWith(fF)?(o.var.push(l),s.push(hF),r.push(c)):(o.number.push(l),s.push(bM),r.push(parseFloat(c))),++l,f8)).split(f8);return{values:r,split:u,indexes:o,types:s}}function SM(e){return up(e).values}function wM(e){const{split:t,types:r}=up(e),o=t.length;return s=>{let l="";for(let i=0;i<o;i++)if(l+=t[i],s[i]!==void 0){const u=r[i];u===bM?l+=Kf(s[i]):u===vM?l+=Xo.transform(s[i]):l+=s[i]}return l}}const mF=e=>typeof e=="number"?0:Xo.test(e)?Xo.getAnimatableNone(e):e;function gF(e){const t=SM(e);return wM(e)(t.map(mF))}const Gi={test:uF,parse:SM,createTransformer:wM,getAnimatableNone:gF};function v2(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<1/2?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function yF({hue:e,saturation:t,lightness:r,alpha:o}){e/=360,t/=100,r/=100;let s=0,l=0,i=0;if(!t)s=l=i=r;else{const u=r<.5?r*(1+t):r+t-r*t,c=2*r-u;s=v2(c,u,e+1/3),l=v2(c,u,e),i=v2(c,u,e-1/3)}return{red:Math.round(s*255),green:Math.round(l*255),blue:Math.round(i*255),alpha:o}}function J5(e,t){return r=>r>0?t:e}const Ao=(e,t,r)=>e+(t-e)*r,S2=(e,t,r)=>{const o=e*e,s=r*(t*t-o)+o;return s<0?0:Math.sqrt(s)},xF=[Ox,bd,rh],bF=e=>xF.find(t=>t.test(e));function p8(e){const t=bF(e);if(!t)return!1;let r=t.parse(e);return t===rh&&(r=yF(r)),r}const m8=(e,t)=>{const r=p8(e),o=p8(t);if(!r||!o)return J5(e,t);const s={...r};return l=>(s.red=S2(r.red,o.red,l),s.green=S2(r.green,o.green,l),s.blue=S2(r.blue,o.blue,l),s.alpha=Ao(r.alpha,o.alpha,l),bd.transform(s))},_x=new Set(["none","hidden"]);function vF(e,t){return _x.has(e)?r=>r<=0?e:t:r=>r>=1?t:e}function SF(e,t){return r=>Ao(e,t,r)}function Jb(e){return typeof e=="number"?SF:typeof e=="string"?Kb(e)?J5:Xo.test(e)?m8:MF:Array.isArray(e)?CM:typeof e=="object"?Xo.test(e)?m8:wF:J5}function CM(e,t){const r=[...e],o=r.length,s=e.map((l,i)=>Jb(l)(l,t[i]));return l=>{for(let i=0;i<o;i++)r[i]=s[i](l);return r}}function wF(e,t){const r={...e,...t},o={};for(const s in r)e[s]!==void 0&&t[s]!==void 0&&(o[s]=Jb(e[s])(e[s],t[s]));return s=>{for(const l in o)r[l]=o[l](s);return r}}function CF(e,t){const r=[],o={color:0,var:0,number:0};for(let s=0;s<t.values.length;s++){const l=t.types[s],i=e.indexes[l][o[l]],u=e.values[i]??0;r[s]=u,o[l]++}return r}const MF=(e,t)=>{const r=Gi.createTransformer(t),o=up(e),s=up(t);return o.indexes.var.length===s.indexes.var.length&&o.indexes.color.length===s.indexes.color.length&&o.indexes.number.length>=s.indexes.number.length?_x.has(e)&&!s.values.length||_x.has(t)&&!o.values.length?vF(e,t):jp(CM(CF(o,s),s.values),r):J5(e,t)};function MM(e,t,r){return typeof e=="number"&&typeof t=="number"&&typeof r=="number"?Ao(e,t,r):Jb(e)(e,t)}const kF=e=>{const t=({timestamp:r})=>e(r);return{start:(r=!0)=>no.update(t,r),stop:()=>a0(t),now:()=>Ta.isProcessing?Ta.timestamp:as.now()}},kM=(e,t,r=10)=>{let o="";const s=Math.max(Math.round(t/r),2);for(let l=0;l<s;l++)o+=Math.round(e(l/(s-1))*1e4)/1e4+", ";return`linear(${o.substring(0,o.length-2)})`},Q5=2e4;function Qb(e){let t=0;const r=50;let o=e.next(t);for(;!o.done&&t<Q5;)t+=r,o=e.next(t);return t>=Q5?1/0:t}function RF(e,t=100,r){const o=r({...e,keyframes:[0,t]}),s=Math.min(Qb(o),Q5);return{type:"keyframes",ease:l=>o.next(s*l).value/t,duration:di(s)}}const AF=5;function RM(e,t,r){const o=Math.max(t-AF,0);return oM(r-e(o),t-o)}const No={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},w2=.001;function jF({duration:e=No.duration,bounce:t=No.bounce,velocity:r=No.velocity,mass:o=No.mass}){let s,l,i=1-t;i=Cl(No.minDamping,No.maxDamping,i),e=Cl(No.minDuration,No.maxDuration,di(e)),i<1?(s=d=>{const h=d*i,f=h*e,g=h-r,m=Dx(d,i),y=Math.exp(-f);return w2-g/m*y},l=d=>{const f=d*i*e,g=f*r+r,m=Math.pow(i,2)*Math.pow(d,2)*e,y=Math.exp(-f),v=Dx(Math.pow(d,2),i);return(-s(d)+w2>0?-1:1)*((g-m)*y)/v}):(s=d=>{const h=Math.exp(-d*e),f=(d-r)*e+1;return-w2+h*f},l=d=>{const h=Math.exp(-d*e),f=(r-d)*(e*e);return h*f});const u=5/e,c=TF(s,l,u);if(e=Hi(e),isNaN(c))return{stiffness:No.stiffness,damping:No.damping,duration:e};{const d=Math.pow(c,2)*o;return{stiffness:d,damping:i*2*Math.sqrt(o*d),duration:e}}}const EF=12;function TF(e,t,r){let o=r;for(let s=1;s<EF;s++)o=o-e(o)/t(o);return o}function Dx(e,t){return e*Math.sqrt(1-t*t)}const IF=["duration","bounce"],PF=["stiffness","damping","mass"];function g8(e,t){return t.some(r=>e[r]!==void 0)}function FF(e){let t={velocity:No.velocity,stiffness:No.stiffness,damping:No.damping,mass:No.mass,isResolvedFromDuration:!1,...e};if(!g8(e,PF)&&g8(e,IF))if(t.velocity=0,e.visualDuration){const r=e.visualDuration,o=2*Math.PI/(r*1.2),s=o*o,l=2*Cl(.05,1,1-(e.bounce||0))*Math.sqrt(s);t={...t,mass:No.mass,stiffness:s,damping:l}}else{const r=jF({...e,velocity:0});t={...t,...r,mass:No.mass},t.isResolvedFromDuration=!0}return t}function eg(e=No.visualDuration,t=No.bounce){const r=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:o,restDelta:s}=r;const l=r.keyframes[0],i=r.keyframes[r.keyframes.length-1],u={done:!1,value:l},{stiffness:c,damping:d,mass:h,duration:f,velocity:g,isResolvedFromDuration:m}=FF({...r,velocity:-di(r.velocity||0)}),y=g||0,v=d/(2*Math.sqrt(c*h)),b=i-l,S=di(Math.sqrt(c/h)),C=Math.abs(b)<5;o||(o=C?No.restSpeed.granular:No.restSpeed.default),s||(s=C?No.restDelta.granular:No.restDelta.default);let k;if(v<1){const j=Dx(S,v);k=T=>{const _=Math.exp(-v*S*T);return i-_*((y+v*S*b)/j*Math.sin(j*T)+b*Math.cos(j*T))}}else if(v===1)k=j=>i-Math.exp(-S*j)*(b+(y+S*b)*j);else{const j=S*Math.sqrt(v*v-1);k=T=>{const _=Math.exp(-v*S*T),P=Math.min(j*T,300);return i-_*((y+v*S*b)*Math.sinh(P)+j*b*Math.cosh(P))/j}}const R={calculatedDuration:m&&f||null,next:j=>{const T=k(j);if(m)u.done=j>=f;else{let _=j===0?y:0;v<1&&(_=j===0?Hi(y):RM(k,j,T));const P=Math.abs(_)<=o,I=Math.abs(i-T)<=s;u.done=P&&I}return u.value=u.done?i:T,u},toString:()=>{const j=Math.min(Qb(R),Q5),T=kM(_=>R.next(j*_).value,j,30);return j+"ms "+T},toTransition:()=>{}};return R}eg.applyToOptions=e=>{const t=RF(e,100,eg);return e.ease=t.ease,e.duration=Hi(t.duration),e.type="keyframes",e};function Lx({keyframes:e,velocity:t=0,power:r=.8,timeConstant:o=325,bounceDamping:s=10,bounceStiffness:l=500,modifyTarget:i,min:u,max:c,restDelta:d=.5,restSpeed:h}){const f=e[0],g={done:!1,value:f},m=P=>u!==void 0&&P<u||c!==void 0&&P>c,y=P=>u===void 0?c:c===void 0||Math.abs(u-P)<Math.abs(c-P)?u:c;let v=r*t;const b=f+v,S=i===void 0?b:i(b);S!==b&&(v=S-f);const C=P=>-v*Math.exp(-P/o),k=P=>S+C(P),R=P=>{const I=C(P),$=k(P);g.done=Math.abs(I)<=d,g.value=g.done?S:$};let j,T;const _=P=>{m(g.value)&&(j=P,T=eg({keyframes:[g.value,y(g.value)],velocity:RM(k,P,g.value),damping:s,stiffness:l,restDelta:d,restSpeed:h}))};return _(0),{calculatedDuration:null,next:P=>{let I=!1;return!T&&j===void 0&&(I=!0,R(P),_(P)),j!==void 0&&P>=j?T.next(P-j):(!I&&R(P),g)}}}function NF(e,t,r){const o=[],s=r||ec.mix||MM,l=e.length-1;for(let i=0;i<l;i++){let u=s(e[i],e[i+1]);if(t){const c=Array.isArray(t)?t[i]||hi:t;u=jp(c,u)}o.push(u)}return o}function OF(e,t,{clamp:r=!0,ease:o,mixer:s}={}){const l=e.length;if(Gb(l===t.length),l===1)return()=>t[0];if(l===2&&t[0]===t[1])return()=>t[1];const i=e[0]===e[1];e[0]>e[l-1]&&(e=[...e].reverse(),t=[...t].reverse());const u=NF(t,o,s),c=u.length,d=h=>{if(i&&h<e[0])return t[0];let f=0;if(c>1)for(;f<e.length-2&&!(h<e[f+1]);f++);const g=cp(e[f],e[f+1],h);return u[f](g)};return r?h=>d(Cl(e[0],e[l-1],h)):d}function _F(e,t){const r=e[e.length-1];for(let o=1;o<=t;o++){const s=cp(0,t,o);e.push(Ao(r,1,s))}}function DF(e){const t=[0];return _F(t,e.length-1),t}function LF(e,t){return e.map(r=>r*t)}function zF(e,t){return e.map(()=>t||fM).splice(0,e.length-1)}function Xf({duration:e=300,keyframes:t,times:r,ease:o="easeInOut"}){const s=XP(o)?o.map(d8):d8(o),l={done:!1,value:t[0]},i=LF(r&&r.length===t.length?r:DF(t),e),u=OF(i,t,{ease:Array.isArray(s)?s:zF(t,s)});return{calculatedDuration:e,next:c=>(l.value=u(c),l.done=c>=e,l)}}const BF=e=>e!==null;function ev(e,{repeat:t,repeatType:r="loop"},o,s=1){const l=e.filter(BF),u=s<0||t&&r!=="loop"&&t%2===1?0:l.length-1;return!u||o===void 0?l[u]:o}const $F={decay:Lx,inertia:Lx,tween:Xf,keyframes:Xf,spring:eg};function AM(e){typeof e.type=="string"&&(e.type=$F[e.type])}class tv{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(t=>{this.resolve=t})}notifyFinished(){this.resolve()}then(t,r){return this.finished.then(t,r)}}const qF=e=>e/100;class nv extends tv{constructor(t){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var o,s;const{motionValue:r}=this.options;r&&r.updatedAt!==as.now()&&this.tick(as.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(s=(o=this.options).onStop)==null||s.call(o))},this.options=t,this.initAnimation(),this.play(),t.autoplay===!1&&this.pause()}initAnimation(){const{options:t}=this;AM(t);const{type:r=Xf,repeat:o=0,repeatDelay:s=0,repeatType:l,velocity:i=0}=t;let{keyframes:u}=t;const c=r||Xf;c!==Xf&&typeof u[0]!="number"&&(this.mixKeyframes=jp(qF,MM(u[0],u[1])),u=[0,100]);const d=c({...t,keyframes:u});l==="mirror"&&(this.mirroredGenerator=c({...t,keyframes:[...u].reverse(),velocity:-i})),d.calculatedDuration===null&&(d.calculatedDuration=Qb(d));const{calculatedDuration:h}=d;this.calculatedDuration=h,this.resolvedDuration=h+s,this.totalDuration=this.resolvedDuration*(o+1)-s,this.generator=d}updateTime(t){const r=Math.round(t-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=r}tick(t,r=!1){const{generator:o,totalDuration:s,mixKeyframes:l,mirroredGenerator:i,resolvedDuration:u,calculatedDuration:c}=this;if(this.startTime===null)return o.next(0);const{delay:d=0,keyframes:h,repeat:f,repeatType:g,repeatDelay:m,type:y,onUpdate:v,finalKeyframe:b}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-s/this.speed,this.startTime)),r?this.currentTime=t:this.updateTime(t);const S=this.currentTime-d*(this.playbackSpeed>=0?1:-1),C=this.playbackSpeed>=0?S<0:S>s;this.currentTime=Math.max(S,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=s);let k=this.currentTime,R=o;if(f){const P=Math.min(this.currentTime,s)/u;let I=Math.floor(P),$=P%1;!$&&P>=1&&($=1),$===1&&I--,I=Math.min(I,f+1),!!(I%2)&&(g==="reverse"?($=1-$,m&&($-=m/u)):g==="mirror"&&(R=i)),k=Cl(0,1,$)*u}const j=C?{done:!1,value:h[0]}:R.next(k);l&&(j.value=l(j.value));let{done:T}=j;!C&&c!==null&&(T=this.playbackSpeed>=0?this.currentTime>=s:this.currentTime<=0);const _=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&T);return _&&y!==Lx&&(j.value=ev(h,this.options,b,this.speed)),v&&v(j.value),_&&this.finish(),j}then(t,r){return this.finished.then(t,r)}get duration(){return di(this.calculatedDuration)}get iterationDuration(){const{delay:t=0}=this.options||{};return this.duration+di(t)}get time(){return di(this.currentTime)}set time(t){var r;t=Hi(t),this.currentTime=t,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.playbackSpeed),(r=this.driver)==null||r.start(!1)}get speed(){return this.playbackSpeed}set speed(t){this.updateTime(as.now());const r=this.playbackSpeed!==t;this.playbackSpeed=t,r&&(this.time=di(this.currentTime))}play(){var s,l;if(this.isStopped)return;const{driver:t=kF,startTime:r}=this.options;this.driver||(this.driver=t(i=>this.tick(i))),(l=(s=this.options).onPlay)==null||l.call(s);const o=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=o):this.holdTime!==null?this.startTime=o-this.holdTime:this.startTime||(this.startTime=r??o),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(as.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var t,r;this.notifyFinished(),this.teardown(),this.state="finished",(r=(t=this.options).onComplete)==null||r.call(t)}cancel(){var t,r;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(r=(t=this.options).onCancel)==null||r.call(t)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}attachTimeline(t){var r;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(r=this.driver)==null||r.stop(),t.observe(this)}}function WF(e){for(let t=1;t<e.length;t++)e[t]??(e[t]=e[t-1])}const vd=e=>e*180/Math.PI,zx=e=>{const t=vd(Math.atan2(e[1],e[0]));return Bx(t)},HF={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:zx,rotateZ:zx,skewX:e=>vd(Math.atan(e[1])),skewY:e=>vd(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},Bx=e=>(e=e%360,e<0&&(e+=360),e),y8=zx,x8=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),b8=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),GF={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:x8,scaleY:b8,scale:e=>(x8(e)+b8(e))/2,rotateX:e=>Bx(vd(Math.atan2(e[6],e[5]))),rotateY:e=>Bx(vd(Math.atan2(-e[2],e[0]))),rotateZ:y8,rotate:y8,skewX:e=>vd(Math.atan(e[4])),skewY:e=>vd(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function $x(e){return e.includes("scale")?1:0}function qx(e,t){if(!e||e==="none")return $x(t);const r=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let o,s;if(r)o=GF,s=r;else{const u=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);o=HF,s=u}if(!s)return $x(t);const l=o[t],i=s[1].split(",").map(UF);return typeof l=="function"?l(i):i[l]}const VF=(e,t)=>{const{transform:r="none"}=getComputedStyle(e);return qx(r,t)};function UF(e){return parseFloat(e.trim())}const Ph=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Fh=new Set(Ph),v8=e=>e===Ih||e===Fn,YF=new Set(["x","y","z"]),KF=Ph.filter(e=>!YF.has(e));function XF(e){const t=[];return KF.forEach(r=>{const o=e.getValue(r);o!==void 0&&(t.push([r,o.get()]),o.set(r.startsWith("scale")?1:0))}),t}const Kc={width:({x:e},{paddingLeft:t="0",paddingRight:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),height:({y:e},{paddingTop:t="0",paddingBottom:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:(e,{transform:t})=>qx(t,"x"),y:(e,{transform:t})=>qx(t,"y")};Kc.translateX=Kc.x;Kc.translateY=Kc.y;const kd=new Set;let Wx=!1,Hx=!1,Gx=!1;function jM(){if(Hx){const e=Array.from(kd).filter(o=>o.needsMeasurement),t=new Set(e.map(o=>o.element)),r=new Map;t.forEach(o=>{const s=XF(o);s.length&&(r.set(o,s),o.render())}),e.forEach(o=>o.measureInitialState()),t.forEach(o=>{o.render();const s=r.get(o);s&&s.forEach(([l,i])=>{var u;(u=o.getValue(l))==null||u.set(i)})}),e.forEach(o=>o.measureEndState()),e.forEach(o=>{o.suspendedScrollY!==void 0&&window.scrollTo(0,o.suspendedScrollY)})}Hx=!1,Wx=!1,kd.forEach(e=>e.complete(Gx)),kd.clear()}function EM(){kd.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(Hx=!0)})}function ZF(){Gx=!0,EM(),jM(),Gx=!1}class rv{constructor(t,r,o,s,l,i=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...t],this.onComplete=r,this.name=o,this.motionValue=s,this.element=l,this.isAsync=i}scheduleResolve(){this.state="scheduled",this.isAsync?(kd.add(this),Wx||(Wx=!0,no.read(EM),no.resolveKeyframes(jM))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:r,element:o,motionValue:s}=this;if(t[0]===null){const l=s==null?void 0:s.get(),i=t[t.length-1];if(l!==void 0)t[0]=l;else if(o&&r){const u=o.readValue(r,i);u!=null&&(t[0]=u)}t[0]===void 0&&(t[0]=i),s&&l===void 0&&s.set(t[0])}WF(t)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(t=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,t),kd.delete(this)}cancel(){this.state==="scheduled"&&(kd.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const JF=e=>e.startsWith("--");function QF(e,t,r){JF(t)?e.style.setProperty(t,r):e.style[t]=r}const eN={};function TM(e,t){const r=rM(e);return()=>eN[t]??r()}const tN=TM(()=>window.ScrollTimeline!==void 0,"scrollTimeline"),IM=TM(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),zf=([e,t,r,o])=>`cubic-bezier(${e}, ${t}, ${r}, ${o})`,S8={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:zf([0,.65,.55,1]),circOut:zf([.55,0,1,.45]),backIn:zf([.31,.01,.66,-.59]),backOut:zf([.33,1.53,.69,.99])};function PM(e,t){if(e)return typeof e=="function"?IM()?kM(e,t):"ease-out":pM(e)?zf(e):Array.isArray(e)?e.map(r=>PM(r,t)||S8.easeOut):S8[e]}function nN(e,t,r,{delay:o=0,duration:s=300,repeat:l=0,repeatType:i="loop",ease:u="easeOut",times:c}={},d=void 0){const h={[t]:r};c&&(h.offset=c);const f=PM(u,s);Array.isArray(f)&&(h.easing=f);const g={delay:o,duration:s,easing:Array.isArray(f)?"linear":f,fill:"both",iterations:l+1,direction:i==="reverse"?"alternate":"normal"};return d&&(g.pseudoElement=d),e.animate(h,g)}function FM(e){return typeof e=="function"&&"applyToOptions"in e}function rN({type:e,...t}){return FM(e)&&IM()?e.applyToOptions(t):(t.duration??(t.duration=300),t.ease??(t.ease="easeOut"),t)}class NM extends tv{constructor(t){if(super(),this.finishedTime=null,this.isStopped=!1,this.manualStartTime=null,!t)return;const{element:r,name:o,keyframes:s,pseudoElement:l,allowFlatten:i=!1,finalKeyframe:u,onComplete:c}=t;this.isPseudoElement=!!l,this.allowFlatten=i,this.options=t,Gb(typeof t.type!="string");const d=rN(t);this.animation=nN(r,o,s,d,l),d.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!l){const h=ev(s,this.options,u,this.speed);this.updateMotionValue?this.updateMotionValue(h):QF(r,o,h),this.animation.cancel()}c==null||c(),this.notifyFinished()}}play(){this.isStopped||(this.manualStartTime=null,this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var t,r;(r=(t=this.animation).finish)==null||r.call(t)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:t}=this;t==="idle"||t==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var r,o,s;const t=(r=this.options)==null?void 0:r.element;!this.isPseudoElement&&(t!=null&&t.isConnected)&&((s=(o=this.animation).commitStyles)==null||s.call(o))}get duration(){var r,o;const t=((o=(r=this.animation.effect)==null?void 0:r.getComputedTiming)==null?void 0:o.call(r).duration)||0;return di(Number(t))}get iterationDuration(){const{delay:t=0}=this.options||{};return this.duration+di(t)}get time(){return di(Number(this.animation.currentTime)||0)}set time(t){this.manualStartTime=null,this.finishedTime=null,this.animation.currentTime=Hi(t)}get speed(){return this.animation.playbackRate}set speed(t){t<0&&(this.finishedTime=null),this.animation.playbackRate=t}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return this.manualStartTime??Number(this.animation.startTime)}set startTime(t){this.manualStartTime=this.animation.startTime=t}attachTimeline({timeline:t,observe:r}){var o;return this.allowFlatten&&((o=this.animation.effect)==null||o.updateTiming({easing:"linear"})),this.animation.onfinish=null,t&&tN()?(this.animation.timeline=t,hi):r(this)}}const OM={anticipate:dM,backInOut:cM,circInOut:hM};function oN(e){return e in OM}function aN(e){typeof e.ease=="string"&&oN(e.ease)&&(e.ease=OM[e.ease])}const C2=10;class sN extends NM{constructor(t){aN(t),AM(t),super(t),t.startTime!==void 0&&(this.startTime=t.startTime),this.options=t}updateMotionValue(t){const{motionValue:r,onUpdate:o,onComplete:s,element:l,...i}=this.options;if(!r)return;if(t!==void 0){r.set(t);return}const u=new nv({...i,autoplay:!1}),c=Math.max(C2,as.now()-this.startTime),d=Cl(0,C2,c-C2);r.setWithVelocity(u.sample(Math.max(0,c-d)).value,u.sample(c).value,d),u.stop()}}const w8=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(Gi.test(e)||e==="0")&&!e.startsWith("url("));function iN(e){const t=e[0];if(e.length===1)return!0;for(let r=0;r<e.length;r++)if(e[r]!==t)return!0}function lN(e,t,r,o){const s=e[0];if(s===null)return!1;if(t==="display"||t==="visibility")return!0;const l=e[e.length-1],i=w8(s,t),u=w8(l,t);return!i||!u?!1:iN(e)||(r==="spring"||FM(r))&&o}function Vx(e){e.duration=0,e.type="keyframes"}const cN=new Set(["opacity","clipPath","filter","transform"]),dN=rM(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function uN(e){var h;const{motionValue:t,name:r,repeatDelay:o,repeatType:s,damping:l,type:i}=e;if(!(((h=t==null?void 0:t.owner)==null?void 0:h.current)instanceof HTMLElement))return!1;const{onUpdate:c,transformTemplate:d}=t.owner.getProps();return dN()&&r&&cN.has(r)&&(r!=="transform"||!d)&&!c&&!o&&s!=="mirror"&&l!==0&&i!=="inertia"}const hN=40;class fN extends tv{constructor({autoplay:t=!0,delay:r=0,type:o="keyframes",repeat:s=0,repeatDelay:l=0,repeatType:i="loop",keyframes:u,name:c,motionValue:d,element:h,...f}){var y;super(),this.stop=()=>{var v,b;this._animation&&(this._animation.stop(),(v=this.stopTimeline)==null||v.call(this)),(b=this.keyframeResolver)==null||b.cancel()},this.createdAt=as.now();const g={autoplay:t,delay:r,type:o,repeat:s,repeatDelay:l,repeatType:i,name:c,motionValue:d,element:h,...f},m=(h==null?void 0:h.KeyframeResolver)||rv;this.keyframeResolver=new m(u,(v,b,S)=>this.onKeyframesResolved(v,b,g,!S),c,d,h),(y=this.keyframeResolver)==null||y.scheduleResolve()}onKeyframesResolved(t,r,o,s){var b,S;this.keyframeResolver=void 0;const{name:l,type:i,velocity:u,delay:c,isHandoff:d,onUpdate:h}=o;this.resolvedAt=as.now(),lN(t,l,i,u)||((ec.instantAnimations||!c)&&(h==null||h(ev(t,o,r))),t[0]=t[t.length-1],Vx(o),o.repeat=0);const g={startTime:s?this.resolvedAt?this.resolvedAt-this.createdAt>hN?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:r,...o,keyframes:t},m=!d&&uN(g),y=(S=(b=g.motionValue)==null?void 0:b.owner)==null?void 0:S.current,v=m?new sN({...g,element:y}):new nv(g);v.finished.then(()=>{this.notifyFinished()}).catch(hi),this.pendingTimeline&&(this.stopTimeline=v.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=v}get finished(){return this._animation?this.animation.finished:this._finished}then(t,r){return this.finished.finally(t).then(()=>{})}get animation(){var t;return this._animation||((t=this.keyframeResolver)==null||t.resume(),ZF()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(t){this.animation.time=t}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(t){this.animation.speed=t}get startTime(){return this.animation.startTime}attachTimeline(t){return this._animation?this.stopTimeline=this.animation.attachTimeline(t):this.pendingTimeline=t,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var t;this._animation&&this.animation.cancel(),(t=this.keyframeResolver)==null||t.cancel()}}function _M(e,t,r,o=0,s=1){const l=Array.from(e).sort((d,h)=>d.sortNodePosition(h)).indexOf(t),i=e.size,u=(i-1)*o;return typeof r=="function"?r(l,i):s===1?l*o:u-l*o}const pN=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function mN(e){const t=pN.exec(e);if(!t)return[,];const[,r,o,s]=t;return[`--${r??o}`,s]}function DM(e,t,r=1){const[o,s]=mN(e);if(!o)return;const l=window.getComputedStyle(t).getPropertyValue(o);if(l){const i=l.trim();return eM(i)?parseFloat(i):i}return Kb(s)?DM(s,t,r+1):s}const gN={type:"spring",stiffness:500,damping:25,restSpeed:10},yN=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),xN={type:"keyframes",duration:.8},bN={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},vN=(e,{keyframes:t})=>t.length>2?xN:Fh.has(e)?e.startsWith("scale")?yN(t[1]):gN:bN,SN=e=>e!==null;function wN(e,{repeat:t,repeatType:r="loop"},o){const s=e.filter(SN),l=t&&r!=="loop"&&t%2===1?0:s.length-1;return s[l]}function LM(e,t){if(e!=null&&e.inherit&&t){const{inherit:r,...o}=e;return{...t,...o}}return e}function ov(e,t){const r=(e==null?void 0:e[t])??(e==null?void 0:e.default)??e;return r!==e?LM(r,e):r}function CN({when:e,delay:t,delayChildren:r,staggerChildren:o,staggerDirection:s,repeat:l,repeatType:i,repeatDelay:u,from:c,elapsed:d,...h}){return!!Object.keys(h).length}const av=(e,t,r,o={},s,l)=>i=>{const u=ov(o,e)||{},c=u.delay||o.delay||0;let{elapsed:d=0}=o;d=d-Hi(c);const h={keyframes:Array.isArray(r)?r:[null,r],ease:"easeOut",velocity:t.getVelocity(),...u,delay:-d,onUpdate:g=>{t.set(g),u.onUpdate&&u.onUpdate(g)},onComplete:()=>{i(),u.onComplete&&u.onComplete()},name:e,motionValue:t,element:l?void 0:s};CN(u)||Object.assign(h,vN(e,h)),h.duration&&(h.duration=Hi(h.duration)),h.repeatDelay&&(h.repeatDelay=Hi(h.repeatDelay)),h.from!==void 0&&(h.keyframes[0]=h.from);let f=!1;if((h.type===!1||h.duration===0&&!h.repeatDelay)&&(Vx(h),h.delay===0&&(f=!0)),(ec.instantAnimations||ec.skipAnimations||s!=null&&s.shouldSkipAnimations)&&(f=!0,Vx(h),h.delay=0),h.allowFlatten=!u.type&&!u.ease,f&&!l&&t.get()!==void 0){const g=wN(h.keyframes,u);if(g!==void 0){no.update(()=>{h.onUpdate(g),h.onComplete()});return}}return u.isSync?new nv(h):new fN(h)};function C8(e){const t=[{},{}];return e==null||e.values.forEach((r,o)=>{t[0][o]=r.get(),t[1][o]=r.getVelocity()}),t}function sv(e,t,r,o){if(typeof t=="function"){const[s,l]=C8(o);t=t(r!==void 0?r:e.custom,s,l)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[s,l]=C8(o);t=t(r!==void 0?r:e.custom,s,l)}return t}function gh(e,t,r){const o=e.getProps();return sv(o,t,r!==void 0?r:o.custom,e)}const zM=new Set(["width","height","top","left","right","bottom",...Ph]),M8=30,MN=e=>!isNaN(parseFloat(e));class kN{constructor(t,r={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=o=>{var l;const s=as.now();if(this.updatedAt!==s&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(o),this.current!==this.prev&&((l=this.events.change)==null||l.notify(this.current),this.dependents))for(const i of this.dependents)i.dirty()},this.hasAnimated=!1,this.setCurrent(t),this.owner=r.owner}setCurrent(t){this.current=t,this.updatedAt=as.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=MN(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,r){this.events[t]||(this.events[t]=new Vb);const o=this.events[t].add(r);return t==="change"?()=>{o(),no.read(()=>{this.events.change.getSize()||this.stop()})}:o}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,r){this.passiveEffect=t,this.stopPassiveEffect=r}set(t){this.passiveEffect?this.passiveEffect(t,this.updateAndNotify):this.updateAndNotify(t)}setWithVelocity(t,r,o){this.set(r),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-o}jump(t,r=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,r&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var t;(t=this.events.change)==null||t.notify(this.current)}addDependent(t){this.dependents||(this.dependents=new Set),this.dependents.add(t)}removeDependent(t){this.dependents&&this.dependents.delete(t)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=as.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>M8)return 0;const r=Math.min(this.updatedAt-this.prevUpdatedAt,M8);return oM(parseFloat(this.current)-parseFloat(this.prevFrameValue),r)}start(t){return this.stop(),new Promise(r=>{this.hasAnimated=!0,this.animation=t(r),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var t,r;(t=this.dependents)==null||t.clear(),(r=this.events.destroy)==null||r.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Mh(e,t){return new kN(e,t)}const Ux=e=>Array.isArray(e);function RN(e,t,r){e.hasValue(t)?e.getValue(t).set(r):e.addValue(t,Mh(r))}function AN(e){return Ux(e)?e[e.length-1]||0:e}function jN(e,t){const r=gh(e,t);let{transitionEnd:o={},transition:s={},...l}=r||{};l={...l,...o};for(const i in l){const u=AN(l[i]);RN(e,i,u)}}const Va=e=>!!(e&&e.getVelocity);function EN(e){return!!(Va(e)&&e.add)}function Yx(e,t){const r=e.getValue("willChange");if(EN(r))return r.add(t);if(!r&&ec.WillChange){const o=new ec.WillChange("auto");e.addValue("willChange",o),o.add(t)}}function iv(e){return e.replace(/([A-Z])/g,t=>`-${t.toLowerCase()}`)}const TN="framerAppearId",BM="data-"+iv(TN);function $M(e){return e.props[BM]}function IN({protectedKeys:e,needsAnimating:t},r){const o=e.hasOwnProperty(r)&&t[r]!==!0;return t[r]=!1,o}function qM(e,t,{delay:r=0,transitionOverride:o,type:s}={}){let{transition:l,transitionEnd:i,...u}=t;const c=e.getDefaultTransition();l=l?LM(l,c):c;const d=l==null?void 0:l.reduceMotion;o&&(l=o);const h=[],f=s&&e.animationState&&e.animationState.getState()[s];for(const g in u){const m=e.getValue(g,e.latestValues[g]??null),y=u[g];if(y===void 0||f&&IN(f,g))continue;const v={delay:r,...ov(l||{},g)},b=m.get();if(b!==void 0&&!m.isAnimating&&!Array.isArray(y)&&y===b&&!v.velocity)continue;let S=!1;if(window.MotionHandoffAnimation){const R=$M(e);if(R){const j=window.MotionHandoffAnimation(R,g,no);j!==null&&(v.startTime=j,S=!0)}}Yx(e,g);const C=d??e.shouldReduceMotion;m.start(av(g,m,y,C&&zM.has(g)?{type:!1}:v,e,S));const k=m.animation;k&&h.push(k)}if(i){const g=()=>no.update(()=>{i&&jN(e,i)});h.length?Promise.all(h).then(g):g()}return h}function Kx(e,t,r={}){var c;const o=gh(e,t,r.type==="exit"?(c=e.presenceContext)==null?void 0:c.custom:void 0);let{transition:s=e.getDefaultTransition()||{}}=o||{};r.transitionOverride&&(s=r.transitionOverride);const l=o?()=>Promise.all(qM(e,o,r)):()=>Promise.resolve(),i=e.variantChildren&&e.variantChildren.size?(d=0)=>{const{delayChildren:h=0,staggerChildren:f,staggerDirection:g}=s;return PN(e,t,d,h,f,g,r)}:()=>Promise.resolve(),{when:u}=s;if(u){const[d,h]=u==="beforeChildren"?[l,i]:[i,l];return d().then(()=>h())}else return Promise.all([l(),i(r.delay)])}function PN(e,t,r=0,o=0,s=0,l=1,i){const u=[];for(const c of e.variantChildren)c.notify("AnimationStart",t),u.push(Kx(c,t,{...i,delay:r+(typeof o=="function"?0:o)+_M(e.variantChildren,c,o,s,l)}).then(()=>c.notify("AnimationComplete",t)));return Promise.all(u)}function FN(e,t,r={}){e.notify("AnimationStart",t);let o;if(Array.isArray(t)){const s=t.map(l=>Kx(e,l,r));o=Promise.all(s)}else if(typeof t=="string")o=Kx(e,t,r);else{const s=typeof t=="function"?gh(e,t,r.custom):t;o=Promise.all(qM(e,s,r))}return o.then(()=>{e.notify("AnimationComplete",t)})}const NN={test:e=>e==="auto",parse:e=>e},WM=e=>t=>t.test(e),HM=[Ih,Fn,Sl,Lc,cF,lF,NN],k8=e=>HM.find(WM(e));function ON(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||nM(e):!0}const _N=new Set(["brightness","contrast","saturate","opacity"]);function DN(e){const[t,r]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[o]=r.match(Xb)||[];if(!o)return e;const s=r.replace(o,"");let l=_N.has(t)?1:0;return o!==r&&(l*=100),t+"("+l+s+")"}const LN=/\b([a-z-]*)\(.*?\)/gu,Xx={...Gi,getAnimatableNone:e=>{const t=e.match(LN);return t?t.map(DN).join(" "):e}},Zx={...Gi,getAnimatableNone:e=>{const t=Gi.parse(e);return Gi.createTransformer(e)(t.map(o=>typeof o=="number"?0:typeof o=="object"?{...o,alpha:1}:o))}},R8={...Ih,transform:Math.round},zN={rotate:Lc,rotateX:Lc,rotateY:Lc,rotateZ:Lc,scale:Bm,scaleX:Bm,scaleY:Bm,scaleZ:Bm,skew:Lc,skewX:Lc,skewY:Lc,distance:Fn,translateX:Fn,translateY:Fn,translateZ:Fn,x:Fn,y:Fn,z:Fn,perspective:Fn,transformPerspective:Fn,opacity:dp,originX:h8,originY:h8,originZ:Fn},lv={borderWidth:Fn,borderTopWidth:Fn,borderRightWidth:Fn,borderBottomWidth:Fn,borderLeftWidth:Fn,borderRadius:Fn,borderTopLeftRadius:Fn,borderTopRightRadius:Fn,borderBottomRightRadius:Fn,borderBottomLeftRadius:Fn,width:Fn,maxWidth:Fn,height:Fn,maxHeight:Fn,top:Fn,right:Fn,bottom:Fn,left:Fn,inset:Fn,insetBlock:Fn,insetBlockStart:Fn,insetBlockEnd:Fn,insetInline:Fn,insetInlineStart:Fn,insetInlineEnd:Fn,padding:Fn,paddingTop:Fn,paddingRight:Fn,paddingBottom:Fn,paddingLeft:Fn,paddingBlock:Fn,paddingBlockStart:Fn,paddingBlockEnd:Fn,paddingInline:Fn,paddingInlineStart:Fn,paddingInlineEnd:Fn,margin:Fn,marginTop:Fn,marginRight:Fn,marginBottom:Fn,marginLeft:Fn,marginBlock:Fn,marginBlockStart:Fn,marginBlockEnd:Fn,marginInline:Fn,marginInlineStart:Fn,marginInlineEnd:Fn,fontSize:Fn,backgroundPositionX:Fn,backgroundPositionY:Fn,...zN,zIndex:R8,fillOpacity:dp,strokeOpacity:dp,numOctaves:R8},BN={...lv,color:Xo,backgroundColor:Xo,outlineColor:Xo,fill:Xo,stroke:Xo,borderColor:Xo,borderTopColor:Xo,borderRightColor:Xo,borderBottomColor:Xo,borderLeftColor:Xo,filter:Xx,WebkitFilter:Xx,mask:Zx,WebkitMask:Zx},GM=e=>BN[e],$N=new Set([Xx,Zx]);function VM(e,t){let r=GM(e);return $N.has(r)||(r=Gi),r.getAnimatableNone?r.getAnimatableNone(t):void 0}const qN=new Set(["auto","none","0"]);function WN(e,t,r){let o=0,s;for(;o<e.length&&!s;){const l=e[o];typeof l=="string"&&!qN.has(l)&&up(l).values.length&&(s=e[o]),o++}if(s&&r)for(const l of t)e[l]=VM(r,s)}class HN extends rv{constructor(t,r,o,s,l){super(t,r,o,s,l,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:r,name:o}=this;if(!r||!r.current)return;super.readKeyframes();for(let h=0;h<t.length;h++){let f=t[h];if(typeof f=="string"&&(f=f.trim(),Kb(f))){const g=DM(f,r.current);g!==void 0&&(t[h]=g),h===t.length-1&&(this.finalKeyframe=f)}}if(this.resolveNoneKeyframes(),!zM.has(o)||t.length!==2)return;const[s,l]=t,i=k8(s),u=k8(l),c=u8(s),d=u8(l);if(c!==d&&Kc[o]){this.needsMeasurement=!0;return}if(i!==u)if(v8(i)&&v8(u))for(let h=0;h<t.length;h++){const f=t[h];typeof f=="string"&&(t[h]=parseFloat(f))}else Kc[o]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:r}=this,o=[];for(let s=0;s<t.length;s++)(t[s]===null||ON(t[s]))&&o.push(s);o.length&&WN(t,o,r)}measureInitialState(){const{element:t,unresolvedKeyframes:r,name:o}=this;if(!t||!t.current)return;o==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Kc[o](t.measureViewportBox(),window.getComputedStyle(t.current)),r[0]=this.measuredOrigin;const s=r[r.length-1];s!==void 0&&t.getValue(o,s).jump(s,!1)}measureEndState(){var u;const{element:t,name:r,unresolvedKeyframes:o}=this;if(!t||!t.current)return;const s=t.getValue(r);s&&s.jump(this.measuredOrigin,!1);const l=o.length-1,i=o[l];o[l]=Kc[r](t.measureViewportBox(),window.getComputedStyle(t.current)),i!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=i),(u=this.removedTransforms)!=null&&u.length&&this.removedTransforms.forEach(([c,d])=>{t.getValue(c).set(d)}),this.resolveNoneKeyframes()}}const GN=new Set(["opacity","clipPath","filter","transform"]);function UM(e,t,r){if(e==null)return[];if(e instanceof EventTarget)return[e];if(typeof e=="string"){let o=document;const s=(r==null?void 0:r[e])??o.querySelectorAll(e);return s?Array.from(s):[]}return Array.from(e).filter(o=>o!=null)}const YM=(e,t)=>t&&typeof e=="number"?t.transform(e):e;function Jx(e){return tM(e)&&"offsetHeight"in e}const{schedule:cv}=mM(queueMicrotask,!1),Fi={x:!1,y:!1};function KM(){return Fi.x||Fi.y}function VN(e){return e==="x"||e==="y"?Fi[e]?null:(Fi[e]=!0,()=>{Fi[e]=!1}):Fi.x||Fi.y?null:(Fi.x=Fi.y=!0,()=>{Fi.x=Fi.y=!1})}function XM(e,t){const r=UM(e),o=new AbortController,s={passive:!0,...t,signal:o.signal};return[r,s,()=>o.abort()]}function UN(e){return!(e.pointerType==="touch"||KM())}function YN(e,t,r={}){const[o,s,l]=XM(e,r);return o.forEach(i=>{let u=!1,c=!1,d;const h=()=>{i.removeEventListener("pointerleave",y)},f=b=>{d&&(d(b),d=void 0),h()},g=b=>{u=!1,window.removeEventListener("pointerup",g),window.removeEventListener("pointercancel",g),c&&(c=!1,f(b))},m=()=>{u=!0,window.addEventListener("pointerup",g,s),window.addEventListener("pointercancel",g,s)},y=b=>{if(b.pointerType!=="touch"){if(u){c=!0;return}f(b)}},v=b=>{if(!UN(b))return;c=!1;const S=t(i,b);typeof S=="function"&&(d=S,i.addEventListener("pointerleave",y,s))};i.addEventListener("pointerenter",v,s),i.addEventListener("pointerdown",m,s)}),l}const ZM=(e,t)=>t?e===t?!0:ZM(e,t.parentElement):!1,dv=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,KN=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function XN(e){return KN.has(e.tagName)||e.isContentEditable===!0}const ZN=new Set(["INPUT","SELECT","TEXTAREA"]);function JN(e){return ZN.has(e.tagName)||e.isContentEditable===!0}const F5=new WeakSet;function A8(e){return t=>{t.key==="Enter"&&e(t)}}function M2(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const QN=(e,t)=>{const r=e.currentTarget;if(!r)return;const o=A8(()=>{if(F5.has(r))return;M2(r,"down");const s=A8(()=>{M2(r,"up")}),l=()=>M2(r,"cancel");r.addEventListener("keyup",s,t),r.addEventListener("blur",l,t)});r.addEventListener("keydown",o,t),r.addEventListener("blur",()=>r.removeEventListener("keydown",o),t)};function j8(e){return dv(e)&&!KM()}const E8=new WeakSet;function eO(e,t,r={}){const[o,s,l]=XM(e,r),i=u=>{const c=u.currentTarget;if(!j8(u)||E8.has(u))return;F5.add(c),r.stopPropagation&&E8.add(u);const d=t(c,u),h=(m,y)=>{window.removeEventListener("pointerup",f),window.removeEventListener("pointercancel",g),F5.has(c)&&F5.delete(c),j8(m)&&typeof d=="function"&&d(m,{success:y})},f=m=>{h(m,c===window||c===document||r.useGlobalTarget||ZM(c,m.target))},g=m=>{h(m,!1)};window.addEventListener("pointerup",f,s),window.addEventListener("pointercancel",g,s)};return o.forEach(u=>{(r.useGlobalTarget?window:u).addEventListener("pointerdown",i,s),Jx(u)&&(u.addEventListener("focus",d=>QN(d,s)),!XN(u)&&!u.hasAttribute("tabindex")&&(u.tabIndex=0))}),l}function uv(e){return tM(e)&&"ownerSVGElement"in e}const N5=new WeakMap;let zc;const JM=(e,t,r)=>(o,s)=>s&&s[0]?s[0][e+"Size"]:uv(o)&&"getBBox"in o?o.getBBox()[t]:o[r],tO=JM("inline","width","offsetWidth"),nO=JM("block","height","offsetHeight");function rO({target:e,borderBoxSize:t}){var r;(r=N5.get(e))==null||r.forEach(o=>{o(e,{get width(){return tO(e,t)},get height(){return nO(e,t)}})})}function oO(e){e.forEach(rO)}function aO(){typeof ResizeObserver>"u"||(zc=new ResizeObserver(oO))}function sO(e,t){zc||aO();const r=UM(e);return r.forEach(o=>{let s=N5.get(o);s||(s=new Set,N5.set(o,s)),s.add(t),zc==null||zc.observe(o)}),()=>{r.forEach(o=>{const s=N5.get(o);s==null||s.delete(t),s!=null&&s.size||zc==null||zc.unobserve(o)})}}const O5=new Set;let oh;function iO(){oh=()=>{const e={get width(){return window.innerWidth},get height(){return window.innerHeight}};O5.forEach(t=>t(e))},window.addEventListener("resize",oh)}function lO(e){return O5.add(e),oh||iO(),()=>{O5.delete(e),!O5.size&&typeof oh=="function"&&(window.removeEventListener("resize",oh),oh=void 0)}}function T8(e,t){return typeof e=="function"?lO(e):sO(e,t)}function cO(e){return uv(e)&&e.tagName==="svg"}const dO=[...HM,Xo,Gi],uO=e=>dO.find(WM(e)),I8=()=>({translate:0,scale:1,origin:0,originPoint:0}),ah=()=>({x:I8(),y:I8()}),P8=()=>({min:0,max:0}),ra=()=>({x:P8(),y:P8()}),hO=new WeakMap;function Pg(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}function hp(e){return typeof e=="string"||Array.isArray(e)}const hv=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],fv=["initial",...hv];function Fg(e){return Pg(e.animate)||fv.some(t=>hp(e[t]))}function QM(e){return!!(Fg(e)||e.variants)}function fO(e,t,r){for(const o in t){const s=t[o],l=r[o];if(Va(s))e.addValue(o,s);else if(Va(l))e.addValue(o,Mh(s,{owner:e}));else if(l!==s)if(e.hasValue(o)){const i=e.getValue(o);i.liveStyle===!0?i.jump(s):i.hasAnimated||i.set(s)}else{const i=e.getStaticValue(o);e.addValue(o,Mh(i!==void 0?i:s,{owner:e}))}}for(const o in r)t[o]===void 0&&e.removeValue(o);return t}const Qx={current:null},ek={current:!1},pO=typeof window<"u";function mO(){if(ek.current=!0,!!pO)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>Qx.current=e.matches;e.addEventListener("change",t),t()}else Qx.current=!1}const F8=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];let tg={};function tk(e){tg=e}function gO(){return tg}class yO{scrapeMotionValuesFromProps(t,r,o){return{}}constructor({parent:t,props:r,presenceContext:o,reducedMotionConfig:s,skipAnimations:l,blockInitialAnimation:i,visualState:u},c={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.shouldSkipAnimations=!1,this.values=new Map,this.KeyframeResolver=rv,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.hasBeenMounted=!1,this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const m=as.now();this.renderScheduledAt<m&&(this.renderScheduledAt=m,no.render(this.render,!1,!0))};const{latestValues:d,renderState:h}=u;this.latestValues=d,this.baseTarget={...d},this.initialValues=r.initial?{...d}:{},this.renderState=h,this.parent=t,this.props=r,this.presenceContext=o,this.depth=t?t.depth+1:0,this.reducedMotionConfig=s,this.skipAnimationsConfig=l,this.options=c,this.blockInitialAnimation=!!i,this.isControllingVariants=Fg(r),this.isVariantNode=QM(r),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:f,...g}=this.scrapeMotionValuesFromProps(r,{},this);for(const m in g){const y=g[m];d[m]!==void 0&&Va(y)&&y.set(d[m])}}mount(t){var r,o;if(this.hasBeenMounted)for(const s in this.initialValues)(r=this.values.get(s))==null||r.jump(this.initialValues[s]),this.latestValues[s]=this.initialValues[s];this.current=t,hO.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((s,l)=>this.bindToMotionValue(l,s)),this.reducedMotionConfig==="never"?this.shouldReduceMotion=!1:this.reducedMotionConfig==="always"?this.shouldReduceMotion=!0:(ek.current||mO(),this.shouldReduceMotion=Qx.current),this.shouldSkipAnimations=this.skipAnimationsConfig??!1,(o=this.parent)==null||o.addChild(this),this.update(this.props,this.presenceContext),this.hasBeenMounted=!0}unmount(){var t;this.projection&&this.projection.unmount(),a0(this.notifyUpdate),a0(this.render),this.valueSubscriptions.forEach(r=>r()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(t=this.parent)==null||t.removeChild(this);for(const r in this.events)this.events[r].clear();for(const r in this.features){const o=this.features[r];o&&(o.unmount(),o.isMounted=!1)}this.current=null}addChild(t){this.children.add(t),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(t)}removeChild(t){this.children.delete(t),this.enteringChildren&&this.enteringChildren.delete(t)}bindToMotionValue(t,r){if(this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)(),r.accelerate&&GN.has(t)&&this.current instanceof HTMLElement){const{factory:i,keyframes:u,times:c,ease:d,duration:h}=r.accelerate,f=new NM({element:this.current,name:t,keyframes:u,times:c,ease:d,duration:Hi(h)}),g=i(f);this.valueSubscriptions.set(t,()=>{g(),f.cancel()});return}const o=Fh.has(t);o&&this.onBindTransform&&this.onBindTransform();const s=r.on("change",i=>{this.latestValues[t]=i,this.props.onUpdate&&no.preRender(this.notifyUpdate),o&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let l;typeof window<"u"&&window.MotionCheckAppearSync&&(l=window.MotionCheckAppearSync(this,t,r)),this.valueSubscriptions.set(t,()=>{s(),l&&l(),r.owner&&r.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in tg){const r=tg[t];if(!r)continue;const{isEnabled:o,Feature:s}=r;if(!this.features[t]&&s&&o(this.props)&&(this.features[t]=new s(this)),this.features[t]){const l=this.features[t];l.isMounted?l.update():(l.mount(),l.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):ra()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,r){this.latestValues[t]=r}update(t,r){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=r;for(let o=0;o<F8.length;o++){const s=F8[o];this.propEventSubscriptions[s]&&(this.propEventSubscriptions[s](),delete this.propEventSubscriptions[s]);const l="on"+s,i=t[l];i&&(this.propEventSubscriptions[s]=this.on(s,i))}this.prevMotionValues=fO(this,this.scrapeMotionValuesFromProps(t,this.prevProps||{},this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const r=this.getClosestVariantNode();if(r)return r.variantChildren&&r.variantChildren.add(t),()=>r.variantChildren.delete(t)}addValue(t,r){const o=this.values.get(t);r!==o&&(o&&this.removeValue(t),this.bindToMotionValue(t,r),this.values.set(t,r),this.latestValues[t]=r.get())}removeValue(t){this.values.delete(t);const r=this.valueSubscriptions.get(t);r&&(r(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,r){if(this.props.values&&this.props.values[t])return this.props.values[t];let o=this.values.get(t);return o===void 0&&r!==void 0&&(o=Mh(r===null?void 0:r,{owner:this}),this.addValue(t,o)),o}readValue(t,r){let o=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:this.getBaseTargetFromProps(this.props,t)??this.readValueFromInstance(this.current,t,this.options);return o!=null&&(typeof o=="string"&&(eM(o)||nM(o))?o=parseFloat(o):!uO(o)&&Gi.test(r)&&(o=VM(t,r)),this.setBaseTarget(t,Va(o)?o.get():o)),Va(o)?o.get():o}setBaseTarget(t,r){this.baseTarget[t]=r}getBaseTarget(t){var l;const{initial:r}=this.props;let o;if(typeof r=="string"||typeof r=="object"){const i=sv(this.props,r,(l=this.presenceContext)==null?void 0:l.custom);i&&(o=i[t])}if(r&&o!==void 0)return o;const s=this.getBaseTargetFromProps(this.props,t);return s!==void 0&&!Va(s)?s:this.initialValues[t]!==void 0&&o===void 0?void 0:this.baseTarget[t]}on(t,r){return this.events[t]||(this.events[t]=new Vb),this.events[t].add(r)}notify(t,...r){this.events[t]&&this.events[t].notify(...r)}scheduleRenderMicrotask(){cv.render(this.render)}}class nk extends yO{constructor(){super(...arguments),this.KeyframeResolver=HN}sortInstanceNodePosition(t,r){return t.compareDocumentPosition(r)&2?1:-1}getBaseTargetFromProps(t,r){const o=t.style;return o?o[r]:void 0}removeValueFromRenderState(t,{vars:r,style:o}){delete r[t],delete o[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;Va(t)&&(this.childSubscription=t.on("change",r=>{this.current&&(this.current.textContent=`${r}`)}))}}class i0{constructor(t){this.isMounted=!1,this.node=t}update(){}}function rk({top:e,left:t,right:r,bottom:o}){return{x:{min:t,max:r},y:{min:e,max:o}}}function xO({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function bO(e,t){if(!t)return e;const r=t({x:e.left,y:e.top}),o=t({x:e.right,y:e.bottom});return{top:r.y,left:r.x,bottom:o.y,right:o.x}}function k2(e){return e===void 0||e===1}function eb({scale:e,scaleX:t,scaleY:r}){return!k2(e)||!k2(t)||!k2(r)}function id(e){return eb(e)||ok(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function ok(e){return N8(e.x)||N8(e.y)}function N8(e){return e&&e!=="0%"}function ng(e,t,r){const o=e-r,s=t*o;return r+s}function O8(e,t,r,o,s){return s!==void 0&&(e=ng(e,s,o)),ng(e,r,o)+t}function tb(e,t=0,r=1,o,s){e.min=O8(e.min,t,r,o,s),e.max=O8(e.max,t,r,o,s)}function ak(e,{x:t,y:r}){tb(e.x,t.translate,t.scale,t.originPoint),tb(e.y,r.translate,r.scale,r.originPoint)}const _8=.999999999999,D8=1.0000000000001;function vO(e,t,r,o=!1){const s=r.length;if(!s)return;t.x=t.y=1;let l,i;for(let u=0;u<s;u++){l=r[u],i=l.projectionDelta;const{visualElement:c}=l.options;c&&c.props.style&&c.props.style.display==="contents"||(o&&l.options.layoutScroll&&l.scroll&&l!==l.root&&ih(e,{x:-l.scroll.offset.x,y:-l.scroll.offset.y}),i&&(t.x*=i.x.scale,t.y*=i.y.scale,ak(e,i)),o&&id(l.latestValues)&&ih(e,l.latestValues))}t.x<D8&&t.x>_8&&(t.x=1),t.y<D8&&t.y>_8&&(t.y=1)}function sh(e,t){e.min=e.min+t,e.max=e.max+t}function L8(e,t,r,o,s=.5){const l=Ao(e.min,e.max,s);tb(e,t,r,l,o)}function ih(e,t){L8(e.x,t.x,t.scaleX,t.scale,t.originX),L8(e.y,t.y,t.scaleY,t.scale,t.originY)}function sk(e,t){return rk(bO(e.getBoundingClientRect(),t))}function SO(e,t,r){const o=sk(e,r),{scroll:s}=t;return s&&(sh(o.x,s.offset.x),sh(o.y,s.offset.y)),o}const wO={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},CO=Ph.length;function MO(e,t,r){let o="",s=!0;for(let l=0;l<CO;l++){const i=Ph[l],u=e[i];if(u===void 0)continue;let c=!0;if(typeof u=="number")c=u===(i.startsWith("scale")?1:0);else{const d=parseFloat(u);c=i.startsWith("scale")?d===1:d===0}if(!c||r){const d=YM(u,lv[i]);if(!c){s=!1;const h=wO[i]||i;o+=`${h}(${d}) `}r&&(t[i]=d)}}return o=o.trim(),r?o=r(t,s?"":o):s&&(o="none"),o}function pv(e,t,r){const{style:o,vars:s,transformOrigin:l}=e;let i=!1,u=!1;for(const c in t){const d=t[c];if(Fh.has(c)){i=!0;continue}else if(yM(c)){s[c]=d;continue}else{const h=YM(d,lv[c]);c.startsWith("origin")?(u=!0,l[c]=h):o[c]=h}}if(t.transform||(i||r?o.transform=MO(t,e.transform,r):o.transform&&(o.transform="none")),u){const{originX:c="50%",originY:d="50%",originZ:h=0}=l;o.transformOrigin=`${c} ${d} ${h}`}}function ik(e,{style:t,vars:r},o,s){const l=e.style;let i;for(i in t)l[i]=t[i];s==null||s.applyProjectionStyles(l,o);for(i in r)l.setProperty(i,r[i])}function z8(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const mf={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(Fn.test(e))e=parseFloat(e);else return e;const r=z8(e,t.target.x),o=z8(e,t.target.y);return`${r}% ${o}%`}},kO={correct:(e,{treeScale:t,projectionDelta:r})=>{const o=e,s=Gi.parse(e);if(s.length>5)return o;const l=Gi.createTransformer(e),i=typeof s[0]!="number"?1:0,u=r.x.scale*t.x,c=r.y.scale*t.y;s[0+i]/=u,s[1+i]/=c;const d=Ao(u,c,.5);return typeof s[2+i]=="number"&&(s[2+i]/=d),typeof s[3+i]=="number"&&(s[3+i]/=d),l(s)}},nb={borderRadius:{...mf,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:mf,borderTopRightRadius:mf,borderBottomLeftRadius:mf,borderBottomRightRadius:mf,boxShadow:kO};function lk(e,{layout:t,layoutId:r}){return Fh.has(e)||e.startsWith("origin")||(t||r!==void 0)&&(!!nb[e]||e==="opacity")}function mv(e,t,r){var i;const o=e.style,s=t==null?void 0:t.style,l={};if(!o)return l;for(const u in o)(Va(o[u])||s&&Va(s[u])||lk(u,e)||((i=r==null?void 0:r.getValue(u))==null?void 0:i.liveStyle)!==void 0)&&(l[u]=o[u]);return l}function RO(e){return window.getComputedStyle(e)}class AO extends nk{constructor(){super(...arguments),this.type="html",this.renderInstance=ik}readValueFromInstance(t,r){var o;if(Fh.has(r))return(o=this.projection)!=null&&o.isProjecting?$x(r):VF(t,r);{const s=RO(t),l=(yM(r)?s.getPropertyValue(r):s[r])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(t,{transformPagePoint:r}){return sk(t,r)}build(t,r,o){pv(t,r,o.transformTemplate)}scrapeMotionValuesFromProps(t,r,o){return mv(t,r,o)}}const jO={offset:"stroke-dashoffset",array:"stroke-dasharray"},EO={offset:"strokeDashoffset",array:"strokeDasharray"};function TO(e,t,r=1,o=0,s=!0){e.pathLength=1;const l=s?jO:EO;e[l.offset]=`${-o}`,e[l.array]=`${t} ${r}`}const IO=["offsetDistance","offsetPath","offsetRotate","offsetAnchor"];function ck(e,{attrX:t,attrY:r,attrScale:o,pathLength:s,pathSpacing:l=1,pathOffset:i=0,...u},c,d,h){if(pv(e,u,d),c){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:f,style:g}=e;f.transform&&(g.transform=f.transform,delete f.transform),(g.transform||f.transformOrigin)&&(g.transformOrigin=f.transformOrigin??"50% 50%",delete f.transformOrigin),g.transform&&(g.transformBox=(h==null?void 0:h.transformBox)??"fill-box",delete f.transformBox);for(const m of IO)f[m]!==void 0&&(g[m]=f[m],delete f[m]);t!==void 0&&(f.x=t),r!==void 0&&(f.y=r),o!==void 0&&(f.scale=o),s!==void 0&&TO(f,s,l,i,!1)}const dk=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]),uk=e=>typeof e=="string"&&e.toLowerCase()==="svg";function PO(e,t,r,o){ik(e,t,void 0,o);for(const s in t.attrs)e.setAttribute(dk.has(s)?s:iv(s),t.attrs[s])}function hk(e,t,r){const o=mv(e,t,r);for(const s in e)if(Va(e[s])||Va(t[s])){const l=Ph.indexOf(s)!==-1?"attr"+s.charAt(0).toUpperCase()+s.substring(1):s;o[l]=e[s]}return o}class FO extends nk{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=ra}getBaseTargetFromProps(t,r){return t[r]}readValueFromInstance(t,r){if(Fh.has(r)){const o=GM(r);return o&&o.default||0}return r=dk.has(r)?r:iv(r),t.getAttribute(r)}scrapeMotionValuesFromProps(t,r,o){return hk(t,r,o)}build(t,r,o){ck(t,r,this.isSVGTag,o.transformTemplate,o.style)}renderInstance(t,r,o,s){PO(t,r,o,s)}mount(t){this.isSVGTag=uk(t.tagName),super.mount(t)}}const NO=fv.length;function fk(e){if(!e)return;if(!e.isControllingVariants){const r=e.parent?fk(e.parent)||{}:{};return e.props.initial!==void 0&&(r.initial=e.props.initial),r}const t={};for(let r=0;r<NO;r++){const o=fv[r],s=e.props[o];(hp(s)||s===!1)&&(t[o]=s)}return t}function pk(e,t){if(!Array.isArray(t))return!1;const r=t.length;if(r!==e.length)return!1;for(let o=0;o<r;o++)if(t[o]!==e[o])return!1;return!0}const OO=[...hv].reverse(),_O=hv.length;function DO(e){return t=>Promise.all(t.map(({animation:r,options:o})=>FN(e,r,o)))}function LO(e){let t=DO(e),r=B8(),o=!0;const s=c=>(d,h)=>{var g;const f=gh(e,h,c==="exit"?(g=e.presenceContext)==null?void 0:g.custom:void 0);if(f){const{transition:m,transitionEnd:y,...v}=f;d={...d,...v,...y}}return d};function l(c){t=c(e)}function i(c){const{props:d}=e,h=fk(e.parent)||{},f=[],g=new Set;let m={},y=1/0;for(let b=0;b<_O;b++){const S=OO[b],C=r[S],k=d[S]!==void 0?d[S]:h[S],R=hp(k),j=S===c?C.isActive:null;j===!1&&(y=b);let T=k===h[S]&&k!==d[S]&&R;if(T&&o&&e.manuallyAnimateOnMount&&(T=!1),C.protectedKeys={...m},!C.isActive&&j===null||!k&&!C.prevProp||Pg(k)||typeof k=="boolean")continue;if(S==="exit"&&C.isActive&&j!==!0){C.prevResolvedValues&&(m={...m,...C.prevResolvedValues});continue}const _=zO(C.prevProp,k);let P=_||S===c&&C.isActive&&!T&&R||b>y&&R,I=!1;const $=Array.isArray(k)?k:[k];let q=$.reduce(s(S),{});j===!1&&(q={});const{prevResolvedValues:L={}}=C,H={...L,...q},G=pe=>{P=!0,g.has(pe)&&(I=!0,g.delete(pe)),C.needsAnimating[pe]=!0;const ce=e.getValue(pe);ce&&(ce.liveStyle=!1)};for(const pe in H){const ce=q[pe],te=L[pe];if(m.hasOwnProperty(pe))continue;let F=!1;Ux(ce)&&Ux(te)?F=!pk(ce,te):F=ce!==te,F?ce!=null?G(pe):g.add(pe):ce!==void 0&&g.has(pe)?G(pe):C.protectedKeys[pe]=!0}C.prevProp=k,C.prevResolvedValues=q,C.isActive&&(m={...m,...q}),o&&e.blockInitialAnimation&&(P=!1);const oe=T&&_;P&&(!oe||I)&&f.push(...$.map(pe=>{const ce={type:S};if(typeof pe=="string"&&o&&!oe&&e.manuallyAnimateOnMount&&e.parent){const{parent:te}=e,F=gh(te,pe);if(te.enteringChildren&&F){const{delayChildren:Q}=F.transition||{};ce.delay=_M(te.enteringChildren,e,Q)}}return{animation:pe,options:ce}}))}if(g.size){const b={};if(typeof d.initial!="boolean"){const S=gh(e,Array.isArray(d.initial)?d.initial[0]:d.initial);S&&S.transition&&(b.transition=S.transition)}g.forEach(S=>{const C=e.getBaseTarget(S),k=e.getValue(S);k&&(k.liveStyle=!0),b[S]=C??null}),f.push({animation:b})}let v=!!f.length;return o&&(d.initial===!1||d.initial===d.animate)&&!e.manuallyAnimateOnMount&&(v=!1),o=!1,v?t(f):Promise.resolve()}function u(c,d){var f;if(r[c].isActive===d)return Promise.resolve();(f=e.variantChildren)==null||f.forEach(g=>{var m;return(m=g.animationState)==null?void 0:m.setActive(c,d)}),r[c].isActive=d;const h=i(c);for(const g in r)r[g].protectedKeys={};return h}return{animateChanges:i,setActive:u,setAnimateFunction:l,getState:()=>r,reset:()=>{r=B8()}}}function zO(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!pk(t,e):!1}function _0(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function B8(){return{animate:_0(!0),whileInView:_0(),whileHover:_0(),whileTap:_0(),whileDrag:_0(),whileFocus:_0(),exit:_0()}}function $8(e,t){e.min=t.min,e.max=t.max}function Ri(e,t){$8(e.x,t.x),$8(e.y,t.y)}function q8(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}const mk=1e-4,BO=1-mk,$O=1+mk,gk=.01,qO=0-gk,WO=0+gk;function ss(e){return e.max-e.min}function HO(e,t,r){return Math.abs(e-t)<=r}function W8(e,t,r,o=.5){e.origin=o,e.originPoint=Ao(t.min,t.max,e.origin),e.scale=ss(r)/ss(t),e.translate=Ao(r.min,r.max,e.origin)-e.originPoint,(e.scale>=BO&&e.scale<=$O||isNaN(e.scale))&&(e.scale=1),(e.translate>=qO&&e.translate<=WO||isNaN(e.translate))&&(e.translate=0)}function Zf(e,t,r,o){W8(e.x,t.x,r.x,o?o.originX:void 0),W8(e.y,t.y,r.y,o?o.originY:void 0)}function H8(e,t,r){e.min=r.min+t.min,e.max=e.min+ss(t)}function GO(e,t,r){H8(e.x,t.x,r.x),H8(e.y,t.y,r.y)}function G8(e,t,r){e.min=t.min-r.min,e.max=e.min+ss(t)}function rg(e,t,r){G8(e.x,t.x,r.x),G8(e.y,t.y,r.y)}function V8(e,t,r,o,s){return e-=t,e=ng(e,1/r,o),s!==void 0&&(e=ng(e,1/s,o)),e}function VO(e,t=0,r=1,o=.5,s,l=e,i=e){if(Sl.test(t)&&(t=parseFloat(t),t=Ao(i.min,i.max,t/100)-i.min),typeof t!="number")return;let u=Ao(l.min,l.max,o);e===l&&(u-=t),e.min=V8(e.min,t,r,u,s),e.max=V8(e.max,t,r,u,s)}function U8(e,t,[r,o,s],l,i){VO(e,t[r],t[o],t[s],t.scale,l,i)}const UO=["x","scaleX","originX"],YO=["y","scaleY","originY"];function Y8(e,t,r,o){U8(e.x,t,UO,r?r.x:void 0,o?o.x:void 0),U8(e.y,t,YO,r?r.y:void 0,o?o.y:void 0)}function K8(e){return e.translate===0&&e.scale===1}function yk(e){return K8(e.x)&&K8(e.y)}function X8(e,t){return e.min===t.min&&e.max===t.max}function KO(e,t){return X8(e.x,t.x)&&X8(e.y,t.y)}function Z8(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function xk(e,t){return Z8(e.x,t.x)&&Z8(e.y,t.y)}function J8(e){return ss(e.x)/ss(e.y)}function Q8(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}function ml(e){return[e("x"),e("y")]}function XO(e,t,r){let o="";const s=e.x.translate/t.x,l=e.y.translate/t.y,i=(r==null?void 0:r.z)||0;if((s||l||i)&&(o=`translate3d(${s}px, ${l}px, ${i}px) `),(t.x!==1||t.y!==1)&&(o+=`scale(${1/t.x}, ${1/t.y}) `),r){const{transformPerspective:d,rotate:h,rotateX:f,rotateY:g,skewX:m,skewY:y}=r;d&&(o=`perspective(${d}px) ${o}`),h&&(o+=`rotate(${h}deg) `),f&&(o+=`rotateX(${f}deg) `),g&&(o+=`rotateY(${g}deg) `),m&&(o+=`skewX(${m}deg) `),y&&(o+=`skewY(${y}deg) `)}const u=e.x.scale*t.x,c=e.y.scale*t.y;return(u!==1||c!==1)&&(o+=`scale(${u}, ${c})`),o||"none"}const bk=["TopLeft","TopRight","BottomLeft","BottomRight"],ZO=bk.length,e6=e=>typeof e=="string"?parseFloat(e):e,t6=e=>typeof e=="number"||Fn.test(e);function JO(e,t,r,o,s,l){s?(e.opacity=Ao(0,r.opacity??1,QO(o)),e.opacityExit=Ao(t.opacity??1,0,e_(o))):l&&(e.opacity=Ao(t.opacity??1,r.opacity??1,o));for(let i=0;i<ZO;i++){const u=`border${bk[i]}Radius`;let c=n6(t,u),d=n6(r,u);if(c===void 0&&d===void 0)continue;c||(c=0),d||(d=0),c===0||d===0||t6(c)===t6(d)?(e[u]=Math.max(Ao(e6(c),e6(d),o),0),(Sl.test(d)||Sl.test(c))&&(e[u]+="%")):e[u]=d}(t.rotate||r.rotate)&&(e.rotate=Ao(t.rotate||0,r.rotate||0,o))}function n6(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const QO=vk(0,.5,uM),e_=vk(.5,.95,hi);function vk(e,t,r){return o=>o<e?0:o>t?1:r(cp(e,t,o))}function t_(e,t,r){const o=Va(e)?e:Mh(e);return o.start(av("",o,t,r)),o.animation}function fp(e,t,r,o={passive:!0}){return e.addEventListener(t,r,o),()=>e.removeEventListener(t,r)}const n_=(e,t)=>e.depth-t.depth;class r_{constructor(){this.children=[],this.isDirty=!1}add(t){Hb(this.children,t),this.isDirty=!0}remove(t){Z5(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(n_),this.isDirty=!1,this.children.forEach(t)}}function o_(e,t){const r=as.now(),o=({timestamp:s})=>{const l=s-r;l>=t&&(a0(o),e(l-t))};return no.setup(o,!0),()=>a0(o)}function _5(e){return Va(e)?e.get():e}class a_{constructor(){this.members=[]}add(t){Hb(this.members,t);for(let r=this.members.length-1;r>=0;r--){const o=this.members[r];if(o===t||o===this.lead||o===this.prevLead)continue;const s=o.instance;s&&s.isConnected===!1&&o.isPresent!==!1&&!o.snapshot&&Z5(this.members,o)}t.scheduleRender()}remove(t){if(Z5(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const r=this.members[this.members.length-1];r&&this.promote(r)}}relegate(t){const r=this.members.findIndex(s=>t===s);if(r===0)return!1;let o;for(let s=r;s>=0;s--){const l=this.members[s],i=l.instance;if(l.isPresent!==!1&&(!i||i.isConnected!==!1)){o=l;break}}return o?(this.promote(o),!0):!1}promote(t,r){const o=this.lead;if(t!==o&&(this.prevLead=o,this.lead=t,t.show(),o)){o.instance&&o.scheduleRender(),t.scheduleRender();const s=o.options.layoutDependency,l=t.options.layoutDependency;if(!(s!==void 0&&l!==void 0&&s===l)){const c=o.instance;c&&c.isConnected===!1&&!o.snapshot||(t.resumeFrom=o,r&&(t.resumeFrom.preserveOpacity=!0),o.snapshot&&(t.snapshot=o.snapshot,t.snapshot.latestValues=o.animationValues||o.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0))}const{crossfade:u}=t.options;u===!1&&o.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:r,resumingFrom:o}=t;r.onExitComplete&&r.onExitComplete(),o&&o.options.onExitComplete&&o.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const D5={hasAnimatedSinceResize:!0,hasEverUpdated:!1},R2=["","X","Y","Z"],s_=1e3;let i_=0;function A2(e,t,r,o){const{latestValues:s}=t;s[e]&&(r[e]=s[e],t.setStaticValue(e,0),o&&(o[e]=0))}function Sk(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const r=$M(t);if(window.MotionHasOptimisedAnimation(r,"transform")){const{layout:s,layoutId:l}=e.options;window.MotionCancelOptimisedAnimation(r,"transform",no,!(s||l))}const{parent:o}=e;o&&!o.hasCheckedOptimisedAppear&&Sk(o)}function wk({attachResizeListener:e,defaultParent:t,measureScroll:r,checkIsScrollRoot:o,resetTransform:s}){return class{constructor(i={},u=t==null?void 0:t()){this.id=i_++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(d_),this.nodes.forEach(p_),this.nodes.forEach(m_),this.nodes.forEach(u_)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=i,this.root=u?u.root||u:this,this.path=u?[...u.path,u]:[],this.parent=u,this.depth=u?u.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new r_)}addEventListener(i,u){return this.eventHandlers.has(i)||this.eventHandlers.set(i,new Vb),this.eventHandlers.get(i).add(u)}notifyListeners(i,...u){const c=this.eventHandlers.get(i);c&&c.notify(...u)}hasListeners(i){return this.eventHandlers.has(i)}mount(i){if(this.instance)return;this.isSVG=uv(i)&&!cO(i),this.instance=i;const{layoutId:u,layout:c,visualElement:d}=this.options;if(d&&!d.current&&d.mount(i),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(c||u)&&(this.isLayoutDirty=!0),e){let h,f=0;const g=()=>this.root.updateBlockedByResize=!1;no.read(()=>{f=window.innerWidth}),e(i,()=>{const m=window.innerWidth;m!==f&&(f=m,this.root.updateBlockedByResize=!0,h&&h(),h=o_(g,250),D5.hasAnimatedSinceResize&&(D5.hasAnimatedSinceResize=!1,this.nodes.forEach(a6)))})}u&&this.root.registerSharedNode(u,this),this.options.animate!==!1&&d&&(u||c)&&this.addEventListener("didUpdate",({delta:h,hasLayoutChanged:f,hasRelativeLayoutChanged:g,layout:m})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const y=this.options.transition||d.getDefaultTransition()||v_,{onLayoutAnimationStart:v,onLayoutAnimationComplete:b}=d.getProps(),S=!this.targetLayout||!xk(this.targetLayout,m),C=!f&&g;if(this.options.layoutRoot||this.resumeFrom||C||f&&(S||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const k={...ov(y,"layout"),onPlay:v,onComplete:b};(d.shouldReduceMotion||this.options.layoutRoot)&&(k.delay=0,k.type=!1),this.startAnimation(k),this.setAnimationOrigin(h,C)}else f||a6(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=m})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const i=this.getStack();i&&i.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),a0(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(g_),this.animationId++)}getTransformTemplate(){const{visualElement:i}=this.options;return i&&i.getProps().transformTemplate}willUpdate(i=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Sk(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let h=0;h<this.path.length;h++){const f=this.path[h];f.shouldResetTransform=!0,f.updateScroll("snapshot"),f.options.layoutRoot&&f.willUpdate(!1)}const{layoutId:u,layout:c}=this.options;if(u===void 0&&!c)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),i&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(r6);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(o6);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(f_),this.nodes.forEach(l_),this.nodes.forEach(c_)):this.nodes.forEach(o6),this.clearAllSnapshots();const u=as.now();Ta.delta=Cl(0,1e3/60,u-Ta.timestamp),Ta.timestamp=u,Ta.isProcessing=!0,x2.update.process(Ta),x2.preRender.process(Ta),x2.render.process(Ta),Ta.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,cv.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(h_),this.sharedNodes.forEach(y_)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,no.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){no.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!ss(this.snapshot.measuredBox.x)&&!ss(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const i=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=ra(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:u}=this.options;u&&u.notify("LayoutMeasure",this.layout.layoutBox,i?i.layoutBox:void 0)}updateScroll(i="measure"){let u=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===i&&(u=!1),u&&this.instance){const c=o(this.instance);this.scroll={animationId:this.root.animationId,phase:i,isRoot:c,offset:r(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!s)return;const i=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,u=this.projectionDelta&&!yk(this.projectionDelta),c=this.getTransformTemplate(),d=c?c(this.latestValues,""):void 0,h=d!==this.prevTransformTemplateValue;i&&this.instance&&(u||id(this.latestValues)||h)&&(s(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(i=!0){const u=this.measurePageBox();let c=this.removeElementScroll(u);return i&&(c=this.removeTransform(c)),S_(c),{animationId:this.root.animationId,measuredBox:u,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){var d;const{visualElement:i}=this.options;if(!i)return ra();const u=i.measureViewportBox();if(!(((d=this.scroll)==null?void 0:d.wasRoot)||this.path.some(w_))){const{scroll:h}=this.root;h&&(sh(u.x,h.offset.x),sh(u.y,h.offset.y))}return u}removeElementScroll(i){var c;const u=ra();if(Ri(u,i),(c=this.scroll)!=null&&c.wasRoot)return u;for(let d=0;d<this.path.length;d++){const h=this.path[d],{scroll:f,options:g}=h;h!==this.root&&f&&g.layoutScroll&&(f.wasRoot&&Ri(u,i),sh(u.x,f.offset.x),sh(u.y,f.offset.y))}return u}applyTransform(i,u=!1){const c=ra();Ri(c,i);for(let d=0;d<this.path.length;d++){const h=this.path[d];!u&&h.options.layoutScroll&&h.scroll&&h!==h.root&&ih(c,{x:-h.scroll.offset.x,y:-h.scroll.offset.y}),id(h.latestValues)&&ih(c,h.latestValues)}return id(this.latestValues)&&ih(c,this.latestValues),c}removeTransform(i){const u=ra();Ri(u,i);for(let c=0;c<this.path.length;c++){const d=this.path[c];if(!d.instance||!id(d.latestValues))continue;eb(d.latestValues)&&d.updateSnapshot();const h=ra(),f=d.measurePageBox();Ri(h,f),Y8(u,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,h)}return id(this.latestValues)&&Y8(u,this.latestValues),u}setTargetDelta(i){this.targetDelta=i,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(i){this.options={...this.options,...i,crossfade:i.crossfade!==void 0?i.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ta.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(i=!1){var m;const u=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=u.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=u.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=u.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==u;if(!(i||c&&this.isSharedProjectionDirty||this.isProjectionDirty||(m=this.parent)!=null&&m.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:h,layoutId:f}=this.options;if(!this.layout||!(h||f))return;this.resolvedRelativeTargetAt=Ta.timestamp;const g=this.getClosestProjectingParent();g&&this.linkedParentVersion!==g.layoutVersion&&!g.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(g&&g.layout?this.createRelativeTarget(g,this.layout.layoutBox,g.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=ra(),this.targetWithTransforms=ra()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),GO(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Ri(this.target,this.layout.layoutBox),ak(this.target,this.targetDelta)):Ri(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,g&&!!g.resumingFrom==!!this.resumingFrom&&!g.options.layoutScroll&&g.target&&this.animationProgress!==1?this.createRelativeTarget(g,this.target,g.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||eb(this.parent.latestValues)||ok(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(i,u,c){this.relativeParent=i,this.linkedParentVersion=i.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ra(),this.relativeTargetOrigin=ra(),rg(this.relativeTargetOrigin,u,c),Ri(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){var y;const i=this.getLead(),u=!!this.resumingFrom||this!==i;let c=!0;if((this.isProjectionDirty||(y=this.parent)!=null&&y.isProjectionDirty)&&(c=!1),u&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===Ta.timestamp&&(c=!1),c)return;const{layout:d,layoutId:h}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(d||h))return;Ri(this.layoutCorrected,this.layout.layoutBox);const f=this.treeScale.x,g=this.treeScale.y;vO(this.layoutCorrected,this.treeScale,this.path,u),i.layout&&!i.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(i.target=i.layout.layoutBox,i.targetWithTransforms=ra());const{target:m}=i;if(!m){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(q8(this.prevProjectionDelta.x,this.projectionDelta.x),q8(this.prevProjectionDelta.y,this.projectionDelta.y)),Zf(this.projectionDelta,this.layoutCorrected,m,this.latestValues),(this.treeScale.x!==f||this.treeScale.y!==g||!Q8(this.projectionDelta.x,this.prevProjectionDelta.x)||!Q8(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",m))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(i=!0){var u;if((u=this.options.visualElement)==null||u.scheduleRender(),i){const c=this.getStack();c&&c.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=ah(),this.projectionDelta=ah(),this.projectionDeltaWithTransform=ah()}setAnimationOrigin(i,u=!1){const c=this.snapshot,d=c?c.latestValues:{},h={...this.latestValues},f=ah();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!u;const g=ra(),m=c?c.source:void 0,y=this.layout?this.layout.source:void 0,v=m!==y,b=this.getStack(),S=!b||b.members.length<=1,C=!!(v&&!S&&this.options.crossfade===!0&&!this.path.some(b_));this.animationProgress=0;let k;this.mixTargetDelta=R=>{const j=R/1e3;s6(f.x,i.x,j),s6(f.y,i.y,j),this.setTargetDelta(f),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(rg(g,this.layout.layoutBox,this.relativeParent.layout.layoutBox),x_(this.relativeTarget,this.relativeTargetOrigin,g,j),k&&KO(this.relativeTarget,k)&&(this.isProjectionDirty=!1),k||(k=ra()),Ri(k,this.relativeTarget)),v&&(this.animationValues=h,JO(h,d,this.latestValues,j,C,S)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=j},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(i){var u,c,d;this.notifyListeners("animationStart"),(u=this.currentAnimation)==null||u.stop(),(d=(c=this.resumingFrom)==null?void 0:c.currentAnimation)==null||d.stop(),this.pendingAnimation&&(a0(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=no.update(()=>{D5.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=Mh(0)),this.motionValue.jump(0,!1),this.currentAnimation=t_(this.motionValue,[0,1e3],{...i,velocity:0,isSync:!0,onUpdate:h=>{this.mixTargetDelta(h),i.onUpdate&&i.onUpdate(h)},onStop:()=>{},onComplete:()=>{i.onComplete&&i.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const i=this.getStack();i&&i.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(s_),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const i=this.getLead();let{targetWithTransforms:u,target:c,layout:d,latestValues:h}=i;if(!(!u||!c||!d)){if(this!==i&&this.layout&&d&&Ck(this.options.animationType,this.layout.layoutBox,d.layoutBox)){c=this.target||ra();const f=ss(this.layout.layoutBox.x);c.x.min=i.target.x.min,c.x.max=c.x.min+f;const g=ss(this.layout.layoutBox.y);c.y.min=i.target.y.min,c.y.max=c.y.min+g}Ri(u,c),ih(u,h),Zf(this.projectionDeltaWithTransform,this.layoutCorrected,u,h)}}registerSharedNode(i,u){this.sharedNodes.has(i)||this.sharedNodes.set(i,new a_),this.sharedNodes.get(i).add(u);const d=u.options.initialPromotionConfig;u.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(u):void 0})}isLead(){const i=this.getStack();return i?i.lead===this:!0}getLead(){var u;const{layoutId:i}=this.options;return i?((u=this.getStack())==null?void 0:u.lead)||this:this}getPrevLead(){var u;const{layoutId:i}=this.options;return i?(u=this.getStack())==null?void 0:u.prevLead:void 0}getStack(){const{layoutId:i}=this.options;if(i)return this.root.sharedNodes.get(i)}promote({needsReset:i,transition:u,preserveFollowOpacity:c}={}){const d=this.getStack();d&&d.promote(this,c),i&&(this.projectionDelta=void 0,this.needsReset=!0),u&&this.setOptions({transition:u})}relegate(){const i=this.getStack();return i?i.relegate(this):!1}resetSkewAndRotation(){const{visualElement:i}=this.options;if(!i)return;let u=!1;const{latestValues:c}=i;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(u=!0),!u)return;const d={};c.z&&A2("z",i,d,this.animationValues);for(let h=0;h<R2.length;h++)A2(`rotate${R2[h]}`,i,d,this.animationValues),A2(`skew${R2[h]}`,i,d,this.animationValues);i.render();for(const h in d)i.setStaticValue(h,d[h]),this.animationValues&&(this.animationValues[h]=d[h]);i.scheduleRender()}applyProjectionStyles(i,u){if(!this.instance||this.isSVG)return;if(!this.isVisible){i.visibility="hidden";return}const c=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,i.visibility="",i.opacity="",i.pointerEvents=_5(u==null?void 0:u.pointerEvents)||"",i.transform=c?c(this.latestValues,""):"none";return}const d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){this.options.layoutId&&(i.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,i.pointerEvents=_5(u==null?void 0:u.pointerEvents)||""),this.hasProjected&&!id(this.latestValues)&&(i.transform=c?c({},""):"none",this.hasProjected=!1);return}i.visibility="";const h=d.animationValues||d.latestValues;this.applyTransformsToTarget();let f=XO(this.projectionDeltaWithTransform,this.treeScale,h);c&&(f=c(h,f)),i.transform=f;const{x:g,y:m}=this.projectionDelta;i.transformOrigin=`${g.origin*100}% ${m.origin*100}% 0`,d.animationValues?i.opacity=d===this?h.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:h.opacityExit:i.opacity=d===this?h.opacity!==void 0?h.opacity:"":h.opacityExit!==void 0?h.opacityExit:0;for(const y in nb){if(h[y]===void 0)continue;const{correct:v,applyTo:b,isCSSVariable:S}=nb[y],C=f==="none"?h[y]:v(h[y],d);if(b){const k=b.length;for(let R=0;R<k;R++)i[b[R]]=C}else S?this.options.visualElement.renderState.vars[y]=C:i[y]=C}this.options.layoutId&&(i.pointerEvents=d===this?_5(u==null?void 0:u.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(i=>{var u;return(u=i.currentAnimation)==null?void 0:u.stop()}),this.root.nodes.forEach(r6),this.root.sharedNodes.clear()}}}function l_(e){e.updateLayout()}function c_(e){var r;const t=((r=e.resumeFrom)==null?void 0:r.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){const{layoutBox:o,measuredBox:s}=e.layout,{animationType:l}=e.options,i=t.source!==e.layout.source;l==="size"?ml(f=>{const g=i?t.measuredBox[f]:t.layoutBox[f],m=ss(g);g.min=o[f].min,g.max=g.min+m}):Ck(l,t.layoutBox,o)&&ml(f=>{const g=i?t.measuredBox[f]:t.layoutBox[f],m=ss(o[f]);g.max=g.min+m,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[f].max=e.relativeTarget[f].min+m)});const u=ah();Zf(u,o,t.layoutBox);const c=ah();i?Zf(c,e.applyTransform(s,!0),t.measuredBox):Zf(c,o,t.layoutBox);const d=!yk(u);let h=!1;if(!e.resumeFrom){const f=e.getClosestProjectingParent();if(f&&!f.resumeFrom){const{snapshot:g,layout:m}=f;if(g&&m){const y=ra();rg(y,t.layoutBox,g.layoutBox);const v=ra();rg(v,o,m.layoutBox),xk(y,v)||(h=!0),f.options.layoutRoot&&(e.relativeTarget=v,e.relativeTargetOrigin=y,e.relativeParent=f)}}}e.notifyListeners("didUpdate",{layout:o,snapshot:t,delta:c,layoutDelta:u,hasLayoutChanged:d,hasRelativeLayoutChanged:h})}else if(e.isLead()){const{onExitComplete:o}=e.options;o&&o()}e.options.transition=void 0}function d_(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function u_(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function h_(e){e.clearSnapshot()}function r6(e){e.clearMeasurements()}function o6(e){e.isLayoutDirty=!1}function f_(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function a6(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function p_(e){e.resolveTargetDelta()}function m_(e){e.calcProjection()}function g_(e){e.resetSkewAndRotation()}function y_(e){e.removeLeadSnapshot()}function s6(e,t,r){e.translate=Ao(t.translate,0,r),e.scale=Ao(t.scale,1,r),e.origin=t.origin,e.originPoint=t.originPoint}function i6(e,t,r,o){e.min=Ao(t.min,r.min,o),e.max=Ao(t.max,r.max,o)}function x_(e,t,r,o){i6(e.x,t.x,r.x,o),i6(e.y,t.y,r.y,o)}function b_(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const v_={duration:.45,ease:[.4,0,.1,1]},l6=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),c6=l6("applewebkit/")&&!l6("chrome/")?Math.round:hi;function d6(e){e.min=c6(e.min),e.max=c6(e.max)}function S_(e){d6(e.x),d6(e.y)}function Ck(e,t,r){return e==="position"||e==="preserve-aspect"&&!HO(J8(t),J8(r),.2)}function w_(e){var t;return e!==e.root&&((t=e.scroll)==null?void 0:t.wasRoot)}const C_=wk({attachResizeListener:(e,t)=>fp(e,"resize",t),measureScroll:()=>{var e,t;return{x:document.documentElement.scrollLeft||((e=document.body)==null?void 0:e.scrollLeft)||0,y:document.documentElement.scrollTop||((t=document.body)==null?void 0:t.scrollTop)||0}},checkIsScrollRoot:()=>!0}),j2={current:void 0},Mk=wk({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!j2.current){const e=new C_({});e.mount(window),e.setOptions({layoutScroll:!0}),j2.current=e}return j2.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),gv=w.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});function u6(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function M_(...e){return t=>{let r=!1;const o=e.map(s=>{const l=u6(s,t);return!r&&typeof l=="function"&&(r=!0),l});if(r)return()=>{for(let s=0;s<o.length;s++){const l=o[s];typeof l=="function"?l():u6(e[s],null)}}}}function k_(...e){return w.useCallback(M_(...e),e)}class R_ extends w.Component{getSnapshotBeforeUpdate(t){const r=this.props.childRef.current;if(r&&t.isPresent&&!this.props.isPresent&&this.props.pop!==!1){const o=r.offsetParent,s=Jx(o)&&o.offsetWidth||0,l=Jx(o)&&o.offsetHeight||0,i=this.props.sizeRef.current;i.height=r.offsetHeight||0,i.width=r.offsetWidth||0,i.top=r.offsetTop,i.left=r.offsetLeft,i.right=s-i.width-i.left,i.bottom=l-i.height-i.top}return null}componentDidUpdate(){}render(){return this.props.children}}function A_({children:e,isPresent:t,anchorX:r,anchorY:o,root:s,pop:l}){var g;const i=w.useId(),u=w.useRef(null),c=w.useRef({width:0,height:0,top:0,left:0,right:0,bottom:0}),{nonce:d}=w.useContext(gv),h=((g=e.props)==null?void 0:g.ref)??(e==null?void 0:e.ref),f=k_(u,h);return w.useInsertionEffect(()=>{const{width:m,height:y,top:v,left:b,right:S,bottom:C}=c.current;if(t||l===!1||!u.current||!m||!y)return;const k=r==="left"?`left: ${b}`:`right: ${S}`,R=o==="bottom"?`bottom: ${C}`:`top: ${v}`;u.current.dataset.motionPopId=i;const j=document.createElement("style");d&&(j.nonce=d);const T=s??document.head;return T.appendChild(j),j.sheet&&j.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${m}px !important;
            height: ${y}px !important;
            ${k}px !important;
            ${R}px !important;
          }
        `),()=>{T.contains(j)&&T.removeChild(j)}},[t]),a.jsx(R_,{isPresent:t,childRef:u,sizeRef:c,pop:l,children:l===!1?e:w.cloneElement(e,{ref:f})})}const j_=({children:e,initial:t,isPresent:r,onExitComplete:o,custom:s,presenceAffectsLayout:l,mode:i,anchorX:u,anchorY:c,root:d})=>{const h=Wb(E_),f=w.useId();let g=!0,m=w.useMemo(()=>(g=!1,{id:f,initial:t,isPresent:r,custom:s,onExitComplete:y=>{h.set(y,!0);for(const v of h.values())if(!v)return;o&&o()},register:y=>(h.set(y,!1),()=>h.delete(y))}),[r,h,o]);return l&&g&&(m={...m}),w.useMemo(()=>{h.forEach((y,v)=>h.set(v,!1))},[r]),w.useEffect(()=>{!r&&!h.size&&o&&o()},[r]),e=a.jsx(A_,{pop:i==="popLayout",isPresent:r,anchorX:u,anchorY:c,root:d,children:e}),a.jsx(Ig.Provider,{value:m,children:e})};function E_(){return new Map}function kk(e=!0){const t=w.useContext(Ig);if(t===null)return[!0,null];const{isPresent:r,onExitComplete:o,register:s}=t,l=w.useId();w.useEffect(()=>{if(e)return s(l)},[e]);const i=w.useCallback(()=>e&&o&&o(l),[l,o,e]);return!r&&o?[!1,i]:[!0]}const $m=e=>e.key||"";function h6(e){const t=[];return w.Children.forEach(e,r=>{w.isValidElement(r)&&t.push(r)}),t}const Xc=({children:e,custom:t,initial:r=!0,onExitComplete:o,presenceAffectsLayout:s=!0,mode:l="sync",propagate:i=!1,anchorX:u="left",anchorY:c="top",root:d})=>{const[h,f]=kk(i),g=w.useMemo(()=>h6(e),[e]),m=i&&!h?[]:g.map($m),y=w.useRef(!0),v=w.useRef(g),b=Wb(()=>new Map),S=w.useRef(new Set),[C,k]=w.useState(g),[R,j]=w.useState(g);QC(()=>{y.current=!1,v.current=g;for(let P=0;P<R.length;P++){const I=$m(R[P]);m.includes(I)?(b.delete(I),S.current.delete(I)):b.get(I)!==!0&&b.set(I,!1)}},[R,m.length,m.join("-")]);const T=[];if(g!==C){let P=[...g];for(let I=0;I<R.length;I++){const $=R[I],q=$m($);m.includes(q)||(P.splice(I,0,$),T.push($))}return l==="wait"&&T.length&&(P=T),j(h6(P)),k(g),null}const{forceRender:_}=w.useContext(qb);return a.jsx(a.Fragment,{children:R.map(P=>{const I=$m(P),$=i&&!h?!1:g===R||m.includes(I),q=()=>{if(S.current.has(I))return;if(S.current.add(I),b.has(I))b.set(I,!0);else return;let L=!0;b.forEach(H=>{H||(L=!1)}),L&&(_==null||_(),j(v.current),i&&(f==null||f()),o&&o())};return a.jsx(j_,{isPresent:$,initial:!y.current||r?void 0:!1,custom:t,presenceAffectsLayout:s,mode:l,root:d,onExitComplete:$?void 0:q,anchorX:u,anchorY:c,children:P},I)})})},Rk=w.createContext({strict:!1}),f6={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]};let p6=!1;function T_(){if(p6)return;const e={};for(const t in f6)e[t]={isEnabled:r=>f6[t].some(o=>!!r[o])};tk(e),p6=!0}function Ak(){return T_(),gO()}function I_(e){const t=Ak();for(const r in e)t[r]={...t[r],...e[r]};tk(t)}const P_=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","propagate","ignoreStrict","viewport"]);function og(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||P_.has(e)}let jk=e=>!og(e);function F_(e){typeof e=="function"&&(jk=t=>t.startsWith("on")?!og(t):e(t))}try{F_(require("@emotion/is-prop-valid").default)}catch{}function N_(e,t,r){const o={};for(const s in e)s==="values"&&typeof e.values=="object"||(jk(s)||r===!0&&og(s)||!t&&!og(s)||e.draggable&&s.startsWith("onDrag"))&&(o[s]=e[s]);return o}const Ng=w.createContext({});function O_(e,t){if(Fg(e)){const{initial:r,animate:o}=e;return{initial:r===!1||hp(r)?r:void 0,animate:hp(o)?o:void 0}}return e.inherit!==!1?t:{}}function __(e){const{initial:t,animate:r}=O_(e,w.useContext(Ng));return w.useMemo(()=>({initial:t,animate:r}),[m6(t),m6(r)])}function m6(e){return Array.isArray(e)?e.join(" "):e}const yv=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function Ek(e,t,r){for(const o in t)!Va(t[o])&&!lk(o,r)&&(e[o]=t[o])}function D_({transformTemplate:e},t){return w.useMemo(()=>{const r=yv();return pv(r,t,e),Object.assign({},r.vars,r.style)},[t])}function L_(e,t){const r=e.style||{},o={};return Ek(o,r,e),Object.assign(o,D_(e,t)),o}function z_(e,t){const r={},o=L_(e,t);return e.drag&&e.dragListener!==!1&&(r.draggable=!1,o.userSelect=o.WebkitUserSelect=o.WebkitTouchCallout="none",o.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(r.tabIndex=0),r.style=o,r}const Tk=()=>({...yv(),attrs:{}});function B_(e,t,r,o){const s=w.useMemo(()=>{const l=Tk();return ck(l,t,uk(o),e.transformTemplate,e.style),{...l.attrs,style:{...l.style}}},[t]);if(e.style){const l={};Ek(l,e.style,e),s.style={...l,...s.style}}return s}const $_=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function xv(e){return typeof e!="string"||e.includes("-")?!1:!!($_.indexOf(e)>-1||/[A-Z]/u.test(e))}function q_(e,t,r,{latestValues:o},s,l=!1,i){const c=(i??xv(e)?B_:z_)(t,o,s,e),d=N_(t,typeof e=="string",l),h=e!==w.Fragment?{...d,...c,ref:r}:{},{children:f}=t,g=w.useMemo(()=>Va(f)?f.get():f,[f]);return w.createElement(e,{...h,children:g})}function W_({scrapeMotionValuesFromProps:e,createRenderState:t},r,o,s){return{latestValues:H_(r,o,s,e),renderState:t()}}function H_(e,t,r,o){const s={},l=o(e,{});for(const g in l)s[g]=_5(l[g]);let{initial:i,animate:u}=e;const c=Fg(e),d=QM(e);t&&d&&!c&&e.inherit!==!1&&(i===void 0&&(i=t.initial),u===void 0&&(u=t.animate));let h=r?r.initial===!1:!1;h=h||i===!1;const f=h?u:i;if(f&&typeof f!="boolean"&&!Pg(f)){const g=Array.isArray(f)?f:[f];for(let m=0;m<g.length;m++){const y=sv(e,g[m]);if(y){const{transitionEnd:v,transition:b,...S}=y;for(const C in S){let k=S[C];if(Array.isArray(k)){const R=h?k.length-1:0;k=k[R]}k!==null&&(s[C]=k)}for(const C in v)s[C]=v[C]}}}return s}const Ik=e=>(t,r)=>{const o=w.useContext(Ng),s=w.useContext(Ig),l=()=>W_(e,t,o,s);return r?l():Wb(l)},G_=Ik({scrapeMotionValuesFromProps:mv,createRenderState:yv}),V_=Ik({scrapeMotionValuesFromProps:hk,createRenderState:Tk}),U_=Symbol.for("motionComponentSymbol");function Y_(e,t,r){const o=w.useRef(r);w.useInsertionEffect(()=>{o.current=r});const s=w.useRef(null);return w.useCallback(l=>{var u;l&&((u=e.onMount)==null||u.call(e,l)),t&&(l?t.mount(l):t.unmount());const i=o.current;if(typeof i=="function")if(l){const c=i(l);typeof c=="function"&&(s.current=c)}else s.current?(s.current(),s.current=null):i(l);else i&&(i.current=l)},[t])}const Pk=w.createContext({});function Gu(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function K_(e,t,r,o,s,l){var k,R;const{visualElement:i}=w.useContext(Ng),u=w.useContext(Rk),c=w.useContext(Ig),d=w.useContext(gv),h=d.reducedMotion,f=d.skipAnimations,g=w.useRef(null),m=w.useRef(!1);o=o||u.renderer,!g.current&&o&&(g.current=o(e,{visualState:t,parent:i,props:r,presenceContext:c,blockInitialAnimation:c?c.initial===!1:!1,reducedMotionConfig:h,skipAnimations:f,isSVG:l}),m.current&&g.current&&(g.current.manuallyAnimateOnMount=!0));const y=g.current,v=w.useContext(Pk);y&&!y.projection&&s&&(y.type==="html"||y.type==="svg")&&X_(g.current,r,s,v);const b=w.useRef(!1);w.useInsertionEffect(()=>{y&&b.current&&y.update(r,c)});const S=r[BM],C=w.useRef(!!S&&!((k=window.MotionHandoffIsComplete)!=null&&k.call(window,S))&&((R=window.MotionHasOptimisedAnimation)==null?void 0:R.call(window,S)));return QC(()=>{m.current=!0,y&&(b.current=!0,window.MotionIsMounted=!0,y.updateFeatures(),y.scheduleRenderMicrotask(),C.current&&y.animationState&&y.animationState.animateChanges())}),w.useEffect(()=>{y&&(!C.current&&y.animationState&&y.animationState.animateChanges(),C.current&&(queueMicrotask(()=>{var j;(j=window.MotionHandoffMarkAsComplete)==null||j.call(window,S)}),C.current=!1),y.enteringChildren=void 0)}),y}function X_(e,t,r,o){const{layoutId:s,layout:l,drag:i,dragConstraints:u,layoutScroll:c,layoutRoot:d,layoutCrossfade:h}=t;e.projection=new r(e.latestValues,t["data-framer-portal-id"]?void 0:Fk(e.parent)),e.projection.setOptions({layoutId:s,layout:l,alwaysMeasureLayout:!!i||u&&Gu(u),visualElement:e,animationType:typeof l=="string"?l:"both",initialPromotionConfig:o,crossfade:h,layoutScroll:c,layoutRoot:d})}function Fk(e){if(e)return e.options.allowProjection!==!1?e.projection:Fk(e.parent)}function E2(e,{forwardMotionProps:t=!1,type:r}={},o,s){o&&I_(o);const l=r?r==="svg":xv(e),i=l?V_:G_;function u(d,h){let f;const g={...w.useContext(gv),...d,layoutId:Z_(d)},{isStatic:m}=g,y=__(d),v=i(d,m);if(!m&&JC){J_();const b=Q_(g);f=b.MeasureLayout,y.visualElement=K_(e,v,g,s,b.ProjectionNode,l)}return a.jsxs(Ng.Provider,{value:y,children:[f&&y.visualElement?a.jsx(f,{visualElement:y.visualElement,...g}):null,q_(e,d,Y_(v,y.visualElement,h),v,m,t,l)]})}u.displayName=`motion.${typeof e=="string"?e:`create(${e.displayName??e.name??""})`}`;const c=w.forwardRef(u);return c[U_]=e,c}function Z_({layoutId:e}){const t=w.useContext(qb).id;return t&&e!==void 0?t+"-"+e:e}function J_(e,t){w.useContext(Rk).strict}function Q_(e){const t=Ak(),{drag:r,layout:o}=t;if(!r&&!o)return{};const s={...r,...o};return{MeasureLayout:r!=null&&r.isEnabled(e)||o!=null&&o.isEnabled(e)?s.MeasureLayout:void 0,ProjectionNode:s.ProjectionNode}}function eD(e,t){if(typeof Proxy>"u")return E2;const r=new Map,o=(l,i)=>E2(l,i,e,t),s=(l,i)=>o(l,i);return new Proxy(s,{get:(l,i)=>i==="create"?o:(r.has(i)||r.set(i,E2(i,void 0,e,t)),r.get(i))})}const tD=(e,t)=>t.isSVG??xv(e)?new FO(t):new AO(t,{allowProjection:e!==w.Fragment});class nD extends i0{constructor(t){super(t),t.animationState||(t.animationState=LO(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();Pg(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:r}=this.node.prevProps||{};t!==r&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)==null||t.call(this)}}let rD=0;class oD extends i0{constructor(){super(...arguments),this.id=rD++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:r}=this.node.presenceContext,{isPresent:o}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===o)return;const s=this.node.animationState.setActive("exit",!t);r&&!t&&s.then(()=>{r(this.id)})}mount(){const{register:t,onExitComplete:r}=this.node.presenceContext||{};r&&r(this.id),t&&(this.unmount=t(this.id))}unmount(){}}const aD={animation:{Feature:nD},exit:{Feature:oD}};function Ip(e){return{point:{x:e.pageX,y:e.pageY}}}const sD=e=>t=>dv(t)&&e(t,Ip(t));function Jf(e,t,r,o){return fp(e,t,sD(r),o)}const Nk=({current:e})=>e?e.ownerDocument.defaultView:null,g6=(e,t)=>Math.abs(e-t);function iD(e,t){const r=g6(e.x,t.x),o=g6(e.y,t.y);return Math.sqrt(r**2+o**2)}const y6=new Set(["auto","scroll"]);class Ok{constructor(t,r,{transformPagePoint:o,contextWindow:s=window,dragSnapToOrigin:l=!1,distanceThreshold:i=3,element:u}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.scrollPositions=new Map,this.removeScrollListeners=null,this.onElementScroll=m=>{this.handleScroll(m.target)},this.onWindowScroll=()=>{this.handleScroll(window)},this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const m=I2(this.lastMoveEventInfo,this.history),y=this.startEvent!==null,v=iD(m.offset,{x:0,y:0})>=this.distanceThreshold;if(!y&&!v)return;const{point:b}=m,{timestamp:S}=Ta;this.history.push({...b,timestamp:S});const{onStart:C,onMove:k}=this.handlers;y||(C&&C(this.lastMoveEvent,m),this.startEvent=this.lastMoveEvent),k&&k(this.lastMoveEvent,m)},this.handlePointerMove=(m,y)=>{this.lastMoveEvent=m,this.lastMoveEventInfo=T2(y,this.transformPagePoint),no.update(this.updatePoint,!0)},this.handlePointerUp=(m,y)=>{this.end();const{onEnd:v,onSessionEnd:b,resumeAnimation:S}=this.handlers;if((this.dragSnapToOrigin||!this.startEvent)&&S&&S(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const C=I2(m.type==="pointercancel"?this.lastMoveEventInfo:T2(y,this.transformPagePoint),this.history);this.startEvent&&v&&v(m,C),b&&b(m,C)},!dv(t))return;this.dragSnapToOrigin=l,this.handlers=r,this.transformPagePoint=o,this.distanceThreshold=i,this.contextWindow=s||window;const c=Ip(t),d=T2(c,this.transformPagePoint),{point:h}=d,{timestamp:f}=Ta;this.history=[{...h,timestamp:f}];const{onSessionStart:g}=r;g&&g(t,I2(d,this.history)),this.removeListeners=jp(Jf(this.contextWindow,"pointermove",this.handlePointerMove),Jf(this.contextWindow,"pointerup",this.handlePointerUp),Jf(this.contextWindow,"pointercancel",this.handlePointerUp)),u&&this.startScrollTracking(u)}startScrollTracking(t){let r=t.parentElement;for(;r;){const o=getComputedStyle(r);(y6.has(o.overflowX)||y6.has(o.overflowY))&&this.scrollPositions.set(r,{x:r.scrollLeft,y:r.scrollTop}),r=r.parentElement}this.scrollPositions.set(window,{x:window.scrollX,y:window.scrollY}),window.addEventListener("scroll",this.onElementScroll,{capture:!0}),window.addEventListener("scroll",this.onWindowScroll),this.removeScrollListeners=()=>{window.removeEventListener("scroll",this.onElementScroll,{capture:!0}),window.removeEventListener("scroll",this.onWindowScroll)}}handleScroll(t){const r=this.scrollPositions.get(t);if(!r)return;const o=t===window,s=o?{x:window.scrollX,y:window.scrollY}:{x:t.scrollLeft,y:t.scrollTop},l={x:s.x-r.x,y:s.y-r.y};l.x===0&&l.y===0||(o?this.lastMoveEventInfo&&(this.lastMoveEventInfo.point.x+=l.x,this.lastMoveEventInfo.point.y+=l.y):this.history.length>0&&(this.history[0].x-=l.x,this.history[0].y-=l.y),this.scrollPositions.set(t,s),no.update(this.updatePoint,!0))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),this.removeScrollListeners&&this.removeScrollListeners(),this.scrollPositions.clear(),a0(this.updatePoint)}}function T2(e,t){return t?{point:t(e.point)}:e}function x6(e,t){return{x:e.x-t.x,y:e.y-t.y}}function I2({point:e},t){return{point:e,delta:x6(e,_k(t)),offset:x6(e,lD(t)),velocity:cD(t,.1)}}function lD(e){return e[0]}function _k(e){return e[e.length-1]}function cD(e,t){if(e.length<2)return{x:0,y:0};let r=e.length-1,o=null;const s=_k(e);for(;r>=0&&(o=e[r],!(s.timestamp-o.timestamp>Hi(t)));)r--;if(!o)return{x:0,y:0};o===e[0]&&e.length>2&&s.timestamp-o.timestamp>Hi(t)*2&&(o=e[1]);const l=di(s.timestamp-o.timestamp);if(l===0)return{x:0,y:0};const i={x:(s.x-o.x)/l,y:(s.y-o.y)/l};return i.x===1/0&&(i.x=0),i.y===1/0&&(i.y=0),i}function dD(e,{min:t,max:r},o){return t!==void 0&&e<t?e=o?Ao(t,e,o.min):Math.max(e,t):r!==void 0&&e>r&&(e=o?Ao(r,e,o.max):Math.min(e,r)),e}function b6(e,t,r){return{min:t!==void 0?e.min+t:void 0,max:r!==void 0?e.max+r-(e.max-e.min):void 0}}function uD(e,{top:t,left:r,bottom:o,right:s}){return{x:b6(e.x,r,s),y:b6(e.y,t,o)}}function v6(e,t){let r=t.min-e.min,o=t.max-e.max;return t.max-t.min<e.max-e.min&&([r,o]=[o,r]),{min:r,max:o}}function hD(e,t){return{x:v6(e.x,t.x),y:v6(e.y,t.y)}}function fD(e,t){let r=.5;const o=ss(e),s=ss(t);return s>o?r=cp(t.min,t.max-o,e.min):o>s&&(r=cp(e.min,e.max-s,t.min)),Cl(0,1,r)}function pD(e,t){const r={};return t.min!==void 0&&(r.min=t.min-e.min),t.max!==void 0&&(r.max=t.max-e.min),r}const rb=.35;function mD(e=rb){return e===!1?e=0:e===!0&&(e=rb),{x:S6(e,"left","right"),y:S6(e,"top","bottom")}}function S6(e,t,r){return{min:w6(e,t),max:w6(e,r)}}function w6(e,t){return typeof e=="number"?e:e[t]||0}const gD=new WeakMap;class yD{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=ra(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=t}start(t,{snapToCursor:r=!1,distanceThreshold:o}={}){const{presenceContext:s}=this.visualElement;if(s&&s.isPresent===!1)return;const l=f=>{r&&this.snapToCursor(Ip(f).point),this.stopAnimation()},i=(f,g)=>{const{drag:m,dragPropagation:y,onDragStart:v}=this.getProps();if(m&&!y&&(this.openDragLock&&this.openDragLock(),this.openDragLock=VN(m),!this.openDragLock))return;this.latestPointerEvent=f,this.latestPanInfo=g,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),ml(S=>{let C=this.getAxisMotionValue(S).get()||0;if(Sl.test(C)){const{projection:k}=this.visualElement;if(k&&k.layout){const R=k.layout.layoutBox[S];R&&(C=ss(R)*(parseFloat(C)/100))}}this.originPoint[S]=C}),v&&no.update(()=>v(f,g),!1,!0),Yx(this.visualElement,"transform");const{animationState:b}=this.visualElement;b&&b.setActive("whileDrag",!0)},u=(f,g)=>{this.latestPointerEvent=f,this.latestPanInfo=g;const{dragPropagation:m,dragDirectionLock:y,onDirectionLock:v,onDrag:b}=this.getProps();if(!m&&!this.openDragLock)return;const{offset:S}=g;if(y&&this.currentDirection===null){this.currentDirection=bD(S),this.currentDirection!==null&&v&&v(this.currentDirection);return}this.updateAxis("x",g.point,S),this.updateAxis("y",g.point,S),this.visualElement.render(),b&&no.update(()=>b(f,g),!1,!0)},c=(f,g)=>{this.latestPointerEvent=f,this.latestPanInfo=g,this.stop(f,g),this.latestPointerEvent=null,this.latestPanInfo=null},d=()=>{const{dragSnapToOrigin:f}=this.getProps();(f||this.constraints)&&this.startAnimation({x:0,y:0})},{dragSnapToOrigin:h}=this.getProps();this.panSession=new Ok(t,{onSessionStart:l,onStart:i,onMove:u,onSessionEnd:c,resumeAnimation:d},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:h,distanceThreshold:o,contextWindow:Nk(this.visualElement),element:this.visualElement.current})}stop(t,r){const o=t||this.latestPointerEvent,s=r||this.latestPanInfo,l=this.isDragging;if(this.cancel(),!l||!s||!o)return;const{velocity:i}=s;this.startAnimation(i);const{onDragEnd:u}=this.getProps();u&&no.postRender(()=>u(o,s))}cancel(){this.isDragging=!1;const{projection:t,animationState:r}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.endPanSession();const{dragPropagation:o}=this.getProps();!o&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),r&&r.setActive("whileDrag",!1)}endPanSession(){this.panSession&&this.panSession.end(),this.panSession=void 0}updateAxis(t,r,o){const{drag:s}=this.getProps();if(!o||!qm(t,s,this.currentDirection))return;const l=this.getAxisMotionValue(t);let i=this.originPoint[t]+o[t];this.constraints&&this.constraints[t]&&(i=dD(i,this.constraints[t],this.elastic[t])),l.set(i)}resolveConstraints(){var l;const{dragConstraints:t,dragElastic:r}=this.getProps(),o=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(l=this.visualElement.projection)==null?void 0:l.layout,s=this.constraints;t&&Gu(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&o?this.constraints=uD(o.layoutBox,t):this.constraints=!1,this.elastic=mD(r),s!==this.constraints&&!Gu(t)&&o&&this.constraints&&!this.hasMutatedConstraints&&ml(i=>{this.constraints!==!1&&this.getAxisMotionValue(i)&&(this.constraints[i]=pD(o.layoutBox[i],this.constraints[i]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:r}=this.getProps();if(!t||!Gu(t))return!1;const o=t.current,{projection:s}=this.visualElement;if(!s||!s.layout)return!1;const l=SO(o,s.root,this.visualElement.getTransformPagePoint());let i=hD(s.layout.layoutBox,l);if(r){const u=r(xO(i));this.hasMutatedConstraints=!!u,u&&(i=rk(u))}return i}startAnimation(t){const{drag:r,dragMomentum:o,dragElastic:s,dragTransition:l,dragSnapToOrigin:i,onDragTransitionEnd:u}=this.getProps(),c=this.constraints||{},d=ml(h=>{if(!qm(h,r,this.currentDirection))return;let f=c&&c[h]||{};i&&(f={min:0,max:0});const g=s?200:1e6,m=s?40:1e7,y={type:"inertia",velocity:o?t[h]:0,bounceStiffness:g,bounceDamping:m,timeConstant:750,restDelta:1,restSpeed:10,...l,...f};return this.startAxisValueAnimation(h,y)});return Promise.all(d).then(u)}startAxisValueAnimation(t,r){const o=this.getAxisMotionValue(t);return Yx(this.visualElement,t),o.start(av(t,o,0,r,this.visualElement,!1))}stopAnimation(){ml(t=>this.getAxisMotionValue(t).stop())}getAxisMotionValue(t){const r=`_drag${t.toUpperCase()}`,o=this.visualElement.getProps(),s=o[r];return s||this.visualElement.getValue(t,(o.initial?o.initial[t]:void 0)||0)}snapToCursor(t){ml(r=>{const{drag:o}=this.getProps();if(!qm(r,o,this.currentDirection))return;const{projection:s}=this.visualElement,l=this.getAxisMotionValue(r);if(s&&s.layout){const{min:i,max:u}=s.layout.layoutBox[r],c=l.get()||0;l.set(t[r]-Ao(i,u,.5)+c)}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:r}=this.getProps(),{projection:o}=this.visualElement;if(!Gu(r)||!o||!this.constraints)return;this.stopAnimation();const s={x:0,y:0};ml(i=>{const u=this.getAxisMotionValue(i);if(u&&this.constraints!==!1){const c=u.get();s[i]=fD({min:c,max:c},this.constraints[i])}});const{transformTemplate:l}=this.visualElement.getProps();this.visualElement.current.style.transform=l?l({},""):"none",o.root&&o.root.updateScroll(),o.updateLayout(),this.constraints=!1,this.resolveConstraints(),ml(i=>{if(!qm(i,t,null))return;const u=this.getAxisMotionValue(i),{min:c,max:d}=this.constraints[i];u.set(Ao(c,d,s[i]))}),this.visualElement.render()}addListeners(){if(!this.visualElement.current)return;gD.set(this.visualElement,this);const t=this.visualElement.current,r=Jf(t,"pointerdown",d=>{const{drag:h,dragListener:f=!0}=this.getProps(),g=d.target,m=g!==t&&JN(g);h&&f&&!m&&this.start(d)});let o;const s=()=>{const{dragConstraints:d}=this.getProps();Gu(d)&&d.current&&(this.constraints=this.resolveRefConstraints(),o||(o=xD(t,d.current,()=>this.scalePositionWithinConstraints())))},{projection:l}=this.visualElement,i=l.addEventListener("measure",s);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),no.read(s);const u=fp(window,"resize",()=>this.scalePositionWithinConstraints()),c=l.addEventListener("didUpdate",(({delta:d,hasLayoutChanged:h})=>{this.isDragging&&h&&(ml(f=>{const g=this.getAxisMotionValue(f);g&&(this.originPoint[f]+=d[f].translate,g.set(g.get()+d[f].translate))}),this.visualElement.render())}));return()=>{u(),r(),i(),c&&c(),o&&o()}}getProps(){const t=this.visualElement.getProps(),{drag:r=!1,dragDirectionLock:o=!1,dragPropagation:s=!1,dragConstraints:l=!1,dragElastic:i=rb,dragMomentum:u=!0}=t;return{...t,drag:r,dragDirectionLock:o,dragPropagation:s,dragConstraints:l,dragElastic:i,dragMomentum:u}}}function C6(e){let t=!0;return()=>{if(t){t=!1;return}e()}}function xD(e,t,r){const o=T8(e,C6(r)),s=T8(t,C6(r));return()=>{o(),s()}}function qm(e,t,r){return(t===!0||t===e)&&(r===null||r===e)}function bD(e,t=10){let r=null;return Math.abs(e.y)>t?r="y":Math.abs(e.x)>t&&(r="x"),r}class vD extends i0{constructor(t){super(t),this.removeGroupControls=hi,this.removeListeners=hi,this.controls=new yD(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||hi}update(){const{dragControls:t}=this.node.getProps(),{dragControls:r}=this.node.prevProps||{};t!==r&&(this.removeGroupControls(),t&&(this.removeGroupControls=t.subscribe(this.controls)))}unmount(){this.removeGroupControls(),this.removeListeners(),this.controls.isDragging||this.controls.endPanSession()}}const P2=e=>(t,r)=>{e&&no.update(()=>e(t,r),!1,!0)};class SD extends i0{constructor(){super(...arguments),this.removePointerDownListener=hi}onPointerDown(t){this.session=new Ok(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Nk(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:r,onPan:o,onPanEnd:s}=this.node.getProps();return{onSessionStart:P2(t),onStart:P2(r),onMove:P2(o),onEnd:(l,i)=>{delete this.session,s&&no.postRender(()=>s(l,i))}}}mount(){this.removePointerDownListener=Jf(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}let F2=!1;class wD extends w.Component{componentDidMount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:o,layoutId:s}=this.props,{projection:l}=t;l&&(r.group&&r.group.add(l),o&&o.register&&s&&o.register(l),F2&&l.root.didUpdate(),l.addEventListener("animationComplete",()=>{this.safeToRemove()}),l.setOptions({...l.options,layoutDependency:this.props.layoutDependency,onExitComplete:()=>this.safeToRemove()})),D5.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:r,visualElement:o,drag:s,isPresent:l}=this.props,{projection:i}=o;return i&&(i.isPresent=l,t.layoutDependency!==r&&i.setOptions({...i.options,layoutDependency:r}),F2=!0,s||t.layoutDependency!==r||r===void 0||t.isPresent!==l?i.willUpdate():this.safeToRemove(),t.isPresent!==l&&(l?i.promote():i.relegate()||no.postRender(()=>{const u=i.getStack();(!u||!u.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),cv.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:o}=this.props,{projection:s}=t;F2=!0,s&&(s.scheduleCheckAfterUnmount(),r&&r.group&&r.group.remove(s),o&&o.deregister&&o.deregister(s))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function Dk(e){const[t,r]=kk(),o=w.useContext(qb);return a.jsx(wD,{...e,layoutGroup:o,switchLayoutGroup:w.useContext(Pk),isPresent:t,safeToRemove:r})}const CD={pan:{Feature:SD},drag:{Feature:vD,ProjectionNode:Mk,MeasureLayout:Dk}};function M6(e,t,r){const{props:o}=e;e.animationState&&o.whileHover&&e.animationState.setActive("whileHover",r==="Start");const s="onHover"+r,l=o[s];l&&no.postRender(()=>l(t,Ip(t)))}class MD extends i0{mount(){const{current:t}=this.node;t&&(this.unmount=YN(t,(r,o)=>(M6(this.node,o,"Start"),s=>M6(this.node,s,"End"))))}unmount(){}}class kD extends i0{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=jp(fp(this.node.current,"focus",()=>this.onFocus()),fp(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function k6(e,t,r){const{props:o}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&o.whileTap&&e.animationState.setActive("whileTap",r==="Start");const s="onTap"+(r==="End"?"":r),l=o[s];l&&no.postRender(()=>l(t,Ip(t)))}class RD extends i0{mount(){const{current:t}=this.node;if(!t)return;const{globalTapTarget:r,propagate:o}=this.node.props;this.unmount=eO(t,(s,l)=>(k6(this.node,l,"Start"),(i,{success:u})=>k6(this.node,i,u?"End":"Cancel")),{useGlobalTarget:r,stopPropagation:(o==null?void 0:o.tap)===!1})}unmount(){}}const ob=new WeakMap,N2=new WeakMap,AD=e=>{const t=ob.get(e.target);t&&t(e)},jD=e=>{e.forEach(AD)};function ED({root:e,...t}){const r=e||document;N2.has(r)||N2.set(r,{});const o=N2.get(r),s=JSON.stringify(t);return o[s]||(o[s]=new IntersectionObserver(jD,{root:e,...t})),o[s]}function TD(e,t,r){const o=ED(t);return ob.set(e,r),o.observe(e),()=>{ob.delete(e),o.unobserve(e)}}const ID={some:0,all:1};class PD extends i0{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:r,margin:o,amount:s="some",once:l}=t,i={root:r?r.current:void 0,rootMargin:o,threshold:typeof s=="number"?s:ID[s]},u=c=>{const{isIntersecting:d}=c;if(this.isInView===d||(this.isInView=d,l&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:h,onViewportLeave:f}=this.node.getProps(),g=d?h:f;g&&g(c)};return TD(this.node.current,i,u)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:r}=this.node;["amount","margin","root"].some(FD(t,r))&&this.startObserver()}unmount(){}}function FD({viewport:e={}},{viewport:t={}}={}){return r=>e[r]!==t[r]}const ND={inView:{Feature:PD},tap:{Feature:RD},focus:{Feature:kD},hover:{Feature:MD}},OD={layout:{ProjectionNode:Mk,MeasureLayout:Dk}},_D={...aD,...ND,...CD,...OD},to=eD(_D,tD),R6="'Doto', monospace",Dl="'IBM Plex Mono', monospace",gs="#ffd400",DD=({guideState:e,onComplete:t,onSkip:r})=>{const[o,s]=w.useState(e.getProgress()),[l,i]=w.useState(null),[u,c]=w.useState(null),[d,h]=w.useState(!1),f=e.getCurrentStep(),g=e.getSteps().length;w.useEffect(()=>e.subscribe(k=>{if(s(k),k.badges.length>o.badges.length){const R=k.badges[k.badges.length-1];i(R),setTimeout(()=>i(null),2400)}}),[e,o.badges.length]),w.useEffect(()=>{if(!(f!=null&&f.targetSelector)){c(null);return}const C=document.querySelector(f.targetSelector);c(C?C.getBoundingClientRect():null)},[f]);const m=()=>{e.nextStep()||t()},y=()=>{e.previousStep()},v=()=>{e.skipToEnd(),r()};if(!f)return null;const b=(o.currentStep+1)/g*100,S=f.actionType==="finish";return a.jsxs(a.Fragment,{children:[u&&a.jsx("div",{style:{position:"fixed",zIndex:99,pointerEvents:"none",left:u.left-6,top:u.top-6,width:u.width+12,height:u.height+12,border:`1px dashed ${gs}50`,transition:"all 0.4s ease"}}),a.jsx(Xc,{children:!d&&a.jsxs(to.div,{initial:{opacity:0,y:12,x:0},animate:{opacity:1,y:0,x:0},exit:{opacity:0,y:12},transition:{duration:.35,ease:"easeOut"},style:{position:"fixed",bottom:20,left:20,zIndex:100,width:320,maxWidth:"calc(100vw - 40px)",background:"rgba(0,0,0,0.96)",border:"1px dashed rgba(255,255,255,0.08)",pointerEvents:"auto",backdropFilter:"blur(12px)"},children:[a.jsx("div",{style:{height:1,background:"rgba(255,255,255,0.04)"},children:a.jsx("div",{style:{height:"100%",width:`${b}%`,background:`linear-gradient(90deg, ${gs}60, ${gs})`,transition:"width 0.5s ease"}})}),a.jsxs("div",{style:{padding:"16px 18px 14px"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",marginBottom:10},children:[a.jsxs("div",{style:{flex:1},children:[a.jsx("h3",{style:{fontFamily:R6,fontSize:14,fontWeight:400,color:"rgba(255,255,255,0.85)",textTransform:"uppercase",letterSpacing:"0.06em",margin:0,lineHeight:1.2},children:f.title}),a.jsxs("div",{style:{fontFamily:Dl,fontSize:8,color:`${gs}70`,letterSpacing:"0.3em",textTransform:"uppercase",marginTop:4},children:[o.currentStep+1," / ",g]})]}),a.jsx("div",{style:{display:"flex",gap:3,marginTop:4,flexShrink:0},children:Array.from({length:Math.min(g,10)}).map((C,k)=>a.jsx("div",{style:{width:4,height:4,background:k<=o.currentStep?k===o.currentStep?gs:`${gs}60`:"rgba(255,255,255,0.08)",transition:"all 0.3s"}},k))})]}),a.jsx("p",{style:{fontFamily:Dl,fontSize:10,color:"rgba(255,255,255,0.5)",lineHeight:1.7,margin:"0 0 14px 0",textTransform:"uppercase",letterSpacing:"0.02em"},children:f.copy}),!S&&f.actionType!=="observe"&&a.jsx("div",{style:{fontFamily:Dl,fontSize:8,color:`${gs}60`,letterSpacing:"0.1em",textTransform:"uppercase",marginBottom:12,paddingTop:8,borderTop:"1px dashed rgba(255,255,255,0.04)"},children:f.actionType==="drag"&&" Experimente arrastar no canvas"}),a.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",paddingTop:10,borderTop:"1px dashed rgba(255,255,255,0.06)"},children:[o.currentStep>0&&a.jsx("button",{onClick:y,style:{padding:"6px 12px",background:"none",border:"1px dashed rgba(255,255,255,0.08)",color:"rgba(255,255,255,0.3)",fontFamily:Dl,fontSize:8,letterSpacing:"0.1em",textTransform:"uppercase",cursor:"pointer",transition:"all 0.15s"},children:""}),a.jsx("button",{onClick:m,style:{flex:1,padding:"7px 0",background:S?`${gs}12`:"rgba(255,255,255,0.03)",border:`1px dashed ${S?`${gs}35`:"rgba(255,255,255,0.08)"}`,color:S?`${gs}e0`:"rgba(255,255,255,0.55)",fontFamily:Dl,fontSize:9,letterSpacing:"0.12em",textTransform:"uppercase",cursor:"pointer",transition:"all 0.15s"},children:S?"Comear":"Prximo "}),!S&&a.jsx("button",{onClick:v,style:{padding:"6px 10px",background:"none",border:"none",color:"rgba(255,255,255,0.15)",fontFamily:Dl,fontSize:8,letterSpacing:"0.08em",textTransform:"uppercase",cursor:"pointer",transition:"all 0.15s"},children:"Pular"})]})]})]})}),d&&a.jsxs(to.button,{initial:{opacity:0},animate:{opacity:1},onClick:()=>h(!1),style:{position:"fixed",bottom:20,left:20,zIndex:100,padding:"6px 14px",background:"rgba(0,0,0,0.92)",border:`1px dashed ${gs}30`,cursor:"pointer",fontFamily:Dl,fontSize:8,color:`${gs}80`,letterSpacing:"0.15em",textTransform:"uppercase",display:"flex",alignItems:"center",gap:6},children:[a.jsx("span",{style:{fontSize:10},children:""}),"Guia ",o.currentStep+1,"/",g]}),!d&&a.jsx("button",{onClick:()=>h(!0),style:{position:"fixed",bottom:21,left:318,zIndex:101,width:18,height:18,background:"rgba(0,0,0,0.96)",border:"1px dashed rgba(255,255,255,0.08)",color:"rgba(255,255,255,0.2)",fontSize:8,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:Dl},title:"Minimizar guia",children:""}),a.jsx(Xc,{children:l&&m2[l]&&a.jsxs(to.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},style:{position:"fixed",bottom:80,left:20,zIndex:102,background:"rgba(0,0,0,0.96)",border:`1px dashed ${gs}25`,padding:"10px 16px",display:"flex",alignItems:"center",gap:10},children:[a.jsx("span",{style:{fontSize:18},children:m2[l].icon}),a.jsxs("div",{children:[a.jsx("div",{style:{fontFamily:Dl,fontSize:7,color:`${gs}70`,letterSpacing:"0.2em",textTransform:"uppercase",marginBottom:2},children:"Emblema"}),a.jsx("div",{style:{fontFamily:R6,fontSize:12,color:"rgba(255,255,255,0.7)",textTransform:"uppercase",letterSpacing:"0.04em"},children:m2[l].name})]})]})})]})},A6="'Doto', monospace",D0="'IBM Plex Mono', monospace",ri="#ffd400",LD=({onStart:e,onSkip:t})=>{const[r,o]=w.useState(!1),[s,l]=w.useState(!1);return a.jsx("div",{style:{position:"fixed",inset:0,zIndex:100,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.75)",backdropFilter:"blur(6px)"},children:a.jsxs(to.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},transition:{duration:.6,ease:"easeOut"},style:{width:520,maxWidth:"92vw",background:"#000",border:"1px dashed rgba(255,255,255,0.08)",overflow:"hidden"},children:[a.jsx("div",{style:{height:1,background:`linear-gradient(90deg, transparent, ${ri}40, transparent)`}}),a.jsxs("div",{style:{padding:"40px 36px 32px"},children:[a.jsx("div",{style:{textAlign:"center",marginBottom:24},children:a.jsx("span",{style:{fontSize:28,opacity:.3},children:""})}),a.jsx("h2",{style:{fontFamily:A6,fontSize:28,fontWeight:300,textAlign:"center",color:"white",letterSpacing:"0.04em",textTransform:"uppercase",marginBottom:4},children:"Complexity Lab"}),a.jsx("p",{style:{fontFamily:D0,fontSize:9,color:`${ri}90`,textAlign:"center",letterSpacing:"0.4em",textTransform:"uppercase",marginBottom:32},children:"VIDA ARTIFICIAL"}),a.jsx("div",{style:{borderTop:"1px dashed rgba(255,255,255,0.06)",borderBottom:"1px dashed rgba(255,255,255,0.06)",padding:"20px 0",marginBottom:24},children:a.jsx("p",{style:{fontFamily:D0,fontSize:11,color:"rgba(255,255,255,0.55)",lineHeight:1.8,textTransform:"uppercase",textAlign:"center",maxWidth:420,margin:"0 auto"},children:"Agentes com regras simples de atrao e repulso geram padres complexos emergentes  membranas, colnias, organismos, caos."})}),a.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:12,marginBottom:28},children:[{symbol:"",label:"Campo",desc:"Ambiente invisvel",color:ri},{symbol:"",label:"Agentes",desc:"Partculas com tipo",color:"#ff0084"},{symbol:"",label:"Interao",desc:"Matriz de foras",color:"#37b2da"}].map(i=>a.jsxs("div",{style:{textAlign:"center",padding:"12px 0"},children:[a.jsx("div",{style:{fontSize:16,color:i.color,opacity:.5,marginBottom:6},children:i.symbol}),a.jsx("div",{style:{fontFamily:A6,fontSize:11,color:"rgba(255,255,255,0.6)",textTransform:"uppercase",letterSpacing:"0.08em",marginBottom:3},children:i.label}),a.jsx("div",{style:{fontFamily:D0,fontSize:8,color:"rgba(255,255,255,0.25)",textTransform:"uppercase",letterSpacing:"0.06em"},children:i.desc})]},i.label))}),a.jsxs("div",{style:{background:`${ri}06`,border:`1px dashed ${ri}18`,padding:"14px 16px",marginBottom:24},children:[a.jsx("p",{style:{fontFamily:D0,fontSize:9,color:`${ri}90`,textAlign:"center",letterSpacing:"0.12em",textTransform:"uppercase",marginBottom:4},children:"Primeiro acesso?"}),a.jsx("p",{style:{fontFamily:D0,fontSize:10,color:"rgba(255,255,255,0.4)",textAlign:"center",lineHeight:1.6,textTransform:"uppercase"},children:"Um guia rpido e discreto vai apontar os controles essenciais."})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[a.jsx("button",{onClick:e,onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),style:{width:"100%",padding:"12px 0",background:r?`${ri}15`:`${ri}08`,border:`1px dashed ${r?`${ri}50`:`${ri}25`}`,color:r?ri:`${ri}c0`,fontFamily:D0,fontSize:10,letterSpacing:"0.2em",textTransform:"uppercase",cursor:"pointer",transition:"all 0.2s"},children:"Iniciar Guia"}),a.jsx("button",{onClick:t,onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),style:{width:"100%",padding:"10px 0",background:"none",border:"none",color:s?"rgba(255,255,255,0.5)":"rgba(255,255,255,0.2)",fontFamily:D0,fontSize:9,letterSpacing:"0.15em",textTransform:"uppercase",cursor:"pointer",transition:"all 0.2s"},children:"Explorar sozinho"})]})]})]})})};class zD{constructor(){this.storageKey="metalife_achievements_v2",this.achievements=new Map,this.load()}load(){try{const t=localStorage.getItem(this.storageKey);t&&(this.achievements=new Map(Object.entries(JSON.parse(t))))}catch{}}save(){try{localStorage.setItem(this.storageKey,JSON.stringify(Object.fromEntries(this.achievements)))}catch{}}unlock(t){return this.achievements.has(t.id)?!1:(t.unlockedAt=Date.now(),this.achievements.set(t.id,t),this.save(),!0)}getAll(){return Array.from(this.achievements.values()).sort((t,r)=>(r.unlockedAt||0)-(t.unlockedAt||0))}getUnlockedCount(){return this.achievements.size}isUnlocked(t){return this.achievements.has(t)}clear(){this.achievements.clear(),this.save()}}const ab=[{id:"first_30_seconds",name:"Observador",description:"Assistiu 30 segundos de evoluo",category:"milestone",icon:""},{id:"first_minute",name:"Testemunha",description:"Um minuto de observao",category:"milestone",icon:""},{id:"five_minutes",name:"Cronista",description:"5 minutos contemplando o universo",category:"milestone",icon:""},{id:"ten_minutes",name:"Historiador",description:"10 minutos de vida artificial",category:"milestone",icon:""},{id:"thirty_minutes",name:"Arquivista Temporal",description:"Meia hora de existncia",category:"milestone",icon:""},{id:"one_hour",name:"Guardio das Eras",description:"Uma hora de ciclos universais",category:"milestone",icon:""},{id:"pop_500",name:"Gnesis",description:"Universo com 500+ partculas",category:"milestone",icon:""},{id:"pop_1000",name:"Ecossistema",description:"Universo com 1000+ partculas",category:"milestone",icon:""},{id:"pop_2000",name:"Metrpole",description:"2000+ partculas simultneas",category:"milestone",icon:""},{id:"pop_5000",name:"Megacidade",description:"5000+ partculas! Densidade crtica",category:"milestone",icon:""},{id:"border_formed",name:"Fronteira",description:"Bordas territoriais claras emergiram",category:"pattern",icon:""},{id:"stable_attractor",name:"Atrator Estvel",description:"3+ clusters estveis simultneos",category:"pattern",icon:""},{id:"oscillation",name:"Oscilador",description:"Padro oscilatrio peridico detectado",category:"pattern",icon:""},{id:"crystal_form",name:"Cristal",description:"Alta coeso + baixa entropia = cristal",category:"pattern",icon:""},{id:"vortex_form",name:"Vrtice",description:"Rotao coletiva estvel",category:"pattern",icon:""},{id:"segregation",name:"Segregao",description:"Tipos separados em territrios distintos",category:"pattern",icon:""},{id:"spiral_arms",name:"Galxia Espiral",description:"Braos espirais rotativos",category:"pattern",icon:""},{id:"fractal_structure",name:"Mandelbrot",description:"Estrutura auto-similar recursiva",category:"pattern",icon:""},{id:"binary_orbit",name:"Sistema Binrio",description:"Dois grupos orbitando mutuamente",category:"pattern",icon:""},{id:"perfect_symmetry",name:"Simetria",description:"Simetria radial emergiu",category:"pattern",icon:""},{id:"first_beat",name:"Primeira Batida",description:"Primeiro evento evolutivo",category:"emergence",icon:""},{id:"ten_beats",name:"Declogo",description:"10 eventos evolutivos",category:"emergence",icon:""},{id:"fifty_beats",name:"Sinfonia",description:"50 eventos evolutivos",category:"emergence",icon:""},{id:"first_speciation",name:"Gnese de Espcie",description:"Primeira especiao emergiu",category:"emergence",icon:""},{id:"five_speciations",name:"Exploso Cambriana",description:"5+ especiaes ocorreram",category:"emergence",icon:""},{id:"first_mitosis",name:"Diviso Celular",description:"Primeiro evento de mitose",category:"emergence",icon:""},{id:"ten_mitosis",name:"Reproduo Ativa",description:"10 divises celulares",category:"emergence",icon:""},{id:"first_mutation",name:"Primeira Mutao",description:"Primeiro drift gentico",category:"emergence",icon:""},{id:"phase_shift",name:"Transio de Fase",description:"Mudana abrupta de regime detectada",category:"emergence",icon:""},{id:"cascade_event",name:"Cascata",description:"Eventos encadeados em sequncia",category:"emergence",icon:""},{id:"stability_30s",name:"Equilbrio",description:"Sistema estvel por 30 segundos",category:"stability",icon:""},{id:"stability_2min",name:"Homeostase",description:"Estvel por 2+ minutos",category:"stability",icon:""},{id:"stability_5min",name:"Ordem Eterna",description:"Estvel por 5+ minutos",category:"stability",icon:""},{id:"high_diversity",name:"Biodiversidade",description:"Alta diversidade de tipos simultnea",category:"stability",icon:""},{id:"field_coherence",name:"Campo Coerente",description:"Alta coeso no campo de memria",category:"stability",icon:""},{id:"high_entropy",name:"Big Bang",description:"Entropia mxima alcanada",category:"chaos",icon:""},{id:"mass_extinction",name:"Extino em Massa",description:"Queda de 80%+ da populao",category:"chaos",icon:""},{id:"chaos_recovery",name:"Fnix",description:"Ordem emergiu do caos mximo",category:"chaos",icon:""},{id:"tension_spike",name:"Crise",description:"Tenso crtica no campo",category:"chaos",icon:""},{id:"matrix_randomized",name:"Alquimista",description:"Matriz de interao randomizada",category:"discovery",icon:""},{id:"preset_explorer",name:"Explorador",description:"3+ presets diferentes testados",category:"discovery",icon:""},{id:"field_heatmap",name:"Cartgrafo",description:"Heatmap de campo ativado",category:"discovery",icon:""},{id:"trails_on",name:"Rastro de Luz",description:"Trilhas de partculas ativadas",category:"discovery",icon:""},{id:"high_speed",name:"Acelerao",description:"Simulao em velocidade 5x",category:"discovery",icon:""},{id:"codex_capture",name:"Taxonomista",description:"Primeiro organismo capturado no Codex",category:"discovery",icon:""}],BD=new Map(ab.map(e=>[e.id,e])),jr=e=>({...BD.get(e)});let Mc=0,Wm=0,Lk=0,gf=-1,mu=0;const $D=e=>{Lk++},qD=(e,t)=>{const r=new Set(t.map(j=>j.id)),o=e.currentTime,s=e.particleCount,l=e.borderStrength??0,i=e.stableClusters??0,u=e.oscillation??0,c=e.diversityIndex??0,d=e.avgTension??0,h=e.avgCohesion??0,f=e.entropyLevel,g=e.stabilityScore,m=e.totalBeats??0,y=e.totalSpeciations??0,v=e.totalMitosis??0;if(!r.has("first_30_seconds")&&o>=30)return{...jr("first_30_seconds"),metadata:{duration:o}};if(!r.has("first_minute")&&o>=60)return{...jr("first_minute"),metadata:{duration:o}};if(!r.has("five_minutes")&&o>=300)return{...jr("five_minutes"),metadata:{duration:o}};if(!r.has("ten_minutes")&&o>=600)return{...jr("ten_minutes"),metadata:{duration:o}};if(!r.has("thirty_minutes")&&o>=1800)return{...jr("thirty_minutes"),metadata:{duration:o}};if(!r.has("one_hour")&&o>=3600)return{...jr("one_hour"),metadata:{duration:o}};if(mu=Math.max(mu,s),!r.has("pop_500")&&mu>=500)return{...jr("pop_500"),metadata:{particleCount:s}};if(!r.has("pop_1000")&&mu>=1e3)return{...jr("pop_1000"),metadata:{particleCount:s}};if(!r.has("pop_2000")&&mu>=2e3)return{...jr("pop_2000"),metadata:{particleCount:s}};if(!r.has("pop_5000")&&mu>=5e3)return{...jr("pop_5000"),metadata:{particleCount:s}};if(gf>0&&s<gf*.2&&gf>100&&(gf=s,!r.has("mass_extinction")))return{...jr("mass_extinction"),metadata:{particleCount:s}};if(s>50&&(gf=s),!r.has("border_formed")&&l>.55)return{...jr("border_formed"),metadata:{confidence:l}};if(!r.has("stable_attractor")&&i>=3)return{...jr("stable_attractor"),metadata:{confidence:i/10}};if(!r.has("oscillation")&&u>.5)return{...jr("oscillation"),metadata:{confidence:u}};if(!r.has("segregation")&&l>.7&&i>=2)return{...jr("segregation"),metadata:{confidence:l}};if(!r.has("crystal_form")&&h>.7&&f<.2)return{...jr("crystal_form"),metadata:{confidence:h}};if(!r.has("field_coherence")&&h>.65&&o>30)return{...jr("field_coherence"),metadata:{confidence:h}};if(!r.has("high_entropy")&&f>.85)return{...jr("high_entropy"),metadata:{confidence:f}};if(!r.has("tension_spike")&&d>.75)return{...jr("tension_spike"),metadata:{confidence:d}};if(!r.has("high_diversity")&&c>.7&&e.typesCount>=4)return{...jr("high_diversity"),metadata:{typesCount:e.typesCount}};const b=Date.now()/1e3;if(g>.65?(Wm===0&&(Wm=b),Mc=b-Wm):(Wm=0,Mc=0),!r.has("stability_30s")&&Mc>=30)return{...jr("stability_30s"),metadata:{duration:Mc}};if(!r.has("stability_2min")&&Mc>=120)return{...jr("stability_2min"),metadata:{duration:Mc}};if(!r.has("stability_5min")&&Mc>=300)return{...jr("stability_5min"),metadata:{duration:Mc}};const S=e.recentEvents.some(j=>j.toLowerCase().includes("espcie")||j.toLowerCase().includes("archetype")||j.toLowerCase().includes("speciao")),C=e.recentEvents.some(j=>j.toLowerCase().includes("diviso")||j.toLowerCase().includes("mitose")),k=e.recentEvents.some(j=>j.toLowerCase().includes("mutao")||j.toLowerCase().includes("mutation")),R=e.recentEvents.some(j=>j.includes("")||j.includes("")||j.includes(""));return!r.has("first_beat")&&(R||S||m>=1)?{...jr("first_beat"),metadata:{confidence:1}}:!r.has("ten_beats")&&m>=10?{...jr("ten_beats"),metadata:{confidence:1}}:!r.has("fifty_beats")&&m>=50?{...jr("fifty_beats"),metadata:{confidence:1}}:!r.has("first_speciation")&&(S||y>=1)?{...jr("first_speciation"),metadata:{confidence:1}}:!r.has("five_speciations")&&y>=5?{...jr("five_speciations"),metadata:{confidence:1}}:!r.has("first_mitosis")&&(C||v>=1)?{...jr("first_mitosis"),metadata:{confidence:1}}:!r.has("ten_mitosis")&&v>=10?{...jr("ten_mitosis"),metadata:{confidence:1}}:!r.has("first_mutation")&&k?{...jr("first_mutation"),metadata:{confidence:1}}:!r.has("phase_shift")&&f>.6&&g<.3&&o>60?{...jr("phase_shift"),metadata:{confidence:f}}:!r.has("chaos_recovery")&&f<.4&&g>.6&&m>=5?{...jr("chaos_recovery"),metadata:{confidence:g}}:!r.has("cascade_event")&&m>=3&&e.recentEvents.length>=5?{...jr("cascade_event"),metadata:{confidence:.9}}:!r.has("preset_explorer")&&Lk>=3?{...jr("preset_explorer"),metadata:{confidence:1}}:null},WD=async(e,t)=>null,HD=()=>{const[e]=w.useState(()=>new zD),[t,r]=w.useState([]),[o,s]=w.useState(null),[l,i]=w.useState(!1),u=w.useRef(0),c=2e3;w.useEffect(()=>{r(e.getAll())},[e]);const d=w.useCallback(async y=>{const v=Date.now();if(v-u.current<c)return;u.current=v;const b=e.getAll(),S=qD(y,b);if(S&&e.unlock(S)){r(e.getAll()),s(S);return}try{const C=await WD(y,b);C&&e.unlock(C)&&(r(e.getAll()),s(C))}catch(C){console.warn("LLM achievement detection failed:",C)}},[e]),h=w.useCallback(()=>{s(null)},[]),f=w.useCallback(()=>{i(!0)},[]),g=w.useCallback(()=>{i(!1)},[]),m=w.useCallback(()=>{e.clear(),r([]),s(null)},[e]);return{achievements:t,latestAchievement:o,showPanel:l,checkAchievements:d,dismissLatest:h,openPanel:f,closePanel:g,clearAll:m,unlockedCount:t.length}},O2={pattern:{label:"Padro",color:"text-purple-400",bg:"bg-purple-500/10",border:"border-purple-500/20",icon:lp},emergence:{label:"Emergncia",color:"text-cyan-400",bg:"bg-cyan-500/10",border:"border-cyan-500/20",icon:Yi},stability:{label:"Estabilidade",color:"text-green-400",bg:"bg-green-500/10",border:"border-green-500/20",icon:UE},chaos:{label:"Caos",color:"text-red-400",bg:"bg-red-500/10",border:"border-red-500/20",icon:I9},discovery:{label:"Descoberta",color:"text-yellow-400",bg:"bg-yellow-500/10",border:"border-yellow-500/20",icon:Es},milestone:{label:"Marco",color:"text-orange-400",bg:"bg-orange-500/10",border:"border-orange-500/20",icon:Lj}},GD=({achievements:e,onClose:t,onClearAll:r})=>{const[o,s]=w.useState(null),[l,i]=w.useState(!0),u=w.useMemo(()=>new Set(e.map(y=>y.id)),[e]),c=w.useMemo(()=>ab.map(y=>{var v;return{...y,unlocked:u.has(y.id),unlockedAt:(v=e.find(b=>b.id===y.id))==null?void 0:v.unlockedAt}}),[u,e]),d=w.useMemo(()=>{let y=c;return o&&(y=y.filter(v=>v.category===o)),l||(y=y.filter(v=>v.unlocked)),y.sort((v,b)=>v.unlocked&&!b.unlocked?-1:!v.unlocked&&b.unlocked?1:(b.unlockedAt??0)-(v.unlockedAt??0))},[c,o,l]),h=w.useMemo(()=>e.reduce((y,v)=>(y[v.category]=(y[v.category]||0)+1,y),{}),[e]),f=e.length,g=ab.length,m=Math.round(f/g*100);return a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4",children:a.jsxs("div",{className:"w-full max-w-4xl h-[88vh] bg-black/95 backdrop-blur-xl border border-white/10 rounded-xl flex flex-col overflow-hidden shadow-2xl",children:[a.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-white/[0.06]",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-9 h-9 rounded-full bg-gradient-to-br from-cyan-500/20 to-purple-500/20 border border-cyan-500/30 flex items-center justify-center",children:a.jsx(Yi,{className:"w-4 h-4 text-cyan-400",strokeWidth:1.5})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-base font-light text-white tracking-tight",children:"Conquistas"}),a.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[a.jsx("div",{className:"h-1 w-32 bg-white/10 rounded-full overflow-hidden",children:a.jsx("div",{className:"h-full bg-gradient-to-r from-cyan-500 to-purple-500 rounded-full transition-all",style:{width:`${m}%`}})}),a.jsxs("span",{className:"text-[10px] text-white/40 font-mono",children:[f,"/",g]})]})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("button",{onClick:()=>i(y=>!y),className:`flex items-center gap-1.5 px-3 py-1.5 text-[10px] rounded border transition-all
                ${l?"border-white/15 text-white/50 hover:text-white/70":"border-white/5 text-white/25 hover:text-white/40"}`,children:[a.jsx(Rx,{size:10}),l?"Mostrando bloqueadas":"Apenas desbloqueadas"]}),r&&a.jsx("button",{onClick:r,className:"px-3 py-1.5 text-[10px] text-red-400/50 hover:text-red-400/80 border border-red-500/10 hover:border-red-500/30 rounded transition-all",children:"Resetar"}),a.jsx("button",{onClick:t,className:"p-2 rounded-full border border-white/10 hover:border-white/30 text-white/40 hover:text-white/80 transition-all",children:a.jsx(ya,{size:16,strokeWidth:1.5})})]})]}),a.jsxs("div",{className:"flex gap-1.5 px-5 py-3 border-b border-white/[0.04] overflow-x-auto",children:[a.jsxs("button",{onClick:()=>s(null),className:`px-3 py-1.5 text-[10px] tracking-wider uppercase font-light transition-all rounded-lg border shrink-0
              ${o===null?"text-white bg-white/10 border-white/20":"text-white/35 border-white/5 hover:text-white/60 hover:border-white/10"}`,children:["Todas  ",f]}),Object.entries(O2).map(([y,v])=>{const b=h[y]||0,S=v.icon;return a.jsxs("button",{onClick:()=>s(y),className:`flex items-center gap-1.5 px-3 py-1.5 text-[10px] tracking-wider uppercase font-light transition-all rounded-lg border shrink-0
                  ${o===y?`${v.color} ${v.bg} ${v.border}`:"text-white/35 border-white/5 hover:text-white/60 hover:border-white/10"}`,children:[a.jsx(S,{size:10,strokeWidth:1.5}),v.label,b>0&&a.jsxs("span",{className:"ml-0.5 opacity-70",children:[" ",b]})]},y)})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-5 [&::-webkit-scrollbar]:w-1 [&::-webkit-scrollbar-track]:bg-white/5 [&::-webkit-scrollbar-thumb]:bg-white/20 [&::-webkit-scrollbar-thumb]:rounded-full",children:d.length===0?a.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-white/25",children:[a.jsx(Yi,{size:40,strokeWidth:1,className:"mb-3 opacity-30"}),a.jsx("p",{className:"text-sm font-light",children:"Nenhuma conquista ainda"}),a.jsx("p",{className:"text-xs mt-1.5 opacity-60",children:"Continue explorando o universo"})]}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:d.map(y=>{const v=O2[y.category],b=v.icon,S=y.unlocked;return a.jsxs("div",{className:`relative p-4 rounded-lg border transition-all
                      ${S?`${v.bg} ${v.border} hover:scale-[1.01]`:"bg-white/[0.02] border-white/[0.05] opacity-40"}`,children:[!S&&a.jsx("div",{className:"absolute top-3 right-3",children:a.jsx(Rx,{size:10,className:"text-white/30"})}),a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:`text-3xl leading-none shrink-0 ${S?"":"grayscale opacity-50"}`,children:y.icon}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-1.5 mb-1 flex-wrap",children:[a.jsx("span",{className:`text-sm font-medium ${S?"text-white":"text-white/50"}`,children:y.name}),a.jsxs("div",{className:`flex items-center gap-0.5 px-1.5 py-px rounded-full ${v.bg} border ${v.border} shrink-0`,children:[a.jsx(b,{size:8,strokeWidth:2,className:v.color}),a.jsx("span",{className:`text-[8px] uppercase tracking-wider ${v.color}`,children:v.label})]})]}),a.jsx("p",{className:"text-[10px] text-white/40 leading-snug",children:y.description}),S&&y.unlockedAt&&a.jsx("p",{className:"text-[9px] text-white/25 mt-1.5 font-mono",children:new Date(y.unlockedAt).toLocaleDateString("pt-BR",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"})})]})]})]},y.id)})})}),a.jsxs("div",{className:"p-4 border-t border-white/[0.04] bg-black/20 flex items-center justify-between",children:[a.jsx("div",{className:"flex items-center gap-4 text-[10px] font-light flex-wrap",children:Object.entries(O2).map(([y,v])=>a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${v.color.replace("text-","bg-")}`}),a.jsxs("span",{className:"text-white/30",children:[v.label,":"]}),a.jsx("span",{className:"text-white/60 font-mono",children:h[y]||0})]},y))}),a.jsxs("div",{className:"text-[10px] text-white/30 font-mono",children:[m,"% completo"]})]})]})})},VD=({achievement:e,onDismiss:t})=>{const[r,o]=w.useState(!1);return w.useEffect(()=>{if(e){o(!0);const s=setTimeout(()=>{o(!1),setTimeout(t,300)},5e3);return()=>clearTimeout(s)}},[e]),e?a.jsx("div",{className:`
        fixed top-6 right-6 z-50 transition-all duration-300 transform
        ${r?"translate-x-0 opacity-100":"translate-x-full opacity-0"}
      `,onClick:()=>{o(!1),setTimeout(t,300)},children:a.jsxs("div",{className:"relative w-96 bg-gradient-to-br from-black/95 to-black/90 backdrop-blur-xl border border-cyan-500/20 rounded-lg overflow-hidden shadow-2xl shadow-cyan-500/10 cursor-pointer hover:border-cyan-500/40 transition-all",children:[a.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-cyan-500/5 via-purple-500/5 to-transparent opacity-50"}),a.jsxs("div",{className:"relative p-4 flex items-start gap-3",children:[a.jsx("div",{className:"flex-shrink-0 text-4xl leading-none mt-1 drop-shadow-glow",children:e.icon}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(Yi,{className:"w-3 h-3 text-cyan-400",strokeWidth:2}),a.jsx("span",{className:"text-[10px] uppercase tracking-[0.2em] text-cyan-400/80 font-light",children:"Conquista"})]}),a.jsx("h3",{className:"text-white text-base font-medium mb-1 leading-tight",children:e.name}),a.jsx("p",{className:"text-white/50 text-xs font-light leading-relaxed",children:e.description})]})]}),a.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-white/5",children:a.jsx("div",{className:"h-full bg-gradient-to-r from-cyan-500 to-purple-500 transition-all duration-[5000ms] ease-linear",style:{width:r?"0%":"100%"}})})]})}):null},UD=[{name:"Black",value:"radial-gradient(circle, #000000 0%, #000000 100%)"},{name:"Dark Gray",value:"radial-gradient(circle, #1a1a1a 0%, #000000 100%)"},{name:"Deep Blue",value:"radial-gradient(circle, #0f172a 0%, #000000 100%)"},{name:"Purple Void",value:"radial-gradient(circle, #1e1b4b 0%, #000000 100%)"},{name:"Crimson",value:"radial-gradient(circle, #450a0a 0%, #000000 100%)"},{name:"Forest",value:"radial-gradient(circle, #14532d 0%, #000000 100%)"},{name:"Ocean Deep",value:"radial-gradient(circle, #082f49 0%, #000000 100%)"},{name:"Midnight",value:"radial-gradient(circle, #1e3a8a 0%, #000000 100%)"},{name:"Rose",value:"radial-gradient(circle, #4c0519 0%, #000000 100%)"},{name:"Emerald",value:"radial-gradient(circle, #064e3b 0%, #000000 100%)"},{name:"Amber",value:"radial-gradient(circle, #451a03 0%, #000000 100%)"},{name:"Slate",value:"radial-gradient(circle, #1e293b 0%, #000000 100%)"},{name:"Neon Blue",value:"radial-gradient(circle, #0c4a6e 30%, #000000 100%)"},{name:"Neon Purple",value:"radial-gradient(circle, #581c87 30%, #000000 100%)"},{name:"Neon Pink",value:"radial-gradient(circle, #831843 30%, #000000 100%)"},{name:"Cosmic",value:"radial-gradient(circle, #312e81 0%, #1e1b4b 50%, #000000 100%)"},{name:"Sunset",value:"radial-gradient(circle, #7c2d12 0%, #450a0a 50%, #000000 100%)"},{name:"Aurora",value:"radial-gradient(circle, #164e63 0%, #1e3a8a 50%, #000000 100%)"},{name:"Galaxy",value:"radial-gradient(circle, #4c1d95 20%, #1e1b4b 60%, #000000 100%)"},{name:"Fire",value:"radial-gradient(circle, #7f1d1d 0%, #450a0a 40%, #000000 100%)"}],j6=[{name:"Black",value:"#000000"},{name:"Deep Blue",value:"#0f172a"},{name:"Purple",value:"#1e1b4b"},{name:"Crimson",value:"#450a0a"},{name:"Forest",value:"#14532d"},{name:"Ocean",value:"#082f49"},{name:"Midnight",value:"#1e3a8a"},{name:"Rose",value:"#4c0519"},{name:"Emerald",value:"#064e3b"},{name:"Amber",value:"#451a03"},{name:"Slate",value:"#1e293b"},{name:"Neon Blue",value:"#0c4a6e"},{name:"Neon Purple",value:"#581c87"},{name:"Neon Pink",value:"#831843"}],YD=({currentBg:e,onBgChange:t,onClose:r})=>{const[o,s]=w.useState("#1e1b4b"),[l,i]=w.useState("#000000"),[u,c]=w.useState(30),d=()=>{const h=`radial-gradient(circle, ${o} ${u}%, ${l} 100%)`;t(h)};return a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/20 backdrop-blur-sm",children:a.jsxs("div",{className:"w-full max-w-3xl bg-black/5 backdrop-blur-sm border border-white/[0.02] rounded-lg overflow-hidden",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/[0.02]",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-500/10 flex items-center justify-center",children:a.jsx(ME,{className:"w-4 h-4 text-purple-500",strokeWidth:1.5})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-base font-light text-white tracking-tight",children:"Background Gradient"}),a.jsx("p",{className:"text-[10px] text-white/40 font-light",children:"Customize canvas background"})]})]}),a.jsx("button",{onClick:r,className:"p-2 rounded-full border border-white/10 hover:border-white/30 text-white/40 hover:text-white/80 transition-all",children:a.jsx(ya,{size:16,strokeWidth:1})})]}),a.jsxs("div",{className:"p-6 max-h-[70vh] overflow-y-auto",children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("h3",{className:"text-xs uppercase tracking-wider text-white/40 mb-3 font-light",children:"Presets"}),a.jsx("div",{className:"grid grid-cols-4 gap-2",children:UD.map(h=>a.jsxs("button",{onClick:()=>t(h.value),className:"group relative h-20 rounded-lg border border-white/10 hover:border-white/30 transition-all overflow-hidden",style:{background:h.value},children:[a.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"}),a.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-2 text-[9px] text-white/70 font-light text-center",children:h.name}),e===h.value&&a.jsx("div",{className:"absolute top-1 right-1 w-3 h-3 rounded-full bg-purple-500 border border-white"})]},h.name))})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-xs uppercase tracking-wider text-white/40 mb-3 font-light",children:"Custom Gradient"}),a.jsxs("div",{className:"bg-white/[0.02] border border-white/5 rounded-lg p-4 space-y-4",children:[a.jsx("div",{className:"h-32 rounded-lg border border-white/10",style:{background:`radial-gradient(circle, ${o} ${u}%, ${l} 100%)`}}),a.jsxs("div",{children:[a.jsx("label",{className:"text-[10px] text-white/40 uppercase tracking-wider font-light mb-2 block",children:"Center Color"}),a.jsx("div",{className:"grid grid-cols-7 gap-2",children:j6.map(h=>a.jsx("button",{onClick:()=>s(h.value),className:`h-10 rounded border-2 transition-all ${o===h.value?"border-white scale-110":"border-white/20 hover:border-white/40"}`,style:{backgroundColor:h.value},title:h.name},h.name))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-[10px] text-white/40 uppercase tracking-wider font-light mb-2 block",children:"Edge Color"}),a.jsx("div",{className:"grid grid-cols-7 gap-2",children:j6.map(h=>a.jsx("button",{onClick:()=>i(h.value),className:`h-10 rounded border-2 transition-all ${l===h.value?"border-white scale-110":"border-white/20 hover:border-white/40"}`,style:{backgroundColor:h.value},title:h.name},h.name))})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"text-[10px] text-white/40 uppercase tracking-wider font-light mb-2 block",children:["Center Spread: ",u,"%"]}),a.jsx("input",{type:"range",min:"0",max:"80",value:u,onChange:h=>c(Number(h.target.value)),className:`w-full h-1 bg-white/10 rounded-lg appearance-none cursor-pointer 
                    [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 
                    [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-purple-500 
                    [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:border-2 
                    [&::-webkit-slider-thumb]:border-white`})]}),a.jsx("button",{onClick:d,className:"w-full bg-purple-600 hover:bg-purple-500 text-white text-xs py-2.5 rounded transition-colors font-light tracking-wide uppercase",children:"Apply Custom Gradient"})]})]})]})]})})},KD="'IBM Plex Mono', monospace",_2="#ffd400",XD=({targetSelector:e,show:t})=>{const[r,o]=w.useState(null);return w.useEffect(()=>{if(!t){o(null);return}const s=()=>{const l=document.querySelector(e);if(l){const i=l.getBoundingClientRect();o({x:i.left+i.width/2,y:i.top-32})}};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[t,e]),!t||!r?null:a.jsx("div",{style:{position:"fixed",zIndex:90,pointerEvents:"none",left:r.x,top:r.y,transform:"translateX(-50%)"},children:a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",animation:"pulse 2s ease-in-out infinite"},children:[a.jsx("div",{style:{fontFamily:KD,fontSize:8,color:`${_2}90`,letterSpacing:"0.12em",textTransform:"uppercase",background:"rgba(0,0,0,0.88)",border:`1px dashed ${_2}30`,padding:"4px 10px",marginBottom:4,whiteSpace:"nowrap"},children:"Guia disponvel"}),a.jsx("div",{style:{color:`${_2}60`,fontSize:10},children:""})]})})};function ZD(){return{nextId:100,list:[]}}function JD(e,t,r,o){if(o.volatility<.05)return null;for(const d of e.list)if(QD(d.genes,r)<.18)return null;const s=e.nextId++,l=eL(s),i=tL(s),u=[];o.scarcity>.6&&u.push(" Nascido da Escassez"),o.cohesion>.6&&u.push(" Altamente Coesivo"),o.volatility>.6&&u.push(" Filho da Tempestade");const c={id:s,name:i,sigil:l,genes:r,bornAt:t,notes:u};return e.list.unshift(c),e.list.length>60&&e.list.pop(),c}function QD(e,t){const r=e.a-t.a,o=e.b-t.b,s=e.c-t.c,l=e.d-t.d;return Math.sqrt(r*r+o*o+s*s+l*l)}function eL(e){const t=["","","","","","","","","","","","","","","","","","",""];return t[Math.abs(e)%t.length]}function tL(e,t,r){const o=["Aster","Kera","Mori","Nexa","Vira","Soma","Luma","Rho","Ech","Tess"],s=["espiral","ruptura","florescer","escriba","deriva","forja","vu","pulso","vnculo","sussurro"];return`${o[Math.abs(e)%o.length]} ${s[Math.abs(e*7|0)%s.length]}`}function nL(e,t=200){if(e.count<10)return null;const r=Math.min(t,e.count);let o=0,s=0,l=0,i=0;for(let h=0;h<r;h++){const f=Math.random()*e.count|0;e.geneA&&e.geneB&&e.geneC&&e.geneD&&(o+=e.geneA[f],s+=e.geneB[f],l+=e.geneC[f],i+=e.geneD[f])}const u={a:o/r,b:s/r,c:l/r,d:i/r};let c=0;for(let h=0;h<r;h++){const f=Math.random()*e.count|0;if(e.geneA&&e.geneB&&e.geneC&&e.geneD){const g=e.geneA[f]-u.a,m=e.geneB[f]-u.b,y=e.geneC[f]-u.c,v=e.geneD[f]-u.d;c+=g*g+m*m+y*y+v*v}}const d=Math.sqrt(c/r);return{centroid:u,spread:d}}function rL(e,t,r,o){if(!(!e.geneA||!e.geneB||!e.geneC||!e.geneD))for(let s=0;s<e.count;s+=2){const l=e.x[s],i=e.y[s],u=t(l,i),c=o.baseRate+o.entropyGain*(u.entropy??0);if(Math.random()<c*r){const d=Math.random()*4|0,h=(Math.random()-.5)*o.step*(.5+(u.entropy??0));d===0&&(e.geneA[s]=Hm(e.geneA[s]+h)),d===1&&(e.geneB[s]=Hm(e.geneB[s]+h)),d===2&&(e.geneC[s]=Hm(e.geneC[s]+h)),d===3&&(e.geneD[s]=Hm(e.geneD[s]+h))}}}function Hm(e){return e<0?0:e>1?1:e}const oL={mode:"FULL",foodEnabled:!1,foodRatio:.15,foodType:255,energyEnabled:!1,energyDecay:.002,energyFeedRate:.04,energyReproThreshold:2,mutationDial:.35,mutationAmount:.08,mutationRate:8e-4,typeStability:.985,reconfigEnabled:!0,reconfigRate:.08,reconfigAmount:.06};function D2(e){const t=aL(e.mutationDial),r=yf(5e-5,.0035,t),o=yf(.999,.955,t),s=yf(.02,.18,t),l=yf(.02,.2,t),i=yf(.01,.14,t);return{...e,mutationRate:r,typeStability:o,mutationAmount:s,reconfigRate:l,reconfigAmount:i}}function aL(e){return e<0?0:e>1?1:e}function yf(e,t,r){return e+(t-e)*r}const sL=()=>({births:0,deaths:0,mutations:0,speciation:0,lastEvent:""});function iL(){return{pings:[],nextId:0}}function E6(e,t,r,o,s,l,i=5){e.pings.push({id:e.nextId++,x:t,y:r,sigil:o,color:s,name:l,spawnTime:Date.now()/1e3,lifetime:i,intensity:1})}function lL(e,t){const r=Date.now()/1e3;for(let o=e.pings.length-1;o>=0;o--){const s=e.pings[o],l=r-s.spawnTime;if(l>=s.lifetime)e.pings.splice(o,1);else{const i=s.lifetime*.7;if(l>i){const u=(l-i)/(s.lifetime-i);s.intensity=1-u}}}e.pings.length>50&&e.pings.shift()}const Gm={bond:"#ffaa00",bloom:"#00ffaa",storm:"#ff4444",default:"#88ccff"};function cL(e){return e.includes("coesivo")?Gm.bond:e.includes("filho-da-tempestade")?Gm.storm:e.includes("nascido-da-escassez")?Gm.bloom:Gm.default}const dL=(e,t)=>{const r=e*t;return{width:e,height:t,bond:new Float32Array(r),rift:new Float32Array(r),bloom:new Float32Array(r),oath:new Float32Array(r)}},uL=()=>({enabled:!1,showOverlay:!1,influence:.15,deposit:.3,diffusion:.08,decay:.95}),Xl=e=>e<0?0:e>1?1:e,zk=(e,t,r,o)=>{const s=Math.floor((e+1)/2*r),l=Math.floor((t+1)/2*o),i=Math.max(0,Math.min(r-1,s));return Math.max(0,Math.min(o-1,l))*r+i};function hL(e,t,r,o,s){const l=zk(t,r,e.width,e.height),i=Xl(s);o==="bond"&&(e.bond[l]=Xl(e.bond[l]+i)),o==="rift"&&(e.rift[l]=Xl(e.rift[l]+i)),o==="bloom"&&(e.bloom[l]=Xl(e.bloom[l]+i)),o==="oath"&&(e.oath[l]=Xl(e.oath[l]+i))}function Bk(e,t,r){const o=zk(t,r,e.width,e.height);return{bond:e.bond[o],rift:e.rift[o],bloom:e.bloom[o],oath:e.oath[o]}}function fL(e,t,r){if(!t.enabled)return;const o=e.width,s=e.height,l=e.bond.slice(),i=e.rift.slice(),u=e.bloom.slice(),c=e.oath.slice(),d=t.diffusion*r,h=Math.exp(-t.decay*r);for(let f=0;f<s;f++)for(let g=0;g<o;g++){const m=f*o+g,y=f>0?m-o:m,v=f<s-1?m+o:m,b=g>0?m-1:m,S=g<o-1?m+1:m,C=(l[y]+l[v]+l[b]+l[S]-4*l[m])*d,k=(i[y]+i[v]+i[b]+i[S]-4*i[m])*d,R=(u[y]+u[v]+u[b]+u[S]-4*u[m])*d,j=(c[y]+c[v]+c[b]+c[S]-4*c[m])*d;e.bond[m]=Xl((l[m]+C)*h),e.rift[m]=Xl((i[m]+k)*h),e.bloom[m]=Xl((u[m]+R)*h),e.oath[m]=Xl((c[m]+j)*h)}}const T6={VINCULO:{name:"Vnculo",sigil:"",description:"Coeso local: atrao e pacto temporrio."},RUPTURA:{name:"Ruptura",sigil:"",description:"Fronteira viva: repulso, conflito, cisma."},FLORESCER:{name:"Florescer",sigil:"",description:"Zona frtil: alimento, abundncia, replicao."},JURAMENTO:{name:"Juramento",sigil:"",description:"Ritual: caminho estvel, memria, hbito."},MIXED:{name:"Hbrido",sigil:"",description:"Smbolos competem: regime instvel e criativo."}};function pL(e,t=.22){const r=new Map;for(let s=0;s<e.count;s++){const l=Math.floor((e.x[s]+1)/t),i=Math.floor((e.y[s]+1)/t),u=l+","+i;r.has(u)||r.set(u,[]),r.get(u).push(s)}const o=[];for(const[s,l]of r){if(l.length<8)continue;let i=0,u=0;for(const f of l)i+=e.x[f],u+=e.y[f];const c=i/l.length,d=u/l.length;let h=0;for(const f of l){const g=e.x[f]-c,m=e.y[f]-d;h=Math.max(h,Math.sqrt(g*g+m*m))}o.push({centroid:{x:c,y:d},count:l.length,radius:h})}return o}function mL(e,t,r,o){const s=pL(t),l=[],i=new Set;for(const u of e){let c=-1,d=1e9;for(let h=0;h<s.length;h++){if(i.has(h))continue;const f=s[h].centroid.x-u.centroid.x,g=s[h].centroid.y-u.centroid.y,m=Math.sqrt(f*f+g*g);m<.25&&m<d&&(d=m,c=h)}if(c>=0){i.add(c);const h=s[c],f=h.centroid.x-u.lastCentroid.x,g=h.centroid.y-u.lastCentroid.y,m=Math.sqrt(f*f+g*g),y=Math.abs(h.count-u.particleCount)/Math.max(1,u.particleCount),v=m<.03&&y<.35?1:0,b=gL(u.stability*.85+v*.15);l.push({...u,centroid:h.centroid,lastCentroid:u.centroid,particleCount:h.count,stability:b,lifetime:u.lifetime+r})}}for(let u=0;u<s.length;u++){if(i.has(u))continue;const c=s[u];l.push({id:"cl_"+Math.floor(o*1e3)+"_"+u,centroid:c.centroid,lastCentroid:c.centroid,particleCount:c.count,lifetime:0,stability:.45})}return l.filter(u=>u.lifetime<90)}function gL(e){return e<0?0:e>1?1:e}function yL(e,t,r){if(e.lifetime<6||e.stability<.62||e.particleCount<10)return null;const o=Df(t,e.centroid.x,e.centroid.y),s=Bk(r,e.centroid.x,e.centroid.y),l=Math.max(s.bond,s.rift,s.bloom,s.oath),i=[s.bond,s.rift,s.bloom,s.oath].sort((u,c)=>c-u)[1];if(l>.55&&l-i>.15){if(s.bond===l)return"VINCULO";if(s.rift===l)return"RUPTURA";if(s.bloom===l)return"FLORESCER";if(s.oath===l)return"JURAMENTO"}return o.cohesion>.62?"VINCULO":o.tension>.62?"RUPTURA":o.scarcity<.35?"FLORESCER":o.mythic>.55?"JURAMENTO":null}function xL(e,t,r){const o=T6[t]||T6.MIXED;return{id:e.id,name:o.name,sigil:o.sigil,description:o.description,bornAt:r,locus:{...e.centroid},radius:Math.max(.06,Math.min(.35,.12+e.particleCount/300)),kind:t||"MIXED"}}const ks=["#ff6b9d","#ffd166","#06d6a0","#118ab2","#ef476f","#8ac926","#ff9f1c","#2ec4b6"];function bL(e){const t=new Uint8Array(e),r=new Float32Array(e),o=new Float32Array(e),s=new Float32Array(e);return r.fill(.5),o.fill(.05),{memeId:t,memeStrength:r,prestige:o,lastConvertAt:s}}function vL(){return{enabled:!0,memeCount:6,convertCooldownSec:6,convertRadius:.17,convertRate:.25}}function I6(){return{totems:[],taboos:[],rituals:[],tribes:[],cases:[],config:{enabled:!0,cadenceSec:5,influenceGain:.35,justiceMode:"AUTO",maxTotems:8,maxRituals:8,autoEmergence:!0,simSpeed:.5,showImpactMetrics:!0,enableRoles:!0},tool:"SELECT",selected:null,overlay:{show:!0,showTribes:!0,showNorms:!0,showChronicle:!0},lastTickTime:0,chronicle:[],nextId:1,roleState:{roles:[],enforcerTargets:[]},culture:bL(1e3),cultureConfig:vL()}}function Ql(e,t){const r=`${t}-${String(e.nextId).padStart(3,"0")}`;return e.nextId++,r}function $k(e,t,r){const o=new Array(r).fill(0),s=e.count;if(s===0)return{dominantMeme:0,dominantPct:0,secondMeme:1,secondPct:0,memeCounts:o,schism:!1};for(let h=0;h<s;h++)o[t.memeId[h]%r]++;let l=0,i=-1;for(let h=1;h<r;h++)o[h]>o[l]?(i=l,l=h):(i<0||o[h]>o[i])&&(i=h);i<0&&(i=(l+1)%r);const u=o[l]/s,c=o[i]/s,d=u>=.35&&c>=.28&&u<=.68;return{dominantMeme:l,dominantPct:u,secondMeme:i,secondPct:c,memeCounts:o,schism:d}}function SL(e,t,r){for(let o=0;o<e.count;o++)t.memeId[o]=e.type[o]%r,t.memeStrength[o]=.5,t.prestige[o]=.05,t.lastConvertAt[o]=0}function wL(e,t,r,o,s,l){const i=[],u=t.count;if(u===0||!o.enabled)return i;for(let y=0;y<u;y++)r.memeStrength[y]<.01&&(r.memeId[y]=t.type[y]%o.memeCount,r.memeStrength[y]=.5,r.prestige[y]=.05);const c=Math.max(10,Math.min(800,Math.floor(u*.2))),d=Math.max(1,Math.floor(u/c)),h=o.convertRadius*o.convertRadius;let f=0,g=0,m=0;for(let y=0;y<u;y+=d){if(e-r.lastConvertAt[y]<o.convertCooldownSec)continue;const v=t.x[y],b=t.y[y],S=r.memeId[y];let C=-1,k=-1;for(let P=0;P<u;P++){if(P===y||r.memeId[P]===S)continue;const I=t.x[P]-v,$=t.y[P]-b;if(I*I+$*$>h)continue;const q=r.prestige[P]*r.memeStrength[P];q>C&&(C=q,k=P)}if(k<0)continue;const R=r.prestige[y]*.65,j=C-R;let _=o.convertRate*(1/(1+Math.exp(-j*5)));if(l){const P=l(v,b),I=P.a??.5,$=P.s??0;_=Math.max(0,Math.min(1,_*(1+I*.5-$*.5)))}s.next()<_&&(r.lastConvertAt[y]=e,r.memeId[y]=r.memeId[k],r.memeStrength[y]=r.memeStrength[y]*.65+1*.35,r.prestige[k]=Math.min(1,r.prestige[k]+.01),f++,g+=v,m+=b)}if(f>=4){const y=g/f,v=m/f,b=$k(t,r,o.memeCount);i.push({type:"CONVERSION_WAVE",memeId:b.dominantMeme,count:f,wx:y,wy:v,evidence:`${f} converts, meme #${b.dominantMeme}  ${(b.dominantPct*100).toFixed(0)}%`}),b.dominantPct>=.6&&i.push({type:"CULT_DOMINANCE",memeId:b.dominantMeme,count:Math.round(b.dominantPct*u),wx:y,wy:v,evidence:`meme #${b.dominantMeme} dominates at ${(b.dominantPct*100).toFixed(0)}%`}),b.schism&&i.push({type:"SCHISM_WARNING",memeId:b.dominantMeme,count:0,wx:0,wy:0,evidence:`factions #${b.dominantMeme} ${(b.dominantPct*100).toFixed(0)}% vs #${b.secondMeme} ${(b.secondPct*100).toFixed(0)}%`})}return i}const CL=.025,ML=.04,kL=.65;function RL(e,t,r,o,s){const l=t.count,i=[],u=Math.exp(-.06*e);for(let h=0;h<l;h++)r.prestige[h]=Math.max(0,r.prestige[h]*u);for(const h of o.rituals){const f=o.totems.find(y=>y.id===h.totemId);if(!f||(s-h.bornAt)%h.periodSec/h.periodSec>=h.dutyCycle)continue;const m=(f.radius*1.3)**2;for(let y=0;y<l;y++){const v=t.x[y]-f.pos.x,b=t.y[y]-f.pos.y;v*v+b*b<m&&(r.prestige[y]=Math.min(1,r.prestige[y]+CL*e))}}for(const h of o.taboos){if(h.kind!=="NO_ENTER")continue;const f=h.radius*h.radius;for(let g=0;g<l;g++){const m=t.x[g]-h.pos.x,y=t.y[g]-h.pos.y;m*m+y*y<f&&(r.prestige[g]=Math.max(0,r.prestige[g]-ML*e))}}let c=-1,d=kL-.01;for(let h=0;h<l;h++)r.prestige[h]>d&&(d=r.prestige[h],c=h);return c>=0&&i.push({type:"LEADER_EMERGES",particleIdx:c,prestige:d,memeId:r.memeId[c],wx:t.x[c],wy:t.y[c],evidence:`#${c} prestige ${d.toFixed(2)}, meme #${r.memeId[c]}`}),i}function AL(e,t,r=5){const o=[];for(let s=0;s<e.count;s++)t.prestige[s]>.2&&o.push({idx:s,prestige:t.prestige[s],memeId:t.memeId[s],wx:e.x[s],wy:e.y[s]});return o.sort((s,l)=>l.prestige-s.prestige),o.slice(0,r)}const jL={TOTEM_FOUNDED:{icon:"",template:'TOTEM FOUNDED: {kind} "{name}"',cause:"Placed by the observer",consequence:"Local field bias active"},TOTEM_EMERGED:{icon:"",template:' TOTEM EMERGED: {kind} "{name}"',cause:"Spontaneous crystallization from particle behavior",consequence:"Self-organized field bias now active"},TOTEM_REMOVED:{icon:"",template:'TOTEM REMOVED: "{name}"',cause:"Banished by the observer",consequence:"Field influence dissolved"},TABOO_DECLARED:{icon:"",template:"TABOO DECLARED: {kind} zone",cause:"Zone marked forbidden",consequence:"Boundary enforced"},TABOO_EMERGED:{icon:"",template:" TABOO EMERGED: {kind} boundary",cause:"Collective avoidance pattern detected",consequence:"Self-organized restriction now enforced"},TABOO_REMOVED:{icon:"",template:"TABOO LIFTED: zone dissolved",cause:"Restriction removed",consequence:"Area now open"},RITUAL_STARTED:{icon:"",template:'RITUAL STARTED: {kind} at "{totemName}"',cause:"Ritual bound to totem",consequence:"Periodic gathering active"},RITUAL_EMERGED:{icon:"",template:' RITUAL EMERGED: {kind} at "{totemName}"',cause:"Recurring motion pattern detected",consequence:"Self-organized ceremony now active"},RITUAL_ENDED:{icon:"",template:"RITUAL ENDED at totem",cause:"Ritual dissolved",consequence:"Periodic effect ceased"},TRANSGRESSION:{icon:"",template:"TRANSGRESSION: {tabooKind} taboo violated",cause:"Particles crossed forbidden boundary",consequence:"Case opened for judgment"},JUDGMENT:{icon:"",template:"JUDGMENT: {resolution}",cause:"Case {caseId} resolved",consequence:"{resolution} applied to violators"},SCHISM:{icon:"",template:"SCHISM: tribe split detected",cause:"Divergent ethos",consequence:"New faction emerged"}};function bl(e,t={},r){const o=jL[e],s=l=>l.replace(/\{(\w+)\}/g,(i,u)=>t[u]||"?");return{time:r??Date.now()/1e3,icon:o.icon,message:s(o.template),cause:s(o.cause),consequence:s(o.consequence)}}const P6={BOND:["Hearth","Nexus","Anchor","Haven","Beacon","Cradle","Font","Root"],RIFT:["Rift","Schism","Void","Breach","Divide","Fracture","Scar","Edge"],ORACLE:["Oracle","Whisper","Flux","Tremor","Pulse","Spark","Echo","Haze"],ARCHIVE:["Archive","Memory","Codex","Record","Ledger","Stone","Tablet","Trace"]};let L2=0;function qk(e){const t=P6[e]||P6.BOND,r=t[L2%t.length];return L2++,`${r}-${String(L2).padStart(2,"0")}`}const EL=.003,TL=30,IL=1.3,PL=1.2,Vm=[];function FL(e,t,r){for(;e.roleState.roles.length<t.count;)e.roleState.roles.push("NEUTRAL"),e.roleState.enforcerTargets.push(-1);for(let o=Vm.length-1;o>=0;o--){const s=Vm[o];r>=s.expiresAt&&(s.particleId<t.count&&(e.roleState.roles[s.particleId]="NEUTRAL",e.roleState.enforcerTargets[s.particleId]=-1),Vm.splice(o,1))}for(let o=0;o<t.count;o++){if(e.roleState.roles[o]!=="NEUTRAL"||Math.random()>EL)continue;const s=t.x[o],l=t.y[o],i=t.vx[o],u=t.vy[o],c=Math.sqrt(i*i+u*u);let d=!1,h="";for(const g of e.taboos){const m=(s-g.pos.x)**2+(l-g.pos.y)**2,y=(g.radius*2)**2;if(m<y){d=!0,h=g.id;break}}let f="NEUTRAL";if(d&&e.cases.length>0){if(c<.03)f="VIGILANTE";else if(c>.06){f="ENFORCER";const g=e.cases.find(m=>m.status==="OPEN"&&m.tabooId===h);g&&g.offenderParticleId!==void 0&&(e.roleState.enforcerTargets[o]=g.offenderParticleId)}}else c>.08&&(f="RESISTER");f!=="NEUTRAL"&&(e.roleState.roles[o]=f,Vm.push({particleId:o,role:f,expiresAt:r+TL}))}}function NL(e,t,r){if(e.config.enableRoles)for(let o=0;o<t.count;o++){const s=e.roleState.roles[o];if(!s||s==="NEUTRAL")continue;const l=t.x[o],i=t.y[o];if(s==="ENFORCER"){const u=e.roleState.enforcerTargets[o];if(u>=0&&u<t.count){const c=t.x[u],d=t.y[u],h=c-l,f=d-i,g=Math.sqrt(h*h+f*f);if(g>.01){const m=.03*r*IL;t.vx[o]+=h/g*m,t.vy[o]+=f/g*m}}}else if(s==="VIGILANTE"){let u=null,c=1/0;for(const d of e.taboos){const h=(l-d.pos.x)**2+(i-d.pos.y)**2;h<c&&(c=h,u=d)}if(u){const d=l-u.pos.x,h=i-u.pos.y,f=Math.sqrt(d*d+h*h);if(f>.01){const g=-h/f,m=d/f,y=.015*r;t.vx[o]+=g*y,t.vy[o]+=m*y;const v=u.radius*1.5,b=(f-v)*.02*r;t.vx[o]-=d/f*b,t.vy[o]-=h/f*b}}}else if(s==="RESISTER"){let u=null,c=1/0;for(const d of e.taboos){const h=(l-d.pos.x)**2+(i-d.pos.y)**2;h<c&&h>(d.radius*.5)**2&&(c=h,u=d)}if(u){const d=u.pos.x-l,h=u.pos.y-i,f=Math.sqrt(d*d+h*h);if(f>.01){const g=.02*r*PL;t.vx[o]+=d/f*g,t.vy[o]+=h/f*g}}}}}const z2=new Map;function OL(e,t){if(!z2.has(e)){const o=e.split("").reduce((s,l)=>s+l.charCodeAt(0),0);z2.set(e,{angle:o%360*Math.PI/180,phase:0})}const r=z2.get(e);return r.phase+=.03,r.angle+=Math.sin(r.phase)*.1,{x:Math.cos(r.angle),y:Math.sin(r.angle)}}const _L=.3,DL=12,LL=80;function gu(e,t,r,o,s){e.vx[t]+=Math.max(-.025,Math.min(.025,r*s)),e.vy[t]+=Math.max(-.025,Math.min(.025,o*s))}function Yl(e,t,r,o){const s=e-r,l=t-o;return s*s+l*l}function zL(e,t,r){if(!e.config.enabled)return[];const o=[],s=e.config.influenceGain*e.config.simSpeed,l=t.count;e.totems.forEach(u=>u.affectedCount=0),e.taboos.forEach(u=>u.affectedCount=0),e.rituals.forEach(u=>u.affectedCount=0),e.config.enableRoles&&FL(e,t,r);for(const u of e.totems){const c=u.radius*u.radius,d=u.strength*s;for(let h=0;h<l;h++){const f=t.x[h],g=t.y[h],m=Yl(f,g,u.pos.x,u.pos.y);if(m>c||m<1e-8)continue;u.affectedCount++;const v=1-Math.sqrt(m)/u.radius;if(u.kind==="BOND"){const b=(u.pos.x-f)*v*d*1.2,S=(u.pos.y-g)*v*d*1.2;gu(t,h,b,S,1)}else if(u.kind==="RIFT"){const b=(f-u.pos.x)*v*d*.9,S=(g-u.pos.y)*v*d*.9;gu(t,h,b,S,1)}else if(u.kind==="ORACLE"){const b=OL(u.id),S=b.x*v*d*.4,C=b.y*v*d*.4;gu(t,h,S,C,1)}}}for(const u of e.taboos){const c=u.radius*u.radius;let d=0;for(let h=0;h<l;h++){const f=t.x[h],g=t.y[h],m=Yl(f,g,u.pos.x,u.pos.y);if(u.kind==="NO_ENTER"){if(m<c){u.affectedCount++;const y=Math.sqrt(m),v=1-y/u.radius,b=(f-u.pos.x)/(y+1e-6),S=(g-u.pos.y)/(y+1e-6),C=v*u.intensity*s*2;gu(t,h,b*C,S*C,1),d+=v}}else u.kind==="NO_MIX"&&m<c&&u.targetType!==void 0&&t.type[h]===u.targetType&&(u.affectedCount++,t.vx[h]*=1-u.intensity*s*.35,t.vy[h]*=1-u.intensity*s*.35,d+=.3)}if(d>_L){const h=e.cases.find(m=>m.tabooId===u.id&&m.status==="OPEN"),f=e.cases.filter(m=>m.tabooId===u.id&&m.status==="RESOLVED").sort((m,y)=>(y.resolvedAt||0)-(m.resolvedAt||0))[0];if(!h&&(!f||r-(f.resolvedAt||0)>DL)){const m={id:Ql(e,"case"),tabooId:u.id,status:"OPEN",resolution:null,createdAt:r};e.cases.push(m);const y=bl("TRANSGRESSION",{tabooKind:u.kind,tabooId:u.id,violationStrength:d.toFixed(2)},r);o.push(y),BL(e,m,t,r,o)}}}for(const u of e.rituals){const c=e.totems.find(m=>m.id===u.totemId);if(!c||!((r-u.bornAt)%u.periodSec/u.periodSec<u.dutyCycle))continue;const f=c.radius*c.radius,g=u.intensity*s;for(let m=0;m<t.count;m++){const y=t.x[m],v=t.y[m],b=Yl(y,v,c.pos.x,c.pos.y);if(b>f*2.25||b<1e-8)continue;u.affectedCount++;const S=Math.sqrt(b);if(u.kind==="GATHER"){const C=(c.pos.x-y)/S,k=(c.pos.y-v)/S,R=g*1.5*Math.min(1,S/c.radius);gu(t,m,C*R,k*R,1)}else if(u.kind==="PROCESSION"){const C=(c.pos.x-y)/S,k=(c.pos.y-v)/S,R=-k,j=C,T=g*1.2,_=g*.4*(1-S/(c.radius*1.2));gu(t,m,R*T+C*_,j*T+k*_,1)}else if(u.kind==="OFFERING"){const C=1-S/(c.radius*1.5);C>0&&(t.vx[m]*=1-C*g*.45,t.vy[m]*=1-C*g*.45)}}}for(e.config.enableRoles&&NL(e,t,s);e.chronicle.length>LL;)e.chronicle.pop();const i=e.cases.filter(u=>u.status==="RESOLVED");if(i.length>20){const u=i.slice(0,i.length-20);e.cases=e.cases.filter(c=>!u.includes(c))}return o}function BL(e,t,r,o,s){const l=e.taboos.find(c=>c.id===t.tabooId);if(!l)return;let i=e.config.justiceMode;if(i==="AUTO"){let c=0;const d=l.radius*l.radius;for(let h=0;h<r.count;h++)Yl(r.x[h],r.y[h],l.pos.x,l.pos.y)<d&&c++;i=c>15?"RETRIBUTIVE":"RESTORATIVE"}if(i==="RETRIBUTIVE"){t.resolution="PUNISH";const c=l.radius*l.radius;for(let d=0;d<r.count;d++)if(Yl(r.x[d],r.y[d],l.pos.x,l.pos.y)<c){const h=Math.sqrt(Yl(r.x[d],r.y[d],l.pos.x,l.pos.y));if(h>1e-6){const f=(r.x[d]-l.pos.x)/h,g=(r.y[d]-l.pos.y)/h;r.vx[d]+=f*.08,r.vy[d]+=g*.08}r.vx[d]*=.5,r.vy[d]*=.5}}else{t.resolution="RESTORE";const c=e.totems.reduce((d,h)=>{if(!d)return h;const f=Yl(h.pos.x,h.pos.y,l.pos.x,l.pos.y),g=Yl(d.pos.x,d.pos.y,l.pos.x,l.pos.y);return f<g?h:d},null);if(c){const d=l.radius*l.radius*2;for(let h=0;h<r.count;h++)if(Yl(r.x[h],r.y[h],l.pos.x,l.pos.y)<d){const f=c.pos.x-r.x[h],g=c.pos.y-r.y[h],m=Math.sqrt(f*f+g*g);m>1e-6&&(r.vx[h]+=f/m*.025,r.vy[h]+=g/m*.025)}}}t.status="RESOLVED",t.resolvedAt=o;const u=bl("JUDGMENT",{resolution:t.resolution,tabooId:t.tabooId,caseId:t.id},o);s.push(u)}function $L(e,t){const r=e.config.cadenceSec/e.config.simSpeed;return e.config.enabled&&t-e.lastTickTime>=r}const bv={BOND:"#5ac8fa",RIFT:"#ff6b6b",ORACLE:"#c084fc",ARCHIVE:"#94a3b8"},Wk={NO_ENTER:"#ef4444",NO_MIX:"#f97316"},qL=12,Hc=[];function kc(e,t,r,o,s,l=4){Hc.push({x:e,y:t,bornAt:s,color:o,label:r,duration:l}),Hc.length>qL&&Hc.shift()}const Hk=6,yh=[];function Ai(e,t,r="#ffffff"){yh.unshift({time:e,text:t,color:r}),yh.length>Hk&&yh.pop()}function Og(e,t,r,o){return[(e+1)*.5*r,(-t+1)*.5*o]}function vv(e,t,r){return e*.5*Math.min(t,r)}function WL(e,t,r,o,s,l,i="off"){if(!t.overlay.show)return;if(e.save(),i==="culture"&&l&&HL(e,t,l,r,o),t.overlay.showNorms)for(const c of t.taboos)VL(e,c,t,r,o,i==="law");const u=i==="ritual"||i==="culture"||i==="law"||i==="off";for(const c of t.totems)GL(e,c,t,r,o,s,u);for(const c of t.rituals)UL(e,c,t,r,o,s);(i==="events"||i==="culture"||i==="off")&&YL(e,r,o,s),KL(e,r,o,s),e.restore()}function HL(e,t,r,o,s,l){const i=t.culture,u=t.cultureConfig,c=r.count;if(c===0)return;e.save();for(let S=0;S<u.memeCount;S++){const C=ks[S%ks.length];e.fillStyle=C,e.globalAlpha=.6,e.beginPath();for(let k=0;k<c;k++){if(i.memeId[k]%u.memeCount!==S)continue;const R=(r.x[k]+1)*.5*o,j=(-r.y[k]+1)*.5*s;e.moveTo(R+2,j),e.arc(R,j,2,0,Math.PI*2)}e.fill()}const d=[];for(let S=0;S<c;S++)i.prestige[S]>.3&&d.push({i:S,p:i.prestige[S]});d.sort((S,C)=>C.p-S.p);for(const{i:S,p:C}of d.slice(0,10)){const k=(r.x[S]+1)*.5*o,R=(-r.y[S]+1)*.5*s,j=ks[i.memeId[S]%ks.length],T=6+C*14,_=e.createRadialGradient(k,R,0,k,R,T);_.addColorStop(0,j),_.addColorStop(1,"transparent"),e.fillStyle=_,e.globalAlpha=.12+C*.28,e.beginPath(),e.arc(k,R,T,0,Math.PI*2),e.fill(),C>.55&&(e.beginPath(),e.arc(k,R,4+C*4,0,Math.PI*2),e.strokeStyle=j,e.lineWidth=1.2,e.globalAlpha=.7,e.stroke())}const h=.22*.5*Math.min(o,s),f=h*h;e.lineWidth=.6,e.setLineDash([2,5]);for(const{i:S,p:C}of d.slice(0,3)){if(C<.5)break;const k=(r.x[S]+1)*.5*o,R=(-r.y[S]+1)*.5*s,j=i.memeId[S],T=ks[j%ks.length];e.strokeStyle=T,e.globalAlpha=.1+C*.08;const _=Math.max(1,Math.floor(c/80));let P=0;for(let I=0;I<c&&P<5;I+=_){if(I===S||i.memeId[I]!==j)continue;const $=(r.x[I]+1)*.5*o,q=(-r.y[I]+1)*.5*s,L=$-k,H=q-R;L*L+H*H>f||(e.beginPath(),e.moveTo(k,R),e.lineTo($,q),e.stroke(),P++)}}e.setLineDash([]);const g=new Array(u.memeCount).fill(0);for(let S=0;S<c;S++)g[i.memeId[S]%u.memeCount]++;let m=0;for(let S=1;S<u.memeCount;S++)g[S]>g[m]&&(m=S);const y=c>0?g[m]/c:0,v=ks[m%ks.length],b=d.filter(S=>S.p>.5).length;e.globalAlpha=.85,e.font="10px system-ui, sans-serif",e.textAlign="left",e.textBaseline="top",e.fillStyle="#000000",e.globalAlpha=.35,e.fillRect(12,12,180,38),e.globalAlpha=.9,e.fillStyle=v,e.fillText(`Meme #${m} dominant: ${(y*100).toFixed(0)}%`,18,18),e.fillStyle="#ffffff",e.globalAlpha=.55,e.fillText(`Leaders: ${b}  |  ${u.memeCount} memes active`,18,32),e.restore()}function GL(e,t,r,o,s,l,i=!0){var m;const[u,c]=Og(t.pos.x,t.pos.y,o,s),d=vv(t.radius,o,s),h=bv[t.kind]||"#ffffff",f=((m=r.selected)==null?void 0:m.type)==="totem"&&r.selected.id===t.id;if(i){const y=1+.04*Math.sin(l*1.5+t.bornAt);e.beginPath(),e.arc(u,c,d*y,0,Math.PI*2),e.strokeStyle=h,e.lineWidth=f?1.5:.8,e.globalAlpha=f?.35:.12,e.stroke(),e.globalAlpha=.025,e.fillStyle=h,e.fill()}const g=e.createRadialGradient(u,c,0,u,c,10);if(g.addColorStop(0,h),g.addColorStop(1,"transparent"),e.beginPath(),e.arc(u,c,10,0,Math.PI*2),e.fillStyle=g,e.globalAlpha=.5,e.fill(),e.beginPath(),e.arc(u,c,f?4.5:3.5,0,Math.PI*2),e.fillStyle=h,e.globalAlpha=.9,e.fill(),t.emergent){const y=(l*.8+t.bornAt)%(Math.PI*2);e.globalAlpha=.4,e.fillStyle=h;for(let v=0;v<3;v++){const b=y+v/3*Math.PI*2,S=u+Math.cos(b)*(d*.4),C=c+Math.sin(b)*(d*.4);e.beginPath(),e.arc(S,C,1.5,0,Math.PI*2),e.fill()}}f&&(e.globalAlpha=.6,e.fillStyle=h,e.font="9px system-ui, sans-serif",e.textAlign="center",e.textBaseline="top",e.fillText(t.name,u,c+8))}function VL(e,t,r,o,s,l=!1){var g;const[i,u]=Og(t.pos.x,t.pos.y,o,s),c=vv(t.radius,o,s),d=Wk[t.kind]||"#ef4444",h=((g=r.selected)==null?void 0:g.type)==="taboo"&&r.selected.id===t.id;e.beginPath(),e.arc(i,u,c,0,Math.PI*2),e.setLineDash([4,4]),e.strokeStyle=d,e.lineWidth=h?1.5:.8,e.globalAlpha=h?.5:.2,e.stroke(),e.setLineDash([]),(l||h)&&(e.beginPath(),e.arc(i,u,c,0,Math.PI*2),e.fillStyle=d,e.globalAlpha=.04+t.intensity*.03,e.fill()),e.globalAlpha=h?.6:.25,e.strokeStyle=d,e.lineWidth=1.2;const f=4;e.beginPath(),e.moveTo(i-f,u-f),e.lineTo(i+f,u+f),e.moveTo(i+f,u-f),e.lineTo(i-f,u+f),e.stroke()}function UL(e,t,r,o,s,l){const i=r.totems.find(b=>b.id===t.totemId);if(!i)return;const[u,c]=Og(i.pos.x,i.pos.y,o,s),d=vv(i.radius,o,s),h=bv[i.kind]||"#ffffff",f=(l-t.bornAt)%t.periodSec/t.periodSec;if(!(f<t.dutyCycle)){e.beginPath(),e.arc(u,c,d*1.3,0,Math.PI*2),e.setLineDash([2,6]),e.strokeStyle=h,e.lineWidth=.5,e.globalAlpha=.06,e.stroke(),e.setLineDash([]);return}const m=f/t.dutyCycle,y=d*(1.1+.25*Math.sin(m*Math.PI*2));e.beginPath(),e.arc(u,c,y,0,Math.PI*2),e.strokeStyle=h,e.lineWidth=1.5,e.globalAlpha=.18+.12*Math.sin(m*Math.PI),e.stroke();const v=d*(1+.2*Math.cos(m*Math.PI*2));if(e.beginPath(),e.arc(u,c,v,0,Math.PI*2),e.lineWidth=.7,e.globalAlpha=.08,e.stroke(),t.kind==="PROCESSION"){const b=m*Math.PI*4,S=u+Math.cos(b)*y*.7,C=c+Math.sin(b)*y*.7;e.beginPath(),e.arc(S,C,2.5,0,Math.PI*2),e.fillStyle=h,e.globalAlpha=.5,e.fill()}else if(t.kind==="GATHER"){e.globalAlpha=.15,e.strokeStyle=h,e.lineWidth=1;for(let b=0;b<4;b++){const S=b/4*Math.PI*2+l*.3,C=y*.95,k=d*.4;e.beginPath(),e.moveTo(u+Math.cos(S)*C,c+Math.sin(S)*C),e.lineTo(u+Math.cos(S)*k,c+Math.sin(S)*k),e.stroke()}}}function YL(e,t,r,o){for(let s=Hc.length-1;s>=0;s--)o-Hc[s].bornAt>Hc[s].duration&&Hc.splice(s,1);for(const s of Hc){const i=(o-s.bornAt)/s.duration,[u,c]=Og(s.x,s.y,t,r),d=35+i*25,h=(1-i)*.5;if(e.beginPath(),e.arc(u,c,d*i,0,Math.PI*2),e.strokeStyle=s.color,e.lineWidth=1.5*(1-i)+.3,e.globalAlpha=h,e.stroke(),i>.15){const f=Math.max(0,i-.15);e.beginPath(),e.arc(u,c,d*f,0,Math.PI*2),e.lineWidth=.8*(1-f),e.globalAlpha=h*.5,e.stroke()}if(i<.6){const f=(1-i/.6)*.7;e.globalAlpha=f,e.fillStyle=s.color,e.font="9px system-ui, sans-serif",e.textAlign="center",e.textBaseline="bottom";const g=-20-i*12;e.fillText(s.label,u,c+g)}}}function KL(e,t,r,o){if(yh.length===0)return;const s=16,l=r-20,i=16;e.font="10px system-ui, sans-serif",e.textAlign="left",e.textBaseline="bottom";for(let u=0;u<Math.min(yh.length,Hk);u++){const c=yh[u],d=o-c.time,h=8,f=28;let g;if(d<h)g=.75;else if(d<f)g=.75*(1-(d-h)/(f-h));else{g=0;continue}d<1&&(g=.75+.25*(1-d));const m=l-u*i;e.globalAlpha=g*.3,e.fillStyle="#000000",e.fillText(c.text,s+1,m+1),e.globalAlpha=g,e.fillStyle=c.color,e.fillText(c.text,s,m)}}function XL(e,t,r,o,s,l,i){if(t==="SELECT"||r<0||o<0)return;e.save();const u=35;if(t==="TOTEM"){const c=bv[i||"BOND"]||"#5ac8fa";e.beginPath(),e.arc(r,o,u,0,Math.PI*2),e.strokeStyle=c,e.lineWidth=1,e.globalAlpha=.3,e.stroke(),e.beginPath(),e.arc(r,o,4,0,Math.PI*2),e.fillStyle=c,e.globalAlpha=.7,e.fill(),e.globalAlpha=.4,e.font="9px system-ui, sans-serif",e.textAlign="center",e.textBaseline="top",e.fillText(i||"BOND",r,o+10)}else if(t==="TABOO"){const c=Wk[i||"NO_ENTER"]||"#ef4444";e.beginPath(),e.arc(r,o,u,0,Math.PI*2),e.setLineDash([4,4]),e.strokeStyle=c,e.lineWidth=1,e.globalAlpha=.3,e.stroke(),e.setLineDash([]),e.globalAlpha=.4,e.strokeStyle=c,e.lineWidth=1.2;const d=5;e.beginPath(),e.moveTo(r-d,o-d),e.lineTo(r+d,o+d),e.moveTo(r+d,o-d),e.lineTo(r-d,o+d),e.stroke(),e.globalAlpha=.4,e.fillStyle=c,e.font="9px system-ui, sans-serif",e.textAlign="center",e.textBaseline="top",e.fillText((i||"NO_ENTER").replace("_"," "),r,o+10)}else if(t==="RITUAL"){const c=i==="PROCESSION"?"#c084fc":i==="OFFERING"?"#fbbf24":"#34d399";e.beginPath(),e.arc(r,o,u*1.1,0,Math.PI*2),e.setLineDash([3,5]),e.strokeStyle=c,e.lineWidth=1,e.globalAlpha=.25,e.stroke(),e.setLineDash([]),e.globalAlpha=.4,e.fillStyle=c,e.font="9px system-ui, sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillText(i||"GATHER",r,o),e.globalAlpha=.25,e.font="8px system-ui, sans-serif",e.textBaseline="top",e.fillText("click a totem",r,o+12)}e.restore()}function ZL(e,t,r){if(e.totems.length===0){e.tribes=[];return}const o=new Map;for(const i of e.totems){const u=new Map,c=i.radius*i.radius;for(let d=0;d<t.count;d++){const h=t.x[d]-i.pos.x,f=t.y[d]-i.pos.y;if(h*h+f*f<c){const g=t.type[d];u.set(g,(u.get(g)||0)+1)}}o.set(i.id,u)}const s=new Map;for(const i of e.totems){const u=o.get(i.id);if(!u||u.size===0)continue;let c=0,d=-1;for(const[h,f]of u)f>c&&(c=f,d=h);d>=0&&c>=3&&(s.has(d)||s.set(d,[]),s.get(d).push(i.id))}const l=[];for(const[i,u]of s){const c=e.tribes.find(d=>d.typeId===i);if(c)c.totems=u,l.push(c);else if(u.length>=1){const d=i*1e3+Math.floor(r*.1);l.push({id:Ql(e,"tribe"),typeId:i,totems:u,ethos:{cohesionBias:Math.sin(d*.0073)*.2,tensionBias:Math.cos(d*.0057)*.2},bornAt:r})}}e.tribes=l}function JL(e,t,r,o,s){const{R:l,gridW:i,gridH:u}=t,c=o/i,d=s/u;e.save(),e.globalCompositeOperation="source-over";for(let h=0;h<u;h++)for(let f=0;f<i;f++){const g=l[h*i+f];if(g<.05)continue;let m=0,y=0,v=0;if(g<.5){const S=g/.5;m=Math.round(20*(1-S)+80*S),y=Math.round(60*(1-S)+200*S),v=Math.round(20*(1-S)+40*S)}else{const S=(g-.5)/.5;m=Math.round(80*(1-S)+255*S),y=Math.round(200*(1-S)+255*S),v=Math.round(40*(1-S)+100*S)}const b=g*.45;e.fillStyle=`rgba(${m},${y},${v},${b})`,e.fillRect(Math.floor(f*c),Math.floor(h*d),Math.ceil(c)+1,Math.ceil(d)+1)}e.globalAlpha=.55,e.fillStyle="#ffffff",e.font="9px system-ui, sans-serif",e.textAlign="right",e.textBaseline="top",e.fillText(" Resource Field",o-10,10),e.restore()}function QL(e,t,r,o){const{claimOwner:s,claimStrength:l,gridW:i,gridH:u}=t,c=r/i,d=o/u;e.save();for(let h=0;h<u;h++)for(let f=0;f<i;f++){const g=h*i+f,m=s[g];if(m<0)continue;const y=l[g];if(y<.04)continue;const v=ks[m%ks.length];e.fillStyle=v,e.globalAlpha=y*.35,e.fillRect(Math.floor(f*c),Math.floor(h*d),Math.ceil(c)+1,Math.ceil(d)+1)}for(let h=0;h<u;h++)for(let f=0;f<i;f++){const g=h*i+f;if(l[g]<.6)continue;const m=f<i-1?s[h*i+f+1]:-1,y=h<u-1?s[(h+1)*i+f]:-1,v=s[g];v<0||(m>=0&&m!==v||y>=0&&y!==v)&&(e.fillStyle=ks[v%ks.length],e.globalAlpha=.6,e.fillRect(Math.floor(f*c),Math.floor(h*d),Math.ceil(c),Math.ceil(d)))}e.globalAlpha=.55,e.fillStyle="#ffffff",e.font="9px system-ui, sans-serif",e.textAlign="right",e.textBaseline="top",e.fillText(" Territory Claims",r-10,10),e.restore()}const ez=20,hd=8,ag=10,tz=.07,nz=.02;function rz(e,t,r){if(!e.config.enabled)return;const o=oz(t);az(e,t,o,r),sz(e,t,o,r),iz(e,t,r)}function oz(e){const t=new Map;for(let r=0;r<e.count;r++){const o=e.x[r],s=e.y[r],l=e.vx[r],i=e.vy[r],u=e.type[r],c=Math.floor(o*ag),d=Math.floor(s*ag),h=`${c},${d}`;let f=t.get(h);f||(f={count:0,typeCount:new Map,avgVx:0,avgVy:0,sumVel:0,centroidX:0,centroidY:0},t.set(h,f)),f.count++,f.typeCount.set(u,(f.typeCount.get(u)||0)+1),f.avgVx+=l,f.avgVy+=i,f.sumVel+=Math.sqrt(l*l+i*i),f.centroidX+=o,f.centroidY+=s}for(const r of t.values())r.count>0&&(r.avgVx/=r.count,r.avgVy/=r.count,r.sumVel/=r.count,r.centroidX/=r.count,r.centroidY/=r.count);return t}function az(e,t,r,o){if(!(e.totems.length>=e.config.maxTotems))for(const[s,l]of r.entries()){if(l.count<hd)continue;const i=l.centroidX,u=l.centroidY;if(e.totems.some(h=>(h.pos.x-i)**2+(h.pos.y-u)**2<.08))continue;let d=null;if(l.sumVel>tz&&l.count>hd*.5)d="ORACLE";else if(l.sumVel<nz&&l.count>hd*.7)d="ARCHIVE";else{const h=lz(l.typeCount);(h?(l.typeCount.get(h)||0)/l.count:0)>.6&&l.sumVel<.05&&l.count>hd&&(d="BOND")}if(d||l.typeCount.size/Math.min(t.count/8,5)>.5&&l.sumVel>.025&&l.sumVel<.08&&l.count>hd*.6&&(d="RIFT"),d&&e.totems.length<e.config.maxTotems){if(e.totems.filter(y=>y.emergent&&o-y.bornAt<30).length>=3)continue;const f=qk(d),g={id:Ql(e,"totem"),kind:d,pos:{x:i,y:u},radius:.15,strength:.8,pinned:!1,bornAt:o,name:f,emergent:!0,affectedCount:0};e.totems.push(g);const m=bl("TOTEM_EMERGED",{kind:d,name:f},o);e.chronicle.unshift(m),console.log(` TOTEM EMERGED: ${d} "${f}" at (${i.toFixed(2)}, ${u.toFixed(2)})`)}}}function sz(e,t,r,o){if(!(e.taboos.length>=6))for(const[s,l]of r.entries()){const i=l.centroidX,u=l.centroidY;if(!e.taboos.some(d=>(d.pos.x-i)**2+(d.pos.y-u)**2<.06)){if(l.count===0){const d=F6(s,r);if(d.reduce((f,g)=>f+g.count,0)/(d.length||1)>hd*.6){const[f,g]=s.split(",").map(Number),m={id:Ql(e,"taboo"),kind:"NO_ENTER",pos:{x:(f+.5)/ag,y:(g+.5)/ag},radius:.1,intensity:.7,bornAt:o,emergent:!0,affectedCount:0};e.taboos.push(m);const y=bl("TABOO_EMERGED",{kind:"NO_ENTER"},o);e.chronicle.unshift(y),console.log(` TABOO EMERGED: NO_ENTER at (${m.pos.x.toFixed(2)}, ${m.pos.y.toFixed(2)})`);return}}if(l.count>hd*.4&&l.typeCount.size===1){const d=Array.from(l.typeCount.keys())[0];if(F6(s,r).some(g=>{const m=Array.from(g.typeCount.keys()).filter(y=>y!==d);return m.length>0&&g.typeCount.get(m[0])>2})&&e.taboos.length<6){const g={id:Ql(e,"taboo"),kind:"NO_MIX",pos:{x:i,y:u},radius:.12,intensity:.6,targetType:d,bornAt:o,emergent:!0,affectedCount:0};e.taboos.push(g);const m=bl("TABOO_EMERGED",{kind:"NO_MIX"},o);e.chronicle.unshift(m),console.log(` TABOO EMERGED: NO_MIX at (${i.toFixed(2)}, ${u.toFixed(2)}) for type ${d}`);return}}}}}function iz(e,t,r){if(!(e.rituals.length>=e.config.maxRituals)&&e.totems.length!==0)for(const o of e.totems){if(e.rituals.some(h=>h.totemId===o.id))continue;if(e.rituals.length>=e.config.maxRituals)return;let s=0,l=0,i=0,u=0;const c=(o.radius*2.5)**2;for(let h=0;h<t.count;h++){const f=t.x[h]-o.pos.x,g=t.y[h]-o.pos.y,m=f*f+g*g;if(m<c&&m>1e-6){s++;const y=Math.sqrt(m),v=f/y,b=g/y,S=t.vx[h]*v+t.vy[h]*b;l+=S;const C=-b,k=v,R=Math.abs(t.vx[h]*C+t.vy[h]*k);i+=R,u+=Math.sqrt(t.vx[h]**2+t.vy[h]**2)}}if(s<4)continue;l/=s,i/=s,u/=s;let d=null;if(i>.02&&Math.abs(l)<.02?d="PROCESSION":l<-.008&&i<.025?d="GATHER":u<.03&&s>5&&(d="OFFERING"),d){const h={id:Ql(e,"ritual"),kind:d,totemId:o.id,periodSec:8,dutyCycle:.4,intensity:.7,bornAt:r,emergent:!0,affectedCount:0};e.rituals.push(h);const f=bl("RITUAL_EMERGED",{kind:d,totemName:o.name},r);e.chronicle.unshift(f),console.log(` RITUAL EMERGED: ${d} at totem "${o.name}"`)}}}function lz(e){let t=0,r=null;for(const[o,s]of e.entries())s>t&&(t=s,r=o);return r}function F6(e,t){const[r,o]=e.split(",").map(Number),s=[];for(let l=-1;l<=1;l++)for(let i=-1;i<=1;i++){if(l===0&&i===0)continue;const u=`${r+l},${o+i}`,c=t.get(u);c&&s.push(c)}return s}function cz(e,t){return t-e>=ez}function dz(e,t,r){if(t==="off")return;const o=e.attract.length,s=.002;switch(t){case"culture":{for(let l=0;l<o;l++)e.attract[l][l]=Math.min(1.5,e.attract[l][l]+s*3);break}case"field":{for(let l=0;l<o;l++)for(let i=0;i<o;i++){const u=Math.sign(e.attract[l][i]);e.attract[l][i]=Math.max(-1.5,Math.min(1.5,e.attract[l][i]+u*s*2))}break}case"ritual":{for(let l=0;l<o;l++)e.attract[l][l]=Math.min(1.5,e.attract[l][l]+s*4);break}case"law":{for(let l=0;l<o;l++)for(let i=0;i<o;i++)e.attract[l][i]*=1-s*3;break}case"events":{for(let l=0;l<o;l++)for(let i=0;i<o;i++)if(Math.abs(e.attract[l][i])>.3){const u=Math.sign(e.attract[l][i]);e.attract[l][i]=Math.max(-1.5,Math.min(1.5,e.attract[l][i]+u*s*4))}break}}}function uz(e,t){if(t.tribes.length===0)return;const r=.001;for(const o of t.tribes){const s=o.typeId;if(s>=e.attract.length)continue;const l=r*(1+o.ethos.cohesionBias);e.attract[s][s]+=l,e.attract[s][s]=Math.min(1.5,e.attract[s][s]);const i=r*(.5+o.ethos.tensionBias);for(let u=0;u<e.attract.length;u++)u!==s&&e.attract[s][u]>-1&&(e.attract[s][u]-=i,e.attract[s][u]=Math.max(-1.5,e.attract[s][u]))}}const yu=12,B2=.2,N6=4;function hz(e,t,r){if(e.count<20)return[];const o=new Map;for(let h=0;h<e.count;h++){const f=Math.floor((e.x[h]+1)*yu/2),g=Math.floor((e.y[h]+1)*yu/2),m=`${f},${g}`;o.has(m)||o.set(m,[]),o.get(m).push(h)}const s=new Float32Array(e.count),l=B2*B2,i=Math.max(1,Math.floor(e.count/300));for(let h=0;h<e.count;h+=i){const f=e.x[h],g=e.y[h],m=e.type[h],y=Math.floor((f+1)*yu/2),v=Math.floor((g+1)*yu/2);let b=0,S=0,C=0,k=0;for(let R=-1;R<=1;R++)for(let j=-1;j<=1;j++){const T=`${y+R},${v+j}`,_=o.get(T);if(_)for(const P of _){if(h===P)continue;const I=e.x[P]-f,$=e.y[P]-g;I*I+$*$<l&&(b++,e.type[P]===m&&(S++,C+=I,k+=$))}}if(S>=N6){C/=S,k/=S;const R=Math.sqrt(C*C+k*k),j=Math.max(0,1-R/.08);s[h]=S*.5+j*30+b*.2}}const u=Math.min(6,Math.ceil(e.count*.02)),c=[];for(let h=0;h<e.count;h+=i)s[h]>0&&c.push({idx:h,score:s[h]});c.sort((h,f)=>f.score-h.score);const d=[];for(const h of c){if(d.length>=u)break;const f=h.idx,g=e.type[f];if(d.filter(k=>k.type===g).length>=2)continue;const m=[],y=e.x[f],v=e.y[f],b=Math.floor((y+1)*yu/2),S=Math.floor((v+1)*yu/2),C=(B2*1.5)**2;for(let k=-1;k<=1;k++)for(let R=-1;R<=1;R++){const j=`${b+k},${S+R}`,T=o.get(j);if(T)for(const _ of T){if(_===f||e.type[_]!==g)continue;const P=e.x[_]-y,I=e.y[_]-v;P*P+I*I<C&&m.push(_)}}m.length<N6||d.push({particleIndex:f,type:g,influence:Math.min(1,h.score/60),followers:m,bornAt:r,x:e.x[f],y:e.y[f]})}return d}function fz(e,t,r){for(const o of t){if(o.particleIndex>=e.count)continue;const s=e.x[o.particleIndex],l=e.y[o.particleIndex],i=o.influence*r*.008;for(const c of o.followers){if(c>=e.count)continue;const d=s-e.x[c],h=l-e.y[c],f=Math.sqrt(d*d+h*h);if(f>.005&&f<.4){const g=i*Math.min(1,f*5);e.vx[c]+=d/f*g,e.vy[c]+=h/f*g}}if(Math.sqrt(e.vx[o.particleIndex]**2+e.vy[o.particleIndex]**2)>.001){const c=1+o.influence*.02;e.vx[o.particleIndex]*=c,e.vy[o.particleIndex]*=c}}}function pz(e,t,r,o,s){if(t.length!==0){e.save();for(const l of t){const i=(l.x+1)*.5*r,u=(-l.y+1)*.5*o,c=s[l.type%s.length]||"#ffffff",d=3+l.influence*3,h=e.createRadialGradient(i,u,0,i,u,d*4);h.addColorStop(0,c),h.addColorStop(1,"transparent"),e.fillStyle=h,e.globalAlpha=.2,e.beginPath(),e.arc(i,u,d*4,0,Math.PI*2),e.fill(),e.fillStyle="#ffffff",e.globalAlpha=.6,e.beginPath(),e.arc(i,u,d*.6,0,Math.PI*2),e.fill()}e.restore()}}const mz={draft:"Draft (3 Mbps)",standard:"Standard (8 Mbps)",high:"High (20 Mbps)",ultra:"Ultra (40 Mbps)"},sg={auto:"Auto",webm:"WebM",mp4:"MP4",mov:"MOV (QT)"},gz={draft:3e6,standard:8e6,high:2e7,ultra:4e7};function Sv(e){const t=Math.floor(e/60).toString().padStart(2,"0"),r=Math.floor(e%60).toString().padStart(2,"0");return`${t}:${r}`}function yz(e){if(e==="mp4"||e==="mov"||e==="auto"){const r=["video/mp4;codecs=avc1","video/mp4;codecs=h264","video/mp4"];for(const o of r)try{if(MediaRecorder.isTypeSupported(o))return{mime:o,ext:e==="mov"?"mov":"mp4"}}catch{}}const t=["video/webm;codecs=vp9,opus","video/webm;codecs=vp9","video/webm;codecs=vp8,opus","video/webm;codecs=vp8","video/webm"];for(const r of t)try{if(MediaRecorder.isTypeSupported(r))return{mime:r,ext:"webm"}}catch{}return{mime:"video/webm",ext:"webm"}}function Gk(e){const t=["video/mp4;codecs=avc1","video/mp4;codecs=h264","video/mp4"];for(const r of t)try{if(MediaRecorder.isTypeSupported(r))return!0}catch{}return!1}class Nh{constructor(t){this.recorder=null,this.chunks=[],this.rafId=0,this.startTime=0,this._state="idle",this._ext="webm",this._actualFmt="WebM",this.compositor=document.createElement("canvas"),this.ctx=this.compositor.getContext("2d",{alpha:!1}),this.onState=t}get state(){return this._state}get elapsed(){return this.startTime>0?(performance.now()-this.startTime)/1e3:0}get actualFmt(){return this._actualFmt}set(t){this._state=t,this.onState(t)}start(t,r,o=30,s,l={}){if(this._state!=="idle")return;const u=t().find(k=>k!=null);if(!u){console.warn("[CanvasRecorder] No source canvas");return}const c=Math.min(1920,u.clientWidth||window.innerWidth),d=Math.min(1080,u.clientHeight||window.innerHeight);this.compositor.width=c,this.compositor.height=d,this.chunks=[],this.startTime=performance.now();const h=l.format??"auto",f=l.quality??"standard",g=l.fps??o,{mime:m,ext:y}=yz(h),v=gz[f];this._ext=y,this._actualFmt=y==="mp4"?"MP4":y==="mov"?"MOV":"WebM";const b=this.compositor.captureStream(g);let S;s&&s.getAudioTracks().length>0?S=new MediaStream([...b.getVideoTracks(),...s.getAudioTracks()]):S=b;try{this.recorder=new MediaRecorder(S,{mimeType:m,videoBitsPerSecond:v})}catch{this.recorder=new MediaRecorder(S)}this.recorder.ondataavailable=k=>{k.data.size>0&&this.chunks.push(k.data)},this.recorder.onstop=()=>this.finalize(m),this.recorder.start(100),this.set("recording");const C=()=>{!this.recorder||this.recorder.state==="inactive"||(this.rafId=requestAnimationFrame(C),this.composite(t(),r()))};C()}stop(){var t;this._state==="recording"&&(cancelAnimationFrame(this.rafId),this.set("saving"),((t=this.recorder)==null?void 0:t.state)==="recording"&&this.recorder.stop())}composite(t,r){const{ctx:o,compositor:s}=this,l=s.width,i=s.height;o.fillStyle="#07050e",o.fillRect(0,0,l,i);for(const u of t)if(u)try{o.drawImage(u,0,0,l,i)}catch{}this.drawOverlay(r,l,i)}drawOverlay(t,r,o){const s=this.ctx,l=this.elapsed,i=14,u=15;s.save(),s.font="11px monospace";const c=`${t.labName}    ${Sv(l)}`,d=s.measureText(c).width+20;if(s.globalAlpha=.7,s.fillStyle="rgba(7,5,14,0.85)",s.beginPath(),s.roundRect(i-5,i-13,d,21,4),s.fill(),s.globalAlpha=1,s.fillStyle="#c4b5fd",s.fillText(c,i,i),s.restore(),Math.floor(l*1.5)%2===0){s.save(),s.font="bold 10px monospace";const m=` REC  ${this._actualFmt}`,y=s.measureText(m).width+18;s.globalAlpha=.8,s.fillStyle="rgba(7,5,14,0.85)",s.beginPath(),s.roundRect(r-y-i,i-13,y,21,4),s.fill(),s.fillStyle="#f87171",s.fillText(m,r-s.measureText(m).width-i,i),s.restore()}if(t.lines.length===0)return;s.save(),s.font="10px monospace";const h=Math.max(...t.lines.map(m=>s.measureText(m).width)),f=t.lines.length*u+10,g=o-f-i+2;s.globalAlpha=.6,s.fillStyle="rgba(7,5,14,0.88)",s.beginPath(),s.roundRect(i-6,g-4,h+18,f,5),s.fill(),s.globalAlpha=.88;for(let m=0;m<t.lines.length;m++){const y=o-i-(t.lines.length-1-m)*u;s.fillStyle=m===0?"rgba(196,181,253,0.92)":"rgba(210,200,255,0.80)",s.fillText(t.lines[m],i,y)}s.restore()}finalize(t){const r=new Blob(this.chunks,{type:t}),o=URL.createObjectURL(r),s=document.createElement("a");s.href=o,s.download=`metalife-${new Date().toISOString().slice(0,19).replace(/[T:]/g,"-")}.${this._ext}`,document.body.appendChild(s),s.click(),document.body.removeChild(s),setTimeout(()=>URL.revokeObjectURL(o),6e4),this.chunks=[],this.set("idle")}dispose(){this.stop()}}const Pp=({state:e,elapsed:t,onStart:r,onStop:o,className:s="",showOptions:l=!1})=>{const[i,u]=w.useState("auto"),[c,d]=w.useState("standard"),[h,f]=w.useState(!1),[,g]=w.useState(0);w.useEffect(()=>{if(e!=="recording")return;const v=setInterval(()=>g(b=>b+1),1e3);return()=>clearInterval(v)},[e]);const m=Gk(),y={display:"flex",alignItems:"center",gap:4};return e==="saving"?a.jsxs("div",{className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg
        bg-black/60 border border-yellow-400/20 backdrop-blur-sm ${s}`,children:[a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-yellow-400/70 animate-pulse"}),a.jsx("span",{className:"text-[8px] font-mono text-yellow-300/60 uppercase tracking-widest",children:"salvando"})]}):e==="recording"?a.jsxs("button",{onClick:o,title:"Parar gravao",className:`group flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg
          bg-red-950/70 border border-red-500/50 text-red-400
          hover:bg-red-900/80 hover:border-red-400/70 transition-all
          backdrop-blur-sm ${s}`,children:[a.jsx("span",{className:"w-2 h-2 rounded-sm bg-red-500 group-hover:bg-red-400 animate-pulse flex-shrink-0"}),a.jsx("span",{className:"text-[9px] font-mono tabular-nums",children:Sv(t)}),a.jsx("span",{className:"text-[7px] font-mono text-red-400/50 tracking-widest uppercase ml-0.5",children:"parar"})]}):a.jsxs("div",{className:`relative flex flex-col gap-1 ${s}`,children:[l&&h&&a.jsxs("div",{className:`absolute bottom-full mb-1 right-0 z-50
          bg-black/90 border border-white/10 rounded-lg p-2 min-w-[160px]
          backdrop-blur-sm shadow-xl`,children:[a.jsxs("div",{className:"mb-2",children:[a.jsx("div",{className:"text-[7px] font-mono text-white/30 uppercase tracking-widest mb-1",children:"Formato"}),["auto","webm","mp4","mov"].map(v=>a.jsxs("button",{title:v,onClick:()=>u(v),className:`w-full text-left px-2 py-0.5 rounded text-[9px] font-mono transition-colors mb-0.5 flex items-center justify-between ${i===v?"bg-white/10 text-white/80":"text-white/35 hover:text-white/60 hover:bg-white/5"}`,children:[a.jsx("span",{children:sg[v]}),(v==="mp4"||v==="mov")&&!m&&a.jsx("span",{className:"text-[7px] text-yellow-500/60",children:"WebM"})]},v))]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-[7px] font-mono text-white/30 uppercase tracking-widest mb-1",children:"Qualidade"}),["draft","standard","high","ultra"].map(v=>a.jsx("button",{title:v,onClick:()=>d(v),className:`w-full text-left px-2 py-0.5 rounded text-[9px] font-mono transition-colors mb-0.5 ${c===v?"bg-white/10 text-white/80":"text-white/35 hover:text-white/60 hover:bg-white/5"}`,children:mz[v]},v))]})]}),a.jsxs("div",{style:y,children:[l&&a.jsx("button",{onClick:()=>f(v=>!v),title:"Opes de gravao",className:`flex items-center gap-1 px-1.5 py-1.5 rounded-lg text-[7px] font-mono uppercase tracking-widest
              transition-all backdrop-blur-sm ${h?"bg-white/10 border border-white/20 text-white/70":"bg-black/50 border border-white/8 text-white/25 hover:text-white/50 hover:bg-black/70"}`,children:""}),a.jsxs("button",{onClick:()=>r({format:i,quality:c}),title:"Iniciar gravao do canvas",className:`group flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg
            bg-black/50 border border-white/10 text-white/35
            hover:bg-black/70 hover:border-purple-400/30 hover:text-white/65
            transition-all backdrop-blur-sm`,children:[a.jsx("span",{className:`w-2 h-2 rounded-full border border-current
            group-hover:border-red-400/70 group-hover:bg-red-500/20
            transition-colors flex-shrink-0`}),a.jsx("span",{className:"text-[8px] font-mono uppercase tracking-widest",children:"gravar"}),l&&a.jsxs("span",{className:"text-[7px] font-mono text-white/20 ml-0.5",children:[sg[i],"  ",c]})]})]})]})},t0=["#ff6b6b","#4ecdc4","#ffd93d","#6bcb77","#a78bfa"];function O6(){return{agentCount:160,groupCount:4,speed:.45,friction:.88,rMax:.3,autonomy:.55,cohesion:.5,pressure:.35,aggressionBase:.25,trustBase:.55,needBase:.6,macroTickSec:1,kBelief:.4,kFear:.35,kDesire:.3,harvestRate:.06,decayWealth:.012,ideologyPressure:.25,conformity:.4,empathy:.3,mobility:.1,contagion:.35,hierarchyStrength:.4,innovationRate:.05,cooperationBias:.3,culturalInertia:.5,resourceScarcity:.5,boidsAlignment:.4,boidsCohesion:.3,panopticism:.5,violationThreshold:3,exceptionDuration:25,autoSymbols:!0,archetypeHoldSec:2.2}}function $2(){return{totems:[],tabus:[],rituals:[]}}function q2(){return{exceptionActive:!1,exceptionStartTime:0,violationCount:0,violationsWindowStart:0,violationsWindow:0,meanWealth:.25,gini:0,rngState:1}}function W2(){return{cohesion:.2,polarization:.1,conflict:.05,consensus:.5,phase:"SWARM",leaderCount:0,rebelCount:0,meanFear:.1,meanBelief:.2,entropy:.5}}function H2(e){return e>=.72?2:e>=.42?1:0}function xz(e){const t=e.belief,r=e.fear,o=e.desire,s=e.resistance;return s>=t&&s>=r&&s>=o?3:t>=r&&t>=o?0:r>=o?1:2}function bz(e){return e<-.25?0:e>.25?2:1}function _g(e){const t=xz(e),r=t===0?e.belief:t===1?e.fear:t===2?e.desire:e.resistance,o=H2(r),s=H2(Math.max(e.status*.92+e.centrality*.55,e.status)),l=H2(e.aggression),i=bz(e.ideology),u=(e.memeId|0)&15;return(t&3|(o&3)<<2|(s&3)<<4|(l&3)<<6|(i&3)<<8|(u&15)<<10)>>>0}function vz(e){let t=(e^2654435769)>>>0;return t=Math.imul(t,2654435761)>>>0,t^=t>>>16,t=Math.imul(t,2246822507)>>>0,t^=t>>>13,t>>>0}function tc(e){const t=vz(e),r=t%360,o=72+(t>>>9)%10,s=52+(t>>>17)%10;return`hsl(${r} ${o}% ${s}%)`}function Sz(e){const t=e&3,r=e>>>2&3,o=e>>>4&3,s=e>>>6&3,l=e>>>8&3,i=e>>>10&15;return`${t===0?"B":t===1?"F":t===2?"D":"R"}${r}  P${o}  ${l===0?"O":l===2?"L":"M"}  A${s}  m${i}`}function _6(e=32){const t=new Float32Array(e*e);return t.fill(.28),{n:new Float32Array(e*e),l:new Float32Array(e*e),r:t,size:e,dirty:!0}}function D6(){return{decayN:.018,decayL:.007,decayR:.004,diffuseN:.1,diffuseL:.05,diffuseR:.02,regenR:.02}}function L6(e,t){return Math.max(0,Math.min(t-1,(e+1)*.5*t|0))}function wv(e,t,r,o){const s=(r+1)*.5*(t-1),l=(o+1)*.5*(t-1),i=Math.max(0,Math.min(t-2,s|0)),u=Math.max(0,Math.min(t-2,l|0)),c=s-i,d=l-u,h=e[u*t+i],f=e[u*t+i+1],g=e[(u+1)*t+i],m=e[(u+1)*t+i+1];return h*(1-c)*(1-d)+f*c*(1-d)+g*(1-c)*d+m*c*d}function wz(e,t,r){return wv(e.n,e.size,t,r)}function Cz(e,t,r){return wv(e.l,e.size,t,r)}function z6(e,t,r){return wv(e.r,e.size,t,r)}function Cv(e,t,r,o,s,l){const i=L6(r,t),u=L6(o,t),c=Math.max(1,Math.ceil(l*t*.5));for(let d=-c;d<=c;d++)for(let h=-c;h<=c;h++){const f=i+h,g=u+d;if(f<0||f>=t||g<0||g>=t)continue;const m=Math.sqrt(h*h+d*d)/c;if(m>1)continue;const y=Math.exp(-m*m*3),v=g*t+f;e[v]=Math.max(0,Math.min(1,e[v]+s*y))}}function si(e,t,r,o,s){Cv(e.n,e.size,t,r,o,s)}function ma(e,t,r,o,s){Cv(e.l,e.size,t,r,o,s)}function os(e,t,r,o,s){Cv(e.r,e.size,t,r,o,s)}const B6=new Float32Array(1024*4);function G2(e,t,r,o,s,l){const i=t*t,u=B6.length>=i?B6:new Float32Array(i),c=o*l;for(let h=0;h<t;h++)for(let f=0;f<t;f++){const g=e[h*t+f];let m=-4*g;m+=h>0?e[(h-1)*t+f]:g,m+=h<t-1?e[(h+1)*t+f]:g,m+=f>0?e[h*t+f-1]:g,m+=f<t-1?e[h*t+f+1]:g,u[h*t+f]=g+c*m}const d=1-r*l;for(let h=0;h<i;h++)e[h]=Math.max(0,Math.min(1,u[h]*d+s*l))}function Mz(e,t,r){G2(e.n,e.size,t.decayN,t.diffuseN,0,r),G2(e.l,e.size,t.decayL,t.diffuseL,0,r),G2(e.r,e.size,t.decayR,t.diffuseR,t.regenR,r),e.dirty=!0}function kz(e){e.n.fill(0),e.l.fill(0),e.r.fill(.28),e.dirty=!0}function Vk(e,t){const r=new Map;for(let o=0;o<e.length;o++){const s=(e[o].x+1)/t|0,l=(e[o].y+1)/t|0,i=s*1024+l;let u=r.get(i);u||(u=[],r.set(i,u)),u.push(o)}return r}function $6(e,t,r,o,s,l){const i=t[e],u=(i.x+1)/s|0,c=(i.y+1)/s|0,d=o*o,h=[];e:for(let f=-2;f<=2;f++)for(let g=-2;g<=2;g++){const m=r.get((u+f)*1024+(c+g));if(m)for(const y of m){if(y===e)continue;const v=t[y].x-i.x,b=t[y].y-i.y;if(v*v+b*b<d&&(h.push(y),h.length>=l))break e}}return h}function Rz(e,t,r){const{agentCount:o,groupCount:s}=e,l=[],i=c=>Math.max(-.95,Math.min(.95,c)),u=[];if(r==="unified_center")for(let c=0;c<s;c++)u.push([0,0]);else if(r==="corners"){const c=[[-.68,-.68],[.68,-.68],[.68,.68],[-.68,.68],[0,-.78],[.78,0],[0,.78],[-.78,0]];for(let d=0;d<s;d++)u.push(c[d%c.length])}else for(let c=0;c<s;c++){const d=c/s*Math.PI*2-Math.PI/2;u.push([Math.cos(d)*.52,Math.sin(d)*.52])}for(let c=0;c<o;c++){const d=c%s,[h,f]=u[d]??[0,0],g=t()*Math.PI*2,m=t()*.17+.02,y=d/Math.max(s-1,1)*2-1,v=Math.max(-1,Math.min(1,y+(t()-.5)*.6));let b=h+Math.cos(g)*m,S=f+Math.sin(g)*m;if(r==="ring"){const R=d/Math.max(s,1)*Math.PI*2-Math.PI/2,j=Math.PI*2/Math.max(s,1)*.8,T=R+(t()-.5)*j,_=.55+(t()-.5)*.22;b=Math.cos(T)*_,S=Math.sin(T)*_}else if(r==="line"){const R=d/Math.max(s-1,1),j=t(),T=(t()-.5)*.28;b=(j-.5)*1.6+T,S=(R-.5)*1.6+(j-.5)*.4+(t()-.5)*.12}else r==="random"&&(b=(t()-.5)*1.8,S=(t()-.5)*1.8);const C={x:i(b),y:i(S),vx:(t()-.5)*.07,vy:(t()-.5)*.07,groupId:d,opinion:v,trust:Math.max(0,Math.min(1,e.trustBase+(t()-.5)*.3)),aggression:Math.max(0,Math.min(1,e.aggressionBase+(t()-.5)*.2)),need:Math.max(0,Math.min(1,e.needBase+(t()-.5)*.25)),goalX:h,goalY:f,memory:[],centrality:0,hostileCount:0,belief:.3+t()*.3,fear:.1+t()*.15,desire:.2+t()*.3,status:.05+t()*.1,wealth:.2+t()*.15,ideology:v,fatigue:.05+t()*.05,conformity:Math.max(0,Math.min(1,e.conformity+(t()-.5)*.3)),empathy:Math.max(0,Math.min(1,e.empathy+(t()-.5)*.25)),charisma:t()*.3+.05,groupLoyalty:.4+t()*.5,memeId:d,visibility:0,resistance:.1+t()*.2,trailX:new Float32Array(15).fill(i(b)),trailY:new Float32Array(15).fill(i(S)),trailIdx:0,lastGroupChange:0,archKeyMoment:0,archKeyStable:0,archKeyCandidate:0,archCandidateAt:0,archStableAt:0},k=_g(C);C.archKeyMoment=k,C.archKeyStable=k,C.archKeyCandidate=k,l.push(C)}return l}const Vu=.042,q6=1.9;function Az(e){return Vk(e,Vu*2.5)}function jz(e,t,r,o){const{friction:s,speed:l,autonomy:i}=r,u=Vu*Vu,c=Vu*2.5;for(let d=0;d<e.length;d++){const h=e[d];let f=0,g=0,m=0,y=0,v=0,b=0,S=0,C=0;const k=(h.x+1)/c|0,R=(h.y+1)/c|0;for(let q=-1;q<=1;q++)for(let L=-1;L<=1;L++){const H=t.get((k+q)*1024+(R+L));if(H)for(const G of H){if(G===d)continue;const oe=e[G],le=h.x-oe.x,pe=h.y-oe.y,ce=le*le+pe*pe;if(ce<u&&ce>1e-6){const te=Math.sqrt(ce),F=(Vu-te)/Vu;f+=le/te*F*q6,g+=pe/te*F*q6}oe.groupId===h.groupId&&ce<u*4&&(m+=oe.vx,y+=oe.vy,v++,b+=oe.x,S+=oe.y,C++)}}if(v>0&&(m/=v,y/=v,f+=(m-h.vx)*r.boidsAlignment*1.5,g+=(y-h.vy)*r.boidsAlignment*1.5),C>0){b/=C,S/=C;const q=b-h.x,L=S-h.y,H=Math.sqrt(q*q+L*L)+.001;f+=q/H*r.boidsCohesion*1.2,g+=L/H*r.boidsCohesion*1.2}const j=h.goalX-h.x,T=h.goalY-h.y,_=Math.sqrt(j*j+T*T)+.001,P=Math.min(_/.5,1),I=1+h.fear*.6;f+=j/_*i*l*2.2*P*I,g+=T/_*i*l*2.2*P*I,h.vx=(h.vx+f*o)*s,h.vy=(h.vy+g*o)*s;const $=Math.sqrt(h.vx*h.vx+h.vy*h.vy);if($>l*1.4){const q=l*1.4/$;h.vx*=q,h.vy*=q}h.x+=h.vx*o,h.y+=h.vy*o,h.x<-.97&&(h.x=-.97,h.vx=Math.abs(h.vx)*.4),h.x>.97&&(h.x=.97,h.vx=-Math.abs(h.vx)*.4),h.y<-.97&&(h.y=-.97,h.vy=Math.abs(h.vy)*.4),h.y>.97&&(h.y=.97,h.vy=-Math.abs(h.vy)*.4),h.trailX[h.trailIdx]=h.x,h.trailY[h.trailIdx]=h.y,h.trailIdx=(h.trailIdx+1)%15}}const V2=12,Ez=3;function Rd(e){return e.rngState=Math.imul(e.rngState>>>0,1664525)+1013904223>>>0,e.rngState/4294967296}function U2(e){return Rd(e)-.5}function Tz(e,t,r,o,s,l,i,u,c){const d=[];Mz(o,s,u),Iz(r,o,l,i,u,c,d);const h=Vk(e,t.rMax*1.1),f=Dz(e,t.groupCount),g=e.reduce((v,b)=>v+b.x,0)/(e.length||1),m=e.reduce((v,b)=>v+b.y,0)/(e.length||1),y=Mv(e,t);for(let v=0;v<e.length;v++){const b=e[v],S=$6(v,e,h,t.rMax,t.rMax*1.1,V2),C=wz(o,b.x,b.y),k=Cz(o,b.x,b.y),R=z6(o,b.x,b.y);b.visibility=0;for(const $e of r.totems)if($e.kind==="PANOPTICON"){const Ze=$e.x-b.x,Fe=$e.y-b.y,Xe=Ze*Ze+Fe*Fe;if(Xe<$e.radius*$e.radius){const jt=Math.sqrt(Xe);b.visibility=Math.max(b.visibility,1-jt/$e.radius)}}const j=b.visibility*t.panopticism;j>0?(b.fear=Mr(b.fear+j*.1*u,0,1),b.conformity=Mr(b.conformity+j*.05*u,0,1),b.ideology>0&&b.desire>.5&&(b.resistance=Mr(b.resistance+j*.15*u,0,1))):b.resistance=Mr(b.resistance-.02*u,0,1),b.resistance>.8&&(b.conformity=Mr(b.conformity-.1*u,0,1),b.aggression=Mr(b.aggression+.05*u,0,1),b.belief=Mr(b.belief-.1*u,0,1));const T=(t.kBelief*C*(1-b.desire*.7)-.05*b.desire)*u;b.belief=Mr(b.belief+T,0,1);const _=t.kFear*C*(1-b.belief*.8),P=.12*(b.hostileCount/3),I=-.15*k*b.belief;b.fear=Mr(b.fear+(_+P+I)*u-.08*u,0,1);const $=(t.kDesire*(1-C)*.7+.1*(1-b.wealth))*u-.06*u;b.desire=Mr(b.desire+$,0,1);const q=t.harvestRate*R*u;b.wealth=Mr(b.wealth+q-t.decayWealth*u,0,1),q>.001&&os(o,b.x,b.y,-q*.6,.08);const L=k,H=(.08*b.centrality+.05*b.wealth*L+.03*k)*u;b.status=Mr(b.status*(1-.015*u)+H,0,1);let G=0,oe=0;for(const $e of S){const Ze=e[$e],Fe=Ze.status+.1;G+=Ze.ideology*Fe,oe+=Fe}if(oe>0){const $e=G/oe-b.ideology;b.ideology=Mr(b.ideology+$e*t.ideologyPressure*u,-1,1)}b.opinion=b.ideology;const le=r.rituals.some($e=>(b.x-$e.x)**2+(b.y-$e.y)**2<$e.radius**2)?1:0,pe=(.08*(b.hostileCount/3)+.04*le-.06*R)*u;b.fatigue=Mr(b.fatigue+pe,0,1);const ce=t.conformity*b.conformity*(C-b.belief)*.15;b.belief=Mr(b.belief+ce*u,0,1);const te=1-t.culturalInertia*.7;b.hostileCount=0;let F=0,Q=b.opinion,ae=1,we=b.x,Re=b.y,ge=0,Ae=0,tt=0,We=0,J=0,ke=0,Le=0;for(const $e of S){const Ze=e[$e];ge++;const Fe=(.35+Ze.centrality*.65)*Ze.status*(.55+Ze.charisma),Xe=Ze.status>.72&&Ze.centrality>.28&&Ze.aggression>.62&&Ze.belief>.55&&Ze.ideology<-.15,jt=Ze.belief>.7&&Ze.status>.45&&Ze.charisma>.4&&Ze.aggression<.55;if(Xe?ke+=Fe*(.9+Ze.aggression*.6):ke+=Fe*Ze.aggression*(Ze.ideology<-.15?.85:.45),jt?Le+=Fe*1.05:Le+=Fe*Ze.belief*(Ze.ideology<-.15?.85:.55),Ze.groupId===b.groupId){F++;const an=1+t.hierarchyStrength*Ze.status*Ze.charisma;Q+=Ze.opinion*Ze.trust*an,ae+=an,we+=Ze.x,Re+=Ze.y,Y2(b,$e,!0,i)}else if(Ze.aggression>.5||b.aggression>.5)b.hostileCount++,Y2(b,$e,!1,i);else{const it=.1+t.hierarchyStrength*Ze.status*.3;Q+=Ze.opinion*it,ae+=it,Y2(b,$e,!0,i)}const hn=b.empathy*t.empathy;Ae+=Ze.fear*hn,tt+=Ze.desire*hn,We+=Ze.belief*hn,J++}if(b.centrality=Math.min(1,ge/V2),ge>0){const $e=1/ge,Ze=Math.max(0,Math.min(1,ke*$e)),Fe=Math.max(0,Math.min(1,Le*$e)),Xe=1-b.resistance*.65;b.fear=Mr(b.fear+Ze*.1*u*Xe,0,1),b.conformity=Mr(b.conformity+Ze*.06*u*Xe,0,1);const jt=1-b.desire*.55;b.belief=Mr(b.belief+Fe*.08*u*jt,0,1),b.fear=Mr(b.fear-Fe*b.belief*.05*u,0,1)}if(J>0){const $e=.06*u;b.fear=Mr(b.fear+(Ae/J-b.fear)*$e,0,1),b.desire=Mr(b.desire+(tt/J-b.desire)*$e,0,1),b.belief=Mr(b.belief+(We/J-b.belief)*$e*.5,0,1)}if(t.contagion>0&&S.length>0){const $e=[];for(const Xe of S){const jt=e[Xe].memeId;$e[jt]=($e[jt]||0)+1+e[Xe].charisma*t.hierarchyStrength}let Ze=b.memeId,Fe=0;for(let Xe=0;Xe<$e.length;Xe++)$e[Xe]>Fe&&(Fe=$e[Xe],Ze=Xe);Ze!==b.memeId&&Rd(l)<t.contagion*.12*(1-t.culturalInertia*.6)&&(b.memeId=Ze)}if(t.innovationRate>0&&Rd(l)<t.innovationRate*.03&&(b.ideology=Mr(b.ideology+U2(l)*.4,-1,1),b.desire=Mr(b.desire+.05,0,1)),t.cooperationBias>0&&b.wealth>.3)for(const $e of S){const Ze=e[$e];if(Ze.groupId===b.groupId&&Ze.wealth<b.wealth-.1){const Fe=t.cooperationBias*.02*u;b.wealth=Mr(b.wealth-Fe,0,1),Ze.wealth=Mr(Ze.wealth+Fe,0,1)}}if(ae>1){const $e=(Q/ae-b.opinion)*t.pressure*.3*te*u/t.macroTickSec;b.opinion=Mr(b.opinion+$e,-1,1)}const K=f[b.groupId]??f[0]??[0,0,1],[et,dt]=K,Rt=F>0?we/(F+1):et,Wt=F>0?Re/(F+1):dt;if(l.exceptionActive)b.belief>.5?(b.goalX=Rt,b.goalY=Wt):(b.goalX=et*.3+g*.7,b.goalY=dt*.3+m*.7);else if(b.fear>.55){let $e=0,Ze=0,Fe=0;for(const Xe of S){const jt=e[Xe];jt.groupId!==b.groupId&&jt.aggression>.4&&($e+=b.x-jt.x,Ze+=b.y-jt.y,Fe++)}if(Fe>0){const Xe=Math.sqrt($e*$e+Ze*Ze)+.001;b.goalX=b.x+$e/Xe*.3+et*.7,b.goalY=b.y+Ze/Xe*.3+dt*.7}else b.goalX=et,b.goalY=dt}else if(b.wealth<.25){let $e=R,Ze=g,Fe=m;for(const Xe of S){const jt=z6(o,e[Xe].x,e[Xe].y);jt>$e&&($e=jt,Ze=e[Xe].x,Fe=e[Xe].y)}b.goalX=Ze*.6+Rt*.4,b.goalY=Fe*.6+Wt*.4}else if(b.desire>.65&&b.fear<.3){const $e=r.tabus[0];$e?(b.goalX=$e.x+(b.x-$e.x)*.4,b.goalY=$e.y+(b.y-$e.y)*.4):(b.goalX=U2(l)*1.4,b.goalY=U2(l)*1.4)}else if(b.need>.5||t.cohesion>.5)b.goalX=Rt,b.goalY=Wt;else{const $e=et*.5+g*.5,Ze=dt*.5+m*.5;b.goalX=b.goalX*.7+$e*.3,b.goalY=b.goalY*.7+Ze*.3}for(const $e of r.tabus){const Ze=b.x-$e.x,Fe=b.y-$e.y,Xe=Ze*Ze+Fe*Fe;if(Xe<$e.radius*$e.radius){if($e.kind==="NO_ENTER"){const jt=Math.sqrt(Xe)+.001;b.goalX=$e.x+Ze/jt*($e.radius+.1),b.goalY=$e.y+Fe/jt*($e.radius+.1)}else if($e.kind==="NO_MIX")for(const jt of S){const hn=e[jt];if(hn.groupId!==b.groupId){const an=b.x-hn.x,it=b.y-hn.y,kt=Math.sqrt(an*an+it*it)+.001;b.goalX+=an/kt*.2,b.goalY+=it/kt*.2}}}}for(const $e of r.totems){const Ze=$e.x-b.x,Fe=$e.y-b.y;Ze*Ze+Fe*Fe<$e.radius*$e.radius&&($e.kind==="BOND"&&b.belief>.35?(b.goalX=b.goalX*.5+$e.x*.5,b.goalY=b.goalY*.5+$e.y*.5):$e.kind==="RIFT"&&b.groupId===$e.groupId?(b.goalX=b.goalX*.4+$e.x*.6,b.goalY=b.goalY*.4+$e.y*.6):$e.kind==="ORACLE"&&b.status>.2?(b.goalX=b.goalX*.6+$e.x*.4,b.goalY=b.goalY*.6+$e.y*.4,b.belief=Mr(b.belief+.02*u,0,1)):$e.kind==="ARCHIVE"&&(b.groupLoyalty=Mr(b.groupLoyalty+.01*u,0,1),b.conformity=Mr(b.conformity+.008*u,0,1)))}const Zt=_g(b);if(b.archKeyMoment=Zt,Zt!==b.archKeyCandidate)b.archKeyCandidate=Zt,b.archCandidateAt=i;else if(Zt!==b.archKeyStable){const $e=Math.max(.2,t.archetypeHoldSec||0);i-b.archCandidateAt>=$e&&(b.archKeyStable=Zt,b.archStableAt=i)}b.goalX=Mr(b.goalX,-.95,.95),b.goalY=Mr(b.goalY,-.95,.95)}if(Pz(e,r,l,i,c,d),Fz(e,l),Nz(l,t,o,i,d),t.mobility>0)for(let v=0;v<e.length;v++){const b=e[v];if(Rd(l)>t.mobility*.02*(1-b.groupLoyalty))continue;const S=$6(v,e,h,t.rMax,t.rMax*1.1,V2),C=new Array(t.groupCount).fill(0);for(const j of S)C[e[j].groupId]++;let k=b.groupId,R=C[b.groupId]||0;for(let j=0;j<t.groupCount;j++)j!==b.groupId&&C[j]>R&&(k=j,R=C[j]);if(k!==b.groupId&&R>=3){const j=b.groupId;b.groupId=k,b.groupLoyalty*=.7,b.memeId=k,d.push({time:i,icon:"",message:`Agent migrated G${j}G${k}`,color:t0[k]||"#fff"})}}if(t.resourceScarcity<.5){const v=(.5-t.resourceScarcity)*.008*u;for(let b=0;b<o.r.length;b++)o.r[b]=Math.max(0,o.r[b]-v);o.dirty=!0}return Oz(e,l),_z(e,t,y,l,i,c,d),t.autoSymbols&&Bz(e,t,r,l,i,c,d),d}function Iz(e,t,r,o,s,l,i){const u=r.exceptionActive?1.6:1;for(const c of e.totems){const d=c.pulseStrength*s*u;if(c.kind==="BOND")si(t,c.x,c.y,d*1.2,c.radius),ma(t,c.x,c.y,d*.8,c.radius);else if(c.kind==="RIFT")si(t,c.x,c.y,-d*.9,c.radius*.7),ma(t,c.x,c.y,d*1.1,c.radius);else if(c.kind==="ORACLE")ma(t,c.x,c.y,d*1.4,c.radius),si(t,c.x,c.y,d*.3,c.radius*.5);else if(c.kind==="PANOPTICON")si(t,c.x,c.y,d*1.5,c.radius*1.2);else if(c.kind==="ARCHIVE"){const h=Math.floor((c.x+1)*t.size/2),f=Math.floor((c.y+1)*t.size/2),g=Math.ceil(c.radius*t.size/2);for(let m=-g;m<=g;m++)for(let y=-g;y<=g;y++){const v=(f+y)*t.size+(h+m);v>=0&&v<t.n.length&&(t.n[v]=Math.min(1,t.n[v]+.003*s),t.l[v]=Math.min(1,t.l[v]+.002*s))}}}for(const c of e.tabus){const d=c.radius*.9;for(let h=0;h<Math.PI*2;h+=Math.PI/8){const f=c.x+Math.cos(h)*d,g=c.y+Math.sin(h)*d;si(t,f,g,.015*s*u,.1)}}for(const c of e.rituals){const d=c.periodSec,h=(o-c.bornAt)%d,f=h<d*.3;c.active=f,f&&(c.kind==="GATHER"?(si(t,c.x,c.y,.04*s*u,c.radius),ma(t,c.x,c.y,.03*s,c.radius),Math.abs(h)<.1&&h<.15&&(i.push({time:o,icon:"",message:"Gathering ritual begins",color:"#a78bfa"}),l.push({x:c.x,y:c.y,message:"Gather",color:"#a78bfa",bornAt:o,ttl:3,age:0}))):c.kind==="OFFERING"?(os(t,c.x,c.y,.06*s*u,c.radius),ma(t,c.x,c.y,.02*s,c.radius*.7),Math.abs(h)<.1&&h<.15&&(i.push({time:o,icon:"",message:"Offering ritual  resources redistributed",color:"#fbbf24"}),l.push({x:c.x,y:c.y,message:"Offering",color:"#fbbf24",bornAt:o,ttl:3,age:0}))):c.kind==="REVOLT"?(si(t,c.x,c.y,-.08*s*u,c.radius*1.5),Math.abs(h)<.1&&h<.15&&(i.push({time:o,icon:"",message:"Revolt ritual  norms shattered",color:"#ef4444"}),l.push({x:c.x,y:c.y,message:"Revolt",color:"#ef4444",bornAt:o,ttl:3,age:0}))):(si(t,c.x,c.y,.05*s*u,c.radius*1.2),Math.abs(h)<.1&&h<.15&&(i.push({time:o,icon:"",message:"Procession ritual in march",color:"#fbd38d"}),l.push({x:c.x,y:c.y,message:"Procession",color:"#fbd38d",bornAt:o,ttl:3,age:0}))))}}function Pz(e,t,r,o,s,l){for(const i of t.tabus){let u=0;for(const c of e){const d=c.x-i.x,h=c.y-i.y;if(d*d+h*h<i.radius*i.radius)if(i.kind==="NO_ENTER"){const f=c.desire>.5;c.fear=Mr(c.fear+i.severity*.12,0,1),f&&(c.status=Mr(c.status+.04,0,1),u++,r.violationCount++,r.violationsWindow++)}else i.kind==="NO_MIX"&&i.violationCount++}u>0&&(i.violationCount+=u,l.push({time:o,icon:"",message:`Taboo violation ${u}`,color:"#ef4444"}),s.push({x:i.x,y:i.y,message:`${u} violations`,color:"#ef4444",bornAt:o,ttl:2,age:0}))}o-r.violationsWindowStart>60&&(r.violationsWindowStart=o,r.violationsWindow=0)}function Fz(e,t,r){for(let o=0;o<e.length;o++){const s=e[o];if(!(s.belief<.6||s.status<.35))for(let l=0;l<e.length;l++){if(l===o)continue;const i=e[l],u=i.x-s.x,c=i.y-s.y;u*u+c*c>.06*.06||i.desire>.6&&(i.fear=Mr(i.fear+.08,0,1),i.status=Mr(i.status-.03,0,1),t.exceptionActive&&(i.fear=Mr(i.fear+.04,0,1)))}}}function Nz(e,t,r,o,s){if(!e.exceptionActive&&e.violationsWindow>=t.violationThreshold){e.exceptionActive=!0,e.exceptionStartTime=o,s.push({time:o,icon:"",message:"STATE OF EXCEPTION declared",color:"#ef4444"});for(let l=0;l<r.n.length;l++)r.n[l]=Math.min(1,r.n[l]+.15);r.dirty=!0}e.exceptionActive&&o-e.exceptionStartTime>t.exceptionDuration&&(e.exceptionActive=!1,s.push({time:o,icon:"",message:"State of Exception lifted",color:"#34d399"}))}function Oz(e,t){if(e.length===0)return;const r=e.reduce((l,i)=>l+i.wealth,0);t.meanWealth=r/e.length;const o=e.map(l=>l.wealth).sort((l,i)=>l-i);let s=0;for(let l=0;l<o.length;l++)s+=(2*(l+1)-o.length-1)*o[l];t.gini=r>0?Math.abs(s)/(o.length*r):0}function _z(e,t,r,o,s,l,i){const u=Mv(e,t);if(u.phase!==r.phase){const h={SWARM:"#94a3b8",CLUSTERS:"#34d399",POLARIZED:"#fbd38d",CONFLICT:"#ef4444",CONSENSUS:"#a78bfa",EXCEPTION:"#ff6b6b"};i.push({time:s,icon:"",message:`Phase: ${r.phase}  ${u.phase}`,color:h[u.phase]||"#fff"})}o.gini>.55&&Rd(o)<.2&&i.push({time:s,icon:"",message:`Wealth gap  Gini ${o.gini.toFixed(2)}`,color:"#fbbf24"});const c=new Array(t.groupCount).fill(0);for(const h of e)h.groupId<c.length&&c[h.groupId]++;const d=Math.max(...c);if(d>e.length*.55&&Rd(o)<.15){const h=c.indexOf(d),f=t0[h%t0.length];i.push({time:s,icon:"",message:`Coalition  Group ${h} (${Math.round(d/e.length*100)}%)`,color:f}),l.push({x:0,y:0,message:"Coalition",color:f,bornAt:s,ttl:3,age:0})}}function Dz(e,t){const r=[];for(let o=0;o<t;o++)r.push([0,0,0]);for(const o of e)o.groupId<t&&(r[o.groupId][0]+=o.x,r[o.groupId][1]+=o.y,r[o.groupId][2]++);for(const o of r)o[2]>0&&(o[0]/=o[2],o[1]/=o[2]);return r}function Y2(e,t,r,o){e.memory.unshift({agentIdx:t,friendly:r,time:o}),e.memory.length>Ez&&e.memory.pop()}function Mr(e,t,r){return e<t?t:e>r?r:e}function Mv(e,t){var j;if(!e.length)return{cohesion:0,polarization:0,conflict:0,consensus:.5,phase:"SWARM",leaderCount:0,rebelCount:0,meanFear:0,meanBelief:0,entropy:.5};const r=Array.from({length:t.groupCount},()=>[]);for(const T of e)(j=r[T.groupId])==null||j.push(T);let o=0,s=0;for(let T=0;T<t.groupCount;T++){const _=r[T];if(_.length<2)continue;const P=_.reduce((q,L)=>q+L.x,0)/_.length,I=_.reduce((q,L)=>q+L.y,0)/_.length,$=_.reduce((q,L)=>q+Math.sqrt((L.x-P)**2+(L.y-I)**2),0)/_.length;o+=1-Math.min(1,$/.7),s++}const l=s>0?o/s:0,i=r.map(T=>T.length>0?T.reduce((_,P)=>_+P.ideology,0)/T.length:0),u=i.reduce((T,_)=>T+_,0)/i.length,c=i.reduce((T,_)=>T+(_-u)**2,0)/i.length,d=Math.min(1,Math.sqrt(c)),h=Math.min(1,e.reduce((T,_)=>T+_.hostileCount,0)/(e.length*3)),f=e.reduce((T,_)=>T+_.ideology,0)/e.length,g=e.reduce((T,_)=>T+(_.ideology-f)**2,0)/e.length,m=Math.max(0,1-Math.sqrt(g)/1.1),y=e.reduce((T,_)=>T+_.fear,0)/e.length,v=e.reduce((T,_)=>T+_.belief,0)/e.length,b=e.filter(T=>T.centrality>.3&&T.status>.4).length,S=e.filter(T=>T.resistance>.7||T.ideology>.5&&T.fear<.3&&T.desire>.65).length,C=new Float32Array(5);for(const T of e)C[Math.min(4,Math.floor((T.ideology+1)/2*5))]++;let k=0;for(let T=0;T<5;T++){const _=C[T]/e.length;_>0&&(k-=_*Math.log2(_))}k=Math.min(1,k/Math.log2(5));let R;return m>.78&&h<.2?R="CONSENSUS":h>.5?R="CONFLICT":d>.58?R="POLARIZED":l>.55&&d<.35?R="CLUSTERS":R="SWARM",{cohesion:l,polarization:d,conflict:h,consensus:m,phase:R,leaderCount:b,rebelCount:S,meanFear:y,meanBelief:v,entropy:k}}function Lz(e){const t=new Array(e.length).fill("normal");if(!e.length)return t;const r=e.map((o,s)=>({i:s,c:o.centrality+o.status})).sort((o,s)=>s.c-o.c);for(let o=0;o<Math.min(5,e.length);o++)r[o].c>.5&&(t[r[o].i]="leader");for(let o=0;o<e.length;o++){const s=e[o];if(s.status>.72&&s.centrality>.28&&s.aggression>.62&&s.belief>.55&&s.ideology<-.15){t[o]="dictator";continue}if(s.belief>.7&&s.status>.45&&s.charisma>.4&&s.aggression<.55){t[o]="priest";continue}if(s.resistance>.7||s.ideology>.5&&s.desire>.65&&s.fear<.35){t[o]="rebel";continue}if(s.status>.58&&(s.belief>.62||s.conformity>.7)&&s.charisma>.18){t[o]="authority";continue}if(s.aggression>.65&&s.hostileCount>=2){t[o]="aggressor";continue}if(s.belief>.65&&s.status>.4){t[o]="guardian";continue}const c=s.memory.filter(d=>d.agentIdx<e.length&&e[d.agentIdx].groupId!==s.groupId&&d.friendly).length;s.trust>.7&&c>=2&&(t[o]="mediator")}return t}let zz=2e3;const Rc=()=>`auto-${zz++}`;function Ac(e,t,r,o){return r.some(s=>(s.x-e)**2+(s.y-t)**2<o*o)}function Bz(e,t,r,o,s,l,i){if(!(r.totems.length+r.tabus.length+r.rituals.length>=12)&&!(Rd(o)>.12)){if(r.totems.length<4){const c=[];for(let d=0;d<t.groupCount;d++)c.push({g:d,cx:0,cy:0,mb:0,ms:0,n:0});for(const d of e){const h=c[d.groupId];h&&(h.cx+=d.x,h.cy+=d.y,h.mb+=d.belief,h.ms+=d.status,h.n++)}for(const d of c)if(!(d.n<8)&&(d.cx/=d.n,d.cy/=d.n,d.mb/=d.n,d.ms/=d.n,d.mb>.62&&d.ms>.25&&!Ac(d.cx,d.cy,r.totems,.4))){const h={id:Rc(),kind:"BOND",x:d.cx,y:d.cy,radius:.22,groupId:d.g,pulseStrength:.65,bornAt:s,emergent:!0};r.totems.push(h),i.push({time:s,icon:"",message:`Foundation  Group ${d.g} crystallised belief`,color:"#34d399"}),l.push({x:d.cx,y:d.cy,message:"Foundation",color:"#34d399",bornAt:s,ttl:5,age:0});return}}if(r.tabus.length<3&&o.violationsWindow>=2){const c=e.filter(d=>d.desire>.65);if(c.length>=3){const d=c.slice(0,6).reduce((f,g)=>f+g.x,0)/Math.min(6,c.length),h=c.slice(0,6).reduce((f,g)=>f+g.y,0)/Math.min(6,c.length);if(!Ac(d,h,r.tabus,.25)){const f={id:Rc(),kind:"NO_ENTER",x:d,y:h,radius:.17,severity:.55,bornAt:s,violationCount:0};r.tabus.push(f),i.push({time:s,icon:"",message:"Taboo sealed  community declares limit",color:"#ef4444"}),l.push({x:d,y:h,message:"Sealed",color:"#ef4444",bornAt:s,ttl:4,age:0});return}}}if(r.rituals.length<3){const c=e.reduce((h,f)=>h+f.belief,0)/e.length,d=e.reduce((h,f)=>h+f.ideology**2,0)/e.length;if(c>.65&&d<.18){const h=e.reduce((g,m)=>g+m.x,0)/e.length,f=e.reduce((g,m)=>g+m.y,0)/e.length;if(!Ac(h,f,r.rituals,.35)){const g={id:Rc(),kind:"GATHER",x:h,y:f,radius:.28,periodSec:9,lastFired:s,active:!1,bornAt:s};r.rituals.push(g),i.push({time:s,icon:"",message:"Ritual emerged  collective belief crystallised",color:"#a78bfa"}),l.push({x:h,y:f,message:"Ritual",color:"#a78bfa",bornAt:s,ttl:5,age:0});return}}}if(r.totems.filter(c=>c.kind==="RIFT").length<2){const c=e.reduce((h,f)=>h+f.ideology,0)/e.length,d=e.filter(h=>h.ideology<c-.55);if(d.length>=10){const h=d.reduce((m,y)=>m+y.x,0)/d.length,f=d.reduce((m,y)=>m+y.y,0)/d.length,g=d[0].groupId;if(!Ac(h,f,r.totems,.35)){const m={id:Rc(),kind:"RIFT",x:h,y:f,radius:.22,groupId:g,pulseStrength:.8,bornAt:s,emergent:!0};r.totems.push(m),i.push({time:s,icon:"",message:`Schism  faction ${g} breaks from consensus`,color:"#ff6b6b"}),l.push({x:h,y:f,message:"Schism",color:"#ff6b6b",bornAt:s,ttl:5,age:0});return}}}if(r.totems.filter(c=>c.kind==="ORACLE").length<2){const c=e.filter(d=>d.charisma>.25&&d.status>.35);if(c.length>=3){const d=c.reduce((f,g)=>f+g.x,0)/c.length,h=c.reduce((f,g)=>f+g.y,0)/c.length;if(!Ac(d,h,r.totems,.35)){const f={id:Rc(),kind:"ORACLE",x:d,y:h,radius:.24,groupId:c[0].groupId,pulseStrength:.9,bornAt:s,emergent:!0};r.totems.push(f),i.push({time:s,icon:"",message:"Oracle emerged  charismatic authority crystallised",color:"#c084fc"}),l.push({x:d,y:h,message:"Oracle",color:"#c084fc",bornAt:s,ttl:5,age:0});return}}}if(r.totems.filter(c=>c.kind==="ARCHIVE").length<2){const c=e.filter(d=>d.fatigue<.15&&d.belief>.5&&d.fear<.2);if(c.length>=e.length*.25){const d=c.reduce((f,g)=>f+g.x,0)/c.length,h=c.reduce((f,g)=>f+g.y,0)/c.length;if(!Ac(d,h,r.totems,.4)){const f={id:Rc(),kind:"ARCHIVE",x:d,y:h,radius:.2,groupId:0,pulseStrength:.5,bornAt:s,emergent:!0};r.totems.push(f),i.push({time:s,icon:"",message:"Archive emerged  collective memory preserved",color:"#94a3b8"}),l.push({x:d,y:h,message:"Archive",color:"#94a3b8",bornAt:s,ttl:5,age:0});return}}}if(r.rituals.filter(c=>c.kind==="OFFERING").length<2&&o.gini>.45){const c=e.filter(d=>d.wealth<.15);if(c.length>=8){const d=c.reduce((f,g)=>f+g.x,0)/c.length,h=c.reduce((f,g)=>f+g.y,0)/c.length;if(!Ac(d,h,r.rituals,.3)){const f={id:Rc(),kind:"OFFERING",x:d,y:h,radius:.25,periodSec:8,lastFired:s,active:!1,bornAt:s};r.rituals.push(f),i.push({time:s,icon:"",message:"Offering emerged  community responds to poverty",color:"#fbbf24"}),l.push({x:d,y:h,message:"Offering",color:"#fbbf24",bornAt:s,ttl:5,age:0});return}}}if(r.rituals.filter(c=>c.kind==="REVOLT").length<2){const c=e.filter(d=>d.resistance>.85);if(c.length>=6){const d=c.reduce((f,g)=>f+g.x,0)/c.length,h=c.reduce((f,g)=>f+g.y,0)/c.length;if(!Ac(d,h,r.rituals,.3)){const f={id:Rc(),kind:"REVOLT",x:d,y:h,radius:.35,periodSec:6,lastFired:s,active:!1,bornAt:s,emergent:!0};r.rituals.push(f),i.push({time:s,icon:"",message:"Revolt erupted against surveillance",color:"#ef4444"}),l.push({x:d,y:h,message:"Revolt",color:"#ef4444",bornAt:s,ttl:5,age:0});return}}}}}function Vi(e,t){return(e+1)*.5*t}function Ui(e,t){return(e+1)*.5*t}function $z(e,t){return .028*.5*Math.min(e,t)}function qz(e,t){const r=parseInt(e.slice(1,3),16),o=parseInt(e.slice(3,5),16),s=parseInt(e.slice(5,7),16);return`rgba(${r},${o},${s},${t})`}let fd=null,sb=null,W6=0,Uu=null,Yu=null,Ku=null;function Wz(e){return(!fd||W6!==e)&&(fd=document.createElement("canvas"),fd.width=e,fd.height=e,sb=fd.getContext("2d"),W6=e,Uu=null,Yu=null,Ku=null),sb}function K2(e,t,r,o,s){const l=new ImageData(t,t),i=l.data;for(let u=0;u<t*t;u++){const c=e[u];i[u*4]=r,i[u*4+1]=o,i[u*4+2]=s,i[u*4+3]=Math.min(255,c*240)}return l}function xu(e,t,r,o){const s=sb;!s||!fd||(s.putImageData(t,0,0),e.save(),e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="low",e.drawImage(fd,0,0,r,o),e.restore())}function nc(e){return e.archKeyStable>>>0||_g(e)}function H6(e){return e.archKeyMoment>>>0||_g(e)}function Hz(e,t,r,o,s,l,i,u,c,d,h,f,g){e.clearRect(0,0,t,r),e.fillStyle="#000000",e.fillRect(0,0,t,r),e.strokeStyle="rgba(255,255,255,0.03)",e.lineWidth=1,e.strokeRect(3,3,t-6,r-6);const m=d.size;Wz(m),d.dirty&&(Uu=K2(d.n,m,52,211,153),Yu=K2(d.l,m,167,139,250),Ku=K2(d.r,m,251,191,36),d.dirty=!1),u==="field"&&Uu&&Yu&&Ku?(e.globalAlpha=.5,xu(e,Uu,t,r),e.globalAlpha=.4,xu(e,Yu,t,r),e.globalAlpha=.35,xu(e,Ku,t,r),e.globalAlpha=1):u==="power"&&Uu&&Yu?(e.globalAlpha=.45,xu(e,Uu,t,r),e.globalAlpha=.55,xu(e,Yu,t,r),e.globalAlpha=1):u==="economy"&&Ku&&(e.globalAlpha=.55,xu(e,Ku,t,r),e.globalAlpha=1),u!=="off"&&Jz(e,t,r,c,h.exceptionActive,o),u!=="off"&&u!=="events"&&Gz(e,t,r,o);const y=$z(t,r);if(u==="off"?Xz(e,t,r,o,y):u==="economy"?Yz(e,t,r,o,s,y):u==="power"?Uz(e,t,r,o,s,y):u==="events"?Kz(e,t,r,o,y):u==="archetype"?Zz(e,t,r,o,s,y):Vz(e,t,r,o,s,y),Qz(e,t,r,f),u==="archetype"){const v=new Map;for(let S=0;S<o.length;S++){const C=nc(o[S]),k=v.get(C);k?k.n++:v.set(C,{n:1,label:Sz(C),color:tc(C)})}const b=Array.from(v.values()).sort((S,C)=>C.n-S.n).slice(0,8);if(b.length){e.save(),e.globalAlpha=.9,e.fillStyle="rgba(0,0,0,0.35)",e.fillRect(10,10,255,18+b.length*12),e.font="10px system-ui, sans-serif",e.textAlign="left",e.textBaseline="top",e.fillStyle="rgba(255,255,255,0.75)",e.fillText("Archetype (stable)",16,14);for(let S=0;S<b.length;S++){const C=28+S*12;e.fillStyle=b[S].color,e.globalAlpha=.9,e.fillRect(16,C+2,7,7),e.globalAlpha=.75,e.fillStyle="rgba(255,255,255,0.70)",e.fillText(`${b[S].n}  ${b[S].label}`,28,C)}e.restore()}}}function Gz(e,t,r,o,s){e.lineWidth=1.5,e.lineCap="round",e.lineJoin="round";for(let l=0;l<o.length;l++){const i=o[l];if(!i.trailX||i.trailX[0]===0)continue;e.beginPath();let u=!0;for(let c=0;c<i.trailX.length;c++){const d=(i.trailIdx+c)%i.trailX.length,h=i.trailX[d],f=i.trailY[d];if(h===0&&f===0)continue;const g=Vi(h,t),m=Ui(f,r);u?(e.moveTo(g,m),u=!1):e.lineTo(g,m)}e.strokeStyle=tc(nc(i)),e.globalAlpha=.2,e.stroke()}e.globalAlpha=1}function Oh(e,t,r,o,s,l,i,u){const c=Math.sqrt(o*o+s*s),d=c>1e-4?o/c:1,h=c>1e-4?s/c:0;e.globalAlpha=u,e.beginPath(),e.arc(t,r,l,0,Math.PI*2),e.fillStyle=i,e.fill(),e.beginPath(),e.moveTo(t+d*l,r+h*l),e.lineTo(t+d*(l+l*1.3),r+h*(l+l*1.3)),e.strokeStyle=i,e.lineWidth=Math.max(1,l*.5),e.lineCap="round",e.stroke(),e.globalAlpha=1}function Vz(e,t,r,o,s,l){for(let i=0;i<o.length;i++){const u=o[i],c=Vi(u.x,t),d=Ui(u.y,r),h=s[i]??"normal",f=tc(nc(u)),g=t0[u.groupId%t0.length],m=l*(.72+u.status*.72),y=Math.max(u.belief,u.fear,u.desire);if(y>.42){let v="";u.belief>=u.fear&&u.belief>=u.desire&&u.belief>.42?v="#34d399":u.fear>=u.desire&&u.fear>.42?v="#ef4444":u.desire>.42&&(v="#fbd38d"),v&&(e.beginPath(),e.arc(c,d,m+3.5,0,Math.PI*2),e.strokeStyle=v,e.lineWidth=1.5,e.globalAlpha=(y-.4)*1.2,e.stroke(),e.globalAlpha=1)}Oh(e,c,d,u.vx,u.vy,m,f,.82),e.beginPath(),e.arc(c,d,m+1.2,0,Math.PI*2),e.strokeStyle=qz(g,.65),e.lineWidth=.8,e.globalAlpha=.55,e.stroke(),e.globalAlpha=1,Dg(e,c,d,m,f,h)}}function Uz(e,t,r,o,s,l){for(let i=0;i<o.length;i++){const u=o[i],c=Vi(u.x,t),d=Ui(u.y,r),h=s[i]??"normal",f=tc(nc(u));u.status>.15&&(e.beginPath(),e.arc(c,d,l+u.status*l*2.5,0,Math.PI*2),e.save(),e.strokeStyle=f,e.lineWidth=1,e.globalAlpha=Math.min(.6,.12+u.status*.35),e.stroke(),e.restore());const g=Math.round(255*(.5+u.fear*.5)),m=Math.round(100*(1-u.fear*.6)),y=u.fear>.4?`rgb(${g},${m},60)`:f;Oh(e,c,d,u.vx,u.vy,l,y,.8),Dg(e,c,d,l,f,h)}}function Yz(e,t,r,o,s,l){const i=o.map((c,d)=>({i:d,w:c.wealth})).sort((c,d)=>d.w-c.w),u=new Set(i.slice(0,10).map(c=>c.i));for(let c=0;c<o.length;c++){const d=o[c],h=Vi(d.x,t),f=Ui(d.y,r),g=s[c]??"normal",m=tc(nc(d));u.has(c)&&(e.beginPath(),e.arc(h,f,l+5+d.wealth*6,0,Math.PI*2),e.strokeStyle=`rgba(251,191,36,${d.wealth*.55})`,e.lineWidth=2,e.stroke()),Oh(e,h,f,d.vx,d.vy,l,m,.35+d.wealth*.55),Dg(e,h,f,l,m,g)}}function Kz(e,t,r,o,s){for(let l=0;l<o.length;l++){const i=o[l],u=tc(nc(i));Oh(e,Vi(i.x,t),Ui(i.y,r),i.vx,i.vy,s*.7,u,.25)}}function Xz(e,t,r,o,s){for(const l of o){const i=tc(nc(l));Oh(e,Vi(l.x,t),Ui(l.y,r),l.vx,l.vy,s,i,.82)}}function Zz(e,t,r,o,s,l){for(let i=0;i<o.length;i++){const u=o[i],c=Vi(u.x,t),d=Ui(u.y,r),h=s[i]??"normal",f=tc(nc(u)),g=tc(H6(u)),m=f,y=l*(.72+u.status*.55);H6(u)!==nc(u)&&(e.beginPath(),e.arc(c,d,y+2.5,0,Math.PI*2),e.strokeStyle=g,e.lineWidth=1,e.setLineDash([2,3]),e.globalAlpha=.35,e.stroke(),e.setLineDash([]),e.globalAlpha=1),h==="dictator"?(e.beginPath(),e.arc(c,d,y+7,0,Math.PI*2),e.strokeStyle="rgba(239,68,68,0.95)",e.lineWidth=2.2,e.globalAlpha=.55,e.stroke(),e.globalAlpha=1):h==="rebel"?(e.beginPath(),e.arc(c,d,y+4,0,Math.PI*2),e.strokeStyle="#f87171",e.lineWidth=1.5,e.globalAlpha=.45,e.stroke(),e.globalAlpha=1):h==="leader"?(e.beginPath(),e.arc(c,d,y+5,0,Math.PI*2),e.strokeStyle="#fbbf24",e.lineWidth=1.5,e.globalAlpha=.5,e.stroke(),e.globalAlpha=1):h==="authority"||h==="guardian"?(e.beginPath(),e.arc(c,d,y+4.5,0,Math.PI*2),e.strokeStyle="#60a5fa",e.lineWidth=1.2,e.globalAlpha=.45,e.stroke(),e.globalAlpha=1):h==="priest"&&(e.beginPath(),e.arc(c,d,y+4,0,Math.PI*2),e.strokeStyle="#c084fc",e.lineWidth=1,e.setLineDash([3,3]),e.globalAlpha=.55,e.stroke(),e.setLineDash([]),e.globalAlpha=1),Oh(e,c,d,u.vx,u.vy,y,m,.85),Dg(e,c,d,y,m,h)}}function Dg(e,t,r,o,s,l){switch(l){case"leader":e.beginPath(),e.arc(t,r,o+2.5,0,Math.PI*2),e.strokeStyle=s,e.lineWidth=1.5,e.globalAlpha=.65,e.stroke(),e.beginPath(),e.arc(t,r,o+5,0,Math.PI*2),e.lineWidth=.7,e.globalAlpha=.28,e.stroke(),e.globalAlpha=1;break;case"authority":{e.beginPath(),e.arc(t,r,o+3.2,0,Math.PI*2),e.strokeStyle="#60a5fa",e.lineWidth=1.6,e.globalAlpha=.75,e.stroke(),e.beginPath(),e.arc(t,r,o*.22,0,Math.PI*2),e.fillStyle="#60a5fa",e.globalAlpha=.55,e.fill(),e.globalAlpha=1;break}case"dictator":{const i=o+4;e.globalAlpha=.85,e.strokeStyle="#ef4444",e.lineWidth=2.2,e.strokeRect(t-i,r-i,i*2,i*2),e.globalAlpha=.65,e.beginPath(),e.moveTo(t-i,r-i),e.lineTo(t-i-5,r-i-3),e.moveTo(t+i,r-i),e.lineTo(t+i+5,r-i-3),e.moveTo(t-i,r+i),e.lineTo(t-i-5,r+i+3),e.moveTo(t+i,r+i),e.lineTo(t+i+5,r+i+3),e.stroke(),e.globalAlpha=1;break}case"aggressor":e.beginPath(),e.arc(t,r,o,0,Math.PI*2),e.strokeStyle="#ef4444",e.lineWidth=2,e.globalAlpha=.8,e.stroke(),e.beginPath(),e.moveTo(t,r-o-6),e.lineTo(t-3,r-o),e.lineTo(t+3,r-o),e.closePath(),e.fillStyle="#ef4444",e.globalAlpha=.6,e.fill(),e.globalAlpha=1;break;case"guardian":e.beginPath(),e.arc(t,r,o+2.5,0,Math.PI*2),e.strokeStyle="#fbd38d",e.lineWidth=1.5,e.globalAlpha=.6,e.stroke(),e.globalAlpha=1;break;case"mediator":e.beginPath(),e.arc(t,r,o*.35,0,Math.PI*2),e.fillStyle="#ffffff",e.globalAlpha=.7,e.fill(),e.globalAlpha=1;break;case"rebel":e.beginPath(),e.moveTo(t-3,r-o-8),e.lineTo(t+1,r-o-4),e.lineTo(t-1,r-o-2),e.lineTo(t+3,r-o+1),e.strokeStyle="#f87171",e.lineWidth=1.5,e.globalAlpha=.85,e.stroke(),e.globalAlpha=1;break;case"priest":e.beginPath(),e.arc(t,r,o+3,0,Math.PI*2),e.strokeStyle="#c084fc",e.lineWidth=.8,e.setLineDash([2,3]),e.globalAlpha=.55,e.stroke(),e.setLineDash([]),e.globalAlpha=1;break}}function X2(e,t,r,o){let s=0;for(const l of e)(l.x-t)**2+(l.y-r)**2<o*o&&s++;return s}function Jz(e,t,r,o,s,l){for(const i of o.rituals){const u=Vi(i.x,t),c=Ui(i.y,r),d=i.radius*.5*Math.min(t,r),h=i.kind==="GATHER"?"#a78bfa":i.kind==="OFFERING"?"#fbbf24":i.kind==="REVOLT"?"#ef4444":"#fbd38d";e.beginPath(),e.arc(u,c,d,0,Math.PI*2),e.strokeStyle=h,e.lineWidth=i.active?i.kind==="REVOLT"?3:2:1,e.globalAlpha=i.active?i.kind==="REVOLT"?.6:.5:.2,i.kind==="REVOLT"&&i.active?e.setLineDash([10,5,2,5]):e.setLineDash(i.active?[]:[4,4]),e.stroke(),e.setLineDash([]),e.globalAlpha=1;const f=X2(l,i.x,i.y,i.radius),g=i.kind==="GATHER"?" Gather":i.kind==="OFFERING"?" Offering":i.kind==="REVOLT"?" Revolt":" Procession",m=i.active?`  ${f} in`:`  ${f} near`;L0(e,u,c-d-12,g,h),L0(e,u,c-d-3,m,h)}for(const i of o.tabus){const u=Vi(i.x,t),c=Ui(i.y,r),d=i.radius*.5*Math.min(t,r),h="#ef4444";e.beginPath(),e.arc(u,c,d,0,Math.PI*2),e.fillStyle=h,e.globalAlpha=.07*(s?1.8:1),e.fill(),e.beginPath(),e.arc(u,c,d,0,Math.PI*2),e.strokeStyle=h,e.lineWidth=s?2.5:1.5,e.globalAlpha=.55,e.stroke(),e.globalAlpha=1;const f=X2(l,i.x,i.y,i.radius),g=i.kind==="NO_ENTER"?" No-Enter":" No-Mix",m=i.violationCount>0?`  ${i.violationCount} violations`:"";L0(e,u,c-d-12,g,h),L0(e,u,c-d-3,`${f} inside${m}`,h)}for(const i of o.totems){const u=Vi(i.x,t),c=Ui(i.y,r),d=i.radius*.5*Math.min(t,r),f={BOND:"#34d399",RIFT:"#ff6b6b",ORACLE:"#c084fc",ARCHIVE:"#94a3b8",PANOPTICON:"#fbbf24"}[i.kind]||"#34d399";e.beginPath(),e.arc(u,c,d,0,Math.PI*2),e.fillStyle=f,e.globalAlpha=.06,e.fill(),e.beginPath(),e.arc(u,c,d,0,Math.PI*2),e.strokeStyle=f,e.lineWidth=i.kind==="PANOPTICON"?2:1.5,e.globalAlpha=i.kind==="PANOPTICON"?.6:.45,i.kind==="PANOPTICON"&&e.setLineDash([2,4]),e.stroke(),e.setLineDash([]),e.globalAlpha=1,e.beginPath(),e.arc(u,c,i.kind==="PANOPTICON"?7:5,0,Math.PI*2),e.fillStyle=f,e.globalAlpha=i.kind==="PANOPTICON"?.9:.7,e.fill(),e.globalAlpha=1;const g={BOND:" Bond",RIFT:" Rift",ORACLE:" Oracle",ARCHIVE:" Archive",PANOPTICON:" Panopticon"},m={BOND:"deposits N+L",RIFT:"erodes N  faction L",ORACLE:"amplifies charisma",ARCHIVE:"locks memory",PANOPTICON:"surveils  conformity"},y=X2(l,i.x,i.y,i.radius);L0(e,u,c-d-20,g[i.kind]||i.kind,f),L0(e,u,c-d-11,m[i.kind]||"",f),L0(e,u,c-d-2,`${y} agents`,f)}}function L0(e,t,r,o,s){e.font="9px system-ui, sans-serif",e.fillStyle=s,e.globalAlpha=.65,e.textAlign="center",e.textBaseline="middle",e.fillText(o,t,r),e.globalAlpha=1}function Qz(e,t,r,o){for(const s of o){const l=1-s.age/s.ttl;if(l<=0)continue;const i=Vi(s.x,t),u=Ui(s.y,r),c=(1-l)*55+8;e.beginPath(),e.arc(i,u,c,0,Math.PI*2),e.strokeStyle=s.color,e.lineWidth=1.5,e.globalAlpha=l*.55,e.stroke(),l>.4&&(e.font="8px system-ui, sans-serif",e.fillStyle=s.color,e.globalAlpha=l*.75,e.textAlign="center",e.textBaseline="bottom",e.fillText(s.message,i,u-c-4)),e.globalAlpha=1}}let eB=500;const kv=()=>`sc-${eB++}`,zr=(e,t,r,o=.26,s=0,l=.85)=>({id:kv(),kind:e,x:t,y:r,radius:o,groupId:s,pulseStrength:l,bornAt:0}),Ds=(e,t,r,o=.18,s=.55)=>({id:kv(),kind:e,x:t,y:r,radius:o,severity:s,bornAt:0,violationCount:0}),Wa=(e,t,r,o=.28,s=8)=>({id:kv(),kind:e,x:t,y:r,radius:o,periodSec:s,lastFired:0,active:!1,bornAt:0}),Um=[{id:"open_market",name:"Open Market Tension",icon:"",category:"economy",description:"Resources abundant  no norms  accumulation  inequality & conflict",apply(e,t){e.agentCount=160,e.groupCount=4,e.speed=.5,e.aggressionBase=.35,e.trustBase=.45,e.kBelief=.2,e.harvestRate=.1,e.decayWealth=.008,e.ideologyPressure=.15,e.violationThreshold=6,e.autoSymbols=!0,t.decayN=.035,t.regenR=.04},setupWorld(e,t){os(e,.55,0,.6,.28),os(e,-.45,.5,.5,.22),os(e,-.2,-.55,.4,.18),os(e,.1,.55,.35,.15)}},{id:"discipline_state",name:"Discipline State",icon:"",category:"power",description:"Central BOND totem + Procession  high norms  conformity enforced",apply(e,t){e.agentCount=140,e.groupCount=3,e.speed=.38,e.aggressionBase=.18,e.trustBase=.65,e.kBelief=.65,e.kFear=.5,e.ideologyPressure=.4,e.violationThreshold=2,e.autoSymbols=!0,t.decayN=.008,t.diffuseN=.14,t.regenR=.016},setupWorld(e,t){for(let r=0;r<e.n.length;r++)e.n[r]=Math.min(1,e.n[r]+.38);ma(e,0,0,.55,.38),t.totems.push(zr("BOND",0,0,.34,0,1)),t.rituals.push(Wa("PROCESSION",0,0,.5,9)),e.dirty=!0}},{id:"polarization_spiral",name:"Polarization Spiral",icon:"",category:"conflict",description:"2 RIFT totems  low trust  ideology  extreme polarization",apply(e,t){e.agentCount=120,e.groupCount=2,e.speed=.52,e.aggressionBase=.5,e.trustBase=.28,e.ideologyPressure=.65,e.violationThreshold=3,e.autoSymbols=!0,t.diffuseN=.05,t.diffuseL=.03},setupWorld(e,t){t.totems.push(zr("RIFT",-.58,0,.3,0,1)),t.totems.push(zr("RIFT",.58,0,.3,1,1)),ma(e,-.58,0,.45,.28),ma(e,.58,0,.45,.28),e.dirty=!0}},{id:"sacred_founder",name:"Sacred Founder",icon:"",category:"genesis",description:"Single massive BOND totem draws all groups  pilgrimage dynamics",apply(e,t){e.agentCount=160,e.groupCount=4,e.speed=.42,e.cohesion=.45,e.kBelief=.55,e.kFear=.25,e.ideologyPressure=.3,e.autoSymbols=!0,t.decayL=.004,t.diffuseL=.08},setupWorld(e,t){t.totems.push(zr("BOND",0,0,.55,0,1.2)),ma(e,0,0,.9,.55),si(e,0,0,.6,.4),e.dirty=!0}},{id:"tribal_council",name:"Tribal Council",icon:"",category:"genesis",description:"5 independent tribes  each with a BOND totem  federation dynamics",apply(e,t){e.agentCount=150,e.groupCount=5,e.speed=.45,e.cohesion=.65,e.aggressionBase=.28,e.ideologyPressure=.2,e.autoSymbols=!0,t.diffuseN=.08},setupWorld(e,t){[[0,-.62],[.59,-.19],[.36,.5],[-.36,.5],[-.59,-.19]].forEach(([o,s],l)=>{t.totems.push(zr("BOND",o,s,.22,l,.75)),ma(e,o,s,.35,.2)}),e.dirty=!0}},{id:"scarcity_war",name:"Scarcity War",icon:"",category:"conflict",description:"Resources near depletion  groups clash over remaining hotspots",apply(e,t){e.agentCount=160,e.groupCount=4,e.speed=.55,e.aggressionBase=.6,e.trustBase=.3,e.harvestRate=.14,e.decayWealth=.025,e.violationThreshold=4,e.autoSymbols=!0,t.regenR=.006,t.decayR=.015},setupWorld(e,t){for(let r=0;r<e.r.length;r++)e.r[r]=.05;os(e,.5,-.5,.7,.22),os(e,-.5,.5,.65,.2),e.dirty=!0}},{id:"factional_war",name:"Factional Holy War",icon:"",category:"conflict",description:"2 groups  opposing RIFT totems  max aggression  legitimacy conflict",apply(e,t){e.agentCount=140,e.groupCount=2,e.speed=.58,e.aggressionBase=.72,e.trustBase=.15,e.ideologyPressure=.7,e.kFear=.55,e.violationThreshold=2,e.exceptionDuration=40,e.autoSymbols=!0,t.diffuseN=.04},setupWorld(e,t){t.totems.push(zr("RIFT",-.55,.1,.32,0,1.1)),t.totems.push(zr("RIFT",.55,-.1,.32,1,1.1)),ma(e,-.55,0,.55,.3),ma(e,.55,0,.55,.3),t.tabus.push(Ds("NO_MIX",0,0,.2,.8)),e.dirty=!0}},{id:"the_schism",name:"The Schism",icon:"",category:"conflict",description:"4 groups unified then split  watch polarization break cohesion",apply(e,t){e.agentCount=160,e.groupCount=4,e.speed=.46,e.cohesion=.7,e.aggressionBase=.22,e.ideologyPressure=.55,e.autoSymbols=!0,t.diffuseN=.07,t.diffuseL=.04},setupWorld(e,t){t.totems.push(zr("BOND",0,0,.4,0,.8)),t.totems.push(zr("RIFT",.7,.7,.22,0,.9)),t.totems.push(zr("RIFT",-.7,-.7,.22,2,.9)),si(e,0,0,.5,.4),e.dirty=!0}},{id:"border_tensions",name:"Border Tensions",icon:"",category:"conflict",description:"3 groups  3 Taboo boundaries  mixing forbidden  endogamy",apply(e,t){e.agentCount=150,e.groupCount=3,e.speed=.44,e.aggressionBase=.4,e.trustBase=.35,e.autoSymbols=!0,t.diffuseN=.1},setupWorld(e,t){t.tabus.push(Ds("NO_MIX",.55,0,.22,.7)),t.tabus.push(Ds("NO_MIX",-.28,.48,.22,.7)),t.tabus.push(Ds("NO_MIX",-.28,-.48,.22,.7)),e.dirty=!0}},{id:"gold_rush",name:"Gold Rush",icon:"",category:"economy",description:"5 resource hotspots  fast harvest  visible inequality race",apply(e,t){e.agentCount=160,e.groupCount=4,e.harvestRate=.13,e.decayWealth=.006,e.aggressionBase=.3,e.trustBase=.5,e.autoSymbols=!0,t.regenR=.03,t.decayR=.003},setupWorld(e,t){[[.6,0],[-.6,0],[0,.6],[0,-.6],[0,0]].forEach(([o,s])=>os(e,o,s,.8,.18)),e.dirty=!0}},{id:"plutocracy",name:"Plutocracy",icon:"",category:"economy",description:"Extreme wealthstatus advantage  elites dominate access to L",apply(e,t){e.agentCount=160,e.groupCount=4,e.harvestRate=.15,e.decayWealth=.004,e.aggressionBase=.2,e.trustBase=.45,e.ideologyPressure=.2,e.autoSymbols=!0,t.regenR=.025,t.decayL=.004},setupWorld(e,t){os(e,0,0,.9,.5),t.totems.push(zr("BOND",0,0,.45,0,1.2)),e.dirty=!0}},{id:"redistribution",name:"Redistribution Crisis",icon:"",category:"economy",description:"Equal starting R + fast depletion  GATHER rituals redistribute",apply(e,t){e.agentCount=140,e.groupCount=3,e.harvestRate=.08,e.decayWealth=.018,e.cohesion=.6,e.kBelief=.45,e.autoSymbols=!0,t.regenR=.012,t.decayR=.01},setupWorld(e,t){for(let r=0;r<e.r.length;r++)e.r[r]=.8;t.rituals.push(Wa("GATHER",-.45,-.45,.3,7)),t.rituals.push(Wa("GATHER",.45,.45,.3,7)),e.dirty=!0}},{id:"mind_merge",name:"Mind Merge",icon:"",category:"culture",description:"Extreme ideology pressure  5 groups converging to single worldview",apply(e,t){e.agentCount=150,e.groupCount=5,e.speed=.4,e.ideologyPressure=.8,e.pressure=.6,e.trustBase=.7,e.aggressionBase=.1,e.autoSymbols=!0,t.diffuseN=.15}},{id:"reform_wave",name:"Reform Wave",icon:"",category:"culture",description:"Declining norms  high desire  transgression becomes new norm",apply(e,t){e.agentCount=160,e.groupCount=4,e.kDesire=.65,e.kBelief=.15,e.aggressionBase=.22,e.trustBase=.55,e.ideologyPressure=.35,e.violationThreshold=8,e.autoSymbols=!0,t.decayN=.045,t.diffuseN=.08},setupWorld(e,t){for(let r=0;r<e.n.length;r++)e.n[r]=Math.min(1,e.n[r]+.45);e.dirty=!0}},{id:"assembly_democracy",name:"Assembly Democracy",icon:"",category:"culture",description:"3 GATHER rituals  consensus building  polarization falls over time",apply(e,t){e.agentCount=140,e.groupCount=3,e.speed=.38,e.cohesion=.55,e.pressure=.5,e.trustBase=.65,e.aggressionBase=.12,e.autoSymbols=!0,t.diffuseN=.12},setupWorld(e,t){t.rituals.push(Wa("GATHER",0,0,.35,7)),t.rituals.push(Wa("GATHER",-.55,.55,.28,11)),t.rituals.push(Wa("GATHER",.55,.55,.28,11)),e.dirty=!0}},{id:"carnival_collapse",name:"Carnival & Collapse",icon:"",category:"culture",description:"High desire  ritual overload  fatigue cascade  norms dissolve",apply(e,t){e.agentCount=160,e.groupCount=4,e.speed=.58,e.kDesire=.75,e.kBelief=.1,e.aggressionBase=.18,e.trustBase=.6,e.violationThreshold=10,e.autoSymbols=!0,t.decayN=.055,t.regenR=.035},setupWorld(e,t){t.rituals.push(Wa("GATHER",0,0,.45,4)),t.rituals.push(Wa("GATHER",.6,.6,.25,3)),t.rituals.push(Wa("GATHER",-.6,.6,.25,3)),t.rituals.push(Wa("GATHER",0,-.65,.25,5));for(let r=0;r<e.r.length;r++)e.r[r]=.6;e.dirty=!0}},{id:"iron_order",name:"Iron Order",icon:"",category:"power",description:"N field maxed  fear economy  exception threshold = 1 violation",apply(e,t){e.agentCount=140,e.groupCount=3,e.speed=.35,e.kBelief=.8,e.kFear=.75,e.aggressionBase=.1,e.trustBase=.55,e.violationThreshold=1,e.exceptionDuration=40,e.autoSymbols=!0,t.decayN=.005,t.diffuseN=.18},setupWorld(e,t){for(let r=0;r<e.n.length;r++)e.n[r]=.85;t.totems.push(zr("BOND",0,0,.55,0,1.4)),t.rituals.push(Wa("PROCESSION",0,0,.65,6)),e.dirty=!0}},{id:"panopticon",name:"Panopticon",icon:"",category:"power",description:"4 Taboo NO_ENTER zones  surveillance grid  fear drives compliance",apply(e,t){e.agentCount=150,e.groupCount=3,e.speed=.4,e.kFear=.65,e.kBelief=.5,e.violationThreshold=2,e.autoSymbols=!0,t.diffuseN=.12},setupWorld(e,t){t.tabus.push(Ds("NO_ENTER",.55,.55,.2,.8)),t.tabus.push(Ds("NO_ENTER",-.55,.55,.2,.8)),t.tabus.push(Ds("NO_ENTER",.55,-.55,.2,.8)),t.tabus.push(Ds("NO_ENTER",-.55,-.55,.2,.8)),e.dirty=!0}},{id:"peace_brokers",name:"Peace Brokers",icon:"",category:"power",description:"High trust  mediators dominant  cross-group bonds prevent escalation",apply(e,t){e.agentCount=160,e.groupCount=4,e.speed=.42,e.trustBase=.82,e.aggressionBase=.05,e.pressure=.55,e.cohesion=.4,e.ideologyPressure=.35,e.autoSymbols=!0,t.diffuseL=.1,t.regenR=.025}},{id:"phoenix",name:"Phoenix",icon:"",category:"power",description:"Starts in STATE OF EXCEPTION  watch how order rebuilds from collapse",apply(e,t){e.agentCount=140,e.groupCount=4,e.speed=.5,e.kFear=.6,e.kBelief=.4,e.aggressionBase=.45,e.trustBase=.3,e.violationThreshold=1,e.exceptionDuration=35,e.autoSymbols=!0,t.decayN=.025},setupWorld(e,t){for(let r=0;r<e.n.length;r++)e.n[r]=.05;for(let r=0;r<e.r.length;r++)e.r[r]=.7;e.dirty=!0}},{id:"nomadic_encounter",name:"Nomadic Encounter",icon:"",category:"genesis",description:"High mobility  low loyalty  groups intermix freely  emergent tribes",apply(e){e.agentCount=180,e.groupCount=5,e.speed=.55,e.mobility=.6,e.cohesion=.2,e.culturalInertia=.15,e.contagion=.55,e.empathy=.5,e.conformity=.15,e.cooperationBias=.35,e.autoSymbols=!0}},{id:"silent_consensus",name:"Silent Consensus",icon:"",category:"genesis",description:"Extreme conformity  no aggression  ideology converges without conflict",apply(e){e.agentCount=160,e.groupCount=3,e.conformity=.9,e.empathy=.65,e.aggressionBase=.02,e.ideologyPressure=.5,e.culturalInertia=.7,e.innovationRate=.01,e.autoSymbols=!0},setupWorld(e){for(let t=0;t<e.n.length;t++)e.n[t]=.35;e.dirty=!0}},{id:"first_contact",name:"First Contact",icon:"",category:"genesis",description:"2 isolated groups meet  empathy vs aggression determines outcome",apply(e){e.agentCount=120,e.groupCount=2,e.speed=.42,e.empathy=.55,e.aggressionBase=.35,e.contagion=.4,e.mobility=.15,e.culturalInertia=.6,e.cooperationBias=.25,e.autoSymbols=!0},setupWorld(e,t){t.totems.push(zr("BOND",-.6,0,.22,0,.7)),t.totems.push(zr("BOND",.6,0,.22,1,.7)),e.dirty=!0}},{id:"oral_tradition",name:"Oral Tradition",icon:"",category:"genesis",description:"High contagion + archives emerge  memes spread and crystallize",apply(e){e.agentCount=150,e.groupCount=4,e.contagion=.75,e.culturalInertia=.55,e.hierarchyStrength=.5,e.empathy=.4,e.conformity=.45,e.autoSymbols=!0}},{id:"culture_war",name:"Culture War",icon:"",category:"conflict",description:"High contagion + low empathy + innovation  memetic conflict",apply(e){e.agentCount=180,e.groupCount=4,e.contagion=.7,e.empathy=.1,e.innovationRate=.15,e.ideologyPressure=.65,e.aggressionBase=.4,e.culturalInertia=.25,e.hierarchyStrength=.55,e.autoSymbols=!0},setupWorld(e,t){t.totems.push(zr("RIFT",-.5,-.5,.24,0,.9)),t.totems.push(zr("RIFT",.5,.5,.24,2,.9)),e.dirty=!0}},{id:"class_revolt",name:"Class Revolt",icon:"",category:"conflict",description:"Extreme inequality + high desire + low conformity  uprising",apply(e){e.agentCount=200,e.groupCount=3,e.speed=.52,e.aggressionBase=.45,e.conformity=.1,e.kDesire=.7,e.cooperationBias=.55,e.resourceScarcity=.2,e.harvestRate=.12,e.decayWealth=.02,e.violationThreshold=2,e.autoSymbols=!0},setupWorld(e){for(let t=0;t<e.r.length;t++)e.r[t]=.08;os(e,0,0,.9,.18),e.dirty=!0}},{id:"proxy_war",name:"Proxy War",icon:"",category:"conflict",description:"4 groups  2 Oracles manipulate  hierarchy drives factional violence",apply(e){e.agentCount=160,e.groupCount=4,e.hierarchyStrength=.8,e.aggressionBase=.38,e.empathy=.12,e.contagion=.5,e.ideologyPressure=.55,e.autoSymbols=!0},setupWorld(e,t){t.totems.push(zr("ORACLE",-.55,.2,.26,0,1)),t.totems.push(zr("ORACLE",.55,-.2,.26,2,1)),ma(e,-.55,.2,.5,.25),ma(e,.55,-.2,.5,.25),e.dirty=!0}},{id:"genocide_risk",name:"Genocide Risk",icon:"",category:"conflict",description:"Exception + max aggression + NO_MIX + zero empathy  worst case",apply(e){e.agentCount=140,e.groupCount=2,e.speed=.5,e.aggressionBase=.8,e.empathy=0,e.conformity=.7,e.kFear=.7,e.trustBase=.1,e.violationThreshold=1,e.exceptionDuration=50,e.autoSymbols=!0},setupWorld(e,t){for(let r=0;r<e.n.length;r++)e.n[r]=.7;t.tabus.push(Ds("NO_MIX",0,0,.3,.9)),t.totems.push(zr("RIFT",-.55,0,.28,0,1.2)),t.totems.push(zr("RIFT",.55,0,.28,1,1.2)),e.dirty=!0}},{id:"commons_tragedy",name:"Tragedy of the Commons",icon:"",category:"economy",description:"Shared resources + zero cooperation  depletion  conflict",apply(e){e.agentCount=180,e.groupCount=4,e.cooperationBias=0,e.harvestRate=.14,e.decayWealth=.015,e.resourceScarcity=.3,e.aggressionBase=.35,e.conformity=.2,e.autoSymbols=!0},setupWorld(e){for(let t=0;t<e.r.length;t++)e.r[t]=.5;e.dirty=!0}},{id:"gift_economy",name:"Gift Economy",icon:"",category:"economy",description:"Max cooperation + offering rituals + empathy  wealth equality",apply(e){e.agentCount=140,e.groupCount=3,e.cooperationBias=.85,e.empathy=.65,e.harvestRate=.07,e.decayWealth=.01,e.aggressionBase=.05,e.conformity=.45,e.autoSymbols=!0},setupWorld(e,t){t.rituals.push(Wa("OFFERING",0,0,.35,6)),t.rituals.push(Wa("OFFERING",-.55,-.55,.25,8));for(let r=0;r<e.r.length;r++)e.r[r]=.55;e.dirty=!0}},{id:"colonial_extraction",name:"Colonial Extraction",icon:"",category:"economy",description:"Central group hoards R  peripheral groups depleted  hierarchy exploits",apply(e){e.agentCount=180,e.groupCount=4,e.hierarchyStrength=.75,e.cooperationBias=.1,e.harvestRate=.15,e.decayWealth=.005,e.resourceScarcity=.35,e.conformity=.55,e.autoSymbols=!0},setupWorld(e,t){for(let r=0;r<e.r.length;r++)e.r[r]=.1;os(e,0,0,.95,.3),t.totems.push(zr("BOND",0,0,.35,0,1.1)),t.tabus.push(Ds("NO_ENTER",0,0,.2,.8)),e.dirty=!0}},{id:"renaissance",name:"Renaissance",icon:"",category:"culture",description:"High innovation + high empathy + oracles  cultural explosion",apply(e){e.agentCount=160,e.groupCount=5,e.innovationRate=.2,e.empathy=.6,e.contagion=.55,e.culturalInertia=.1,e.cooperationBias=.45,e.hierarchyStrength=.4,e.aggressionBase=.08,e.autoSymbols=!0},setupWorld(e,t){t.totems.push(zr("ORACLE",0,0,.3,0,1)),os(e,0,0,.6,.4),e.dirty=!0}},{id:"mass_hysteria",name:"Mass Hysteria",icon:"",category:"culture",description:"Max empathy + fear contagion + low conformity  panic cascades",apply(e){e.agentCount=180,e.groupCount=3,e.empathy=.9,e.kFear=.65,e.conformity=.15,e.contagion=.65,e.aggressionBase=.3,e.innovationRate=.08,e.speed=.55,e.autoSymbols=!0},setupWorld(e,t){t.tabus.push(Ds("NO_ENTER",0,0,.25,.9)),e.dirty=!0}},{id:"cultural_assimilation",name:"Cultural Assimilation",icon:"",category:"culture",description:"High mobility + high conformity + 1 dominant BOND  groups merge",apply(e){e.agentCount=160,e.groupCount=5,e.mobility=.5,e.conformity=.7,e.contagion=.6,e.culturalInertia=.2,e.empathy=.4,e.cohesion=.3,e.autoSymbols=!0},setupWorld(e,t){t.totems.push(zr("BOND",0,0,.45,0,1.2)),si(e,0,0,.6,.4),e.dirty=!0}},{id:"counter_culture",name:"Counter-Culture",icon:"",category:"culture",description:"High innovation + low conformity + high desire  new movements emerge",apply(e){e.agentCount=160,e.groupCount=4,e.innovationRate=.18,e.conformity=.08,e.kDesire=.65,e.empathy=.45,e.contagion=.5,e.culturalInertia=.15,e.mobility=.3,e.aggressionBase=.15,e.autoSymbols=!0},setupWorld(e){for(let t=0;t<e.n.length;t++)e.n[t]=.55;e.dirty=!0}},{id:"theocracy",name:"Theocracy",icon:"",category:"power",description:"Oracle + BOND + max hierarchy + high conformity  total control",apply(e){e.agentCount=150,e.groupCount=3,e.hierarchyStrength=.9,e.conformity=.8,e.kBelief=.75,e.empathy=.3,e.culturalInertia=.8,e.innovationRate=.01,e.violationThreshold=1,e.autoSymbols=!0},setupWorld(e,t){for(let r=0;r<e.n.length;r++)e.n[r]=.75;t.totems.push(zr("ORACLE",0,0,.4,0,1.3)),t.totems.push(zr("BOND",0,.35,.28,0,.9)),t.rituals.push(Wa("PROCESSION",0,0,.55,7)),ma(e,0,0,.8,.45),e.dirty=!0}},{id:"anarchist_commune",name:"Anarchist Commune",icon:"",category:"power",description:"Zero hierarchy + max cooperation + high empathy + no norms  self-org",apply(e){e.agentCount=120,e.groupCount=4,e.hierarchyStrength=0,e.cooperationBias=.8,e.empathy=.7,e.conformity=0,e.kBelief=.05,e.kFear=.1,e.aggressionBase=.08,e.innovationRate=.12,e.mobility=.4,e.autoSymbols=!0,e.violationThreshold=99},setupWorld(e){for(let t=0;t<e.r.length;t++)e.r[t]=.65;e.dirty=!0}},{id:"populist_surge",name:"Populist Surge",icon:"",category:"power",description:"Charismatic Oracle + high contagion + empathy  rapid mass movement",apply(e){e.agentCount=200,e.groupCount=4,e.contagion=.8,e.empathy=.55,e.hierarchyStrength=.65,e.conformity=.45,e.ideologyPressure=.6,e.speed=.5,e.autoSymbols=!0},setupWorld(e,t){t.totems.push(zr("ORACLE",-.3,-.3,.3,0,1.2)),ma(e,-.3,-.3,.65,.3),e.dirty=!0}},{id:"panopticon_regime",name:"Panopticon Regime",icon:"",category:"power",description:"PANOPTICON + PROCESSION + strict tabus  fear rises  dictators emerge",apply(e,t){e.agentCount=170,e.groupCount=4,e.speed=.44,e.trustBase=.38,e.aggressionBase=.32,e.kBelief=.62,e.kFear=.7,e.conformity=.7,e.hierarchyStrength=.85,e.panopticism=.95,e.ideologyPressure=.45,e.violationThreshold=2,e.exceptionDuration=45,e.autoSymbols=!0,t.decayN=.01,t.diffuseN=.1,t.decayL=.006,t.regenR=.014},setupWorld(e,t){for(let r=0;r<e.n.length;r++)e.n[r]=Math.min(1,e.n[r]+.3);t.totems.push(zr("PANOPTICON",0,0,.62,0,1)),t.rituals.push(Wa("PROCESSION",0,0,.62,8)),t.tabus.push(Ds("NO_ENTER",.18,.08,.16,.7)),t.tabus.push(Ds("NO_ENTER",-.22,-.12,.16,.7));for(let r=0;r<e.r.length;r++)e.r[r]=.12;os(e,.65,0,.7,.18),os(e,-.65,0,.55,.16),ma(e,0,0,.55,.35),e.dirty=!0}},{id:"state_church",name:"State Church",icon:"",category:"power",description:"BOND + ARCHIVE + GATHER  high belief  priests legitimize authority",apply(e,t){e.agentCount=160,e.groupCount=4,e.speed=.4,e.kBelief=.75,e.kFear=.35,e.kDesire=.22,e.hierarchyStrength=.7,e.conformity=.6,e.empathy=.35,e.cooperationBias=.25,e.culturalInertia=.7,e.panopticism=.25,e.autoSymbols=!0,t.decayN=.006,t.diffuseN=.12,t.decayL=.003,t.regenR=.018},setupWorld(e,t){t.totems.push(zr("BOND",0,0,.48,0,1.15)),t.totems.push(zr("ARCHIVE",0,.38,.28,0,.7)),t.rituals.push(Wa("GATHER",0,0,.5,9)),si(e,0,0,.65,.45),ma(e,0,0,.7,.4),e.dirty=!0}},{id:"empire_collapse",name:"Empire Collapse",icon:"",category:"power",description:"Archive crumbles  high innovation + mobility  fragmentation",apply(e){e.agentCount=180,e.groupCount=5,e.mobility=.55,e.innovationRate=.15,e.culturalInertia=.1,e.conformity=.15,e.kBelief=.15,e.aggressionBase=.4,e.cooperationBias=.15,e.hierarchyStrength=.25,e.autoSymbols=!0},setupWorld(e,t){t.totems.push(zr("ARCHIVE",0,0,.35,0,.6));for(let r=0;r<e.n.length;r++)e.n[r]=.5;for(let r=0;r<e.l.length;r++)e.l[r]=.4;e.dirty=!0}}],tB={genesis:"Genesis",conflict:"Conflict",economy:"Economy",culture:"Culture",power:"Power"},Wr="'IBM Plex Mono', monospace",nB="'Doto', monospace";function rB(e){let t=e;return()=>(t=(t*9301+49297)%233280,t/233280)}let oB=1;const Z2=()=>`u-${oB++}`,aB={SWARM:"#94a3b8",CLUSTERS:"#34d399",POLARIZED:"#fbd38d",CONFLICT:"#ef4444",CONSENSUS:"#a78bfa",EXCEPTION:"#ff6b6b"},sB={SWARM:"",CLUSTERS:"",POLARIZED:"",CONFLICT:"!",CONSENSUS:"",EXCEPTION:"!"},Ym=[{id:"select",icon:"",label:"Select",color:"#94a3b8",desc:"Click agent to inspect"},{id:"totem_bond",icon:"",label:"Bond Totem",color:"#34d399",desc:"N+L deposit  grows leaders  draws believers"},{id:"totem_rift",icon:"",label:"Rift Totem",color:"#ff6b6b",desc:"Anti-N  factional L  drives polarization"},{id:"totem_oracle",icon:"",label:"Oracle",color:"#c084fc",desc:"High L deposit  amplifies charismatic authority"},{id:"totem_archive",icon:"",label:"Archive",color:"#94a3b8",desc:"Preserves N/L against decay  collective memory"},{id:"totem_panopticon",icon:"",label:"Panopticon",color:"#fbbf24",desc:"Max N visibility  forces conformity but sparks resistance"},{id:"tabu_enter",icon:"X",label:"No-Enter",color:"#ef4444",desc:"Fear pulse on entry  moral panic risk"},{id:"tabu_mix",icon:"",label:"No-Mix",color:"#f97316",desc:"Cross-group repulsion  promotes endogamy"},{id:"ritual_gather",icon:"",label:"Gather",color:"#a78bfa",desc:"Periodic consensus  N+L deposit  costs fatigue"},{id:"ritual_procession",icon:"|",label:"Procession",color:"#fbd38d",desc:"Discipline march  N boost  raises leader power"},{id:"ritual_offering",icon:"",label:"Offering",color:"#fbbf24",desc:"Redistributes R in radius  reduces inequality"},{id:"ritual_revolt",icon:"",label:"Revolt",color:"#ef4444",desc:"Destroys N  driven by high resistance & desire"}],G6=[{id:"off",label:"Off",desc:"Plain canvas"},{id:"groups",label:"Groups",desc:"Group color + psychology rings + roles"},{id:"archetype",label:"Archetype",desc:"Unique color per archetype-combination (not start groups)"},{id:"power",label:"Power",desc:"L/N fields + status auras + fear tint"},{id:"economy",label:"Economy",desc:"R field + wealth halos (top 10)"},{id:"events",label:"Events",desc:"Event pings only"},{id:"field",label:"Fields",desc:"All 3 fields: N=green L=violet R=gold"}];function J2({label:e,icon:t,children:r,align:o="left"}){const[s,l]=w.useState(!1),i=w.useRef(null);return w.useEffect(()=>{const u=c=>{var d;(d=i.current)!=null&&d.contains(c.target)||l(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[]),a.jsxs("div",{ref:i,className:"relative",children:[a.jsxs("button",{onClick:()=>l(u=>!u),style:{fontFamily:Wr},className:"flex items-center gap-1.5 px-2.5 py-1 border border-white/[0.08] bg-white/[0.03] text-white/60 hover:text-white/90 hover:border-white/20 transition-all text-[10px] tracking-wide",children:[t," ",e," ",a.jsx(Pa,{size:9,className:`transition-transform ${s?"rotate-180":""}`})]}),s&&a.jsx("div",{className:`absolute top-full mt-1 z-50 min-w-[200px] overflow-hidden ${o==="right"?"right-0":"left-0"}`,style:{background:"rgba(4,6,10,0.98)",border:"1px solid rgba(255,255,255,0.08)"},onClick:()=>l(!1),children:r})]})}function Km({icon:e,label:t,sub:r,active:o,onClick:s,color:l}){return a.jsxs("button",{onClick:s,className:"w-full flex items-center gap-2.5 px-3 py-1.5 text-left transition-colors",style:{fontFamily:Wr,background:o?"rgba(255,255,255,0.05)":""},onMouseEnter:i=>{o||(i.currentTarget.style.background="rgba(255,255,255,0.03)")},onMouseLeave:i=>{o||(i.currentTarget.style.background="")},children:[e&&a.jsx("span",{className:"text-[11px] shrink-0",children:e}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"text-[10px]",style:{color:o?l||"rgba(255,255,255,0.90)":"rgba(255,255,255,0.55)"},children:t}),r&&a.jsx("div",{className:"text-[9px] truncate",style:{color:"rgba(255,255,255,0.25)"},children:r})]}),o&&a.jsx("div",{className:"w-1 h-1 rounded-full shrink-0",style:{background:l||"#a78bfa"}})]})}function iB({label:e}){return a.jsx("div",{className:"px-3 py-1 text-[8px] uppercase tracking-[0.15em] mt-1 pt-2",style:{color:"rgba(255,255,255,0.20)",borderTop:"1px solid rgba(255,255,255,0.05)",fontFamily:Wr},children:e})}function ys({label:e,v:t,c:r}){return a.jsxs("div",{className:"flex items-center gap-2",style:{fontFamily:Wr},children:[a.jsx("span",{className:"text-[9px] w-14 shrink-0",style:{color:"rgba(255,255,255,0.35)"},children:e}),a.jsx("div",{className:"flex-1 h-px rounded-full overflow-hidden",style:{background:"rgba(255,255,255,0.08)"},children:a.jsx("div",{className:"h-full transition-all duration-300",style:{width:`${(t*100).toFixed(0)}%`,background:r}})}),a.jsx("span",{className:"text-[9px] w-7 text-right shrink-0",style:{color:"rgba(255,255,255,0.45)"},children:(t*100).toFixed(0)})]})}function bu({title:e,badge:t,open:r,onToggle:o,children:s}){return a.jsxs("div",{style:{borderBottom:"1px solid rgba(255,255,255,0.05)"},children:[a.jsxs("button",{onClick:o,className:"w-full flex items-center justify-between px-3 py-2 transition-colors",style:{fontFamily:Wr},onMouseEnter:l=>{l.currentTarget.style.background="rgba(255,255,255,0.02)"},onMouseLeave:l=>{l.currentTarget.style.background=""},children:[a.jsxs("span",{className:"flex items-center gap-2 text-[9px] uppercase tracking-[0.12em]",style:{color:"rgba(255,255,255,0.45)"},children:[e,t!==void 0&&a.jsx("span",{className:"text-[8px] px-1 py-px",style:{color:"rgba(255,255,255,0.30)",background:"rgba(255,255,255,0.06)"},children:t})]}),a.jsx(Pa,{size:10,className:`transition-transform ${r?"rotate-180":""}`,style:{color:"rgba(255,255,255,0.20)"}})]}),r&&a.jsx("div",{className:"px-3 pb-3 space-y-2",children:s})]})}const lB=({onLeave:e})=>{var mt,yt,Et,Ft;const t=w.useRef(null),r=w.useRef([]),o=w.useRef([]),s=w.useRef(O6()),l=w.useRef($2()),i=w.useRef(_6()),u=w.useRef(D6()),c=w.useRef(q2()),d=w.useRef(W2()),h=w.useRef([]),f=w.useRef([]),g=w.useRef({elapsed:0,lastMacro:-99,lastRole:-99}),m=w.useRef(0),y=w.useRef(0),[v,b]=w.useState(!1),S=w.useRef(!1),[C,k]=w.useState("archetype"),R=w.useRef("archetype"),[j,T]=w.useState("select"),_=w.useRef("select"),[P,I]=w.useState("discipline_state"),[$,q]=w.useState(()=>(Date.now()>>>0)%1e9),L=w.useRef($),[H,G]=w.useState("separated_clusters"),oe=w.useRef("separated_clusters"),[le,pe]=w.useState(W2()),[ce,te]=w.useState(q2()),[F,Q]=w.useState([]),[ae,we]=w.useState({w:window.innerWidth,h:window.innerHeight}),[Re,ge]=w.useState(0),[Ae,tt]=w.useState(-1),[We,J]=w.useState(null),[ke,Le]=w.useState("normal"),K=w.useRef(-1),[et,dt]=w.useState(!0),[Rt,Wt]=w.useState(!1),[Zt,$e]=w.useState(!1),[Ze,Fe]=w.useState(!0),[Xe,jt]=w.useState(!0),[hn,an]=w.useState(!0),[it,kt]=w.useState(!0);w.useEffect(()=>{const me=()=>we({w:window.innerWidth,h:window.innerHeight});return window.addEventListener("resize",me),()=>window.removeEventListener("resize",me)},[]),w.useEffect(()=>{L.current=$},[$]),w.useEffect(()=>{oe.current=H},[H]);const On=w.useCallback((me,cn)=>{const Xt=Um.find(ft=>ft.id===me)??Um[0],Dt=O6(),ne=D6();Xt.apply(Dt,ne),cn!==void 0&&(Dt.autoSymbols=cn),s.current=Dt,u.current=ne;const Ne=rB(L.current>>>0);r.current=Rz(Dt,Ne,oe.current),o.current=new Array(r.current.length).fill("normal");const Ke=_6(),Ct=$2();Xt.setupWorld&&Xt.setupWorld(Ke,Ct),i.current=Ke,l.current=Ct,c.current=q2(),c.current.rngState=L.current>>>0,h.current=[],f.current=[],g.current={elapsed:0,lastMacro:-99,lastRole:-99},pe(W2()),te({...c.current}),Q([]),I(me),kt(Dt.autoSymbols),ge(ft=>ft+1),tt(-1),J(null),K.current=-1},[]);w.useEffect(()=>{On("discipline_state")},[]);const sn=w.useRef({zoom:1,panX:0,panY:0}),Xn=w.useRef({active:!1,lastX:0,lastY:0,btn:0}),Pt=w.useRef(new Set),[zt,jn]=w.useState(1),[En,lt]=w.useState(!1);w.useEffect(()=>{const me=t.current;if(!me)return;const cn=Xt=>{Xt.preventDefault();const Dt=me.getBoundingClientRect(),ne=Xt.clientX-Dt.left-Dt.width/2,Ne=Xt.clientY-Dt.top-Dt.height/2,Ke=sn.current,Ct=Xt.deltaY>0?1/1.12:1.12,ft=Math.max(.15,Math.min(10,Ke.zoom*Ct)),At=ft/Ke.zoom;sn.current={zoom:ft,panX:ne+(Ke.panX-ne)*At,panY:Ne+(Ke.panY-Ne)*At},jn(ft),lt(Math.abs(sn.current.panX)>2||Math.abs(sn.current.panY)>2)};return me.addEventListener("wheel",cn,{passive:!1}),()=>me.removeEventListener("wheel",cn)},[]),w.useEffect(()=>{const me=t.current;if(!me)return;const cn=Ne=>{Xn.current={active:!0,lastX:Ne.clientX,lastY:Ne.clientY,btn:Ne.button},Ne.button===1&&Ne.preventDefault()},Xt=Ne=>{if(!Xn.current.active||Xn.current.btn!==1&&Xn.current.btn!==2)return;const Ke=Ne.clientX-Xn.current.lastX,Ct=Ne.clientY-Xn.current.lastY;Xn.current.lastX=Ne.clientX,Xn.current.lastY=Ne.clientY;const ft=sn.current;sn.current={...ft,panX:ft.panX+Ke,panY:ft.panY+Ct},lt(!0)},Dt=()=>{Xn.current.active=!1;const{panX:Ne,panY:Ke}=sn.current;lt(Math.abs(Ne)>2||Math.abs(Ke)>2)},ne=Ne=>{Ne.preventDefault()};return me.addEventListener("mousedown",cn),window.addEventListener("mousemove",Xt),window.addEventListener("mouseup",Dt),me.addEventListener("contextmenu",ne),()=>{me.removeEventListener("mousedown",cn),window.removeEventListener("mousemove",Xt),window.removeEventListener("mouseup",Dt),me.removeEventListener("contextmenu",ne)}},[]),w.useEffect(()=>{const me=Xt=>{var Ne;const Dt=(Ne=document.activeElement)==null?void 0:Ne.tagName;if(Dt==="INPUT"||Dt==="TEXTAREA"||Dt==="SELECT")return;const ne=Xt.key.toLowerCase();["w","a","s","d"].includes(ne)&&(Pt.current.add(ne),Xt.preventDefault()),ne==="r"&&(sn.current={zoom:1,panX:0,panY:0},jn(1),lt(!1))},cn=Xt=>{Pt.current.delete(Xt.key.toLowerCase())};return window.addEventListener("keydown",me),window.addEventListener("keyup",cn),()=>{window.removeEventListener("keydown",me),window.removeEventListener("keyup",cn)}},[]),w.useEffect(()=>{const me=t.current;if(!me)return;const cn=Xt=>{m.current=requestAnimationFrame(cn);const Dt=me.getContext("2d");if(!Dt)return;if(Pt.current.size>0){const At=5/sn.current.zoom,bt=sn.current;let{panX:nn,panY:Bt}=bt;Pt.current.has("a")&&(nn+=At),Pt.current.has("d")&&(nn-=At),Pt.current.has("w")&&(Bt+=At),Pt.current.has("s")&&(Bt-=At),sn.current={...bt,panX:nn,panY:Bt}}if(S.current)y.current=Xt;else{const At=Math.min((Xt-y.current)/1e3,.05);y.current=Xt,g.current.elapsed+=At;const bt=g.current.elapsed,nn=Az(r.current);jz(r.current,nn,s.current,At);for(const Bt of h.current)Bt.age+=At;if(h.current=h.current.filter(Bt=>Bt.age<Bt.ttl),bt-g.current.lastMacro>=s.current.macroTickSec){const Bt=Math.max(s.current.macroTickSec,bt-g.current.lastMacro);s.current.autoSymbols=ht.current;const Jt=Tz(r.current,s.current,l.current,i.current,u.current,c.current,bt,Bt,h.current);Jt.length>0&&(f.current=[...Jt,...f.current].slice(0,30),Q([...f.current]),l.current.totems.length+l.current.tabus.length+l.current.rituals.length>0&&ge(Wn=>Wn+1));const Qt=Mv(r.current,s.current);d.current=Qt,pe({...Qt}),te({...c.current}),ge(vn=>vn+1),g.current.lastMacro=bt;const en=K.current;en>=0&&en<r.current.length&&(J({...r.current[en]}),Le(o.current[en]??"normal"))}bt-g.current.lastRole>=2&&(o.current=Lz(r.current),g.current.lastRole=bt)}const ne=me.width,Ne=me.height,{zoom:Ke,panX:Ct,panY:ft}=sn.current;Dt.setTransform(1,0,0,1,0,0),Dt.fillStyle="#070714",Dt.fillRect(0,0,ne,Ne),Dt.save(),Dt.translate(ne/2+Ct,Ne/2+ft),Dt.scale(Ke,Ke),Dt.translate(-ne/2,-Ne/2),Hz(Dt,me.width,me.height,r.current,o.current,s.current,d.current,R.current,l.current,i.current,c.current,h.current,g.current.elapsed),Dt.restore()};return y.current=performance.now(),m.current=requestAnimationFrame(cn),()=>cancelAnimationFrame(m.current)},[ae]);const ht=w.useRef(!0);w.useEffect(()=>{ht.current=it,s.current.autoSymbols=it},[it]);const _t=w.useCallback(me=>{const cn=me.currentTarget.getBoundingClientRect(),Xt=me.clientX-cn.left,Dt=me.clientY-cn.top,ne=cn.width,Ne=cn.height,{zoom:Ke,panX:Ct,panY:ft}=sn.current,At=2*(Xt-ne/2-Ct)/(Ke*ne),bt=2*(Dt-Ne/2-ft)/(Ke*Ne),nn=_.current,Bt=l.current;if(nn==="select"){let Qt=-1,en=.07*.07;r.current.forEach((vn,Wn)=>{const Gn=(vn.x-At)**2+(vn.y-bt)**2;Gn<en&&(en=Gn,Qt=Wn)}),tt(Qt),K.current=Qt,Qt>=0&&(J({...r.current[Qt]}),Le(o.current[Qt]??"normal"),jt(!0));return}const Jt=g.current.elapsed;if(nn==="totem_bond"||nn==="totem_rift"||nn==="totem_oracle"||nn==="totem_archive"||nn==="totem_panopticon"){const Qt={totem_bond:"BOND",totem_rift:"RIFT",totem_oracle:"ORACLE",totem_archive:"ARCHIVE",totem_panopticon:"PANOPTICON"},en={BOND:"#34d399",RIFT:"#ff6b6b",ORACLE:"#c084fc",ARCHIVE:"#94a3b8",PANOPTICON:"#fbbf24"},vn={BOND:"",RIFT:"",ORACLE:"",ARCHIVE:"",PANOPTICON:""},Wn=Qt[nn],Gn={id:Z2(),kind:Wn,x:At,y:bt,radius:.26,groupId:0,pulseStrength:.85,bornAt:Jt};Bt.totems=[...Bt.totems,Gn],f.current=[{time:Jt,icon:vn[Wn],message:`${Wn} Totem placed`,color:en[Wn]},...f.current].slice(0,30),Q([...f.current])}else if(nn==="tabu_enter"||nn==="tabu_mix"){const Qt={id:Z2(),kind:nn==="tabu_enter"?"NO_ENTER":"NO_MIX",x:At,y:bt,radius:.2,severity:.6,bornAt:Jt,violationCount:0};Bt.tabus=[...Bt.tabus,Qt],f.current=[{time:Jt,icon:"X",message:`Taboo ${Qt.kind} declared`,color:"#ef4444"},...f.current].slice(0,30),Q([...f.current])}else if(nn==="ritual_gather"||nn==="ritual_procession"||nn==="ritual_offering"||nn==="ritual_revolt"){const Qt={ritual_gather:"GATHER",ritual_procession:"PROCESSION",ritual_offering:"OFFERING",ritual_revolt:"REVOLT"},en={GATHER:"#a78bfa",PROCESSION:"#fbd38d",OFFERING:"#fbbf24",REVOLT:"#ef4444"},vn={GATHER:"",PROCESSION:"|",OFFERING:"",REVOLT:""},Wn=Qt[nn],Gn={id:Z2(),kind:Wn,x:At,y:bt,radius:.3,periodSec:7,lastFired:Jt,active:!1,bornAt:Jt};Bt.rituals=[...Bt.rituals,Gn],f.current=[{time:Jt,icon:vn[Wn],message:`${Wn} Ritual founded`,color:en[Wn]},...f.current].slice(0,30),Q([...f.current])}ge(Qt=>Qt+1)},[]),Ie=me=>{Object.assign(s.current,me)},{phase:at}=le,St=aB[at]??"#fff",ye=Math.max(300,ae.w-256),xe=Math.max(200,ae.h-44),gt=l.current,Ge=gt.totems.length+gt.tabus.length+gt.rituals.length,Ye=Um.find(me=>me.id===P),Ve=w.useRef(null),[Oe,Gt]=w.useState("idle"),[Kt,fn]=w.useState(0);w.useEffect(()=>(Ve.current=new Nh(Gt),()=>{var me;return(me=Ve.current)==null?void 0:me.dispose()}),[]),w.useEffect(()=>{if(Oe!=="recording"){fn(0);return}const me=setInterval(()=>{var cn;return fn(((cn=Ve.current)==null?void 0:cn.elapsed)??0)},500);return()=>clearInterval(me)},[Oe]);const zn=w.useCallback(()=>{var me;(me=Ve.current)==null||me.start(()=>[t.current],()=>({labName:"Sociogenesis Tool",lines:[`fase: ${c.current.phase}    agentes: ${r.current.length}`,`coeso: ${(d.current.cohesion*100).toFixed(0)}%  polariz.: ${(d.current.polarization*100).toFixed(0)}%  conflito: ${(d.current.conflict*100).toFixed(0)}%`,`lens: ${R.current}    cenrio: ${P}`,`totens: ${l.current.totems.length}  tabus: ${l.current.tabus.length}  rituais: ${l.current.rituals.length}`]}))},[P]),rt=w.useCallback(()=>{var me;return(me=Ve.current)==null?void 0:me.stop()},[]);return a.jsxs("div",{className:"fixed inset-0 z-20 flex flex-col overflow-hidden select-none",style:{background:"#000",fontFamily:Wr},children:[ce.exceptionActive&&a.jsxs("div",{className:"h-7 flex items-center justify-center gap-3 shrink-0 animate-pulse",style:{background:"rgba(239,68,68,0.15)",borderBottom:"1px solid rgba(239,68,68,0.30)"},children:[a.jsx("span",{className:"text-xs text-red-400 font-semibold tracking-widest uppercase",children:"STATE OF EXCEPTION"}),a.jsx("span",{className:"text-[10px] text-red-400/50",children:"N field surging  policing active"})]}),a.jsxs("div",{className:"flex items-center gap-2 px-3 h-10 shrink-0",style:{borderBottom:"1px solid rgba(255,255,255,0.06)",background:"rgba(0,0,0,0.95)"},children:[e&&a.jsxs("button",{onClick:e,className:"flex items-center gap-1.5 px-2.5 py-1 border transition-all text-[10px]",style:{borderColor:"rgba(255,255,255,0.08)",color:"rgba(255,255,255,0.45)",fontFamily:Wr},onMouseEnter:me=>{me.currentTarget.style.color="rgba(255,255,255,0.80)",me.currentTarget.style.borderColor="rgba(255,255,255,0.20)"},onMouseLeave:me=>{me.currentTarget.style.color="rgba(255,255,255,0.45)",me.currentTarget.style.borderColor="rgba(255,255,255,0.08)"},children:[a.jsx(Pj,{size:10})," Exit"]}),a.jsx("span",{className:"text-[10px] hidden md:block",style:{color:"rgba(255,255,255,0.20)",fontFamily:nB,letterSpacing:"0.08em"},children:"SOCIOGENESIS"}),a.jsx("div",{className:"w-px h-4",style:{background:"rgba(255,255,255,0.06)"}}),a.jsx(J2,{label:v?"Paused":"Running",icon:v?a.jsx(s0,{size:11}):a.jsx(wl,{size:11}),children:a.jsxs("div",{className:"py-1",children:[a.jsx(Km,{icon:v?"":"",label:v?"Run":"Pause",onClick:()=>{const me=!v;b(me),S.current=me}}),a.jsx(Km,{icon:"",label:"Reset Scenario",onClick:()=>On(P,it)}),a.jsxs("div",{className:"px-3 py-2 mt-1",style:{borderTop:"1px solid rgba(255,255,255,0.05)",fontFamily:Wr},children:[a.jsx("div",{className:"text-[9px] mb-1.5",style:{color:"rgba(255,255,255,0.30)"},children:"macroTick interval"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"range",min:.5,max:2.5,step:.1,defaultValue:1,onChange:me=>Ie({macroTickSec:parseFloat(me.target.value)}),className:"flex-1 h-px appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-2.5 [&::-webkit-slider-thumb]:h-2.5 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-white/60",style:{background:"rgba(255,255,255,0.10)"}}),a.jsx("span",{className:"text-[9px]",style:{color:"rgba(255,255,255,0.40)"},children:"1.0s"})]})]})]})}),a.jsx(J2,{label:Ye?`${Ye.icon} ${Ye.name}`:"Scenario",children:a.jsx("div",{className:"py-1 max-h-80 overflow-y-auto",children:["genesis","conflict","economy","culture","power"].map(me=>{const cn=Um.filter(Xt=>Xt.category===me);return a.jsxs("div",{children:[a.jsx(iB,{label:tB[me]}),cn.map(Xt=>a.jsx(Km,{icon:Xt.icon,label:Xt.name,sub:Xt.description,active:P===Xt.id,onClick:()=>On(Xt.id,it)},Xt.id))]},me)})})}),a.jsx(J2,{label:((mt=G6.find(me=>me.id===C))==null?void 0:mt.label)??"Lens",children:a.jsx("div",{className:"py-1",children:G6.map(me=>a.jsx(Km,{label:me.label,sub:me.desc,active:C===me.id,onClick:()=>{k(me.id),R.current=me.id}},me.id))})}),a.jsx("div",{className:"flex-1"}),a.jsxs("div",{className:"flex items-center gap-2 px-2.5 py-0.5 border",style:{borderColor:St+"35",background:St+"0e",fontFamily:Wr},children:[a.jsx("span",{className:"text-[10px]",children:sB[at]}),a.jsx("span",{className:"text-[9px] uppercase tracking-[0.12em]",style:{color:St},children:at})]}),a.jsx(Pp,{state:Oe,elapsed:Kt,onStart:zn,onStop:rt})]}),a.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[a.jsxs("div",{className:"flex-1 relative",children:[a.jsx("canvas",{ref:t,width:ye,height:xe,style:{display:"block",width:"100%",height:"100%",cursor:j!=="select"?"crosshair":"default"},onClick:_t}),a.jsxs("div",{className:"absolute bottom-5 left-5 pointer-events-none",children:[a.jsx("div",{className:"text-3xl font-light tracking-widest uppercase mb-2",style:{color:St,textShadow:`0 0 24px ${St}55`,letterSpacing:"0.3em"},children:at}),a.jsxs("div",{className:"space-y-2 w-52",children:[a.jsx(Q2,{label:"Cohesion",v:le.cohesion,c:"#34d399"}),a.jsx(Q2,{label:"Polarization",v:le.polarization,c:"#fbd38d"}),a.jsx(Q2,{label:"Conflict",v:le.conflict,c:"#ef4444"})]})]}),a.jsx("div",{className:"absolute bottom-5 right-5 flex flex-col items-end gap-1 pointer-events-none",children:Array.from({length:s.current.groupCount}).map((me,cn)=>a.jsxs("div",{className:"flex items-center gap-2",style:{fontFamily:Wr},children:[a.jsxs("span",{className:"text-[9px]",style:{color:"rgba(255,255,255,0.30)"},children:["G",cn]}),a.jsx("div",{className:"w-2 h-2 rounded-full",style:{background:t0[cn]}})]},cn))}),j!=="select"&&a.jsx("div",{className:"absolute top-3 left-1/2 -translate-x-1/2 pointer-events-none",children:a.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 border text-[10px]",style:{borderColor:"rgba(56,189,248,0.25)",background:"rgba(56,189,248,0.08)",color:"rgba(186,230,253,0.85)",fontFamily:Wr},children:[a.jsx("span",{children:(yt=Ym.find(me=>me.id===j))==null?void 0:yt.icon}),a.jsx("span",{children:(Et=Ym.find(me=>me.id===j))==null?void 0:Et.label}),a.jsx("span",{style:{color:"rgba(56,189,248,0.45)"},children:" click to place  Esc to cancel"})]})}),(C==="field"||C==="power"||C==="economy")&&a.jsxs("div",{className:"absolute top-3 left-3 pointer-events-none space-y-1",children:[C!=="economy"&&a.jsx(ny,{c:"#34d399",label:"N Norma"}),C!=="economy"&&a.jsx(ny,{c:"#a78bfa",label:"L Legitimidade"}),C!=="power"&&a.jsx(ny,{c:"#fbbf24",label:"R Recurso"})]}),(zt<.99||zt>1.01||En)&&a.jsxs("div",{className:"absolute bottom-5 right-5 flex flex-col items-end gap-1 pointer-events-auto select-none",style:{bottom:"5rem"},children:[a.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-md bg-black/60 border border-white/10",children:[a.jsx("span",{className:"text-[8px] font-mono text-white/30 uppercase tracking-widest",children:"zoom"}),a.jsxs("span",{className:"text-[9px] font-mono text-emerald-300/70",children:[zt.toFixed(2),""]})]}),a.jsx("button",{onClick:()=>{sn.current={zoom:1,panX:0,panY:0},jn(1),lt(!1)},className:"px-2 py-0.5 rounded text-[8px] font-mono bg-black/50 border border-white/10 text-white/35 hover:text-white/70 transition-colors",children:"[R] reset"})]})]}),a.jsxs("div",{className:"w-64 shrink-0 flex flex-col overflow-y-auto",style:{borderLeft:"1px solid rgba(255,255,255,0.06)",background:"rgba(0,0,0,0.92)"},children:[a.jsxs(bu,{title:"Tools",open:et,onToggle:()=>dt(me=>!me),children:[a.jsx("div",{className:"grid grid-cols-2 gap-1",children:Ym.map(me=>a.jsxs("button",{onClick:()=>{T(me.id),_.current=me.id},title:me.desc,className:"flex items-center gap-1.5 px-2 py-1.5 border text-[10px] transition-all",style:j===me.id?{borderColor:me.color+"55",background:me.color+"12",color:me.color,fontFamily:Wr}:{borderColor:"rgba(255,255,255,0.07)",background:"transparent",color:"rgba(255,255,255,0.40)",fontFamily:Wr},children:[a.jsx("span",{className:"text-[11px]",children:me.icon}),a.jsx("span",{className:"truncate",children:me.label})]},me.id))}),a.jsx("div",{className:"text-[9px] leading-relaxed mt-1 px-0.5",style:{color:"rgba(255,255,255,0.25)",fontFamily:Wr},children:((Ft=Ym.find(me=>me.id===j))==null?void 0:Ft.desc)??""}),a.jsxs("div",{className:"flex items-center justify-between pt-2 mt-1",style:{borderTop:"1px solid rgba(255,255,255,0.05)"},children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-[10px]",style:{color:"rgba(255,255,255,0.60)",fontFamily:Wr},children:"Auto-Emergence"}),a.jsx("div",{className:"text-[9px]",style:{color:"rgba(255,255,255,0.22)",fontFamily:Wr},children:"Engine places symbols autonomously"})]}),a.jsx("button",{onClick:()=>kt(me=>!me),className:"w-8 h-4 rounded-full transition-all relative shrink-0",style:{background:it?"#a78bfa":"#3f3f46"},children:a.jsx("div",{className:"absolute top-0.5 w-3 h-3 rounded-full bg-white transition-all",style:{left:it?"17px":"2px"}})})]})]}),a.jsxs(bu,{title:"Agents",badge:r.current.length,open:Rt,onToggle:()=>Wt(me=>!me),children:[a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-2",style:{fontFamily:Wr},children:[a.jsx("span",{className:"text-[9px] w-12 shrink-0",style:{color:"rgba(255,255,255,0.35)"},children:"Seed"}),a.jsx("input",{type:"number",value:$,onChange:me=>q(Math.max(0,Math.min(2147483647,parseInt(me.target.value||"0",10)||0))),className:"flex-1 px-2 py-1 text-[10px] rounded border border-white/[0.08] bg-white/[0.03] text-white/70"}),a.jsx("button",{onClick:()=>q((Date.now()>>>0)%1e9),className:"px-2 py-1 rounded text-[9px] border border-white/[0.08] text-white/50 hover:text-white/80 hover:border-white/20 transition-all",style:{fontFamily:Wr,background:"rgba(255,255,255,0.02)"},children:"Rand"}),a.jsx("button",{onClick:()=>{var me;try{(me=navigator.clipboard)==null||me.writeText(String(L.current))}catch{}},className:"px-2 py-1 rounded text-[9px] border border-white/[0.08] text-white/50 hover:text-white/80 hover:border-white/20 transition-all",style:{fontFamily:Wr,background:"rgba(255,255,255,0.02)"},children:"Copy"})]}),a.jsxs("div",{className:"flex items-center gap-2",style:{fontFamily:Wr},children:[a.jsx("span",{className:"text-[9px] w-12 shrink-0",style:{color:"rgba(255,255,255,0.35)"},children:"Start"}),a.jsxs("select",{value:H,onChange:me=>G(me.target.value),className:"flex-1 px-2 py-1 text-[10px] rounded border border-white/[0.08] bg-white/[0.03] text-white/70",children:[a.jsx("option",{value:"unified_center",children:"Unified"}),a.jsx("option",{value:"separated_clusters",children:"Clusters"}),a.jsx("option",{value:"corners",children:"Corners"}),a.jsx("option",{value:"ring",children:"Ring"}),a.jsx("option",{value:"line",children:"Line"}),a.jsx("option",{value:"random",children:"Random"})]}),a.jsx("button",{onClick:()=>On(P,it),className:"px-2 py-1 rounded text-[9px] border border-white/[0.08] text-white/50 hover:text-white/80 hover:border-white/20 transition-all",style:{fontFamily:Wr,background:"rgba(255,255,255,0.02)"},children:"Respawn"})]})]}),a.jsx(ta,{label:"Count",v:s.current.agentCount,min:50,max:200,step:10,onChange:me=>{s.current.agentCount=me}}),a.jsx(ta,{label:"Groups",v:s.current.groupCount,min:2,max:5,step:1,onChange:me=>{s.current.groupCount=me}}),a.jsx(ta,{label:"Speed",v:s.current.speed,min:.1,max:1,step:.05,onChange:me=>Ie({speed:me})}),a.jsx(ta,{label:"Autonomy",v:s.current.autonomy,min:0,max:1,step:.05,onChange:me=>Ie({autonomy:me})}),a.jsx(ta,{label:"Cohesion",v:s.current.cohesion,min:0,max:1,step:.05,onChange:me=>Ie({cohesion:me})}),a.jsx(ta,{label:"Aggress.",v:s.current.aggressionBase,min:0,max:1,step:.05,onChange:me=>Ie({aggressionBase:me})})]}),a.jsxs(bu,{title:"Dynamics",open:Zt,onToggle:()=>$e(me=>!me),children:[a.jsx(ta,{label:"Conform.",v:s.current.conformity,min:0,max:1,step:.05,onChange:me=>Ie({conformity:me})}),a.jsx(ta,{label:"Empathy",v:s.current.empathy,min:0,max:1,step:.05,onChange:me=>Ie({empathy:me})}),a.jsx(ta,{label:"Mobility",v:s.current.mobility,min:0,max:1,step:.05,onChange:me=>Ie({mobility:me})}),a.jsx(ta,{label:"Contagion",v:s.current.contagion,min:0,max:1,step:.05,onChange:me=>Ie({contagion:me})}),a.jsx(ta,{label:"Hierarchy",v:s.current.hierarchyStrength,min:0,max:1,step:.05,onChange:me=>Ie({hierarchyStrength:me})}),a.jsx(ta,{label:"Innovate",v:s.current.innovationRate,min:0,max:.3,step:.01,onChange:me=>Ie({innovationRate:me})}),a.jsx(ta,{label:"Cooperat.",v:s.current.cooperationBias,min:0,max:1,step:.05,onChange:me=>Ie({cooperationBias:me})}),a.jsx(ta,{label:"Inertia",v:s.current.culturalInertia,min:0,max:1,step:.05,onChange:me=>Ie({culturalInertia:me})}),a.jsx(ta,{label:"ArchHold",v:s.current.archetypeHoldSec,min:.4,max:5,step:.1,onChange:me=>Ie({archetypeHoldSec:me})}),a.jsx(ta,{label:"Scarcity",v:s.current.resourceScarcity,min:0,max:1,step:.05,onChange:me=>Ie({resourceScarcity:me})}),a.jsx(ta,{label:"Panoptic.",v:s.current.panopticism,min:0,max:1,step:.05,onChange:me=>Ie({panopticism:me})}),a.jsx(ta,{label:"Boids.Al",v:s.current.boidsAlignment,min:0,max:1,step:.05,onChange:me=>Ie({boidsAlignment:me})}),a.jsx(ta,{label:"Boids.Co",v:s.current.boidsCohesion,min:0,max:1,step:.05,onChange:me=>Ie({boidsCohesion:me})})]}),Ae>=0&&We&&a.jsxs(bu,{title:`Agent #${Ae}`,badge:ke,open:Xe,onToggle:()=>jt(me=>!me),children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx("div",{className:"w-3.5 h-3.5 rounded-full shrink-0",style:{background:t0[We.groupId%t0.length]}}),a.jsxs("span",{className:"text-[10px]",style:{color:"rgba(255,255,255,0.65)",fontFamily:Wr},children:["Group ",We.groupId]}),a.jsx("span",{className:"text-[9px] ml-auto capitalize",style:{color:"rgba(255,255,255,0.30)",fontFamily:Wr},children:ke}),a.jsx("button",{onClick:()=>{tt(-1),J(null),K.current=-1},className:"ml-1 transition-colors",style:{color:"rgba(255,255,255,0.20)"},onMouseEnter:me=>{me.currentTarget.style.color="rgba(255,255,255,0.55)"},onMouseLeave:me=>{me.currentTarget.style.color="rgba(255,255,255,0.20)"},children:a.jsx(ya,{size:9})})]}),a.jsxs("div",{className:"space-y-1.5",children:[a.jsx(ys,{label:"Belief",v:We.belief,c:"#34d399"}),a.jsx(ys,{label:"Fear",v:We.fear,c:"#ef4444"}),a.jsx(ys,{label:"Desire",v:We.desire,c:"#fbd38d"}),a.jsx(ys,{label:"Status",v:We.status,c:"#a78bfa"}),a.jsx(ys,{label:"Wealth",v:We.wealth,c:"#fbbf24"}),a.jsx(ys,{label:"Fatigue",v:We.fatigue,c:"#94a3b8"}),a.jsx(ys,{label:"Conform.",v:We.conformity,c:"#60d0ff"}),a.jsx(ys,{label:"Empathy",v:We.empathy,c:"#ff6b9d"}),a.jsx(ys,{label:"Charisma",v:We.charisma,c:"#ffd060"}),a.jsx(ys,{label:"Loyalty",v:We.groupLoyalty,c:"#6bcb77"})]}),a.jsxs("div",{className:"mt-2 pt-2",style:{borderTop:"1px solid rgba(255,255,255,0.05)",fontFamily:Wr},children:[a.jsx("div",{className:"text-[9px] mb-1",style:{color:"rgba(255,255,255,0.30)"},children:"Ideology (order  freedom)"}),a.jsxs("div",{className:"relative h-1",style:{background:"rgba(255,255,255,0.08)"},children:[a.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 w-2 h-2 rounded-full bg-white/70 transition-all",style:{left:`calc(${((We.ideology+1)/2*100).toFixed(0)}% - 4px)`}}),a.jsx("div",{className:"absolute inset-y-0 left-0 w-1/2",style:{background:"rgba(37,99,235,0.25)"}}),a.jsx("div",{className:"absolute inset-y-0 right-0 w-1/2",style:{background:"rgba(220,38,38,0.25)"}})]}),a.jsxs("div",{className:"flex justify-between text-[8px] mt-0.5",style:{color:"rgba(255,255,255,0.22)"},children:[a.jsx("span",{children:"Order"}),a.jsx("span",{children:We.ideology.toFixed(2)}),a.jsx("span",{children:"Freedom"})]})]})]}),a.jsxs(bu,{title:"Symbols",badge:Ge,open:Ze,onToggle:()=>Fe(me=>!me),children:[Ge===0&&a.jsxs("div",{className:"text-[9px] text-center py-2",style:{color:"rgba(255,255,255,0.20)",fontFamily:Wr},children:["No symbols placed.",a.jsx("br",{}),"Select a tool and click the canvas."]}),gt.totems.map(me=>{const cn={BOND:"",RIFT:"",ORACLE:"",ARCHIVE:"",PANOPTICON:""},Xt={BOND:"#34d399",RIFT:"#ff6b6b",ORACLE:"#c084fc",ARCHIVE:"#94a3b8",PANOPTICON:"#fbbf24"};return a.jsx(ey,{icon:cn[me.kind]||"",label:`${me.kind} Totem`,sub:me.emergent||me.id.startsWith("auto-")?"auto-emerged":"manual",color:Xt[me.kind]||"#34d399",onRemove:()=>{gt.totems=gt.totems.filter(Dt=>Dt.id!==me.id),ge(Dt=>Dt+1)}},me.id)}),gt.tabus.map(me=>a.jsx(ey,{icon:me.kind==="NO_ENTER"?"X":"",label:`Tabu ${me.kind}`,sub:me.id.startsWith("auto-")?"auto-emerged":"manual",color:"#ef4444",onRemove:()=>{gt.tabus=gt.tabus.filter(cn=>cn.id!==me.id),ge(cn=>cn+1)}},me.id)),gt.rituals.map(me=>{const cn={GATHER:"",PROCESSION:"|",OFFERING:"",REVOLT:""},Xt={GATHER:"#a78bfa",PROCESSION:"#fbd38d",OFFERING:"#fbbf24",REVOLT:"#ef4444"};return a.jsx(ey,{icon:cn[me.kind]||"",label:`${me.kind} Ritual`,sub:me.emergent||me.id.startsWith("auto-")?"auto-emerged":"manual",color:Xt[me.kind]||"#a78bfa",onRemove:()=>{gt.rituals=gt.rituals.filter(Dt=>Dt.id!==me.id),ge(Dt=>Dt+1)}},me.id)}),Ge>0&&a.jsx("button",{onClick:()=>{l.current=$2(),kz(i.current),ge(me=>me+1)},className:"w-full text-[9px] py-1 mt-1 transition-all",style:{color:"rgba(239,68,68,0.50)",border:"1px solid rgba(239,68,68,0.15)",fontFamily:Wr},onMouseEnter:me=>{me.currentTarget.style.color="rgba(239,68,68,0.80)",me.currentTarget.style.borderColor="rgba(239,68,68,0.30)"},onMouseLeave:me=>{me.currentTarget.style.color="rgba(239,68,68,0.50)",me.currentTarget.style.borderColor="rgba(239,68,68,0.15)"},children:"Clear all symbols"})]}),a.jsxs(bu,{title:"Readout",open:hn,onToggle:()=>an(me=>!me),children:[a.jsxs("div",{className:"space-y-1.5 mb-3",children:[a.jsx(ys,{label:"Cohesion",v:le.cohesion,c:"#34d399"}),a.jsx(ys,{label:"Polariz.",v:le.polarization,c:"#fbd38d"}),a.jsx(ys,{label:"Conflict",v:le.conflict,c:"#ef4444"}),a.jsx(ys,{label:"Consensus",v:le.consensus,c:"#a78bfa"})]}),a.jsxs("div",{className:"pt-2 mb-3",style:{borderTop:"1px solid rgba(255,255,255,0.05)",fontFamily:Wr},children:[a.jsx("div",{className:"text-[8px] uppercase tracking-[0.14em] mb-1.5",style:{color:"rgba(255,255,255,0.22)"},children:"Economy"}),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex justify-between text-[10px]",children:[a.jsx("span",{style:{color:"rgba(255,255,255,0.35)"},children:"Mean Wealth"}),a.jsxs("span",{style:{color:"#fbbf24"},children:[(ce.meanWealth*100).toFixed(0),"%"]})]}),a.jsxs("div",{className:"flex justify-between text-[10px]",children:[a.jsx("span",{style:{color:"rgba(255,255,255,0.35)"},children:"Gini Index"}),a.jsx("span",{style:{color:ce.gini>.55?"#f87171":ce.gini>.35?"#fbbf24":"#4ade80"},children:ce.gini.toFixed(2)})]}),a.jsxs("div",{className:"flex justify-between text-[10px]",children:[a.jsx("span",{style:{color:"rgba(255,255,255,0.35)"},children:"Violations/min"}),a.jsx("span",{style:{color:ce.violationsWindow>2?"#f87171":"rgba(255,255,255,0.45)"},children:ce.violationsWindow})]})]})]}),F.length>0&&a.jsxs("div",{className:"pt-2",style:{borderTop:"1px solid rgba(255,255,255,0.05)",fontFamily:Wr},children:[a.jsx("div",{className:"text-[8px] uppercase tracking-[0.14em] mb-1.5",style:{color:"rgba(255,255,255,0.22)"},children:"Chronicle"}),a.jsx("div",{className:"space-y-1",children:F.slice(0,12).map((me,cn)=>a.jsxs("div",{className:"flex gap-1.5 items-baseline",children:[a.jsx("span",{className:"text-[10px] shrink-0",children:me.icon}),a.jsx("span",{className:"text-[9px] leading-tight",style:{color:me.color},children:me.message})]},cn))})]})]}),a.jsxs("div",{className:"px-3 py-3 mt-auto",style:{borderTop:"1px solid rgba(255,255,255,0.05)"},children:[a.jsxs("div",{className:"grid grid-cols-2 gap-x-3 gap-y-0.5",children:[a.jsx(Xm,{sym:"",label:"Leader",c:"#fbbf24"}),a.jsx(Xm,{sym:"",label:"Aggressor",c:"#ef4444"}),a.jsx(Xm,{sym:"",label:"Guardian",c:"#fbd38d"}),a.jsx(Xm,{sym:"",label:"Mediator",c:"#94a3b8"})]}),a.jsxs("div",{className:"mt-2 pt-2 grid grid-cols-3 gap-1",style:{borderTop:"1px solid rgba(255,255,255,0.05)"},children:[a.jsx(ty,{c:"#34d399",label:"N",title:"Norma"}),a.jsx(ty,{c:"#a78bfa",label:"L",title:"Legit."}),a.jsx(ty,{c:"#fbbf24",label:"R",title:"Recurso"})]})]})]})]})]})};function Q2({label:e,v:t,c:r}){return a.jsxs("div",{className:"flex items-center gap-2",style:{fontFamily:"'IBM Plex Mono', monospace"},children:[a.jsx("span",{className:"text-[10px] w-20 shrink-0",style:{color:"rgba(255,255,255,0.40)"},children:e}),a.jsx("div",{className:"flex-1 h-px overflow-hidden",style:{background:"rgba(255,255,255,0.10)"},children:a.jsx("div",{className:"h-full transition-all duration-500",style:{width:`${(t*100).toFixed(0)}%`,background:r}})}),a.jsx("span",{className:"text-[10px] w-5 text-right",style:{color:r},children:(t*100).toFixed(0)})]})}function ta({label:e,v:t,min:r,max:o,step:s,onChange:l}){const[i,u]=w.useState(t);return w.useEffect(()=>{u(t)},[t]),a.jsxs("div",{className:"flex items-center gap-2",style:{fontFamily:"'IBM Plex Mono', monospace"},children:[a.jsx("span",{className:"text-[9px] w-14 shrink-0",style:{color:"rgba(255,255,255,0.35)"},children:e}),a.jsx("input",{type:"range",min:r,max:o,step:s,value:i,onChange:c=>{const d=parseFloat(c.target.value);u(d),l(d)},className:"flex-1 h-px appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-2.5 [&::-webkit-slider-thumb]:h-2.5 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-white/60",style:{background:"rgba(255,255,255,0.10)"}}),a.jsx("span",{className:"text-[9px] w-6 text-right shrink-0",style:{color:"rgba(255,255,255,0.45)"},children:s>=1?Math.round(i):i.toFixed(2)})]})}function ey({icon:e,label:t,sub:r,color:o,onRemove:s}){return a.jsxs("div",{className:"flex items-center gap-2 py-0.5",style:{fontFamily:"'IBM Plex Mono', monospace"},children:[a.jsx("span",{style:{color:o},className:"text-[11px] shrink-0",children:e}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"text-[10px]",style:{color:"rgba(255,255,255,0.60)"},children:t}),a.jsx("div",{className:"text-[8px]",style:{color:"rgba(255,255,255,0.22)"},children:r})]}),a.jsx("button",{onClick:s,className:"transition-colors",style:{color:"rgba(255,255,255,0.20)"},onMouseEnter:l=>{l.currentTarget.style.color="rgba(239,68,68,0.70)"},onMouseLeave:l=>{l.currentTarget.style.color="rgba(255,255,255,0.20)"},children:a.jsx(ya,{size:9})})]})}function Xm({sym:e,label:t,c:r}){return a.jsxs("div",{className:"flex items-center gap-1.5",style:{fontFamily:"'IBM Plex Mono', monospace"},children:[a.jsx("span",{className:"text-[10px] w-4 text-center shrink-0",style:{color:r},children:e}),a.jsx("span",{className:"text-[9px]",style:{color:"rgba(255,255,255,0.35)"},children:t})]})}function ty({c:e,label:t,title:r}){return a.jsxs("div",{className:"flex items-center gap-1",style:{fontFamily:"'IBM Plex Mono', monospace"},children:[a.jsx("div",{className:"w-1.5 h-1.5 shrink-0",style:{background:e,opacity:.75}}),a.jsxs("div",{children:[a.jsx("div",{className:"text-[9px]",style:{color:e},children:t}),a.jsx("div",{className:"text-[8px]",style:{color:"rgba(255,255,255,0.22)"},children:r})]})]})}function ny({c:e,label:t}){return a.jsxs("div",{className:"flex items-center gap-1.5",style:{fontFamily:"'IBM Plex Mono', monospace"},children:[a.jsx("div",{className:"w-2 h-2 shrink-0",style:{background:e,opacity:.65}}),a.jsx("span",{className:"text-[9px]",style:{color:e,opacity:.75},children:t})]})}const Ad=["SELF","PERSONA","SHADOW","ANIMA","TRICKSTER","HERO","MOTHER","FATHER","WISE_ONE","CHILD","LOVER","DESTROYER"],jd=0,Uk={SELF_REGION:[0,0],EGO:[.4,-.3],PERSONA_REGION:[-.4,-.3],SHADOW_REGION:[-.4,.35],COLLECTIVE:[.4,.35],ID:[0,.58],SUPEREGO:[0,-.66]},ii=64,Ed=64,ns=1300,xh=500;function ry(){return{quantaTarget:600,danceIntensity:.2,flowGain:.3,damping:2,maxSpeed:.18,breathPeriod:24,springK:.55,springRestLen:.045,linkRadius:.07,linkValDiff:.35,linkProbability:.004,linkMaxTtl:2.5,archetypesOn:!0,selfPull:.18,spawnRate:4,deathAge:70,lens:"TOPOLOGY",trailFade:.06,trailOpacity:.65,trailWidth:3,bondsOn:!0,frozenFlow:!1,stateRelaxRate:1,soulVis:0}}function xs(){return Math.random()}function ig(e,t,r){let o,s,l;r==="id"?(o=0,s=.55,l=.2):(o=.38,s=.32,l=.26);const i=Math.max(1e-6,xs()),u=xs(),c=Math.sqrt(-2*Math.log(i))*Math.cos(2*Math.PI*u),d=Math.sqrt(-2*Math.log(i))*Math.sin(2*Math.PI*u);let h=o+c*l,f=s+d*l;const g=Math.sqrt(h*h+f*f),m=.88;g>m&&(h=h*(m/g),f=f*(m/g)),e.x[t]=h,e.y[t]=f,e.vx[t]=(xs()-.5)*.06,e.vy[t]=(xs()-.5)*.06,e.charge[t]=r==="id"?.55+xs()*.35:.3+xs()*.4,e.valence[t]=(xs()-.5)*(r==="id"?.8:.6),e.coherence[t]=r==="collective"?.3+xs()*.3:.1+xs()*.2,e.arousal[t]=r==="id"?.5+xs()*.4:.2+xs()*.4,e.inhibition[t]=.1+xs()*.2,e.tag[t]=jd,e.tagAge[t]=0,e.age[t]=xs()*10,e.soulHue[t]===0&&(e.soulHue[t]=xs()*360)}function V6(e){const t=Math.min(e,ns),r={count:t,x:new Float32Array(ns),y:new Float32Array(ns),vx:new Float32Array(ns),vy:new Float32Array(ns),charge:new Float32Array(ns),valence:new Float32Array(ns),coherence:new Float32Array(ns),arousal:new Float32Array(ns),inhibition:new Float32Array(ns),tag:new Uint8Array(ns),tagAge:new Float32Array(ns),age:new Float32Array(ns),soulHue:new Float32Array(ns),flowU:new Float32Array(ii*Ed),flowV:new Float32Array(ii*Ed),linkA:new Int32Array(xh).fill(-1),linkB:new Int32Array(xh).fill(-1),linkTtl:new Float32Array(xh),linkCount:0,archetypeActive:Ad.map(()=>!0),archetypeStrength:Ad.map(()=>.5),breathT:0,breathPhase:0,tick:0,elapsed:0,integrationIndex:.5,tensionIndex:.3,fragmentationIndex:.4,phase:"CALM",events:[],journeyActive:!1,journeyAct:0,journeyActT:0,journeyDone:!1},o=Math.floor(t*.6);for(let s=0;s<o;s++)ig(r,s,"id");for(let s=o;s<t;s++)ig(r,s,"collective");return r}function oy(e,t){ig(e,t,Math.random()<.6?"id":"collective")}function U6(e,t,r){const o=Math.min(t,ns);if(o>e.count)for(let s=e.count;s<o;s++)ig(e,s,s<e.count+(o-e.count)*.6?"id":"collective");e.count=o,r.quantaTarget=o}const Ki=[{id:"SELF",sigil:"",color:"#f5c842",preferredRegion:"SELF_REGION",fieldMode:"sink",fieldRadius:.28,description:"Integrao  centro unificador da psique"},{id:"PERSONA",sigil:"",color:"#b0c4de",preferredRegion:"PERSONA_REGION",fieldMode:"shear",fieldRadius:.28,description:"Mscara social  interface com o mundo"},{id:"SHADOW",sigil:"",color:"#7c3aed",preferredRegion:"SHADOW_REGION",fieldMode:"vortex",fieldRadius:.32,description:"Contedo reprimido e negado"},{id:"ANIMA",sigil:"",color:"#f43f5e",preferredRegion:"COLLECTIVE",fieldMode:"oscillate",fieldRadius:.35,description:"Ponte entre Ego e Inconsciente"},{id:"TRICKSTER",sigil:"",color:"#84cc16",preferredRegion:"SHADOW_REGION",fieldMode:"spiral",fieldRadius:.3,description:"Ruptura criativa  recombinao"},{id:"HERO",sigil:"",color:"#3b82f6",preferredRegion:"EGO",fieldMode:"source",fieldRadius:.28,description:"Direo e conquista  ego dirigido"},{id:"MOTHER",sigil:"",color:"#f59e0b",preferredRegion:"COLLECTIVE",fieldMode:"sink",fieldRadius:.34,description:"Nutrio e acolhimento  campo matrizal"},{id:"FATHER",sigil:"",color:"#6b7280",preferredRegion:"SUPEREGO",fieldMode:"shear",fieldRadius:.3,description:"Lei e ordem  estrutura normativa"},{id:"WISE_ONE",sigil:"",color:"#6366f1",preferredRegion:"SELF_REGION",fieldMode:"sink",fieldRadius:.38,description:"Sntese e sentido  sabedoria profunda"},{id:"CHILD",sigil:"",color:"#06b6d4",preferredRegion:"EGO",fieldMode:"oscillate",fieldRadius:.26,description:"Potencial e renascimento  abertura"},{id:"LOVER",sigil:"",color:"#ec4899",preferredRegion:"COLLECTIVE",fieldMode:"spiral",fieldRadius:.32,description:"Vnculo e Eros  campo de ressonncia"},{id:"DESTROYER",sigil:"",color:"#ef4444",preferredRegion:"ID",fieldMode:"source",fieldRadius:.28,description:"Morte e transformao  ruptura necessria"}],Lg={SELF:[0,0],PERSONA:[-.42,-.3],SHADOW:[-.42,.35],ANIMA:[.1,.2],TRICKSTER:[-.22,.45],HERO:[.42,-.3],MOTHER:[.2,.48],FATHER:[0,-.64],WISE_ONE:[0,-.1],CHILD:[.3,-.52],LOVER:[.45,.2],DESTROYER:[0,.68]};function cB(e,t,r,o,s,l){const[i,u]=t,c=r-i,d=o-u,h=Math.sqrt(c*c+d*d);if(h<.001||h>e.fieldRadius)return[0,0];const f=(1-h/e.fieldRadius)**2;let g=0,m=0;switch(e.fieldMode){case"sink":g=-c/h*f,m=-d/h*f;break;case"source":g=c/h*f,m=d/h*f;break;case"vortex":g=-d/h*f,m=c/h*f;break;case"shear":g=d/h*f,m=-c/h*f*.3;break;case"oscillate":{const y=s*1.5;g=Math.cos(y)*(-c/h)*f+Math.sin(y)*(-d/h)*f*.5,m=Math.cos(y)*(-d/h)*f+Math.sin(y)*(c/h)*f*.5;break}case"spiral":g=(-c/h-d/h*.7)*f,m=(-d/h+c/h*.7)*f;break}return[g*l,m*l]}function dB(e,t,r,o,s,l,i,u,c,d,h){const f=t[0]-r[0],g=t[1]-r[1],m=Math.sqrt(f*f+g*g);if(m>c)return{charge:o,valence:s,coherence:l,arousal:i,inhibition:u};const y=(1-m/c)*d*h;switch(e){case"SELF":return{charge:o+(.5-o)*y*.4,valence:s+(0-s)*y*.3,coherence:l+(1-l)*y*.8,arousal:i+(.3-i)*y*.5,inhibition:u+(.2-u)*y*.6};case"SHADOW":return{charge:o+(o>.5?.02:0)*y,valence:s-.05*y,coherence:l-.06*y,arousal:i+.04*y,inhibition:u+.03*y};case"HERO":return{charge:Math.min(1,o+.04*y),valence:Math.min(1,s+.05*y),coherence:l+.03*y,arousal:Math.min(1,i+.04*y),inhibition:u};case"MOTHER":return{charge:o+(.5-o)*y*.3,valence:Math.min(1,s+.06*y),coherence:Math.min(1,l+.05*y),arousal:i+(.35-i)*y*.4,inhibition:Math.max(0,u-.04*y)};case"FATHER":return{charge:o,valence:s,coherence:l+.02*y,arousal:Math.max(0,i-.04*y),inhibition:Math.min(1,u+.06*y)};case"TRICKSTER":return{charge:o+(Math.random()-.5)*.15*y,valence:s+(Math.random()-.5)*.12*y,coherence:Math.max(0,l-.05*y),arousal:Math.min(1,i+.06*y),inhibition:Math.max(0,u-.05*y)};case"DESTROYER":return{charge:Math.min(1,o+.08*y),valence:s-.07*y,coherence:Math.max(0,l-.08*y),arousal:Math.min(1,i+.07*y),inhibition:Math.max(0,u-.03*y)};case"ANIMA":return{charge:o+Math.sin(o*Math.PI)*.03*y,valence:s+(Math.random()>.5?.04:-.02)*y,coherence:l+.04*y,arousal:i+.02*y,inhibition:Math.max(0,u-.03*y)};case"WISE_ONE":return{charge:o+(.5-o)*y*.2,valence:Math.min(1,s+.04*y),coherence:Math.min(1,l+.07*y),arousal:i+(.4-i)*y*.3,inhibition:u+(.3-u)*y*.3};case"CHILD":return{charge:Math.min(1,o+.03*y),valence:Math.min(1,s+.05*y),coherence:Math.max(0,l-.02*y),arousal:Math.min(1,i+.05*y),inhibition:Math.max(0,u-.05*y)};case"LOVER":return{charge:o+.03*y,valence:Math.min(1,s+.07*y),coherence:Math.min(1,l+.04*y),arousal:Math.min(1,i+.04*y),inhibition:u};case"PERSONA":return{charge:o,valence:s+(.1-s)*y*.3,coherence:l+.02*y,arousal:Math.max(0,i-.03*y),inhibition:Math.min(1,u+.04*y)};default:return{charge:o,valence:s,coherence:l,arousal:i,inhibition:u}}}function uB(e,t){const{flowU:r,flowV:o,breathPhase:s,elapsed:l}=e,i=t.frozenFlow?0:l,c=Math.sin(s),d=t.danceIntensity;for(let h=0;h<Ed;h++)for(let f=0;f<ii;f++){const g=(f+.5)/ii*2-1,m=(h+.5)/Ed*2-1,y=Math.sqrt(g*g+m*m),v=y>.001?y:.001;let b=0,S=0;b+=-m*.35*c*d,S+=g*.35*c*d,b+=Math.sin(m*3.14+i*.38)*.2*d,S+=Math.cos(g*2.71+i*.29)*.2*d,b+=Math.sin(g*5.1-m*3.7+i*.72)*.13*d,S+=Math.cos(m*4.9+g*2.3-i*.61)*.13*d,b+=Math.cos(g*1.4+m*2.8+i*.18)*.09*d,S+=Math.sin(g*2.2-m*1.6+i*.22)*.09*d;const C=t.selfPull;b-=g/v*Math.max(0,C-y*.9)*.5,S-=m/v*Math.max(0,C-y*.9)*.5;const k=m-.58,R=Math.sqrt(g*g+k*k);if(R<.2){const P=t.archetypesOn&&e.archetypeActive[11],I=(.2-R)*.6*d*(P?1:.5);b+=g/(R+.01)*I,S+=k/(R+.01)*I}const j=m+.66;if(Math.sqrt(g*g+j*j)<.18&&t.archetypesOn&&(S+=j*.5*d*.4),t.archetypesOn)for(let P=0;P<Ki.length;P++){if(!e.archetypeActive[P])continue;const I=Ki[P],$=Lg[I.id],[q,L]=cB(I,$,g,m,i,e.archetypeStrength[P]*d*.55);b+=q,S+=L}const _=h*ii+f;r[_]=r[_]*.72+b*.28,o[_]=o[_]*.72+S*.28}}function Yk(e,t,r){if(!isFinite(t)||!isFinite(r))return[0,0];const o=Math.max(-1,Math.min(1,t)),s=Math.max(-1,Math.min(1,r)),l=(o+1)*.5*(ii-1),i=(s+1)*.5*(Ed-1),u=Math.max(0,Math.min(ii-1,Math.floor(l))),c=Math.max(0,Math.min(Ed-1,Math.floor(i))),d=Math.min(u+1,ii-1),h=Math.min(c+1,Ed-1),f=l-u,g=i-c,m=c*ii+u,y=c*ii+d,v=h*ii+u,b=h*ii+d,S=e.flowU[m]*(1-f)*(1-g)+e.flowU[y]*f*(1-g)+e.flowU[v]*(1-f)*g+e.flowU[b]*f*g,C=e.flowV[m]*(1-f)*(1-g)+e.flowV[y]*f*(1-g)+e.flowV[v]*(1-f)*g+e.flowV[b]*f*g;return[S,C]}const Ws=20,lg=2/Ws,ay=Array.from({length:Ws*Ws},()=>[]);function hB(e,t){if(!isFinite(e)||!isFinite(t))return 0;const r=Math.max(0,Math.min(Ws-1,Math.floor((e+1)/lg)));return Math.max(0,Math.min(Ws-1,Math.floor((t+1)/lg)))*Ws+r}function vu(e,t,r,o,s){const l=(e-r)**2+(t-o)**2;return Math.exp(-l/(2*s*s))}function fB(e,t,r){const{count:o}=e;if(o===0)return;e.breathT+=r,e.breathPhase=e.breathT%t.breathPeriod/t.breathPeriod*Math.PI*2;const l=(Math.sin(e.breathPhase)+1)*.5;e.tick++,e.tick%3===0&&uB(e,t);let i=0;for(let y=0;y<e.linkCount;y++)e.linkTtl[y]-=r,!(e.linkTtl[y]<=0)&&(e.linkA[i]=e.linkA[y],e.linkB[i]=e.linkB[y],e.linkTtl[i]=e.linkTtl[y],i++);e.linkCount=i;const u=t.springK*r*60,c=t.springRestLen;for(let y=0;y<e.linkCount;y++){const v=e.linkA[y],b=e.linkB[y];if(v<0||b<0||v>=o||b>=o)continue;const S=e.x[b]-e.x[v],C=e.y[b]-e.y[v];if(!isFinite(S)||!isFinite(C))continue;const k=Math.sqrt(S*S+C*C);if(k<.001||!isFinite(k))continue;const R=(k-c)*u,j=S/k*R,T=C/k*R;!isFinite(j)||!isFinite(T)||(e.vx[v]+=j,e.vy[v]+=T,e.vx[b]-=j,e.vy[b]-=T)}for(let y=0;y<Ws*Ws;y++)ay[y].length=0;for(let y=0;y<o;y++){if(!isFinite(e.x[y])||!isFinite(e.y[y])){oy(e,y);continue}ay[hB(e.x[y],e.y[y])].push(y)}const d=1-t.damping*r,h=t.maxSpeed,f=t.flowGain*t.danceIntensity,g=t.archetypesOn,m=r*(t.stateRelaxRate??1);for(let y=0;y<o;y++){let v=e.x[y],b=e.y[y],S=e.vx[y],C=e.vy[y];if(!isFinite(v)||!isFinite(b)||!isFinite(S)||!isFinite(C)){oy(e,y);continue}const[k,R]=Yk(e,v,b);isFinite(k)&&(S+=k*f),isFinite(R)&&(C+=R*f);const j=(1-l)*.012*t.danceIntensity,T=Math.sqrt(v*v+b*b);T>.05&&(S+=v/T*j,C+=b/T*j);let _=e.charge[y],P=e.valence[y],I=e.coherence[y],$=e.arousal[y],q=e.inhibition[y];const L=vu(v,b,0,0,.12);I=Math.min(1,I+L*.45*m),q=q+(.2-q)*L*.35*m,_=_+(.5-_)*L*.2*m,$=$+(.3-$)*L*.25*m,P=P+(0-P)*L*.1*m;const H=vu(v,b,0,.58,.18);_=Math.min(1,_+H*.3*m),$=Math.min(1,$+H*.25*m),I=Math.max(0,I-H*.2*m),P=P-H*.08*m;const G=vu(v,b,-.42,.35,.22);I=Math.max(0,I-G*.18*m),q=Math.min(1,q+G*.15*m),_=Math.min(1,_+G*.1*m);const oe=vu(v,b,.4,.32,.24);I=Math.min(1,I+oe*.15*m);const le=vu(v,b,.4,-.3,.22);P=Math.min(1,P+le*.12*m),$=Math.min(1,$+le*.1*m);const pe=vu(v,b,0,-.66,.2);if(q=Math.min(1,q+pe*.2*m),$=Math.max(0,$-pe*.15*m),P=P+pe*.05*m,S*=1-q*.35*r,C*=1-q*.35*r,g)for(let F=0;F<Ki.length;F++){if(!e.archetypeActive[F])continue;const Q=Ki[F],ae=Lg[Q.id],we=e.archetypeStrength[F],Re=dB(Q.id,[v,b],ae,_,P,I,$,q,Q.fieldRadius,we,r);_=Math.max(0,Math.min(1,Re.charge)),P=Math.max(-1,Math.min(1,Re.valence)),I=Math.max(0,Math.min(1,Re.coherence)),$=Math.max(0,Math.min(1,Re.arousal)),q=Math.max(0,Math.min(1,Re.inhibition))}e.charge[y]=_,e.valence[y]=P,e.coherence[y]=I,e.arousal[y]=$,e.inhibition[y]=q,S*=d,C*=d;const ce=Math.sqrt(S*S+C*C);!isFinite(ce)||ce===0?(S=0,C=0):ce>h&&(S=S/ce*h,C=C/ce*h),v+=S*r*55,b+=C*r*55;const te=Math.sqrt(v*v+b*b);if(te>.9&&te>0){const F=.9/te;v=v*F,b=b*F;const Q=S*(v/.9)+C*(b/.9);Q>0&&(S-=v/.9*Q*.8,C-=b/.9*Q*.8)}e.x[y]=v,e.y[y]=b,e.vx[y]=S,e.vy[y]=C,g&&pB(e,y,r),e.age[y]+=r,e.age[y]>t.deathAge&&oy(e,y)}if(e.linkCount<xh-10){const y=Math.floor(o*.04),v=t.linkRadius,b=v*v;for(let S=0;S<y;S++){const C=Math.floor(Math.random()*o);if(e.coherence[C]<.35||!isFinite(e.x[C])||!isFinite(e.y[C]))continue;const k=Math.max(0,Math.min(Ws-1,Math.floor((e.x[C]+1)/lg))),R=Math.max(0,Math.min(Ws-1,Math.floor((e.y[C]+1)/lg)));for(let j=-1;j<=1;j++)for(let T=-1;T<=1;T++){const _=k+T,P=R+j;if(_<0||P<0||_>=Ws||P>=Ws)continue;const I=ay[P*Ws+_];if(I)for(const $ of I){if($===C)continue;const q=e.x[$]-e.x[C],L=e.y[$]-e.y[C];if(q*q+L*L>b||Math.abs(e.valence[C]-e.valence[$])>t.linkValDiff||Math.random()>t.linkProbability*40)continue;let H=!1;for(let G=0;G<e.linkCount;G++)if(e.linkA[G]===C&&e.linkB[G]===$||e.linkA[G]===$&&e.linkB[G]===C){H=!0;break}!H&&e.linkCount<xh&&(e.linkA[e.linkCount]=C,e.linkB[e.linkCount]=$,e.linkTtl[e.linkCount]=t.linkMaxTtl*(.5+Math.random()*.5),e.linkCount++)}}}}e.elapsed+=r}function pB(e,t,r){const o=e.x[t],s=e.y[t],l=e.coherence[t],i=e.valence[t],u=e.inhibition[t],c=e.arousal[t];let d=e.tag[t];if(e.tagAge[t]+=r,d!==jd&&e.tagAge[t]>8+Math.random()*6&&(d=jd,e.tagAge[t]=0),d!==jd)return;if(Math.sqrt(o*o+s*s)<.14&&l>.65&&c>.25){e.tag[t]=1,e.tagAge[t]=0;return}const f=o+.42,g=s-.35;if(Math.sqrt(f*f+g*g)<.22&&l<.4&&u>.45){e.tag[t]=3,e.tagAge[t]=0;return}const m=o-.4,y=s+.3;if(Math.sqrt(m*m+y*y)<.22&&i>.5&&c>.55){e.tag[t]=6,e.tagAge[t]=0;return}if(c>.75&&l<.3&&Math.random()<.003){e.tag[t]=5,e.tagAge[t]=0;return}const v=o,b=s-.58;if(Math.sqrt(v*v+b*b)<.18&&e.charge[t]>.75&&i<-.4){e.tag[t]=12,e.tagAge[t]=0;return}const S=o-.4,C=s-.32;if(Math.sqrt(S*S+C*C)<.22&&i>.45&&l>.55){e.tag[t]=11,e.tagAge[t]=0;return}}const mB=1.2;let Y6=0,sy=0,iy=.5;function gB(e){if(e.elapsed-Y6<mB)return;Y6=e.elapsed;const{count:t}=e;if(t===0)return;let r=0,o=0,s=0,l=0,i=0;for(let T=0;T<t;T++){r+=e.coherence[T],o+=e.arousal[T],s+=e.inhibition[T];const _=e.x[T]+.42,P=e.y[T]-.35;Math.sqrt(_*_+P*P)<.25&&l++,Math.sqrt(e.x[T]*e.x[T]+e.y[T]*e.y[T])<.15&&i++}const u=r/t,c=o/t,d=s/t,h=l/t,f=i/t;let g=0;for(let T=0;T<t;T++)g+=(e.coherence[T]-u)**2;g/=t;const m=c*.5+d*.25+h*.15;e.tensionIndex=Math.max(0,Math.min(1,(m-.22)/.52)),e.integrationIndex=Math.min(1,u*.7+f*.3),e.fragmentationIndex=Math.min(1,g*7);const y=e.tensionIndex,v=e.integrationIndex,b=e.fragmentationIndex;let S;v>.55&&y<.18?S="FLOW":v>.42&&y<.28?S="INTEGRATING":y>.65&&b>.12?S="PANIC":y>.4?S="ALERT":b>.18&&v<.3?S="FRAGMENTED":S="CALM",e.phase=S;const C=(T,_,P,I)=>{e.events.push({text:T,x:_,y:P,ttl:3.5,color:I}),e.events.length>24&&e.events.shift()};h>.2&&h-sy>.05&&C("SHADOW SURGE",-.42,.35,"#7c3aed"),d>.6&&iy>u+.04&&C("REPRESSION",0,-.66,"#6b7280"),sy<.08&&h>.15&&d>.55&&C("RETURN OF THE REPRESSED",-.42,.35,"#ef4444"),u>iy+.06&&b>.08&&C("INSIGHT ",0,0,"#f5c842"),v>.68&&f>.06&&S==="INTEGRATING"&&C("INTEGRATION",0,0,"#f5c842");const k=new Int32Array(13);for(let T=0;T<t;T++)k[e.tag[T]]++;let R=0,j=0;for(let T=1;T<=12;T++)k[T]>j&&(j=k[T],R=T);if(R>0&&j>t*.12&&Math.random()<.08){const T=Ad[R-1],_=Object.values(Lg)[R-1];C(`ARCHETYPE: ${T}`,_[0],_[1],"#f5c842")}sy=h,iy=u}const yB=[38,42,40,45],Kk=["Descent","Encounters","Confrontation","Integration"];function xB(e,t,r,o){if(!e.journeyActive||e.journeyDone)return;e.journeyActT+=t;const s=yB[e.journeyAct];if(bB(e,o,t),e.journeyActT>=s){if(e.journeyAct++,e.journeyActT=0,e.journeyAct>=4){e.journeyDone=!0,e.journeyActive=!1,o(" The Red Book Journey is complete.");return}Xk(e),r({name:Kk[e.journeyAct],act:e.journeyAct})}}let ib=-99;function bB(e,t,r){const o=e.journeyActT,s=e.journeyAct,l=s===0?[[3," Nigredo  the first descent into darkness begins."],[15,"The Ego loosens its grip. Shadows stir below."],[28,"Raw drives emerge from the Id core."]]:s===1?[[4,"Figures emerge from the Collective Unconscious."],[16,"The Anima speaks  a bridge is forming."],[30,"Trickster disrupts. The familiar dissolves."]]:s===2?[[5,"Hero confronts Shadow at the threshold."],[18,"The Father's law presses down  repression peaks."],[30,"Tension at its highest. Something must break."]]:[[5,"The Self draws all inward. Coherence returns."],[20,"Mandala stabilizes. Integration begins."],[36,"Albedo  the Wise One speaks from the center."]];for(const[i,u]of l)o>=i&&o<i+r+.5&&ib<e.journeyActT-1&&(t(`[Act ${s+1}: ${Kk[s]}] ${u}`),ib=o)}function Xk(e){const t=e.journeyAct;for(let r=0;r<12;r++)e.archetypeStrength[r]=.2;if(t===0)e.archetypeActive[2]=!0,e.archetypeStrength[2]=.9,e.archetypeActive[11]=!0,e.archetypeStrength[11]=.7,e.archetypeActive[5]=!0,e.archetypeStrength[5]=.15;else if(t===1){for(let r=0;r<12;r++)e.archetypeActive[r]=!0,e.archetypeStrength[r]=.45+Math.random()*.35;e.archetypeStrength[3]=.8,e.archetypeStrength[4]=.75}else t===2?(e.archetypeStrength[5]=.85,e.archetypeStrength[2]=.85,e.archetypeStrength[7]=.8,e.archetypeStrength[0]=.25):t===3&&(e.archetypeStrength[0]=.95,e.archetypeStrength[8]=.85,e.archetypeStrength[6]=.7,e.archetypeStrength[2]=.3,e.archetypeStrength[5]=.4)}function vB(e){e.journeyActive=!0,e.journeyAct=0,e.journeyActT=0,e.journeyDone=!1,ib=-99,Xk(e)}function K6(e){e.journeyActive=!1,e.journeyDone=!0}const SB=.43,wB="#000000";function CB(e){const t=e.replace("#","");return[parseInt(t.slice(0,2),16),parseInt(t.slice(2,4),16),parseInt(t.slice(4,6),16)]}function lh(e,t,r){const o=(1-Math.abs(2*r-1))*t,s=o*(1-Math.abs(e/60%2-1)),l=r-o/2;let i=0,u=0,c=0;return e<60?(i=o,u=s,c=0):e<120?(i=s,u=o,c=0):e<180?(i=0,u=o,c=s):e<240?(i=0,u=s,c=o):e<300?(i=s,u=0,c=o):(i=o,u=0,c=s),[Math.round((i+l)*255),Math.round((u+l)*255),Math.round((c+l)*255)]}function z0(e,t,r,o,s,l){if(l<=.005)return`rgba(${e},${t},${r},${o})`;const[i,u,c]=lh(s,.7,.6),d=Math.min(1,l),h=Math.round(e*(1-d)+i*d),f=Math.round(t*(1-d)+u*d),g=Math.round(r*(1-d)+c*d);return`rgba(${h},${f},${g},${o})`}const L5={zoom:1,panX:0,panY:0};function Xi(e,t,r){return[e.cx+t*e.R,e.cy+r*e.R]}function MB(e,t,r){const o=200-e*160,s=50+t*50,l=35+e*30;return`hsla(${o},${s}%,${l}%,${r})`}function kB(e,t){return e>=0?`hsla(120,${e*80}%,${30+e*25}%,${t})`:`hsla(0,${-e*80}%,${30+-e*25}%,${t})`}function RB(e,t){return`hsla(240,${30+e*40}%,${22+e*50}%,${t})`}function AB(e,t){const r=Math.sqrt(e*e+t*t);return t>.4||r>.75?"R":t<-.35||Math.abs(e)>.3&&t<-.1?"S":"I"}const Rv={EROS:[255,70,155],THANATOS:[80,30,200],REPRESSAO:[230,140,20],SUBLIMACAO:[40,215,165]};function Av(e,t){return e.inhibition[t]>.5?"REPRESSAO":e.coherence[t]>.6?"SUBLIMACAO":e.valence[t]>=0?"EROS":"THANATOS"}const pp={SELF_REGION:"#f5c842",EGO:"#3b82f6",PERSONA_REGION:"#b0c4de",SHADOW_REGION:"#7c3aed",COLLECTIVE:"#06b6d4",ID:"#ef4444",SUPEREGO:"#9ca3af"},X6=[{key:"SELF_REGION",rgb:[245,200,66],r:.18,baseA:.15},{key:"EGO",rgb:[59,130,246],r:.3,baseA:.09},{key:"PERSONA_REGION",rgb:[176,196,222],r:.3,baseA:.07},{key:"SHADOW_REGION",rgb:[124,58,237],r:.3,baseA:.09},{key:"COLLECTIVE",rgb:[6,182,212],r:.3,baseA:.09},{key:"ID",rgb:[239,68,68],r:.26,baseA:.1},{key:"SUPEREGO",rgb:[156,163,175],r:.27,baseA:.06}];function mp(e,t){if(Math.sqrt(e*e+t*t)<.14)return"SELF_REGION";const o=e-.4,s=t+.3,l=e+.4,i=t+.3,u=e+.42,c=t-.35,d=e-.4,h=t-.32,f=e,g=t-.58,m=e,y=t+.66,v=[["EGO",o*o+s*s],["PERSONA_REGION",l*l+i*i],["SHADOW_REGION",u*u+c*c],["COLLECTIVE",d*d+h*h],["ID",f*f+g*g],["SUPEREGO",m*m+y*y]];return v.sort((b,S)=>b[1]-S[1]),v[0][0]}function jB(e){const t={};for(let r=0;r<e.count;r++){const o=mp(e.x[r],e.y[r]);t[o]=(t[o]||0)+1}return t}function EB(e,t,r,o){const s=jB(r),l=r.count/X6.length;e.save();for(const i of X6){const[u,c]=Uk[i.key],[d,h]=Xi(t,u,c),f=t.R*i.r,g=(s[i.key]||0)/Math.max(1,l),m=i.baseA*Math.min(1.8,.5+.8*g),y=i.key==="SELF_REGION"?1+.15*Math.sin(o*.9):1+.05*Math.sin(o*.7+u*2),v=m*y,[b,S,C]=i.rgb,k=e.createRadialGradient(d,h,0,d,h,f);k.addColorStop(0,`rgba(${b},${S},${C},${v.toFixed(3)})`),k.addColorStop(.3,`rgba(${b},${S},${C},${(v*.55).toFixed(3)})`),k.addColorStop(.65,`rgba(${b},${S},${C},${(v*.18).toFixed(3)})`),k.addColorStop(1,`rgba(${b},${S},${C},0)`),e.beginPath(),e.arc(d,h,f,0,Math.PI*2),e.fillStyle=k,e.fill()}e.restore()}function TB(e,t,r){const{cx:o,cy:s,R:l}=t;e.save(),e.beginPath(),e.arc(o,s,l*.95,0,Math.PI*2),e.strokeStyle="rgba(180,160,240,0.13)",e.lineWidth=1.5,e.stroke();const i=1+.08*Math.sin(r*.9);e.beginPath(),e.arc(o,s,l*.13*i,0,Math.PI*2),e.strokeStyle="rgba(245,200,66,0.28)",e.lineWidth=1,e.stroke(),e.beginPath(),e.arc(o,s,l*.5,0,Math.PI*2),e.strokeStyle="rgba(150,130,200,0.08)",e.lineWidth=1,e.stroke(),e.strokeStyle="rgba(150,130,200,0.07)",e.lineWidth=.8;for(const[g,m,y,v]of[[-l*.95,0,l*.95,0],[0,-l*.95,0,l*.95]])e.beginPath(),e.moveTo(o+g,s+m),e.lineTo(o+y,s+v),e.stroke();const u=l*.95*.707;e.strokeStyle="rgba(150,130,200,0.045)";for(const[g,m,y,v]of[[-u,-u,u,u],[-u,u,u,-u]])e.beginPath(),e.moveTo(o+g,s+m),e.lineTo(o+y,s+v),e.stroke();const c=[["EGO","","EGO"],["PERSONA","","PERSONA_REGION"],["SOMBRA","","SHADOW_REGION"],["COLETIVO","","COLLECTIVE"],["ID","","ID"],["SUPEREGO","","SUPEREGO"]],d=Math.max(9,l*.034);e.textAlign="center",e.textBaseline="middle";for(const[g,m,y]of c){const[v,b]=Uk[y],[S,C]=Xi(t,v,b),k=pp[y]??"#b0a0f0";e.font=`${d+3}px sans-serif`,e.fillStyle=k+"55",e.fillText(m,S,C-d*.9),e.font=`${d}px monospace`,e.fillStyle=k+"44",e.fillText(g,S,C+d*.5)}const[h,f]=Xi(t,0,0);e.font=`${d+4}px sans-serif`,e.fillStyle="rgba(245,200,66,0.65)",e.fillText("",h,f-d*.85),e.font=`${d+1}px monospace`,e.fillStyle="rgba(245,200,66,0.55)",e.fillText("SELF",h,f+d*.55),e.restore()}function IB(e,t,r){const{cx:o,cy:s,R:l}=t,i=l*.52,u=l*.24,c=[[o,s-u*.8,"rgba(50,100,230,0.14)","S"],[o-u*.7,s+u*.4,"rgba(240,190,30,0.13)","I"],[o+u*.7,s+u*.4,"rgba(220,40,50,0.12)","R"]];e.save();const d=Math.max(9,l*.03),h={S:"SYMBOLIQUE",I:"IMAGINAIRE",R:"REL"},f={S:"#6080e0",I:"#d4a800",R:"#cc3030"};for(const[y,v,b,S]of c){const C=1+.04*Math.sin(r*.6+c.indexOf(c.find(R=>R[3]===S))*2.1);e.globalAlpha=.6,e.strokeStyle=f[S]+"44",e.lineWidth=1.2*C,e.beginPath(),e.arc(y,v,i*C,0,Math.PI*2),e.stroke();const k=e.createRadialGradient(y,v,0,y,v,i);k.addColorStop(0,b),k.addColorStop(1,b.replace(/[\d.]+\)$/,"0)")),e.globalAlpha=.4,e.fillStyle=k,e.beginPath(),e.arc(y,v,i,0,Math.PI*2),e.fill(),e.globalAlpha=.72,e.font=`${d}px monospace`,e.textAlign="center",e.textBaseline="middle",e.fillStyle=f[S],e.fillText(h[S],y,v+i*.3),e.font=`bold ${d+2}px monospace`,e.fillStyle=f[S]+"cc",e.fillText(S,y,v-i*.1)}const[g,m]=[o,s+u*.08];e.globalAlpha=.85,e.font=`${d+1}px serif`,e.textAlign="center",e.textBaseline="middle",e.fillStyle="rgba(255,230,120,0.90)",e.fillText("",g,m),e.globalAlpha=1,e.restore()}function PB(e,t,r,o){const{cx:s,cy:l,R:i}=t;e.save();const u=l-i*.26,c=l+i*.22,d=i*1.6;e.globalAlpha=.2;const h=e.createLinearGradient(s,u,s,c);h.addColorStop(0,"rgba(50,120,200,0.10)"),h.addColorStop(1,"rgba(50,120,200,0.00)"),e.fillStyle=h,e.fillRect(s-d/2,u,d,c-u),e.globalAlpha=.35,e.strokeStyle="rgba(80,140,220,0.60)",e.lineWidth=1,e.setLineDash([8,6]),e.beginPath(),e.moveTo(s-d/2,u),e.lineTo(s+d/2,u),e.stroke(),e.strokeStyle="rgba(220,80,50,0.50)",e.beginPath(),e.moveTo(s-d/2,c),e.lineTo(s+d/2,c),e.stroke(),e.setLineDash([]);const f=Math.max(8,i*.028);e.textAlign="left",e.textBaseline="middle";const g=s-i*.88,m=[[u-i*.25,"CONSCIENT","rgba(140,180,255,0.60)"],[u+(c-u)/2,"PRCONSCIENT","rgba(100,140,220,0.55)"],[c+i*.22,"INCONSCIENT","rgba(220,80,50,0.55)"]];e.font=`${f}px monospace`,e.globalAlpha=.8;for(const[I,$,q]of m)e.fillStyle=q,e.fillText($,g,I);const y=[[u-i*.46,"SUR-MOI","rgba(180,180,200,0.65)"],[l,"MOI","rgba(60,150,220,0.70)"],[c+i*.4,"A","rgba(240,80,60,0.75)"]];e.font=`bold ${f+1}px monospace`,e.textAlign="right";const v=s+i*.88;for(const[I,$,q]of y)e.fillStyle=q,e.fillText($,v,I+.04*i*Math.sin(o*.5));const b={EROS:0,THANATOS:0,REPRESSAO:0,SUBLIMACAO:0};for(let I=0;I<r.count;I++)b[Av(r,I)]++;const S=Math.max(1,r.count),C=[["EROS"," Eros","pulso de vida"],["THANATOS"," Thanatos","pulso de morte"],["REPRESSAO"," Represso","inibio do Ego"],["SUBLIMACAO"," Sublimao","energia transformada"]],k=s-i*.93,R=l+i*.55,j=Math.max(16,f*1.65),T=Math.max(4,f*.45),_=i*.72,P=j*4+10;e.globalAlpha=.6,e.fillStyle="rgba(7,5,14,0.82)",e.beginPath(),e.roundRect(k-4,R-6,_,P,5),e.fill(),e.strokeStyle="rgba(120,100,180,0.30)",e.lineWidth=.8,e.beginPath(),e.roundRect(k-4,R-6,_,P,5),e.stroke(),e.globalAlpha=1,e.font=`${f}px monospace`,C.forEach(([I,$,q],L)=>{const[H,G,oe]=Rv[I],le=Math.round(b[I]/S*100),pe=R+L*j+j*.5,ce=`rgb(${H},${G},${oe})`,te=e.createRadialGradient(k+T,pe,0,k+T,pe,T*2.5);te.addColorStop(0,`rgba(${H},${G},${oe},0.55)`),te.addColorStop(1,`rgba(${H},${G},${oe},0)`),e.fillStyle=te,e.beginPath(),e.arc(k+T,pe,T*2.5,0,Math.PI*2),e.fill(),e.fillStyle=ce,e.beginPath(),e.arc(k+T,pe,T,0,Math.PI*2),e.fill(),e.textAlign="left",e.textBaseline="middle",e.fillStyle=`rgba(${H},${G},${oe},0.92)`,e.font=`${f}px monospace`,e.fillText($,k+T*3.5,pe-f*.28),e.fillStyle=`rgba(${H},${G},${oe},0.50)`,e.font=`${Math.max(7,f-1)}px monospace`,e.fillText(q,k+T*3.5,pe+f*.55),e.textAlign="right",e.font=`${f}px monospace`,e.fillStyle=`rgba(${H},${G},${oe},0.80)`,e.fillText(`${le}%`,k+_-8,pe)}),e.globalAlpha=1,e.restore()}function FB(e,t,r){const s=.10705882352941176;e.save(),e.lineCap="round";for(let l=0;l<17;l++)for(let i=0;i<17;i++){const u=-.91+(i+.5)*s,c=-.91+(l+.5)*s;if(u*u+c*c>.8)continue;const[d,h]=Yk(r,u,c),f=Math.sqrt(d*d+h*h);if(f<.004)continue;const g=Math.min(1,f*3.5),[m,y]=Xi(t,u,c),v=t.R*.024*g,b=d/f,S=h/f,C=m-b*v*.45,k=y-S*v*.45,R=m+b*v*.55,j=y+S*v*.55,T=mp(u,c),_=pp[T]??"#b0a0f0",P=.1+g*.18;e.globalAlpha=P,e.strokeStyle=_,e.lineWidth=.7+g*.5,e.beginPath(),e.moveTo(C,k),e.lineTo(R,j),e.stroke();const I=-S*v*.12,$=b*v*.12,q=R-b*v*.2,L=j-S*v*.2;e.globalAlpha=P*1.3,e.fillStyle=_,e.beginPath(),e.moveTo(R,j),e.lineTo(q+I,L+$),e.lineTo(q-I,L-$),e.closePath(),e.fill()}e.globalAlpha=1,e.restore()}function NB(e,t,r){const o=new Int32Array(13);for(let u=0;u<r.count;u++)o[r.tag[u]]++;const s=[];for(let u=1;u<=12;u++)o[u]>0&&r.archetypeActive[u-1]&&s.push([u,o[u]]);s.sort((u,c)=>c[1]-u[1]);const l=s.slice(0,3);e.save(),e.textAlign="center",e.textBaseline="middle";const i=t.R;e.font=`${Math.max(14,i*.05)}px serif`;for(const[u,c]of l){const d=Ki[u-1],h=Lg[d.id],[f,g]=Xi(t,h[0],h[1]),m=Math.min(1,.3+c/r.count*8),y=e.createRadialGradient(f,g,0,f,g,i*.12);y.addColorStop(0,d.color+"55"),y.addColorStop(1,d.color+"00"),e.beginPath(),e.arc(f,g,i*.12,0,Math.PI*2),e.fillStyle=y,e.fill(),e.fillStyle=d.color+Math.round(m*255).toString(16).padStart(2,"0"),e.fillText(d.sigil,f,g),e.font=`${Math.max(7,i*.022)}px monospace`,e.fillStyle=d.color+"99",e.fillText(d.id,f,g+i*.07),e.font=`${Math.max(14,i*.05)}px serif`}e.restore()}function OB(e,t,r,o){e.save(),e.textAlign="center",e.textBaseline="middle";const s=t.R;e.font=`${Math.max(9,s*.03)}px monospace`;for(let l=r.events.length-1;l>=0;l--){const i=r.events[l];if(i.ttl-=o,i.ttl<=0){r.events.splice(l,1);continue}const u=Math.min(1,i.ttl/1.2),[c,d]=Xi(t,i.x,i.y-(3.5-i.ttl)*.08);e.font=`${Math.max(9,s*.03)}px monospace`;const h=e.measureText(i.text).width;e.globalAlpha=u*.5,e.fillStyle="rgba(7,5,14,0.7)",e.beginPath(),e.roundRect(c-h/2-4,d-8,h+8,16,4),e.fill(),e.globalAlpha=u,e.fillStyle=i.color+Math.round(u*230).toString(16).padStart(2,"0"),e.fillText(i.text,c,d)}e.globalAlpha=1,e.restore()}function _B(e,t,r,o,s=1,l=.8){if(r.linkCount!==0){e.save(),e.lineCap="round",e.lineJoin="round";for(let i=0;i<r.linkCount;i++){const u=r.linkA[i],c=r.linkB[i];if(u<0||c<0||u>=r.count||c>=r.count)continue;const d=Math.min(1,r.linkTtl[i]/2.5),h=(.12+d*.6)*l,f=(1.2+d*1.6)*s,[g,m]=Xi(t,r.x[u],r.y[u]),[y,v]=Xi(t,r.x[c],r.y[c]),b=Math.round(Math.min(1,h)*255).toString(16).padStart(2,"0"),S=pp[mp(r.x[u],r.y[u])]+b,C=pp[mp(r.x[c],r.y[c])]+b,k=e.createLinearGradient(g,m,y,v);k.addColorStop(0,S),k.addColorStop(1,C),e.lineWidth=f,e.strokeStyle=k,e.beginPath(),e.moveTo(g,m),e.lineTo(y,v),e.stroke()}e.restore()}}function jv(e,t,r,o=.85,s=0){const l=e.soulHue[t];switch(r){case"TOPOLOGY":{const i=pp[mp(e.x[t],e.y[t])];if(!s)return i+"cc";const u=parseInt(i.slice(1,3),16),c=parseInt(i.slice(3,5),16),d=parseInt(i.slice(5,7),16);return z0(u,c,d,.8,l,s)}case"ENERGY":{const i=200-e.charge[t]*160,u=50+e.arousal[t]*50,c=35+e.charge[t]*30;if(!s)return`hsla(${i},${u}%,${c}%,${o})`;const[d,h,f]=lh(i,u/100,c/100);return z0(d,h,f,o,l,s)}case"VALENCE":{const i=e.valence[t];if(!s)return kB(i,o);const[u,c,d]=i>=0?lh(120,i*.8,.3+i*.25):lh(0,-i*.8,.3+-i*.25);return z0(u,c,d,o,l,s)}case"COHERENCE":{if(!s)return RB(e.coherence[t],o);const[i,u,c]=lh(240,(30+e.coherence[t]*40)/100,(22+e.coherence[t]*50)/100);return z0(i,u,c,o,l,s)}case"LACAN":{const i=AB(e.x[t],e.y[t]),[u,c,d]=i==="R"?[220,40,50]:i==="S"?[50,100,230]:[240,190,30];return z0(u,c,d,o,l,s)}case"FREUD":{const i=Av(e,t),[u,c,d]=Rv[i],h=.75+e.charge[t]*.5;return z0(Math.min(255,Math.round(u*h)),Math.min(255,Math.round(c*h)),Math.min(255,Math.round(d*h)),o,l,s)}case"ARCHETYPES":{const i=e.tag[t];if(i===jd)return`rgba(120,110,160,${o*.3})`;const u=Ki[i-1].color;if(!s)return u+"dd";const c=parseInt(u.slice(1,3),16),d=parseInt(u.slice(3,5),16),h=parseInt(u.slice(5,7),16);return z0(c,d,h,o,l,s)}case"EVENTS":return MB(e.charge[t],e.arousal[t],o*.82);default:return`rgba(180,170,220,${o*.82})`}}function DB(e,t,r,o,s=0){const l=t.R,i=Math.max(2,l*.0055);for(let u=0;u<r.count;u++){const[c,d]=Xi(t,r.x[u],r.y[u]),h=jv(r,u,o,.85,s);let f=i;if(o==="ENERGY"&&(f=i*(.7+r.arousal[u]*.9)),o==="COHERENCE"&&(f=i*(.6+r.coherence[u]*.8)),(o==="ARCHETYPES"||o==="LACAN"||o==="FREUD")&&r.tag[u]!==jd&&(f=i*1.5),o==="FREUD"){const g=Av(r,u),[m,y,v]=Rv[g],b=2.2+r.charge[u]*1.8+r.arousal[u]*1,S=f*b,C=e.createRadialGradient(c,d,f*.4,c,d,S);C.addColorStop(0,`rgba(${m},${y},${v},0.28)`),C.addColorStop(1,`rgba(${m},${y},${v},0)`),e.fillStyle=C,e.beginPath(),e.arc(c,d,S,0,Math.PI*2),e.fill()}if(e.fillStyle=h,e.beginPath(),e.arc(c,d,f,0,Math.PI*2),e.fill(),o==="ARCHETYPES"&&r.tag[u]!==jd){const g=Ki[r.tag[u]-1],m=e.createRadialGradient(c,d,f*.5,c,d,f*3.5);m.addColorStop(0,g.color+"44"),m.addColorStop(1,g.color+"00"),e.beginPath(),e.arc(c,d,f*3.5,0,Math.PI*2),e.fillStyle=m,e.fill()}if(s>.15){const[g,m,y]=lh(r.soulHue[u],.8,.65),v=Math.min(.9,s*.85),b=f+Math.max(.5,f*.4);e.strokeStyle=`rgba(${g},${m},${y},${v})`,e.lineWidth=Math.max(.5,f*.35),e.beginPath(),e.arc(c,d,b,0,Math.PI*2),e.stroke()}}}let Ga=null;function Z6(){if(Ga){const e=Ga.getContext("2d");e&&e.clearRect(0,0,Ga.width,Ga.height)}}function LB(e,t,r){Ga||(Ga=document.createElement("canvas"));const o=Math.round(e*r),s=Math.round(t*r);return(Ga.width!==o||Ga.height!==s)&&(Ga.width=o,Ga.height=s),Ga.getContext("2d")}function zB(e,t,r,o,s,l,i,u,c=[0,0,0]){const d=e.canvas.width,h=e.canvas.height;e.setTransform(1,0,0,1,0,0),e.globalAlpha=Math.min(.99,Math.max(.01,s)),e.fillStyle=`rgb(${c[0]},${c[1]},${c[2]})`,e.fillRect(0,0,d,h),e.setTransform(i,0,0,i,0,0);const f=Math.max(1.5,t.R*.0052);e.lineCap="round";for(let g=0;g<r.count;g++){const[m,y]=Xi(t,r.x[g],r.y[g]),v=jv(r,g,o,1,u),b=r.vx[g],S=r.vy[g],C=Math.hypot(b,S);if(C>2e-4){const k=b/C,R=S/C,j=f*Math.min(12,1.5+C*l*22),T=m-k*j,_=y-R*j;e.globalAlpha=.55,e.strokeStyle=v,e.lineWidth=Math.max(.4,f*.5),e.beginPath(),e.moveTo(m,y),e.lineTo(T,_),e.stroke()}e.globalAlpha=C>2e-4?.85:.45,e.fillStyle=v,e.beginPath(),e.arc(m,y,f,0,Math.PI*2),e.fill()}e.globalAlpha=1}let As=null,J6=!0;function Q6(e,t,r){As||(As=document.createElement("canvas"));const o=Math.round(e*r),s=Math.round(t*r);return(As.width!==o||As.height!==s)&&(As.width=o,As.height=s),As.getContext("2d")}function BB(e,t,r,o){const s=t.R,l=Math.max(10,s*.03),i=Math.max(3,s*.008);for(let u=0;u<r.count;u++){const[c,d]=Xi(t,r.x[u],r.y[u]),h=jv(r,u,o,1);e.globalAlpha=.1,e.fillStyle=h,e.beginPath(),e.arc(c,d,l,0,Math.PI*2),e.fill(),e.globalAlpha=.3,e.fillStyle=h,e.beginPath(),e.arc(c,d,i,0,Math.PI*2),e.fill()}e.globalAlpha=1}let eS=0,ly=null;function $B(e,t,r,o,s,l={},i=L5){const{rastrosOn:u=!1,campoOn:c=!1,fieldOn:d=!1,bondsOn:h=!0,overlayOn:f=!0,trailFade:g=.06,trailOpacity:m=.65,trailWidth:y=3,soulVis:v=0,bondWidth:b=1,bondOpacity:S=.8,bgColor:C=wB}=l,[k,R,j]=CB(C),T=performance.now(),_=Math.min(.05,(T-eS)/1e3);if(eS=T,ly!==null&&ly!==r){if(Ga){const G=Ga.getContext("2d");G&&G.clearRect(0,0,Ga.width,Ga.height)}if(As){const G=As.getContext("2d");G&&G.clearRect(0,0,As.width,As.height)}}ly=r;const P=Math.min(window.devicePixelRatio||1,1.5),I=e.clientWidth,$=e.clientHeight;(e.width!==Math.round(I*P)||e.height!==Math.round($*P))&&(e.width=Math.round(I*P),e.height=Math.round($*P));const q=e.getContext("2d");q.setTransform(P,0,0,P,0,0);const L=Math.min(I,$)*SB,H={cx:I/2+i.panX,cy:$/2+i.panY,R:L*i.zoom};if(q.clearRect(0,0,I,$),q.fillStyle=C,q.fillRect(0,0,I,$),c){const G=Q6(I,$,P);G.setTransform(P,0,0,P,0,0),G.fillStyle=`rgba(${k},${R},${j},0.055)`,G.fillRect(0,0,I,$),BB(G,H,t,r),q.save(),q.globalAlpha=.85,q.drawImage(As,0,0,I,$),q.restore()}else J6&&!c&&Q6(I,$,P).clearRect(0,0,As.width,As.height);if(J6=c,u){const G=LB(I,$,P);G&&(zB(G,H,t,r,g,y,P,v,[k,R,j]),q.save(),q.globalAlpha=m,q.drawImage(Ga,0,0,I,$),q.restore())}d&&FB(q,H,t),f&&EB(q,H,t,t.elapsed),f&&TB(q,H,t.elapsed),f&&r==="LACAN"&&IB(q,H,t.elapsed),f&&r==="FREUD"&&PB(q,H,t,t.elapsed),h&&_B(q,H,t,!1,b,S),DB(q,H,t,r,v),r==="ARCHETYPES"&&NB(q,H,t),(r==="EVENTS"||r==="TOPOLOGY")&&OB(q,H,t,_),o&&(q.save(),q.textAlign="center",q.textBaseline="bottom",q.font=`${Math.max(10,H.R*.03)}px monospace`,q.fillStyle="rgba(200,180,255,0.28)",q.fillText(s,I/2,$-12),q.font=`${Math.max(8,H.R*.022)}px monospace`,q.fillStyle="rgba(180,160,230,0.20)",q.fillText(t.phase,I/2,$-28),q.restore())}const cg=[{id:"mandala-calm",name:"Mandala Calm",description:"Estado basal  fluxo harmnico, respirao suave, arqutipos em baixa.",observe:"Fluxo circular lento, integrao gradual ao centro, vnculos elsticos aparecem e somem com calma.",tags:["equilbrio","meditao","base"],config:{danceIntensity:.11,maxSpeed:.1,breathPeriod:32,selfPull:.28,damping:4.5,linkMaxTtl:3.5},archetypeStrengths:{SELF:.6,WISE_ONE:.5},archetypeActive:["SELF","WISE_ONE","MOTHER","ANIMA"],quantaCount:600},{id:"ego-inflation",name:"Ego Inflation",description:"Hero e Persona dominam. Superego alto. O Self  ignorado.",observe:"Ordem superficial na regio Ego/Persona, Sombra acumulando silenciosamente  o retorno  inevitvel.",tags:["inflao","persona","heri","tenso"],config:{danceIntensity:.19,maxSpeed:.16,breathPeriod:14,selfPull:.06,damping:3},archetypeStrengths:{HERO:.95,PERSONA:.9,FATHER:.8,SELF:.1,SHADOW:.3},archetypeActive:["HERO","PERSONA","FATHER","SELF","SHADOW"],quantaCount:700},{id:"return-of-shadow",name:"Return of the Shadow",description:"Represso ativa: Superego alto, Sombra acumulando.",observe:"Quanta se aglomeram lentamente no quadrante inferior esquerdo (Sombra). Observe o retorno gradual do reprimido.",tags:["represso","sombra","retorno","complexo"],config:{danceIntensity:.22,maxSpeed:.18,breathPeriod:12,selfPull:.12,damping:3.5,linkValDiff:.2},archetypeStrengths:{SHADOW:.95,FATHER:.85,DESTROYER:.6,SELF:.2,HERO:.25},archetypeActive:["SHADOW","FATHER","DESTROYER","SELF","HERO","PERSONA"],quantaCount:750},{id:"anima-bridge",name:"Anima Bridge",description:"Anima/Animus ativo: portais SelfColetivo abertos. Circulao integrada.",observe:"Circulao suave entre Coletivo e Self central. Vnculos elsticos densos e duradouros.",tags:["anima","animus","ponte","circulao"],config:{danceIntensity:.14,maxSpeed:.12,breathPeriod:22,selfPull:.32,damping:4.5,linkRadius:.09,linkProbability:.006,linkMaxTtl:4},archetypeStrengths:{ANIMA:.95,SELF:.8,LOVER:.75,CHILD:.6,WISE_ONE:.65},archetypeActive:["ANIMA","SELF","LOVER","CHILD","WISE_ONE","MOTHER"],quantaCount:600},{id:"trickster-breakthrough",name:"Trickster Breakthrough",description:"Trickster + Destroyer em alta. Limiares baixos. Recombinao criativa.",observe:"Padres se desfazem e recombinamos. Insights visveis. Novos clusters emergem do aparente caos.",tags:["trickster","caos criativo","insight","ruptura"],config:{danceIntensity:.32,maxSpeed:.26,breathPeriod:9,selfPull:.14,damping:2,linkMaxTtl:1.2,linkRadius:.055},archetypeStrengths:{TRICKSTER:.95,DESTROYER:.75,CHILD:.8,SHADOW:.65,ANIMA:.6},archetypeActive:["TRICKSTER","DESTROYER","CHILD","SHADOW","ANIMA"],quantaCount:800},{id:"red-book-journey",name:"Red Book Journey",description:"Jornada guiada do Livro Vermelho em 4 atos (~2.5 min).",observe:"Ato I: Descida. Ato II: Encontros. Ato III: Confronto. Ato IV: Integrao.",tags:["guiado","Jung","Livro Vermelho","4 atos"],config:{danceIntensity:.17,maxSpeed:.13,breathPeriod:20,selfPull:.22,damping:3.5,linkMaxTtl:3},archetypeStrengths:{},archetypeActive:["SELF","SHADOW","ANIMA","TRICKSTER","HERO","MOTHER","FATHER","WISE_ONE","CHILD","LOVER","DESTROYER","PERSONA"],quantaCount:700,journeyMode:!0},{id:"nigredo",name:"Nigredo",description:"A fase negra: dissoluo, decomposio, putrefao. Tudo precisa morrer para renascer.",observe:"Clusters se desfazem gradualmente, Sombra domina, alta fragmentao. A matria prima emerge do colapso.",tags:["alquimia","nigredo","dissoluo","shadow"],config:{danceIntensity:.27,maxSpeed:.22,breathPeriod:7,selfPull:.08,damping:2.5,linkMaxTtl:.8,linkRadius:.05},archetypeStrengths:{SHADOW:1,DESTROYER:.9,TRICKSTER:.7,SELF:.05},archetypeActive:["SHADOW","DESTROYER","TRICKSTER"],quantaCount:900},{id:"albedo",name:"Albedo",description:"A fase branca: purificao, clareza lunar, Anima emerge como guia interior.",observe:"Fluxo luminoso e pausado. Quanta se distribuem em padres simtricos. Vnculos longos e delicados.",tags:["alquimia","albedo","purificao","anima"],config:{danceIntensity:.09,maxSpeed:.07,breathPeriod:45,selfPull:.42,damping:5.5,linkMaxTtl:5.5,linkProbability:.008},archetypeStrengths:{ANIMA:.95,SELF:.85,WISE_ONE:.8,MOTHER:.7},archetypeActive:["ANIMA","SELF","WISE_ONE","MOTHER","CHILD"],quantaCount:550},{id:"rubedo",name:"Rubedo",description:"A fase vermelha: integrao final, o Rei e a Rainha se unem. Opus Magnum.",observe:"Todos os arqutipos danam juntos com calma majestosa. Auto-organizao mxima. O SELF brilha no centro.",tags:["alquimia","rubedo","integrao","opus"],config:{danceIntensity:.16,maxSpeed:.12,breathPeriod:26,selfPull:.5,damping:4.5,linkRadius:.1,linkProbability:.01,linkMaxTtl:4.5},archetypeStrengths:{SELF:1,ANIMA:.8,HERO:.75,WISE_ONE:.85,LOVER:.75},archetypeActive:["SELF","ANIMA","HERO","WISE_ONE","LOVER","MOTHER","CHILD"],quantaCount:700},{id:"dark-night",name:"Noite Escura da Alma",description:"So Joo da Cruz: abandono espiritual total. Deus sumiu. O ego se despedaa.",observe:"Alta fragmentao, SELF quase ausente, movimento pesado. Eventualmente  depois de muito tempo  surge uma centelha de ordem.",tags:["mstica","crise","abandono","escurido"],config:{danceIntensity:.34,maxSpeed:.28,breathPeriod:6,selfPull:.04,damping:2,linkMaxTtl:.5},archetypeStrengths:{DESTROYER:.95,SHADOW:.85,CHILD:.6,SELF:.02},archetypeActive:["DESTROYER","SHADOW","CHILD"],quantaCount:1e3},{id:"oceanic-feeling",name:"Sentimento Ocenico",description:"Freud/Rolland: dissoluo dos limites do ego, fuso com o cosmos.",observe:"Fronteiras entre regies dissolvem muito lentamente. Fluxo ocenico. Auto-organizao difusa e abrangente.",tags:["Freud","Rolland","ocenico","mstica"],config:{danceIntensity:.07,maxSpeed:.06,breathPeriod:55,selfPull:.18,damping:5.5,linkRadius:.14,linkProbability:.012,linkMaxTtl:7},archetypeStrengths:{SELF:.5,MOTHER:.85,CHILD:.8,LOVER:.7,WISE_ONE:.6},archetypeActive:["SELF","MOTHER","CHILD","LOVER","WISE_ONE"],quantaCount:800},{id:"ego-dissolution",name:"Ego Dissolution",description:"Dissoluo progressiva do ego (ex.: experincia psicodlica profunda).",observe:"O EGO se fragmenta gradualmente. Quanta vagam alm das fronteiras regionais. O coletivo expande.",tags:["dissoluo","psicodlico","self","limiar"],config:{danceIntensity:.24,maxSpeed:.19,breathPeriod:13,selfPull:.06,damping:2.5,linkRadius:.12,linkMaxTtl:1.5},archetypeStrengths:{TRICKSTER:.8,CHILD:.9,ANIMA:.7,SHADOW:.6,SELF:.3},archetypeActive:["TRICKSTER","CHILD","ANIMA","SHADOW","SELF"],quantaCount:800},{id:"narcissus-mirror",name:"Narciso  O Espelho",description:"Ferida narcsica: ego frgil, Persona rgida, Anima projetada no outro.",observe:"Cluster rgido na Persona. Sombra e Anima completamente separadas. Ressonncia com EGO.",tags:["narcisismo","espelho","persona","clnica"],config:{danceIntensity:.15,maxSpeed:.11,breathPeriod:17,selfPull:.08,damping:3.5,linkValDiff:.1},archetypeStrengths:{PERSONA:1,HERO:.9,SHADOW:.05,ANIMA:.2,SELF:.1},archetypeActive:["PERSONA","HERO","FATHER"],quantaCount:600},{id:"trauma-freeze",name:"Trauma  Congelamento",description:"Resposta de congelamento: toda a energia psquica paralisada.",observe:"Movimento mnimo, alta inibio. Quanta ficam presos em clusters rgidos. O tempo parece parar.",tags:["trauma","freeze","inibio","clnica"],config:{danceIntensity:.04,maxSpeed:.04,breathPeriod:80,selfPull:.35,damping:7,linkMaxTtl:9},archetypeStrengths:{SHADOW:.7,FATHER:.8,CHILD:.9,SELF:.3},archetypeActive:["SHADOW","FATHER","CHILD"],quantaCount:500},{id:"grief-processing",name:"Elaborao do Luto",description:"As 5 fases de Kbler-Ross como dinmica de partculas.",observe:"Oscilao lenta entre fases: negao (clusters rgidos), raiva (leve turbulncia), aceitao (fluxo suave).",tags:["luto","Kbler-Ross","elaborao","clnica"],config:{danceIntensity:.19,maxSpeed:.15,breathPeriod:16,selfPull:.22,damping:3.5,linkMaxTtl:2.5},archetypeStrengths:{CHILD:.85,SHADOW:.7,MOTHER:.75,DESTROYER:.65,SELF:.4},archetypeActive:["CHILD","SHADOW","MOTHER","DESTROYER","SELF","LOVER"],quantaCount:650},{id:"collective-dreaming",name:"Sonho Coletivo",description:"Inconsciente coletivo ativo: imagens primordiais emergindo do fundo.",observe:"Padres mandaliformes espontneos. Vnculos densos na regio Coletivo. Smbolos emergem devagar.",tags:["inconsciente coletivo","sonho","imago","Jung"],config:{danceIntensity:.12,maxSpeed:.09,breathPeriod:28,selfPull:.26,damping:4.5,linkRadius:.1,linkProbability:.007},archetypeStrengths:{WISE_ONE:.9,MOTHER:.85,CHILD:.8,TRICKSTER:.6,SELF:.7},archetypeActive:["WISE_ONE","MOTHER","CHILD","TRICKSTER","SELF","ANIMA"],quantaCount:750},{id:"kundalini",name:"Kundalini Rising",description:"Energia de base ascende pelo eixo central  da ID ao SUPEREGO.",observe:"Movimento ascendente lento e concentrado no eixo vertical. Pulsaes rtmicas profundas.",tags:["kundalini","energia","eixo","vertical"],config:{danceIntensity:.21,maxSpeed:.16,breathPeriod:10,selfPull:.55,damping:3.5,linkRadius:.06},archetypeStrengths:{HERO:.85,SELF:.9,DESTROYER:.6,WISE_ONE:.7,MOTHER:.65},archetypeActive:["HERO","SELF","DESTROYER","WISE_ONE","MOTHER"],quantaCount:700},{id:"synchronicity",name:"Sincronicidade",description:"Coincidncias significativas: padres que conectam interno e externo.",observe:"Vnculos se formam entre partculas distantes de forma improvvel. Clusters inesperados. Espelhos.",tags:["sincronicidade","Jung","padro","coincidncia"],config:{danceIntensity:.14,maxSpeed:.1,breathPeriod:20,selfPull:.28,damping:3.5,linkRadius:.16,linkProbability:.003,linkMaxTtl:5.5,linkValDiff:.6},archetypeStrengths:{TRICKSTER:.85,WISE_ONE:.8,SELF:.75,CHILD:.7},archetypeActive:["TRICKSTER","WISE_ONE","SELF","CHILD","ANIMA"],quantaCount:600},{id:"flow-state",name:"Estado de Fluxo",description:"Csikszentmihalyi: desafio = habilidade. Ateno total, sem esforo.",observe:"Movimento fluido sem turbulncia. Alta coerncia, baixa fragmentao. O tempo se dilata.",tags:["fluxo","Csikszentmihalyi","ateno","peak"],config:{danceIntensity:.17,maxSpeed:.14,breathPeriod:24,selfPull:.42,damping:2.5,linkRadius:.08,linkMaxTtl:4},archetypeStrengths:{HERO:.8,SELF:.9,TRICKSTER:.5,CHILD:.7,WISE_ONE:.75},archetypeActive:["HERO","SELF","TRICKSTER","CHILD","WISE_ONE"],quantaCount:600},{id:"mystical-union",name:"Unio Mstica",description:"Unio Mystica: a separao sujeito-objeto desaparece. Experincia de no-dualidade.",observe:"Todas as regies convergem lentamente ao SELF. Vnculos mximos. Pulsao profunda e quieta.",tags:["mstica","no-dualidade","unio","integrao"],config:{danceIntensity:.08,maxSpeed:.06,breathPeriod:50,selfPull:.62,damping:5.5,linkRadius:.12,linkProbability:.01,linkMaxTtl:7},archetypeStrengths:{SELF:1,WISE_ONE:.9,LOVER:.85,MOTHER:.8,CHILD:.8},archetypeActive:["SELF","WISE_ONE","LOVER","MOTHER","CHILD","ANIMA"],quantaCount:650},{id:"hero-complete",name:"Jornada do Heri  Retorno",description:"Campbell: o heri completa o ciclo e traz o elixir. Integrao e dom ao mundo.",observe:"HERO retorna ao SELF com sabedoria. WISE_ONE aguarda. O CHILD recebe o dom. Harmonia pausada.",tags:["Campbell","heri","retorno","jornada"],config:{danceIntensity:.13,maxSpeed:.1,breathPeriod:28,selfPull:.4,damping:4,linkMaxTtl:4.5,linkRadius:.09},archetypeStrengths:{HERO:.85,SELF:.9,WISE_ONE:.85,CHILD:.75,LOVER:.7,TRICKSTER:.55},archetypeActive:["HERO","SELF","WISE_ONE","CHILD","LOVER","TRICKSTER","MOTHER"],quantaCount:650},{id:"creative-fire",name:"Fogo Criativo",description:"A musa desceu: energia criativa expansiva, conexes improvveis.",observe:"Movimento vivaz, vnculos efmeros. Caos com inteno. Insights emergem como flashes breves.",tags:["criatividade","musa","inspirao","fogo"],config:{danceIntensity:.28,maxSpeed:.23,breathPeriod:9,selfPull:.22,damping:2,linkRadius:.07,linkMaxTtl:1.3,linkProbability:.009},archetypeStrengths:{TRICKSTER:.9,ANIMA:.85,CHILD:.85,DESTROYER:.65,SELF:.5},archetypeActive:["TRICKSTER","ANIMA","CHILD","DESTROYER","SELF","LOVER"],quantaCount:850},{id:"mente-calma",name:" Mente Calma",description:"Estado basal de equilbrio profundo. Campo congelado, atratores estticos, quanta em rbita suave ao redor do Self.",observe:"Anis concntricos ao redor do Self central. Vnculos longos e persistentes. Alta coerncia. A mente encontrou seu centro de gravidade.",tags:["estvel","equilbrio","self","meditao","atrator"],config:{danceIntensity:.04,flowGain:.2,damping:9,maxSpeed:.06,breathPeriod:55,selfPull:.8,linkRadius:.11,linkProbability:.013,linkMaxTtl:12,linkValDiff:.5,spawnRate:.4,deathAge:400,springK:.4,frozenFlow:!0,stateRelaxRate:.25,archetypesOn:!0},archetypeStrengths:{SELF:1,WISE_ONE:.85,MOTHER:.7,CHILD:.5},archetypeActive:["SELF","WISE_ONE","MOTHER"],quantaCount:500},{id:"mente-ansiosa",name:" Mente Ansiosa",description:"Ansiedade crnica: oscilao entre Superego (deveria) e Id (quero), sem resoluo. Sistema sub-amortecido  nunca assenta.",observe:"Quanta oscilam entre Superego e Id sem jamais assentar. Vnculos se formam e quebram. Alta inibio, baixa coerncia. SELF inacessvel.",tags:["estvel","ansiedade","oscilao","superego","id","clnica"],config:{danceIntensity:.08,flowGain:.3,damping:.7,maxSpeed:.28,breathPeriod:3.5,selfPull:.03,linkRadius:.05,linkProbability:.005,linkMaxTtl:.45,linkValDiff:.15,spawnRate:5,deathAge:28,springK:.8,frozenFlow:!0,stateRelaxRate:2,archetypesOn:!0},archetypeStrengths:{FATHER:.95,SHADOW:.75,DESTROYER:.55,SELF:.05,HERO:.3},archetypeActive:["FATHER","SHADOW","DESTROYER"],quantaCount:700},{id:"mente-hedonista",name:" Mente Hedonista",description:"Princpio do prazer (Freud): Id domina, Superego silenciado, toda energia flui para Eros.",observe:"Quanta gravitam entre Id e Ego/Coletivo. Alta valncia positiva, baixa inibio. LOVER e MOTHER tecem uma teia de prazer.",tags:["estvel","hedonismo","eros","prazer","id","Freud"],config:{danceIntensity:.07,flowGain:.25,damping:4.5,maxSpeed:.12,breathPeriod:9,selfPull:.06,linkRadius:.1,linkProbability:.011,linkMaxTtl:4.5,linkValDiff:.55,spawnRate:1.5,deathAge:150,springK:.35,frozenFlow:!0,stateRelaxRate:.5,archetypesOn:!0},archetypeStrengths:{LOVER:1,CHILD:.85,TRICKSTER:.6,MOTHER:.75,SHADOW:.1,FATHER:.05},archetypeActive:["LOVER","CHILD","TRICKSTER","MOTHER"],quantaCount:600},{id:"melancolia",name:" Melancolia",description:"A melancolia de Freud: o objeto perdido foi internalizado. O Ego se identifica com o que perdeu e se volta contra si mesmo.",observe:"Quanta pesados gravitam para a Sombra. Velocidade muito baixa. Valncia negativa generalizada. O SELF est l  mas inacessvel, encoberto.",tags:["clnica","depresso","Freud","objeto","perda"],config:{danceIntensity:.06,maxSpeed:.05,breathPeriod:45,selfPull:.1,damping:6.5,linkMaxTtl:1.2,linkRadius:.06},archetypeStrengths:{SHADOW:.9,DESTROYER:.7,CHILD:.8,SELF:.15,MOTHER:.3},archetypeActive:["SHADOW","DESTROYER","CHILD"],quantaCount:500},{id:"hipomania",name:" Hipomania",description:"O polo elevado do espectro bipolar: energia alta, julgamento intacto, prazer em tudo, o mundo parece possvel.",observe:"Movimento contnuo e vivaz sem colapso. Alta valncia, arousal elevado. Muitos vnculos se formando. HERO e LOVER danam sem parar.",tags:["clnica","bipolar","energia","expanso"],config:{danceIntensity:.26,maxSpeed:.22,breathPeriod:8,selfPull:.18,damping:2.5,linkRadius:.09,linkProbability:.01,linkMaxTtl:2.5},archetypeStrengths:{HERO:.9,LOVER:.85,TRICKSTER:.8,CHILD:.75,SELF:.5,DESTROYER:.3},archetypeActive:["HERO","LOVER","TRICKSTER","CHILD","SELF"],quantaCount:800},{id:"toc-compulsao",name:" TOC  Compulso",description:"Transtorno Obsessivo-Compulsivo: loops repetitivos. O FATHER demanda, o HERO obedece, a SHADOW acumula o que foi evitado.",observe:"Clusters circulam em padres repetitivos estreitos. Vnculos se formam e se desfazem nos mesmos pontos. Observe os loops.",tags:["clnica","TOC","compulso","loop","repetio"],config:{danceIntensity:.14,maxSpeed:.11,breathPeriod:6,selfPull:.05,damping:3,linkRadius:.06,linkValDiff:.08,linkMaxTtl:1.8,springK:.85},archetypeStrengths:{FATHER:1,PERSONA:.9,SHADOW:.6,HERO:.7,SELF:.1},archetypeActive:["FATHER","PERSONA","HERO","SHADOW"],quantaCount:650},{id:"dissociacao",name:" Dissociao",description:"O eu se fragmenta em partes que no se comunicam. Partes do self seguem trajetrias paralelas sem encontro.",observe:'Dois ou trs clusters isolados que quase no trocam quanta. Poucos vnculos entre regies. Cada cluster tem sua prpria "vida".',tags:["clnica","dissociao","fragmentao","trauma"],config:{danceIntensity:.1,maxSpeed:.08,breathPeriod:30,selfPull:.04,damping:5,linkRadius:.04,linkProbability:.002,linkValDiff:.08,linkMaxTtl:.8},archetypeStrengths:{SHADOW:.8,CHILD:.9,PERSONA:.75,DESTROYER:.5,SELF:.1},archetypeActive:["SHADOW","CHILD","PERSONA"],quantaCount:600},{id:"apego-ansioso",name:" Apego Ansioso",description:"Teoria do apego (Bowlby): hipervigilncia ao abandono. O CHILD orbita o MOTHER em busca de sinal, nunca satisfeito.",observe:"CHILD oscila em torno da MOTHER sem pousar. Alerta constante. Valncia instvel. Quando a MOTHER some, emerge o pnico da Sombra.",tags:["clnica","apego","ansiedade","Bowlby","CHILD"],config:{danceIntensity:.16,maxSpeed:.14,breathPeriod:5,selfPull:.08,damping:1.8,linkRadius:.07,linkMaxTtl:1,linkValDiff:.25},archetypeStrengths:{CHILD:1,MOTHER:.8,SHADOW:.65,DESTROYER:.4,FATHER:.55},archetypeActive:["CHILD","MOTHER","SHADOW","FATHER"],quantaCount:600},{id:"individuacao-final",name:" Individuao  Telos",description:"O fim do processo de individuao jungiano: todos os arqutipos integrados, SELF como centro estvel da personalidade total.",observe:"Cada arqutipo ocupa seu lugar natural. Quanta fluem sem tenso entre regies. O SELF pulsa suavemente no centro. Harmonia genuna.",tags:["Jung","individuao","integrao","telos","SELF"],config:{danceIntensity:.1,maxSpeed:.08,breathPeriod:40,selfPull:.6,damping:5,linkRadius:.1,linkProbability:.009,linkMaxTtl:6,frozenFlow:!0,stateRelaxRate:.3},archetypeStrengths:{SELF:1,WISE_ONE:.8,ANIMA:.8,HERO:.7,MOTHER:.75,SHADOW:.65,CHILD:.7,LOVER:.75,TRICKSTER:.6,FATHER:.65,DESTROYER:.55,PERSONA:.6},archetypeActive:["SELF","WISE_ONE","ANIMA","HERO","MOTHER","SHADOW","CHILD","LOVER","TRICKSTER","FATHER","DESTROYER","PERSONA"],quantaCount:700},{id:"inflacao-self",name:" Inflao do Self",description:'Identificao com o Self (messianismo, grandiosidade): o ego confunde-se com o arqutipo central. O "eu sou especial" como defesa.',observe:"Todos os quanta tentam orbitar o SELF mas sem damping suficiente  sobrepem-se, colidem, formam super-clusters instveis.",tags:["Jung","inflao","SELF","grandiosidade","messianismo"],config:{danceIntensity:.2,maxSpeed:.18,breathPeriod:12,selfPull:.9,damping:1.5,linkRadius:.05,linkMaxTtl:.6},archetypeStrengths:{SELF:1,HERO:.9,WISE_ONE:.85,FATHER:.8,PERSONA:.75},archetypeActive:["SELF","HERO","WISE_ONE","FATHER","PERSONA"],quantaCount:800},{id:"sonho-lucido",name:" Sonho Lcido",description:"Conscincia dentro do sonho: o ego sabe que sonha, pode interagir com imagens onricas sem ser arrastado.",observe:"ANIMA guia o movimento, TRICKSTER testa as bordas, CHILD explora. HERO observa com conscincia. Padres onricos estveis mas vivos.",tags:["sonho","lcido","Jung","ANIMA","onirismo"],config:{danceIntensity:.15,maxSpeed:.12,breathPeriod:18,selfPull:.3,damping:3.5,linkRadius:.09,linkMaxTtl:3.5,linkProbability:.008},archetypeStrengths:{ANIMA:.9,TRICKSTER:.8,CHILD:.85,HERO:.7,WISE_ONE:.75,SELF:.65},archetypeActive:["ANIMA","TRICKSTER","CHILD","HERO","WISE_ONE"],quantaCount:650},{id:"mindfulness",name:" Mindfulness",description:"Ateno plena ao momento presente: observar sem julgar, sem reter nem empurrar.",observe:"Movimento muito lento e uniforme. Todos os arqutipos ativos mas em baixa intensidade. Quanta distribudos. Sem aglomerao em nenhuma regio.",tags:["mindfulness","ateno","presente","meditao","equanimidade"],config:{danceIntensity:.06,maxSpeed:.05,breathPeriod:35,selfPull:.35,damping:6.5,linkRadius:.08,linkProbability:.005,linkMaxTtl:5,frozenFlow:!0,stateRelaxRate:.2},archetypeStrengths:{SELF:.6,WISE_ONE:.55,MOTHER:.5,HERO:.4,SHADOW:.4,CHILD:.45,ANIMA:.5},archetypeActive:["SELF","WISE_ONE","MOTHER","CHILD"],quantaCount:550},{id:"estado-hipnotico",name:" Estado Hipntico",description:"Transe hipntico: ateno estreitada, sugestionabilidade alta, WISE_ONE como voz interna amplificada.",observe:"Quanta convergem para um foco estreito. Movimentos quase que paralelos. Vnculos se formam rapidamente numa direo nica.",tags:["hipnose","transe","foco","ateno","sugestionabilidade"],config:{danceIntensity:.07,maxSpeed:.06,breathPeriod:20,selfPull:.55,damping:5.5,linkRadius:.07,linkProbability:.012,linkMaxTtl:8,linkValDiff:.12,frozenFlow:!0,stateRelaxRate:.35},archetypeStrengths:{WISE_ONE:1,SELF:.8,ANIMA:.7,PERSONA:.6,SHADOW:.2},archetypeActive:["WISE_ONE","SELF","ANIMA"],quantaCount:500},{id:"meditacao-theta",name:" Meditao Theta",description:"Ondas theta (48 Hz): limiar entre viglia e sono. Vises hipnaggicas. O mais profundo repouso consciente possvel.",observe:"Movimento quase imperceptvel. Vnculos duradouros e luminosos. Quanta em rbitas quase circulares. O mandala se autocompleta.",tags:["meditao","theta","repouso","viso","silncio"],config:{danceIntensity:.03,maxSpeed:.03,breathPeriod:70,selfPull:.85,damping:11,linkRadius:.12,linkProbability:.015,linkMaxTtl:15,spawnRate:.2,deathAge:500,frozenFlow:!0,stateRelaxRate:.15,archetypesOn:!0},archetypeStrengths:{SELF:1,WISE_ONE:.9,MOTHER:.8,ANIMA:.75},archetypeActive:["SELF","WISE_ONE","MOTHER"],quantaCount:450},{id:"infancia-primordial",name:" Infncia",description:"A psique infantil: CHILD domina, sem represso, sem Persona formada. Cada coisa  descoberta pela primeira vez.",observe:"Quanta exploram todas as regies sem medo. Alta renovao (vida curta, renascimento rpido). Vnculos simples e efmeros. Valncia positiva dominante.",tags:["ciclo de vida","infncia","CHILD","descoberta","inocncia"],config:{danceIntensity:.18,maxSpeed:.16,breathPeriod:10,selfPull:.12,damping:2.5,linkRadius:.08,linkMaxTtl:1.5,spawnRate:8,deathAge:20},archetypeStrengths:{CHILD:1,MOTHER:.85,LOVER:.6,TRICKSTER:.7,SELF:.3},archetypeActive:["CHILD","MOTHER","TRICKSTER","LOVER"],quantaCount:700},{id:"velhice-integrada",name:" Velhice Integrada",description:"A senectude jungiana: WISE_ONE acumula, CHILD persiste, HERO descansa. A morte como integrao, no derrota.",observe:"Movimento muito lento. Quanta com longa vida, profundamente enraizados em suas regies. Poucos novos quanta. Coerncia acumulada visvel.",tags:["ciclo de vida","velhice","WISE_ONE","integrao","sabedoria"],config:{danceIntensity:.05,maxSpeed:.04,breathPeriod:60,selfPull:.5,damping:7.5,linkRadius:.09,linkProbability:.006,linkMaxTtl:10,spawnRate:.3,deathAge:450,frozenFlow:!0,stateRelaxRate:.2},archetypeStrengths:{WISE_ONE:1,SELF:.85,MOTHER:.8,CHILD:.65,HERO:.5,ANIMA:.7},archetypeActive:["WISE_ONE","SELF","MOTHER","CHILD"],quantaCount:500},{id:"amor-eros",name:" Amor  Eros",description:"O amor ertico em seu auge: LOVER e ANIMA/ANIMUS em plena circulao. Eros como fora de ligao do mundo.",observe:"Quanta circulam entre EGO e Coletivo em correntes suaves. Vnculos densos e luminosos. Valncia muito positiva. SELF como fundo de sustentao.",tags:["amor","Eros","LOVER","ANIMA","vnculo"],config:{danceIntensity:.13,maxSpeed:.11,breathPeriod:14,selfPull:.28,damping:4,linkRadius:.11,linkProbability:.012,linkMaxTtl:5},archetypeStrengths:{LOVER:1,ANIMA:.9,CHILD:.75,MOTHER:.8,SELF:.65,HERO:.6},archetypeActive:["LOVER","ANIMA","CHILD","MOTHER","SELF"],quantaCount:650},{id:"desamor",name:" Desamor",description:"O fim do amor: ANIMA retirada, projees desfeitas. O vazio entre quem voc era e quem ficou.",observe:"LOVER e ANIMA enfraquecem, SHADOW cresce. Quanta que antes circulavam juntos divergem. Vnculos longos se rompem gradualmente.",tags:["desamor","perda","ANIMA","SHADOW","separao"],config:{danceIntensity:.14,maxSpeed:.11,breathPeriod:22,selfPull:.14,damping:3.5,linkRadius:.07,linkMaxTtl:1.8,linkValDiff:.3},archetypeStrengths:{SHADOW:.85,DESTROYER:.7,CHILD:.8,ANIMA:.3,SELF:.35,LOVER:.2},archetypeActive:["SHADOW","DESTROYER","CHILD","ANIMA","SELF"],quantaCount:600},{id:"amor-materno",name:" Amor Materno",description:"MOTHER como arqutipo central: proteo, nutrio, incondicionalidade. O Self nutrindo o mundo.",observe:"Quanta orbitam a MOTHER em espirais protetoras. CHILD permanece prximo. Alta densidade de vnculos na regio Coletivo. Calor e sustentao.",tags:["MOTHER","amor","nutrio","proteo","arqutipo"],config:{danceIntensity:.09,maxSpeed:.07,breathPeriod:28,selfPull:.42,damping:5,linkRadius:.12,linkProbability:.013,linkMaxTtl:7,frozenFlow:!0,stateRelaxRate:.4},archetypeStrengths:{MOTHER:1,CHILD:.9,SELF:.75,LOVER:.7,ANIMA:.65,WISE_ONE:.6},archetypeActive:["MOTHER","CHILD","SELF","LOVER"],quantaCount:600},{id:"insight-subito",name:" Insight Sbito",description:'O momento "Eureka": ordem brota do caos em flash. TRICKSTER encontra WISE_ONE no mesmo instante.',observe:"Quanta em movimento variado se reorganizam subitamente em torno do SELF. Vnculos improvveis se formam. O campo parece respirar fundo.",tags:["insight","criatividade","eureka","TRICKSTER","WISE_ONE"],config:{danceIntensity:.22,maxSpeed:.18,breathPeriod:12,selfPull:.35,damping:2.8,linkRadius:.14,linkProbability:.008,linkMaxTtl:3.5,linkValDiff:.55},archetypeStrengths:{TRICKSTER:.95,WISE_ONE:.9,SELF:.8,CHILD:.75,ANIMA:.7},archetypeActive:["TRICKSTER","WISE_ONE","SELF","CHILD","ANIMA"],quantaCount:650},{id:"incubacao-criativa",name:" Incubao Criativa",description:"A fase silenciosa da criatividade: a ideia ainda no nasceu, mas est se formando no escuro.",observe:"Aparentemente quieto. Quanta se movem muito devagar, tecendo vnculos sub-visveis. TRICKSTER e ANIMA trabalham em silncio. Espere.",tags:["criatividade","incubao","silncio","processo","gestation"],config:{danceIntensity:.06,maxSpeed:.05,breathPeriod:42,selfPull:.22,damping:6,linkRadius:.1,linkProbability:.006,linkMaxTtl:6.5,frozenFlow:!0,stateRelaxRate:.3},archetypeStrengths:{TRICKSTER:.7,ANIMA:.8,CHILD:.75,WISE_ONE:.65,SHADOW:.5,SELF:.55},archetypeActive:["TRICKSTER","ANIMA","CHILD","WISE_ONE","SHADOW"],quantaCount:550},{id:"psicose-limiar",name:" Limiar da Psicose",description:"O limite antes do colapso total: o ego ainda existe mas est sendo arrastado. DESTROYER e SHADOW dominam sem oposio.",observe:"Movimento turbulento com ilhas momentneas de ordem que se desfazem. Quanta cruzam fronteiras regionais aleatoriamente. Tenso extrema.",tags:["clnica","psicose","limiar","DESTROYER","colapso"],config:{danceIntensity:.35,maxSpeed:.3,breathPeriod:4,selfPull:.02,damping:1.5,linkMaxTtl:.3,linkRadius:.06,spawnRate:7,deathAge:15},archetypeStrengths:{DESTROYER:1,SHADOW:.9,TRICKSTER:.75,CHILD:.7,SELF:.05,HERO:.2},archetypeActive:["DESTROYER","SHADOW","TRICKSTER","CHILD"],quantaCount:950},{id:"sabedoria-trickster",name:" Sabedoria do Trickster",description:"O Trickster maduro: no mais puro caos, mas o caos que serve  transformao. A sabedoria que s vem pela disrupo.",observe:"Padres se formam e se desfazem ciclicamente. TRICKSTER e WISE_ONE alternando influncia. Caos com ritmo reconhecvel.",tags:["Trickster","sabedoria","transformao","ciclo","paradoxo"],config:{danceIntensity:.2,maxSpeed:.16,breathPeriod:11,selfPull:.25,damping:2.5,linkRadius:.08,linkMaxTtl:2.5,linkProbability:.007},archetypeStrengths:{TRICKSTER:.95,WISE_ONE:.85,SHADOW:.7,SELF:.75,CHILD:.65,DESTROYER:.55},archetypeActive:["TRICKSTER","WISE_ONE","SHADOW","SELF","CHILD"],quantaCount:700},{id:"complexo-paterno",name:" Complexo Paterno",description:"A sombra do FATHER: lei, limite, julgamento. Pode ser libertador ou aprisionante. Hero tenta escapar, Persona obedece.",observe:"FATHER domina o Superego com fora. HERO e PERSONA orbitam tensamente. CHILD recuado. SHADOW cresce nos limites.",tags:["complexo","FATHER","lei","autoridade","clnica"],config:{danceIntensity:.17,maxSpeed:.14,breathPeriod:14,selfPull:.1,damping:3.5,linkRadius:.07,linkValDiff:.18,linkMaxTtl:2.5},archetypeStrengths:{FATHER:1,PERSONA:.85,HERO:.75,SHADOW:.7,CHILD:.4,SELF:.25},archetypeActive:["FATHER","PERSONA","HERO","SHADOW","CHILD"],quantaCount:650}];function qB(e){return cg.find(t=>t.id===e)}const lb="'Doto', monospace",tr="'IBM Plex Mono', monospace",Po="#8b5cf6",WB={CALM:{label:"CALMO",desc:"Equilbrio dinmico",color:"#93c5fd"},ALERT:{label:"ALERTA",desc:"Tenso crescente",color:"#fde047"},PANIC:{label:"COLAPSO",desc:"Ruptura catica",color:"#f87171"},FLOW:{label:"FLUXO",desc:"Coerncia elevada  Self ativo",color:"#86efac"},FRAGMENTED:{label:"FRAGMENTADO",desc:"Dissociao ativa",color:"#fdba74"},INTEGRATING:{label:"INTEGRANDO",desc:"Sntese emergente",color:"#c4b5fd"}},HB={CALM:"Princpio de Prazer estvel  Eros domina",ALERT:"Conflito pulsional  Id vs Superego",PANIC:"Retorno do Reprimido  defesas rompidas",FLOW:"Sublimao ativa  Eros liberto",FRAGMENTED:"Angstia de fragmentao  Ego frgil",INTEGRATING:"Elaborao psquica  Trabalho de luto"},GB={CALM:"Ordem simblica estvel  Lei do Pai operativa",ALERT:"Tenso RSI  borda entre registros",PANIC:"Irrupo do Real  inassimilvel",FLOW:"Gozo modulado  circulao entre registros",FRAGMENTED:"Sujeito dividido ($) em crise",INTEGRATING:"Travessia da fantasia  reorganizao do $"},Zm=[{id:"TOPOLOGY",label:"Topologia",color:"#c4b5fd"},{id:"ENERGY",label:"Energia",color:"#fca5a5"},{id:"VALENCE",label:"Valncia",color:"#86efac"},{id:"COHERENCE",label:"Coerncia",color:"#93c5fd"},{id:"ARCHETYPES",label:"Arqutipos",color:"#fde047"},{id:"EVENTS",label:"Eventos",color:"#67e8f9"},{id:"LACAN",label:" Lacan  RSI",color:"#e0a0ff",group:"teoria"},{id:"FREUD",label:" Freud  Id/Ego",color:"#f4a460",group:"teoria"}],VB=[{sigil:"",name:"SELF",color:"#f5c842",desc:"Centro integrador"},{sigil:"",name:"EGO",color:"#3b82f6",desc:"Conscincia diurna"},{sigil:"",name:"PERSONA",color:"#b0c4de",desc:"Mscara social"},{sigil:"",name:"SOMBRA",color:"#7c3aed",desc:"Contedo reprimido"},{sigil:"",name:"ID",color:"#ef4444",desc:"Pulses primais"},{sigil:"",name:"SUPEREGO",color:"#9ca3af",desc:"Lei interna"},{sigil:"",name:"COLETIVO",color:"#06b6d4",desc:"Inconsciente coletivo"}],UB=[{sigil:"",name:"Id",color:"#ef4444",desc:"Reservatrio pulsional"},{sigil:"",name:"Ego",color:"#3b82f6",desc:"Realidade  mediador"},{sigil:"",name:"Superego",color:"#9ca3af",desc:"Lei e ideal  censura"},{sigil:"",name:"Eros",color:"#f472b6",desc:"Pulso de Vida"},{sigil:"",name:"Thanatos",color:"#64748b",desc:"Pulso de Morte"}],YB=[{sigil:"",name:"Real",color:"#dc2626",desc:"O inassimilvel"},{sigil:"",name:"Simblico",color:"#3b82f6",desc:"Rede de significantes"},{sigil:"",name:"Imaginrio",color:"#f5c842",desc:"Identificaes do Ego"},{sigil:"S",name:"Sujeito $",color:"#a78bfa",desc:"Sujeito dividido"},{sigil:"a",name:"Objeto a",color:"#fb923c",desc:"Causa do desejo"}],KB=[300,600,900,1200],XB=[{hex:"#000000",label:"Preto"},{hex:"#0a0a0a",label:"Quase preto"},{hex:"#0d0d1a",label:"ndigo escuro"},{hex:"#0a0f0a",label:"Verde escuro"},{hex:"#1a1a1a",label:"Cinza escuro"},{hex:"#f5f5f0",label:"Quase branco"},{hex:"#ffffff",label:"Branco"}],Ss={background:"rgba(0,0,0,0.94)",border:"1px dashed rgba(255,255,255,0.06)",overflow:"hidden"},ZB=(e="rgba(255,255,255,0.22)")=>({background:"none",border:"none",cursor:"pointer",width:"100%",padding:"8px 12px",display:"flex",alignItems:"center",justifyContent:"space-between",fontFamily:lb,fontSize:10,color:e,letterSpacing:"0.08em",textTransform:"uppercase",transition:"background 0.15s"}),Cs={fontFamily:tr,fontSize:8,color:"rgba(255,255,255,0.35)",letterSpacing:"0.06em",textTransform:"uppercase"},cy={fontFamily:tr,fontSize:8,color:"rgba(255,255,255,0.22)"},JB=e=>{var j,T,_,P;const[t,r]=w.useState(!1),[o,s]=w.useState(!1),[l,i]=w.useState(!1),[u,c]=w.useState(!1),[d,h]=w.useState(!1),f=cg.find(I=>I.id===e.presetId),g=e.presetId==="red-book-journey",m=!!((j=f==null?void 0:f.config)!=null&&j.frozenFlow),y=WB[e.phase],v=e.lens==="FREUD",b=e.lens==="LACAN",S=v||b,C=v?HB[e.phase]:b?GB[e.phase]:y.desc,k=v?"estado libidinal":b?"posio subjetiva":"estado psquico",R=v?"#f4a460":b?"#e0a0ff":y.color;return a.jsxs("div",{style:{position:"fixed",inset:0,pointerEvents:"none",zIndex:20,userSelect:"none"},children:[m&&a.jsxs("div",{style:{position:"absolute",top:10,left:"50%",transform:"translateX(-50%)",zIndex:30,...Ss,padding:"4px 14px",display:"flex",alignItems:"center",gap:6,borderColor:"rgba(120,240,160,0.20)"},children:[a.jsx("span",{style:{color:"rgba(100,230,140,0.70)",fontSize:8},children:""}),a.jsx("span",{style:{...Cs,color:"rgba(100,230,140,0.60)"},children:"campo estvel"}),a.jsx("span",{style:{...cy,color:"rgba(100,230,140,0.30)"},children:"frozenFlow"})]}),a.jsx("div",{style:{position:"absolute",left:10,top:50,bottom:10,width:172,pointerEvents:"auto",overflowY:"auto",overflowX:"hidden",scrollbarWidth:"thin",scrollbarColor:`${Po}40 transparent`},children:a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6,paddingBottom:8},children:[a.jsxs("div",{style:{...Ss,padding:"6px 8px",display:"flex",alignItems:"center",gap:5},children:[a.jsx("button",{onClick:e.onToggleRun,style:{flex:1,padding:"4px 0",fontFamily:tr,fontSize:9,background:"none",cursor:"pointer",border:`1px dashed ${e.running?"rgba(255,255,255,0.10)":`${Po}40`}`,color:e.running?"rgba(255,255,255,0.40)":`${Po}cc`,letterSpacing:"0.06em",textTransform:"uppercase"},children:e.running?" Pausar":" Iniciar"}),a.jsx("button",{onClick:e.onReset,title:"Reiniciar",style:{background:"none",border:"none",cursor:"pointer",color:"rgba(255,255,255,0.25)",fontSize:13,padding:"0 4px"},children:""}),a.jsx("button",{onClick:e.onCinematicToggle,style:{background:"none",border:"none",cursor:"pointer",color:e.cinematicMode?Po:"rgba(255,255,255,0.20)",fontSize:10,padding:"0 2px"},children:e.cinematicMode?"":""})]}),a.jsxs("div",{style:{...Ss,borderColor:(S?R:y.color)+"18",padding:"10px 12px"},children:[a.jsx("div",{style:{...Cs,color:(S?R:y.color)+"80",marginBottom:4},children:k}),a.jsx("div",{style:{fontFamily:lb,fontSize:13,letterSpacing:"0.1em",color:S?R:y.color,marginBottom:3},children:y.label}),a.jsx("div",{style:{fontFamily:tr,fontSize:7,lineHeight:1.5,color:(S?R:y.color)+"70"},children:C})]}),v&&e.freudMetrics?a.jsxs("div",{style:{...Ss,borderColor:"#f4a46018",padding:"10px 12px"},children:[a.jsx("div",{style:{...Cs,color:"#f4a46050",marginBottom:8},children:"ndices Freudianos"}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[a.jsx(cl,{label:"Eros",sublabel:"pulso de vida",value:e.freudMetrics.eros,color:"#f472b6"}),a.jsx(cl,{label:"Thanatos",sublabel:"pulso de morte",value:e.freudMetrics.thanatos,color:"#64748b"}),a.jsx(cl,{label:"Represso",sublabel:"bloqueio do Ego",value:e.freudMetrics.repressao,color:"#f4a460"}),a.jsx(cl,{label:"Sublimao",sublabel:"energia transformada",value:e.freudMetrics.sublimacao,color:"#86efac"})]})]}):b&&e.lacanMetrics?a.jsxs("div",{style:{...Ss,borderColor:"#e0a0ff18",padding:"10px 12px"},children:[a.jsx("div",{style:{...Cs,color:"#e0a0ff50",marginBottom:8},children:"Registros RSI"}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[a.jsx(cl,{label:"Real",sublabel:"o inassimilvel",value:e.lacanMetrics.real,color:"#dc2626"}),a.jsx(cl,{label:"Simblico",sublabel:"rede de significantes",value:e.lacanMetrics.simbolico,color:"#3b82f6"}),a.jsx(cl,{label:"Imaginrio",sublabel:"identificao especular",value:e.lacanMetrics.imaginario,color:"#f5c842"})]})]}):a.jsxs("div",{style:{...Ss,padding:"10px 12px"},children:[a.jsx("div",{style:{...Cs,marginBottom:8},children:"ndices"}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[a.jsx(cl,{label:"Integrao",sublabel:"coeso psquica",value:e.integrationIndex,color:"#f5c842"}),a.jsx(cl,{label:"Tenso",sublabel:"conflito de foras",value:e.tensionIndex,color:"#f87171"}),a.jsx(cl,{label:"Fragmentao",sublabel:"dissociao",value:Math.min(1,e.fragmentIndex),color:"#fb923c"})]})]}),a.jsxs("div",{style:{...Ss,padding:"10px 12px"},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:6},children:[a.jsx("span",{style:Cs,children:"Velocidade"}),a.jsxs("span",{style:cy,children:[Math.round(e.danceIntensity*100),"%"]})]}),a.jsx("input",{type:"range",min:.04,max:.8,step:.01,value:e.danceIntensity,onChange:I=>e.onDanceChange(parseFloat(I.target.value)),style:{width:"100%",height:2,accentColor:Po,cursor:"pointer"}}),a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:3},children:[a.jsx("span",{style:{fontFamily:tr,fontSize:7,color:"rgba(255,255,255,0.15)"},children:"Contemplativo"}),a.jsx("span",{style:{fontFamily:tr,fontSize:7,color:"rgba(255,255,255,0.15)"},children:"Intenso"})]})]}),a.jsx(Zl,{title:"Parmetros",open:u,onToggle:()=>c(I=>!I),children:a.jsxs("div",{style:{padding:"8px 12px",display:"flex",flexDirection:"column",gap:8},children:[a.jsx(ji,{label:"Dana",hint:"intensidade do flow field",value:e.flowGain,min:.05,max:.8,step:.05,display:I=>`${Math.round(I*100)}%`,color:"#c4b5fd",onChange:e.onFlowGainChange}),a.jsx(ji,{label:"Molas",hint:"rigidez dos vnculos",value:e.springK,min:.1,max:2,step:.05,display:I=>I.toFixed(2),color:"#86efac",onChange:e.onSpringKChange}),a.jsx(ji,{label:"Alcance",hint:"raio de conexo",value:e.linkRadius,min:.04,max:.18,step:.005,display:I=>I.toFixed(3),color:"#67e8f9",onChange:e.onLinkRadiusChange}),a.jsx(ji,{label:"Respirao",hint:"ciclo em segundos",value:e.breathPeriod,min:6,max:60,step:1,display:I=>`${Math.round(I)}s`,color:"#fca5a5",onChange:e.onBreathPeriodChange})]})}),a.jsxs("div",{style:Ss,children:[a.jsxs("div",{style:{padding:"8px 12px",borderBottom:"1px dashed rgba(255,255,255,0.04)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.jsx("span",{style:{fontFamily:lb,fontSize:10,color:"rgba(255,255,255,0.22)",letterSpacing:"0.08em",textTransform:"uppercase"},children:"Fsica Psquica"}),a.jsx("button",{onClick:e.onFrozenFlowToggle,style:{padding:"2px 8px",fontFamily:tr,fontSize:7,background:e.frozenFlow?"rgba(100,230,140,0.08)":"none",border:`1px dashed ${e.frozenFlow?"rgba(100,230,140,0.30)":"rgba(255,255,255,0.08)"}`,color:e.frozenFlow?"rgba(100,230,140,0.75)":"rgba(255,255,255,0.25)",cursor:"pointer",letterSpacing:"0.08em",textTransform:"uppercase"},children:e.frozenFlow?" fixo":" livre"})]}),a.jsxs("div",{style:{padding:"8px 12px",display:"flex",flexDirection:"column",gap:10},children:[a.jsx(ji,{label:"Inrcia",hint:"resistncia  mudana",value:e.damping,min:.3,max:20,step:.1,display:I=>I.toFixed(1),color:"#fbbf24",onChange:e.onDampingChange}),a.jsx(ji,{label:"Memria",hint:"velocidade de mudana interna",value:e.stateRelaxRate,min:.05,max:3,step:.05,display:I=>`${I.toFixed(2)}`,color:"#67e8f9",onChange:e.onStateRelaxChange})]})]}),a.jsxs("div",{style:{...Ss,padding:"10px 12px"},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[a.jsx("span",{style:Cs,children:"Alma"}),a.jsxs("span",{style:cy,children:[Math.round(e.soulVis*100),"%"]})]}),a.jsx("div",{style:{fontFamily:tr,fontSize:7,color:"rgba(255,255,255,0.15)",marginBottom:5,lineHeight:1.5},children:"identidade individual de cada quantum"}),a.jsx("input",{type:"range",min:0,max:1,step:.02,value:e.soulVis,onChange:I=>e.onSoulVisChange(parseFloat(I.target.value)),style:{width:"100%",height:2,accentColor:Po,cursor:"pointer"}})]}),a.jsx(Zl,{title:"Lente",open:l,onToggle:()=>i(I=>!I),accent:((T=Zm.find(I=>I.id===e.lens))==null?void 0:T.color)??Po,extra:a.jsx("span",{style:{fontFamily:tr,fontSize:8,color:((_=Zm.find(I=>I.id===e.lens))==null?void 0:_.color)??"#aaa"},children:(P=Zm.find(I=>I.id===e.lens))==null?void 0:P.label}),children:a.jsx("div",{style:{padding:"4px 8px"},children:Zm.map(I=>a.jsxs("button",{onClick:()=>{e.onLensChange(I.id),i(!1)},style:{display:"block",width:"100%",textAlign:"left",padding:"5px 6px",background:e.lens===I.id?"rgba(255,255,255,0.04)":"none",border:"none",cursor:"pointer",borderLeft:`2px solid ${e.lens===I.id?I.color+"60":"transparent"}`,fontFamily:tr,fontSize:9,color:e.lens===I.id?I.color:"rgba(255,255,255,0.30)",transition:"all 0.1s"},children:[I.group==="teoria"&&a.jsx("div",{style:{fontSize:6,color:"rgba(255,255,255,0.15)",letterSpacing:"0.1em",textTransform:"uppercase",marginBottom:2},children:I.group}),I.label]},I.id))})}),a.jsxs("div",{style:{...Ss,padding:"8px 12px",display:"flex",flexDirection:"column",gap:6},children:[a.jsx(B0,{label:"Mapa",on:e.overlayOn,onToggle:e.onOverlayToggle,color:"#c4b5fd"}),a.jsx(B0,{label:"Campo",on:e.campoOn,onToggle:e.onCampoToggle,color:"#06b6d4"}),a.jsx(B0,{label:"Vetores",on:e.fieldOn,onToggle:e.onFieldToggle,color:"#a3e635"}),a.jsx(B0,{label:"Rastros",on:e.trailOn,onToggle:e.onTrailToggle,color:"#a78bfa"}),a.jsx(B0,{label:"Bonds",on:e.bondsOn,onToggle:e.onBondsToggle,color:"#67e8f9"}),a.jsx(B0,{label:"Arqutipos",on:e.archetypesOn,onToggle:e.onArchetypesToggle,color:"#fde047"}),g&&a.jsx(B0,{label:"Jornada",on:e.journeyOn,onToggle:e.onJourneyToggle,color:"#c4b5fd"}),e.bondsOn&&a.jsxs("div",{style:{paddingTop:6,borderTop:"1px dashed rgba(255,255,255,0.04)",display:"flex",flexDirection:"column",gap:6},children:[a.jsx(ji,{label:"Espessura",hint:"bonds",value:e.bondWidth,min:.3,max:4,step:.1,display:I=>I.toFixed(1),color:"#67e8f9",onChange:e.onBondWidthChange}),a.jsx(ji,{label:"Opac. bonds",hint:"",value:e.bondOpacity,min:.05,max:1,step:.05,display:I=>`${Math.round(I*100)}%`,color:"#67e8f9",onChange:e.onBondOpacityChange})]}),e.trailOn&&a.jsxs("div",{style:{paddingTop:6,borderTop:"1px dashed rgba(255,255,255,0.04)",display:"flex",flexDirection:"column",gap:6},children:[a.jsx(ji,{label:"Memria",hint:"rastros",value:e.trailFade,min:.01,max:.2,step:.005,display:I=>I.toFixed(3),color:"#a78bfa",onChange:e.onTrailFadeChange}),a.jsx(ji,{label:"Opac. rastro",hint:"",value:e.trailOpacity,min:.1,max:1,step:.05,display:I=>`${Math.round(I*100)}%`,color:"#a78bfa",onChange:e.onTrailOpacityChange}),a.jsx(ji,{label:"Cauda",hint:"",value:e.trailWidth,min:1,max:8,step:.5,display:I=>I.toFixed(1),color:"#a78bfa",onChange:e.onTrailWidthChange})]})]}),a.jsxs("div",{style:{...Ss,padding:"8px 12px"},children:[a.jsx("div",{style:{...Cs,marginBottom:6},children:"Partculas"}),a.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:4},children:KB.map(I=>a.jsx("button",{onClick:()=>e.onQuantaChange(I),style:{padding:"3px 0",fontFamily:tr,fontSize:8,background:e.quantaCount===I?`${Po}10`:"none",border:`1px dashed ${e.quantaCount===I?`${Po}40`:"rgba(255,255,255,0.06)"}`,color:e.quantaCount===I?`${Po}cc`:"rgba(255,255,255,0.22)",cursor:"pointer",transition:"all 0.15s"},children:I>=1e3?`${I/1e3}k`:I},I))})]}),a.jsxs("div",{style:{...Ss,padding:"8px 12px"},children:[a.jsx("div",{style:{...Cs,marginBottom:6},children:"Fundo"}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[a.jsxs("div",{style:{position:"relative",flexShrink:0},children:[a.jsx("div",{style:{width:20,height:20,border:"1px dashed rgba(255,255,255,0.12)",background:e.bgColor,cursor:"pointer"}}),a.jsx("input",{type:"color",value:e.bgColor,onChange:I=>e.onBgColorChange(I.target.value),style:{position:"absolute",inset:0,opacity:0,cursor:"pointer",width:"100%",height:"100%"}})]}),a.jsx("span",{style:{fontFamily:tr,fontSize:8,color:"rgba(255,255,255,0.30)"},children:e.bgColor})]}),a.jsx("div",{style:{display:"flex",gap:4,marginTop:6,flexWrap:"wrap"},children:XB.map(I=>a.jsx("button",{onClick:()=>e.onBgColorChange(I.hex),title:I.label,style:{width:18,height:18,cursor:"pointer",background:I.hex,border:`1px dashed ${e.bgColor===I.hex?`${Po}55`:"rgba(255,255,255,0.08)"}`,transition:"border-color 0.15s"}},I.hex))})]})]})}),a.jsx("div",{style:{position:"absolute",right:10,top:50,bottom:10,width:208,pointerEvents:"auto",overflowY:"auto",overflowX:"hidden",scrollbarWidth:"thin",scrollbarColor:`${Po}40 transparent`},children:a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6,paddingBottom:8},children:[a.jsx("button",{onClick:e.onOpenConsciousness,style:{width:"100%",padding:"10px 0",background:`${Po}06`,border:`1px dashed ${Po}25`,color:`${Po}90`,fontFamily:tr,fontSize:9,letterSpacing:"0.12em",textTransform:"uppercase",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:6,transition:"all 0.15s"},children:" Nova Conscincia"}),a.jsx(Zl,{title:"Preset",open:o,onToggle:()=>s(I=>!I),accent:`${Po}80`,extra:a.jsx("span",{style:{fontFamily:tr,fontSize:8,color:`${Po}60`},children:(f==null?void 0:f.name)??""}),children:a.jsx("div",{style:{maxHeight:240,overflowY:"auto"},children:cg.map(I=>a.jsxs("button",{onClick:()=>{e.onPresetChange(I.id),s(!1)},style:{display:"block",width:"100%",textAlign:"left",padding:"8px 12px",background:"none",cursor:"pointer",borderLeft:`2px solid ${e.presetId===I.id?`${Po}60`:"transparent"}`,borderTop:"none",borderRight:"none",borderBottom:"1px dashed rgba(255,255,255,0.03)",transition:"all 0.1s"},children:[a.jsx("div",{style:{fontFamily:tr,fontSize:9,color:e.presetId===I.id?`${Po}cc`:"rgba(255,255,255,0.45)",marginBottom:2},children:I.name}),a.jsx("div",{style:{fontFamily:tr,fontSize:7,color:"rgba(255,255,255,0.18)",lineHeight:1.4},children:I.observe})]},I.id))})}),a.jsx(Zl,{title:"Crnica",open:d,onToggle:()=>h(I=>!I),extra:e.narrativeLog.length>0?a.jsx("span",{style:{fontFamily:tr,fontSize:7,color:`${Po}50`},children:e.narrativeLog.length}):void 0,children:a.jsx("div",{style:{maxHeight:200,overflowY:"auto"},children:e.narrativeLog.length===0?a.jsx("p",{style:{padding:"10px 12px",fontFamily:tr,fontSize:8,color:"rgba(255,255,255,0.15)",fontStyle:"italic"},children:"Nenhum evento ainda."}):[...e.narrativeLog].reverse().map((I,$)=>a.jsxs("div",{style:{display:"flex",gap:8,padding:"5px 12px",borderBottom:"1px dashed rgba(255,255,255,0.03)"},children:[a.jsx("span",{style:{fontFamily:tr,fontSize:7,color:"rgba(255,255,255,0.18)",flexShrink:0,marginTop:1},children:QB(I.time)}),a.jsx("span",{style:{fontFamily:tr,fontSize:8,lineHeight:1.4,color:I.color+"bb"},children:I.text})]},$))})}),v?a.jsx(n$,{metrics:e.freudMetrics,phase:e.phase}):b?a.jsx(r$,{metrics:e.lacanMetrics,phase:e.phase,integration:e.integrationIndex}):a.jsx(e$,{integration:e.integrationIndex,tension:e.tensionIndex,fragment:e.fragmentIndex,phase:e.phase}),v?a.jsx(dy,{title:"Aparelho Psquico",camadas:UB,intro:"Cada quantum habita zonas do aparelho freudiano.",legenda:[["#ef4444","Id","pulso crua"],["#3b82f6","Ego","realidade"],["#9ca3af","Superego","lei"]]}):b?a.jsx(dy,{title:"Topologia RSI",camadas:YB,intro:"Real, Simblico, Imaginrio  borromeanamente ligados.",legenda:[["#dc2626","Real","inassimilvel"],["#3b82f6","Simblico","lei/linguagem"],["#f5c842","Imaginrio","espelho"]]}):a.jsx(dy,{title:"Mapa Psquico",camadas:VB,intro:"Cada quantum navega por regies que modulam seu estado.",legenda:[["#ef4444","Vermelho","alta energia"],["#3b82f6","Azul","coerncia"],["#86efac","Verde","valncia +"],["#7c3aed","Roxo","sombra"],["#f5c842","Dourado","Self"]]}),e.archetypesOn&&a.jsx(Zl,{title:"Arqutipos",open:t,onToggle:()=>r(I=>!I),children:a.jsx("div",{style:{padding:"4px 8px",maxHeight:280,overflowY:"auto"},children:Ki.map((I,$)=>a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"3px 0"},children:[a.jsx("button",{onClick:()=>e.onArchActiveToggle($),style:{background:"none",border:"none",cursor:"pointer",fontSize:12,flexShrink:0,opacity:e.archetypeActive[$]?1:.2,transition:"opacity 0.2s"},children:I.sigil}),a.jsx("span",{style:{fontFamily:tr,fontSize:8,width:56,flexShrink:0,color:e.archetypeActive[$]?I.color:"rgba(255,255,255,0.15)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:I.id}),a.jsx("input",{type:"range",min:0,max:1,step:.05,value:e.archetypeStrengths[$],disabled:!e.archetypeActive[$],onChange:q=>e.onArchStrengthChange($,parseFloat(q.target.value)),style:{flex:1,height:2,accentColor:I.color,cursor:"pointer",opacity:e.archetypeActive[$]?1:.15}})]},I.id))})}),e.journeyOn&&e.journeyChapter&&a.jsxs("div",{style:{...Ss,borderColor:`${Po}15`,padding:"10px 12px"},children:[a.jsxs("div",{style:{...Cs,color:`${Po}40`,marginBottom:5},children:["Ato ",e.journeyAct+1]}),a.jsx("p",{style:{fontFamily:tr,fontSize:9,color:"rgba(255,255,255,0.35)",fontStyle:"italic",lineHeight:1.6},children:e.journeyChapter})]})]})})]})};function Zl({title:e,open:t,onToggle:r,children:o,accent:s="rgba(255,255,255,0.22)",extra:l}){return a.jsxs("div",{style:Ss,children:[a.jsxs("button",{onClick:r,style:{...ZB(s)},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5},children:[t?a.jsx(Pa,{size:9,style:{opacity:.35}}):a.jsx(aa,{size:9,style:{opacity:.35}}),e]}),l]}),t&&a.jsx("div",{style:{borderTop:"1px dashed rgba(255,255,255,0.04)"},children:o})]})}function cl({label:e,sublabel:t,value:r,color:o}){const s=Math.round(Math.max(0,Math.min(1,r))*100);return a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:3},children:[a.jsx("span",{style:{fontFamily:tr,fontSize:9,color:"rgba(255,255,255,0.50)"},children:e}),a.jsxs("span",{style:{fontFamily:tr,fontSize:8,color:o+"bb"},children:[s,"%"]})]}),a.jsx("div",{style:{height:3,background:"rgba(255,255,255,0.04)",overflow:"hidden"},children:a.jsx("div",{style:{height:"100%",width:`${Math.max(2,s)}%`,background:`linear-gradient(90deg, ${o}55, ${o}aa)`,transition:"width 0.7s"}})}),a.jsx("div",{style:{fontFamily:tr,fontSize:7,color:"rgba(255,255,255,0.15)",marginTop:2},children:t})]})}function ji({label:e,hint:t,value:r,min:o,max:s,step:l,display:i,color:u,onChange:c}){return a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[a.jsx("span",{style:{fontFamily:tr,fontSize:9,color:u+"aa",letterSpacing:"0.04em",textTransform:"uppercase"},children:e}),a.jsx("span",{style:{fontFamily:tr,fontSize:8,color:"rgba(255,255,255,0.22)"},children:i(r)})]}),a.jsx("input",{type:"range",min:o,max:s,step:l,value:r,onChange:d=>c(parseFloat(d.target.value)),style:{width:"100%",height:2,accentColor:u,cursor:"pointer"}}),t&&a.jsx("div",{style:{fontFamily:tr,fontSize:7,color:"rgba(255,255,255,0.12)",marginTop:2},children:t})]})}function B0({label:e,on:t,onToggle:r,color:o}){return a.jsxs("button",{onClick:r,style:{display:"flex",alignItems:"center",gap:8,background:"none",border:"none",cursor:"pointer",width:"100%",padding:0,transition:"all 0.15s"},children:[a.jsx("span",{style:{fontFamily:tr,fontSize:10,color:t?o:"rgba(255,255,255,0.15)",transition:"color 0.2s"},children:t?"":""}),a.jsx("span",{style:{fontFamily:tr,fontSize:9,color:t?o+"cc":"rgba(255,255,255,0.22)",letterSpacing:"0.04em",textTransform:"uppercase",transition:"color 0.2s"},children:e})]})}function js({label:e,value:t,color:r,desc:o}){const s=Math.round(Math.max(0,Math.min(1,t))*100);return a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:3},children:[a.jsx("span",{style:{fontFamily:tr,fontSize:9,color:"rgba(255,255,255,0.45)"},children:e}),a.jsxs("span",{style:{fontFamily:tr,fontSize:8,color:r+"aa"},children:[s,"%"]})]}),a.jsx("div",{style:{height:3,background:"rgba(255,255,255,0.04)",overflow:"hidden"},children:a.jsx("div",{style:{height:"100%",width:`${Math.max(2,s)}%`,background:`linear-gradient(90deg, ${r}44, ${r}99)`,transition:"width 0.7s"}})}),a.jsx("div",{style:{fontFamily:tr,fontSize:7,color:"rgba(255,255,255,0.12)",marginTop:2},children:o})]})}function QB(e){const t=Math.floor(e/60),r=Math.floor(e%60);return`${t}:${r.toString().padStart(2,"0")}`}const e$=({integration:e,tension:t,fragment:r,phase:o})=>{const[s,l]=w.useState(!0),i=Math.min(1,t*(1-e)*1.4),u=Math.min(1,e*(1-t)*(1-r)*1.6),c=Math.min(1,t*r*1.8),d=Math.max(-1,Math.min(1,e-r-t*.5)),h=Math.min(1,t>.65?(t-.65)*2.5:0),f=d>.1?"#86efac":d<-.1?"#f87171":"#94a3b8",g=d>.3?"Progresso ativa":d<-.2?"Regresso ativa":"Neutro";return a.jsx(Zl,{title:"Processo Psquico",open:s,onToggle:()=>l(m=>!m),children:a.jsxs("div",{style:{padding:"10px 12px",display:"flex",flexDirection:"column",gap:8},children:[a.jsx(js,{label:"Compensao",value:i,color:"#fb923c",desc:"inconsciente compensando o consciente"}),a.jsx(js,{label:"Numinosidade",value:u,color:"#f5c842",desc:"qualidade sagrada  Self ativo"}),a.jsx(js,{label:"Complexo Ativo",value:c,color:"#c084fc",desc:"dissociao parcial em curso"}),h>.05&&a.jsx(js,{label:"Enantiodromia",value:h,color:"#f43f5e",desc:"reverso iminente"}),a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:3},children:[a.jsx("span",{style:{fontFamily:tr,fontSize:8,color:f+"aa"},children:d>=0?"Progresso":"Regresso"}),a.jsx("span",{style:{fontFamily:tr,fontSize:7,color:f+"77"},children:g})]}),a.jsxs("div",{style:{height:3,background:"rgba(255,255,255,0.04)",position:"relative",overflow:"hidden"},children:[a.jsx("div",{style:{position:"absolute",left:"50%",top:0,width:1,height:"100%",background:"rgba(255,255,255,0.12)"}}),a.jsx("div",{style:{position:"absolute",top:0,height:"100%",transition:"all 0.7s",...d>=0?{left:"50%",width:`${Math.abs(d)*50}%`,background:`${f}88`}:{right:"50%",width:`${Math.abs(d)*50}%`,background:`${f}88`}}})]})]}),a.jsx("div",{style:{paddingTop:6,borderTop:"1px dashed rgba(255,255,255,0.04)"},children:a.jsx("p",{style:{fontFamily:tr,fontSize:7,color:"rgba(255,255,255,0.20)",fontStyle:"italic",lineHeight:1.6},children:t$(i,u,c,d,o)})})]})})};function t$(e,t,r,o,s){return t>.55?"Self ativo  individuao emergente. Raro e precioso.":r>.6?"Complexo autnomo dominante. Ego perdeu o centro.":e>.7?"Compensao intensa. O oposto do estado consciente pressiona.":o>.5?"Libido progressiva  energia fluindo para formas superiores.":o<-.4?"Regresso ativa  libido voltando ao modo primitivo.":s==="FLOW"?"Funo Transcendente ativa  sntese consciente/inconsciente.":s==="PANIC"?"Enantiodromia em curso  ruptura antes da renovao.":"Processo em andamento  padres emergentes aguardando leitura."}const n$=({metrics:e,phase:t})=>{const[r,o]=w.useState(!0);if(!e)return null;const s=e.idPower+e.egoStrength+e.superegoForce+.001,l=e.idPower/s,i=e.egoStrength/s,u=e.superegoForce/s,c=()=>e.eros>.65?"Eros dominante  libido expansiva, tendncia  ligao.":e.thanatos>.55?"Thanatos emergente  compulso de repetio ativa.":e.repressao>.6?"Alta represso  material inconsciente sob presso.":e.sublimacao>.55?"Sublimao ativa  energia pulsional transformada.":t==="PANIC"?"Retorno do reprimido  defesas rompidas pelo acmulo.":t==="FLOW"?"Princpio da realidade em equilbrio com o prazer.":"Economia libidinal em negociao  Id, Ego e Superego em tenso.";return a.jsx(Zl,{title:" Aparelho Psquico",open:r,onToggle:()=>o(d=>!d),accent:"#f4a46080",children:a.jsxs("div",{style:{padding:"10px 12px",display:"flex",flexDirection:"column",gap:8},children:[a.jsxs("div",{children:[a.jsx("div",{style:{...Cs,color:"#f4a46040",marginBottom:5},children:"Distribuio topogrfica"}),a.jsxs("div",{style:{display:"flex",height:4,gap:1,overflow:"hidden"},children:[a.jsx("div",{style:{width:`${l*100}%`,background:"rgba(239,68,68,0.65)",transition:"width 0.7s"}}),a.jsx("div",{style:{width:`${i*100}%`,background:"rgba(59,130,246,0.65)",transition:"width 0.7s"}}),a.jsx("div",{style:{width:`${u*100}%`,background:"rgba(156,163,175,0.55)",transition:"width 0.7s"}})]}),a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:3},children:[a.jsxs("span",{style:{fontFamily:tr,fontSize:7,color:"#ef444477"},children:["Id ",Math.round(l*100),"%"]}),a.jsxs("span",{style:{fontFamily:tr,fontSize:7,color:"#3b82f677"},children:["Ego ",Math.round(i*100),"%"]}),a.jsxs("span",{style:{fontFamily:tr,fontSize:7,color:"#9ca3af77"},children:["SG ",Math.round(u*100),"%"]})]})]}),a.jsx(js,{label:"Eros",value:e.eros,color:"#f472b6",desc:"pulso de vida"}),a.jsx(js,{label:"Thanatos",value:e.thanatos,color:"#64748b",desc:"pulso de morte"}),a.jsx(js,{label:"Represso",value:e.repressao,color:"#f4a460",desc:"material bloqueado"}),a.jsx(js,{label:"Sublimao",value:e.sublimacao,color:"#86efac",desc:"energia transformada"}),a.jsx("div",{style:{paddingTop:6,borderTop:"1px dashed rgba(255,255,255,0.04)"},children:a.jsx("p",{style:{fontFamily:tr,fontSize:7,color:"#f4a46060",fontStyle:"italic",lineHeight:1.6},children:c()})})]})})},r$=({metrics:e,phase:t})=>{const[r,o]=w.useState(!0);if(!e)return null;const s=e.real+e.simbolico+e.imaginario+.001,l=e.real/s,i=e.simbolico/s,u=e.imaginario/s,c=()=>e.real>.45?"Irrupo do Real  o inassimilvel invade o campo.":e.gozo>.65?"Gozo intenso  alm do princpio do prazer.":e.falta>.75?"Falta estrutural dominante  desejo como motor.":e.sujeito>.6?"Sujeito dividido em crise  falha na cadeia significante.":e.simbolico>.55?"Ordem Simblica forte  Lei do Pai operativa.":e.imaginario>.55?"Registro Imaginrio dominante  identificao especular.":t==="FLOW"?"Circulao borromiana equilibrada  RSI em tenso criativa.":t==="PANIC"?"N borromiano solto  passagem ao ato iminente.":"Registros RSI em reorganizao  sujeito em travessia.";return a.jsx(Zl,{title:" Topologia RSI",open:r,onToggle:()=>o(d=>!d),accent:"#e0a0ff80",children:a.jsxs("div",{style:{padding:"10px 12px",display:"flex",flexDirection:"column",gap:8},children:[a.jsxs("div",{children:[a.jsx("div",{style:{...Cs,color:"#e0a0ff40",marginBottom:5},children:"Proporo dos registros"}),a.jsxs("div",{style:{display:"flex",height:4,gap:1,overflow:"hidden"},children:[a.jsx("div",{style:{width:`${l*100}%`,background:"rgba(220,38,38,0.70)",transition:"width 0.7s"}}),a.jsx("div",{style:{width:`${i*100}%`,background:"rgba(59,130,246,0.70)",transition:"width 0.7s"}}),a.jsx("div",{style:{width:`${u*100}%`,background:"rgba(245,200,66,0.65)",transition:"width 0.7s"}})]}),a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:3},children:[a.jsxs("span",{style:{fontFamily:tr,fontSize:7,color:"#dc262677"},children:["R ",Math.round(l*100),"%"]}),a.jsxs("span",{style:{fontFamily:tr,fontSize:7,color:"#3b82f677"},children:["S ",Math.round(i*100),"%"]}),a.jsxs("span",{style:{fontFamily:tr,fontSize:7,color:"#f5c84277"},children:["I ",Math.round(u*100),"%"]})]})]}),a.jsx(js,{label:"Real",value:e.real,color:"#dc2626",desc:"inassimilvel  trauma"}),a.jsx(js,{label:"Simblico",value:e.simbolico,color:"#3b82f6",desc:"lei, linguagem, Outro"}),a.jsx(js,{label:"Imaginrio",value:e.imaginario,color:"#f5c842",desc:"espelho, Ego, imagem"}),a.jsxs("div",{style:{paddingTop:6,borderTop:"1px dashed rgba(255,255,255,0.04)"},children:[a.jsx("div",{style:{...Cs,color:"#e0a0ff40",marginBottom:5},children:"Conceitos"}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[a.jsx(js,{label:"Gozo (J)",value:e.gozo,color:"#f43f5e",desc:"jouissance  alm do prazer"}),a.jsx(js,{label:"Falta ()",value:e.falta,color:"#e0a0ff",desc:"manque  buraco do desejo"}),a.jsx(js,{label:"Sujeito $",value:e.sujeito,color:"#a78bfa",desc:"diviso  efeito do significante"})]})]}),a.jsx("div",{style:{display:"flex",justifyContent:"center",gap:12,padding:"8px 0"},children:[{label:"R",color:"#dc2626",v:e.real},{label:"S",color:"#3b82f6",v:e.simbolico},{label:"I",color:"#f5c842",v:e.imaginario}].map(({label:d,color:h,v:f})=>a.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:3},children:a.jsx("div",{style:{width:26+f*14,height:26+f*14,border:`1px dashed ${h}55`,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.7s"},children:a.jsx("span",{style:{fontFamily:tr,fontSize:10,color:h},children:d})})},d))}),a.jsx("div",{style:{paddingTop:6,borderTop:"1px dashed rgba(255,255,255,0.04)"},children:a.jsx("p",{style:{fontFamily:tr,fontSize:7,color:"#e0a0ff55",fontStyle:"italic",lineHeight:1.6},children:c()})})]})})},dy=({title:e,camadas:t,intro:r,legenda:o})=>{const[s,l]=w.useState(!1);return a.jsx(Zl,{title:e,open:s,onToggle:()=>l(i=>!i),children:a.jsxs("div",{style:{padding:"8px 12px"},children:[a.jsx("p",{style:{fontFamily:tr,fontSize:7,color:"rgba(255,255,255,0.18)",fontStyle:"italic",marginBottom:8,lineHeight:1.5},children:r}),t.map(i=>a.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",padding:"3px 0"},children:[a.jsx("span",{style:{fontSize:12,flexShrink:0,color:i.color},children:i.sigil}),a.jsx("span",{style:{fontFamily:tr,fontSize:9,color:i.color},children:i.name}),a.jsx("span",{style:{fontFamily:tr,fontSize:7,color:"rgba(255,255,255,0.20)"},children:i.desc})]},i.name)),a.jsxs("div",{style:{marginTop:8,paddingTop:6,borderTop:"1px dashed rgba(255,255,255,0.04)"},children:[a.jsx("div",{style:{...Cs,marginBottom:4},children:"Lentes de cor"}),o.map(([i,u,c])=>a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:3},children:[a.jsx("div",{style:{width:6,height:6,background:i+"bb",flexShrink:0}}),a.jsx("span",{style:{fontFamily:tr,fontSize:7,color:i+"99"},children:u}),a.jsxs("span",{style:{fontFamily:tr,fontSize:7,color:"rgba(255,255,255,0.15)"},children:[" ",c]})]},u))]})]})})},Ev=[{id:"hero-inflation",name:"Heri Inflado",sigil:"",color:"#3b82f6",keywords:["fora","direo","sombra negada"],description:"Ego identificado com o Heri. Persona brilhante. Sombra cresce s escuras.",poeticLine:"A espada erguida que no v sua prpria sombra.",archetypes:{HERO:.95,PERSONA:.85,FATHER:.75,SHADOW:.25,SELF:.1},configMods:{danceIntensity:.38,maxSpeed:.3,breathPeriod:10,selfPull:.08}},{id:"shadow-surge",name:"Sombra Emergente",sigil:"",color:"#7c3aed",keywords:["reprimido","retorno","complexo"],description:"Contedo reprimido pressiona por emergncia. Vrtices no quadrante da Sombra.",poeticLine:"O que foi enterrado comea a mover a terra.",archetypes:{SHADOW:.95,DESTROYER:.8,TRICKSTER:.65,SELF:.2,HERO:.2},configMods:{danceIntensity:.5,maxSpeed:.4,breathPeriod:8,selfPull:.12}},{id:"grande-mae",name:"Grande Me",sigil:"",color:"#f59e0b",keywords:["nutrio","eros","vnculo"],description:"Campo matrizal dominante. Anima e Amante tecem o espao.",poeticLine:"A mo que sustenta sem prender.",archetypes:{MOTHER:.95,ANIMA:.8,LOVER:.75,CHILD:.6,SELF:.55},configMods:{danceIntensity:.26,maxSpeed:.2,breathPeriod:22,selfPull:.22}},{id:"lei-pai",name:"Lei do Pai",sigil:"",color:"#6b7280",keywords:["estrutura","represso","lei"],description:"Estrutura normativa alta. Inibio cresce. Movimento restrito mas coeso.",poeticLine:"A lei que ordena tambm aprisiona.",archetypes:{FATHER:.95,PERSONA:.75,HERO:.55,SHADOW:.35,SELF:.15},configMods:{danceIntensity:.28,maxSpeed:.2,breathPeriod:18,selfPull:.1}},{id:"crianca-divina",name:"Criana Divina",sigil:"",color:"#06b6d4",keywords:["potencial","abertura","renascimento"],description:"Abertura radical ao novo. Inibio baixa. Movimento livre e exploratrio.",poeticLine:"O olho que v tudo pela primeira vez.",archetypes:{CHILD:.95,LOVER:.75,ANIMA:.7,TRICKSTER:.55,SELF:.4},configMods:{danceIntensity:.42,maxSpeed:.34,breathPeriod:12,selfPull:.16}},{id:"velho-sabio",name:"Velho Sbio",sigil:"",color:"#6366f1",keywords:["sntese","sentido","profundidade"],description:"Self e Sbio em confluncia. Integrao ativa. Campo centralizado.",poeticLine:"O silncio que contm todas as respostas.",archetypes:{WISE_ONE:.95,SELF:.9,ANIMA:.65,MOTHER:.55,SHADOW:.3},configMods:{danceIntensity:.22,maxSpeed:.16,breathPeriod:28,selfPull:.3}},{id:"possessao",name:"Possesso",sigil:"",color:"#84cc16",keywords:["caos","ruptura","transfigurao"],description:"Trickster e Destruidor dominam. Estrutura colapsa. Reconfigurao emerge.",poeticLine:"O relmpago que ilumina ao destruir.",archetypes:{TRICKSTER:.95,DESTROYER:.88,SHADOW:.75,SELF:.1,HERO:.15},configMods:{danceIntensity:.68,maxSpeed:.58,breathPeriod:6,selfPull:.08}},{id:"individuation",name:"Individuao",sigil:"",color:"#f5c842",keywords:["integrao","totalidade","mandala"],description:"Todos em equilbrio dinmico. Self como centro gravitacional.",poeticLine:"O crculo que contm todos os opostos.",archetypes:{SELF:.9,WISE_ONE:.75,HERO:.65,SHADOW:.55,ANIMA:.6,MOTHER:.5},configMods:{danceIntensity:.3,maxSpeed:.22,breathPeriod:22,selfPull:.28}}],o$={SHADOW:["O Retorno","A Sombra que Fala","O Abismo","A Escurido Frtil"],HERO:["A Espada","O Ego Diretivo","O Conquistador","A Fora Cega"],SELF:["O Centro","O Mandala Vivo","A Totalidade","O Eixo"],TRICKSTER:["O Caos","O Shapeshifter","A Ordem Quebrada","O Limiar"],MOTHER:["O Campo","A Nutrio","O Acolhimento","A Origem"],DESTROYER:["A Ruptura","O Fim Necessrio","A Transfigurao","O Vazio"],ANIMA:["A Ponte","O Mensageiro","O Feminino","A Mediao"],WISE_ONE:["O Sbio","A Sntese","O Sentido","A Profundidade"],FATHER:["A Lei","A Estrutura","O Pai","A Norma"],CHILD:["O Novo","O Potencial","A Abertura","A Inocncia"],LOVER:["O Eros","O Vnculo","A Ressonncia","O Encontro"],PERSONA:["A Mscara","O Papel","A Interface","O Rosto Pblico"]},Zk={SELF:"#f5c842",PERSONA:"#b0c4de",SHADOW:"#7c3aed",ANIMA:"#f43f5e",TRICKSTER:"#84cc16",HERO:"#3b82f6",MOTHER:"#f59e0b",FATHER:"#6b7280",WISE_ONE:"#6366f1",CHILD:"#06b6d4",LOVER:"#ec4899",DESTROYER:"#ef4444"};function uy(e){return e[Math.floor(Math.random()*e.length)]}function tS(){const e=uy(Ev),t={};for(const[c,d]of Object.entries(e.archetypes))t[c]=Math.max(.05,Math.min(1,d+(Math.random()-.5)*.28));const r=Ad.filter(c=>!(c in t)),o=1+Math.floor(Math.random()*2);for(let c=0;c<o;c++){const d=uy(r.slice(c));d&&(t[d]=.12+Math.random()*.42)}const s=Jk(t),l=uy(o$[s]??["Uma Nova Conscincia"]),i=Zk[s]??"#c4b5fd",u={...e.configMods};return u.danceIntensity&&(u.danceIntensity=hy(u.danceIntensity+(Math.random()-.5)*.14,.12,.75)),u.maxSpeed&&(u.maxSpeed=hy(u.maxSpeed+(Math.random()-.5)*.1,.1,.65)),u.breathPeriod&&(u.breathPeriod=hy(u.breathPeriod+(Math.random()-.5)*8,6,55)),{name:l,description:e.description,poeticLine:e.poeticLine,archetypeWeights:t,activeArchetypes:Object.keys(t),configMods:u,dominantArchetype:s,predictedPhase:Qk(t),color:i}}function a$(e){if(e.length===0)return null;const t=Ev.filter(g=>e.includes(g.id));if(t.length===0)return null;const r={};for(const g of t)for(const[m,y]of Object.entries(g.archetypes))r[m]=Math.min(1,Math.max(r[m]??0,y)*.8+y*.2);const o=Jm(t,g=>g.configMods.danceIntensity??.32),s=Jm(t,g=>g.configMods.maxSpeed??.24),l=Jm(t,g=>g.configMods.breathPeriod??20),i=Jm(t,g=>g.configMods.selfPull??.18),u=Jk(r),c=Zk[u]??"#c4b5fd",d=t.map(g=>g.name).join("  "),h=t.map(g=>g.description).join(" "),f=t[0].poeticLine;return{name:d,description:h,poeticLine:f,archetypeWeights:r,activeArchetypes:Object.keys(r),configMods:{danceIntensity:o,maxSpeed:s,breathPeriod:l,selfPull:i},dominantArchetype:u,predictedPhase:Qk(r),color:c}}function Jk(e){let t="SELF",r=0;for(const[o,s]of Object.entries(e))s>r&&(r=s,t=o);return t}function Qk(e){const t=(e.SHADOW??0)*.3+(e.DESTROYER??0)*.3+(e.TRICKSTER??0)*.2,r=(e.SELF??0)*.4+(e.WISE_ONE??0)*.3+(e.ANIMA??0)*.15;return t>.6?t>.75?"COLAPSO":"ALERTA":r>.55?r>.7?"FLUXO":"INTEGRANDO":"CALMO"}function Jm(e,t){return e.reduce((r,o)=>r+t(o),0)/e.length}function hy(e,t,r){return Math.max(t,Math.min(r,e))}const eR="'Doto', monospace",qo="'IBM Plex Mono', monospace",Ll="#8b5cf6",s$=({onClose:e,onInvoke:t})=>{const[r,o]=w.useState("random"),[s,l]=w.useState(null),[i,u]=w.useState([]),[c,d]=w.useState(!1);w.useEffect(()=>{l(tS())},[]);const h=i.length>0?a$(i):null,f=r==="random"?s:h,g=y=>u(v=>v.includes(y)?v.filter(b=>b!==y):v.length<3?[...v,y]:v),m=()=>{f&&(d(!0),setTimeout(()=>{t(f),e()},320))};return a.jsx("div",{onClick:y=>y.target===y.currentTarget&&e(),style:{position:"fixed",inset:0,zIndex:50,display:"flex",alignItems:"center",justifyContent:"center",padding:16,background:"rgba(0,0,0,0.92)"},children:a.jsxs("div",{style:{position:"relative",width:"100%",maxWidth:640,maxHeight:"90vh",display:"flex",flexDirection:"column",overflow:"hidden",background:"rgba(0,0,0,0.98)",border:"1px dashed rgba(255,255,255,0.08)"},children:[a.jsxs("div",{style:{flexShrink:0,padding:"18px 24px 14px",borderBottom:"1px dashed rgba(255,255,255,0.06)",display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[a.jsxs("div",{children:[a.jsx("div",{style:{fontFamily:qo,fontSize:8,color:"rgba(255,255,255,0.18)",letterSpacing:"0.1em",textTransform:"uppercase",marginBottom:5},children:"PSYCHE LAB  CONSCINCIA"}),a.jsx("h2",{style:{fontFamily:eR,fontSize:17,color:"rgba(255,255,255,0.75)",letterSpacing:"0.04em",margin:0},children:"Gerar Nova Conscincia"}),a.jsx("p",{style:{fontFamily:qo,fontSize:9,color:"rgba(255,255,255,0.22)",marginTop:4,fontStyle:"italic"},children:"Cada invocao reinicia a psique com novos padres iniciais."})]}),a.jsx("button",{onClick:e,style:{background:"none",border:"none",cursor:"pointer",color:"rgba(255,255,255,0.15)",fontSize:16,padding:"0 2px"},children:""})]}),a.jsx("div",{style:{flexShrink:0,display:"flex",borderBottom:"1px dashed rgba(255,255,255,0.05)"},children:["random","compose"].map(y=>a.jsx("button",{onClick:()=>o(y),style:{flex:1,padding:"10px 0",background:"none",border:"none",cursor:"pointer",fontFamily:qo,fontSize:9,letterSpacing:"0.1em",textTransform:"uppercase",color:r===y?`${Ll}cc`:"rgba(255,255,255,0.18)",borderBottom:r===y?`1px solid ${Ll}55`:"1px solid transparent",transition:"all 0.15s"},children:y==="random"?" Aleatrio":" Compor"},y))}),a.jsxs("div",{style:{flex:1,overflowY:"auto",minHeight:0},children:[r==="random"&&a.jsxs("div",{style:{padding:20,display:"flex",flexDirection:"column",gap:16},children:[a.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[a.jsx("button",{onClick:()=>l(tS()),style:{display:"flex",alignItems:"center",gap:6,padding:"6px 12px",background:"none",border:"1px dashed rgba(255,255,255,0.10)",color:"rgba(255,255,255,0.35)",cursor:"pointer",fontFamily:qo,fontSize:9,letterSpacing:"0.08em",textTransform:"uppercase",transition:"all 0.15s"},children:" Gerar Outro"}),a.jsx("span",{style:{fontFamily:qo,fontSize:8,color:"rgba(255,255,255,0.15)",fontStyle:"italic"},children:"Seed aleatrio baseado em complexos junguianos"})]}),s&&a.jsx(nS,{profile:s})]}),r==="compose"&&a.jsxs("div",{style:{padding:20,display:"flex",flexDirection:"column",gap:16},children:[a.jsxs("p",{style:{fontFamily:qo,fontSize:8,color:"rgba(255,255,255,0.20)",fontStyle:"italic",margin:0},children:["Selecione at 3 complexos. Os campos se fundiro num perfil nico.",i.length>0&&a.jsxs("span",{style:{marginLeft:4,color:`${Ll}55`},children:[i.length,"/3 selecionados."]})]}),a.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:Ev.map(y=>a.jsx(i$,{c:y,selected:i.includes(y.id),onToggle:()=>g(y.id)},y.id))}),h&&a.jsxs("div",{style:{paddingTop:8,borderTop:"1px dashed rgba(255,255,255,0.04)",display:"flex",flexDirection:"column",gap:10},children:[a.jsx("div",{style:{fontFamily:qo,fontSize:8,color:"rgba(255,255,255,0.22)",letterSpacing:"0.1em",textTransform:"uppercase"},children:" Fuso resultante"}),a.jsx(nS,{profile:h})]}),i.length===0&&a.jsx("div",{style:{padding:"24px 0",textAlign:"center",fontFamily:qo,fontSize:9,color:"rgba(255,255,255,0.15)",fontStyle:"italic"},children:"Nenhum complexo selecionado ainda."})]})]}),a.jsx("div",{style:{flexShrink:0,padding:"14px 20px",borderTop:"1px dashed rgba(255,255,255,0.05)"},children:a.jsxs("button",{onClick:m,disabled:!f||c,style:{width:"100%",padding:"12px 0",display:"flex",alignItems:"center",justifyContent:"center",gap:8,background:c?`${Ll}0c`:`${Ll}06`,border:`1px dashed ${c?`${Ll}50`:`${Ll}25`}`,color:c?`${Ll}cc`:`${Ll}90`,fontFamily:qo,fontSize:10,letterSpacing:"0.12em",textTransform:"uppercase",cursor:!f||c?"not-allowed":"pointer",opacity:f?1:.3,transition:"all 0.2s"},children:[" ",c?"Invocando...":"Invocar Conscincia"]})})]})})},nS=({profile:e})=>{const t=Ki.find(s=>s.id===e.dominantArchetype),r=e.color,o=Object.entries(e.archetypeWeights).sort(([,s],[,l])=>l-s).slice(0,6);return a.jsxs("div",{style:{padding:16,background:r+"06",border:`1px dashed ${r}22`,transition:"all 0.2s"},children:[a.jsxs("div",{style:{display:"flex",gap:12,alignItems:"flex-start",marginBottom:12},children:[a.jsx("span",{style:{fontSize:28,lineHeight:1,flexShrink:0,color:r},children:(t==null?void 0:t.sigil)??""}),a.jsxs("div",{style:{flex:1,minWidth:0},children:[a.jsx("div",{style:{fontFamily:eR,fontSize:15,color:"rgba(255,255,255,0.80)",letterSpacing:"0.04em",marginBottom:3},children:e.name}),a.jsxs("div",{style:{fontFamily:qo,fontSize:8,fontStyle:"italic",lineHeight:1.5,color:r+"99"},children:['"',e.poeticLine,'"']}),a.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:5,marginTop:8},children:[a.jsxs("span",{style:{fontFamily:qo,fontSize:7,padding:"2px 6px",background:r+"12",color:r+"bb"},children:[" ",e.dominantArchetype]}),a.jsx("span",{style:{fontFamily:qo,fontSize:7,padding:"2px 6px",background:"rgba(255,255,255,0.03)",color:"rgba(255,255,255,0.30)"},children:e.predictedPhase}),a.jsxs("span",{style:{fontFamily:qo,fontSize:7,padding:"2px 6px",background:"rgba(255,255,255,0.03)",color:"rgba(255,255,255,0.30)"},children:[e.activeArchetypes.length," arqutipos"]})]})]})]}),a.jsx("p",{style:{fontFamily:qo,fontSize:8,color:"rgba(255,255,255,0.28)",marginBottom:12,lineHeight:1.6},children:e.description}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:5},children:o.map(([s,l])=>{const i=Ki.find(u=>u.id===s);return i?a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[a.jsx("span",{style:{fontSize:11,width:16,flexShrink:0,textAlign:"center",color:i.color},children:i.sigil}),a.jsx("span",{style:{fontFamily:qo,fontSize:7,width:70,flexShrink:0,color:"rgba(255,255,255,0.35)"},children:i.id}),a.jsx("div",{style:{flex:1,height:3,background:"rgba(255,255,255,0.04)",overflow:"hidden"},children:a.jsx("div",{style:{height:"100%",width:`${Math.round(l*100)}%`,background:`linear-gradient(90deg, ${i.color}55, ${i.color}aa)`,transition:"width 0.7s"}})}),a.jsxs("span",{style:{fontFamily:qo,fontSize:7,color:"rgba(255,255,255,0.20)",width:26,textAlign:"right"},children:[Math.round(l*100),"%"]})]},s):null})}),a.jsxs("div",{style:{marginTop:12,paddingTop:10,borderTop:"1px dashed rgba(255,255,255,0.04)",display:"flex",flexWrap:"wrap",gap:12},children:[e.configMods.danceIntensity!=null&&a.jsx(fy,{label:"Velocidade",value:`${Math.round(e.configMods.danceIntensity*100)}%`}),e.configMods.breathPeriod!=null&&a.jsx(fy,{label:"Respirao",value:`${Math.round(e.configMods.breathPeriod)}s`}),e.configMods.maxSpeed!=null&&a.jsx(fy,{label:"Max Speed",value:e.configMods.maxSpeed.toFixed(2)})]})]})},fy=({label:e,value:t})=>a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[a.jsx("span",{style:{fontFamily:qo,fontSize:7,color:"rgba(255,255,255,0.15)",letterSpacing:"0.1em",textTransform:"uppercase"},children:e}),a.jsx("span",{style:{fontFamily:qo,fontSize:9,color:"rgba(255,255,255,0.35)"},children:t})]}),i$=({c:e,selected:t,onToggle:r})=>{const o=Object.entries(e.archetypes).sort(([,s],[,l])=>l-s).slice(0,3);return a.jsxs("button",{onClick:r,style:{textAlign:"left",padding:12,cursor:"pointer",background:t?e.color+"08":"rgba(255,255,255,0.01)",border:`1px dashed ${t?e.color+"40":"rgba(255,255,255,0.05)"}`,transition:"all 0.15s"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8},children:[a.jsx("span",{style:{fontSize:18,lineHeight:1,flexShrink:0,color:e.color},children:e.sigil}),a.jsxs("div",{style:{flex:1,minWidth:0},children:[a.jsx("div",{style:{fontFamily:qo,fontSize:9,lineHeight:1.3,color:t?e.color:"rgba(255,255,255,0.50)"},children:e.name}),a.jsx("div",{style:{display:"flex",gap:4,flexWrap:"wrap",marginTop:3},children:e.keywords.map(s=>a.jsx("span",{style:{fontFamily:qo,fontSize:7,color:"rgba(255,255,255,0.15)"},children:s},s))})]}),t&&a.jsx("span",{style:{fontSize:9,flexShrink:0,color:e.color},children:""})]}),a.jsx("div",{style:{display:"flex",gap:4,flexWrap:"wrap"},children:o.map(([s,l])=>{const i=Ki.find(u=>u.id===s);return i?a.jsxs("span",{style:{fontFamily:qo,fontSize:7,padding:"2px 6px",background:i.color+"12",color:i.color+"99"},children:[i.sigil," ",Math.round(l*100),"%"]},s):null})})]})};const Td={zVar:"speed",zScale:.55,mode:"particles",camera:{yaw:.55,pitch:.48,dist:3,panX:0,panY:0},showTrails:!1,trailLen:14,showBonds:!1,ptSize:5.5,colorScheme3D:"default"};function l$(e,t,r,o){const s=1/Math.tan(e/2),l=1/(r-o),i=new Float32Array(16);return i[0]=s/t,i[5]=s,i[10]=(o+r)*l,i[11]=-1,i[14]=2*o*r*l,i}function c$(e,t,r,o,s,l){let i=o-e,u=s-t,c=l-r,d=Math.sqrt(i*i+u*u+c*c)||1;i/=d,u/=d,c/=d;let h=u*0-c*-1,f=c*0-i*0,g=i*-1-u*0;h=u*0-c*1,f=c*0-i*0,g=i*1-u*0,h=-c,f=0,g=i;let m=Math.sqrt(h*h+f*f+g*g)||1;h/=m,f/=m,g/=m;const y=f*c-g*u,v=g*i-h*c,b=h*u-f*i;return new Float32Array([h,y,-i,0,f,v,-u,0,g,b,-c,0,-(h*e+f*t+g*r),-(y*e+v*t+b*r),i*e+u*t+c*r,1])}function d$(e,t){const r=new Float32Array(16);for(let o=0;o<4;o++)for(let s=0;s<4;s++)r[s*4+o]=e[0+o]*t[s*4+0]+e[4+o]*t[s*4+1]+e[8+o]*t[s*4+2]+e[12+o]*t[s*4+3];return r}const u$=`
attribute vec3 a_pos;
attribute vec3 a_col;
attribute float a_alpha;
uniform mat4 u_mvp;
uniform float u_ptSize;
varying vec3 v_col;
varying float v_alpha;
void main(){
  gl_Position = u_mvp * vec4(a_pos,1.0);
  gl_PointSize = u_ptSize;
  v_col = a_col; v_alpha = a_alpha;
}`,h$=`
precision mediump float;
varying vec3 v_col;
varying float v_alpha;
void main(){ gl_FragColor = vec4(v_col, v_alpha); }`,dl=7;class Tv{constructor(t){this.gl=null,this.prg=null,this.buf=null,this.verts=new Float32Array(0),this.trailBuf=new Map,this.frameIdx=0,this.canvas=t;const r=t.getContext("webgl",{alpha:!0,antialias:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0});if(!r){console.warn("[Renderer3D] WebGL unavailable");return}this.gl=r,this.prg=this.buildProg(u$,h$),this.prg&&(this.buf=r.createBuffer())}get isReady(){return this.gl!==null&&this.prg!==null}buildProg(t,r){const o=this.gl,s=(c,d)=>{const h=o.createShader(c);return o.shaderSource(h,d),o.compileShader(h),o.getShaderParameter(h,o.COMPILE_STATUS)?h:(console.error("[Renderer3D]",o.getShaderInfoLog(h)),null)},l=s(o.VERTEX_SHADER,t),i=s(o.FRAGMENT_SHADER,r);if(!l||!i)return null;const u=o.createProgram();return o.attachShader(u,l),o.attachShader(u,i),o.linkProgram(u),o.getProgramParameter(u,o.LINK_STATUS)?u:(console.error("[Renderer3D]",o.getProgramInfoLog(u)),null)}resize(t,r){if(!this.gl)return;const o=Math.min(window.devicePixelRatio||1,1.5);this.canvas.width=Math.round(t*o),this.canvas.height=Math.round(r*o),this.gl.viewport(0,0,this.canvas.width,this.canvas.height)}render(t,r,o,s){const l=this.gl;if(!l||!this.prg||!this.buf)return;const i=this.canvas.width,u=this.canvas.height;if(i===0||u===0)return;const c=r.camera,d=f$(c),h=c$(d[0],d[1],d[2],c.panX,0,c.panY),f=l$(Math.PI*.4,i/u,.01,50),g=d$(f,h);l.useProgram(this.prg),l.uniformMatrix4fv(l.getUniformLocation(this.prg,"u_mvp"),!1,g),l.clearColor(.027,.02,.055,1),l.clear(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT),l.enable(l.BLEND),l.blendFunc(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA),l.enable(l.DEPTH_TEST),l.depthFunc(l.LEQUAL);const m=r.zScale;if(this.drawGrid(l,g,m),(r.mode==="terrain"||r.mode==="hybrid")&&o&&this.drawTerrain(l,o,m),r.mode==="terrain")return;const y=t.length;if(y===0)return;if(r.showTrails){this.frameIdx++;for(let C=0;C<y;C++){const k=t[C];this.trailBuf.has(C)||this.trailBuf.set(C,[]);const R=this.trailBuf.get(C);R.push([k.nx,k.ny,k.z*m]),R.length>(r.trailLen??14)&&R.shift()}const S=[];for(let C=0;C<y;C++){const k=this.trailBuf.get(C);if(!k||k.length<2)continue;const R=t[C];for(let j=1;j<k.length;j++){const T=j/k.length*.45,_=k[j-1],P=k[j];S.push(_[0],_[2]>.001?_[2]:.001,-_[1]),S.push(R.r*.6,R.g*.6,R.b*.8,T*.6),S.push(P[0],P[2]>.001?P[2]:.001,-P[1]),S.push(R.r*.8,R.g*.8,R.b*.9,T)}}if(S.length>0){const C=new Float32Array(S),k=C.length/dl;this.upload(l,C,k),this.setAttribs(l),l.uniform1f(l.getUniformLocation(this.prg,"u_ptSize"),1),l.drawArrays(l.LINES,0,k)}}else this.trailBuf.size>0&&this.trailBuf.clear();if(r.showBonds&&s&&s.length>0){const S=[];for(const C of s){const k=C.a,R=C.b;if(k<0||R<0||k>=y||R>=y)continue;const j=t[k],T=t[R],_=j.z*m,P=T.z*m;S.push(j.nx,_,-j.ny,.55,.4,.8,.35),S.push(T.nx,P,-T.ny,.55,.4,.8,.35)}if(S.length>0){const C=new Float32Array(S),k=C.length/dl;this.upload(l,C,k),this.setAttribs(l),l.uniform1f(l.getUniformLocation(this.prg,"u_ptSize"),1),l.drawArrays(l.LINES,0,k)}}const v=y*2;this.verts.length<v*dl&&(this.verts=new Float32Array((v+200)*dl));let b=0;for(let S=0;S<y;S++){const C=t[S],k=C.z*m;this.verts[b++]=C.nx,this.verts[b++]=0,this.verts[b++]=-C.ny,this.verts[b++]=C.r,this.verts[b++]=C.g,this.verts[b++]=C.b,this.verts[b++]=.22,this.verts[b++]=C.nx,this.verts[b++]=k,this.verts[b++]=-C.ny,this.verts[b++]=C.r,this.verts[b++]=C.g,this.verts[b++]=C.b,this.verts[b++]=.7}this.upload(l,this.verts,v),this.setAttribs(l),l.uniform1f(l.getUniformLocation(this.prg,"u_ptSize"),1),l.drawArrays(l.LINES,0,v),this.verts.length<y*dl&&(this.verts=new Float32Array((y+200)*dl)),b=0;for(let S=0;S<y;S++){const C=t[S],k=C.z*m;this.verts[b++]=C.nx,this.verts[b++]=k,this.verts[b++]=-C.ny,this.verts[b++]=C.r,this.verts[b++]=C.g,this.verts[b++]=C.b,this.verts[b++]=.92}this.upload(l,this.verts,y),this.setAttribs(l),l.uniform1f(l.getUniformLocation(this.prg,"u_ptSize"),r.ptSize??5.5),l.drawArrays(l.POINTS,0,y)}drawGrid(t,r,o){const l=new Float32Array(44*dl);let i=0;const u=(c,d,h,f)=>{for(const[g,m]of[[c,d],[h,f]])l[i++]=g,l[i++]=0,l[i++]=m,l[i++]=.18,l[i++]=.16,l[i++]=.28,l[i++]=.3};for(let c=0;c<=10;c++){const d=c/10*2-1;u(d,-1,d,1),u(-1,d,1,d)}this.upload(t,l,44),this.setAttribs(t),t.uniform1f(t.getUniformLocation(this.prg,"u_ptSize"),1),t.drawArrays(t.LINES,0,44)}drawTerrain(t,r,o){const{w:s,h:l,heights:i}=r,u=(s-1)*l+s*(l-1),c=new Float32Array(u*2*dl);let d=0;const h=(f,g)=>{const m=f/(s-1)*2-1,y=g/(l-1)*2-1,v=i[g*s+f]*o,b=i[g*s+f];c[d++]=m,c[d++]=v,c[d++]=-y,c[d++]=.15+b*.25,c[d++]=.2+b*.5,c[d++]=.45+b*.3,c[d++]=.28+b*.22};for(let f=0;f<l;f++)for(let g=0;g<s-1;g++)h(g,f),h(g+1,f);for(let f=0;f<s;f++)for(let g=0;g<l-1;g++)h(f,g),h(f,g+1);this.upload(t,c,u*2),this.setAttribs(t),t.uniform1f(t.getUniformLocation(this.prg,"u_ptSize"),1),t.drawArrays(t.LINES,0,u*2)}upload(t,r,o){t.bindBuffer(t.ARRAY_BUFFER,this.buf),t.bufferData(t.ARRAY_BUFFER,r.subarray(0,o*dl),t.DYNAMIC_DRAW)}setAttribs(t){const r=this.prg,o=dl*4,s=t.getAttribLocation(r,"a_pos"),l=t.getAttribLocation(r,"a_col"),i=t.getAttribLocation(r,"a_alpha");t.enableVertexAttribArray(s),t.vertexAttribPointer(s,3,t.FLOAT,!1,o,0),t.enableVertexAttribArray(l),t.vertexAttribPointer(l,3,t.FLOAT,!1,o,12),t.enableVertexAttribArray(i),t.vertexAttribPointer(i,1,t.FLOAT,!1,o,24)}dispose(){const t=this.gl;t&&(this.prg&&t.deleteProgram(this.prg),this.buf&&t.deleteBuffer(this.buf),this.prg=null,this.buf=null)}}function f$(e){const t=Math.sin(e.yaw)*Math.cos(e.pitch)*e.dist+e.panX,r=Math.sin(e.pitch)*e.dist,o=Math.cos(e.yaw)*Math.cos(e.pitch)*e.dist+e.panY;return[t,r,o]}function tR(e,t,r){const o=t*Math.min(r,1-r),s=l=>{const i=(l+e*12)%12;return r-o*Math.max(-1,Math.min(Math.min(i-3,9-i),1))};return[s(0),s(8),s(4)]}function p$(e,t){if(e===255)return[.85,.85,.3];const r=e/Math.max(1,t)*.83+.04;return tR(r,.75,.6)}function n0(e,t,r){return e<t?t:e>r?r:e}function m$(e,t,r,o,s,l){switch(l){case"speed":return n0(Math.sqrt(e*e+t*t)*2.5,0,1);case"energy":return n0(r,0,1);case"geneA":return o;case"geneB":return o;case"age":return n0(s/8e3,0,1);default:return .4}}function g$(e,t,r,o,s,l){switch(l){case"coherence":return e;case"arousal":return t;case"charge":return r;case"inhibition":return o;case"valence":return(s+1)*.5;default:return .4}}const rS={complexityLife:[{id:"speed",label:"Velocidade"},{id:"energy",label:"Energia"},{id:"geneA",label:"Gene A"},{id:"age",label:"Idade"}],sociogenesis:[{id:"speed",label:"Velocidade"},{id:"prestige",label:"Prestgio"},{id:"meme",label:"Meme"}],psycheLab:[{id:"coherence",label:"Coerncia"},{id:"arousal",label:"Excitao"},{id:"charge",label:"Carga"},{id:"inhibition",label:"Inibio"},{id:"valence",label:"Valncia"}]},y$=[{id:"default",label:"Default"},{id:"topology",label:"Topologia"},{id:"energy",label:"Energia"},{id:"valence",label:"Valncia"},{id:"coherence",label:"Coerncia"}],oS=({on:e,label:t,color:r,onClick:o})=>a.jsx("button",{onClick:o,className:`text-[8px] font-mono px-1.5 py-0.5 transition-all ${e?"":"text-white/30 hover:text-white/50"}`,style:e?{color:r,border:`1px dashed ${r}44`,background:r+"0c"}:{border:"1px dashed transparent"},children:t}),nR=({activeLab:e,config:t,onChange:r,onReset:o})=>{const s=rS[e]??rS.complexityLife,l=e==="psycheLab";return a.jsxs("div",{className:`fixed bottom-4 left-1/2 -translate-x-1/2 z-30 pointer-events-auto
        flex items-center gap-2.5 px-3 py-2`,style:{background:"rgba(0,0,0,0.94)",border:"1px dashed rgba(255,255,255,0.06)",flexWrap:"wrap",maxWidth:"90vw"},children:[a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx("span",{className:"text-[8px] uppercase tracking-widest text-white/25",children:"Altura"}),a.jsx("select",{value:t.zVar,onChange:i=>r({zVar:i.target.value}),className:"text-white/70 text-[9px] font-mono px-1.5 py-1 focus:outline-none cursor-pointer",style:{background:"rgba(255,255,255,0.03)",border:"1px dashed rgba(255,255,255,0.06)"},children:s.map(i=>a.jsx("option",{value:i.id,className:"bg-[#07050e]",children:i.label},i.id))})]}),a.jsx("div",{className:"w-px h-4 bg-white/10"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-[8px] uppercase tracking-widest text-white/25",children:"Z"}),a.jsx("input",{type:"range",min:.1,max:1.4,step:.05,value:t.zScale,onChange:i=>r({zScale:parseFloat(i.target.value)}),className:`w-16 h-px bg-white/15 appearance-none cursor-pointer
            [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3
            [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:bg-white/60
            [&::-webkit-slider-thumb]:bg-purple-300/80`}),a.jsx("span",{className:"text-[9px] font-mono text-white/35 w-6",children:t.zScale.toFixed(2)})]}),a.jsx("div",{className:"w-px h-4 bg-white/10"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-[8px] uppercase tracking-widest text-white/25",children:"Pt"}),a.jsx("input",{type:"range",min:2,max:12,step:.5,value:t.ptSize??5.5,onChange:i=>r({ptSize:parseFloat(i.target.value)}),className:`w-12 h-px bg-white/15 appearance-none cursor-pointer
            [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3
            [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:bg-white/60
            [&::-webkit-slider-thumb]:bg-cyan-300/80`}),a.jsx("span",{className:"text-[9px] font-mono text-white/35 w-5",children:(t.ptSize??5.5).toFixed(1)})]}),a.jsx("div",{className:"w-px h-4 bg-white/10"}),a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx("span",{className:"text-[8px] uppercase tracking-widest text-white/25",children:"Modo"}),["particles","terrain","hybrid"].map(i=>a.jsx("button",{onClick:()=>r({mode:i}),className:"text-[8px] px-2 py-0.5 font-mono transition-all",style:t.mode===i?{background:"rgba(139,92,246,0.10)",color:"#a78bfa",border:"1px dashed rgba(139,92,246,0.30)"}:{color:"rgba(255,255,255,0.25)",border:"1px dashed transparent"},children:i==="particles"?"Pts":i==="terrain"?"Terreno":"Hbrido"},i))]}),a.jsx("div",{className:"w-px h-4 bg-white/10"}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-[8px] uppercase tracking-widest text-white/25 mr-0.5",children:"Vis"}),a.jsx(oS,{on:!!t.showTrails,label:"Rastros",color:"#a78bfa",onClick:()=>r({showTrails:!t.showTrails})}),a.jsx(oS,{on:!!t.showBonds,label:"Bonds",color:"#67e8f9",onClick:()=>r({showBonds:!t.showBonds})})]}),t.showTrails&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-px h-4 bg-white/10"}),a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx("span",{className:"text-[8px] text-white/25",children:"Len"}),a.jsx("input",{type:"range",min:4,max:32,step:2,value:t.trailLen??14,onChange:i=>r({trailLen:parseInt(i.target.value)}),className:`w-12 h-px bg-white/15 appearance-none cursor-pointer
                [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3
                [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:bg-white/60
                [&::-webkit-slider-thumb]:bg-purple-300/70`}),a.jsx("span",{className:"text-[9px] font-mono text-white/35 w-4",children:t.trailLen??14})]})]}),l&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-px h-4 bg-white/10"}),a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx("span",{className:"text-[8px] uppercase tracking-widest text-white/25",children:"Cor"}),a.jsx("select",{value:t.colorScheme3D??"default",onChange:i=>r({colorScheme3D:i.target.value}),className:"text-white/70 text-[9px] font-mono px-1.5 py-1 focus:outline-none cursor-pointer",style:{background:"rgba(255,255,255,0.03)",border:"1px dashed rgba(255,255,255,0.06)"},children:y$.map(i=>a.jsx("option",{value:i.id,className:"bg-[#07050e]",children:i.label},i.id))})]})]}),a.jsx("div",{className:"w-px h-4 bg-white/10"}),a.jsxs("button",{onClick:o,className:`flex items-center gap-1 text-[8px] text-white/30 hover:text-white/60
          transition-colors px-1 py-0.5`,title:"Resetar cmera",children:[a.jsx(Wi,{size:10}),a.jsx("span",{children:"Cmera"})]})]})},aS={CALM:"#93c5fd",ALERT:"#fde047",PANIC:"#f87171",FLOW:"#86efac",FRAGMENTED:"#fdba74",INTEGRATING:"#c4b5fd"},x$=[[.96,.78,.26],[.69,.77,.87],[.49,.23,.93],[.96,.25,.37],[.52,.8,.09],[.23,.51,.96],[.96,.62,.07],[.42,.44,.63],[.39,.4,.95],[.02,.71,.83],[.93,.28,.6],[.94,.27,.27]],b$=({active:e,viewMode:t="2D",view3DConfig:r,onView3DConfigChange:o})=>{const s=w.useRef(null),l=w.useRef(V6(600)),i=w.useRef(ry()),u=w.useRef(0),c=w.useRef(0),d=w.useRef(!0),h=w.useRef({...L5}),f=w.useRef({active:!1,lastX:0,lastY:0}),g=w.useRef(new Set),[m,y]=w.useState(1),[v,b]=w.useState(!1),S=w.useRef(null),[C,k]=w.useState("idle"),[R,j]=w.useState(0);w.useEffect(()=>(S.current=new Nh(k),()=>{var U;return(U=S.current)==null?void 0:U.dispose()}),[]),w.useEffect(()=>{if(C!=="recording"){j(0);return}const U=setInterval(()=>{var je;j(((je=S.current)==null?void 0:je.elapsed)??0)},500);return()=>clearInterval(U)},[C]);const T=w.useCallback(U=>{var X;const je=l.current,W=sS(G);(X=S.current)==null||X.start(()=>[t==="3D"?P.current:s.current],()=>({labName:"Psyche Lab",lines:[`fase: ${je.phase}    quanta: ${je.count}`,`integrao: ${(je.integrationIndex*100).toFixed(0)}%  tenso: ${(je.tensionIndex*100).toFixed(0)}%  frag: ${(je.fragmentationIndex*100).toFixed(0)}%`,`lens: ${i.current.lens}    preset: ${W}`,`dana: ${i.current.danceIntensity.toFixed(2)}    arq.: ${je.archetypeActive.filter(Boolean).length} ativos`]}),30,void 0,{format:(U==null?void 0:U.format)??"auto",quality:(U==null?void 0:U.quality)??"standard"})},[t]),_=w.useCallback(()=>{var U;(U=S.current)==null||U.stop()},[]),P=w.useRef(null),I=w.useRef(null),$=w.useRef({active:!1,lastX:0,lastY:0,shift:!1}),q=w.useRef(r??Td);w.useEffect(()=>{r&&(q.current=r)},[r]);const[L,H]=w.useState("TOPOLOGY"),[G,oe]=w.useState("mandala-calm"),[le,pe]=w.useState(!0),[ce,te]=w.useState(!1),[F,Q]=w.useState(.22),[ae,we]=w.useState(600),[Re,ge]=w.useState(!1),[Ae,tt]=w.useState(!0),[We,J]=w.useState(!1),[ke,Le]=w.useState(!1),[K,et]=w.useState(!1),[dt,Rt]=w.useState(!0),[Wt,Zt]=w.useState(!0),[$e,Ze]=w.useState("#000000"),[Fe,Xe]=w.useState(.06),[jt,hn]=w.useState(.65),[an,it]=w.useState(3),[kt,On]=w.useState(1),[sn,Xn]=w.useState(.8),[Pt,zt]=w.useState(i.current.flowGain),[jn,En]=w.useState(i.current.springK),[lt,ht]=w.useState(i.current.linkRadius),[_t,Ie]=w.useState(i.current.breathPeriod),[at,St]=w.useState(i.current.damping),[ye,xe]=w.useState(i.current.stateRelaxRate??1),[gt,Ge]=w.useState(i.current.frozenFlow??!1),[Ye,Ve]=w.useState(i.current.soulVis??0),[Oe,Gt]=w.useState(l.current.phase),[Kt,fn]=w.useState(0),[zn,rt]=w.useState(0),[mt,yt]=w.useState(0),[Et,Ft]=w.useState({eros:0,thanatos:0,repressao:0,idPower:.2,superegoForce:.15,egoStrength:.5,sublimacao:0}),[me,cn]=w.useState({real:.25,simbolico:.35,imaginario:.4,gozo:0,falta:.5,sujeito:0}),[Xt,Dt]=w.useState([...l.current.archetypeStrength]),[ne,Ne]=w.useState([...l.current.archetypeActive]),[Ke,Ct]=w.useState(0),[ft,At]=w.useState(""),[bt,nn]=w.useState([]),Bt=w.useRef("CALM"),[Jt,Qt]=w.useState(!1),en=w.useRef(0);w.useEffect(()=>(l.current,()=>{}),[]),w.useEffect(()=>{const U=P.current;if(!U)return;I.current=new Tv(U);const je=window.innerWidth,W=window.innerHeight;return I.current.resize(je,W),()=>{var X;(X=I.current)==null||X.dispose(),I.current=null}},[]),w.useEffect(()=>{const U=()=>{var je;(je=I.current)==null||je.resize(window.innerWidth,window.innerHeight)};return window.addEventListener("resize",U),()=>window.removeEventListener("resize",U)},[]),w.useEffect(()=>{const U=P.current;if(!U)return;const je=He=>{$.current={active:!0,lastX:He.clientX,lastY:He.clientY,shift:He.shiftKey}},W=He=>{if(!$.current.active)return;const he=He.clientX-$.current.lastX,fe=He.clientY-$.current.lastY;$.current.lastX=He.clientX,$.current.lastY=He.clientY;const be=q.current;let Ee;$.current.shift||He.shiftKey?Ee={...be,camera:{...be.camera,panX:be.camera.panX+he*.002,panY:be.camera.panY+fe*.002}}:Ee={...be,camera:{...be.camera,yaw:be.camera.yaw+he*.008,pitch:n0(be.camera.pitch+fe*.008,.04,Math.PI/2-.04)}},q.current=Ee,o==null||o(Ee)},X=()=>{$.current.active=!1},Te=He=>{He.preventDefault();const he=q.current,fe={...he,camera:{...he.camera,dist:n0(he.camera.dist*(1+He.deltaY*.001),.5,8)}};q.current=fe,o==null||o(fe)};return U.addEventListener("mousedown",je),U.addEventListener("mousemove",W),U.addEventListener("mouseup",X),U.addEventListener("mouseleave",X),U.addEventListener("wheel",Te,{passive:!1}),()=>{U.removeEventListener("mousedown",je),U.removeEventListener("mousemove",W),U.removeEventListener("mouseup",X),U.removeEventListener("mouseleave",X),U.removeEventListener("wheel",Te)}},[o]),w.useEffect(()=>{const U=s.current;if(!U)return;const je=W=>{if(t==="3D")return;W.preventDefault();const X=U.getBoundingClientRect(),Te=W.clientX-X.left-X.width/2,He=W.clientY-X.top-X.height/2,he=h.current,fe=W.deltaY>0?1/1.12:1.12,be=Math.max(.12,Math.min(14,he.zoom*fe)),Ee=be/he.zoom,Me=Te+(he.panX-Te)*Ee,_e=He+(he.panY-He)*Ee;h.current={zoom:be,panX:Me,panY:_e},y(be),b(Math.abs(Me)>2||Math.abs(_e)>2)};return U.addEventListener("wheel",je,{passive:!1}),()=>U.removeEventListener("wheel",je)},[t]),w.useEffect(()=>{const U=s.current;if(!U)return;const je=Te=>{t!=="3D"&&(f.current={active:!0,lastX:Te.clientX,lastY:Te.clientY},U.style.cursor="grabbing")},W=Te=>{if(!f.current.active)return;const He=Te.clientX-f.current.lastX,he=Te.clientY-f.current.lastY;f.current.lastX=Te.clientX,f.current.lastY=Te.clientY,h.current={...h.current,panX:h.current.panX+He,panY:h.current.panY+he},b(!0)},X=()=>{f.current.active=!1,U.style.cursor="grab";const{panX:Te,panY:He}=h.current;b(Math.abs(Te)>2||Math.abs(He)>2)};return U.addEventListener("mousedown",je),window.addEventListener("mousemove",W),window.addEventListener("mouseup",X),U.addEventListener("mouseleave",X),()=>{U.removeEventListener("mousedown",je),window.removeEventListener("mousemove",W),window.removeEventListener("mouseup",X),U.removeEventListener("mouseleave",X)}},[t]),w.useEffect(()=>{const U=W=>{var He;const X=(He=document.activeElement)==null?void 0:He.tagName;if(X==="INPUT"||X==="TEXTAREA"||X==="SELECT"||t==="3D")return;const Te=W.key.toLowerCase();["w","a","s","d"].includes(Te)&&(g.current.add(Te),W.preventDefault()),Te==="r"&&(h.current={...L5},y(1),b(!1))},je=W=>{g.current.delete(W.key.toLowerCase())};return window.addEventListener("keydown",U),window.addEventListener("keyup",je),()=>{window.removeEventListener("keydown",U),window.removeEventListener("keyup",je)}},[t]);const vn=w.useCallback(()=>{h.current={...L5},y(1),b(!1)},[]),Wn=w.useCallback((U,je)=>{nn(W=>{const X={text:U,color:je,time:l.current.elapsed};return[...W.slice(-19),X]})},[]),Gn=w.useCallback(()=>{const U=I.current;if(!(U!=null&&U.isReady))return;const je=l.current,W=q.current,X=[],Te=W.colorScheme3D??"default";for(let he=0;he<je.count;he++){const fe=g$(je.coherence[he],je.arousal[he],je.charge[he],je.inhibition[he],je.valence[he],W.zVar),be=je.tag[he];let Ee=.5,Me=.4,_e=.8;if(Te==="default")if(be>0&&be<=12)[Ee,Me,_e]=x$[be-1];else{const Je=je.coherence[he];Ee=Je*.9,Me=Je*.6+.1,_e=.4+Je*.4}else if(Te==="energy"){const Je=(200-je.charge[he]*160)/360,Vt=.5+je.arousal[he]*.5,rn=.35+je.charge[he]*.3;[Ee,Me,_e]=tR(Je,Vt,rn)}else if(Te==="valence")je.valence[he]>=0?(Ee=.1,Me=.3+je.valence[he]*.5,_e=.15):(Ee=.3+-je.valence[he]*.5,Me=.1,_e=.1);else if(Te==="coherence")Ee=.1+je.coherence[he]*.2,Me=.1+je.coherence[he]*.3,_e=.25+je.coherence[he]*.5;else if(Te==="topology"){const Je=je.x[he],Vt=je.y[he];Math.sqrt(Je*Je+Vt*Vt)<.14?(Ee=.96,Me=.78,_e=.26):Vt<-.3?(Ee=.61,Me=.72,_e=.97):Vt>.45?(Ee=.94,Me=.27,_e=.27):(Ee=.49,Me=.23,_e=.93,_e=.6)}X.push({nx:je.x[he],ny:je.y[he],z:fe,r:Ee,g:Me,b:_e})}const He=[];if(W.showBonds)for(let he=0;he<je.linkCount;he++)He.push({a:je.linkA[he],b:je.linkB[he]});U.render(X,W,void 0,W.showBonds?He:[])},[]);w.useEffect(()=>{if(!e){cancelAnimationFrame(u.current);return}const U=je=>{if(u.current=requestAnimationFrame(U),!s.current)return;const W=Math.min(.05,(je-c.current)/1e3);c.current=je;const X=l.current,Te=i.current;if(d.current&&(fB(X,Te,W),X.journeyActive&&xB(X,W,He=>{Ct(He.act),At(`Ato ${He.act+1}: ${He.name}`)},He=>At(He)),je-en.current>450)){gB(X),en.current=je,Gt(X.phase),fn(X.integrationIndex),rt(X.tensionIndex),yt(X.fragmentationIndex);let He=0,he=0,fe=0,be=0,Ee=0,Me=0,_e=0;for(let st=0;st<X.count;st++){const $t=X.y[st],Tt=X.charge[st],Ut=X.inhibition[st],ln=X.valence[st],wt=Math.max(0,ln);He+=wt*Tt*(1-Ut),he+=Ut*(1-wt)*Tt,fe+=Ut,$t>.28?be++:$t<-.3?Ee++:(Me++,_e+=X.coherence[st])}const Je=X.count||1,Vt=X.integrationIndex,rn=Math.min(1,He/Je*2.5);Ft({eros:rn,thanatos:Math.min(1,he/Je*3),repressao:Math.min(1,fe/Je),idPower:be/Je,superegoForce:Ee/Je,egoStrength:Me>0?_e/Me:0,sublimacao:Math.min(1,rn*Vt*1.4)});let pn=0,re=0,de=0,Se=0;for(let st=0;st<X.count;st++){const $t=X.x[st],Tt=X.y[st],Ut=Math.sqrt($t*$t+Tt*Tt),ln=Tt>.4||Ut>.75?"R":Tt<-.35||Math.abs($t)>.3&&Tt<-.1?"S":"I";ln==="R"?(pn++,Se+=X.charge[st]*X.arousal[st]):ln==="S"?re++:de++}const qe=Math.min(1,X.linkCount/Math.max(1,xh*.3));cn({real:pn/Je,simbolico:Math.min(1,re/Je*.7+qe*.3),imaginario:de/Je,gozo:pn>0?Math.min(1,Se/pn):0,falta:1-X.integrationIndex,sujeito:X.fragmentationIndex}),X.phase!==Bt.current&&(Wn(`Fase  ${X.phase}`,aS[X.phase]),Bt.current=X.phase)}if(t!=="3D"&&g.current.size>0){const He=4.5/h.current.zoom,he=h.current;let{panX:fe,panY:be}=he;g.current.has("a")&&(fe+=He),g.current.has("d")&&(fe-=He),g.current.has("w")&&(be+=He),g.current.has("s")&&(be-=He),h.current={...he,panX:fe,panY:be}}t!=="3D"&&$B(s.current,X,Te.lens,Re,sS(G),{rastrosOn:We,campoOn:ke,fieldOn:K,bondsOn:dt,overlayOn:Wt,trailFade:Fe,trailOpacity:jt,trailWidth:an,soulVis:Ye,bondWidth:kt,bondOpacity:sn,bgColor:$e},h.current),t==="3D"&&Gn()};return c.current=performance.now(),u.current=requestAnimationFrame(U),()=>cancelAnimationFrame(u.current)},[e,Re,G,We,ke,K,dt,Wt,Fe,jt,an,t,Gn,$e]),w.useEffect(()=>{i.current.lens=L},[L]);const cr=w.useCallback(U=>{const je=qB(U);if(!je)return;const W=l.current,X=i.current;Object.assign(X,ry(),je.config),X.lens=L,X.archetypesOn=le;const Te=je.quantaCount??600;if(U6(W,Te,X),we(Te),je.archetypeActive)for(let He=0;He<12;He++)W.archetypeActive[He]=je.archetypeActive.includes(Ad[He]);if(je.archetypeStrengths)for(let He=0;He<12;He++){const he=je.archetypeStrengths[Ad[He]];he!==void 0&&(W.archetypeStrength[He]=he)}Dt([...W.archetypeStrength]),Ne([...W.archetypeActive]),Q(X.danceIntensity),zt(X.flowGain),En(X.springK),ht(X.linkRadius),Ie(X.breathPeriod),St(X.damping),xe(X.stateRelaxRate??1),Ge(X.frozenFlow??!1),Ve(X.soulVis??0),je.journeyMode||(K6(W),te(!1)),oe(U),Wn(`Preset: ${je.name}`,"#c4b5fd")},[L,le,Wn]);w.useEffect(()=>{cr("mandala-calm")},[]);const pr=w.useCallback(U=>{const je=l.current,W=i.current;for(let Te=0;Te<12;Te++){const He=Ad[Te];je.archetypeActive[Te]=He in U.archetypeWeights,je.archetypeStrength[Te]=U.archetypeWeights[He]??.15}const X=ry();Object.assign(W,X,U.configMods),W.lens=L,W.archetypesOn=le,Dt([...je.archetypeStrength]),Ne([...je.archetypeActive]),U.configMods.danceIntensity!=null&&Q(U.configMods.danceIntensity),zt(W.flowGain),En(W.springK),ht(W.linkRadius),Ie(W.breathPeriod),Z6(),nn([]),Wn(` "${U.name}"  ${U.description.slice(0,60)}`,U.color),oe("")},[L,le,Wn]),br=()=>{d.current=!d.current,tt(d.current)},hr=()=>{Object.assign(l.current,V6(ae)),Z6(),nn([]),Bt.current="CALM",cr(G||"mandala-calm")},or=()=>{const U=!le;pe(U),i.current.archetypesOn=U},uo=()=>{const U=l.current;ce?(K6(U),te(!1),At("")):(vB(U),te(!0),Ct(0),At("Ato 1: Descent  a jornada comea."),Wn(" Red Book Journey iniciado.","#c4b5fd"))},fr=U=>{U6(l.current,U,i.current),we(U)},Tr=U=>{i.current.danceIntensity=U,i.current.maxSpeed=.18*(U/.2),Q(U)},Ir=U=>{i.current.lens=U,H(U)},jo=(U,je)=>{l.current.archetypeStrength[U]=je,Dt(W=>{const X=[...W];return X[U]=je,X})},bo=U=>{l.current.archetypeActive[U]=!l.current.archetypeActive[U],Ne(je=>{const W=[...je];return W[U]=l.current.archetypeActive[U],W})},vo=U=>{i.current.flowGain=U,zt(U)},Zo=U=>{i.current.springK=U,En(U)},Jo=U=>{i.current.linkRadius=U,ht(U)},Ua=U=>{i.current.breathPeriod=U,Ie(U)},Na=U=>{i.current.damping=U,St(U)},sa=U=>{i.current.stateRelaxRate=U,xe(U)},So=()=>{const U=!i.current.frozenFlow;i.current.frozenFlow=U,Ge(U)},Oo=U=>{i.current.soulVis=U,Ve(U)};return a.jsxs("div",{style:{display:e?"block":"none"},className:"fixed inset-0 z-0",children:[a.jsx("canvas",{ref:s,className:"w-full h-full block",style:{background:$e,display:t==="3D"?"none":"block",cursor:f.current.active?"grabbing":"grab"}}),a.jsx("canvas",{ref:P,className:"absolute inset-0 w-full h-full",style:{display:t==="3D"?"block":"none",pointerEvents:t==="3D"?"auto":"none",cursor:"grab",background:"#000"}}),t==="3D"&&a.jsx(nR,{activeLab:"psycheLab",config:r??q.current,onChange:U=>{const je={...q.current,...U};q.current=je,o==null||o(je)},onReset:()=>{q.current={...Td},o==null||o({...Td})}}),t!=="3D"&&a.jsxs("div",{style:{position:"fixed",bottom:14,right:14,zIndex:30,display:"flex",flexDirection:"column",alignItems:"flex-end",gap:5,pointerEvents:"none",userSelect:"none"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"3px 10px",background:"rgba(0,0,0,0.92)",border:"1px dashed rgba(255,255,255,0.06)"},children:[a.jsx("span",{style:{fontFamily:"'Doto', monospace",fontSize:8,color:"rgba(255,255,255,0.22)",letterSpacing:"0.1em",textTransform:"uppercase"},children:"zoom"}),a.jsxs("span",{style:{fontFamily:"'IBM Plex Mono', monospace",fontSize:9,color:"#8b5cf690"},children:[m.toFixed(2),""]}),v&&a.jsx("span",{style:{fontFamily:"'IBM Plex Mono', monospace",fontSize:8,color:"rgba(255,255,255,0.22)"},children:"pan"})]}),(Math.abs(m-1)>.02||v)&&a.jsx("button",{onClick:vn,style:{pointerEvents:"auto",padding:"3px 10px",fontFamily:"'IBM Plex Mono', monospace",fontSize:8,letterSpacing:"0.08em",textTransform:"uppercase",background:"rgba(139,92,246,0.06)",border:"1px dashed rgba(139,92,246,0.22)",color:"rgba(139,92,246,0.65)",cursor:"pointer",transition:"all 0.15s"},children:"[R] reset view"}),a.jsx("div",{style:{padding:"2px 8px",background:"rgba(0,0,0,0.80)",border:"1px dashed rgba(255,255,255,0.04)"},children:a.jsx("span",{style:{fontFamily:"'IBM Plex Mono', monospace",fontSize:7,color:"rgba(255,255,255,0.14)"},children:"scroll=zoom  drag=pan  wasd=navegar"})})]}),!Re&&t!=="3D"&&a.jsx(JB,{presetId:G,lens:L,archetypesOn:le,journeyOn:ce,journeyAct:Ke,journeyChapter:ft,quantaCount:ae,danceIntensity:F,phase:Oe,integrationIndex:Kt,tensionIndex:zn,fragmentIndex:mt,archetypeStrengths:Xt,archetypeActive:ne,flowGain:Pt,springK:jn,linkRadius:lt,breathPeriod:_t,trailOn:We,campoOn:ke,fieldOn:K,narrativeLog:bt,onPresetChange:cr,onLensChange:Ir,onArchetypesToggle:or,onJourneyToggle:uo,onQuantaChange:fr,onDanceChange:Tr,onFlowGainChange:vo,onSpringKChange:Zo,onLinkRadiusChange:Jo,onBreathPeriodChange:Ua,onArchStrengthChange:jo,onArchActiveToggle:bo,onCinematicToggle:()=>ge(U=>!U),cinematicMode:Re,onTrailToggle:()=>J(U=>!U),onCampoToggle:()=>Le(U=>!U),onFieldToggle:()=>et(U=>!U),bondsOn:dt,onBondsToggle:()=>Rt(U=>!U),overlayOn:Wt,onOverlayToggle:()=>Zt(U=>!U),bgColor:$e,onBgColorChange:Ze,trailFade:Fe,trailOpacity:jt,trailWidth:an,onTrailFadeChange:Xe,onTrailOpacityChange:hn,onTrailWidthChange:it,bondWidth:kt,bondOpacity:sn,onBondWidthChange:On,onBondOpacityChange:Xn,running:Ae,onToggleRun:br,onReset:hr,onOpenConsciousness:()=>Qt(!0),freudMetrics:Et,lacanMetrics:me,damping:at,stateRelaxRate:ye,frozenFlow:gt,soulVis:Ye,onDampingChange:Na,onStateRelaxChange:sa,onFrozenFlowToggle:So,onSoulVisChange:Oo}),t==="3D"&&a.jsxs("div",{style:{position:"fixed",top:50,left:"50%",transform:"translateX(-50%)",zIndex:20,pointerEvents:"none",display:"flex",alignItems:"center",gap:12,padding:"5px 16px",background:"rgba(0,0,0,0.92)",border:"1px dashed rgba(255,255,255,0.06)"},children:[a.jsx("span",{style:{fontFamily:"'Doto', monospace",fontSize:8,color:"rgba(255,255,255,0.25)",letterSpacing:"0.1em",textTransform:"uppercase"},children:"Psyche 3D"}),a.jsxs("span",{style:{fontFamily:"'IBM Plex Mono', monospace",fontSize:8,color:aS[Oe]+"aa"},children:[Oe,"  ",l.current.count," quanta"]}),a.jsxs("span",{style:{fontFamily:"'IBM Plex Mono', monospace",fontSize:8,color:"rgba(255,255,255,0.18)"},children:["Z: ",(r==null?void 0:r.zVar)??"coherence"]}),a.jsx("span",{style:{fontFamily:"'IBM Plex Mono', monospace",fontSize:8,color:"rgba(255,255,255,0.14)",fontStyle:"italic"},children:"drag=rbita  shift+drag=pan  roda=zoom"})]}),Re&&t!=="3D"&&a.jsx("button",{onClick:()=>ge(!1),style:{position:"fixed",top:50,right:10,zIndex:30,fontFamily:"'IBM Plex Mono', monospace",fontSize:9,color:"rgba(255,255,255,0.18)",background:"none",border:"none",cursor:"pointer",letterSpacing:"0.08em",textTransform:"uppercase",transition:"color 0.15s"},children:"[H] show HUD"}),Jt&&a.jsx(s$,{onClose:()=>Qt(!1),onInvoke:pr}),a.jsx(Pp,{state:C,elapsed:R,onStart:T,onStop:_,className:"fixed bottom-4 left-4 z-40"})]})};function sS(e){var t;return((t=cg.find(r=>r.id===e))==null?void 0:t.name)??"Psyche Lab"}const v$="modulepreload",S$=function(e){return"/"+e},iS={},gl=function(t,r,o){let s=Promise.resolve();if(r&&r.length>0){let i=function(d){return Promise.all(d.map(h=>Promise.resolve(h).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),c=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));s=i(r.map(d=>{if(d=S$(d),d in iS)return;iS[d]=!0;const h=d.endsWith(".css"),f=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${f}`))return;const g=document.createElement("link");if(g.rel=h?"stylesheet":v$,h||(g.as="script"),g.crossOrigin="",g.href=d,c&&g.setAttribute("nonce",c),document.head.appendChild(g),h)return new Promise((m,y)=>{g.addEventListener("load",m),g.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${d}`)))})}))}function l(i){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=i,window.dispatchEvent(u),!u.defaultPrevented)throw i}return s.then(i=>{for(const u of i||[])u.status==="rejected"&&l(u.reason);return t().catch(l)})},py=.12,jc=.72;function Qm(e){return Math.abs(e)<py?0:(e-Math.sign(e)*py)/(1-py)}function bh(){return{a:!1,b:!1,x:!1,y:!1,lb:!1,rb:!1,start:!1,select:!1,dpadUp:!1,dpadDown:!1,dpadLeft:!1,dpadRight:!1,l3:!1,r3:!1}}function lS(){return{connected:!1,name:"",axes:{lx:0,ly:0,rx:0,ry:0},triggers:{lt:0,rt:0},buttons:bh(),justPressed:bh(),justReleased:bh()}}const cS=[[0,"a"],[1,"b"],[2,"x"],[3,"y"],[4,"lb"],[5,"rb"],[8,"select"],[9,"start"],[10,"l3"],[11,"r3"],[12,"dpadUp"],[13,"dpadDown"],[14,"dpadLeft"],[15,"dpadRight"]];class w${constructor(){this.padIndex=-1,this.prevButtons={},this._state=lS(),this.smoothLx=0,this.smoothLy=0,this.smoothRx=0,this.smoothRy=0,this.repeatTimers={},this.REPEAT_INITIAL=400,this.REPEAT_RATE=160,this.hapticCount=0,this.hapticResetTime=0,this.HAPTIC_BUDGET=10}poll(t=performance.now()){const r=navigator.getGamepads?navigator.getGamepads():[];let o=null;if(this.padIndex>=0&&(o=r[this.padIndex]??null),!o||!o.connected){this.padIndex=-1;for(const v of r)if(v&&v.connected){o=v,this.padIndex=v.index;break}}if(!o||!o.connected)return this._state=lS(),this._state;const s=Qm(o.axes[0]??0),l=Qm(o.axes[1]??0),i=Qm(o.axes[2]??0),u=Qm(o.axes[3]??0);this.smoothLx=this.smoothLx*jc+s*(1-jc),this.smoothLy=this.smoothLy*jc+l*(1-jc),this.smoothRx=this.smoothRx*jc+i*(1-jc),this.smoothRy=this.smoothRy*jc+u*(1-jc);const c=v=>{var b;return!!((b=o.buttons[v])!=null&&b.pressed)},d=v=>{var b;return((b=o.buttons[v])==null?void 0:b.value)??0},h=bh();for(const[v,b]of cS)h[b]=c(v);const f=Math.max(d(6),o.axes[4]!==void 0?(o.axes[4]+1)/2:0),g=Math.max(d(7),o.axes[5]!==void 0?(o.axes[5]+1)/2:0),m=bh(),y=bh();for(const[,v]of cS){const b=h[v],S=this.prevButtons[v]??!1;m[v]=b&&!S,y[v]=!b&&S,this.prevButtons[v]=b}return this._state={connected:!0,name:o.id,axes:{lx:this.smoothLx,ly:this.smoothLy,rx:this.smoothRx,ry:this.smoothRy},triggers:{lt:f,rt:g},buttons:h,justPressed:m,justReleased:y},this._state}get current(){return this._state}rumble(t,r,o=.5,s=.5){const l=performance.now();if(l-this.hapticResetTime>1e3&&(this.hapticCount=0,this.hapticResetTime=l),this.hapticCount>=this.HAPTIC_BUDGET)return;this.hapticCount++;const i=navigator.getGamepads?navigator.getGamepads():[],u=this.padIndex>=0?i[this.padIndex]:null;if(!u)return;const c=u.vibrationActuator;if(c)try{c.playEffect("dual-rumble",{startDelay:0,duration:r,weakMagnitude:s*t,strongMagnitude:o*t})}catch{}}}let my=null;function Iv(){return my||(my=new w$),my}function gy({value:e,color:t="rgba(80,230,140,0.8)",label:r}){return a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginBottom:3},children:[a.jsx("span",{style:{width:60,fontSize:9,color:"rgba(255,255,255,0.38)",textTransform:"uppercase",letterSpacing:"0.08em",textAlign:"right"},children:r}),a.jsx("div",{style:{width:60,height:4,background:"rgba(255,255,255,0.1)",borderRadius:2},children:a.jsx("div",{style:{width:`${Math.min(1,Math.max(0,e))*100}%`,height:"100%",background:t,borderRadius:2}})})]})}const rR=({ctrl:e,toolName:t,presetName:r,radius:o,intensity:s,quantaCount:l,showHUD:i})=>!e.connected||!i?null:a.jsxs("div",{style:{position:"absolute",bottom:48,left:10,background:"rgba(4,6,12,0.82)",border:"1px solid rgba(80,230,140,0.18)",borderRadius:6,padding:"8px 12px",pointerEvents:"none",zIndex:40,backdropFilter:"blur(4px)"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginBottom:7,borderBottom:"1px solid rgba(255,255,255,0.07)",paddingBottom:5},children:[a.jsx("div",{style:{width:6,height:6,borderRadius:"50%",background:"rgba(80,230,140,0.8)",flexShrink:0}}),a.jsx("span",{style:{fontSize:8,color:"rgba(80,230,140,0.7)",letterSpacing:"0.1em"},children:e.name.slice(0,20)})]}),a.jsx("div",{style:{fontSize:10,color:"rgba(255,255,255,0.8)",letterSpacing:"0.06em",marginBottom:6},children:t.toUpperCase()}),a.jsx(gy,{value:s,color:"rgba(80,230,140,0.8)",label:"RT"}),a.jsx(gy,{value:e.triggers.lt,color:"rgba(200,100,80,0.8)",label:"LT"}),a.jsx(gy,{value:o,color:"rgba(140,160,255,0.8)",label:"RAIO"}),a.jsx("div",{style:{marginTop:6,fontSize:8,color:"rgba(255,255,255,0.3)",letterSpacing:"0.06em"},children:r.slice(0,22)}),l!==void 0&&a.jsxs("div",{style:{fontSize:8,color:"rgba(255,255,255,0.2)",fontFamily:"monospace",marginTop:2},children:["Q ",l]}),a.jsx("div",{style:{marginTop:8,display:"flex",flexDirection:"column",gap:2},children:[["LB / RB","ferramenta"],["D  ","preset"],["Y","snapshot"],["A","HUD on/off"],["SEL","cinem."]].map(([u,c])=>a.jsxs("div",{style:{display:"flex",gap:5,alignItems:"center"},children:[a.jsx("span",{style:{fontSize:7,color:"rgba(200,180,100,0.7)",minWidth:36,textAlign:"right",fontFamily:"monospace"},children:u}),a.jsx("span",{style:{fontSize:7,color:"rgba(255,255,255,0.25)"},children:c})]},u))})]});function oR({open:e,onClose:t,ctrl:r,presetsSection:o,toolsSection:s}){const l=[o,s],[i,u]=w.useState(0),[c,d]=w.useState(0),h=w.useRef({dpadUp:!1,dpadDown:!1,dpadLeft:!1,dpadRight:!1,a:!1,b:!1,start:!1});return w.useEffect(()=>{e&&(d(0),u(0))},[e]),w.useEffect(()=>{if(!e)return;const f=h.current,g=r.buttons;if(g.dpadUp&&!f.dpadUp&&d(m=>Math.max(0,m-1)),g.dpadDown&&!f.dpadDown&&d(m=>{var y;return Math.min((((y=l[i])==null?void 0:y.items.length)??1)-1,m+1)}),g.dpadLeft&&!f.dpadLeft&&(u(m=>Math.max(0,m-1)),d(0)),g.dpadRight&&!f.dpadRight&&(u(m=>Math.min(l.length-1,m+1)),d(0)),g.a&&!f.a){const m=l[i];m&&(m.onSelect(m.items[c]),t())}(g.b&&!f.b||g.start&&!f.start)&&t(),h.current={dpadUp:g.dpadUp,dpadDown:g.dpadDown,dpadLeft:g.dpadLeft,dpadRight:g.dpadRight,a:g.a,b:g.b,start:g.start}},[r,e]),e?a.jsxs("div",{style:{position:"fixed",inset:0,zIndex:200,background:"rgba(4,6,12,0.88)",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(6px)"},children:[a.jsx("div",{style:{display:"flex",gap:32,maxHeight:"80vh"},children:l.map((f,g)=>a.jsxs("div",{style:{minWidth:180,background:i===g?"rgba(255,255,255,0.04)":"transparent",borderRadius:8,padding:"14px 8px",border:i===g?"1px solid rgba(80,230,140,0.25)":"1px solid rgba(255,255,255,0.06)"},children:[a.jsx("div",{style:{fontSize:9,color:i===g?"rgba(80,230,140,0.8)":"rgba(255,255,255,0.3)",letterSpacing:"0.16em",textTransform:"uppercase",marginBottom:10,paddingLeft:8},children:f.label}),a.jsx("div",{style:{overflowY:"auto",maxHeight:"65vh"},children:f.items.map((m,y)=>{const v=g===i&&y===c;return a.jsx("div",{onClick:()=>{f.onSelect(m),t()},style:{padding:"7px 10px",cursor:"pointer",borderRadius:5,background:v?"rgba(80,230,140,0.15)":"transparent",color:v?"rgba(255,255,255,0.95)":"rgba(255,255,255,0.45)",fontSize:11,letterSpacing:"0.04em",borderLeft:v?"2px solid rgba(80,230,140,0.6)":"2px solid transparent",transition:"all 0.1s"},children:f.getLabel(m)},y)})})]},g))}),a.jsx("div",{style:{position:"absolute",bottom:24,left:"50%",transform:"translateX(-50%)",display:"flex",gap:20},children:[["D  ","coluna"],["D  ","item"],["A","selecionar"],["B / START","fechar"]].map(([f,g])=>a.jsxs("div",{style:{display:"flex",gap:4,alignItems:"center"},children:[a.jsx("span",{style:{fontSize:10,color:"rgba(200,180,100,0.8)",fontFamily:"monospace"},children:f}),a.jsx("span",{style:{fontSize:9,color:"rgba(255,255,255,0.3)"},children:g})]},f))})]}):null}const Gc={major:[0,2,4,5,7,9,11],minor:[0,2,3,5,7,8,10],pentatonic:[0,2,4,7,9],blues:[0,3,5,6,7,10],dorian:[0,2,3,5,7,9,10],phrygian:[0,1,3,5,7,8,10],lydian:[0,2,4,6,7,9,11],mixolydian:[0,2,4,5,7,9,10],whole_tone:[0,2,4,6,8,10],harmonic_minor:[0,2,3,5,7,8,11],chromatic:[0,1,2,3,4,5,6,7,8,9,10,11]},mo={KICK:"#ff3b5c",BASS:"#ff8c00",PERC:"#00e5ff",PAD:"#9b59ff",LEAD:"#39ff70",ARP:"#00d4c8",STRINGS:"#ffd700",CHOIR:"#ff69b4"},dg={KICK:0,BASS:28,PERC:190,PAD:270,LEAD:135,ARP:175,STRINGS:48,CHOIR:330};function C$(e){return 440*Math.pow(2,(e-69)/12)}function Vc(e,t,r){const o=Gc[r],s=Math.floor((e-t)/12),l=((e-t)%12+12)%12;let i=o[0],u=12;for(const c of o){const d=Math.abs(c-l);d<u&&(u=d,i=c)}return t+s*12+i}function aR(e,t){const r=((t-e)%12+12)%12;return{0:1,7:.9,5:.8,4:.7,3:.65,9:.65,2:.35,10:.35,8:.3,6:.15,1:.1,11:.1}[r]??.2}const Ja={damping:.962,cohesion:1.3,separation:1.1,maxSpeed:.38,gravityX:0,gravityY:0,turbulence:.28,mutationRate:.1,energyTransfer:.38,entainment:.45,predatorPrey:!1,motionStyle:"swarm",alignment:.8,zoneRadius:.18,vortexForce:0,burstRate:.3,migrationX:0,migrationY:1,clusterTarget:6,polarize:.5},dS={KICK:{BASS:-.04,PERC:-.03},BASS:{KICK:.06,LEAD:.018},PERC:{KICK:-.025},LEAD:{BASS:.045,ARP:-.02},PAD:{CHOIR:.018},ARP:{LEAD:.032,STRINGS:.015},STRINGS:{PAD:.025,CHOIR:.018},CHOIR:{STRINGS:.02}};function z5(){const e=["KICK","BASS","PERC","PAD","LEAD","ARP","STRINGS","CHOIR"],t={};for(const r of e){t[r]={};for(const o of e)t[r][o]=0}return t}const cb={mode:"role",bgColor:"#050810",accent:"#00d4ff",roleColorOverrides:{}},qc=()=>Math.random(),Br=()=>(Math.random()-.5)*2;function M$(e){let t=1/0,r=-1/0,o=1/0,s=-1/0;for(const[i,u]of e.pts)i<t&&(t=i),i>r&&(r=i),u<o&&(o=u),u>s&&(s=u);const l=[t,r,o,s];return e._bb=l,l}function k$(e){let t=2166136261;for(let r=0;r<e.length;r++)t^=e.charCodeAt(r),t=Math.imul(t,16777619);return t>>>0}function R$(e){let t=e>>>0;return()=>{t|=0,t=t+1831565813|0;let r=Math.imul(t^t>>>15,1|t);return r=r+Math.imul(r^r>>>7,61|r)^r,((r^r>>>14)>>>0)/4294967296}}const Ii=(e,t,r)=>Math.max(t,Math.min(r,e)),Fr=e=>(e()-.5)*2;function uS(e,t,r,o,s,l,i,u){const c=r-e,d=o-t,h=i-s,f=u-l,g=c*f-d*h;if(Math.abs(g)<1e-10)return!1;const m=((s-e)*f-(l-t)*h)/g,y=((s-e)*d-(l-t)*c)/g;return m>=0&&m<=1&&y>=0&&y<=1}function hS(e,t,r){return[Math.cos(t*2.4+r*.4)*.5+Math.cos(e*2.4*.7+r*.7)*.5,Math.sin(e*2.4+r*.4)*.5+Math.sin(t*2.4*.7+r*.7)*.5]}function A$(e){const t=[],r=Object.values(e.roles).reduce((o,s)=>o+s.proportion,0);for(const[o,s]of Object.entries(e.roles)){const l=Math.max(1,Math.round(s.proportion/r*64));for(let i=0;i<l;i++)t.push(o)}return t}function ug(e,t,r,o,s,l=qc){const i=t.roles[r],u=(i==null?void 0:i.pitchRange)??[48,84],c=Vc(Math.round(u[0]+l()*(u[1]-u[0])),t.root,t.scale),d=o??Fr(l)*.82,h=s??Fr(l)*.82;return{id:e,role:r,x:d,y:h,vx:Fr(l)*.028,vy:Fr(l)*.028,prevX:d,prevY:h,phase:l(),pitch:c,brightness:.3+l()*.5,charge:.2+l()*.5,hue:dg[r],cooldown:l()*1.2,trailX:[],trailY:[],age:0,dischargeTimer:0,recentlyFired:0,selected:!1,mutations:0,phaseLocked:-1,roleLockTimer:0,timbreIdx:-1}}function j$(e,t){const r=[],o=e.gateCount??0;if(o<=0)return r;const s=new Set((e.tags??[]).map(String)),i=s.has("Experimental")||s.has("Dark")||e.intensity>=4?["gate","gate","mirror","mirror","absorber","membrane","membrane"]:["gate","gate","gate","mirror"],u={gate:[e.primary,e.secondary,e.accent,"#fff"],mirror:["#c8e8ff","#d8f0ff","#a8d8ef"],absorber:["#dd3333","#cc1111","#ff4444"],membrane:["#dd66ff","#cc44ff","#aa22ee"]};for(let c=0;c<o;c++){const d=i[Math.floor(t()*i.length)],h=Fr(t)*.62,f=Fr(t)*.62,g=t()*Math.PI,m=.1+t()*.55;r.push({x1:h-Math.cos(g)*m,y1:f-Math.sin(g)*m,x2:h+Math.cos(g)*m,y2:f+Math.sin(g)*m,cooldown:0,color:u[d][c%u[d].length],type:d})}return r}function E$(e,t){const r=[],o=e.attractorCount??0;if(o<=0)return r;const s=new Set((e.tags??[]).map(String)),i=s.has("Techno")||s.has("Club")||s.has("Groove")||s.has("Breakbeat")||e.bpm>=118?["metro","attractor","attractor","vortex","repulsor"]:["attractor","attractor","vortex","repulsor"];r.push({x:0,y:0,strength:.06+t()*.1,vortexStr:0,radius:.65+t()*.35,type:"attractor"});for(let u=1;u<o;u++){const c=i[Math.floor(t()*i.length)],d=Fr(t)*.78,h=Fr(t)*.78,f=.04+t()*.2,g=.18+t()*.65;c==="vortex"?r.push({x:d,y:h,strength:0,vortexStr:f*(.55+t()*.45),radius:g,type:"vortex"}):c==="repulsor"?r.push({x:d,y:h,strength:-f,vortexStr:0,radius:g,type:"repulsor"}):c==="metro"?r.push({x:d,y:h,strength:f*(.8+t()*.6),vortexStr:0,radius:g,type:"metro"}):r.push({x:d,y:h,strength:f,vortexStr:0,radius:g,type:"attractor"})}return r}function T$(e,t,r,o){const s=e.motionStyle;if(r<=0)return null;switch(s){case"orbit":{const l=t/r*Math.PI*2+Fr(o)*.35,i=.35+o()*.18;return[Math.cos(l)*i,Math.sin(l)*i]}case"lattice":{const l=Math.max(3,Math.round(Math.sqrt(r))),i=t%l/(l-1)*2-1,u=Math.floor(t/l)/(l-1)*2-1;return[i*.72+Fr(o)*.03,u*.72+Fr(o)*.03]}case"meditation":case"drift":return[Fr(o)*.22,Fr(o)*.22];case"migration":case"exodus":{const l=Math.floor(o()*4),i=Fr(o)*.78;return l===0?[-.92,i]:l===1?[.92,i]:l===2?[i,-.92]:[i,.92]}case"ballistic":return[Fr(o)*.85,.85+o()*.25];default:return null}}function I$(e,t,r){if(t.id==="blank-canvas"||t.quantaCount<=0)return;const o=new Set((t.tags??[]).map(String)),s=o.has("Techno")||o.has("Club")||o.has("Groove")||o.has("Breakbeat")||o.has("Rave")||t.bpm>=118,l=o.has("Experimental")||o.has("Space")||t.name.toLowerCase().includes("quantum"),i=o.has("Strings")||o.has("Orchestral")||o.has("Choral"),u=o.has("Minimalist")||t.id==="solo-particle"||t.quantaCount<=2;if(!u&&(t.motionStyle==="flow"||t.motionStyle==="drift"||t.motionStyle==="migration"||t.motionStyle==="exodus")&&r()<.85){const g=[],m=Fr(r)*.55,y=Fr(r)*.55,v=r()*Math.PI*2,b=Math.cos(v),S=Math.sin(v),C=6+Math.floor(r()*10);for(let k=0;k<C;k++){const R=k/Math.max(1,C-1),j=m+b*(R-.5)*1.1+Fr(r)*.06,T=y+S*(R-.5)*1.1+Fr(r)*.06;g.push([Ii(j,-.95,.95),Ii(T,-.95,.95),b,S])}e.channels.push({id:Math.floor(r()*1e5),pts:g,strength:.45+r()*.45,radius:.1+r()*.1,color:t.secondary})}const c=u?0:s?2:1;for(let g=0;g<c;g++){const m=Fr(r)*.55,y=Fr(r)*.55,v=r()*Math.PI,b=.18+r()*.55;e.rails.push({x1:m-Math.cos(v)*b,y1:y-Math.sin(v)*b,x2:m+Math.cos(v)*b,y2:y+Math.sin(v)*b,strength:.25+r()*.55,color:t.accent})}if(l&&r()<.85){const g=1+(s?1:0)+(r()<.35?1:0);for(let m=0;m<g;m++){const y=Fr(r)*.85,v=Fr(r)*.85,b=Fr(r)*.85,S=Fr(r)*.85;e.tunnels.push({id:Math.floor(r()*1e5),ax:y,ay:v,bx:b,by:S,radius:.05+r()*.06,color:m%2===0?t.primary:t.accent,cd:0})}}if((i||s)&&r()<.55){const g=r()<.35,m=Fr(r)*.35,y=Fr(r)*.35,v=.55+r()*.55,b=.45+r()*.55,S=.28+r()*.3,C=g?{id:Math.floor(r()*1e5),shape:"circle",x:m,y,w:v,h:b,r:S,elasticity:.75+r()*.2,color:"#00ffcc"}:{id:Math.floor(r()*1e5),shape:"rect",x:m,y,w:v,h:b,r:Math.max(v,b)/2,elasticity:.75+r()*.2,color:"#00ffcc"};e.cages.push(C)}const d=i?2+Math.floor(r()*2):!u&&r()<.25?1:0;for(let g=0;g<d;g++){const m=Fr(r)*.65,y=Fr(r)*.65,v=r()*Math.PI,b=.18+r()*.7;e.strings.push({id:Math.floor(r()*1e5),x1:m-Math.cos(v)*b,y1:y-Math.sin(v)*b,x2:m+Math.cos(v)*b,y2:y+Math.sin(v)*b,tension:r(),vibAmp:0,vibPhase:0,decay:.55+r()*.55,color:"#ffd700",lastHit:99})}const h=t.intensity>=4?3:t.intensity>=2?2:1,f=s?["pulse_beat","compress_zone","excite_zone","glitch","scatter_zone","harmonize_zone"]:o.has("Ambient")||o.has("Meditative")?["slow","tremolo","warp","harmonize_zone","freeze_zone"]:["vortex_zone","density_wave","phase_lock","harmonize_zone","transpose","scatter_zone"];for(let g=0;g<h;g++){const m=f[Math.floor(r()*f.length)],y=Fr(r)*.65,v=Fr(r)*.65,b=.2+r()*.4,S=.18+r()*.35,C=[[Ii(y-b,-.95,.95),Ii(v-S,-.95,.95)],[Ii(y+b,-.95,.95),Ii(v-S,-.95,.95)],[Ii(y+b,-.95,.95),Ii(v+S,-.95,.95)],[Ii(y-b,-.95,.95),Ii(v+S,-.95,.95)]],k={id:Math.floor(r()*1e5),pts:C,effect:m,strength:.35+r()*.6,param:r(),color:t.accent};e.fxZones.push(k)}if(s&&r()<.85){const g=r()<.55?16:8,m=r()<.5?1:2;e.sequencer={...e.sequencer,active:!0,x:Fr(r)*.75,y:Fr(r)*.75,ringR:.18+r()*.34,tempoMult:m,steps:Array.from({length:g},(y,v)=>({armed:r()<.25+t.intensity*.08||v%4===0,pitchOff:Math.floor((r()-.5)*10),vel:.35+r()*.65,role:null})),stepCd:new Array(g).fill(0)}}}function e5(e,t){const r=(t==null?void 0:t.variation)??Math.random(),o=(k$(e.id)^Math.floor(Ii(r,0,1)*4294967295))>>>0,s=R$(o),l=A$(e),i=[];for(let c=0;c<e.quantaCount;c++){const d=T$(e,c,e.quantaCount,s),h=d?ug(c,e,l[c%l.length],d[0],d[1],s):ug(c,e,l[c%l.length],void 0,void 0,s),f=e.motionStyle,g=f==="meditation"?.18:f==="drift"?.35:f==="orbit"?.65:f==="lattice"?.55:f==="ballistic"?.85:e.intensity<=1?.45:e.intensity>=4?1.1:.75;h.vx*=g,h.vy*=g,i.push(h)}const u={quanta:i,count:e.quantaCount,gates:j$(e,s),attractors:E$(e,s),ripples:[],emergent:[],channels:[],rails:[],tunnels:[],cages:[],strings:[],fxZones:[],userMatrix:z5(),sequencer:{active:!1,x:0,y:0,ringR:.42,steps:Array.from({length:8},(c,d)=>({armed:d%2===0,pitchOff:0,vel:.65,role:null})),cursor:0,tempoMult:1,triggerR:.15,stepCd:new Array(8).fill(0)},elapsed:0,tick:0,bpm:e.bpm,beatPhase:0,barPhase:0,lastBeatTime:0,syncIntensity:0,roleEnergy:{}};return I$(u,e,s),u}function Vl(e,t,r){e.ripples.length>28||e.ripples.push({x:t.x,y:t.y,r:0,maxR:.08+qc()*.08,alpha:.7,color:r,thick:1.2+t.velocity*2})}function Bf(e){return Math.max(.05,e.attack+e.decay+e.sustain*1.5)}function P$(e,t,r,o,s){if(o<=0||o>.1)return;e.elapsed+=o,e.tick++;const l=60/e.bpm;e.beatPhase=e.elapsed/l%1,e.barPhase=e.elapsed/(l*4)%1;const i=e.count;for(let c=0;c<i;c++){const d=e.quanta[c];d.prevX=d.x,d.prevY=d.y,d.age+=o,d.cooldown>0&&(d.cooldown-=o),d.recentlyFired>0&&(d.recentlyFired-=o),d.roleLockTimer>0&&(d.roleLockTimer-=o),d.phase=(d.phase+(.5+d.brightness*2)*o)%1,d.charge+=(.5-d.charge)*o*.12;let h=0,f=0;if(r.motionStyle==="ballistic"||r.bounceWalls?(h+=r.gravityX,f+=r.gravityY):(h+=r.gravityX*.15*o,f+=r.gravityY*.15*o),r.turbulence>0){const[m,y]=hS(d.x,d.y,e.elapsed);h+=m*r.turbulence*.06,f+=y*r.turbulence*.06}if(e.channels.length>0)for(const m of e.channels){let y=m.radius,v=0,b=0;for(const[S,C,k,R]of m.pts){const j=d.x-S,T=d.y-C,_=Math.sqrt(j*j+T*T);_<y&&(y=_,v=k,b=R)}if(y<m.radius){const S=(1-y/m.radius)*m.strength;h+=v*S*.055,f+=b*S*.055}}for(const m of e.rails){const y=m.x2-m.x1,v=m.y2-m.y1,b=y*y+v*v;if(b<1e-4)continue;const S=Math.max(0,Math.min(1,((d.x-m.x1)*y+(d.y-m.y1)*v)/b)),C=m.x1+S*y,k=m.y1+S*v,R=C-d.x,j=k-d.y,T=Math.sqrt(R*R+j*j)+.001;if(T>.5)continue;const _=m.strength*.06/(T*T*2+.008);h+=R/T*_,f+=j/T*_}switch(r.motionStyle??t.motionStyle){case"orbit":{const m=Math.sqrt(d.x*d.x+d.y*d.y)+.001,y=.38+c%5*.08,v=.08+r.vortexForce;h+=-d.y/m*v,f+=d.x/m*v,h+=d.x/m*(y-m)*.22,f+=d.y/m*(y-m)*.22;break}case"swarm":{const m=r.zoneRadius,y=m*m;let v=0,b=0,S=0,C=0,k=0;for(let R=0;R<i;R++){if(R===c)continue;const j=e.quanta[R].x-d.x,T=e.quanta[R].y-d.y,_=j*j+T*T;_<y&&(v+=e.quanta[R].x,b+=e.quanta[R].y,S+=e.quanta[R].vx,C+=e.quanta[R].vy,k++,_<y*.22&&(h-=j*r.separation*2,f-=T*r.separation*2))}k>0&&(h+=(v/k-d.x)*r.cohesion*.38,f+=(b/k-d.y)*r.cohesion*.38,h+=(S/k-d.vx)*r.alignment*.2,f+=(C/k-d.vy)*r.alignment*.2),h+=Br()*.035,f+=Br()*.035;break}case"flow":{const m=d.x*2.1+d.y*1.7+e.elapsed*.4;h+=Math.cos(m)*(.055+r.turbulence*.03),f+=Math.sin(m)*(.055+r.turbulence*.03);break}case"drift":{h+=Br()*(.018+r.turbulence*.04),f+=Br()*(.018+r.turbulence*.04);break}case"spiral":{const m=Math.sqrt(d.x*d.x+d.y*d.y)+.001,y=.1+r.vortexForce;h+=-d.y/m*y+-d.x/m*.025,f+=d.x/m*y+-d.y/m*.025;break}case"lattice":{const m=Math.max(.04,r.zoneRadius*.9),y=Math.round(d.x/m)*m,v=Math.round(d.y/m)*m;h+=(y-d.x)*1.1,f+=(v-d.y)*1.1;break}case"murmuration":{const m=r.zoneRadius,y=m*m,v=m*.3;let b=0,S=0,C=0,k=0,R=0,j=0,T=0,_=0;for(let P=0;P<i;P++){if(P===c)continue;const I=e.quanta[P].x-d.x,$=e.quanta[P].y-d.y,q=I*I+$*$;if(q>y)continue;const L=Math.sqrt(q)+.001;L<v?(j-=I/L*(v-L)/v,T-=$/L*(v-L)/v,_++):(b+=e.quanta[P].vx,S+=e.quanta[P].vy,C+=e.quanta[P].x,k+=e.quanta[P].y,R++)}_>0&&(h+=j/_*r.separation*3,f+=T/_*r.separation*3),R>0&&(h+=(b/R-d.vx)*r.alignment*.5,f+=(S/R-d.vy)*r.alignment*.5,h+=(C/R-d.x)*r.cohesion*.28,f+=(k/R-d.y)*r.cohesion*.28),h+=Br()*.012*r.turbulence,f+=Br()*.012*r.turbulence;break}case"school":{const m=r.zoneRadius,y=m*m;let v=0,b=0,S=0,C=0,k=0,R=0,j=0,T=0,_=0;for(let I=0;I<i;I++){if(I===c)continue;const $=e.quanta[I].x-d.x,q=e.quanta[I].y-d.y,L=$*$+q*q;if(L>y)continue;const H=Math.sqrt(L)+.001;H<m*.25?(v-=$/H,b-=q/H,j++):H<m*.6?(S+=e.quanta[I].vx,C+=e.quanta[I].vy,T++):(k+=e.quanta[I].x,R+=e.quanta[I].y,_++)}j>0&&(h+=v/j*r.separation*3,f+=b/j*r.separation*3),T>0&&(h+=(S/T-d.vx)*r.alignment*.6,f+=(C/T-d.vy)*r.alignment*.6),_>0&&(h+=(k/_-d.x)*r.cohesion*.35,f+=(R/_-d.y)*r.cohesion*.35);const P=Math.sqrt(d.vx*d.vx+d.vy*d.vy)+.001;h+=d.vx/P*(r.maxSpeed*.55-P)*.35,f+=d.vy/P*(r.maxSpeed*.55-P)*.35;break}case"war":{const m=c%2===0;for(let y=0;y<i;y++){if(y===c)continue;const v=e.quanta[y].x-d.x,b=e.quanta[y].y-d.y,S=v*v+b*b;if(S>r.zoneRadius*r.zoneRadius||S<1e-4)continue;const C=Math.sqrt(S),k=y%2===0;m&&!k&&(h+=v/C*r.cohesion*.45,f+=b/C*r.cohesion*.45),!m&&k&&(h-=v/C*r.separation*.55,f-=b/C*r.separation*.55),m===k&&S<.04&&(h-=v/C*r.separation*1.5,f-=b/C*r.separation*1.5)}h+=Br()*.022*r.turbulence,f+=Br()*.022*r.turbulence;break}case"polarization":{for(let m=0;m<i;m++){if(m===c)continue;const y=e.quanta[m],v=y.x-d.x,b=y.y-d.y,S=v*v+b*b;if(S>r.zoneRadius*r.zoneRadius||S<1e-4)continue;const C=Math.sqrt(S),k=Math.abs((d.phase-y.phase+1.5)%1-.5)*2;k<.4?(h+=v/C*r.cohesion*r.polarize*.42,f+=b/C*r.cohesion*r.polarize*.42):k>.6&&(h-=v/C*r.separation*r.polarize*.42,f-=b/C*r.separation*r.polarize*.42)}h+=Br()*.014,f+=Br()*.014;break}case"revolution":{const m=Math.sqrt(d.x*d.x+d.y*d.y)+.001;h+=-d.y/m*r.vortexForce,f+=d.x/m*r.vortexForce,h+=-d.x/m*(.035+r.cohesion*.018),f+=-d.y/m*(.035+r.cohesion*.018),d.charge>.75&&(h+=d.x/m*r.burstRate*.28,f+=d.y/m*r.burstRate*.28),h+=Br()*r.turbulence*.02,f+=Br()*r.turbulence*.02;break}case"explosion":{const m=Math.sqrt(d.x*d.x+d.y*d.y)+.001;(e.elapsed*r.burstRate+d.phase*.5)%1<.15?(h+=d.x/m*.38,f+=d.y/m*.38):(h+=-d.x*r.cohesion*.28,f+=-d.y*r.cohesion*.28);for(let v=c+1;v<Math.min(i,c+20);v++){const b=e.quanta[v].x-d.x,S=e.quanta[v].y-d.y,C=b*b+S*S;if(C<.04&&C>1e-4){const k=Math.sqrt(C);h-=b/k*r.separation*.5,f-=S/k*r.separation*.5}}break}case"carnival":{for(let y=0;y<3;y++){const v=e.elapsed*.45+y/3*Math.PI*2,b=Math.cos(v)*.38,S=Math.sin(v)*.38,C=b-d.x,k=S-d.y,R=Math.sqrt(C*C+k*k)+.01;R<.5&&(h+=C/R*r.cohesion*.32,f+=k/R*r.cohesion*.32,h+=-k/R*r.vortexForce,f+=C/R*r.vortexForce)}h+=Br()*r.turbulence*.04,f+=Br()*r.turbulence*.04;break}case"jazz":{const m=Math.max(1,Math.ceil(i/Math.max(2,r.clusterTarget))),y=c%m;let v=0,b=0,S=0;for(let C=0;C<i;C++)C%m===y&&(v+=e.quanta[C].x,b+=e.quanta[C].y,S++);S>1&&(h+=(v/S-d.x)*r.cohesion*.55,f+=(b/S-d.y)*r.cohesion*.55);for(let C=0;C<i;C++){if(C===c||C%m===y)continue;const k=e.quanta[C].x-d.x,R=e.quanta[C].y-d.y,j=k*k+R*R;if(j<.07&&j>.001){const T=Math.sqrt(j);h-=k/T*r.separation*.35,f-=R/T*r.separation*.35}}h+=Br()*r.turbulence*.058,f+=Br()*r.turbulence*.058;break}case"organism":{const m=Math.sqrt(d.x*d.x+d.y*d.y)+.001,y=.28*(1+Math.sin(e.elapsed*r.burstRate*3+c*.08)*.35);h+=d.x/m*(y-m)*r.cohesion*1.6,f+=d.y/m*(y-m)*r.cohesion*1.6;const v=r.zoneRadius*.5,b=v*v;for(let S=0;S<i;S++){if(S===c)continue;const C=e.quanta[S].x-d.x,k=e.quanta[S].y-d.y,R=C*C+k*k;if(R<b&&R>1e-4){const j=Math.sqrt(R);h-=C/j*r.separation*.75,f-=k/j*r.separation*.75}}break}case"exodus":{const m=Math.sqrt(r.migrationX*r.migrationX+r.migrationY*r.migrationY)+.001;h+=r.migrationX/m*r.maxSpeed*.14,f+=r.migrationY/m*r.maxSpeed*.14;const y=r.zoneRadius,v=y*y;let b=0,S=0,C=0;for(let k=0;k<i;k++){if(k===c)continue;const R=e.quanta[k].x-d.x,j=e.quanta[k].y-d.y;R*R+j*j<v&&(b+=e.quanta[k].vx,S+=e.quanta[k].vy,C++)}C>0&&(h+=(b/C-d.vx)*r.alignment*.4,f+=(S/C-d.vy)*r.alignment*.4),h+=Br()*.01*r.turbulence,f+=Br()*.01*r.turbulence;break}case"dance":{let m=r.zoneRadius*3,y=0,v=0;for(let k=0;k<i;k++){if(k===c)continue;const R=e.quanta[k].x-d.x,j=e.quanta[k].y-d.y,T=Math.sqrt(R*R+j*j);T<m&&(m=T,y=e.quanta[k].x,v=e.quanta[k].y)}const b=y-d.x,S=v-d.y,C=Math.sqrt(b*b+S*S)+.001;C>.07&&C<r.zoneRadius*3&&(h+=b/C*r.cohesion*.5,f+=S/C*r.cohesion*.5),h+=-S/C*r.vortexForce*(c%2===0?1:-1),f+=b/C*r.vortexForce*(c%2===0?1:-1),C<.06&&(h-=b/C*r.separation,f-=S/C*r.separation);break}case"chaos":{h+=Br()*r.turbulence*.14,f+=Br()*r.turbulence*.14,Math.random()<r.burstRate*.009&&(h+=Br()*r.burstRate*.12,f+=Br()*r.burstRate*.12),r.cohesion>0&&(h+=-d.x*r.cohesion*.018,f+=-d.y*r.cohesion*.018);break}case"ballistic":break;case"meditation":{const[m,y]=hS(d.x,d.y,e.elapsed*.12);h+=m*.014,f+=y*.014;const v=Math.sqrt(d.x*d.x+d.y*d.y)+.001,b=.38+c%7*.055;h+=-d.y/v*r.vortexForce*.35,f+=d.x/v*r.vortexForce*.35,h+=d.x/v*(b-v)*r.cohesion*.12,f+=d.y/v*(b-v)*r.cohesion*.12;break}case"migration":{const m=Math.sqrt(r.migrationX*r.migrationX+r.migrationY*r.migrationY)+.001;h+=r.migrationX/m*.11,f+=r.migrationY/m*.11;const y=r.zoneRadius,v=y*y;let b=0,S=0,C=0;for(let k=0;k<i;k++){if(k===c)continue;const R=e.quanta[k].x-d.x,j=e.quanta[k].y-d.y;R*R+j*j<v&&(b+=e.quanta[k].vx,S+=e.quanta[k].vy,C++)}C>0&&(h+=(b/C-d.vx)*r.alignment*.55,f+=(S/C-d.vy)*r.alignment*.55);for(let k=0;k<i;k++){if(k===c)continue;const R=e.quanta[k].x-d.x,j=e.quanta[k].y-d.y,T=R*R+j*j;if(T<.04&&T>1e-4){const _=Math.sqrt(T);h-=R/_*r.separation*.45,f-=j/_*r.separation*.45}}break}case"predation":{const m=dS[d.role];for(let S=0;S<i;S++){if(S===c)continue;const C=e.quanta[S],k=m?m[C.role]:void 0;if(!k)continue;const R=C.x-d.x,j=C.y-d.y,T=R*R+j*j;if(T<r.zoneRadius*r.zoneRadius&&T>1e-4){const _=Math.sqrt(T);h+=R/_*k*r.polarize*2.2,f+=j/_*k*r.polarize*2.2}}let y=0,v=0,b=0;for(let S=0;S<i;S++){if(S===c||e.quanta[S].role!==d.role)continue;const C=e.quanta[S].x-d.x,k=e.quanta[S].y-d.y;C*C+k*k<r.zoneRadius*r.zoneRadius&&(y+=e.quanta[S].vx,v+=e.quanta[S].vy,b++)}b>0&&(h+=(y/b-d.vx)*r.alignment*.32,f+=(v/b-d.vy)*r.alignment*.32),h+=Br()*r.turbulence*.022,f+=Br()*r.turbulence*.022;break}case"cells":{const m=Math.max(1,Math.ceil(i/Math.max(2,r.clusterTarget))),y=c%m,v=Math.sin(e.elapsed*r.burstRate*2+y*1.4),b=.055+Math.abs(v)*.09;let S=0,C=0,k=0;for(let R=0;R<i;R++)R%m===y&&(S+=e.quanta[R].x,C+=e.quanta[R].y,k++);if(k>0){const R=d.x-S/k,j=d.y-C/k,T=Math.sqrt(R*R+j*j)+.001;h+=R/T*(b-T)*r.cohesion*2.6,f+=j/T*(b-T)*r.cohesion*2.6}for(let R=0;R<i;R++){if(R===c||R%m===y)continue;const j=e.quanta[R].x-d.x,T=e.quanta[R].y-d.y,_=j*j+T*T;if(_<.06&&_>1e-4){const P=Math.sqrt(_);h-=j/P*r.separation*1.25,f-=T/P*r.separation*1.25}}break}}for(const m of e.attractors){const y=m.x-d.x,v=m.y-d.y,b=y*y+v*v;if(b<m.radius*m.radius&&b>1e-4){const S=Math.sqrt(b);if(m.type==="metro"){const C=Math.max(0,Math.cos(e.elapsed*(e.bpm/60)*Math.PI*2)),k=m.strength*C*C*2;h+=y/S*k,f+=v/S*k}else h+=y/S*m.strength,f+=v/S*m.strength,h+=-v/S*m.vortexStr,f+=y/S*m.vortexStr}}if(e.userMatrix&&e.tick%2===0){const y=e.userMatrix[d.role];if(y)for(let v=0;v<i;v++){if(v===c)continue;const b=e.quanta[v],S=y[b.role]??0;if(Math.abs(S)<.008)continue;const C=b.x-d.x,k=b.y-d.y,R=C*C+k*k;if(R>.09||R<4e-4)continue;const j=Math.sqrt(R),T=S*.08/(j+.025);h+=C/j*T,f+=k/j*T}}if(r.predatorPrey&&e.tick%2===0){const m=dS[d.role];if(m)for(let y=0;y<i;y++){if(y===c)continue;const v=e.quanta[y],b=m[v.role];if(!b)continue;const S=v.x-d.x,C=v.y-d.y,k=S*S+C*C;if(k>.001&&k<.22){const R=Math.sqrt(k);h+=S/R*b,f+=C/R*b}}}d.vx=(d.vx+h*o)*Math.pow(r.damping,o*60),d.vy=(d.vy+f*o)*Math.pow(r.damping,o*60);const g=Math.sqrt(d.vx*d.vx+d.vy*d.vy);g>r.maxSpeed&&(d.vx=d.vx/g*r.maxSpeed,d.vy=d.vy/g*r.maxSpeed),d.x+=d.vx*o*30,d.y+=d.vy*o*30;for(const m of e.tunnels){if(m.cd>0){m.cd-=o;continue}const y=d.x-m.ax,v=d.y-m.ay;if(y*y+v*v<m.radius*m.radius){const b=Math.sqrt(d.vx*d.vx+d.vy*d.vy),S=Math.atan2(m.by-m.ay,m.bx-m.ax);d.x=m.bx+(Math.random()-.5)*.01,d.y=m.by+(Math.random()-.5)*.01,d.vx=Math.cos(S)*b,d.vy=Math.sin(S)*b,m.cd=.25,d.recentlyFired=.6,Vl(e,{pitch:d.pitch,velocity:.7,role:d.role,x:m.bx,y:m.by},m.color);break}}if(r.bounceWalls||r.motionStyle==="ballistic"){const y=r.restitution??.82;d.x>.97&&(d.x=.97,d.vx=-Math.abs(d.vx)*y),d.x<-.97&&(d.x=-.97,d.vx=Math.abs(d.vx)*y),d.y>.97&&(d.y=.97,d.vy=-Math.abs(d.vy)*y),d.y<-.97&&(d.y=-.97,d.vy=Math.abs(d.vy)*y)}else d.x>1&&(d.x-=2),d.x<-1&&(d.x+=2),d.y>1&&(d.y-=2),d.y<-1&&(d.y+=2);for(const m of e.cages??[])if(m.shape==="rect"){const y=m.w/2,v=m.h/2;if(!(d.prevX>m.x-y&&d.prevX<m.x+y&&d.prevY>m.y-v&&d.prevY<m.y+v))continue;d.x<m.x-y&&(d.x=m.x-y+.001,d.vx=Math.abs(d.vx)*m.elasticity),d.x>m.x+y&&(d.x=m.x+y-.001,d.vx=-Math.abs(d.vx)*m.elasticity),d.y<m.y-v&&(d.y=m.y-v+.001,d.vy=Math.abs(d.vy)*m.elasticity),d.y>m.y+v&&(d.y=m.y+v-.001,d.vy=-Math.abs(d.vy)*m.elasticity)}else{const y=d.x-m.x,v=d.y-m.y,b=Math.sqrt(y*y+v*v);if(Math.sqrt((d.prevX-m.x)**2+(d.prevY-m.y)**2)>m.r||b<=m.r)continue;const C=y/(b+1e-4),k=v/(b+1e-4),R=d.vx*C+d.vy*k;R>0&&(d.vx-=2*R*C,d.vy-=2*R*k),d.vx*=m.elasticity,d.vy*=m.elasticity,d.x=m.x+C*(m.r-.002),d.y=m.y+k*(m.r-.002)}for(const m of e.fxZones??[]){if(m.pts.length<3)continue;const y=m._bb??M$(m);if(d.x<y[0]||d.x>y[1]||d.y<y[2]||d.y>y[3])continue;let v=!1;for(let C=0,k=m.pts.length-1;C<m.pts.length;k=C++){const R=m.pts[C][0],j=m.pts[C][1],T=m.pts[k][0],_=m.pts[k][1];j>d.y!=_>d.y&&d.x<(T-R)*(d.y-j)/(_-j)+R&&(v=!v)}if(!v)continue;const b=m.strength,S=m.param??.5;switch(m.effect){case"slow":d.vx*=1-b*.04*o*60,d.vy*=1-b*.04*o*60;break;case"fast":d.vx*=1+b*.025*o*60,d.vy*=1+b*.025*o*60;break;case"mute":d.cooldown=Math.max(d.cooldown,.25);break;case"excite_zone":d.charge=Math.min(1,d.charge+b*.015*o*60);break;case"freeze_zone":d.vx*=.95,d.vy*=.95,d.charge*=.998;break;case"pitch_up":e.tick%Math.max(1,Math.round(90*(1-b*.8)))===0&&(d.pitch=Math.min(108,d.pitch+1));break;case"pitch_down":e.tick%Math.max(1,Math.round(90*(1-b*.8)))===0&&(d.pitch=Math.max(24,d.pitch-1));break;case"reverse":e.tick%120===Math.round(c*7)%120&&(d.vx*=-1,d.vy*=-1);break;case"vortex_zone":{const C=m.pts.reduce((_,P)=>_+P[0],0)/m.pts.length,k=m.pts.reduce((_,P)=>_+P[1],0)/m.pts.length,R=d.x-C,j=d.y-k,T=Math.sqrt(R*R+j*j)+.001;h+=-j/T*b*(.3+S*.4),f+=R/T*b*(.3+S*.4);break}case"gravity_down":f+=b*(.5+S*1.5);break;case"gravity_up":f-=b*(.5+S*1.5);break;case"transpose":{if(e.tick%45===c*5%45){const C=Math.round((S-.5)*24);d.pitch=Math.max(24,Math.min(108,d.pitch+C))}break}case"harmonize_zone":e.tick%60===c*7%60&&(d.pitch=Vc(d.pitch,t.root,t.scale));break;case"bounce":{if(qc()<b*.04*o*60){const C=qc()*Math.PI*2;d.vx+=Math.cos(C)*(.05+S*.2),d.vy+=Math.sin(C)*(.05+S*.2)}break}case"compress_zone":{const C=m.pts.reduce((R,j)=>R+j[0],0)/m.pts.length,k=m.pts.reduce((R,j)=>R+j[1],0)/m.pts.length;h+=(C-d.x)*b*(.25+S*.5),f+=(k-d.y)*b*(.25+S*.5);break}case"scatter_zone":{qc()<b*.02*o*60&&(d.x+=Br()*.04,d.y+=Br()*.04);break}case"glitch":{qc()<b*.025*o*60&&(d.x+=Br()*(.06+S*.2),d.y+=Br()*(.06+S*.2),d.vx+=Br()*b*.08,d.vy+=Br()*b*.08);break}case"tremolo":{const C=b*(.3+S*.7);d.charge=Math.max(0,Math.min(1,d.charge+Math.sin(e.elapsed*(8+S*24)+d.phase*4)*C*.04*o*60));break}case"pulse_beat":{const C=Math.max(0,Math.sin(e.elapsed*(e.bpm/60)*Math.PI*2)),k=b*(.3+S*.7)*C*C,R=m.pts.reduce((T,_)=>T+_[0],0)/m.pts.length,j=m.pts.reduce((T,_)=>T+_[1],0)/m.pts.length;h+=(R-d.x)*k,f+=(j-d.y)*k,C>.85&&(d.charge=Math.min(1,d.charge+b*.01));break}case"warp":{const C=Math.sin(d.y*(6+S*10)+e.elapsed*1.5)*b*(.15+S*.35),k=Math.cos(d.x*(6+S*10)+e.elapsed*1.5)*b*(.15+S*.35);h+=C,f+=k;break}case"phase_lock":{const C=S*Math.PI*2,k=Math.sin(d.phase*Math.PI*2-C);d.phase=(d.phase-k*b*.04*o*60+1)%1;break}case"role_shift":{if(d.roleLockTimer<=0&&qc()<b*.004*o*60){const C=["KICK","BASS","PERC","PAD","LEAD","ARP","STRINGS","CHOIR"];d.role=C[Math.min(Math.floor(S*C.length),C.length-1)],d.hue=dg[d.role],d.roleLockTimer=2}break}case"density_wave":{const C=Math.sqrt(d.x*d.x+d.y*d.y)+.001,k=Math.sin(C*(8+S*16)-e.elapsed*2)*b*.12;h+=d.x/C*k,f+=d.y/C*k;break}}}if(t.trailLen>0){d.trailX.push(d.x),d.trailY.push(d.y);const m=d.trailX.length-t.trailLen;m>16&&(d.trailX.splice(0,m),d.trailY.splice(0,m))}}for(const c of e.strings??[])if(c.lastHit=Math.max(0,c.lastHit-o),c.vibPhase=(c.vibPhase+(2+c.tension*4)*o)%(Math.PI*2),c.vibAmp*=Math.pow(1-c.decay*.8,o*60),c.vibAmp<.001&&(c.vibAmp=0),!(c.lastHit>0))for(let d=0;d<e.count;d++){const h=e.quanta[d];if(!uS(h.prevX,h.prevY,h.x,h.y,c.x1,c.y1,c.x2,c.y2))continue;const f=c.x2-c.x1,g=c.y2-c.y1,m=Math.sqrt(f*f+g*g)+.001,y=-g/m,v=f/m,b=h.vx*y+h.vy*v;if(h.vx-=2*b*y*.75,h.vy-=2*b*v*.75,h.x=h.prevX,h.y=h.prevY,c.vibAmp=Math.min(1,c.vibAmp+h.charge*.45),c.lastHit=.08,h.cooldown<=0){const S=Math.sqrt((c.x2-c.x1)**2+(c.y2-c.y1)**2),C=Vc(Math.round(52+(1-Math.min(1,S/1.5))*26),0,"chromatic"),k=[0,12,19,24][Math.floor(Math.random()*4)],R=Math.min(108,C+k),j=t.roles.STRINGS;j&&(s({pitch:R,velocity:.5+h.charge*.4,role:"STRINGS",x:(c.x1+c.x2)/2,y:(c.y1+c.y2)/2,duration:.6+c.tension*1.2,timbre:.65},j),h.cooldown=.12,Vl(e,{velocity:.6,x:(c.x1+c.x2)/2,y:(c.y1+c.y2)/2},c.color))}break}if(e.sequencer.active&&F$(e,t,o,s),e.tick%3===0){const c=r.entainment*o;for(let d=0;d<i;d++){const h=e.quanta[d];for(let f=d+1;f<Math.min(d+8,i);f++){const g=e.quanta[f],m=h.x-g.x,y=h.y-g.y;if(m*m+y*y<.09){const v=(g.phase-h.phase+1.5)%1-.5;h.phase=(h.phase+v*c*.5+1)%1,g.phase=(g.phase-v*c*.5+1)%1}}}}if(e.tick%8===0){let c=0,d=0;for(let h=0;h<i;h++)c+=Math.sin(e.quanta[h].phase*Math.PI*2),d+=Math.cos(e.quanta[h].phase*Math.PI*2);e.syncIntensity=Math.sqrt(c*c+d*d)/i}if(e.tick%4===0&&(r.energyTransfer>0||r.mutationRate>0)){const c=t.encounterR*1.6*(t.encounterR*1.6);for(let d=0;d<i;d++){const h=e.quanta[d];for(let f=d+1;f<Math.min(d+10,i);f++){const g=e.quanta[f],m=h.x-g.x,y=h.y-g.y;if(!(m*m+y*y>c)){if(r.energyTransfer>0){const v=(h.charge-g.charge)*r.energyTransfer*o*4;h.charge=Math.max(0,Math.min(1,h.charge-v)),g.charge=Math.max(0,Math.min(1,g.charge+v))}if(r.mutationRate>0&&h.roleLockTimer<=0&&g.roleLockTimer<=0){const v=h.vx-g.vx,b=h.vy-g.vy;if(Math.sqrt(v*v+b*b)>.18&&qc()<r.mutationRate*o*8){const C=h.charge<g.charge?h:g,k=h.charge<g.charge?g:h;C.role=k.role,C.hue=dg[k.role],C.mutations++,C.roleLockTimer=2,e.emergent.push({type:"mutation",x:C.x,y:C.y,r:.08,alpha:1,color:"#ffffff"})}}}}}}for(let c=0;c<i;c++){const d=e.quanta[c];if(d.charge>.9){if(d.dischargeTimer+=o,d.dischargeTimer>.45){d.dischargeTimer=0;const h=d.charge;d.charge=.15;for(let g=0;g<i;g++){if(g===c)continue;const m=e.quanta[g],y=d.x-m.x,v=d.y-m.y,b=y*y+v*v;if(b<.18&&b>1e-4){const S=Math.sqrt(b);m.vx+=(m.x-d.x)/S*.12*h,m.vy+=(m.y-d.y)/S*.12*h,m.charge=Math.min(1,m.charge+h*.15)}}const f=t.roles[d.role];f&&!r.physicsOnly&&(s({pitch:d.pitch,velocity:.85,role:d.role,x:d.x,y:d.y,duration:Bf(f.envelope),timbre:1,timbreIdx:d.timbreIdx},f),d.recentlyFired=1,d.cooldown=Math.max(f.cooldownMin*1.5,.3)),e.emergent.push({type:"discharge",x:d.x,y:d.y,r:.05,alpha:1,color:"#ffff80"}),Vl(e,{pitch:d.pitch,velocity:.85,role:d.role,x:d.x,y:d.y},"#ffff80")}}else d.dischargeTimer=Math.max(0,d.dischargeTimer-o*2)}for(let c=e.emergent.length-1;c>=0;c--){const d=e.emergent[c];d.r+=o*.4,d.alpha-=o*2.5,d.alpha<=0&&e.emergent.splice(c,1)}const u=60/(e.bpm*t.eventRate*4+.001);for(const c of e.gates){if(c.cooldown>0){c.cooldown-=o;continue}const d=c.type??"gate";for(let h=0;h<i;h++){const f=e.quanta[h];if(f.cooldown>0&&d==="gate"||!uS(f.prevX,f.prevY,f.x,f.y,c.x1,c.y1,c.x2,c.y2))continue;const g=t.roles[f.role];if(g)if(d==="mirror"){const m=c.x2-c.x1,y=c.y2-c.y1,v=Math.sqrt(m*m+y*y)+1e-4,b=-y/v,S=m/v,C=f.vx*b+f.vy*S;f.vx-=2*C*b,f.vy-=2*C*S,f.x=f.prevX,f.y=f.prevY,Vl(e,{pitch:f.pitch,velocity:.25,role:f.role,x:f.x,y:f.y},c.color);break}else if(d==="absorber"){f.charge=Math.max(0,f.charge*.07),f.vx*=.12,f.vy*=.12,f.recentlyFired=.45,c.cooldown=u*.08,Vl(e,{pitch:f.pitch,velocity:.28,role:f.role,x:f.x,y:f.y},c.color);break}else if(d==="membrane"){const m=c.x2-c.x1,y=c.y2-c.y1,v=Math.sqrt(m*m+y*y)+1e-4,b=-y/v,S=m/v;if((f.prevX-c.x1)*b+(f.prevY-c.y1)*S>0){const k=f.vx*b+f.vy*S;f.vx-=2*k*b*.84,f.vy-=2*k*S*.84,f.x=f.prevX,f.y=f.prevY,Vl(e,{pitch:f.pitch,velocity:.2,role:f.role,x:f.x,y:f.y},c.color)}break}else{if(f.cooldown>0)break;const m=.55+f.charge*.45,y=Bf(g.envelope);s({pitch:f.pitch,velocity:m,role:f.role,x:f.x,y:f.y,duration:y,timbre:f.brightness,timbreIdx:f.timbreIdx},g),f.cooldown=Math.max(g.cooldownMin,u),f.recentlyFired=.8,c.cooldown=u*.3,Vl(e,{pitch:f.pitch,velocity:m,role:f.role,x:f.x,y:f.y,timbre:f.brightness},c.color);break}}}if(!r.physicsOnly&&e.syncIntensity>t.syncThreshold&&e.tick%12===0)for(let c=0;c<i;c++){const d=e.quanta[c];if(d.cooldown>0||d.phase>.08)continue;const h=t.roles[d.role];if(!h)continue;const f=.45+e.syncIntensity*.4;s({pitch:d.pitch,velocity:f,role:d.role,x:d.x,y:d.y,duration:Bf(h.envelope),timbre:d.brightness,timbreIdx:d.timbreIdx},h),d.cooldown=Math.max(h.cooldownMin*1.5,u*2),d.recentlyFired=.6;break}if(!r.physicsOnly&&e.tick%4===0){const c=t.encounterR*t.encounterR;let d=0;for(let h=0;h<i&&d<3;h++){const f=e.quanta[h];if(!(f.cooldown>0))for(let g=h+1;g<i&&d<3;g++){const m=e.quanta[g];if(m.cooldown>0)continue;const y=f.x-m.x,v=f.y-m.y;if(y*y+v*v>=c)continue;const b=aR(f.pitch,m.pitch);if(t.harmonyMode==="consonant"&&b<.5||t.harmonyMode==="dissonant"&&b>.5)continue;const S=t.roles[f.role];if(!S)continue;const C=.35+f.charge*.4,k=Bf(S.envelope);s({pitch:f.pitch,velocity:C,role:f.role,x:f.x,y:f.y,duration:k,timbre:f.brightness,timbreIdx:f.timbreIdx},S),f.cooldown=Math.max(S.cooldownMin*2,u*3),f.recentlyFired=.5,d++;break}}}for(let c=e.ripples.length-1;c>=0;c--){const d=e.ripples[c];d.r+=.55*o,d.alpha-=o*1.8,(d.alpha<=0||d.r>d.maxR)&&e.ripples.splice(c,1)}}function F$(e,t,r,o){const s=e.sequencer,l=s.cursor,i=e.quanta.length;if(i===0)return;const u=e.bpm/240,c=s.tempoMult*u*r;s.cursor=(s.cursor+c)%1;for(let h=0;h<s.stepCd.length;h++)s.stepCd[h]>0&&(s.stepCd[h]-=r);const d=s.steps.length;for(let h=0;h<d;h++){const f=s.steps[h];if(!f.armed||(s.stepCd.length<=h&&s.stepCd.push(0),s.stepCd[h]>0))continue;const g=h/d;let m;if(s.cursor>=l?m=g>=l&&g<s.cursor:m=g>=l||g<s.cursor,!m)continue;const y=g*Math.PI*2-Math.PI*.5,v=s.x+s.ringR*Math.cos(y),b=s.y+s.ringR*Math.sin(y);let S=null,C=1/0;for(let _=0;_<i;_++){const P=e.quanta[_],I=P.x-v,$=P.y-b,q=I*I+$*$;q<C&&(C=q,S=P)}if(!S)continue;const k=t.roles[S.role];if(!k)continue;const R=Math.max(0,Math.min(127,S.pitch+f.pitchOff)),j=f.vel>0?f.vel:Math.min(1,.45+S.charge*.55),T=Bf(k.envelope);o({pitch:R,velocity:j,role:S.role,x:S.x,y:S.y,duration:T,timbre:S.brightness,timbreIdx:S.timbreIdx},k),S.recentlyFired=.5,s.stepCd[h]=Math.max(.04,60/e.bpm/d*.8),Vl(e,{velocity:j,role:S.role,x:v,y:b},"#aaddff88")}}const se=(e,t,r,o)=>({attack:e,decay:t,sustain:r,release:o}),ie=(e,t,r,o,s,l,i,u,c,d,h,f)=>({proportion:e,pitchRange:t,envelope:r,waveform:o,filterType:s,filterFreq:l,filterQ:i,gainScale:u,detune:c,panSpread:d,maxVoices:h,cooldownMin:f}),Id=[{id:"eno-drift",name:"Eno Drift Garden",intensity:1,description:"Pads infinitos, root drift lento. Reverb expansivo como um jardim.",vibe:"Infinite, Still, Breathing",tags:["Ambient","Eno","Meditative","Soft"],bpm:48,scale:"major",root:53,quantaCount:64,motionStyle:"drift",roles:{PAD:ie(.55,[48,72],se(1.2,.5,.8,2.5),"sine","lowpass",900,1.2,.5,0,.9,4,1.8),STRINGS:ie(.3,[53,69],se(.8,.4,.7,1.8),"triangle","lowpass",1200,1,.4,3,.8,3,1.5),CHOIR:ie(.15,[60,72],se(1.5,.6,.75,3),"sine","lowpass",700,1,.35,0,1,2,2.5)},syncThreshold:.3,encounterR:.18,entainment:.25,eventRate:.25,reverbAmt:.85,delayAmt:.5,delayTime:.55,masterGain:.7,harmonyMode:"consonant",particleGlow:2.2,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#88ffcc",secondary:"#001122",accent:"#ffeebb",gateCount:2,attractorCount:1},{id:"deep-choir",name:"Deep Space Choir",intensity:2,description:"Vozes csmicas orbitando. Cada encontro  um harmnico vocal.",vibe:"Vast, Choral, Cosmic",tags:["Ambient","Choral","Space","Meditative"],bpm:40,scale:"lydian",root:48,quantaCount:72,motionStyle:"orbit",roles:{CHOIR:ie(.5,[48,72],se(1.8,.7,.82,3.5),"sine","lowpass",800,1.1,.45,0,.95,4,2),PAD:ie(.3,[42,60],se(2,.8,.85,4),"triangle","lowpass",600,1,.35,7,.9,3,2.5),STRINGS:ie(.2,[55,72],se(.9,.5,.7,2),"sine","lowpass",1400,1.2,.4,-5,.7,2,1.8)},syncThreshold:.28,encounterR:.2,entainment:.3,eventRate:.2,reverbAmt:.92,delayAmt:.6,delayTime:.7,masterGain:.65,harmonyMode:"consonant",particleGlow:2.8,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#aabbff",secondary:"#020510",accent:"#ffd5a0",gateCount:1,attractorCount:1},{id:"meditation-pool",name:"Meditation Pool",intensity:1,description:"Meditao ultralenta. Cada nota emerge como uma gota na superfcie.",vibe:"Stillness, Breath, Zen",tags:["Ambient","Meditative","Soft","Drone"],bpm:36,scale:"pentatonic",root:48,quantaCount:40,motionStyle:"meditation",roles:{PAD:ie(.45,[48,72],se(2.5,1,.85,4),"sine","lowpass",600,.8,.38,0,.9,3,3),STRINGS:ie(.35,[53,72],se(1.5,.8,.75,3),"triangle","lowpass",800,1,.35,5,.8,2,2.5),CHOIR:ie(.2,[60,72],se(2,.8,.8,3.5),"sine","lowpass",550,.9,.3,0,1,2,3.5)},syncThreshold:.2,encounterR:.25,entainment:.15,eventRate:.12,reverbAmt:.95,delayAmt:.7,delayTime:.8,masterGain:.55,harmonyMode:"consonant",particleGlow:3,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#aaccff",secondary:"#020208",accent:"#ffeedd",gateCount:1,attractorCount:0},{id:"underwater",name:"Underwater Harmonics",intensity:2,description:"Cardume submerso. Frequncias graves e harmnicos molhados.",vibe:"Deep, Pressure, Liquid",tags:["Ambient","Aquatic","Drone","Experimental"],bpm:52,scale:"dorian",root:40,quantaCount:80,motionStyle:"school",roles:{BASS:ie(.3,[28,48],se(.3,.3,.75,1.5),"sine","lowpass",200,1.5,.55,-3,.4,3,.8),PAD:ie(.35,[40,64],se(1.5,.5,.8,2.5),"triangle","lowpass",700,1.2,.45,8,.9,3,1.8),STRINGS:ie(.2,[48,72],se(.8,.4,.65,1.5),"sine","lowpass",1100,1,.35,0,.7,2,1.2),LEAD:ie(.15,[55,76],se(.15,.2,.5,1),"triangle","bandpass",900,2,.3,12,.6,2,1)},syncThreshold:.32,encounterR:.15,entainment:.35,eventRate:.35,reverbAmt:.88,delayAmt:.55,delayTime:.45,masterGain:.7,harmonyMode:"consonant",particleGlow:1.8,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#00aacc",secondary:"#001520",accent:"#88ffee",gateCount:3,attractorCount:1},{id:"glass-arps",name:"Glass Arpeggios",intensity:3,description:"Arpejos cristalinos em padro de grade. Philip Glass emergente.",vibe:"Crystal, Pattern, Minimalist",tags:["Classical","Minimalist","Arpeggios","Generative"],bpm:88,scale:"major",root:60,quantaCount:96,motionStyle:"lattice",roles:{ARP:ie(.35,[60,96],se(.003,.12,.15,.22),"triangle","lowpass",3200,2,.55,0,.6,4,.14),LEAD:ie(.25,[60,84],se(.008,.1,.45,.18),"triangle","lowpass",2400,1.5,.5,5,.5,3,.22),PAD:ie(.2,[48,72],se(.6,.3,.7,1.2),"sine","lowpass",1e3,1,.4,0,.8,2,.9),BASS:ie(.2,[36,52],se(.01,.2,.55,.2),"triangle","lowpass",400,1.5,.5,0,.3,3,.35)},syncThreshold:.42,encounterR:.1,entainment:.55,eventRate:.65,reverbAmt:.45,delayAmt:.4,delayTime:.22,masterGain:.78,harmonyMode:"consonant",particleGlow:1.2,trailLen:0,lens:"Notes",bgPulse:!1,cinematic:!1,primary:"#aaeeff",secondary:"#0a1020",accent:"#ffd700",gateCount:4,attractorCount:1},{id:"drone-mandala",name:"Drone Mandala",intensity:1,description:"Espiral lenta formando mandala sonora. Drones e overtones emergentes.",vibe:"Ritual, Trance, Ancient",tags:["Drone","Meditative","Space","Experimental"],bpm:44,scale:"phrygian",root:36,quantaCount:56,motionStyle:"spiral",roles:{PAD:ie(.4,[36,60],se(2,.8,.85,3.5),"sawtooth","lowpass",350,2,.5,0,.9,3,2),CHOIR:ie(.3,[48,72],se(1.8,.7,.8,3),"sine","lowpass",700,1,.4,0,1,2,2.5),STRINGS:ie(.2,[42,66],se(1,.5,.7,2),"triangle","lowpass",1e3,1.2,.35,5,.8,2,1.5),BASS:ie(.1,[24,42],se(.5,.4,.8,2),"sine","lowpass",180,.8,.55,0,.3,2,1.5)},syncThreshold:.25,encounterR:.18,entainment:.2,eventRate:.18,reverbAmt:.9,delayAmt:.65,delayTime:.7,masterGain:.6,harmonyMode:"modal",particleGlow:2.5,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#cc88ff",secondary:"#0a0515",accent:"#ffcc88",gateCount:2,attractorCount:1},{id:"aurora",name:"Aurora Borealis",intensity:2,description:"Partculas migrando como cortinas de aurora. Melodias etreas.",vibe:"Northern Lights, Ethereal, Slow",tags:["Ambient","Space","Experimental","Soft"],bpm:46,scale:"whole_tone",root:50,quantaCount:88,motionStyle:"migration",roles:{STRINGS:ie(.35,[48,76],se(1,.5,.72,2),"triangle","lowpass",1400,1,.4,7,.9,3,1.5),PAD:ie(.3,[42,66],se(1.8,.7,.8,3),"sine","lowpass",650,.9,.38,0,.8,3,2),CHOIR:ie(.2,[55,72],se(1.5,.6,.75,2.5),"sine","lowpass",600,1,.32,0,1,2,2.2),ARP:ie(.15,[60,88],se(.05,.15,.2,.5),"triangle","highpass",2e3,1.5,.25,12,.7,2,.8)},syncThreshold:.3,encounterR:.16,entainment:.28,eventRate:.3,reverbAmt:.88,delayAmt:.55,delayTime:.55,masterGain:.65,harmonyMode:"free",particleGlow:2.4,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#44ffcc",secondary:"#020812",accent:"#ff88cc",gateCount:3,attractorCount:0},{id:"berlin-techno",name:"Berlin Techno Engine",intensity:5,description:"Kick 4/4 emergente por sync peaks. Bass pulse profundo. Swarm bunker.",vibe:"Bunker, Sub-bass, Sidechain",tags:["Techno","Club","Electronic","Dark"],bpm:132,scale:"minor",root:36,quantaCount:128,motionStyle:"swarm",roles:{KICK:ie(.25,[24,36],se(.001,.08,0,.05),"kick","lowpass",200,.5,.9,0,.3,6,.4),BASS:ie(.2,[36,48],se(.005,.18,.6,.12),"sawtooth","lowpass",280,3,.7,-5,.4,4,.25),PERC:ie(.2,[60,72],se(.001,.06,0,.04),"hihat","highpass",5e3,.5,.55,0,.8,4,.18),LEAD:ie(.2,[60,80],se(.01,.1,.4,.18),"sawtooth","lowpass",1400,4,.6,7,.5,3,.3),PAD:ie(.15,[48,60],se(.4,.3,.7,.8),"sawtooth","lowpass",600,2,.35,0,.6,2,.8)},syncThreshold:.55,encounterR:.12,entainment:.65,eventRate:.9,reverbAmt:.18,delayAmt:.15,delayTime:.17,masterGain:.88,harmonyMode:"modal",particleGlow:1.4,trailLen:0,lens:"Rhythm",bgPulse:!0,cinematic:!0,primary:"#00d4ff",secondary:"#7700ff",accent:"#ff2255",gateCount:4,attractorCount:1},{id:"minimal-micro",name:"Minimal Microhouse",intensity:3,description:"Groove swing com clicks percussivos. Menos  mais.",vibe:"Clicks, Swing, Hypnotic",tags:["Techno","Minimal","Groove"],bpm:124,scale:"minor",root:36,quantaCount:64,motionStyle:"drift",roles:{KICK:ie(.18,[24,36],se(.001,.06,0,.04),"kick","lowpass",180,.4,.8,0,.2,4,.45),PERC:ie(.35,[60,84],se(.001,.04,0,.02),"snare","bandpass",3500,.8,.5,0,.7,5,.2),BASS:ie(.22,[36,48],se(.01,.12,.3,.1),"triangle","lowpass",350,2,.55,0,.35,3,.35),LEAD:ie(.25,[60,72],se(.008,.08,.4,.12),"square","lowpass",800,3,.45,12,.6,2,.4)},syncThreshold:.4,encounterR:.09,entainment:.4,eventRate:.6,reverbAmt:.12,delayAmt:.25,delayTime:.12,masterGain:.8,harmonyMode:"modal",particleGlow:1,trailLen:0,lens:"Rhythm",bgPulse:!1,cinematic:!1,primary:"#33ff88",secondary:"#1a1a2e",accent:"#ff8833",gateCount:3,attractorCount:1},{id:"acid-swarm",name:"Acid Swarm",intensity:5,description:"303-style acid com flock murmuration. Slides por velocidade do bando.",vibe:"Resonance, Squelch, Rave",tags:["Techno","Acid","Rave","Electronic"],bpm:138,scale:"minor",root:36,quantaCount:96,motionStyle:"murmuration",roles:{KICK:ie(.18,[24,36],se(.001,.07,0,.05),"kick","lowpass",220,.5,.85,0,.2,5,.35),BASS:ie(.3,[36,52],se(.002,.12,.45,.08),"sawtooth","lowpass",360,18,.75,-7,.4,4,.14),PERC:ie(.22,[60,84],se(.001,.05,0,.03),"hihat","highpass",6e3,.5,.5,0,.7,4,.16),LEAD:ie(.3,[52,76],se(.003,.1,.35,.1),"sawtooth","lowpass",450,14,.65,0,.5,3,.18)},syncThreshold:.5,encounterR:.11,entainment:.7,eventRate:.85,reverbAmt:.15,delayAmt:.2,delayTime:.14,masterGain:.82,harmonyMode:"modal",particleGlow:1.6,trailLen:0,lens:"Rhythm",bgPulse:!0,cinematic:!0,primary:"#ff5500",secondary:"#220000",accent:"#00ff88",gateCount:4,attractorCount:2},{id:"detroit-chords",name:"Detroit Chords",intensity:4,description:"Pares orbitantes gerando chord stabs. Dana de Detroit soul.",vibe:"Soulful, Chords, Garage",tags:["Techno","Club","Groove","Ambient"],bpm:122,scale:"minor",root:48,quantaCount:88,motionStyle:"dance",roles:{KICK:ie(.18,[24,36],se(.001,.1,0,.06),"kick","lowpass",200,.5,.82,0,.2,4,.42),BASS:ie(.18,[36,52],se(.008,.22,.55,.15),"sawtooth","lowpass",300,2.5,.65,-3,.35,3,.3),PAD:ie(.25,[48,72],se(.08,.15,.65,.45),"sawtooth","lowpass",1200,3,.55,7,.8,4,.5),LEAD:ie(.2,[60,84],se(.01,.08,.5,.15),"square","lowpass",1800,2.5,.5,5,.6,3,.25),STRINGS:ie(.19,[48,72],se(.3,.2,.7,1),"triangle","lowpass",1400,1,.4,0,.7,3,.8)},syncThreshold:.48,encounterR:.12,entainment:.55,eventRate:.7,reverbAmt:.3,delayAmt:.35,delayTime:.22,masterGain:.82,harmonyMode:"modal",particleGlow:1.3,trailLen:0,lens:"Harmony",bgPulse:!0,cinematic:!1,primary:"#ff9944",secondary:"#1a0a1e",accent:"#44aaff",gateCount:4,attractorCount:1},{id:"breakbeat",name:"Breakbeat Reactor",intensity:5,description:"Caos browniano gerando breaks imprevisveis. Cada coliso  um hit.",vibe:"Breaks, Chaos, Rave",tags:["Breakbeat","Electronic","Experimental","Rave"],bpm:140,scale:"minor",root:36,quantaCount:112,motionStyle:"chaos",roles:{KICK:ie(.2,[24,36],se(.001,.06,0,.04),"kick","lowpass",220,.5,.9,0,.3,6,.3),PERC:ie(.3,[48,84],se(.001,.05,0,.03),"snare","bandpass",3500,1,.55,0,.8,5,.15),BASS:ie(.2,[36,52],se(.003,.15,.5,.08),"sawtooth","lowpass",280,4,.7,-5,.3,4,.2),LEAD:ie(.15,[60,84],se(.005,.08,.35,.12),"square","bandpass",1600,3,.5,7,.5,3,.18),ARP:ie(.15,[60,96],se(.002,.06,.1,.08),"square","lowpass",2800,2,.45,0,.7,3,.12)},syncThreshold:.6,encounterR:.1,entainment:.75,eventRate:1,reverbAmt:.12,delayAmt:.18,delayTime:.11,masterGain:.85,harmonyMode:"free",particleGlow:1.5,trailLen:0,lens:"Rhythm",bgPulse:!0,cinematic:!0,primary:"#ff2200",secondary:"#0a0008",accent:"#ffcc00",gateCount:6,attractorCount:2},{id:"dub-techno",name:"Dub Techno Fog",intensity:3,description:"Massa orgnica respirando em delay infinito. Cordas dubby.",vibe:"Dub, Fog, Hypnotic",tags:["Techno","Ambient","Drone","Club"],bpm:120,scale:"dorian",root:36,quantaCount:80,motionStyle:"organism",roles:{KICK:ie(.15,[24,36],se(.001,.12,0,.08),"kick","lowpass",160,.4,.75,0,.2,3,.5),BASS:ie(.22,[36,52],se(.01,.25,.6,.2),"sine","lowpass",250,1.5,.6,0,.3,3,.4),PAD:ie(.28,[48,72],se(.5,.3,.75,1.5),"sawtooth","lowpass",600,2.5,.45,5,.8,3,1),PERC:ie(.15,[60,84],se(.001,.04,0,.03),"hihat","highpass",4500,.5,.4,0,.6,4,.22),STRINGS:ie(.2,[48,72],se(.4,.3,.65,1.2),"triangle","lowpass",1100,1,.38,0,.7,2,.9)},syncThreshold:.38,encounterR:.13,entainment:.45,eventRate:.5,reverbAmt:.75,delayAmt:.65,delayTime:.35,masterGain:.75,harmonyMode:"modal",particleGlow:1.6,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#5588cc",secondary:"#050810",accent:"#aaddff",gateCount:3,attractorCount:1},{id:"carnival-samba",name:"Carnival Samba",intensity:5,description:"Trs vrtices em festa. Percusso sincopada com swing brasileiro.",vibe:"Carnaval, Ritmo, Energia",tags:["Groove","Dynamic","Electronic","Experimental"],bpm:126,scale:"dorian",root:48,quantaCount:120,motionStyle:"carnival",roles:{KICK:ie(.18,[24,36],se(.001,.07,0,.05),"kick","lowpass",200,.5,.85,0,.2,5,.35),PERC:ie(.3,[48,84],se(.001,.05,0,.02),"snare","bandpass",3e3,.8,.55,0,.8,5,.14),BASS:ie(.18,[36,52],se(.008,.15,.5,.1),"sawtooth","lowpass",320,3,.65,-3,.35,4,.22),ARP:ie(.2,[60,96],se(.003,.08,.15,.12),"square","lowpass",2400,2,.5,0,.7,4,.1),LEAD:ie(.14,[60,84],se(.01,.1,.4,.15),"sawtooth","lowpass",1600,3,.55,7,.5,3,.2)},syncThreshold:.55,encounterR:.11,entainment:.7,eventRate:.9,reverbAmt:.2,delayAmt:.25,delayTime:.13,masterGain:.85,harmonyMode:"modal",particleGlow:1.5,trailLen:0,lens:"Rhythm",bgPulse:!0,cinematic:!0,primary:"#ffcc00",secondary:"#1a0a00",accent:"#ff3366",gateCount:5,attractorCount:3},{id:"reich-phase",name:"Reich Phase Machine",intensity:3,description:"Phasing emergente por espiral. Padres se desalinham e realinham.",vibe:"Phasing, Pattern, Process",tags:["Classical","Minimalist","Generative","Experimental"],bpm:96,scale:"major",root:60,quantaCount:80,motionStyle:"revolution",roles:{ARP:ie(.35,[60,84],se(.003,.1,.18,.15),"triangle","lowpass",2800,1.5,.5,0,.6,4,.16),LEAD:ie(.25,[60,80],se(.005,.08,.45,.12),"triangle","lowpass",2200,1,.48,3,.5,3,.18),PAD:ie(.2,[48,72],se(.5,.3,.7,1),"sine","lowpass",900,1,.38,0,.7,2,.8),PERC:ie(.2,[60,84],se(.001,.04,0,.03),"noise","highpass",4e3,.4,.42,0,.6,4,.2)},syncThreshold:.45,encounterR:.1,entainment:.6,eventRate:.7,reverbAmt:.35,delayAmt:.45,delayTime:.28,masterGain:.78,harmonyMode:"consonant",particleGlow:1.2,trailLen:0,lens:"Notes",bgPulse:!1,cinematic:!1,primary:"#ccffaa",secondary:"#080c08",accent:"#ffaa44",gateCount:4,attractorCount:1},{id:"satie-gymno",name:"Satie Gymnopdie",intensity:2,description:"Deriva suave com notas esparsas de piano. Simplicidade perfeita.",vibe:"Sparse, Gentle, Elegant",tags:["Classical","Minimalist","Soft","Ambient"],bpm:62,scale:"lydian",root:53,quantaCount:48,motionStyle:"drift",roles:{LEAD:ie(.4,[60,84],se(.01,.15,.4,.3),"triangle","lowpass",2e3,1,.45,0,.5,2,.5),PAD:ie(.3,[48,72],se(1,.5,.75,2),"sine","lowpass",800,1,.35,0,.8,2,1.5),BASS:ie(.15,[36,52],se(.05,.3,.55,.4),"sine","lowpass",350,1,.5,0,.3,2,.6),STRINGS:ie(.15,[48,72],se(.5,.3,.65,1.5),"triangle","lowpass",1200,1,.35,5,.7,2,1.2)},syncThreshold:.3,encounterR:.15,entainment:.3,eventRate:.3,reverbAmt:.65,delayAmt:.4,delayTime:.35,masterGain:.7,harmonyMode:"consonant",particleGlow:1.5,trailLen:0,lens:"Notes",bgPulse:!1,cinematic:!0,primary:"#ffeedd",secondary:"#0a0808",accent:"#aaccff",gateCount:2,attractorCount:0},{id:"bartok-pizz",name:"Bartk Pizzicato",intensity:3,description:"Microclusters formam, improvisam e dissolvem. Pizzicato folclrico.",vibe:"Folk, Plucked, Angular",tags:["Classical","Experimental","Strings","Dynamic"],bpm:104,scale:"harmonic_minor",root:45,quantaCount:72,motionStyle:"jazz",roles:{STRINGS:ie(.3,[48,76],se(.003,.08,.12,.15),"triangle","bandpass",1800,2,.5,0,.7,3,.18),LEAD:ie(.25,[52,84],se(.005,.1,.35,.12),"triangle","lowpass",2200,2,.48,5,.5,3,.2),PERC:ie(.2,[60,84],se(.001,.04,0,.03),"noise","bandpass",2500,.6,.42,0,.6,4,.16),PAD:ie(.15,[42,60],se(.4,.3,.6,1),"sine","lowpass",600,1,.35,0,.7,2,.9),BASS:ie(.1,[28,48],se(.01,.15,.45,.15),"triangle","lowpass",300,1.5,.55,0,.3,2,.4)},syncThreshold:.4,encounterR:.1,entainment:.5,eventRate:.55,reverbAmt:.35,delayAmt:.3,delayTime:.18,masterGain:.78,harmonyMode:"modal",particleGlow:1,trailLen:0,lens:"Notes",bgPulse:!1,cinematic:!1,primary:"#ffd700",secondary:"#0c0800",accent:"#88aaff",gateCount:4,attractorCount:1},{id:"cool-jazz",name:"Cool Jazz Midnight",intensity:3,description:"Clusters improvisando em modal. Brushes, piano, contrabaixo.",vibe:"Smoky, Modal, Late Night",tags:["Jazz","Improvisation","Modal","Soft"],bpm:72,scale:"dorian",root:45,quantaCount:64,motionStyle:"jazz",roles:{BASS:ie(.2,[28,48],se(.02,.25,.65,.3),"triangle","lowpass",280,1.5,.55,0,.3,2,.4),LEAD:ie(.25,[55,84],se(.01,.12,.45,.2),"triangle","lowpass",1800,1.5,.48,0,.5,3,.25),PAD:ie(.18,[48,72],se(.5,.3,.7,1.2),"sine","lowpass",800,1,.38,5,.7,2,.9),PERC:ie(.22,[48,72],se(.001,.06,0,.04),"noise","bandpass",2e3,.5,.4,0,.6,4,.2),ARP:ie(.15,[60,88],se(.005,.1,.2,.15),"triangle","lowpass",2400,1,.4,0,.5,2,.3)},syncThreshold:.35,encounterR:.12,entainment:.4,eventRate:.45,reverbAmt:.55,delayAmt:.4,delayTime:.28,masterGain:.72,harmonyMode:"modal",particleGlow:1.3,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#ff9944",secondary:"#0a0608",accent:"#88ccff",gateCount:3,attractorCount:1},{id:"free-jazz",name:"Free Jazz Storm",intensity:5,description:"Dois exrcitos tmbricos colidindo. Cromatismo livre. Ornette Coleman.",vibe:"Free, Collision, Energy",tags:["Jazz","Experimental","Dynamic","Improvisation"],bpm:108,scale:"chromatic",root:48,quantaCount:96,motionStyle:"war",roles:{LEAD:ie(.25,[48,96],se(.003,.08,.35,.1),"sawtooth","lowpass",2500,3,.55,7,.6,3,.15),PERC:ie(.25,[48,84],se(.001,.05,0,.04),"noise","bandpass",3e3,.6,.48,0,.8,5,.12),BASS:ie(.2,[28,52],se(.005,.18,.55,.12),"sawtooth","lowpass",350,3,.65,-5,.3,3,.2),ARP:ie(.15,[60,96],se(.002,.06,.15,.08),"square","bandpass",2e3,4,.45,12,.7,3,.1),PAD:ie(.15,[42,66],se(.2,.2,.5,.5),"sawtooth","lowpass",700,2,.35,0,.6,2,.5)},syncThreshold:.55,encounterR:.09,entainment:.65,eventRate:1,reverbAmt:.25,delayAmt:.2,delayTime:.12,masterGain:.8,harmonyMode:"free",particleGlow:1.5,trailLen:0,lens:"Tension",bgPulse:!0,cinematic:!0,primary:"#ff3333",secondary:"#0a0004",accent:"#ffcc00",gateCount:6,attractorCount:2},{id:"bebop-cells",name:"Bebop Cells",intensity:4,description:"Grupos celulares respirando. Linhas harmnicas rpidas. Walking bass.",vibe:"Swing, Virtuosity, Energy",tags:["Jazz","Groove","Dynamic","Improvisation"],bpm:160,scale:"mixolydian",root:48,quantaCount:80,motionStyle:"cells",roles:{BASS:ie(.2,[28,52],se(.01,.12,.55,.1),"triangle","lowpass",350,1.5,.6,0,.3,3,.18),LEAD:ie(.3,[55,96],se(.003,.06,.35,.08),"triangle","lowpass",2800,1.5,.5,0,.5,3,.12),PERC:ie(.25,[48,84],se(.001,.04,0,.02),"hihat","highpass",5e3,.4,.45,0,.7,5,.1),ARP:ie(.15,[60,90],se(.003,.08,.2,.1),"triangle","lowpass",2400,1,.42,5,.6,3,.14),PAD:ie(.1,[48,66],se(.2,.2,.5,.5),"sine","lowpass",700,1,.3,0,.6,2,.8)},syncThreshold:.5,encounterR:.09,entainment:.6,eventRate:.85,reverbAmt:.25,delayAmt:.2,delayTime:.1,masterGain:.78,harmonyMode:"modal",particleGlow:1,trailLen:0,lens:"Notes",bgPulse:!1,cinematic:!1,primary:"#ff9944",secondary:"#0c0608",accent:"#44ff88",gateCount:5,attractorCount:1},{id:"ballistic-cathedral",name:"Ballistic Cathedral",intensity:4,description:"Gravidade real. Partculas caem e ricocheteiam em gates  cada quique  uma nota.",vibe:"Gravity, Bounce, Percussion",tags:["Experimental","Dynamic","Generative"],bpm:100,scale:"pentatonic",root:48,quantaCount:60,motionStyle:"ballistic",roles:{PERC:ie(.3,[48,84],se(.001,.05,0,.04),"noise","bandpass",2500,.6,.55,0,.7,5,.15),LEAD:ie(.25,[55,84],se(.005,.1,.35,.15),"triangle","lowpass",2200,1.5,.48,0,.5,3,.2),BASS:ie(.2,[28,48],se(.01,.2,.55,.15),"sine","lowpass",250,1,.55,0,.3,3,.3),ARP:ie(.15,[60,96],se(.003,.08,.12,.1),"triangle","lowpass",3e3,1.5,.42,5,.6,3,.14),STRINGS:ie(.1,[48,72],se(.3,.2,.6,.8),"triangle","lowpass",1200,1,.35,0,.7,2,.8)},syncThreshold:.45,encounterR:.1,entainment:.55,eventRate:.7,reverbAmt:.55,delayAmt:.4,delayTime:.25,masterGain:.78,harmonyMode:"consonant",particleGlow:1.3,trailLen:0,lens:"Notes",bgPulse:!1,cinematic:!1,primary:"#ffd700",secondary:"#080808",accent:"#88aaff",gateCount:5,attractorCount:0},{id:"murmuration-song",name:"Murmuration Song",intensity:4,description:"O bando  a orquestra. 8 roles em formao de estorninho cantante.",vibe:"Flock, Orchestra, Emergence",tags:["Generative","Experimental","Orchestral","Dynamic"],bpm:88,scale:"major",root:48,quantaCount:128,motionStyle:"murmuration",roles:{KICK:ie(.1,[24,36],se(.001,.08,0,.05),"kick","lowpass",180,.4,.75,0,.2,3,.45),BASS:ie(.12,[36,52],se(.01,.2,.55,.15),"sine","lowpass",280,1.5,.55,0,.3,3,.35),PERC:ie(.12,[48,84],se(.001,.04,0,.03),"hihat","highpass",5e3,.5,.4,0,.7,4,.18),PAD:ie(.15,[48,72],se(.6,.3,.75,1.2),"sine","lowpass",900,1,.38,0,.8,3,1),LEAD:ie(.15,[55,84],se(.008,.1,.45,.15),"triangle","lowpass",2e3,1.5,.48,5,.5,3,.22),ARP:ie(.12,[60,96],se(.003,.08,.15,.1),"triangle","lowpass",2800,1,.42,0,.6,3,.14),STRINGS:ie(.12,[48,76],se(.35,.2,.65,1),"triangle","lowpass",1400,1,.38,3,.8,3,.7),CHOIR:ie(.12,[48,72],se(1,.5,.75,2),"sine","lowpass",700,1,.32,0,.9,2,1.5)},syncThreshold:.42,encounterR:.11,entainment:.55,eventRate:.6,reverbAmt:.45,delayAmt:.35,delayTime:.22,masterGain:.8,harmonyMode:"consonant",particleGlow:1.5,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#88aaff",secondary:"#060810",accent:"#ffcc88",gateCount:4,attractorCount:1},{id:"organism-pulse",name:"Organism Pulse",intensity:3,description:"Organismo vivo respirando. Contrao = ritmo, expanso = melodia.",vibe:"Alive, Breath, Organic",tags:["Generative","Experimental","Organic Instruments","Ambient"],bpm:76,scale:"dorian",root:40,quantaCount:96,motionStyle:"organism",roles:{KICK:ie(.12,[24,36],se(.001,.1,0,.06),"kick","lowpass",180,.4,.72,0,.2,3,.5),BASS:ie(.18,[28,48],se(.02,.25,.65,.2),"sine","lowpass",220,1,.55,0,.3,3,.4),PAD:ie(.25,[42,66],se(1,.5,.8,2),"triangle","lowpass",700,1.2,.42,5,.8,3,1.2),LEAD:ie(.18,[55,80],se(.01,.12,.42,.18),"triangle","lowpass",1800,1.5,.45,0,.5,3,.25),STRINGS:ie(.15,[48,72],se(.4,.3,.65,1),"triangle","lowpass",1200,1,.38,3,.7,2,.8),CHOIR:ie(.12,[48,72],se(1.2,.5,.75,2.5),"sine","lowpass",650,1,.32,0,.9,2,1.5)},syncThreshold:.38,encounterR:.13,entainment:.45,eventRate:.5,reverbAmt:.55,delayAmt:.4,delayTime:.3,masterGain:.75,harmonyMode:"modal",particleGlow:1.8,trailLen:0,lens:"Events",bgPulse:!1,cinematic:!0,primary:"#44ff88",secondary:"#040a06",accent:"#ff88cc",gateCount:3,attractorCount:1},{id:"predator-prey",name:"Predator Prey",intensity:4,description:"Roles perseguem e fogem. A tenso da caa vira tenso harmnica.",vibe:"Hunt, Flight, Tension",tags:["Experimental","Dynamic","Generative"],bpm:112,scale:"harmonic_minor",root:40,quantaCount:88,motionStyle:"predation",roles:{KICK:ie(.12,[24,36],se(.001,.07,0,.05),"kick","lowpass",200,.5,.82,0,.2,4,.4),BASS:ie(.18,[28,52],se(.008,.2,.55,.12),"sawtooth","lowpass",300,2.5,.65,-3,.3,3,.25),PERC:ie(.18,[48,84],se(.001,.05,0,.03),"snare","bandpass",3e3,.6,.48,0,.7,5,.15),LEAD:ie(.22,[52,88],se(.005,.08,.4,.12),"sawtooth","lowpass",2e3,3,.55,7,.5,3,.18),PAD:ie(.15,[42,66],se(.3,.2,.6,.8),"triangle","lowpass",700,1.5,.38,0,.7,2,.7),ARP:ie(.15,[60,90],se(.003,.08,.15,.1),"square","lowpass",2500,2,.42,0,.6,3,.12)},syncThreshold:.48,encounterR:.1,entainment:.6,eventRate:.75,reverbAmt:.3,delayAmt:.25,delayTime:.15,masterGain:.8,harmonyMode:"dissonant",particleGlow:1.4,trailLen:0,lens:"Tension",bgPulse:!0,cinematic:!0,primary:"#ff4422",secondary:"#0a0204",accent:"#44ffcc",gateCount:5,attractorCount:2},{id:"exodus-song",name:"Exodus Migration",intensity:4,description:"Migrao em massa cruzando portais sonoros. pico e linear.",vibe:"Epic, Linear, Journey",tags:["Generative","Dynamic","Orchestral","Experimental"],bpm:94,scale:"mixolydian",root:45,quantaCount:112,motionStyle:"exodus",roles:{KICK:ie(.1,[24,36],se(.001,.08,0,.05),"kick","lowpass",180,.4,.78,0,.2,3,.45),BASS:ie(.15,[28,48],se(.01,.2,.55,.15),"triangle","lowpass",300,1.5,.55,0,.3,3,.3),STRINGS:ie(.25,[42,72],se(.3,.2,.65,1),"triangle","lowpass",1400,1,.42,5,.8,3,.7),LEAD:ie(.2,[55,84],se(.01,.1,.45,.15),"sawtooth","lowpass",2e3,2,.5,0,.5,3,.22),PAD:ie(.15,[42,66],se(.6,.3,.75,1.5),"sine","lowpass",800,1,.38,0,.8,2,1),CHOIR:ie(.15,[48,72],se(1,.5,.75,2),"sine","lowpass",700,1,.35,0,.9,2,1.5)},syncThreshold:.42,encounterR:.12,entainment:.5,eventRate:.6,reverbAmt:.5,delayAmt:.4,delayTime:.25,masterGain:.78,harmonyMode:"modal",particleGlow:1.6,trailLen:0,lens:"Events",bgPulse:!1,cinematic:!0,primary:"#88ff44",secondary:"#060a04",accent:"#ffaa44",gateCount:5,attractorCount:0},{id:"polarization-duet",name:"Polarization Duet",intensity:3,description:"Duas polaridades harmnicas emergem. Consonncia vs dissonncia viva.",vibe:"Duality, Contrast, Tension",tags:["Experimental","Generative","Dynamic"],bpm:84,scale:"harmonic_minor",root:48,quantaCount:80,motionStyle:"polarization",roles:{PAD:ie(.25,[42,66],se(.6,.3,.75,1.5),"sawtooth","lowpass",700,2,.42,5,.8,3,1),LEAD:ie(.22,[52,84],se(.01,.1,.42,.15),"triangle","lowpass",2e3,1.5,.48,0,.5,3,.22),STRINGS:ie(.2,[48,76],se(.35,.2,.65,1),"triangle","lowpass",1400,1,.38,3,.8,2,.7),BASS:ie(.18,[28,52],se(.02,.25,.6,.2),"sine","lowpass",250,1,.55,0,.3,3,.4),CHOIR:ie(.15,[48,72],se(1,.5,.75,2),"sine","lowpass",650,1,.32,0,.9,2,1.5)},syncThreshold:.38,encounterR:.14,entainment:.45,eventRate:.5,reverbAmt:.55,delayAmt:.45,delayTime:.35,masterGain:.72,harmonyMode:"modal",particleGlow:1.8,trailLen:0,lens:"Tension",bgPulse:!1,cinematic:!0,primary:"#ff8800",secondary:"#080404",accent:"#4488ff",gateCount:4,attractorCount:1},{id:"revolution-spiral",name:"Revolution Spiral",intensity:4,description:"Espiral que aperta at explodir. Cada colapso  um clmax musical.",vibe:"Tightening, Release, Cycle",tags:["Experimental","Dynamic","Generative"],bpm:108,scale:"phrygian",root:40,quantaCount:96,motionStyle:"revolution",roles:{KICK:ie(.12,[24,36],se(.001,.08,0,.05),"kick","lowpass",200,.5,.82,0,.2,4,.4),BASS:ie(.18,[28,52],se(.005,.18,.55,.12),"sawtooth","lowpass",320,3,.65,-5,.3,3,.22),LEAD:ie(.25,[52,84],se(.005,.08,.4,.1),"sawtooth","lowpass",1800,3,.55,7,.5,3,.16),PERC:ie(.18,[48,84],se(.001,.05,0,.03),"snare","bandpass",3e3,.6,.48,0,.7,5,.14),PAD:ie(.15,[42,66],se(.3,.2,.55,.6),"triangle","lowpass",600,1.5,.38,0,.6,2,.6),ARP:ie(.12,[60,96],se(.003,.06,.12,.08),"square","lowpass",2600,2,.42,0,.6,3,.1)},syncThreshold:.5,encounterR:.1,entainment:.65,eventRate:.8,reverbAmt:.3,delayAmt:.25,delayTime:.15,masterGain:.82,harmonyMode:"dissonant",particleGlow:1.5,trailLen:0,lens:"Tension",bgPulse:!0,cinematic:!0,primary:"#cc44ff",secondary:"#0a0210",accent:"#44ffcc",gateCount:5,attractorCount:2},{id:"explosion-nebula",name:"Explosion Nebula",intensity:5,description:"Exploses cclicas. Cada expanso espalha fragmentos meldicos.",vibe:"Burst, Debris, Cosmic",tags:["Experimental","Space","Dynamic","Generative"],bpm:96,scale:"whole_tone",root:42,quantaCount:104,motionStyle:"explosion",roles:{KICK:ie(.12,[24,36],se(.001,.06,0,.04),"kick","lowpass",200,.5,.85,0,.2,5,.35),PERC:ie(.22,[48,84],se(.001,.04,0,.03),"snare","bandpass",3500,.8,.5,0,.8,5,.12),LEAD:ie(.25,[52,88],se(.003,.08,.3,.1),"triangle","lowpass",2500,2,.5,5,.5,3,.14),ARP:ie(.18,[60,96],se(.002,.06,.12,.08),"triangle","highpass",2e3,1.5,.42,12,.7,3,.1),PAD:ie(.12,[42,66],se(.3,.2,.5,.5),"sine","lowpass",650,1,.35,0,.6,2,.6),STRINGS:ie(.11,[48,72],se(.2,.2,.55,.8),"triangle","lowpass",1200,1,.35,0,.7,2,.7)},syncThreshold:.5,encounterR:.1,entainment:.6,eventRate:.8,reverbAmt:.4,delayAmt:.35,delayTime:.2,masterGain:.8,harmonyMode:"free",particleGlow:1.8,trailLen:0,lens:"Events",bgPulse:!0,cinematic:!0,primary:"#ff6600",secondary:"#0a0400",accent:"#88ccff",gateCount:5,attractorCount:1},{id:"sitar-raga",name:"Sitar Raga Meditation",intensity:2,description:"Raga emergente com drone tanpura. Espiral meditativa.",vibe:"Raga, Drone, Tanpura",tags:["Modal","Meditative","Strings","Ambient"],bpm:68,scale:"phrygian",root:45,quantaCount:72,motionStyle:"spiral",roles:{STRINGS:ie(.35,[48,84],se(.01,.12,.45,.3),"triangle","bandpass",1600,3,.5,7,.7,3,.25),PAD:ie(.25,[36,60],se(2,.8,.85,3.5),"sine","lowpass",350,1,.45,0,.8,3,2),LEAD:ie(.2,[55,84],se(.008,.1,.4,.2),"triangle","lowpass",2200,2,.48,0,.5,3,.22),BASS:ie(.1,[28,42],se(.5,.4,.8,2),"sine","lowpass",180,.8,.5,0,.2,2,1.5),CHOIR:ie(.1,[48,72],se(1.5,.6,.75,2.5),"sine","lowpass",600,1,.3,0,.9,2,2)},syncThreshold:.32,encounterR:.15,entainment:.3,eventRate:.35,reverbAmt:.75,delayAmt:.5,delayTime:.45,masterGain:.7,harmonyMode:"modal",particleGlow:2,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#ffd700",secondary:"#0a0800",accent:"#ff6644",gateCount:3,attractorCount:1},{id:"gamelan-bells",name:"Gamelan Bells",intensity:3,description:"Metalofone em grade. Bells e gongs sobrepostos em camadas.",vibe:"Bells, Layers, Ceremony",tags:["Modal","Experimental","Minimalist"],bpm:78,scale:"pentatonic",root:55,quantaCount:72,motionStyle:"lattice",roles:{LEAD:ie(.3,[55,84],se(.003,.2,.1,.5),"triangle","bandpass",2800,3,.5,0,.6,3,.25),ARP:ie(.25,[60,96],se(.002,.15,.08,.4),"triangle","bandpass",3500,2,.45,5,.7,3,.18),PAD:ie(.2,[42,66],se(.8,.4,.7,1.5),"sine","lowpass",600,1,.38,0,.8,2,1),BASS:ie(.15,[28,48],se(.05,.3,.65,.5),"sine","lowpass",250,1,.5,0,.3,2,.5),PERC:ie(.1,[60,84],se(.001,.08,0,.06),"noise","bandpass",4e3,.4,.38,0,.6,3,.2)},syncThreshold:.38,encounterR:.12,entainment:.45,eventRate:.55,reverbAmt:.65,delayAmt:.5,delayTime:.32,masterGain:.72,harmonyMode:"consonant",particleGlow:1.4,trailLen:0,lens:"Notes",bgPulse:!1,cinematic:!1,primary:"#ffd700",secondary:"#0c0a04",accent:"#ff4400",gateCount:4,attractorCount:1},{id:"flamenco",name:"Flamenco Duende",intensity:4,description:"Espiral flamenca. Cada volta aperta a intensidade at o grito.",vibe:"Fire, Passion, Spiral",tags:["Modal","Dynamic","Strings","Groove"],bpm:118,scale:"phrygian",root:40,quantaCount:80,motionStyle:"revolution",roles:{STRINGS:ie(.3,[48,80],se(.005,.08,.35,.12),"triangle","bandpass",1800,3,.55,0,.7,3,.16),PERC:ie(.25,[48,72],se(.001,.05,0,.03),"snare","bandpass",2500,.6,.5,0,.7,5,.12),BASS:ie(.18,[28,48],se(.01,.15,.5,.1),"triangle","lowpass",300,2,.55,0,.3,3,.22),LEAD:ie(.15,[55,88],se(.003,.06,.38,.1),"sawtooth","lowpass",2200,3,.5,5,.5,3,.14),PAD:ie(.12,[40,60],se(.2,.2,.5,.5),"sine","lowpass",500,1.5,.35,0,.6,2,.6)},syncThreshold:.5,encounterR:.1,entainment:.65,eventRate:.8,reverbAmt:.25,delayAmt:.2,delayTime:.12,masterGain:.82,harmonyMode:"modal",particleGlow:1.3,trailLen:0,lens:"Rhythm",bgPulse:!0,cinematic:!0,primary:"#ff2200",secondary:"#0a0200",accent:"#ffd700",gateCount:5,attractorCount:2},{id:"saharan-blues",name:"Saharan Blues",intensity:3,description:"Caravana no deserto. Blues do Sahara com groove hipntico.",vibe:"Desert, Trance, Groove",tags:["Modal","Groove","Experimental"],bpm:108,scale:"blues",root:40,quantaCount:72,motionStyle:"migration",roles:{LEAD:ie(.3,[55,84],se(.005,.1,.4,.15),"triangle","lowpass",2e3,2,.48,5,.5,3,.2),BASS:ie(.2,[28,48],se(.01,.2,.55,.15),"triangle","lowpass",300,1.5,.55,0,.3,3,.3),PERC:ie(.22,[48,84],se(.001,.05,0,.03),"noise","bandpass",3e3,.5,.45,0,.7,4,.16),PAD:ie(.15,[36,60],se(.5,.3,.65,1),"sine","lowpass",500,1,.38,0,.7,2,.8),STRINGS:ie(.13,[48,72],se(.2,.2,.55,.8),"triangle","lowpass",1200,1,.35,3,.7,2,.7)},syncThreshold:.4,encounterR:.11,entainment:.5,eventRate:.6,reverbAmt:.4,delayAmt:.35,delayTime:.22,masterGain:.78,harmonyMode:"modal",particleGlow:1.2,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#cc8844",secondary:"#0a0604",accent:"#44aaff",gateCount:4,attractorCount:0},{id:"cello-solo",name:"Cello Solo",intensity:2,description:"Partcula solitria vagando. Timbre de cello em sawtooth filtrado.",vibe:"Solo, Intimate, Melancholy",tags:["Strings","Soft","Ambient","Classical"],bpm:56,scale:"minor",root:36,quantaCount:32,motionStyle:"drift",roles:{STRINGS:ie(.5,[36,72],se(.15,.15,.65,1.5),"sawtooth","lowpass",1200,2,.5,3,.6,2,.4),PAD:ie(.3,[36,60],se(1.2,.5,.78,2.5),"sine","lowpass",600,1,.35,0,.8,2,1.5),CHOIR:ie(.2,[48,66],se(1,.4,.7,2),"sine","lowpass",550,.9,.28,0,.9,2,2)},syncThreshold:.25,encounterR:.18,entainment:.2,eventRate:.22,reverbAmt:.72,delayAmt:.45,delayTime:.4,masterGain:.65,harmonyMode:"consonant",particleGlow:2,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#cc8844",secondary:"#0a0604",accent:"#ffeedd",gateCount:2,attractorCount:0},{id:"upright-bass",name:"Jazz Upright Bass",intensity:2,description:"Walking bass line emergente. Tom de madeira com harmnicos naturais.",vibe:"Walking, Woody, Groove",tags:["Jazz","Strings","Groove"],bpm:92,scale:"dorian",root:28,quantaCount:48,motionStyle:"flow",roles:{BASS:ie(.45,[28,52],se(.015,.18,.55,.2),"triangle","lowpass",400,1.5,.6,0,.3,3,.22),LEAD:ie(.25,[48,76],se(.01,.1,.4,.15),"triangle","lowpass",1800,1,.45,0,.5,2,.3),PERC:ie(.15,[48,72],se(.001,.05,0,.04),"noise","bandpass",2e3,.4,.38,0,.6,3,.22),PAD:ie(.15,[42,60],se(.4,.3,.65,1),"sine","lowpass",700,1,.32,0,.7,2,.9)},syncThreshold:.35,encounterR:.12,entainment:.4,eventRate:.45,reverbAmt:.45,delayAmt:.3,delayTime:.22,masterGain:.72,harmonyMode:"modal",particleGlow:1,trailLen:0,lens:"Notes",bgPulse:!1,cinematic:!1,primary:"#cc7744",secondary:"#0a0604",accent:"#88ccff",gateCount:3,attractorCount:1},{id:"guitar-pick",name:"Guitar Fingerpick",intensity:3,description:"Grade como trastes. Dedilhado emergente em padres repetitivos.",vibe:"Acoustic, Pattern, Folk",tags:["Strings","Minimalist","Soft","Generative"],bpm:98,scale:"major",root:52,quantaCount:56,motionStyle:"lattice",roles:{LEAD:ie(.35,[52,80],se(.003,.1,.18,.2),"triangle","lowpass",2400,1.5,.48,0,.5,3,.18),ARP:ie(.25,[52,84],se(.002,.08,.12,.15),"triangle","lowpass",3e3,1,.42,0,.6,3,.14),BASS:ie(.2,[36,52],se(.01,.15,.5,.15),"triangle","lowpass",350,1,.52,0,.3,2,.35),PAD:ie(.2,[48,66],se(.5,.3,.6,.8),"sine","lowpass",800,1,.35,0,.7,2,.8)},syncThreshold:.4,encounterR:.1,entainment:.5,eventRate:.55,reverbAmt:.4,delayAmt:.35,delayTime:.2,masterGain:.75,harmonyMode:"consonant",particleGlow:1,trailLen:0,lens:"Notes",bgPulse:!1,cinematic:!1,primary:"#ccaa66",secondary:"#0a0804",accent:"#88aaff",gateCount:4,attractorCount:1},{id:"saxophone",name:"Saxophone Breath",intensity:3,description:"Sopro fluido. Sawtooth+bandpass como timbre de sax tenor.",vibe:"Breath, Fluid, Soul",tags:["Jazz","Improvisation","Modal"],bpm:82,scale:"mixolydian",root:48,quantaCount:56,motionStyle:"flow",roles:{LEAD:ie(.4,[48,80],se(.02,.12,.5,.25),"sawtooth","bandpass",1600,3,.55,5,.5,3,.22),BASS:ie(.2,[28,48],se(.02,.22,.6,.2),"triangle","lowpass",300,1.5,.52,0,.3,2,.35),PAD:ie(.18,[42,66],se(.5,.3,.65,1),"sine","lowpass",700,1,.35,0,.7,2,.8),PERC:ie(.12,[48,72],se(.001,.06,0,.04),"noise","bandpass",2200,.4,.38,0,.6,3,.22),STRINGS:ie(.1,[48,72],se(.3,.2,.55,.8),"triangle","lowpass",1200,1,.32,0,.7,2,.8)},syncThreshold:.35,encounterR:.13,entainment:.4,eventRate:.42,reverbAmt:.5,delayAmt:.35,delayTime:.25,masterGain:.72,harmonyMode:"modal",particleGlow:1.2,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#ffaa44",secondary:"#0a0604",accent:"#88ccff",gateCount:3,attractorCount:1},{id:"darwin-garden",name:"Darwin's Garden",intensity:3,description:"Alta mutao. Roles evoluem. O jardim sonoro se auto-seleciona.",vibe:"Evolution, Mutation, Emergent",tags:["Experimental","Generative","Organic Instruments"],bpm:84,scale:"major",root:48,quantaCount:96,motionStyle:"predation",roles:{KICK:ie(.08,[24,36],se(.001,.08,0,.05),"kick","lowpass",180,.4,.72,0,.2,3,.5),BASS:ie(.12,[28,52],se(.01,.2,.55,.15),"sine","lowpass",250,1,.52,0,.3,3,.35),PERC:ie(.12,[48,84],se(.001,.04,0,.03),"hihat","highpass",5e3,.5,.38,0,.7,4,.18),PAD:ie(.18,[42,66],se(.5,.3,.7,1.2),"sine","lowpass",800,1,.38,0,.8,3,1),LEAD:ie(.15,[55,84],se(.008,.1,.42,.15),"triangle","lowpass",2e3,1.5,.45,0,.5,3,.22),ARP:ie(.12,[60,96],se(.003,.08,.15,.1),"triangle","lowpass",2800,1,.4,0,.6,3,.14),STRINGS:ie(.12,[48,76],se(.3,.2,.6,.8),"triangle","lowpass",1200,1,.35,3,.7,2,.7),CHOIR:ie(.11,[48,72],se(1,.5,.72,2),"sine","lowpass",650,1,.3,0,.9,2,1.5)},syncThreshold:.4,encounterR:.12,entainment:.5,eventRate:.55,reverbAmt:.45,delayAmt:.35,delayTime:.25,masterGain:.75,harmonyMode:"modal",particleGlow:1.5,trailLen:0,lens:"Events",bgPulse:!1,cinematic:!0,primary:"#44cc44",secondary:"#040a04",accent:"#ffaa88",gateCount:4,attractorCount:1},{id:"ant-colony",name:"Ant Colony",intensity:3,description:"Colnia densa com alinhamento apertado. Ritmo emergente do coletivo.",vibe:"Collective, Dense, Pattern",tags:["Generative","Experimental","Groove"],bpm:116,scale:"minor",root:40,quantaCount:128,motionStyle:"school",roles:{KICK:ie(.15,[24,36],se(.001,.06,0,.04),"kick","lowpass",180,.4,.78,0,.2,4,.4),PERC:ie(.28,[48,84],se(.001,.04,0,.02),"noise","bandpass",3500,.6,.45,0,.7,5,.12),BASS:ie(.18,[28,48],se(.008,.15,.5,.1),"triangle","lowpass",280,1.5,.55,0,.3,3,.25),LEAD:ie(.15,[55,80],se(.005,.08,.35,.1),"square","lowpass",1600,2,.45,0,.5,3,.18),ARP:ie(.14,[60,90],se(.002,.06,.12,.08),"triangle","lowpass",2500,1.5,.4,0,.6,3,.1),PAD:ie(.1,[42,60],se(.3,.2,.55,.6),"sine","lowpass",600,1,.32,0,.6,2,.7)},syncThreshold:.45,encounterR:.09,entainment:.6,eventRate:.7,reverbAmt:.2,delayAmt:.2,delayTime:.12,masterGain:.8,harmonyMode:"modal",particleGlow:1,trailLen:0,lens:"Rhythm",bgPulse:!1,cinematic:!1,primary:"#ff8844",secondary:"#0a0604",accent:"#44ff88",gateCount:5,attractorCount:1},{id:"neural-net",name:"Neural Network",intensity:3,description:"Pares formam sinapses. Cada conexo dispara uma nota. Crebro vivo.",vibe:"Synapses, Connections, Intelligence",tags:["Generative","Experimental","Electronic"],bpm:92,scale:"whole_tone",root:48,quantaCount:80,motionStyle:"dance",roles:{LEAD:ie(.25,[55,88],se(.003,.08,.3,.1),"triangle","lowpass",2500,2,.48,5,.5,3,.16),ARP:ie(.22,[60,96],se(.002,.06,.12,.08),"square","lowpass",3e3,1.5,.42,0,.7,3,.1),PAD:ie(.2,[42,66],se(.4,.3,.6,.8),"sine","lowpass",700,1,.35,0,.7,2,.7),PERC:ie(.15,[48,72],se(.001,.04,0,.02),"noise","highpass",4500,.4,.38,0,.6,4,.14),BASS:ie(.1,[28,48],se(.01,.2,.5,.12),"triangle","lowpass",280,1.5,.48,0,.3,2,.3),STRINGS:ie(.08,[48,72],se(.3,.2,.55,.8),"triangle","lowpass",1200,1,.32,3,.7,2,.8)},syncThreshold:.42,encounterR:.1,entainment:.55,eventRate:.6,reverbAmt:.4,delayAmt:.35,delayTime:.2,masterGain:.75,harmonyMode:"free",particleGlow:1.5,trailLen:0,lens:"Events",bgPulse:!1,cinematic:!0,primary:"#00e5ff",secondary:"#040810",accent:"#ff88cc",gateCount:4,attractorCount:1},{id:"idm-lattice",name:"IDM Lattice",intensity:4,description:"Grade quebrando patterns em ritmos impossveis. Autechre digital.",vibe:"Glitch, Grid, Broken",tags:["Experimental","Electronic","Glitch"],bpm:136,scale:"chromatic",root:48,quantaCount:72,motionStyle:"lattice",roles:{PERC:ie(.28,[48,96],se(.001,.03,0,.02),"noise","bandpass",4e3,4,.5,0,.8,5,.08),BASS:ie(.22,[28,52],se(.002,.1,.4,.05),"square","lowpass",350,6,.6,-7,.3,3,.15),LEAD:ie(.22,[52,96],se(.002,.06,.25,.06),"square","bandpass",2e3,5,.48,12,.6,3,.1),ARP:ie(.15,[60,96],se(.001,.04,.08,.04),"square","highpass",2500,3,.4,0,.7,3,.06),PAD:ie(.13,[42,60],se(.1,.15,.35,.3),"sawtooth","lowpass",600,2,.32,0,.5,2,.5)},syncThreshold:.55,encounterR:.08,entainment:.7,eventRate:.9,reverbAmt:.15,delayAmt:.2,delayTime:.09,masterGain:.78,harmonyMode:"free",particleGlow:1,trailLen:0,lens:"Rhythm",bgPulse:!1,cinematic:!1,primary:"#00e5ff",secondary:"#000a0c",accent:"#ff00ff",gateCount:6,attractorCount:2},{id:"ambient-house",name:"Ambient House",intensity:3,description:"4/4 suave em neblina. Warmth de pads com groove gentil.",vibe:"Warm, Hazy, Sunday",tags:["Ambient","Club","Electronic","Soft"],bpm:118,scale:"major",root:48,quantaCount:80,motionStyle:"drift",roles:{KICK:ie(.15,[24,36],se(.001,.12,0,.08),"kick","lowpass",160,.4,.72,0,.2,3,.5),BASS:ie(.18,[36,52],se(.01,.2,.55,.15),"sine","lowpass",250,1,.52,0,.3,3,.35),PAD:ie(.28,[48,72],se(.6,.3,.78,1.5),"sawtooth","lowpass",800,2,.45,5,.8,3,.9),LEAD:ie(.18,[60,84],se(.01,.1,.4,.18),"triangle","lowpass",2e3,1.5,.42,0,.5,2,.3),ARP:ie(.12,[60,88],se(.003,.08,.15,.12),"triangle","lowpass",2800,1,.38,0,.6,2,.2),PERC:ie(.09,[60,72],se(.001,.04,0,.03),"hihat","highpass",5e3,.4,.35,0,.6,3,.22)},syncThreshold:.4,encounterR:.11,entainment:.45,eventRate:.55,reverbAmt:.55,delayAmt:.45,delayTime:.28,masterGain:.78,harmonyMode:"consonant",particleGlow:1.5,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#88ccff",secondary:"#060810",accent:"#ffcc88",gateCount:4,attractorCount:1},{id:"trance-gates",name:"Trance Gates",intensity:5,description:"Flock murmuration cruzando portais. Arpejos hipnticos em cascata.",vibe:"Euphoria, Cascade, Energy",tags:["Electronic","Club","Rave"],bpm:140,scale:"minor",root:45,quantaCount:120,motionStyle:"murmuration",roles:{KICK:ie(.18,[24,36],se(.001,.07,0,.05),"kick","lowpass",200,.5,.88,0,.2,5,.35),BASS:ie(.16,[36,52],se(.005,.15,.55,.08),"sawtooth","lowpass",300,2,.68,-5,.3,3,.25),ARP:ie(.28,[60,96],se(.003,.08,.12,.1),"sawtooth","lowpass",2800,3,.55,7,.7,4,.08),LEAD:ie(.18,[55,84],se(.01,.1,.45,.15),"sawtooth","lowpass",2200,3,.52,5,.5,3,.18),PAD:ie(.12,[48,66],se(.3,.2,.65,.8),"sawtooth","lowpass",600,2,.38,0,.7,2,.8),PERC:ie(.08,[60,84],se(.001,.04,0,.02),"hihat","highpass",6e3,.4,.4,0,.7,4,.14)},syncThreshold:.55,encounterR:.1,entainment:.7,eventRate:.9,reverbAmt:.3,delayAmt:.35,delayTime:.15,masterGain:.85,harmonyMode:"modal",particleGlow:1.6,trailLen:0,lens:"Rhythm",bgPulse:!0,cinematic:!0,primary:"#cc44ff",secondary:"#0a0210",accent:"#44ffcc",gateCount:6,attractorCount:2},{id:"lofi-rain",name:"Lo-fi Rain",intensity:2,description:"Tudo filtrado como vinil. Chuva orgnica. Warmth nostlgica.",vibe:"Warm, Vintage, Rain",tags:["Ambient","Soft","Electronic","Groove"],bpm:75,scale:"pentatonic",root:48,quantaCount:56,motionStyle:"organism",roles:{KICK:ie(.12,[24,36],se(.001,.12,0,.08),"kick","lowpass",120,.3,.65,0,.2,2,.55),BASS:ie(.18,[36,52],se(.015,.25,.55,.2),"sine","lowpass",200,1,.48,0,.3,2,.4),PAD:ie(.28,[48,66],se(.8,.4,.75,1.5),"sine","lowpass",550,1,.38,0,.8,2,1.2),LEAD:ie(.2,[55,76],se(.01,.12,.38,.2),"triangle","lowpass",1200,1,.42,0,.4,2,.35),PERC:ie(.12,[48,72],se(.001,.06,0,.04),"noise","lowpass",2e3,.3,.32,0,.5,3,.25),ARP:ie(.1,[60,84],se(.005,.1,.15,.12),"triangle","lowpass",1800,1,.35,0,.5,2,.3)},syncThreshold:.32,encounterR:.14,entainment:.35,eventRate:.4,reverbAmt:.6,delayAmt:.45,delayTime:.3,masterGain:.7,harmonyMode:"consonant",particleGlow:1.2,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#ccaa88",secondary:"#0a0804",accent:"#88aacc",gateCount:3,attractorCount:1},{id:"film-noir",name:"Film Noir",intensity:2,description:"Suspense lento em flow. Sombras harmnicas, tenso cromtica.",vibe:"Suspense, Shadow, Mystery",tags:["Ambient","Dark","Experimental"],bpm:58,scale:"harmonic_minor",root:36,quantaCount:56,motionStyle:"flow",roles:{PAD:ie(.3,[36,60],se(1,.5,.75,2),"sawtooth","lowpass",500,2,.42,5,.8,3,1.2),STRINGS:ie(.25,[42,72],se(.5,.3,.65,1.2),"triangle","lowpass",1100,1,.38,3,.7,2,.8),BASS:ie(.18,[24,42],se(.1,.3,.65,1),"sine","lowpass",180,1,.5,0,.3,2,.6),LEAD:ie(.15,[52,80],se(.02,.12,.4,.2),"triangle","lowpass",1600,1.5,.42,0,.5,2,.35),CHOIR:ie(.12,[48,66],se(1.2,.5,.72,2.5),"sine","lowpass",550,.9,.3,0,.9,2,2)},syncThreshold:.28,encounterR:.15,entainment:.25,eventRate:.25,reverbAmt:.72,delayAmt:.5,delayTime:.45,masterGain:.65,harmonyMode:"dissonant",particleGlow:1.8,trailLen:0,lens:"Tension",bgPulse:!1,cinematic:!0,primary:"#8888aa",secondary:"#040408",accent:"#ff6644",gateCount:2,attractorCount:1},{id:"epic-crescendo",name:"Epic Crescendo",intensity:5,description:"Migrao pica para o clmax. Orquestra completa em movimento.",vibe:"Epic, Climax, Power",tags:["Orchestral","Dynamic","Cinematic"],bpm:96,scale:"major",root:48,quantaCount:128,motionStyle:"exodus",roles:{KICK:ie(.1,[24,36],se(.001,.08,0,.05),"kick","lowpass",200,.5,.82,0,.2,4,.4),BASS:ie(.12,[28,48],se(.01,.2,.55,.15),"triangle","lowpass",300,1.5,.55,0,.3,3,.3),PERC:ie(.1,[48,72],se(.001,.06,0,.04),"snare","bandpass",3e3,.5,.45,0,.7,4,.2),STRINGS:ie(.22,[42,76],se(.15,.15,.65,1.2),"sawtooth","lowpass",1400,1.5,.48,5,.8,3,.5),LEAD:ie(.15,[55,88],se(.01,.1,.48,.15),"sawtooth","lowpass",2200,2,.5,3,.5,3,.2),PAD:ie(.12,[42,66],se(.5,.3,.72,1.5),"sine","lowpass",800,1,.38,0,.8,2,.9),CHOIR:ie(.12,[48,72],se(.8,.4,.75,2),"sine","lowpass",700,1,.35,0,.9,2,1.2),ARP:ie(.07,[60,90],se(.003,.08,.15,.1),"triangle","lowpass",2800,1,.38,0,.6,2,.14)},syncThreshold:.48,encounterR:.11,entainment:.55,eventRate:.7,reverbAmt:.55,delayAmt:.4,delayTime:.25,masterGain:.82,harmonyMode:"consonant",particleGlow:1.8,trailLen:0,lens:"Events",bgPulse:!0,cinematic:!0,primary:"#ffd700",secondary:"#0a0800",accent:"#ff4400",gateCount:6,attractorCount:1},{id:"horror-cells",name:"Horror Cells",intensity:4,description:"Clusters orgnicos pulsando. Dissonncia cromtica. Tenso visceral.",vibe:"Terror, Visceral, Organism",tags:["Experimental","Dark","Cinematic"],bpm:66,scale:"chromatic",root:36,quantaCount:72,motionStyle:"cells",roles:{PAD:ie(.3,[30,60],se(.8,.4,.7,2),"sawtooth","lowpass",400,3,.45,7,.8,3,1),STRINGS:ie(.25,[36,72],se(.1,.2,.5,.8),"sawtooth","bandpass",1200,4,.42,12,.7,3,.5),BASS:ie(.18,[24,42],se(.1,.3,.65,1.5),"sine","lowpass",150,1,.55,0,.3,2,.6),PERC:ie(.15,[36,72],se(.001,.08,0,.05),"noise","bandpass",2e3,.5,.38,0,.6,4,.2),CHOIR:ie(.12,[42,60],se(1.5,.6,.7,3),"sine","lowpass",450,1,.3,0,.9,2,2.5)},syncThreshold:.35,encounterR:.14,entainment:.35,eventRate:.4,reverbAmt:.7,delayAmt:.55,delayTime:.5,masterGain:.68,harmonyMode:"dissonant",particleGlow:2.2,trailLen:0,lens:"Tension",bgPulse:!1,cinematic:!0,primary:"#ff3333",secondary:"#080004",accent:"#880066",gateCount:3,attractorCount:1},{id:"quantum-tunneling",name:"Quantum Tunneling",intensity:4,description:"Partculas rpidas atravessando portais de gate. Cascatas qunticas.",vibe:"Portal, Speed, Quantum",tags:["Experimental","Electronic","Generative"],bpm:128,scale:"whole_tone",root:48,quantaCount:96,motionStyle:"swarm",roles:{LEAD:ie(.25,[52,96],se(.002,.06,.25,.06),"triangle","lowpass",3e3,2,.48,5,.6,3,.1),ARP:ie(.25,[60,96],se(.001,.04,.1,.05),"triangle","highpass",2500,1.5,.42,12,.7,4,.06),PERC:ie(.2,[48,84],se(.001,.03,0,.02),"noise","bandpass",4e3,.5,.4,0,.7,5,.08),BASS:ie(.15,[36,52],se(.003,.12,.45,.08),"square","lowpass",350,3,.55,-5,.3,3,.18),PAD:ie(.15,[42,66],se(.2,.15,.45,.3),"sine","lowpass",700,1,.32,0,.6,2,.5)},syncThreshold:.55,encounterR:.08,entainment:.7,eventRate:.95,reverbAmt:.25,delayAmt:.3,delayTime:.12,masterGain:.8,harmonyMode:"free",particleGlow:1.2,trailLen:0,lens:"Notes",bgPulse:!0,cinematic:!1,primary:"#00e5ff",secondary:"#000a0c",accent:"#ff88cc",gateCount:8,attractorCount:2},{id:"ambient-cosmos",name:"Ambient Cosmos",intensity:1,description:"38bpm mega-ambient  9 camadas harmnicas, whole_tone, reverb infinito.",vibe:"Infinite, Vast, Breathing",tags:["Ambient","Space","Drone","Meditative"],bpm:38,scale:"whole_tone",root:48,quantaCount:64,motionStyle:"meditation",roles:{PAD:ie(.25,[36,60],se(3,1,.88,5),"sine","lowpass",500,.7,.38,0,.9,3,3.5),CHOIR:ie(.2,[48,72],se(2.5,.8,.82,4),"sine","lowpass",600,.9,.32,0,1,2,3),STRINGS:ie(.2,[42,72],se(1.5,.6,.72,3),"triangle","lowpass",900,1,.35,5,.8,2,2.5),LEAD:ie(.15,[55,84],se(.3,.2,.5,.8),"triangle","lowpass",1400,1,.28,0,.5,2,.8),BASS:ie(.1,[24,42],se(.8,.5,.8,3),"sine","lowpass",150,.6,.45,0,.2,2,2),ARP:ie(.1,[60,96],se(.1,.15,.2,.5),"triangle","highpass",2200,1.2,.22,12,.7,2,1)},syncThreshold:.2,encounterR:.22,entainment:.15,eventRate:.1,reverbAmt:.98,delayAmt:.75,delayTime:.85,masterGain:.55,harmonyMode:"consonant",particleGlow:3,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#8888ff",secondary:"#020208",accent:"#ffddaa",gateCount:1,attractorCount:0},{id:"polyrhythm",name:"Polyrhythm Engine",intensity:4,description:"3 vrtices em velocidades diferentes. Polirritmia emergente 3:4:5.",vibe:"Complex, Layered, Polyrhythm",tags:["Groove","Experimental","Dynamic","Generative"],bpm:110,scale:"dorian",root:45,quantaCount:96,motionStyle:"carnival",roles:{KICK:ie(.15,[24,36],se(.001,.07,0,.05),"kick","lowpass",200,.5,.82,0,.2,4,.38),PERC:ie(.25,[48,84],se(.001,.04,0,.02),"snare","bandpass",3e3,.6,.48,0,.8,5,.12),BASS:ie(.18,[28,52],se(.008,.15,.52,.1),"triangle","lowpass",300,2,.58,0,.3,3,.2),LEAD:ie(.18,[55,84],se(.005,.08,.38,.12),"triangle","lowpass",2e3,1.5,.45,0,.5,3,.16),ARP:ie(.14,[60,96],se(.002,.06,.12,.08),"square","lowpass",2600,2,.4,0,.6,3,.1),PAD:ie(.1,[42,60],se(.3,.2,.55,.6),"sine","lowpass",600,1,.32,0,.6,2,.7)},syncThreshold:.48,encounterR:.1,entainment:.65,eventRate:.75,reverbAmt:.25,delayAmt:.3,delayTime:.18,masterGain:.8,harmonyMode:"modal",particleGlow:1.3,trailLen:0,lens:"Rhythm",bgPulse:!0,cinematic:!1,primary:"#ffcc00",secondary:"#0a0800",accent:"#ff3366",gateCount:5,attractorCount:3},{id:"all-voices",name:"All 8 Voices",intensity:3,description:"Todas as 8 roles em equilbrio. A paleta completa do Music Lab.",vibe:"Complete, Balanced, Showcase",tags:["Generative","Orchestral","Groove"],bpm:96,scale:"major",root:48,quantaCount:112,motionStyle:"murmuration",roles:{KICK:ie(.12,[24,36],se(.001,.08,0,.05),"kick","lowpass",180,.4,.78,0,.2,3,.45),BASS:ie(.12,[28,52],se(.01,.2,.55,.15),"sine","lowpass",260,1,.52,0,.3,3,.32),PERC:ie(.12,[48,84],se(.001,.05,0,.03),"hihat","highpass",5e3,.5,.42,0,.7,4,.16),PAD:ie(.14,[48,72],se(.5,.3,.72,1.2),"sine","lowpass",800,1,.38,0,.8,3,.9),LEAD:ie(.14,[55,84],se(.008,.1,.42,.15),"triangle","lowpass",2e3,1.5,.45,0,.5,3,.22),ARP:ie(.12,[60,96],se(.003,.08,.15,.1),"triangle","lowpass",2800,1,.4,0,.6,3,.14),STRINGS:ie(.12,[48,76],se(.35,.2,.62,1),"triangle","lowpass",1400,1,.36,3,.8,2,.7),CHOIR:ie(.12,[48,72],se(1,.5,.72,2),"sine","lowpass",650,1,.3,0,.9,2,1.5)},syncThreshold:.4,encounterR:.11,entainment:.5,eventRate:.55,reverbAmt:.45,delayAmt:.35,delayTime:.22,masterGain:.78,harmonyMode:"consonant",particleGlow:1.3,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#88aaff",secondary:"#060810",accent:"#ffcc88",gateCount:4,attractorCount:1},{id:"solo-particle",name:"Solo Particle",intensity:1,description:"Uma nica partcula. Cada gate crossing  uma performance solo.",vibe:"Solitude, Focus, Pure",tags:["Minimalist","Experimental","Soft"],bpm:64,scale:"pentatonic",root:60,quantaCount:1,motionStyle:"drift",roles:{LEAD:ie(1,[48,84],se(.01,.12,.45,.3),"triangle","lowpass",2e3,1.5,.55,0,.5,2,.3)},syncThreshold:.2,encounterR:.2,entainment:.1,eventRate:.3,reverbAmt:.8,delayAmt:.6,delayTime:.5,masterGain:.7,harmonyMode:"consonant",particleGlow:3,trailLen:0,lens:"Notes",bgPulse:!1,cinematic:!0,primary:"#ffffff",secondary:"#020204",accent:"#88aaff",gateCount:3,attractorCount:0},{id:"max-density",name:"Maximum Density",intensity:5,description:"256 partculas em swarm. Textura pura. Som como fenmeno coletivo.",vibe:"Mass, Texture, Swarm",tags:["Experimental","Drone","Electronic"],bpm:120,scale:"chromatic",root:36,quantaCount:256,motionStyle:"swarm",roles:{PERC:ie(.25,[36,96],se(.001,.03,0,.02),"noise","bandpass",3e3,2,.4,0,.8,6,.06),LEAD:ie(.25,[48,96],se(.001,.04,.1,.04),"square","lowpass",2500,4,.35,0,.6,4,.08),ARP:ie(.2,[60,96],se(.001,.03,.05,.03),"triangle","highpass",3500,2,.3,0,.7,4,.05),BASS:ie(.15,[24,48],se(.002,.1,.35,.05),"sawtooth","lowpass",250,3,.5,-7,.3,3,.12),PAD:ie(.15,[36,60],se(.1,.1,.3,.2),"sawtooth","lowpass",500,2,.28,5,.5,2,.3)},syncThreshold:.65,encounterR:.06,entainment:.8,eventRate:1.2,reverbAmt:.15,delayAmt:.1,delayTime:.08,masterGain:.7,harmonyMode:"free",particleGlow:.8,trailLen:0,lens:"Events",bgPulse:!0,cinematic:!0,primary:"#ff0055",secondary:"#0a0004",accent:"#00ff88",gateCount:8,attractorCount:3},{id:"gravity-falls",name:"Gravity Falls",intensity:3,description:"Gravidade forte. Partculas ricocheteiam em gates como xilofone.",vibe:"Bounce, Playful, Percussive",tags:["Experimental","Generative","Dynamic"],bpm:90,scale:"major",root:60,quantaCount:48,motionStyle:"ballistic",roles:{LEAD:ie(.35,[60,96],se(.002,.12,.15,.2),"triangle","bandpass",3e3,2,.5,0,.6,3,.16),PERC:ie(.25,[48,84],se(.001,.05,0,.03),"noise","bandpass",2500,.5,.45,0,.7,4,.14),BASS:ie(.2,[36,52],se(.01,.2,.5,.15),"triangle","lowpass",350,1.5,.52,0,.3,3,.3),ARP:ie(.2,[60,88],se(.002,.08,.12,.1),"triangle","lowpass",2800,1,.42,0,.5,3,.12)},syncThreshold:.42,encounterR:.1,entainment:.5,eventRate:.6,reverbAmt:.45,delayAmt:.35,delayTime:.22,masterGain:.75,harmonyMode:"consonant",particleGlow:1.2,trailLen:0,lens:"Notes",bgPulse:!1,cinematic:!1,primary:"#44aaff",secondary:"#040810",accent:"#ffcc44",gateCount:6,attractorCount:0},{id:"noise-meditation",name:"Noise Meditation",intensity:2,description:"Texturas de rudo como meditao. Anti-msica zen. Escuta profunda.",vibe:"Noise, Zen, Deep Listening",tags:["Experimental","Drone","Meditative"],bpm:40,scale:"chromatic",root:36,quantaCount:48,motionStyle:"meditation",roles:{PAD:ie(.4,[24,60],se(2,.8,.82,4),"sawtooth","lowpass",300,2,.4,5,.8,3,2.5),PERC:ie(.3,[36,84],se(.5,.3,.1,1),"noise","bandpass",1500,1,.35,0,.6,3,1),BASS:ie(.15,[24,36],se(1,.5,.8,3),"sine","lowpass",120,.6,.48,0,.2,2,2),STRINGS:ie(.15,[42,72],se(.8,.4,.55,1.5),"sawtooth","bandpass",800,3,.3,12,.7,2,1.5)},syncThreshold:.22,encounterR:.2,entainment:.15,eventRate:.15,reverbAmt:.92,delayAmt:.7,delayTime:.8,masterGain:.55,harmonyMode:"free",particleGlow:2.5,trailLen:0,lens:"Tension",bgPulse:!1,cinematic:!0,primary:"#aaaaaa",secondary:"#040404",accent:"#ff4400",gateCount:1,attractorCount:0},{id:"dance-atoms",name:"Dance of Atoms",intensity:3,description:"Cada par de partculas  um dueto. Valsa atmica em minor harmnica.",vibe:"Waltz, Pairs, Intimate",tags:["Generative","Classical","Experimental"],bpm:88,scale:"harmonic_minor",root:48,quantaCount:64,motionStyle:"dance",roles:{STRINGS:ie(.3,[48,76],se(.1,.12,.55,1),"triangle","lowpass",1400,1.5,.45,3,.7,3,.25),LEAD:ie(.22,[55,84],se(.008,.1,.42,.15),"triangle","lowpass",2e3,1.5,.45,0,.5,3,.2),PAD:ie(.2,[42,66],se(.5,.3,.7,1.2),"sine","lowpass",700,1,.38,0,.8,2,.9),BASS:ie(.15,[28,48],se(.015,.2,.55,.15),"sine","lowpass",250,1,.5,0,.3,2,.35),CHOIR:ie(.13,[48,72],se(.8,.4,.7,1.5),"sine","lowpass",600,1,.3,0,.9,2,1.2)},syncThreshold:.38,encounterR:.13,entainment:.42,eventRate:.5,reverbAmt:.55,delayAmt:.4,delayTime:.3,masterGain:.72,harmonyMode:"consonant",particleGlow:1.6,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#ff88cc",secondary:"#080408",accent:"#88ccff",gateCount:3,attractorCount:1},{id:"storm-chaser",name:"Storm Chaser",intensity:5,description:"Tempestade musical. Caos browniano + exploses cclicas. Trovo.",vibe:"Storm, Thunder, Power",tags:["Experimental","Dynamic","Electronic","Dark"],bpm:144,scale:"minor",root:36,quantaCount:128,motionStyle:"explosion",roles:{KICK:ie(.18,[24,36],se(.001,.06,0,.03),"kick","lowpass",240,.5,.92,0,.2,6,.28),PERC:ie(.25,[36,84],se(.001,.04,0,.02),"snare","bandpass",3500,.8,.55,0,.8,6,.1),BASS:ie(.18,[28,48],se(.003,.12,.5,.06),"sawtooth","lowpass",320,4,.7,-5,.3,4,.15),LEAD:ie(.18,[48,88],se(.002,.06,.3,.06),"sawtooth","lowpass",2200,3,.52,7,.5,3,.12),ARP:ie(.12,[60,96],se(.001,.04,.08,.04),"square","highpass",2800,2,.4,0,.7,4,.06),PAD:ie(.09,[36,60],se(.15,.15,.4,.3),"sawtooth","lowpass",500,2,.3,0,.5,2,.4)},syncThreshold:.6,encounterR:.08,entainment:.8,eventRate:1.1,reverbAmt:.2,delayAmt:.15,delayTime:.1,masterGain:.85,harmonyMode:"dissonant",particleGlow:1.5,trailLen:0,lens:"Events",bgPulse:!0,cinematic:!0,primary:"#ff4400",secondary:"#0a0200",accent:"#00ccff",gateCount:7,attractorCount:2},{id:"silk-road",name:"Silk Road",intensity:3,description:"Viagem pela Rota da Seda. 8 vozes migrando em harmonic minor.",vibe:"Journey, Caravan, Horizon",tags:["Modal","Orchestral","Dynamic","Ambient"],bpm:86,scale:"harmonic_minor",root:40,quantaCount:96,motionStyle:"migration",roles:{KICK:ie(.08,[24,36],se(.001,.1,0,.06),"kick","lowpass",160,.3,.68,0,.2,2,.5),BASS:ie(.12,[28,48],se(.02,.25,.6,.2),"sine","lowpass",220,1,.5,0,.3,2,.4),PERC:ie(.12,[48,72],se(.001,.06,0,.04),"noise","bandpass",2500,.4,.38,0,.6,4,.2),PAD:ie(.18,[36,60],se(.8,.4,.72,1.5),"sine","lowpass",600,1,.38,0,.8,3,1),STRINGS:ie(.18,[42,72],se(.2,.15,.58,1),"triangle","lowpass",1400,1.5,.42,5,.8,3,.5),LEAD:ie(.14,[52,84],se(.01,.1,.42,.15),"triangle","bandpass",1800,2,.45,0,.5,3,.22),CHOIR:ie(.1,[48,72],se(1,.5,.72,2),"sine","lowpass",600,1,.3,0,.9,2,1.5),ARP:ie(.08,[60,88],se(.005,.08,.15,.12),"triangle","lowpass",2400,1,.35,0,.6,2,.18)},syncThreshold:.38,encounterR:.12,entainment:.42,eventRate:.5,reverbAmt:.55,delayAmt:.45,delayTime:.32,masterGain:.72,harmonyMode:"modal",particleGlow:1.5,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#cc8844",secondary:"#0a0604",accent:"#88ccff",gateCount:4,attractorCount:0},{id:"cells-life",name:"Cells of Life",intensity:3,description:"Simulao de vida como msica. Clulas respiram, dividem, cantam.",vibe:"Life, Breath, Organic",tags:["Generative","Experimental","Organic Instruments"],bpm:80,scale:"lydian",root:48,quantaCount:104,motionStyle:"cells",roles:{KICK:ie(.08,[24,36],se(.001,.1,0,.06),"kick","lowpass",160,.3,.65,0,.2,2,.55),BASS:ie(.12,[28,48],se(.02,.25,.58,.18),"sine","lowpass",220,1,.48,0,.3,2,.38),PAD:ie(.22,[42,66],se(.8,.4,.75,1.5),"sine","lowpass",700,1,.38,0,.8,3,1),LEAD:ie(.18,[55,84],se(.008,.1,.4,.15),"triangle","lowpass",2e3,1.5,.42,0,.5,3,.22),STRINGS:ie(.15,[48,76],se(.3,.2,.58,.8),"triangle","lowpass",1200,1,.35,3,.7,2,.7),CHOIR:ie(.13,[48,72],se(1,.5,.72,2),"sine","lowpass",600,1,.3,0,.9,2,1.5),ARP:ie(.07,[60,88],se(.003,.08,.15,.1),"triangle","lowpass",2600,1,.35,0,.6,2,.14),PERC:ie(.05,[48,72],se(.001,.05,0,.03),"noise","highpass",4500,.4,.32,0,.5,3,.2)},syncThreshold:.38,encounterR:.13,entainment:.42,eventRate:.48,reverbAmt:.5,delayAmt:.38,delayTime:.28,masterGain:.75,harmonyMode:"consonant",particleGlow:1.6,trailLen:0,lens:"Events",bgPulse:!1,cinematic:!0,primary:"#44ffcc",secondary:"#040a08",accent:"#ff88aa",gateCount:3,attractorCount:1},{id:"revolution-waltz",name:"Revolution Waltz",intensity:4,description:"Espiral valsa. Tenso cresce at colapsar em resoluo harmnica.",vibe:"Waltz, Spiral, Climax",tags:["Classical","Dynamic","Experimental"],bpm:102,scale:"minor",root:45,quantaCount:80,motionStyle:"revolution",roles:{STRINGS:ie(.28,[42,76],se(.1,.12,.58,1),"sawtooth","lowpass",1400,1.5,.48,5,.8,3,.4),LEAD:ie(.22,[55,88],se(.008,.08,.42,.12),"triangle","lowpass",2200,2,.48,0,.5,3,.18),PAD:ie(.18,[42,60],se(.5,.3,.68,1.2),"sine","lowpass",700,1,.38,0,.7,2,.8),BASS:ie(.15,[28,48],se(.01,.2,.55,.15),"sine","lowpass",280,1,.52,0,.3,2,.3),PERC:ie(.1,[48,72],se(.001,.05,0,.03),"snare","bandpass",2800,.5,.42,0,.6,4,.18),CHOIR:ie(.07,[48,66],se(.8,.4,.68,1.5),"sine","lowpass",550,.9,.28,0,.8,2,1.2)},syncThreshold:.48,encounterR:.11,entainment:.58,eventRate:.68,reverbAmt:.42,delayAmt:.35,delayTime:.22,masterGain:.78,harmonyMode:"modal",particleGlow:1.5,trailLen:0,lens:"Tension",bgPulse:!1,cinematic:!0,primary:"#cc44ff",secondary:"#0a0210",accent:"#ffd700",gateCount:4,attractorCount:1},{id:"blank-canvas",name:"The Blank Canvas",intensity:0,description:"Tela em branco. 0 partculas, 0 gates. Construa tudo do zero.",vibe:"Empty, Your Creation, Freedom",tags:["Experimental","Minimalist","Generative"],bpm:90,scale:"major",root:48,quantaCount:0,motionStyle:"drift",roles:{PAD:ie(.25,[48,72],se(.5,.3,.7,1.2),"sine","lowpass",800,1,.38,0,.8,2,.9),LEAD:ie(.25,[55,84],se(.008,.1,.42,.15),"triangle","lowpass",2e3,1.5,.45,0,.5,3,.22),BASS:ie(.25,[28,52],se(.01,.2,.55,.15),"sine","lowpass",250,1,.5,0,.3,2,.35),ARP:ie(.25,[60,96],se(.003,.08,.15,.1),"triangle","lowpass",2800,1,.4,0,.6,3,.14)},syncThreshold:.35,encounterR:.12,entainment:.4,eventRate:.5,reverbAmt:.5,delayAmt:.4,delayTime:.25,masterGain:.75,harmonyMode:"consonant",particleGlow:1.5,trailLen:0,lens:"Notes",bgPulse:!1,cinematic:!1,primary:"#ffffff",secondary:"#080808",accent:"#37b2da",gateCount:0,attractorCount:0}],N$=new Map(Id.map(e=>[e.id,e]));function db(e){return N$.get(e)}const O$=48;function _$(e,t=2){const r=Math.floor(e.sampleRate*t),o=e.createBuffer(1,r,e.sampleRate),s=o.getChannelData(0);for(let l=0;l<r;l++)s[l]=Math.random()*2-1;return o}function D$(e,t=2.8,r=3.2){const o=Math.floor(e.sampleRate*t),s=e.createBuffer(2,o,e.sampleRate);for(let l=0;l<2;l++){const i=s.getChannelData(l);for(let u=0;u<o;u++)i[u]=(Math.random()*2-1)*Math.pow(1-u/o,r)}return s}class L${constructor(){this.voices=[],this._ready=!1,this.roleEnergy={},this._audioDestNode=null}get ready(){return this._ready}async init(){if(!this._ready){this.ctx=new(window.AudioContext||window.webkitAudioContext),this.ctx.state==="suspended"&&await this.ctx.resume(),this.noiseBuffer=_$(this.ctx),this.masterBus=this.ctx.createGain(),this.masterBus.gain.value=.88,this.compressor=this.ctx.createDynamicsCompressor(),this.compressor.threshold.value=-16,this.compressor.knee.value=6,this.compressor.ratio.value=5,this.compressor.attack.value=.004,this.compressor.release.value=.22,this.convolver=this.ctx.createConvolver(),this.convolver.buffer=D$(this.ctx,2.8,3.2),this.reverbSend=this.ctx.createGain(),this.reverbSend.gain.value=0,this.reverbRet=this.ctx.createGain(),this.reverbRet.gain.value=.85,this.delayNode=this.ctx.createDelay(2),this.delayNode.delayTime.value=.35,this.delayFb=this.ctx.createGain(),this.delayFb.gain.value=.28,this.delaySend=this.ctx.createGain(),this.delaySend.gain.value=0,this.delayRet=this.ctx.createGain(),this.delayRet.gain.value=.65,this.masterBus.connect(this.compressor),this.compressor.connect(this.ctx.destination),this.masterBus.connect(this.reverbSend),this.reverbSend.connect(this.convolver),this.convolver.connect(this.reverbRet),this.reverbRet.connect(this.compressor),this.masterBus.connect(this.delaySend),this.delaySend.connect(this.delayNode),this.delayNode.connect(this.delayFb),this.delayFb.connect(this.delayNode),this.delayNode.connect(this.delayRet),this.delayRet.connect(this.compressor);for(let t=0;t<O$;t++){const r=this.ctx.createGain();r.gain.value=0;const o=this.ctx.createBiquadFilter();o.type="lowpass",o.frequency.value=18e3,o.Q.value=.7;const s=this.ctx.createStereoPanner();o.connect(r),r.connect(s),s.connect(this.masterBus),this.voices.push({id:t,role:"PAD",active:!1,startTime:0,endTime:0,gainNode:r,filter:o,panner:s,oscs:[],noise:null,mixNodes:[]})}this._ready=!0}}createAudioStream(){if(!this._ready)throw new Error("AudioEngine not initialised");return this._audioDestNode||(this._audioDestNode=this.ctx.createMediaStreamDestination(),this.compressor.connect(this._audioDestNode)),this._audioDestNode.stream}acquireVoice(){const t=this.ctx.currentTime;let r=this.voices.find(o=>!o.active||o.endTime<=t);if(r||(r=this.voices.reduce((o,s)=>o.endTime<s.endTime?o:s)),r.oscs.forEach(o=>{try{o.stop(),o.disconnect()}catch{}}),r.oscs=[],r.noise){try{r.noise.stop(),r.noise.disconnect()}catch{}r.noise=null}return r.mixNodes.forEach(o=>{try{o.disconnect()}catch{}}),r.mixNodes=[],r.gainNode.gain.cancelScheduledValues(t),r.gainNode.gain.setValueAtTime(0,t),r.active=!0,r}_applyEnv(t,r,o,s,l){const i=Math.max(.002,s.attack),u=s.sustain<.05?s.decay*.1+.001:s.decay*.28+.001;if(t.cancelScheduledValues(r),i>.06){const c=Math.min(o*.12,.08);t.setValueAtTime(c,r),t.linearRampToValueAtTime(c*.6,r+.025),t.linearRampToValueAtTime(o,r+i)}else t.setValueAtTime(1e-4,r),t.linearRampToValueAtTime(o,r+i);t.setTargetAtTime(o*s.sustain,r+i,u),t.setTargetAtTime(1e-4,r+l,Math.max(.01,s.release)*.38+.001)}fire(t,r){if(!this._ready)return;const o=this.ctx.currentTime,s=this.acquireVoice();s.role=t.role,s.startTime=o,s.panner.pan.setValueAtTime(t.x*.65*r.panSpread,o);const l=.22+t.timbre*.78,i=.5+t.velocity*.5,u=Math.min(18e3,r.filterFreq*l*i),c=t.velocity*r.gainScale,d=C$(t.pitch),h=r.envelope;switch(s.filter.type=r.filterType,s.filter.frequency.setValueAtTime(u,o),s.filter.Q.setValueAtTime(r.filterQ,o),t.role){case"KICK":this._kick(s,o,c);break;case"BASS":this._bassVoice(s,o,d,c,h,r.detune);break;case"PERC":r.waveform==="snare"?this._snare(s,o,c):r.waveform==="hihat"?this._hihat(s,o,c,t.timbre):this._percVoice(s,o,d,c,h,t.timbre);break;case"PAD":this._padVoice(s,o,d,c,h,r.detune);break;case"LEAD":this._leadVoice(s,o,d,c,h,r.detune);break;case"ARP":this._arpVoice(s,o,d,c,h,t.timbre);break;case"STRINGS":this._stringsVoice(s,o,d,c,h,r.detune);break;case"CHOIR":this._choirVoice(s,o,d,c,h);break;default:this._oscVoice(s,o,d,r.waveform||"sine",r.detune,c,h,t.duration);break}this.roleEnergy[t.role]=Math.min(1,(this.roleEnergy[t.role]??0)+c*.5)}_kick(t,r,o){const s=this.ctx.createOscillator();s.type="sine",s.frequency.setValueAtTime(145,r),s.frequency.exponentialRampToValueAtTime(48,r+.09),s.frequency.exponentialRampToValueAtTime(36,r+.38),s.connect(t.filter),s.start(r),s.stop(r+.42);const l=this.ctx.createOscillator();l.type="sine",l.frequency.setValueAtTime(1400,r),l.frequency.exponentialRampToValueAtTime(220,r+.016),l.connect(t.filter),l.start(r),l.stop(r+.028),t.oscs=[s,l],t.filter.type="lowpass",t.filter.frequency.value=260,t.filter.Q.value=.5;const i=t.gainNode.gain;i.cancelScheduledValues(r),i.setValueAtTime(o*1.15,r),i.exponentialRampToValueAtTime(o*.55,r+.022),i.exponentialRampToValueAtTime(o*.1,r+.13),i.exponentialRampToValueAtTime(1e-4,r+.38),t.endTime=r+.42}_snare(t,r,o){const s=this.ctx.createOscillator();s.type="triangle",s.frequency.setValueAtTime(250,r),s.frequency.exponentialRampToValueAtTime(155,r+.055),s.connect(t.filter),s.start(r),s.stop(r+.16),t.oscs.push(s);const l=this.ctx.createBufferSource();l.buffer=this.noiseBuffer,l.loop=!1,l.connect(t.filter),l.start(r),l.stop(r+.2),t.noise=l,t.filter.type="bandpass",t.filter.frequency.value=3800,t.filter.Q.value=.65;const i=t.gainNode.gain;i.cancelScheduledValues(r),i.setValueAtTime(o*.92,r),i.exponentialRampToValueAtTime(o*.38,r+.024),i.exponentialRampToValueAtTime(1e-4,r+.18),t.endTime=r+.2}_hihat(t,r,o,s=0){const l=this.ctx.createBufferSource();l.buffer=this.noiseBuffer,l.loop=!1,l.connect(t.filter),t.filter.type="highpass",t.filter.frequency.value=7800+s*2e3,t.filter.Q.value=.5;const i=.032+s*.28;l.start(r),l.stop(r+i+.05),t.noise=l;const u=t.gainNode.gain;u.cancelScheduledValues(r),u.setValueAtTime(o*.58,r),u.exponentialRampToValueAtTime(1e-4,r+i),t.endTime=r+i+.05}_bassVoice(t,r,o,s,l,i){const u=Math.max(.05,l.attack+l.decay+l.sustain*1.8),c=this.ctx.createOscillator();c.type="sine",c.frequency.value=o*.5,c.detune.value=0;const d=this.ctx.createOscillator();d.type="sawtooth",d.frequency.value=o,d.detune.value=i-7;const h=this.ctx.createOscillator();h.type="sawtooth",h.frequency.value=o,h.detune.value=i+7;const f=this.ctx.createGain();f.gain.value=.7;const g=this.ctx.createGain();g.gain.value=.5;const m=this.ctx.createGain();m.gain.value=.5,t.mixNodes.push(f,g,m),c.connect(f),f.connect(t.filter),d.connect(g),g.connect(t.filter),h.connect(m),m.connect(t.filter),[c,d,h].forEach(y=>{y.start(r),y.stop(r+u+l.release+.08)}),t.oscs=[c,d,h],this._applyEnv(t.gainNode.gain,r,s*.6,l,u),t.endTime=r+u+l.release+.08}_percVoice(t,r,o,s,l,i){const u=Math.max(.04,l.attack+l.decay*1.2),c=this.ctx.createOscillator();c.type=i>.55?"square":"triangle",c.frequency.setValueAtTime(o*1.45,r),c.frequency.exponentialRampToValueAtTime(o,r+.018),c.connect(t.filter),c.start(r),c.stop(r+u+.06),t.oscs.push(c);const d=this.ctx.createBufferSource();d.buffer=this.noiseBuffer,d.loop=!1,d.connect(t.filter),d.start(r),d.stop(r+Math.min(.025,u*.3)),t.noise=d;const h=t.gainNode.gain;h.cancelScheduledValues(r),h.setValueAtTime(s,r),h.exponentialRampToValueAtTime(1e-4,r+u),t.endTime=r+u+.06}_padVoice(t,r,o,s,l,i){const u=Math.max(.1,l.attack+l.decay+l.sustain*2.5),c=[i-14,i,i+14];for(const d of c){const h=this.ctx.createOscillator();h.type="sawtooth",h.frequency.value=o,h.detune.value=d,h.connect(t.filter),h.start(r),h.stop(r+u+l.release+.12),t.oscs.push(h)}this._applyEnv(t.gainNode.gain,r,s*.4,l,u),t.endTime=r+u+l.release+.12}_leadVoice(t,r,o,s,l,i){const u=Math.max(.05,l.attack+l.decay+l.sustain*2),c=r+u+l.release+.08,d=this.ctx.createOscillator(),h=this.ctx.createGain();d.type="sine",d.frequency.value=5.2,h.gain.setValueAtTime(0,r),h.gain.linearRampToValueAtTime(5.5,r+l.attack+.12),d.connect(h),d.start(r),d.stop(c+.05),t.oscs.push(d),t.mixNodes.push(h);const f=this.ctx.createOscillator();f.type="sawtooth",f.frequency.value=o,f.detune.value=i,h.connect(f.detune);const g=this.ctx.createOscillator();g.type="triangle",g.frequency.value=o,g.detune.value=i+4,h.connect(g.detune);const m=this.ctx.createGain();m.gain.value=.7;const y=this.ctx.createGain();y.gain.value=.35,t.mixNodes.push(m,y),f.connect(m),m.connect(t.filter),g.connect(y),y.connect(t.filter),f.start(r),g.start(r),f.stop(c),g.stop(c),t.oscs.push(f,g),this._applyEnv(t.gainNode.gain,r,s*.62,l,u),t.endTime=c}_arpVoice(t,r,o,s,l,i){const u=Math.max(.04,l.attack+l.decay+l.sustain*1.2),c=r+u+l.release+.06,d=[1,2.003,3.009,4.02],h=[1,.45,.22,.1],f=g=>h[g]*(i>.5?1:Math.pow(.5,g*.6));for(let g=0;g<d.length;g++){const m=this.ctx.createOscillator(),y=this.ctx.createGain();m.type=g===0?"triangle":"sine",m.frequency.value=o*d[g],y.gain.value=f(g),t.mixNodes.push(y),m.connect(y),y.connect(t.filter),m.start(r),m.stop(c),t.oscs.push(m)}this._applyEnv(t.gainNode.gain,r,s*.65,l,u),t.endTime=c}_stringsVoice(t,r,o,s,l,i){const u=Math.max(.1,l.attack+l.decay+l.sustain*2.8),c=r+u+l.release+.12,d=this.ctx.createOscillator(),h=this.ctx.createGain();d.type="sine",d.frequency.value=4.5,h.gain.setValueAtTime(0,r),h.gain.linearRampToValueAtTime(3.2,r+l.attack*.6+.08),d.connect(h),d.start(r),d.stop(c+.05),t.oscs.push(d),t.mixNodes.push(h);const f=[i-9,i+9];for(const g of f){const m=this.ctx.createOscillator();m.type="sawtooth",m.frequency.value=o,m.detune.value=g,h.connect(m.detune),m.connect(t.filter),m.start(r),m.stop(c),t.oscs.push(m)}this._applyEnv(t.gainNode.gain,r,s*.52,l,u),t.endTime=c}_choirVoice(t,r,o,s,l){const i=Math.max(.1,l.attack+l.decay+l.sustain*3),u=r+i+l.release+.15,c=700,d=1100,h=[1,2,3,4,5];for(let f=0;f<h.length;f++){const g=h[f],m=o*g,y=Math.abs(m-c),v=Math.abs(m-d),b=Math.exp(-y*y/(c*c*.6))+Math.exp(-v*v/(d*d*.5)),C=(g===1?1:.18)+b*.55,k=this.ctx.createOscillator(),R=this.ctx.createGain();k.type=g<=2?"triangle":"sine",k.frequency.value=m,k.detune.value=(Math.random()-.5)*7,R.gain.value=C,t.mixNodes.push(R),k.connect(R),R.connect(t.filter),k.start(r),k.stop(u),t.oscs.push(k)}this._applyEnv(t.gainNode.gain,r,s*.38,l,i),t.endTime=u}_oscVoice(t,r,o,s,l,i,u,c){const d=this.ctx.createOscillator();d.type=s,d.frequency.setValueAtTime(o,r),d.detune.setValueAtTime(l,r),d.connect(t.filter),d.start(r),d.stop(r+c+u.release+.05),t.oscs.push(d),this._applyEnv(t.gainNode.gain,r,i,u,c),t.endTime=r+c+u.release+.05}getActiveCount(t){var o;const r=((o=this.ctx)==null?void 0:o.currentTime)??0;return t?this.voices.filter(s=>s.active&&s.role===t&&s.endTime>r).length:this.voices.filter(s=>s.active&&s.endTime>r).length}setReverb(t){if(!this._ready)return;const r=this.ctx.currentTime;this.reverbSend.gain.setTargetAtTime(t,r,.1)}setDelay(t,r){if(!this._ready)return;const o=this.ctx.currentTime;this.delaySend.gain.setTargetAtTime(t*.32,o,.1),this.delayNode.delayTime.setTargetAtTime(r,o,.05),this.delayFb.gain.setTargetAtTime(t*.38,o,.1)}setMasterGain(t){this._ready&&this.masterBus.gain.setTargetAtTime(t,this.ctx.currentTime,.05)}cutAll(){if(!this._ready)return;const t=this.ctx.currentTime;for(const r of this.voices){if(r.oscs.forEach(o=>{try{o.stop(t),o.disconnect()}catch{}}),r.oscs=[],r.noise){try{r.noise.stop(t),r.noise.disconnect()}catch{}r.noise=null}r.mixNodes.forEach(o=>{try{o.disconnect()}catch{}}),r.mixNodes=[],r.gainNode.gain.cancelScheduledValues(t),r.gainNode.gain.setValueAtTime(0,t),r.active=!1,r.endTime=0}this.delayFb.gain.cancelScheduledValues(t),this.delayFb.gain.setValueAtTime(0,t),this.delaySend.gain.cancelScheduledValues(t),this.delaySend.gain.setValueAtTime(0,t),this.delayRet.gain.cancelScheduledValues(t),this.delayRet.gain.setValueAtTime(0,t),this.reverbSend.gain.cancelScheduledValues(t),this.reverbSend.gain.setValueAtTime(0,t),this.reverbRet.gain.cancelScheduledValues(t),this.reverbRet.gain.setValueAtTime(0,t),this.masterBus.gain.cancelScheduledValues(t),this.masterBus.gain.setValueAtTime(0,t)}restoreGains(t,r,o,s){if(!this._ready)return;const l=this.ctx.currentTime,i=.04;this.masterBus.gain.setTargetAtTime(s,l,i),this.reverbSend.gain.setTargetAtTime(t,l,i),this.reverbRet.gain.setTargetAtTime(.85,l,i),this.delaySend.gain.setTargetAtTime(r*.32,l,i),this.delayFb.gain.setTargetAtTime(r*.38,l,i),this.delayRet.gain.setTargetAtTime(.65,l,i),this.delayNode.delayTime.setTargetAtTime(o,l,.02)}tickEnergy(t){for(const r in this.roleEnergy){const o=r;this.roleEnergy[o]=Math.max(0,(this.roleEnergy[o]??0)-t*3.5)}}dispose(){this._ready&&(this.voices.forEach(t=>{if(t.oscs.forEach(r=>{try{r.stop()}catch{}}),t.mixNodes.forEach(r=>{try{r.disconnect()}catch{}}),t.noise)try{t.noise.stop()}catch{}}),this.ctx.close().catch(()=>{}),this._ready=!1)}}const lr=new L$,$f=[{id:"murmuration",name:"Murmurao",icon:"",color:"#88aaff",description:"Estorninhos em ballet coletivo. Ondas de forma pura.",ref:"Reynolds 1987  Boids: sep + align + coeso",motionStyle:"murmuration",physics:{cohesion:.9,separation:.7,alignment:1.45,zoneRadius:.22,maxSpeed:.42,turbulence:.1,damping:.972,predatorPrey:!1}},{id:"school",name:"Cardume",icon:"",color:"#00ccff",description:"Peixes em zonas: repulso  alinhamento  atrao.",ref:"Couzin et al. 2002  Zone model + preferred speed",motionStyle:"school",physics:{cohesion:1.4,separation:1.85,alignment:1.6,zoneRadius:.2,maxSpeed:.36,turbulence:.04,damping:.975,predatorPrey:!1}},{id:"war",name:"Guerra",icon:"",color:"#ff3333",description:"Dois exrcitos. Pares impares perseguem; pares fogem.",ref:"Schelling 1969  Agent-based conflict models",motionStyle:"war",physics:{cohesion:1.8,separation:2,polarize:.9,alignment:.35,zoneRadius:.26,maxSpeed:.56,turbulence:.28,predatorPrey:!1}},{id:"polarization",name:"Polarizao",icon:"",color:"#ff8800",description:"Similares atraem, diferentes repelem. Dois plos emergem.",ref:"Deffuant-Weisbuch 2000  Opinion dynamics",motionStyle:"polarization",physics:{cohesion:.85,separation:1.2,polarize:.95,zoneRadius:.28,maxSpeed:.26,turbulence:.08,alignment:.4,predatorPrey:!1}},{id:"revolution",name:"Revoluo",icon:"",color:"#cc44ff",description:"Espiral que aperta. Alta carga ejeta para fora periodicamente.",ref:"Lorenz attractor  Centripetal collapse + bifurcao",motionStyle:"revolution",physics:{vortexForce:.18,cohesion:.65,separation:.8,burstRate:.45,maxSpeed:.5,turbulence:.15,alignment:.5,damping:.966}},{id:"explosion",name:"Exploso",icon:"",color:"#ff6600",description:"Burst radial cclico. Expande e reagrupa em ondas.",ref:"Radial particle systems  Firework physics",motionStyle:"explosion",physics:{burstRate:.7,cohesion:1.2,separation:1.05,maxSpeed:.62,turbulence:.22,vortexForce:.05,alignment:.2}},{id:"carnival",name:"Carnaval",icon:"",color:"#ffcc00",description:"Trs vrtices girantes em festa. Alta energia + ritmo.",ref:"Multi-vortex flocking  Rotational attractors",motionStyle:"carnival",physics:{vortexForce:.26,cohesion:1.55,separation:.82,maxSpeed:.68,turbulence:.38,alignment:.55,clusterTarget:8,burstRate:.4}},{id:"jazz",name:"Jazz",icon:"",color:"#ff8844",description:"Pequenos grupos formam, improvisam e dissolvem. Microclusters.",ref:"Pressing 1988  Improvisation: Methods and Models",motionStyle:"jazz",physics:{cohesion:2.1,separation:1.55,clusterTarget:4,maxSpeed:.32,turbulence:.48,mutationRate:.28,alignment:.65,zoneRadius:.16}},{id:"organism",name:"Organismo",icon:"",color:"#44ff88",description:"Massa celular respirando. Presso interna + pulso de vida.",ref:"Gray-Scott reaction-diffusion  Cellular automata pulse",motionStyle:"organism",physics:{cohesion:2.55,separation:2.25,clusterTarget:7,burstRate:.5,maxSpeed:.2,turbulence:.1,zoneRadius:.16,alignment:.8}},{id:"exodus",name:"xodo",icon:"",color:"#88ff44",description:"Migrao em massa. Todos fugindo em formao coordenada.",ref:"Evacuation models  Helbing 2000  Panic dynamics",motionStyle:"exodus",physics:{migrationX:0,migrationY:-1,alignment:1.25,cohesion:.55,separation:.82,maxSpeed:.52,turbulence:.12,zoneRadius:.2}},{id:"dance",name:"Dana",icon:"",color:"#ff88cc",description:"Cada quanta orbita o seu par mais prximo. Waltz quntico.",ref:"Two-body problem  Paired orbital mechanics",motionStyle:"dance",physics:{cohesion:2.2,separation:1.45,clusterTarget:2,vortexForce:.14,maxSpeed:.36,turbulence:.08,zoneRadius:.15,alignment:.35}},{id:"chaos",name:"Caos",icon:"",color:"#ff0055",description:"Entropia mxima. Movimento browniano com jolts aleatrios.",ref:"Langevin dynamics  Boltzmann chaos  Maximum entropy",motionStyle:"chaos",physics:{turbulence:.95,damping:.94,burstRate:.82,cohesion:.08,separation:.15,maxSpeed:.68,alignment:0,polarize:0}},{id:"meditation",name:"Meditao",icon:"",color:"#aaccff",description:"Deriva ultralenta. Arcos harmnicos. Tempo quase parado.",ref:"Hamiltonian slow manifold  Drift-diffusion at 0",motionStyle:"meditation",physics:{cohesion:.4,separation:.52,maxSpeed:.07,turbulence:.04,damping:.988,alignment:.32,zoneRadius:.38,vortexForce:.025}},{id:"migration",name:"Migrao",icon:"",color:"#ffee88",description:"Formao migratria. Todos em direo, alinhados por vento.",ref:"Aves migration theory  Aerodynamic drafting models",motionStyle:"migration",physics:{migrationX:0,migrationY:1,alignment:1.8,cohesion:.62,separation:.92,maxSpeed:.44,turbulence:.08,zoneRadius:.2}},{id:"predation",name:"Predao",icon:"",color:"#ff4422",description:"Predadores e presas por role. Perseguio emergente.",ref:"Lotka-Volterra  Role Matrix agent pursuit/flight",motionStyle:"predation",physics:{predatorPrey:!0,polarize:.72,cohesion:1.05,separation:1.42,maxSpeed:.52,turbulence:.18,alignment:.55,zoneRadius:.24}},{id:"cells",name:"Clulas",icon:"",color:"#44ffcc",description:"Grupos celulares respirando. Presso  expanso  contrao.",ref:"CPM Cellular Potts Model  Glazier-Graner 1993",motionStyle:"cells",physics:{cohesion:3,separation:2.82,clusterTarget:5,burstRate:.42,maxSpeed:.16,turbulence:.12,zoneRadius:.12,alignment:.98}}],yy=Object.fromEntries($f.map(e=>[e.id,e]));function xy(e,t){return{...t,...e.physics,motionStyle:e.motionStyle}}const ub={canvas:{bgStyle:"radial",grain:.55,vignette:.45},quanta:{shape:"circle",baseSize:1,glow:.65,outline:.15},trails:{enabled:!1,style:"line",persistence:.55,width:1,blur:.15,blend:"screen"},connections:{enabled:!0,width:.8,alpha:.35,blend:"screen"},tools:{intensity:.85,labels:!0},post:{bloom:.25,chroma:0},overlays:{showAnnotations:!0,showHitFlashes:!0},threeD:{fog:.55,exposure:1.3,emissive:.65,overlays:!0}},t5=e=>e,n5=e=>e,sR=[{id:"meta-lite",name:"Meta-Lite",description:"Camadas suaves, glow controlado, vibe Meta-Arte sem pesar.",palette:t5({mode:"plasma",bgColor:"#04060a",accent:"#ff0084"}),aesthetic:n5({canvas:{bgStyle:"radial",grain:.75,vignette:.55},trails:{enabled:!1,persistence:.72,blur:.25,blend:"screen"},post:{bloom:.35},connections:{alpha:.42,width:.85,blend:"screen"},quanta:{glow:.75,outline:.1}})},{id:"neon-noir",name:"Neon Noir",description:"Alto contraste, neon limpo, barras e campos com presena.",palette:t5({mode:"neon",bgColor:"#020208",accent:"#00d4ff"}),aesthetic:n5({canvas:{bgStyle:"solid",grain:.35,vignette:.65},trails:{enabled:!1,persistence:.52,width:1.1,blur:.08,blend:"lighter"},post:{bloom:.18},connections:{alpha:.3,blend:"lighter"},quanta:{glow:.9,outline:.22},tools:{intensity:1.05},threeD:{fog:.6,exposure:1.45,emissive:.8,overlays:!0}})},{id:"ink-paper",name:"Ink / Paper",description:"Trao orgnico, fundo claro, esttica editorial.",palette:t5({mode:"mono",bgColor:"#f6f3ea",accent:"#111111"}),aesthetic:n5({canvas:{bgStyle:"solid",grain:.22,vignette:.12},trails:{enabled:!1,persistence:.82,width:.9,blur:0,blend:"multiply"},connections:{alpha:.18,blend:"multiply",width:.7},quanta:{shape:"diamond",glow:.05,outline:.55},tools:{intensity:.55,labels:!1},post:{bloom:0},overlays:{showAnnotations:!1,showHitFlashes:!1},threeD:{fog:.15,exposure:1,emissive:.1,overlays:!1}})},{id:"ritual-aurora",name:"Ritual Aurora",description:"Neblina + rastros longos; campos viram pintura.",palette:t5({mode:"earth",bgColor:"#02050a",accent:"#ffd700"}),aesthetic:n5({canvas:{bgStyle:"radial",grain:.62,vignette:.58},trails:{enabled:!1,persistence:.88,width:1.2,blur:.35,blend:"screen"},connections:{alpha:.55,width:1,blend:"screen"},quanta:{shape:"spark",glow:.85,outline:.05},post:{bloom:.45,chroma:.12},tools:{intensity:.95},threeD:{fog:.7,exposure:1.25,emissive:.7,overlays:!0}})}],z$=new Map(sR.map(e=>[e.id,e]));function B$(e){return z$.get(e)}const B5=["KICK","BASS","PERC","PAD","LEAD","ARP","STRINGS","CHOIR"];let $0=null;function $$(){if($0)return $0;const e=256;$0=document.createElement("canvas"),$0.width=$0.height=e;const t=$0.getContext("2d"),r=t.createImageData(e,e);for(let o=0;o<r.data.length;o+=4){const s=Math.random()*26;r.data[o]=r.data[o+1]=r.data[o+2]=s,r.data[o+3]=255}return t.putImageData(r,0,0),$0}let r5=null;const Ec={key:"",cvs:null},hg={};function fS(e,t,r){let o=hg[e];if(o||(o=document.createElement("canvas"),hg[e]=o),o.width!==t||o.height!==r){o.width=t,o.height=r;const s=o.getContext("2d");if(s&&s.setTransform(1,0,0,1,0,0),e==="trail"){const l=o.getContext("2d");l&&l.clearRect(0,0,t,r)}}return o}function q$(e){switch(e){case"screen":return"screen";case"lighter":return"lighter";case"multiply":return"multiply";case"overlay":return"overlay";default:return"source-over"}}const gr=(e,t)=>(e+1)*t*.5,yr=(e,t)=>(e+1)*t*.5,$5=[];for(let e=0;e<256;e++)$5[e]=e.toString(16).padStart(2,"0");function by(e,t,r=1,o="role",s){if(o==="role"&&(s!=null&&s[e.role]))return s[e.role]+$5[Math.round(r*255)];if(o==="mono")return`rgba(255,255,255,${r*(.4+e.charge*.6)})`;if(o==="neon")return`hsla(${e.pitch*3.5%360|0},100%,68%,${r})`;if(o==="heat")return`hsla(${(1-e.charge)*60|0},95%,${45+e.charge*25|0}%,${r})`;if(o==="earth")return`hsla(${[32,20,50,38,44,28,38,35][B5.indexOf(e.role)]??35},55%,${38+e.charge*22|0}%,${r})`;if(o==="plasma")return`hsla(${(e.phase*360+e.charge*120)%360|0},90%,65%,${r})`;const l=(s==null?void 0:s[e.role])??mo[e.role];switch(t){case"Off":case"Events":return l+$5[Math.round(r*255)];case"Notes":return`hsla(${250-(e.pitch-33)/72*190|0},80%,${55+e.charge*25|0}%,${r})`;case"Harmony":return l+$5[Math.round(r*200)];case"Rhythm":return`hsla(${e.phase*360|0},90%,62%,${r})`;case"Tension":return`hsla(${40-e.charge*40|0},90%,${45+e.brightness*25|0}%,${r})`}}function zg(e){return[parseInt(e.slice(1,3),16),parseInt(e.slice(3,5),16),parseInt(e.slice(5,7),16)]}function W$(e,t,r,o){var s;if((s=t.channels)!=null&&s.length){e.save(),e.lineCap="round";for(const l of t.channels)if(l.pts.length){e.strokeStyle=l.color,e.lineWidth=1.5,e.globalAlpha=.2,e.beginPath(),e.moveTo(gr(l.pts[0][0],r),yr(l.pts[0][1],o));for(let i=1;i<l.pts.length;i++)e.lineTo(gr(l.pts[i][0],r),yr(l.pts[i][1],o));e.stroke(),e.globalAlpha=.55;for(let i=6;i<l.pts.length;i+=10){const[u,c,d,h]=l.pts[i],f=gr(u,r),g=yr(c,o),m=12,y=4;e.fillStyle=l.color,e.beginPath(),e.moveTo(f+d*m,g+h*m),e.lineTo(f-h*y,g+d*y),e.lineTo(f+h*y,g-d*y),e.closePath(),e.fill()}}e.restore()}}function H$(e,t,r,o,s){var l;if((l=t.rails)!=null&&l.length){e.save(),e.lineCap="round";for(const i of t.rails){const u=gr(i.x1,r),c=yr(i.y1,o),d=gr(i.x2,r),h=yr(i.y2,o),f=i.color;e.strokeStyle=f,e.lineWidth=8*i.strength,e.globalAlpha=.07,e.beginPath(),e.moveTo(u,c),e.lineTo(d,h),e.stroke(),e.lineWidth=1.8,e.globalAlpha=.7,e.beginPath(),e.moveTo(u,c),e.lineTo(d,h),e.stroke();const g=d-u,m=h-c,y=Math.sqrt(g*g+m*m),v=-m/y,b=g/y,S=Math.floor(y/14);e.lineWidth=.8,e.globalAlpha=.4;for(let k=1;k<S;k++){const R=u+g*(k/S),j=c+m*(k/S);e.beginPath(),e.moveTo(R+v*4,j+b*4),e.lineTo(R-v*4,j-b*4),e.stroke()}const C=4;for(let k=0;k<C;k++){const R=(k/C+s*.3)%1,j=u+g*R,T=c+m*R;e.globalAlpha=.5*(.5+.5*Math.sin(s*4+k*1.5)),e.fillStyle=f,e.beginPath(),e.arc(j,T,1.5,0,Math.PI*2),e.fill()}}e.restore()}}function G$(e,t,r,o,s){var l;if((l=t.tunnels)!=null&&l.length){e.save(),e.lineCap="round";for(const i of t.tunnels){const u=gr(i.ax,r),c=yr(i.ay,o),d=gr(i.bx,r),h=yr(i.by,o),f=i.radius*r*.5,g=i.color;e.strokeStyle=g,e.lineWidth=.8,e.globalAlpha=.12+.06*Math.sin(s*2),e.setLineDash([3,6]),e.beginPath(),e.moveTo(u,c),e.lineTo(d,h),e.stroke(),e.setLineDash([]);const m=.5+.5*Math.sin(s*5);for(let v=0;v<3;v++)e.globalAlpha=(.5-v*.12)*(.6+m*.4),e.strokeStyle=g,e.lineWidth=1.5-v*.4,e.beginPath(),e.arc(u,c,f*(1+v*.6),0,Math.PI*2),e.stroke();e.globalAlpha=.8,e.fillStyle="rgba(0,0,0,.5)",e.beginPath(),e.arc(u,c,f*.4,0,Math.PI*2),e.fill(),e.globalAlpha=.7,e.fillStyle=g,e.font="8px monospace",e.textAlign="center",e.textBaseline="middle",e.fillText("A",u,c);const y=.5+.5*Math.sin(s*5+Math.PI);for(let v=0;v<3;v++)e.globalAlpha=(.5-v*.12)*(.6+y*.4),e.strokeStyle=g,e.lineWidth=1.5-v*.4,e.beginPath(),e.arc(d,h,f*(1+v*.6),0,Math.PI*2),e.stroke();e.globalAlpha=.7,e.fillStyle="rgba(0,0,0,.5)",e.beginPath(),e.arc(d,h,f*.4,0,Math.PI*2),e.fill(),e.globalAlpha=.7,e.fillStyle=g,e.fillText("B",d,h)}e.restore()}}function V$(e,t,r,o,s){const l=t.sequencer;if(!(l!=null&&l.active))return;e.save();const i=gr(l.x,r),u=yr(l.y,o),c=l.ringR*r*.5,d=l.steps.length;e.strokeStyle="rgba(255,255,255,0.08)",e.lineWidth=1,e.beginPath(),e.arc(i,u,c,0,Math.PI*2),e.stroke();for(let v=0;v<d;v++){const b=l.steps[v],S=v/d*Math.PI*2-Math.PI/2,C=i+Math.cos(S)*c,k=u+Math.sin(S)*c,R=b.armed;if(e.strokeStyle=R?"rgba(255,255,255,0.55)":"rgba(255,255,255,0.12)",e.lineWidth=R?1.5:.8,e.beginPath(),e.moveTo(i+Math.cos(S)*(c-4),u+Math.sin(S)*(c-4)),e.lineTo(i+Math.cos(S)*(c+4),u+Math.sin(S)*(c+4)),e.stroke(),R){const j=.7+.3*Math.sin(s*3+v);e.globalAlpha=j,e.fillStyle="#ffffff",e.beginPath(),e.arc(C,k,3,0,Math.PI*2),e.fill(),b.role&&(e.globalAlpha=.5,e.fillStyle=mo[b.role]??"#fff",e.beginPath(),e.arc(C,k,2.2,0,Math.PI*2),e.fill())}else e.globalAlpha=.2,e.fillStyle="rgba(255,255,255,0.3)",e.beginPath(),e.arc(C,k,1.5,0,Math.PI*2),e.fill();e.globalAlpha=1}const h=l.cursor*Math.PI*2-Math.PI/2,f=e.createLinearGradient(i,u,i+Math.cos(h)*c*1.1,u+Math.sin(h)*c*1.1);f.addColorStop(0,"rgba(255,255,255,0)"),f.addColorStop(.6,"rgba(255,255,255,0.08)"),f.addColorStop(1,"rgba(255,255,255,0.45)"),e.strokeStyle=f,e.lineWidth=1.5,e.beginPath(),e.moveTo(i,u),e.lineTo(i+Math.cos(h)*c*1.1,u+Math.sin(h)*c*1.1),e.stroke();const g=i+Math.cos(h)*(c+4),m=u+Math.sin(h)*(c+4),y=.5+.5*Math.sin(s*8);e.globalAlpha=y*.9,e.fillStyle="#ffffff",e.beginPath(),e.arc(g,m,2.5,0,Math.PI*2),e.fill(),e.globalAlpha=.4,e.strokeStyle="rgba(255,255,255,0.2)",e.lineWidth=.8,e.beginPath(),e.arc(i,u,6,0,Math.PI*2),e.stroke(),e.globalAlpha=.25,e.fillStyle="rgba(255,255,255,0.15)",e.beginPath(),e.arc(i,u,5,0,Math.PI*2),e.fill(),e.globalAlpha=.05,e.strokeStyle="#fff",e.lineWidth=1,e.setLineDash([3,8]),e.beginPath(),e.arc(i,u,l.triggerR*r*.5,0,Math.PI*2),e.stroke(),e.setLineDash([]),e.restore()}function U$(e,t,r,o,s){var l;if((l=t.cages)!=null&&l.length){e.save();for(const i of t.cages){const u=.5+.5*Math.sin(s*2),[c,d,h]=zg(i.color);if(i.shape==="rect"){const f=gr(i.x-i.w/2,r),g=yr(i.y-i.h/2,o),m=gr(i.x+i.w/2,r),y=yr(i.y+i.h/2,o),v=m-f,b=y-g;e.globalAlpha=.12*u,e.strokeStyle=i.color,e.lineWidth=6,e.beginPath(),e.rect(f,g,v,b),e.stroke(),e.strokeStyle=i.color,e.lineWidth=1.5,e.globalAlpha=.7,e.beginPath(),e.rect(f,g,v,b),e.stroke();const S=8;e.strokeStyle=i.color,e.lineWidth=2.5,e.globalAlpha=.9;for(const[k,R,j,T]of[[f,g,1,1],[m,g,-1,1],[m,y,-1,-1],[f,y,1,-1]])e.beginPath(),e.moveTo(k,R+T*S),e.lineTo(k,R),e.lineTo(k+j*S,R),e.stroke();const C=e.createLinearGradient(f,g,m,y);C.addColorStop(0,`rgba(${c},${d},${h},0.03)`),C.addColorStop(1,`rgba(${c},${d},${h},0.01)`),e.fillStyle=C,e.globalAlpha=1,e.beginPath(),e.rect(f+1,g+1,v-2,b-2),e.fill()}else{const f=gr(i.x,r),g=yr(i.y,o),m=i.r*r*.5;for(let v=0;v<3;v++)e.globalAlpha=(.5-v*.15)*(.5+u*.4),e.strokeStyle=i.color,e.lineWidth=1.5-v*.4,e.beginPath(),e.arc(f,g,m*(1+v*.06),0,Math.PI*2),e.stroke();const y=e.createRadialGradient(f,g,0,f,g,m);y.addColorStop(0,`rgba(${c},${d},${h},0.04)`),y.addColorStop(1,`rgba(${c},${d},${h},0)`),e.fillStyle=y,e.globalAlpha=1,e.beginPath(),e.arc(f,g,m,0,Math.PI*2),e.fill()}}e.restore()}}function Y$(e,t,r,o,s){var l;if((l=t.strings)!=null&&l.length){e.save(),e.lineCap="round";for(const i of t.strings){const u=gr(i.x1,r),c=yr(i.y1,o),d=gr(i.x2,r),h=yr(i.y2,o),f=d-u,g=h-c,m=Math.sqrt(f*f+g*g),y=-g/m,v=f/m,b=20,S=i.vibAmp*12*(.8+.2*Math.sin(s*8));e.globalAlpha=.06+i.vibAmp*.18,e.strokeStyle=i.color,e.lineWidth=10+i.vibAmp*12,e.beginPath(),e.moveTo(u,c),e.lineTo(d,h),e.stroke(),e.globalAlpha=.03+i.vibAmp*.08,e.lineWidth=18+i.vibAmp*16,e.beginPath(),e.moveTo(u,c),e.lineTo(d,h),e.stroke(),e.globalAlpha=.8+i.vibAmp*.2,e.strokeStyle=i.color,e.lineWidth=1.5+i.vibAmp,e.beginPath();for(let C=0;C<=b;C++){const k=C/b,R=u+f*k,j=c+g*k,T=Math.sin(k*Math.PI)*Math.sin(i.vibPhase*2)*S;C===0?e.moveTo(R+y*T,j+v*T):e.lineTo(R+y*T,j+v*T)}if(e.stroke(),e.globalAlpha=.9,e.fillStyle=i.color,e.beginPath(),e.arc(u,c,4,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(d,h,4,0,Math.PI*2),e.fill(),i.vibAmp>.05){const C=(u+d)/2,k=(c+h)/2,[R,j,T]=zg(i.color);e.globalAlpha=i.vibAmp*.4;const _=30+i.vibAmp*40,P=e.createRadialGradient(C,k,0,C,k,_);P.addColorStop(0,`rgba(${R},${j},${T},0.6)`),P.addColorStop(.4,`rgba(${R},${j},${T},0.2)`),P.addColorStop(1,`rgba(${R},${j},${T},0)`),e.fillStyle=P,e.beginPath(),e.arc(C,k,_,0,Math.PI*2),e.fill()}}e.restore()}}function K$(e,t,r,o,s){var u;if(!((u=t.fxZones)!=null&&u.length))return;const l={slow:"#0066ff",fast:"#ff4400",mute:"#444488",excite_zone:"#ff8800",pitch_up:"#00ff88",pitch_down:"#ff0088",reverse:"#ff00ff",freeze_zone:"#88ccff",vortex_zone:"#cc44ff",gravity_down:"#ff8844",gravity_up:"#44ccff",transpose:"#ffdd00",harmonize_zone:"#88ff44",bounce:"#ff4444",compress_zone:"#4488ff",scatter_zone:"#ff88cc"},i={slow:"SLOW",fast:"FAST",mute:"MUTE",excite_zone:"EXCITE",pitch_up:"PITCH",pitch_down:"PITCH",reverse:"REVERSE",freeze_zone:"FREEZE",vortex_zone:"VORTEX",gravity_down:"GRAV",gravity_up:"GRAV",transpose:"TRANS",harmonize_zone:"HARM",bounce:"BOUNCE",compress_zone:"COMPRESS",scatter_zone:"SCATTER"};e.save();for(const c of t.fxZones){if(c.pts.length<3)continue;const d=l[c.effect]??"#ffffff",[h,f,g]=zg(d),m=.5+.5*Math.sin(s*3+c.id*.7);e.beginPath();for(let b=0;b<c.pts.length;b++){const S=gr(c.pts[b][0],r),C=yr(c.pts[b][1],o);b===0?e.moveTo(S,C):e.lineTo(S,C)}e.closePath(),e.globalAlpha=.06+c.strength*.08+m*.03,e.fillStyle=`rgb(${h},${f},${g})`,e.fill(),e.globalAlpha=.5+m*.3,e.strokeStyle=d,e.lineWidth=1.2,e.setLineDash([6,4]),e.lineDashOffset=-s*10,e.stroke(),e.setLineDash([]);const y=c.pts.reduce((b,S)=>b+S[0],0)/c.pts.length,v=c.pts.reduce((b,S)=>b+S[1],0)/c.pts.length;e.globalAlpha=.7,e.fillStyle=d,e.font="8px monospace",e.textAlign="center",e.textBaseline="middle",e.fillText(i[c.effect]??c.effect,gr(y,r),yr(v,o))}e.restore()}function X$(e,t,r,o,s,l,i,u,c,d,h,f,g,m=1,y=0,v=0,b=-1,S=null,C=!0,k=cb,R,j,T=ub){const _=Math.min(window.devicePixelRatio||1,1.5),P=e.clientWidth,I=e.clientHeight,$=Math.round(P*_),q=Math.round(I*_);(e.width!==$||e.height!==q)&&(e.width=$,e.height=q);const L=e.getContext("2d");L.setTransform(_,0,0,_,0,0),L.fillStyle=k.bgColor,L.fillRect(0,0,P,I);const[H,G,oe]=zg(r.primary);if(T.canvas.bgStyle==="radial"){const J=L.createRadialGradient(P/2,I/2,0,P/2,I/2,Math.max(P,I)*.62);J.addColorStop(0,`rgba(${H},${G},${oe},${i?.05:.026})`),J.addColorStop(.5,`rgba(${H},${G},${oe},.012)`),J.addColorStop(1,"rgba(0,0,0,0)"),L.fillStyle=J,L.fillRect(0,0,P,I)}const le=.01+(T.canvas.grain??.5)*.09;if(le>.02){if(!r5){const J=L.createPattern($$(),"repeat");J&&(r5=J)}r5&&(L.save(),L.globalAlpha=le,L.fillStyle=r5,L.fillRect(0,0,P,I),L.restore())}const pe=fS("trail",$,q),ce=pe.getContext("2d");if(ce.setTransform(_,0,0,_,0,0),T.trails.enabled){const J=Math.max(0,Math.min(1,T.trails.persistence??.55)),ke=.35+Math.pow(J,.55)*.645;ce.save(),ce.globalCompositeOperation="destination-in",ce.globalAlpha=ke,ce.fillStyle="rgba(0,0,0,1)",ce.fillRect(0,0,P,I),ce.restore(),ce.save(),ce.translate(P/2+y,I/2+v),ce.scale(m,m),ce.translate(-P/2,-I/2),ce.globalCompositeOperation=q$(T.trails.blend),ce.lineCap="round";const Le=T.trails.width??1;for(const K of t.quanta){const et=K.x-K.prevX,dt=K.y-K.prevY;if(et*et+dt*dt<1e-8)continue;const Rt=gr(K.prevX,P),Wt=yr(K.prevY,I),Zt=gr(K.x,P),$e=yr(K.y,I),Ze=by(K,o,1,k.mode,k.roleColorOverrides);ce.strokeStyle=Ze,ce.globalAlpha=.05+K.charge*.16,ce.lineWidth=(.25+K.charge*1.15)*Le,ce.beginPath(),ce.moveTo(Rt,Wt),ce.lineTo(Zt,$e),ce.stroke()}ce.restore()}const te=fS("scene",$,q),F=te.getContext("2d");if(F.setTransform(_,0,0,_,0,0),F.clearRect(0,0,P,I),F.save(),F.translate(P/2+y,I/2+v),F.scale(m,m),F.translate(-P/2,-I/2),C){F.save();for(const J of t.attractors){const ke=gr(J.x,P),Le=yr(J.y,I),K=J.radius*P*.5;let et=J.type==="metro"?"255,200,0":J.type==="repulsor"?"255,80,0":J.type==="vortex"?"180,0,255":"0,180,255";const dt=F.createRadialGradient(ke,Le,0,ke,Le,K);if(dt.addColorStop(0,`rgba(${et},.1)`),dt.addColorStop(.5,`rgba(${et},.03)`),dt.addColorStop(1,`rgba(${et},0)`),F.fillStyle=dt,F.globalAlpha=1,F.beginPath(),F.arc(ke,Le,K,0,Math.PI*2),F.fill(),J.type==="metro"){const Rt=.5+.5*Math.cos(t.elapsed*(t.bpm/60)*Math.PI*2);F.strokeStyle=`rgba(255,200,0,${.4+Rt*.5})`,F.lineWidth=2,F.beginPath(),F.moveTo(ke,Le-12*(.7+Rt*.5)),F.lineTo(ke,Le+8),F.moveTo(ke-6,Le+8),F.lineTo(ke+6,Le+8),F.stroke()}}F.restore(),K$(F,t,P,I,t.elapsed),U$(F,t,P,I,t.elapsed),Y$(F,t,P,I,t.elapsed)}else{F.save();for(const J of t.attractors){const ke=gr(J.x,P),Le=yr(J.y,I),K=J.radius*P*.5;F.globalAlpha=.015,F.fillStyle=J.type==="repulsor"?"#ff5000":J.type==="vortex"?"#8800ff":"#00aaff",F.beginPath(),F.arc(ke,Le,K,0,Math.PI*2),F.fill()}F.restore()}if(o!=="Off"&&o!=="Rhythm"){F.save(),F.lineCap="round";const J=.12*.12,ke=120;let Le=0;const K=t.count>80?2:1;for(let et=0;et<t.count&&Le<ke;et+=K){const dt=t.quanta[et];for(let Rt=et+1;Rt<t.count&&Le<ke;Rt+=K){const Wt=t.quanta[Rt],Zt=dt.x-Wt.x,$e=dt.y-Wt.y;if(Zt*Zt+$e*$e>J)continue;const Ze=Math.sqrt(Zt*Zt+$e*$e),Fe=aR(dt.pitch,Wt.pitch),Xe=(1-Ze/.12)*.28;F.globalAlpha=o==="Harmony"?Xe*(.4+Fe*.6):Xe*.22,F.strokeStyle=o==="Harmony"?`hsl(${Fe*140},70%,55%)`:"rgba(255,255,255,0.7)",F.lineWidth=.5+Fe*.7,F.beginPath(),F.moveTo(gr(dt.x,P),yr(dt.y,I)),F.lineTo(gr(Wt.x,P),yr(Wt.y,I)),F.stroke(),Le++}}F.restore()}F.save(),F.lineCap="round";for(const J of t.gates){const ke=gr(J.x1,P),Le=yr(J.y1,I),K=gr(J.x2,P),et=yr(J.y2,I),dt=J.type??"gate";if(dt==="mirror"){F.globalAlpha=.22,F.strokeStyle="#d0eeff",F.lineWidth=8,F.beginPath(),F.moveTo(ke,Le),F.lineTo(K,et),F.stroke(),F.globalAlpha=.92,F.strokeStyle="#e8f6ff",F.lineWidth=1.8,F.beginPath(),F.moveTo(ke,Le),F.lineTo(K,et),F.stroke();const Rt=K-ke,Wt=et-Le,Zt=Math.sqrt(Rt*Rt+Wt*Wt)+.001,$e=-Wt/Zt,Ze=Rt/Zt,Fe=Math.max(2,Math.floor(Zt/10));F.lineWidth=.9,F.globalAlpha=.55,F.strokeStyle="#c0e8ff";for(let Xe=1;Xe<Fe;Xe++){const jt=ke+Rt*(Xe/Fe),hn=Le+Wt*(Xe/Fe);F.beginPath(),F.moveTo(jt+$e*6,hn+Ze*6),F.lineTo(jt+$e*1,hn+Ze*1),F.stroke()}F.globalAlpha=.85,F.fillStyle="#e8f6ff",F.beginPath(),F.arc(ke,Le,4,0,Math.PI*2),F.fill(),F.beginPath(),F.arc(K,et,4,0,Math.PI*2),F.fill(),F.globalAlpha=.55,F.fillStyle="#c0e8ff",F.font="7px monospace",F.textAlign="center",F.textBaseline="middle",F.fillText("",(ke+K)/2,(Le+et)/2-10)}else if(dt==="absorber"){F.globalAlpha=.18,F.strokeStyle="#cc1111",F.lineWidth=12,F.beginPath(),F.moveTo(ke,Le),F.lineTo(K,et),F.stroke(),F.globalAlpha=.8,F.strokeStyle="#dd3333",F.lineWidth=1.5,F.setLineDash([5,3]),F.beginPath(),F.moveTo(ke,Le),F.lineTo(K,et),F.stroke(),F.setLineDash([]),F.globalAlpha=.45,F.strokeStyle="#880000",F.lineWidth=.8,F.beginPath(),F.moveTo(ke,Le),F.lineTo(K,et),F.stroke(),F.globalAlpha=.75,F.fillStyle="#dd3333",F.beginPath(),F.arc(ke,Le,4,0,Math.PI*2),F.fill(),F.beginPath(),F.arc(K,et,4,0,Math.PI*2),F.fill();const Rt=K-ke,Wt=et-Le,Zt=Math.sqrt(Rt*Rt+Wt*Wt)+.001,$e=Math.max(2,Math.floor(Zt/20));F.globalAlpha=.4,F.fillStyle="#ff2222";for(let Ze=1;Ze<$e;Ze++){const Fe=ke+Rt*(Ze/$e),Xe=Le+Wt*(Ze/$e);F.beginPath(),F.arc(Fe,Xe,2,0,Math.PI*2),F.fill()}F.globalAlpha=.45,F.fillStyle="#cc1111",F.font="7px monospace",F.textAlign="center",F.textBaseline="middle",F.fillText("",(ke+K)/2,(Le+et)/2-10)}else if(dt==="membrane"){F.globalAlpha=.22,F.strokeStyle="#cc44ff",F.lineWidth=9,F.beginPath(),F.moveTo(ke,Le),F.lineTo(K,et),F.stroke(),F.globalAlpha=.82,F.strokeStyle="#dd66ff",F.lineWidth=1.5,F.beginPath(),F.moveTo(ke,Le),F.lineTo(K,et),F.stroke();const Rt=K-ke,Wt=et-Le,Zt=Math.sqrt(Rt*Rt+Wt*Wt)+.001,$e=-Wt/Zt,Ze=Rt/Zt,Fe=Math.max(2,Math.floor(Zt/22));F.fillStyle="#cc44ff",F.globalAlpha=.65;for(let Xe=1;Xe<Fe;Xe++){const jt=ke+Rt*(Xe/Fe),hn=Le+Wt*(Xe/Fe),an=9;F.beginPath(),F.moveTo(jt-$e*an,hn-Ze*an),F.lineTo(jt+$e*3-Wt/Zt*4,hn+Ze*3+Rt/Zt*4),F.lineTo(jt+$e*3+Wt/Zt*4,hn+Ze*3-Rt/Zt*4),F.closePath(),F.fill()}F.globalAlpha=.75,F.fillStyle="#dd66ff",F.beginPath(),F.arc(ke,Le,4,0,Math.PI*2),F.fill(),F.beginPath(),F.arc(K,et,4,0,Math.PI*2),F.fill(),F.globalAlpha=.5,F.fillStyle="#cc44ff",F.font="7px monospace",F.textAlign="center",F.textBaseline="middle",F.fillText("",(ke+K)/2,(Le+et)/2-10)}else F.globalAlpha=.18,F.strokeStyle=J.color,F.lineWidth=6,F.beginPath(),F.moveTo(ke,Le),F.lineTo(K,et),F.stroke(),F.globalAlpha=.75,F.lineWidth=1.2,F.beginPath(),F.moveTo(ke,Le),F.lineTo(K,et),F.stroke(),F.globalAlpha=.55,F.fillStyle=J.color,F.beginPath(),F.arc(ke,Le,3.5,0,Math.PI*2),F.fill(),F.beginPath(),F.arc(K,et,3.5,0,Math.PI*2),F.fill()}if(u){const{x1:J,y1:ke,x2:Le,y2:K}=u,et=c==null?void 0:c.tool,dt=et==="mirror"?"#e8f6ff":et==="absorber"?"#dd3333":et==="membrane"?"#dd66ff":"#ffffff";F.globalAlpha=.65,F.strokeStyle=dt,F.lineWidth=1,F.setLineDash([4,4]),F.beginPath(),F.moveTo(gr(J,P),yr(ke,I)),F.lineTo(gr(Le,P),yr(K,I)),F.stroke(),F.setLineDash([])}if(F.restore(),H$(F,t,P,I,t.elapsed),W$(F,t,P,I),G$(F,t,P,I,t.elapsed),V$(F,t,P,I,t.elapsed),h!=null&&h.length&&h.length>1){F.save(),F.lineCap="round",F.strokeStyle="rgba(255,255,255,0.35)",F.lineWidth=1.2,F.setLineDash([3,4]),F.beginPath(),F.moveTo(gr(h[0][0],P),yr(h[0][1],I));for(let J=1;J<h.length;J++)F.lineTo(gr(h[J][0],P),yr(h[J][1],I));F.stroke(),F.setLineDash([]),F.restore()}if(f){F.save();const J=gr(f.x,P),ke=yr(f.y,I),Le=.5+.5*Math.sin(t.elapsed*6);F.strokeStyle="#cc66ff",F.lineWidth=1.5;for(let K=0;K<3;K++)F.globalAlpha=(.6-K*.15)*(.6+Le*.4),F.beginPath(),F.arc(J,ke,10*(1+K*.6),0,Math.PI*2),F.stroke();F.globalAlpha=.7,F.fillStyle="#cc66ff",F.font="8px monospace",F.textAlign="center",F.textBaseline="middle",F.fillText("A",J,ke),F.restore()}if(g){const{x1:J,y1:ke,x2:Le,y2:K}=g;F.save(),F.lineCap="round",F.globalAlpha=.55,F.strokeStyle="#c8960a",F.lineWidth=2,F.setLineDash([5,4]),F.beginPath(),F.moveTo(gr(J,P),yr(ke,I)),F.lineTo(gr(Le,P),yr(K,I)),F.stroke(),F.setLineDash([]),F.restore()}if(R){const{x1:J,y1:ke,x2:Le,y2:K}=R;F.save(),F.globalAlpha=.65,F.strokeStyle="#00ffcc",F.lineWidth=1.5,F.setLineDash([5,4]);const et=gr(J,P),dt=yr(ke,I),Rt=gr(Le,P),Wt=yr(K,I);F.beginPath(),F.rect(Math.min(et,Rt),Math.min(dt,Wt),Math.abs(Rt-et),Math.abs(Wt-dt)),F.stroke(),F.setLineDash([]),F.restore()}if(j&&j.length>1){F.save(),F.globalAlpha=.5,F.strokeStyle="#ff44cc",F.lineWidth=1.2,F.setLineDash([4,4]),F.beginPath(),F.moveTo(gr(j[0][0],P),yr(j[0][1],I));for(let J=1;J<j.length;J++)F.lineTo(gr(j[J][0],P),yr(j[J][1],I));F.stroke(),F.setLineDash([]),F.restore()}F.save(),F.lineCap="round";for(const J of t.ripples)F.globalAlpha=Math.max(0,J.alpha),F.strokeStyle=J.color,F.lineWidth=J.thick,F.beginPath(),F.arc(gr(J.x,P),yr(J.y,I),J.r*P*.5,0,Math.PI*2),F.stroke();F.restore(),F.save();for(const J of t.emergent){const ke=gr(J.x,P),Le=yr(J.y,I);if(F.globalAlpha=Math.max(0,J.alpha),J.type==="discharge"){const K=F.createRadialGradient(ke,Le,0,ke,Le,J.r*P*.5);K.addColorStop(0,"rgba(255,255,150,.9)"),K.addColorStop(.5,"rgba(255,200,0,.4)"),K.addColorStop(1,"rgba(255,150,0,0)"),F.fillStyle=K,F.beginPath(),F.arc(ke,Le,J.r*P*.5,0,Math.PI*2),F.fill()}else if(J.type==="mutation"){F.strokeStyle="#fff",F.lineWidth=1.5;for(let K=0;K<3;K++)F.globalAlpha=Math.max(0,J.alpha*(1-K*.28)),F.beginPath(),F.arc(ke,Le,(J.r+K*.04)*P*.5,0,Math.PI*2),F.stroke()}}if(F.restore(),d){F.save(),F.lineCap="round";for(const J of t.quanta){if(Math.sqrt(J.vx*J.vx+J.vy*J.vy)<.002)continue;const Le=gr(J.x,P),K=yr(J.y,I),et=gr(J.x+J.vx*4,P),dt=yr(J.y+J.vy*4,I);F.globalAlpha=.4,F.strokeStyle=by(J,o,1,k.mode,k.roleColorOverrides),F.lineWidth=.7,F.beginPath(),F.moveTo(Le,K),F.lineTo(et,dt),F.stroke()}F.restore()}F.save();const Q=r.particleGlow,ae=k.mode,we=k.roleColorOverrides;for(let J=0;J<t.quanta.length;J++){const ke=t.quanta[J],Le=gr(ke.x,P),K=yr(ke.y,I),et=3+ke.charge*2.8,dt=by(ke,o,1,ae,we);if(F.globalAlpha=.22+ke.charge*.1,F.fillStyle=dt,F.beginPath(),F.arc(Le,K,et*Q*1.6,0,Math.PI*2),F.fill(),F.globalAlpha=.9,F.beginPath(),F.arc(Le,K,et*.52,0,Math.PI*2),F.fill(),ke.recentlyFired>0&&(F.globalAlpha=ke.recentlyFired*.7,F.fillStyle="#ffffff",F.beginPath(),F.arc(Le,K,et*2.8,0,Math.PI*2),F.fill()),J===b){const Rt=.55+.45*Math.sin(t.elapsed*8);F.globalAlpha=Rt*.7,F.strokeStyle="#ffffff",F.lineWidth=1.5,F.beginPath(),F.arc(Le,K,et*Q*3.2,0,Math.PI*2),F.stroke()}ke.selected&&(F.globalAlpha=.55,F.strokeStyle="#ffffff",F.lineWidth=1.5,F.beginPath(),F.arc(Le,K,et*Q*2.8,0,Math.PI*2),F.stroke())}if(F.restore(),S){const J=gr(S.x1,P),ke=yr(S.y1,I),Le=gr(S.x2,P),K=yr(S.y2,I),et=Le-J,dt=K-ke;F.save(),F.globalAlpha=.18,F.fillStyle="#88ccff",F.fillRect(J,ke,et,dt),F.globalAlpha=.75,F.strokeStyle="#88ccff",F.lineWidth=1.2,F.setLineDash([4,3]),F.strokeRect(J,ke,et,dt),F.setLineDash([]),F.restore()}if(c){const J=gr(c.wx,P),ke=yr(c.wy,I);switch(F.save(),F.lineCap="round",c.tool){case"excite":{const Le=c.radius*P*.5,K=F.createRadialGradient(J,ke,0,J,ke,Le);K.addColorStop(0,"rgba(255,160,0,.18)"),K.addColorStop(1,"rgba(255,160,0,0)"),F.fillStyle=K,F.beginPath(),F.arc(J,ke,Le,0,Math.PI*2),F.fill(),F.globalAlpha=.5+c.active?.2:0,F.strokeStyle="#ff8800",F.lineWidth=1,F.beginPath(),F.arc(J,ke,Le,0,Math.PI*2),F.stroke();break}case"freeze":{const Le=c.radius*P*.5,K=F.createRadialGradient(J,ke,0,J,ke,Le);K.addColorStop(0,"rgba(100,200,255,.18)"),K.addColorStop(1,"rgba(100,200,255,0)"),F.fillStyle=K,F.beginPath(),F.arc(J,ke,Le,0,Math.PI*2),F.fill(),F.globalAlpha=.5,F.strokeStyle="#88ddff",F.lineWidth=1,F.beginPath(),F.arc(J,ke,Le,0,Math.PI*2),F.stroke();break}case"attractor":{F.globalAlpha=.6,F.strokeStyle="#00aaff",F.lineWidth=1,F.beginPath(),F.arc(J,ke,14,0,Math.PI*2),F.stroke(),F.beginPath(),F.arc(J,ke,5,0,Math.PI*2),F.stroke();for(let Le=0;Le<8;Le++){const K=Le/8*Math.PI*2;F.beginPath(),F.moveTo(J+Math.cos(K)*22,ke+Math.sin(K)*22),F.lineTo(J+Math.cos(K)*16,ke+Math.sin(K)*16),F.stroke()}break}case"repulsor":{F.globalAlpha=.6,F.strokeStyle="#ff4400",F.lineWidth=1,F.beginPath(),F.arc(J,ke,14,0,Math.PI*2),F.stroke();for(let Le=0;Le<8;Le++){const K=Le/8*Math.PI*2;F.beginPath(),F.moveTo(J+Math.cos(K)*8,ke+Math.sin(K)*8),F.lineTo(J+Math.cos(K)*20,ke+Math.sin(K)*20),F.stroke()}break}case"vortex":{F.globalAlpha=.65,F.strokeStyle="#cc44ff",F.lineWidth=1;const Le=performance.now()/1e3;for(let K=8;K<=22;K+=7)F.beginPath(),F.arc(J,ke,K,Le*.5,Le*.5+Math.PI*1.6),F.stroke();break}case"spawn":{F.globalAlpha=.7,F.strokeStyle="#aaffaa",F.lineWidth=1,F.beginPath(),F.arc(J,ke,10,0,Math.PI*2),F.stroke(),F.beginPath(),F.moveTo(J-10,ke),F.lineTo(J+10,ke),F.moveTo(J,ke-10),F.lineTo(J,ke+10),F.stroke();break}case"mutate":{F.globalAlpha=.7,F.strokeStyle="#ff88ff",F.lineWidth=1,F.beginPath(),F.arc(J,ke,12,0,Math.PI*2),F.stroke();const Le=performance.now()/800;F.setLineDash([4,4]),F.beginPath(),F.arc(J,ke,18,Le,Le+Math.PI*1.5),F.stroke(),F.setLineDash([]);break}case"erase":{F.globalAlpha=.5,F.strokeStyle="#ff4466",F.lineWidth=1,F.beginPath(),F.arc(J,ke,12,0,Math.PI*2),F.stroke(),F.beginPath(),F.moveTo(J-7,ke-7),F.lineTo(J+7,ke+7),F.moveTo(J+7,ke-7),F.lineTo(J-7,ke+7),F.stroke();break}case"channel":{F.globalAlpha=.65,F.strokeStyle="rgba(200,210,220,0.7)",F.lineWidth=1,F.beginPath(),F.arc(J,ke,10,0,Math.PI*2),F.stroke();const Le=performance.now()/1e3;F.fillStyle="rgba(200,210,220,0.7)",F.beginPath(),F.moveTo(J+Math.cos(Le)*14,ke+Math.sin(Le)*14),F.lineTo(J+Math.cos(Le+2.4)*6,ke+Math.sin(Le+2.4)*6),F.lineTo(J+Math.cos(Le-2.4)*6,ke+Math.sin(Le-2.4)*6),F.closePath(),F.fill();break}case"tunnel":{F.globalAlpha=.65,F.strokeStyle="#cc66ff",F.lineWidth=1;const Le=.5+.5*Math.sin(performance.now()/200);F.beginPath(),F.arc(J,ke,10*(1+Le*.2),0,Math.PI*2),F.stroke(),F.globalAlpha=.3,F.beginPath(),F.arc(J,ke,18,0,Math.PI*2),F.stroke();break}case"rail":{F.globalAlpha=.65,F.strokeStyle="#c8960a",F.lineWidth=1,F.beginPath(),F.arc(J,ke,10,0,Math.PI*2),F.stroke();for(let Le=0;Le<4;Le++)F.beginPath(),F.moveTo(J,ke-16-Le*3),F.lineTo(J,ke-10-Le*3),F.moveTo(J,ke+10+Le*3),F.lineTo(J,ke+16+Le*3),F.moveTo(J-16-Le*3,ke),F.lineTo(J-10-Le*3,ke),F.moveTo(J+10+Le*3,ke),F.lineTo(J+16+Le*3,ke);F.stroke();break}default:{F.globalAlpha=.35,F.strokeStyle="rgba(255,255,255,.5)",F.lineWidth=1,F.beginPath(),F.arc(J,ke,4,0,Math.PI*2),F.stroke();break}}F.restore()}F.restore(),L.setTransform(1,0,0,1,0,0),T.trails.enabled&&L.drawImage(pe,0,0),L.drawImage(te,0,0);const Re=Math.max(0,Math.min(1,T.post.bloom??0));if(Re>.01&&T.trails.enabled){const ke=Math.max(1,Math.round($*.125)),Le=Math.max(1,Math.round(q*.125));let K=hg.bloom;K||(K=document.createElement("canvas"),hg.bloom=K),(K.width!==ke||K.height!==Le)&&(K.width=ke,K.height=Le);const et=K.getContext("2d");et.imageSmoothingEnabled=!0,et.imageSmoothingQuality="low",et.drawImage(pe,0,0,ke,Le),L.save(),L.globalCompositeOperation="screen",L.globalAlpha=.1+Re*.45,L.imageSmoothingEnabled=!0,L.imageSmoothingQuality="low",L.drawImage(K,0,0,$,q),L.restore()}const ge=Math.max(0,Math.min(1,T.canvas.vignette??0));if(ge>.01){const J=`${P}|${I}|${ge*100|0}`;if(Ec.key!==J){Ec.cvs||(Ec.cvs=document.createElement("canvas")),Ec.cvs.width=P,Ec.cvs.height=I;const ke=Ec.cvs.getContext("2d"),Le=ke.createRadialGradient(P/2,I/2,Math.min(P,I)*.12,P/2,I/2,Math.max(P,I)*.78);Le.addColorStop(0,"rgba(0,0,0,0)"),Le.addColorStop(.6,`rgba(0,0,0,${.05+ge*.22})`),Le.addColorStop(1,`rgba(0,0,0,${.18+ge*.6})`),ke.fillStyle=Le,ke.fillRect(0,0,P,I),Ec.key=J}L.save(),L.setTransform(_,0,0,_,0,0),L.drawImage(Ec.cvs,0,0),L.restore()}L.setTransform(_,0,0,_,0,0);const Ae=40,tt=I-Ae,We=P/B5.length;L.save(),L.globalAlpha=.6,L.fillStyle="#080c14",L.fillRect(0,tt,P,Ae),L.globalAlpha=.25,L.strokeStyle="rgba(255,255,255,.1)",L.lineWidth=1,L.beginPath(),L.moveTo(0,tt),L.lineTo(P,tt),L.stroke();for(let J=0;J<B5.length;J++){const ke=B5[J],Le=t.roleEnergy[ke]??0,K=J*We,et=Math.max(2,Le*(Ae-10)),dt=mo[ke];L.globalAlpha=Le*.38,L.fillStyle=dt,L.fillRect(K+We*.12,tt+(Ae-et)-4,We*.76,et+4),L.globalAlpha=.6+Le*.38,L.fillStyle=dt,L.fillRect(K+We*.3,tt+(Ae-et),We*.4,et),L.globalAlpha=.3+Le*.35,L.fillStyle=dt,L.font="7px monospace",L.textAlign="center",L.textBaseline="bottom",L.fillText(ke,K+We*.5,I-2)}L.restore(),s&&(L.save(),L.textAlign="center",L.textBaseline="top",L.fillStyle=r.primary+"44",L.font=`${Math.max(11,P*.016)}px monospace`,L.fillText(r.name.toUpperCase(),P/2,22),L.font=`${Math.max(8,P*.01)}px monospace`,L.fillStyle=r.accent+"aa",L.fillText(r.vibe,P/2,42),L.restore())}const iR="t4p_musiclab_metaart_snapshot_v1";function Z$(e){var d,h,f,g,m,y,v,b,S;const{state:t,preset:r,palette:o,aesthetic:s,phys:l,roleOverrides:i}=e,u={};for(const C of t.quanta)u[C.role]=(u[C.role]??0)+1;const c={};for(const C of t.fxZones??[])c[C.effect]=(c[C.effect]??0)+1;return{v:1,ts:Date.now(),preset:{id:r.id,name:r.name,tags:r.tags,intensity:r.intensity,bpm:r.bpm,scale:r.scale,root:r.root,reverbAmt:r.reverbAmt,delayAmt:r.delayAmt,delayTime:r.delayTime,primary:r.primary,secondary:r.secondary,accent:r.accent,lens:r.lens,harmonyMode:r.harmonyMode,eventRate:r.eventRate},palette:o,aesthetic:s,phys:l,roleOverrides:i,scene:{quantaCount:t.count,roles:u,roleEnergy:t.roleEnergy??{},gates:((d=t.gates)==null?void 0:d.length)??0,attractors:((h=t.attractors)==null?void 0:h.length)??0,channels:((f=t.channels)==null?void 0:f.length)??0,rails:((g=t.rails)==null?void 0:g.length)??0,tunnels:((m=t.tunnels)==null?void 0:m.length)??0,cages:((y=t.cages)==null?void 0:y.length)??0,strings:((v=t.strings)==null?void 0:v.length)??0,fxZones:((b=t.fxZones)==null?void 0:b.length)??0,sequencerOn:!!((S=t.sequencer)!=null&&S.active),fxKinds:c}}}function J$(e){try{localStorage.setItem(iR,JSON.stringify(e))}catch{}}function Q$(){try{const e=localStorage.getItem(iR);if(!e)return null;const t=JSON.parse(e);return!t||t.v!==1?null:t}catch{return null}}const vr=e=>Math.max(0,Math.min(1,e)),xf=(e,t,r)=>e+(t-e)*r;function eq(e){var s,l,i;const t=((s=e.palette)==null?void 0:s.bgColor)??e.preset.secondary??"#000000",r=[],o=u=>{u&&/^#[0-9a-fA-F]{6}$/.test(u)&&!r.includes(u)&&r.push(u)};if(o(e.preset.primary),o(e.preset.accent),o(e.preset.secondary),o((l=e.palette)==null?void 0:l.accent),(i=e.palette)!=null&&i.roleColorOverrides)for(const u of Object.values(e.palette.roleColorOverrides))o(u);return r.length<3&&r.push("#ffffff","#00d4ff","#ff0084"),{palette:r.slice(0,6),background:t}}function tq(e){const t=new Set((e??[]).map(String));return t.has("Techno")||t.has("Club")||t.has("Rave")||t.has("Breakbeat")?"ecstasy":t.has("Ambient")||t.has("Meditative")||t.has("Drone")?"silence":t.has("Glitch")?"glitch":t.has("Minimalist")||t.has("Minimalist")?"minimal":t.has("Orchestral")||t.has("Choral")||t.has("Strings")?"harmony":"none"}function nq(e){var v,b,S,C,k,R,j,T,_,P,I,$,q;const{palette:t,background:r}=eq(e),o=vr((e.scene.quantaCount??0)/160),s=vr((e.scene.gates+e.scene.rails+e.scene.cages)/16*.9),l=vr(xf(e.preset.reverbAmt??.3,1,.25)*.9),i=vr((e.phys.alignment??.8)/2*.65+(e.scene.channels>0?.25:0)),u=vr((e.preset.intensity??2)/5*.65+(((v=e.palette)==null?void 0:v.mode)==="mono"?.15:.35)),c=vr(((e.preset.bpm??90)-40)/140*.55+vr((e.preset.eventRate??.6)/2.5)*.45),d=vr((e.phys.turbulence??.2)*.75+(Object.keys(e.scene.fxKinds??{}).includes("glitch")?.25:0)),h=vr(((S=(b=e.aesthetic)==null?void 0:b.trails)==null?void 0:S.persistence)??.55),f=(e.ts^e.scene.quantaCount<<5^(e.preset.bpm??0)<<1)>>>0,g={id:`musiclab_${e.preset.id}_${e.ts}`,createdAt:Date.now(),name:`Capa  ${e.preset.name}`,intention:tq(e.preset.tags),background:r,palette:t,quantaCount:Math.round(380+o*900),genes:{structure:s,flow:i,entropy:d,memory:h,contrast:u,symmetry:vr((e.scene.sequencerOn?.4:.2)+(e.preset.scale==="whole_tone"?.1:0)),glyphness:vr(.15+(e.scene.tunnels>0?.2:0)+(e.scene.fxKinds.harmonize_zone?.15:0)),erosion:vr(.15+(e.scene.fxKinds.mute?.2:0)),layering:vr(.25+(e.scene.fxZones>1?.25:0)+l*.2),rhythm:c,fragmentation:vr(.1+(e.scene.tunnels>0?.2:0)+(e.scene.fxKinds.scatter_zone?.2:0)),coherence:vr(.35+(e.preset.harmonyMode==="consonant"?.25:e.preset.harmonyMode==="dissonant"?-.1:0)),linear:vr(.15+(e.scene.channels>0?.2:0)+(e.phys.migrationX||e.phys.migrationY?.15:0))}},m={mode:"hybrid",macroStructure:s,macroGesture:i,macroContrast:u,macroSilence:vr(1-(c*.8+o*.2)),macroAtmosphere:vr(l*.85+h*.15),macroCollage:vr(.12+(e.scene.fxZones>0?.25:0)+d*.15),snapAxes:.12,gridStrength:vr(s*.65),gridSize:.35,lineMastery:vr(.18+s*.55),planeCasting:vr(.15+l*.55),cutWindows:vr(.05+d*.35),mixPoint:vr(.55-s*.15),mixLine:vr(.25+s*.35),mixRect:vr(.08+s*.25),mixArc:vr(.06+i*.3),mixPlane:vr(.06+l*.25),shapeOpacity:vr(.25+l*.35),fillSolidity:vr(.25+u*.45),strokeWeight:xf(.35,1.6,s),shapeScale:xf(.7,1.6,i),rotationDrift:vr(d*.65),vignetteStr:vr(.15+u*.55),grainStr:vr(.15+(((k=(C=e.aesthetic)==null?void 0:C.canvas)==null?void 0:k.grain)??.5)*.65),bloomShape:vr(.12+(((j=(R=e.aesthetic)==null?void 0:R.post)==null?void 0:j.bloom)??.25)*.65),zDepth:vr(.35+s*.55),orbitSpeed:vr(.25+c*.55),camFOV:55,depthFog:vr(.15+l*.65),light3D:vr(.35+u*.45),particleSize3D:xf(.7,1.5,o),glowIntensity3D:vr(.25+(((_=(T=e.aesthetic)==null?void 0:T.quanta)==null?void 0:_.glow)??.65)*.65),waveZ:vr(.2+c*.6),showGeoShapes:!0,solidShapes3D:!1,trails3D:!0,trailLength3D:xf(1,4.5,h),boundaryMode:"wrap",showBorder:!1},y={connections:(((I=(P=e.aesthetic)==null?void 0:P.connections)==null?void 0:I.enabled)??!0)&&(e.scene.quantaCount??0)<=220,glow:(((q=($=e.aesthetic)==null?void 0:$.post)==null?void 0:q.bloom)??0)>.15,pulse:e.scene.sequencerOn||c>.55};return{dna:g,geo:m,overlays:y,seed:f}}const rq="'Doto', monospace",oq="'IBM Plex Mono', monospace",q0="#37b2da",Su=(e=16)=>Array.from({length:e},()=>({on:!1,vel:.8})),pS=()=>[{role:"KICK",muted:!1,solo:!1,steps:Su()},{role:"BASS",muted:!1,solo:!1,steps:Su()},{role:"PERC",muted:!1,solo:!1,steps:Su()},{role:"LEAD",muted:!1,solo:!1,steps:Su()},{role:"ARP",muted:!1,solo:!1,steps:Su()},{role:"PAD",muted:!1,solo:!1,steps:Su()}],aq=[{name:"4 on 4",desc:"Kick em cada beat  techno clssico",steps:{KICK:[0,4,8,12],BASS:[0,4,8,12],PERC:[2,6,10,14],LEAD:[2,10],ARP:[0,2,4,6,8,10,12,14]}},{name:"Boom Bap",desc:"Hip-hop: kick 1+3, snare 2+4",steps:{KICK:[0,6,10],BASS:[0,8],PERC:[4,12],ARP:[2,6,14]}},{name:"Techno",desc:"Groove de 2 barras, bassline acido",steps:{KICK:[0,4,8,12],PERC:[2,6,10,14],BASS:[0,3,8,11],LEAD:[6,14],ARP:[1,5,9,13]}},{name:"Arpejo",desc:"ARP livre, PAD e BASS no 1+3",steps:{ARP:[0,2,4,6,8,10,12,14],PAD:[0,8],BASS:[0,8],KICK:[0,8]}},{name:"Minimal",desc:"Espao e respiro",steps:{KICK:[0,8],BASS:[0,6],PERC:[4],PAD:[0]}},{name:"D&B",desc:"Drum and Bass: kick sincopado",steps:{KICK:[0,10],BASS:[0,3,8,11],PERC:[4,6,12,14],ARP:[0,4,8,12]}},{name:"Afro",desc:"Poliritmo afrobeat",steps:{KICK:[0,3,6,9,12],PERC:[2,5,8,11,14],BASS:[0,6,12],ARP:[2,8,14],LEAD:[4,10]}},{name:"Ambient",desc:"Texturas lentas, sem percusso",steps:{PAD:[0],ARP:[0,4,8,12],LEAD:[4],BASS:[0,8]}}],sq=({rows:e,active:t,stepCount:r,cursor:o,bpm:s,onToggleActive:l,onToggleStep:i,onSetStepCount:u,onToggleMute:c,onToggleSolo:d,onClearRow:h,onLoadPattern:f,onClearAll:g})=>{const[m,y]=w.useState(!1),v=e.some(b=>b.solo);return a.jsxs("div",{className:"flex flex-col select-none",style:{background:"rgba(0,0,0,0.94)",fontFamily:oq},children:[a.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5",style:{borderBottom:"1px dashed rgba(255,255,255,0.04)"},children:[a.jsx("button",{title:t?"Desativar sequencer":"Ativar sequencer",onClick:l,className:"flex items-center gap-1 px-2.5 py-1 transition-all",style:{fontSize:7,letterSpacing:"0.08em",textTransform:"uppercase",color:t?q0:"rgba(255,255,255,0.25)",background:t?`${q0}08`:"transparent",border:t?`1px dashed ${q0}30`:"1px dashed rgba(255,255,255,0.06)"},children:t?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"w-1.5 h-1.5 animate-pulse inline-block mr-0.5",style:{background:q0}}),"ON"]}):a.jsx(a.Fragment,{children:" OFF"})}),a.jsx("span",{style:{fontFamily:rq,fontSize:8,letterSpacing:"0.12em",textTransform:"uppercase",color:"rgba(255,255,255,0.28)"},children:"Studio Seq"}),a.jsxs("span",{style:{fontSize:6,color:"rgba(255,255,255,0.14)"},children:[s," BPM  ",r," steps  4/4"]}),a.jsx("div",{className:"flex-1"}),a.jsxs("div",{className:"flex items-center gap-0.5",children:[a.jsx("span",{style:{fontSize:6,color:"rgba(255,255,255,0.14)",textTransform:"uppercase",marginRight:4},children:"Steps"}),[8,16].map(b=>a.jsx("button",{title:`${b} steps`,onClick:()=>u(b),className:"transition-all",style:{fontSize:7,padding:"2px 8px",color:r===b?q0:"rgba(255,255,255,0.18)",background:r===b?`${q0}08`:"transparent",border:r===b?`1px dashed ${q0}30`:"1px dashed rgba(255,255,255,0.04)"},children:b},b))]}),a.jsxs("div",{className:"relative",children:[a.jsx("button",{title:"Padres",onClick:()=>y(b=>!b),className:"transition-all",style:{fontSize:7,padding:"2px 8px",color:"rgba(255,255,255,0.22)",border:"1px dashed rgba(255,255,255,0.06)"},children:"Padres "}),m&&a.jsx("div",{className:"absolute bottom-full right-0 mb-1 z-50 w-52 py-1",style:{background:"rgba(0,0,0,0.96)",border:"1px dashed rgba(255,255,255,0.06)"},children:aq.map(b=>a.jsxs("button",{title:b.name,onClick:()=>{f(b),y(!1)},className:"w-full text-left px-3 py-1.5 transition-all",style:{background:"transparent"},onMouseEnter:S=>S.currentTarget.style.background="rgba(255,255,255,0.03)",onMouseLeave:S=>S.currentTarget.style.background="transparent",children:[a.jsx("div",{style:{fontSize:7,color:"rgba(255,255,255,0.55)"},children:b.name}),a.jsx("div",{style:{fontSize:6,color:"rgba(255,255,255,0.20)"},children:b.desc})]},b.name))})]}),a.jsx("button",{title:"Limpar tudo",onClick:g,className:"transition-all",style:{fontSize:7,padding:"2px 8px",color:"rgba(255,60,60,0.35)",border:"1px dashed rgba(255,60,60,0.12)"},children:"Limpar"})]}),a.jsxs("div",{className:"px-3 py-2 flex flex-col gap-[3px]",children:[e.map((b,S)=>{const C=mo[b.role],k=b.muted||v&&!b.solo;return a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",style:{width:80},children:[a.jsx("button",{onClick:()=>c(S),title:"Mute",className:"w-[18px] h-[18px] flex items-center justify-center transition-all",style:{fontSize:6,border:`1px dashed ${b.muted?"rgba(255,255,255,0.06)":C+"40"}`,color:b.muted?"rgba(255,255,255,0.15)":C+"bb",background:b.muted?"transparent":C+"08"},children:"M"}),a.jsx("button",{onClick:()=>d(S),title:"Solo",className:"w-[18px] h-[18px] flex items-center justify-center transition-all",style:{fontSize:6,border:`1px dashed ${b.solo?"rgba(255,215,0,0.50)":"rgba(255,255,255,0.04)"}`,color:b.solo?"#ffd700":"rgba(255,255,255,0.15)",background:b.solo?"rgba(255,215,0,0.06)":"transparent"},children:"S"}),a.jsx("span",{className:"flex-1 text-center transition-colors",style:{fontSize:7,letterSpacing:"0.10em",textTransform:"uppercase",color:k?"rgba(255,255,255,0.12)":C},children:b.role.slice(0,3)}),a.jsx("button",{onClick:()=>h(S),style:{fontSize:7,color:"rgba(255,255,255,0.10)"},className:"transition-colors",title:"Limpar linha",children:""})]}),a.jsx("div",{className:"flex gap-px flex-1",children:Array.from({length:r}).map((R,j)=>{const _=(b.steps[j]??{on:!1}).on,P=t&&j===o,I=j%4===0,$=j===0||j===8;return a.jsx("button",{title:`Beat ${j+1}`,onClick:()=>i(S,j),className:`relative flex-1 transition-all ${P?"ring-1 ring-white/70":""}`,style:{height:22,background:_?P?C:k?C+"28":C+"60":I?"rgba(255,255,255,0.04)":"rgba(255,255,255,0.02)",borderBottom:_?`2px solid ${k?C+"35":C}`:$?"1px solid rgba(255,255,255,0.08)":I?"1px solid rgba(255,255,255,0.04)":"1px solid rgba(255,255,255,0.02)",opacity:k&&!P?.4:1}},j)})})]},b.role)}),a.jsx("div",{className:"flex gap-px",style:{marginLeft:88},children:Array.from({length:r}).map((b,S)=>a.jsx("div",{className:"flex-1 flex justify-start pl-0.5",children:S%4===0&&a.jsx("span",{style:{fontSize:5,color:"rgba(255,255,255,0.14)"},children:S/4+1})},S))})]})]})},Pv="'Doto', monospace",Hs="'IBM Plex Mono', monospace",wu="#37b2da",Ro={fontFamily:Hs,fontSize:7,color:"rgba(255,255,255,0.32)",lineHeight:1.8},q5={fontFamily:Hs,fontSize:7,color:"rgba(255,255,255,0.58)",background:"rgba(255,255,255,0.06)",padding:"1px 5px",border:"1px dashed rgba(255,255,255,0.08)",whiteSpace:"nowrap"},pa={padding:"8px 10px",border:"1px dashed rgba(255,255,255,0.05)",marginTop:4},Hl={fontFamily:Hs,fontSize:6,color:"rgba(255,255,255,0.18)",lineHeight:1.8},Bo={fontFamily:Pv,fontSize:8,letterSpacing:"0.10em",textTransform:"uppercase",marginBottom:6},Qa=({c:e,children:t})=>a.jsx("em",{style:{color:`${e}cc`,fontStyle:"normal",fontWeight:500},children:t}),bf=({children:e})=>a.jsx("span",{style:q5,children:e}),Tc=({items:e})=>a.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:4},children:e.map(([t,r])=>a.jsxs("div",{style:{...pa,padding:"5px 8px"},children:[a.jsx("div",{style:{fontFamily:Hs,fontSize:7,color:"rgba(255,255,255,0.55)"},children:t}),a.jsx("div",{style:Hl,children:r})]},t))}),Cu=({items:e,color:t})=>a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:5},children:e.map((r,o)=>a.jsxs("div",{style:{display:"flex",gap:8,alignItems:"flex-start"},children:[a.jsxs("span",{style:{fontFamily:Hs,fontSize:8,color:`${t}55`,width:14,textAlign:"right",flexShrink:0},children:[o+1,"."]}),a.jsx("p",{style:Ro,children:r})]},o))}),Xu=[{title:"O que  o Music Lab?",chapter:"Conceito",icon:"",color:wu,content:a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[a.jsxs("p",{style:{...Ro,fontSize:8,color:"rgba(255,255,255,0.45)"},children:["O Music Lab  um ",a.jsx(Qa,{c:wu,children:"instrumento generativo sinestsico"}),". Partculas com propriedades musicais (pitch, role, charge) circulam num espao fsico e ",a.jsx("em",{style:{fontStyle:"normal",color:"rgba(255,255,255,0.50)"},children:"produzem som ao interagir com o ambiente"}),"."]}),a.jsxs("div",{style:pa,children:[a.jsx("div",{style:{...Bo,color:`${wu}44`},children:"Princpios"}),a.jsx(Cu,{color:wu,items:["Cada partcula tem um ROLE (KICK, BASS, LEAD, PAD, ARP, etc.) que define seu timbre.",'Gate Lines so "linhas de disparo"  quando uma partcula cruza uma, ela emite uma nota.',"A posio, velocidade e energia da partcula influenciam o pitch, o volume e o timbre.","Nada  pr-programado. A msica emerge da fsica e da topologia do espao."]})]}),a.jsx("p",{style:Hl,children:"Resultado: composies que nunca se repetem, mas mantm coerncia harmnica."})]})},{title:"Primeiro Som",chapter:"Passo a passo",icon:"",color:"#4ade80",content:a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[a.jsxs("p",{style:{...Ro,fontSize:8,color:"rgba(255,255,255,0.45)"},children:["Em ",a.jsx(Qa,{c:"#4ade80",children:"3 aes"})," voc ter som. Siga a ordem:"]}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[["1",bf({children:" Start"}),"no topo da toolbar ativa o udio e inicia a simulao."],["2",bf({children:"E + arraste"}),"desenha Gate Lines no canvas  as linhas que disparam notas quando cruzadas."],["3",bf({children:"W + clique"}),"spawna partculas. Elas vo se mover e colidir com os gates, produzindo som."]].map(([e,t,r])=>a.jsxs("div",{style:{display:"flex",gap:10,alignItems:"flex-start"},children:[a.jsx("span",{style:{fontFamily:Pv,fontSize:14,color:"#4ade8044",width:22,textAlign:"right",flexShrink:0,lineHeight:"1.1"},children:e}),a.jsx("div",{children:a.jsxs("div",{style:{...Ro,fontSize:7.5,color:"rgba(255,255,255,0.40)"},children:[t," ",r]})})]},String(e)))}),a.jsxs("div",{style:{...pa,borderColor:"rgba(74,222,128,0.12)"},children:[a.jsx("div",{style:{...Bo,color:"rgba(74,222,128,0.35)"},children:"Dica"}),a.jsxs("p",{style:Ro,children:["Desenhe ",a.jsx("span",{style:{color:"rgba(255,255,255,0.50)"},children:"2-3 gate lines cruzadas"})," pelo centro  quanto mais caminhos, mais variao sonora. Partculas com ",a.jsx("span",{style:{color:"rgba(255,255,255,0.50)"},children:"roles diferentes"})," produzem sons diferentes ao cruzar os mesmos gates."]})]})]})},{title:"Ferramentas",chapter:"Canvas Tools",icon:"",color:"#00d4ff",content:a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[a.jsxs("p",{style:{...Ro,fontSize:8,color:"rgba(255,255,255,0.40)"},children:["A barra lateral esquerda tem ",a.jsx(Qa,{c:"#00d4ff",children:"20 ferramentas"}),". Cada uma modifica o espao de forma diferente."]}),a.jsx("div",{style:{...Bo,color:"rgba(0,212,255,0.35)",marginTop:4},children:"Essenciais"}),a.jsx(Tc,{items:[["Q  Select","Clique/arraste para selecionar partculas."],["W  Spawn","Cria novas partculas no clique."],["E  Gate Line","Desenha linhas que disparam notas."],["P  Erase","Remove partculas e objetos."]]}),a.jsx("div",{style:{...Bo,color:"rgba(0,212,255,0.35)",marginTop:6},children:"Foras"}),a.jsx(Tc,{items:[["A  Attractor","Campo gravitacional que puxa partculas."],["T  Repulsor","Empurra partculas para longe."],["Y  Vortex","Redemoinho que gira partculas."],["U  Excite","Aumenta energia/carga das partculas."],["I  Freeze","Diminui velocidade e carga."],["O  Mutate","Muda o role (timbre) de uma partcula."]]})]})},{title:"Quantum Powers",chapter:"Advanced Tools",icon:"",color:"#cc44ff",content:a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[a.jsxs("p",{style:{...Ro,fontSize:8,color:"rgba(255,255,255,0.40)"},children:["Ferramentas avanadas que criam ",a.jsx(Qa,{c:"#cc44ff",children:"topologias complexas"})," no espao."]}),a.jsx("div",{style:{...Bo,color:"rgba(204,68,255,0.35)",marginTop:4},children:"Quntico"}),a.jsx(Tc,{items:[["1  Q.Channel",'Pinte "vento" direcional  guia partculas.'],["2  G.Rail","Trilho magntico que atrai partculas."],["3  Q.Tunnel","Portal: entrada A  sada B."]]}),a.jsx("div",{style:{...Bo,color:"rgba(204,68,255,0.35)",marginTop:6},children:"Barreiras"}),a.jsx(Tc,{items:[["4  Mirror","Reflete partculas como um espelho."],["5  Absorber","Absorve e destri partculas."],["6  Membrane","Semi-permevel: passa s vezes."]]}),a.jsx("div",{style:{...Bo,color:"rgba(204,68,255,0.35)",marginTop:6},children:"Instrumentos"}),a.jsx(Tc,{items:[["7  Cage","Cerca que prende partculas dentro."],["8  H.String","Corda harmnica que vibra."],["9  FX Zone","Zona pintada com efeito especial."],["0  Metro","Metrnomo espacial pulsante."]]})]})},{title:"Roles & Timbres",chapter:"Som",icon:"",color:"#ff8c00",content:a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[a.jsxs("p",{style:{...Ro,fontSize:8,color:"rgba(255,255,255,0.40)"},children:["Cada partcula tem um ",a.jsx(Qa,{c:"#ff8c00",children:"Voice Role"})," que define seu timbre base. O painel direito (aba Timbre) permite trocar o template de cada role."]}),a.jsx(Tc,{items:[["KICK ","Graves percussivos  ritmo base."],["BASS ","Linhas de baixo  fundao harmnica."],["PERC ","Hi-hats, snares  texturas rtmicas."],["PAD ~","Pads longos  atmosfera e fundo."],["LEAD ","Melodias  linhas principais."],["ARP ","Arpejos rpidos  movimento."],["STRINGS ","Cordas  camadas sustain."],["CHOIR ","Vozes  profundidade coral."]]}),a.jsxs("div",{style:pa,children:[a.jsx("div",{style:{...Bo,color:"rgba(255,140,0,0.35)"},children:"Timbre Templates"}),a.jsxs("p",{style:Ro,children:["No painel direito, clique no template de timbre para mudar: ",a.jsx("span",{style:{color:"rgba(255,255,255,0.45)"},children:"Sub Bass, Acid 303, Hard Kick, FM Bell, Saw Lead, Warm Pad, Shimmer, Glitch"}),", etc. Cada template modifica waveform, filtro, envelope e gain."]})]})]})},{title:"Escalas & Harmonia",chapter:"Teoria Musical",icon:"",color:"#9b59ff",content:a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[a.jsxs("p",{style:{...Ro,fontSize:8,color:"rgba(255,255,255,0.40)"},children:["Todas as notas so ",a.jsx(Qa,{c:"#9b59ff",children:"quantizadas automaticamente"}),' para a escala ativa. Isso garante que tudo soe "certo" mesmo com o caos das partculas.']}),a.jsxs("div",{style:pa,children:[a.jsx("div",{style:{...Bo,color:"rgba(155,89,255,0.35)"},children:"Escalas disponveis"}),a.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:3},children:["Major","Minor","Pentatonic","Blues","Dorian","Phrygian","Lydian","Mixolydian","Whole Tone","Harmonic Minor","Chromatic"].map(e=>a.jsx("span",{style:{...q5,fontSize:6},children:e},e))})]}),a.jsxs("div",{style:pa,children:[a.jsx("div",{style:{...Bo,color:"rgba(155,89,255,0.35)"},children:"Pitch por Role"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:3},children:[["KICK / PERC","Pitch fixo  apenas ritmo e textura."],["BASS","Nota raiz da escala  fundamento."],["LEAD","Cicla pelos graus da escala ativa."],["ARP","Arpejo rpido na escala."],["PAD / STRINGS / CHOIR","Harmonias e cores tonais."]].map(([e,t])=>a.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[a.jsx("span",{style:{...q5,width:100,textAlign:"center",flexShrink:0,fontSize:6},children:e}),a.jsx("span",{style:Ro,children:t})]},e))})]}),a.jsxs("p",{style:Hl,children:["Use o painel superior para alterar Root e Scale em tempo real. Modo ",a.jsx("span",{style:{color:"rgba(255,255,255,0.35)"},children:"Canvas"})," mapeia pitch pela posio X/Y."]})]})},{title:"Fsica & Comportamento",chapter:"Dinmica",icon:"",color:"#39ff70",content:a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[a.jsxs("p",{style:{...Ro,fontSize:8,color:"rgba(255,255,255,0.40)"},children:["O painel direito (aba Physics) controla a ",a.jsx(Qa,{c:"#39ff70",children:"dinmica do movimento"}),". Cada parmetro muda como as partculas se comportam."]}),a.jsx(Tc,{items:[["Damping","Atrito  valores altos = partculas lentas."],["Cohesion","Fora que une partculas prximas."],["Separation","Fora que repele partculas muito perto."],["Max Speed","Velocidade mxima das partculas."],["Turbulence","Caos aleatrio no movimento."],["Alignment","Partculas se alinham na mesma direo."]]}),a.jsxs("div",{style:pa,children:[a.jsx("div",{style:{...Bo,color:"rgba(57,255,112,0.35)"},children:"Motion Styles"}),a.jsxs("p",{style:Ro,children:["Mude o ",a.jsx("span",{style:{color:"rgba(255,255,255,0.45)"},children:"Motion Style"})," (aba Behavior) para padres pr-definidos:",a.jsx("span",{style:{color:"rgba(255,255,255,0.35)"},children:" Swarm, Orbit, Flow, Drift, Spiral, Lattice, Murmuration, Jazz, Meditation, Chaos"}),", etc."]})]})]})},{title:"Studio Sequencer",chapter:"Composio",icon:"",color:"#00e5ff",content:a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[a.jsxs("p",{style:{...Ro,fontSize:8,color:"rgba(255,255,255,0.40)"},children:["O ",a.jsx(Qa,{c:"#00e5ff",children:"Studio Sequencer"})," (painel inferior )  um step sequencer determinstico  diferente das partculas, ele toca ",a.jsx("span",{style:{color:"rgba(255,255,255,0.45)"},children:"exatamente nos beats que voc armar"}),"."]}),a.jsxs("div",{style:pa,children:[a.jsx("div",{style:{...Bo,color:"rgba(0,229,255,0.35)"},children:"Workflow"}),a.jsx(Cu,{color:"#00e5ff",items:["Clique em STUDIO SEQ na barra inferior para expandir.",'Use Padres  para carregar um pattern pronto (ex: "4 on 4").',"Clique nas clulas do grid para ativar/desativar beats.","Use M (mute) e S (solo) para controlar quais roles tocam.","Ajuste o BPM no painel superior para o tempo global."]})]}),a.jsxs("div",{style:pa,children:[a.jsx("div",{style:{...Bo,color:"rgba(0,229,255,0.35)"},children:"Receita: Beat Techno bsico"}),a.jsxs("p",{style:Ro,children:[a.jsx("span",{style:{color:"rgba(255,255,255,0.45)"},children:"KICK no beat 1, 5, 9, 13"}),"  ",a.jsx("span",{style:{color:"rgba(255,255,255,0.45)"},children:"PERC (hi-hat) em todos os beats"}),"  ",a.jsx("span",{style:{color:"rgba(255,255,255,0.45)"},children:"BASS no 1 e 9"}),"  ",a.jsx("span",{style:{color:"rgba(255,255,255,0.45)"},children:"ARP nos off-beats (2, 4, 6...)"}),"."]})]})]})},{title:"Quantum Sequencer",chapter:"Indeterminao",icon:"",color:"#cc44ff",content:a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[a.jsxs("p",{style:{...Ro,fontSize:8,color:"rgba(255,255,255,0.40)"},children:["O ",a.jsx(Qa,{c:"#cc44ff",children:"Quantum Sequencer"}),"  um anel giratrio no canvas. Diferente do Studio Seq,  ",a.jsx("span",{style:{color:"rgba(255,255,255,0.45)"},children:"probabilstico"}),"  dispara notas das partculas mais prximas."]}),a.jsxs("div",{style:pa,children:[a.jsx("div",{style:{...Bo,color:"rgba(204,68,255,0.35)"},children:"Como funciona"}),a.jsx(Cu,{color:"#cc44ff",items:["Ative o Quantum Sequencer no painel (aba Q.Seq).","Um anel aparece no canvas com steps armveis.","O cursor gira na velocidade do BPM.","Quando passa num step armado, dispara a nota da partcula mais prxima.","Se no h partcula perto, aquele step fica em silncio."]})]}),a.jsx("p",{style:Hl,children:"Dica: Use o Studio Seq para KICK/BASS/PERC (ritmo fixo) e o Q.Seq para LEAD/ARP (melodias emergentes)."})]})},{title:"Presets & Vibes",chapter:"Explorao",icon:"",color:"#ffd700",content:a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[a.jsxs("p",{style:{...Ro,fontSize:8,color:"rgba(255,255,255,0.40)"},children:["Presets so ",a.jsx(Qa,{c:"#ffd700",children:"pontos de partida"}),"  combinaes prontas de escala, timbres, quantidade de partculas, physics e visual. Cada um tem uma vibe diferente."]}),a.jsxs("div",{style:pa,children:[a.jsx("div",{style:{...Bo,color:"rgba(255,215,0,0.35)"},children:"Como usar presets"}),a.jsx(Cu,{color:"#ffd700",items:["Abra o painel lateral direito e escolha um preset da lista.","O preset troca escala, BPM, timbres, physics, visual  tudo de uma vez.","Modifique os parmetros livremente: o preset  apenas um starting point.","Use o boto  na toolbar para carregar um preset aleatrio."]})]}),a.jsx("p",{style:Hl,children:"Presets vo de Ambient/Drone at Techno/Rave. Cada um tem tags que indicam o gnero e a energia."})]})},{title:"FX Zones",chapter:"Espao Interativo",icon:"",color:"#ff44cc",content:a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[a.jsxs("p",{style:{...Ro,fontSize:8,color:"rgba(255,255,255,0.40)"},children:[a.jsx(Qa,{c:"#ff44cc",children:"FX Zones"})," so polgonos pintados no canvas com efeitos especiais. Partculas que entram na zona so afetadas."]}),a.jsx("div",{style:{...Bo,color:"rgba(255,68,204,0.35)",marginTop:4},children:"Efeitos disponveis"}),a.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:3},children:[["Slow","Reduz velocidade"],["Fast","Acelera"],["Mute","Silencia notas"],["Excite","Aumenta carga"],["Pitch ","Sobe o pitch"],["Pitch ","Desce o pitch"],["Reverse","Inverte direo"],["Freeze","Congela"],["Vortex","Redemoinho"],["Glitch","Glitch aleatrio"],["Tremolo","Pulso de volume"],["Phase Lock","Sincroniza fase"]].map(([e,t])=>a.jsxs("div",{style:{...pa,padding:"4px 6px"},children:[a.jsx("div",{style:{fontFamily:Hs,fontSize:6,color:"rgba(255,255,255,0.50)"},children:e}),a.jsx("div",{style:{...Hl,fontSize:5},children:t})]},e))}),a.jsxs("p",{style:Hl,children:["Tecla ",a.jsx(bf,{children:"9"})," + clique para desenhar o polgono. Feche com duplo-clique."]})]})},{title:"Capa da Composio",chapter:"Meta-Gen-Art",icon:"",color:"#ff6b6b",content:a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[a.jsxs("p",{style:{...Ro,fontSize:8,color:"rgba(255,255,255,0.40)"},children:["Toda composio merece uma ",a.jsx(Qa,{c:"#ff6b6b",children:"capa visual"}),". O Music Lab pode exportar seus parmetros para o ",a.jsx(Qa,{c:"#ff6b6b",children:"Meta-Gen-Art"}),", que gera uma arte generativa baseada na essncia da sua msica."]}),a.jsxs("div",{style:pa,children:[a.jsx("div",{style:{...Bo,color:"rgba(255,107,107,0.35)"},children:"Como funciona"}),a.jsx(Cu,{color:"#ff6b6b",items:["Monte sua composio no Music Lab (preset, partculas, physics, etc.).",'Clique no boto "Capa" () na toolbar superior.',"Abra o Meta-Gen-Art e clique no boto de importar do MusicLab.","A arte ser gerada com paleta, estrutura e energia da sua msica."]})]}),a.jsxs("div",{style:pa,children:[a.jsx("div",{style:{...Bo,color:"rgba(255,107,107,0.35)"},children:"O que  transferido"}),a.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:3},children:[["Paleta de cores","Primary, accent, role colors"],["Estrutura","Gates, rails, cages  geometria"],["Energia","BPM, turbulence  ritmo visual"],["Atmosfera","Reverb, delay  profundidade"],["Densidade","N de partculas  qtd. shapes"],["Inteno","Tags do preset  mood da arte"]].map(([e,t])=>a.jsxs("div",{style:{...pa,padding:"4px 6px"},children:[a.jsx("div",{style:{fontFamily:Hs,fontSize:6,color:"rgba(255,255,255,0.50)"},children:e}),a.jsx("div",{style:{...Hl,fontSize:5},children:t})]},e))})]})]})},{title:"Modo 3D",chapter:"Visualizao",icon:"",color:"#00aaff",content:a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[a.jsxs("p",{style:{...Ro,fontSize:8,color:"rgba(255,255,255,0.40)"},children:["O boto ",a.jsx(bf,{children:"3D"})," na toolbar ativa a ",a.jsx(Qa,{c:"#00aaff",children:"visualizao tridimensional"}),". O som ",a.jsx("span",{style:{color:"rgba(255,255,255,0.50)"},children:"no muda"}),"   puramente visual."]}),a.jsxs("div",{style:pa,children:[a.jsx("div",{style:{...Bo,color:"rgba(0,170,255,0.35)"},children:"Modos de cmera"}),a.jsx(Tc,{items:[["Orbital","Gira em volta do centro automaticamente."],["Top","Vista de cima  como o 2D, mas com profundidade."],["Side","Vista lateral  pitch como altura."],["FPP","Primeira pessoa  dentro do enxame."]]})]}),a.jsx("p",{style:Hl,children:"Arraste para orbitar. Scroll para zoom. Charge da partcula controla a altura Y."})]})},{title:"Compose Mode",chapter:"Performance",icon:"",color:"#fbbf24",content:a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[a.jsxs("p",{style:{...Ro,fontSize:8,color:"rgba(255,255,255,0.40)"},children:["O ",a.jsx(Qa,{c:"#fbbf24",children:"Compose Mode"})," pausa as partculas para voc posicionar tudo com preciso, e depois ",a.jsx("span",{style:{color:"rgba(255,255,255,0.50)"},children:"solta (Release)"})," para ouvir o resultado."]}),a.jsxs("div",{style:pa,children:[a.jsx("div",{style:{...Bo,color:"rgba(251,191,36,0.35)"},children:"Workflow"}),a.jsx(Cu,{color:"#fbbf24",items:["Ative Compose na toolbar  simulao pausa.","Posicione partculas, gates, attractors, zones com calma.","Ajuste velocity arrastando partculas (direo do arraste = velocidade inicial).","Clique Release   tudo comea a se mover e produzir som.","Use Restore para voltar ao estado anterior ao Release."]})]})]})},{title:"Atalhos de Teclado",chapter:"Referncia",icon:"",color:wu,content:a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[a.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"4px 16px"},children:[["Q","Select"],["W","Spawn"],["E","Gate Line"],["A","Attractor"],["T","Repulsor"],["Y","Vortex"],["U","Excite"],["I","Freeze"],["O","Mutate"],["P","Erase"],["1","Q.Channel"],["2","Gravity Rail"],["3","Q.Tunnel"],["4","Mirror"],["5","Absorber"],["6","Membrane"],["7","Cage"],["8","H.String"],["9","FX Zone"],["0","Metro"],["Space","Play / Pause"],["Del","Deletar selecionado"],["V","Overlays on/off"],["C","Cinematic mode"]].map(([e,t])=>a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[a.jsx("span",{style:{...q5,minWidth:24,textAlign:"center",flexShrink:0},children:e}),a.jsx("span",{style:Ro,children:t})]},e))}),a.jsxs("div",{style:{...pa,marginTop:6},children:[a.jsx("div",{style:{...Bo,color:`${wu}44`},children:"Gamepad"}),a.jsx("p",{style:Ro,children:"Conecte um controle para joystick spawn, trigger gates e haptics sincronizados ao BPM."})]})]})}],iq=[...new Set(Xu.map(e=>e.chapter))],lq=({onClose:e})=>{const[t,r]=w.useState(0),o=Xu[t];return iq.indexOf(o.chapter),a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center",style:{background:"rgba(0,0,0,0.88)"},onClick:e,children:a.jsxs("div",{style:{width:600,maxWidth:"96vw",maxHeight:"92vh",background:"rgba(0,0,0,0.97)",border:"1px dashed rgba(255,255,255,0.06)",overflow:"hidden",display:"flex",flexDirection:"column"},onClick:s=>s.stopPropagation(),children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"14px 20px",borderBottom:"1px dashed rgba(255,255,255,0.05)",flexShrink:0},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:14},children:[a.jsx("span",{style:{fontSize:16,color:o.color+"66",filter:`drop-shadow(0 0 8px ${o.color}22)`},children:o.icon}),a.jsxs("div",{children:[a.jsxs("div",{style:{fontFamily:Hs,fontSize:6,letterSpacing:"0.12em",textTransform:"uppercase",color:"rgba(255,255,255,0.15)",marginBottom:2},children:["Jornada  ",o.chapter,"  ",t+1,"/",Xu.length]}),a.jsx("div",{style:{fontFamily:Pv,fontSize:12,color:o.color+"cc",letterSpacing:"0.04em"},children:o.title})]})]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx("button",{title:"Fechar guia",onClick:e,className:"transition-opacity hover:opacity-70",style:{fontFamily:Hs,fontSize:7,letterSpacing:"0.12em",textTransform:"uppercase",color:"rgba(255,255,255,0.20)",padding:"4px 8px",border:"1px dashed rgba(255,255,255,0.06)"},children:"Pular"}),a.jsx("button",{title:"Fechar",onClick:e,style:{color:"rgba(255,255,255,0.15)"},className:"hover:opacity-70 transition-opacity",children:a.jsx(ya,{size:13})})]})]}),a.jsx("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"10px 20px 0",flexShrink:0},children:Xu.map((s,l)=>{const i=l===0||Xu[l-1].chapter!==s.chapter;return a.jsxs(Yt.Fragment,{children:[i&&l>0&&a.jsx("div",{style:{width:1,height:10,background:"rgba(255,255,255,0.04)",margin:"0 2px"}}),a.jsx("button",{onClick:()=>r(l),className:"transition-all",title:s.title,style:{width:l===t?20:5,height:3,background:l===t?o.color+"88":l<t?o.color+"25":"rgba(255,255,255,0.05)",flexShrink:0}})]},l)})}),a.jsx("div",{style:{padding:"16px 20px 12px",overflowY:"auto",flex:1,minHeight:0},children:o.content}),a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"12px 20px",borderTop:"1px dashed rgba(255,255,255,0.04)",flexShrink:0},children:[a.jsxs("button",{title:"Pgina anterior",onClick:()=>r(s=>Math.max(0,s-1)),disabled:t===0,className:"flex items-center gap-1 transition-all disabled:opacity-0",style:{fontFamily:Hs,fontSize:8,letterSpacing:"0.10em",textTransform:"uppercase",color:o.color+"66"},children:[a.jsx(Ap,{size:10})," Anterior"]}),a.jsx("div",{style:{fontFamily:Hs,fontSize:6,color:"rgba(255,255,255,0.12)",letterSpacing:"0.06em"},children:o.chapter}),t<Xu.length-1?a.jsxs("button",{title:"Prxima pgina",onClick:()=>r(s=>s+1),className:"flex items-center gap-1 transition-all",style:{fontFamily:Hs,fontSize:8,letterSpacing:"0.10em",textTransform:"uppercase",padding:"4px 14px",color:o.color,background:o.color+"08",border:`1px dashed ${o.color}25`},children:["Prximo ",a.jsx(aa,{size:10})]}):a.jsx("button",{title:"Concluir guia",onClick:e,className:"flex items-center gap-1 transition-all",style:{fontFamily:Hs,fontSize:8,letterSpacing:"0.10em",textTransform:"uppercase",padding:"4px 14px",color:o.color,background:o.color+"08",border:`1px dashed ${o.color}25`},children:"Comear "})]})]})})},vy="'IBM Plex Mono', monospace",cq="#37b2da",zl=110,Mu=18,W0=28,mS=({open:e,items:t,position:r,activeId:o,onSelect:s,onClose:l})=>{var v,b,S,C;const[i,u]=w.useState(null),c=w.useRef(null),d=w.useCallback(k=>{var $;const R=k.clientX-r.x,j=k.clientY-r.y;if(Math.sqrt(R*R+j*j)<W0){u(null);return}let _=Math.atan2(j,R);_<0&&(_+=Math.PI*2);const P=Math.PI*2/t.length,I=Math.round(_/P)%t.length;u((($=t[I])==null?void 0:$.id)??null)},[t,r]),h=w.useCallback(()=>{i?s(i):l()},[i,s,l]);if(w.useEffect(()=>{if(!e)return;const k=R=>{R.key==="Escape"&&(l(),R.preventDefault())};return window.addEventListener("keydown",k),()=>window.removeEventListener("keydown",k)},[e,l]),w.useEffect(()=>{e||u(null)},[e]),!e||t.length===0)return null;const f=Math.max(zl+20,Math.min(window.innerWidth-zl-20,r.x)),g=Math.max(zl+20,Math.min(window.innerHeight-zl-20,r.y)),m=Math.PI*2/t.length;let y;return a.jsxs("div",{ref:c,className:"fixed inset-0 z-[200]",style:{cursor:"default"},onMouseMove:d,onMouseUp:h,onClick:l,children:[a.jsx("div",{className:"absolute inset-0",style:{background:"rgba(2,3,8,0.72)"}}),a.jsxs("svg",{style:{position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none"},children:[t.map((k,R)=>{const j=k.group!==void 0&&k.group!==y;if(y=k.group,!j)return null;const T=R*m-m/2,_=f+Math.cos(T)*(W0+6),P=g+Math.sin(T)*(W0+6),I=f+Math.cos(T)*(zl+Mu+4),$=g+Math.sin(T)*(zl+Mu+4);return a.jsx("line",{x1:_,y1:P,x2:I,y2:$,stroke:"rgba(255,255,255,0.06)",strokeWidth:1,strokeDasharray:"3 3"},`div-${R}`)}),a.jsx("circle",{cx:f,cy:g,r:zl,fill:"none",stroke:"rgba(255,255,255,0.04)",strokeWidth:1})]}),a.jsx("div",{style:{position:"absolute",left:f-W0,top:g-W0,width:W0*2,height:W0*2,background:"rgba(0,0,0,0.92)",border:"1px dashed rgba(255,255,255,0.08)",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",pointerEvents:"none"},children:i?a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{fontFamily:vy,fontSize:7,letterSpacing:"0.10em",textTransform:"uppercase",color:((v=t.find(k=>k.id===i))==null?void 0:v.color)??cq,textAlign:"center",lineHeight:1.3},children:(b=t.find(k=>k.id===i))==null?void 0:b.label}),((S=t.find(k=>k.id===i))==null?void 0:S.key)&&a.jsxs("div",{style:{fontFamily:vy,fontSize:6,color:"rgba(255,255,255,0.25)",marginTop:2},children:["[",(C=t.find(k=>k.id===i))==null?void 0:C.key,"]"]})]}):a.jsx("div",{style:{fontFamily:vy,fontSize:6,color:"rgba(255,255,255,0.18)",textTransform:"uppercase",letterSpacing:"0.12em"},children:"Select"})}),t.map((k,R)=>{const j=R*m-Math.PI/2,T=f+Math.cos(j)*zl-Mu,_=g+Math.sin(j)*zl-Mu,P=i===k.id,I=o===k.id,$=P?1.25:1;return a.jsx("div",{style:{position:"absolute",left:T,top:_,width:Mu*2,height:Mu*2,display:"flex",alignItems:"center",justifyContent:"center",background:P?`${k.color}18`:I?`${k.color}0c`:"rgba(0,0,0,0.85)",border:P?`1px solid ${k.color}55`:I?`1px dashed ${k.color}35`:"1px dashed rgba(255,255,255,0.06)",color:P?k.color:I?`${k.color}cc`:"rgba(255,255,255,0.35)",transform:`scale(${$})`,transition:"all 0.1s ease-out",pointerEvents:"none",boxShadow:P?`0 0 16px ${k.color}25`:"none"},children:a.jsx("div",{style:{fontSize:13,lineHeight:1},children:k.icon})},k.id)})]})},dq="'IBM Plex Mono', monospace";function uq(e){try{const t=localStorage.getItem(`dp_${e}`);if(!t)return null;const r=JSON.parse(t);if(typeof r.x=="number"&&typeof r.y=="number")return r}catch{}return null}function hq(e,t,r){try{localStorage.setItem(`dp_${e}`,JSON.stringify({x:t,y:r}))}catch{}}const Qf=({id:e,title:t,titleColor:r,defaultX:o,defaultY:s,zIndex:l=30,defaultMinimized:i=!1,headerExtra:u,width:c,maxHeight:d,children:h,onClose:f,anchorRight:g,anchorBottom:m,persist:y=!0,className:v})=>{const b=y?uq(e):null,[S,C]=w.useState({x:(b==null?void 0:b.x)??o,y:(b==null?void 0:b.y)??s}),[k,R]=w.useState(i),j=w.useRef(!1),T=w.useRef({dx:0,dy:0}),_=w.useRef(null),P=w.useCallback(L=>{L.target.closest("button, input, select")||(L.preventDefault(),L.stopPropagation(),j.current=!0,T.current={dx:L.clientX-S.x,dy:L.clientY-S.y},L.target.setPointerCapture(L.pointerId))},[S]),I=w.useCallback(L=>{if(!j.current)return;const H=L.clientX-T.current.dx,G=L.clientY-T.current.dy;C({x:H,y:G})},[]),$=w.useCallback(L=>{if(!j.current)return;j.current=!1,L.target.releasePointerCapture(L.pointerId);const H=L.clientX-T.current.dx,G=L.clientY-T.current.dy;C({x:H,y:G}),y&&hq(e,H,G)},[e,y]);w.useEffect(()=>{const L=()=>{C(H=>({x:Math.min(H.x,window.innerWidth-40),y:Math.min(H.y,window.innerHeight-24)}))};return window.addEventListener("resize",L),()=>window.removeEventListener("resize",L)},[]);const q={position:"fixed",zIndex:l,fontFamily:dq,background:"rgba(0,0,0,0.94)",border:"1px dashed rgba(255,255,255,0.06)",pointerEvents:"auto",...c!=null?{width:c}:{},...g?{right:S.x,top:S.y}:m?{left:S.x,bottom:S.y}:{left:S.x,top:S.y}};return a.jsxs("div",{ref:_,style:q,className:v,children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,padding:"3px 6px",borderBottom:k?"none":"1px dashed rgba(255,255,255,0.04)",cursor:"grab",userSelect:"none",minHeight:20},onPointerDown:P,onPointerMove:I,onPointerUp:$,children:[a.jsx("span",{style:{fontSize:7,color:"rgba(255,255,255,0.12)",letterSpacing:1,marginRight:2},children:""}),a.jsx("span",{style:{fontSize:7,letterSpacing:"0.12em",textTransform:"uppercase",color:r??"rgba(55,178,218,0.55)",flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t}),u,a.jsx("button",{onClick:()=>R(L=>!L),style:{background:"none",border:"none",padding:"0 2px",color:"rgba(255,255,255,0.20)",fontSize:9,cursor:"pointer",lineHeight:1},title:k?"Expand":"Minimize",children:k?"":""}),f&&a.jsx("button",{onClick:f,style:{background:"none",border:"none",padding:"0 2px",color:"rgba(255,255,255,0.15)",fontSize:9,cursor:"pointer",lineHeight:1},title:"Close",children:""})]}),!k&&a.jsx("div",{style:{overflowY:d?"auto":void 0,maxHeight:d??void 0,scrollbarWidth:"thin",scrollbarColor:"rgba(55,178,218,.08) transparent"},children:h})]})},fq="'Doto', monospace",o5="'IBM Plex Mono', monospace",ku="#37b2da",pq=()=>{const[e,t]=w.useState(!1),[r,o]=w.useState(!1);w.useEffect(()=>{if(!localStorage.getItem("musiclab_patch_01.3_seen")){const i=setTimeout(()=>t(!0),2e3);return()=>clearTimeout(i)}},[]);const s=()=>{t(!1),o(!0),localStorage.setItem("musiclab_patch_01.3_seen","true")};return!e||r?null:a.jsxs("div",{className:"fixed top-20 right-4 z-40 max-w-sm",style:{background:"rgba(0,0,0,0.96)",border:"1px dashed rgba(255,255,255,0.06)",padding:16,animation:"slideIn 0.5s ease-out"},children:[a.jsx("button",{title:"Dispensar",onClick:s,className:"absolute top-2 right-2 transition-colors",style:{color:"rgba(255,255,255,0.20)"},children:a.jsx(ya,{size:13})}),a.jsxs("div",{className:"inline-flex items-center gap-1.5 px-2 py-0.5 mb-3",style:{background:`${ku}08`,border:`1px dashed ${ku}25`},children:[a.jsx("div",{className:"w-1.5 h-1.5 animate-pulse",style:{background:ku}}),a.jsx("span",{style:{fontFamily:o5,fontSize:8,letterSpacing:"0.14em",textTransform:"uppercase",color:`${ku}cc`},children:"Patch 01.3"})]}),a.jsx("h3",{style:{fontFamily:fq,fontSize:12,letterSpacing:"0.06em",textTransform:"uppercase",color:"rgba(255,255,255,0.65)",marginBottom:8},children:"Evolution & 3D Vision"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8,marginBottom:12},children:[["","3D Visualization","Toggle  3D to explore particles in three dimensions"],["","20 New Presets","Organic instruments, experimental FX, physics showcase"],["","Pro Templates","Guitar, sax, cello, sitar, quantum tunneling & more"]].map(([l,i,u])=>a.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:[a.jsx("span",{style:{color:`${ku}88`,fontSize:10,flexShrink:0},children:l}),a.jsxs("p",{style:{fontFamily:o5,fontSize:8,color:"rgba(255,255,255,0.45)",lineHeight:1.6},children:[a.jsx("strong",{style:{color:"rgba(255,255,255,0.65)"},children:i}),"  ",u]})]},i))}),a.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,fontFamily:o5,fontSize:8},children:[["Total Presets","60"],["Camera Modes","4"]].map(([l,i])=>a.jsxs("div",{style:{background:"rgba(255,255,255,0.02)",border:"1px dashed rgba(255,255,255,0.04)",padding:"6px 8px"},children:[a.jsx("div",{style:{color:"rgba(255,255,255,0.25)",marginBottom:2},children:l}),a.jsx("div",{style:{color:ku},children:i})]},l))}),a.jsx("div",{style:{marginTop:12,paddingTop:10,borderTop:"1px dashed rgba(255,255,255,0.04)",fontFamily:o5,fontSize:7,color:"rgba(255,255,255,0.18)",textAlign:"center",letterSpacing:"0.08em"},children:"Explore new sonic territories"})]})},lR=({zoom:e,onZoomIn:t,onZoomOut:r,onReset:o,className:s="",accentColor:l="rgba(255,255,255,0.45)"})=>{const i=Math.round(e*100);return a.jsxs("div",{className:`flex items-center gap-0.5 rounded-lg border px-1.5 py-0.5 backdrop-blur-sm select-none ${s}`,style:{background:"rgba(4,6,14,0.75)",borderColor:"rgba(255,255,255,0.07)"},title:"Scroll para zoom  Boto do meio para mover",children:[a.jsx("button",{onClick:r,className:"w-5 h-5 flex items-center justify-center rounded hover:bg-white/8 transition-colors",style:{color:"rgba(255,255,255,0.38)",fontSize:14,fontFamily:"monospace",lineHeight:1},title:"Zoom out  []",children:""}),a.jsxs("button",{onClick:o,className:"px-1 text-center rounded hover:bg-white/5 transition-colors",style:{color:e===1?"rgba(255,255,255,0.22)":l,fontSize:6.5,fontFamily:"monospace",minWidth:34,letterSpacing:"0.04em"},title:"Resetar zoom [clique]",children:[i,"%"]}),a.jsx("button",{onClick:t,className:"w-5 h-5 flex items-center justify-center rounded hover:bg-white/8 transition-colors",style:{color:"rgba(255,255,255,0.38)",fontSize:14,fontFamily:"monospace",lineHeight:1},title:"Zoom in  [+]",children:"+"}),a.jsx("span",{className:"ml-0.5 hidden sm:block",style:{color:"rgba(255,255,255,0.10)",fontSize:5.5,fontFamily:"monospace"},children:"scroll"})]})};function cR(e){const[o,s]=w.useState(1),[l,i]=w.useState(0),[u,c]=w.useState(0),d=w.useRef(1),h=w.useRef(0),f=w.useRef(0),g=w.useRef(!1),m=w.useRef({cx:0,cy:0,px:0,py:0}),y=w.useCallback((T,_,P)=>{d.current=T,h.current=_,f.current=P,s(T),i(_),c(P)},[]),v=w.useCallback((T,_)=>{T.preventDefault();const P=_.getBoundingClientRect(),I=T.clientX-P.left,$=T.clientY-P.top,q=P.width,L=P.height,H=T.deltaY<0?1.12:1/1.12,G=Math.max(.15,Math.min(10,d.current*H)),oe=I-q/2-(I-q/2-h.current)*G/d.current,le=$-L/2-($-L/2-f.current)*G/d.current;y(G,oe,le)},[.15,10,y]),b=w.useCallback(T=>{const _=T.button===1,P=T.button===0&&T.altKey;return!_&&!P?!1:(T.preventDefault(),g.current=!0,m.current={cx:T.clientX,cy:T.clientY,px:h.current,py:f.current},!0)},[]),S=w.useCallback(T=>{if(!g.current)return!1;const _=m.current.px+(T.clientX-m.current.cx),P=m.current.py+(T.clientY-m.current.cy);return h.current=_,f.current=P,i(_),c(P),!0},[]),C=w.useCallback(T=>{T&&T.button===1?g.current=!1:T?T.button===0&&(g.current=!1):g.current=!1},[]),k=w.useCallback(()=>y(1,0,0),[y]),R=w.useCallback(()=>{const T=Math.min(10,d.current*1.25);y(T,h.current,f.current)},[10,y]),j=w.useCallback(()=>{const T=Math.max(.15,d.current/1.25);y(T,h.current,f.current)},[.15,y]);return{zoom:o,panX:l,panY:u,zoomRef:d,panXRef:h,panYRef:f,isPanning:g,handleWheel:v,handlePanStart:b,handlePanMove:S,handlePanEnd:C,resetView:k,zoomIn:R,zoomOut:j}}function mq(e,t,r,o,s,l){const i=e-r.left,u=t-r.top,c=r.width,d=r.height;return[(i-c/2-s)/(o*c/2),(u-d/2-l)/(o*d/2)]}function gq(e,t,r,o,s,l){const i=e-r.left,u=t-r.top,c=r.width,d=r.height;return[(i-c/2-s)/(o*c)+.5,(u-d/2-l)/(o*d)+.5]}const yq=w.lazy(()=>gl(()=>import("./music3DRenderer-6pXnPp4v.js"),__vite__mapDeps([0,1]))),vf={Techno:"#ff3b5c",Club:"#cc2255",Ambient:"#44ffcc",Eno:"#88ffdd",Classical:"#ffd700",Baroque:"#cc9900",Minimalist:"#aaffaa",Jazz:"#ff9944",Swing:"#ffaa33",Experimental:"#cc44ff",Electronic:"#00d4ff",Generative:"#66ffaa",Meditative:"#aaccff",Drone:"#9966ff",Space:"#88aaff",Romantic:"#ff8899",Reich:"#ccffaa",Glitch:"#ff00ff",Cage:"#aaaaaa","Free Jazz":"#ff6633",Groove:"#ffcc44",Dark:"#cc3366",Soft:"#88ffcc",Rave:"#ff4400",Improvisation:"#ff9966",Breakbeat:"#ff2200",Strings:"#ffdd66",Modal:"#aaffbb",Aquatic:"#00ccff",Arpeggios:"#ccffff",Minimalism:"#ccffcc",Dynamic:"#ff8866",Phasing:"#aaffcc",Choral:"#ffaabb",Orchestral:"#ffcc77"},H0=[{id:"select",icon:a.jsx(fE,{size:13}),label:"Select",key:"Q",color:"#aaaaff"},{id:"spawn",icon:a.jsx(jg,{size:13}),label:"Spawn",key:"W",color:"#aaffaa"},{id:"gate",icon:a.jsx(uE,{size:13}),label:"Gate Line",key:"E",color:"#ffffff"},{id:"attractor",icon:a.jsx(lp,{size:13}),label:"Attractor",key:"A",color:"#00aaff"},{id:"repulsor",icon:a.jsx(mT,{size:13}),label:"Repulsor",key:"T",color:"#ff4400"},{id:"vortex",icon:a.jsx(Ch,{size:13}),label:"Vortex",key:"Y",color:"#cc44ff"},{id:"excite",icon:a.jsx(Es,{size:13}),label:"Excite",key:"U",color:"#ff8800"},{id:"freeze",icon:a.jsx($E,{size:13}),label:"Freeze",key:"I",color:"#88ddff"},{id:"mutate",icon:a.jsx(DE,{size:13}),label:"Mutate",key:"O",color:"#ff88ff"},{id:"erase",icon:a.jsx(j5,{size:13}),label:"Erase",key:"P",color:"#ff4466"},{id:"channel",icon:a.jsx("span",{style:{fontSize:11},children:""}),label:"Q.Channel",key:"1",color:"#c0c8d0"},{id:"rail",icon:a.jsx("span",{style:{fontSize:11},children:""}),label:"G.Rail",key:"2",color:"#c8960a"},{id:"tunnel",icon:a.jsx("span",{style:{fontSize:11},children:""}),label:"Q.Tunnel",key:"3",color:"#cc66ff"},{id:"mirror",icon:a.jsx("span",{style:{fontSize:11},children:""}),label:"Mirror",key:"4",color:"#c0e8ff"},{id:"absorber",icon:a.jsx("span",{style:{fontSize:11},children:""}),label:"Absorber",key:"5",color:"#dd3333"},{id:"membrane",icon:a.jsx("span",{style:{fontSize:11},children:""}),label:"Membrane",key:"6",color:"#cc44ff"},{id:"cage",icon:a.jsx("span",{style:{fontSize:11},children:""}),label:"Cage",key:"7",color:"#00ffcc"},{id:"string",icon:a.jsx("span",{style:{fontSize:11},children:""}),label:"H.String",key:"8",color:"#ffd700"},{id:"zone",icon:a.jsx("span",{style:{fontSize:11},children:""}),label:"FX Zone",key:"9",color:"#ff44cc"},{id:"metro",icon:a.jsx("span",{style:{fontSize:11},children:""}),label:"Metro",key:"0",color:"#ffcc00"}],Ru=["KICK","BASS","PERC","PAD","LEAD","ARP","STRINGS","CHOIR"],xq=[{id:"select",icon:"",label:"Select",color:"#aaaaff",group:"essential",key:"Q"},{id:"spawn",icon:"+",label:"Spawn",color:"#aaffaa",group:"essential",key:"W"},{id:"gate",icon:"",label:"Gate",color:"#ffffff",group:"essential",key:"E"},{id:"erase",icon:"",label:"Erase",color:"#ff4466",group:"essential",key:"P"},{id:"attractor",icon:"",label:"Attractor",color:"#00aaff",group:"forces",key:"A"},{id:"repulsor",icon:"",label:"Repulsor",color:"#ff4400",group:"forces",key:"T"},{id:"vortex",icon:"",label:"Vortex",color:"#cc44ff",group:"forces",key:"Y"},{id:"excite",icon:"",label:"Excite",color:"#ff8800",group:"forces",key:"U"},{id:"freeze",icon:"",label:"Freeze",color:"#88ddff",group:"forces",key:"I"},{id:"mutate",icon:"",label:"Mutate",color:"#ff88ff",group:"forces",key:"O"},{id:"channel",icon:"",label:"Channel",color:"#c0c8d0",group:"quantum",key:"1"},{id:"rail",icon:"",label:"Rail",color:"#c8960a",group:"quantum",key:"2"},{id:"tunnel",icon:"",label:"Tunnel",color:"#cc66ff",group:"quantum",key:"3"},{id:"cage",icon:"",label:"Cage",color:"#00ffcc",group:"instruments",key:"7"},{id:"string",icon:"",label:"String",color:"#ffd700",group:"instruments",key:"8"},{id:"zone",icon:"",label:"FX Zone",color:"#ff44cc",group:"instruments",key:"9"},{id:"metro",icon:"",label:"Metro",color:"#ffcc00",group:"instruments",key:"0"}],bq=[{id:"exciteAll",icon:"",label:"Excite All",color:"#ff8800",group:"power"},{id:"freezeAll",icon:"",label:"Freeze All",color:"#88ddff",group:"power"},{id:"explode",icon:"",label:"Explode",color:"#ff4444",group:"power"},{id:"compress",icon:"",label:"Compress",color:"#aa88ff",group:"power"},{id:"scatter",icon:"",label:"Scatter",color:"#aaffaa",group:"power"},{id:"harmonize",icon:"",label:"Harmonize",color:"#ffd700",group:"power"},{id:"reseed",icon:"",label:"Reseed",color:"#88ffaa",group:"clear"},{id:"addTen",icon:"+10",label:"+10 Quanta",color:"#88aaff",group:"clear"},{id:"removeTen",icon:"10",label:"-10 Quanta",color:"#ff8866",group:"clear"},{id:"clearAll",icon:"",label:"Clear All",color:"#ff4466",group:"clear"}],Sf={KICK:{proportion:1,pitchRange:[36,48],waveform:"kick",filterType:"lowpass",filterFreq:200,filterQ:1,envelope:{attack:.001,decay:.1,sustain:0,release:.08},gainScale:1,detune:0,panSpread:.1,maxVoices:2,cooldownMin:.15},BASS:{proportion:1,pitchRange:[28,52],waveform:"sawtooth",filterType:"lowpass",filterFreq:280,filterQ:3,envelope:{attack:.01,decay:.2,sustain:.65,release:.25},gainScale:.75,detune:0,panSpread:.25,maxVoices:3,cooldownMin:.35},PERC:{proportion:1,pitchRange:[48,84],waveform:"noise",filterType:"highpass",filterFreq:5e3,filterQ:.4,envelope:{attack:.001,decay:.06,sustain:0,release:.04},gainScale:.55,detune:0,panSpread:.6,maxVoices:4,cooldownMin:.18},PAD:{proportion:1,pitchRange:[48,72],waveform:"sine",filterType:"lowpass",filterFreq:900,filterQ:1.2,envelope:{attack:.8,decay:.3,sustain:.8,release:1.5},gainScale:.5,detune:0,panSpread:.8,maxVoices:4,cooldownMin:.9},LEAD:{proportion:1,pitchRange:[52,88],waveform:"sawtooth",filterType:"lowpass",filterFreq:2200,filterQ:2,envelope:{attack:.01,decay:.12,sustain:.5,release:.2},gainScale:.7,detune:0,panSpread:.4,maxVoices:3,cooldownMin:.22},ARP:{proportion:1,pitchRange:[60,96],waveform:"square",filterType:"lowpass",filterFreq:3e3,filterQ:1.5,envelope:{attack:.003,decay:.12,sustain:.15,release:.22},gainScale:.6,detune:0,panSpread:.6,maxVoices:3,cooldownMin:.14},STRINGS:{proportion:1,pitchRange:[48,76],waveform:"triangle",filterType:"lowpass",filterFreq:1800,filterQ:1.5,envelope:{attack:.35,decay:.2,sustain:.7,release:1.2},gainScale:.5,detune:0,panSpread:.9,maxVoices:4,cooldownMin:.7},CHOIR:{proportion:1,pitchRange:[48,72],waveform:"sine",filterType:"lowpass",filterFreq:800,filterQ:1,envelope:{attack:1.2,decay:.5,sustain:.75,release:2.5},gainScale:.45,detune:0,panSpread:1,maxVoices:3,cooldownMin:1.5}},ul=[{name:"Sub Bass",icon:"",color:"#ff8c00",wave:"sine",fType:"lowpass",fFreq:90,fQ:1,env:{attack:.01,decay:.3,sustain:.82,release:.6},gain:.82,det:0,cd:.35},{name:"Acid 303",icon:"",color:"#ff5500",wave:"sawtooth",fType:"lowpass",fFreq:360,fQ:18,env:{attack:.002,decay:.14,sustain:.35,release:.1},gain:.75,det:-7,cd:.14},{name:"Hard Kick",icon:"",color:"#ff3b5c",wave:"kick",fType:"lowpass",fFreq:180,fQ:.5,env:{attack:.001,decay:.08,sustain:0,release:.06},gain:.9,det:0,cd:.4},{name:"FM Bell",icon:"",color:"#00d4c8",wave:"triangle",fType:"bandpass",fFreq:3200,fQ:3,env:{attack:.003,decay:.25,sustain:.1,release:.85},gain:.55,det:0,cd:.22},{name:"Saw Lead",icon:"",color:"#39ff70",wave:"sawtooth",fType:"lowpass",fFreq:2e3,fQ:4,env:{attack:.008,decay:.1,sustain:.5,release:.2},gain:.6,det:7,cd:.18},{name:"Square",icon:"",color:"#00aaff",wave:"square",fType:"lowpass",fFreq:1200,fQ:2.5,env:{attack:.005,decay:.12,sustain:.42,release:.15},gain:.5,det:0,cd:.2},{name:"Warm Pad",icon:"~",color:"#9b59ff",wave:"sawtooth",fType:"lowpass",fFreq:550,fQ:2,env:{attack:.55,decay:.3,sustain:.75,release:1.2},gain:.45,det:0,cd:.85},{name:"Choir",icon:"",color:"#ff69b4",wave:"sine",fType:"lowpass",fFreq:750,fQ:1.2,env:{attack:1.1,decay:.5,sustain:.8,release:2},gain:.45,det:0,cd:2},{name:"Shimmer",icon:"",color:"#ffd700",wave:"triangle",fType:"highpass",fFreq:2400,fQ:1.5,env:{attack:.2,decay:.3,sustain:.6,release:1},gain:.4,det:12,cd:.6},{name:"Snare",icon:"",color:"#00e5ff",wave:"snare",fType:"bandpass",fFreq:2600,fQ:.8,env:{attack:.001,decay:.07,sustain:0,release:.05},gain:.65,det:0,cd:.18},{name:"Hi-Hat",icon:"",color:"#aaccff",wave:"hihat",fType:"highpass",fFreq:5500,fQ:.5,env:{attack:.001,decay:.03,sustain:0,release:.02},gain:.5,det:0,cd:.12},{name:"Glitch",icon:"",color:"#ff00ff",wave:"square",fType:"bandpass",fFreq:2800,fQ:8,env:{attack:.001,decay:.04,sustain:.1,release:.04},gain:.6,det:0,cd:.1}],Yo="'Doto', monospace",$o="'IBM Plex Mono', monospace",xr="#37b2da",Cr=({label:e,value:t,min:r,max:o,step:s,display:l,color:i=xr,onChange:u})=>{const c=((t-r)/(o-r)*100).toFixed(1)+"%";return a.jsxs("div",{className:"flex flex-col gap-0.5",children:[a.jsxs("div",{className:"flex justify-between items-baseline",children:[a.jsx("span",{style:{fontFamily:$o,fontSize:7,color:i+"66",letterSpacing:"0.08em",textTransform:"uppercase"},children:e}),a.jsx("span",{style:{fontFamily:$o,fontSize:7,color:i+"99"},children:l?l(t):t})]}),a.jsx("input",{type:"range",min:r,max:o,step:s,value:t,onChange:d=>u(parseFloat(d.target.value)),className:"h-px w-full appearance-none cursor-pointer",style:{background:`linear-gradient(90deg,${i}55 ${c},rgba(255,255,255,.06) ${c})`}})]})},vq=({label:e,on:t,color:r="#88aaff",onToggle:o})=>a.jsxs("button",{onClick:o,title:`${e}: ${t?"ON":"OFF"}`,className:"flex items-center gap-1.5 text-[8px] font-mono uppercase tracking-widest transition-colors",style:{color:t?r:"rgba(255,255,255,.25)"},children:[a.jsx("span",{children:t?"":""}),e]}),Sq=({currentId:e,onSelect:t,onClose:r})=>{const[o,s]=w.useState(null),l=w.useMemo(()=>Array.from(new Set(Id.flatMap(u=>u.tags))).sort(),[]),i=o?Id.filter(u=>u.tags.includes(o)):Id;return a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center",style:{background:"rgba(0,0,0,0.88)"},onClick:r,children:a.jsxs("div",{className:"w-[820px] max-w-[96vw] max-h-[88vh] flex flex-col border border-dashed border-white/[0.06] bg-black",style:{fontFamily:$o},onClick:u=>u.stopPropagation(),children:[a.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-b border-dashed border-white/[0.06]",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{style:{fontSize:12,color:`${xr}40`},children:""}),a.jsx("span",{style:{fontFamily:Yo,fontSize:10,letterSpacing:"0.14em",textTransform:"uppercase",color:"rgba(255,255,255,0.30)"},children:"60 PRESETS"})]}),a.jsx("button",{onClick:r,title:"Fechar",className:"text-white/25 hover:text-white/60",children:a.jsx(ya,{size:13})})]}),a.jsxs("div",{className:"flex items-center gap-1.5 px-4 py-2 border-b border-dashed border-white/[0.06] overflow-x-auto flex-shrink-0",style:{scrollbarWidth:"none"},children:[a.jsx("button",{onClick:()=>s(null),title:"Mostrar todos os presets",className:`text-[6px] uppercase tracking-[0.14em] px-2 py-0.5 border whitespace-nowrap transition-all
              ${o?"border-white/[0.06] text-white/28 hover:text-white/55":"border-[#37b2da]/50 text-[#37b2da] bg-[#37b2da]/8"}`,style:{fontFamily:$o,borderRadius:0},children:"All"}),l.map(u=>a.jsx("button",{onClick:()=>s(o===u?null:u),title:`Filtrar: ${u}`,className:`text-[6px] uppercase tracking-[0.14em] px-2 py-0.5 border whitespace-nowrap transition-all
                ${o===u?"border-current bg-current/10":"border-white/[0.06] text-white/28 hover:text-white/55"}`,style:{fontFamily:$o,borderRadius:0,...o===u?{color:vf[u]??"#aaa",borderColor:vf[u]??"#aaa"}:{}},children:u},u))]}),a.jsx("div",{className:"grid grid-cols-4 gap-2 p-4 overflow-y-auto",style:{scrollbarWidth:"thin",scrollbarColor:"rgba(55,178,218,.15) transparent"},children:i.map(u=>a.jsxs("button",{onClick:()=>{t(u.id),r()},title:u.name,className:`text-left p-3 border transition-all
                ${u.id===e?"border-[#37b2da]/40 bg-[#37b2da]/[0.04]":"border-white/[0.06] hover:border-white/15 hover:bg-white/[0.02]"}`,style:{borderRadius:0,borderStyle:u.id===e?"solid":"dashed"},children:[a.jsxs("div",{className:"flex items-center gap-0.5 mb-1.5",children:[Array.from({length:5}).map((c,d)=>a.jsx("div",{className:"w-1.5 h-1.5",style:{background:d<u.intensity?u.primary:"rgba(255,255,255,.08)",borderRadius:0}},d)),a.jsxs("span",{className:"ml-1 text-[6px] text-white/18",style:{fontFamily:$o},children:[u.bpm,"bpm"]})]}),a.jsx("div",{className:"text-[9px] mb-0.5 leading-tight",style:{color:u.id===e?u.primary:"rgba(255,255,255,.7)",fontFamily:$o,fontWeight:300},children:u.name}),a.jsx("div",{className:"text-[7px] text-white/25 mb-2 leading-snug line-clamp-1",style:{fontFamily:$o},children:u.vibe}),a.jsx("div",{className:"flex flex-wrap gap-0.5",children:u.tags.slice(0,3).map(c=>a.jsx("span",{className:"text-[5px] uppercase tracking-[0.14em] px-1.5 py-0.5",style:{color:vf[c]??"#aaa",background:(vf[c]??"#aaa")+"10",border:`1px solid ${vf[c]??"#aaa"}28`,fontFamily:$o,borderRadius:0},children:c},c))})]},u.id))})]})})};function wq(e,t,r,o){const s=Gc[o]??Gc.minor;switch(e){case"KICK":return r;case"BASS":return r+12;case"PERC":return r+24;case"PAD":return r+24+(s[2]??4);case"STRINGS":return r+19+(s[0]??0);case"CHOIR":return r+24+(s[3]??5);case"LEAD":{const l=Math.floor(t/2)%s.length;return r+24+s[l]}case"ARP":{const l=t%s.length;return r+24+s[l]}default:return r+24}}const es=db("eno-drift")??Id[0],Cq=({active:e})=>{var w0,C0,Z,Ue,ut;const t=w.useRef(null),r=w.useRef(null),o=w.useRef(es),s=w.useRef(0),l=w.useRef(0),i=w.useRef(!1),u=w.useRef({...Ja,motionStyle:es.motionStyle??"drift"}),c=w.useRef({}),d=w.useRef({wx:0,wy:0,active:!1}),h=w.useRef(-1),f=w.useRef(!1),g=w.useRef(null),m=w.useRef(null),[y,v]=w.useState(null),b=cR(),[S,C]=w.useState(es.id),[k,R]=w.useState(!1),[j,T]=w.useState(!1),[_,P]=w.useState(!1),[I,$]=w.useState(!1),[q,L]=w.useState(es.lens),[H,G]=w.useState(es.bpm),[oe,le]=w.useState(.5),[pe,ce]=w.useState(.65),[te,F]=w.useState("gate"),[Q,ae]=w.useState("PAD"),[we,Re]=w.useState(1),[ge,Ae]=w.useState(.14),[tt,We]=w.useState(.14),[J,ke]=w.useState(!1),[Le,K]=w.useState(!1),et=w.useRef(null),dt=w.useRef(null),[Rt,Wt]=w.useState(!1),[Zt,$e]=w.useState(!1),[Ze,Fe]=w.useState("harmony"),[Xe,jt]=w.useState("PAD"),[hn,an]=w.useState(!1),[it,kt]=w.useState({...Ja,motionStyle:es.motionStyle??"drift"}),[On,sn]=w.useState(""),[Xn,Pt]=w.useState(es.quantaCount),[zt,jn]=w.useState("preset"),[En,lt]=w.useState(!1),ht=w.useRef(!1);w.useEffect(()=>{ht.current=En},[En]);const[_t,Ie]=w.useState("3d-orbital"),[at,St]=w.useState(!0),[ye,xe]=w.useState(!1),[gt,Ge]=w.useState(!0),[Ye,Ve]=w.useState("role"),[Oe,Gt]=w.useState(es.root),[Kt,fn]=w.useState(es.scale),[zn,rt]=w.useState(es.harmonyMode??"consonant"),[mt,yt]=w.useState(es.eventRate??.25),[,Et]=w.useState(0),Ft=w.useRef([]),me=w.useRef(null),cn=w.useRef(!1),[Xt,Dt]=w.useState(null),[ne,Ne]=w.useState(null),Ke=w.useRef(null),[,Ct]=w.useState(null),[ft,At]=w.useState(!1),[bt,nn]=w.useState(1),[Bt,Jt]=w.useState(8),[Qt,en]=w.useState(pS),[vn,Wn]=w.useState(!1),[Gn,cr]=w.useState(16),[pr,br]=w.useState(0),[hr,or]=w.useState(!0),[uo,fr]=w.useState(!1),[Tr,Ir]=w.useState(!1),[jo,bo]=w.useState(!1),[vo,Zo]=w.useState(!1),[Jo,Ua]=w.useState({x:0,y:0}),[Na,sa]=w.useState(!0),[So,Oo]=w.useState(!0),U=w.useRef(!0);w.useEffect(()=>{U.current=So},[So]);const[je,W]=w.useState({...cb}),X=w.useRef({...cb});w.useEffect(()=>{X.current=je},[je]);const[Te,He]=w.useState("meta-lite"),[he,fe]=w.useState({...ub}),be=w.useRef({...ub});w.useEffect(()=>{be.current=he},[he]);const[Ee,Me]=w.useState(0),_e=w.useRef(null),Je=w.useRef(!1),Vt=w.useRef(null),rn=w.useRef(!1),pn=w.useRef([]),re=w.useRef(!1),[de,Se]=w.useState(null),[qe,st]=w.useState("slow"),[$t,Tt]=w.useState(.7),[Ut,ln]=w.useState(.5),[wt,mn]=w.useState(.1),un=w.useRef(pS()),$n=w.useRef(!1),It=w.useRef(16),dn=w.useRef(-1),gn=w.useRef(0);w.useEffect(()=>{un.current=Qt},[Qt]),w.useEffect(()=>{$n.current=vn},[vn]),w.useEffect(()=>{It.current=Gn},[Gn]);const Sn=w.useRef(null),nr=w.useRef(!1),Eo=w.useRef(null),ro=w.useRef(!1),Bn=w.useRef(null),[ar,_o]=w.useState("idle"),[Ar,Nn]=w.useState(0);w.useEffect(()=>(Bn.current=new Nh(_o),()=>{var E;(E=Bn.current)==null||E.dispose()}),[]),w.useEffect(()=>{if(ar!=="recording"){Nn(0);return}const E=setInterval(()=>{var D;return Nn(((D=Bn.current)==null?void 0:D.elapsed)??0)},500);return()=>clearInterval(E)},[ar]),w.useEffect(()=>{const E=t.current;if(!E||!e)return;const D=z=>b.handleWheel(z,E);return E.addEventListener("wheel",D,{passive:!1}),()=>E.removeEventListener("wheel",D)},[e,b.handleWheel]),w.useEffect(()=>{u.current=it},[it]);const Vn=w.useMemo(()=>["C","C#","D","Eb","E","F","F#","G","Ab","A","Bb","B"],[]),ir=w.useMemo(()=>({major:"Major",minor:"Minor",pentatonic:"Penta",blues:"Blues",dorian:"Dorian",phrygian:"Phryg",lydian:"Lydian",mixolydian:"Mixo",whole_tone:"Whole",harmonic_minor:"H.Min",chromatic:"Chrom"}),[]),mr=w.useCallback(E=>{Gt(E),o.current.root=E;const D=r.current;if(D)for(const z of D.quanta)z.pitch=Vc(z.pitch,E,o.current.scale)},[]),Gr=w.useCallback(E=>{fn(E),o.current.scale=E;const D=r.current;if(D)for(const z of D.quanta)z.pitch=Vc(z.pitch,o.current.root,E)},[]),Dr=w.useCallback(E=>{rt(E),o.current.harmonyMode=E},[]),Rr=w.useCallback(E=>{yt(E),o.current.eventRate=E},[]),Ho=w.useCallback(E=>{let D=2166136261;for(let z=0;z<E.length;z++)D^=E.charCodeAt(z),D=Math.imul(D,16777619);return D>>>0},[]),yn=w.useCallback(E=>{let D=E>>>0;return()=>{D|=0,D=D+1831565813|0;let z=Math.imul(D^D>>>15,1|D);return z=z+Math.imul(z^z>>>7,61|z)^z,((z^z>>>14)>>>0)/4294967296}},[]),Vr=w.useCallback((E,D,z)=>Math.max(D,Math.min(z,E)),[]),pi=w.useCallback(E=>yy[E.motionStyle]?E.motionStyle:{swarm:"murmuration",orbit:"revolution",flow:"migration",drift:"meditation",spiral:"revolution",lattice:"school",ballistic:"chaos"}[E.motionStyle]??"murmuration",[]),Us=w.useCallback((E,D)=>{const z=(Ho(E.id)^Math.floor(Vr(D,0,1)*4294967295))>>>0,ee=yn(z),ue=pi(E),Ce=yy[ue]??$f[0];let ze=xy(Ce,{...Ja});ze.entainment=E.entainment;const De=Vr((E.intensity??2)/5,0,1),ct=()=>(ee()-.5)*2;if(ze.damping=Vr((ze.damping??Ja.damping)-De*.012+ct()*.004,.9,.999),ze.maxSpeed=Vr((ze.maxSpeed??Ja.maxSpeed)*(.78+De*.65)+ct()*.06,.02,.9),ze.turbulence=Vr((ze.turbulence??Ja.turbulence)+De*.14+ct()*.12,0,1),ze.cohesion=Vr((ze.cohesion??Ja.cohesion)*(.75+De*.55)+ct()*.35,0,3),ze.separation=Vr((ze.separation??Ja.separation)*(.75+De*.6)+ct()*.35,0,3),ze.alignment=Vr((ze.alignment??Ja.alignment)*(.7+De*.9)+ct()*.25,0,2),ze.zoneRadius=Vr((ze.zoneRadius??Ja.zoneRadius)+ct()*.08,.03,.5),ze.vortexForce=Vr((ze.vortexForce??Ja.vortexForce)+(E.motionStyle==="orbit"?.1:0)+ct()*.06,0,.4),ze.burstRate=Vr((ze.burstRate??Ja.burstRate)+De*.22+ct()*.18,0,1),E.motionStyle==="migration"||E.motionStyle==="exodus"||Ce.motionStyle==="migration"||Ce.motionStyle==="exodus"){const pt=ee()*Math.PI*2;ze.migrationX=Math.cos(pt),ze.migrationY=Math.sin(pt)}return ze.bounceWalls=!1,ze.physicsOnly=!1,ze.restitution=ze.restitution??.82,ze.motionStyle=Ce.motionStyle,{phys:ze,behaviorId:Ce.id}},[xy,Vr,Ho,yn,pi]),Ml=w.useCallback((E,D)=>{const z=r.current;if(!z||z.count<=0)return;const ee=(Ho(E.id+"_tmb")^Math.floor(Vr(D,0,1)*4294967295))>>>0,ue=yn(ee),Ce=new Set((E.tags??[]).map(String)),ze=Ce.has("Ambient")||Ce.has("Meditative")||Ce.has("Drone"),De=Ce.has("Techno")||Ce.has("Club")||Ce.has("Rave")||Ce.has("Breakbeat")||Ce.has("Groove"),ct=Ce.has("Classical")||Ce.has("Orchestral")||Ce.has("Strings")||Ce.has("Choral"),pt={KICK:De?[2,2,2]:[2,2],BASS:De?[0,0,1,0]:ze?[0,0,0]:[0,0,1],PERC:De?[9,10,11,9,10]:[9,10,11],PAD:ze?[6,6,7,8,6]:ct?[6,8,7,6]:[6,6,8,7],LEAD:ze?[3,8,5,3]:De?[4,4,5,1]:ct?[3,5,8]:[4,5,3,8],ARP:De?[3,11,5,3]:[3,8,5],STRINGS:ct?[6,8,7,6]:[6,7,8],CHOIR:ze||ct?[7,7,6,8]:[7,6,8]},on=ze?.22:De?.42:.3;for(const kn of z.quanta){if(ue()>on){kn.timbreIdx=-1;continue}const xn=pt[kn.role]??[6,8,5];kn.timbreIdx=xn[Math.floor(ue()*xn.length)]??-1}},[Vr,Ho,yn]),mi=w.useCallback(E=>{const D=Math.floor(Math.random()*ul.length),z=ul[D];rl(E,{waveform:z.wave,filterType:z.fType,filterFreq:z.fFreq,filterQ:z.fQ,envelope:{...z.env},gainScale:z.gain,detune:z.det,cooldownMin:z.cd})},[]),Lh=w.useCallback(E=>{var z;const D=(z=r.current)==null?void 0:z.quanta[E];D&&(D.timbreIdx=Math.floor(Math.random()*ul.length),Et(ee=>ee+1))},[]),Bd=w.useCallback(E=>{const D=r.current;if(!D)return;const z=o.current,ee=D.quanta.filter(De=>De.selected),ue=ee.length?ee:(()=>{const De=d.current.wx,ct=d.current.wy;let pt=null,on=.14;for(const kn of D.quanta){const xn=Math.hypot(kn.x-De,kn.y-ct);xn<on&&(on=xn,pt=kn)}return pt?[pt]:[]})();if(!ue.length)return;const Ce=(z.root+E)%12,ze=(De,ct,pt,on)=>{let kn=Vr(De,pt,on),xn=1e9;for(let Zn=Math.floor(pt);Zn<=Math.floor(on);Zn++){if((Zn%12+12)%12!==ct)continue;const dr=Math.abs(Zn-De);dr<xn&&(xn=dr,kn=Zn)}return kn};for(const De of ue){const ct=z.roles[De.role]??Sf[De.role],pt=c.current[De.role],on=pt?{...ct,...pt}:ct,[kn,xn]=on.pitchRange??[48,84];De.pitch=ze(De.pitch,Ce,kn,xn)}if(lr.ready){const De=z.roles[Xe]??Sf[Xe],ct=c.current[Xe],pt=ct?{...De,...ct}:De,[on,kn]=pt.pitchRange??[48,84],xn=ze((on+kn)/2,Ce,on,kn);lr.fire({pitch:xn,velocity:.55,role:Xe,x:0,y:0,duration:Math.max(.05,pt.envelope.attack+pt.envelope.decay+pt.envelope.sustain*1.5),timbre:.6},pt)}Et(De=>De+1)},[Vr,Xe]);w.useEffect(()=>{const E=Math.random();r.current=e5(es,{variation:E}),r.current.bpm=es.bpm,Ml(es,E);const{phys:D,behaviorId:z}=Us(es,E);u.current=D,kt(D),sn(z),At(r.current.sequencer.active),Jt(r.current.sequencer.steps.length),nn(r.current.sequencer.tempoMult)},[Us,Ml]);const Oa=w.useCallback((E,D)=>{const z=db(E);if(!z)return;const ee=Math.random();o.current=z,r.current=e5(z,{variation:ee}),r.current.bpm=z.bpm,c.current={},C(E),G(z.bpm),L(z.lens),Pt(z.quantaCount),Ml(z,ee);const{phys:ue,behaviorId:Ce}=Us(z,ee);u.current=ue,kt(ue),sn(Ce),At(r.current.sequencer.active),Jt(r.current.sequencer.steps.length),nn(r.current.sequencer.tempoMult),Gt(z.root),fn(z.scale),rt(z.harmonyMode??"any"),yt(z.eventRate??1),lr.ready&&(lr.setReverb(z.reverbAmt*oe),lr.setDelay(z.delayAmt*oe,z.delayTime),lr.setMasterGain(z.masterGain*pe))},[oe,Us,pe,Ml]);w.useEffect(()=>{r.current&&(r.current.bpm=H)},[H]),w.useEffect(()=>{if(!lr.ready)return;const E=o.current;lr.setReverb(E.reverbAmt*oe),lr.setDelay(E.delayAmt*oe,E.delayTime)},[oe]),w.useEffect(()=>{lr.ready&&lr.setMasterGain(o.current.masterGain*pe)},[pe]);const wn=w.useCallback(async()=>{if(lr.ready)if(k){const E=!i.current;if(i.current=E,T(E),!E)lr.cutAll();else{const D=o.current;lr.restoreGains(D.reverbAmt*wo.current,D.delayAmt*wo.current,D.delayTime,D.masterGain*ia.current)}}else{const E=o.current;lr.restoreGains(E.reverbAmt*wo.current,E.delayAmt*wo.current,E.delayTime,E.masterGain*ia.current),R(!0),i.current=!0,T(!0)}else{await lr.init();const E=o.current;lr.setReverb(E.reverbAmt*oe),lr.setDelay(E.delayAmt*oe,E.delayTime),lr.setMasterGain(E.masterGain*pe),R(!0),i.current=!0,T(!0)}},[oe,pe,k]),zh=w.useRef("Harmony"),Ys=w.useRef(!1),wo=w.useRef(.5),ia=w.useRef(1),is=w.useRef(!1),_a=w.useRef("preset");w.useEffect(()=>{zh.current=q},[q]),w.useEffect(()=>{Ys.current=_},[_]),w.useEffect(()=>{wo.current=oe},[oe]),w.useEffect(()=>{ia.current=pe},[pe]),w.useEffect(()=>{is.current=hn},[hn]),w.useEffect(()=>{_a.current=zt},[zt]);const oc=w.useCallback(E=>{const D=B$(E);D&&(He(E),D.palette&&W(z=>({...z,...D.palette,roleColorOverrides:{...z.roleColorOverrides,...D.palette.roleColorOverrides??{}}})),D.aesthetic&&fe(z=>({...z,...D.aesthetic,canvas:{...z.canvas,...D.aesthetic.canvas??{}},quanta:{...z.quanta,...D.aesthetic.quanta??{}},trails:{...z.trails,...D.aesthetic.trails??{}},connections:{...z.connections,...D.aesthetic.connections??{}},tools:{...z.tools,...D.aesthetic.tools??{}},post:{...z.post,...D.aesthetic.post??{}},overlays:{...z.overlays,...D.aesthetic.overlays??{}},threeD:{...z.threeD,...D.aesthetic.threeD??{}}})))},[]),$d=w.useCallback(()=>{const E=r.current;if(!E)return;const D=Z$({state:E,preset:o.current,palette:X.current,aesthetic:be.current,phys:u.current,roleOverrides:c.current});J$(D),Me(Date.now())},[]);w.useEffect(()=>{if(!e){cancelAnimationFrame(s.current);return}const E=D=>{if(s.current=requestAnimationFrame(E),!t.current||!r.current)return;const z=Math.min(.05,(D-l.current)/1e3);l.current=D;const ee=r.current,ue=o.current;if(i.current){lr.ready&&lr.tickEnergy(z),ee.roleEnergy={...lr.roleEnergy};const ct={};for(const on of Ru){const kn=ue.roles[on]??Sf[on],xn=c.current[on];ct[on]=xn?{...kn,...xn}:kn}const pt={...ue,roles:ct};if(_a.current==="canvas"&&ee.tick%3===0){const on=Gc[pt.scale],kn=Math.max(1,on.length);for(const xn of ee.quanta){const Zn=ct[xn.role]??ue.roles[xn.role]??Sf[xn.role],[dr,Ur]=Zn.pitchRange??[48,84],oo=Vr((xn.x+1)/2,0,1),Do=Vr(1-(xn.y+1)/2,0,1),Lo=Math.floor(oo*kn)%kn,vt=(pt.root+on[Lo])%12,Mt=Math.floor((dr-vt)/12),xt=Math.floor((Ur-vt)/12),Mn=Math.round(Mt+(xt-Mt)*Do),Rn=Vr(vt+Mn*12,dr,Ur);xn.pitch=Vc(Rn,pt.root,pt.scale)}}if(P$(ee,pt,u.current,z,(on,kn)=>{let xn=kn;if(on.timbreIdx!==void 0&&on.timbreIdx>=0){const Zn=ul[on.timbreIdx];Zn&&(xn={...kn,waveform:Zn.wave,filterType:Zn.fType,filterFreq:Zn.fFreq,filterQ:Zn.fQ,envelope:{...Zn.env},gainScale:kn.gainScale*Zn.gain,detune:Zn.det,cooldownMin:Zn.cd})}lr.ready&&lr.fire(on,xn)}),$n.current&&lr.ready){const on=15/ee.bpm;gn.current+=z;let kn=!1;for(;gn.current>=on;){gn.current-=on,dn.current=(dn.current+1)%It.current,kn=!0;const xn=dn.current,Zn=un.current.some(dr=>dr.solo);for(const dr of un.current){if(dr.muted||Zn&&!dr.solo)continue;const Ur=dr.steps[xn];if(!(Ur!=null&&Ur.on))continue;const oo=ue.roles[dr.role];if(!oo)continue;const Do=c.current[dr.role],Lo=Do?{...oo,...Do}:oo,vt=wq(dr.role,xn,ue.root,ue.scale);lr.fire({pitch:vt,velocity:Ur.vel*.92,role:dr.role,x:(Math.random()-.5)*1.6,y:(Math.random()-.5)*1.6,duration:Math.max(.05,Lo.envelope.attack+Lo.envelope.decay+Lo.envelope.sustain*1.5),timbre:.5},Lo)}}kn&&br(dn.current)}}const Ce=ee.beatPhase<.08||ee.beatPhase>.92,ze={tool:te,wx:d.current.wx,wy:d.current.wy,radius:ge,active:d.current.active};ht.current||X$(t.current,ee,ue,zh.current,Ys.current,wo.current,Ce,Sn.current,ze,is.current,Ft.current.length>1?Ft.current:null,ne,Ke.current,b.zoomRef.current,b.panXRef.current,b.panYRef.current,h.current,m.current,U.current,X.current,_e.current,pn.current.length>2?pn.current:null,be.current);const De=et.current;if(De&&t.current){const ct=t.current,pt=ct.getContext("2d");if(pt){const on=Math.min(ct.width,ct.height)/2,kn=ct.width/2+b.panXRef.current*on*b.zoomRef.current,xn=ct.height/2+b.panYRef.current*on*b.zoomRef.current,Zn=b.zoomRef.current,dr=kn+De.x1*on*Zn,Ur=xn+De.y1*on*Zn,oo=kn+De.x2*on*Zn,Do=xn+De.y2*on*Zn,Lo=oo-dr,vt=Do-Ur,Mt=Math.sqrt(Lo*Lo+vt*vt),xt=mo[Q]||"#fff";if(pt.save(),pt.strokeStyle=xt,pt.lineWidth=1.5,pt.globalAlpha=.85,pt.setLineDash([4,3]),pt.beginPath(),pt.moveTo(dr,Ur),pt.lineTo(oo,Do),pt.stroke(),pt.setLineDash([]),Mt>4){const Mn=Lo/Mt,Rn=vt/Mt,Hn=7;pt.beginPath(),pt.moveTo(oo,Do),pt.lineTo(oo-Mn*Hn-Rn*Hn*.5,Do-Rn*Hn+Mn*Hn*.5),pt.lineTo(oo-Mn*Hn+Rn*Hn*.5,Do-Rn*Hn-Mn*Hn*.5),pt.closePath(),pt.fillStyle=xt,pt.fill()}pt.beginPath(),pt.arc(dr,Ur,4,0,Math.PI*2),pt.fillStyle=xt,pt.globalAlpha=.6,pt.fill(),pt.restore()}}};return l.current=performance.now(),s.current=requestAnimationFrame(E),()=>cancelAnimationFrame(s.current)},[e,te,ge,ne]);const Bh=w.useRef(null),[Zi,_p]=w.useState({connected:!1,name:"",axes:{lx:0,ly:0,rx:0,ry:0},triggers:{lt:0,rt:0},buttons:{},justPressed:{},justReleased:{}}),[$h,Dp]=w.useState(!0),[l0,Ts]=w.useState(!1),qh=w.useRef(wn),qd=w.useRef(Oa);w.useEffect(()=>{qh.current=wn},[wn]),w.useEffect(()=>{qd.current=Oa},[Oa]),w.useEffect(()=>{if(!e)return;const E=Iv(),D={x:.5,y:.5},z=.014,ee=Id;let ue=0,Ce=!1,ze=!1,De=!1,ct=!1,pt=!1,on=!1,kn=!1,xn=!1,Zn=!1,dr=!1,Ur=0;const oo={current:120},Do=vt=>{var va,xi,ls;const Mt=requestAnimationFrame(Do);window.__ctrl_music_raf=Mt;const xt=E.poll(vt);if(!xt.connected)return;const Mn=t.current;if(!Mn)return;const Rn=Mn.getBoundingClientRect(),Hn=Rn.width,In=Rn.height;D.x=Math.max(0,Math.min(1,D.x+xt.axes.lx*z)),D.y=Math.max(0,Math.min(1,D.y+xt.axes.ly*z));const sr=Bh.current;sr&&(sr.style.display="block",sr.style.left=`${D.x*100}%`,sr.style.top=`${D.y*100}%`);const bn=((va=b.zoomRef)==null?void 0:va.current)??1,Yr=((xi=b.panXRef)==null?void 0:xi.current)??0,Kr=((ls=b.panYRef)==null?void 0:ls.current)??0,ho=D.x*Hn/bn-Yr/bn,M0=D.y*In/bn-Kr/bn;d.current.wx=ho,d.current.wy=M0,d.current.active=xt.triggers.rt>.06,xt.triggers.lt>.3&&(d.current.active=!1),Math.abs(xt.axes.ry)>.15&&kt(Go=>({...Go,entainment:Math.max(0,Math.min(1,(Go.entainment??.5)-xt.axes.ry*.018))})),xt.buttons.a&&!Ce&&(qh.current(),E.rumble(.2,60)),xt.buttons.b&&!ze&&(i.current=!1,T(!1),lr.cutAll(),E.rumble(.35,80));const fo=["BASS","PAD","LEAD","PERC","ARP","STRINGS"];if(xt.buttons.lb&&!kn){const Go=fo.indexOf(Q);ae(fo[(Go-1+fo.length)%fo.length]),E.rumble(.12,35)}if(xt.buttons.rb&&!xn){const Go=fo.indexOf(Q);ae(fo[(Go+1)%fo.length]),E.rumble(.12,35)}if(xt.buttons.dpadLeft&&!De&&(ue=(ue-1+ee.length)%ee.length,qd.current(ee[ue].id),E.rumble(.12,35)),xt.buttons.dpadRight&&!ct&&(ue=(ue+1)%ee.length,qd.current(ee[ue].id),E.rumble(.12,35)),xt.buttons.dpadUp&&!pt&&G(Go=>Math.min(200,Go+5)),xt.buttons.dpadDown&&!on&&G(Go=>Math.max(40,Go-5)),xt.buttons.start&&!Zn&&Ts(Go=>!Go),xt.buttons.y&&!dr&&E.rumble(.35,80,.4,.6),i.current&&k){oo.current=H;const Go=60/Math.max(40,oo.current)*1e3;vt-Ur>Go*.9&&(E.rumble(xt.triggers.rt>.1?.45:.18,30,.8,.2),Ur=vt)}vt%60<16&&_p({...xt}),Ce=xt.buttons.a,ze=xt.buttons.b,De=xt.buttons.dpadLeft,ct=xt.buttons.dpadRight,pt=xt.buttons.dpadUp,on=xt.buttons.dpadDown,kn=xt.buttons.lb,xn=xt.buttons.rb,Zn=xt.buttons.start,dr=xt.buttons.y},Lo=requestAnimationFrame(Do);return()=>{cancelAnimationFrame(Lo),cancelAnimationFrame(window.__ctrl_music_raf??0)}},[e]);const Ji=w.useCallback(E=>{const D=t.current;return D?mq(E.clientX,E.clientY,D.getBoundingClientRect(),b.zoomRef.current,b.panXRef.current,b.panYRef.current):[0,0]},[b.zoomRef,b.panXRef,b.panYRef]),c0=w.useCallback((E,D,z)=>{const ee=r.current;if(!ee)return;const ue=ge*ge;for(const Ce of ee.quanta){const ze=Ce.x-E,De=Ce.y-D;ze*ze+De*De>ue||(z==="excite"?(Ce.charge=Math.min(1,Ce.charge+.06),Math.sqrt(Ce.vx*Ce.vx+Ce.vy*Ce.vy)>.001&&(Ce.vx*=1.1,Ce.vy*=1.1)):(Ce.vx*=.82,Ce.vy*=.82,Ce.charge=Math.max(0,Ce.charge-.04)))}},[ge]),ac=w.useCallback((E,D,z,ee=0,ue=0)=>{const Ce=r.current,ze=o.current;if(!Ce)return;const De=z??Q,ct=Date.now()%1e5+Ce.quanta.length,pt=ee!==0||ue!==0;for(let on=0;on<we;on++){const kn=(Math.random()-.5)*.06*on,xn=(Math.random()-.5)*.06*on,Zn=ug(ct+on,ze,De,E+kn,D+xn);if(Zn.vx=pt?ee+(Math.random()-.5)*.005:(Math.random()-.5)*.025,Zn.vy=pt?ue+(Math.random()-.5)*.005:(Math.random()-.5)*.025,Zn.charge=.5+Math.random()*.3,Ce.quanta.push(Zn),Ce.count++,Vl(Ce,{pitch:Zn.pitch,velocity:.65,x:E+kn,y:D+xn},mo[De]),lr.ready){const dr=ze.roles[De]??Sf[De];dr&&lr.fire({pitch:Zn.pitch,velocity:.65,role:De,x:E+kn,y:D+xn,duration:dr.envelope.attack+dr.envelope.decay+dr.envelope.release,timbre:.6},dr)}}Pt(Ce.count)},[Q,we]),sc=w.useCallback((E,D)=>{const z=r.current;if(!z)return null;let ee=-1,ue=.08;for(let Ce=0;Ce<z.count;Ce++){const ze=z.quanta[Ce],De=Math.sqrt((ze.x-E)**2+(ze.y-D)**2);De<ue&&(ue=De,ee=Ce)}for(const Ce of z.quanta)Ce.selected=!1;return ee>=0&&(z.quanta[ee].selected=!0),Eo.current=ee>=0?z.quanta[ee].id:null,Et(Ce=>Ce+1),ee>=0?ee:null},[]),gi=w.useCallback((E,D)=>{const z=r.current;if(!z)return;let ee=-1,ue=.08;for(let De=0;De<z.count;De++){const ct=z.quanta[De],pt=Math.sqrt((ct.x-E)**2+(ct.y-D)**2);pt<ue&&(ue=pt,ee=De)}if(ee<0)return;const Ce=z.quanta[ee],ze=Ru.indexOf(Ce.role);Ce.role=Ru[(ze+1)%Ru.length],Ce.mutations++,Ce.roleLockTimer=1.5,z.emergent.push({type:"mutation",x:Ce.x,y:Ce.y,r:.04,alpha:1,color:"#ffffff"}),Et(De=>De+1)},[]),kl=w.useCallback((E,D)=>{const z=r.current;if(!z)return;for(let Ce=z.gates.length-1;Ce>=0;Ce--){const ze=z.gates[Ce],De=ze.x2-ze.x1,ct=ze.y2-ze.y1,pt=De*De+ct*ct;if(pt<1e-4)continue;const on=Math.max(0,Math.min(1,((E-ze.x1)*De+(D-ze.y1)*ct)/pt)),kn=ze.x1+on*De,xn=ze.y1+on*ct;if((E-kn)**2+(D-xn)**2<.03){z.gates.splice(Ce,1);return}}for(let Ce=z.attractors.length-1;Ce>=0;Ce--){const ze=z.attractors[Ce];if((ze.x-E)**2+(ze.y-D)**2<.025){z.attractors.splice(Ce,1);return}}let ee=-1,ue=.07;for(let Ce=0;Ce<z.count;Ce++){const ze=z.quanta[Ce],De=Math.sqrt((ze.x-E)**2+(ze.y-D)**2);De<ue&&(ue=De,ee=Ce)}ee>=0&&(z.quanta.splice(ee,1),z.count--),Pt(z.count),Et(Ce=>Ce+1)},[]),ic=w.useCallback(E=>{if(E.button===1){b.handlePanStart(E);return}if(E.button!==0)return;const[D,z]=Ji(E);d.current.active=!0;const ee=r.current;switch(o.current,te){case"gate":case"mirror":case"absorber":case"membrane":nr.current=!0,Sn.current={x1:D,y1:z,x2:D,y2:z};break;case"spawn":Le?et.current={x1:D,y1:z,x2:D,y2:z}:ac(D,z);break;case"attractor":ee==null||ee.attractors.push({x:D,y:z,strength:tt,vortexStr:0,radius:.55,type:"attractor"});break;case"repulsor":ee==null||ee.attractors.push({x:D,y:z,strength:-tt,vortexStr:0,radius:.45,type:"repulsor"});break;case"vortex":ee==null||ee.attractors.push({x:D,y:z,strength:0,vortexStr:tt*.8,radius:.6,type:"vortex"});break;case"metro":ee==null||ee.attractors.push({x:D,y:z,strength:wt,vortexStr:0,radius:.5,type:"metro"});break;case"excite":case"freeze":nr.current=!0,c0(D,z,te);break;case"select":{if(sc(D,z)!==null)ro.current=!0;else if(f.current=!0,g.current={x:D,y:z},m.current={x1:D,y1:z,x2:D,y2:z},ee)for(const Ce of ee.quanta)Ce.selected=!1;break}case"mutate":gi(D,z);break;case"erase":kl(D,z);break;case"channel":cn.current=!0,Ft.current=[],me.current=[D,z];break;case"rail":nr.current=!0,Ke.current={x1:D,y1:z,x2:D,y2:z},Ct({x1:D,y1:z,x2:D,y2:z});break;case"cage":Je.current=!0,_e.current={x1:D,y1:z,x2:D,y2:z};break;case"string":rn.current=!0,Vt.current={x1:D,y1:z,x2:D,y2:z};break;case"zone":re.current=!0,pn.current=[[D,z]],Se([[D,z]]);break;case"tunnel":if(!ne)Ne({x:D,y:z});else{if(ee){const ue=["#cc66ff","#aa44ee","#ee88ff"];ee.tunnels.push({id:Date.now()%1e5,ax:ne.x,ay:ne.y,bx:D,by:z,radius:.06,color:ue[ee.tunnels.length%ue.length],cd:0})}Ne(null),Et(ue=>ue+1)}break}Et(ue=>ue+1)},[te,Le,tt,wt,c0,ac,sc,gi,kl,Ji,ne]),Wh=w.useCallback(E=>{if(b.handlePanMove(E))return;const[D,z]=Ji(E);if(d.current={...d.current,wx:D,wy:z},et.current&&(et.current={...et.current,x2:D,y2:z}),(te==="gate"||te==="mirror"||te==="absorber"||te==="membrane")&&nr.current&&Sn.current&&(Sn.current={...Sn.current,x2:D,y2:z}),(te==="excite"||te==="freeze")&&nr.current&&c0(D,z,te),te==="select"&&ro.current&&r.current){for(const ee of r.current.quanta)if(ee.selected){ee.x=D,ee.y=z,ee.vx=0,ee.vy=0;break}}if(te==="select"&&r.current&&!ro.current){const ee=r.current;let ue=-1,Ce=.08;for(let ze=0;ze<ee.count;ze++){const De=ee.quanta[ze],ct=Math.sqrt((De.x-D)**2+(De.y-z)**2);ct<Ce&&(Ce=ct,ue=ze)}h.current=ue}else te!=="select"&&(h.current=-1);if(f.current&&g.current){const ee=g.current;m.current={x1:Math.min(ee.x,D),y1:Math.min(ee.y,z),x2:Math.max(ee.x,D),y2:Math.max(ee.y,z)}}if(te==="channel"&&cn.current&&me.current){const[ee,ue]=me.current,Ce=D-ee,ze=z-ue,De=Math.sqrt(Ce*Ce+ze*ze);De>.008&&(Ft.current.push([D,z,Ce/De,ze/De]),me.current=[D,z],Dt([...Ft.current]))}if(te==="rail"&&nr.current&&Ke.current){const ee={...Ke.current,x2:D,y2:z};Ke.current=ee,Ct(ee)}if(te==="cage"&&Je.current&&_e.current&&(_e.current={..._e.current,x2:D,y2:z}),te==="string"&&rn.current&&Vt.current&&(Vt.current={...Vt.current,x2:D,y2:z}),te==="zone"&&re.current){const ee=pn.current[pn.current.length-1];(!ee||Math.sqrt((D-ee[0])**2+(z-ee[1])**2)>.018)&&(pn.current.push([D,z]),Se([...pn.current]))}},[te,c0,Ji]),Qi=w.useCallback(E=>{if(b.handlePanEnd(E),d.current.active=!1,ro.current=!1,et.current&&te==="spawn"){const D=et.current,z=.28,ee=(D.x2-D.x1)*z,ue=(D.y2-D.y1)*z;ac(D.x1,D.y1,void 0,ee,ue),et.current=null,Et(Ce=>Ce+1)}if((te==="gate"||te==="mirror"||te==="absorber"||te==="membrane")&&nr.current&&Sn.current&&r.current){const D=Sn.current;if((D.x2-D.x1)**2+(D.y2-D.y1)**2>.004){const z=o.current,ue={gate:[z.primary,z.secondary,z.accent,"#ffffff"],mirror:["#c8e8ff","#d8f0ff","#a8d8ef"],absorber:["#dd3333","#cc1111","#ff4444"],membrane:["#dd66ff","#cc44ff","#aa22ee"]}[te]??[z.primary];r.current.gates.push({x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,cooldown:0,color:ue[r.current.gates.length%ue.length],type:te})}}if(te==="channel"&&cn.current){if(cn.current=!1,Ft.current.length>3&&r.current){const D=o.current,z=[D.primary,D.secondary,D.accent,"#c0c8d0","#88ffcc"];r.current.channels.push({id:Date.now()%1e5,pts:[...Ft.current],strength:.6,radius:.12,color:z[r.current.channels.length%z.length]})}Ft.current=[],Dt(null)}if(te==="rail"&&nr.current&&Ke.current&&r.current){const D=Ke.current;if((D.x2-D.x1)**2+(D.y2-D.y1)**2>.004){const z=o.current;r.current.rails.push({x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,strength:.5,color:z.accent||"#c8960a"})}Ke.current=null,Ct(null)}if(nr.current=!1,Sn.current=null,f.current&&m.current&&r.current){const D=m.current;for(const z of r.current.quanta)z.selected=z.x>=D.x1&&z.x<=D.x2&&z.y>=D.y1&&z.y<=D.y2}if(f.current=!1,g.current=null,m.current=null,te==="cage"&&Je.current&&_e.current&&r.current){const D=_e.current,z=Math.abs(D.x2-D.x1),ee=Math.abs(D.y2-D.y1);if(z>.04||ee>.04){const ue=["#00ffcc","#00ccff","#88ffaa","#ffcc44"];r.current.cages.push({id:Date.now()%1e5,shape:"rect",x:(D.x1+D.x2)/2,y:(D.y1+D.y2)/2,w:z,h:ee,r:Math.max(z,ee)/2,elasticity:.85,color:ue[r.current.cages.length%ue.length]})}Je.current=!1,_e.current=null}if(te==="string"&&rn.current&&Vt.current&&r.current){const D=Vt.current;if((D.x2-D.x1)**2+(D.y2-D.y1)**2>.003){const z=["#ffd700","#ffaa44","#ffcc88"];r.current.strings.push({id:Date.now()%1e5,x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,tension:.5,vibAmp:0,vibPhase:0,decay:.8,color:z[r.current.strings.length%z.length],lastHit:0})}rn.current=!1,Vt.current=null}if(te==="zone"&&re.current&&r.current){const D=pn.current;if(D.length>=3){const z={slow:"#0066ff",fast:"#ff4400",mute:"#444488",excite_zone:"#ff8800",pitch_up:"#00ff88",pitch_down:"#ff0088",reverse:"#ff00ff",freeze_zone:"#88ccff",vortex_zone:"#cc44ff",gravity_down:"#ff8844",gravity_up:"#44ccff",transpose:"#ffdd00",harmonize_zone:"#88ff44",bounce:"#ff4444",compress_zone:"#4488ff",scatter_zone:"#ff88cc"};r.current.fxZones.push({id:Date.now()%1e5,pts:[...D],effect:qe,strength:$t,param:Ut,color:z[qe]??"#ffffff"})}re.current=!1,pn.current=[],Se(null)}Et(D=>D+1)},[te,ac,Le,qe]),Hh=w.useCallback(()=>{d.current.active=!1,nr.current=!1,ro.current=!1,f.current=!1,m.current=null,et.current=null,Sn.current=null,h.current=-1,Je.current=!1,_e.current=null,rn.current=!1,Vt.current=null,re.current=!1,pn.current=[],Se(null),b.handlePanEnd()},[b.handlePanEnd]),d0=w.useCallback(E=>{E.preventDefault();const[D,z]=Ji(E),ee=r.current;if(!ee)return;let ue=-1,Ce=.1;for(let ze=0;ze<ee.count;ze++){const De=ee.quanta[ze],ct=Math.sqrt((De.x-D)**2+(De.y-z)**2);ct<Ce&&(Ce=ct,ue=ze)}if(ue>=0){for(const ze of ee.quanta)ze.selected=!1;ee.quanta[ue].selected=!0,v({sx:E.clientX,sy:E.clientY,qIdx:ue})}else v(null),Ua({x:E.clientX,y:E.clientY}),bo(!0);Et(ze=>ze+1)},[Ji]);w.useEffect(()=>{if(!e)return;const E=D=>{if(D.target!==document.body&&D.target.tagName!=="CANVAS")return;const z={q:"select",w:"spawn",e:"gate",a:"attractor",t:"repulsor",y:"vortex",u:"excite",i:"freeze",o:"mutate",p:"erase",1:"channel",2:"rail",3:"tunnel",4:"mirror",5:"absorber",6:"membrane",7:"cage",8:"string",9:"zone",0:"metro"};(D.key==="h"||D.key==="H")&&(D.preventDefault(),P(ue=>!ue)),(D.key==="v"||D.key==="V")&&(D.preventDefault(),Oo(ue=>!ue)),(D.key==="r"||D.key==="R")&&(D.preventDefault(),g0.current());const ee=z[D.key.toLowerCase()];if(ee&&F(ee),D.key===" "&&D.shiftKey)D.preventDefault(),Ua({x:window.innerWidth/2,y:window.innerHeight/2}),Zo(!0);else if(D.key===" "){D.preventDefault();const ue=!i.current;if(i.current=ue,T(ue),!ue)lr.cutAll();else{const Ce=o.current;lr.restoreGains(Ce.reverbAmt*wo.current,Ce.delayAmt*wo.current,Ce.delayTime,Ce.masterGain*ia.current)}}if(D.key==="Tab"&&!D.shiftKey&&(D.preventDefault(),Ua({x:window.innerWidth/2,y:window.innerHeight/2}),bo(!0)),(D.ctrlKey||D.metaKey)&&((D.key==="="||D.key==="+")&&(D.preventDefault(),b.zoomIn()),D.key==="-"&&(D.preventDefault(),b.zoomOut()),D.key==="0"&&(D.preventDefault(),b.resetView())),D.key==="Delete"||D.key==="Backspace"){const ue=r.current;if(ue){for(let Ce=ue.quanta.length-1;Ce>=0;Ce--)if(ue.quanta[Ce].selected){ue.quanta.splice(Ce,1),ue.count--;break}}Pt((ue==null?void 0:ue.count)??0)}};return window.addEventListener("keydown",E),()=>window.removeEventListener("keydown",E)},[e]);const lc=()=>{var E;(E=r.current)==null||E.quanta.forEach(D=>{D.charge=Math.min(1,D.charge+.3)})},Da=()=>{var E;(E=r.current)==null||E.quanta.forEach(D=>{D.vx*=.1,D.vy*=.1,D.charge=Math.max(.05,D.charge-.25)})},Wd=()=>{var E;(E=r.current)==null||E.quanta.forEach(D=>{D.x=(Math.random()-.5)*1.6,D.y=(Math.random()-.5)*1.6,D.vx=(Math.random()-.5)*.02,D.vy=(Math.random()-.5)*.02,D.phase=Math.random()})},u0=()=>{lr.cutAll();const E=o.current;lr.restoreGains(E.reverbAmt*wo.current,E.delayAmt*wo.current,E.delayTime,E.masterGain*ia.current),r.current&&(r.current.quanta=[],r.current.count=0),Pt(0)},Hd=()=>{const E=r.current,D=o.current;if(E){for(let z=0;z<10;z++){const ee=Object.keys(D.roles),ue=ee[z%ee.length],Ce=ug(Date.now()%1e5+z,D,ue);E.quanta.push(Ce),E.count++}Pt(E.count)}},cc=()=>{const E=r.current;E&&(E.quanta.splice(Math.max(0,E.count-10)),E.count=E.quanta.length,Pt(E.count))},Gd=()=>{r.current&&(r.current.gates=[]),Et(E=>E+1)},el=()=>{r.current&&(r.current.attractors=[]),Et(E=>E+1)},Rl=()=>{r.current&&(r.current.channels=[],r.current.rails=[],r.current.tunnels=[]),Et(E=>E+1)},Gh=()=>{r.current&&(r.current.cages=[],r.current.strings=[],r.current.fxZones=[]),Et(E=>E+1)},yi=()=>{var E;(E=r.current)==null||E.quanta.forEach(D=>{D.x=(Math.random()-.5)*1.7,D.y=(Math.random()-.5)*1.7,D.vx=(Math.random()-.5)*.04,D.vy=(Math.random()-.5)*.04})},Vd=()=>{var E;(E=r.current)==null||E.quanta.forEach(D=>{D.vx+=-D.x*.12,D.vy+=-D.y*.12})},h0=()=>{var E;(E=r.current)==null||E.quanta.forEach(D=>{const z=Math.sqrt(D.x*D.x+D.y*D.y)+.01;D.vx+=D.x/z*.25,D.vy+=D.y/z*.25})},f0=()=>{const E=r.current,D=o.current;E&&E.quanta.forEach(z=>{z.pitch=Vc(z.pitch,D.root,D.scale)})},xa=()=>{r.current&&(r.current.userMatrix=z5()),Et(E=>E+1)},Is=()=>{const E=["KICK","BASS","PERC","PAD","LEAD","ARP","STRINGS","CHOIR"],D=z5();for(const z of E)for(const ee of E)Math.random()<.38&&(D[z][ee]=parseFloat(((Math.random()*2-1)*.6).toFixed(1)));r.current&&(r.current.userMatrix=D),Et(z=>z+1)},p0=w.useCallback(()=>{lr.cutAll();const E=o.current;lr.restoreGains(E.reverbAmt*wo.current,E.delayAmt*wo.current,E.delayTime,E.masterGain*ia.current);const D=r.current;D&&(D.quanta=[],D.count=0,D.gates=[],D.attractors=[],D.channels=[],D.rails=[],D.tunnels=[],D.cages=[],D.strings=[],D.fxZones=[],D.ripples=[],D.emergent=[],D.userMatrix=z5(),D.sequencer.active=!1,At(!1),Pt(0),Et(z=>z+1))},[]),Ks=w.useCallback(E=>{F(E),bo(!1)},[]),Tn=w.useCallback(E=>{var z;const D={exciteAll:lc,freezeAll:Da,explode:h0,compress:Vd,scatter:yi,harmonize:f0,reseed:Wd,addTen:Hd,removeTen:cc,clearAll:u0};(z=D[E])==null||z.call(D),Zo(!1)},[]),m0=w.useCallback(()=>{const E=dt.current,D=r.current;if(E&&D)lr.cutAll(),D.quanta=E.quanta.map(z=>({...z,trailX:[],trailY:[]})),D.count=D.quanta.length,D.gates=E.gates.map(z=>({...z})),D.attractors=E.attractors.map(z=>({...z})),D.channels=E.channels.map(z=>({...z,pts:[...z.pts]})),D.rails=E.rails.map(z=>({...z})),D.tunnels=E.tunnels.map(z=>({...z})),D.cages=E.cages.map(z=>({...z})),D.strings=E.strings.map(z=>({...z})),D.fxZones=E.fxZones.map(z=>({...z,pts:[...z.pts]})),i.current=!1,T(!1),et.current=null,K(!0),F("spawn"),Pt(D.count),Et(z=>z+1);else{const z=db(S);z&&(o.current=z,r.current=e5(z),r.current.bpm=z.bpm,c.current={},G(z.bpm),L(z.lens),Pt(z.quantaCount),Gt(z.root),fn(z.scale),rt(z.harmonyMode??"any"),yt(z.eventRate??1),lr.cutAll(),i.current=!1,T(!1),K(!1),Wt(!1),Et(ee=>ee+1))}},[S]),g0=w.useRef(()=>{});w.useEffect(()=>{g0.current=m0},[m0]);const y0=w.useCallback(()=>{ke(E=>{const D=!E;if(D){$e(!0),Fe("physics");const z={...Ja,motionStyle:"ballistic",bounceWalls:!0,physicsOnly:!0,gravityX:0,gravityY:.327,damping:.9992,turbulence:0,cohesion:0,separation:0,alignment:0,predatorPrey:!1,mutationRate:0,energyTransfer:0,entainment:0,maxSpeed:2.5,restitution:.72};if(u.current=z,kt({...z}),r.current)for(const ee of r.current.quanta)ee.vx=0,ee.vy=0,ee.charge=.5}else{const z=o.current,ee={...Ja,motionStyle:z.motionStyle??"swarm",bounceWalls:!1,physicsOnly:!1};u.current=ee,kt({...ee})}return D})},[]),Ud=w.useCallback(()=>{K(E=>{const D=!E;if(D){const z=r.current;z&&(dt.current={quanta:z.quanta.map(ee=>({...ee,trailX:[],trailY:[]})),gates:z.gates.map(ee=>({...ee})),attractors:z.attractors.map(ee=>({...ee})),channels:z.channels.map(ee=>({...ee,pts:[...ee.pts]})),rails:z.rails.map(ee=>({...ee})),tunnels:z.tunnels.map(ee=>({...ee})),cages:z.cages.map(ee=>({...ee})),strings:z.strings.map(ee=>({...ee})),fxZones:z.fxZones.map(ee=>({...ee,pts:[...ee.pts]}))},Wt(!0)),i.current=!1,T(!1),lr.cutAll(),F("spawn")}return et.current=null,D})},[]),Ya=w.useCallback(()=>{lr.cutAll();const E=Math.random,D=(ur,Sa,Lr)=>{ur=(ur%360+360)%360,Sa/=100,Lr/=100;const To=Sa*Math.min(Lr,1-Lr),ol=Fs=>{const La=(Fs+ur/30)%12;return Math.round(255*(Lr-To*Math.max(Math.min(La-3,9-La,1),-1))).toString(16).padStart(2,"0")};return"#"+ol(0)+ol(8)+ol(4)},z=Math.floor(E()*360),ee=50+E()*32,ue=D(z,ee,62),Ce=D((z+125)%360,ee*.9,55),ze=D((z+245)%360,ee*1.1,68),De=[60,70,72,75,80,84,85,88,90,95,100,104,108,110,114,120,124,128,130,135,140,144,150,160,170],ct=De[Math.floor(E()*De.length)],pt=["major","minor","pentatonic","blues","dorian","phrygian","lydian","mixolydian","whole_tone","harmonic_minor"],on=Math.floor(E()*12),kn=pt[Math.floor(E()*pt.length)],xn=["free","free","free","consonant","dissonant"],Zn=xn[Math.floor(E()*xn.length)],dr=Zn==="consonant"?"consonant":Zn==="dissonant"?"dissonant":"any",Ur=.3+E()*2.8,oo=.1+E()*.72,Do=[.125,.25,.333,.375,.5,.666,.75],Lo=Do[Math.floor(E()*Do.length)],vt=E()*.55,Mt=.7+E()*.25,xt=15+Math.floor(E()*58),Mn=Math.floor(E()*14),Rn=1+E()*2,Hn=$f[Math.floor(E()*$f.length)],In={...Ja,damping:.918+E()*.068,cohesion:.15+E()*2.5,separation:.25+E()*2,maxSpeed:.05+E()*.5,gravityX:(E()-.5)*.34,gravityY:(E()-.5)*.34,turbulence:E()*.92,mutationRate:E()*.45,energyTransfer:.08+E()*.74,entainment:.06+E()*.84,predatorPrey:E()<.22,motionStyle:Hn.motionStyle,alignment:E()*2.4,zoneRadius:.04+E()*.5,vortexForce:E()*.44,burstRate:E()*.94,migrationX:(E()-.5)*2,migrationY:(E()-.5)*2,clusterTarget:2+Math.floor(E()*22),polarize:E()},sr={KICK:[2,2,2],BASS:[0,0,1,0],PERC:[9,10,11,9,10],PAD:[6,6,7,8,6],LEAD:[4,4,5,3,4],ARP:[3,8,5,3,3],STRINGS:[6,6,7,0],CHOIR:[7,7,6,7]},bn={KICK:{A:[.001,.003],D:[.055,.12],S:[0,.02],R:[.04,.1]},BASS:{A:[.005,.085],D:[.08,.35],S:[.55,.9],R:[.15,.7]},PERC:{A:[.001,.006],D:[.04,.14],S:[0,.18],R:[.03,.12]},PAD:{A:[.3,1.7],D:[.18,.62],S:[.62,.94],R:[.8,3.2]},LEAD:{A:[.004,.028],D:[.07,.24],S:[.32,.72],R:[.1,.45]},ARP:{A:[.001,.01],D:[.07,.3],S:[.04,.32],R:[.12,.75]},STRINGS:{A:[.22,1.3],D:[.14,.48],S:[.58,.92],R:[.48,2.2]},CHOIR:{A:[.75,2.4],D:[.22,.75],S:[.68,.96],R:[1,3.8]}},Yr={KICK:[33,48],BASS:[28,52],PERC:[42,82],PAD:[48,84],LEAD:[52,88],ARP:[60,96],STRINGS:[45,76],CHOIR:[48,80]},Kr=(ur,Sa,Lr)=>ur+(Sa-ur)*Lr,ho={};for(const ur of["KICK","BASS","PERC","PAD","LEAD","ARP","STRINGS","CHOIR"]){const Sa=sr[ur],Lr=ul[Sa[Math.floor(E()*Sa.length)]],To=bn[ur];ho[ur]={proportion:ur==="KICK"?E()<.45?1:2:1+Math.floor(E()*3),pitchRange:Yr[ur],waveform:Lr.wave,filterType:Lr.fType,filterFreq:Math.max(40,Lr.fFreq*Kr(.6,1.55,E())),filterQ:Math.max(.3,Lr.fQ*Kr(.5,1.9,E())),envelope:{attack:Kr(To.A[0],To.A[1],E()),decay:Kr(To.D[0],To.D[1],E()),sustain:Kr(To.S[0],To.S[1],E()),release:Kr(To.R[0],To.R[1],E())},gainScale:Math.max(.1,Lr.gain*Kr(.6,1.4,E())),detune:Lr.det+(E()-.5)*26,panSpread:.28+E()*.72,maxVoices:2+Math.floor(E()*5),cooldownMin:Math.max(.05,Lr.cd*Kr(.45,1.65,E()))}}const M0={id:`rnd_${Date.now()}`,name:"Random",description:"Generative",vibe:"",tags:["random"],intensity:E(),bpm:ct,root:on,scale:kn,harmonyMode:Zn,eventRate:Ur,quantaCount:xt,trailLen:Mn,particleGlow:Rn,roles:ho,syncThreshold:.24+E()*.58,encounterR:.05+E()*.15,entainment:In.entainment,reverbAmt:oo,delayAmt:vt,delayTime:Lo,masterGain:Mt,lens:"Off",bgPulse:!1,cinematic:!1,primary:ue,secondary:Ce,accent:ze,gateCount:0,attractorCount:0,motionStyle:Hn.motionStyle};o.current=M0,r.current=e5(M0),r.current.bpm=ct,c.current={},G(ct),Pt(xt),Gt(on),fn(kn),rt(dr),yt(Ur),kt(In),u.current=In,sn(Hn.id),lr.ready&&lr.restoreGains(oo*oe,vt*oe,Lo,Mt*pe);const fo=r.current;for(const ur of fo.quanta)ur.x=(E()-.5)*1.55,ur.y=(E()-.5)*1.55,ur.vx=(E()-.5)*.06,ur.vy=(E()-.5)*.06,ur.phase=E(),ur.charge=.12+E()*.6,ur.cooldown=E()*.5,ur.trailX=[],ur.trailY=[],ur.timbreIdx=E()<.38?-1:sr[ur.role][Math.floor(E()*sr[ur.role].length)],ur.pitch=Vc(ur.pitch,on,kn);const va=[8,12,16][Math.floor(E()*3)],xi=[.5,1,2,4][Math.floor(E()*4)],ls=.22+E()*.55,Go=["KICK","BASS","PERC","PAD","LEAD","ARP","STRINGS","CHOIR"];fo.sequencer={...fo.sequencer,steps:Array.from({length:va},()=>({armed:E()<ls,pitchOff:Math.floor((E()-.5)*14),vel:.35+E()*.65,role:E()<.55?null:Go[Math.floor(E()*8)]})),stepCd:new Array(va).fill(0),tempoMult:xi,x:(E()-.5)*.8,y:(E()-.5)*.8,ringR:.18+E()*.34,active:E()<.6},Jt(va),nn(xi),At(fo.sequencer.active),fo.attractors=[];for(let ur=0,Sa=Math.floor(E()*5);ur<Sa;ur++){const Lr=["attractor","repulsor","vortex"][Math.floor(E()*3)],To=.04+E()*.2;fo.attractors.push({x:(E()-.5)*1.3,y:(E()-.5)*1.3,strength:Lr==="repulsor"?-To:Lr==="vortex"?0:To,vortexStr:Lr==="vortex"?To*.8:0,radius:.22+E()*.52,type:Lr})}fo.gates=[];const Lp=["gate","gate","mirror","mirror","absorber","membrane","membrane"],zp={gate:[ue,Ce,ze,"#fff"],mirror:["#c8e8ff","#a8d8ef","#d8f0ff"],absorber:["#dd3333","#cc1111","#ff4444"],membrane:["#dd66ff","#cc44ff","#aa22ee"]};for(let ur=0,Sa=1+Math.floor(E()*7);ur<Sa;ur++){const Lr=Lp[Math.floor(E()*Lp.length)],To=(E()-.5)*1.3,ol=(E()-.5)*1.3,Fs=E()*Math.PI,La=.1+E()*.52;fo.gates.push({x1:To-Math.cos(Fs)*La,y1:ol-Math.sin(Fs)*La,x2:To+Math.cos(Fs)*La,y2:ol+Math.sin(Fs)*La,cooldown:0,color:zp[Lr][ur%zp[Lr].length],type:Lr})}Pt(fo.count),Et(ur=>ur+1)},[oe,pe]),Al=w.useCallback(()=>{const E=!$n.current;$n.current=E,E||(gn.current=0,dn.current=-1,br(-1)),Wn(E)},[]),dc=w.useCallback((E,D)=>{en(z=>z.map((ee,ue)=>ue!==E?ee:{...ee,steps:ee.steps.map((Ce,ze)=>ze!==D?Ce:{...Ce,on:!Ce.on})}))},[]),x0=w.useCallback(E=>{en(D=>D.map(z=>{const ee=[...z.steps];for(;ee.length<E;)ee.push({on:!1,vel:.8});for(;ee.length>E;)ee.pop();return{...z,steps:ee}})),cr(E),dn.current=-1,gn.current=0},[]),Yd=w.useCallback(E=>{en(D=>D.map((z,ee)=>ee!==E?z:{...z,muted:!z.muted}))},[]),Kd=w.useCallback(E=>{en(D=>D.map((z,ee)=>ee!==E?z:{...z,solo:!z.solo}))},[]),jl=w.useCallback((E,D)=>{en(z=>z.map((ee,ue)=>ue!==E?ee:{...ee,steps:ee.steps.map(Ce=>({...Ce,vel:D}))}))},[]),Vh=w.useCallback(E=>{en(D=>D.map((z,ee)=>ee!==E?z:{...z,steps:z.steps.map(ue=>({...ue,on:!1}))}))},[]),Uh=w.useCallback(E=>{en(D=>D.map(z=>{const ee=E.steps[z.role],ue=z.steps.map((Ce,ze)=>({...Ce,on:ee?ee.includes(ze):!1}));return{...z,steps:ue}}))},[]),tl=w.useCallback(()=>{en(E=>E.map(D=>({...D,steps:D.steps.map(z=>({...z,on:!1}))})))},[]),b0=w.useCallback(()=>{const E=Bn.current;if(!E)return;let D;try{lr.ready&&(D=lr.createAudioStream())}catch{}E.start(()=>[t.current],()=>{const z=o.current;return{labName:`Music Lab  ${z.name}`,lines:[`Preset: ${z.name}    ${z.bpm} BPM`,`Scale: ${z.root} ${z.scale}    ${z.motionStyle}`,D?" udio + vdeo":" apenas vdeo"]}},30,D)},[]),El=w.useCallback(()=>{var E;(E=Bn.current)==null||E.stop()},[]),v0=w.useCallback(()=>{const E=r.current;if(!E)return;const D=!E.sequencer.active;E.sequencer.active=D,At(D)},[]),Xd=w.useCallback(E=>{const D=r.current;!D||!D.sequencer.steps[E]||(D.sequencer.steps[E].armed=!D.sequencer.steps[E].armed,Et(z=>z+1))},[]),uc=w.useCallback(E=>{const D=r.current;D&&(D.sequencer.tempoMult=E,nn(E))},[]),nl=w.useCallback(E=>{const D=r.current;if(D){for(;D.sequencer.steps.length<E;)D.sequencer.steps.push({armed:!1,pitchOff:0,vel:.65,role:null});for(;D.sequencer.steps.length>E;)D.sequencer.steps.pop();D.sequencer.stepCd=new Array(E).fill(0),Jt(E),Et(z=>z+1)}},[]),Ps=(E,D,z)=>{c.current={...c.current,[E]:{...c.current[E]??{},[D]:z}},Et(ee=>ee+1)},rl=(E,D)=>{c.current={...c.current,[E]:{...c.current[E]??{},...D}},Et(z=>z+1)},ba=(E,D)=>{var ee,ue;const z=(ee=c.current[E])==null?void 0:ee[D];return z!==void 0?z:(ue=o.current.roles[E])==null?void 0:ue[D]},la=(w0=r.current)==null?void 0:w0.quanta.find(E=>E.selected),Xs=o.current,S0=["excite","freeze","spawn","attractor","repulsor","vortex","mutate","erase","channel"].includes(te)?"none":te==="gate"||te==="rail"?"crosshair":te==="tunnel"?"cell":"default",Zd=[{id:"sine",label:""},{id:"triangle",label:""},{id:"sawtooth",label:""},{id:"square",label:""},{id:"noise",label:""},{id:"kick",label:"K"},{id:"snare",label:"S"},{id:"hihat",label:"H"}];return a.jsxs("div",{style:{display:e?"block":"none"},className:"fixed inset-0 z-0",children:[a.jsx("canvas",{ref:t,className:"w-full h-full block",style:{background:"#000",cursor:S0,display:En?"none":"block"},onMouseDown:E=>{y&&v(null),ic(E)},onMouseMove:Wh,onMouseUp:Qi,onMouseLeave:Hh,onContextMenu:d0}),En&&r.current&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-full h-full absolute top-0 left-0",children:a.jsx(w.Suspense,{fallback:a.jsx("div",{className:"w-full h-full flex items-center justify-center bg-black",children:a.jsx("div",{className:"text-[#37b2da] text-[9px] uppercase tracking-[0.2em] animate-pulse",style:{fontFamily:$o},children:"LOADING 3D ENGINE..."})}),children:a.jsx(yq,{state:r.current,width:window.innerWidth,height:window.innerHeight,cameraMode:_t,paused:!j,showGrid:at,showAxes:ye,showTrails:gt,colorMode:Ye})})}),a.jsxs("div",{className:"fixed bottom-4 right-4 z-30 flex flex-col gap-1.5 pointer-events-auto",style:{fontFamily:$o},children:[a.jsxs("div",{className:"px-2.5 py-1.5",style:{background:"rgba(0,0,0,0.94)",border:"1px dashed rgba(255,255,255,0.06)"},children:[a.jsx("div",{style:{fontSize:6,letterSpacing:"0.12em",textTransform:"uppercase",color:"rgba(55,178,218,0.40)",marginBottom:3},children:"COLOR"}),a.jsx("div",{className:"flex gap-1",children:["role","charge","velocity"].map(E=>a.jsx("button",{onClick:()=>Ve(E),title:`Colorir por ${E}`,className:"transition-all",style:{fontSize:6,letterSpacing:"0.08em",textTransform:"uppercase",padding:"2px 6px",color:Ye===E?xr:"rgba(255,255,255,0.22)",background:Ye===E?"rgba(55,178,218,0.06)":"transparent",border:Ye===E?`1px dashed ${xr}30`:"1px dashed rgba(255,255,255,0.05)"},children:E},E))})]}),a.jsxs("div",{className:"px-2.5 py-1.5",style:{background:"rgba(0,0,0,0.94)",border:"1px dashed rgba(255,255,255,0.06)"},children:[a.jsx("div",{style:{fontSize:6,letterSpacing:"0.12em",textTransform:"uppercase",color:"rgba(55,178,218,0.40)",marginBottom:3},children:"OVERLAYS"}),a.jsx("div",{className:"flex gap-1 flex-wrap",children:[{label:"Grid",v:at,fn:()=>St(E=>!E)},{label:"Axes",v:ye,fn:()=>xe(E=>!E)},{label:"Trails",v:gt,fn:()=>Ge(E=>!E)}].map(({label:E,v:D,fn:z})=>a.jsx("button",{onClick:z,title:`${E}: ${D?"ON":"OFF"}`,className:"transition-all",style:{fontSize:6,letterSpacing:"0.08em",textTransform:"uppercase",padding:"2px 6px",color:D?xr:"rgba(255,255,255,0.22)",background:D?"rgba(55,178,218,0.06)":"transparent",border:D?`1px dashed ${xr}30`:"1px dashed rgba(255,255,255,0.05)"},children:E},E))})]}),a.jsxs("div",{className:"px-2.5 py-1.5",style:{background:"rgba(0,0,0,0.94)",border:`1px dashed ${xr}18`},children:[a.jsxs("div",{className:"flex items-center gap-1.5 mb-0.5",children:[a.jsx("div",{className:"w-1.5 h-1.5 animate-pulse",style:{background:xr}}),a.jsx("span",{style:{fontSize:7,letterSpacing:"0.12em",textTransform:"uppercase",color:xr},children:"3D ACTIVE"})]}),a.jsxs("div",{style:{fontSize:6,color:"rgba(255,255,255,0.25)"},children:[a.jsxs("div",{children:[r.current.count," parts  ",_t.replace("3d-","").toUpperCase()]}),a.jsx("div",{style:{fontSize:5,color:"rgba(255,255,255,0.15)",marginTop:2},children:"Drag orbit  Scroll zoom"})]})]})]})]}),Zi.connected&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{ref:Bh,style:{position:"fixed",pointerEvents:"none",display:"none",transform:"translate(-50%,-50%)",zIndex:50},children:[a.jsx("div",{style:{position:"absolute",width:28,height:28,left:-14,top:-14,borderRadius:"50%",border:"1px solid rgba(0,200,255,0.7)",opacity:.6}}),a.jsx("div",{style:{position:"absolute",left:-10,top:-.5,width:20,height:1,background:"rgba(0,200,255,0.85)"}}),a.jsx("div",{style:{position:"absolute",top:-10,left:-.5,height:20,width:1,background:"rgba(0,200,255,0.85)"}}),a.jsx("div",{style:{position:"absolute",width:4,height:4,left:-2,top:-2,borderRadius:"50%",background:"rgba(0,200,255,0.9)"}})]}),a.jsx(rR,{ctrl:Zi,toolName:Q,presetName:S,radius:ge,intensity:Zi.triggers.rt,showHUD:$h&&Zi.connected}),a.jsxs("div",{style:{position:"fixed",top:50,left:8,pointerEvents:"none",display:"flex",alignItems:"center",gap:4,zIndex:30},children:[a.jsx("div",{style:{width:5,height:5,borderRadius:"50%",background:"rgba(0,200,255,0.7)"}}),a.jsx("span",{style:{fontSize:7,color:"rgba(0,200,255,0.5)",letterSpacing:"0.08em"},children:"CTRL"})]})]}),a.jsx(oR,{open:l0,onClose:()=>Ts(!1),ctrl:Zi,presetsSection:{label:"Presets",items:Id,getLabel:E=>E.name,onSelect:E=>Oa(E.id)},toolsSection:{label:"Spawn Role",items:["KICK","BASS","PERC","PAD","LEAD","ARP","STRINGS","CHOIR"],getLabel:E=>E,onSelect:E=>ae(E)}}),!_&&a.jsx("div",{className:"fixed top-9 left-0 right-0 z-20 pointer-events-none",style:{fontFamily:$o},children:a.jsxs("div",{className:"flex items-center pointer-events-auto",style:{background:"rgba(0,0,0,0.94)",borderBottom:"1px dashed rgba(255,255,255,0.06)",height:28},children:[a.jsx("button",{onClick:wn,title:k&&j?"Pause":"Play",className:"flex items-center justify-center transition-all",style:{width:32,height:28,color:k&&j?xr:"rgba(55,178,218,0.55)",background:k&&j?"rgba(55,178,218,0.06)":"transparent",borderRight:"1px dashed rgba(255,255,255,0.06)"},children:k&&j?a.jsx(s0,{size:11}):a.jsx(wl,{size:11})}),a.jsxs("div",{className:"flex items-center gap-1 px-2",style:{borderRight:"1px dashed rgba(255,255,255,0.06)",height:28},children:[a.jsx("input",{type:"range",min:30,max:180,step:1,value:H,onChange:E=>G(parseInt(E.target.value)),title:`BPM: ${H}`,className:"w-12 h-px appearance-none cursor-pointer",style:{background:"rgba(255,255,255,.08)",accentColor:xr}}),a.jsx("span",{style:{fontSize:8,color:"rgba(255,255,255,0.40)",width:20,textAlign:"right",fontVariantNumeric:"tabular-nums"},children:H})]}),a.jsxs("div",{className:"flex items-center gap-1 px-2",style:{borderRight:"1px dashed rgba(255,255,255,0.06)",height:28},children:[a.jsx(hT,{size:8,style:{color:"rgba(255,255,255,0.22)",flexShrink:0}}),a.jsx("input",{type:"range",min:0,max:1,step:.01,value:pe,onChange:E=>ce(parseFloat(E.target.value)),title:`Volume: ${Math.round(pe*100)}%`,className:"w-10 h-px appearance-none cursor-pointer",style:{background:"rgba(255,255,255,.08)",accentColor:xr}})]}),a.jsxs("div",{className:"flex items-center gap-1 px-2",style:{borderRight:"1px dashed rgba(255,255,255,0.06)",height:28},children:[a.jsx("span",{style:{fontSize:6,color:"rgba(255,255,255,0.22)",letterSpacing:"0.08em"},children:"FX"}),a.jsx("input",{type:"range",min:0,max:1,step:.01,value:oe,onChange:E=>le(parseFloat(E.target.value)),title:`FX: ${Math.round(oe*100)}%`,className:"w-10 h-px appearance-none cursor-pointer",style:{background:"rgba(255,255,255,.08)",accentColor:xr}})]}),a.jsx("div",{style:{width:1,height:16,background:"rgba(255,255,255,0.04)"}}),a.jsxs("button",{onClick:()=>$(!0),title:"Escolher preset",className:"flex items-center gap-1.5 px-3 transition-all",style:{height:28,borderRight:"1px dashed rgba(255,255,255,0.06)"},children:[a.jsx(o2,{size:8,style:{color:Xs.primary+"88",flexShrink:0}}),a.jsx("span",{style:{fontSize:8,color:Xs.primary+"bb",letterSpacing:"0.04em",maxWidth:120,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:Xs.name})]}),a.jsx("button",{onClick:()=>mr((Oe+1)%12),title:`Root: ${Vn[Oe%12]} (click to cycle)`,className:"flex items-center justify-center transition-all",style:{height:28,width:28,fontSize:9,color:"#88ffcc",background:"rgba(136,255,204,0.04)",borderRight:"1px dashed rgba(255,255,255,0.06)"},children:Vn[Oe%12]}),a.jsx("button",{onClick:()=>{const E=Object.keys(ir),D=E.indexOf(Kt);Gr(E[(D+1)%E.length])},title:`Scale: ${ir[Kt]} (click to cycle)`,className:"flex items-center justify-center transition-all",style:{height:28,fontSize:7,color:"rgba(155,89,255,0.75)",padding:"0 8px",borderRight:"1px dashed rgba(255,255,255,0.06)",letterSpacing:"0.06em",textTransform:"uppercase"},children:ir[Kt]}),a.jsx("div",{className:"flex items-center",style:{borderRight:"1px dashed rgba(255,255,255,0.06)"},children:["Off","Notes","Harmony","Rhythm","Tension","Events"].map(E=>a.jsx("button",{onClick:()=>L(E),title:`Lens: ${E}`,className:"transition-all",style:{height:28,padding:"0 6px",fontSize:6,letterSpacing:"0.06em",textTransform:"uppercase",color:q===E?xr:"rgba(255,255,255,0.18)",background:q===E?"rgba(55,178,218,0.05)":"transparent",borderBottom:q===E?`1px solid ${xr}`:"1px solid transparent"},children:E},E))}),a.jsx("div",{style:{width:1,height:16,background:"rgba(255,255,255,0.04)"}}),a.jsx("button",{onClick:()=>P(E=>!E),title:"Cinematic [C]",className:"flex items-center justify-center transition-all",style:{width:26,height:28,color:_?xr:"rgba(255,255,255,0.18)"},children:a.jsx(E9,{size:10})}),a.jsx("button",{onClick:()=>lt(E=>!E),title:"3D Mode",className:"flex items-center justify-center transition-all",style:{width:26,height:28,fontSize:8,color:En?xr:"rgba(255,255,255,0.18)",fontWeight:En?600:400},children:"3D"}),En&&["3d-orbital","3d-top","3d-side","3d-fpp"].map(E=>a.jsx("button",{onClick:()=>Ie(E),title:E.replace("3d-","").toUpperCase(),className:"transition-all",style:{height:28,padding:"0 4px",fontSize:6,letterSpacing:"0.06em",textTransform:"uppercase",color:_t===E?xr:"rgba(255,255,255,0.18)",borderBottom:_t===E?`1px solid ${xr}`:"1px solid transparent"},children:E==="3d-orbital"?"ORB":E==="3d-top"?"TOP":E==="3d-side"?"SIDE":"FPP"},E)),a.jsx("button",{onClick:()=>an(E=>!E),title:"Velocity Vectors",className:"flex items-center justify-center transition-all",style:{width:20,height:28,fontSize:7,fontWeight:hn?700:400,color:hn?xr:"rgba(255,255,255,0.15)"},children:"V"}),a.jsx("button",{onClick:()=>Oo(E=>!E),title:"Overlays [V]",className:"flex items-center justify-center transition-all",style:{width:24,height:28,color:So?"rgba(255,255,255,0.22)":"#fbbf24"},children:So?a.jsx(vl,{size:9}):a.jsx(Ag,{size:9})}),a.jsx("div",{style:{flex:1}}),a.jsx("button",{onClick:y0,title:"Physics Sandbox",className:"flex items-center justify-center transition-all",style:{width:26,height:28,fontSize:9,color:J?"#ff9944":"rgba(255,255,255,0.18)"},children:""}),a.jsx("button",{onClick:Ud,title:"Compose Mode",className:"flex items-center justify-center transition-all",style:{width:26,height:28,color:Le?"#fbbf24":"rgba(255,255,255,0.18)"},children:a.jsx(AE,{size:10})}),Le&&!j&&a.jsx("button",{title:"Exportar capa para Meta-Gen-Art",onClick:()=>{const E=r.current;E&&(dt.current={quanta:E.quanta.map(z=>({...z,trailX:[],trailY:[]})),gates:E.gates.map(z=>({...z})),attractors:E.attractors.map(z=>({...z})),channels:E.channels.map(z=>({...z,pts:[...z.pts]})),rails:E.rails.map(z=>({...z})),tunnels:E.tunnels.map(z=>({...z})),cages:E.cages.map(z=>({...z})),strings:E.strings.map(z=>({...z})),fxZones:E.fxZones.map(z=>({...z,pts:[...z.pts]}))},Wt(!0)),K(!1),et.current=null,i.current=!0,T(!0);const D=o.current;lr.ready&&lr.restoreGains(D.reverbAmt*wo.current,D.delayAmt*wo.current,D.delayTime,D.masterGain*ia.current)},title:"Release composition",className:"flex items-center justify-center animate-pulse transition-all",style:{width:26,height:28,color:"#4ade80"},children:a.jsx(wl,{size:11})}),a.jsx("button",{onClick:m0,title:Rt?"Restore":"Reset",className:"flex items-center justify-center transition-all",style:{width:26,height:28,color:Rt?"rgba(251,191,36,0.65)":"rgba(255,255,255,0.18)"},children:a.jsx(Wi,{size:9})}),a.jsx("button",{onClick:Ya,title:"Preset aleatrio",className:"flex items-center justify-center transition-all",style:{width:26,height:28,color:"rgba(255,255,255,0.18)"},children:a.jsx(g9,{size:9})}),a.jsx("button",{onClick:()=>{$d()},title:"Exportar capa  Meta-Gen-Art",className:"flex items-center justify-center transition-all",style:{width:26,height:28,color:Ee>0&&Date.now()-Ee<3e3?"#4ade80":"rgba(255,255,255,0.18)"},children:a.jsx(q9,{size:9})}),a.jsx("button",{onClick:()=>fr(!0),title:"Guia",className:"flex items-center justify-center transition-all",style:{width:26,height:28,color:"rgba(55,178,218,0.45)"},children:a.jsx(TC,{size:9})}),a.jsx("button",{onClick:p0,title:"Limpar tudo",className:"flex items-center justify-center transition-all",style:{width:26,height:28,color:"rgba(255,255,255,0.15)"},children:a.jsx(o0,{size:9})}),a.jsx("div",{style:{width:1,height:16,background:"rgba(255,255,255,0.04)",margin:"0 2px"}}),a.jsx("div",{className:"flex items-center gap-1 px-2",style:{height:28},children:a.jsx("span",{style:{fontSize:7,color:"rgba(255,255,255,0.22)",fontVariantNumeric:"tabular-nums"},children:Xn})}),a.jsx(lR,{zoom:b.zoom,onZoomIn:b.zoomIn,onZoomOut:b.zoomOut,onReset:b.resetView,accentColor:Xs.primary})]})}),!_&&a.jsxs("div",{className:"fixed left-0 z-20 flex flex-col items-start",style:{top:68,bottom:hr?258:32,fontFamily:$o},children:[a.jsx("div",{className:"flex flex-col overflow-y-auto",style:{width:36,background:"rgba(0,0,0,0.94)",borderRight:"1px dashed rgba(255,255,255,0.06)",scrollbarWidth:"none"},children:[{label:"",tools:H0.filter(D=>["select","spawn","gate","erase"].includes(D.id))},{label:"",tools:H0.filter(D=>["attractor","repulsor","vortex","excite","freeze","mutate"].includes(D.id))},{label:"",tools:H0.filter(D=>["channel","rail","tunnel"].includes(D.id))},{label:"",tools:H0.filter(D=>["mirror","absorber","membrane"].includes(D.id))},{label:"",tools:H0.filter(D=>["cage","string","zone","metro"].includes(D.id))}].map((D,z)=>a.jsxs(Yt.Fragment,{children:[z>0&&a.jsx("div",{style:{height:1,background:"rgba(255,255,255,0.04)",margin:"2px 6px"}}),D.tools.map(ee=>a.jsxs("button",{onClick:()=>F(ee.id),title:`${ee.label} [${ee.key}]`,className:"flex items-center justify-center transition-all relative",style:{width:36,height:28,color:te===ee.id?ee.color:"rgba(255,255,255,.28)",background:te===ee.id?`${ee.color}0c`:"transparent"},children:[te===ee.id&&a.jsx("div",{style:{position:"absolute",left:0,top:4,bottom:4,width:2,background:ee.color}}),a.jsx("span",{style:{fontSize:13,lineHeight:1},children:ee.icon})]},ee.id))]},z))}),(()=>{var z,ee;if(!(te==="spawn"||te==="excite"||te==="freeze"||te==="attractor"||te==="repulsor"||te==="vortex"||te==="zone"||te==="metro"||te==="select"&&la))return null;const D=((z=H0.find(ue=>ue.id===te))==null?void 0:z.color)??xr;return a.jsxs("div",{style:{position:"absolute",left:38,top:0,width:140,background:"rgba(0,0,0,0.94)",border:"1px dashed rgba(255,255,255,0.06)",borderLeft:"none",padding:8,maxHeight:"60vh",overflowY:"auto",scrollbarWidth:"none"},children:[a.jsx("div",{style:{fontFamily:$o,fontSize:7,color:`${D}88`,letterSpacing:"0.10em",textTransform:"uppercase",marginBottom:6},children:(ee=H0.find(ue=>ue.id===te))==null?void 0:ee.label}),(te==="excite"||te==="freeze")&&a.jsx(Cr,{label:"Brush R",value:ge,min:.04,max:.4,step:.01,display:ue=>`${(ue*100).toFixed(0)}%`,color:te==="excite"?"#ff8800":"#88ddff",onChange:Ae}),(te==="attractor"||te==="repulsor"||te==="vortex")&&a.jsx(Cr,{label:"Strength",value:tt,min:.02,max:.5,step:.01,display:ue=>ue.toFixed(2),color:te==="repulsor"?"#ff4400":te==="vortex"?"#cc44ff":"#00aaff",onChange:We}),te==="metro"&&a.jsx(Cr,{label:"Beat Str",value:wt,min:.02,max:.5,step:.01,display:ue=>ue.toFixed(2),color:"#ffcc00",onChange:mn}),te==="zone"&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"grid grid-cols-3 gap-0.5 mb-2",style:{maxHeight:100,overflowY:"auto"},children:[{id:"slow",icon:"",label:"Slow"},{id:"fast",icon:"",label:"Fast"},{id:"mute",icon:"",label:"Mute"},{id:"excite_zone",icon:"",label:"Excite"},{id:"freeze_zone",icon:"",label:"Freeze"},{id:"reverse",icon:"",label:"Rev"},{id:"bounce",icon:"",label:"Bounce"},{id:"scatter_zone",icon:"",label:"Scatter"},{id:"vortex_zone",icon:"",label:"Vortex"},{id:"glitch",icon:"",label:"Glitch"},{id:"pitch_up",icon:"",label:"P"},{id:"pitch_down",icon:"",label:"P"},{id:"transpose",icon:"",label:"Trans"},{id:"harmonize_zone",icon:"",label:"Harm"},{id:"tremolo",icon:"",label:"Trem"},{id:"warp",icon:"",label:"Warp"},{id:"phase_lock",icon:"",label:"Phase"},{id:"role_shift",icon:"",label:"Role"}].map(ue=>a.jsxs("button",{onClick:()=>st(ue.id),title:ue.label,className:"text-[5px] py-0.5 transition-all text-center",style:{color:qe===ue.id?"#ff88cc":"rgba(255,255,255,0.30)",background:qe===ue.id?"rgba(255,136,204,0.08)":"transparent",border:qe===ue.id?"1px dashed rgba(255,136,204,0.35)":"1px dashed rgba(255,255,255,0.04)"},children:[a.jsx("span",{style:{fontSize:8},children:ue.icon}),a.jsx("br",{}),ue.label]},ue.id))}),a.jsx(Cr,{label:"Strength",value:$t,min:0,max:1,step:.01,display:ue=>`${(ue*100).toFixed(0)}%`,color:"#ff44cc",onChange:Tt}),a.jsx(Cr,{label:"Param",value:Ut,min:0,max:1,step:.01,display:ue=>`${(ue*100).toFixed(0)}%`,color:"#cc88ff",onChange:ln})]}),te==="spawn"&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"flex gap-0.5 mb-2 flex-wrap",children:Ru.map(ue=>a.jsx("button",{onClick:()=>ae(ue),title:ue,className:"transition-all",style:{width:14,height:14,background:Q===ue?mo[ue]:`${mo[ue]}22`,border:Q===ue?`1px solid ${mo[ue]}`:"1px dashed rgba(255,255,255,0.08)"}},ue))}),a.jsx(Cr,{label:"Count",value:we,min:1,max:10,step:1,display:ue=>String(ue),color:"#aaffaa",onChange:Re})]}),te==="select"&&la&&a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap",style:{fontSize:7},children:[a.jsx("span",{style:{color:mo[la.role]},children:la.role}),a.jsxs("span",{style:{color:"rgba(255,255,255,0.30)"},children:["p:",la.pitch," c:",la.charge.toFixed(2)]})]}),a.jsxs("div",{className:"grid grid-cols-4 gap-0.5 mt-1",children:[a.jsx("button",{onClick:()=>{la.timbreIdx=-1,Et(ue=>ue+1)},title:"Usar timbre padro da role",className:"text-[5px] py-0.5 text-center transition-all",style:{color:la.timbreIdx===-1?"#fff":"rgba(255,255,255,0.25)",background:la.timbreIdx===-1?"rgba(255,255,255,0.08)":"transparent",border:"1px dashed rgba(255,255,255,0.06)"},children:"Role"}),ul.map((ue,Ce)=>a.jsx("button",{onClick:()=>{la.timbreIdx=Ce,Et(ze=>ze+1)},title:ue.name,className:"text-[8px] py-0.5 text-center transition-all",style:{color:la.timbreIdx===Ce?ue.color:"rgba(255,255,255,0.25)",background:la.timbreIdx===Ce?`${ue.color}18`:"transparent",border:la.timbreIdx===Ce?`1px dashed ${ue.color}55`:"1px dashed rgba(255,255,255,0.04)"},children:ue.icon},Ce))]})]})]})})()]}),!_&&a.jsx(Qf,{id:"ml_powers",title:"POWERS",defaultX:40,defaultY:98,zIndex:22,children:a.jsxs("div",{className:"flex items-center gap-0.5 px-1 py-1 flex-wrap",style:{maxWidth:220},children:[[{icon:"",fn:lc,color:"#ff8800",title:"Excite All"},{icon:"",fn:Da,color:"#88ddff",title:"Freeze All"},{icon:"",fn:h0,color:"#ff4444",title:"Explode"},{icon:"",fn:Vd,color:"#aa88ff",title:"Compress"},{icon:"",fn:yi,color:"#aaffaa",title:"Scatter"},{icon:"+",fn:Hd,color:"#88aaff",title:"+10 Quanta"},{icon:"",fn:cc,color:"#ff8866",title:"-10 Quanta"}].map(E=>a.jsx("button",{onClick:E.fn,title:E.title,className:"flex items-center justify-center transition-all hover:scale-110",style:{width:24,height:24,fontSize:11,color:`${E.color}aa`,background:"rgba(0,0,0,0.85)",border:"1px dashed rgba(255,255,255,0.06)"},children:E.icon},E.title)),a.jsxs("div",{className:"relative",children:[a.jsx("button",{onClick:()=>Ir(E=>!E),title:"Clear...",className:"flex items-center justify-center transition-all",style:{width:24,height:24,color:"rgba(255,255,255,0.22)",background:"rgba(0,0,0,0.85)",border:"1px dashed rgba(255,255,255,0.06)"},children:a.jsx(o0,{size:10})}),Tr&&a.jsx("div",{className:"absolute left-0 top-[26px] flex flex-col z-50",style:{background:"rgba(0,0,0,0.96)",border:"1px dashed rgba(255,255,255,0.06)",minWidth:100},children:[{label:"Clear All",fn:u0,color:"#ff4466"},{label:"Gates",fn:Gd,color:"#ffaaff"},{label:"Attractors",fn:el,color:"#ffccaa"},{label:"Fields",fn:Rl,color:"#c0c8d0"},{label:"Cage/Str/Zone",fn:Gh,color:"#00ffcc"},{label:"Reset Matrix",fn:xa,color:"#88ccff"}].map(E=>a.jsx("button",{onClick:()=>{E.fn(),Ir(!1)},title:E.label,className:"text-left px-2.5 py-1.5 hover:bg-white/5 transition-all",style:{fontSize:7,color:`${E.color}aa`},children:E.label},E.label))})]})]})}),!_&&a.jsx(Qf,{id:"ml_qseq",title:"QSEQ",defaultX:Zt?window.innerWidth-344:window.innerWidth-148,defaultY:98,zIndex:22,width:148,headerExtra:a.jsx("button",{onClick:v0,title:ft?"Desativar sequencer":"Ativar sequencer",className:"transition-all",style:{fontSize:6,padding:"1px 6px",color:ft?xr:"rgba(255,255,255,0.25)",background:ft?`${xr}10`:"transparent",border:ft?`1px dashed ${xr}50`:"1px dashed rgba(255,255,255,0.06)"},children:ft?"ON":"OFF"}),children:a.jsxs("div",{style:{padding:"4px 8px 6px"},children:[a.jsxs("div",{className:"flex items-center gap-0.5 mb-1",children:[[8,12,16].map(E=>a.jsx("button",{onClick:()=>nl(E),title:`${E} steps`,style:{fontSize:5,padding:"1px 4px",color:Bt===E?xr:"rgba(255,255,255,0.18)",border:Bt===E?`1px dashed ${xr}40`:"1px dashed rgba(255,255,255,0.04)"},children:E},E)),a.jsx("div",{style:{width:1,height:8,background:"rgba(255,255,255,0.04)",margin:"0 2px"}}),[.5,1,2,4].map(E=>a.jsxs("button",{onClick:()=>uc(E),title:`Velocidade ${E}`,style:{fontSize:5,padding:"1px 3px",color:bt===E?xr:"rgba(255,255,255,0.18)",border:bt===E?`1px dashed ${xr}40`:"1px dashed rgba(255,255,255,0.04)"},children:[E,""]},E))]}),a.jsx("div",{className:"grid gap-0.5",style:{gridTemplateColumns:`repeat(${Math.min(Bt,8)},1fr)`},children:Array.from({length:Bt}).map((E,D)=>{var ue,Ce,ze;const z=((Ce=(ue=r.current)==null?void 0:ue.sequencer.steps[D])==null?void 0:Ce.armed)??!1,ee=ft&&Math.floor((((ze=r.current)==null?void 0:ze.sequencer.cursor)??0)*Bt)===D;return a.jsx("button",{onClick:()=>Xd(D),title:`Beat ${D+1}: ${z?"armado":"desarmado"}`,style:{height:14,fontSize:5,position:"relative",color:z?xr:"rgba(255,255,255,0.18)",background:z?`${xr}20`:"rgba(255,255,255,0.02)",border:ee?"1px solid rgba(255,255,255,0.6)":z?`1px dashed ${xr}50`:"1px dashed rgba(255,255,255,0.04)"},children:D+1},D)})})]})}),!_&&a.jsxs("div",{className:"fixed top-[68px] right-0 z-20 flex flex-row-reverse",style:{bottom:hr?258:32},children:[a.jsx("button",{onClick:()=>$e(E=>!E),title:Zt?"Fechar painel":"Abrir painel de controles",className:"absolute -left-4 top-4 z-30 w-4 h-8 flex items-center justify-center transition-all",style:{background:"rgba(0,0,0,0.94)",border:"1px dashed rgba(255,255,255,0.06)",borderRight:"none",color:"rgba(255,255,255,0.22)"},children:Zt?a.jsx(aa,{size:9}):a.jsx(Ap,{size:9})}),Zt&&a.jsxs("div",{className:"w-[200px] flex flex-col overflow-y-auto",style:{scrollbarWidth:"thin",scrollbarColor:"rgba(55,178,218,.08) transparent",fontFamily:$o,background:"rgba(0,0,0,0.94)",borderLeft:"1px dashed rgba(255,255,255,0.06)"},children:[a.jsxs("button",{onClick:()=>$(!0),title:"Escolher preset",className:"flex items-center gap-1.5 px-3 py-2 transition-all hover:bg-white/[0.03]",style:{borderBottom:"1px dashed rgba(255,255,255,0.05)"},children:[a.jsx(o2,{size:8,style:{color:Xs.primary+"88"}}),a.jsx("span",{style:{fontSize:8,color:Xs.primary+"bb",letterSpacing:"0.04em"},children:Xs.name}),a.jsx("span",{style:{fontSize:6,color:"rgba(255,255,255,0.15)",marginLeft:"auto"},children:"change"})]}),a.jsx("div",{className:"flex",style:{flexWrap:"wrap",borderBottom:"1px dashed rgba(255,255,255,0.05)"},children:[{id:"timbre",label:"Timbre",icon:a.jsx(zE,{size:7,className:"inline mr-0.5"})},{id:"harmony",label:"Harmony",icon:a.jsx(o2,{size:7,className:"inline mr-0.5"})},{id:"physics",label:"Physics",icon:a.jsx(_d,{size:7,className:"inline mr-0.5"})},{id:"matrix",label:"Matrix",icon:a.jsx("span",{style:{fontSize:7,marginRight:2},children:""})},{id:"palette",label:"Palette",icon:a.jsx("span",{style:{fontSize:7,marginRight:2},children:""})},{id:"aesthetic",label:"Look",icon:a.jsx("span",{style:{fontSize:7,marginRight:2},children:""})}].map(E=>a.jsxs("button",{onClick:()=>Fe(E.id),title:E.label,className:"flex-1 py-1.5 transition-all min-w-[38px]",style:{fontSize:6,letterSpacing:"0.12em",textTransform:"uppercase",color:Ze===E.id?xr:"rgba(255,255,255,0.22)",background:Ze===E.id?"rgba(55,178,218,0.04)":"transparent",borderBottom:Ze===E.id?`1px solid ${xr}`:"1px solid transparent"},children:[E.icon,E.label]},E.id))}),Ze==="timbre"&&a.jsxs("div",{className:"flex flex-col gap-3 p-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"uppercase",style:{fontFamily:Yo,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)",marginBottom:5},children:"TIMBRE TEMPLATES"}),a.jsx("div",{className:"grid grid-cols-3 gap-0.5",children:ul.map(E=>a.jsxs("button",{title:E.name,onClick:()=>rl(Xe,{waveform:E.wave,filterType:E.fType,filterFreq:E.fFreq,filterQ:E.fQ,envelope:E.env,gainScale:E.gain,detune:E.det,cooldownMin:E.cd}),className:"flex flex-col items-center gap-0.5 p-1 transition-all",style:{color:E.color,border:"1px dashed rgba(255,255,255,0.05)",background:"transparent"},title:E.name,children:[a.jsx("span",{className:"text-[10px] leading-none",children:E.icon}),a.jsx("span",{className:"text-[5px] font-mono uppercase tracking-wider text-white/45 leading-none text-center",children:E.name})]},E.name))}),a.jsx("div",{className:"mt-1 text-[5.5px] font-mono text-white/18 text-center",children:"aplica timbre  role selecionada "})]}),a.jsxs("div",{children:[a.jsx("div",{className:"uppercase",style:{fontFamily:Yo,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)",marginBottom:5},children:"EDIT ROLE"}),a.jsx("div",{className:"grid grid-cols-4 gap-0.5",children:Ru.map(E=>a.jsx("button",{onClick:()=>jt(E),title:`Editar role: ${E}`,className:`text-[6px] uppercase py-1 transition-all
                            ${Xe===E?"bg-white/10":"hover:bg-white/5"}`,style:{color:Xe===E?mo[E]:"rgba(255,255,255,.3)",borderBottom:`1px solid ${Xe===E?mo[E]:"transparent"}`,borderRadius:0},children:E.slice(0,3)},E))}),a.jsxs("div",{className:"mt-1 flex items-center justify-between px-0.5",children:[a.jsxs("span",{className:"text-[6px] font-mono text-white/20",children:[((C0=r.current)==null?void 0:C0.quanta.filter(E=>E.role===Xe).length)??0," quanta"]}),a.jsxs("div",{className:"flex gap-1",children:[a.jsxs("button",{onClick:()=>mi(Xe),title:"Random timbre para este role",className:"text-[5.5px] uppercase px-1.5 py-0.5 border border-white/[0.06] text-white/30 hover:text-[#37b2da] hover:border-[#37b2da]/30 bg-black transition-all flex items-center gap-0.5",style:{borderRadius:0},children:[a.jsx(Wi,{size:6})," Rand"]}),a.jsx("button",{onClick:()=>{c.current[Xe]={},Et(E=>E+1)},title:"Reset role ao padro do preset",className:"text-[5.5px] uppercase px-1.5 py-0.5 border border-white/[0.06] text-white/20 hover:text-white/55 hover:border-white/15 bg-black transition-all",style:{borderRadius:0},children:"Reset"})]})]}),a.jsx("div",{className:"mt-0.5 text-[5px] font-mono text-white/18 px-0.5",children:(()=>{const E=ba(Xe,"waveform"),D=ba(Xe,"filterFreq")??800,z=ul.find(ee=>ee.wave===E&&Math.abs(ee.fFreq-D)<200);return z?a.jsxs("span",{style:{color:z.color},children:[z.icon," ",z.name]}):a.jsxs("span",{className:"text-white/18",children:["Custom / ",E]})})()})]}),a.jsxs("div",{children:[a.jsx("div",{className:"uppercase",style:{fontFamily:Yo,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)",marginBottom:4},children:"WAVEFORM"}),a.jsx("div",{className:"grid grid-cols-4 gap-0.5",children:Zd.map(E=>a.jsx("button",{onClick:()=>Ps(Xe,"waveform",E.id),className:`text-[10px] py-1 transition-all
                            ${ba(Xe,"waveform")===E.id?"bg-white/12 text-white/90":"text-white/30 hover:text-white/60 hover:bg-white/5"}`,style:{borderRadius:0},title:String(E.id),children:E.label},E.id))})]}),a.jsxs("div",{className:"flex flex-col gap-1.5",children:[a.jsx(Cr,{label:"Filter Freq",value:ba(Xe,"filterFreq")??800,min:40,max:8e3,step:10,display:E=>`${E}Hz`,color:mo[Xe],onChange:E=>Ps(Xe,"filterFreq",E)}),a.jsx(Cr,{label:"Filter Q",value:ba(Xe,"filterQ")??1,min:.1,max:20,step:.1,display:E=>E.toFixed(1),color:mo[Xe],onChange:E=>Ps(Xe,"filterQ",E)})]}),a.jsxs("div",{className:"flex flex-col gap-1.5",children:[a.jsx("div",{className:"uppercase",style:{fontFamily:Yo,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)"},children:"ENVELOPE"}),["attack","decay","sustain","release"].map(E=>{var ee;const D=E==="sustain",z=(ee=ba(Xe,"envelope"))==null?void 0:ee[E];return a.jsx(Cr,{label:E[0].toUpperCase()+E.slice(1),value:z??D?.6:.3,min:0,max:D?1:3,step:.01,display:ue=>D?ue.toFixed(2):`${ue.toFixed(2)}s`,color:mo[Xe],onChange:ue=>Ps(Xe,"envelope",{...ba(Xe,"envelope")??{attack:.01,decay:.2,sustain:.6,release:.3},[E]:ue})},E)})]}),a.jsxs("div",{className:"flex flex-col gap-1.5",children:[a.jsx(Cr,{label:"Gain",value:ba(Xe,"gainScale")??.6,min:0,max:1,step:.01,display:E=>E.toFixed(2),color:mo[Xe],onChange:E=>Ps(Xe,"gainScale",E)}),a.jsx(Cr,{label:"Detune",value:ba(Xe,"detune")??0,min:-100,max:100,step:1,display:E=>`${E}`,color:mo[Xe],onChange:E=>Ps(Xe,"detune",E)}),a.jsx(Cr,{label:"Cooldown",value:ba(Xe,"cooldownMin")??.25,min:.05,max:3,step:.05,display:E=>`${E.toFixed(2)}s`,color:mo[Xe],onChange:E=>Ps(Xe,"cooldownMin",E)})]})]}),Ze==="harmony"&&a.jsxs("div",{className:"flex flex-col gap-3 p-3",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"uppercase",style:{fontFamily:Yo,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)",marginBottom:5},children:["NOTA RAIZ  ",a.jsx("span",{style:{color:"#88ffcc"},children:Vn[Oe%12]})]}),a.jsx("div",{className:"grid grid-cols-6 gap-0.5",children:Vn.map((E,D)=>a.jsx("button",{onClick:()=>mr(D),title:`Root: ${E}`,className:`text-[6px] py-1.5 transition-all text-center
                            ${Oe===D?"bg-[#37b2da]/15 border border-[#37b2da]/50 text-[#37b2da]":E.includes("#")||E.includes("b")?"bg-white/[0.02] border border-white/[0.06] text-white/30 hover:bg-white/6 hover:text-white/55":"bg-white/[0.04] border border-white/[0.08] text-white/45 hover:bg-white/10 hover:text-white/70"}`,style:{borderRadius:0},children:E},E))})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"uppercase",style:{fontFamily:Yo,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)",marginBottom:5},children:["ESCALA  ",a.jsx("span",{style:{color:"#88ffcc"},children:ir[Kt]})]}),a.jsx("div",{className:"grid grid-cols-3 gap-0.5",children:Object.keys(ir).map(E=>a.jsx("button",{onClick:()=>Gr(E),title:`Escala: ${ir[E]}`,className:`text-[5.5px] uppercase py-1.5 text-center transition-all
                            ${Kt===E?"bg-[#37b2da]/15 border border-[#37b2da]/50 text-[#37b2da]":"border border-dashed border-white/[0.04] text-white/30 hover:border-white/12 hover:text-white/55"}`,style:{background:"transparent"},children:ir[E]},E))})]}),a.jsxs("div",{children:[a.jsx("div",{className:"uppercase",style:{fontFamily:Yo,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)",marginBottom:5},children:"MODO HARMNICO"}),a.jsx("div",{className:"flex gap-1",children:["consonant","any","dissonant"].map(E=>a.jsx("button",{onClick:()=>Dr(E),title:E==="consonant"?"S notas consonantes":E==="dissonant"?"Prioriza dissonncias":"Qualquer intervalo",className:`flex-1 text-[5.5px] uppercase py-1.5 transition-all
                            ${zn===E?"bg-[#37b2da]/15 border border-[#37b2da]/50 text-[#37b2da]":"border border-dashed border-white/[0.04] text-white/25 hover:border-white/12 hover:text-white/50"}`,style:{background:"transparent"},children:E==="consonant"?"Tonal":E==="dissonant"?"Clash":"Free"},E))}),a.jsx("div",{className:"mt-0.5 text-[5px] font-mono text-white/18 text-center leading-snug",children:zn==="consonant"?"S acorda notas consonantes":zn==="dissonant"?"Prioriza dissonncias":"Toca qualquer intervalo"})]}),a.jsxs("div",{className:"border-t border-dashed border-white/[0.06] pt-2",children:[a.jsx("div",{className:"uppercase",style:{fontFamily:Yo,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)",marginBottom:5},children:"MAPEAMENTO"}),a.jsxs("div",{className:"flex gap-1",children:[a.jsx("button",{onClick:()=>jn("preset"),title:"Notas mapeadas pelo preset",className:`flex-1 text-[5.5px] uppercase py-1.5 transition-all
                          ${zt==="preset"?"bg-[#37b2da]/15 border border-[#37b2da]/50 text-[#37b2da]":"border border-dashed border-white/[0.04] text-white/25 hover:border-white/12 hover:text-white/50"}`,style:{background:"transparent"},children:"Preset"}),a.jsx("button",{onClick:()=>jn("canvas"),title:"Notas mapeadas pela posio no canvas",className:`flex-1 text-[5.5px] uppercase py-1.5 transition-all
                          ${zt==="canvas"?"bg-[#37b2da]/15 border border-[#37b2da]/50 text-[#37b2da]":"border border-dashed border-white/[0.04] text-white/25 hover:border-white/12 hover:text-white/50"}`,style:{background:"transparent"},children:"Canvas"})]}),a.jsx("div",{className:"mt-0.5 text-[5px] font-mono text-white/18 text-center leading-snug",children:zt==="preset"?"Pitch vive nos quanta (tool zones ainda modulam)":"X  grau da escala  Y  oitava (respeita pitchRange da role)"})]}),a.jsxs("div",{className:"border-t border-dashed border-white/[0.06] pt-2",children:[a.jsx("div",{className:"uppercase",style:{fontFamily:Yo,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)",marginBottom:5},children:"LIVE PAD  QUANTIZE"}),a.jsx("div",{className:"grid grid-cols-6 gap-0.5",children:Gc[Kt].map((E,D)=>{const z=Vn[(Oe+E)%12];return a.jsx("button",{onClick:()=>Bd(E),title:`Quantizar para ${z}`,className:"text-[6px] py-1.5 transition-all text-center bg-white/[0.04] border border-white/[0.08] text-white/55 hover:bg-white/10 hover:text-white/75",style:{borderRadius:0},children:z},`${E}_${D}`)})}),a.jsx("div",{className:"mt-1 text-[5px] font-mono text-white/18 text-center leading-snug",children:"Aplica na seleo (ou no quanta mais perto do cursor) sem mudar a raiz global."})]}),a.jsxs("div",{className:"border-t border-dashed border-white/[0.06] pt-2",children:[a.jsx(Cr,{label:"Event Rate",value:mt,min:.1,max:4,step:.05,display:E=>`${E.toFixed(2)}`,color:"#88ffcc",onChange:Rr}),a.jsx("div",{className:"mt-0.5 text-[5px] font-mono text-white/18",children:"Frequncia de disparo de notas"})]}),a.jsxs("div",{className:"border-t border-dashed border-white/[0.06] pt-2",children:[a.jsx("div",{className:"uppercase",style:{fontFamily:Yo,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)",marginBottom:5},children:"NOTAS ATIVAS"}),a.jsx("div",{className:"flex flex-wrap gap-0.5",children:Gc[Kt].map(E=>{const D=Vn[(Oe+E)%12];return a.jsx("button",{onClick:()=>mr((Oe+E)%12),title:`Raiz  ${D}`,className:"text-[6px] px-1.5 py-0.5 bg-[#37b2da]/8 border border-[#37b2da]/20 text-[#37b2da]/70 hover:bg-[#37b2da]/15 hover:text-[#37b2da] transition-all",style:{borderRadius:0},children:D},E)})}),a.jsx("div",{className:"mt-1 text-[5px] font-mono text-white/18",children:"Clique numa nota para definir como raiz"})]}),a.jsx("div",{className:"border-t border-dashed border-white/[0.06] pt-2",children:a.jsxs("button",{title:"Sortear root, escala e modo aleatoriamente",onClick:()=>{const E=["major","minor","pentatonic","blues","dorian","phrygian","lydian","mixolydian","whole_tone","harmonic_minor"],D=["consonant","any","any","dissonant"];mr(Math.floor(Math.random()*12)),Gr(E[Math.floor(Math.random()*E.length)]),Dr(D[Math.floor(Math.random()*D.length)]),Rr(.4+Math.random()*2.5)},className:"w-full py-1.5 transition-all flex items-center justify-center gap-1",style:{fontSize:7,letterSpacing:"0.10em",textTransform:"uppercase",color:"rgba(255,255,255,0.25)",border:"1px dashed rgba(255,255,255,0.05)",background:"transparent"},children:[a.jsx(Wi,{size:8})," Campo Harmnico Aleatrio"]})})]}),Ze==="physics"&&a.jsxs("div",{className:"flex flex-col gap-2.5 p-3",children:[J&&a.jsxs("div",{className:"border border-dashed border-orange-400/15 bg-orange-500/[0.02] p-2 flex flex-col gap-2",style:{borderRadius:0},children:[a.jsxs("div",{className:"flex items-center gap-1.5 mb-0.5",children:[a.jsx("span",{className:"text-[6px] uppercase tracking-[0.16em] text-orange-300/70",children:" BALLISTIC PHYSICS"}),a.jsx("span",{className:"text-[5px] font-mono text-white/20 ml-auto",children:"gravity only"})]}),a.jsxs("div",{className:"flex flex-col gap-0.5",children:[a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx("span",{className:"text-[6px] font-mono text-white/35 w-14",children:" Gravity Y"}),a.jsx("input",{type:"range",min:-2,max:2,step:.005,value:it.gravityY,onChange:E=>{const D=parseFloat(E.target.value);u.current={...u.current,gravityY:D},kt(z=>({...z,gravityY:D}))},className:"flex-1 h-px appearance-none cursor-pointer",style:{background:"rgba(255,200,100,.25)"}}),a.jsx("span",{className:"text-[6px] font-mono text-orange-300/60 w-8 text-right",children:it.gravityY.toFixed(3)})]}),J&&a.jsxs("div",{className:"flex items-center gap-0.5 flex-wrap mt-0.5",children:[a.jsx("div",{className:"text-[5px] font-mono text-white/18 w-full mb-0.5",children:"a = g30 wu/s  Earth0.327 cai 2wu em ~0.7s"}),[{label:" Earth",g:.327},{label:" Moon",g:.054},{label:" Mars",g:.126},{label:" Jupiter",g:.822},{label:" Zero",g:0},{label:" Anti",g:-.327}].map(E=>a.jsx("button",{title:`Gravidade: ${E.label} (${E.g.toFixed(3)})`,onClick:()=>{u.current={...u.current,gravityY:E.g},kt(D=>({...D,gravityY:E.g}))},className:`text-[5px] px-1 py-0.5 border transition-all
                                  ${Math.abs(it.gravityY-E.g)<.004?"text-yellow-300 border-yellow-400/40 bg-yellow-400/10":"text-white/40 border-white/[0.06] hover:text-orange-300 hover:border-orange-400/30"}`,style:{borderRadius:0},children:E.label},E.label))]})]}),a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx("span",{className:"text-[6px] font-mono text-white/35 w-14",children:" Gravity X"}),a.jsx("input",{type:"range",min:-2,max:2,step:.005,value:it.gravityX,onChange:E=>{const D=parseFloat(E.target.value);u.current={...u.current,gravityX:D},kt(z=>({...z,gravityX:D}))},className:"flex-1 h-px appearance-none cursor-pointer",style:{background:"rgba(255,200,100,.25)"}}),a.jsx("span",{className:"text-[6px] font-mono text-orange-300/60 w-8 text-right",children:it.gravityX.toFixed(J?1:2)})]}),a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx("span",{className:"text-[6px] font-mono text-white/35 w-14",children:" Bounce"}),a.jsx("input",{type:"range",min:0,max:1,step:.01,value:it.restitution??.75,onChange:E=>{const D=parseFloat(E.target.value);u.current={...u.current,restitution:D},kt(z=>({...z,restitution:D}))},className:"flex-1 h-px appearance-none cursor-pointer",style:{background:"rgba(255,200,100,.25)"}}),a.jsxs("span",{className:"text-[6px] font-mono text-orange-300/60 w-8 text-right",children:[((it.restitution??.75)*100).toFixed(0),"%"]})]}),a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx("span",{className:"text-[6px] font-mono text-white/35 w-14",children:"~ Air Drag"}),a.jsx("input",{type:"range",min:.96,max:1,step:.001,value:it.damping,onChange:E=>{const D=parseFloat(E.target.value);u.current={...u.current,damping:D},kt(z=>({...z,damping:D}))},className:"flex-1 h-px appearance-none cursor-pointer",style:{background:"rgba(255,200,100,.25)"}}),a.jsx("span",{className:"text-[6px] font-mono text-orange-300/60 w-8 text-right",children:(1-it.damping).toFixed(3)})]}),a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx("span",{className:"text-[6px] font-mono text-white/35 w-14",children:" Max Spd"}),a.jsx("input",{type:"range",min:.1,max:2,step:.05,value:it.maxSpeed,onChange:E=>{const D=parseFloat(E.target.value);u.current={...u.current,maxSpeed:D},kt(z=>({...z,maxSpeed:D}))},className:"flex-1 h-px appearance-none cursor-pointer",style:{background:"rgba(255,200,100,.25)"}}),a.jsx("span",{className:"text-[6px] font-mono text-orange-300/60 w-8 text-right",children:it.maxSpeed.toFixed(2)})]}),a.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5",children:[a.jsx("button",{title:`Bounce Walls: ${u.current.bounceWalls?"ON":"OFF"}`,onClick:()=>{const E=!u.current.bounceWalls;u.current={...u.current,bounceWalls:E},kt(D=>({...D,bounceWalls:E}))},className:`flex-1 text-[6px] uppercase py-1 border transition-all
                            ${it.bounceWalls?"border-orange-400/40 text-orange-300/80 bg-orange-500/10":"border-white/[0.06] text-white/30 hover:border-white/15"}`,style:{borderRadius:0},children:it.bounceWalls?" Wall Bounce ON":" Wall Bounce OFF"}),a.jsx("button",{title:`Physics Only: ${u.current.physicsOnly?"ON":"OFF"}`,onClick:()=>{const E=!u.current.physicsOnly;u.current={...u.current,physicsOnly:E},kt(D=>({...D,physicsOnly:E}))},className:`flex-1 text-[6px] uppercase py-1 border transition-all
                            ${it.physicsOnly?"border-orange-400/40 text-orange-300/80 bg-orange-500/10":"border-[#37b2da]/25 text-[#37b2da]/60 hover:border-[#37b2da]/40"}`,style:{borderRadius:0},children:it.physicsOnly?" Gate Only":" All Notes"})]}),a.jsx("div",{className:"text-[5.5px] font-mono text-white/18 mt-1 leading-relaxed",children:"Spawn bolas com  Compose (drag = velocity) ento  Release"})]}),a.jsxs("div",{children:[a.jsx("div",{className:"uppercase",style:{fontFamily:Yo,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)",marginBottom:5},children:"BEHAVIOR PRESETS"}),a.jsx("div",{className:"grid grid-cols-4 gap-0.5",children:$f.map(E=>a.jsxs("button",{title:`${E.name}  ${E.description}`,onClick:()=>{sn(E.id);const D=xy(E,it);kt(D),u.current=D},title:`${E.name}  ${E.description}`,className:"flex flex-col items-center gap-0.5 py-1 px-0.5 transition-all",style:{color:On===E.id?E.color:"rgba(255,255,255,0.30)",background:On===E.id?E.color+"08":"transparent",border:On===E.id?`1px dashed ${E.color}40`:"1px dashed rgba(255,255,255,0.04)"},children:[a.jsx("span",{className:"text-[10px] leading-none",children:E.icon}),a.jsx("span",{className:"text-[4.5px] font-mono uppercase tracking-wide leading-none text-center opacity-80",children:E.name})]},E.id))}),On&&(()=>{const E=yy[On];return E?a.jsxs("div",{className:"mt-1.5 text-[5.5px] font-mono text-white/28 leading-snug px-0.5",children:[a.jsx("span",{style:{color:E.color+"bb"},children:E.name}),"  ",E.description]}):null})()]}),a.jsxs("div",{className:"border-t border-dashed border-white/[0.06] pt-2",children:[a.jsx("div",{className:"uppercase",style:{fontFamily:Yo,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)",marginBottom:6},children:"MOTION + FORCES"}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx(Cr,{label:"Damping",value:it.damping,min:.9,max:.999,step:.001,display:E=>E.toFixed(3),color:"#88aaff",onChange:E=>kt(D=>({...D,damping:E}))}),a.jsx(Cr,{label:"Cohesion",value:it.cohesion,min:0,max:3,step:.05,display:E=>E.toFixed(2),color:"#aaffbb",onChange:E=>kt(D=>({...D,cohesion:E}))}),a.jsx(Cr,{label:"Separation",value:it.separation,min:0,max:3,step:.05,display:E=>E.toFixed(2),color:"#ffbbaa",onChange:E=>kt(D=>({...D,separation:E}))}),a.jsx(Cr,{label:"Max Speed",value:it.maxSpeed,min:.02,max:.7,step:.01,display:E=>E.toFixed(2),color:"#ffddaa",onChange:E=>kt(D=>({...D,maxSpeed:E}))}),a.jsx(Cr,{label:"Turbulence",value:it.turbulence,min:0,max:1,step:.01,display:E=>E.toFixed(2),color:"#aaff88",onChange:E=>kt(D=>({...D,turbulence:E}))}),a.jsx(Cr,{label:"Gravity X",value:it.gravityX,min:it.motionStyle==="ballistic"?-2:-.4,max:it.motionStyle==="ballistic"?2:.4,step:.005,display:E=>E.toFixed(3),color:"#ccaaff",onChange:E=>kt(D=>({...D,gravityX:E}))}),a.jsx(Cr,{label:"Gravity Y",value:it.gravityY,min:it.motionStyle==="ballistic"?-2:-.4,max:it.motionStyle==="ballistic"?2:.4,step:.005,display:E=>E.toFixed(3),color:"#ccaaff",onChange:E=>kt(D=>({...D,gravityY:E}))}),it.motionStyle==="ballistic"&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"text-[5px] font-mono text-white/20 mt-0.5 mb-1",children:"Preset: efetivo a = g30 wu/s  Earth=0.327 cai ~2wu/0.7s"}),a.jsx("div",{className:"flex gap-0.5 flex-wrap",children:[{label:" Moon",g:.054},{label:" Mars",g:.126},{label:" Earth",g:.327},{label:" Jupiter",g:.822},{label:"Zero",g:0}].map(({label:E,g:D})=>a.jsx("button",{title:`Gravidade: ${E}`,onClick:()=>kt(z=>({...z,gravityY:D})),className:`text-[5px] px-1 py-0.5 border transition-all
                                  ${Math.abs(it.gravityY-D)<.004?"text-yellow-300 border-yellow-400/40 bg-yellow-400/10":"text-white/35 border-white/[0.06] hover:text-white/65 hover:border-white/20"}`,style:{borderRadius:0},children:E},E))})]})]})]}),a.jsxs("div",{className:"border-t border-dashed border-white/[0.06] pt-2",children:[a.jsx("div",{className:"uppercase",style:{fontFamily:Yo,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)",marginBottom:6},children:"BEHAVIOR PHYSICS"}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx(Cr,{label:"Alignment",value:it.alignment,min:0,max:2,step:.05,display:E=>E.toFixed(2),color:"#aaeeff",onChange:E=>kt(D=>({...D,alignment:E}))}),a.jsx(Cr,{label:"Zone Radius",value:it.zoneRadius,min:.03,max:.5,step:.01,display:E=>E.toFixed(2),color:"#88ffdd",onChange:E=>kt(D=>({...D,zoneRadius:E}))}),a.jsx(Cr,{label:"Vortex Force",value:it.vortexForce,min:0,max:.4,step:.005,display:E=>E.toFixed(3),color:"#cc88ff",onChange:E=>kt(D=>({...D,vortexForce:E}))}),a.jsx(Cr,{label:"Burst Rate",value:it.burstRate,min:0,max:1,step:.01,display:E=>E.toFixed(2),color:"#ff9944",onChange:E=>kt(D=>({...D,burstRate:E}))}),a.jsx(Cr,{label:"Migration X",value:it.migrationX,min:-1,max:1,step:.05,display:E=>E.toFixed(2),color:"#ffee88",onChange:E=>kt(D=>({...D,migrationX:E}))}),a.jsx(Cr,{label:"Migration Y",value:it.migrationY,min:-1,max:1,step:.05,display:E=>E.toFixed(2),color:"#ffee88",onChange:E=>kt(D=>({...D,migrationY:E}))}),a.jsx(Cr,{label:"Cluster Target",value:it.clusterTarget,min:2,max:20,step:1,display:E=>`${Math.round(E)}`,color:"#88ffaa",onChange:E=>kt(D=>({...D,clusterTarget:Math.round(E)}))}),a.jsx(Cr,{label:"Polarize",value:it.polarize,min:0,max:1,step:.01,display:E=>E.toFixed(2),color:"#ff6688",onChange:E=>kt(D=>({...D,polarize:E}))})]})]}),a.jsxs("div",{className:"border-t border-dashed border-white/[0.06] pt-2",children:[a.jsx("div",{className:"uppercase",style:{fontFamily:Yo,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)",marginBottom:6},children:"EMERGENT"}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx(Cr,{label:"Mutation Rate",value:it.mutationRate,min:0,max:1,step:.01,display:E=>E.toFixed(2),color:"#ff88ff",onChange:E=>kt(D=>({...D,mutationRate:E}))}),a.jsx(Cr,{label:"Energy Transfer",value:it.energyTransfer,min:0,max:1,step:.01,display:E=>E.toFixed(2),color:"#ffcc88",onChange:E=>kt(D=>({...D,energyTransfer:E}))}),a.jsx(Cr,{label:"Entrainment",value:it.entainment,min:0,max:1,step:.01,display:E=>E.toFixed(2),color:"#88ffcc",onChange:E=>kt(D=>({...D,entainment:E}))}),a.jsx(vq,{label:"Predator/Prey",on:it.predatorPrey,color:"#ff8888",onToggle:()=>kt(E=>({...E,predatorPrey:!E.predatorPrey}))})]})]}),a.jsxs("div",{className:"border-t border-dashed border-white/[0.06] pt-2",children:[a.jsx("div",{className:"uppercase",style:{fontFamily:Yo,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)",marginBottom:5},children:"SYNC"}),a.jsxs("div",{className:"flex flex-col gap-0.5 text-[7px] font-mono text-white/35",children:[a.jsxs("div",{children:["Alignment: ",((((Z=r.current)==null?void 0:Z.syncIntensity)??0)*100).toFixed(0),"%"]}),a.jsxs("div",{children:["Beat: ",((((Ue=r.current)==null?void 0:Ue.beatPhase)??0)*100).toFixed(0),"%"]}),a.jsxs("div",{children:["Quanta: ",Xn]}),a.jsx("div",{className:"text-[5.5px] text-white/20 mt-0.5 uppercase tracking-wider",children:it.motionStyle})]})]})]}),Ze==="matrix"&&r.current&&(()=>{const E=["KICK","BASS","PERC","PAD","LEAD","ARP","STRINGS","CHOIR"],D=["KCK","BAS","PRC","PAD","LED","ARP","STR","CHO"],z=r.current.userMatrix;return a.jsxs("div",{className:"p-2 flex flex-col gap-2",children:[a.jsx("div",{className:"uppercase",style:{fontFamily:Yo,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)"},children:"INTERACTION MATRIX"}),a.jsxs("div",{className:"text-[5.5px] text-white/18 leading-snug bg-white/[0.02] px-1.5 py-1 border border-dashed border-white/[0.06] mb-1",style:{borderRadius:0},children:["Click +0.1  Shift -0.1  Ctrl reset",a.jsx("br",{}),"Azul=atrao  Vermelho=repulso"]}),a.jsxs("div",{style:{overflowX:"auto"},children:[a.jsxs("div",{style:{display:"grid",gridTemplateColumns:"18px repeat(8,1fr)",gap:1.5,marginBottom:2},children:[a.jsx("div",{}),D.map((ee,ue)=>a.jsx("div",{style:{fontSize:4.5,textAlign:"center",color:mo[E[ue]],fontFamily:"monospace",overflow:"hidden"},children:ee},ue))]}),E.map((ee,ue)=>a.jsxs("div",{style:{display:"grid",gridTemplateColumns:"18px repeat(8,1fr)",gap:1.5,marginBottom:1.5},children:[a.jsx("div",{style:{fontSize:4.5,color:mo[ee],fontFamily:"monospace",display:"flex",alignItems:"center"},children:D[ue]}),E.map(Ce=>{var on;const ze=((on=z[ee])==null?void 0:on[Ce])??0,De=ze<0?Math.round(Math.abs(ze)*220):0,ct=ze>0?Math.round(ze*220):0,pt=ee===Ce;return a.jsx("button",{title:`${ee}${Ce}: ${ze.toFixed(1)}`,onClick:kn=>{const xn=kn.shiftKey?-.1:kn.ctrlKey||kn.metaKey?-(z[ee][Ce]??0):.1;r.current.userMatrix[ee][Ce]=parseFloat(Math.max(-1,Math.min(1,(z[ee][Ce]??0)+xn)).toFixed(1)),Et(Zn=>Zn+1)},style:{background:pt?`rgba(255,255,255,${.04+Math.abs(ze)*.1})`:`rgba(${De},0,${ct},${.12+Math.abs(ze)*.65})`,border:`1px solid rgba(255,255,255,${.04+Math.abs(ze)*.08})`,borderRadius:2,height:13,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:Math.abs(ze)>.05&&a.jsx("span",{style:{fontSize:4,color:ze<0?"#ff9999":"#99aaff",fontFamily:"monospace"},children:ze.toFixed(1)})},Ce)})]},ee))]}),a.jsxs("div",{className:"flex gap-1 mt-1",children:[a.jsx("button",{onClick:xa,title:"Resetar matriz de interaes",className:"flex-1 text-[6px] text-white/25 hover:text-white/50 transition-all py-1 border border-dashed border-white/[0.06]",style:{borderRadius:0},children:" Reset"}),a.jsx("button",{onClick:Is,title:"Gerar matriz aleatria",className:"flex-1 text-[6px] text-[#37b2da]/45 hover:text-[#37b2da] transition-all py-1 border border-dashed border-[#37b2da]/20 hover:border-[#37b2da]/40",style:{borderRadius:0},children:" Random"})]})]})})(),Ze==="palette"&&a.jsxs("div",{className:"p-2 flex flex-col gap-3",children:[a.jsx("div",{className:"uppercase",style:{fontFamily:Yo,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)"},children:"CANVAS PALETTE"}),a.jsxs("div",{children:[a.jsx("div",{className:"text-[5.5px] uppercase text-white/18 tracking-[0.14em] mb-1.5",children:"MODO DE COR"}),a.jsx("div",{className:"grid grid-cols-3 gap-1",children:[{id:"role",label:"Role",c:"#00d4ff"},{id:"mono",label:"Mono",c:"#ffffff"},{id:"neon",label:"Neon",c:"#ff00ff"},{id:"heat",label:"Heat",c:"#ff4400"},{id:"earth",label:"Earth",c:"#c8960a"},{id:"plasma",label:"Plasma",c:"#cc44ff"}].map(E=>a.jsx("button",{title:`Paleta: ${E.label}`,onClick:()=>W(D=>({...D,mode:E.id})),className:"py-1.5 px-1 border transition-all text-[6.5px]",style:{borderColor:je.mode===E.id?E.c+"88":"rgba(255,255,255,0.06)",background:je.mode===E.id?E.c+"12":"transparent",color:je.mode===E.id?E.c:"rgba(255,255,255,0.4)",borderRadius:0},children:E.label},E.id))})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[a.jsx("div",{className:"text-[5.5px] uppercase text-white/18 tracking-[0.14em]",children:"CORES POR ROLE"}),Object.keys(je.roleColorOverrides??{}).length>0&&a.jsx("button",{onClick:()=>W(E=>({...E,roleColorOverrides:{}})),title:"Resetar cores personalizadas",className:"text-[5px] font-mono text-white/20 hover:text-white/55 transition-all",children:" reset"})]}),a.jsx("div",{className:"flex flex-col gap-1",children:["KICK","BASS","PERC","PAD","LEAD","ARP","STRINGS","CHOIR"].map(E=>{var ue,Ce;const D=mo[E],z=((ue=je.roleColorOverrides)==null?void 0:ue[E])??D,ee=!!((Ce=je.roleColorOverrides)!=null&&Ce[E]);return a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("div",{className:"w-2 h-2 flex-shrink-0 border border-white/[0.06]",style:{background:z,borderRadius:0}}),a.jsx("span",{className:"text-[5.5px] font-mono w-11 flex-shrink-0",style:{color:z},children:E}),a.jsx("input",{type:"color",value:z,onChange:ze=>W(De=>({...De,roleColorOverrides:{...De.roleColorOverrides,[E]:ze.target.value}})),className:"w-6 h-4 cursor-pointer flex-shrink-0 border-0 p-0",style:{background:"transparent",borderRadius:0}}),a.jsx("input",{type:"text",value:z,onChange:ze=>{const De=ze.target.value.trim();/^#[0-9a-fA-F]{6}$/.test(De)&&W(ct=>({...ct,roleColorOverrides:{...ct.roleColorOverrides,[E]:De}}))},className:"flex-1 min-w-0 bg-white/[0.03] border border-dashed border-white/[0.06] text-[5px] px-1 py-0.5",style:{color:z,borderRadius:0}}),ee&&a.jsx("button",{title:"Resetar cor deste role",onClick:()=>{const ze={...je.roleColorOverrides};delete ze[E],W(De=>({...De,roleColorOverrides:ze}))},className:"text-[7px] text-white/20 hover:text-white/55 flex-shrink-0 transition-all",children:""})]},E)})})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-[5.5px] uppercase text-white/18 tracking-[0.14em] mb-1.5",children:"BACKGROUND"}),a.jsx("div",{className:"grid grid-cols-4 gap-1 mb-1.5",children:[{label:"Void",color:"#050810"},{label:"Night",color:"#05050a"},{label:"Pitch",color:"#020202"},{label:"Navy",color:"#050818"},{label:"Forest",color:"#030804"},{label:"Ember",color:"#0a0402"},{label:"Cosmic",color:"#08050f"},{label:"Slate",color:"#060809"}].map(E=>a.jsx("button",{title:`Fundo: ${E.label}`,onClick:()=>W(D=>({...D,bgColor:E.color})),className:"flex flex-col items-center py-1.5 border transition-all",style:{borderColor:je.bgColor===E.color?"rgba(255,255,255,0.45)":"rgba(255,255,255,0.06)",background:E.color,borderRadius:0},children:a.jsx("span",{className:"text-[5px] font-mono text-white/50",children:E.label})},E.label))}),a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx("span",{className:"text-[5px] font-mono text-white/20",children:"Custom"}),a.jsx("input",{type:"color",value:je.bgColor,onChange:E=>W(D=>({...D,bgColor:E.target.value})),className:"w-6 h-4 cursor-pointer border-0 p-0 flex-shrink-0",style:{borderRadius:0}}),a.jsx("input",{type:"text",value:je.bgColor,onChange:E=>{const D=E.target.value.trim();/^#[0-9a-fA-F]{6}$/.test(D)&&W(z=>({...z,bgColor:D}))},className:"flex-1 bg-white/[0.03] border border-dashed border-white/[0.06] text-[5px] px-1 py-0.5 text-white/50",style:{borderRadius:0}})]})]})]}),Ze==="aesthetic"&&a.jsxs("div",{className:"p-2 flex flex-col gap-3",children:[a.jsx("div",{className:"uppercase",style:{fontFamily:Yo,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)"},children:"AESTHETIC"}),a.jsxs("div",{children:[a.jsx("div",{className:"text-[5.5px] uppercase text-white/18 tracking-[0.14em] mb-1.5",children:"VISUAL PRESETS"}),a.jsx("div",{className:"grid grid-cols-2 gap-1",children:sR.map(E=>{const D=Te===E.id;return a.jsxs("button",{title:`${E.name}: ${E.description}`,onClick:()=>oc(E.id),className:"p-2 border transition-all text-left",style:{borderRadius:0,borderColor:D?`${xr}66`:"rgba(255,255,255,0.06)",background:D?`${xr}10`:"rgba(255,255,255,0.02)"},children:[a.jsx("div",{className:"text-[7px] uppercase tracking-widest",style:{color:D?xr:"rgba(255,255,255,0.45)"},children:E.name}),a.jsx("div",{className:"text-[5.5px] font-mono leading-snug mt-0.5",style:{color:"rgba(255,255,255,0.22)"},children:E.description})]},E.id)})})]}),a.jsxs("div",{className:"border-t border-dashed border-white/[0.06] pt-2 flex flex-col gap-2.5",children:[a.jsx(Cr,{label:"Grain",value:he.canvas.grain,min:0,max:1,step:.01,display:E=>`${Math.round(E*100)}%`,color:"#88ccff",onChange:E=>fe(D=>({...D,canvas:{...D.canvas,grain:E}}))}),a.jsx(Cr,{label:"Vignette",value:he.canvas.vignette,min:0,max:1,step:.01,display:E=>`${Math.round(E*100)}%`,color:"#88aaff",onChange:E=>fe(D=>({...D,canvas:{...D.canvas,vignette:E}}))}),a.jsx(Cr,{label:"Glow",value:he.quanta.glow,min:0,max:1,step:.01,display:E=>`${Math.round(E*100)}%`,color:"#ff88cc",onChange:E=>fe(D=>({...D,quanta:{...D.quanta,glow:E}}))}),a.jsx(Cr,{label:"Trail Memory",value:he.trails.persistence,min:0,max:1,step:.01,display:E=>`${Math.round(E*100)}%`,color:"#cc88ff",onChange:E=>fe(D=>({...D,trails:{...D.trails,persistence:E}}))}),a.jsx(Cr,{label:"Connections",value:he.connections.alpha,min:0,max:1,step:.01,display:E=>`${Math.round(E*100)}%`,color:"#00d4ff",onChange:E=>fe(D=>({...D,connections:{...D.connections,alpha:E}}))}),a.jsx(Cr,{label:"Tools Intensity",value:he.tools.intensity,min:0,max:1.5,step:.01,display:E=>E.toFixed(2),color:"#ffcc44",onChange:E=>fe(D=>({...D,tools:{...D.tools,intensity:E}}))}),a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsx("span",{className:"text-[5.5px] uppercase tracking-[0.14em] text-white/18",children:"3D overlays"}),a.jsx("button",{title:`Overlays 3D: ${he.threeD.overlays?"ON":"OFF"}`,onClick:()=>fe(E=>({...E,threeD:{...E.threeD,overlays:!E.threeD.overlays}})),className:"text-[6px] uppercase px-2 py-1 border transition-all",style:{borderRadius:0,borderColor:he.threeD.overlays?`${xr}55`:"rgba(255,255,255,0.06)",background:he.threeD.overlays?`${xr}12`:"transparent",color:he.threeD.overlays?xr:"rgba(255,255,255,0.28)"},children:he.threeD.overlays?"ON":"OFF"})]}),a.jsx("div",{className:"text-[5px] font-mono text-white/18 leading-snug text-center",children:"(em breve) estes knobs vo controlar camadas do canvas/3D  base j pronta."})]})]})]})]}),y&&((ut=r.current)==null?void 0:ut.quanta[y.qIdx])&&(()=>{var D;const E=r.current.quanta[y.qIdx];return a.jsxs("div",{className:"fixed z-[100] min-w-[148px] overflow-hidden",style:{left:y.sx+4,top:y.sy+4,fontFamily:$o,background:"rgba(0,0,0,0.96)",border:"1px dashed rgba(255,255,255,0.06)"},onMouseLeave:()=>v(null),children:[a.jsxs("div",{className:"px-2.5 py-1.5 border-b border-dashed border-white/[0.06] flex items-center justify-between",children:[a.jsxs("span",{className:"text-[6px] font-mono uppercase tracking-widest",style:{color:mo[E.role]},children:[E.role,"  pitch ",E.pitch]}),a.jsx("button",{onClick:()=>v(null),title:"Fechar",className:"text-white/25 hover:text-white/60 text-[8px]",children:""})]}),a.jsxs("div",{className:"p-1.5 border-b border-dashed border-white/[0.06]",children:[a.jsx("div",{className:"text-[5.5px] font-mono uppercase tracking-widest text-white/22 mb-1 px-1",children:"Change Role"}),a.jsx("div",{className:"grid grid-cols-4 gap-0.5",children:["KICK","BASS","PERC","PAD","LEAD","ARP","STRINGS","CHOIR"].map(z=>a.jsx("button",{title:`Mudar para ${z}`,onClick:()=>{var ee;E.role=z,E.mutations++,E.roleLockTimer=1.5,E.hue=dg[z],(ee=r.current)==null||ee.emergent.push({type:"mutation",x:E.x,y:E.y,r:.04,alpha:1,color:mo[z]}),Et(ue=>ue+1),v(null)},className:`text-[5.5px] uppercase py-1 px-0.5 transition-all
                      ${E.role===z?"bg-white/10":"hover:bg-white/6"}`,style:{color:E.role===z?mo[z]:"rgba(255,255,255,0.4)",borderRadius:0},children:z.slice(0,3)},z))})]}),a.jsxs("div",{className:"p-1.5 flex flex-col gap-0.5",children:[a.jsxs("div",{className:"p-1.5 border-b border-dashed border-white/[0.06]",children:[a.jsxs("div",{className:"text-[5.5px] font-mono uppercase tracking-widest text-white/22 mb-1 px-1",children:["Timbre  ",E.timbreIdx>=0?(D=ul[E.timbreIdx])==null?void 0:D.name:"Role default"]}),a.jsxs("div",{className:"flex flex-wrap gap-0.5 max-h-16 overflow-y-auto",style:{scrollbarWidth:"none"},children:[a.jsx("button",{title:"Usar timbre padro da role",onClick:()=>{E.timbreIdx=-1,Et(z=>z+1),v(null)},className:`text-[5px] px-1 py-0.5 border transition-all ${E.timbreIdx===-1?"border-white/30 text-white/70 bg-white/10":"border-white/[0.06] text-white/30 hover:text-white/60 hover:border-white/15"}`,style:{borderRadius:0},children:"Role"}),ul.map((z,ee)=>a.jsx("button",{onClick:()=>{E.timbreIdx=ee,Et(ue=>ue+1),v(null)},title:z.name,className:`text-[8px] py-0.5 px-0.5 border transition-all ${E.timbreIdx===ee?"border-current bg-current/15":"border-white/[0.06] hover:border-white/15"}`,style:{color:E.timbreIdx===ee?z.color:"rgba(255,255,255,0.4)",borderRadius:0},children:z.icon},ee))]})]}),[{label:"Rand Timbre",action:()=>Lh(y.qIdx)},{label:"Excite",action:()=>{E.charge=1,E.recentlyFired=1}},{label:"Freeze",action:()=>{E.vx=0,E.vy=0,E.charge=.05}},{label:"Lock Phase",action:()=>{E.phaseLocked=E.phaseLocked>=0?-1:E.id}},{label:"Pitch +1",action:()=>{E.pitch=Math.min(108,E.pitch+1)}},{label:"Pitch -1",action:()=>{E.pitch=Math.max(24,E.pitch-1)}},{label:"Delete",action:()=>{const z=r.current;if(!z)return;const ee=z.quanta.indexOf(E);ee>=0&&(z.quanta.splice(ee,1),z.count--),Pt(z.count)}}].map(({label:z,action:ee})=>a.jsx("button",{title:z,onClick:()=>{ee(),Et(ue=>ue+1),v(null)},className:`text-left text-[6.5px] uppercase tracking-wider px-2 py-1 transition-all
                    ${z==="Delete"?"text-red-400/70 hover:bg-red-900/20":"text-white/45 hover:text-white/80 hover:bg-white/[0.06]"}`,style:{borderRadius:0},children:z},z))]})]})})(),_&&a.jsx("button",{onClick:()=>P(!1),title:"Press H to restore HUD",className:"fixed top-3 right-3 z-40 px-2.5 py-1 transition-all",style:{fontFamily:$o,fontSize:7,letterSpacing:"0.12em",textTransform:"uppercase",color:"rgba(255,255,255,0.20)",background:"rgba(0,0,0,0.94)",border:"1px dashed rgba(255,255,255,0.06)"},children:"H  Show HUD"}),I&&a.jsx(Sq,{currentId:S,onSelect:Oa,onClose:()=>$(!1)}),Le&&!j&&a.jsx("div",{className:"fixed bottom-20 left-1/2 -translate-x-1/2 z-[6] pointer-events-none",children:a.jsxs("div",{className:"flex items-center gap-3 px-4 py-2",style:{fontFamily:$o,background:"rgba(0,0,0,0.94)",border:"1px dashed rgba(251,191,36,0.15)"},children:[a.jsx("span",{style:{fontSize:7,color:"rgba(251,191,36,0.60)",letterSpacing:"0.12em",textTransform:"uppercase"},children:" COMPOSE"}),a.jsx("span",{style:{fontSize:7,color:"rgba(255,255,255,0.20)"},children:"Click to place  Drag = velocity   Release to run  R to restore"})]})}),J&&a.jsx("div",{className:"fixed top-16 left-1/2 -translate-x-1/2 z-[6] pointer-events-none",children:a.jsx("div",{className:"flex items-center gap-2 px-3 py-1",style:{fontFamily:$o,background:"rgba(0,0,0,0.94)",border:"1px dashed rgba(255,153,68,0.15)"},children:a.jsx("span",{style:{fontSize:7,color:"rgba(255,153,68,0.55)",letterSpacing:"0.12em",textTransform:"uppercase"},children:" BALLISTIC  WALL BOUNCE  GATE NOTES ONLY"})})}),!_&&Na&&a.jsxs(Qf,{id:"ml_pad",title:"PAD",titleColor:"#88ffcc88",defaultX:40,defaultY:Math.max(200,window.innerHeight-(hr?380:180)),zIndex:22,width:210,onClose:()=>sa(!1),children:[a.jsx("div",{className:"flex px-1.5 pt-1.5 gap-0.5",children:Vn.map((E,D)=>a.jsx("button",{onClick:()=>mr(D),title:`Root: ${E}`,className:"flex-1 transition-all",style:{height:16,fontSize:6,textAlign:"center",color:Oe===D?"#88ffcc":E.includes("#")||E.includes("b")?"rgba(255,255,255,0.25)":"rgba(255,255,255,0.40)",background:Oe===D?"rgba(136,255,204,0.12)":E.includes("#")||E.includes("b")?"rgba(255,255,255,0.02)":"rgba(255,255,255,0.04)",border:Oe===D?"1px solid rgba(136,255,204,0.40)":"1px dashed rgba(255,255,255,0.04)"},children:E},E))}),a.jsxs("div",{className:"flex items-center px-1.5 py-1 gap-1",children:[a.jsxs("button",{onClick:()=>{const E=Object.keys(ir),D=E.indexOf(Kt);Gr(E[(D+1)%E.length])},title:"Trocar escala (clique para ciclar)",className:"flex items-center gap-1 transition-all",style:{fontSize:7,color:"rgba(155,89,255,0.75)",letterSpacing:"0.06em",textTransform:"uppercase"},children:[ir[Kt]," ",a.jsx(Pa,{size:7})]}),a.jsx("div",{style:{flex:1}}),a.jsxs("span",{style:{fontSize:6,color:"rgba(255,255,255,0.15)"},children:[Vn[Oe%12]," ",ir[Kt]]})]}),a.jsx("div",{className:"grid gap-0.5 px-1.5 pb-1.5",style:{gridTemplateColumns:`repeat(${Math.min(Gc[Kt].length,7)},1fr)`},children:Gc[Kt].map((E,D)=>{const z=Vn[(Oe+E)%12],ee=E===0;return a.jsx("button",{onClick:()=>Bd(E),title:`${z}${ee?" (root)":""}`,className:"transition-all active:scale-95",style:{height:28,fontSize:9,textAlign:"center",color:ee?"#88ffcc":"rgba(255,255,255,0.55)",background:ee?"rgba(136,255,204,0.08)":"rgba(255,255,255,0.04)",border:ee?"1px solid rgba(136,255,204,0.25)":"1px dashed rgba(255,255,255,0.06)",fontWeight:ee?600:400},children:z},`${E}_${D}`)})})]}),!_&&!Na&&a.jsx("button",{onClick:()=>sa(!0),className:"fixed z-[22] pointer-events-auto transition-all",title:"Abrir Instrument Pad",style:{left:40,bottom:hr?262:36,width:24,height:24,background:"rgba(0,0,0,0.85)",border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(55,178,218,0.45)",fontSize:11,display:"flex",alignItems:"center",justifyContent:"center"},children:""}),!_&&a.jsxs("div",{className:"fixed left-0 right-0 z-[25] border-t border-dashed border-white/[0.06]",style:{bottom:0,background:"#000",fontFamily:$o},children:[a.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 cursor-pointer select-none transition-colors",onClick:()=>or(E=>!E),style:{borderBottom:hr?"1px dashed rgba(255,255,255,0.04)":"none"},children:[a.jsx("span",{style:{fontFamily:Yo,fontSize:8,letterSpacing:"0.12em",textTransform:"uppercase",color:vn?xr:"rgba(255,255,255,0.22)"},children:"STUDIO SEQ"}),vn&&a.jsx("span",{className:"w-1.5 h-1.5 animate-pulse flex-shrink-0",style:{background:xr}}),a.jsx("span",{style:{fontFamily:$o,fontSize:6,color:"rgba(255,255,255,0.12)",marginLeft:"auto"},children:hr?"":""})]}),hr&&a.jsx(sq,{rows:Qt,active:vn,stepCount:Gn,cursor:pr,bpm:H,onToggleActive:Al,onToggleStep:dc,onSetStepCount:x0,onToggleMute:Yd,onToggleSolo:Kd,onSetVel:jl,onClearRow:Vh,onLoadPattern:Uh,onClearAll:tl})]}),a.jsx("div",{className:"fixed left-4 z-40",style:{bottom:hr&&!_?264:16},children:a.jsx(Pp,{state:ar,elapsed:Ar,onStart:b0,onStop:El})}),uo&&a.jsx(lq,{onClose:()=>fr(!1)}),a.jsx(pq,{}),a.jsx(mS,{open:jo,items:xq,position:Jo,activeId:te,onSelect:Ks,onClose:()=>bo(!1)}),a.jsx(mS,{open:vo,items:bq,position:Jo,onSelect:Tn,onClose:()=>Zo(!1)})]})},Er=280,kr=175,V={EMPTY:0,WALL:1,WATER:2,SAND:3,FIRE:4,FOOD:5,OIL:6,STEAM:7,POWDER:8,GUNPOWDER:9,ICE:10,SNOW:11,MAGMA:12,GAS:13,ACID:14,SEED:15,WOOD:16,VINE:17,CLONE:18,SALT:19,METAL:20,BOMB:21},gS={[V.EMPTY]:{label:"Erase",color:"#1a2030",desc:"Clear cells",cat:"tool"},[V.WALL]:{label:"Wall",color:"#5577aa",desc:"Immovable barrier",cat:"solid"},[V.WATER]:{label:"Water",color:"#2266ff",desc:"Flows and pools",cat:"fluid"},[V.SAND]:{label:"Sand",color:"#d4a030",desc:"Falls and piles",cat:"powder"},[V.FIRE]:{label:"Fire",color:"#ff5500",desc:"Burns oil, wood, gas",cat:"gas"},[V.FOOD]:{label:"Food",color:"#00ff88",desc:"Creatures eat this",cat:"bio"},[V.OIL]:{label:"Oil",color:"#8822cc",desc:"Floats, burns wildly",cat:"fluid"},[V.STEAM]:{label:"Steam",color:"#88aacc",desc:"Hot gas  rises, fades",cat:"gas"},[V.POWDER]:{label:"Powder",color:"#ddc488",desc:"Dust  ignites and blasts",cat:"powder"},[V.GUNPOWDER]:{label:"Gunpowder",color:"#555544",desc:"Chain explosion!",cat:"powder"},[V.ICE]:{label:"Ice",color:"#aaddff",desc:"Solid  melts near heat",cat:"solid"},[V.SNOW]:{label:"Snow",color:"#ddeeff",desc:"Falls slow, melts in fire",cat:"powder"},[V.MAGMA]:{label:"Magma",color:"#ff2200",desc:"Hot heavy liquid  burns",cat:"fluid"},[V.GAS]:{label:"Gas",color:"#88ff44",desc:"Flammable gas  rises",cat:"gas"},[V.ACID]:{label:"Acid",color:"#00ffaa",desc:"Dissolves most solids",cat:"fluid"},[V.SEED]:{label:"Seed",color:"#664422",desc:"Grows into wood + vine",cat:"bio"},[V.WOOD]:{label:"Wood",color:"#8b5a2b",desc:"Solid organic  burns",cat:"solid"},[V.VINE]:{label:"Vine",color:"#2a8822",desc:"Grows and spreads",cat:"bio"},[V.CLONE]:{label:"Clone",color:"#cc44ff",desc:"Multiplies what it touches",cat:"tool"},[V.SALT]:{label:"Salt",color:"#eeeeff",desc:"Dissolves in water",cat:"powder"},[V.METAL]:{label:"Metal",color:"#8899aa",desc:"Fireproof solid conductor",cat:"solid"},[V.BOMB]:{label:"Bomb",color:"#ff8800",desc:"Explodes when ignited",cat:"tool"}},Mq=[{id:"fluid",label:"Fluids",color:"#2266ff",cells:[V.WATER,V.OIL,V.MAGMA,V.ACID]},{id:"powder",label:"Powders",color:"#d4a030",cells:[V.SAND,V.POWDER,V.GUNPOWDER,V.SNOW,V.SALT]},{id:"solid",label:"Solids",color:"#5577aa",cells:[V.WALL,V.ICE,V.METAL,V.WOOD,V.BOMB]},{id:"gas",label:"Gas",color:"#ff5500",cells:[V.FIRE,V.GAS,V.STEAM]},{id:"bio",label:"Biology",color:"#00ff88",cells:[V.FOOD,V.SEED,V.VINE]},{id:"tool",label:"Tools",color:"#cc44ff",cells:[V.EMPTY,V.CLONE]}];function ts(e,t,r){return e<t?t:e>r?r:e}const dR={[V.WATER]:{density:1,viscosity:.3,thermal:.45},[V.OIL]:{density:.8,viscosity:.6,thermal:.25},[V.MAGMA]:{density:1.4,viscosity:.8,thermal:.9},[V.ACID]:{density:1.1,viscosity:.4,thermal:.4},[V.WALL]:{density:3,viscosity:1,thermal:.1},[V.SAND]:{density:1.6,viscosity:1,thermal:.15},[V.ICE]:{density:.92,viscosity:1,thermal:.55},[V.METAL]:{density:5,viscosity:1,thermal:.95},[V.WOOD]:{density:.6,viscosity:1,thermal:.08},[V.SNOW]:{density:.3,viscosity:1,thermal:.2}};function Sy(e){return e===V.WATER||e===V.OIL||e===V.MAGMA||e===V.ACID}class kq{constructor(){this.cols=Er,this.rows=kr,this.cells=new Uint8Array(Er*kr),this.heat=new Float32Array(Er*kr),this.extra=new Float32Array(Er*kr),this._upd=new Uint8Array(Er*kr),this._heatBuf=new Float32Array(Er*kr),this.fluidPressure=.6}idx(t,r){return r*this.cols+t}get(t,r){return t<0||t>=this.cols||r<0||r>=this.rows?V.WALL:this.cells[r*this.cols+t]}set(t,r,o,s=0){if(t<0||t>=this.cols||r<0||r>=this.rows)return;const l=r*this.cols+t;this.cells[l]=o,this.heat[l]=s,this.extra[l]=0,o===V.FIRE&&(this.heat[l]=.8+Math.random()*.2),o===V.STEAM&&(this.heat[l]=.3+Math.random()*.4),o===V.GAS&&(this.heat[l]=.8+Math.random()*.2),o===V.SEED&&(this.heat[l]=0),o===V.VINE&&(this.heat[l]=.5+Math.random()*.5),o===V.MAGMA&&(this.heat[l]=1),o===V.BOMB&&(this.extra[l]=0)}swap(t,r,o,s){const l=r*this.cols+t,i=s*this.cols+o,u=this.cells[l];this.cells[l]=this.cells[i],this.cells[i]=u;const c=this.heat[l];this.heat[l]=this.heat[i],this.heat[i]=c;const d=this.extra[l];this.extra[l]=this.extra[i],this.extra[i]=d}mark(t,r){this._upd[r*this.cols+t]=1}paint(t,r,o,s,l=1){const i=Math.ceil(o);for(let u=-i;u<=i;u++)for(let c=-i;c<=i;c++)if(c*c+u*u<=o*o&&Math.random()<l){const d=t+c|0,h=r+u|0,f=this.get(d,h);(s===V.EMPTY||f!==V.WALL||s===V.WALL)&&this.set(d,h,s)}}fill(t,r,o,s,l){for(let i=r;i<=s;i++)for(let u=t;u<=o;u++)this.set(u,i,l)}spawnFood(t=8){let r=0,o=0;for(;r<t&&o<t*30;){o++;const s=2+(Math.random()*(this.cols-4)|0),l=2+(Math.random()*(this.rows-5)|0);this.get(s,l)===V.EMPTY&&(this.set(s,l,V.FOOD),r++)}}_explode(t,r,o){const s=Math.ceil(o);for(let l=-s;l<=s;l++)for(let i=-s;i<=s;i++){const u=Math.sqrt(i*i+l*l);if(u>o)continue;const c=t+i,d=r+l,h=this.get(c,d);if(h===V.WALL||h===V.METAL)continue;const f=this.idx(c,d);u<o*.45?(this.cells[f]=V.EMPTY,this.heat[f]=0):(this.cells[f]=V.FIRE,this.heat[f]=1),this._upd[f]=1}}update(t){this._upd.fill(0);const r=(t&1)===0;for(let o=this.rows-2;o>=0;o--)for(let s=0;s<this.cols;s++){const l=r?s:this.cols-1-s,i=o*this.cols+l;if(!this._upd[i])switch(this.cells[i]){case V.SAND:this._sand(l,o);break;case V.WATER:this._water(l,o);break;case V.FIRE:this._fire(l,o);break;case V.OIL:this._oil(l,o);break;case V.STEAM:this._steam(l,o);break;case V.POWDER:this._powder(l,o);break;case V.GUNPOWDER:this._gunpowder(l,o);break;case V.ICE:this._ice(l,o);break;case V.SNOW:this._snow(l,o);break;case V.MAGMA:this._magma(l,o);break;case V.GAS:this._gas(l,o);break;case V.ACID:this._acid(l,o);break;case V.SEED:this._seed(l,o,t);break;case V.WOOD:this._wood(l,o,t);break;case V.VINE:this._vine(l,o);break;case V.CLONE:this._clone(l,o);break;case V.SALT:this._salt(l,o);break;case V.BOMB:this._bomb(l,o);break;case V.FOOD:this._food(l,o);break}}}_fall(t,r,o){return r+1>=this.rows?!1:o.includes(this.get(t,r+1))?(this.swap(t,r,t,r+1),this.mark(t,r+1),!0):!1}_slide(t,r,o){const s=Math.random()<.5?1:-1;for(const l of[s,-s])if(r+1<this.rows&&o.includes(this.get(t+l,r+1))&&this.get(t+l,r)===V.EMPTY)return this.swap(t,r,t+l,r+1),this.mark(t+l,r+1),!0;return!1}_spread(t,r,o){const s=Math.random()<.5?1:-1;for(const l of[s,-s])if(o.includes(this.get(t+l,r)))return this.swap(t,r,t+l,r),this.mark(t+l,r),!0;return!1}_sand(t,r){this._fall(t,r,[V.EMPTY,V.WATER,V.OIL,V.GAS])||this._slide(t,r,[V.EMPTY,V.WATER,V.GAS])}_water(t,r){if(this._fall(t,r,[V.EMPTY]))return;const o=Math.random()<.5?1:-1;if(r+1<this.rows){if(this.get(t+o,r+1)===V.EMPTY){this.swap(t,r,t+o,r+1),this.mark(t+o,r+1);return}if(this.get(t-o,r+1)===V.EMPTY){this.swap(t,r,t-o,r+1),this.mark(t-o,r+1);return}}const s=this.fluidPressure;if(s>.01){let l=0;for(let u=1;u<=6&&!(r-u<0);u++)if(this.get(t,r-u)===V.WATER)l++;else break;const i=.5+l*.08*s;if(Math.random()<i){if(l>=3&&s>.3){for(const u of[o,-o])if(this.get(t+u,r)===V.EMPTY&&this.get(t+u*2,r)===V.EMPTY){this.swap(t,r,t+u,r),this.mark(t+u,r);return}}if(this._spread(t,r,[V.EMPTY]))return}}this._spread(t,r,[V.EMPTY])}_fire(t,r){const o=this.idx(t,r);if(this.heat[o]-=.004+Math.random()*.009,this.heat[o]<=0){this.cells[o]=Math.random()<.28?V.STEAM:V.EMPTY,this.cells[o]===V.STEAM&&(this.heat[o]=.2+Math.random()*.3);return}if(r>0&&this.get(t,r-1)===V.EMPTY&&Math.random()<.6&&(this.swap(t,r,t,r-1),this.mark(t,r-1)),Math.random()<.04){const s=[[0,-1],[0,1],[-1,0],[1,0]];for(const[l,i]of s){const u=this.get(t+l,r+i),c=this.idx(t+l,r+i);if((u===V.OIL||u===V.WOOD||u===V.VINE||u===V.GAS||u===V.POWDER)&&(this.cells[c]=V.FIRE,this.heat[c]=1),u===V.GUNPOWDER&&this._explode(t+l,r+i,7),u===V.BOMB){const d=this.idx(t+l,r+i);this.extra[d]===0&&(this.extra[d]=1)}if(u===V.WATER&&Math.random()<.35){this.cells[o]=V.STEAM,this.heat[o]=.4;return}u===V.ICE&&Math.random()<.1&&(this.cells[c]=V.WATER,this.heat[c]=0)}}}_oil(t,r){if(this._fall(t,r,[V.EMPTY]))return;if(r>0&&this.get(t,r-1)===V.WATER){this.swap(t,r,t,r-1),this.mark(t,r-1);return}const o=this.fluidPressure;if(o>.01){let s=0;for(let i=1;i<=4&&!(r-i<0);i++)if(this.get(t,r-i)===V.OIL)s++;else break;const l=.2+s*.06*o;if(Math.random()<l){this._spread(t,r,[V.EMPTY]);return}}Math.random()<.35&&this._spread(t,r,[V.EMPTY])}_steam(t,r){const o=this.idx(t,r);if(this.heat[o]-=.005+Math.random()*.004,this.heat[o]<=0){this.cells[o]=V.EMPTY;return}if(r>0){const s=Math.random()<.5?1:-1;this.get(t,r-1)===V.EMPTY?(this.swap(t,r,t,r-1),this.mark(t,r-1)):this.get(t+s,r-1)===V.EMPTY?(this.swap(t,r,t+s,r-1),this.mark(t+s,r-1)):this.get(t-s,r-1)===V.EMPTY&&(this.swap(t,r,t-s,r-1),this.mark(t-s,r-1))}}_powder(t,r){if(!this._fall(t,r,[V.EMPTY,V.WATER,V.OIL])&&(this._slide(t,r,[V.EMPTY,V.WATER]),Math.random()<.03)){for(const[o,s]of[[0,-1],[0,1],[-1,0],[1,0]])if(this.get(t+o,r+s)===V.FIRE||this.get(t+o,r+s)===V.MAGMA){this._explode(t,r,4);return}}}_gunpowder(t,r){if(!this._fall(t,r,[V.EMPTY,V.WATER])&&(this._slide(t,r,[V.EMPTY,V.WATER]),Math.random()<.05))for(const[o,s]of[[0,-1],[0,1],[-1,0],[1,0]]){const l=this.get(t+o,r+s);if(l===V.FIRE||l===V.MAGMA){this._explode(t,r,9);return}}}_ice(t,r){const o=this.idx(t,r);if(Math.random()<.005)for(const[s,l]of[[0,-1],[0,1],[-1,0],[1,0]]){const i=this.get(t+s,r+l);if(i===V.FIRE||i===V.MAGMA||i===V.STEAM){this.cells[o]=V.WATER,this.heat[o]=0;return}}if(this.heat[o]>.35&&Math.random()<.04){this.cells[o]=V.WATER,this.heat[o]=0;return}if(Math.random()<.02)for(const[s,l]of[[0,-1],[0,1],[-1,0],[1,0]]){const i=t+s,u=r+l;if(i>=0&&i<this.cols&&u>=0&&u<this.rows){const c=u*this.cols+i;if(this.heat[c]>.5){this.heat[o]+=.03;break}}}}_snow(t,r){if(Math.random()<.35){if(this._fall(t,r,[V.EMPTY]))return;this._slide(t,r,[V.EMPTY])}for(const[o,s]of[[0,-1],[0,1],[-1,0],[1,0]]){const l=this.get(t+o,r+s);if((l===V.FIRE||l===V.MAGMA)&&Math.random()<.08){this.set(t,r,V.WATER);return}}}_magma(t,r){if(this.idx(t,r),Math.random()<.55){if(this._fall(t,r,[V.EMPTY,V.WATER]))return;Math.random()<.45&&this._spread(t,r,[V.EMPTY])}if(Math.random()<.06)for(const[o,s]of[[0,-1],[0,1],[-1,0],[1,0]]){const l=t+o,i=r+s,u=this.get(l,i),c=this.idx(l,i);u===V.WATER&&(this.cells[c]=V.STEAM,this.heat[c]=.5),(u===V.OIL||u===V.WOOD||u===V.VINE||u===V.GAS)&&(this.cells[c]=V.FIRE,this.heat[c]=1),u===V.ICE&&(this.cells[c]=V.WATER,this.heat[c]=0),u===V.SNOW&&(this.cells[c]=V.STEAM,this.heat[c]=.4)}}_gas(t,r){const o=this.idx(t,r);if(this.heat[o]-=.002+Math.random()*.003,this.heat[o]<=0){this.cells[o]=V.EMPTY;return}if(r>0&&Math.random()<.65){const s=Math.random()<.5?1:-1;this.get(t,r-1)===V.EMPTY?(this.swap(t,r,t,r-1),this.mark(t,r-1)):this.get(t+s,r-1)===V.EMPTY&&(this.swap(t,r,t+s,r-1),this.mark(t+s,r-1))}if(Math.random()<.03){for(const[s,l]of[[0,-1],[0,1],[-1,0],[1,0]])if(this.get(t+s,r+l)===V.FIRE||this.get(t+s,r+l)===V.MAGMA){this._explode(t,r,5);return}}}_acid(t,r){if(this._fall(t,r,[V.EMPTY]))return;const o=Math.random()<.5?1:-1;if(this.get(t+o,r+1)===V.EMPTY||this.get(t-o,r+1)===V.EMPTY?this._slide(t,r,[V.EMPTY]):this._spread(t,r,[V.EMPTY]),Math.random()<.08){const s=[[0,-1],[0,1],[-1,0],[1,0]];for(const[l,i]of s){const u=this.get(t+l,r+i);if(u===V.WALL||u===V.SAND||u===V.ICE||u===V.WOOD||u===V.METAL||u===V.VINE){const c=this.idx(t+l,r+i);if(this.cells[c]=V.EMPTY,this.heat[c]=0,Math.random()<.3){this.cells[this.idx(t,r)]=V.EMPTY;return}break}}}}_seed(t,r,o){if(this._fall(t,r,[V.EMPTY,V.WATER]))return;this._slide(t,r,[V.EMPTY]);const s=this.idx(t,r);this.heat[s]+=.004,this.heat[s]>=1&&Math.random()<.02&&(this.cells[s]=V.WOOD,this.heat[s]=.9,this.extra[s]=1)}_wood(t,r,o){const s=this.idx(t,r);for(const[l,i]of[[0,-1],[0,1],[-1,0],[1,0]]){const u=this.get(t+l,r+i);if((u===V.FIRE||u===V.MAGMA)&&Math.random()<.008){this.cells[s]=V.FIRE,this.heat[s]=.9;return}}if(this.extra[s]>0&&this.heat[s]>.2&&Math.random()<.004){this.heat[s]-=.05;const l=t+(Math.random()<.5?0:Math.random()<.5?1:-1),i=r-1;if(this.get(l,i)===V.EMPTY){this.set(l,i,V.WOOD);const u=this.idx(l,i);this.heat[u]=this.heat[s]*.85,this.extra[u]=1}}}_vine(t,r){const o=this.idx(t,r);if(this.heat[o]-=.001,!(this.heat[o]<=0)){for(const[s,l]of[[0,-1],[0,1],[-1,0],[1,0]]){const i=this.get(t+s,r+l);if(i===V.FIRE||i===V.MAGMA){this.cells[o]=V.FIRE,this.heat[o]=.9;return}}if(Math.random()<.007){const s=[[0,1],[0,-1],[-1,0],[1,0],[1,1],[-1,1]],l=s[Math.random()*s.length|0],i=t+l[0],u=r+l[1];this.get(i,u)===V.EMPTY&&(this.set(i,u,V.VINE),this.heat[this.idx(i,u)]=this.heat[o]*.8)}}}_clone(t,r){if(Math.random()>.04)return;const o=[[0,-1],[0,1],[-1,0],[1,0]];for(const[s,l]of o){const i=this.get(t+s,r+l);if(i!==V.EMPTY&&i!==V.CLONE){const u=o.filter(([c,d])=>this.get(t+c,r+d)===V.EMPTY);if(u.length>0){const[c,d]=u[Math.random()*u.length|0];this.set(t+c,r+d,i)}return}}}_salt(t,r){if(!this._fall(t,r,[V.EMPTY,V.WATER,V.OIL])){this._slide(t,r,[V.EMPTY]);for(const[o,s]of[[0,-1],[0,1],[-1,0],[1,0]])if(this.get(t+o,r+s)===V.WATER&&Math.random()<.06){const l=this.idx(t+o,r+s);this.cells[l]=V.EMPTY,this.cells[this.idx(t,r)]=V.EMPTY;return}}}_bomb(t,r){const o=this.idx(t,r);if(this.extra[o]>0){this.extra[o]+=.08,this.extra[o]>=1&&this._explode(t,r,12);return}for(const[s,l]of[[0,-1],[0,1],[-1,0],[1,0]]){const i=this.get(t+s,r+l);(i===V.FIRE||i===V.MAGMA)&&(this.extra[o]=.01)}}_food(t,r){this._fall(t,r,[V.EMPTY,V.WATER])||this._slide(t,r,[V.EMPTY])}render(t,r){const o=r*.06;for(let s=0;s<this.rows;s++)for(let l=0;l<this.cols;l++){const i=s*this.cols+l,u=i<<2,c=this.cells[i],d=this.heat[i];let h=4,f=6,g=14;switch(c){case V.WALL:{const m=(l*3+s*7&7)*3;h=38+m,f=55+m,g=75+m;break}case V.WATER:{const m=Math.sin(o+l*.35+s*.2)*15|0;h=10,f=65+m,g=195+m*.5;break}case V.SAND:{const m=(l*5+s*3&15)*4;h=165+(m>>1),f=112+(m>>2),g=38;break}case V.FIRE:{const m=ts(d,0,1),y=Math.random()*50|0;h=ts(210+m*45+y|0,0,255),f=ts(m*90+12+(y>>2)|0,0,255),g=0;break}case V.FOOD:{const m=Math.sin(o*1.4+l*.7+s*.5)*30|0;h=0,f=ts(170+m,80,255),g=ts(75+(m>>1),30,150);break}case V.OIL:{const m=((l^s)&7)*5;h=55+m,f=12,g=80+m;break}case V.STEAM:{const m=ts(d*2.8,0,1);h=115*m+4|0,f=138*m+6|0,g=162*m+14|0;break}case V.POWDER:{const m=(l*7+s*5&15)*3;h=205+m,f=185+m,g=140;break}case V.GUNPOWDER:{const m=((l^s)&7)*4;h=50+m,f=52+m,g=48+m;break}case V.ICE:{const m=(l*2+s&7)*4;h=140+m,f=205+m,g=255;break}case V.SNOW:{const m=(l+s&3)*8;h=215+m,f=220+m,g=235+m;break}case V.MAGMA:{const m=Math.random()*40|0;h=ts(235+m,0,255),f=ts(d*60+20+(m>>1)|0,0,255),g=0;break}case V.GAS:{const m=ts(d*1.8,0,1);h=80*m+4|0,f=185*m+6|0,g=60*m+10|0;break}case V.ACID:{const m=Math.sin(o*1.8+l*.4)*20|0;h=0,f=ts(200+m,100,255),g=ts(160+m,80,220);break}case V.SEED:{const m=(l*3+s*5&7)*5;h=80+m,f=55+m,g=20;break}case V.WOOD:{const m=(l*7+s*3&15)*3;h=110+m,f=75+m,g=28;break}case V.VINE:{const m=(l+s*3&7)*5;h=18,f=105+m,g=22;break}case V.CLONE:{const m=Math.sin(o*2.5+l*.8+s*.6)*40|0;h=ts(180+m,80,255),f=30,g=ts(220+m,100,255);break}case V.SALT:{const m=(l+s&3)*10;h=210+m,f=210+m,g=230+m;break}case V.METAL:{const m=(l*3+s&7)*3;h=100+m,f=115+m,g=135+m;break}case V.BOMB:{const m=this.extra[i]>0,y=m?Math.random()*60|0:0;h=m?ts(230+y,0,255):40,f=m?ts(100+y,0,255):35,g=m?0:30;break}default:h=4+(s/this.rows*5|0),f=6+(s/this.rows*6|0),g=14+(s/this.rows*10|0)}t[u]=h,t[u+1]=f,t[u+2]=g,t[u+3]=255}}countType(t){let r=0;for(let o=0;o<this.cells.length;o++)this.cells[o]===t&&r++;return r}nearestFood(t,r,o){let s=null,l=o*o;const i=Math.ceil(o),u=Math.max(0,t-i|0),c=Math.min(this.cols-1,t+i|0),d=Math.max(0,r-i|0),h=Math.min(this.rows-1,r+i|0);for(let f=d;f<=h;f++)for(let g=u;g<=c;g++)if(this.cells[f*this.cols+g]===V.FOOD){const m=(g-t)**2+(f-r)**2;m<l&&(l=m,s={x:g,y:f})}return s}consume(t,r,o){let s=0;const l=Math.ceil(o);for(let i=-l;i<=l;i++)for(let u=-l;u<=l;u++)if(u*u+i*i<=o*o){const c=t+u|0,d=r+i|0;this.get(c,d)===V.FOOD&&(this.set(c,d,V.EMPTY),s++)}return s}isPassable(t,r){const o=this.get(t|0,r|0);return o===V.EMPTY||o===V.WATER||o===V.FOOD||o===V.OIL||o===V.GAS||o===V.STEAM}isSolid(t,r){const o=this.get(t|0,r|0);return o===V.WALL||o===V.SAND||o===V.ICE||o===V.WOOD||o===V.METAL||o===V.BOMB||o===V.SNOW||o===V.SALT||o===V.POWDER||o===V.GUNPOWDER}cellAt(t,r){return this.get(t|0,r|0)}diffuseHeat(t){if(t<.001)return;const r=this.cols,o=this.rows,s=this.heat,l=this._heatBuf,i=.08*t;l.set(s);for(let u=1;u<o-1;u++)for(let c=1;c<r-1;c++){const d=u*r+c,h=this.cells[d];if(h===V.FIRE||h===V.STEAM||h===V.GAS||h===V.SEED||h===V.VINE||h===V.EMPTY)continue;const f=dR[h],g=f?f.thermal*i:i*.5,m=(s[d-1]+s[d+1]+s[d-r]+s[d+r])*.25;l[d]=s[d]+(m-s[d])*g,l[d]<0&&(l[d]=0),l[d]>1&&(l[d]=1)}s.set(l)}clear(){this.cells.fill(0),this.heat.fill(0),this.extra.fill(0)}}const pd=[{id:"terrarium",label:"Terrarium",icon:"",desc:"Blank box  build from scratch",spawnX:30,spawnY:.6,goalX:230},{id:"flat",label:"Flat",icon:"",desc:"Open flat ground  first steps",spawnX:12,spawnY:.5,goalX:230},{id:"cave",label:"Cave",icon:"",desc:"Procedural cavern  Rain World vibes",spawnX:14,spawnY:.3,goalX:240},{id:"ramp",label:"Ramp",icon:"",desc:"Ascending terrain  test climbing",spawnX:12,spawnY:.5,goalX:230},{id:"water",label:"Water",icon:"",desc:"Flooded terrain  test swimming",spawnX:12,spawnY:.4,goalX:230},{id:"steps",label:"Steps",icon:"",desc:"Staircase obstacles  curriculum stage 3",spawnX:12,spawnY:.5,goalX:230}];function _h(e){for(let t=0;t<e.cols;t++)e.set(t,0,V.WALL),e.set(t,e.rows-1,V.WALL),e.set(t,e.rows-2,V.WALL);for(let t=0;t<e.rows;t++)e.set(0,t,V.WALL),e.set(e.cols-1,t,V.WALL)}function Rq(e){e.clear(),_h(e);const t=e.rows,r=e.cols,o=Math.floor(t*.85);for(let s=1;s<r-1;s++)for(let l=0;l<3;l++)e.set(s,o+l,V.WALL)}function Aq(e){e.clear(),_h(e);const t=Math.floor(e.rows*.78);for(let o=1;o<e.cols-1;o++){const s=Math.floor(Math.sin(o*.12)*1.5+Math.random()*.5);for(let l=0;l<4+s;l++)e.set(o,t+l,V.WALL)}const r=[[50,t-14,25],[130,t-22,30],[200,t-12,22]];for(const[o,s,l]of r)for(let i=o;i<o+l;i++)e.set(i,s,V.WALL);e.fill(90,t-8,125,t-1,V.WATER),e.spawnFood(20);for(let o=-2;o<=2;o++)for(let s=-2;s<=2;s++)e.set(220+s,t-6+o,V.FOOD)}function jq(e,t=Math.random()){e.clear();const r=e.cols,o=e.rows,s=Fq(t);for(let d=1;d<o-1;d++)for(let h=1;h<r-1;h++)e.cells[d*r+h]=s()<.44?V.WALL:V.EMPTY;const l=new Uint8Array(r*o);for(let d=0;d<5;d++){for(let h=1;h<o-1;h++)for(let f=1;f<r-1;f++){let g=0;for(let m=-1;m<=1;m++)for(let y=-1;y<=1;y++)e.cells[(h+m)*r+(f+y)]===V.WALL&&g++;l[h*r+f]=g>=5?V.WALL:V.EMPTY}for(let h=0;h<l.length;h++)l[h]!==0&&(e.cells[h]=l[h])}_h(e);const i=Math.floor(o*.5);for(let d=i-4;d<i+4;d++)for(let h=2;h<22;h++)e.set(h,d,V.EMPTY);for(let d=i-5;d<i+5;d++)for(let h=r-22;h<r-2;h++)e.set(h,d,V.EMPTY);let u=15,c=i;for(;u<r-20;){8+(Math.floor(s()*6)|0);const d=6+(Math.floor(s()*8)|0);for(let h=-d/2;h<=d/2;h++){const f=Math.floor(c+h);if(f>1&&f<o-2)for(let g=0;g<6;g++){const m=u+g;m>1&&m<r-2&&e.set(m,f,V.EMPTY)}}u+=4+(Math.floor(s()*4)|0),c+=Math.floor((s()-.5)*5),c=Math.max(8,Math.min(o-10,c))}for(let d=0;d<6;d++){const h=20+Math.floor(s()*(r-40)),f=o-10;if(e.get(h,f)===V.EMPTY)for(let g=0;g<4;g++)for(let m=-5;m<=5;m++)e.get(h+m,f-g)===V.EMPTY&&e.set(h+m,f-g,V.WATER)}e.spawnFood(18)}function Eq(e){e.clear(),_h(e);const t=e.rows,r=e.cols;for(let s=1;s<r-1;s++){const l=Math.floor(t*.82-s*(t*.35)/r);for(let i=0;i<4;i++)e.set(s,l+i,V.WALL)}const o=[[60,.62,20],[130,.5,25],[200,.38,20]];for(const[s,l,i]of o){const u=Math.floor(t*l);for(let c=s;c<s+i;c++)e.set(c,u,V.WALL)}e.spawnFood(15);for(let s=-2;s<=2;s++)for(let l=-3;l<=3;l++)e.set(220+l,Math.floor(t*.25)+s,V.FOOD)}function Tq(e){e.clear(),_h(e);const t=e.rows,r=e.cols,o=Math.floor(t*.8);for(let s=1;s<r-1;s++)for(let l=0;l<3;l++)e.set(s,o+l,V.WALL);e.fill(1,Math.floor(t*.35),r-2,o-1,V.WATER),e.fill(30,Math.floor(t*.32),80,Math.floor(t*.33),V.WALL),e.fill(100,Math.floor(t*.24),160,Math.floor(t*.25),V.WALL),e.fill(180,Math.floor(t*.28),240,Math.floor(t*.29),V.WALL),e.spawnFood(18)}function Iq(e){e.clear(),_h(e);const t=e.rows,r=e.cols,o=Math.floor(t*.78);for(let l=1;l<r-1;l++)for(let i=0;i<3;i++)e.set(l,o+i,V.WALL);let s=0;for(let l=30;l<r-30;l+=22){s+=6;const i=o-s;e.fill(l,i,l+22,o,V.WALL)}e.spawnFood(15)}function Pq(e,t,r){const o=pd.find(s=>s.id===e)??pd[0];switch(e){case"terrarium":Rq(t);break;case"flat":Aq(t);break;case"cave":jq(t,r);break;case"ramp":Eq(t);break;case"water":Tq(t);break;case"steps":Iq(t);break}return o}function wy(e,t,r){const o=Math.floor(e.rows*r);for(let s=o;s<e.rows-2;s++)if(e.isSolid(t|0,s))return s-5;return Math.floor(e.rows*r)}function Fq(e){let t=e*2654435761>>>0;return()=>(t^=t<<13,t^=t>>17,t^=t<<5,(t>>>0)/4294967296)}const uR=.1,Sd=1/60,Nq=8,Zc=.9;let Ls=0;const Ic=[{id:"slugcat",name:"Slugcat",icon:"",segN:6,segR:[2.6,2.3,2.1,1.9,1.6,1.3],segM:[2.2,1.8,1.5,1.3,1,.8],gripIdx:[4,5],jointStiff:.45,hue:210,lineage:Ls++,species:"crawler",appendageCount:3,biolum:!0,tailFade:!0,diet:"omnivore"},{id:"centipede",name:"Centipede",icon:"",segN:10,segR:[1.6,1.8,1.8,1.8,1.8,1.8,1.8,1.8,1.8,1.4],segM:[1.4,1.2,1.2,1.2,1.2,1.2,1.2,1.2,1.2,.9],gripIdx:[1,3,5,7,9],jointStiff:.55,hue:28,lineage:Ls++,species:"centipede",appendageCount:5,biolum:!1,tailFade:!1,diet:"carnivore"},{id:"crawler",name:"Crawler",icon:"",segN:4,segR:[3.2,3,2.8,2.4],segM:[3.5,3,2.5,2],gripIdx:[2,3],jointStiff:.5,hue:340,lineage:Ls++,species:"crawler",appendageCount:2,biolum:!0,tailFade:!0,diet:"herbivore"},{id:"serpent",name:"Serpent",icon:"",segN:8,segR:[1.5,1.7,1.8,1.9,1.9,1.8,1.6,1.3],segM:[1,1,1,1,1,1,1,.8],gripIdx:[2,4,6,7],jointStiff:.35,hue:100,lineage:Ls++,species:"serpent",appendageCount:0,biolum:!0,tailFade:!0,diet:"omnivore"},{id:"spider",name:"Arachnid",icon:"",segN:5,segR:[2.8,2.5,2.2,1.9,1.5],segM:[3,2.5,2,1.5,1],gripIdx:[3,4],jointStiff:.6,hue:270,lineage:Ls++,species:"spider",appendageCount:4,biolum:!0,tailFade:!1,diet:"carnivore"},{id:"jellyfish",name:"Medusa",icon:"",segN:7,segR:[3.5,3,2.8,2.5,2,1.5,1],segM:[.6,.5,.5,.4,.3,.3,.2],gripIdx:[],jointStiff:.25,hue:185,lineage:Ls++,species:"jellyfish",appendageCount:6,biolum:!0,tailFade:!0,diet:"omnivore"},{id:"leviathan",name:"Leviathan",icon:"",segN:12,segR:[2,2.4,2.8,3,3.2,3.2,3,2.8,2.4,2,1.6,1.2],segM:[1.8,2,2.2,2.5,2.8,2.8,2.5,2.2,2,1.8,1.4,1],gripIdx:[3,5,7,9],jointStiff:.4,hue:55,lineage:Ls++,species:"serpent",appendageCount:4,biolum:!0,tailFade:!0,diet:"omnivore"},{id:"manta",name:"Manta Ray",icon:"",segN:5,segR:[2.2,2.8,3.4,2.8,1.8],segM:[.8,.9,1,.8,.5],gripIdx:[],jointStiff:.28,hue:190,lineage:Ls++,species:"swimmer",appendageCount:2,biolum:!0,tailFade:!0,diet:"omnivore"},{id:"bird",name:"Skybird",icon:"",segN:4,segR:[1.6,2,1.8,1],segM:[.28,.35,.3,.18],gripIdx:[],jointStiff:.3,hue:42,lineage:Ls++,species:"aerial",appendageCount:2,biolum:!1,tailFade:!0,diet:"carnivore"},{id:"glowworm",name:"Glowworm",icon:"",segN:11,segR:[1,1.1,1.2,1.3,1.3,1.3,1.2,1.2,1.1,1,.8],segM:[.7,.6,.6,.6,.6,.6,.6,.6,.6,.6,.5],gripIdx:[2,5,8,10],jointStiff:.38,hue:140,lineage:Ls++,species:"serpent",appendageCount:0,biolum:!0,tailFade:!0,diet:"omnivore"},{id:"starfish",name:"Starfish",icon:"",segN:5,segR:[2,1.8,1.8,1.8,1.8],segM:[2.2,1.6,1.6,1.6,1.6],gripIdx:[0,1,2,3,4],jointStiff:.52,hue:22,lineage:Ls++,species:"crawler",appendageCount:5,biolum:!0,tailFade:!1,diet:"omnivore"},{id:"dragonfly",name:"Dragonfly",icon:"",segN:3,segR:[1.2,1.5,.8],segM:[.22,.28,.16],gripIdx:[],jointStiff:.4,hue:160,lineage:Ls++,species:"aerial",appendageCount:2,biolum:!1,tailFade:!0,diet:"carnivore"},{id:"crab",name:"Crab",icon:"",segN:4,segR:[2.6,2.8,2.8,2.4],segM:[2.8,3,2.8,2.2],gripIdx:[0,1,2,3],jointStiff:.65,hue:15,lineage:Ls++,species:"spider",appendageCount:4,biolum:!1,tailFade:!1,diet:"omnivore"}];function hR(e){return 3+Math.min(4,Math.ceil((e.segN-1)/3))*2}function fR(e){const t=hR(e),r=new Float32Array(t);r[0]=1.6,r[1]=.55,r[2]=.2;const o=Math.min(4,Math.ceil((e.segN-1)/3));for(let s=0;s<o;s++)r[3+s*2]=.1+Math.random()*.05,r[3+s*2+1]=(Math.random()-.5)*.04;return r}function pR(e,t){const r=e[0],o=e[1],s=e[2],l=t.segs,i=l.length,u=Math.min(4,Math.ceil((i-1)/3)),c=Oq(t),d=-s*c*.04,h=[];for(let f=0;f<i;f++){const m=3+Math.min(u-1,Math.floor(f*u/i))*2,y=e[m]??.1,v=e[m+1]??0,b=r*t.phase*60+f*o;h.push((v+y*Math.sin(b)+d)*l[f].mass)}return h}function Oq(e){const t=e.segs[0],r=e.segs[e.segs.length-1];return Math.atan2(r.y-t.y,r.x-t.x)}function mR(e){let t=0,r=0;for(const o of e.segs)t+=o.x*o.mass,r+=o.mass;return t/r}function _q(e){return e.segs.filter(t=>t.gripped).length}function Dq(e){const t=e.length;if(!(t<2))for(let r=0;r<t;r++){const o=e[r];if(!o.alive)continue;const s=o.segs[0];for(let l=r+1;l<t;l++){const i=e[l];if(!i.alive)continue;const u=i.segs[0],c=u.x-s.x,d=u.y-s.y,h=c*c+d*d,f=(s.r+u.r)*1.8;if(h<f*f&&h>.001){const g=Math.sqrt(h),m=f-g,y=c/g,v=d/g,b=m*.15;s.vx-=y*b,s.vy-=v*b,u.vx+=y*b,u.vy+=v*b}}}}function Lq(e){if(e.energy<160||e.age<300||!e.alive||Math.random()>.15)return null;e.energy-=80;const t=e.segs[0],r=t.x+(Math.random()-.5)*10,o=t.y-2,s=e.policyParams.slice();for(let u=0;u<s.length;u++)s[u]+=(Math.random()-.5)*.08;const l={...e.bp,hue:((e.bp.hue+Math.floor((Math.random()-.5)*12))%360+360)%360,lineage:e.bp.lineage+1},i=Pd(l,r,o,s);return i.energy=80,i.generation=e.generation+1,i.facingDir=Math.random()<.5?1:-1,i}function Pd(e,t,r,o){const s=e.segR.map((l,i)=>({x:t+i*l*1.65,y:r,vx:0,vy:0,r:l,mass:e.segM[i]??1,isGrip:e.gripIdx.includes(i),gripped:!1}));return{bp:e,segs:s,phase:0,alive:!0,energy:120,age:0,startX:t,startY:r,fitness:0,policyParams:o??fR(e),lastProgress:t,stuckTimer:0,trail:[],facingDir:Math.random()<.5?1:-1,lastAteTick:0,ateAmount:0,maxAge:800+Math.floor(Math.random()*600),generation:0}}function gR(e,t,r,o=uR){const s=e.segs,l=s.length;e.age++,e.phase+=Sd;const i=s[0];e.trail.push({x:i.x,y:i.y,age:0}),e.trail.length>40&&e.trail.shift();for(const C of e.trail)C.age++;if(e.age%12===0){const C=r.nearestFood(i.x,i.y,60);C&&(e.facingDir=C.x>=i.x?1:-1)}const u=e.bp.species==="aerial",c=e.bp.species==="swimmer"||e.bp.species==="jellyfish";for(let C=0;C<l;C++){const k=s[C],R=t[C]??0,T=r.cellAt(k.x|0,k.y|0)===V.WATER,_=u?o*.12:o;if(k.vy+=_*60*Sd,k.vy+=R*Sd*60,T&&(k.vx*=.84,k.vy*=.84,k.vy-=o*(u?1.2:c?.85:.55)*60*Sd,c)){const I=(e.policyParams[0]??1.6)*e.phase*60+C*.6;k.vx+=Math.sin(I)*.035*e.facingDir*k.mass}const P=T?1:k.gripped?.84:.997;k.vx*=P,k.vy*=P,k.vx=Math.max(-Zc,Math.min(Zc,k.vx)),k.vy=Math.max(-Zc,Math.min(Zc,k.vy)),k.x+=k.vx,k.y+=k.vy}const d=Math.max(.15,Math.min(.85,e.bp.jointStiff));for(let C=0;C<5;C++)for(let k=0;k<l-1;k++){const R=s[k],j=s[k+1],T=(R.r+j.r)*.85,_=j.x-R.x,P=j.y-R.y,I=Math.sqrt(_*_+P*P);if(I<1e-4)continue;const $=(I-T)/I*d,q=R.mass+j.mass,L=j.mass/q,H=R.mass/q;R.x+=_*$*L,R.y+=P*$*L,j.x-=_*$*H,j.y-=P*$*H}for(const C of s){C.gripped=!1;const k=C.y+C.r+.5,R=C.x|0,j=k|0;if(j>=0&&j<r.rows&&r.isSolid(R,j)){let q=j;for(;q>1&&r.isSolid(R,q-1);)q--;const L=C.y+C.r-q;L>0&&L<C.r*2.5&&(C.y-=L,C.vy=Math.min(0,C.vy)*-.1,C.vx*=.76,C.gripped=C.isGrip)}const T=C.x-C.r-.5|0,_=C.x+C.r+.5|0,P=C.y|0;T>=0&&r.isSolid(T,P)&&(C.x+=.6,C.vx=Math.abs(C.vx)*.3),_<r.cols&&r.isSolid(_,P)&&(C.x-=.6,C.vx=-Math.abs(C.vx)*.3);const I=C.y-C.r-.5|0;I>=0&&r.isSolid(R,I)&&(C.y=I+C.r+1,C.vy=Math.abs(C.vy)*.25),C.x=Math.max(C.r+1,Math.min(r.cols-C.r-1,C.x)),C.y=Math.max(C.r+1,Math.min(r.rows-C.r-1,C.y));const $=r.cellAt(C.x|0,C.y|0);($===V.FIRE||$===V.MAGMA)&&(e.energy-=.25),$===V.ACID&&(e.energy-=.08)}const h=e.policyParams[0]??1.6,f=e.policyParams[1]??.55,g=Math.max(.04,e.policyParams[3]??.1)*.55,m=s[0],y=e.phase*60;switch(e.bp.species){case"serpent":{for(let C=0;C<l;C++){const k=h*y+C*f*2.2,R=s[Math.max(0,C-1)],j=s[Math.min(l-1,C+1)],_=Math.atan2(j.y-R.y,j.x-R.x)+Math.PI/2,P=C/(l-1),I=g*(1+P*2.5)*s[C].mass;s[C].vx+=Math.cos(_)*Math.sin(k)*I,s[C].vy+=Math.sin(_)*Math.sin(k)*I,s[C].vx+=Math.max(0,Math.sin(k+.9))*g*.35*e.facingDir*s[C].mass}for(let C=1;C<l;C++)s[C].gripped&&(m.vx+=e.facingDir*.035*s[C].mass);break}case"spider":{const C=Math.sin(h*y*1.6),k=e.bp.gripIdx;for(let R=0;R<k.length;R++){const j=k[R],T=s[j],_=R%2===0,P=_?C>0:C<0;T.gripped&&P&&(m.vx+=e.facingDir*.11*T.mass,s[Math.max(0,j-1)].vy-=.018),T.isGrip&&!P&&(T.vy-=.012*Math.max(0,-Math.sin(h*y*1.6+(_?0:Math.PI))))}m.vy+=Math.sin(h*y*3.2)*.01;for(let R=0;R<l;R++)s[R].vx+=g*.15*e.facingDir*s[R].mass*Math.max(0,Math.sin(h*y+R*.6));break}case"centipede":{const C=e.bp.gripIdx;for(let k=0;k<C.length;k++){const R=C[k],j=s[R],T=h*y*1.2+k*f*1.8,_=Math.max(0,Math.sin(T));if(j.gripped&&_>.3){const P=e.facingDir*.065*j.mass*_;s[Math.max(0,R-1)].vx+=P,m.vx+=P*.25}j.isGrip&&_<.2&&(j.vy-=.018*Math.max(0,Math.sin(T+Math.PI)))}for(let k=0;k<l;k++)s[k].vy+=Math.sin(h*y*.9+k*.45)*g*.18*s[k].mass;break}case"crawler":{const C=Math.sin(h*y*.7),k=Math.floor(l/2);if(C>0){for(let j=0;j<k;j++)s[j].vx+=e.facingDir*g*1.4*s[j].mass;for(let j=k;j<l;j++)s[j].gripped&&(s[j].vx*=.65)}else{for(let j=k;j<l;j++)s[j].vx+=e.facingDir*g*1.8*s[j].mass;for(let j=0;j<k;j++)s[j].gripped&&(s[j].vx*=.65)}const R=Math.abs(Math.cos(h*y*.7))*.03;for(let j=1;j<l-1;j++){const T=1-Math.abs(j-k)/Math.max(1,k);s[j].vy-=R*T*s[j].mass}for(let j=1;j<l;j++)s[j].gripped&&(m.vx+=e.facingDir*.025*s[j].mass);break}case"jellyfish":{const C=Math.sin(h*.45*y);let k=0,R=0,j=0;for(const T of s)k+=T.x*T.mass,R+=T.y*T.mass,j+=T.mass;if(k/=j,R/=j,C>0){const T=C*.065;for(const _ of s)_.vx+=(k-_.x)*T,_.vy+=(R-_.y)*T;for(const _ of s)_.vy-=C*.045*_.mass;m.vx+=e.facingDir*C*.025}else{const T=Math.abs(C)*.018;for(const _ of s)_.vx+=(_.x-k)*T*.5,_.vy+=(_.y-R)*T*.3}for(let T=Math.floor(l*.55);T<l;T++)s[T].vy+=.009,s[T].vx+=Math.sin(y*.6+T*.9)*.009;break}case"swimmer":{if(s.some(k=>r.cellAt(k.x|0,k.y|0)===V.WATER)){const k=Math.floor(l*.4);for(let R=k;R<l;R++){const j=h*1.8*y+R*.9,T=s[Math.max(0,R-1)],_=s[Math.min(l-1,R+1)],I=Math.atan2(_.y-T.y,_.x-T.x)+Math.PI/2,$=(R-k)/Math.max(1,l-1-k),q=g*3*s[R].mass*(.3+$*.7);s[R].vx+=Math.cos(I)*Math.sin(j)*q,s[R].vy+=Math.sin(I)*Math.sin(j)*q}m.vx+=e.facingDir*g*.55}else{const k=Math.sin(h*y*2.5);for(let R=Math.floor(l/2);R<l;R++)s[R].vy-=Math.max(0,k)*.12*s[R].mass,s[R].vx+=k*.04*e.facingDir*s[R].mass}break}case"aerial":{const C=h*y*1.1,k=Math.sin(C);if(k>-.2){const R=Math.max(0,k)*.16;for(const T of s)T.vy-=R*T.mass;const j=Math.max(0,k)*.065;for(const T of s)T.vx+=j*e.facingDir*T.mass}else for(const R of s)R.vy+=.005*R.mass;m.vy+=k*.025,m.vx+=e.facingDir*.02,s[l-1].vx-=Math.sin(C*.5)*.01*e.facingDir;break}default:{for(let C=0;C<l;C++){const k=h*y+C*f;s[C].vx+=Math.max(0,Math.sin(k))*g*e.facingDir*s[C].mass}for(let C=1;C<l;C++)s[C].gripped&&(m.vx+=e.facingDir*.06*s[C].mass,C>1&&(s[C-1].vx+=e.facingDir*.03*s[C].mass));break}}const b=r.consume(m.x,m.y,m.r*3);b>0&&(e.energy=Math.min(200,e.energy+b*50),m.vx+=e.facingDir*.04,e.lastAteTick=e.age,e.ateAmount=b),e.energy-=.015,e.energy<=0&&(e.alive=!1);const S=mR(e);Math.abs(S-e.lastProgress)<.08?(e.stuckTimer++,e.stuckTimer>80&&(e.facingDir=e.facingDir*-1,e.stuckTimer=0,e.lastProgress=S)):(e.stuckTimer=0,e.lastProgress=S)}function zq(e,t){const r=mR(e)-e.startX,o=e.alive?5:-5,s=_q(e)>0?1:-2,l=e.energy-120,i=Math.max(0,Math.min(1,e.energy/120));return t==="survive"?r*.9+o+s+i*3:t==="forage"?l*.22+r*.3+o+s:t==="climb"?(e.startY-e.segs[0].y)*1.5+o+i*2:r+o+s}class Bq{constructor(t,r,o,s,l="survive"){this.candidates=[],this.evalCreature=null,this.evalIdx=0,this.evalTick=0,this.evalMaxTick=240,this.generation=0,this.bestScore=-1/0,this.bestParams=null,this.running=!1,this.popSize=12,this.eliteK=4,this._bp=t,this._grid=r,this._sx=o,this._sy=s,this._task=l;const i=hR(t);this.mean=fR(t).slice(),this.std=new Float32Array(i).fill(.35),this.std[0]=.5,this.std[1]=.4,this.std[2]=.2}start(t=12,r=4){this.popSize=t,this.evalMaxTick=r*60|0,this.running=!0,this._newRound()}stop(){this.running=!1}step(){if(!this.running)return{improved:!1};const t=performance.now();let r=!1;for(;performance.now()-t<Nq;){if(!this.evalCreature||this.evalIdx>=this.candidates.length){this._update(),this._newRound(),this.generation++,r=!0;break}const o=this.candidates[this.evalIdx],s=pR(o.params,this.evalCreature);gR(this.evalCreature,s,this._grid),this.evalTick++;const l=this.evalTick>90&&this.evalCreature.stuckTimer>80;(!this.evalCreature.alive||l||this.evalTick>=this.evalMaxTick)&&(o.score=zq(this.evalCreature,this._task),o.score>this.bestScore&&(this.bestScore=o.score,this.bestParams=new Float32Array(o.params),r=!0),this.evalIdx++,this.evalIdx<this.candidates.length&&(this.evalCreature=Pd(this._bp,this._sx,this._sy,this.candidates[this.evalIdx].params),this.evalTick=0))}return{improved:r}}spawnChampion(){return this.bestParams?Pd(this._bp,this._sx,this._sy,this.bestParams.slice()):null}get currentCandidate(){return this.evalCreature}getStats(){const t=this.candidates.filter(o=>isFinite(o.score)),r=t.length>0?t.reduce((o,s)=>o+s.score,0)/t.length:0;return{generation:this.generation,bestScore:this.bestScore,avgScore:r,candidateIdx:this.evalIdx,popSize:this.popSize,running:this.running}}changeGrid(t){this._grid=t}_newRound(){if(this.candidates=Array.from({length:this.popSize},()=>({params:this._sample(),score:-1/0})),this._task==="forage"){for(let t=-20;t<=50;t+=5)for(let r=-6;r<=4;r+=3)if(Math.random()<.45){const o=this._sx+t|0,s=this._sy+r|0;o>1&&o<this._grid.cols-1&&s>1&&s<this._grid.rows-1&&this._grid.cellAt(o,s)===0&&this._grid.set(o,s,V.FOOD)}}this.evalCreature=Pd(this._bp,this._sx,this._sy,this.candidates[0].params),this.evalIdx=0,this.evalTick=0}_sample(){const t=new Float32Array(this.mean.length);for(let r=0;r<t.length;r++)t[r]=this.mean[r]+$q()*this.std[r];return t}_update(){const t=this.candidates.filter(o=>isFinite(o.score)).sort((o,s)=>s.score-o.score);if(t.length===0)return;const r=t.slice(0,Math.max(2,this.eliteK));for(let o=0;o<this.mean.length;o++){let s=0;for(const l of r)s+=l.params[o];this.mean[o]=s/r.length}for(let o=0;o<this.std.length;o++){let s=0;for(const l of r)s+=(l.params[o]-this.mean[o])**2;this.std[o]=Math.max(.008,Math.sqrt(s/r.length)*1.05+.003)}}}function $q(){let e=0,t=0;for(;!e;)e=Math.random();for(;!t;)t=Math.random();return Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*t)}let qq=1;function Wq(e,t,r,o){const s=[];return r>20&&s.push("runner"),r>40&&s.push("climber"),e.segN>7&&s.push("crawler"),e.segN<=4&&s.push("heavy"),{id:`sp-${qq++}`,bp:{...e,lineage:e.lineage+1},bestParams:t.slice(),bestScore:r,generation:o,createdAt:Date.now(),tags:s}}function yS(e){let t=0;for(const r of e.segs)t+=r.mass;return t}function Hq(e){const t=e.length;if(!(t<2))for(let r=0;r<t;r++){const o=e[r];if(!o.alive)continue;const s=o.bp.diet;if(s==="herbivore"){for(let l=0;l<t;l++){if(r===l)continue;const i=e[l];if(!i.alive||i.bp.diet==="herbivore")continue;const u=o.segs[0].x-i.segs[0].x,c=o.segs[0].y-i.segs[0].y,d=u*u+c*c;if(d<900&&d>.01){const h=Math.sqrt(d),f=.08/(h*.05+1);o.segs[0].vx+=u/h*f,o.segs[0].vy+=c/h*f*.5,o.facingDir=u>0?1:-1}}continue}if(s==="carnivore"||s==="omnivore"){const l=o.segs[0],i=yS(o);let u=null,c=1/0;for(let d=0;d<t;d++){if(r===d)continue;const h=e[d];if(!h.alive||yS(h)>=i*(s==="carnivore"?.95:.65))continue;const m=h.segs[0].x-l.x,y=h.segs[0].y-l.y,v=m*m+y*y;v<c&&v<2500&&(c=v,u=h)}if(u){const d=u.segs[0].x-l.x,h=u.segs[0].y-l.y,f=Math.sqrt(c);o.facingDir=d>0?1:-1;const g=.05/(f*.03+1);l.vx+=d/f*g,l.vy+=h/f*g*.5;for(const m of o.segs)for(const y of u.segs){const v=y.x-m.x,b=y.y-m.y,S=v*v+b*b,C=(m.r+y.r)*1.2;if(S<C*C){const k=m.mass*.8;if(u.energy-=k,o.energy=Math.min(200,o.energy+k*.6),S>.01){const R=Math.sqrt(S);y.vx+=v/R*.3,y.vy+=b/R*.3}o.lastAteTick=o.age,o.ateAmount=1;break}}}}}}function Gq(e){const t=e.length;if(!(t<2))for(let r=0;r<t;r++){const o=e[r];if(o.alive)for(let s=r+1;s<t;s++){const l=e[s];if(!l.alive)continue;const i=o.segs[0].x-l.segs[0].x,u=o.segs[0].y-l.segs[0].y;if(!(i*i+u*u>2500))for(const c of o.segs)for(const d of l.segs){const h=d.x-c.x,f=d.y-c.y,g=h*h+f*f,m=(c.r+d.r)*.9;if(g<m*m&&g>.001){const y=Math.sqrt(g),v=m-y,b=h/y,S=f/y,C=v*.12,k=c.mass+d.mass;c.vx-=b*C*(d.mass/k),c.vy-=S*C*(d.mass/k),d.vx+=b*C*(c.mass/k),d.vy+=S*C*(c.mass/k)}}}}}function Vq(e,t,r=uR){const o=e.segs,s=o.length;e.phase+=Sd*.3;for(const l of o)l.vy+=r*60*Sd,t.cellAt(l.x|0,l.y|0)===V.WATER?(l.vx*=.88,l.vy*=.88,l.vy-=r*.35*60*Sd):(l.vx*=.992,l.vy*=.992),l.vx=Math.max(-Zc,Math.min(Zc,l.vx)),l.vy=Math.max(-Zc,Math.min(Zc,l.vy)),l.x+=l.vx,l.y+=l.vy;for(let l=0;l<2;l++)for(let i=0;i<s-1;i++){const u=o[i],c=o[i+1],d=(u.r+c.r)*1.2,h=c.x-u.x,f=c.y-u.y,g=Math.sqrt(h*h+f*f);if(g<1e-4)continue;const m=(g-d)/g*.15,y=u.mass+c.mass;u.x+=h*m*(c.mass/y),u.y+=f*m*(c.mass/y),c.x-=h*m*(u.mass/y),c.y-=f*m*(u.mass/y)}for(const l of o){l.gripped=!1,l.x=Math.max(l.r+1,Math.min(t.cols-l.r-1,l.x)),l.y=Math.max(l.r+1,Math.min(t.rows-l.r-1,l.y));const i=l.x|0,u=l.y+l.r+.5|0;u>=0&&u<t.rows&&t.isSolid(i,u)&&(l.y=u-l.r-.5,l.vy=Math.min(0,l.vy)*-.1,l.vx*=.6,l.gripped=!0)}}function Uq(e,t,r,o){const s=Math.max(0,1-o/300)*.45;s<.01||hb(e,t,r,!1,s)}function hb(e,t,r,o=!1,s=1){const l=t.segs;if(l.length<2)return;const{hue:i,species:u,biolum:c,tailFade:d,appendageCount:h}=t.bp,f=Math.max(0,Math.min(1,t.energy/120)),g=Math.sin(t.phase*2.2)*.08+1;if(e.save(),t.trail.length>3)for(let P=0;P<t.trail.length-1;P++){const I=t.trail[P],$=Math.max(0,1-I.age/40)*.15*s;$<.01||(e.beginPath(),e.arc(I.x,I.y,l[0].r*r*.4,0,Math.PI*2),e.fillStyle=`hsla(${i},70%,55%,${$})`,e.fill())}h>0&&Kq(e,t,r,s),Yq(e,l,r,i,f,s,c,d,g,t.phase);for(const P of l)if(P.gripped){const I=P.r*r*.6;e.beginPath(),e.arc(P.x,P.y+P.r*r*.5,I,0,Math.PI*2),e.fillStyle=`hsla(${(i+130)%360},90%,60%,${.25*s})`,e.fill()}const m=l[0],y=l[1],v=Math.atan2(m.y-y.y,m.x-y.x),b=m.r*r*.15,S=m.r*r*.5;c&&(e.shadowColor=`hsl(${i},100%,80%)`,e.shadowBlur=b*6);const C=m.x+Math.cos(v)*S,k=m.y+Math.sin(v)*S;if(e.beginPath(),e.arc(C,k,b*g,0,Math.PI*2),e.fillStyle=`hsla(${i},60%,85%,${.7*s*f})`,e.fill(),e.shadowBlur=0,f<.35){const P=1+(.35-f)*8,I=(Math.sin(t.phase*P)*.5+.5)*.4;e.beginPath(),e.arc(m.x,m.y,m.r*r*1.2,0,Math.PI*2),e.fillStyle=`hsla(0,80%,50%,${I*s})`,e.fill()}if(f>.8&&c){const P=(f-.8)*2.5*.12;e.beginPath(),e.arc(m.x,m.y,m.r*r*2.5*g,0,Math.PI*2),e.fillStyle=`hsla(${i},80%,70%,${P*s})`,e.fill()}const R=t.age-t.lastAteTick;if(R<25&&t.lastAteTick>0){const P=Math.max(0,1-R/25),I=m.r*r*(1.8+t.ateAmount*.6)*P;e.beginPath(),e.arc(m.x,m.y,I,0,Math.PI*2),e.fillStyle=`hsla(120,90%,65%,${.18*P*s})`,e.fill();for(let $=0;$<Math.min(4,t.ateAmount*2);$++){const q=t.phase*8+$*1.57,L=I*(.5+P*.5),H=m.x+Math.cos(q)*L,G=m.y+Math.sin(q)*L;e.beginPath(),e.arc(H,G,.3*P,0,Math.PI*2),e.fillStyle=`hsla(100,100%,80%,${.5*P*s})`,e.fill()}}const j=m.r*r*1.8,T=m.x+Math.cos(v)*j*t.facingDir,_=m.y+Math.sin(v)*j*.3*t.facingDir;if(e.beginPath(),e.arc(T,_,b*.4,0,Math.PI*2),e.fillStyle=`hsla(${i},50%,70%,${.15*s*f})`,e.fill(),o){e.strokeStyle=`hsla(${i},80%,70%,${.4*s})`,e.lineWidth=r*.2,e.setLineDash([r*.5,r*.3]),e.beginPath();for(let P=0;P<l.length;P++){const I=l[P];P===0?e.moveTo(I.x,I.y):e.lineTo(I.x,I.y)}e.stroke(),e.setLineDash([])}e.restore()}function Yq(e,t,r,o,s,l,i,u,c,d){const h=t.length;if(h<2)return;const f=[],g=[];for(let k=0;k<h;k++){const R=t[k],j=t[Math.min(k+1,h-1)],T=t[Math.max(k-1,0)],P=Math.atan2(j.y-T.y,j.x-T.x)+Math.PI/2,I=1+Math.sin(d*2.2+k*.5)*.06,$=R.r*r*.9*I;f.push({x:R.x+Math.cos(P)*$,y:R.y+Math.sin(P)*$}),g.push({x:R.x-Math.cos(P)*$,y:R.y-Math.sin(P)*$})}e.beginPath(),e.moveTo(f[0].x,f[0].y);for(let k=1;k<f.length;k++){const R=f[k-1],j=f[k];e.quadraticCurveTo(R.x,R.y,(R.x+j.x)/2,(R.y+j.y)/2)}e.lineTo(f[h-1].x,f[h-1].y);const m=t[h-1];e.quadraticCurveTo(m.x+(f[h-1].x-m.x)*.3,m.y+1,g[h-1].x,g[h-1].y);for(let k=g.length-2;k>=0;k--){const R=g[k+1],j=g[k];e.quadraticCurveTo(R.x,R.y,(R.x+j.x)/2,(R.y+j.y)/2)}const y=t[0];e.quadraticCurveTo(y.x-(y.x-g[0].x)*.3,y.y-1,f[0].x,f[0].y),e.closePath();const v=e.createLinearGradient(t[0].x,t[0].y,t[h-1].x,t[h-1].y),b=18+s*22,S=50+s*25,C=u?.35:.75;v.addColorStop(0,`hsla(${o},${S}%,${b+12}%,${.85*l})`),v.addColorStop(.4,`hsla(${o},${S}%,${b}%,${.8*l})`),v.addColorStop(1,`hsla(${(o+20)%360},${S-10}%,${b-6}%,${C*l})`),i&&(e.shadowColor=`hsl(${o},90%,65%)`,e.shadowBlur=y.r*r*2.5*s),e.fillStyle=v,e.fill(),e.shadowBlur=0,e.strokeStyle=`hsla(${o},65%,${b+20}%,${.18*l})`,e.lineWidth=r*.12,e.stroke();for(let k=1;k<h-1;k+=2){const R=t[k],j=t[k-1],T=t[k+1],P=Math.atan2(T.y-j.y,T.x-j.x)+Math.PI/2,I=R.r*r*.5;e.beginPath(),e.moveTo(R.x+Math.cos(P)*I,R.y+Math.sin(P)*I),e.lineTo(R.x-Math.cos(P)*I,R.y-Math.sin(P)*I),e.strokeStyle=`hsla(${(o+40)%360},45%,${b+15}%,${.12*l})`,e.lineWidth=r*.08,e.stroke()}}function Kq(e,t,r,o){const{hue:s,species:l,appendageCount:i}=t.bp,u=t.segs,c=u.length;for(let d=0;d<i;d++){const h=Math.min(c-1,Math.floor((d+1)*c/(i+1))),f=u[h],g=u[Math.max(0,h-1)],m=u[Math.min(c-1,h+1)],v=Math.atan2(m.y-g.y,m.x-g.x)+Math.PI/2,b=f.r*r*(l==="spider"?3.5:l==="centipede"?2.2:l==="jellyfish"?3:l==="aerial"?4.5:1.8),S=Math.sin(t.phase*(l==="aerial"?9:3)+d*1.7)*.4,C=l==="jellyfish"?.3:l==="aerial"?-.5:-.2;for(const k of[-1,1]){const R=f.x+Math.cos(v)*f.r*r*.7*k,j=f.y+Math.sin(v)*f.r*r*.7*k,T=v*k+S+C,_=R+Math.cos(T)*b*.5,P=j+Math.sin(T)*b*.5,I=T+S*.6+(l==="jellyfish"?.5:l==="aerial"?-.8:-.3),$=_+Math.cos(I)*b*.5,q=P+Math.sin(I)*b*.5;e.beginPath(),e.moveTo(R,j),e.quadraticCurveTo(_,P,$,q);const L=l==="jellyfish"?.08:l==="spider"?.15:l==="aerial"?.3:.2;e.lineWidth=f.r*r*L,e.strokeStyle=`hsla(${s},45%,30%,${(l==="aerial"?.22:.5)*o})`,e.lineCap="round",e.stroke(),l==="aerial"&&(e.beginPath(),e.moveTo(R,j),e.lineTo($,q),e.lineTo(f.x,f.y),e.closePath(),e.fillStyle=`hsla(${s},55%,60%,${.09*o})`,e.fill()),(f.isGrip||l==="spider"||l==="centipede")&&(e.beginPath(),e.arc($,q,f.r*r*.15,0,Math.PI*2),e.fillStyle=`hsla(${(s+100)%360},60%,50%,${.4*o})`,e.fill())}}}const xS=[{id:"attract",label:"Attract",icon:"",color:"#ff88ff",desc:"Pull all creatures toward cursor"},{id:"repel",label:"Repel",icon:"",color:"#88ffcc",desc:"Push all creatures away"},{id:"feed",label:"Feed",icon:"",color:"#44ff88",desc:"Spawn food at cursor area"},{id:"shockwave",label:"Shockwave",icon:"",color:"#ffaa44",desc:"Explosive force push on creatures"},{id:"heal",label:"Heal",icon:"",color:"#88ff88",desc:"Restore energy to nearby creatures"},{id:"fire_rain",label:"Fire Rain",icon:"",color:"#ff5500",desc:"Rain fire from above at cursor"},{id:"freeze_wave",label:"Freeze Wave",icon:"",color:"#88ccff",desc:"Freeze water and cool area"},{id:"speed_boost",label:"Speed Boost",icon:"",color:"#ffff44",desc:"Temporarily boost creature speed"}],yR=[{id:"bomb",label:"Bomb",icon:"",cat:"explosive",desc:"Explodes on contact with fire",color:"#ff6622"},{id:"c4",label:"C4",icon:"",cat:"explosive",desc:"Timed explosion, massive radius",color:"#ff4444"},{id:"nuke",label:"Nuke",icon:"",cat:"explosive",desc:"Devastating chain reaction",color:"#ffcc00"},{id:"fan",label:"Fan",icon:"",cat:"force",desc:"Pushes particles & creatures",color:"#66ccff"},{id:"attractor",label:"Attractor",icon:"",cat:"force",desc:"Pulls everything nearby",color:"#ff88ff"},{id:"repulsor",label:"Repulsor",icon:"",cat:"force",desc:"Pushes everything away",color:"#88ffcc"},{id:"vortex",label:"Vortex",icon:"",cat:"force",desc:"Swirling force field",color:"#4488ff"},{id:"heater",label:"Heater",icon:"",cat:"thermal",desc:"Melts ice, boils water",color:"#ff8844"},{id:"cooler",label:"Cooler",icon:"",cat:"thermal",desc:"Freezes water, cools lava",color:"#88ccff"},{id:"lightning",label:"Lightning",icon:"",cat:"energy",desc:"Electric bolt, ignites & destroys",color:"#ffff44"},{id:"laser",label:"Laser",icon:"",cat:"energy",desc:"Focused beam cuts through matter",color:"#ff2222"},{id:"virus",label:"Virus",icon:"",cat:"bio",desc:"Spreads and consumes organic matter",color:"#88ff44"},{id:"spore",label:"Spore Cloud",icon:"",cat:"bio",desc:"Disperses spores that grow",color:"#aa88ff"},{id:"wheel",label:"Wheel",icon:"",cat:"mech",desc:"Rolling physics body",color:"#aabbcc"},{id:"ball",label:"Ball",icon:"",cat:"mech",desc:"Bouncy physics sphere",color:"#ff88aa"},{id:"box",label:"Box",icon:"",cat:"mech",desc:"Heavy physics block",color:"#88aaff"},{id:"spring",label:"Spring",icon:"",cat:"mech",desc:"Bouncy spring launcher",color:"#44ff88"},{id:"motor",label:"Motor",icon:"",cat:"mech",desc:"Spinning motor with torque",color:"#ffaa44"},{id:"blackhole",label:"Black Hole",icon:"",cat:"cosmic",desc:"Devours everything nearby",color:"#440066"},{id:"whitehole",label:"White Hole",icon:"",cat:"cosmic",desc:"Spawns random matter",color:"#ffffff"},{id:"portal_in",label:"Portal In",icon:"",cat:"cosmic",desc:"Teleports matter to portal out",color:"#ff44ff"},{id:"portal_out",label:"Portal Out",icon:"",cat:"cosmic",desc:"Receives teleported matter",color:"#44ffff"}],Xq=[{id:"explosive",label:"Explosives",color:"#ff6622"},{id:"force",label:"Forces",color:"#66ccff"},{id:"thermal",label:"Thermal",color:"#ff8844"},{id:"energy",label:"Energy",color:"#ffff44"},{id:"bio",label:"Biological",color:"#88ff44"},{id:"mech",label:"Mechanical",color:"#aabbcc"},{id:"cosmic",label:"Cosmic",color:"#aa44ff"}],Cy=[{id:"tree",label:"Oak Tree",icon:"",color:"#228833",desc:"Grows tall, branches wide, drops fruit"},{id:"vine",label:"Ivy Vine",icon:"",color:"#33aa44",desc:"Invasive creeper, never stops growing"},{id:"coral",label:"Coral",icon:"",color:"#ff6688",desc:"Underwater only  needs water to grow"},{id:"mushroom",label:"Mushroom",icon:"",color:"#aa66cc",desc:"Fungi, spreads spores, grows in dark"},{id:"fern",label:"Fern",icon:"",color:"#44cc55",desc:"Fractal fronds, photosynthesizes fast"},{id:"cactus",label:"Cactus",icon:"",color:"#55aa44",desc:"Desert plant, slow growth, stores water"},{id:"kelp",label:"Giant Kelp",icon:"",color:"#228866",desc:"Aquatic, grows very tall in water"},{id:"bamboo",label:"Bamboo",icon:"",color:"#33cc33",desc:"Grows extremely fast, straight up"},{id:"moss",label:"Moss",icon:"",color:"#448833",desc:"Spreads on surfaces, needs moisture"},{id:"sunflower",label:"Sunflower",icon:"",color:"#ddaa22",desc:"Tall flower, produces seeds (food)"},{id:"lily",label:"Water Lily",icon:"",color:"#ff88bb",desc:"Floats on water, blooms flowers"},{id:"mangrove",label:"Mangrove",icon:"",color:"#337744",desc:"Roots in water/land boundary"},{id:"orchid",label:"Orchid",icon:"",color:"#cc44aa",desc:"Rare bloom, needs specific conditions"},{id:"pitcher",label:"Pitcher Plant",icon:"",color:"#44aa66",desc:"Carnivorous! Traps small creatures"},{id:"bonsai",label:"Bonsai",icon:"",color:"#557733",desc:"Compact tree, slow but elegant growth"}],My=[{id:"trim",label:"Trim",icon:"",color:"#ff8866",desc:"Cut back overgrown plants"},{id:"water",label:"Water",icon:"",color:"#4488ff",desc:"Water plants to boost growth"},{id:"fertilize",label:"Fertilize",icon:"",color:"#88cc44",desc:"Boost growth rate dramatically"},{id:"harvest",label:"Harvest",icon:"",color:"#ddaa44",desc:"Collect fruit/seeds from plants"}],Bl=({label:e,val:t,min:r,max:o,step:s,fmt:l,color:i="#88aaff",onChange:u})=>{const c=((t-r)/(o-r)*100).toFixed(0)+"%";return a.jsxs("div",{className:"flex flex-col gap-0.5",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-[6px] font-mono uppercase tracking-widest",style:{color:i+"70"},children:e}),a.jsx("span",{className:"text-[6.5px] font-mono",style:{color:i+"bb"},children:l?l(t):t})]}),a.jsx("input",{type:"range",min:r,max:o,step:s,value:t,onChange:d=>u(+d.target.value),className:"w-full h-[2px] appearance-none cursor-pointer rounded-full",style:{background:`linear-gradient(90deg,${i}55 ${c},rgba(255,255,255,.06) ${c})`}})]})},Zq=({active:e,color:t="#88aaff",onClick:r,children:o,title:s,size:l="sm"})=>a.jsx("button",{onClick:r,title:s,className:`flex items-center justify-center gap-0.5 rounded transition-all border
      ${l==="sm"?"px-1.5 py-0.5 text-[6.5px]":"px-2 py-1 text-[7px]"} font-mono uppercase tracking-widest
      ${e?"border-current/30 bg-current/8":"border-white/[0.06] text-white/30 hover:text-white/55 hover:bg-white/[0.04]"}`,style:e?{color:t,borderColor:t+"40",background:t+"10"}:{},children:o}),bS=({label:e,open:t,onToggle:r,color:o="#88aaff",count:s})=>a.jsxs("button",{onClick:r,className:"flex items-center w-full px-2 py-1.5 gap-1 hover:bg-white/[0.03] transition-all",children:[t?a.jsx(Pa,{size:7,className:"text-white/25"}):a.jsx(aa,{size:7,className:"text-white/25"}),a.jsx("span",{className:"text-[6px] font-mono uppercase tracking-widest",style:{color:o+"70"},children:e}),s!=null&&a.jsx("span",{className:"ml-auto text-[5.5px] font-mono px-1 rounded-full",style:{color:o+"50",background:o+"0c"},children:s})]}),Jq=({active:e})=>{const t=w.useRef(null),r=w.useRef(0),o=w.useRef(0),s=w.useRef(new kq),l=w.useRef(null),i=w.useRef(null),u=w.useRef([]),c=w.useRef(null),d=w.useRef([]),h=w.useRef([]),f=w.useRef([]),g=w.useRef({scale:1,panX:0,panY:0}),m=w.useRef(!1),y=w.useRef({mx:0,my:0,px:0,py:0}),v=w.useRef(1),b=w.useRef(!1),S=w.useRef({x:0,y:0}),C=w.useRef({x:0,y:0}),k=w.useRef(V.SAND),R=w.useRef(4),j=w.useRef(!0),T=w.useRef(1),_=w.useRef("inspect"),P=w.useRef("bomb"),I=w.useRef("terrarium"),$=w.useRef(Ic[0]),q=w.useRef("survive"),L=w.useRef(null),H=w.useRef(null),G=w.useRef(!1),oe=w.useRef(1),le=w.useRef(0),pe=w.useRef(.5),ce=w.useRef(.99),[te,F]=w.useState(!0),[Q,ae]=w.useState("terrarium"),[we,Re]=w.useState(1),[ge,Ae]=w.useState(V.SAND),[tt,We]=w.useState(4),[J,ke]=w.useState(!0),[Le,K]=w.useState("elements"),[et,dt]=w.useState("inspect"),[Rt,Wt]=w.useState("bomb"),[Zt,$e]=w.useState(Ic[0]),[Ze,Fe]=w.useState("survive"),[Xe,jt]=w.useState(12),[hn,an]=w.useState(null),[it,kt]=w.useState([]),[On,sn]=w.useState({food:0,water:0,creatures:0,plants:0,objects:0}),[Xn,Pt]=w.useState(!1),[zt,jn]=w.useState(1),[En,lt]=w.useState(1),[ht,_t]=w.useState(0),[Ie,at]=w.useState(.5),[St,ye]=w.useState(.99),[xe,gt]=w.useState("tree"),Ge=w.useRef("tree"),[Ye,Ve]=w.useState("circle"),Oe=w.useRef("circle"),[Gt,Kt]=w.useState("attract"),fn=w.useRef("attract"),[zn,rt]=w.useState("water"),mt=w.useRef("water"),[yt,Et]=w.useState(.6),Ft=w.useRef(.6),[me,cn]=w.useState(.7),Xt=w.useRef(.7),[Dt,ne]=w.useState(.35),Ne=w.useRef(.35),Ke=w.useRef([]),[Ct,ft]=w.useState(30),At=w.useRef(30),[bt,nn]=w.useState(null),Bt=w.useRef(null),[Jt,Qt]=w.useState(!1),en=w.useRef(!1),vn=w.useRef([]),Wn=w.useRef([]),[Gn,cr]=w.useState({fluid:!0,powder:!1,solid:!1,gas:!1,bio:!0,tool:!1,explosive:!0,force:!0,thermal:!1,energy:!1,bio_obj:!1,mech:!1,cosmic:!1}),pr=W=>cr(X=>({...X,[W]:!X[W]}));w.useEffect(()=>{j.current=te},[te]),w.useEffect(()=>{k.current=ge},[ge]),w.useEffect(()=>{R.current=tt},[tt]),w.useEffect(()=>{T.current=we},[we]),w.useEffect(()=>{I.current=Q},[Q]),w.useEffect(()=>{$.current=Zt},[Zt]),w.useEffect(()=>{q.current=Ze},[Ze]),w.useEffect(()=>{_.current=et},[et]),w.useEffect(()=>{P.current=Rt},[Rt]),w.useEffect(()=>{Ge.current=xe},[xe]),w.useEffect(()=>{Oe.current=Ye},[Ye]),w.useEffect(()=>{fn.current=Gt},[Gt]),w.useEffect(()=>{mt.current=zn},[zn]),w.useEffect(()=>{Ft.current=yt,s.current.fluidPressure=yt},[yt]),w.useEffect(()=>{Xt.current=me},[me]),w.useEffect(()=>{Ne.current=Dt},[Dt]),w.useEffect(()=>{en.current=Jt},[Jt]),w.useEffect(()=>{At.current=Ct},[Ct]),w.useEffect(()=>{oe.current=En},[En]),w.useEffect(()=>{le.current=ht},[ht]),w.useEffect(()=>{pe.current=Ie},[Ie]),w.useEffect(()=>{ce.current=St},[St]);const br=w.useCallback((W,X,Te,He)=>{const he=s.current,fe=Oe.current,be=Math.ceil(Te);switch(fe){case"circle":he.paint(W|0,X|0,Te,He);break;case"square":for(let Ee=-be;Ee<=be;Ee++)for(let Me=-be;Me<=be;Me++)Math.random()<.9&&he.set(W+Me|0,X+Ee|0,He);break;case"spray":for(let Ee=0;Ee<be*3;Ee++){const Me=Math.random()*Math.PI*2,_e=Math.random()*Te*1.5;he.set(W+Math.cos(Me)*_e|0,X+Math.sin(Me)*_e|0,He)}break;case"hline":for(let Ee=-be*2;Ee<=be*2;Ee++)for(let Me=-1;Me<=1;Me++)Math.random()<.85&&he.set(W+Ee|0,X+Me|0,He);break;case"vline":for(let Ee=-be*2;Ee<=be*2;Ee++)for(let Me=-1;Me<=1;Me++)Math.random()<.85&&he.set(W+Me|0,X+Ee|0,He);break}},[]),hr=w.useCallback((W,X)=>{const Te=fn.current,He=u.current,he=s.current;switch(Te){case"attract":for(const fe of He){const be=W-fe.segs[0].x,Ee=X-fe.segs[0].y,Me=Math.sqrt(be*be+Ee*Ee)+1;if(Me<80){const _e=3.5/(Me*.04+1);for(const Je of fe.segs)Je.vx+=be/Me*_e,Je.vy+=Ee/Me*_e}}break;case"repel":for(const fe of He){const be=fe.segs[0].x-W,Ee=fe.segs[0].y-X,Me=Math.sqrt(be*be+Ee*Ee)+1;if(Me<80){const _e=4.5/(Me*.04+1);for(const Je of fe.segs)Je.vx+=be/Me*_e,Je.vy+=Ee/Me*_e}}break;case"feed":for(let fe=0;fe<25;fe++){const be=W+(Math.random()-.5)*24|0,Ee=X+(Math.random()-.5)*18|0;he.get(be,Ee)===V.EMPTY&&he.set(be,Ee,V.FOOD)}break;case"shockwave":for(const fe of He){const be=fe.segs[0].x-W,Ee=fe.segs[0].y-X,Me=Math.sqrt(be*be+Ee*Ee)+1;if(Me<60){const _e=12/(Me*.06+1);for(const Je of fe.segs)Je.vx+=be/Me*_e,Je.vy+=(Ee/Me-.5)*_e}}break;case"heal":for(const fe of He){const be=fe.segs[0].x-W,Ee=fe.segs[0].y-X;be*be+Ee*Ee<1600&&(fe.energy=Math.min(200,fe.energy+8))}break;case"fire_rain":for(let fe=0;fe<15;fe++){const be=W+(Math.random()-.5)*30|0,Ee=Math.max(2,X-10-Math.random()*30|0);he.set(be,Ee,V.FIRE)}break;case"freeze_wave":for(let fe=-14;fe<=14;fe++)for(let be=-14;be<=14;be++){if(be*be+fe*fe>196)continue;const Ee=W+be|0,Me=X+fe|0,_e=he.get(Ee,Me);_e===V.WATER&&Math.random()<.35&&he.set(Ee,Me,V.ICE),_e===V.FIRE&&Math.random()<.6&&he.set(Ee,Me,V.EMPTY),_e===V.MAGMA&&Math.random()<.3&&he.set(Ee,Me,V.WALL)}break;case"speed_boost":for(const fe of He){const be=fe.segs[0].x-W,Ee=fe.segs[0].y-X;if(be*be+Ee*Ee<1600)for(const Me of fe.segs)Me.vx+=fe.facingDir*2.5}break}},[]),or=w.useCallback(W=>{g.current=W,jn(+W.scale.toFixed(2))},[]),uo=w.useCallback((W,X,Te)=>{const He=Math.min(X/Er,Te/kr);v.current=He;const{scale:he,panX:fe,panY:be}=g.current,Ee=(X-He*Er)/2,Me=(Te-He*kr)/2;W.setTransform(He*he,0,0,He*he,Ee+fe,Me+be)},[]),fr=w.useCallback((W,X,Te)=>{const He=W.width,he=W.height,fe=v.current||Math.min(He/Er,he/kr),{scale:be,panX:Ee,panY:Me}=g.current,_e=(He-fe*Er)/2,Je=(he-fe*kr)/2;return{x:(X-_e-Ee)/(fe*be),y:(Te-Je-Me)/(fe*be)}},[]),Tr=w.useCallback(W=>{var X;Pq(W,s.current),ae(W),u.current=[],h.current=[],f.current=[],s.current.spawnFood(20),o.current=0,(X=c.current)==null||X.stop(),c.current=null,an(null)},[]),Ir=w.useCallback(W=>{const X=s.current,Te=W??$.current,He=15+Math.random()*(Er-30);let he=kr*.5;for(let be=5;be<kr-5;be++)if(X.isSolid(He|0,be)){he=be-4;break}he=Math.max(5,Math.min(kr-15,he));const fe=Pd(Te,He,he);u.current.push(fe)},[]),jo=w.useCallback((W,X,Te)=>{const He=s.current,he=Te??$.current;let fe=X|0;for(let be=X|0;be<kr-5;be++)if(He.isSolid(W|0,be)){fe=be-6;break}u.current.push(Pd(he,W,fe))},[]),bo=w.useCallback((W,X,Te)=>{const He={id:`obj-${Date.now()}-${Math.random().toString(36).slice(2,6)}`,type:W,x:X,y:Te,vx:0,vy:0,angle:0,omega:0,radius:W==="nuke"?18:W==="c4"?12:W==="blackhole"?15:8,strength:1,life:0,maxLife:W==="c4"?180:W==="lightning"?15:W==="laser"?60:-1,active:!0};h.current.push(He)},[]),vo=w.useCallback((W,X,Te)=>{const He={tree:"#228833",vine:"#33aa44",coral:"#ff6688",mushroom:"#aa66cc",fern:"#44cc55",cactus:"#55aa44",kelp:"#228866",bamboo:"#33cc33",moss:"#448833",sunflower:"#ddaa22",lily:"#ff88bb",mangrove:"#337744",orchid:"#cc44aa",pitcher:"#44aa66",bonsai:"#557733"};let he=Te|0;for(let be=Te|0;be<kr-1;be++)if(s.current.isSolid(X|0,be)){he=be-1;break}const fe={id:`plant-${Date.now()}-${Math.random().toString(36).slice(2,6)}`,root:{x:X,y:he,vx:0,vy:0,restDx:0,restDy:0,age:0,thickness:4,children:[],angle:-Math.PI/2,alive:!0},species:W,color:He[W]??"#228833",growthRate:.28+Math.random()*.2,age:0};xR(fe.root,W,s.current,0),f.current.push(fe)},[]);w.useCallback(()=>{u.current=[];const W=s.current,X=pd.find(fe=>fe.id===I.current)??pd[0];let Te=X.spawnX,He=wy(W,X.spawnX,X.spawnY);for(const fe of[X.spawnX,Er*.25,Er*.5]){const be=wy(W,fe,X.spawnY);if(be>5&&be<kr-15){Te=fe,He=be;break}}W.spawnFood(20);const he=new Bq($.current,W,Te,He,q.current);he.start(Xe,4),c.current=he,an(he.getStats())},[Xe]),w.useCallback(()=>{var W;(W=c.current)==null||W.stop(),an(null)},[]),w.useCallback(()=>{var X;const W=(X=c.current)==null?void 0:X.spawnChampion();W&&u.current.push(W)},[]),w.useCallback(()=>{const W=c.current;if(!W||!W.bestParams)return;const X=Wq($.current,W.bestParams,W.bestScore,W.generation);d.current=[X,...d.current].slice(0,20),kt([...d.current])},[]);const Zo=w.useCallback((W,X)=>{const Te=h.current,He=oe.current,he=[];for(const fe of Te){if(!fe.active){he.push(fe.id);continue}if(fe.life++,["ball","box","wheel","bomb","c4","nuke"].includes(fe.type)){const be=fe.type==="box"?1.8:fe.type==="nuke"?2.5:fe.type==="bomb"||fe.type==="c4"?1.3:fe.type==="wheel"?1.1:.7,Ee=fe.x|0,Me=fe.y|0,_e=W.get(Ee,Me),Je=Sy(_e),Vt=Xt.current;if(Je&&Vt>.01){const rn=dR[_e],pn=rn?rn.density:1,re=rn?rn.viscosity:.3,de=(pn-be)*.12*Vt*He;fe.vy+=de,fe.vy+=.15*He*.3;const Se=1-re*.15*Vt;fe.vx*=Se,fe.vy*=Se;const qe=Ft.current;if(qe>.1){const st=Sy(W.get(Ee-3,Me))?1:0,$t=Sy(W.get(Ee+3,Me))?1:0;fe.vx+=($t-st)*.02*qe}}else fe.vy+=.15*He,fe.vx*=.995,fe.vy*=.995;fe.x+=fe.vx,fe.y+=fe.vy,fe.y>kr-4&&(fe.y=kr-4,fe.vy*=-.4,fe.vx*=.9),fe.x<2&&(fe.x=2,fe.vx*=-.5),fe.x>Er-2&&(fe.x=Er-2,fe.vx*=-.5),W.isSolid(fe.x|0,fe.y+2|0)&&(fe.vy*=-.3,fe.y-=1)}switch(fe.type){case"bomb":fe.life>120&&Math.abs(fe.vy)<.1&&(W.paint(fe.x|0,fe.y|0,8,V.FIRE,.7),W.paint(fe.x|0,fe.y|0,4,V.EMPTY,1),fe.active=!1);break;case"c4":fe.life>=fe.maxLife&&(W.paint(fe.x|0,fe.y|0,14,V.FIRE,.8),W.paint(fe.x|0,fe.y|0,8,V.EMPTY,1),fe.active=!1);break;case"nuke":if(fe.life>=90){for(let be=0;be<22;be+=3)W.paint(fe.x|0,fe.y|0,be,V.FIRE,.6);W.paint(fe.x|0,fe.y|0,12,V.EMPTY,1);for(const be of X){const Ee=be.segs[0].x-fe.x,Me=be.segs[0].y-fe.y;Ee*Ee+Me*Me<400&&(be.energy-=100)}fe.active=!1}break;case"fan":for(const be of X){const Ee=be.segs[0].x-fe.x,Me=be.segs[0].y-fe.y,_e=Math.sqrt(Ee*Ee+Me*Me);if(_e<20){const Je=.3*(1-_e/20);for(const Vt of be.segs)Vt.vx+=Math.cos(fe.angle)*Je,Vt.vy+=Math.sin(fe.angle)*Je}}if(fe.life%3===0){const be=fe.x|0,Ee=fe.y|0;for(let Me=-8;Me<=8;Me++)for(let _e=-8;_e<=8;_e++){const Je=be+_e,Vt=Ee+Me;if(_e*_e+Me*Me>64)continue;const rn=W.get(Je,Vt);if(rn!==V.EMPTY&&rn!==V.WALL&&rn!==V.METAL){const pn=Je+Math.round(Math.cos(fe.angle)*2),re=Vt+Math.round(Math.sin(fe.angle)*2);W.get(pn,re)===V.EMPTY&&(W.set(pn,re,rn),W.set(Je,Vt,V.EMPTY))}}}break;case"attractor":for(const be of X){const Ee=fe.x-be.segs[0].x,Me=fe.y-be.segs[0].y,_e=Math.sqrt(Ee*Ee+Me*Me)+1;if(_e<25){const Je=.08/(_e*.15+1);for(const Vt of be.segs)Vt.vx+=Ee/_e*Je,Vt.vy+=Me/_e*Je}}break;case"repulsor":for(const be of X){const Ee=be.segs[0].x-fe.x,Me=be.segs[0].y-fe.y,_e=Math.sqrt(Ee*Ee+Me*Me)+1;if(_e<25){const Je=.12/(_e*.15+1);for(const Vt of be.segs)Vt.vx+=Ee/_e*Je,Vt.vy+=Me/_e*Je}}break;case"heater":if(fe.life%5===0){const be=fe.x|0,Ee=fe.y|0;for(let Me=-6;Me<=6;Me++)for(let _e=-6;_e<=6;_e++){if(_e*_e+Me*Me>36)continue;const Je=W.get(be+_e,Ee+Me);Je===V.ICE&&Math.random()<.1&&W.set(be+_e,Ee+Me,V.WATER),Je===V.WATER&&Math.random()<.05&&W.set(be+_e,Ee+Me,V.STEAM),Je===V.SNOW&&Math.random()<.15&&W.set(be+_e,Ee+Me,V.WATER)}}break;case"cooler":if(fe.life%5===0){const be=fe.x|0,Ee=fe.y|0;for(let Me=-6;Me<=6;Me++)for(let _e=-6;_e<=6;_e++){if(_e*_e+Me*Me>36)continue;const Je=W.get(be+_e,Ee+Me);Je===V.WATER&&Math.random()<.08&&W.set(be+_e,Ee+Me,V.ICE),Je===V.MAGMA&&Math.random()<.1&&W.set(be+_e,Ee+Me,V.WALL),Je===V.FIRE&&Math.random()<.2&&W.set(be+_e,Ee+Me,V.EMPTY),Je===V.STEAM&&Math.random()<.15&&W.set(be+_e,Ee+Me,V.WATER)}}break;case"lightning":if(fe.life<15){const be=fe.x|0,Ee=fe.y|0;for(let Me=Ee;Me<Math.min(kr-2,Ee+40);Me++){const _e=Math.round((Math.random()-.5)*3),Je=W.get(be+_e,Me);if(Je===V.WALL||Je===V.METAL)break;W.set(be+_e,Me,V.FIRE)}}fe.life>=15&&(fe.active=!1);break;case"virus":if(fe.life%8===0){const be=fe.x|0,Ee=fe.y|0;for(let Me=-3;Me<=3;Me++)for(let _e=-3;_e<=3;_e++){const Je=W.get(be+_e,Ee+Me);(Je===V.WOOD||Je===V.VINE||Je===V.FOOD)&&Math.random()<.15&&W.set(be+_e,Ee+Me,V.EMPTY)}fe.x+=(Math.random()-.5)*2,fe.y+=(Math.random()-.5)*2}fe.life>600&&(fe.active=!1);break;case"blackhole":if(fe.life%2===0){const be=fe.x|0,Ee=fe.y|0;for(let Me=-12;Me<=12;Me++)for(let _e=-12;_e<=12;_e++){const Je=Math.sqrt(_e*_e+Me*Me);if(Je>12||Je<1)continue;const Vt=W.get(be+_e,Ee+Me);Vt!==V.EMPTY&&Vt!==V.WALL&&Math.random()<.08/Je&&W.set(be+_e,Ee+Me,V.EMPTY)}}for(const be of X){const Ee=fe.x-be.segs[0].x,Me=fe.y-be.segs[0].y,_e=Math.sqrt(Ee*Ee+Me*Me)+1;if(_e<18){const Je=.2/(_e*.1+1);for(const Vt of be.segs)Vt.vx+=Ee/_e*Je,Vt.vy+=Me/_e*Je;_e<3&&(be.energy-=2)}}break;case"whitehole":if(fe.life%10===0){const be=[V.WATER,V.SAND,V.FOOD,V.OIL,V.SNOW],Ee=be[Math.floor(Math.random()*be.length)],Me=Math.random()*Math.PI*2,_e=3+Math.random()*4;W.set(fe.x+Math.cos(Me)*_e|0,fe.y+Math.sin(Me)*_e|0,Ee)}break;case"spring":for(const be of X){const Ee=be.segs[0].x-fe.x,Me=be.segs[0].y-fe.y;if(Math.sqrt(Ee*Ee+Me*Me)<5)for(const Je of be.segs)Je.vy-=2.5}break;case"vortex":{const be=fe.x|0,Ee=fe.y|0;for(const Me of X){const _e=Me.segs[0].x-fe.x,Je=Me.segs[0].y-fe.y,Vt=Math.sqrt(_e*_e+Je*Je)+1;if(Vt<22){const rn=.1/(Vt*.12+1);for(const pn of Me.segs)pn.vx+=-Je/Vt*rn,pn.vy+=_e/Vt*rn,pn.vx+=(fe.x-pn.x)*.002,pn.vy+=(fe.y-pn.y)*.002}}if(fe.life%3===0)for(let Me=-10;Me<=10;Me++)for(let _e=-10;_e<=10;_e++){const Je=_e*_e+Me*Me;if(Je>100||Je<4)continue;const Vt=be+_e,rn=Ee+Me,pn=W.get(Vt,rn);if(pn!==V.EMPTY&&pn!==V.WALL&&pn!==V.METAL){const re=Math.sqrt(Je),de=-Me/re,Se=_e/re,qe=Vt+Math.round(de*1.5),st=rn+Math.round(Se*1.5);W.get(qe,st)===V.EMPTY&&(W.set(qe,st,pn),W.set(Vt,rn,V.EMPTY))}}break}case"motor":{fe.angle+=.08;for(const be of X){const Ee=be.segs[0].x-fe.x,Me=be.segs[0].y-fe.y,_e=Math.sqrt(Ee*Ee+Me*Me);if(_e<8&&_e>1){const Je=-Me/_e,Vt=Ee/_e;for(const rn of be.segs)rn.vx+=Je*.15,rn.vy+=Vt*.15}}break}case"laser":{if(fe.life<(fe.maxLife>0?fe.maxLife:60)){const be=fe.x|0;for(let Ee=0;Ee<50;Ee++){const Me=(fe.y|0)+Ee;if(Me>=kr-1)break;const _e=W.get(be,Me);if(_e===V.WALL&&Math.random()<.3)break;_e!==V.EMPTY&&_e!==V.METAL&&(Math.random()<.4?W.set(be,Me,V.FIRE):W.set(be,Me,V.EMPTY))}for(const Ee of X){const Me=Ee.segs[0];Math.abs(Me.x-fe.x)<2&&Me.y>fe.y&&Me.y<fe.y+50&&(Ee.energy-=.8)}}fe.life>=(fe.maxLife>0?fe.maxLife:60)&&(fe.active=!1);break}case"spore":{if(fe.life%15===0&&fe.life<300)for(let be=0;be<3;be++){const Ee=Math.random()*Math.PI*2,Me=3+Math.random()*6,_e=fe.x+Math.cos(Ee)*Me|0,Je=fe.y+Math.sin(Ee)*Me|0;W.get(_e,Je)===V.EMPTY&&W.set(_e,Je,Math.random()<.3?V.VINE:V.SEED)}fe.x+=(Math.random()-.5)*.5,fe.y-=.1,fe.life>300&&(fe.active=!1);break}case"portal_in":{const be=Te.find(Ee=>Ee.type==="portal_out"&&Ee.active);if(be){if(fe.life%4===0){const Ee=fe.x|0,Me=fe.y|0;for(let _e=-4;_e<=4;_e++)for(let Je=-4;Je<=4;Je++){if(Je*Je+_e*_e>16)continue;const Vt=Ee+Je,rn=Me+_e,pn=W.get(Vt,rn);if(pn!==V.EMPTY&&pn!==V.WALL&&pn!==V.METAL&&Math.random()<.2){const re=be.x+Je|0,de=be.y+_e|0;W.get(re,de)===V.EMPTY&&(W.set(re,de,pn),W.set(Vt,rn,V.EMPTY))}}}for(const Ee of X){const Me=Ee.segs[0].x-fe.x,_e=Ee.segs[0].y-fe.y;if(Me*Me+_e*_e<16){const Je=be.x-fe.x,Vt=be.y-fe.y;for(const rn of Ee.segs)rn.x+=Je,rn.y+=Vt}}}break}}}h.current=Te.filter(fe=>fe.active)},[]),Jo=w.useCallback(W=>{for(const X of f.current){X.age++;const Te=1/(1+X.age*5e-4),He=X.growthRate*Te;Math.random()<He&&bR(X.root,X,W,0),vR(X.root,X,null,le.current,oe.current)}},[]);w.useEffect(()=>{if(!e){cancelAnimationFrame(r.current);return}l.current||(l.current=document.createElement("canvas"),l.current.width=Er,l.current.height=kr);const W=l.current,X=W.getContext("2d");i.current=X.createImageData(Er,kr),Tr("terrarium");const Te=()=>{var Vt,rn,pn,re;r.current=requestAnimationFrame(Te);const He=t.current;if(!He)return;const he=He.getContext("2d");if(!he)return;(He.width<10||He.height<10)&&(He.width=He.offsetWidth||900,He.height=He.offsetHeight||600);const fe=He.width,be=He.height,Ee=o.current;if(he.clearRect(0,0,fe,be),b.current){const{x:de,y:Se}=S.current,qe=_.current;if(qe==="paint")br(de,Se,R.current,k.current);else if(qe==="erase")br(de,Se,R.current,V.EMPTY);else if(qe==="power")hr(de,Se);else if((qe==="grab"||qe==="inspect")&&L.current){const $t=L.current.segs[0],Tt=$t.x,Ut=$t.y,ln=.28;$t.x+=(de-$t.x)*ln,$t.y+=(Se-$t.y)*ln,$t.vx=($t.x-Tt)*.6,$t.vy=($t.y-Ut)*.6}if(H.current){const st=H.current;st.vx+=(de-st.x)*.35,st.vy+=(Se-st.y)*.35}}if(j.current){const de=T.current;for(let wt=0;wt<de;wt++)s.current.update(Ee+wt);o.current+=de;const Se=le.current;if(Math.abs(Se)>.01&&Ee%3===0)for(let wt=0;wt<kr;wt++)for(let mn=0;mn<Er;mn++){const un=s.current.get(mn,wt);if((un===V.STEAM||un===V.GAS||un===V.FIRE)&&Math.random()<Math.abs(Se)*.1){const $n=mn+(Se>0?1:-1);s.current.get($n,wt)===V.EMPTY&&(s.current.set($n,wt,un),s.current.set(mn,wt,V.EMPTY))}}const qe=pe.current;if(Ee%8===0&&Math.abs(qe-.5)>.05){const wt=s.current,mn=Math.max(0,(qe-.5)*.04),un=Math.max(0,(.5-qe)*.04),$n=5;for(let It=1;It<kr-1;It+=$n)for(let dn=1;dn<Er-1;dn+=$n){const gn=dn+(Math.random()*$n|0),Sn=It+(Math.random()*$n|0);if(gn>=Er-1||Sn>=kr-1)continue;const nr=wt.get(gn,Sn);mn>0&&(nr===V.ICE&&Math.random()<mn&&wt.set(gn,Sn,V.WATER),nr===V.SNOW&&Math.random()<mn*1.5&&wt.set(gn,Sn,V.WATER),nr===V.WATER&&Math.random()<mn*.3&&wt.set(gn,Sn,V.STEAM)),un>0&&(nr===V.WATER&&Math.random()<un&&wt.set(gn,Sn,V.ICE),nr===V.STEAM&&Math.random()<un*1.5&&wt.set(gn,Sn,V.WATER),nr===V.MAGMA&&Math.random()<un*.5&&wt.set(gn,Sn,V.WALL))}}if(Ee%3===0&&s.current.diffuseHeat(Ne.current),Math.abs(qe-.5)>.05){const wt=Math.abs(qe-.5)*.12;for(const mn of u.current)if(mn.alive)for(const un of mn.segs)un.vx+=(Math.random()-.5)*wt,un.vy+=(Math.random()-.5)*wt*.6}const st=u.current,$t=.1*oe.current,Tt=ce.current;for(const wt of st){if(!wt.alive)continue;const mn=pR(wt.policyParams,wt);if(gR(wt,mn,s.current,$t),Math.abs(Se)>.01)for(const un of wt.segs)un.vx+=Se*.025;if(Tt<.998)for(const un of wt.segs)un.vx*=Tt,un.vy*=Tt}Gq(st),Dq(st),Ee%3===0&&Hq(st);for(const wt of st)wt.alive&&wt.age>wt.maxAge&&(wt.energy=-1,wt.alive=!1);if(Ee%30===0&&st.length<At.current){const wt=[];for(const mn of st){if(!mn.alive)continue;const un=Lq(mn);un&&st.length+wt.length<At.current&&wt.push(un)}for(const mn of wt)u.current.push(mn),Wn.current.push({x:mn.segs[0].x,y:mn.segs[0].y,hue:mn.bp.hue,age:0})}for(const wt of st)if(!wt.alive&&wt.energy<=0){const mn=wt.segs[0],un=s.current,$n=Math.min(8,Math.floor(wt.segs.length*1.2));for(let It=0;It<$n;It++){const dn=(Math.random()-.5)*12,gn=(Math.random()-.5)*8,Sn=mn.x+dn|0,nr=mn.y+gn|0;un.get(Sn,nr)===V.EMPTY&&un.set(Sn,nr,Math.random()<.7?V.FOOD:V.SEED)}for(const It of wt.segs)vn.current.push({x:It.x,y:It.y,hue:wt.bp.hue,age:0,r:It.r*2.5});Ke.current.push({creature:wt,deathAge:0})}u.current=st.filter(wt=>wt.alive);const Ut=.1*oe.current;Ke.current=Ke.current.filter(wt=>(wt.deathAge++,wt.deathAge>300?!1:(Vq(wt.creature,s.current,Ut),!0))),vn.current=vn.current.map(wt=>({...wt,age:wt.age+1})).filter(wt=>wt.age<30),Wn.current=Wn.current.map(wt=>({...wt,age:wt.age+1})).filter(wt=>wt.age<20);const ln=Bt.current;if(ln&&!ln.alive&&(Bt.current=null,nn(null),en.current=!1,Qt(!1)),(Vt=c.current)!=null&&Vt.running&&(c.current.step(),Ee%10===0&&an(c.current.getStats())),Zo(s.current,u.current),Jo(s.current),Ee%60===0){const wt=s.current;for(const mn of f.current){if(mn.age<30)continue;const un=[],$n=It=>{It.children.length===0&&It.alive&&un.push({x:It.x,y:It.y});for(const dn of It.children)$n(dn)};$n(mn.root);for(const It of un)if(Math.random()<.15){const dn=It.x+(Math.random()-.5)*3|0,gn=It.y+(Math.random()-.5)*3|0;wt.get(dn,gn)===V.EMPTY&&wt.set(dn,gn,V.FOOD)}}}Ee%90===0&&s.current.countType(V.FOOD)<25&&s.current.spawnFood(16),Ee%45===0&&sn({food:s.current.countType(V.FOOD),water:s.current.countType(V.WATER),creatures:u.current.length,plants:f.current.length,objects:h.current.length}),Ee%12===0&&Bt.current&&Bt.current.alive&&nn({...Bt.current})}if(en.current&&Bt.current&&Bt.current.alive){const de=Bt.current.segs[0],Se=v.current||Math.min(fe/Er,be/kr),{scale:qe}=g.current,st=fe/2-(de.x*Se*qe+(fe-Se*Er)/2),$t=be/2-(de.y*Se*qe+(be-Se*kr)/2),Tt=.06,Ut=g.current.panX+(st-g.current.panX)*Tt,ln=g.current.panY+($t-g.current.panY)*Tt;g.current={...g.current,panX:Ut,panY:ln}}s.current.render(i.current.data,o.current),X.putImageData(i.current,0,0),he.save(),uo(he,fe,be),he.imageSmoothingEnabled=!1,he.drawImage(W,0,0);for(const de of f.current)SR(he,de.root,de,1);for(const de of h.current)nW(he,de,o.current);for(const de of Ke.current)Uq(he,de.creature,1,de.deathAge);const Me=Bt.current;for(const de of u.current)hb(he,de,1,de===Me);for(const de of u.current){const Se=de.segs[0],qe=Se.r*3.2,st=.6,$t=Se.x-qe/2,Tt=Se.y-Se.r*2.2,Ut=Math.max(0,Math.min(1,de.energy/200));he.fillStyle="rgba(0,0,0,0.35)",he.fillRect($t-.2,Tt-.1,qe+.4,st+.2);const ln=Ut>.6?`hsla(${de.bp.hue},60%,50%,0.55)`:Ut>.3?"rgba(220,180,40,0.55)":"rgba(220,50,40,0.6)";he.fillStyle=ln,he.fillRect($t,Tt,qe*Ut,st)}for(const de of vn.current){const Se=de.age/30,qe=Math.max(0,1-Se),st=de.r*(1+Se*2.5);if(he.beginPath(),he.arc(de.x,de.y,st,0,Math.PI*2),he.strokeStyle=`hsla(${de.hue},80%,65%,${.5*qe})`,he.lineWidth=.4*qe,he.stroke(),de.age<10){const $t=Math.max(0,1-de.age/10)*.4;he.beginPath(),he.arc(de.x,de.y,de.r*.8,0,Math.PI*2),he.fillStyle=`hsla(${de.hue},60%,85%,${$t})`,he.fill()}}for(const de of Wn.current){const Se=de.age/20,qe=Math.max(0,1-Se),st=2+Se*6;he.beginPath(),he.arc(de.x,de.y,st,0,Math.PI*2),he.strokeStyle=`hsla(${de.hue},70%,70%,${.4*qe})`,he.lineWidth=.3*qe,he.stroke();for(let $t=0;$t<4;$t++){const Tt=Se*6+$t*1.57,Ut=st*.8;he.beginPath(),he.arc(de.x+Math.cos(Tt)*Ut,de.y+Math.sin(Tt)*Ut,.4*qe,0,Math.PI*2),he.fillStyle=`hsla(120,80%,75%,${.5*qe})`,he.fill()}}const _e=(rn=c.current)==null?void 0:rn.currentCandidate;if(_e&&((pn=c.current)!=null&&pn.running)){hb(he,_e,1,!0,.85);const de=_e.segs[0];he.font=`${2.5/g.current.scale}px monospace`,he.fillStyle="rgba(200,140,255,0.5)",he.fillText("EVOLVING",de.x-6,de.y-5)}if(S.current.x>0||S.current.y>0){const{x:de,y:Se}=S.current,qe=R.current,st=_.current,$t=.5/g.current.scale;if(st==="paint"||st==="erase"){const Tt=st==="erase"?"#ff4444":((re=gS[k.current])==null?void 0:re.color)??"#fff",Ut=Oe.current;if(he.strokeStyle=Tt+"aa",he.lineWidth=$t,he.beginPath(),Ut==="circle"||Ut==="spray"?he.arc(de,Se,qe,0,Math.PI*2):Ut==="square"?he.rect(de-qe,Se-qe,qe*2,qe*2):Ut==="hline"?he.rect(de-qe*2,Se-1,qe*4,3):Ut==="vline"&&he.rect(de-1,Se-qe*2,3,qe*4),he.stroke(),Ut==="spray")for(let ln=0;ln<8;ln++){const wt=ln/8*Math.PI*2,mn=qe*.7;he.beginPath(),he.arc(de+Math.cos(wt)*mn,Se+Math.sin(wt)*mn,.3,0,Math.PI*2),he.fillStyle=Tt+"55",he.fill()}}else if(st==="drop")he.beginPath(),he.arc(de,Se,3,0,Math.PI*2),he.strokeStyle="#ffaa44aa",he.lineWidth=$t,he.setLineDash([1,1]),he.stroke(),he.setLineDash([]);else if(st==="plant")he.beginPath(),he.arc(de,Se,3,0,Math.PI*2),he.strokeStyle="#44ff88aa",he.lineWidth=$t,he.setLineDash([1,1]),he.stroke(),he.setLineDash([]);else if(st==="plant_tool"){const Tt=My.find(ln=>ln.id===mt.current),Ut=(Tt==null?void 0:Tt.color)??"#44ff88";he.beginPath(),he.arc(de,Se,8,0,Math.PI*2),he.strokeStyle=Ut+"55",he.lineWidth=$t*1.5,he.setLineDash([1.5,1]),he.stroke(),he.setLineDash([]),he.beginPath(),he.arc(de,Se,1.5,0,Math.PI*2),he.fillStyle=Ut+"aa",he.fill()}else if(st==="power"){const Tt=xS.find(wt=>wt.id===fn.current),Ut=(Tt==null?void 0:Tt.color)??"#ffaa44",ln=10+Math.sin(o.current*.08)*3;he.beginPath(),he.arc(de,Se,ln,0,Math.PI*2),he.strokeStyle=Ut+"55",he.lineWidth=$t*2,he.setLineDash([2,2]),he.stroke(),he.setLineDash([]),he.beginPath(),he.arc(de,Se,2,0,Math.PI*2),he.fillStyle=Ut+"aa",he.fill()}else if(st==="creature"){const Tt=4+Math.sin(o.current*.1)*1.5;he.beginPath(),he.arc(de,Se,Tt,0,Math.PI*2),he.strokeStyle="#cc88ffaa",he.lineWidth=$t,he.setLineDash([1.5,1]),he.stroke(),he.setLineDash([])}else st==="inspect"&&(he.strokeStyle="#88ffeebb",he.lineWidth=$t,he.beginPath(),he.moveTo(de-3,Se),he.lineTo(de+3,Se),he.moveTo(de,Se-3),he.lineTo(de,Se+3),he.stroke(),he.beginPath(),he.arc(de,Se,5,0,Math.PI*2),he.setLineDash([1,1]),he.stroke(),he.setLineDash([]))}const Je=Bt.current;if(Je&&Je.alive){const de=Je.segs[0],Se=2.5/g.current.scale;he.font=`bold ${Se}px monospace`;const qe=de.x+Je.segs[0].r*2+1;let st=de.y-5;const $t=[`${Je.bp.name} (${Je.bp.species})`,`HP ${Je.energy.toFixed(0)} / 200`,`Age ${Je.age}/${Je.maxAge}  Gen ${Je.generation}`,`Dir ${Je.facingDir>0?"":""}  Segs ${Je.segs.length}  Grip ${Je.segs.filter(Tt=>Tt.gripped).length}`,`vX ${Je.segs[0].vx.toFixed(2)}  vY ${Je.segs[0].vy.toFixed(2)}`];he.fillStyle="rgba(0,0,0,0.55)",he.fillRect(qe-.5,st-Se*.8,Se*18,$t.length*Se*1.4+Se*.5),he.fillStyle="rgba(180,255,220,0.7)";for(const Tt of $t)he.fillText(Tt,qe,st),st+=Se*1.4;he.beginPath(),he.arc(de.x,de.y,de.r*2+Math.sin(o.current*.15)*.5,0,Math.PI*2),he.strokeStyle=`hsla(${Je.bp.hue},80%,65%,0.5)`,he.lineWidth=.5/g.current.scale,he.setLineDash([1.5,1]),he.stroke(),he.setLineDash([])}he.restore()};return r.current=requestAnimationFrame(Te),()=>cancelAnimationFrame(r.current)},[e]),w.useEffect(()=>{const W=t.current;if(!W)return;const X=()=>{const Te=W.offsetWidth,He=W.offsetHeight;Te>0&&He>0&&(W.width=Te,W.height=He)};return X(),window.addEventListener("resize",X),()=>window.removeEventListener("resize",X)},[e]);const Ua=w.useCallback(W=>{W.currentTarget.setPointerCapture(W.pointerId);const X=W.currentTarget,Te=X.getBoundingClientRect(),He=W.clientX-Te.left,he=W.clientY-Te.top;if(C.current={x:He,y:he},S.current=fr(X,He,he),W.button===1||W.altKey)m.current=!0,y.current={mx:He,my:he,px:g.current.panX,py:g.current.panY};else{const fe=_.current;if(fe==="drop"){const{x:be,y:Ee}=S.current;bo(P.current,be,Ee)}else if(fe==="plant"){const{x:be,y:Ee}=S.current;vo(Ge.current,be,Ee)}else if(fe==="grab"){const{x:be,y:Ee}=S.current;let Me=null,_e=30;for(const Vt of u.current)for(const rn of Vt.segs){const pn=rn.x-be,re=rn.y-Ee,de=Math.sqrt(pn*pn+re*re);de<_e&&(_e=de,Me=Vt)}let Je={node:null,dist:900};for(const Vt of f.current)W5(Vt.root,be,Ee,Je);Je.node&&Math.sqrt(Je.dist)<_e?(H.current=Je.node,L.current=null):(L.current=Me,H.current=null),b.current=!0}else if(fe==="creature"){const{x:be,y:Ee}=S.current;jo(be,Ee)}else if(fe==="inspect"){const{x:be,y:Ee}=S.current;let Me=null,_e=30;for(const Je of u.current)for(const Vt of Je.segs){const rn=Vt.x-be,pn=Vt.y-Ee,re=Math.sqrt(rn*rn+pn*pn);re<_e&&(_e=re,Me=Je)}if(Bt.current=Me,nn(Me),Me&&K("creatures"),Me)L.current=Me,b.current=!0;else{const Je={node:null,dist:225};for(const Vt of f.current)W5(Vt.root,be,Ee,Je);Je.node&&(H.current=Je.node,b.current=!0)}}else if(fe==="plant_tool"){const{x:be,y:Ee}=S.current,Me=mt.current;for(const _e of f.current){const Je=_e.root.x-be,Vt=_e.root.y-Ee;if(Je*Je+Vt*Vt<400){if(Me==="trim"){const rn=(pn,re)=>{re>5&&(pn.alive=!1);for(const de of pn.children)rn(de,re+1)};rn(_e.root,0)}else if(Me==="water"){_e.growthRate=Math.min(.8,_e.growthRate+.15);for(let rn=0;rn<3;rn++){const pn=_e.root.x+(Math.random()-.5)*6|0,re=_e.root.y+1+Math.random()*3|0;s.current.get(pn,re)===V.EMPTY&&s.current.set(pn,re,V.WATER)}}else if(Me==="fertilize")_e.growthRate=Math.min(1,_e.growthRate+.3);else if(Me==="harvest"){const rn=pn=>{if(pn.children.length===0&&pn.alive&&Math.random()<.4){const re=pn.x+(Math.random()-.5)*4|0,de=pn.y+1|0;s.current.get(re,de)===V.EMPTY&&s.current.set(re,de,V.FOOD),pn.alive=!1}for(const re of pn.children)rn(re)};rn(_e.root)}}}b.current=!0}else if(fe==="power"){b.current=!0;const{x:be,y:Ee}=S.current;hr(be,Ee)}else b.current=!0}},[fr,bo,vo,jo,hr]),Na=w.useCallback(W=>{const X=W.currentTarget,Te=X.getBoundingClientRect(),He=W.clientX-Te.left,he=W.clientY-Te.top;if(C.current={x:He,y:he},S.current=fr(X,He,he),m.current){const{mx:fe,my:be,px:Ee,py:Me}=y.current;or({...g.current,panX:Ee+(He-fe),panY:Me+(he-be)})}if(!b.current){const{x:fe,y:be}=S.current;let Ee=!1;for(const _e of u.current){for(const Je of _e.segs){const Vt=Je.x-fe,rn=Je.y-be;if(Vt*Vt+rn*rn<625){Ee=!0;break}}if(Ee)break}if(!Ee){const _e={node:null,dist:225};for(const Je of f.current)if(W5(Je.root,fe,be,_e),_e.node){Ee=!0;break}}G.current=Ee;const Me=_.current;Ee&&(Me==="inspect"||Me==="grab"||Me==="paint"||Me==="erase")||Me==="grab"?X.style.cursor="grab":Me==="paint"||Me==="erase"?X.style.cursor="crosshair":Me==="creature"?X.style.cursor="cell":Me==="drop"||Me==="plant"?X.style.cursor="copy":Me==="power"||Me==="plant_tool"?X.style.cursor="pointer":Me==="inspect"?X.style.cursor=Ee?"grab":"help":X.style.cursor=Ee?"grab":"default"}},[fr,or]),sa=w.useCallback(()=>{b.current=!1,m.current=!1,L.current=null,H.current=null},[]),So=w.useCallback(W=>{W.preventDefault();const Te=W.currentTarget.getBoundingClientRect(),He=W.clientX-Te.left,he=W.clientY-Te.top,fe=W.deltaY<0?1.12:1/1.12,be=Math.max(.4,Math.min(5,g.current.scale*fe));or({scale:be,panX:He-(He-g.current.panX)*(be/g.current.scale),panY:he-(he-g.current.panY)*(be/g.current.scale)})},[or]),Oo=w.useCallback(W=>{const X=t.current;if(!X)return;const Te=X.width,He=X.height,he=Math.max(.4,Math.min(5,g.current.scale*W));or({scale:he,panX:Te/2-(Te/2-g.current.panX)*(he/g.current.scale),panY:He/2-(He/2-g.current.panY)*(he/g.current.scale)})},[or]),U=w.useCallback(()=>{or({scale:1,panX:0,panY:0})},[or]);w.useEffect(()=>{if(!e)return;const W=X=>{X.key===" "&&(X.preventDefault(),F(Te=>!Te)),X.key==="r"&&Tr(I.current),X.key==="c"&&Ir(),X.key==="f"&&s.current.spawnFood(12),(X.key==="="||X.key==="+")&&Oo(1.2),X.key==="-"&&Oo(1/1.2),X.key==="0"&&U(),X.key==="1"&&dt("paint"),X.key==="2"&&dt("erase"),X.key==="3"&&dt("grab"),X.key==="4"&&dt("drop"),X.key==="5"&&dt("plant"),X.key==="6"&&dt("creature"),X.key==="7"&&dt("power"),(X.key==="8"||X.key==="i")&&dt("inspect")};return window.addEventListener("keydown",W),()=>window.removeEventListener("keydown",W)},[e,Tr,Ir,Oo,U]);const je=[{id:"elements",icon:a.jsx(_4,{size:8}),label:"Mat"},{id:"objects",icon:a.jsx(Bj,{size:8}),label:"Obj"},{id:"creatures",icon:a.jsx(Rm,{size:8}),label:"Life"},{id:"plants",icon:a.jsx(Am,{size:8}),label:"Flora"},{id:"environment",icon:a.jsx(_d,{size:8}),label:"Env"},{id:"ecosystem",icon:a.jsx(X5,{size:8}),label:"Eco"}];return a.jsxs("div",{style:{display:e?"flex":"none"},className:"fixed inset-0 z-0 flex flex-col overflow-hidden bg-[#020408] pt-[30px]",children:[a.jsxs("div",{className:`z-20 flex-shrink-0 flex items-center gap-1 px-2 py-1
        bg-black/70 backdrop-blur-md border-b border-white/[0.04]`,children:[a.jsx("div",{className:"flex gap-0.5",children:pd.map(W=>a.jsxs("button",{onClick:()=>Tr(W.id),title:W.desc,className:`flex items-center gap-1 px-1.5 py-0.5 rounded text-[6.5px] font-mono border transition-all
                ${Q===W.id?"border-white/15 text-white/55 bg-white/6":"border-transparent text-white/20 hover:text-white/45 hover:bg-white/[0.03]"}`,children:[a.jsx("span",{className:"text-[8px]",children:W.icon}),a.jsx("span",{className:"hidden md:inline",children:W.label})]},W.id))}),a.jsx("div",{className:"w-px h-3.5 bg-white/8 mx-0.5"}),a.jsx("div",{className:"flex gap-0.5",children:[{id:"paint",icon:a.jsx(wE,{size:8}),label:"Paint"},{id:"erase",icon:a.jsx(j5,{size:8}),label:"Erase"},{id:"grab",icon:a.jsx(z9,{size:8}),label:"Grab"},{id:"drop",icon:a.jsx(lp,{size:8}),label:"Drop Obj"},{id:"plant",icon:a.jsx(Am,{size:8}),label:"Plant"},{id:"creature",icon:a.jsx(Rm,{size:8}),label:"Place Creature"},{id:"power",icon:a.jsx(Es,{size:8}),label:"Power Tool"},{id:"plant_tool",icon:a.jsx(Am,{size:8}),label:"Plant Tools"},{id:"inspect",icon:a.jsx(vl,{size:8}),label:"Inspect"}].map(W=>a.jsx(Zq,{active:et===W.id,color:"#cc88ff",onClick:()=>dt(W.id),title:W.label,children:W.icon},W.id))}),a.jsx("div",{className:"w-px h-3.5 bg-white/8 mx-0.5"}),a.jsx("button",{onClick:()=>F(W=>!W),className:`flex items-center gap-0.5 px-2 py-0.5 rounded text-[6.5px] font-mono uppercase tracking-widest transition-all border
            ${te?"border-cyan-400/30 text-cyan-300/80 bg-cyan-500/8":"border-white/10 text-white/40 hover:text-white/65"}`,children:te?a.jsxs(a.Fragment,{children:[a.jsx(s0,{size:7}),"Pause"]}):a.jsxs(a.Fragment,{children:[a.jsx(wl,{size:7}),"Play"]})}),a.jsx("button",{onClick:()=>Tr(Q),title:"Reset",className:"p-1 rounded border border-white/[0.05] text-white/25 hover:text-white/50 transition-all",children:a.jsx(Wi,{size:8})}),a.jsx("div",{className:"flex gap-0.5",children:[1,2,4].map(W=>a.jsxs("button",{onClick:()=>Re(W),className:`w-5 h-4 rounded text-[6px] font-mono border transition-all
                ${we===W?"border-cyan-400/25 text-cyan-300 bg-cyan-500/6":"border-white/[0.04] text-white/20 hover:text-white/45"}`,children:[W,""]},W))}),a.jsx("div",{className:"w-px h-3.5 bg-white/8 mx-0.5"}),a.jsx("button",{onClick:()=>Oo(1.25),className:"p-0.5 text-white/25 hover:text-white/50",children:a.jsx(zC,{size:9})}),a.jsxs("span",{className:"text-[6px] font-mono text-white/20 w-7 text-center",children:[(zt*100).toFixed(0),"%"]}),a.jsx("button",{onClick:()=>Oo(1/1.25),className:"p-0.5 text-white/25 hover:text-white/50",children:a.jsx(BC,{size:9})}),a.jsx("button",{onClick:U,className:"p-0.5 text-white/25 hover:text-white/50",title:"Reset view",children:a.jsx(yE,{size:8})}),a.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[a.jsxs("div",{className:"flex items-center gap-1.5 text-[6px] font-mono",children:[a.jsxs("span",{className:"text-emerald-400/40",children:[a.jsx(r2,{size:7,className:"inline"})," ",On.food]}),a.jsxs("span",{className:"text-blue-400/40",children:[a.jsx(_4,{size:7,className:"inline"})," ",On.water]}),a.jsxs("span",{className:"text-purple-400/40",children:[a.jsx(Rm,{size:7,className:"inline"})," ",On.creatures]}),a.jsxs("span",{className:"text-green-400/40",children:[a.jsx(Am,{size:7,className:"inline"})," ",On.plants]}),On.objects>0&&a.jsxs("span",{className:"text-orange-400/40",children:[a.jsx(lp,{size:7,className:"inline"})," ",On.objects]})]}),a.jsxs("button",{onClick:()=>Pt(W=>!W),className:`flex items-center gap-0.5 px-2 py-0.5 rounded text-[6px] font-mono border border-white/[0.05]
              text-white/25 hover:text-white/50 transition-all`,children:[a.jsx(Ax,{size:7})," ",it.length]})]})]}),a.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[a.jsxs("div",{className:"relative z-20 flex-shrink-0 transition-all duration-200",style:{width:J?174:12},children:[a.jsx("button",{onClick:()=>ke(W=>!W),className:`absolute -right-4 top-12 z-30 w-4 h-8 flex items-center justify-center
              bg-black/60 border border-white/[0.06] rounded-r text-white/25 hover:text-white/50 transition-all`,children:J?a.jsx(Ap,{size:8}):a.jsx(aa,{size:8})}),J&&a.jsxs("div",{className:"flex flex-col h-full bg-black/65 backdrop-blur-md border-r border-white/[0.05]",children:[a.jsx("div",{className:"flex border-b border-white/[0.04] px-0.5 py-0.5 gap-0.5",children:je.map(W=>a.jsxs("button",{onClick:()=>K(W.id),className:`flex-1 flex flex-col items-center gap-0.5 py-1 rounded text-[5px] font-mono transition-all
                      ${Le===W.id?"text-white/60 bg-white/6":"text-white/18 hover:text-white/35 hover:bg-white/[0.02]"}`,children:[W.icon,a.jsx("span",{className:"uppercase tracking-widest",children:W.label})]},W.id))}),a.jsxs("div",{className:"flex-1 overflow-y-auto py-1",style:{scrollbarWidth:"none"},children:[Le==="elements"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"px-2 mb-1 flex flex-col gap-1",children:[a.jsx(Bl,{label:"Brush Size",val:tt,min:1,max:40,step:1,fmt:W=>`${W}px`,color:"#88aaff",onChange:We}),a.jsx("div",{className:"flex gap-0.5",children:[{id:"circle",icon:a.jsx(l9,{size:7}),label:""},{id:"square",icon:a.jsx(GE,{size:7}),label:""},{id:"spray",icon:a.jsx(O4,{size:7}),label:""},{id:"hline",icon:a.jsx("span",{className:"text-[6px]",children:""}),label:""},{id:"vline",icon:a.jsx("span",{className:"text-[6px]",children:""}),label:""}].map(W=>a.jsx("button",{onClick:()=>Ve(W.id),title:W.id,className:`flex-1 flex items-center justify-center py-0.5 rounded text-[6px] font-mono border transition-all
                              ${Ye===W.id?"border-blue-400/25 text-blue-300 bg-blue-500/8":"border-white/[0.04] text-white/20 hover:text-white/45"}`,children:W.icon},W.id))})]}),Mq.map(W=>a.jsxs("div",{children:[a.jsx(bS,{label:W.label,color:W.color,open:Gn[W.id]??!0,onToggle:()=>pr(W.id),count:W.cells.length}),(Gn[W.id]??!0)&&a.jsx("div",{className:"grid grid-cols-2 gap-0.5 px-1.5 pb-1",children:W.cells.map(X=>{const Te=gS[X];return a.jsxs("button",{onClick:()=>{Ae(X),dt("paint")},title:Te.desc,className:`flex items-center gap-1 px-1 py-0.5 rounded text-[6.5px] font-mono
                                    border transition-all ${ge===X&&et==="paint"?"bg-white/8 border-white/15":"border-transparent text-white/28 hover:bg-white/[0.04] hover:text-white/50"}`,style:{color:ge===X&&et==="paint"?Te.color:void 0},children:[a.jsx("span",{className:"w-1.5 h-1.5 rounded-sm flex-shrink-0",style:{background:Te.color}}),Te.label]},X)})})]},W.id)),a.jsxs("div",{className:"px-2 pt-1 flex flex-col gap-0.5",children:[a.jsxs("button",{onClick:()=>s.current.spawnFood(14),className:`w-full py-1 rounded text-[6.5px] font-mono border border-emerald-400/15
                          text-emerald-300/45 hover:bg-emerald-500/6 transition-all flex items-center justify-center gap-1`,children:[a.jsx(r2,{size:7})," Scatter Food"]}),a.jsxs("button",{onClick:()=>s.current.clear(),className:`w-full py-1 rounded text-[6.5px] font-mono border border-red-400/15
                          text-red-300/35 hover:bg-red-500/6 transition-all flex items-center justify-center gap-1`,children:[a.jsx(j5,{size:7})," Clear All"]})]})]}),Le==="objects"&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"px-2 mb-1 text-[5.5px] font-mono text-white/20",children:"Select an object then click canvas to place it."}),Xq.map(W=>{const X=yR.filter(Te=>Te.cat===W.id);return a.jsxs("div",{children:[a.jsx(bS,{label:W.label,color:W.color,open:Gn[W.id]??(W.id==="explosive"||W.id==="force"),onToggle:()=>pr(W.id),count:X.length}),(Gn[W.id]??(W.id==="explosive"||W.id==="force"))&&a.jsx("div",{className:"grid grid-cols-2 gap-0.5 px-1.5 pb-1",children:X.map(Te=>a.jsxs("button",{onClick:()=>{Wt(Te.id),dt("drop")},title:Te.desc,className:`flex items-center gap-1 px-1 py-0.5 rounded text-[6.5px] font-mono
                                    border transition-all ${Rt===Te.id&&et==="drop"?"bg-white/8 border-white/15":"border-transparent text-white/28 hover:bg-white/[0.04] hover:text-white/50"}`,style:{color:Rt===Te.id&&et==="drop"?Te.color:void 0},children:[a.jsx("span",{className:"text-[8px]",children:Te.icon}),Te.label]},Te.id))})]},W.id)})]}),Le==="creatures"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"px-2 mb-1.5",children:[a.jsxs("div",{className:"text-[5.5px] font-mono text-white/20 mb-1",children:["Pick a body plan  ",a.jsx("span",{className:"text-purple-300/50",children:"Place"}),"  click canvas. Creatures seek food automatically."]}),a.jsx("div",{className:"flex flex-col gap-0.5",children:Ic.map(W=>a.jsxs("button",{onClick:()=>{$e(W),$.current=W},className:`flex items-center gap-1.5 px-1.5 py-1 rounded text-[6.5px] font-mono border transition-all
                              ${Zt.id===W.id?"border-purple-400/20 bg-purple-500/8 text-purple-200":"border-transparent text-white/25 hover:bg-white/[0.03] hover:text-white/45"}`,children:[a.jsx("span",{className:"text-[10px] w-4 text-center",children:W.icon}),a.jsxs("div",{className:"flex-1 text-left",children:[a.jsx("div",{children:W.name}),a.jsxs("div",{className:"text-[5px] opacity-40",children:[W.segN,"seg  ",W.species,"  ",W.appendageCount,"limbs"]})]})]},W.id))})]}),a.jsxs("div",{className:"px-2 flex flex-col gap-1",children:[a.jsxs("button",{onClick:()=>dt("creature"),className:`w-full py-1.5 rounded text-[7px] font-mono border transition-all flex items-center justify-center gap-1
                          ${et==="creature"?"border-purple-400/40 bg-purple-500/14 text-purple-200 animate-pulse":"border-purple-400/20 text-purple-300/55 hover:bg-purple-500/6"}`,children:[a.jsx(Rm,{size:8}),et==="creature"?" Click on canvas":"Place on Canvas"]}),a.jsxs("button",{onClick:()=>Ir(),className:`w-full py-1 rounded text-[6.5px] font-mono border border-white/[0.06]
                          text-white/28 hover:bg-white/[0.04] transition-all flex items-center justify-center gap-1`,children:[a.jsx(Yi,{size:7})," Random Spawn"]}),a.jsxs("button",{onClick:()=>{for(let W=0;W<5;W++){const X=Ic[Math.floor(Math.random()*Ic.length)];Ir(X)}},className:`w-full py-1 rounded text-[6.5px] font-mono border border-white/[0.06]
                          text-white/28 hover:bg-white/[0.04] transition-all flex items-center justify-center gap-1`,children:[a.jsx(mh,{size:7})," Spawn Colony (5)"]}),a.jsxs("button",{onClick:()=>s.current.spawnFood(16),className:`w-full py-1 rounded text-[6.5px] font-mono border border-emerald-400/12
                          text-emerald-300/40 hover:bg-emerald-500/6 transition-all flex items-center justify-center gap-1`,children:[a.jsx(r2,{size:7})," Scatter Food"]}),a.jsxs("button",{onClick:()=>{u.current=[]},className:`w-full py-0.5 rounded text-[6px] font-mono border border-red-400/10
                          text-red-300/25 hover:bg-red-500/5 transition-all flex items-center justify-center gap-1`,children:[a.jsx(j5,{size:6})," Clear All Creatures"]})]}),a.jsx("div",{className:"px-2 pt-1",children:a.jsx(Bl,{label:"Max Population",val:Ct,min:5,max:60,step:1,fmt:W=>`${W}`,color:"#cc88ff",onChange:ft})}),On.creatures>0&&a.jsxs("div",{className:"px-2 pt-1.5 border-t border-white/[0.04] mt-1",children:[a.jsxs("div",{className:"text-[5.5px] font-mono uppercase tracking-widest text-white/18 mb-1",children:["Census (",On.creatures," alive)"]}),a.jsx("div",{className:"flex flex-col gap-0.5 text-[6px] font-mono",children:(()=>{const W={};for(const X of u.current){if(!X.alive)continue;const Te=X.bp.id;W[Te]||(W[Te]={count:0,icon:X.bp.icon,hue:X.bp.hue,maxGen:0}),W[Te].count++,W[Te].maxGen=Math.max(W[Te].maxGen,X.generation)}return Object.entries(W).map(([X,Te])=>{var He;return a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("span",{className:"text-white/30",children:[a.jsx("span",{className:"text-[8px] mr-0.5",children:Te.icon}),((He=Ic.find(he=>he.id===X))==null?void 0:He.name)??X]}),a.jsxs("div",{className:"flex items-center gap-1",children:[Te.maxGen>0&&a.jsxs("span",{className:"text-[4.5px] font-mono text-white/15",children:["G",Te.maxGen]}),a.jsxs("span",{className:"px-1 rounded-full text-[5px]",style:{color:`hsl(${Te.hue},60%,55%)`,background:`hsla(${Te.hue},40%,30%,0.15)`},children:["",Te.count]})]})]},X)})})()})]}),bt&&bt.alive&&a.jsxs("div",{className:"px-2 pt-2 border-t border-white/[0.04] mt-1",children:[a.jsxs("div",{className:"text-[5.5px] font-mono uppercase tracking-widest text-teal-300/35 mb-1",children:[a.jsx(vl,{size:6,className:"inline mr-0.5"})," Inspecting: ",bt.bp.name]}),a.jsxs("div",{className:"flex flex-col gap-0.5 text-[6px] font-mono",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-white/22",children:"Species"}),a.jsx("span",{className:"text-white/50",children:bt.bp.species})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-white/22",children:"Diet"}),a.jsxs("span",{style:{color:bt.bp.diet==="herbivore"?"#66ff88":bt.bp.diet==="carnivore"?"#ff6666":"#ffaa44"},children:[bt.bp.diet==="herbivore"?"":bt.bp.diet==="carnivore"?"":""," ",bt.bp.diet]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-white/22",children:"Energy"}),a.jsxs("span",{style:{color:bt.energy<40?"#ff6666":bt.energy>120?"#66ff88":"#aacc88"},children:[bt.energy.toFixed(0)," / 200"]})]}),a.jsx("div",{className:"w-full h-1 bg-white/5 rounded-full overflow-hidden",children:a.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${Math.min(100,bt.energy/200*100)}%`,background:bt.energy<40?"#ff4444":bt.energy>120?"#44ff88":"#88aa66"}})}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-white/22",children:"Age"}),a.jsxs("span",{className:"text-white/50",children:[bt.age," ticks"]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-white/22",children:"Segs"}),a.jsxs("span",{className:"text-white/50",children:[bt.segs.length," (",bt.segs.filter(W=>W.gripped).length," gripped)"]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-white/22",children:"Facing"}),a.jsx("span",{className:"text-white/50",children:bt.facingDir>0?" Right":" Left"})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-white/22",children:"Vel"}),a.jsx("span",{className:"text-white/50",children:Math.sqrt(bt.segs[0].vx**2+bt.segs[0].vy**2).toFixed(2)})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-white/22",children:"Gen"}),a.jsxs("span",{className:"text-white/50",children:["G",bt.generation]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-white/22",children:"Max Age"}),a.jsxs("span",{className:"text-white/50",children:[bt.maxAge," (",(bt.age/bt.maxAge*100).toFixed(0),"%)"]})]})]}),a.jsxs("div",{className:"mt-1 flex gap-0.5",children:[a.jsxs("button",{onClick:()=>{Qt(W=>!W)},className:`flex-1 py-0.5 rounded text-[5.5px] font-mono border transition-all flex items-center justify-center gap-0.5
                              ${Jt?"border-cyan-400/25 text-cyan-300/70 bg-cyan-500/8":"border-white/[0.04] text-white/20 hover:text-white/40"}`,children:[a.jsx(O4,{size:5})," ",Jt?"Following":"Follow"]}),a.jsx("button",{onClick:()=>{Bt.current=null,nn(null),Qt(!1)},className:"flex-1 py-0.5 rounded text-[5.5px] font-mono border border-white/[0.04] text-white/20 hover:text-white/40 transition-all",children:"Deselect"})]}),a.jsxs("div",{className:"mt-0.5 flex gap-0.5",children:[a.jsx("button",{onClick:()=>{Bt.current&&(Bt.current.energy=Math.min(200,Bt.current.energy+60))},className:"flex-1 py-0.5 rounded text-[5.5px] font-mono border border-emerald-400/15 text-emerald-300/40 hover:bg-emerald-500/6 transition-all",children:" Feed"}),a.jsx("button",{onClick:()=>{Bt.current&&(Bt.current.facingDir=Bt.current.facingDir*-1)},className:"flex-1 py-0.5 rounded text-[5.5px] font-mono border border-white/[0.04] text-white/20 hover:text-white/40 transition-all",children:" Flip"}),a.jsx("button",{onClick:()=>{Bt.current&&(Bt.current.energy=-1,Bt.current=null,nn(null),Qt(!1))},className:"flex-1 py-0.5 rounded text-[5.5px] font-mono border border-red-400/12 text-red-300/25 hover:bg-red-500/6 transition-all",children:" Kill"})]})]}),a.jsxs("div",{className:"px-2 pt-2 border-t border-white/[0.04] mt-1",children:[a.jsx("div",{className:"text-[5.5px] font-mono uppercase tracking-widest text-white/18 mb-1",children:"Power Tools"}),a.jsx("div",{className:"text-[5px] font-mono text-white/15 mb-1",children:"Select power  click & drag on canvas"}),a.jsx("div",{className:"grid grid-cols-2 gap-0.5",children:xS.map(W=>a.jsxs("button",{onClick:()=>{Kt(W.id),dt("power")},title:W.desc,className:`flex items-center gap-1 px-1 py-0.5 rounded text-[6px] font-mono
                              border transition-all ${Gt===W.id&&et==="power"?"bg-white/8 border-white/15":"border-transparent text-white/28 hover:bg-white/[0.04] hover:text-white/50"}`,style:{color:Gt===W.id&&et==="power"?W.color:void 0},children:[a.jsx("span",{className:"text-[8px]",children:W.icon}),W.label]},W.id))})]})]}),Le==="plants"&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"px-2 mb-1.5 text-[5.5px] font-mono text-white/20",children:"Select species  click canvas to plant. Plants photosynthesize (produce food at tips)."}),a.jsx("div",{className:"flex flex-col gap-0.5 px-2 max-h-[300px] overflow-y-auto",style:{scrollbarWidth:"none"},children:Cy.map(W=>a.jsxs("button",{onClick:()=>{gt(W.id),dt("plant")},className:`flex items-center gap-1.5 px-1.5 py-0.5 rounded text-[6px] font-mono border transition-all
                            ${xe===W.id?"border-green-400/20 bg-green-500/8 text-green-200":"border-transparent text-white/25 hover:bg-white/[0.03] hover:text-white/45"}`,children:[a.jsx("span",{className:"text-[9px]",children:W.icon}),a.jsxs("div",{className:"flex-1 text-left",children:[a.jsx("div",{children:W.label}),a.jsx("div",{className:"text-[4.5px] opacity-40",children:W.desc})]})]},W.id))}),a.jsxs("div",{className:"px-2 pt-1.5 flex flex-col gap-0.5",children:[a.jsxs("button",{onClick:()=>{const{x:W,y:X}=S.current;vo(xe,W>0?W:Er/2,X>0?X:kr*.7)},className:`w-full py-1.5 rounded text-[7px] font-mono border border-green-400/20
                          text-green-300/55 hover:bg-green-500/6 transition-all flex items-center justify-center gap-1`,children:[a.jsx(QE,{size:8})," Plant Here"]}),a.jsx("button",{onClick:()=>{f.current=[]},className:`w-full py-0.5 rounded text-[6px] font-mono border border-red-400/10
                          text-red-300/25 hover:bg-red-500/5 transition-all`,children:"Clear All Plants"})]}),a.jsxs("div",{className:"px-2 pt-2 border-t border-white/[0.04] mt-1",children:[a.jsx("div",{className:"text-[5.5px] font-mono uppercase tracking-widest text-white/18 mb-1",children:"Plant Care Tools"}),a.jsx("div",{className:"grid grid-cols-2 gap-0.5",children:My.map(W=>a.jsxs("button",{onClick:()=>{rt(W.id),dt("plant_tool")},title:W.desc,className:`flex items-center gap-1 px-1 py-0.5 rounded text-[6px] font-mono
                              border transition-all ${zn===W.id&&et==="plant_tool"?"bg-white/8 border-white/15":"border-transparent text-white/28 hover:bg-white/[0.04] hover:text-white/50"}`,style:{color:zn===W.id&&et==="plant_tool"?W.color:void 0},children:[a.jsx("span",{className:"text-[8px]",children:W.icon}),W.label]},W.id))})]})]}),Le==="environment"&&a.jsxs("div",{className:"px-2 flex flex-col gap-2 pt-1",children:[a.jsx(Bl,{label:"Gravity",val:En,min:0,max:3,step:.05,fmt:W=>`${W.toFixed(2)}g`,color:"#88aaff",onChange:W=>{lt(W),oe.current=W}}),a.jsx(Bl,{label:"Wind",val:ht,min:-2,max:2,step:.1,fmt:W=>W>0?`${W.toFixed(1)}`:W<0?`${Math.abs(W).toFixed(1)}`:"0",color:"#66ccff",onChange:W=>{_t(W),le.current=W}}),a.jsx(Bl,{label:"Temperature",val:Ie,min:0,max:1,step:.01,fmt:W=>W<.3?"Cold":W>.7?"Hot":"Mild",color:"#ff8844",onChange:W=>{at(W),pe.current=W}}),a.jsx(Bl,{label:"Drag",val:St,min:.9,max:1,step:.001,fmt:W=>W.toFixed(3),color:"#aa88ff",onChange:W=>{ye(W),ce.current=W}}),a.jsxs("div",{className:"border-t border-white/[0.04] pt-2 flex flex-col gap-2",children:[a.jsx("div",{className:"text-[5.5px] font-mono uppercase tracking-widest text-white/18 mb-0.5",children:"Physics"}),a.jsx(Bl,{label:"Fluid Pressure",val:yt,min:0,max:1,step:.05,fmt:W=>W.toFixed(2),color:"#2266ff",onChange:W=>{Et(W),Ft.current=W,s.current.fluidPressure=W}}),a.jsx(Bl,{label:"Obj Buoyancy",val:me,min:0,max:1,step:.05,fmt:W=>W.toFixed(2),color:"#44ccaa",onChange:W=>{cn(W),Xt.current=W}}),a.jsx(Bl,{label:"Heat Diffusion",val:Dt,min:0,max:1,step:.05,fmt:W=>W.toFixed(2),color:"#ff8844",onChange:W=>{ne(W),Ne.current=W}})]}),a.jsxs("div",{className:"border-t border-white/[0.04] pt-2 flex flex-col gap-0.5",children:[a.jsx("div",{className:"text-[5.5px] font-mono uppercase tracking-widest text-white/18 mb-0.5",children:"Weather"}),a.jsxs("div",{className:"grid grid-cols-3 gap-0.5",children:[a.jsx("button",{onClick:()=>{const W=s.current;for(let X=0;X<40;X++){const Te=5+(Math.random()*(Er-10)|0);W.get(Te,2)===V.EMPTY&&W.set(Te,2,V.WATER)}},className:`py-0.5 rounded text-[6px] font-mono border border-blue-400/12
                            text-blue-300/35 hover:bg-blue-500/6 transition-all`,children:" Rain"}),a.jsx("button",{onClick:()=>{const W=s.current;for(let X=0;X<20;X++){const Te=5+(Math.random()*(Er-10)|0);W.get(Te,2)===V.EMPTY&&W.set(Te,2,V.SNOW)}},className:`py-0.5 rounded text-[6px] font-mono border border-blue-200/12
                            text-blue-200/30 hover:bg-blue-200/6 transition-all`,children:" Snow"}),a.jsx("button",{onClick:()=>{const W=s.current;for(let X=0;X<15;X++){const Te=5+(Math.random()*(Er-10)|0);W.set(Te,2,V.FIRE)}},className:`py-0.5 rounded text-[6px] font-mono border border-orange-400/12
                            text-orange-300/30 hover:bg-orange-500/6 transition-all`,children:" Meteor"}),a.jsx("button",{onClick:()=>{const W=s.current;for(let X=0;X<10;X++){const Te=5+(Math.random()*(Er-10)|0);W.get(Te,2)===V.EMPTY&&W.set(Te,2,V.GAS)}},className:`py-0.5 rounded text-[6px] font-mono border border-green-400/12
                            text-green-300/30 hover:bg-green-500/6 transition-all`,children:" Gas Cloud"}),a.jsx("button",{onClick:()=>{const W=s.current,X=Math.floor(kr*.7);for(let Te=X;Te<kr-2;Te++)for(let He=1;He<Er-1;He++)W.get(He,Te)===V.EMPTY&&W.set(He,Te,V.WATER)},className:`py-0.5 rounded text-[6px] font-mono border border-cyan-400/12
                            text-cyan-300/30 hover:bg-cyan-500/6 transition-all`,children:" Flood"}),a.jsx("button",{onClick:()=>{const W=s.current;for(let X=0;X<kr;X++)for(let Te=0;Te<Er;Te++)W.get(Te,X)===V.WATER&&W.set(Te,X,V.EMPTY)},className:`py-0.5 rounded text-[6px] font-mono border border-red-300/12
                            text-red-300/25 hover:bg-red-400/6 transition-all`,children:" Clear Water"})]})]}),a.jsxs("div",{className:"border-t border-white/[0.04] pt-2 flex flex-col gap-1",children:[a.jsx("div",{className:"text-[5.5px] font-mono uppercase tracking-widest text-white/18 mb-0.5",children:"Presets"}),[{label:"Normal",g:1,w:0,t:.5,d:.99},{label:"Zero-G",g:0,w:0,t:.5,d:.995},{label:"Heavy",g:2.5,w:0,t:.5,d:.98},{label:"Windy",g:1,w:1.5,t:.5,d:.99},{label:"Ice World",g:1,w:.3,t:.1,d:.998},{label:"Volcanic",g:1.2,w:0,t:.9,d:.985},{label:"Moon",g:.16,w:0,t:.2,d:.998}].map(W=>a.jsx("button",{onClick:()=>{lt(W.g),_t(W.w),at(W.t),ye(W.d),oe.current=W.g,le.current=W.w,pe.current=W.t,ce.current=W.d},className:`w-full py-0.5 px-1.5 rounded text-[6px] font-mono border border-white/[0.04]
                            text-white/25 hover:bg-white/[0.04] hover:text-white/50 transition-all text-left`,children:W.label},W.label))]})]}),Le==="ecosystem"&&a.jsxs("div",{className:"px-2 pt-1 flex flex-col gap-2",children:[a.jsx("div",{className:"text-[5.5px] font-mono text-white/25 leading-relaxed",children:"Prey/Predator ecosystem  herbivores eat plants, carnivores hunt smaller creatures. Balanced by food chain."}),a.jsxs("div",{className:"flex flex-col gap-0.5",children:[a.jsx("div",{className:"text-[5.5px] font-mono uppercase tracking-widest text-white/18 mb-0.5",children:"Diet Legend"}),a.jsxs("div",{className:"flex gap-1 text-[6px] font-mono",children:[a.jsx("span",{className:"px-1 rounded bg-green-500/10 text-green-300/60",children:" Herb"}),a.jsx("span",{className:"px-1 rounded bg-red-500/10 text-red-300/60",children:" Carn"}),a.jsx("span",{className:"px-1 rounded bg-amber-500/10 text-amber-300/60",children:" Omni"})]})]}),a.jsxs("div",{className:"border-t border-white/[0.04] pt-1.5",children:[a.jsx("div",{className:"text-[5.5px] font-mono uppercase tracking-widest text-white/18 mb-1",children:"Population by Diet"}),a.jsx("div",{className:"flex flex-col gap-0.5 text-[6px] font-mono",children:(()=>{const W={herbivore:0,carnivore:0,omnivore:0};for(const X of u.current)X.alive&&W[X.bp.diet]++;return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-green-300/50",children:" Herbivores"}),a.jsx("span",{className:"text-green-300/70",children:W.herbivore})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-red-300/50",children:" Carnivores"}),a.jsx("span",{className:"text-red-300/70",children:W.carnivore})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-amber-300/50",children:" Omnivores"}),a.jsx("span",{className:"text-amber-300/70",children:W.omnivore})]}),a.jsxs("div",{className:"flex justify-between mt-1 border-t border-white/[0.03] pt-1",children:[a.jsx("span",{className:"text-white/30",children:"Total Alive"}),a.jsx("span",{className:"text-white/55",children:W.herbivore+W.carnivore+W.omnivore})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-white/20",children:"Ragdoll Corpses"}),a.jsx("span",{className:"text-white/35",children:Ke.current.length})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-white/20",children:"Plants"}),a.jsx("span",{className:"text-white/35",children:f.current.length})]})]})})()})]}),a.jsxs("div",{className:"border-t border-white/[0.04] pt-1.5 flex flex-col gap-0.5",children:[a.jsx("div",{className:"text-[5.5px] font-mono uppercase tracking-widest text-white/18 mb-0.5",children:"Quick Actions"}),a.jsx("button",{onClick:()=>{const W=Ic.filter(X=>X.diet==="herbivore");for(let X=0;X<3;X++)Ir(W[Math.floor(Math.random()*W.length)])},className:`w-full py-0.5 rounded text-[6px] font-mono border border-green-400/12
                          text-green-300/40 hover:bg-green-500/6 transition-all`,children:" Spawn 3 Herbivores"}),a.jsx("button",{onClick:()=>{const W=Ic.filter(X=>X.diet==="carnivore");for(let X=0;X<2;X++)Ir(W[Math.floor(Math.random()*W.length)])},className:`w-full py-0.5 rounded text-[6px] font-mono border border-red-400/12
                          text-red-300/35 hover:bg-red-500/6 transition-all`,children:" Spawn 2 Carnivores"}),a.jsx("button",{onClick:()=>{for(let W=0;W<5;W++){const X=Cy[Math.floor(Math.random()*Cy.length)],Te=20+Math.random()*(Er-40);vo(X.id,Te,kr*.5)}},className:`w-full py-0.5 rounded text-[6px] font-mono border border-green-400/12
                          text-green-300/35 hover:bg-green-500/6 transition-all`,children:" Seed 5 Random Plants"}),a.jsx("button",{onClick:()=>s.current.spawnFood(30),className:`w-full py-0.5 rounded text-[6px] font-mono border border-emerald-400/12
                          text-emerald-300/35 hover:bg-emerald-500/6 transition-all`,children:" Flood Food (30)"}),a.jsx("button",{onClick:()=>{Ke.current=[]},className:`w-full py-0.5 rounded text-[6px] font-mono border border-white/[0.04]
                          text-white/20 hover:bg-white/[0.04] transition-all`,children:" Clear Corpses"})]}),a.jsxs("div",{className:"border-t border-white/[0.04] pt-1.5",children:[a.jsx("div",{className:"text-[5.5px] font-mono uppercase tracking-widest text-white/18 mb-0.5",children:"Plant Tools"}),a.jsx("div",{className:"text-[5px] font-mono text-white/15 mb-1",children:"Select tool  click near a plant on canvas"}),a.jsx("div",{className:"grid grid-cols-2 gap-0.5",children:My.map(W=>a.jsxs("button",{onClick:()=>{rt(W.id),dt("plant_tool")},title:W.desc,className:`flex items-center gap-1 px-1 py-0.5 rounded text-[6px] font-mono
                              border transition-all ${zn===W.id&&et==="plant_tool"?"bg-white/8 border-white/15":"border-transparent text-white/28 hover:bg-white/[0.04] hover:text-white/50"}`,style:{color:zn===W.id&&et==="plant_tool"?W.color:void 0},children:[a.jsx("span",{className:"text-[8px]",children:W.icon}),W.label]},W.id))})]})]})]}),a.jsx("div",{className:"px-2 py-1.5 border-t border-white/[0.04]",children:a.jsxs("div",{className:"text-[5px] font-mono text-white/10 leading-relaxed",children:["Scroll=zoom  Alt+drag=pan  Space=pause",a.jsx("br",{}),"C=rand-spawn  F=food  R=reset  1-8=tools"]})})]})]}),a.jsxs("div",{className:"flex-1 relative overflow-hidden",children:[a.jsx("canvas",{ref:t,className:"absolute inset-0 w-full h-full",style:{imageRendering:"pixelated",cursor:et==="grab"?"grab":et==="paint"||et==="erase"?"crosshair":et==="creature"?"cell":et==="drop"||et==="plant"?"copy":et==="power"||et==="plant_tool"?"pointer":et==="inspect"?"help":"default"},onPointerDown:Ua,onPointerMove:Na,onPointerUp:sa,onPointerLeave:sa,onWheel:So}),!te&&a.jsx("div",{className:`absolute top-2 left-1/2 -translate-x-1/2 z-10 pointer-events-none
              text-[7px] font-mono text-white/25 bg-black/50 px-3 py-1 rounded border border-white/8`,children:" PAUSED  Space to resume"}),bt&&bt.alive&&Le!=="creatures"&&a.jsx("div",{className:`absolute bottom-3 left-3 z-10 pointer-events-auto
              px-2.5 py-1.5 rounded-lg bg-black/70 border border-teal-400/20 backdrop-blur-sm cursor-pointer`,onClick:()=>K("creatures"),children:a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx(vl,{size:7,className:"text-teal-300/50"}),a.jsxs("span",{className:"text-[6.5px] font-mono text-teal-200/60",children:[bt.bp.icon," ",bt.bp.name]}),a.jsxs("span",{className:"text-[5.5px] font-mono",style:{color:bt.energy<40?"#ff6666":bt.energy>120?"#66ff88":"#aacc88"},children:["",bt.energy.toFixed(0)]})]})}),(hn==null?void 0:hn.running)&&a.jsx("div",{className:`absolute bottom-3 left-1/2 -translate-x-1/2 z-10 pointer-events-none
              px-4 py-2 rounded-lg bg-black/70 border border-purple-400/25 backdrop-blur-sm`,children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-400 animate-pulse"}),a.jsxs("div",{className:"flex flex-col gap-0.5",children:[a.jsxs("span",{className:"text-[7px] font-mono text-purple-200/80 font-bold",children:["EVOLVING  Gen ",hn.generation]}),a.jsxs("span",{className:"text-[6px] font-mono text-purple-300/50",children:["Candidate ",hn.candidateIdx+1,"/",hn.popSize,"  best ",hn.bestScore>-1/0?hn.bestScore.toFixed(1):""]})]})]})})]})]}),Xn&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",onClick:W=>{W.target===W.currentTarget&&Pt(!1)},children:a.jsxs("div",{className:`bg-[#080c14] border border-white/[0.06] rounded-xl w-[480px] max-h-[60vh]
            flex flex-col overflow-hidden`,children:[a.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-white/[0.05]",children:[a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx(Ax,{size:10,className:"text-amber-400/50"}),a.jsx("span",{className:"text-[8px] font-mono uppercase tracking-widest text-white/40",children:"Species Gallery"})]}),a.jsx("button",{onClick:()=>Pt(!1),className:"text-white/20 hover:text-white/50 text-[9px] font-mono",children:""})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-2",style:{scrollbarWidth:"none"},children:[it.length===0&&a.jsx("div",{className:"text-center text-[7px] font-mono text-white/15 py-6",children:"No species saved yet. Train in Evolve tab and save."}),a.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:it.map(W=>a.jsxs("div",{className:"p-2 rounded bg-white/[0.02] border border-white/[0.04] flex flex-col gap-1",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-[12px]",children:W.bp.icon}),a.jsxs("div",{children:[a.jsx("div",{className:"text-[7px] font-mono text-white/55",children:W.bp.name}),a.jsxs("div",{className:"text-[5.5px] font-mono text-white/22",children:["G",W.generation,"  ",W.bestScore.toFixed(1)]})]})]}),a.jsx("button",{onClick:()=>{const X=pd.find(He=>He.id===I.current)??pd[0],Te=wy(s.current,X.spawnX,X.spawnY);u.current.push(Pd(W.bp,X.spawnX,Te,W.bestParams.slice())),Pt(!1)},className:`py-0.5 rounded text-[6px] font-mono border border-cyan-400/15
                        text-cyan-300/40 hover:bg-cyan-500/6 transition-all`,children:"Adopt"})]},W.id))})]})]})})]})},fg={tree:{maxDepth:8,segLen:12,lenDecay:.82,thickDecay:.72,branchAngle:.5,angleJitter:.3,branchProb:.6,maxBranches:3,growUp:!0,needsWater:!1,trunkDepth:3},vine:{maxDepth:12,segLen:6,lenDecay:.92,thickDecay:.88,branchAngle:.55,angleJitter:.7,branchProb:.3,maxBranches:3,growUp:!1,needsWater:!1,trunkDepth:0},coral:{maxDepth:7,segLen:6,lenDecay:.82,thickDecay:.75,branchAngle:.65,angleJitter:.8,branchProb:.55,maxBranches:4,growUp:!1,needsWater:!0,trunkDepth:1},mushroom:{maxDepth:5,segLen:10,lenDecay:.5,thickDecay:.5,branchAngle:1.2,angleJitter:.35,branchProb:.85,maxBranches:5,growUp:!0,needsWater:!1,trunkDepth:3},fern:{maxDepth:8,segLen:8,lenDecay:.82,thickDecay:.78,branchAngle:.45,angleJitter:.25,branchProb:.7,maxBranches:2,growUp:!0,needsWater:!1,trunkDepth:1},cactus:{maxDepth:5,segLen:10,lenDecay:.7,thickDecay:.65,branchAngle:.25,angleJitter:.12,branchProb:.25,maxBranches:2,growUp:!0,needsWater:!1,trunkDepth:2},kelp:{maxDepth:10,segLen:8,lenDecay:.93,thickDecay:.9,branchAngle:.18,angleJitter:.12,branchProb:.15,maxBranches:2,growUp:!0,needsWater:!0,trunkDepth:5},bamboo:{maxDepth:12,segLen:10,lenDecay:.97,thickDecay:.95,branchAngle:.12,angleJitter:.05,branchProb:.08,maxBranches:2,growUp:!0,needsWater:!1,trunkDepth:9},moss:{maxDepth:4,segLen:2.5,lenDecay:.8,thickDecay:.7,branchAngle:1,angleJitter:1.2,branchProb:.75,maxBranches:5,growUp:!1,needsWater:!1,trunkDepth:0},sunflower:{maxDepth:6,segLen:12,lenDecay:.55,thickDecay:.55,branchAngle:.35,angleJitter:.06,branchProb:.08,maxBranches:2,growUp:!0,needsWater:!1,trunkDepth:5},lily:{maxDepth:4,segLen:3,lenDecay:.75,thickDecay:.65,branchAngle:.8,angleJitter:.7,branchProb:.6,maxBranches:4,growUp:!1,needsWater:!0,trunkDepth:0},mangrove:{maxDepth:8,segLen:10,lenDecay:.82,thickDecay:.72,branchAngle:.55,angleJitter:.45,branchProb:.5,maxBranches:3,growUp:!0,needsWater:!1,trunkDepth:2},orchid:{maxDepth:6,segLen:7,lenDecay:.72,thickDecay:.65,branchAngle:.45,angleJitter:.3,branchProb:.35,maxBranches:3,growUp:!0,needsWater:!1,trunkDepth:3},pitcher:{maxDepth:5,segLen:8,lenDecay:.7,thickDecay:.6,branchAngle:.7,angleJitter:.5,branchProb:.4,maxBranches:3,growUp:!0,needsWater:!1,trunkDepth:2},bonsai:{maxDepth:7,segLen:6,lenDecay:.8,thickDecay:.7,branchAngle:.55,angleJitter:.45,branchProb:.6,maxBranches:3,growUp:!0,needsWater:!1,trunkDepth:1}};function xR(e,t,r,o){const s=fg[t]??fg.tree;if(o>=s.maxDepth||e.x<2||e.x>Er-2||e.y<2||e.y>kr-2||r.isSolid(e.x|0,e.y|0)||s.needsWater&&o>0&&r.cellAt(e.x|0,e.y|0)!==V.WATER)return;const l=o<s.trunkDepth,i=l?1:Math.random()<s.branchProb?1+Math.floor(Math.random()*s.maxBranches):1,u=s.segLen*Math.pow(s.lenDecay,o);for(let c=0;c<i;c++){let d=e.angle;if(l)d+=(Math.random()-.5)*s.angleJitter*.3;else if(i>1){const m=s.branchAngle,y=i>1?c/(i-1)-.5:0;d+=y*m*2+(Math.random()-.5)*s.angleJitter}else d+=(Math.random()-.5)*s.angleJitter;if(s.growUp){const m=o<s.trunkDepth?.7:.4;d=d*(1-m)+-Math.PI/2*m}const h=e.x+Math.cos(d)*u,f=e.y+Math.sin(d)*u;if(h<2||h>Er-2||f<2||f>kr-2||r.isSolid(h|0,f|0))continue;const g={x:h,y:f,vx:0,vy:0,restDx:h-e.x,restDy:f-e.y,age:0,thickness:Math.max(.15,e.thickness*s.thickDecay),children:[],angle:d,alive:!0};e.children.push(g),Math.random()<.96-o*.02&&xR(g,t,r,o+1)}}function bR(e,t,r,o){if(!e.alive||o>50)return;e.age++;const s=fg[t.species]??fg.tree;if(!(s.needsWater&&o>0&&r.cellAt(e.x|0,e.y|0)!==V.WATER)){if(e.children.length===0){const l=1/(1+Math.max(0,o-s.maxDepth)*.25),i=t.growthRate*.15*l*(o<s.trunkDepth?.3:1);if(Math.random()<i){const c=s.segLen*Math.pow(s.lenDecay,o)*(.7+Math.random()*.3);let d=e.angle+(Math.random()-.5)*s.angleJitter;if(s.growUp){const g=o<s.trunkDepth?.7:.4;d=d*(1-g)+-Math.PI/2*g}const h=e.x+Math.cos(d)*c,f=e.y+Math.sin(d)*c;h>2&&h<Er-2&&f>2&&f<kr-2&&!r.isSolid(h|0,f|0)&&e.children.push({x:h,y:f,vx:0,vy:0,restDx:h-e.x,restDy:f-e.y,age:0,thickness:Math.max(.12,e.thickness*s.thickDecay),children:[],angle:d,alive:!0})}if(e.age>8&&Math.random()<s.branchProb*.06&&e.children.length<s.maxBranches){const c=Math.random()<.5?-1:1,d=e.angle+c*s.branchAngle*(.6+Math.random()*.4),h=s.segLen*Math.pow(s.lenDecay,o)*.7,f=e.x+Math.cos(d)*h,g=e.y+Math.sin(d)*h;f>2&&f<Er-2&&g>2&&g<kr-2&&!r.isSolid(f|0,g|0)&&e.children.push({x:f,y:g,vx:0,vy:0,restDx:f-e.x,restDy:g-e.y,age:0,thickness:Math.max(.1,e.thickness*s.thickDecay*.6),children:[],angle:d,alive:!0})}if((t.species==="sunflower"||t.species==="orchid"||t.species==="tree"||t.species==="mangrove")&&e.age>50&&Math.random()<.008){const c=e.x+(Math.random()-.5)*3|0,d=e.y+1|0;r.get(c,d)===V.EMPTY&&r.set(c,d,V.FOOD)}}o<3&&e.age%60===0&&(e.thickness=Math.min(4,e.thickness+.02));for(const l of e.children)bR(l,t,r,o+1)}}function vR(e,t,r,o,s){if(!e.alive)return;const l=t.species;if(!!r){const u=r.x+e.restDx,c=r.y+e.restDy,h=(l==="bamboo"?.55:l==="cactus"?.65:l==="tree"?.45:l==="vine"?.12:l==="kelp"?.1:l==="fern"?.35:l==="mushroom"?.5:l==="moss"?.3:l==="bonsai"?.5:l==="mangrove"?.42:l==="sunflower"?.4:.35)+e.thickness*.1;e.vx+=(u-e.x)*h,e.vy+=(c-e.y)*h;const f=(1-Math.min(1,e.thickness*.3))*.06;e.vx+=o*f;const g=l==="vine"?.025:l==="kelp"?-.008:l==="moss"?.012:.008;e.vy+=g*s;const m=t.age*.012+e.restDx*.3+e.restDy*.2;l==="kelp"||l==="coral"?e.vx+=Math.sin(m*.8+e.y*.1)*.015:l==="vine"?e.vx+=Math.sin(m*.5)*.008:l==="bamboo"?e.vx+=Math.sin(m*2)*.004:(l==="sunflower"||l==="fern")&&(e.vx+=Math.sin(m*.7)*.005,e.vy+=Math.cos(m*.5)*.002),e.vx*=.78,e.vy*=.78,e.x+=e.vx,e.y+=e.vy;const y=e.x-r.x,v=e.y-r.y,b=Math.sqrt(y*y+v*v),C=Math.sqrt(e.restDx*e.restDx+e.restDy*e.restDy)*1.4;if(b>C&&b>.1){const k=C/b;e.x=r.x+y*k,e.y=r.y+v*k}e.x=Math.max(2,Math.min(Er-2,e.x)),e.y=Math.max(2,Math.min(kr-2,e.y))}for(const u of e.children)vR(u,t,e,o,s)}function W5(e,t,r,o){if(!e.alive)return;const s=e.x-t,l=e.y-r,i=s*s+l*l;i<o.dist&&(o.dist=i,o.node=e);for(const u of e.children)W5(u,t,r,o)}const Qq={tree:110,vine:130,coral:340,mushroom:280,fern:120,cactus:100,kelp:155,bamboo:115,moss:105,sunflower:50,lily:330,mangrove:140,orchid:310,pitcher:135,bonsai:95};function eW(e,t,r,o,s,l,i){e.fillStyle=i;let u=Math.round(t),c=Math.round(r);const d=Math.round(o),h=Math.round(s),f=Math.abs(d-u),g=-Math.abs(h-c),m=u<d?1:-1,y=c<h?1:-1;let v=f+g;const b=Math.max(0,Math.round(l*.5));for(let S=0;S<200&&(b<=0?e.fillRect(u,c,1,1):(e.fillRect(u-b,c,1+b*2,1),e.fillRect(u,c-b,1,1+b*2)),!(u===d&&c===h));S++){const C=2*v;C>=g&&(v+=g,u+=m),C<=f&&(v+=f,c+=y)}}function SR(e,t,r,o,s=0){const l=Qq[r.species]??120,i=r.species;r.age*.02;for(const u of t.children){if(!u.alive)continue;const c=Math.max(0,t.thickness*Math.pow(.88,s));let d;if(i==="mushroom"&&s<3)d=`hsl(30,20%,${22+s*3}%)`;else if(i==="cactus")d=`hsl(${l},55%,${28+s*3}%)`;else if(i==="bamboo")d=s%3===0&&s>0?`hsl(${l},30%,30%)`:`hsl(${l},50%,${32+s*2}%)`;else if(i==="coral")d=`hsl(${l+s*10},${65+s*3}%,${35+s*5}%)`;else if(i==="kelp")d=`hsl(${l},45%,${25+s*3}%)`;else{const f=Math.max(0,1-s/4),g=l*(1-f)+30*f,m=25+(1-f)*45,y=20+s*3;d=`hsl(${g},${m}%,${y}%)`}eW(e,t.x,t.y,u.x,u.y,c,d),u.children.length===0&&u.alive&&s>1&&tW(e,u.x,u.y,i,l,s,t.thickness),SR(e,u,r,o,s+1)}}function tW(e,t,r,o,s,l,i,u){const c=Math.round(t),d=Math.round(r),h=(f,g,m)=>{e.fillStyle=m,e.fillRect(Math.round(f),Math.round(g),1,1)};switch(o){case"tree":case"bonsai":case"mangrove":{const f=`hsl(${s+10},55%,32%)`,g=`hsl(${s+20},60%,40%)`,m=`hsl(${s+5},50%,28%)`;h(c,d,f),h(c-1,d,g),h(c+1,d,g),h(c,d-1,g),h(c,d+1,m),i>1&&(h(c-1,d-1,m),h(c+1,d-1,m),h(c-2,d,g),h(c+2,d,g));break}case"fern":{const f=`hsl(${s+15},60%,36%)`,g=l%2===0?1:-1;h(c,d,f),h(c+g,d-1,f),h(c+g*2,d-2,f);break}case"mushroom":{if(l>=2){const f=`hsl(${s},50%,38%)`,g=`hsl(${s+30},40%,55%)`,m=`hsl(${s-10},55%,30%)`;for(let y=-3;y<=3;y++)h(c+y,d-1,f);for(let y=-2;y<=2;y++)h(c+y,d-2,f);h(c-1,d-3,f),h(c,d-3,f),h(c+1,d-3,f),h(c-1,d-2,g),h(c+1,d-2,g),h(c-2,d,m),h(c+2,d,m)}break}case"coral":{const f=`hsl(${s},80%,60%)`;h(c,d,f),h(c+1,d,f),h(c,d-1,f),e.fillStyle=`hsla(${s},85%,65%,0.3)`,e.fillRect(c-1,d-1,3,3);break}case"sunflower":{if(l>=4){const f="hsl(50,85%,55%)",g="hsl(30,70%,22%)";h(c-2,d,f),h(c+2,d,f),h(c,d-2,f),h(c,d+2,f),h(c-1,d-1,f),h(c+1,d-1,f),h(c-1,d+1,f),h(c+1,d+1,f),h(c,d,g),h(c-1,d,g),h(c+1,d,g),h(c,d-1,g),h(c,d+1,g)}else h(c,d,`hsl(${s+60},50%,35%)`);break}case"orchid":{if(l>=3){const f=`hsl(${s},65%,58%)`,g=`hsl(${s+40},70%,68%)`;h(c,d-2,f),h(c-2,d,f),h(c+2,d,f),h(c-1,d+1,f),h(c+1,d+1,f),h(c,d,g)}break}case"vine":case"moss":{h(c,d,`hsl(${s+15},55%,36%)`),h(c+(l%2===0?1:-1),d,`hsl(${s+10},50%,32%)`);break}case"cactus":{const f="hsl(60,30%,58%)";h(c-2,d,f),h(c+2,d,f),h(c,d-2,f),h(c,d+2,f);break}case"kelp":{const f=`hsl(${s},45%,33%)`;h(c,d,f),h(c,d-1,f),h(c+1,d,f);break}case"bamboo":{const f=`hsl(${s+10},50%,38%)`;h(c-1,d,f),h(c+1,d,f),h(c-2,d-1,f),h(c+2,d-1,f);break}case"lily":{const f="hsl(140,50%,30%)";for(let g=-2;g<=2;g++)h(c+g,d,f);for(let g=-1;g<=1;g++)h(c+g,d-1,f);if(l>=2){const g=`hsl(${s},60%,62%)`;h(c,d-1,g),h(c-1,d-2,g),h(c+1,d-2,g)}break}case"pitcher":{const f=`hsl(${s},45%,33%)`,g=`hsl(${s+30},55%,43%)`;h(c-1,d,f),h(c+1,d,f),h(c-1,d-1,f),h(c+1,d-1,f),h(c-1,d-2,f),h(c+1,d-2,f),h(c-2,d-3,g),h(c-1,d-3,g),h(c,d-3,g),h(c+1,d-3,g),h(c+2,d-3,g);break}default:h(c,d,`hsl(${s+20},55%,38%)`),h(c+1,d,`hsl(${s+20},55%,38%)`)}}function nW(e,t,r){const o=yR.find(u=>u.id===t.type),s=(o==null?void 0:o.color)??"#ffffff",l=t.x,i=t.y;switch(e.save(),t.type){case"bomb":case"c4":case"nuke":{const u=Math.sin(r*.3)>0&&t.life>30;e.beginPath(),e.arc(l,i,t.type==="nuke"?3:2,0,Math.PI*2),e.fillStyle=u?"#ff0000":s+"cc",e.shadowColor=s,e.shadowBlur=4,e.fill(),e.shadowBlur=0,t.life>0&&t.type==="bomb"&&(e.beginPath(),e.arc(l,i-2.5,.5,0,Math.PI*2),e.fillStyle=`hsl(${r*20%60},100%,70%)`,e.fill());break}case"fan":{const u=r*.15;for(let c=0;c<3;c++){const d=u+c*Math.PI*2/3;e.beginPath(),e.moveTo(l,i),e.lineTo(l+Math.cos(d)*3,i+Math.sin(d)*3),e.strokeStyle=s+"88",e.lineWidth=.6,e.stroke()}e.beginPath(),e.arc(l,i,.8,0,Math.PI*2),e.fillStyle=s+"aa",e.fill();break}case"attractor":case"repulsor":{const u=Math.sin(r*.08)*2+5;e.beginPath(),e.arc(l,i,u,0,Math.PI*2),e.strokeStyle=s+"30",e.lineWidth=.3,e.stroke(),e.beginPath(),e.arc(l,i,1.5,0,Math.PI*2),e.fillStyle=s+"cc",e.shadowColor=s,e.shadowBlur=6,e.fill(),e.shadowBlur=0;break}case"heater":case"cooler":{e.beginPath(),e.arc(l,i,2,0,Math.PI*2),e.fillStyle=s+"88",e.shadowColor=s,e.shadowBlur=8,e.fill(),e.shadowBlur=0;for(let u=0;u<3;u++){const c=r*.05+u*2.1,d=3+Math.sin(r*.1+u)*1.5;e.beginPath(),e.arc(l+Math.cos(c)*d,i+Math.sin(c)*d,.4,0,Math.PI*2),e.fillStyle=s+"44",e.fill()}break}case"lightning":{e.beginPath();let u=l,c=i;for(let d=0;d<8;d++)u+=(Math.random()-.5)*3,c+=4,e.lineTo(u,c);e.strokeStyle="#ffff88",e.lineWidth=.5,e.shadowColor="#ffff00",e.shadowBlur=6,e.stroke(),e.shadowBlur=0;break}case"virus":{const u=Math.sin(r*.12)*.5+1.5;e.beginPath(),e.arc(l,i,u,0,Math.PI*2),e.fillStyle="#88ff4466",e.fill();for(let c=0;c<6;c++){const d=c*Math.PI/3+r*.02;e.beginPath(),e.moveTo(l,i),e.lineTo(l+Math.cos(d)*(u+1),i+Math.sin(d)*(u+1)),e.strokeStyle="#88ff4444",e.lineWidth=.2,e.stroke()}break}case"blackhole":{for(let c=3;c>0;c--)e.beginPath(),e.arc(l,i,c*3+Math.sin(r*.05+c)*1,0,Math.PI*2),e.strokeStyle=`rgba(80,0,120,${.15/c})`,e.lineWidth=.5,e.stroke();e.beginPath(),e.arc(l,i,2,0,Math.PI*2),e.fillStyle="#1a0028",e.shadowColor="#6600aa",e.shadowBlur=10,e.fill(),e.shadowBlur=0;break}case"whitehole":{const u=Math.sin(r*.1)*1+3;e.beginPath(),e.arc(l,i,u,0,Math.PI*2),e.strokeStyle="rgba(255,255,255,0.15)",e.lineWidth=.3,e.stroke(),e.beginPath(),e.arc(l,i,1.5,0,Math.PI*2),e.fillStyle="rgba(255,255,255,0.7)",e.shadowColor="#ffffff",e.shadowBlur=8,e.fill(),e.shadowBlur=0;break}case"spring":{for(let u=0;u<5;u++){const c=i+u*.8-2;e.beginPath(),e.moveTo(l-1.5,c),e.quadraticCurveTo(l+(u%2===0?2:-2),c+.4,l+1.5,c+.8),e.strokeStyle="#44ff8888",e.lineWidth=.3,e.stroke()}break}case"vortex":{for(let u=0;u<3;u++){const c=r*.12+u*Math.PI*2/3,d=4+u*2.5+Math.sin(r*.06)*1.5;e.beginPath(),e.arc(l,i,d,c,c+1.2),e.strokeStyle=`rgba(68,136,255,${.3-u*.08})`,e.lineWidth=.4,e.stroke()}e.beginPath(),e.arc(l,i,1.2,0,Math.PI*2),e.fillStyle="#4488ffaa",e.shadowColor="#4488ff",e.shadowBlur=6,e.fill(),e.shadowBlur=0;break}case"motor":{const u=t.angle??r*.08;e.beginPath(),e.arc(l,i,2.5,0,Math.PI*2),e.strokeStyle="#ffaa44aa",e.lineWidth=.4,e.stroke();for(let c=0;c<4;c++){const d=u+c*Math.PI/2;e.beginPath(),e.moveTo(l+Math.cos(d)*1.8,i+Math.sin(d)*1.8),e.lineTo(l+Math.cos(d)*3.5,i+Math.sin(d)*3.5),e.strokeStyle="#ffaa4488",e.lineWidth=.6,e.lineCap="round",e.stroke()}e.beginPath(),e.arc(l,i,.8,0,Math.PI*2),e.fillStyle="#ffaa44cc",e.fill();break}case"laser":{t.life<(t.maxLife>0?t.maxLife:60)&&(e.beginPath(),e.moveTo(l,i),e.lineTo(l+(Math.random()-.5)*.5,i+50),e.strokeStyle="rgba(255,30,30,0.7)",e.lineWidth=.6,e.shadowColor="#ff2222",e.shadowBlur=8,e.stroke(),e.shadowBlur=0,e.beginPath(),e.arc(l,i,1,0,Math.PI*2),e.fillStyle="#ff4444cc",e.fill());break}case"spore":{const u=Math.sin(r*.08)*.5+1.5;e.beginPath(),e.arc(l,i,u*2,0,Math.PI*2),e.fillStyle="rgba(170,136,255,0.12)",e.fill();for(let c=0;c<5;c++){const d=r*.04+c*1.25,h=u+Math.sin(d*2)*1.5;e.beginPath(),e.arc(l+Math.cos(d)*h,i+Math.sin(d)*h,.4,0,Math.PI*2),e.fillStyle="rgba(170,136,255,0.5)",e.fill()}break}case"portal_in":{for(let u=0;u<3;u++){const c=r*.15+u*2.1;e.beginPath(),e.arc(l,i,3+u+Math.sin(c)*.8,0,Math.PI*2),e.strokeStyle=`rgba(255,68,255,${.25-u*.06})`,e.lineWidth=.4,e.stroke()}e.beginPath(),e.arc(l,i,1.5,0,Math.PI*2),e.fillStyle="#ff44ff88",e.shadowColor="#ff44ff",e.shadowBlur=6,e.fill(),e.shadowBlur=0;break}case"portal_out":{for(let u=0;u<3;u++){const c=-r*.15+u*2.1;e.beginPath(),e.arc(l,i,3+u+Math.sin(c)*.8,0,Math.PI*2),e.strokeStyle=`rgba(68,255,255,${.25-u*.06})`,e.lineWidth=.4,e.stroke()}e.beginPath(),e.arc(l,i,1.5,0,Math.PI*2),e.fillStyle="#44ffff88",e.shadowColor="#44ffff",e.shadowBlur=6,e.fill(),e.shadowBlur=0;break}case"ball":{e.beginPath(),e.arc(l,i,2,0,Math.PI*2),e.fillStyle="#ff88aacc",e.shadowColor="#ff88aa",e.shadowBlur=3,e.fill(),e.shadowBlur=0,e.beginPath(),e.arc(l-.5,i-.5,.6,0,Math.PI*2),e.fillStyle="rgba(255,255,255,0.3)",e.fill();break}case"box":{e.fillStyle="#88aaffcc",e.fillRect(l-2,i-2,4,4),e.strokeStyle="#88aaff44",e.lineWidth=.3,e.strokeRect(l-2,i-2,4,4);break}case"wheel":{const u=r*.1;e.beginPath(),e.arc(l,i,2.5,0,Math.PI*2),e.strokeStyle="#aabbccaa",e.lineWidth=.5,e.stroke();for(let c=0;c<4;c++){const d=u+c*Math.PI/2;e.beginPath(),e.moveTo(l,i),e.lineTo(l+Math.cos(d)*2.3,i+Math.sin(d)*2.3),e.strokeStyle="#aabbcc66",e.lineWidth=.3,e.stroke()}e.beginPath(),e.arc(l,i,.5,0,Math.PI*2),e.fillStyle="#aabbcccc",e.fill();break}default:e.beginPath(),e.arc(l,i,2,0,Math.PI*2),e.fillStyle=s+"88",e.fill()}e.restore()}const Fv=64,Zu={attractor:"#c8960a",repulsor:"#3a7fa0",channel:"#c0c8d0",barrier:"#aa2020",tunnel:"#9966cc"},qn=Fv;function rW(){return{C:new Float32Array(qn*qn),A:new Float32Array(qn*qn),S:new Float32Array(qn*qn)}}let ky=null,vS=null,SS=null;function oW(){return ky||(ky=new Float32Array(qn*qn),vS=new Float32Array(qn*qn),SS=new Float32Array(qn*qn)),[ky,vS,SS]}function aW(e,t){const r=Math.max(0,Math.min(qn-1,Math.floor(e*qn)));return Math.max(0,Math.min(qn-1,Math.floor(t*qn)))*qn+r}function hl(e,t,r){const o=t*(qn-1),s=r*(qn-1),l=Math.floor(o),i=Math.floor(s),u=o-l,c=s-i,d=Math.min(i,qn-1)*qn+Math.min(l,qn-1),h=Math.min(i,qn-1)*qn+Math.min(l+1,qn-1),f=Math.min(i+1,qn-1)*qn+Math.min(l,qn-1),g=Math.min(i+1,qn-1)*qn+Math.min(l+1,qn-1);return e[d]*(1-u)*(1-c)+e[h]*u*(1-c)+e[f]*(1-u)*c+e[g]*u*c}function wS(e,t,r,o,s,l,i){const u=aW(t,r);e.C[u]=Math.min(1,e.C[u]+o*i*.012),e.A[u]=Math.min(1,e.A[u]+s*i*.008),e.S[u]=Math.min(1,e.S[u]+l*i*.008)}function sW(e,t,r,o){const[s,l,i]=oW(),u=Math.min(.8,r.diffusion*t*12),c=r.decay*t*.8,d=r.globalMix*t*.04;let h=0,f=0,g=0;for(let m=0;m<qn*qn;m++)h+=e.C[m],f+=e.A[m],g+=e.S[m];h/=qn*qn,f/=qn*qn,g/=qn*qn;for(let m=0;m<qn;m++)for(let y=0;y<qn;y++){const v=m*qn+y,b=(m>0?m-1:m)*qn+y,S=(m<qn-1?m+1:m)*qn+y,C=m*qn+(y>0?y-1:y),k=m*qn+(y<qn-1?y+1:y),R=(e.C[b]+e.C[S]+e.C[C]+e.C[k])/4,j=(e.A[b]+e.A[S]+e.A[C]+e.A[k])/4,T=(e.S[b]+e.S[S]+e.S[C]+e.S[k])/4;if(s[v]=Math.max(0,(e.C[v]*(1-u)+R*u)*(1-c)+h*d),l[v]=Math.max(0,(e.A[v]*(1-u)+j*u)*(1-c)+f*d),i[v]=Math.max(0,(e.S[v]*(1-u)+T*u)*(1-c)+g*d),o){const _=(y/qn-.5)*2,P=(m/qn-.5)*2,I=_*_+P*P;if(I<.35){const $=t*.06*(1-I/.35),q=Math.min(i[v],$);i[v]-=q,l[v]=Math.min(1,l[v]+q*.7)}}}e.C.set(s),e.A.set(l),e.S.set(i)}function iW(e){let t=0,r=0,o=0;for(let c=0;c<qn*qn;c++)t+=e.C[c],r+=e.A[c],o+=e.S[c];const s=qn*qn,l=t/s,i=r/s,u=o/s;return{meanC:l,meanA:i,meanS:u,integration:Math.max(0,Math.min(1,i-u+.5)),tension:Math.min(1,u*4)}}const lW=["plumbum","sulphur","mercurius","sal","argentum","aurum"],gp={plumbum:{label:"Chumbo",latin:"Plumbum",color:"#7888a0",glowColor:"#5a6878",symbol:"",sizeBoost:1},sulphur:{label:"Enxofre",latin:"Sulphur",color:"#e0b800",glowColor:"#ffe040",symbol:"",sizeBoost:1.15},mercurius:{label:"Mercrio",latin:"Mercurius",color:"#60c8f0",glowColor:"#90e8ff",symbol:"",sizeBoost:.88},sal:{label:"Sal",latin:"Sal",color:"#c8d0e0",glowColor:"#e8f0ff",symbol:"",sizeBoost:1.05},argentum:{label:"Prata",latin:"Argentum",color:"#80acd8",glowColor:"#b0d8ff",symbol:"",sizeBoost:1.28},aurum:{label:"Ouro",latin:"Aurum",color:"#ffc107",glowColor:"#ffe566",symbol:"",sizeBoost:1.65}},yp=[{id:"calcinatio",from:"plumbum",to:"sulphur",operation:"Calcinatio",name:"Calcinao",path:"fire",conditions:[{type:"fire",min:.33,label:" Fogo >33%"},{type:"heat",min:.42,label:" Calor >42%"}],prob:.0014,hint:" Fogo +  Calor  o chumbo calcina em enxofre amarelo."},{id:"solutio",from:"plumbum",to:"mercurius",operation:"Solutio",name:"Dissoluo",path:"water",conditions:[{type:"water",min:.36,label:" gua >36%"},{type:"cool",max:.54,label:" Calor <54%"}],prob:.0014,hint:" gua +  Calor  o chumbo dissolve em mercrio fluido."},{id:"coagulatio",from:"sulphur",to:"sal",operation:"Coagulatio",name:"Coagulao",path:"earth",conditions:[{type:"earth",min:.28,label:" Terra >28%"},{type:"cool",max:.68,label:" Calor <68%"}],prob:.0012,hint:" Terra +  Calor  o enxofre cristaliza em sal."},{id:"sublimatio",from:"mercurius",to:"sal",operation:"Sublimatio",name:"Sublimao",path:"air",conditions:[{type:"air",min:.3,label:" Ar >30%"},{type:"coherence",min:.42,label:"Coerncia >42%"}],prob:.0012,hint:" Ar  partculas coerentes sublimam de mercrio para sal."},{id:"fermentatio",from:"sal",to:"argentum",operation:"Fermentatio",name:"Fermentao",path:"earth",conditions:[{type:"balance",min:.25,label:" Elementos ~25% cada"},{type:"coherence",min:.5,label:"Coerncia >50%"},{type:"heat",min:.28,max:.78,label:" Calor 28-78%"}],prob:.001,hint:" Equilibre os 4 elementos (~25% cada) + calor moderado. Sal fermenta em Prata."},{id:"coniunctio",from:"sulphur",to:"argentum",operation:"Coniunctio",name:"Conjuno",path:"conjunction",conditions:[{type:"conjunction",label:" Enxofre + Mercrio juntos"},{type:"heat",min:.33,max:.72,label:" Calor 33-72%"}],prob:9e-4,hint:" Segredo descoberto: ter Enxofre E Mercrio juntos desencadeia a Conjuno  as Bodas Qumicas!",secret:!0},{id:"projectio",from:"argentum",to:"aurum",operation:"Projectio",name:"Projeo",path:"final",conditions:[{type:"lapis_forged",label:" Lapis Forjado"},{type:"heat",min:.58,label:" Calor >58%"},{type:"pulse_any",label:"COAGULA / SOLVE"}],prob:.0016,hint:" Forge o Lapis (alta integrao),  Calor e pressione COAGULA para a Projeo Final!"}];function wR(e){const t=Math.max(Math.abs(e.earth-.25),Math.abs(e.water-.25),Math.abs(e.air-.25),Math.abs(e.fire-.25));return Math.max(0,1-t*4)}function cW(e,t,r,o,s,l,i){const u=(()=>{switch(e.type){case"fire":return t.fire;case"water":return t.water;case"earth":return t.earth;case"air":return t.air;case"heat":return r;case"cool":return 1-r;case"balance":return wR(t);case"coherence":return l;case"lapis_forged":return o==="FORGED"?1:0;case"conjunction":return i?1:0;case"pulse_any":return s==="COAGULA"||s==="SOLVE"?1:.2;default:return 0}})(),c=e.min??0,d=e.max??1;return e.type==="lapis_forged"||e.type==="conjunction"||e.type==="pulse_any"?u:e.min!=null&&e.max!=null?u<c?Math.max(0,u/c):u>d?Math.max(0,1-(u-d)/(1-d)):1:e.min!=null?u>=c?1:Math.max(0,u/c):e.max!=null?u<=d?1:Math.max(0,1-(u-d)/(1-d)):1}function fb(e,t,r,o,s,l,i){let u=1;for(const c of e.conditions)u*=cW(c,t,r,o,s,l,i);return u}function dW(e,t,r,o,s,l,i,u){const c=Math.random();for(const d of yp){if(d.from!==e||d.id==="coniunctio"&&!u)continue;const h=fb(d,o,s,l,i,r,u);if(h<=0)continue;const f=d.prob*h*(t*.5+.5);if(c<f)return d.to}if(e==="mercurius"&&u){const d=yp.find(f=>f.id==="coniunctio"),h=fb(d,o,s,l,i,r,u);if(h>0){const f=d.prob*h*(t*.5+.5);if(Math.random()<f)return"argentum"}}switch(e){case"sulphur":if(s>.9&&o.air>.4&&Math.random()<6e-4)return"plumbum";break;case"mercurius":if(s>.88&&Math.random()<5e-4)return"plumbum";break;case"argentum":if(s<.18&&r<.25&&Math.random()<4e-4)return"sal";break;case"aurum":if(s>.97&&Math.random()<3e-5)return"argentum";break}return null}const uW=[{id:"discover_sulphur",recipeId:"calcinatio",name:"Primeira Fasca",substance:"sulphur",threshold:1,hint:"Crie sua primeira partcula de Enxofre."},{id:"discover_mercury",recipeId:"solutio",name:"Primeira Gota",substance:"mercurius",threshold:1,hint:"Crie sua primeira partcula de Mercrio."},{id:"discover_sal",recipeId:"coagulatio",name:"Primeiro Cristal",substance:"sal",threshold:1,hint:"Cristalize Sal pela primeira vez."},{id:"discover_argentum",recipeId:"fermentatio",name:"Primeiro Brilho",substance:"argentum",threshold:1,hint:"Produza sua primeira Prata."},{id:"discover_aurum",recipeId:"projectio",name:" Grande Obra",substance:"aurum",threshold:1,hint:"Transmute Prata em Ouro. O Magistrio est completo."}];function CR(){const e=()=>({plumbum:0,sulphur:0,mercurius:0,sal:0,argentum:0,aurum:0});return{counts:e(),produced:e(),flashes:[],completedQuestIds:[],bannerLife:0,bannerText:"",bannerSubstance:null,conjunctionActive:!1,conjunctionDiscovered:!1}}function hW(e,t,r,o,s){e.produced[o]++,e.flashes.length<25&&e.flashes.push({x:t,y:r,substance:o,life:1}),s==="coniunctio"&&!e.conjunctionDiscovered&&(e.conjunctionDiscovered=!0)}function fW(e,t,r){const o={plumbum:0,sulphur:0,mercurius:0,sal:0,argentum:0,aurum:0};for(const s of t)o[s]++;e.counts=o,e.conjunctionActive=o.sulphur>=3&&o.mercurius>=3;for(let s=e.flashes.length-1;s>=0;s--)e.flashes[s].life-=r*1.5,e.flashes[s].life<=0&&e.flashes.splice(s,1);e.bannerLife>0&&(e.bannerLife-=r);for(const s of uW)e.completedQuestIds.includes(s.id)||(e.produced[s.substance]??0)>=s.threshold&&(e.completedQuestIds.push(s.id),gp[s.substance],e.bannerLife=5,e.bannerText=s.name,e.bannerSubstance=s.substance)}const zi=()=>Math.random(),wd=()=>(Math.random()-.5)*2;function pW(e,t,r,o){let s={...e};if(r==="SOLVE"){const u=o;s={earth:s.earth*(1-u*.5),water:Math.min(1,s.water+u*.25),air:Math.min(1,s.air+u*.25),fire:s.fire}}else if(r==="COAGULA"){const u=o;s={earth:Math.min(1,s.earth+u*.3),water:s.water*(1-u*.4),air:s.air*(1-u*.2),fire:Math.min(1,s.fire+u*.15)}}const l=s.earth+s.water+s.air+s.fire;l>0&&(s.earth/=l,s.water/=l,s.air/=l,s.fire/=l);const i=t;return{diffusion:.05+s.water*.4+s.air*.15,decay:.015+s.fire*.04-s.water*.01,globalMix:.02+s.air*.12,writeGain:.5+s.fire*1.2+i*.5,cohesion:.05+s.earth*.25,maxSpeed:.012+s.fire*.022+i*.018-s.earth*.008,springStr:.05+s.earth*.25-s.water*.04,mutationRate:.02+s.fire*.15+i*.12,thresholds:.35+s.earth*.25-s.fire*.15,breathStr:.008+s.water*.022,heat:i,transformRate:i*.15+s.fire*.08,tunnelProb:0}}function mW(e,t,r){const s=Math.cos(t*3.5+r*.15)*.5+Math.cos(e*3.5*.6+r*.28)*.5,l=Math.sin(e*3.5+r*.15)*.5+Math.sin(t*3.5*.6+r*.28)*.5;return[s,l]}function gW(e,t,r,o,s,l){const i=s-r,u=l-o,c=i*i+u*u;let d=c<1e-10?0:Math.max(0,Math.min(1,((e-r)*i+(t-o)*u)/c));const h=r+d*i,f=o+d*u,g=e-h,m=t-f;return{dist:Math.sqrt(g*g+m*m),closest:[h,f],t:d}}function yW(e,t,r,o,s,l,i,u){const c=r-e,d=o-t,h=i-s,f=u-l,g=c*f-d*h;if(Math.abs(g)<1e-10)return!1;const m=((s-e)*f-(l-t)*h)/g,y=((s-e)*d-(l-t)*c)/g;return m>=0&&m<=1&&y>=0&&y<=1}function xW(e,t,r,o,s,l){let i=0,u=0,c=!1,d=null;for(const h of o){if(!h.active)continue;const{dist:f,closest:g}=gW(e.x,e.y,h.x1,h.y1,h.x2,h.y2),[m,y]=g;switch(h.type){case"attractor":{const v=.12+h.strength*.12;if(f<v&&f>.001){const b=h.strength*(1-f/v)*.06;i+=(m-e.x)/f*b,u+=(y-e.y)/f*b}break}case"repulsor":{const v=.1+h.strength*.1;if(f<v&&f>.001){const b=h.strength*(1-f/v)*.08;i-=(m-e.x)/f*b,u-=(y-e.y)/f*b}break}case"channel":{const v=.08+h.strength*.08;if(f<v){const b=h.x2-h.x1,S=h.y2-h.y1,C=Math.sqrt(b*b+S*S)+.001,k=b/C,R=S/C,j=h.strength*(1-f/v);i+=k*j*.06,u+=R*j*.06,d=[k,R]}break}case"barrier":{const v=.025+h.strength*.01;if(f<v&&f>5e-4){const b=h.strength*(1-f/v)*.15;i-=(m-e.x)/f*b,u-=(y-e.y)/f*b}if(yW(e.x,e.y,t,r,h.x1,h.y1,h.x2,h.y2)){const b=1+s*2,S=e.charge*.15*b;if(Math.random()<S)c=!0,e.tunneling=!0;else{const C=h.x2-h.x1,k=h.y2-h.y1,R=Math.sqrt(C*C+k*k)+.001,j=k/R,T=-C/R,_=e.vx*j+e.vy*T;i-=j*_*2/l*.4,u-=T*_*2/l*.4}}break}case"tunnel":{const v=.1+h.strength*.1;if(f<v){const b=h.strength*(1-f/v);e.coherence=Math.min(1,e.coherence+b*l*.8),e.charge=Math.min(1,e.charge+b*l*.4),e.tunneling=Math.random()<b*.25}break}}}return{fx:i,fy:u,tunneled:c,channelDir:d}}function bW(e,t){const r=zi();let o;const{earth:s,water:l,air:i}=t;return r<s?o="earth":r<s+l?o="water":r<s+l+i?o="air":o="fire",{id:e,element:o,substance:"plumbum",x:.15+zi()*.7,y:.15+zi()*.7,vx:wd()*.004,vy:wd()*.004,charge:.1+zi()*.6,coherence:.2+zi()*.5,valence:wd()*.5,phase:zi(),age:0,linkId:-1,linkTtl:0,tunneling:!1}}function CS(e,t,r){const o=[];for(let s=0;s<e;s++)o.push(bW(s,t));return{agents:o,count:e,field:rW(),metrics:{integrationIndex:.5,tensionIndex:.1,noveltyIndex:.3,lapisCharge:0,meanCharge:.3},lapis:{state:"DORMANT",charge:0,forgeTimer:0,crackRisk:0},elapsed:0,tick:0,pulse:{op:"NONE",strength:0,duration:0,maxDur:0},activeEvent:null,eventTimer:0,breathPhase:0,elements:{...t},heat:r,transmutation:CR()}}const ga=12;let qf=[];function vW(e,t){if(qf.length<ga*ga)qf=Array.from({length:ga*ga},()=>[]);else for(let r=0;r<ga*ga;r++)qf[r].length=0;for(let r=0;r<t;r++){const o=e[r],s=Math.max(0,Math.min(ga-1,Math.floor(o.x*ga))),l=Math.max(0,Math.min(ga-1,Math.floor(o.y*ga)));qf[l*ga+s].push(r)}}function MS(e,t){const r=Math.max(0,Math.min(ga-1,Math.floor(e*ga))),o=Math.max(0,Math.min(ga-1,Math.floor(t*ga))),s=[];for(let l=-1;l<=1;l++)for(let i=-1;i<=1;i++){const u=r+i,c=o+l;u>=0&&u<ga&&c>=0&&c<ga&&s.push(...qf[c*ga+u])}return s}let kS=.5;function SW(e,t,r){if(t<=0||t>.1)return;e.elapsed+=t,e.tick++;const{agents:o,count:s,field:l}=e,i=pW(e.elements,e.heat,e.pulse.op,e.pulse.strength);e.breathPhase=e.elapsed/15%1,e.pulse.op!=="NONE"&&(e.pulse.duration-=t,e.pulse.strength=Math.max(0,e.pulse.duration/e.pulse.maxDur),e.pulse.duration<=0&&(e.pulse={op:"NONE",strength:0,duration:0,maxDur:0})),vW(o,s);for(let u=0;u<s;u++){const c=o[u];c.age+=t,c.tunneling=!1,c.linkTtl>0?c.linkTtl-=t:(c.linkId=-1,c.linkTtl=0),c.phase=(c.phase+t*.067)%1;let d=0,h=0;const[f,g]=mW(c.x,c.y,e.elapsed);d+=f*.0025,h+=g*.0025;const m=Math.sin(e.breathPhase*Math.PI*2),y=c.x-.5,v=c.y-.5,b=Math.sqrt(y*y+v*v)+.001,S=-m*i.breathStr;d+=y/b*S,h+=v/b*S;const C=hl(l.A,c.x,c.y),k=hl(l.S,c.x,c.y),R=1.5/Fv,j=(hl(l.A,c.x+R,c.y)-hl(l.A,c.x-R,c.y))/(2*R),T=(hl(l.A,c.x,c.y+R)-hl(l.A,c.x,c.y-R))/(2*R),_=(hl(l.S,c.x+R,c.y)-hl(l.S,c.x-R,c.y))/(2*R),P=(hl(l.S,c.x,c.y+R)-hl(l.S,c.x,c.y-R))/(2*R);switch(d+=j*Math.min(C,1)*i.cohesion*.15-_*Math.min(k,1)*.12,h+=T*Math.min(C,1)*i.cohesion*.15-P*Math.min(k,1)*.12,c.element){case"earth":d+=(.5-c.x)*i.cohesion*.015,h+=(.5-c.y)*i.cohesion*.015;break;case"air":d+=wd()*.005,h+=wd()*.005;break;case"fire":d+=wd()*.008,h+=wd()*.008;break}if(c.linkId>=0&&c.linkId<s){const H=o[c.linkId],G=H.x-c.x,oe=H.y-c.y,le=Math.sqrt(G*G+oe*oe)+.001,pe=(le-.06)*i.springStr;d+=G/le*pe,h+=oe/le*pe}if(i.cohesion>.1){const H=MS(c.x,c.y);let G=0,oe=0,le=0;for(const pe of H){if(pe===u)continue;const ce=o[pe],te=ce.x-c.x,F=ce.y-c.y,Q=te*te+F*F;if(Q<.008&&ce.element===c.element&&(G+=ce.x,oe+=ce.y,le++,Q<.0012)){const ae=Math.sqrt(Q)+.001;d-=te/ae*.012,h-=F/ae*.012}}le>0&&(d+=(G/le-c.x)*i.cohesion*.08,h+=(oe/le-c.y)*i.cohesion*.08)}const I=Math.pow(.92,t*60);c.vx=(c.vx+d)*I,c.vy=(c.vy+h)*I;const $=Math.sqrt(c.vx*c.vx+c.vy*c.vy);$>i.maxSpeed&&(c.vx=c.vx/$*i.maxSpeed,c.vy=c.vy/$*i.maxSpeed);const q=c.x+c.vx*t*45,L=c.y+c.vy*t*45;if(r.length>0){const H=xW(c,q,L,r,e.lapis.charge,t);if(c.vx+=H.fx,c.vy+=H.fy,H.tunneled&&(c.tunneling=!0),H.channelDir){const[G,oe]=H.channelDir,le=Math.sqrt(c.vx*c.vx+c.vy*c.vy);c.vx+=G*le*.15,c.vy+=oe*le*.15}}c.x=c.x+c.vx*t*45,c.y=c.y+c.vy*t*45,c.x<.05&&(c.x=.05,c.vx*=-.5),c.x>.95&&(c.x=.95,c.vx*=-.5),c.y<.05&&(c.y=.05,c.vy*=-.5),c.y>.95&&(c.y=.95,c.vy*=-.5),c.charge=Math.max(0,Math.min(1,c.charge+(C-k)*t*.15)),c.coherence=Math.max(0,Math.min(1,c.coherence+(C-k-.1)*t*.08)),c.valence=Math.max(-1,Math.min(1,c.valence+(C-k)*t*.05))}if(e.tick%6===0){const u=i.thresholds*i.thresholds*.006;for(let c=0;c<s;c++){const d=o[c];if(d.linkId>=0)continue;const h=MS(d.x,d.y);for(const f of h){if(f<=c)continue;const g=o[f];if(g.linkId>=0)continue;const m=d.x-g.x,y=d.y-g.y;if(m*m+y*y>u)continue;const v=1-Math.abs(d.charge-g.charge);v>i.thresholds*.8&&zi()<i.springStr*.3&&(d.linkId=f,d.linkTtl=2+zi()*4,g.linkId=c,g.linkTtl=d.linkTtl,wS(l,(d.x+g.x)*.5,(d.y+g.y)*.5,0,v,0,i.writeGain));break}}}if(e.tick%3===0)for(let u=0;u<s;u++){const c=o[u],d=c.tunneling?.5:0,h=Math.max(0,c.valence<0?-c.valence:0)+(1-c.coherence)*.4+d*.3,f=Math.max(0,c.valence)*c.coherence+(c.tunneling?.2:0);wS(l,c.x,c.y,c.charge,f,h,i.writeGain)}if(e.tick%2===0&&sW(l,t*2,i,e.lapis.state==="FORGED"),e.tick%10===0){const u=iW(l),c=Math.min(1,Math.abs(u.integration-kS)*25);kS=u.integration,e.metrics={integrationIndex:u.integration,tensionIndex:u.tension,noveltyIndex:c,lapisCharge:e.lapis.charge,meanCharge:u.meanC}}if(wW(e,t),CW(e,t,i),i.mutationRate>.08&&e.tick%30===0){const u=Math.ceil(s*i.mutationRate*.06);for(let c=0;c<u;c++){const d=Math.floor(zi()*s),h=o[d],f=zi();f<.25?h.element="earth":f<.5?h.element="water":f<.75?h.element="air":h.element="fire"}}if(e.tick%8===0){const{elements:u,heat:c,lapis:d,pulse:h,transmutation:f}=e;let g=0,m=0;for(let v=0;v<s;v++)o[v].substance==="sulphur"&&g++,o[v].substance==="mercurius"&&m++;const y=g>=3&&m>=3;for(let v=0;v<s;v++){const b=o[v],S=dW(b.substance,b.charge,b.coherence,u,c,d.state,h.op,y);if(S!==null){const C=S==="argentum"&&y&&(b.substance==="sulphur"||b.substance==="mercurius")?"coniunctio":"generic";b.substance=S,hW(f,b.x,b.y,S,C)}}}fW(e.transmutation,e.agents.map(u=>u.substance),t)}function wW(e,t,r){const o=e.metrics,s=e.lapis,l=e.heat;switch(s.crackRisk+=t*((l>.7?(l-.7)*.3:0)+(e.activeEvent==="BURNOUT"?.05:0)),s.crackRisk=Math.max(0,Math.min(1,s.crackRisk-t*.02)),s.state){case"DORMANT":s.charge+=t*o.integrationIndex*.04,s.charge=Math.min(.4,s.charge),s.charge>.25&&o.integrationIndex>.6&&(s.state="FORMING",s.forgeTimer=0);break;case"FORMING":s.forgeTimer+=t,s.charge+=t*o.integrationIndex*.06-t*o.tensionIndex*.04,s.charge=Math.max(.2,Math.min(.85,s.charge)),s.charge>.7&&s.forgeTimer>15&&o.integrationIndex>.65&&(s.state="FORGED"),s.crackRisk>.75&&(s.state="CRACKED",s.charge*=.5);break;case"FORGED":s.charge+=t*(o.integrationIndex-.5)*.04,s.charge=Math.max(.4,Math.min(1,s.charge)),(s.crackRisk>.85||e.activeEvent==="BURNOUT")&&(s.state="CRACKED",s.charge*=.4);break;case"CRACKED":s.charge+=t*(o.integrationIndex-.5)*.025,s.charge=Math.max(.05,Math.min(.5,s.charge)),s.crackRisk-=t*.04,s.crackRisk<=0&&s.charge>.3&&o.integrationIndex>.6&&(s.state="FORMING",s.forgeTimer=0);break}e.metrics.lapisCharge=s.charge}function CW(e,t,r){if(e.activeEvent){e.eventTimer+=t,e.eventTimer>4&&(e.activeEvent=null,e.eventTimer=0);return}const o=e.metrics,s=e.heat;if(r.writeGain>1.6&&s>.7&&o.tensionIndex>.65){e.activeEvent="BURNOUT",e.eventTimer=0;for(let l=0;l<Math.ceil(e.count*.15);l++){const i=e.agents[Math.floor(zi()*e.count)];i.valence=-.5,i.coherence=Math.max(0,i.coherence-.3)}return}if(r.cohesion>.25&&o.noveltyIndex<.05&&e.elapsed>20){e.activeEvent="CRYSTALLIZATION",e.eventTimer=0;return}if(r.diffusion>.38&&o.integrationIndex<.3){e.activeEvent="DISSOLUTION",e.eventTimer=0;for(const l of e.agents)l.linkId=-1,l.linkTtl=0;return}r.globalMix>.1&&o.integrationIndex<.35&&o.noveltyIndex>.6&&(e.activeEvent="NOISE",e.eventTimer=0)}function fl(e,t){if(e.pulse.op!=="NONE")return;const r=3.5;e.pulse={op:t,strength:1,duration:r,maxDur:r};const o=e.field,s=o.C.length;if(t==="SOLVE")for(let l=0;l<s;l++)o.S[l]=Math.min(1,o.S[l]+.08);else for(let l=0;l<s;l++)o.A[l]=Math.min(1,o.A[l]+.1)}const wf=Fv,Au={earth:"#8b7a55",water:"#3a7fa0",air:"#90b0c0",fire:"#c8561e"},MW={NIGREDO:"rgba(0,0,0,0.25)",ALBEDO:"rgba(180,190,220,0.055)",CITRINITAS:"rgba(200,160,0,0.055)",RUBEDO:"rgba(160,0,0,0.07)"},ju="rgba(200,150,12,";function Ry(e,t){const r=parseInt(e.slice(1,3),16),o=parseInt(e.slice(3,5),16),s=parseInt(e.slice(5,7),16);return`rgba(${r},${o},${s},${t.toFixed(3)})`}function ch(e,t){return e*t}function dh(e,t){return e*t}function kW(e,t,r,o,s){if(t.length!==0){e.save(),e.lineCap="round";for(const l of t){if(!l.active)continue;const i=ch(l.x1,r),u=dh(l.y1,o),c=ch(l.x2,r),d=dh(l.y2,o),h=Zu[l.type],f=l.type==="tunnel"?.5+.5*Math.sin(s*4):l.type==="channel"?.5+.5*Math.sin(s*2.5):1;if(e.strokeStyle=h,e.lineWidth=8*l.strength,e.globalAlpha=.08*f,e.beginPath(),e.moveTo(i,u),e.lineTo(c,d),e.stroke(),e.lineWidth=1.5+l.strength,e.globalAlpha=.6*f,e.beginPath(),e.moveTo(i,u),e.lineTo(c,d),e.stroke(),l.type==="channel"){const g=(i+c)/2,m=(u+d)/2,y=c-i,v=d-u,b=Math.sqrt(y*y+v*v)+.001,S=y/b,C=v/b,k=14;e.globalAlpha=.8,e.fillStyle=h,e.beginPath(),e.moveTo(g+S*k,m+C*k),e.lineTo(g-C*6,m+S*6),e.lineTo(g+C*6,m-S*6),e.closePath(),e.fill()}if(l.type==="tunnel"){const g=Math.floor(l.strength*8+2);for(let m=0;m<g;m++){const y=(m/g+s*.3)%1,v=i+y*(c-i),b=u+y*(d-u);e.globalAlpha=.6*(.5+.5*Math.sin(s*6+m)),e.fillStyle=h,e.beginPath(),e.arc(v,b,1.5,0,Math.PI*2),e.fill()}}e.globalAlpha=.5,e.fillStyle=h,e.beginPath(),e.arc(i,u,3,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(c,d,3,0,Math.PI*2),e.fill(),l.label&&(e.font="7px monospace",e.textAlign="center",e.textBaseline="bottom",e.fillStyle=h,e.globalAlpha=.6,e.fillText(l.label,(i+c)/2,Math.min(u,d)-3))}e.restore()}}function RW(e,t,r,o,s){if(!t.active)return;const l=t.steps,i=l.length,u=22,c=o-52-u,d=Math.min(28,r*.6/i),h=d*i,f=(r-h)/2;e.save(),e.fillStyle="rgba(0,0,0,0.55)",e.strokeStyle="rgba(200,150,12,0.15)",e.lineWidth=1;const g=f-4,m=h+8;e.beginPath(),e.roundRect(g,c,m,u,4),e.fill(),e.stroke();for(let y=0;y<i;y++){const v=l[y],b=f+y*d+d/2,S=c+u/2,C=y===t.cursor,k=y===t.superStep,R=l.some((P,I)=>P.entangled===y&&I===t.cursor),j=v.active;let T="rgba(255,255,255,0.03)";if(C&&(T="rgba(200,150,12,0.18)"),k&&(T="rgba(160,90,220,0.15)"),e.fillStyle=T,e.beginPath(),e.roundRect(f+y*d+1,c+2,d-2,u-4,3),e.fill(),t.quantum&&j){const P=(u-8)*v.probability;e.fillStyle="rgba(200,150,12,0.25)",e.fillRect(f+y*d+2,c+u-4-P,d-4,P)}const _=j?C?"#f0c040":k?"#cc88ff":R?"#88ccff":"rgba(255,255,255,.45)":"rgba(255,255,255,.15)";if(e.font=`${C?8:7}px monospace`,e.textAlign="center",e.textBaseline="middle",e.fillStyle=_,e.globalAlpha=j?1:.35,e.fillText(v.label,b,S),v.op!=="NONE"&&(e.font="5px monospace",e.fillStyle=v.op==="SOLVE"?"#3a7fa0":"#c8960a",e.fillText(v.op==="SOLVE"?"":"",b,c+u-3)),C){const P=.5+.5*Math.sin(s*8);e.fillStyle=`rgba(240,192,64,${.6+P*.4})`,e.fillRect(b-1,c,2,2)}k&&(e.strokeStyle=`rgba(160,90,220,${t.superWeight*.8})`,e.lineWidth=1,e.globalAlpha=1,e.beginPath(),e.moveTo(f+y*d+2,c+2),e.lineTo(f+y*d+2,c+u-2),e.stroke()),e.globalAlpha=1}e.font="6px monospace",e.textAlign="right",e.textBaseline="middle",e.fillStyle="rgba(200,150,12,0.4)",e.fillText(`${t.bpm}bpm${t.quantum?" ":""}`,f+h+2,c+u/2),e.restore()}function AW(e,t,r,o,s,l,i,u=1,c=0,d=0){var $;const h=Math.min(window.devicePixelRatio||1,1.5),f=e.clientWidth,g=e.clientHeight;(e.width!==Math.round(f*h)||e.height!==Math.round(g*h))&&(e.width=Math.round(f*h),e.height=Math.round(g*h));const m=e.getContext("2d");m.setTransform(h,0,0,h,0,0),m.fillStyle="#08060a",m.fillRect(0,0,f,g);const y=t.heat,v=m.createRadialGradient(f/2,g/2,0,f/2,g/2,Math.max(f,g)*.6);v.addColorStop(0,`rgba(${Math.round(y*80)},${Math.round(y*40)},5,${.03+y*.08})`),v.addColorStop(.6,"rgba(20,10,5,0.03)"),v.addColorStop(1,"rgba(0,0,0,0)"),m.fillStyle=v,m.fillRect(0,0,f,g),o&&(m.fillStyle=MW[o],m.fillRect(0,0,f,g)),m.save(),m.translate(f/2+c,g/2+d),m.scale(u,u),m.translate(-f/2,-g/2),(r==="FIELD"||r==="LAPIS")&&jW(m,t.field,f,g,r==="LAPIS"?t.lapis.charge:1);const b=f/2,S=g/2,C=Math.min(f,g)*.42,k=r==="FIELD"?.25:.55;m.save(),m.lineCap="round",m.lineJoin="round";const R=1+s*.012;m.strokeStyle=ju+k+")",m.lineWidth=.8,m.beginPath(),m.arc(b,S,C*R,0,Math.PI*2),m.stroke(),m.strokeStyle=ju+k*.4+")",m.lineWidth=.4,m.beginPath(),m.arc(b,S,C*.95*R,0,Math.PI*2),m.stroke(),m.strokeStyle=ju+k*.7+")",m.lineWidth=.7,m.beginPath();for(let q=0;q<4;q++){const L=q*Math.PI/2+Math.PI/4,H=b+C*Math.cos(L),G=S+C*Math.sin(L);q===0?m.moveTo(H,G):m.lineTo(H,G)}m.closePath(),m.stroke(),m.strokeStyle=ju+k*.6+")",m.lineWidth=.7,m.beginPath();for(let q=0;q<3;q++){const L=q*Math.PI*2/3-Math.PI/2,H=b+C*Math.cos(L),G=S+C*Math.sin(L);q===0?m.moveTo(H,G):m.lineTo(H,G)}m.closePath(),m.stroke();const j=C*.12,T=t.lapis,_=T.state==="FORGED"?`rgba(255,215,0,${k*1.2})`:T.state==="CRACKED"?`rgba(180,50,0,${k*.9})`:T.state==="FORMING"?`rgba(200,160,50,${k})`:ju+k*.5+")";m.strokeStyle=_,m.lineWidth=T.state==="FORGED"?1.5:.7,m.beginPath(),m.arc(b,S,j,0,Math.PI*2),m.stroke(),m.strokeStyle=ju+k*.5+")",m.lineWidth=.5;const P=j*1.8;if(m.beginPath(),m.moveTo(b-P,S),m.lineTo(b+P,S),m.moveTo(b,S-P),m.lineTo(b,S+P),m.stroke(),T.state==="FORGED"||T.state==="FORMING"){const q=t.elapsed,L=.5+.5*Math.sin(q*1.8),H=j*(2.5+L*1.5),G=m.createRadialGradient(b,S,0,b,S,H);G.addColorStop(0,`rgba(255,215,0,${T.state==="FORGED"?.18*L:.08*L})`),G.addColorStop(1,"rgba(255,215,0,0)"),m.fillStyle=G,m.beginPath(),m.arc(b,S,H,0,Math.PI*2),m.fill()}if(T.state==="CRACKED"){m.strokeStyle="rgba(200,50,0,0.4)",m.lineWidth=.6;for(let q=0;q<4;q++){const L=q*Math.PI/2+.3;m.beginPath(),m.moveTo(b,S),m.lineTo(b+Math.cos(L)*j*2.5,S+Math.sin(L)*j*2.5),m.stroke()}}if(r!=="FIELD"){const q=C*1.08,L=[{a:-Math.PI/2,s:"",color:Au.fire},{a:Math.PI/6,s:"",color:Au.water},{a:Math.PI*5/6,s:"",color:Au.earth}];m.font=`${Math.round(C*.065)}px serif`,m.textAlign="center",m.textBaseline="middle";for(const H of L){const G=b+Math.cos(H.a)*q,oe=S+Math.sin(H.a)*q;m.globalAlpha=k*.55,m.fillStyle=H.color,m.fillText(H.s,G,oe)}m.globalAlpha=1}if(m.restore(),r!=="FIELD"){m.save(),m.lineCap="round";for(let q=0;q<t.count;q++){const L=t.agents[q];if(L.linkId<0||L.linkId>=t.count||L.linkId<=q)continue;const H=t.agents[L.linkId],G=L.linkTtl/6;m.globalAlpha=.12+G*.15,m.strokeStyle=Au[L.element],m.lineWidth=.5+L.coherence*.6,m.beginPath(),m.moveTo(ch(L.x,f),dh(L.y,g)),m.lineTo(ch(H.x,f),dh(H.y,g)),m.stroke()}m.restore()}m.save();for(let q=0;q<t.count;q++){const L=t.agents[q],H=ch(L.x,f),G=dh(L.y,g),oe=L.substance??"plumbum",le=gp[oe],pe=oe==="plumbum"?Au[L.element]:le.color,ce=oe==="plumbum"?Au[L.element]:le.glowColor,te=le.sizeBoost;let F,Q;switch(r){case"FIELD":case"SIGIL":F=(1.5+L.charge*1.8)*te,Q=.4+L.coherence*.5;break;case"EVENTS":F=(1.8+L.charge*2)*te,Q=.5+L.coherence*.5;break;case"LAPIS":F=(1.5+t.lapis.charge*2.5*L.charge)*te,Q=.35+t.lapis.charge*.55;break;default:F=(1.5+L.charge*1.8)*te,Q=.4+L.coherence*.5}if(oe==="aurum"){const ae=.6+.4*Math.sin(t.elapsed*2.5+L.phase*Math.PI*2),we=m.createRadialGradient(H,G,0,H,G,F*5);we.addColorStop(0,`rgba(255,200,40,${.3*ae})`),we.addColorStop(.4,`rgba(255,160,0,${.15*ae})`),we.addColorStop(1,"rgba(255,140,0,0)"),m.fillStyle=we,m.globalAlpha=Q,m.beginPath(),m.arc(H,G,F*5,0,Math.PI*2),m.fill(),m.strokeStyle=`rgba(255,215,64,${.5*ae})`,m.lineWidth=.8,m.globalAlpha=.6*ae,m.beginPath(),m.arc(H,G,F*3.2,0,Math.PI*2),m.stroke()}if(oe==="argentum"){const ae=m.createRadialGradient(H,G,0,H,G,F*3.5);ae.addColorStop(0,"rgba(180,210,255,0.18)"),ae.addColorStop(1,"rgba(150,180,220,0)"),m.fillStyle=ae,m.globalAlpha=Q*.8,m.beginPath(),m.arc(H,G,F*3.5,0,Math.PI*2),m.fill()}if(oe==="sulphur"){const ae=.7+.3*Math.sin(t.elapsed*8+L.phase*Math.PI*4);m.globalAlpha=Q*.15*ae,m.fillStyle=le.glowColor,m.beginPath(),m.arc(H,G,F*3,0,Math.PI*2),m.fill()}if(oe==="mercurius"&&(m.globalAlpha=Q*.12,m.fillStyle=le.glowColor,m.beginPath(),m.arc(H,G,F*2.8,0,Math.PI*2),m.fill()),m.globalAlpha=Q*.22,m.fillStyle=ce,m.beginPath(),m.arc(H,G,F*2.5,0,Math.PI*2),m.fill(),m.globalAlpha=Q,m.fillStyle=pe,m.beginPath(),m.arc(H,G,F*.6,0,Math.PI*2),m.fill(),oe==="sal"&&(m.strokeStyle=`rgba(220,228,248,${Q*.6})`,m.lineWidth=.5,m.globalAlpha=Q*.5,m.beginPath(),m.arc(H,G,F*1.1,0,Math.PI*2),m.stroke()),r==="LAPIS"&&t.lapis.state==="FORGED"){const ae=m.createRadialGradient(H,G,0,H,G,F*4);ae.addColorStop(0,"rgba(255,215,0,0.12)"),ae.addColorStop(1,"rgba(255,215,0,0)"),m.fillStyle=ae,m.globalAlpha=1,m.beginPath(),m.arc(H,G,F*4,0,Math.PI*2),m.fill()}m.globalAlpha=1}const I=(($=t.transmutation)==null?void 0:$.flashes)??[];for(const q of I){if(q.life<=0)continue;const L=gp[q.substance],H=ch(q.x,f),G=dh(q.y,g),oe=q.life*20,le=q.life*.9,pe=m.createRadialGradient(H,G,0,H,G,oe);pe.addColorStop(0,Ry(L.glowColor,le)),pe.addColorStop(.4,Ry(L.color,le*.45)),pe.addColorStop(1,"rgba(0,0,0,0)"),m.fillStyle=pe,m.globalAlpha=1,m.beginPath(),m.arc(H,G,oe,0,Math.PI*2),m.fill(),m.strokeStyle=Ry(L.glowColor,q.life*.55),m.lineWidth=.9*q.life,m.beginPath(),m.arc(H,G,oe*1.5,0,Math.PI*2),m.stroke(),m.globalAlpha=1}if(m.restore(),kW(m,l,f,g,t.elapsed),m.restore(),t.activeEvent){const L={BURNOUT:"rgba(255,60,0,",CRYSTALLIZATION:"rgba(180,160,80,",DISSOLUTION:"rgba(40,120,200,",NOISE:"rgba(200,200,255,"}[t.activeEvent]??"rgba(200,200,200,",H=t.eventTimer,G=Math.max(0,.15-H*.04);G>0&&(m.fillStyle=L+G+")",m.fillRect(0,0,f,g)),m.save(),m.textAlign="center",m.textBaseline="top",m.font=`${Math.max(10,f*.013)}px monospace`,m.fillStyle=L+Math.max(0,.8-H*.25)+")",m.fillText(` ${t.activeEvent}`,f/2,g*.08),m.restore()}EW(m,t,f,g,o),TW(m,t,f,g),RW(m,i,f,g,t.elapsed)}function jW(e,t,r,o,s){const l=r/wf,i=o/wf;e.save();for(let u=0;u<wf;u++)for(let c=0;c<wf;c++){const d=u*wf+c,h=t.C[d],f=t.A[d],g=t.S[d];if(h<.005&&f<.005&&g<.005)continue;const m=c*l,y=u*i;h>.01&&(e.fillStyle=`rgba(200,140,0,${h*.35})`,e.fillRect(m,y,l,i)),f>.01&&(e.fillStyle=`rgba(0,150,180,${f*.35*s})`,e.fillRect(m,y,l,i)),g>.01&&(e.fillStyle=`rgba(180,40,0,${g*.3})`,e.fillRect(m,y,l,i))}e.restore()}function EW(e,t,r,o,s){const l=t.metrics,i=30,u=o-i;e.save(),e.fillStyle="rgba(5,3,8,0.7)",e.fillRect(0,u,r,i),e.strokeStyle="rgba(200,150,12,0.2)",e.lineWidth=1,e.beginPath(),e.moveTo(0,u),e.lineTo(r,u),e.stroke();const c=[{label:"Integration",val:l.integrationIndex,color:"rgba(0,180,120,"},{label:"Tension",val:l.tensionIndex,color:"rgba(200,60,0,"},{label:"Novelty",val:l.noveltyIndex,color:"rgba(160,120,220,"},{label:"Lapis",val:l.lapisCharge,color:"rgba(255,215,0,"}],d=r/c.length;e.font="7px monospace",e.textAlign="center",e.textBaseline="bottom";for(let g=0;g<c.length;g++){const m=c[g],y=g*d,v=m.val*(i-10);e.fillStyle=m.color+"0.35)",e.fillRect(y+d*.1,u+i-v-2,d*.8,v),e.fillStyle=m.color+"0.75)",e.fillRect(y+d*.3,u+i-v-2,d*.4,Math.min(v,2)),e.fillStyle=m.color+"0.6)",e.fillText(m.label.slice(0,3).toUpperCase(),y+d*.5,o-2)}const h=t.lapis.state,f={DORMANT:"#555",FORMING:"#aa8",FORGED:"#fd0",CRACKED:"#c33"};if(e.fillStyle=f[h]??"#555",e.textAlign="right",e.font="7px monospace",e.fillText(` ${h}`,r-6,o-2),s){const g={NIGREDO:"#333",ALBEDO:"#aac",CITRINITAS:"#da0",RUBEDO:"#800"};e.fillStyle=g[s],e.textAlign="left",e.fillText(` ${s}`,6,o-2)}e.restore()}function TW(e,t,r,o){const s=t.transmutation;if(!s)return;const l=s.counts,i=Math.max(1,Object.values(l).reduce((v,b)=>v+b,0)),u=Math.min(180,r*.22),c=5,d=188,h=o-28;e.fillStyle="rgba(0,0,0,0.5)",e.beginPath(),e.roundRect(d-4,h-2,u+8,c+14,3),e.fill();const f=[{sub:"plumbum",color:"#7888a0",glow:"#4a5868"},{sub:"sulphur",color:"#e0b800",glow:"#ffe040"},{sub:"mercurius",color:"#60c8f0",glow:"#90e8ff"},{sub:"sal",color:"#c8d0e0",glow:"#e8f0ff"},{sub:"argentum",color:"#80acd8",glow:"#b0d8ff"},{sub:"aurum",color:"#ffc107",glow:"#ffe566"}],g={plumbum:"",sulphur:"",mercurius:"",sal:"",argentum:"",aurum:""};let m=d;for(const{sub:v,color:b,glow:S}of f){const R=(l[v]??0)/i*u;R<1||(e.fillStyle=v==="plumbum"?"rgba(100,120,140,0.25)":b,e.globalAlpha=v==="plumbum"?.4:.85,e.fillRect(m,h,R,c),R>12&&v!=="plumbum"&&(e.fillStyle=S,e.globalAlpha=.25,e.fillRect(m,h,R,c)),m+=R)}e.globalAlpha=1,e.font="5px monospace",e.textBaseline="top";let y=d;for(const{sub:v,color:b}of f){const S=l[v]??0,k=S/i*u;if(k<8){y+=k;continue}e.textAlign="left",e.fillStyle=v==="plumbum"?"rgba(255,255,255,0.2)":b,e.globalAlpha=v==="plumbum"?.4:.7,e.fillText(`${g[v]}${S}`,y+1,h+c+2),y+=k}e.globalAlpha=1,e.textBaseline="alphabetic",s.conjunctionActive&&(e.font="5px monospace",e.fillStyle="rgba(160,80,220,0.6)",e.textAlign="left",e.fillText(" Conjuno",d,h-5))}const md={NIGREDO:{phase:"NIGREDO",label:"Nigredo",symbol:"",color:"#2a1a1a",bgTint:"rgba(0,0,0,0.28)",mixTarget:{earth:.3,water:.35,air:.15,fire:.2},heatTarget:.55,duration:45,minIntegration:0,maxTension:1,minNovelty:.15},ALBEDO:{phase:"ALBEDO",label:"Albedo",symbol:"",color:"#c8c8d8",bgTint:"rgba(180,190,220,0.06)",mixTarget:{earth:.2,water:.45,air:.25,fire:.1},heatTarget:.3,duration:45,minIntegration:.45,maxTension:.45,minNovelty:.2},CITRINITAS:{phase:"CITRINITAS",label:"Citrinitas",symbol:"",color:"#d4aa00",bgTint:"rgba(200,160,0,0.06)",mixTarget:{earth:.2,water:.25,air:.3,fire:.25},heatTarget:.45,duration:45,minIntegration:.55,maxTension:.35,minNovelty:.3},RUBEDO:{phase:"RUBEDO",label:"Rubedo",symbol:"",color:"#8b0000",bgTint:"rgba(139,0,0,0.07)",mixTarget:{earth:.25,water:.2,air:.2,fire:.35},heatTarget:.6,duration:45,minIntegration:.6,maxTension:.4,minNovelty:.25}},RS=["NIGREDO","ALBEDO","CITRINITAS","RUBEDO"];function a5(){return{active:!1,phase:"NIGREDO",phaseIndex:0,timer:0,maxTimer:45,completed:[],lapisForged:!1}}function IW(e,t){const r=md[e],o=t;return o.integrationIndex<r.minIntegration?{passed:!1,reason:`Integrao insuficiente (${(o.integrationIndex*100).toFixed(0)}%)`,metrics:o}:o.tensionIndex>r.maxTension?{passed:!1,reason:`Tenso excessiva (${(o.tensionIndex*100).toFixed(0)}%)  a separatio domina`,metrics:o}:o.noveltyIndex<r.minNovelty?{passed:!1,reason:"Novelty insuficiente  o sistema cristalizou",metrics:o}:{passed:!0,reason:`${r.label} consumada com sucesso`,metrics:o}}function AS(e){const t=md[e];return{mix:t.mixTarget,heat:t.heatTarget}}function PW(e){const t=e.phaseIndex+1;return t>=RS.length?null:RS[t]}function FW(e,t,r,o,s){const{integrationIndex:l,tensionIndex:i,noveltyIndex:u}=e,d=r?{NIGREDO:10,ALBEDO:220,CITRINITAS:48,RUBEDO:0}[r]:30+t.fire*30,h=Math.max(1,Math.min(4,Math.round(1+l*3))),f=[3,4,6,8,12],g=Math.min(4,Math.round(t.air*4+t.fire*1)),m=f[g],y=Math.round(i*7+(o?2:0)),v=.6+t.fire*.25-t.earth*.15,b=.3+l*.4+e.lapisCharge*.3;return{outerR:Math.max(.3,Math.min(1,v)),rings:h,segments:m,notches:Math.min(8,y),hue:d,brightness:Math.min(1,b),cracked:s,phase:r}}function NW(e,t,r=60){e.width=e.height=r;const o=e.getContext("2d");o.clearRect(0,0,r,r),o.fillStyle="rgba(5,5,10,0.9)",o.fillRect(0,0,r,r);const s=r/2,l=r/2,i=r*.44*t.outerR,u=`hsla(${t.hue},60%,${40+t.brightness*35}%,`;o.lineCap="round",o.strokeStyle=u+"0.7)",o.lineWidth=.8,o.beginPath(),o.arc(s,l,i,0,Math.PI*2),o.stroke();for(let c=1;c<t.rings;c++){const d=i*(1-c*.2);if(d<3)break;o.globalAlpha=.5-c*.1,o.beginPath(),o.arc(s,l,d,0,Math.PI*2),o.stroke(),o.globalAlpha=1}o.strokeStyle=u+"0.45)",o.lineWidth=.5;for(let c=0;c<t.segments;c++){const d=c/t.segments*Math.PI*2;o.beginPath(),o.moveTo(s,l),o.lineTo(s+Math.cos(d)*i,l+Math.sin(d)*i),o.stroke()}if(t.notches>0){o.strokeStyle=u+"0.8)",o.lineWidth=1;for(let c=0;c<t.notches;c++){const d=c/t.notches*Math.PI*2+Math.PI*.1,h=s+Math.cos(d)*i,f=l+Math.sin(d)*i;o.beginPath(),o.moveTo(s+Math.cos(d)*(i-4),l+Math.sin(d)*(i-4)),o.lineTo(h,f),o.stroke()}}if(o.strokeStyle=u+"0.9)",o.lineWidth=1,o.beginPath(),o.moveTo(s-4,l),o.lineTo(s+4,l),o.moveTo(s,l-4),o.lineTo(s,l+4),o.stroke(),t.brightness>.6){const c=o.createRadialGradient(s,l,0,s,l,8);c.addColorStop(0,`hsla(${t.hue},80%,80%,${(t.brightness-.6)*2})`),c.addColorStop(1,"transparent"),o.fillStyle=c,o.beginPath(),o.arc(s,l,8,0,Math.PI*2),o.fill()}if(t.cracked){o.strokeStyle="rgba(200,50,0,0.6)",o.lineWidth=.7;const c=[.3,1.8,4.1];for(const d of c)o.beginPath(),o.moveTo(s,l),o.lineTo(s+Math.cos(d)*i*.9,l+Math.sin(d)*i*.9),o.stroke()}}const bs={nigredo:["A prima matria retorna ao caos frtil.","A sombra  o tero do ser.","O chumbo dissolve-se em si mesmo.","Putrefao: primeiro sacramento do Opus.","O corvo pousou; o negro precede o branco.","Toda fixao se dissolve antes de reconstruir."],albedo:["A lua revela o que o sol consome.","A prata emerge do resduo carbonizado.","Clarificao: o campo respira com menos rudo.","O espelho se lava; o reflexo se precisa.","A gua purifica o que o fogo revelou."],citrinitas:["A aurora dora os contornos do ser emergente.","O mercrio estabiliza entre dois polos.","A integrao acende a primeira chama consciente.","Citrinitas: nem prata nem ouro  transio sagrada.","O Sol ainda no   mas o horizonte  seu."],rubedo:["O vermelho-rei encarna no campo coagulado.","Rubedo: a fixao final, a pedra quer corpo.","O ouro no  cor   estado de permanncia.","A obra encarna; o Opus se fecha neste ciclo.","O enxofre vence o mercrio; a matria se fixa."],solve:["Solve: a estrutura cede  corrente.","A dissoluo no destri  prepara.","O vnculo se afroxa para que um novo nasa.","Toda dissoluo  semente de nova forma."],coagula:["Coagula: o disperso se recolhe em forma.","A coheso escreve novos padres no campo.","O slido vence o fluido por tempo.","A pedra busca a pedra pelo peso do semelhante."],burnout:["O athanor aqueceu alm do suportvel.","O excesso de fogo carboniza o que no  fixado.","Calcinao involuntria: recuar ou aceitar o colapso."],crystallization:["A terra dominou; a novelty morreu.","Cristalizao: dogma endurecido onde havia mistrio.","O fixo prende o que devia transformar."],dissolution:["A gua venceu toda coeso; o campo se dissolve.","Sem terra, nenhuma forma persiste.","Excesso de solutio: perda de identidade do opus."],noise:["O ar em excesso transforma sinal em rudo.","A volatilizao sem terra produz disperso sem sentido.","O caos areo dissolve a ordem emergente."],lapisForged:["A Pedra Filosofal consolida-se no centro.","Lapis Philosophorum: o catalisador encarna.","A transmutao SA ativa-se pelo centro do campo.","A Pedra no  ouro   o que transforma em ouro."],lapisCracked:["A Pedra racha sob presso excessiva.","O catalisador quebra; a transmutao suspende-se.","Retorno ao Albedo ser necessrio para reconstituir."],generic:["O campo registra a passagem do tempo alqumico.","O Opus avana por suas prprias leis.","A obra caminha sem pressa, mas sem pausa.","Observe; o sistema fala antes de ser perguntado."]};function OW(e,t){const{integrationIndex:r,tensionIndex:o,noveltyIndex:s}=e,l=MR(t);return o>.6?`porque o campo S (separatio) subiu a ${(o*100).toFixed(0)}%, a coeso cedeu  tenso.`:r>.7?`porque A (affinity) excede S em ${((r-.5)*200).toFixed(0)}%, a integrao avana.`:s<.08?`porque a novelty caiu a ${(s*100).toFixed(0)}%, o sistema tende  cristalizao.`:l==="fire"?"porque o Fogo domina, a taxa de mutao aumenta e o risco cresce.":l==="water"?"porque a gua domina, a difuso absorve as estruturas mais frgeis.":l==="earth"?"porque a Terra domina, a coheso freia a volatilidade.":l==="air"?"porque o Ar domina, o campo propaga alm da sua capacidade de reter.":`porque integrao=${(r*100).toFixed(0)}% e tenso=${(o*100).toFixed(0)}%, o Opus encontra seu equilbrio momentneo.`}function MR(e){return Object.entries(e).reduce((r,o)=>o[1]>r[1]?o:r)[0]}function jS(e){return e[Math.floor(Math.random()*e.length)]}function _W(e,t,r,o,s,l){let i=[];const u=[];if(s)switch(s){case"BURNOUT":i=bs.burnout,u.push("burnout");break;case"CRYSTALLIZATION":i=bs.crystallization,u.push("crystallization");break;case"DISSOLUTION":i=bs.dissolution,u.push("dissolution");break;case"NOISE":i=bs.noise,u.push("noise");break}if(e==="lapisForged"&&(i=bs.lapisForged,u.push("lapis","forged")),e==="lapisCracked"&&(i=bs.lapisCracked,u.push("lapis","cracked")),i.length===0&&o)switch(o){case"NIGREDO":i=bs.nigredo,u.push("nigredo");break;case"ALBEDO":i=bs.albedo,u.push("albedo");break;case"CITRINITAS":i=bs.citrinitas,u.push("citrinitas");break;case"RUBEDO":i=bs.rubedo,u.push("rubedo");break}i.length===0&&(i=bs.generic);const c=MR(r);u.push(c),o&&u.push(o.toLowerCase());const d=jS(i);let h=d;if(e==="phaseStart"||e==="phaseEnd"){const m=jS(o?bs[o.toLowerCase()]??bs.generic:bs.generic);m!==d&&(h=`${d}
${m}`)}const f=OW(t,r),g=FW(t,r,o,s,l==="CRACKED");return{text:h,causalLine:f,glyphSpec:g,tags:u}}const DW=140;let LW=1;function ES(){return[]}function Pc(e,t,r,o,s,l,i){const u=_W(t,r,o,s,l,i),c={id:LW++,timestamp:Date.now(),text:u.text,causalLine:u.causalLine,phase:s,event:l,tags:u.tags,elements:{...o},metrics:{...r},glyphSpec:u.glyphSpec,bookmarked:!1};return e.unshift(c),e.length>DW&&e.pop(),c}function zW(e,t,r){return e.filter(o=>!(t&&!o.tags.includes(t)))}function BW(e){const t=new Date(e);return`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`}const ep=[{id:"athanor-calm",name:"Athanor Calmo",subtitle:"Contemplao. O forno aquece devagar.",description:"Baixo risco. Contemplativo. Integrao gradual. Ideal para observao.",agentCount:400,heat:.22,elements:{earth:.35,water:.35,air:.2,fire:.1}},{id:"fermentation",name:"Fermentao",subtitle:"Nigredo forte. A obra comea na sombra.",description:"Risco mdio. A putrefao domina inicialmente.",agentCount:600,heat:.55,elements:{earth:.2,water:.35,air:.15,fire:.3}},{id:"crucible",name:"Cadinho",subtitle:"Fogo alto. Risco real. Lapis possvel.",description:"Alto fogo. Risco de burnout. Lapis pode ser forjada se integrao for sustentada.",agentCount:900,heat:.8,elements:{earth:.15,water:.15,air:.25,fire:.45}},{id:"solutio",name:"Solutio",subtitle:"Aqua dominat. A dissoluo total.",description:"gua domina. A matria se dissolve. Risco de dissolution alto.",agentCount:500,heat:.3,elements:{earth:.08,water:.65,air:.2,fire:.07}},{id:"calcinatio",name:"Calcinatio",subtitle:"Ignis consumit. A purificao pelo fogo.",description:"Fogo alto com calor moderado. Queima o impuro. Risco de burnout.",agentCount:700,heat:.7,elements:{earth:.12,water:.1,air:.18,fire:.6}},{id:"sublimatio",name:"Sublimatio",subtitle:"Aer elevat. A elevao espiritual.",description:"Ar domina. Volatilizao mxima. Risco de rudo e disperso.",agentCount:600,heat:.4,elements:{earth:.08,water:.12,air:.65,fire:.15}},{id:"coagulatio",name:"Coagulatio",subtitle:"Terra fixat. A fixao da matria.",description:"Terra domina. Fixao mxima. Risco de cristalizao prematura.",agentCount:500,heat:.28,elements:{earth:.62,water:.18,air:.1,fire:.1}},{id:"putrefactio-nigra",name:"Putrefactio Nigra",subtitle:"O negro primordial. A matria apodrece.",description:"Nigredo puro. Alta tenso. A putrefao  o incio de tudo.",agentCount:650,heat:.62,elements:{earth:.15,water:.4,air:.12,fire:.33}},{id:"distillatio-alba",name:"Distillatio Alba",subtitle:"A prata emerge. Luna illuminat.",description:"Albedo puro. gua+Terra purificam. Baixo calor. Clarificao gradual.",agentCount:450,heat:.25,elements:{earth:.25,water:.5,air:.18,fire:.07}},{id:"aurora-citrina",name:"Aurora Citrina",subtitle:"O Sol nasce. A integrao manifesta.",description:"Citrinitas. Equilbrio entre os 4 elementos com leve dominncia do Ar.",agentCount:550,heat:.42,elements:{earth:.22,water:.28,air:.32,fire:.18}},{id:"rubedo-regis",name:"Rubedo Regis",subtitle:"O Rei Vermelho encarna. Fogo fixado.",description:"Rubedo. Fogo+Terra coagulam. Lapis busca forma. Alta integrao possvel.",agentCount:650,heat:.58,elements:{earth:.28,water:.15,air:.2,fire:.37}},{id:"mercurius",name:"Mercurius",subtitle:"O mediador. Ar+gua. Fluidez do esprito.",description:"Tria Prima: Mercrio = Ar+gua. Medeia entre Enxofre e Sal. Alto globalMix.",agentCount:600,heat:.38,elements:{earth:.1,water:.4,air:.4,fire:.1}},{id:"sulphur",name:"Sulphur Vivi",subtitle:"A alma em combusto. Fogo+Ar.",description:"Tria Prima: Enxofre = Fogo+Ar. A alma ativa. Alta mutao e transformao.",agentCount:700,heat:.72,elements:{earth:.08,water:.12,air:.3,fire:.5}},{id:"sal-terrae",name:"Sal Terrae",subtitle:"O corpo fixado. Terra+gua.",description:"Tria Prima: Sal = Terra+gua. O corpo da matria. Estvel, lento, profundo.",agentCount:480,heat:.2,elements:{earth:.45,water:.4,air:.08,fire:.07}},{id:"coniunctio",name:"Coniunctio",subtitle:"Sol e Luna se unem. Fogo+gua.",description:"A conjuno dos opostos (Sol/Fogo e Luna/gua). Tenso produtiva. Lapis prxima.",agentCount:600,heat:.5,elements:{earth:.15,water:.35,air:.12,fire:.38}},{id:"separatio",name:"Separatio",subtitle:"Separa o fixo do voltil.",description:"Solve mximo. Ar+gua dominam. Desfaz estruturas para criar novas.",agentCount:600,heat:.45,elements:{earth:.08,water:.38,air:.38,fire:.16}},{id:"fixatio",name:"Fixatio",subtitle:"Fixa o voltil. Coagula mximo.",description:"Coagula forte. Terra+calor fixam o que foi volatilizado. Baixo risco.",agentCount:500,heat:.55,elements:{earth:.55,water:.12,air:.1,fire:.23}},{id:"lapis-hunt",name:"Venatione Lapidis",subtitle:"A caada  Pedra. Alta integrao.",description:"Otimizado para forjar a Lapis: integrao alta, calor moderado, terra+agua base.",agentCount:700,heat:.52,elements:{earth:.28,water:.3,air:.2,fire:.22}},{id:"multiplicatio",name:"Multiplicatio",subtitle:"A pedra se multiplica. Mximo agentes.",description:"Alta densidade. Fogo domina. Sistema altamente emergente. Caos produtivo.",agentCount:900,heat:.75,elements:{earth:.15,water:.2,air:.22,fire:.43}},{id:"via-negativa",name:"Via Negativa",subtitle:"O mnimo. Vazio contemplativo.",description:"Mnima interferncia. Poucos agentes, calor baixo. Medita sobre o vazio do campo.",agentCount:200,heat:.08,elements:{earth:.25,water:.25,air:.25,fire:.25}}];function $W(e){return ep.find(t=>t.id===e)}function TS(){return{active:!1,cursor:0,stepDur:2.5,timer:0,quantum:!1,bpm:24,superStep:null,superWeight:0,steps:kR()}}function Sr(e,t,r={}){return{id:e,label:t,earthTarget:null,waterTarget:null,airTarget:null,fireTarget:null,heatTarget:null,op:"NONE",active:!0,probability:1,entangled:null,entangleSign:1,...r}}function kR(){return[Sr(0,""),Sr(1,"N",{earthTarget:.2,waterTarget:.35,airTarget:.15,fireTarget:.3,heatTarget:.55}),Sr(2,"",{op:"SOLVE"}),Sr(3,""),Sr(4,"A",{earthTarget:.22,waterTarget:.48,airTarget:.2,fireTarget:.1,heatTarget:.28}),Sr(5,"",{op:"COAGULA"}),Sr(6,""),Sr(7,"C",{earthTarget:.22,waterTarget:.26,airTarget:.32,fireTarget:.2,heatTarget:.42}),Sr(8,"",{op:"SOLVE"}),Sr(9,""),Sr(10,"R",{earthTarget:.28,waterTarget:.15,airTarget:.2,fireTarget:.37,heatTarget:.58}),Sr(11,"",{op:"COAGULA"}),Sr(12,"",{heatTarget:.6,probability:.7,entangled:3,entangleSign:1}),Sr(13,"",{probability:.8}),Sr(14,"",{op:"SOLVE",probability:.5,entangled:11,entangleSign:-1}),Sr(15,"",{heatTarget:.35,probability:.6})]}function qW(e,t){if(!e.active)return{stepFired:!1,firedStep:null,superActive:null,superWeight:0,elementsDelta:null,heatDelta:null,op:"NONE"};e.timer+=t;const r={stepFired:!1,firedStep:null,superActive:null,superWeight:0,elementsDelta:null,heatDelta:null,op:"NONE"};if(e.timer>=e.stepDur){e.timer=0;const o=e.steps[e.cursor];if(o.active)if(e.quantum?Math.random()<o.probability:!0){if(r.stepFired=!0,r.firedStep=o,r.op=o.op,(o.earthTarget!=null||o.waterTarget!=null||o.airTarget!=null||o.fireTarget!=null)&&(r.elementsDelta={earth:o.earthTarget??void 0,water:o.waterTarget??void 0,air:o.airTarget??void 0,fire:o.fireTarget??void 0}),o.heatTarget!=null&&(r.heatDelta=o.heatTarget),o.entangled!=null&&e.quantum){const i=e.steps[o.entangled];o.entangleSign===1?Math.random()<o.probability*.8&&(r.superActive=i,r.superWeight=.4,e.superStep=o.entangled,e.superWeight=.4):i.probability>.1&&(i.probability-=.15)}e.cursor=(e.cursor+1)%e.steps.length;let l=0;for(;!e.steps[e.cursor].active&&l<e.steps.length;)e.cursor=(e.cursor+1)%e.steps.length,l++}else{e.superStep=e.cursor,e.superWeight=.5,r.superActive=o,r.superWeight=.5,e.cursor=(e.cursor+1)%e.steps.length;let l=0;for(;!e.steps[e.cursor].active&&l<e.steps.length;)e.cursor=(e.cursor+1)%e.steps.length,l++}else e.cursor=(e.cursor+1)%e.steps.length}return e.superWeight>0&&(e.superWeight-=t*.4,e.superWeight<=0&&(e.superWeight=0,e.superStep=null)),r}const RR=[{id:"opus-classic",name:"Opus Clssico",bpm:20,quantum:!1,steps:kR()},{id:"nigredo-loop",name:"Nigredo Loop",bpm:16,quantum:!1,steps:[Sr(0,"N",{earthTarget:.15,waterTarget:.4,airTarget:.12,fireTarget:.33,heatTarget:.6}),Sr(1,"",{op:"SOLVE"}),Sr(2,""),Sr(3,"N",{fireTarget:.35,waterTarget:.38,heatTarget:.65}),Sr(4,""),Sr(5,"",{op:"SOLVE"}),Sr(6,"",{op:"COAGULA"}),Sr(7,"")]},{id:"quantum-chaos",name:"Quantum Chaos",bpm:30,quantum:!0,steps:[Sr(0,"N",{probability:.7,earthTarget:.12,fireTarget:.45,heatTarget:.7}),Sr(1,"A",{probability:.5,waterTarget:.5,heatTarget:.25,entangled:4,entangleSign:1}),Sr(2,"",{op:"SOLVE",probability:.6}),Sr(3,"",{op:"COAGULA",probability:.6,entangled:2,entangleSign:-1}),Sr(4,"C",{probability:.7,airTarget:.35,heatTarget:.4}),Sr(5,"",{heatTarget:.55,probability:.4}),Sr(6,"R",{probability:.5,fireTarget:.38,earthTarget:.28,heatTarget:.58}),Sr(7,"",{heatTarget:.3,probability:.9})]},{id:"lapis-hunt",name:"Venatione Lapidis",bpm:18,quantum:!0,steps:[Sr(0,"",{op:"COAGULA",probability:.9}),Sr(1,"A",{waterTarget:.48,earthTarget:.22,heatTarget:.28,probability:.85}),Sr(2,"",{probability:.7}),Sr(3,"C",{airTarget:.32,heatTarget:.42,probability:.8,entangled:5,entangleSign:1}),Sr(4,"",{op:"COAGULA",probability:.75}),Sr(5,"",{heatTarget:.52,probability:.65}),Sr(6,"R",{fireTarget:.35,earthTarget:.28,heatTarget:.58,probability:.7}),Sr(7,"",{heatTarget:.45,probability:.95})]}],qs={alcali:{label:"Metais Alcalinos",color:"#ff9800",dim:"#7a4800"},"alcalino-terroso":{label:"Metais Alcalino-Terrosos",color:"#ffc107",dim:"#7a5c00"},transicao:{label:"Metais de Transio",color:"#f06292",dim:"#6a2545"},lantanideo:{label:"Lantandeos",color:"#81c784",dim:"#2a5c2e"},actinineo:{label:"Actindeos",color:"#a5d6a7",dim:"#2e5c30"},"metal-representativo":{label:"Metais Representativos",color:"#4dd0e1",dim:"#1a5c65"},"semi-metal":{label:"Semi-metais",color:"#26a69a",dim:"#0f4a45"},"nao-metal":{label:"No-metais",color:"#90caf9",dim:"#2a4a6a"},halogeno:{label:"Halognios",color:"#66bb6a",dim:"#1e4a20"},"gas-nobre":{label:"Gases Nobres",color:"#9575cd",dim:"#3a2a6a"},desconhecido:{label:"Desconhecido",color:"#90a4ae",dim:"#3a4a50"}},xp=[{z:1,symbol:"H",name:"Hidrognio",cat:"nao-metal",period:1,group:1,row:1,col:1,mass:1.008,alch:" Primordial",desc:"O elemento mais abundante. Base de toda matria.",recipe:{water:[.3,1],air:[.2,.8],heat:[0,.4],ticksNeeded:2,hint:" gua + Ar. Condies primordiais  o primeiro elemento."}},{z:2,symbol:"He",name:"Hlio",cat:"gas-nobre",period:1,group:18,row:1,col:18,mass:4.003,desc:"Gs nobre raro. Inerte, incombustvel.",recipe:{air:[.6,1],heat:[0,.12],ticksNeeded:5,hint:"Ar mximo + calor mnimo. Use SUBLIMATIO para isolar."}},{z:3,symbol:"Li",name:"Ltio",cat:"alcali",period:2,group:1,row:2,col:1,mass:6.941,alch:" Inflamvel",desc:"Metal alcalino leve. Reage com gua liberando fogo.",recipe:{fire:[.4,.9],earth:[.05,.35],heat:[.3,.7],ticksNeeded:6,hint:" Fogo + pouca Terra. O fogo toca a matria slida."}},{z:4,symbol:"Be",name:"Berlio",cat:"alcalino-terroso",period:2,group:2,row:2,col:2,mass:9.012,desc:"Metal leve e rgido. Extremamente txico.",recipe:{earth:[.3,.6],fire:[.3,.6],heat:[.35,.72],ticksNeeded:8,hint:"Terra + Fogo em propores iguais, calor moderado."}},{z:5,symbol:"B",name:"Boro",cat:"semi-metal",period:2,group:13,row:2,col:13,mass:10.811,desc:"Semi-metal essencial. Cristais boratos formam gemas.",recipe:{earth:[.25,.55],air:[.25,.55],heat:[.3,.7],ticksNeeded:7,hint:"Terra + Ar equilibrados  a cristalizao do ter."}},{z:6,symbol:"C",name:"Carbono",cat:"nao-metal",period:2,group:14,row:2,col:14,mass:12.011,alch:" Quintessncia",desc:"Base da vida. Do diamante ao grafite, infinitas formas.",recipe:{earth:[.2,.5],air:[.2,.5],heat:[.2,.6],ticksNeeded:3,hint:"Terra + Ar equilibrados. A quintessncia da vida orgnica."}},{z:7,symbol:"N",name:"Nitrognio",cat:"nao-metal",period:2,group:15,row:2,col:15,mass:14.007,desc:"78% da atmosfera. Essencial para aminocidos.",recipe:{air:[.45,.95],heat:[0,.4],ticksNeeded:4,hint:"Ar dominante + baixo calor. O ar primordial inerte."}},{z:8,symbol:"O",name:"Oxignio",cat:"nao-metal",period:2,group:16,row:2,col:16,mass:15.999,alch:" Vital",desc:"Essencial  respirao e combusto.",recipe:{water:[.3,.7],air:[.2,.5],heat:[.1,.5],ticksNeeded:3,hint:"gua + Ar com calor suave  a respirao do cosmos."}},{z:9,symbol:"F",name:"Flor",cat:"halogeno",period:2,group:17,row:2,col:17,mass:18.998,desc:"O elemento mais eletronegativo. Corri quase tudo.",recipe:{air:[.3,.65],fire:[.3,.65],heat:[.25,.65],ticksNeeded:8,hint:"Ar + Fogo equilibrados. O sal do fogo celestial."}},{z:10,symbol:"Ne",name:"Nenio",cat:"gas-nobre",period:2,group:18,row:2,col:18,mass:20.18,desc:"Gs nobre que emite luz vermelha ao ionizar.",recipe:{air:[.6,1],heat:[0,.15],ticksNeeded:6,hint:"Ar mximo + calor muito baixo. SUBLIMATIO ajuda."}},{z:11,symbol:"Na",name:"Sdio",cat:"alcali",period:3,group:1,row:3,col:1,mass:22.99,alch:" Sal Voltil",desc:"Metal mole. Explode em contato com gua.",recipe:{fire:[.4,.8],earth:[.1,.4],heat:[.4,.8],ticksNeeded:6,hint:" Fogo + alguma Terra, calor mdio-alto."}},{z:12,symbol:"Mg",name:"Magnsio",cat:"alcalino-terroso",period:3,group:2,row:3,col:2,mass:24.305,desc:"Metal leve. Queima com chama branca intensa.",recipe:{earth:[.3,.6],fire:[.2,.5],heat:[.35,.72],ticksNeeded:7,hint:"Terra + Fogo, calor moderado. O brilho metlico nasce."}},{z:13,symbol:"Al",name:"Alumnio",cat:"metal-representativo",period:3,group:13,row:3,col:13,mass:26.982,desc:"O metal mais abundante na crosta terrestre.",recipe:{earth:[.4,.8],air:[.1,.3],heat:[.35,.72],ticksNeeded:7,hint:"Terra + Ar, calor moderado. A pedra que se torna metal."}},{z:14,symbol:"Si",name:"Silcio",cat:"semi-metal",period:3,group:14,row:3,col:14,mass:28.086,alch:"Areia Filosfica",desc:"Areia, vidro, chips  a pedra da era digital.",recipe:{earth:[.45,.9],fire:[.05,.25],heat:[.3,.72],ticksNeeded:7,hint:"Terra dominante + pouco Fogo. A areia cristalizada."}},{z:15,symbol:"P",name:"Fsforo",cat:"nao-metal",period:3,group:15,row:3,col:15,mass:30.974,alch:"Enxofre da Vida",desc:"Essencial ao DNA. O fsforo branco queima espontaneamente.",recipe:{earth:[.2,.5],fire:[.2,.5],heat:[.35,.72],ticksNeeded:8,hint:"Terra + Fogo equilibrados. O fsforo: luz que nasce da terra."}},{z:16,symbol:"S",name:"Enxofre",cat:"nao-metal",period:3,group:16,row:3,col:16,mass:32.065,alch:" Sulphur",desc:"O enxofre clssico dos alquimistas. Amarelo, cristalino.",recipe:{fire:[.35,.7],earth:[.2,.5],heat:[.45,.85],ticksNeeded:5,hint:" Fogo + Terra, calor elevado. O Enxofre Alqumico!"}},{z:17,symbol:"Cl",name:"Cloro",cat:"halogeno",period:3,group:17,row:3,col:17,mass:35.453,desc:"Gs verde-amarelado. Usado em piscinas e guerra qumica.",recipe:{water:[.2,.5],air:[.2,.5],fire:[.1,.4],heat:[.25,.65],ticksNeeded:8,hint:"gua + Ar + Fogo. O sal corrosivo da atmosfera."}},{z:18,symbol:"Ar",name:"Argnio",cat:"gas-nobre",period:3,group:18,row:3,col:18,mass:39.948,desc:"Gs nobre, 1% da atmosfera. Proteo em soldagem.",recipe:{air:[.55,1],heat:[0,.2],ticksNeeded:6,hint:"Ar dominante + baixo calor. O guardio inerte."}},{z:19,symbol:"K",name:"Potssio",cat:"alcali",period:4,group:1,row:4,col:1,mass:39.098,alch:"Sal Fixo",desc:"Alcalino essencial  vida. Reage violentamente com gua.",recipe:{fire:[.5,.9],earth:[.05,.3],heat:[.35,.72],ops:["SOLVE"],ticksNeeded:8,hint:" Fogo + SOLVE aplicado. O Sal Fixo se liberta."}},{z:20,symbol:"Ca",name:"Clcio",cat:"alcalino-terroso",period:4,group:2,row:4,col:2,mass:40.078,desc:"Os ossos, as conchas, o calcrio  tudo  clcio.",recipe:{earth:[.3,.65],water:[.1,.35],fire:[.15,.45],heat:[.3,.72],ticksNeeded:7,hint:"Terra + gua + algum Fogo. A pedra calcria."}},{z:21,symbol:"Sc",name:"Escndio",cat:"transicao",period:4,group:3,row:4,col:3,mass:44.956,desc:"Metal raro, leve. Usado em bicicletas de alta performance.",recipe:{earth:[.4,.75],fire:[.2,.4],heat:[.45,.82],ticksNeeded:10,hint:"Terra + Fogo, calor mdio-alto. Metal de transio leve."}},{z:22,symbol:"Ti",name:"Titnio",cat:"transicao",period:4,group:4,row:4,col:4,mass:47.867,alch:"Marte Branco",desc:"Resistente como o ao, leve como o alumnio.",recipe:{earth:[.45,.82],fire:[.1,.3],heat:[.5,.9],ticksNeeded:10,hint:"Terra dominante + calor alto. O metal dos deuses."}},{z:23,symbol:"V",name:"Vandio",cat:"transicao",period:4,group:5,row:4,col:5,mass:50.942,desc:"Metal multicolorido. Suas solues formam arco-ris.",recipe:{earth:[.4,.72],fire:[.2,.5],heat:[.5,.9],ticksNeeded:10,hint:"Terra + Fogo, calor alto. As cores do arco-ris metlico."}},{z:24,symbol:"Cr",name:"Cromo",cat:"transicao",period:4,group:6,row:4,col:6,mass:51.996,alch:"Cor do Fogo",desc:"Confere brilho ao ao inox. Esmeraldas tm cromo.",recipe:{earth:[.3,.65],fire:[.3,.65],heat:[.55,.92],ticksNeeded:12,hint:"Terra + Fogo iguais, calor alto. O espelho metlico."}},{z:25,symbol:"Mn",name:"Mangans",cat:"transicao",period:4,group:7,row:4,col:7,mass:54.938,desc:"Essencial ao ao. Cores violeta na oxidao.",recipe:{earth:[.35,.68],fire:[.25,.5],heat:[.45,.85],ticksNeeded:10,hint:"Terra + Fogo, calor moderado-alto."}},{z:26,symbol:"Fe",name:"Ferro",cat:"transicao",period:4,group:8,row:4,col:8,mass:55.845,alch:" Marte",desc:"O metal da civilizao. Desde a Idade do Ferro at hoje.",recipe:{earth:[.45,.8],fire:[.2,.5],heat:[.5,.9],ticksNeeded:8,hint:"Terra + Fogo, calor alto.  Marte forja o Ferro."}},{z:27,symbol:"Co",name:"Cobalto",cat:"transicao",period:4,group:9,row:4,col:9,mass:58.933,alch:"Cor Azul",desc:"O azul do cobalto coloriu vitrais medievais.",recipe:{earth:[.35,.65],fire:[.3,.6],heat:[.5,.9],ticksNeeded:10,hint:"Terra + Fogo iguais, calor alto. O azul profundo."}},{z:28,symbol:"Ni",name:"Nquel",cat:"transicao",period:4,group:10,row:4,col:10,mass:58.693,desc:"Moedas, ao inox, baterias. O espelho duradouro.",recipe:{earth:[.35,.68],fire:[.25,.5],heat:[.5,.9],ticksNeeded:10,hint:"Terra + Fogo, calor alto. O metal das moedas."}},{z:29,symbol:"Cu",name:"Cobre",cat:"transicao",period:4,group:11,row:4,col:11,mass:63.546,alch:" Vnus",desc:"O metal dos condutores. Verde no ar, vermelho puro.",recipe:{earth:[.3,.65],water:[.1,.3],fire:[.2,.5],heat:[.45,.85],ticksNeeded:8,hint:"Terra + gua + Fogo.  Vnus  o cobre conduz o amor."}},{z:30,symbol:"Zn",name:"Zinco",cat:"transicao",period:4,group:12,row:4,col:12,mass:65.38,alch:"Tutia",desc:"Proteo contra ferrugem. Lato = cobre + zinco.",recipe:{earth:[.35,.65],fire:[.2,.45],heat:[.45,.82],ticksNeeded:9,hint:"Terra + Fogo, calor mdio. A tutia dos alquimistas."}},{z:31,symbol:"Ga",name:"Glio",cat:"metal-representativo",period:4,group:13,row:4,col:13,mass:69.723,desc:"Derrete na palma da mo. Lquido a 29C.",recipe:{earth:[.35,.65],air:[.1,.3],heat:[.35,.72],ops:["COAGULA"],ticksNeeded:12,hint:"Terra + Ar, COAGULA. O metal que derrete nas mos."}},{z:32,symbol:"Ge",name:"Germnio",cat:"semi-metal",period:4,group:14,row:4,col:14,mass:72.63,desc:"Semicondutor. Essencial na eletrnica antiga.",recipe:{earth:[.35,.65],fire:[.2,.4],heat:[.45,.82],ops:["COAGULA"],ticksNeeded:12,hint:"Terra + Fogo + COAGULA. O semi-metal da era digital."}},{z:33,symbol:"As",name:"Arsnio",cat:"semi-metal",period:4,group:15,row:4,col:15,mass:74.922,alch:" Arsenicum",desc:"Veneno histrico. Os Brgia o usavam em vinhos.",recipe:{earth:[.25,.55],fire:[.3,.6],heat:[.45,.85],ticksNeeded:10,hint:"Terra + Fogo. O veneno dos alquimistas."}},{z:34,symbol:"Se",name:"Selnio",cat:"nao-metal",period:4,group:16,row:4,col:16,mass:78.96,desc:"No-metal vermelho. Essencial em pequenas doses.",recipe:{earth:[.2,.5],air:[.2,.45],heat:[.35,.72],ticksNeeded:10,hint:"Terra + Ar, calor moderado. O sel lunar."}},{z:35,symbol:"Br",name:"Bromo",cat:"halogeno",period:4,group:17,row:4,col:17,mass:79.904,desc:"nico no-metal lquido em temperatura ambiente.",recipe:{water:[.25,.55],air:[.2,.45],fire:[.2,.5],heat:[.35,.72],ticksNeeded:10,hint:"gua + Ar + Fogo. O halognio vermelho-alaranjado."}},{z:36,symbol:"Kr",name:"Criptnio",cat:"gas-nobre",period:4,group:18,row:4,col:18,mass:83.798,desc:"Gs nobre. Lmpadas de cripton tm luz brilhante.",recipe:{air:[.5,.9],heat:[.1,.3],ticksNeeded:8,hint:"Ar dominante + baixo calor. O gs oculto."}},{z:37,symbol:"Rb",name:"Rubdio",cat:"alcali",period:5,group:1,row:5,col:1,mass:85.468,desc:"Alcalino raro. Usado em relgios atmicos.",recipe:{fire:[.5,.9],earth:[.05,.25],heat:[.45,.82],ticksNeeded:12,hint:" Fogo muito dominante + pouca Terra."}},{z:38,symbol:"Sr",name:"Estrncio",cat:"alcalino-terroso",period:5,group:2,row:5,col:2,mass:87.62,desc:"O estrncio d a cor vermelha nos fogos de artifcio.",recipe:{earth:[.3,.62],fire:[.3,.6],heat:[.45,.85],ticksNeeded:12,hint:"Terra + Fogo, calor mdio-alto. O fogo vermelho."}},{z:39,symbol:"Y",name:"trio",cat:"transicao",period:5,group:3,row:5,col:3,mass:88.906,desc:"Metal raro em LEDs brancas e supercondutores.",recipe:{earth:[.4,.72],fire:[.25,.5],heat:[.5,.88],ticksNeeded:14,hint:"Terra + Fogo, calor alto. Metal de terras raras leves."}},{z:40,symbol:"Zr",name:"Zircnio",cat:"transicao",period:5,group:4,row:5,col:4,mass:91.224,desc:"Resistncia trmica extrema. Usado em reatores nucleares.",recipe:{earth:[.5,.85],fire:[.1,.3],heat:[.55,.92],ticksNeeded:14,hint:"Terra muito dominante + calor alto."}},{z:41,symbol:"Nb",name:"Nibio",cat:"transicao",period:5,group:5,row:5,col:5,mass:92.906,alch:"Nibio Brasileiro",desc:"Brasil tem 98% das reservas mundiais. Supercondutividade.",recipe:{earth:[.45,.78],fire:[.2,.45],heat:[.55,.92],ticksNeeded:14,hint:"Terra + Fogo, calor alto. O orgulho brasileiro!"}},{z:42,symbol:"Mo",name:"Molibdnio",cat:"transicao",period:5,group:6,row:5,col:6,mass:95.96,desc:"Ao molibdnio  usado em turbinas de avies.",recipe:{earth:[.4,.75],fire:[.25,.5],heat:[.55,.92],ticksNeeded:14,hint:"Terra + Fogo, calor alto."}},{z:43,symbol:"Tc",name:"Tecncio",cat:"transicao",period:5,group:7,row:5,col:7,mass:98,desc:"Primeiro elemento sinttico. No existe na natureza.",recipe:{earth:[.3,.6],fire:[.3,.6],heat:[.55,.92],ops:["FERMENTATIO"],ticksNeeded:18,hint:"Terra + Fogo + FERMENTATIO. Criao artificial!"}},{z:44,symbol:"Ru",name:"Rutnio",cat:"transicao",period:5,group:8,row:5,col:8,mass:101.07,desc:"Metal do grupo da platina. Extremamente duro.",recipe:{earth:[.4,.72],fire:[.3,.58],heat:[.6,.95],ticksNeeded:15,hint:"Terra + Fogo, calor muito alto."}},{z:45,symbol:"Rh",name:"Rdio",cat:"transicao",period:5,group:9,row:5,col:9,mass:102.906,desc:"O mais raro dos metais preciosos. Catalisador essencial.",recipe:{earth:[.35,.68],fire:[.3,.6],heat:[.62,.98],ticksNeeded:16,hint:"Terra + Fogo iguais, calor muito alto."}},{z:46,symbol:"Pd",name:"Paldio",cat:"transicao",period:5,group:10,row:5,col:10,mass:106.42,desc:"Catalisadores de automveis. Absorve hidrognio.",recipe:{earth:[.35,.68],fire:[.28,.58],heat:[.58,.95],ticksNeeded:15,hint:"Terra + Fogo, calor alto."}},{z:47,symbol:"Ag",name:"Prata",cat:"transicao",period:5,group:11,row:5,col:11,mass:107.868,alch:" Luna/Argentum",desc:"A Prata Lunar. Melhor condutor eltrico. Antibacteriana.",recipe:{earth:[.3,.62],fire:[.25,.52],heat:[.5,.9],opusPhase:"ALBEDO",ticksNeeded:20,hint:"Terra + Fogo + Opus ALBEDO (Brancura).  A Luna Alqumica!"}},{z:48,symbol:"Cd",name:"Cdmio",cat:"transicao",period:5,group:12,row:5,col:12,mass:112.411,desc:"Metal txico. Pigmento amarelo brilhante.",recipe:{earth:[.38,.68],fire:[.22,.48],heat:[.48,.88],ticksNeeded:13,hint:"Terra + Fogo, calor mdio-alto."}},{z:49,symbol:"In",name:"ndio",cat:"metal-representativo",period:5,group:13,row:5,col:13,mass:114.818,desc:"Metal mole e brilhante. Essencial nas telas touch.",recipe:{earth:[.38,.68],water:[.1,.3],heat:[.45,.82],ticksNeeded:12,hint:"Terra + gua, calor mdio."}},{z:50,symbol:"Sn",name:"Estanho",cat:"metal-representativo",period:5,group:14,row:5,col:14,mass:118.71,alch:" Jpiter",desc:"Metal de Jpiter. Bronze = cobre + estanho. Soldagem.",recipe:{earth:[.3,.62],water:[.1,.3],heat:[.42,.8],ticksNeeded:10,hint:"Terra + gua, calor mdio.  Jpiter  o estanho nobre."}},{z:51,symbol:"Sb",name:"Antimnio",cat:"semi-metal",period:5,group:15,row:5,col:15,mass:121.76,alch:" Antimnio",desc:"Usado pelos antigos egpcios como kohl. Semi-metal.",recipe:{earth:[.35,.65],fire:[.25,.5],heat:[.45,.85],ticksNeeded:12,hint:"Terra + Fogo, calor moderado-alto."}},{z:52,symbol:"Te",name:"Telrio",cat:"semi-metal",period:5,group:16,row:5,col:16,mass:127.6,desc:"Semi-metal raro. Cheiro de alho se inalado.",recipe:{earth:[.32,.62],fire:[.22,.48],water:[.08,.28],heat:[.45,.85],ticksNeeded:13,hint:"Terra + Fogo + pouca gua, calor alto."}},{z:53,symbol:"I",name:"Iodo",cat:"halogeno",period:5,group:17,row:5,col:17,mass:126.904,alch:"Violeta Sublime",desc:"Slido que sublima diretamente em vapor violeta.",recipe:{water:[.25,.55],air:[.12,.4],fire:[.22,.5],heat:[.35,.72],ops:["SUBLIMATIO"],ticksNeeded:12,hint:"gua + Ar + Fogo + SUBLIMATIO. O vapor violeta do iodo!"}},{z:54,symbol:"Xe",name:"Xennio",cat:"gas-nobre",period:5,group:18,row:5,col:18,mass:131.293,desc:"Gs nobre anestsico. Propulso inica espacial.",recipe:{air:[.5,.88],heat:[.12,.35],ops:["SUBLIMATIO"],ticksNeeded:12,hint:"Ar dominante + baixo calor + SUBLIMATIO. O estrangeiro gasoso."}},{z:55,symbol:"Cs",name:"Csio",cat:"alcali",period:6,group:1,row:6,col:1,mass:132.905,desc:"Metal mais reativo ao ar. Relgios atmicos de csio.",recipe:{fire:[.62,.95],earth:[.04,.2],heat:[.45,.82],ticksNeeded:15,hint:" Fogo mximo + pouca Terra. Extremamente reativo."}},{z:56,symbol:"Ba",name:"Brio",cat:"alcalino-terroso",period:6,group:2,row:6,col:2,mass:137.327,desc:"xido de brio em raios-X. Sulfato opaco para contraste.",recipe:{earth:[.32,.65],fire:[.32,.65],heat:[.52,.9],ticksNeeded:15,hint:"Terra + Fogo, calor alto."}},{z:72,symbol:"Hf",name:"Hfnio",cat:"transicao",period:6,group:4,row:6,col:4,mass:178.49,desc:"Controle de reatores nucleares. Absorve nutrons.",recipe:{earth:[.48,.82],fire:[.18,.4],heat:[.6,.95],opusPhase:"NIGREDO",ticksNeeded:22,hint:"Terra + Fogo + NIGREDO opus. O guardio dos nutrons."}},{z:73,symbol:"Ta",name:"Tntalo",cat:"transicao",period:6,group:5,row:6,col:5,mass:180.948,desc:"Biocompatvel. Usado em implantes mdicos.",recipe:{earth:[.45,.8],fire:[.22,.48],heat:[.62,.97],opusPhase:"NIGREDO",ticksNeeded:22,hint:"Terra + Fogo + NIGREDO opus. O metal imortal."}},{z:74,symbol:"W",name:"Tungstnio",cat:"transicao",period:6,group:6,row:6,col:6,mass:183.84,alch:"Espuma de Lobo",desc:"Maior ponto de fuso de todos os metais: 3422C.",recipe:{earth:[.52,.88],fire:[.32,.62],heat:[.72,1],opusPhase:"RUBEDO",ticksNeeded:25,hint:"Terra + Fogo + RUBEDO opus + calor mximo. O metal dos filamentos!"}},{z:75,symbol:"Re",name:"Rnio",cat:"transicao",period:6,group:7,row:6,col:7,mass:186.207,desc:"Metal rarssimo. Ps de turbinas supersnicas.",recipe:{earth:[.48,.82],fire:[.3,.58],heat:[.7,1],opusPhase:"RUBEDO",ticksNeeded:25,hint:"Terra + Fogo intenso + RUBEDO opus."}},{z:76,symbol:"Os",name:"smio",cat:"transicao",period:6,group:8,row:6,col:8,mass:190.23,desc:"Metal mais denso do universo. Cheiro de oznio.",recipe:{earth:[.45,.78],fire:[.35,.62],heat:[.68,1],opusPhase:"RUBEDO",ticksNeeded:25,hint:"Terra + Fogo intenso + RUBEDO opus. A densidade mxima."}},{z:77,symbol:"Ir",name:"Irdio",cat:"transicao",period:6,group:9,row:6,col:9,mass:192.217,desc:"Metal de meteorito. Fronteira K-T  extino dos dinossauros.",recipe:{earth:[.42,.78],fire:[.38,.65],heat:[.7,1],ops:["CALCINATIO"],opusPhase:"RUBEDO",ticksNeeded:28,hint:"Terra + Fogo + CALCINATIO + RUBEDO. O metal dos meteoritos."}},{z:78,symbol:"Pt",name:"Platina",cat:"transicao",period:6,group:10,row:6,col:10,mass:195.084,alch:"Prata Branca",desc:"Catalisador nobre. Joias e conversores catalticos.",recipe:{earth:[.35,.68],fire:[.35,.65],heat:[.68,1],opusPhase:"RUBEDO",ticksNeeded:25,hint:"Terra + Fogo equilibrados + RUBEDO opus. A prata branca nobre."}},{z:79,symbol:"Au",name:"Ouro",cat:"transicao",period:6,group:11,row:6,col:11,mass:196.967,alch:" Sol/Aurum",desc:"A Grande Obra. O Ouro Filosfico. A transmutao final.",recipe:{earth:[.3,.65],fire:[.3,.65],heat:[.72,1],ops:["COAGULA"],opusPhase:"RUBEDO",lapisRequired:!0,ticksNeeded:40,hint:" RUBEDO + Lapis + COAGULA + calor alto. A Grande Obra est prxima!"}},{z:80,symbol:"Hg",name:"Mercrio",cat:"transicao",period:6,group:12,row:6,col:12,mass:200.59,alch:" Mercurius",desc:"O nico metal lquido em temp. ambiente. Vivo, fluido.",recipe:{water:[.3,.65],fire:[.28,.58],heat:[.42,.82],ops:["FERMENTATIO"],ticksNeeded:12,hint:"gua + Fogo + FERMENTATIO.  O Mercrio Alqumico vivo!"}},{z:81,symbol:"Tl",name:"Tlio",cat:"metal-representativo",period:6,group:13,row:6,col:13,mass:204.383,desc:"Metal txico. Veneno favorito de assassinos.",recipe:{earth:[.35,.65],fire:[.22,.5],heat:[.52,.9],opusPhase:"NIGREDO",ticksNeeded:20,hint:"Terra + Fogo + NIGREDO opus. O metal da sombra."}},{z:82,symbol:"Pb",name:"Chumbo",cat:"metal-representativo",period:6,group:14,row:6,col:14,mass:207.2,alch:" Saturno/Plumbum",desc:"O Chumbo de Saturno. Incio da Grande Obra.",recipe:{earth:[.42,.75],fire:[.22,.48],heat:[.45,.85],ticksNeeded:8,hint:" Terra + Fogo, calor mdio. O incio  Plumbum/Saturno."}},{z:83,symbol:"Bi",name:"Bismuto",cat:"metal-representativo",period:6,group:15,row:6,col:15,mass:208.98,desc:"Cristais geomtricos iridescentes. Relativamente seguro.",recipe:{earth:[.35,.65],fire:[.3,.58],heat:[.5,.9],ticksNeeded:14,hint:"Terra + Fogo, calor alto."}},{z:84,symbol:"Po",name:"Polnio",cat:"semi-metal",period:6,group:16,row:6,col:16,mass:209,desc:"Radioativo letal. Usado no assassinato de Litvinenko.",recipe:{earth:[.22,.48],fire:[.42,.72],heat:[.72,1],opusPhase:"RUBEDO",ticksNeeded:30,hint:"Fogo dominante + RUBEDO opus + calor mximo. Radioativo!"}},{z:85,symbol:"At",name:"stato",cat:"halogeno",period:6,group:17,row:6,col:17,mass:210,desc:"O elemento mais raro que ocorre naturalmente. ~30g na Terra.",recipe:{fire:[.42,.72],air:[.2,.45],heat:[.65,1],opusPhase:"RUBEDO",ticksNeeded:32,hint:"Fogo + Ar + RUBEDO opus + calor mximo. Extremamente raro!"}},{z:86,symbol:"Rn",name:"Radnio",cat:"gas-nobre",period:6,group:18,row:6,col:18,mass:222,desc:"Gs nobre radioativo. Se acumula em pores.",recipe:{air:[.4,.85],heat:[.45,.82],opusPhase:"NIGREDO",ops:["SUBLIMATIO"],ticksNeeded:25,hint:"Ar + calor mdio + NIGREDO + SUBLIMATIO. O gs invisvel radioativo."}},{z:87,symbol:"Fr",name:"Frncio",cat:"alcali",period:7,group:1,row:7,col:1,mass:223,desc:"Metal alcalino mais instvel. Existe por milissegundos.",recipe:{fire:[.72,1],heat:[.72,1],lapisRequired:!0,ticksNeeded:45,hint:"Fogo + calor mximos + Lapis. A instabilidade extrema."}},{z:88,symbol:"Ra",name:"Rdio",cat:"alcalino-terroso",period:7,group:2,row:7,col:2,mass:226,alch:"Marie Curie",desc:"Marie Curie morreu por ele. Luminescncia nas trevas.",recipe:{earth:[.3,.62],fire:[.4,.72],heat:[.72,1],opusPhase:"CITRINITAS",ticksNeeded:30,hint:"Terra + Fogo + CITRINITAS + calor mximo. O brilho mortal."}},{z:104,symbol:"Rf",name:"Ruterfrdio",cat:"transicao",period:7,group:4,row:7,col:4,mass:267,desc:"Elemento sinttico. Criado em aceleradores.",recipe:{earth:[.4,.7],fire:[.4,.7],heat:[.8,1],lapisRequired:!0,ticksNeeded:55,hint:"Terra + Fogo intensos + Lapis + calor extremo."}},{z:105,symbol:"Db",name:"Dbnio",cat:"transicao",period:7,group:5,row:7,col:5,mass:268,desc:"Sinttico. Meia-vida de 28 horas.",recipe:{earth:[.35,.68],fire:[.42,.72],heat:[.82,1],lapisRequired:!0,ticksNeeded:58,hint:"Terra + Fogo + Lapis + calor extremo."}},{z:106,symbol:"Sg",name:"Seabrgio",cat:"transicao",period:7,group:6,row:7,col:6,mass:271,desc:"Sinttico. Homenagem a Glenn Seaborg.",recipe:{earth:[.35,.68],fire:[.42,.72],heat:[.85,1],lapisRequired:!0,ticksNeeded:60,hint:"Condies extremas + Lapis forjada."}},{z:107,symbol:"Bh",name:"Bhrio",cat:"transicao",period:7,group:7,row:7,col:7,mass:272,desc:"Sinttico. Homenagem a Niels Bohr.",recipe:{earth:[.35,.68],fire:[.45,.75],heat:[.88,1],lapisRequired:!0,ticksNeeded:62,hint:"Condies extremas + Lapis."}},{z:108,symbol:"Hs",name:"Hssio",cat:"transicao",period:7,group:8,row:7,col:8,mass:270,desc:"Sinttico. Apenas alguns tomos produzidos.",recipe:{earth:[.35,.65],fire:[.45,.75],heat:[.88,1],lapisRequired:!0,ticksNeeded:62,hint:"Condies extremas + Lapis."}},{z:109,symbol:"Mt",name:"Meitnrio",cat:"desconhecido",period:7,group:9,row:7,col:9,mass:278,desc:"Homenagem a Lise Meitner. Propriedades desconhecidas.",recipe:{earth:[.3,.65],fire:[.48,.78],heat:[.9,1],lapisRequired:!0,ticksNeeded:65,hint:"Fogo intensssimo + Lapis + calor extremo."}},{z:110,symbol:"Ds",name:"Darmstcio",cat:"desconhecido",period:7,group:10,row:7,col:10,mass:281,desc:"Produzido em 1994. Meia-vida de microssegundos.",recipe:{earth:[.3,.62],fire:[.5,.8],heat:[.9,1],lapisRequired:!0,ticksNeeded:65,hint:"Condies extremas mximas + Lapis."}},{z:111,symbol:"Rg",name:"Roentgnio",cat:"desconhecido",period:7,group:11,row:7,col:11,mass:282,desc:"Homenagem a Rntgen (raios-X). Sinttico instvel.",recipe:{earth:[.28,.6],fire:[.5,.82],heat:[.92,1],lapisRequired:!0,ticksNeeded:68,hint:"Condies mximas + Lapis forjada."}},{z:112,symbol:"Cn",name:"Coperncio",cat:"transicao",period:7,group:12,row:7,col:12,mass:285,desc:"Homenagem a Coprnico. Pode ser gasoso em temp. ambiente.",recipe:{earth:[.25,.58],fire:[.5,.82],heat:[.92,1],lapisRequired:!0,ticksNeeded:68,hint:"Condies mximas + Lapis."}},{z:113,symbol:"Nh",name:"Nihnio",cat:"metal-representativo",period:7,group:13,row:7,col:13,mass:286,desc:"Descoberto pelo Japo em 2016. O Nh do Nihon.",recipe:{earth:[.25,.58],fire:[.52,.85],heat:[.93,1],lapisRequired:!0,ticksNeeded:70,hint:"Condies mximas extremas + Lapis."}},{z:114,symbol:"Fl",name:"Flervio",cat:"metal-representativo",period:7,group:14,row:7,col:14,mass:289,desc:"Pode ser um gs nobre. Extremamente instvel.",recipe:{earth:[.22,.55],fire:[.55,.88],heat:[.95,1],lapisRequired:!0,ticksNeeded:72,hint:"Condies extremas mximas + Lapis."}},{z:115,symbol:"Mc",name:"Moscvio",cat:"metal-representativo",period:7,group:15,row:7,col:15,mass:290,desc:"Produzido em 2003. Meia-vida de 220ms.",recipe:{earth:[.2,.52],fire:[.55,.88],heat:[.95,1],lapisRequired:!0,ticksNeeded:72,hint:"Condies extremas + Lapis."}},{z:116,symbol:"Lv",name:"Livermrio",cat:"metal-representativo",period:7,group:16,row:7,col:16,mass:293,desc:"Homenagem ao Livermore Lab. Decai muito rpido.",recipe:{earth:[.18,.5],fire:[.58,.9],heat:[.96,1],lapisRequired:!0,ticksNeeded:75,hint:"Condies mximas + Lapis forjada."}},{z:117,symbol:"Ts",name:"Tenessnio",cat:"halogeno",period:7,group:17,row:7,col:17,mass:294,desc:"Produzido em 2010. Segundo mais pesado da tabela.",recipe:{fire:[.6,.92],air:[.18,.42],heat:[.96,1],lapisRequired:!0,ticksNeeded:78,hint:"Fogo + Ar + condies extremas + Lapis."}},{z:118,symbol:"Og",name:"Oganessnio",cat:"gas-nobre",period:7,group:18,row:7,col:18,mass:294,desc:"O elemento mais pesado conhecido. 5 tomos j foram criados.",recipe:{heat:[.98,1],lapisRequired:!0,ticksNeeded:100,hint:" Lapis + calor mximo absoluto. O fim da tabela peridica!"}},{z:57,symbol:"La",name:"Lantnio",cat:"lantanideo",period:6,group:null,row:8,col:3,mass:138.905,desc:"Incio dos lantandeos. Catalisadores de refino de petrleo.",recipe:{earth:[.4,.72],fire:[.22,.48],heat:[.52,.9],opusPhase:"NIGREDO",ticksNeeded:20,hint:"Terra + Fogo + NIGREDO opus. O incio das terras raras."}},{z:58,symbol:"Ce",name:"Crio",cat:"lantanideo",period:6,group:null,row:8,col:4,mass:140.116,desc:"Mais abundante dos lantandeos. Isqueiros de pederneira.",recipe:{earth:[.4,.72],fire:[.25,.5],heat:[.52,.9],opusPhase:"NIGREDO",ticksNeeded:20,hint:"Terra + Fogo + NIGREDO opus."}},{z:59,symbol:"Pr",name:"Praseodmio",cat:"lantanideo",period:6,group:null,row:8,col:5,mass:140.908,desc:"ms superpoderosos com neodmio.",recipe:{earth:[.38,.7],fire:[.25,.52],heat:[.55,.92],opusPhase:"NIGREDO",ticksNeeded:22,hint:"Terra + Fogo + NIGREDO opus."}},{z:60,symbol:"Nd",name:"Neodmio",cat:"lantanideo",period:6,group:null,row:8,col:6,mass:144.242,desc:"ms de neodmio: os mais fortes do mundo.",recipe:{earth:[.38,.7],fire:[.28,.55],heat:[.55,.92],opusPhase:"NIGREDO",ticksNeeded:22,hint:"Terra + Fogo + NIGREDO opus. O m mais forte."}},{z:61,symbol:"Pm",name:"Promcio",cat:"lantanideo",period:6,group:null,row:8,col:7,mass:145,desc:"nico lantandeo radioativo sem istopos estveis.",recipe:{earth:[.35,.68],fire:[.3,.58],heat:[.58,.95],opusPhase:"NIGREDO",ops:["FERMENTATIO"],ticksNeeded:28,hint:"Terra + Fogo + NIGREDO + FERMENTATIO. O lantandeo sinttico."}},{z:62,symbol:"Sm",name:"Samrio",cat:"lantanideo",period:6,group:null,row:8,col:8,mass:150.36,desc:"ms de samrio-cobalto. Resistentes ao calor.",recipe:{earth:[.38,.7],fire:[.28,.55],heat:[.55,.92],opusPhase:"ALBEDO",ticksNeeded:23,hint:"Terra + Fogo + ALBEDO opus."}},{z:63,symbol:"Eu",name:"Eurpio",cat:"lantanideo",period:6,group:null,row:8,col:9,mass:151.964,desc:"Faz o vermelho brilhar nas telas de TV e notas de euro.",recipe:{earth:[.35,.68],fire:[.3,.58],heat:[.58,.92],opusPhase:"ALBEDO",ticksNeeded:24,hint:"Terra + Fogo + ALBEDO opus."}},{z:64,symbol:"Gd",name:"Gadolnio",cat:"lantanideo",period:6,group:null,row:8,col:10,mass:157.25,desc:"Contraste em ressonncia magntica. Superconductividade.",recipe:{earth:[.38,.7],fire:[.3,.58],heat:[.58,.95],opusPhase:"ALBEDO",ticksNeeded:24,hint:"Terra + Fogo + ALBEDO opus."}},{z:65,symbol:"Tb",name:"Trbio",cat:"lantanideo",period:6,group:null,row:8,col:11,mass:158.925,desc:"Luz verde em telas de computador. Magnetorestrio.",recipe:{earth:[.38,.7],fire:[.32,.6],heat:[.6,.95],opusPhase:"CITRINITAS",ticksNeeded:25,hint:"Terra + Fogo + CITRINITAS opus."}},{z:66,symbol:"Dy",name:"Disprsio",cat:"lantanideo",period:6,group:null,row:8,col:12,mass:162.5,desc:'ms de motor eltrico. "Difcil de obter"  do grego.',recipe:{earth:[.38,.7],fire:[.32,.6],heat:[.6,.95],opusPhase:"CITRINITAS",ticksNeeded:25,hint:"Terra + Fogo + CITRINITAS opus. Difcil de obter!"}},{z:67,symbol:"Ho",name:"Hlmio",cat:"lantanideo",period:6,group:null,row:8,col:13,mass:164.93,desc:"Maior momento magntico de todos os elementos.",recipe:{earth:[.4,.72],fire:[.32,.6],heat:[.62,.97],opusPhase:"CITRINITAS",ticksNeeded:26,hint:"Terra + Fogo + CITRINITAS opus."}},{z:68,symbol:"Er",name:"rbio",cat:"lantanideo",period:6,group:null,row:8,col:14,mass:167.259,desc:"Amplificadores pticos de fibra. Rosa elegante.",recipe:{earth:[.4,.72],fire:[.32,.62],heat:[.62,.97],opusPhase:"CITRINITAS",ticksNeeded:26,hint:"Terra + Fogo + CITRINITAS opus."}},{z:69,symbol:"Tm",name:"Tlio",cat:"lantanideo",period:6,group:null,row:8,col:15,mass:168.934,desc:"Rarssimo. Portteis de raios-X mdicos.",recipe:{earth:[.38,.7],fire:[.35,.65],heat:[.65,1],opusPhase:"RUBEDO",ticksNeeded:30,hint:"Terra + Fogo + RUBEDO opus + calor alto."}},{z:70,symbol:"Yb",name:"Itrbio",cat:"lantanideo",period:6,group:null,row:8,col:16,mass:173.054,desc:"Relgios de preciso atmica mais exatos do mundo.",recipe:{earth:[.38,.7],fire:[.35,.65],heat:[.65,1],opusPhase:"RUBEDO",ticksNeeded:30,hint:"Terra + Fogo + RUBEDO opus."}},{z:71,symbol:"Lu",name:"Lutcio",cat:"lantanideo",period:6,group:null,row:8,col:17,mass:174.967,desc:"ltimo lantandeo. Cintiladores para PET scan.",recipe:{earth:[.4,.72],fire:[.38,.68],heat:[.68,1],opusPhase:"RUBEDO",ticksNeeded:32,hint:"Terra + Fogo + RUBEDO opus. O ltimo lantandeo."}},{z:89,symbol:"Ac",name:"Actnio",cat:"actinineo",period:7,group:null,row:9,col:3,mass:227,desc:"Incio dos actindeos. Raro e radioativo.",recipe:{earth:[.38,.7],fire:[.35,.65],heat:[.68,1],opusPhase:"RUBEDO",lapisRequired:!0,ticksNeeded:35,hint:"Terra + Fogo + RUBEDO + Lapis."}},{z:90,symbol:"Th",name:"Trio",cat:"actinineo",period:7,group:null,row:9,col:4,mass:232.038,desc:"Combustvel nuclear limpo. Mais abundante que urnio.",recipe:{earth:[.4,.75],fire:[.38,.68],heat:[.72,1],opusPhase:"RUBEDO",ticksNeeded:30,hint:"Terra + Fogo intenso + RUBEDO opus. Potncia nuclear."}},{z:91,symbol:"Pa",name:"Protactnio",cat:"actinineo",period:7,group:null,row:9,col:5,mass:231.036,desc:"Intermedirio na produo de urnio-233.",recipe:{earth:[.38,.72],fire:[.38,.68],heat:[.72,1],opusPhase:"RUBEDO",lapisRequired:!0,ticksNeeded:40,hint:"Terra + Fogo + RUBEDO + Lapis."}},{z:92,symbol:"U",name:"Urnio",cat:"actinineo",period:7,group:null,row:9,col:6,mass:238.029,desc:"A fisso nuclear. Hiroshima, Nagasaki, e energia limpa.",recipe:{earth:[.4,.75],fire:[.4,.72],heat:[.75,1],opusPhase:"RUBEDO",ticksNeeded:32,hint:"Terra + Fogo muito intenso + RUBEDO opus. A fisso nuclear!"}},{z:93,symbol:"Np",name:"Netnio",cat:"actinineo",period:7,group:null,row:9,col:7,mass:237,desc:"Primeiro transurnio sinttico descoberto.",recipe:{earth:[.35,.68],fire:[.42,.72],heat:[.78,1],lapisRequired:!0,ticksNeeded:45,hint:"Terra + Fogo intenso + Lapis."}},{z:94,symbol:"Pu",name:"Plutnio",cat:"actinineo",period:7,group:null,row:9,col:8,mass:244,desc:"Bomba atmica. Extremamente txico e radioativo.",recipe:{earth:[.35,.68],fire:[.45,.75],heat:[.82,1],lapisRequired:!0,ticksNeeded:48,hint:"Terra + Fogo + Lapis + calor extremo. Perigo nuclear!"}},{z:95,symbol:"Am",name:"Amercio",cat:"actinineo",period:7,group:null,row:9,col:9,mass:243,desc:"Detectores de fumaa. Produzido de plutnio.",recipe:{earth:[.32,.65],fire:[.45,.75],heat:[.82,1],lapisRequired:!0,ticksNeeded:50,hint:"Terra + Fogo + Lapis."}},{z:96,symbol:"Cm",name:"Crio",cat:"actinineo",period:7,group:null,row:9,col:10,mass:247,desc:"Homenagem a Pierre e Marie Curie.",recipe:{earth:[.3,.62],fire:[.48,.78],heat:[.85,1],lapisRequired:!0,ticksNeeded:52,hint:"Terra + Fogo intenso + Lapis."}},{z:97,symbol:"Bk",name:"Berqulio",cat:"actinineo",period:7,group:null,row:9,col:11,mass:247,desc:"Produzido em Berkeley, CA. Poucos microgramas feitos.",recipe:{earth:[.28,.6],fire:[.5,.82],heat:[.87,1],lapisRequired:!0,ticksNeeded:55,hint:"Condies extremas + Lapis."}},{z:98,symbol:"Cf",name:"Califrnio",cat:"actinineo",period:7,group:null,row:9,col:12,mass:251,desc:"Custo: $27 milhes/grama. Fonte de nutrons.",recipe:{earth:[.25,.58],fire:[.52,.85],heat:[.9,1],lapisRequired:!0,ticksNeeded:58,hint:"Condies extremas mximas + Lapis."}},{z:99,symbol:"Es",name:"Einstenio",cat:"actinineo",period:7,group:null,row:9,col:13,mass:252,desc:'Descoberto aps o teste nuclear "Ivy Mike" de 1952.',recipe:{earth:[.22,.55],fire:[.55,.88],heat:[.92,1],lapisRequired:!0,ticksNeeded:60,hint:"Condies extremas + Lapis."}},{z:100,symbol:"Fm",name:"Frmio",cat:"actinineo",period:7,group:null,row:9,col:14,mass:257,desc:"Homenagem a Enrico Fermi. Sinttico radioativo.",recipe:{earth:[.2,.52],fire:[.58,.9],heat:[.93,1],lapisRequired:!0,ticksNeeded:62,hint:"Condies extremas + Lapis."}},{z:101,symbol:"Md",name:"Mendelvio",cat:"actinineo",period:7,group:null,row:9,col:15,mass:258,desc:"Homenagem a Mendeleev, criador da tabela peridica.",recipe:{earth:[.18,.5],fire:[.6,.92],heat:[.95,1],lapisRequired:!0,ticksNeeded:65,hint:"Condies mximas + Lapis."}},{z:102,symbol:"No",name:"Noblio",cat:"actinineo",period:7,group:null,row:9,col:16,mass:259,desc:"Homenagem a Alfred Nobel (prmio Nobel).",recipe:{earth:[.15,.48],fire:[.62,.92],heat:[.96,1],lapisRequired:!0,ticksNeeded:68,hint:"Condies extremas mximas + Lapis."}},{z:103,symbol:"Lr",name:"Laurncio",cat:"actinineo",period:7,group:null,row:9,col:17,mass:266,desc:"ltimo actindeo. Homenagem a Ernest Lawrence.",recipe:{earth:[.15,.48],fire:[.62,.92],heat:[.97,1],lapisRequired:!0,ticksNeeded:70,hint:"Condies extremas mximas + Lapis. O ltimo actindeo!"}}],WW=new Map(xp.map(e=>[e.z,e]));function HW(e,t,r,o,s,l){const[i,u]=e.heat;if(r<i||r>u||e.lapisRequired&&l!=="FORGED"||e.opusPhase&&s!==e.opusPhase)return!1;if(e.ops){for(const d of e.ops)if(!o.has(d))return!1}const c=(d,h)=>!d||h>=d[0]&&h<=d[1];return c(e.earth,t.earth)&&c(e.water,t.water)&&c(e.air,t.air)&&c(e.fire,t.fire)}const IS=new Set([1,2,6,7,8,16,26]),GW=["alcali","alcalino-terroso","transicao","lantanideo","actinineo","metal-representativo","semi-metal","nao-metal","halogeno","gas-nobre","desconhecido"],VW=`
@keyframes flash-solve      { 0%{opacity:.5}  70%{opacity:.1} 100%{opacity:0} }
@keyframes flash-coagula    { 0%{opacity:.55} 70%{opacity:.12} 100%{opacity:0} }
@keyframes flash-calcinatio { 0%{opacity:.7}  60%{opacity:.2} 100%{opacity:0} }
@keyframes flash-sublimatio { 0%{opacity:.5}  70%{opacity:.08} 100%{opacity:0} }
@keyframes flash-fermentatio{ 0%{opacity:.45} 70%{opacity:.1} 100%{opacity:0} }
@keyframes flash-putrefactio{ 0%{opacity:.8}  50%{opacity:.4} 100%{opacity:0} }
@keyframes flash-circulatio { 0%{opacity:.45} 70%{opacity:.08} 100%{opacity:0} }
@keyframes flash-fixatio    { 0%{opacity:.55} 70%{opacity:.12} 100%{opacity:0} }
@keyframes orbit-1 { from{transform:rotate(0deg)} to{transform:rotate(360deg)} }
@keyframes orbit-2 { from{transform:rotate(120deg)} to{transform:rotate(480deg)} }
@keyframes orbit-3 { from{transform:rotate(240deg)} to{transform:rotate(600deg)} }
@keyframes nucleus-pulse { 0%,100%{box-shadow:0 0 20px var(--el-color,#fff)} 50%{box-shadow:0 0 50px var(--el-color,#fff)} }
@keyframes modal-in { from{opacity:0;transform:scale(.9) translateY(30px)} to{opacity:1;transform:scale(1) translateY(0)} }
@keyframes badge-bounce { 0%,100%{transform:scale(1)} 40%{transform:scale(1.15)} 60%{transform:scale(.95)} }
@keyframes glow-pulse { 0%,100%{opacity:.65} 50%{opacity:1} }
@keyframes slide-in-left { from{transform:translateX(-100%);opacity:0} to{transform:translateX(0);opacity:1} }
@keyframes progress-fill { from{width:0} to{width:var(--w)} }
.alchemy-hud-enter { animation: slide-in-left .25s ease-out; }
`,UW={solve:"rgba(100,170,255,.18)",coagula:"rgba(255,150,40,.22)",calcinatio:"rgba(255,70,20,.28)",sublimatio:"rgba(120,220,255,.18)",fermentatio:"rgba(60,210,60,.18)",putrefactio:"rgba(90,0,90,.38)",circulatio:"rgba(150,70,255,.18)",fixatio:"rgba(50,180,180,.22)"},YW=[{id:"solve",label:"Solve",latin:"Solutio",icon:"",color:"#5aafff",desc:"Dissolve  dispersa partculas, separa o fixo do voltil."},{id:"coagula",label:"Coagula",latin:"Coagulatio",icon:"",color:"#ffaa30",desc:"Coagula  une partculas, solidifica o voltil em forma estvel."},{id:"calcinatio",label:"Calcinatio",latin:"Calcinatio",icon:"",color:"#ff5020",desc:"Eleva calor +35%. Purifica pela chama. Desbloqueia elementos de alta temperatura."},{id:"sublimatio",label:"Sublimatio",latin:"Sublimatio",icon:"",color:"#80e8ff",desc:"Eleva Ar, reduz Terra. O slido se torna voltil  gases nobres e halognios."},{id:"fermentatio",label:"Fermentatio",latin:"Fermentatio",icon:"",color:"#50dd50",desc:"Equilibra os 4 elementos em 25% cada  ativa Quintessncia mxima."},{id:"putrefactio",label:"Putrefactio",latin:"Putrefactio",icon:"",color:"#aa40aa",desc:"Regride tudo ao Plmbum  reinicia o ciclo alqumico."},{id:"circulatio",label:"Circulatio",latin:"Circulatio",icon:"",color:"#a060ff",desc:"Fora orbital circular  COAGULA  SOLVE em ciclo rpido."},{id:"fixatio",label:"Fixatio",latin:"Fixatio",icon:"",color:"#40cccc",desc:"Congela velocidades + reduz calor. Cristaliza o caos em ordem."}],s5={attractor:{label:"Atrator",color:Zu.attractor,icon:"",desc:"Puxa partculas  o forno absorvente"},repulsor:{label:"Repulsor",color:Zu.repulsor,icon:"",desc:"Expele partculas  o forno repelente"},channel:{label:"Canal",color:Zu.channel,icon:"",desc:"Guia o fluxo em uma direo"},barrier:{label:"Barreira",color:Zu.barrier,icon:"",desc:"Barreira quntica  pode ser tunelada"},tunnel:{label:"Tnel",color:Zu.tunnel,icon:"",desc:"Canal quntico  passagem seletiva"}},uh={earth:{sym:"",label:"Terra",color:"#8b7a55",hint:"Solidez  Metais  Minerais"},water:{sym:"",label:"gua",color:"#3a7fa0",hint:"Fluidez  Hidrognio  Dissoluo"},air:{sym:"",label:"Ar",color:"#90b0c0",hint:"Volatilidade  Gases  Leveza"},fire:{sym:"",label:"Fogo",color:"#c8561e",hint:"Reatividade  Calor  Energia"}},KW=({k:e,value:t,onChange:r})=>{const o=w.useRef(null),s=w.useRef({active:!1,startAngle:0,startValue:0}),{sym:l,label:i,color:u,hint:c}=uh[e],d=50,h=25,f=25,g=20,m=T=>{const _=o.current.getBoundingClientRect();return Math.atan2(T.clientY-(_.top+_.height/2),T.clientX-(_.left+_.width/2))*180/Math.PI},y=T=>{T.preventDefault(),s.current={active:!0,startAngle:m(T),startValue:t}};w.useEffect(()=>{const T=P=>{if(!s.current.active)return;const I=(m(P)-s.current.startAngle)/240;r(Math.max(.01,Math.min(1,s.current.startValue+I)))},_=()=>{s.current.active=!1};return window.addEventListener("mousemove",T),window.addEventListener("mouseup",_),()=>{window.removeEventListener("mousemove",T),window.removeEventListener("mouseup",_)}},[r]);const v=T=>[h+g*Math.cos(T*Math.PI/180),f+g*Math.sin(T*Math.PI/180)],b=150,[S,C]=v(b),[k,R]=v(b+t*240),j=t*240>180?1:0;return a.jsxs("div",{className:"flex flex-col items-center gap-0.5 select-none cursor-ns-resize",title:c,onMouseDown:y,children:[a.jsxs("svg",{ref:o,width:d,height:d,style:{filter:t>.4?`drop-shadow(0 0 ${t*4}px ${u})`:"none"},children:[a.jsx("path",{d:`M ${S} ${C} A ${g} ${g} 0 1 1 ${v(b+240)[0]} ${v(b+240)[1]}`,fill:"none",stroke:"rgba(255,255,255,.07)",strokeWidth:2.2,strokeLinecap:"round"}),t>.01&&a.jsx("path",{d:`M ${S} ${C} A ${g} ${g} 0 ${j} 1 ${k} ${R}`,fill:"none",stroke:u,strokeWidth:2.2,strokeLinecap:"round",opacity:.85}),a.jsx("text",{x:h,y:f+4,textAnchor:"middle",fill:u,fontSize:11,fontFamily:"serif",opacity:.9,children:l})]}),a.jsx("div",{style:{fontSize:6,color:u+"aa",letterSpacing:".1em",textTransform:"uppercase"},children:i}),a.jsxs("div",{style:{fontSize:6,color:u+"55",fontFamily:"monospace"},children:[Math.round(t*100),"%"]})]})},XW=({value:e,onChange:t})=>{const r=`hsl(${Math.max(0,30-e*32)},88%,52%)`;return a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:3},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsx("span",{style:{fontSize:6.5,color:"rgba(255,255,255,.3)",textTransform:"uppercase",letterSpacing:".1em"},children:" Calor do Atanor"}),a.jsxs("span",{style:{fontSize:8,fontFamily:"monospace",color:r},children:[Math.round(e*100),""]})]}),a.jsxs("div",{style:{position:"relative",height:6,background:"rgba(255,255,255,.06)",borderRadius:3,overflow:"visible"},children:[a.jsx("div",{style:{position:"absolute",left:0,top:0,height:"100%",width:`${e*100}%`,background:`linear-gradient(90deg, rgba(100,100,255,.6), ${r})`,borderRadius:3,transition:"width .05s",boxShadow:`0 0 ${e*8}px ${r}66`}}),a.jsx("input",{type:"range",min:0,max:1,step:.01,value:e,onChange:o=>t(parseFloat(o.target.value)),style:{position:"absolute",inset:0,opacity:0,cursor:"pointer",width:"100%",margin:0}})]}),a.jsxs("div",{style:{fontSize:6,color:"rgba(255,255,255,.2)",lineHeight:1.4},children:[e<.25&&"Frio  Gases nobres, elementos leves",e>=.25&&e<.55&&"Moderado  Metais de transio, sais",e>=.55&&e<.8&&"Quente  Metais pesados, lantandeos",e>=.8&&"Extremo  Actindeos, elementos sintticos, Opus RUBEDO"]})]})},ZW=({entry:e,onBookmark:t})=>{const r=w.useRef(null);w.useEffect(()=>{r.current&&NW(r.current,e.glyphSpec,36)},[e.glyphSpec]);const o={NIGREDO:"#555",ALBEDO:"#aac",CITRINITAS:"#da0",RUBEDO:"#800"};return a.jsxs("div",{className:`flex gap-2 p-1.5 rounded border ${e.bookmarked?"border-amber-600/30 bg-amber-900/8":"border-white/[.04] bg-white/[.015]"}`,children:[a.jsx("canvas",{ref:r,width:36,height:36,className:"rounded flex-shrink-0"}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[a.jsxs("div",{className:"flex items-center gap-1 flex-wrap",children:[e.phase&&a.jsx("span",{className:"text-[5px] font-mono uppercase px-1 rounded",style:{color:o[e.phase]??"#888",background:o[e.phase]+"18"},children:e.phase}),e.event&&a.jsx("span",{className:"text-[5px] font-mono px-1 rounded bg-red-900/25 text-red-400",children:e.event}),a.jsx("span",{className:"text-[5px] font-mono text-white/20",children:BW(e.timestamp)})]}),a.jsx("button",{title:"Bookmark",onClick:t,className:`${e.bookmarked?"text-amber-400":"text-white/15 hover:text-amber-500/40"}`,children:a.jsx(Bb,{size:7})})]}),a.jsx("p",{className:"text-[6.5px] font-serif text-white/55 leading-snug line-clamp-3 mb-0.5",children:e.text}),a.jsx("p",{className:"text-[5.5px] font-mono text-white/2 italic",children:e.causalLine})]})]})},Ay=({orbit:e,speed:t,color:r,delay:o=0})=>a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:e*2,height:e*2,marginTop:-e,marginLeft:-e,borderRadius:"50%",border:`1px solid ${r}28`,animation:`orbit-${e%3+1} ${t}s linear infinite`,animationDelay:`${o}s`},children:a.jsx("div",{style:{position:"absolute",top:-3,left:"50%",marginLeft:-3,width:6,height:6,borderRadius:"50%",background:r,boxShadow:`0 0 8px ${r}`,animation:`glow-pulse ${t*.6}s ease-in-out infinite`}})}),JW=({data:e,onContinue:t,onReplay:r})=>{const{element:o,earth:s,water:l,air:i,fire:u,heat:c,opsUsed:d,opusPhase:h,lapisState:f,totalDiscovered:g}=e,m=qs[o.cat],[y,v]=w.useState("story"),b=w.useMemo(()=>{var R;const C=[],k=o.recipe;return k.earth&&C.push(`Terra ${Math.round(k.earth[0]*100)}-${Math.round(k.earth[1]*100)}%`),k.water&&C.push(`gua ${Math.round(k.water[0]*100)}-${Math.round(k.water[1]*100)}%`),k.air&&C.push(`Ar ${Math.round(k.air[0]*100)}-${Math.round(k.air[1]*100)}%`),k.fire&&C.push(`Fogo ${Math.round(k.fire[0]*100)}-${Math.round(k.fire[1]*100)}%`),C.push(`Calor ${Math.round(k.heat[0]*100)}-${Math.round(k.heat[1]*100)}`),(R=k.ops)!=null&&R.length&&C.push(`Ops: ${k.ops.join(", ")}`),k.opusPhase&&C.push(`Opus ${k.opusPhase}`),k.lapisRequired&&C.push("Lapis Forjada"),C},[o]),S=w.useMemo(()=>[{label:"Terra",value:s,color:uh.earth.color},{label:"gua",value:l,color:uh.water.color},{label:"Ar",value:i,color:uh.air.color},{label:"Fogo",value:u,color:uh.fire.color},{label:"Calor",value:c,color:`hsl(${Math.max(0,30-c*32)},88%,52%)`}],[s,l,i,u,c]);return a.jsx("div",{style:{position:"fixed",inset:0,zIndex:300,background:"rgba(0,0,0,.93)",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(4px)"},children:a.jsxs("div",{style:{width:520,maxWidth:"90vw",maxHeight:"90vh",background:"rgba(8,6,16,.98)",border:`1px solid ${m.color}44`,borderRadius:16,boxShadow:`0 0 60px ${m.color}22, 0 0 120px rgba(0,0,0,.8)`,display:"flex",flexDirection:"column",animation:"modal-in .4s cubic-bezier(.34,1.56,.64,1) forwards",overflow:"hidden"},children:[a.jsxs("div",{style:{background:`linear-gradient(135deg, ${m.color}18 0%, rgba(8,6,16,0) 60%)`,borderBottom:`1px solid ${m.color}25`,padding:"20px 24px 16px",display:"flex",gap:20,alignItems:"center"},children:[a.jsxs("div",{style:{position:"relative",width:90,height:90,flexShrink:0},children:[a.jsx(Ay,{orbit:38,speed:3.2,color:m.color,delay:0}),a.jsx(Ay,{orbit:28,speed:2.1,color:m.color,delay:.5}),a.jsx(Ay,{orbit:18,speed:1.4,color:m.color,delay:1}),a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)",width:44,height:44,borderRadius:"50%",background:`radial-gradient(circle, ${m.color}40, ${m.color}12)`,border:`2px solid ${m.color}`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,color:m.color,fontFamily:"serif",fontWeight:700,animation:"nucleus-pulse 2s ease-in-out infinite","--el-color":m.color},children:o.symbol})]}),a.jsxs("div",{style:{flex:1},children:[a.jsxs("div",{style:{fontSize:9,color:`${m.color}99`,letterSpacing:".2em",textTransform:"uppercase",marginBottom:4},children:[" Elemento Descoberto  ",g,"/118"]}),a.jsx("div",{style:{fontSize:26,color:"rgba(255,255,255,.95)",fontWeight:700,lineHeight:1,marginBottom:3},children:o.name}),a.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap",marginBottom:4},children:[a.jsxs("span",{style:{fontSize:9,fontFamily:"monospace",color:"rgba(255,255,255,.45)"},children:["Z = ",o.z]}),a.jsx("span",{style:{fontSize:9,fontFamily:"monospace",color:"rgba(255,255,255,.25)"},children:""}),a.jsxs("span",{style:{fontSize:9,fontFamily:"monospace",color:"rgba(255,255,255,.45)"},children:["M = ",o.mass]}),a.jsx("span",{style:{fontSize:9,fontFamily:"monospace",color:"rgba(255,255,255,.25)"},children:""}),a.jsx("span",{style:{fontSize:9,padding:"2px 7px",borderRadius:10,background:`${m.color}22`,color:m.color,border:`1px solid ${m.color}44`},children:m.label})]}),o.alch&&a.jsxs("div",{style:{fontSize:9,color:`${m.color}77`,fontStyle:"italic"},children:[" ",o.alch]})]})]}),a.jsx("div",{style:{padding:"12px 24px 0",fontSize:11,color:"rgba(255,255,255,.65)",lineHeight:1.65},children:o.desc}),a.jsx("div",{style:{display:"flex",gap:0,borderBottom:"1px solid rgba(255,255,255,.06)",padding:"10px 24px 0",marginTop:8},children:["story","recipe","table"].map(C=>a.jsxs("button",{title:C,onClick:()=>v(C),style:{padding:"5px 12px",borderRadius:"6px 6px 0 0",cursor:"pointer",fontSize:9,fontWeight:y===C?600:400,background:y===C?`${m.color}16`:"transparent",border:`1px solid ${y===C?m.color+"33":"transparent"}`,borderBottom:`2px solid ${y===C?m.color:"transparent"}`,color:y===C?m.color:"rgba(255,255,255,.35)"},children:[C==="story"&&" Por que Aconteceu",C==="recipe"&&" Receita",C==="table"&&" Na Tabela"]},C))}),a.jsxs("div",{style:{padding:"14px 24px",flex:1,overflowY:"auto",minHeight:140},children:[y==="story"&&a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[a.jsx("div",{style:{padding:"10px 14px",borderRadius:8,background:`${m.color}0c`,border:`1px solid ${m.color}28`,fontSize:10,color:"rgba(255,255,255,.7)",lineHeight:1.7},children:o.recipe.hint}),a.jsx("div",{style:{fontSize:8,color:"rgba(255,255,255,.3)",letterSpacing:".1em",textTransform:"uppercase",marginTop:2},children:"Condies que voc criou:"}),a.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:S.map(C=>a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:3,padding:"6px 10px",borderRadius:6,background:`${C.color}10`,border:`1px solid ${C.color}35`,minWidth:52},children:[a.jsxs("div",{style:{fontSize:14,fontFamily:"serif",color:C.color},children:[Math.round(C.value*100),"%"]}),a.jsx("div",{style:{fontSize:7,color:`${C.color}99`,textTransform:"uppercase",letterSpacing:".08em"},children:C.label}),a.jsx("div",{style:{width:"100%",height:2,background:"rgba(255,255,255,.08)",borderRadius:2},children:a.jsx("div",{style:{height:"100%",width:`${C.value*100}%`,background:C.color,borderRadius:2}})})]},C.label))}),a.jsxs("div",{style:{display:"flex",gap:4,flexWrap:"wrap",marginTop:2},children:[d.length>0&&d.slice(0,4).map(C=>a.jsxs("span",{style:{fontSize:8,padding:"3px 8px",borderRadius:10,background:"rgba(255,255,255,.06)",border:"1px solid rgba(255,255,255,.12)",color:"rgba(255,255,255,.5)"},children:[" ",C]},C)),h&&a.jsxs("span",{style:{fontSize:8,padding:"3px 8px",borderRadius:10,background:"rgba(160,80,255,.1)",border:"1px solid rgba(160,80,255,.3)",color:"rgba(200,150,255,.8)"},children:[" Opus ",h]}),f==="FORGED"&&a.jsx("span",{style:{fontSize:8,padding:"3px 8px",borderRadius:10,background:"rgba(255,200,60,.1)",border:"1px solid rgba(255,200,60,.3)",color:"rgba(255,220,100,.8)"},children:" Lapis Forjada"})]})]}),y==="recipe"&&a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[a.jsxs("div",{style:{fontSize:8.5,color:"rgba(255,255,255,.5)",lineHeight:1.65},children:["Para descobrir ",a.jsx("strong",{style:{color:m.color},children:o.name})," novamente voc precisa:"]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[b.map((C,k)=>a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"6px 10px",borderRadius:6,background:"rgba(255,255,255,.03)",border:"1px solid rgba(255,255,255,.06)"},children:[a.jsx("span",{style:{fontSize:9,color:m.color},children:""}),a.jsx("span",{style:{fontSize:9,color:"rgba(255,255,255,.65)"},children:C})]},k)),a.jsxs("div",{style:{marginTop:4,padding:"6px 10px",borderRadius:6,background:"rgba(255,255,255,.02)",fontSize:8,color:"rgba(255,255,255,.3)",lineHeight:1.6,border:"1px solid rgba(255,255,255,.05)"},children:[" Mantenha as condies por ~",o.recipe.ticksNeeded*2,"s para a descoberta."]})]})]}),y==="table"&&a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[a.jsxs("div",{style:{fontSize:8.5,color:"rgba(255,255,255,.5)",lineHeight:1.65},children:[a.jsx("strong",{style:{color:m.color},children:o.name})," est no perodo ",a.jsx("strong",{style:{color:"rgba(255,255,255,.7)"},children:o.period}),o.group&&a.jsxs(a.Fragment,{children:[", grupo ",a.jsx("strong",{style:{color:"rgba(255,255,255,.7)"},children:o.group})]}),".  um ",a.jsx("strong",{style:{color:m.color},children:m.label}),"."]}),a.jsxs("div",{style:{padding:"8px 12px",borderRadius:8,background:`${m.color}08`,border:`1px solid ${m.color}20`,fontSize:8.5,color:"rgba(255,255,255,.55)",lineHeight:1.7},children:[o.cat==="alcali"&&"Metais Alcalinos reagem violentamente com gua liberando Hidrognio. So muito reativos  o Fogo Alqumico domina.",o.cat==="alcalino-terroso"&&"Metais Alcalino-Terrosos so menos reativos que alcalinos, mas ainda muito ativos. Terra + Fogo os invocam.",o.cat==="transicao"&&"Metais de Transio so versteis  condutores, catalticos, coloridos. Terra dominante + calor os revelam.",o.cat==="lantanideo"&&"Lantandeos so terras raras usadas em tecnologia moderna. Requerem o Opus Magnus (fase NIGREDO a RUBEDO).",o.cat==="actinineo"&&"Actindeos so radioativos. Muitos so sintticos  apenas criados em reatores. O Lapis  necessrio.",o.cat==="nao-metal"&&"No-Metais so a base da qumica orgnica e atmosfrica. Ar e gua os invocam com facilidade.",o.cat==="halogeno"&&"Halognios so reativos, formam sais. Ar + Fogo (e s vezes gua) criam as condies para eles emergirem.",o.cat==="gas-nobre"&&"Gases Nobres so inertes  no reagem. Use SUBLIMATIO com Ar dominante e baixo calor para isol-los.",o.cat==="semi-metal"&&"Semi-metais (metaloides) tm propriedades intermedirias. Terra + Ar ou Terra + Fogo os cristalizam.",o.cat==="metal-representativo"&&"Metais Representativos so estveis e versteis. Terra + calor moderado os forma.",o.cat==="desconhecido"&&"Elementos com propriedades ainda no totalmente conhecidas. So sintticos e extremamente instveis."]})]})]}),a.jsxs("div",{style:{padding:"12px 24px",borderTop:"1px solid rgba(255,255,255,.06)",display:"flex",gap:8,justifyContent:"flex-end",background:"rgba(8,6,16,.6)"},children:[a.jsxs("button",{title:"Reset",onClick:r,style:{padding:"8px 16px",borderRadius:8,cursor:"pointer",fontSize:10,background:"rgba(255,255,255,.05)",border:"1px solid rgba(255,255,255,.12)",color:"rgba(255,255,255,.5)",display:"flex",alignItems:"center",gap:5},children:[a.jsx(Wi,{size:11})," Replay"]}),a.jsx("button",{title:"Continuar",onClick:t,style:{padding:"8px 22px",borderRadius:8,cursor:"pointer",fontSize:11,fontWeight:700,background:`linear-gradient(135deg, ${m.color}30, ${m.color}18)`,border:`1px solid ${m.color}55`,color:m.color,display:"flex",alignItems:"center",gap:6,boxShadow:`0 0 20px ${m.color}25`},children:"Continuar a Obra "})]})]})})},QW=({discovered:e,progress:t})=>{const[r,o]=w.useState(null),s=w.useMemo(()=>{const u=Array.from({length:9},()=>Array(18).fill(null));for(const c of xp)u[c.row-1][c.col-1]=c;return u},[]),l=w.useMemo(()=>xp.filter(u=>!e.has(u.z)&&(t.get(u.z)??0)>0).sort((u,c)=>{const d=(t.get(u.z)??0)/u.recipe.ticksNeeded;return(t.get(c.z)??0)/c.recipe.ticksNeeded-d}).slice(0,4),[e,t]),i=r?WW.get(r):null;return a.jsxs("div",{style:{padding:"8px 8px 6px",display:"flex",flexDirection:"column",gap:7},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.jsx("div",{style:{fontSize:6.5,color:"rgba(255,255,255,.3)",letterSpacing:".12em",textTransform:"uppercase"},children:" Tabela Peridica"}),a.jsxs("div",{style:{fontSize:9,fontFamily:"monospace",color:"rgba(255,255,255,.5)"},children:[a.jsx("span",{style:{color:"#80ff80"},children:e.size}),a.jsx("span",{style:{color:"rgba(255,255,255,.2)"},children:"/118"})]})]}),a.jsx("div",{style:{height:3,background:"rgba(255,255,255,.06)",borderRadius:2,overflow:"hidden"},children:a.jsx("div",{style:{height:"100%",width:`${e.size/118*100}%`,background:"linear-gradient(90deg,#6040c0,#80ff80)",borderRadius:2,transition:"width .5s"}})}),l.length>0&&a.jsxs("div",{style:{borderRadius:6,background:"rgba(255,200,60,.04)",border:"1px solid rgba(255,200,60,.12)",padding:"6px 8px"},children:[a.jsx("div",{style:{fontSize:6,color:"rgba(255,200,60,.65)",letterSpacing:".12em",textTransform:"uppercase",marginBottom:5},children:" Prximo da Descoberta"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:l.map(u=>{const c=(t.get(u.z)??0)/u.recipe.ticksNeeded,d=qs[u.cat];return a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},onMouseEnter:()=>o(u.z),onMouseLeave:()=>o(null),children:[a.jsx("div",{style:{width:20,height:20,borderRadius:3,flexShrink:0,display:"flex",alignItems:"center",justifyContent:"center",fontSize:8,fontWeight:700,fontFamily:"monospace",background:`${d.color}22`,border:`1px solid ${d.color}55`,color:d.color},children:u.symbol}),a.jsxs("div",{style:{flex:1,minWidth:0},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[a.jsx("span",{style:{fontSize:7,color:"rgba(255,255,255,.55)"},children:u.name}),a.jsxs("span",{style:{fontSize:6.5,fontFamily:"monospace",color:d.color},children:[Math.round(c*100),"%"]})]}),a.jsx("div",{style:{height:2.5,background:"rgba(255,255,255,.06)",borderRadius:2,overflow:"hidden"},children:a.jsx("div",{style:{height:"100%",width:`${c*100}%`,background:d.color,borderRadius:2,transition:"width .5s"}})})]})]},u.z)})})]}),a.jsx("div",{style:{overflowX:"auto",overflowY:"visible"},children:a.jsx("div",{style:{display:"grid",gridTemplateRows:"repeat(9, 13px)",gridTemplateColumns:"6px repeat(18, 12px)",gap:1,minWidth:230},children:s.map((u,c)=>a.jsxs(Yt.Fragment,{children:[a.jsx("div",{style:{fontSize:5,color:"rgba(255,255,255,.18)",display:"flex",alignItems:"center",justifyContent:"flex-end",paddingRight:1,gridRow:c+1,gridColumn:1},children:c===7?"":c===8?"Ln":c===9?"An":c+1}),u.map((d,h)=>{if(!d)return a.jsx("div",{style:{gridRow:c+1,gridColumn:h+2,width:12,height:13}},h);const f=e.has(d.z),g=(t.get(d.z)??0)/d.recipe.ticksNeeded,m=qs[d.cat];return a.jsx("div",{style:{gridRow:c+1,gridColumn:h+2},onMouseEnter:()=>o(d.z),onMouseLeave:()=>o(null),children:a.jsx("div",{style:{width:12,height:13,borderRadius:1,border:"1px solid",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:4.5,fontFamily:"monospace",fontWeight:700,transition:"all .15s",background:f?`${m.color}25`:g>0?`${m.dim}18`:"rgba(255,255,255,.015)",borderColor:f?`${m.color}80`:g>0?`${m.color}${Math.round(g*160).toString(16).padStart(2,"0")}`:"rgba(255,255,255,.07)",color:f?m.color:g>0?m.dim:"rgba(255,255,255,.2)",boxShadow:f?`0 0 3px ${m.color}33`:"none",animation:g>0&&!f?"glow-pulse 1.8s ease-in-out infinite":"none"},children:d.symbol.slice(0,2)})},h)})]},c))})}),i&&a.jsxs("div",{style:{borderRadius:6,padding:"8px 10px",background:`${qs[i.cat].color}0c`,border:`1px solid ${qs[i.cat].color}33`},children:[a.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:8,marginBottom:4},children:[a.jsx("span",{style:{fontSize:20,fontFamily:"serif",fontWeight:700,lineHeight:1,color:qs[i.cat].color,opacity:e.has(i.z)?1:.4},children:i.symbol}),a.jsxs("div",{children:[a.jsx("div",{style:{fontSize:10,color:"rgba(255,255,255,.85)",fontWeight:600},children:i.name}),a.jsxs("div",{style:{fontSize:7,color:"rgba(255,255,255,.3)",fontFamily:"monospace"},children:["Z=",i.z,"  ",qs[i.cat].label]})]}),a.jsx("div",{style:{marginLeft:"auto",fontSize:9,color:e.has(i.z)?"#80ff80":"rgba(255,255,255,.2)"},children:e.has(i.z)?"":""})]}),i.alch&&a.jsxs("div",{style:{fontSize:7,color:`${qs[i.cat].color}77`,fontStyle:"italic",marginBottom:4},children:[" ",i.alch]}),a.jsx("div",{style:{fontSize:7.5,color:"rgba(255,255,255,.55)",lineHeight:1.55,marginBottom:5},children:i.desc}),!e.has(i.z)&&a.jsxs("div",{style:{fontSize:7,color:"rgba(255,220,80,.75)",lineHeight:1.55,padding:"4px 6px",background:"rgba(255,200,60,.06)",borderRadius:4},children:[" ",i.recipe.hint]}),!e.has(i.z)&&(t.get(i.z)??0)>0&&a.jsx("div",{style:{height:3,background:"rgba(255,255,255,.06)",borderRadius:2,overflow:"hidden",marginTop:5},children:a.jsx("div",{style:{height:"100%",width:`${(t.get(i.z)??0)/i.recipe.ticksNeeded*100}%`,background:qs[i.cat].color,borderRadius:2}})})]}),a.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"2px 6px",paddingTop:4,borderTop:"1px solid rgba(255,255,255,.05)"},children:GW.map(u=>a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:3},children:[a.jsx("div",{style:{width:7,height:7,borderRadius:1,background:`${qs[u].color}35`,border:`1px solid ${qs[u].color}55`}}),a.jsx("span",{style:{fontSize:5,color:"rgba(255,255,255,.25)"},children:qs[u].label})]},u))})]})},eH=({elements:e,heat:t,transmutation:r,quintessence:o,recipeScores:s,simSpeed:l,onElement:i,onHeat:u,onPreset:c,onSimSpeed:d})=>a.jsxs("div",{style:{padding:"8px 10px",display:"flex",flexDirection:"column",gap:10},children:[a.jsx("div",{style:{fontSize:7,color:"rgba(255,180,60,.7)",letterSpacing:".12em",textTransform:"uppercase"},children:" Atanor  Forno Alqumico"}),a.jsxs("div",{style:{fontSize:7,color:"rgba(255,255,255,.4)",lineHeight:1.6,background:"rgba(255,180,60,.04)",borderRadius:4,padding:"5px 8px",border:"1px solid rgba(255,180,60,.1)"},children:["Ajuste os ",a.jsx("strong",{style:{color:"rgba(255,200,100,.8)"},children:"4 Elementos"})," e o",a.jsx("strong",{style:{color:"rgba(255,120,60,.8)"},children:" Calor"})," para criar condies de descoberta."]}),a.jsxs("div",{children:[a.jsx("div",{style:{fontSize:6,color:"rgba(255,255,255,.22)",letterSpacing:".12em",textTransform:"uppercase",marginBottom:4},children:"Velocidade da Simulao"}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[a.jsxs("span",{style:{fontSize:8,minWidth:16,textAlign:"right",fontFamily:"monospace",color:l<.2?"#60c8f0":l<.7?"#a0c080":"#ffa030"},children:[l<.15?"":l<.6?"":""," ",Math.round(l*100),"%"]}),a.jsx("input",{type:"range",min:.05,max:2,step:.05,value:l,onChange:h=>d(+h.target.value),style:{flex:1,accentColor:"#ffa030",cursor:"pointer"}}),a.jsx("div",{style:{display:"flex",gap:2},children:[.15,.4,1].map(h=>a.jsx("button",{title:`Velocidade ${h}x`,onClick:()=>d(h),style:{fontSize:6,padding:"1px 4px",borderRadius:2,cursor:"pointer",border:"none",background:Math.abs(l-h)<.03?"rgba(255,160,60,.25)":"rgba(255,255,255,.05)",color:Math.abs(l-h)<.03?"rgba(255,180,80,.9)":"rgba(255,255,255,.3)"},children:h===.15?"Lento":h===.4?"Mdio":"Normal"},h))})]})]}),a.jsxs("div",{children:[a.jsx("div",{style:{fontSize:6,color:"rgba(255,255,255,.22)",letterSpacing:".12em",textTransform:"uppercase",marginBottom:5},children:"Proporo dos Elementos"}),a.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:2,alignItems:"end"},children:Object.keys(uh).map(h=>a.jsx(KW,{k:h,value:e[h],onChange:f=>i(h,f)},h))})]}),a.jsx(XW,{value:t,onChange:u}),a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[a.jsx("span",{style:{fontSize:6.5,color:"rgba(255,255,255,.28)",textTransform:"uppercase",letterSpacing:".08em"},children:"Quintessncia"}),a.jsxs("span",{style:{fontSize:7,fontFamily:"monospace",color:o>.7?"#ffd060":"rgba(255,255,255,.4)"},children:[Math.round(o*100),"%"]})]}),a.jsx("div",{style:{height:3,background:"rgba(255,255,255,.06)",borderRadius:2,overflow:"hidden"},children:a.jsx("div",{style:{height:"100%",width:`${o*100}%`,background:"linear-gradient(90deg,#c060ff,#ffd060)",borderRadius:2,transition:"width .4s"}})}),a.jsx("div",{style:{fontSize:6,color:"rgba(255,255,255,.22)",marginTop:2},children:"= 1 quando os 4 elementos esto a 25% cada"})]}),a.jsxs("div",{children:[a.jsx("div",{style:{fontSize:6,color:"rgba(255,255,255,.22)",textTransform:"uppercase",letterSpacing:".08em",marginBottom:4},children:"Substncias no Atanor"}),a.jsx("div",{style:{display:"flex",gap:3,flexWrap:"wrap"},children:lW.map(h=>{const f=gp[h],g=r.counts[h]??0;return a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:3,padding:"3px 6px",borderRadius:4,background:g>0?f.color+"16":"rgba(255,255,255,.02)",border:`1px solid ${g>0?f.color+"40":"rgba(255,255,255,.05)"}`,opacity:g>0?1:.4},children:[a.jsx("span",{style:{fontSize:9,lineHeight:1},children:f.symbol}),a.jsxs("div",{children:[a.jsx("div",{style:{fontSize:6.5,color:f.color,fontFamily:"serif",fontWeight:600},children:f.label}),a.jsx("div",{style:{fontSize:5.5,color:"rgba(255,255,255,.3)",fontFamily:"monospace"},children:g})]})]},h)})})]}),a.jsxs("div",{children:[a.jsx("div",{style:{fontSize:6,color:"rgba(255,255,255,.22)",textTransform:"uppercase",letterSpacing:".08em",marginBottom:4},children:"Transmutaes Ativas"}),yp.map(h=>{const f=s[h.id]??0;return f<.05?null:a.jsxs("div",{style:{padding:"4px 7px",borderRadius:4,background:"rgba(255,255,255,.02)",border:`1px solid rgba(80,255,80,${(f*.3).toFixed(2)})`,marginBottom:3},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[a.jsx("span",{style:{fontSize:7.5,color:"rgba(255,255,255,.65)",fontStyle:"italic"},children:h.name}),a.jsx("div",{style:{width:35,height:3,background:"rgba(255,255,255,.06)",borderRadius:2,overflow:"hidden",marginTop:1},children:a.jsx("div",{style:{height:"100%",width:`${f*100}%`,background:"#60ff90",borderRadius:2}})})]}),a.jsx("div",{style:{fontSize:6.5,color:"rgba(255,255,255,.38)",lineHeight:1.45},children:h.hint})]},h.id)}).filter(Boolean),yp.every(h=>(s[h.id]??0)<.05)&&a.jsx("div",{style:{fontSize:7,color:"rgba(255,255,255,.18)",fontStyle:"italic"},children:"Ajuste os elementos para ativar..."})]}),a.jsxs("select",{onChange:h=>{h.target.value&&c(h.target.value)},defaultValue:"",style:{width:"100%",background:"rgba(255,255,255,.04)",border:"1px solid rgba(255,255,255,.08)",color:"rgba(255,255,255,.55)",fontSize:9,padding:"4px 6px",borderRadius:4,cursor:"pointer"},children:[a.jsx("option",{value:"",children:" Preset Alqumico "}),ep.map(h=>a.jsxs("option",{value:h.id,children:[h.name,"  ",h.subtitle]},h.id))]})]}),tH=({opus:e,sequencer:t,onStartOpus:r,onSeqToggle:o,onSeqBpm:s,onSeqPreset:l,onSeqQuantum:i})=>{const u=[{id:"NIGREDO",sym:"",color:"#664444",label:"Nigredo",desc:"Putrefao  calor mdio, terra+gua, alta tenso"},{id:"ALBEDO",sym:"",color:"#b0b8d0",label:"Albedo",desc:"Lavagem  calor baixo, gua+ar, alta integrao"},{id:"CITRINITAS",sym:"",color:"#d4a020",label:"Citrinitas",desc:"Amarelecimento  equilbrio, calor mdio"},{id:"RUBEDO",sym:"",color:"#aa2020",label:"Rubedo",desc:"Vermelhido  fogo+terra, calor alto, grande obra"}];return a.jsxs("div",{style:{padding:"8px 10px",display:"flex",flexDirection:"column",gap:9},children:[a.jsx("div",{style:{fontSize:7,color:"rgba(255,160,80,.7)",letterSpacing:".12em",textTransform:"uppercase"},children:" Opus Magnus  A Grande Obra"}),a.jsxs("div",{style:{fontSize:7,color:"rgba(255,255,255,.4)",lineHeight:1.6,background:"rgba(160,60,255,.04)",borderRadius:4,padding:"5px 8px",border:"1px solid rgba(160,60,255,.12)"},children:["4 fases alqumicas que transformam ",a.jsx("strong",{style:{color:"rgba(180,120,255,.9)"},children:"Chumbo"})," em ",a.jsx("strong",{style:{color:"#ffd060"},children:"Ouro"}),". Cada fase exige condies especficas de elementos e mtricas."]}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:3},children:u.map((c,d)=>{const h=e.active&&e.phase===c.id,f=e.completed.includes(c.id),g=h?e.timer/e.maxTimer:f?1:0;return a.jsxs("div",{style:{padding:"5px 8px",borderRadius:5,background:h?`${c.color}18`:f?"rgba(80,220,80,.05)":"rgba(255,255,255,.02)",border:`1px solid ${h?c.color+"50":f?"rgba(80,220,80,.2)":"rgba(255,255,255,.05)"}`},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginBottom:f||h?3:0},children:[a.jsx("span",{style:{fontSize:12,color:c.color,opacity:f||h?1:.3},children:c.sym}),a.jsx("span",{style:{fontSize:8.5,color:f?"#80ff80":h?c.color:"rgba(255,255,255,.3)",fontWeight:f||h?600:400},children:c.label}),f&&a.jsx("span",{style:{fontSize:7,color:"#80ff80",marginLeft:"auto"},children:" Completo"}),h&&a.jsxs("span",{style:{fontSize:7,fontFamily:"monospace",color:c.color,marginLeft:"auto"},children:[Math.round(g*100),"%"]})]}),a.jsx("div",{style:{fontSize:6.5,color:"rgba(255,255,255,.35)",lineHeight:1.4,marginBottom:h?3:0},children:c.desc}),h&&a.jsx("div",{style:{height:2,background:"rgba(255,255,255,.06)",borderRadius:2,overflow:"hidden"},children:a.jsx("div",{style:{height:"100%",width:`${g*100}%`,background:c.color,borderRadius:2,transition:"width .5s"}})})]},c.id)})}),a.jsx("button",{title:"Iniciar Opus",onClick:r,style:{width:"100%",padding:"7px",borderRadius:6,cursor:"pointer",background:e.active?"rgba(220,60,60,.1)":"rgba(160,60,255,.14)",border:`1px solid ${e.active?"rgba(220,60,60,.3)":"rgba(160,80,255,.4)"}`,color:e.active?"rgba(255,120,120,.9)":"rgba(200,140,255,.9)",fontSize:9,letterSpacing:".08em",textTransform:"uppercase",fontWeight:600},children:e.active?` Cancelar (${e.phase})`:" Iniciar Opus Magnus"}),a.jsxs("div",{style:{borderTop:"1px solid rgba(255,255,255,.05)",paddingTop:7},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:5},children:[a.jsx("div",{style:{fontSize:6.5,color:"rgba(255,255,255,.25)",textTransform:"uppercase",letterSpacing:".08em"},children:"Sequenciador Quntico"}),a.jsx("button",{title:"Sequencer ON/OFF",onClick:o,style:{padding:"2px 8px",borderRadius:3,cursor:"pointer",fontSize:7,background:t.active?"rgba(80,220,80,.14)":"rgba(255,255,255,.04)",border:`1px solid ${t.active?"rgba(80,220,80,.35)":"rgba(255,255,255,.1)"}`,color:t.active?"rgba(120,255,120,.9)":"rgba(255,255,255,.38)"},children:t.active?" Stop":" Start"})]}),a.jsx("div",{style:{display:"flex",gap:2,marginBottom:5},children:t.steps.map((c,d)=>{const h=t.active&&t.cursor===d,f=c.op==="SOLVE"?"#5aafff":c.op==="COAGULA"?"#ffaa30":"#60ff90";return a.jsxs("div",{style:{flex:1,height:20,borderRadius:2,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:0,background:h?`${f}28`:c.active?"rgba(255,255,255,.05)":"rgba(255,255,255,.015)",border:`1px solid ${h?`${f}60`:c.active?"rgba(255,255,255,.1)":"rgba(255,255,255,.04)"}`,boxShadow:h?`0 0 5px ${f}44`:"none",transition:"all .1s"},children:[a.jsx("span",{style:{fontSize:6.5,color:h?f:"rgba(255,255,255,.28)",lineHeight:1},children:c.label}),c.active&&a.jsx("div",{style:{width:3,height:3,borderRadius:"50%",background:f,marginTop:1,opacity:.65}})]},d)})}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5},children:[a.jsx("span",{style:{fontSize:6,color:"rgba(255,255,255,.3)",minWidth:20},children:"BPM"}),a.jsx("input",{type:"range",min:30,max:300,step:1,value:t.bpm,onChange:c=>s(+c.target.value),style:{flex:1,accentColor:"#a060ff",cursor:"pointer"}}),a.jsx("span",{style:{fontSize:8,fontFamily:"monospace",color:"rgba(255,255,255,.45)",minWidth:28},children:t.bpm})]}),a.jsxs("div",{style:{display:"flex",gap:3,marginTop:4,flexWrap:"wrap"},children:[RR.map(c=>a.jsx("button",{title:c.name,onClick:()=>l(c.id),style:{padding:"2px 6px",borderRadius:3,cursor:"pointer",fontSize:6.5,background:"rgba(160,80,255,.07)",border:"1px solid rgba(160,80,255,.18)",color:"rgba(200,150,255,.65)"},children:c.id},c.id)),a.jsx("button",{title:"Quantum",onClick:i,style:{padding:"2px 6px",borderRadius:3,cursor:"pointer",fontSize:6.5,background:t.quantum?"rgba(255,200,60,.1)":"rgba(255,255,255,.03)",border:`1px solid ${t.quantum?"rgba(255,200,60,.3)":"rgba(255,255,255,.08)"}`,color:t.quantum?"rgba(255,220,100,.8)":"rgba(255,255,255,.28)"},children:" Quantum"})]})]})]})},nH=({onOp:e,opsUsed:t,bars:r,barTool:o,onBarTool:s,onDeleteBar:l,onToggleBar:i,onBarStrength:u,lens:c,onLens:d})=>{const[h,f]=w.useState(null);return a.jsxs("div",{style:{padding:"8px 10px",display:"flex",flexDirection:"column",gap:9},children:[a.jsx("div",{style:{fontSize:7,color:"rgba(255,80,200,.7)",letterSpacing:".12em",textTransform:"uppercase"},children:" Arcana  Operaes & Poderes"}),a.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:3},children:YW.map(g=>{const m=t.has(g.id.toUpperCase());return a.jsxs("button",{title:g.name,onClick:()=>e(g.id),onMouseEnter:()=>f(g),onMouseLeave:()=>f(null),style:{padding:"5px 4px",borderRadius:5,cursor:"pointer",background:m?`${g.color}12`:"rgba(255,255,255,.03)",border:`1px solid ${m?`${g.color}40`:"rgba(255,255,255,.08)"}`,display:"flex",flexDirection:"column",alignItems:"center",gap:1.5,transition:"all .12s"},children:[a.jsx("span",{style:{fontSize:13,lineHeight:1},children:g.icon}),a.jsx("span",{style:{fontSize:6.5,color:m?g.color:"rgba(255,255,255,.45)",fontWeight:600},children:g.label}),a.jsx("span",{style:{fontSize:5.5,color:"rgba(255,255,255,.22)",fontStyle:"italic"},children:g.latin})]},g.id)})}),h&&a.jsxs("div",{style:{padding:"5px 8px",borderRadius:4,background:`${h.color}0a`,border:`1px solid ${h.color}28`,fontSize:7,color:"rgba(255,255,255,.55)",lineHeight:1.55},children:[a.jsx("strong",{style:{color:h.color},children:h.label}),"  ",h.desc]}),a.jsxs("div",{children:[a.jsx("div",{style:{fontSize:6,color:"rgba(255,255,255,.22)",textTransform:"uppercase",letterSpacing:".08em",marginBottom:4},children:"Lente de Visualizao"}),a.jsx("div",{style:{display:"flex",gap:2},children:["SIGIL","FIELD","EVENTS","LAPIS"].map(g=>a.jsx("button",{title:g,onClick:()=>d(g),style:{flex:1,padding:"3px 2px",borderRadius:3,cursor:"pointer",fontSize:6,fontFamily:"monospace",background:c===g?"rgba(255,255,255,.09)":"rgba(255,255,255,.02)",border:`1px solid ${c===g?"rgba(255,255,255,.28)":"rgba(255,255,255,.06)"}`,color:c===g?"rgba(255,255,255,.8)":"rgba(255,255,255,.28)"},children:g},g))})]}),a.jsxs("div",{children:[a.jsx("div",{style:{fontSize:6,color:"rgba(255,255,255,.22)",textTransform:"uppercase",letterSpacing:".08em",marginBottom:4},children:"Atanores & Barreiras"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:2},children:Object.keys(s5).map(g=>{const m=s5[g];return a.jsxs("button",{title:m.label||m.id,onClick:()=>s(o===g?null:g),style:{padding:"4px 7px",borderRadius:4,cursor:"pointer",textAlign:"left",background:o===g?`${m.color}16`:"rgba(255,255,255,.025)",border:`1px solid ${o===g?`${m.color}50`:"rgba(255,255,255,.06)"}`,display:"flex",alignItems:"center",gap:6},children:[a.jsx("span",{style:{fontSize:10,color:m.color,opacity:o===g?1:.5},children:m.icon}),a.jsxs("div",{children:[a.jsx("div",{style:{fontSize:7,color:o===g?m.color:"rgba(255,255,255,.4)",fontWeight:o===g?600:400},children:m.label}),a.jsx("div",{style:{fontSize:5.5,color:"rgba(255,255,255,.2)"},children:m.desc})]})]},g)})}),o&&a.jsxs("div",{style:{marginTop:4,padding:"3px 7px",borderRadius:3,background:"rgba(255,200,100,.04)",border:"1px solid rgba(255,200,100,.12)",fontSize:7,color:"rgba(255,200,80,.75)"},children:[" Arraste no canvas para criar ",s5[o].label]}),r.length>0&&a.jsx("div",{style:{marginTop:5,display:"flex",flexDirection:"column",gap:2},children:r.map(g=>{const m=s5[g.type];return a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:2,padding:"3px 6px",borderRadius:4,background:g.active?"rgba(255,255,255,.03)":"rgba(255,255,255,.01)",border:`1px solid ${g.active?"rgba(255,255,255,.08)":"rgba(255,255,255,.03)"}`,opacity:g.active?1:.45},children:[a.jsx("div",{style:{width:6,height:6,borderRadius:"50%",background:m.color,flexShrink:0}}),a.jsxs("div",{style:{flex:1,fontSize:6,color:`${m.color}bb`},children:[m.icon," ",m.label]}),a.jsx("input",{type:"range",min:.1,max:1,step:.05,value:g.strength,onChange:y=>u(g.id,+y.target.value),style:{width:36,accentColor:m.color,cursor:"pointer"}}),a.jsx("button",{title:"ON/OFF",onClick:()=>i(g.id),style:{fontSize:5.5,padding:"1px 4px",borderRadius:2,cursor:"pointer",background:"rgba(255,255,255,.05)",border:"none",color:"rgba(255,255,255,.35)"},children:g.active?"ON":"OFF"}),a.jsx("button",{title:"Remover",onClick:()=>l(g.id),style:{background:"none",border:"none",cursor:"pointer",color:"rgba(255,60,60,.5)",padding:0},children:a.jsx(o0,{size:8})})]},g.id)})})]})]})},rH=({active:e})=>{var fn,zn;const t=w.useRef(null),r=w.useRef(null),o=w.useRef(0),s=w.useRef(0),l=w.useRef(!0),i=cR(),[u,c]=w.useState(ep[1].elements),[d,h]=w.useState(ep[1].heat),[f,g]=w.useState(.4),[m,y]=w.useState("SIGIL"),[v,b]=w.useState(!0),[S,C]=w.useState("atanor"),[k,R]=w.useState(!0),[j,T]=w.useState(a5()),[_,P]=w.useState(ES()),[I,$]=w.useState(!1),[q,L]=w.useState(null),[H,G]=w.useState([]),[oe,le]=w.useState(null),[pe,ce]=w.useState(null),te=w.useRef(1),[F,Q]=w.useState(TS()),[ae,we]=w.useState(CR()),[Re,ge]=w.useState(new Set(IS)),[Ae,tt]=w.useState(new Map),[We,J]=w.useState(null),[ke,Le]=w.useState(new Set),[K,et]=w.useState(null),dt=w.useRef(.4),Rt=w.useRef(1),Wt=w.useRef(null),Zt=w.useRef(!1),$e=w.useRef(new Set(IS)),Ze=w.useRef(new Map),Fe=w.useRef(new Set),Xe=w.useRef(u),jt=w.useRef(d),hn=w.useRef("SIGIL"),an=w.useRef(a5()),it=w.useRef([]),kt=w.useRef([]),On=w.useRef(TS()),sn=w.useRef(null),Xn=w.useRef(null);w.useEffect(()=>{Xe.current=u,r.current&&(r.current.elements={...u})},[u]),w.useEffect(()=>{jt.current=d,r.current&&(r.current.heat=d)},[d]),w.useEffect(()=>{hn.current=m},[m]),w.useEffect(()=>{an.current=j},[j]),w.useEffect(()=>{it.current=_},[_]),w.useEffect(()=>{kt.current=H},[H]),w.useEffect(()=>{On.current=F},[F]),w.useEffect(()=>{l.current=v},[v]),w.useEffect(()=>{dt.current=f},[f]),w.useEffect(()=>{const rt=ep[1];r.current=CS(rt.agentCount,rt.elements,rt.heat)},[]);const Pt=w.useCallback((rt,mt)=>{c(yt=>{const Et=Object.entries(yt).filter(([Xt])=>Xt!==rt),Ft=Et.reduce((Xt,[,Dt])=>Xt+Dt,0),me=Math.max(.01,1-mt);if(Ft<.001){const Xt=me/Et.length;return{...yt,[rt]:mt,...Object.fromEntries(Et.map(([Dt])=>[Dt,Xt]))}}const cn=me/Ft;return{...yt,[rt]:mt,...Object.fromEntries(Et.map(([Xt,Dt])=>[Xt,Dt*cn]))}})},[]),zt=w.useCallback(rt=>{const mt=Date.now();et({type:rt,key:mt}),Xn.current&&clearTimeout(Xn.current),Xn.current=setTimeout(()=>et(null),1800)},[]),jn=w.useCallback(rt=>{if(zt(rt),Fe.current.add(rt.toUpperCase()),Le(new Set(Fe.current)),!r.current)return;const mt=r.current;switch(rt){case"solve":fl(mt,"SOLVE");break;case"coagula":fl(mt,"COAGULA");break;case"calcinatio":h(yt=>{const Et=Math.min(1,yt+.35);return r.current&&(r.current.heat=Et),Et}),fl(mt,"COAGULA"),Pc(it.current,"event",mt.metrics,Xe.current,an.current.active?an.current.phase:null,"BURNOUT",mt.lapis.state),P([...it.current]);break;case"sublimatio":c(yt=>{const Et=Math.min(.75,yt.air+.2),Ft=Math.max(.02,yt.earth-.15),me=yt.fire,cn=yt.water,Xt=Ft+cn+Et+me,Dt={earth:Ft/Xt,water:cn/Xt,air:Et/Xt,fire:me/Xt};return r.current&&(r.current.elements=Dt),Dt}),fl(mt,"SOLVE");break;case"fermentatio":c(()=>{const yt={earth:.25,water:.25,air:.25,fire:.25};return r.current&&(r.current.elements=yt),yt});break;case"putrefactio":h(yt=>{const Et=Math.max(0,yt-.2);return r.current&&(r.current.heat=Et),Et}),c(()=>{const yt={earth:.3,water:.35,air:.15,fire:.2};return r.current&&(r.current.elements=yt),yt}),fl(mt,"SOLVE");for(const yt of mt.agents)yt.substance="plumbum";Pc(it.current,"event",mt.metrics,Xe.current,an.current.active?an.current.phase:null,"DISSOLUTION",mt.lapis.state),P([...it.current]);break;case"circulatio":fl(mt,"COAGULA"),setTimeout(()=>{r.current&&fl(r.current,"SOLVE")},600),setTimeout(()=>{r.current&&fl(r.current,"COAGULA")},1200);break;case"fixatio":for(const yt of mt.agents)yt.vx*=.15,yt.vy*=.15;h(yt=>{const Et=Math.max(0,yt-.15);return r.current&&(r.current.heat=Et),Et}),fl(mt,"COAGULA");break}},[zt]),En=w.useCallback(rt=>{const mt=$W(rt);mt&&(c(mt.elements),h(mt.heat),r.current=CS(mt.agentCount,mt.elements,mt.heat),T(a5()),P(ES()),G([]))},[]),lt=w.useCallback(()=>{if(j.active){T(a5()),sn.current=null;return}if(!r.current)return;T({active:!0,phase:"NIGREDO",phaseIndex:0,timer:0,maxTimer:45,completed:[],lapisForged:!1}),sn.current=AS("NIGREDO"),Pc(it.current,"phaseStart",r.current.metrics,Xe.current,"NIGREDO",null,r.current.lapis.state),P([...it.current])},[j.active]),ht=w.useCallback(()=>Q(rt=>({...rt,active:!rt.active})),[]),_t=w.useCallback(rt=>Q(mt=>({...mt,bpm:rt,stepDur:60/rt})),[]),Ie=w.useCallback(rt=>{const mt=RR.find(yt=>yt.id===rt);mt&&Q(yt=>({...yt,steps:[...mt.steps],bpm:mt.bpm,stepDur:60/mt.bpm,quantum:mt.quantum,cursor:0,timer:0}))},[]),at=w.useCallback(()=>Q(rt=>({...rt,quantum:!rt.quantum})),[]);w.useEffect(()=>{const rt=t.current;if(!rt||!e)return;const mt=yt=>i.handleWheel(yt,rt);return rt.addEventListener("wheel",mt,{passive:!1}),()=>rt.removeEventListener("wheel",mt)},[e,i.handleWheel]);const St=w.useCallback(rt=>{const mt=t.current;return gq(rt.clientX,rt.clientY,mt.getBoundingClientRect(),i.zoomRef.current,i.panXRef.current,i.panYRef.current)},[i.zoomRef,i.panXRef,i.panYRef]),ye=w.useCallback(rt=>{if(rt.button===1){i.handlePanStart(rt);return}if(!oe||rt.button!==0)return;const[mt,yt]=St(rt);ce({x1:mt,y1:yt})},[oe,St]),xe=w.useCallback(rt=>i.handlePanMove(rt),[i.handlePanMove]),gt=w.useCallback(rt=>{if(i.handlePanEnd(rt),!pe||!oe)return;const[mt,yt]=St(rt),Et=mt-pe.x1,Ft=yt-pe.y1;Math.sqrt(Et*Et+Ft*Ft)>.02&&G(me=>[...me,{id:te.current++,x1:pe.x1,y1:pe.y1,x2:mt,y2:yt,type:oe,strength:.6,active:!0}]),ce(null)},[pe,oe,St]);w.useEffect(()=>{if(!e)return;const rt=mt=>{(mt.ctrlKey||mt.metaKey)&&mt.key==="="&&(mt.preventDefault(),i.zoomIn()),(mt.ctrlKey||mt.metaKey)&&mt.key==="-"&&(mt.preventDefault(),i.zoomOut()),(mt.ctrlKey||mt.metaKey)&&mt.key==="0"&&(mt.preventDefault(),i.resetView()),mt.key===" "&&!We&&(mt.preventDefault(),b(yt=>!yt))};return window.addEventListener("keydown",rt),()=>window.removeEventListener("keydown",rt)},[e,We]),w.useEffect(()=>{if(!e){cancelAnimationFrame(o.current);return}let rt="DORMANT";const mt=yt=>{var cn,Xt;if(o.current=requestAnimationFrame(mt),!t.current||!r.current)return;const Et=Math.min(.05,(yt-s.current)/1e3);s.current=yt;const Ft=r.current;if(l.current){if(sn.current){const ne=sn.current;c(Ne=>{const Ke={earth:Ne.earth+(ne.mix.earth-Ne.earth)*Et*.08,water:Ne.water+(ne.mix.water-Ne.water)*Et*.08,air:Ne.air+(ne.mix.air-Ne.air)*Et*.08,fire:Ne.fire+(ne.mix.fire-Ne.fire)*Et*.08};return Ft.elements=Ke,Ke}),h(Ne=>{const Ke=Ne+(ne.heat-Ne)*Et*.06;return Ft.heat=Ke,Ke})}if(On.current.active){const ne=qW(On.current,Et);ne.stepFired&&ne.firedStep&&(ne.elementsDelta&&c(Ne=>{const Ke=ne.elementsDelta,Ct={earth:Ke.earth??Ne.earth,water:Ke.water??Ne.water,air:Ke.air??Ne.air,fire:Ke.fire??Ne.fire};return Ft.elements=Ct,Ct}),ne.heatDelta!=null&&h(()=>(Ft.heat=ne.heatDelta,ne.heatDelta)),ne.op!=="NONE"&&fl(Ft,ne.op)),Q({...On.current})}if(!Zt.current){const ne=xp.filter(Ne=>!$e.current.has(Ne.z)).map(Ne=>({el:Ne,prog:(Ze.current.get(Ne.z)??0)/Ne.recipe.ticksNeeded})).filter(({prog:Ne})=>Ne>.4).sort((Ne,Ke)=>Ke.prog-Ne.prog)[0];if(ne){const Ne=Math.max(.1,1-ne.prog*2);Rt.current+=(Ne-Rt.current)*Math.min(1,Et*1.5);let Ke=.5,Ct=.5,ft=0;for(const Qt of Ft.agents){const en=Qt.charge*Qt.coherence;en>ft&&(ft=en,Ke=Qt.x,Ct=Qt.y)}const At=1.3+ne.prog*2.5;i.zoomRef.current+=(At-i.zoomRef.current)*Math.min(1,Et*.6);const bt=((cn=t.current)==null?void 0:cn.clientWidth)??900,nn=((Xt=t.current)==null?void 0:Xt.clientHeight)??600,Bt=(.5-Ke)*bt*i.zoomRef.current*.4,Jt=(.5-Ct)*nn*i.zoomRef.current*.4;i.panXRef.current+=(Bt-i.panXRef.current)*Math.min(1,Et*.45),i.panYRef.current+=(Jt-i.panYRef.current)*Math.min(1,Et*.45),Wt.current={name:ne.el.name,symbol:ne.el.symbol,color:qs[ne.el.cat].color,progress:ne.prog,hotX:Ke,hotY:Ct}}else Rt.current+=(1-Rt.current)*Math.min(1,Et*1.5),i.zoomRef.current>1.02&&(i.zoomRef.current+=(1-i.zoomRef.current)*Math.min(1,Et*.5)),(Math.abs(i.panXRef.current)>1||Math.abs(i.panYRef.current)>1)&&(i.panXRef.current*=Math.pow(.96,Et*60),i.panYRef.current*=Math.pow(.96,Et*60)),Wt.current=null}const Dt=Et*dt.current*Rt.current;if(SW(Ft,Dt,kt.current),Ft.tick%60===0){const ne={earth:Xe.current.earth,water:Xe.current.water,air:Xe.current.air,fire:Xe.current.fire},Ne=an.current.active?an.current.phase:null;for(const Ke of xp)if(!$e.current.has(Ke.z)&&HW(Ke.recipe,ne,jt.current,Fe.current,Ne,Ft.lapis.state)){const ft=(Ze.current.get(Ke.z)??0)+1;if(Ze.current.set(Ke.z,ft),ft>=Ke.recipe.ticksNeeded){$e.current.add(Ke.z),ge(new Set($e.current)),tt(new Map(Ze.current)),l.current=!1,b(!1);const At={element:Ke,earth:Xe.current.earth,water:Xe.current.water,air:Xe.current.air,fire:Xe.current.fire,heat:jt.current,opsUsed:Array.from(Fe.current),opusPhase:Ne,lapisState:Ft.lapis.state,totalDiscovered:$e.current.size};Zt.current=!0,Wt.current=null,Rt.current=1,J(At),Pc(it.current,"periodic",Ft.metrics,Xe.current,Ne,null,Ft.lapis.state),P([...it.current]);break}}tt(new Map(Ze.current))}Ft.lapis.state!==rt&&(Ft.lapis.state==="FORGED"&&(Pc(it.current,"lapisForged",Ft.metrics,Ft.elements,an.current.active?an.current.phase:null,null,Ft.lapis.state),P([...it.current])),rt=Ft.lapis.state),Ft.activeEvent&&Ft.eventTimer<.1&&(Pc(it.current,"event",Ft.metrics,Ft.elements,an.current.active?an.current.phase:null,Ft.activeEvent,Ft.lapis.state),P([...it.current])),an.current.active&&T(ne=>{if(!ne.active)return ne;const Ne=ne.timer+Et;if(Ne>=ne.maxTimer){const Ke=IW(ne.phase,Ft.metrics),Ct=PW(ne);if(Pc(it.current,"phaseEnd",Ft.metrics,Ft.elements,ne.phase,null,Ft.lapis.state),Ke.passed&&Ct){const ft={...ne,timer:0,phase:Ct,phaseIndex:ne.phaseIndex+1,completed:[...ne.completed,ne.phase]};return sn.current=AS(Ct),Pc(it.current,"phaseStart",Ft.metrics,Ft.elements,Ct,null,Ft.lapis.state),P([...it.current]),ft}else return Ke.passed&&!Ct?(sn.current=null,P([...it.current]),{...ne,active:!1,completed:[...ne.completed,ne.phase]}):(P([...it.current]),{...ne,timer:0})}return{...ne,timer:Ne}}),Ft.tick%20===0&&we({...Ft.transmutation,counts:{...Ft.transmutation.counts},produced:{...Ft.transmutation.produced},flashes:[]})}const me=Math.sin(Ft.breathPhase*Math.PI*2);AW(t.current,Ft,hn.current,an.current.active?an.current.phase:null,me,kt.current,On.current,i.zoomRef.current,i.panXRef.current,i.panYRef.current,284,Wt.current)};return s.current=performance.now(),o.current=requestAnimationFrame(mt),()=>cancelAnimationFrame(o.current)},[e]);const Ge=wR(u),Ye=((fn=r.current)==null?void 0:fn.lapis.state)??"DORMANT",Ve=w.useMemo(()=>Object.fromEntries(yp.map(rt=>{var mt,yt;return[rt.id,fb(rt,u,d,((mt=r.current)==null?void 0:mt.lapis.state)??"DORMANT",((yt=r.current)==null?void 0:yt.pulse.op)??"NONE",.5,ae.conjunctionActive)]})),[u,d,ae.conjunctionActive]),Oe=w.useMemo(()=>q?zW(_,q):_.slice(0,40),[_,q]),Gt=240,Kt=[{id:"tabela",icon:a.jsx(_j,{size:13}),label:"Tabela",color:"#60c0ff"},{id:"atanor",icon:a.jsx(F9,{size:13}),label:"Atanor",color:"#ffa030"},{id:"opus",icon:a.jsx(Rp,{size:13}),label:"Opus",color:"#b060ff"},{id:"arcana",icon:a.jsx(Es,{size:13}),label:"Arcana",color:"#ff60c0"}];return a.jsxs("div",{className:"fixed left-0 right-0 bottom-0 z-[5]",style:{display:e?"flex":"none",top:36},children:[a.jsx("style",{children:VW}),a.jsx("canvas",{ref:t,className:"absolute inset-0 w-full h-full block",style:{background:"#000",cursor:i.isPanning.current?"grabbing":oe?"crosshair":"default"},onMouseDown:ye,onMouseMove:xe,onMouseUp:gt,onMouseLeave:()=>i.handlePanEnd()}),K&&a.jsx("div",{style:{position:"fixed",inset:0,zIndex:90,pointerEvents:"none",background:UW[K.type],animation:`flash-${K.type} 1.6s ease-out forwards`}},K.key),ae.bannerLife>0&&ae.bannerSubstance&&(()=>{const rt=gp[ae.bannerSubstance];return a.jsx("div",{style:{position:"fixed",top:"35%",left:"50%",transform:"translate(-50%,-50%)",zIndex:97,pointerEvents:"none",textAlign:"center"},children:a.jsxs("div",{style:{fontSize:24,letterSpacing:".15em",fontFamily:"serif",color:rt.glowColor,opacity:Math.min(1,ae.bannerLife/2),textShadow:`0 0 30px ${rt.color}88`},children:[rt.symbol," ",ae.bannerText," ",rt.symbol]})})})(),a.jsxs("div",{style:{position:"fixed",left:0,top:36,bottom:0,zIndex:20,display:"flex",pointerEvents:"none"},children:[a.jsxs("div",{style:{width:44,display:"flex",flexDirection:"column",alignItems:"center",background:"rgba(6,5,12,.97)",borderRight:"1px solid rgba(255,255,255,.05)",pointerEvents:"all",paddingTop:4},children:[Kt.map(rt=>a.jsxs("button",{title:rt.label,onClick:()=>{S===rt.id&&k?R(!1):(C(rt.id),R(!0))},style:{width:36,height:36,borderRadius:6,border:"none",cursor:"pointer",margin:"2px 0",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:1.5,background:k&&S===rt.id?`${rt.color}18`:"transparent",boxShadow:k&&S===rt.id?`inset 0 0 0 1px ${rt.color}40`:"none",color:k&&S===rt.id?rt.color:"rgba(255,255,255,.25)",transition:"all .15s"},children:[rt.icon,a.jsx("span",{style:{fontSize:5,letterSpacing:".08em",textTransform:"uppercase"},children:rt.label})]},rt.id)),a.jsx("div",{style:{width:24,height:1,background:"rgba(255,255,255,.06)",margin:"4px 0"}}),a.jsx("button",{onClick:()=>b(rt=>!rt),title:v?"Pausar [Espao]":"Continuar [Espao]",style:{width:36,height:28,borderRadius:5,cursor:"pointer",background:"rgba(255,255,255,.03)",border:`1px solid ${v?"rgba(255,255,255,.06)":"rgba(255,140,60,.40)"}`,color:v?"rgba(255,255,255,.28)":"rgba(255,160,80,.90)",display:"flex",alignItems:"center",justifyContent:"center",margin:"2px 0"},children:v?a.jsx(s0,{size:12}):a.jsx(wl,{size:12})}),a.jsx("button",{onClick:()=>$(rt=>!rt),title:"Grimrio",style:{width:36,height:28,borderRadius:5,border:"none",cursor:"pointer",margin:"2px 0",background:I?"rgba(255,200,60,.1)":"transparent",color:I?"rgba(255,220,100,.8)":"rgba(255,255,255,.3)",display:"flex",alignItems:"center",justifyContent:"center"},children:a.jsx(N4,{size:12})}),a.jsx("button",{onClick:()=>R(rt=>!rt),title:k?"Recolher HUD":"Expandir HUD",style:{width:36,height:28,borderRadius:5,border:"none",cursor:"pointer",margin:"2px 0",background:"transparent",color:"rgba(255,255,255,.2)",display:"flex",alignItems:"center",justifyContent:"center"},children:k?a.jsx(Ap,{size:11}):a.jsx(aa,{size:11})}),a.jsxs("div",{style:{marginTop:"auto",marginBottom:8,display:"flex",flexDirection:"column",alignItems:"center",gap:3},children:[a.jsx("div",{style:{width:10,height:10,borderRadius:"50%",background:Ye==="FORGED"?"#ffd060":Ye==="FORMING"?"#a060ff":Ye==="CRACKED"?"#ff4040":"#333",boxShadow:Ye==="FORGED"?"0 0 8px #ffd060":"none"}}),a.jsxs("span",{style:{fontSize:4.5,color:"rgba(255,255,255,.2)",textTransform:"uppercase",letterSpacing:".06em",writingMode:"vertical-rl",transform:"rotate(180deg)"},children:[Re.size,"/118"]})]})]}),k&&a.jsxs("div",{className:"alchemy-hud-enter",style:{width:Gt,display:"flex",flexDirection:"column",background:"rgba(6,5,12,.97)",borderRight:"1px solid rgba(255,255,255,.05)",pointerEvents:"all",overflowY:"auto",overflowX:"hidden"},children:[a.jsx("div",{style:{padding:"6px 10px 5px",borderBottom:"1px solid rgba(255,255,255,.05)",flexShrink:0},children:a.jsxs("div",{style:{fontSize:7,letterSpacing:".14em",textTransform:"uppercase",color:((zn=Kt.find(rt=>rt.id===S))==null?void 0:zn.color)??"rgba(255,255,255,.4)"},children:[S==="tabela"&&" Tabela Peridica",S==="atanor"&&" Atanor  Forno Alqumico",S==="opus"&&" Opus Magnus",S==="arcana"&&" Operaes &amp; Poderes"]})}),a.jsxs("div",{style:{flex:1},children:[S==="tabela"&&a.jsx(QW,{discovered:Re,progress:Ae}),S==="atanor"&&a.jsx(eH,{elements:u,heat:d,transmutation:ae,quintessence:Ge,recipeScores:Ve,simSpeed:f,onSimSpeed:rt=>{g(rt),dt.current=rt},onElement:Pt,onHeat:rt=>{h(rt),r.current&&(r.current.heat=rt)},onPreset:En}),S==="opus"&&a.jsx(tH,{opus:j,sequencer:F,onStartOpus:lt,onSeqToggle:ht,onSeqBpm:_t,onSeqPreset:Ie,onSeqQuantum:at}),S==="arcana"&&a.jsx(nH,{onOp:jn,opsUsed:ke,bars:H,barTool:oe,onBarTool:le,onDeleteBar:rt=>G(mt=>mt.filter(yt=>yt.id!==rt)),onToggleBar:rt=>G(mt=>mt.map(yt=>yt.id===rt?{...yt,active:!yt.active}:yt)),onBarStrength:(rt,mt)=>G(yt=>yt.map(Et=>Et.id===rt?{...Et,strength:mt}:Et)),lens:m,onLens:rt=>{y(rt),hn.current=rt}})]})]})]}),I&&a.jsxs("div",{style:{position:"fixed",right:0,top:36,bottom:0,width:240,zIndex:20,display:"flex",flexDirection:"column",background:"rgba(6,5,12,.97)",borderLeft:"1px solid rgba(255,255,255,.05)"},children:[a.jsxs("div",{style:{padding:"7px 10px",borderBottom:"1px solid rgba(255,255,255,.05)",display:"flex",alignItems:"center",justifyContent:"space-between",flexShrink:0},children:[a.jsxs("div",{style:{fontSize:8,color:"rgba(255,200,80,.7)",letterSpacing:".1em",textTransform:"uppercase",display:"flex",alignItems:"center",gap:5},children:[a.jsx(N4,{size:10})," Grimrio (",_.length,")"]}),a.jsx("button",{title:"Fechar",onClick:()=>$(!1),style:{background:"none",border:"none",cursor:"pointer",color:"rgba(255,255,255,.3)"},children:a.jsx(ya,{size:10})})]}),a.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"6px 8px",display:"flex",flexDirection:"column",gap:3},children:[Oe.length===0&&a.jsxs("div",{style:{fontSize:8,color:"rgba(255,255,255,.2)",textAlign:"center",padding:"20px 0",fontStyle:"italic"},children:["O Grimrio est vazio.",a.jsx("br",{}),"Execute operaes para registrar."]}),Oe.map(rt=>a.jsx(ZW,{entry:rt,onBookmark:()=>P(mt=>mt.map(yt=>yt.id===rt.id?{...yt,bookmarked:!yt.bookmarked}:yt))},rt.id))]})]}),a.jsx("div",{style:{position:"fixed",bottom:16,right:I?258:16,zIndex:25},children:a.jsx(lR,{zoom:i.zoom,onZoomIn:i.zoomIn,onZoomOut:i.zoomOut,onReset:i.resetView})}),j.active&&a.jsxs("div",{style:{position:"fixed",bottom:16,left:"50%",transform:"translateX(-50%)",zIndex:25,pointerEvents:"none",display:"flex",alignItems:"center",gap:8,padding:"5px 14px",borderRadius:20,background:"rgba(6,5,12,.9)",border:`1px solid ${md[j.phase].color}44`},children:[a.jsx("span",{style:{fontSize:11,color:md[j.phase].color},children:md[j.phase].symbol}),a.jsxs("div",{children:[a.jsxs("div",{style:{fontSize:7.5,color:md[j.phase].color,letterSpacing:".08em",textTransform:"uppercase"},children:["Opus: ",j.phase]}),a.jsx("div",{style:{width:110,height:2,background:"rgba(255,255,255,.07)",borderRadius:2,overflow:"hidden",marginTop:2},children:a.jsx("div",{style:{height:"100%",width:`${j.timer/j.maxTimer*100}%`,background:md[j.phase].color,borderRadius:2,transition:"width .5s"}})})]}),a.jsxs("span",{style:{fontSize:7.5,fontFamily:"monospace",color:"rgba(255,255,255,.4)"},children:[Math.round(j.timer),"s/",j.maxTimer,"s"]})]}),!v&&!We&&a.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%,-50%)",zIndex:30,pointerEvents:"none",textAlign:"center"},children:[a.jsx("div",{style:{fontSize:11,color:"rgba(255,255,255,.25)",letterSpacing:".2em",textTransform:"uppercase",fontFamily:"monospace"},children:" PAUSADO"}),a.jsx("div",{style:{fontSize:8,color:"rgba(255,255,255,.12)",marginTop:4},children:"Espao para continuar"})]}),We&&a.jsx(JW,{data:We,onContinue:()=>{Zt.current=!1,Rt.current=1,J(null),b(!0),l.current=!0},onReplay:()=>{zt("calcinatio"),setTimeout(()=>zt("coagula"),600)}})]})};let oH=1;function Bg(){return`dna-${Date.now()}-${oH++}`}const aH={ascension:{flow:.85,entropy:.3,memory:.7,contrast:.4,coherence:.8},gravity:{flow:.4,entropy:.2,memory:.9,contrast:.7,coherence:.7},conflict:{entropy:.8,contrast:.9,fragmentation:.8,rhythm:.7,erosion:.6},harmony:{coherence:.9,entropy:.15,symmetry:.6,memory:.7,contrast:.3},ecstasy:{flow:.95,entropy:.7,contrast:.5,rhythm:.8,fragmentation:.5},silence:{flow:.1,entropy:.05,memory:.95,contrast:.1,coherence:.9},mondrian:{structure:.98,linear:1,entropy:.02,coherence:.98,fragmentation:.02,flow:.2},suprematist:{structure:.92,linear:.9,entropy:.08,coherence:.9,symmetry:.12,agentShape:"square"},action:{flow:.92,entropy:.88,fragmentation:.95,rhythm:.9,contrast:.92,erosion:.7},minimal:{flow:.12,entropy:.04,memory:.98,contrast:.8,coherence:.97,erosion:.02},glitch:{entropy:.95,fragmentation:.98,rhythm:.95,structure:.12,linear:.7},botanical:{flow:.62,entropy:.22,memory:.9,coherence:.82,structure:.18,fragmentation:.18},constellation:{structure:.08,flow:.25,entropy:.12,memory:.95,coherence:.92,agentShape:"star"},none:{}};function sH(e,t){const r=aH[t]??{};return{...e,intention:t,genes:{...e.genes,...r}}}function Nr(e,t,r,o,s=1200,l="none"){return{id:Bg(),name:e,genes:t,palette:r,background:o,quantaCount:s,createdAt:Date.now(),intention:l}}const G0=[Nr("Quadro Branco",{structure:.18,flow:.55,entropy:.32,memory:.75,contrast:.6,symmetry:.05,glyphness:.06,erosion:.08,layering:.75,rhythm:.38,fragmentation:.22,coherence:.7},["#2a4a7f","#7f2a4a","#2a7f4a","#7f6a2a","#4a2a7f","#2a6a7f"],"#f8f6f0",0),Nr("Mondrian Grid",{structure:.98,flow:.18,entropy:.03,memory:.4,contrast:.99,symmetry:0,glyphness:0,erosion:.6,layering:.3,rhythm:.85,fragmentation:.04,coherence:.98,linear:1,agentShape:"square"},["#e31414","#1449cc","#f5e614","#000000","#f5f5f5"],"#f5f5f5",700,"mondrian"),Nr("Action Paint",{structure:.06,flow:.95,entropy:.92,memory:.35,contrast:.95,symmetry:0,glyphness:0,erosion:.72,layering:.85,rhythm:.95,fragmentation:.97,coherence:.18},["#cc1a00","#ff6600","#f0c000","#1a1a1a","#e0e0e0"],"#f0ece0",1200,"action"),Nr("Ink Calligraphy",{structure:.15,flow:.88,entropy:.18,memory:.85,contrast:.7,symmetry:.05,glyphness:.18,erosion:.12,layering:.65,rhythm:.35,fragmentation:.08,coherence:.8},["#0d0a08","#3a1808","#8b4513","#5c3317"],"#f7f3e9",800),Nr("Dust Cloud",{structure:.12,flow:.42,entropy:.88,memory:.22,contrast:.55,symmetry:0,glyphness:0,erosion:.62,layering:.78,rhythm:.55,fragmentation:.92,coherence:.2},["#d4c4a8","#8a7060","#4a3828","#2a1a10","#f0e0c8"],"#0e0a08",1100),Nr("Watercolor Blobs",{structure:.06,flow:.42,entropy:.14,memory:.92,contrast:.05,symmetry:.12,glyphness:0,erosion:.04,layering:.96,rhythm:.18,fragmentation:.04,coherence:.94},["#d080c0","#80a0e0","#60c0a0","#e0c060","#c0a0d0"],"#f0eef8",700,"silence"),Nr("Blueprint",{structure:.88,flow:.38,entropy:.06,memory:.85,contrast:.88,symmetry:.1,glyphness:0,erosion:.2,layering:.6,rhythm:.45,fragmentation:.12,coherence:.9,linear:.95,agentShape:"diamond"},["#a8d8ff","#60b0e8","#ffffff","#204070"],"#0a1a28",850),Nr("Chromatic Ecstasy",{structure:.1,flow:.92,entropy:.7,memory:.4,contrast:.1,symmetry:0,glyphness:0,erosion:.3,layering:.92,rhythm:.35,fragmentation:.22,coherence:.65},["#ff2060","#2040ff","#00e8c0","#ffdd00","#e040a0"],"#030308",800,"ecstasy"),Nr("Constellation",{structure:.08,flow:.22,entropy:.1,memory:.98,contrast:.7,symmetry:0,glyphness:0,erosion:.02,layering:.95,rhythm:.1,fragmentation:.08,coherence:.96,agentShape:"star"},["#ffffff","#a0c8ff","#c8a0ff","#60d0ff"],"#010308",500,"constellation"),Nr("Glyph Ecology",{structure:.38,flow:.62,entropy:.3,memory:.8,contrast:.52,symmetry:.18,glyphness:.92,erosion:.18,layering:.68,rhythm:.45,fragmentation:.28,coherence:.72},["#1a4a1a","#2d7c2d","#84c884","#c8ecc8","#406040"],"#060e06",700,"harmony"),Nr("Symmetry Temple",{structure:.6,flow:.42,entropy:.2,memory:.72,contrast:.75,symmetry:.98,glyphness:.28,erosion:.28,layering:.78,rhythm:.5,fragmentation:.08,coherence:.9},["#c8a020","#9030b0","#1040c0","#080818","#e0c060"],"#060410",700,"harmony"),Nr("Fracture & Rift",{structure:.52,flow:.28,entropy:.68,memory:.42,contrast:.92,symmetry:.05,glyphness:0,erosion:.7,layering:.62,rhythm:.85,fragmentation:.95,coherence:.22},["#c04020","#6a3018","#e8b040","#181008"],"#060402",800,"conflict"),Nr("Signal",{structure:.58,flow:.42,entropy:.4,memory:.42,contrast:.99,symmetry:0,glyphness:.05,erosion:.52,layering:.4,rhythm:.78,fragmentation:.32,coherence:.58},["#000000","#ffffff"],"#ffffff",800)],Cf=[Nr("Suprematist",{structure:.95,flow:.2,entropy:.05,memory:.55,contrast:.98,symmetry:.08,glyphness:0,erosion:.65,layering:.25,rhythm:.75,fragmentation:.05,coherence:.96,linear:.9,agentShape:"square"},["#000000","#cc1414","#1430aa","#f5e010","#ffffff"],"#f0f0f0",550,"suprematist"),Nr("Neon Wireframe",{structure:.82,flow:.55,entropy:.08,memory:.72,contrast:.98,symmetry:0,glyphness:0,erosion:.28,layering:.5,rhythm:.68,fragmentation:.18,coherence:.78,linear:1},["#00ffaa","#00aaff","#ff00aa"],"#000000",900),Nr("Botanical",{structure:.2,flow:.62,entropy:.22,memory:.9,contrast:.48,symmetry:.08,glyphness:.12,erosion:.08,layering:.92,rhythm:.28,fragmentation:.18,coherence:.84},["#1a4a10","#2d7020","#6ab040","#a8d870","#d0f0a8","#386028"],"#040a02",900,"botanical"),Nr("Psychedelic Mandala",{structure:.55,flow:.62,entropy:.32,memory:.7,contrast:.6,symmetry:.98,glyphness:.35,erosion:.2,layering:.88,rhythm:.55,fragmentation:.15,coherence:.82},["#ff2020","#ff8800","#ffff00","#00ff80","#0080ff","#8000ff"],"#040008",800,"ecstasy"),Nr("Aurora Borealis",{structure:.12,flow:.88,entropy:.28,memory:.82,contrast:.3,symmetry:.05,glyphness:0,erosion:.1,layering:.95,rhythm:.25,fragmentation:.08,coherence:.78},["#00ffc0","#0080ff","#8000ff","#00ff80","#40c8ff"],"#000810",700,"ascension"),Nr("Ink Storm",{structure:.28,flow:.78,entropy:.55,memory:.52,contrast:.9,symmetry:0,glyphness:.08,erosion:.4,layering:.72,rhythm:.8,fragmentation:.58,coherence:.42},["#0a0a0a","#1a1a1a","#888888","#cccccc"],"#f2f0ec",1e3,"conflict"),Nr("Prism Scatter",{structure:.15,flow:.72,entropy:.55,memory:.55,contrast:.8,symmetry:0,glyphness:0,erosion:.35,layering:.88,rhythm:.62,fragmentation:.65,coherence:.48},["#ff0040","#ff8000","#ffff00","#00ff80","#00aaff","#8800ff"],"#0a0008",1100,"ecstasy"),Nr("Slow Fog",{structure:.04,flow:.18,entropy:.2,memory:.98,contrast:.15,symmetry:0,glyphness:0,erosion:.02,layering:.98,rhythm:.08,fragmentation:.08,coherence:.92},["#aac8e0","#d0e8f0","#80a8c0","#e8f0f8"],"#e8f0f8",700,"silence"),Nr("Glitch",{structure:.15,flow:.65,entropy:.95,memory:.18,contrast:.95,symmetry:0,glyphness:0,erosion:.78,layering:.6,rhythm:.92,fragmentation:.98,coherence:.12,linear:.72},["#ff00ff","#00ffff","#ffffff","#000000","#ff4400"],"#050505",1200,"glitch"),Nr("Ancient Script",{structure:.32,flow:.4,entropy:.12,memory:.9,contrast:.62,symmetry:.08,glyphness:.98,erosion:.08,layering:.8,rhythm:.28,fragmentation:.15,coherence:.75},["#8b6914","#3d2a04","#c8a84b","#5c3d10","#e0c88a"],"#f5edd8",600,"gravity"),Nr("Marble Veins",{structure:.35,flow:.55,entropy:.22,memory:.78,contrast:.65,symmetry:.05,glyphness:0,erosion:.15,layering:.85,rhythm:.28,fragmentation:.55,coherence:.6},["#c8c8c8","#888888","#e8e8f0","#9090a8","#6060a0"],"#f8f8ff",800),Nr("Crystalline Lattice",{structure:.95,flow:.2,entropy:.03,memory:.9,contrast:.78,symmetry:.75,glyphness:0,erosion:.55,layering:.25,rhythm:.8,fragmentation:.05,coherence:.98,linear:.9,agentShape:"diamond"},["#a0d8ff","#60a8e0","#ffffff","#204060"],"#020810",600,"harmony"),Nr("Coral Reef",{structure:.22,flow:.48,entropy:.18,memory:.88,contrast:.5,symmetry:.12,glyphness:.15,erosion:.08,layering:.9,rhythm:.3,fragmentation:.22,coherence:.82},["#ff6050","#ff9070","#ffb090","#40c0a0","#20a080","#ff4040"],"#020e0c",900,"harmony"),Nr("Wabi-Sabi",{structure:.12,flow:.3,entropy:.08,memory:.96,contrast:.4,symmetry:0,glyphness:0,erosion:.04,layering:.98,rhythm:.12,fragmentation:.1,coherence:.95},["#8a7060","#c0a888","#403028","#d8c8b0","#f0e8d8"],"#f4efe8",350,"minimal"),Nr("Void Static",{structure:.18,flow:.52,entropy:.9,memory:.12,contrast:.95,symmetry:0,glyphness:0,erosion:.65,layering:.55,rhythm:.7,fragmentation:.9,coherence:.18},["#ffffff","#cccccc","#888888","#000000"],"#000000",900),Nr("Neon Plasma",{structure:.22,flow:.82,entropy:.45,memory:.6,contrast:.7,symmetry:.72,glyphness:0,erosion:.25,layering:.9,rhythm:.65,fragmentation:.3,coherence:.68},["#ff0080","#8000ff","#00ffff","#ff8000"],"#010006",800,"ecstasy")],PS=[Nr("Constructive Score",{structure:.9,flow:.35,entropy:.08,memory:.7,contrast:.88,symmetry:.05,glyphness:0,erosion:.4,layering:.55,rhythm:.55,fragmentation:.12,coherence:.82,linear:.8,agentShape:"square"},["#e8e8e4","#c0c0b8","#404040","#808080","#1a1a1a"],"#0a0a0a",800),Nr("Geometric Orchestra",{structure:.55,flow:.6,entropy:.22,memory:.75,contrast:.7,symmetry:.18,glyphness:0,erosion:.2,layering:.82,rhythm:.45,fragmentation:.2,coherence:.75},["#0080ff","#8040ff","#00c8ff","#ff4080","#40ffcc"],"#020510",900),Nr("Analytical Collage",{structure:.6,flow:.28,entropy:.18,memory:.55,contrast:.75,symmetry:0,glyphness:0,erosion:.5,layering:.7,rhythm:.35,fragmentation:.45,coherence:.6,agentShape:"square"},["#e8d5b0","#b88040","#402010","#c0a060","#f0e8d0","#805020"],"#f5f0e8",700),Nr("Spiritual Geometry",{structure:.3,flow:.22,entropy:.06,memory:.95,contrast:.6,symmetry:.4,glyphness:0,erosion:.05,layering:.92,rhythm:.18,fragmentation:.05,coherence:.95},["#e8e0c8","#b0a878","#404030","#d8d0a0"],"#08080a",350)];function iH(){const e=Math.random,t=["circle","brush"],r=["ascension","gravity","conflict","harmony","ecstasy","silence","mondrian","suprematist","action","minimal","glitch","botanical","constellation","none"],o=(d,h)=>d+e()*(h-d),s=e()>.5?o(.6,1):o(0,.3),l=e()>.4,i={structure:e()>.5?o(.65,1):o(0,.35),flow:e()>.4?o(.5,1):o(0,.3),entropy:e()>.5?o(.6,1):o(0,.25),memory:o(.1,1),contrast:e()>.4?o(.65,1):o(.05,.4),symmetry:e()>.6?o(.6,1):o(0,.2),glyphness:e()>.7?o(.5,1):o(0,.15),erosion:o(.02,.9),layering:o(.2,1),rhythm:o(.05,1),fragmentation:e()>.5?o(.65,1):o(0,.3),coherence:e()>.5?o(.65,1):o(.1,.45),linear:s,agentShape:l?t[Math.floor(e()*t.length)]:"circle"},u=r[Math.floor(e()*r.length)],c=e()>.55?lH():cH();return{id:Bg(),name:"Random",genes:i,intention:u,palette:pg(4+Math.floor(e()*4)),background:c,quantaCount:Math.floor(350+e()*900),createdAt:Date.now()}}function lH(){const e=Math.floor(Math.random()*360),t=Math.floor(Math.random()*25),r=Math.floor(2+Math.random()*10);return $g(e,t,r)}function cH(){const e=Math.floor(Math.random()*360),t=Math.floor(Math.random()*18),r=Math.floor(88+Math.random()*10);return $g(e,t,r)}function dH(e,t,r){const o={},s=new Set([...Object.keys(e),...Object.keys(t)]);for(const l of s){if(l==="agentShape"){o[l]=r<.5?e[l]:t[l];continue}const i=e[l]??0,u=t[l]??0;e[l]===void 0&&t[l]===void 0||(o[l]=i*(1-r)+u*r)}return o}function $g(e,t,r){r/=100,t/=100;const o=t*Math.min(r,1-r),s=l=>{const i=(l+e/30)%12,u=r-o*Math.max(Math.min(i-3,9-i,1),-1);return Math.round(255*u).toString(16).padStart(2,"0")};return`#${s(0)}${s(8)}${s(4)}`}function pg(e=6){const t=Math.random()*360,r=Math.random(),o=[],s=Math.random()>.45,l=s?20:45,i=s?60:85;for(let u=0;u<e;u++){let c;r<.15?c=(t+u*12)%360:r<.3?c=(t+(u%2?180:0)+u*6)%360:r<.5?c=(t+u%3*120+u*4)%360:r<.65?c=(t+u%4*90)%360:r<.8?c=(t+u%2*150+u*8)%360:c=(t+u/e*360)%360;const d=u===e-1&&Math.random()>.5?10+Math.random()*20:55+Math.random()*40,h=l+Math.random()*(i-l);o.push($g((c+360)%360,d,h))}return o}function uH(e,t){const r=(t()*80-40+360)%360;return e.map(o=>{const s=parseInt(o.slice(1,3),16)/255,l=parseInt(o.slice(3,5),16)/255,i=parseInt(o.slice(5,7),16)/255,u=Math.max(s,l,i),c=Math.min(s,l,i);let d=0;const h=u-c,f=(u+c)/2,g=h===0?0:h/(1-Math.abs(2*f-1));if(h!==0)switch(u){case s:d=((l-i)/h+(l<i?6:0))*60;break;case l:d=((i-s)/h+2)*60;break;case i:d=((s-l)/h+4)*60;break}return $g((d+r)%360,g*100,f*100)})}const jy=48;function Ey(){const e=jy*jy;return{size:jy,flowX:new Float32Array(e),flowY:new Float32Array(e),density:new Float32Array(e),pressure:new Float32Array(e),memory:new Float32Array(e),symbol:new Float32Array(e),mask:new Float32Array(e),interactionMatrix:new Float32Array(36)}}function hH(e){let t=Math.abs(e|0)%233280||1;return()=>(t=(t*9301+49297)%233280,t/233280)}function FS(e,t,r){const o=r%1e3,s=Math.sin(e*127.1+o*.311)*43758.5453,l=Math.sin(t*269.5+o*.183)*43758.5453;return s-Math.floor(s)-.5+(l-Math.floor(l)-.5)}function Ty(e,t,r){const{structure:o,coherence:s,entropy:l,flow:i,symmetry:u}=t.genes,c=e.size,d=r%6283*.001;for(let h=0;h<c;h++)for(let f=0;f<c;f++){const g=f/c,m=h/c;let y;if(o>.8)y=Math.round(g*4*o)%4*Math.PI/2+m*i*Math.PI*.3;else if(u>.65){const b=g-.5,S=m-.5,C=Math.atan2(S,b),k=Math.sqrt(b*b+S*S);y=C+Math.PI/2+Math.sin(k*(6+s*8)+d)*i*1.5}else if(l>.8)y=FS(g+d*.1,m+d*.1,r)*Math.PI*3;else{const b=2+s*3,S=b*1.8;y=Math.sin(g*b+d)*Math.cos(m*b+d*.7)*Math.PI*2+Math.cos(g*S-m*S+d*.5)*i*Math.PI+FS(g+d*.08,m+d*.06,r)*l*Math.PI}const v=h*c+f;e.flowX[v]=Math.cos(y),e.flowY[v]=Math.sin(y)}}function V0(e,t,r=!1){const o=hH((Math.abs(t|0)^57005)%233280||1),s=new Float32Array(36),{entropy:l,coherence:i,fragmentation:u,contrast:c,rhythm:d,structure:h}=e.genes,f=[[.35,-.25,.15,-.5,.4,.05],[.3,.2,-.3,.1,-.15,.35],[.1,-.15,.25,.3,-.2,.1],[-.45,.15,-.2,-.1,.5,-.35],[.55,-.25,.15,.3,.15,0],[.05,.35,-.1,-.3,.05,.4]];for(let g=0;g<6;g++)for(let m=0;m<6;m++){const y=g===m;if(r&&!y){o(),o(),s[g*6+m]=0;continue}let v;if(r&&y)v=.65+o()*.25;else if(h>.82)v=y?.55+o()*.3:-(.12+o()*.22);else if(i>.8&&l<.28)v=y?.75+o()*.22:(o()-.72)*.18;else if(u>.85)v=y?.4+o()*.5:(o()-.5)*.08;else if(l>.82)v=(o()-.5)*2.2;else{const b=f[g][m],S=(o()-.5)*l*.9,C=.35+i*.55+c*.35,k=y?0:-u*.28;v=b*C+S+k}v+=(o()-.5)*d*.12,s[g*6+m]=v}return s}function fH(e,t,r){const o=e.size,s=Math.max(0,Math.min(o-1,Math.floor(t*o))),i=Math.max(0,Math.min(o-1,Math.floor(r*o)))*o+s;return{fx:e.flowX[i],fy:e.flowY[i]}}function pH(e,t,r,o){const s=e.size,l=Math.max(0,Math.min(s-1,Math.floor(t*s))),u=Math.max(0,Math.min(s-1,Math.floor(r*s)))*s+l;e.density[u]=Math.min(1,e.density[u]+o),e.memory[u]=Math.min(1,e.memory[u]+o*.3)}function NS(e,t,r,o,s,l,i=0){const u=e.size,c=Math.ceil(o*u),d=Math.floor(t*u),h=Math.floor(r*u);for(let f=-c;f<=c;f++)for(let g=-c;g<=c;g++){const m=d+g,y=h+f;if(m<0||y<0||m>=u||y>=u)continue;const v=Math.sqrt(g*g+f*f)/(c+.1);if(v>1)continue;const b=(1-v)*(1-v)*l,S=y*u+m;switch(s){case"attractor":{const C=(d-m)/(u*.01+Math.abs(d-m)),k=(h-y)/(u*.01+Math.abs(h-y));e.flowX[S]=e.flowX[S]*(1-b*.5)+C*b*.5,e.flowY[S]=e.flowY[S]*(1-b*.5)+k*b*.5;break}case"repulsor":{const C=(m-d)/(u*.01+Math.abs(m-d)),k=(y-h)/(u*.01+Math.abs(y-h));e.flowX[S]=e.flowX[S]*(1-b*.5)+C*b*.5,e.flowY[S]=e.flowY[S]*(1-b*.5)+k*b*.5;break}case"flow_comb":e.flowX[S]=e.flowX[S]*(1-b)+Math.cos(i)*b,e.flowY[S]=e.flowY[S]*(1-b)+Math.sin(i)*b;break;case"vortex":{const C=-(y-h)/(u+1),k=(m-d)/(u+1),R=Math.sqrt(C*C+k*k)+1e-4;e.flowX[S]=e.flowX[S]*(1-b*.6)+C/R*b*.6,e.flowY[S]=e.flowY[S]*(1-b*.6)+k/R*b*.6;break}case"solve":e.density[S]*=1-b*.15,e.pressure[S]*=1-b*.2,e.memory[S]*=1-b*.05;break;case"coagula":e.density[S]=Math.min(1,e.density[S]+b*.1),e.pressure[S]=Math.min(1,e.pressure[S]+b*.15),e.memory[S]=Math.min(1,e.memory[S]+b*.08);break}}}function mH(e,t){const{memory:r,coherence:o}=t.genes,s=e.size,l=.982+r*.017,i=o*.015,u=new Float32Array(e.density);for(let c=1;c<s-1;c++)for(let d=1;d<s-1;d++){const h=c*s+d,f=u[(c-1)*s+d]+u[(c+1)*s+d]+u[c*s+(d-1)]+u[c*s+(d+1)];e.density[h]=(u[h]*(1-i)+f/4*i)*l,e.pressure[h]*=.94,e.memory[h]*=.9995}}function gH(e){let t=Math.abs(e|0)%233280||1;return()=>(t=(t*9301+49297)%233280,t/233280)}function qg(e){const t=parseInt(e.slice(1,3),16)/255,r=parseInt(e.slice(3,5),16)/255,o=parseInt(e.slice(5,7),16)/255,s=Math.max(t,r,o),l=Math.min(t,r,o);let i=0,u=0;const c=(s+l)/2;if(s!==l){const d=s-l;switch(u=c>.5?d/(2-s-l):d/(s+l),s){case t:i=((r-o)/d+(r<o?6:0))/6;break;case r:i=((o-t)/d+2)/6;break;case o:i=((t-r)/d+4)/6;break}}return[i*360,u,c]}function OS(e,t,r=8){const o=t.length;if(o!==0)for(const s of e){const l=t[s.species%o]??t[0],[i,u,c]=qg(l);s.hue=(i+(Math.random()-.5)*r+360)%360,s.sat=Math.max(.35,Math.min(1,u+(Math.random()-.5)*.06)),s.lit=Math.max(.15,Math.min(.88,c+(Math.random()-.5)*.04)),s.baseHue!==void 0&&(s.baseHue=i)}}const Wo=18;function AR(e){const t=Array.from({length:Wo*Wo},()=>[]);for(let r=0;r<e.length;r++){const o=e[r],s=Math.min(Wo-1,Math.max(0,Math.floor(o.x*Wo))),l=Math.min(Wo-1,Math.max(0,Math.floor(o.y*Wo)));t[l*Wo+s].push(r)}return t}function yH(e,t,r,o){if(e<r)return-Math.max(.3,Math.abs(t))*(r/(e+1e-4)-1)*3;if(e>=o)return 0;const s=(e-r)/(o-r);return t*(1-Math.abs(2*s-1))}const _S=[[.22,.22],[.78,.22],[.22,.78],[.78,.78],[.5,.22],[.5,.78]],kh=[{flowFollow:1.2,noiseScale:.6,dampOffset:.04,maxSpeedMul:1,name:"luminous"},{flowFollow:.2,noiseScale:.2,dampOffset:.14,maxSpeedMul:.35,name:"shadowed"},{flowFollow:2.8,noiseScale:.18,dampOffset:.01,maxSpeedMul:2.2,name:"flowing"},{flowFollow:.05,noiseScale:2.8,dampOffset:-.2,maxSpeedMul:3.5,name:"expander"},{flowFollow:1.5,noiseScale:.35,dampOffset:.05,maxSpeedMul:1.3,name:"magnetic"},{flowFollow:.08,noiseScale:4,dampOffset:-.3,maxSpeedMul:4.5,name:"glitch"}];function xH(e,t){const r=gH(t),o=e.quantaCount,s=[];if(o<=0)return s;const l=["DRAW","DRAW","DRAW","DRAW","FLOW","GLYPH","STAMP","ERASE"],i=[.5,.5,.5,.5,.15,e.genes.glyphness*.3,.08,.04],u=i.reduce((c,d)=>c+d,0);for(let c=0;c<o;c++){const d=Math.floor(r()*e.palette.length),h=e.palette[d]??"#888888",[f,g,m]=qg(h);let y="DRAW";const v=r()*u;let b=0;for(let T=0;T<l.length;T++)if(b+=i[T],v<b){y=l[T];break}const S=(c%6+Math.floor(r()*2))%6,C=.003+e.genes.flow*.008,k=r()*Math.PI*2,R=kh[S]??kh[0],j=C*R.maxSpeedMul*(.5+r()*.5);s.push({x:r(),y:r(),vx:Math.cos(k)*j,vy:Math.sin(k)*j,charge:r(),ink:.4+r()*.6,mood:r(),role:y,species:S,memX:new Float32Array([r(),r(),r(),r(),r(),r()]),memY:new Float32Array([r(),r(),r(),r(),r(),r()]),memIdx:0,age:Math.floor(r()*200),hue:f+(r()-.5)*40*(1-e.genes.coherence),sat:Math.max(.05,Math.min(1,g+(r()-.5)*.25*e.genes.contrast)),lit:Math.max(.1,Math.min(.9,m+(r()-.5)*.25)),alpha:.45+r()*.55,size:.8+r()*2.5*(1+e.genes.structure*.5),glyphIndex:Math.floor(r()*32)})}return s}function DS(e,t,r,o,s,l,i,u){const c=[],d=e.palette;for(let h=0;h<l;h++){const f=Math.random,g=u>=0&&u<d.length?u:Math.floor(f()*d.length),m=d[g]??"#888888",[y,v,b]=qg(m),S=Math.floor(f()*6),C=kh[S]??kh[0],k=Math.max(.001,Math.min(.999,t+(f()-.5)*i)),R=Math.max(.001,Math.min(.999,r+(f()-.5)*i)),j=.6+f()*1.2;c.push({x:k,y:R,vx:o*j*C.maxSpeedMul+(f()-.5)*.003,vy:s*j*C.maxSpeedMul+(f()-.5)*.003,charge:f(),ink:.7+f()*.3,mood:f(),role:"DRAW",species:S,memX:new Float32Array([k,k,k,k,k,k]),memY:new Float32Array([R,R,R,R,R,R]),memIdx:0,age:0,hue:y+(f()-.5)*30*(1-e.genes.coherence),sat:Math.max(.1,Math.min(1,v+(f()-.5)*.2)),lit:Math.max(.15,Math.min(.9,b+(f()-.5)*.15)),alpha:.6+f()*.4,size:.8+f()*2.5*(1+e.genes.structure*.5),glyphIndex:Math.floor(f()*32)})}return c}function bH(e,t,r,o,s,l,i,u=1,c=!1,d="wrap",h){const{flow:f,entropy:g,coherence:m,erosion:y,rhythm:v,fragmentation:b,structure:S}=r.genes,C=r.genes.linear??0,k=(h==null?void 0:h.rMaxMul)??1,R=(h==null?void 0:h.forceMul)??1,j=(h==null?void 0:h.dampingMul)??1,T=(h==null?void 0:h.noiseMul)??1,_=(h==null?void 0:h.maxSpeedMul)??1,P=(h==null?void 0:h.rMinMul)??1,I=(h==null?void 0:h.centerPull)??0,$=(h==null?void 0:h.quadrantMode)??!1,q=(h==null?void 0:h.quadrantStrength)??.3,L=(h==null?void 0:h.borderRepulsion)??0,H=(3e-4+Math.pow(f,1.6)*.0175)*_,G=g*g*.038*T,oe=(.97-Math.pow(g,1.5)*.39)*Math.max(.5,Math.min(1.5,j)),le=.02+Math.pow(f,1.5)*.28,pe=1-y,ce=v>.35?.88+.12*Math.sin(i*.07*v):1,te=.016*P,F=(.07+b*.055+m*.025)*k,Q=(.015+m*.045+r.genes.contrast*.025)*R,ae=AR(e),we=t.interactionMatrix,Re=e.length,ge=r.genes.isolation??0,Ae=ge>.01?Math.max(0,1-ge*1.2):1,tt=o.isDragging,We=o.lastX/s,J=o.lastY/l,ke=o.size/Math.max(s,l);for(let Le=0;Le<Re;Le++){const K=e[Le],et=kh[K.species]??kh[0],{fx:dt,fy:Rt}=fH(t,K.x,K.y),Wt=C>.4?Math.max(0,1-C*.9):1,Zt=le*et.flowFollow*(1-g*.4)*Wt,$e=G*et.noiseScale*Wt,Ze=Math.max(.48,Math.min(.98,oe+et.dampOffset+m*.03));let Fe=dt*Zt+(Math.random()-.5)*$e,Xe=Rt*Zt+(Math.random()-.5)*$e;const jt=Math.min(Wo-1,Math.max(0,Math.floor(K.x*Wo))),hn=Math.min(Wo-1,Math.max(0,Math.floor(K.y*Wo)));for(let Pt=-1;Pt<=1;Pt++)for(let zt=-1;zt<=1;zt++){const jn=jt+zt,En=hn+Pt;if(jn<0||En<0||jn>=Wo||En>=Wo)continue;const lt=ae[En*Wo+jn];for(const ht of lt){if(ht===Le)continue;const _t=e[ht];let Ie=_t.x-K.x,at=_t.y-K.y;Ie>.5&&(Ie-=1),Ie<-.5&&(Ie+=1),at>.5&&(at-=1),at<-.5&&(at+=1);const St=Math.sqrt(Ie*Ie+at*at);if(St<1e-4||St>F)continue;const ye=we[K.species*6+_t.species],gt=K.species===_t.species?1:Ae;if(gt<=1e-4)continue;const Ge=yH(St,ye,te,F)*gt;if(Ge===0)continue;const Ye=Ge*Q/(St+1e-4);Fe+=Ie*Ye,Xe+=at*Ye}}if(S>.65){const Pt=(S-.65)*1.8,zt=.04+(1-S)*.08,jn=Math.round(K.x/zt)*zt,En=Math.round(K.y/zt)*zt;Fe+=(jn-K.x)*Pt*.15,Xe+=(En-K.y)*Pt*.15}if((K.species===3||K.species===5)&&Math.random()<v*.04&&(Fe+=(Math.random()-.5)*.012,Xe+=(Math.random()-.5)*.012),I>.001&&(Fe+=(.5-K.x)*I*.003,Xe+=(.5-K.y)*I*.003),$){const Pt=_S[K.species]??_S[0],zt=Pt[0]-K.x,jn=Pt[1]-K.y,lt=Math.sqrt(zt*zt+jn*jn)>.28?2.8:1,ht=q*.022*lt;if(Fe+=zt*ht,Xe+=jn*ht,ge>.3){const _t=(ge-.3)*1.5;Fe+=zt*_t*.01,Xe+=jn*_t*.01}}if(L>.001){const zt=L*.005;K.x<.08&&(Fe+=(.08-K.x)*zt*4),K.x>1-.08&&(Fe-=(K.x-(1-.08))*zt*4),K.y<.08&&(Xe+=(.08-K.y)*zt*4),K.y>1-.08&&(Xe-=(K.y-(1-.08))*zt*4)}if(C>.4){const Pt=Math.min(1,(C-.4)*1.67),zt=Math.sqrt(K.vx*K.vx+K.vy*K.vy);if(zt>2e-5){const jn=K.vx/zt,En=K.vy/zt,lt=Fe*jn+Xe*En,ht=Fe-lt*jn,_t=Xe-lt*En;Fe-=ht*Pt*.97,Xe-=_t*Pt*.97}}const an=C>.4?C*.015:0,it=Math.pow(Math.max(.01,Math.min(.9999,Ze+an)),u);K.vx=(K.vx*it+Fe*u)*ce,K.vy=(K.vy*it+Xe*u)*ce;const kt=Math.sqrt(K.vx*K.vx+K.vy*K.vy),On=H*et.maxSpeedMul,sn=C>.5?On*(1+C*1.5):On;if(kt>sn){const Pt=sn/kt;K.vx*=Pt,K.vy*=Pt}if(d==="wrap"?(K.x=((K.x+K.vx*u)%1+1)%1,K.y=((K.y+K.vy*u)%1+1)%1):d==="bounce"?(K.x+=K.vx*u,K.y+=K.vy*u,K.x<0&&(K.x=-K.x,K.vx=Math.abs(K.vx)),K.x>1&&(K.x=2-K.x,K.vx=-Math.abs(K.vx)),K.y<0&&(K.y=-K.y,K.vy=Math.abs(K.vy)),K.y>1&&(K.y=2-K.y,K.vy=-Math.abs(K.vy)),K.x=Math.max(0,Math.min(1,K.x)),K.y=Math.max(0,Math.min(1,K.y))):d==="absorb"?(K.x+=K.vx*u,K.y+=K.vy*u,(K.x<0||K.x>1||K.y<0||K.y>1)&&(K.x=.1+Math.random()*.8,K.y=.1+Math.random()*.8,K.vx=(Math.random()-.5)*.005,K.vy=(Math.random()-.5)*.005)):(K.x+=K.vx*u,K.y+=K.vy*u,K.x=Math.max(-.5,Math.min(1.5,K.x)),K.y=Math.max(-.5,Math.min(1.5,K.y))),Math.sqrt(K.vx*K.vx+K.vy*K.vy)>1e-4&&r.genes.agentShape==="brush"&&(K.angle=Math.atan2(K.vy,K.vx)),K.memX[K.memIdx]=K.x,K.memY[K.memIdx]=K.y,K.memIdx=(K.memIdx+1)%6,pH(t,K.x,K.y,.008*K.ink),tt){const Pt=We-K.x,zt=J-K.y,jn=Math.sqrt(Pt*Pt+zt*zt)+1e-4;if(jn<ke){const lt=(1-jn/ke)*o.pressure,ht=1/jn,_t=o.activeToolId;if(_t==="attract"||_t==="attractor")K.vx+=Pt*ht*lt*.35,K.vy+=zt*ht*lt*.35;else if(_t==="repel"||_t==="repulsor")K.vx-=Pt*ht*lt*.35,K.vy-=zt*ht*lt*.35;else if(_t==="vortex")K.vx+=-zt*ht*lt*.45,K.vy+=Pt*ht*lt*.45;else if(_t==="freeze"){const Ie=Math.max(0,1-lt*.55);K.vx*=Ie,K.vy*=Ie}else if(_t==="burst"){const Ie=Math.random()*Math.PI*2,at=lt*sn*40;K.vx+=Math.cos(Ie)*at,K.vy+=Math.sin(Ie)*at}else if(_t==="black_hole"){const Ie=lt*lt*1.2/(jn+.005);K.vx+=Pt*ht*Ie,K.vy+=zt*ht*Ie,jn<ke*.08&&(K.x=(1-K.x+(Math.random()-.5)*.15+1)%1,K.y=(1-K.y+(Math.random()-.5)*.15+1)%1)}else if(_t==="color_infect"){const Ie=r.palette[o.colorIndex%r.palette.length];if(Ie){const[at,St,ye]=qg(Ie),xe=(at-K.hue+540)%360-180;K.hue=(K.hue+xe*lt*.08+360)%360,K.sat=K.sat+(St-K.sat)*lt*.05,K.lit=K.lit+(ye-K.lit)*lt*.04}}else _t==="size_wave"?K.size=Math.max(.2,K.size+Math.sin(i*.08+K.age*.05)*lt*.6):_t==="ink_flood"?K.ink=Math.min(1,K.ink+lt*.06):_t==="species_shift"?Math.random()<lt*.018&&(K.species=Math.floor(Math.random()*6)):_t==="pinch"?(K.vy+=(J-K.y)*lt*.18,K.vx+=(We-K.x)*lt*.05):_t==="scatter_burst"?(K.vx-=Pt*ht*lt*.4,K.vy-=zt*ht*lt*.4):_t==="channel"&&(K.vx+=o.dragDX*lt*.3,K.vy+=o.dragDY*lt*.3)}}c||(K.ink=Math.max(0,K.ink-y*.0018),K.ink<.08&&(K.ink=.2+Math.random()*.6*pe),K.mood+=(Math.random()-.5)*.009,K.mood=Math.max(0,Math.min(1,K.mood)),(K.species===2||K.species===5)&&(K.hue=(K.hue+.08)%360)),K.age++}}function Iy(e,t,r,o,s,l,i){switch(e.globalAlpha=i,e.fillStyle=l,e.strokeStyle=l,e.beginPath(),t){case"square":e.rect(r-s,o-s,s*2,s*2),e.fill();break;case"diamond":e.moveTo(r,o-s),e.lineTo(r+s,o),e.lineTo(r,o+s),e.lineTo(r-s,o),e.closePath(),e.fill();break;case"triangle":e.moveTo(r,o-s),e.lineTo(r+s*.87,o+s*.5),e.lineTo(r-s*.87,o+s*.5),e.closePath(),e.fill();break;case"cross":{const u=s*.35;e.rect(r-u,o-s,u*2,s*2),e.fill(),e.beginPath(),e.rect(r-s,o-u,s*2,u*2),e.fill();break}case"star":{const c=s*.42;for(let d=0;d<10;d++){const h=d/10*Math.PI*2-Math.PI/2,f=d%2===0?s:c;d===0?e.moveTo(r+Math.cos(h)*f,o+Math.sin(h)*f):e.lineTo(r+Math.cos(h)*f,o+Math.sin(h)*f)}e.closePath(),e.fill();break}default:e.arc(r,o,s,0,Math.PI*2),e.fill()}}function vH(e){return(e.linear??0)>.5?"straight":e.entropy>.68&&e.memory<.5?"dust":e.structure>.7?"blocks":e.coherence>.76&&e.entropy<.32?"blobs":"lines"}function SH(e){return e<.28?1:e<.5?2:e<.66?4:e<.82?6:8}function wH(e,t,r,o,s,l,i=1,u){const{contrast:c,glyphness:d,symmetry:h}=r.genes,f=vH(r.genes),g=SH(h),m=o/2,y=s/2,v=r.genes.agentShape??"circle",b=v==="brush",S=u;for(const C of t){if(C.role==="FLOW"||C.role==="MASK"||C.ink<.04)continue;const k=C.x*o,R=C.y*s,j=[];for(let q=0;q<6;q++){const L=(C.memIdx+q)%6;j.push([C.memX[L]*o,C.memY[L]*s])}let T=!1;for(let q=1;q<6;q++)if(Math.abs(j[q][0]-j[q-1][0])>o*.18||Math.abs(j[q][1]-j[q-1][1])>s*.18){T=!0;break}if(T)continue;const _=`hsl(${C.hue.toFixed(0)},${(C.sat*100).toFixed(0)}%,${(C.lit*100).toFixed(0)}%)`,P=`hsla(${C.hue.toFixed(0)},${(C.sat*100).toFixed(0)}%,${(C.lit*100).toFixed(0)}%,0)`,I=C.ink*C.alpha,$=Math.min(.85,I*(.14+c*.52));if(b&&S){const q=C.angle??0,L=j[5],H=Math.max(3,C.size*i*8*S.lengthMul*(C.isSingleton?3:1)),G=Math.max(.4,C.size*i*S.widthMul*(.4+C.mood*.6)*(C.isSingleton?2:1)),oe=Math.cos(q),le=Math.sin(q),pe=$*S.opacityMul*(1-S.opacityJitter*Math.random());if(S.textureBreak>0&&Math.random()<S.textureBreak)continue;e.lineCap=S.lineCap;for(let ce=0;ce<S.bristles;ce++){const te=S.bristleSpread>0?(ce-(S.bristles-1)/2)*S.bristleSpread:0,F=-le*te,Q=oe*te,ae=G*(1-S.widthJitter*Math.random());e.globalAlpha=Math.min(.8,pe/S.bristles),e.strokeStyle=_,e.lineWidth=Math.max(.3,ae),e.beginPath(),e.moveTo(L[0]-oe*H*.5+F,L[1]-le*H*.5+Q),e.lineTo(L[0]+oe*H*.5+F,L[1]+le*H*.5+Q),e.stroke()}S.bleed>.05&&(e.globalAlpha=pe*S.bleed*.08,e.filter="blur(4px)",e.strokeStyle=_,e.lineWidth=G*3,e.beginPath(),e.moveTo(L[0]-oe*H*.4,L[1]-le*H*.4),e.lineTo(L[0]+oe*H*.4,L[1]+le*H*.4),e.stroke(),e.filter="none"),e.lineCap="round";continue}if(C.role==="GLYPH"&&d>.12&&l%10===Math.floor(C.age%10)){const q=["","","","","","","","","","","",""];e.globalAlpha=Math.min(.9,$*1.5),e.fillStyle=_,e.font=`${Math.max(6,C.size*i*1.6)}px monospace`,e.textAlign="center",e.textBaseline="middle";for(let L=0;L<g;L++){const H=L/g*Math.PI*2,G=Math.cos(H),oe=Math.sin(H),le=k-m,pe=R-y;e.fillText(q[C.glyphIndex%q.length],m+le*G-pe*oe,y+le*oe+pe*G)}continue}for(let q=0;q<g;q++){let L=j;if(g>1){const H=q/g*Math.PI*2,G=Math.cos(H),oe=Math.sin(H);L=j.map(([le,pe])=>{const ce=le-m,te=pe-y;return[m+ce*G-te*oe,y+ce*oe+te*G]})}switch(e.fillStyle=_,e.strokeStyle=_,e.lineCap="round",e.lineJoin="round",f){case"dust":{const H=Math.max(.3,C.size*i*.22+C.mood*.18);Iy(e,v,L[5][0],L[5][1],H,_,$*.65);break}case"blocks":{const H=Math.max(2,Math.round(C.size*i*(.8+r.genes.structure*1.3))),G=Math.round(L[5][0]/H)*H,oe=Math.round(L[5][1]/H)*H,le=r.genes.fragmentation*H*.3,pe=(H-le)/2;Iy(e,v,G+H/2,oe+H/2,pe,_,$*.88);break}case"blobs":{const H=Math.max(3,C.size*i*(1.8+r.genes.coherence*5)),G=e.createRadialGradient(L[5][0],L[5][1],0,L[5][0],L[5][1],H);G.addColorStop(0,_),G.addColorStop(.6,_),G.addColorStop(1,P),e.fillStyle=G,e.globalAlpha=$*.22,e.beginPath(),e.arc(L[5][0],L[5][1],H,0,Math.PI*2),e.fill(),e.fillStyle=_;break}case"straight":case"lines":default:{if(v!=="circle"){const H=Math.max(.3,C.size*i*.32);Iy(e,v,L[5][0],L[5][1],H,_,$*.78)}else{e.globalAlpha=$,e.lineWidth=Math.max(.2,C.size*i*(f==="straight"?.35:.28)*(.5+C.mood*.7)),f==="straight"&&(e.lineCap="square"),e.beginPath(),e.moveTo(L[1][0],L[1][1]);for(let H=2;H<=4;H++){const G=L[H-2],oe=L[H-1],le=L[H],pe=L[Math.min(H+1,5)],ce=oe[0]+(le[0]-G[0])/6,te=oe[1]+(le[1]-G[1])/6,F=le[0]-(pe[0]-oe[0])/6,Q=le[1]-(pe[1]-oe[1])/6;e.bezierCurveTo(ce,te,F,Q,le[0],le[1])}e.stroke(),f==="straight"&&(e.lineCap="round")}break}}}}e.globalAlpha=1,e.globalCompositeOperation="source-over"}function LS(e,t,r,o,s,l=1,i){e.clearRect(0,0,o,s);const{contrast:u}=r.genes,c=r.genes.agentShape==="brush",d=i;for(const h of t){if(h.role==="FLOW"||h.role==="MASK")continue;const f=h.x*o,g=h.y*s,m=`hsl(${h.hue.toFixed(0)},${(h.sat*100).toFixed(0)}%,${(h.lit*100).toFixed(0)}%)`,y=Math.min(.9,h.ink*h.alpha*(.28+u*.55));if(c&&d){const v=h.angle??0,b=Math.max(2,h.size*l*6*d.lengthMul*(h.isSingleton?3:1)),S=Math.max(.5,h.size*l*d.widthMul*(.5+h.mood*.5)*(h.isSingleton?2:1)),C=Math.cos(v),k=Math.sin(v);if(e.lineCap=d.lineCap,e.lineJoin="round",d.textureBreak>0&&Math.random()<d.textureBreak)continue;const R=y*d.opacityMul*(1-d.opacityJitter*Math.random());for(let j=0;j<d.bristles;j++){const T=d.bristleSpread>0?(j-(d.bristles-1)/2)*d.bristleSpread:0,_=-k*T,P=C*T,I=S*(1-d.widthJitter*Math.random());e.globalAlpha=R/d.bristles,e.strokeStyle=m,e.lineWidth=Math.max(.3,I),e.beginPath(),e.moveTo(f-C*b*.5+_,g-k*b*.5+P),e.lineTo(f+C*b*.5+_,g+k*b*.5+P),e.stroke()}d.bleed>.05&&(e.globalAlpha=R*d.bleed*.12,e.filter="blur(3px)",e.strokeStyle=m,e.lineWidth=S*2.5,e.beginPath(),e.moveTo(f-C*b*.3,g-k*b*.3),e.lineTo(f+C*b*.3,g+k*b*.3),e.stroke(),e.filter="none")}else{const v=y;e.globalAlpha=v,e.fillStyle=m;const b=Math.max(.5,h.size*l*.38*(h.isSingleton?5:1)+h.mood*.4);e.beginPath(),e.arc(f,g,b,0,Math.PI*2),e.fill()}}e.globalAlpha=1,e.lineCap="round"}function CH(e,t,r,o,s){e.clearRect(0,0,o,s);const l=(.06+r.genes.coherence*.055)*Math.min(o,s),i=l*l,u=AR(t),{contrast:c,coherence:d}=r.genes;for(let h=0;h<t.length;h++){const f=t[h],g=f.x*o,m=f.y*s,y=Math.min(Wo-1,Math.max(0,Math.floor(f.x*Wo))),v=Math.min(Wo-1,Math.max(0,Math.floor(f.y*Wo)));for(let b=-1;b<=1;b++)for(let S=-1;S<=1;S++){const C=y+S,k=v+b;if(!(C<0||k<0||C>=Wo||k>=Wo))for(const R of u[k*Wo+C]){if(R<=h)continue;const j=t[R],T=j.x*o,_=j.y*s,P=T-g,I=_-m,$=P*P+I*I;if($>i)continue;const L=1-Math.sqrt($)/l,H=(f.hue+j.hue)/2,G=Math.max(.2,Math.min(.85,(f.lit+j.lit)/2)),oe=L*L*(.08+c*.18)*d;e.globalAlpha=Math.min(.6,oe),e.strokeStyle=`hsl(${H.toFixed(0)},${((f.sat+j.sat)/2*100).toFixed(0)}%,${(G*100).toFixed(0)}%)`,e.lineWidth=Math.max(.2,L*.9),e.beginPath(),e.moveTo(g,m),e.lineTo(T,_),e.stroke()}}}e.globalAlpha=1}function MH(e,t,r,o,s,l=1){e.clearRect(0,0,o,s);const{coherence:i,contrast:u,flow:c}=r.genes,d=(5+i*10+c*5)*l,h=r.background,g=(h.length>=7?(parseInt(h.slice(1,3),16)*.299+parseInt(h.slice(3,5),16)*.587+parseInt(h.slice(5,7),16)*.114)/255:.1)>.5;for(const m of t){if(m.ink<.08)continue;const y=m.x*o,v=m.y*s,b=m.ink*m.alpha*(.04+u*.08+(g?.03:0));if(b<.004)continue;const S=d*(.5+m.size*.08),C=g?Math.max(.1,m.lit*.72):Math.min(.9,m.lit+.15),k=`hsl(${m.hue.toFixed(0)},${Math.min(100,m.sat*120).toFixed(0)}%,${(C*100).toFixed(0)}%)`,R=`hsla(${m.hue.toFixed(0)},${(m.sat*100).toFixed(0)}%,${(C*100).toFixed(0)}%,0.3)`,j=e.createRadialGradient(y,v,0,y,v,S);j.addColorStop(0,k),j.addColorStop(.45,R),j.addColorStop(1,`hsla(${m.hue.toFixed(0)},50%,50%,0)`),e.globalAlpha=Math.min(.7,b),e.fillStyle=j,e.beginPath(),e.arc(y,v,S,0,Math.PI*2),e.fill()}e.globalAlpha=1}function kH(e,t,r){for(const l of e){for(const i of t){const u=i.x2-i.x1,c=i.y2-i.y1,d=u*u+c*c;if(d<1e-4)continue;const h=Math.max(0,Math.min(1,((l.x-i.x1)*u+(l.y-i.y1)*c)/d)),f=i.x1+h*u,g=i.y1+h*c,m=f-l.x,y=g-l.y,v=Math.sqrt(m*m+y*y)+1e-4;if(v>.12)continue;const b=1-v/.12;if(i.type==="flow"){const S=i.strength*.08*b*b/(v*2+.005);l.vx+=m/v*S,l.vy+=y/v*S;const C=Math.sqrt(d),k=u/C,R=c/C;l.vx+=k*i.strength*.012*b,l.vy+=R*i.strength*.012*b}else{const S=i.strength*.12*b*b/(v*2+.005);l.vx+=m/v*S,l.vy+=y/v*S}}for(const i of r){const u=i.points;if(u.length<2)continue;let c=1/0,d=0,h=0,f=0,g=0;for(let v=0;v<u.length-1;v++){const b=u[v][0],S=u[v][1],C=u[v+1][0],k=u[v+1][1],R=C-b,j=k-S,T=R*R+j*j;if(T<1e-6)continue;const _=Math.max(0,Math.min(1,((l.x-b)*R+(l.y-S)*j)/T)),P=b+_*R,I=S+_*j,$=P-l.x,q=I-l.y,L=Math.sqrt($*$+q*q);if(L<c){c=L,d=$,h=q;const H=Math.sqrt(T);f=R/H,g=j/H}}if(c>.06)continue;const m=1-c/.06,y=i.strength*.06*m*m/(c+.003);l.vx+=d/(c+1e-4)*y,l.vy+=h/(c+1e-4)*y,l.vx+=f*i.strength*.02*m,l.vy+=g*i.strength*.02*m}}}function RH(e,t,r,o,s,l){e.save(),e.lineCap="round";for(const i of t){const u=i.x1*o,c=i.y1*s,d=i.x2*o,h=i.y2*s,f=i.color;e.strokeStyle=f,e.lineWidth=6*i.strength,e.globalAlpha=.06,e.beginPath(),e.moveTo(u,c),e.lineTo(d,h),e.stroke(),e.lineWidth=1.4,e.globalAlpha=.65,e.setLineDash(i.type==="pinch"?[3,5]:[6,4]),e.beginPath(),e.moveTo(u,c),e.lineTo(d,h),e.stroke(),e.setLineDash([]);const g=d-u,m=h-c,y=Math.sqrt(g*g+m*m);if(y>10){const b=-m/y,S=g/y,C=Math.floor(y/16);e.lineWidth=.7,e.globalAlpha=.35;for(let k=1;k<C;k++){const R=u+g*(k/C),j=c+m*(k/C);e.beginPath(),e.moveTo(R+b*4,j+S*4),e.lineTo(R-b*4,j-S*4),e.stroke()}}const v=3;for(let b=0;b<v;b++){const S=(b/v+l*.003)%1,C=u+(d-u)*S,k=c+(h-c)*S;e.globalAlpha=.5*(.5+.5*Math.sin(l*.06+b*1.5)),e.fillStyle=f,e.beginPath(),e.arc(C,k,1.5,0,Math.PI*2),e.fill()}e.globalAlpha=.7,e.fillStyle=f,e.beginPath(),e.arc(u,c,3,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(d,h,3,0,Math.PI*2),e.fill()}for(const i of r){if(i.points.length<2)continue;const u=i.color;e.strokeStyle=u,e.lineWidth=4*i.strength,e.globalAlpha=.05,e.beginPath(),e.moveTo(i.points[0][0]*o,i.points[0][1]*s);for(let c=1;c<i.points.length;c++)e.lineTo(i.points[c][0]*o,i.points[c][1]*s);e.stroke(),e.lineWidth=1.2,e.globalAlpha=.55,e.beginPath(),e.moveTo(i.points[0][0]*o,i.points[0][1]*s);for(let c=1;c<i.points.length;c++)e.lineTo(i.points[c][0]*o,i.points[c][1]*s);e.stroke(),e.globalAlpha=.45,e.fillStyle=u;for(let c=8;c<i.points.length-1;c+=12){const d=i.points[c][0]*o,h=i.points[c][1]*s,f=i.points[c+1][0]*o,g=i.points[c+1][1]*s,m=f-d,y=g-h,v=Math.sqrt(m*m+y*y);if(v<.5)continue;const b=m/v,S=y/v,C=7,k=3;e.beginPath(),e.moveTo(d+b*C,h+S*C),e.lineTo(d-S*k,h+b*k),e.lineTo(d+S*k,h-b*k),e.closePath(),e.fill()}}e.restore()}function AH(e,t,r,o,s){if(!t.isDragging)return;const l=t.activeToolId;if(!["attract","attractor","repel","repulsor","vortex","freeze","burst","black_hole","scatter_burst"].includes(l))return;const u=t.lastX,c=t.lastY,d=t.size;e.save();const h=.6+.4*Math.sin(s*.08);e.globalAlpha=.25*h,e.strokeStyle=l==="freeze"?"#80ddff":l==="burst"||l==="scatter_burst"?"#ff6040":l==="black_hole"?"#a040ff":"#ffffff",e.lineWidth=1.2,e.beginPath(),e.arc(u,c,d,0,Math.PI*2),e.stroke(),e.globalAlpha=.35,e.lineWidth=.8;const f=6;e.beginPath(),e.moveTo(u-f,c),e.lineTo(u+f,c),e.stroke(),e.beginPath(),e.moveTo(u,c-f),e.lineTo(u,c+f),e.stroke(),e.globalAlpha=.55,e.fillStyle=e.strokeStyle,e.beginPath(),e.arc(u,c,2,0,Math.PI*2),e.fill(),e.restore()}const jH=[{id:"trail",name:"Rastro",blendMode:"normal",opacity:1},{id:"particles",name:"Quanta",blendMode:"normal",opacity:.18},{id:"connections",name:"Conexoes",blendMode:"normal",opacity:.6},{id:"glow",name:"Brilho",blendMode:"normal",opacity:.18},{id:"post",name:"Post/FX",blendMode:"normal",opacity:0},{id:"brush",name:"Pinceis",blendMode:"normal",opacity:1}];function EH(e,t){return jH.map(r=>{const o=document.createElement("canvas");return o.width=e,o.height=t,{...r,canvas:o,visible:!0,locked:!1}})}function U0(e,t){return e.find(r=>r.id===t)}function TH(e){if(!e.canvas)return;e.canvas.getContext("2d").clearRect(0,0,e.canvas.width,e.canvas.height)}function IH(e,t,r,o,s){e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.fillStyle=r,e.fillRect(0,0,o,s);for(const l of t)!l.visible||!l.canvas||l.opacity<=0||(e.globalAlpha=l.opacity,e.globalCompositeOperation=PH(l.blendMode),e.drawImage(l.canvas,0,0));e.globalAlpha=1,e.globalCompositeOperation="source-over",e.restore()}function PH(e){switch(e){case"add":return"lighter";case"multiply":return"multiply";case"screen":return"screen";case"overlay":return"overlay";default:return"source-over"}}function FH(e,t,r=1){if(!e.canvas)return;const o=e.canvas.getContext("2d"),{memory:s}=t.genes,l=.48+Math.pow(s,.45)*.518,i=r<=0?1:Math.pow(Math.max(.001,Math.min(.9999,l)),Math.max(.02,r));o.globalCompositeOperation="destination-in",o.globalAlpha=i,o.fillStyle="rgba(0,0,0,1)",o.fillRect(0,0,e.canvas.width,e.canvas.height),o.globalCompositeOperation="source-over",o.globalAlpha=1}function NH(e,t,r,o,s){if(!e.canvas||!t.canvas)return;const l=e.canvas.getContext("2d");l.clearRect(0,0,o,s);const{coherence:i,contrast:u}=r.genes,c=i*(1-u*.3);c>.1&&(l.save(),l.filter=`blur(${Math.round(6+i*14)}px)`,l.globalAlpha=c*.5,l.globalCompositeOperation="source-over",l.drawImage(t.canvas,0,0),l.filter="none",l.restore())}const mg=[{id:"spawn_brush",icon:"",name:"Spawn",category:"vida",description:"Pinta agentes vivos  cada trao gera quanta que ganham vida prpria",params:[{label:"Raio",key:"size",min:5,max:220,step:5},{label:"Dens.",key:"pressure",min:.05,max:1,step:.05}]},{id:"erase_agents",icon:"",name:"Apagar",category:"vida",description:"Remove quanta do campo  apaga agentes dentro do raio",params:[{label:"Raio",key:"size",min:10,max:350,step:10},{label:"Fora",key:"pressure",min:.1,max:1,step:.05}]},{id:"attract",icon:"",name:"Atrator",category:"forca",description:"Puxa quanta para o cursor  cria concentrao e densidade viva",params:[{label:"Raio",key:"size",min:10,max:300,step:5},{label:"Fora",key:"pressure",min:.05,max:1,step:.05}]},{id:"repel",icon:"",name:"Repulsor",category:"forca",description:"Expande e dispersa quanta  cria espao negativo",params:[{label:"Raio",key:"size",min:10,max:300,step:5},{label:"Fora",key:"pressure",min:.05,max:1,step:.05}]},{id:"vortex",icon:"",name:"Vrtice",category:"forca",description:"Gira quanta em torno do cursor  redemoinhos e espirais vivas",params:[{label:"Raio",key:"size",min:10,max:300,step:5},{label:"Fora",key:"pressure",min:.05,max:1,step:.05}]},{id:"freeze",icon:"",name:"Congelar",category:"forca",description:"Retarda quanta no raio  cria zonas de silncio e suspenso",params:[{label:"Raio",key:"size",min:10,max:300,step:5},{label:"Fora",key:"pressure",min:.05,max:1,step:.05}]},{id:"burst",icon:"",name:"Exploso",category:"forca",description:"Explode velocidade aleatria nos agentes  caos localizado",params:[{label:"Raio",key:"size",min:10,max:300,step:5},{label:"Fora",key:"pressure",min:.05,max:1,step:.05}]},{id:"black_hole",icon:"",name:"Buraco Negro",category:"forca",description:"Atrao extrema  os quanta chegam e so lanados ao outro lado",params:[{label:"Raio",key:"size",min:10,max:250,step:5},{label:"Fora",key:"pressure",min:.05,max:1,step:.05}]},{id:"color_infect",icon:"",name:"Infectar Cor",category:"mutar",description:"Propaga a cor ativa para os quanta no raio  contgio cromtico",params:[{label:"Raio",key:"size",min:10,max:300,step:5},{label:"Fora",key:"pressure",min:.02,max:1,step:.02}]},{id:"size_wave",icon:"",name:"Onda Tamanho",category:"mutar",description:"Modula o tamanho dos quanta em onda pulsante  textura dinmica",params:[{label:"Raio",key:"size",min:10,max:300,step:5},{label:"Ampli.",key:"pressure",min:.05,max:1,step:.05}]},{id:"ink_flood",icon:"",name:"Inundar Tinta",category:"mutar",description:"Reabastece tinta dos quanta  intensifica rastros na regio",params:[{label:"Raio",key:"size",min:10,max:300,step:5},{label:"Fora",key:"pressure",min:.05,max:1,step:.05}]},{id:"species_shift",icon:"",name:"Mudar Espcie",category:"mutar",description:'Converte espcie dos quanta  muda o "tipo" dos agentes vivos',params:[{label:"Raio",key:"size",min:10,max:300,step:5},{label:"Taxa",key:"pressure",min:.01,max:1,step:.02}]},{id:"flow_paint",icon:"",name:"Pintar Fluxo",category:"guiar",description:"Define direo do campo vetorial com o gesto  guia quanta por muito tempo",params:[{label:"Raio",key:"size",min:10,max:300,step:5},{label:"Fora",key:"pressure",min:.1,max:1,step:.05}]},{id:"channel",icon:"",name:"Canal",category:"guiar",description:"Cria corrente direcional  empurra quanta na direo do arraste",params:[{label:"Raio",key:"size",min:10,max:300,step:5},{label:"Fora",key:"pressure",min:.05,max:1,step:.05}]},{id:"pinch",icon:"",name:"Pinar",category:"guiar",description:"Comprime quanta em direo a uma linha  cria acumulaes lineares",params:[{label:"Raio",key:"size",min:10,max:350,step:5},{label:"Fora",key:"pressure",min:.05,max:1,step:.05}]},{id:"scatter_burst",icon:"",name:"Disperso",category:"guiar",description:"Explode quanta radialmente do cursor  disperso controlada",params:[{label:"Raio",key:"size",min:10,max:350,step:5},{label:"Fora",key:"pressure",min:.05,max:1,step:.05}]}];function zS(){return{activeToolId:"spawn_brush",size:40,pressure:.65,flow:.6,hardness:.6,colorIndex:0,glyphIndex:0,isDragging:!1,lastX:0,lastY:0,sizeMul:1,dragDX:0,dragDY:0}}let OH=1;function _H(){return`arch-${Date.now()}-${OH++}`}function DH(e,t,r,o){const s=e.toDataURL("image/jpeg",.7);return{id:_H(),timestamp:Date.now(),dna:{...t,genes:{...t.genes}},seed:r,thumbnail:s,gestures:o.slice(-10),pinned:!1,favorite:!1}}function Fc(e,t,r){return[{id:`grim-${Date.now()}`,timestamp:Date.now(),text:t,type:r},...e].slice(0,80)}function LH(e){const t=new Date(e),r=t.getHours().toString().padStart(2,"0"),o=t.getMinutes().toString().padStart(2,"0"),s=t.getSeconds().toString().padStart(2,"0");return`${r}:${o}:${s}`}function jR(e){let t=e;return()=>(t=(t*9301+49297)%233280,t/233280)}function zH(e){return Math.max(0,Math.min(1,e))}function ER(e,t=.25,r=8){const o=[],s=jR(e.createdAt+r);for(let l=0;l<r;l++){const i={...e.genes},u=t*(.5+s()*1.2),c=Object.keys(i),d=3+Math.floor(s()*3),h=[...c].filter(m=>m!=="linear"&&m!=="agentShape").sort(()=>s()-.5).slice(0,d);let f=u;for(const m of h){const y=i[m]??0,v=(s()-.5)*2*Math.min(f,.35);if(i[m]=zH(y+v),f-=Math.abs(v),f<=0)break}const g=s()>.6?uH(e.palette,s):e.palette;o.push({...e,id:Bg(),genes:i,palette:g,createdAt:Date.now()+l})}return o}function BH(e,t,r=.5){const o=jR(e.createdAt^t.createdAt),s=dH(e.genes,t.genes,r+(o()-.5)*.2),l=[],i=e.palette.length>=t.palette.length?e.palette:t.palette,u=e.palette.length<t.palette.length?e.palette:t.palette;for(let c=0;c<i.length;c++)l.push(o()>.5?i[c]:u[c%u.length]??i[c]);return{id:Bg(),genes:s,intention:o()>.5?e.intention:t.intention,palette:l.slice(0,6),background:o()>.5?e.background:t.background,quantaCount:o()>.5?e.quantaCount:t.quantaCount,createdAt:Date.now(),name:`cross(${(e.name??"A").slice(0,8)},${(t.name??"B").slice(0,8)})`}}function $H(e,t=100){const r=document.createElement("canvas");r.width=r.height=t;const o=r.getContext("2d"),{genes:s,palette:l,background:i}=e;o.fillStyle=i,o.fillRect(0,0,t,t);const u=Math.max(2,Math.floor(s.layering*6+2));for(let c=0;c<u;c++){const d=l[c%l.length],h=.12+s.contrast*.45;if(o.globalAlpha=h,s.structure>.7){const f=Math.round(3+s.structure*4),g=t/f,m=t/f;for(let y=0;y<f;y++)for(let v=0;v<f;v++)(y+v+c)%3===0&&(o.fillStyle=l[(y+v+c)%l.length],o.fillRect(v*g,y*m,g*(1-s.fragmentation*.4),m))}else if(s.symmetry>.7){const f=t/2,g=t/2,m=t*(.15+c*.12),y=o.createRadialGradient(f,g,m*.1,f,g,m);y.addColorStop(0,d),y.addColorStop(1,"transparent"),o.fillStyle=y,o.fillRect(0,0,t,t)}else{const f=(s.fragmentation<.5?.5:(c+1)/(u+1))*t,g=(.3+s.flow*.4)*t,m=t*(.18+s.coherence*.3),y=o.createRadialGradient(f,g,m*.05,f,g,m);y.addColorStop(0,d+"ff"),y.addColorStop(1,d+"00"),o.fillStyle=y,o.fillRect(0,0,t,t)}}if(s.glyphness>.4){o.globalAlpha=s.glyphness*.7,o.fillStyle=l[0],o.font=`${Math.round(t*.28)}px monospace`,o.textAlign="center",o.textBaseline="middle";const c=["","","","","",""];o.fillText(c[Math.floor(s.glyphness*5)%c.length],t/2,t/2)}if(s.entropy>.4){const c=o.getImageData(0,0,t,t),d=c.data,h=s.entropy*25;for(let f=0;f<d.length;f+=4){const g=(Math.random()-.5)*h;d[f]=Math.max(0,Math.min(255,d[f]+g)),d[f+1]=Math.max(0,Math.min(255,d[f+1]+g)),d[f+2]=Math.max(0,Math.min(255,d[f+2]+g))}o.putImageData(c,0,0)}return o.globalAlpha=1,r.toDataURL("image/jpeg",.8)}function qH(e,t="metaarte"){const r=document.createElement("a");r.download=`${t}-${Date.now()}.png`,r.href=e.toDataURL("image/png"),r.click()}function WH(e,t="recipe"){const r=JSON.stringify(e,null,2),o=new Blob([r],{type:"application/json"}),s=URL.createObjectURL(o),l=document.createElement("a");l.download=`${t}-${Date.now()}.json`,l.href=s,l.click(),setTimeout(()=>URL.revokeObjectURL(s),1e3)}function HH(e){let t=Math.abs(e|0)%233280||1;return()=>(t=(t*9301+49297)%233280,t/233280)}function GH(e){const t=parseInt(e.slice(1,3),16)/255,r=parseInt(e.slice(3,5),16)/255,o=parseInt(e.slice(5,7),16)/255,s=Math.max(t,r,o),l=Math.min(t,r,o);let i=0,u=0;const c=(s+l)/2;if(s!==l){const d=s-l;switch(u=c>.5?d/(2-s-l):d/(s+l),s){case t:i=((r-o)/d+(r<o?6:0))/6;break;case r:i=((o-t)/d+2)/6;break;case o:i=((t-r)/d+4)/6;break}}return[i*360,u,c]}function Uo(e,t,r,o,s=0,l=0,i){const u=i??Math.floor(t()*e.palette.length),c=e.palette[u%e.palette.length]??"#888",[d,h,f]=GH(c),g=Math.floor(t()*6),m=.003+e.genes.flow*.008,y=t()*Math.PI*2,v=m*(.5+t()*.8),b=s!==0||l!==0?s:Math.cos(y)*v,S=s!==0||l!==0?l:Math.sin(y)*v;return{x:r,y:o,vx:b,vy:S,charge:t(),ink:.5+t()*.5,mood:t(),role:"DRAW",species:g,memX:new Float32Array([r,r,r,r,r,r]),memY:new Float32Array([o,o,o,o,o,o]),memIdx:0,age:0,hue:d+(t()-.5)*30*(1-e.genes.coherence),sat:Math.max(.1,Math.min(1,h)),lit:Math.max(.15,Math.min(.9,f)),alpha:.6+t()*.4,size:.8+t()*2.5*(1+e.genes.structure*.5),glyphIndex:Math.floor(t()*32),baseHue:d}}const VH={scatter:"Scatter",grid:"Grade",hex_grid:"Grade Hex",ring:"Anel",spiral:"Espiral",galaxy:"Galxia",cross:"Cruz",diagonal:"Diagonal",sine_wave:"Onda",clusters:"Clusters",center_burst:"Exploso",edges:"Bordas",corners:"Cantos",concentric:"Concntrico",flow_lines:"Fluxos",golden_spiral:"Fibonacci",explosion:"Big Bang",yin_yang:"Yin-Yang",lattice:"Retculo",noise_bands:"Bandas"};function UH(e,t,r){const o=HH(t),s=Math.max(1,e.quantaCount),l=[];switch(r){case"scatter":{for(let i=0;i<s;i++)l.push(Uo(e,o,o(),o()));break}case"grid":{const i=Math.ceil(Math.sqrt(s*1.7777777777777777)),u=Math.ceil(s/i);let c=0;for(let d=0;d<u&&c<s;d++)for(let h=0;h<i&&c<s;h++,c++){const f=(h+.5+(o()-.5)*.2)/i,g=(d+.5+(o()-.5)*.2)/u;l.push(Uo(e,o,f,g,0,0,c%e.palette.length))}break}case"hex_grid":{const i=Math.ceil(Math.sqrt(s)),u=Math.ceil(s/i);let c=0;for(let d=0;d<u&&c<s;d++)for(let h=0;h<i&&c<s;h++,c++){const g=(d%2===0?0:.5/i)+(h+.5)/i+(o()-.5)*.015,m=(d+.5)/u*.9+.05+(o()-.5)*.015;l.push(Uo(e,o,Math.min(.99,g),Math.min(.99,m),0,0,c%e.palette.length))}break}case"ring":{for(let i=0;i<s;i++){const u=i/s*Math.PI*2,c=.32+(o()-.5)*.06,d=.5+Math.cos(u)*c,h=.5+Math.sin(u)*c*.7,f=e.genes.flow*.006;l.push(Uo(e,o,d,h,-Math.sin(u)*f,Math.cos(u)*f*.7,i%e.palette.length))}break}case"spiral":{for(let i=0;i<s;i++){const u=i/s*Math.PI*8,c=u/(Math.PI*8)*.42+.02,d=.5+Math.cos(u)*c,h=.5+Math.sin(u)*c*.75,f=.004+e.genes.flow*.004;l.push(Uo(e,o,Math.max(.01,Math.min(.99,d)),Math.max(.01,Math.min(.99,h)),-Math.sin(u)*f,Math.cos(u)*f,i%e.palette.length))}break}case"galaxy":{for(let i=0;i<s;i++){const u=i%2,c=Math.floor(i/2)/(s/2)*Math.PI*5+u*Math.PI,d=c/(Math.PI*5)*.38+.03,h=(o()-.5)*.06,f=.5+Math.cos(c)*d+h,g=.5+Math.sin(c)*d*.65+h*.5,m=.003+e.genes.flow*.003;l.push(Uo(e,o,Math.max(.01,Math.min(.99,f)),Math.max(.01,Math.min(.99,g)),-Math.sin(c)*m,Math.cos(c)*m,u))}break}case"cross":{const i=Math.ceil(s/4);for(let u=0;u<s;u++){const c=Math.floor(u/i),d=u%i/i;let h=.5,f=.5;const g=(o()-.5)*.04;switch(c%4){case 0:h=d*.9+.05,f=.5+g;break;case 1:h=.5+g,f=d*.9+.05;break;case 2:h=(1-d)*.9+.05,f=.5+g;break;case 3:h=.5+g,f=(1-d)*.9+.05;break}l.push(Uo(e,o,h,f,0,0,c%e.palette.length))}break}case"diagonal":{const i=Math.min(8,e.palette.length);for(let u=0;u<s;u++){const c=u/s,d=Math.floor(c*i),h=c*i%1,f=h*.92+.04+(o()-.5)*.04,g=h*.85+d/i*.15+.04+(o()-.5)*.04;l.push(Uo(e,o,f,Math.min(.96,g),0,0,d%e.palette.length))}break}case"sine_wave":{const i=3+Math.floor(e.genes.rhythm*5);for(let u=0;u<s;u++){const c=u/s,d=c*.92+.04,h=.5+Math.sin(c*Math.PI*2*i)*.35+(o()-.5)*.03,f=Math.cos(c*Math.PI*2*i)*.003;l.push(Uo(e,o,d,h,.002,f,u%e.palette.length))}break}case"clusters":{const i=Math.max(2,Math.min(8,e.palette.length)),u=[];for(let c=0;c<i;c++)u.push([.1+o()*.8,.1+o()*.8]);for(let c=0;c<s;c++){const d=c%i,[h,f]=u[d],g=o()*Math.PI*2,m=Math.pow(o(),.5)*.12;l.push(Uo(e,o,Math.max(.01,Math.min(.99,h+Math.cos(g)*m)),Math.max(.01,Math.min(.99,f+Math.sin(g)*m*.75)),0,0,d%e.palette.length))}break}case"center_burst":{for(let i=0;i<s;i++){const u=o()*Math.PI*2,c=Math.pow(o(),2)*.12,d=.004+e.genes.flow*.008;l.push(Uo(e,o,.5+Math.cos(u)*c,.5+Math.sin(u)*c*.75,Math.cos(u)*d,Math.sin(u)*d,i%e.palette.length))}break}case"edges":{for(let i=0;i<s;i++){const u=o(),c=Math.floor(o()*4),d=.03+o()*.06;let h=u,f=u;switch(c){case 0:h=u,f=d;break;case 1:h=u,f=1-d;break;case 2:h=d,f=u;break;case 3:h=1-d,f=u;break}const g=e.genes.flow*.004,m=[.5-h,.5-f],y=Math.sqrt(m[0]**2+m[1]**2)+.001;l.push(Uo(e,o,h,f,m[0]/y*g,m[1]/y*g,c%e.palette.length))}break}case"corners":{const i=[[.15,.15],[.85,.15],[.15,.85],[.85,.85]];for(let u=0;u<s;u++){const c=u%4,[d,h]=i[c],f=o()*.1,g=o()*Math.PI*2;l.push(Uo(e,o,d+Math.cos(g)*f,h+Math.sin(g)*f*.75,0,0,c%e.palette.length))}break}case"concentric":{const i=Math.max(2,Math.min(8,e.palette.length));for(let u=0;u<s;u++){const c=u%i,d=u/s*Math.PI*2*i+c*.5,h=.06+(c+1)*(.38/i)+(o()-.5)*.02;l.push(Uo(e,o,.5+Math.cos(d)*h,.5+Math.sin(d)*h*.72,0,0,c%e.palette.length))}break}case"flow_lines":{const i=8+Math.floor(e.genes.flow*12);for(let u=0;u<s;u++){const c=u%i,d=u/s*i%1,h=c/i*Math.PI*2,f=c/i*.9+.05,g=d*.85+.07+Math.sin(d*Math.PI*3+h)*.08;l.push(Uo(e,o,f,Math.min(.97,g),0,.002,c%e.palette.length))}break}case"golden_spiral":{const i=(1+Math.sqrt(5))/2;for(let u=0;u<s;u++){const c=Math.sqrt(u/s)*.44,d=u*2*Math.PI/(i*i);l.push(Uo(e,o,.5+Math.cos(d)*c,.5+Math.sin(d)*c*.75,0,0,u%e.palette.length))}break}case"explosion":{for(let i=0;i<s;i++){const u=i/s*Math.PI*2+o()*.3,c=(.005+o()*.015)*(1+e.genes.flow*2);l.push(Uo(e,o,.5+(o()-.5)*.02,.5+(o()-.5)*.02,Math.cos(u)*c,Math.sin(u)*c*.75,i%e.palette.length))}break}case"yin_yang":{for(let i=0;i<s;i++){const u=i<s/2?0:1,c=i%(s/2)/(s/2),d=c*Math.PI*6+u*Math.PI,h=c*.35+.03,f=.5+(u===0?.1:-.1);l.push(Uo(e,o,Math.max(.01,Math.min(.99,f+Math.cos(d)*h)),Math.max(.01,Math.min(.99,.5+Math.sin(d)*h*.72)),0,0,u%e.palette.length))}break}case"lattice":{const i=Math.ceil(Math.sqrt(s));let u=0;for(let c=0;c<i&&u<s;c++)for(let d=0;d<i&&u<s;d++,u++){const h=(d+.5)/i+(c%2?.25/i:0),f=(c+.5)/i*.85+.07;l.push(Uo(e,o,h,f,0,0,(c+d)%e.palette.length))}break}case"noise_bands":{const i=e.palette.length;for(let u=0;u<s;u++){const c=u%i,d=(c+o())/i*.9+.05,h=o()*.9+.05;l.push(Uo(e,o,h,d,0,0,c))}break}}return l.slice(0,s)}function YH(e,t,r){const o=e.size;let s=0,l=0,i=0,u=0,c=0;for(let S=0;S<o;S++)for(let C=0;C<o;C++){const k=S*o+C;if(s+=e.density[k],l+=e.pressure[k],u+=e.memory[k],C>0&&S>0){const R=e.density[k],j=e.density[S*o+(C-1)],T=e.density[(S-1)*o+C];Math.abs(R-j)+Math.abs(R-T)>.08&&i++}if(C<o/2){const R=S*o+(o-1-C);c+=Math.abs(e.density[k]-e.density[R])}}const d=o*o,h=s/d,f=l/d,g=Math.abs(h-r)*20,m=1-Math.min(1,h*5),y=i/(d*.3),v=Math.max(0,1-c/(o*o*.25*.5)),b=Math.max(0,1-g*2);return{density:Math.min(1,h*4),contrast:Math.min(1,f*3),novelty:Math.min(1,g),silenceIndex:Math.max(0,m),motifStability:b,symmetry:v,fragmentation:Math.min(1,y)}}function BS(){return{rMaxMul:1,forceMul:1,dampingMul:1,noiseMul:1,maxSpeedMul:1,rMinMul:1,centerPull:0,quadrantMode:!1,quadrantStrength:.3,borderRepulsion:.25}}const tp=[{id:"molhado",label:"Molhado",emoji:"",lineCap:"round",opacityMul:.7,opacityJitter:.15,widthMul:1.8,widthJitter:.2,lengthMul:1.2,bristles:1,bristleSpread:0,edgeSoftness:.6,textureBreak:0,bleed:.5},{id:"seco",label:"Seco",emoji:"",lineCap:"square",opacityMul:.5,opacityJitter:.5,widthMul:1.4,widthJitter:.4,lengthMul:1,bristles:4,bristleSpread:3,edgeSoftness:0,textureBreak:.6,bleed:0},{id:"duro",label:"Duro",emoji:"",lineCap:"square",opacityMul:1,opacityJitter:0,widthMul:1,widthJitter:0,lengthMul:1,bristles:1,bristleSpread:0,edgeSoftness:0,textureBreak:0,bleed:0},{id:"macio",label:"Macio",emoji:"",lineCap:"round",opacityMul:.4,opacityJitter:.1,widthMul:2,widthJitter:.15,lengthMul:1.1,bristles:1,bristleSpread:0,edgeSoftness:.8,textureBreak:0,bleed:.2},{id:"aquarela",label:"Aquarela",emoji:"",lineCap:"round",opacityMul:.3,opacityJitter:.2,widthMul:2.5,widthJitter:.3,lengthMul:1.3,bristles:1,bristleSpread:0,edgeSoftness:.9,textureBreak:0,bleed:.8},{id:"gouache",label:"Gouache",emoji:"",lineCap:"square",opacityMul:1,opacityJitter:.05,widthMul:1.2,widthJitter:.05,lengthMul:.9,bristles:1,bristleSpread:0,edgeSoftness:0,textureBreak:0,bleed:0},{id:"nanquim",label:"Nanquim",emoji:"",lineCap:"round",opacityMul:.9,opacityJitter:.1,widthMul:.6,widthJitter:.3,lengthMul:1.4,bristles:1,bristleSpread:0,edgeSoftness:0,textureBreak:.1,bleed:0},{id:"crayon",label:"Crayon",emoji:"",lineCap:"round",opacityMul:.65,opacityJitter:.35,widthMul:1.6,widthJitter:.25,lengthMul:1,bristles:3,bristleSpread:2,edgeSoftness:0,textureBreak:.3,bleed:0},{id:"esmalte",label:"Esmalte",emoji:"",lineCap:"round",opacityMul:1,opacityJitter:0,widthMul:1.5,widthJitter:0,lengthMul:.8,bristles:1,bristleSpread:0,edgeSoftness:.3,textureBreak:0,bleed:.3},{id:"carvao",label:"Carvo",emoji:"",lineCap:"square",opacityMul:.6,opacityJitter:.3,widthMul:2.2,widthJitter:.35,lengthMul:1,bristles:3,bristleSpread:4,edgeSoftness:.1,textureBreak:.25,bleed:0},{id:"aerografo",label:"Aergrafo",emoji:"",lineCap:"round",opacityMul:.2,opacityJitter:.05,widthMul:3.5,widthJitter:.1,lengthMul:1.5,bristles:1,bristleSpread:0,edgeSoftness:1,textureBreak:0,bleed:.4},{id:"faca",label:"Faca",emoji:"",lineCap:"butt",opacityMul:.95,opacityJitter:.1,widthMul:2.8,widthJitter:.15,lengthMul:.7,bristles:1,bristleSpread:0,edgeSoftness:0,textureBreak:0,bleed:0},{id:"pena",label:"Pena",emoji:"",lineCap:"round",opacityMul:.85,opacityJitter:.2,widthMul:.4,widthJitter:.5,lengthMul:1.6,bristles:1,bristleSpread:0,edgeSoftness:0,textureBreak:.15,bleed:0},{id:"giz",label:"Giz",emoji:"",lineCap:"round",opacityMul:.55,opacityJitter:.4,widthMul:1.8,widthJitter:.3,lengthMul:1,bristles:2,bristleSpread:2,edgeSoftness:0,textureBreak:.5,bleed:0},{id:"grafite",label:"Grafite",emoji:"",lineCap:"round",opacityMul:.7,opacityJitter:.15,widthMul:.8,widthJitter:.15,lengthMul:1.1,bristles:2,bristleSpread:1,edgeSoftness:0,textureBreak:.1,bleed:0},{id:"acrilica",label:"Acrlica",emoji:"",lineCap:"round",opacityMul:.8,opacityJitter:.1,widthMul:1.3,widthJitter:.1,lengthMul:1,bristles:1,bristleSpread:0,edgeSoftness:.1,textureBreak:.05,bleed:.1}],Ha="'IBM Plex Mono', monospace",Ni="#ff0084",ai="rgba(255,255,255,0.28)",TR="rgba(255,255,255,0.5)",KH="rgba(255,255,255,0.85)",oi="rgba(255,255,255,0.06)",XH={vida:{label:"VIDA",accent:"#ff0084"},forca:{label:"FORA",accent:"#ff0084"},mutar:{label:"MUTAR",accent:"#ff0084"},guiar:{label:"GUIAR",accent:"#ff0084"}},ZH=["vida","forca","mutar","guiar"],JH=[{id:"circle",icon:""},{id:"square",icon:""},{id:"diamond",icon:""},{id:"triangle",icon:""},{id:"cross",icon:"+"},{id:"star",icon:""}],QH=92;function Mf({children:e}){return a.jsx("div",{style:{fontSize:7,letterSpacing:"0.16em",textTransform:"uppercase",color:ai,textAlign:"center",fontFamily:Ha,padding:"6px 0 4px",borderTop:`1px dashed ${oi}`},children:e})}function Py({label:e,active:t,onClick:r}){return a.jsx("button",{onClick:r,style:{flex:1,padding:"4px 2px",borderRadius:1,cursor:"pointer",fontSize:7,letterSpacing:"0.1em",textTransform:"uppercase",fontFamily:Ha,background:t?"rgba(255,0,132,0.08)":"rgba(255,255,255,0.02)",border:`1px solid ${t?"rgba(255,0,132,0.3)":oi}`,color:t?Ni:ai,transition:"all 0.12s"},children:e})}function Fy({label:e,val:t,min:r,max:o,step:s,fmt:l,onChange:i}){return a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[a.jsx("span",{style:{fontSize:7,color:ai,letterSpacing:"0.12em",textTransform:"uppercase",fontFamily:Ha},children:e}),a.jsx("span",{style:{fontSize:7,color:TR,fontFamily:Ha},children:l?l(t):t.toFixed(1)})]}),a.jsx("input",{type:"range",min:r,max:o,step:s,value:t,onChange:u=>i(parseFloat(u.target.value)),style:{width:"100%",cursor:"pointer",accentColor:Ni}})]})}const eG=({toolState:e,palette:t,onToolChange:r,agentShape:o,onAgentShape:s,sizeMul:l,onSizeMul:i,brushTextureId:u,onBrushTexture:c,onSpawnSingleton:d,singletonSize:h,onSingletonSize:f,simSpeed:g,onSimSpeed:m,staticAgents:y,onStaticAgents:v,isolatedSpecies:b,onIsolated:S,linear:C,onLinear:k,geoMode:R,onGeoMode:j,geoPanelOpen:T,onToggleGeoPanel:_})=>{const P=mg.find($=>$.id===e.activeToolId),I=o==="brush";return a.jsx("div",{style:{width:QH,height:"100%",display:"flex",flexDirection:"column",background:"#000",borderRight:`1px solid ${oi}`,overflow:"hidden",userSelect:"none",flexShrink:0},children:a.jsxs("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:[ZH.map($=>{const q=XH[$],L=mg.filter(H=>H.category===$);return a.jsxs("div",{children:[a.jsx("div",{style:{padding:"5px 0 3px",textAlign:"center",fontSize:7,letterSpacing:"0.16em",textTransform:"uppercase",color:ai,fontFamily:Ha,borderBottom:`1px dashed ${oi}`,borderTop:"1px solid rgba(255,255,255,0.02)"},children:q.label}),a.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:0},children:L.map(H=>{const G=e.activeToolId===H.id;return a.jsxs("button",{onClick:()=>r({activeToolId:H.id}),title:`${H.name}  ${H.description}`,style:{padding:"7px 2px 5px",border:"none",cursor:"pointer",background:G?"rgba(255,0,132,0.08)":"transparent",borderBottom:G?`1px solid ${Ni}`:"1px solid transparent",display:"flex",flexDirection:"column",alignItems:"center",gap:2,transition:"all 0.1s",color:G?Ni:ai},onMouseEnter:oe=>{G||(oe.currentTarget.style.background="rgba(255,255,255,0.03)")},onMouseLeave:oe=>{G||(oe.currentTarget.style.background="transparent")},children:[a.jsx("span",{style:{fontSize:13,lineHeight:1},children:H.icon}),a.jsx("span",{style:{fontSize:6,lineHeight:1.2,textAlign:"center",letterSpacing:"0.06em",textTransform:"uppercase",fontFamily:Ha,opacity:G?1:.5,wordBreak:"break-word",maxWidth:32},children:H.name.split(" ")[0]})]},H.id)})})]},$)}),a.jsxs("div",{style:{borderTop:`1px dashed ${oi}`,padding:"5px 5px"},children:[a.jsx("div",{style:{fontSize:7,color:ai,letterSpacing:"0.14em",textTransform:"uppercase",textAlign:"center",marginBottom:3,fontFamily:Ha},children:"COR"}),a.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:2},children:t.slice(0,6).map(($,q)=>a.jsx("button",{onClick:()=>r({colorIndex:q}),title:$,style:{width:"100%",aspectRatio:"1",borderRadius:1,background:$,border:"none",cursor:"pointer",outline:e.colorIndex===q?"1.5px solid rgba(255,255,255,0.8)":`1px solid ${oi}`,outlineOffset:1}},q))})]}),P&&P.params.length>0&&a.jsxs("div",{style:{borderTop:`1px dashed ${oi}`,padding:"5px 6px 6px",background:"rgba(255,255,255,0.01)"},children:[a.jsx("div",{style:{fontSize:7,color:Ni,letterSpacing:"0.14em",textTransform:"uppercase",textAlign:"center",marginBottom:4,fontFamily:Ha},children:P.name}),P.params.map($=>a.jsxs("div",{style:{marginBottom:5},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[a.jsx("span",{style:{fontSize:7,color:ai,letterSpacing:"0.08em",fontFamily:Ha},children:$.label}),a.jsx("span",{style:{fontSize:7,color:TR,fontFamily:Ha},children:(e[$.key]??$.min).toFixed($.step<.1?2:0)})]}),a.jsx("input",{type:"range",min:$.min,max:$.max,step:$.step,value:e[$.key]??$.min,onChange:q=>r({[$.key]:parseFloat(q.target.value)}),style:{width:"100%",cursor:"pointer",accentColor:Ni}})]},$.key))]}),a.jsx(Mf,{children:"Forma"}),a.jsxs("div",{style:{padding:"4px 5px 0"},children:[a.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:2},children:JH.map(({id:$,icon:q})=>{const L=o===$;return a.jsx("button",{onClick:()=>s($),title:$,style:{padding:"5px 2px",borderRadius:1,cursor:"pointer",background:L?"rgba(255,0,132,0.08)":"transparent",border:`1px solid ${L?"rgba(255,0,132,0.3)":oi}`,color:L?KH:ai,fontSize:11,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.1s"},children:q},$)})}),a.jsxs("button",{onClick:()=>s(I?"circle":"brush"),title:"Pincel reto",style:{width:"100%",marginTop:3,padding:"5px 4px",borderRadius:1,cursor:"pointer",fontSize:7,letterSpacing:"0.1em",display:"flex",alignItems:"center",justifyContent:"center",gap:4,background:I?"rgba(255,0,132,0.1)":"rgba(255,255,255,0.02)",border:`1px solid ${I?"rgba(255,0,132,0.35)":oi}`,color:I?Ni:ai,fontFamily:Ha,textTransform:"uppercase",transition:"all 0.12s"},children:[a.jsx("span",{style:{fontSize:12},children:""}),a.jsx("span",{children:"Pincel"})]})]}),I&&a.jsxs("div",{style:{padding:"4px 5px 5px"},children:[a.jsx("div",{style:{fontSize:7,color:"rgba(255,0,132,0.5)",letterSpacing:"0.12em",textTransform:"uppercase",textAlign:"center",marginBottom:4,fontFamily:Ha},children:"Textura"}),a.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:2},children:tp.map($=>{const q=u===$.id;return a.jsxs("button",{onClick:()=>c($.id),title:$.label,style:{padding:"4px 2px",borderRadius:1,cursor:"pointer",fontSize:7,display:"flex",flexDirection:"column",alignItems:"center",gap:1,background:q?"rgba(255,0,132,0.08)":"rgba(255,255,255,0.01)",border:`1px solid ${q?"rgba(255,0,132,0.3)":oi}`,color:q?Ni:ai,fontFamily:Ha,transition:"all 0.1s"},children:[a.jsx("span",{style:{fontSize:11,lineHeight:1},children:$.emoji}),a.jsx("span",{style:{fontSize:5.5,letterSpacing:"0.06em",textTransform:"uppercase"},children:$.label})]},$.id)})})]}),a.jsx(Mf,{children:"Solo"}),a.jsxs("div",{style:{padding:"4px 5px 6px",display:"flex",flexDirection:"column",gap:5},children:[a.jsx(Fy,{label:"Tamanho",val:h,min:2,max:20,step:.5,fmt:$=>`${$.toFixed(1)}x`,onChange:f}),a.jsxs("button",{onClick:d,style:{width:"100%",padding:"5px 4px",borderRadius:1,cursor:"pointer",fontSize:7,letterSpacing:"0.12em",textTransform:"uppercase",fontFamily:Ha,background:"rgba(255,0,132,0.06)",border:"1px solid rgba(255,0,132,0.25)",color:Ni,display:"flex",alignItems:"center",justifyContent:"center",gap:4,transition:"all 0.12s"},children:[a.jsx("span",{style:{fontSize:12},children:""}),a.jsx("span",{children:"Spawn"})]})]}),a.jsx(Mf,{children:"Agentes"}),a.jsxs("div",{style:{padding:"5px 6px 2px",display:"flex",flexDirection:"column",gap:6},children:[a.jsx(Fy,{label:"Tam.",val:l,min:.2,max:6,step:.1,fmt:$=>`${$.toFixed(1)}x`,onChange:i}),a.jsx(Fy,{label:"Tempo",val:g,min:.01,max:10,step:.01,fmt:$=>$<.1?$.toFixed(2)+"x":$.toFixed(1)+"x",onChange:m})]}),a.jsx(Mf,{children:"Modos"}),a.jsxs("div",{style:{padding:"4px 5px 5px",display:"flex",flexDirection:"column",gap:3},children:[a.jsx(Py,{label:"Fixo",active:y,onClick:v}),a.jsx(Py,{label:"Isolado",active:b,onClick:S}),a.jsx(Py,{label:"Rizoma",active:C,onClick:k})]}),a.jsx(Mf,{children:"Compositor"}),a.jsxs("div",{style:{padding:"4px 5px 5px"},children:[a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:2},children:["fluid","geometric","hybrid","3d"].map($=>{const q={fluid:"FLUID",geometric:"GEO",hybrid:"HYBRID","3d":"3D"},L=R===$;return a.jsx("button",{onClick:()=>j($),style:{padding:"4px 6px",borderRadius:1,cursor:"pointer",background:L?"rgba(255,0,132,0.08)":"rgba(255,255,255,0.01)",border:`1px solid ${L?"rgba(255,0,132,0.3)":oi}`,color:L?Ni:ai,fontSize:7,textAlign:"left",letterSpacing:"0.12em",fontFamily:Ha,textTransform:"uppercase",transition:"all 0.12s"},children:q[$]},$)})}),a.jsx("button",{onClick:_,style:{width:"100%",marginTop:5,padding:"4px 0",borderRadius:1,cursor:"pointer",fontSize:7,letterSpacing:"0.1em",textTransform:"uppercase",textAlign:"center",fontFamily:Ha,background:T?"rgba(255,0,132,0.06)":"rgba(255,255,255,0.02)",border:`1px solid ${T?"rgba(255,0,132,0.25)":oi}`,color:T?Ni:ai,transition:"all 0.12s"},children:"PARAMS"})]}),a.jsx("div",{style:{height:12}})]})})},tG=["normal","add","multiply","screen","overlay"],nG=({layers:e,onChange:t,onClearLayer:r})=>a.jsxs("div",{className:"flex flex-col gap-0 overflow-y-auto",style:{background:"#000",fontFamily:"'IBM Plex Mono', monospace"},children:[a.jsx("div",{style:{padding:"10px 12px 8px",fontSize:8,letterSpacing:"0.16em",color:"#ff0084",textTransform:"uppercase",borderBottom:"1px dashed rgba(255,255,255,0.06)"},children:"LAYER STACK"}),[...e].reverse().map(o=>a.jsxs("div",{style:{padding:"8px 10px",borderBottom:"1px solid rgba(255,255,255,0.04)",background:o.visible?"transparent":"rgba(0,0,0,0.3)",opacity:o.visible?1:.5},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:5},children:[a.jsx("button",{onClick:()=>t(o.id,{visible:!o.visible}),style:{background:"none",border:"none",cursor:"pointer",color:o.visible?"rgba(255,255,255,0.6)":"rgba(255,255,255,0.15)",padding:0},children:o.visible?a.jsx(vl,{size:11,strokeWidth:1.5}):a.jsx(Ag,{size:11,strokeWidth:1.5})}),a.jsx("button",{onClick:()=>t(o.id,{locked:!o.locked}),style:{background:"none",border:"none",cursor:"pointer",color:o.locked?"rgba(255,180,60,0.7)":"rgba(255,255,255,0.2)",padding:0},children:o.locked?a.jsx(Rx,{size:11,strokeWidth:1.5}):a.jsx(rE,{size:11,strokeWidth:1.5})}),a.jsx("span",{style:{flex:1,fontSize:10,color:"rgba(255,255,255,0.7)",letterSpacing:"0.04em"},children:o.name}),a.jsx("button",{onClick:()=>r(o.id),title:"Limpar camada",style:{background:"none",border:"none",cursor:"pointer",color:"rgba(255,255,255,0.18)",fontSize:9,padding:0},children:"clr"})]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[a.jsx("span",{style:{fontSize:8,color:"rgba(255,255,255,0.3)",width:14},children:Math.round(o.opacity*100)}),a.jsx("input",{type:"range",min:0,max:1,step:.01,value:o.opacity,onChange:s=>t(o.id,{opacity:parseFloat(s.target.value)}),style:{flex:1,cursor:"pointer",accentColor:"rgba(255,255,255,0.4)"}}),a.jsx("select",{value:o.blendMode,onChange:s=>t(o.id,{blendMode:s.target.value}),style:{background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.08)",color:"rgba(255,255,255,0.6)",fontSize:8,padding:"1px 3px",borderRadius:3,cursor:"pointer",width:58},children:tG.map(s=>a.jsx("option",{value:s,children:s},s))})]})]},o.id))]}),Bs="'IBM Plex Mono', monospace",i5="#ff0084",$l="rgba(255,255,255,0.28)",$S="rgba(255,255,255,0.5)",qS="rgba(255,255,255,0.85)",Gl="rgba(255,255,255,0.06)",WS=[{key:"structure",label:"Structure",desc:"organic  geometric"},{key:"flow",label:"Flow",desc:"static  dynamic"},{key:"entropy",label:"Entropy",desc:"order  chaos"},{key:"memory",label:"Memory",desc:"ephemeral  persistent"},{key:"contrast",label:"Contrast",desc:"soft  hard"},{key:"symmetry",label:"Symmetry",desc:"none  radial"},{key:"glyphness",label:"Glyphness",desc:"none  saturated"},{key:"erosion",label:"Erosion",desc:"accumulate  erode"},{key:"layering",label:"Layering",desc:"flat  deep"},{key:"rhythm",label:"Rhythm",desc:"continuous  staccato"},{key:"fragmentation",label:"Fragmentation",desc:"unified  fragmented"},{key:"coherence",label:"Coherence",desc:"noise  coherent"},{key:"linear",label:"Linear",desc:"curves  retas (rizoma)"},{key:"isolation",label:"Isolation",desc:"interacao total  especies isoladas"}],rG=["none","ascension","gravity","conflict","harmony","ecstasy","silence","mondrian","suprematist","action","minimal","glitch","botanical","constellation"],oG={none:"",ascension:"",gravity:"",conflict:"",harmony:"",ecstasy:"",silence:"",mondrian:"",suprematist:"",action:"",minimal:"",glitch:"",botanical:"",constellation:""},aG=({dna:e,onDNAChange:t,onMutate:r,pinnedDNA:o})=>{var g;const[s,l]=w.useState(new Set),i=(m,y)=>{t({...e,genes:{...e.genes,[m]:Math.max(0,Math.min(1,y))}})},u=m=>{l(y=>{const v=new Set(y);return v.has(m)?v.delete(m):v.add(m),v})},c=()=>{const m={...e.genes};for(const{key:y}of WS)s.has(y)||y!=="linear"&&(m[y]=Math.random());t({...e,genes:m})},d=()=>{r(ER(e,.28,8))},h=()=>{if(!o)return;const m=BH(e,o);t(m)},f=m=>{t(sH(e,m))};return a.jsxs("div",{className:"flex flex-col gap-0 overflow-y-auto",style:{background:"#000",fontFamily:Bs},children:[a.jsx("div",{style:{padding:"10px 12px 8px",fontSize:8,letterSpacing:"0.16em",color:i5,textTransform:"uppercase",borderBottom:`1px dashed ${Gl}`},children:"RECIPE / DNA"}),a.jsxs("div",{style:{padding:"8px 10px",borderBottom:`1px dashed ${Gl}`},children:[a.jsx("div",{style:{fontSize:7,color:$l,letterSpacing:"0.14em",textTransform:"uppercase",marginBottom:5,fontFamily:Bs},children:"Intention"}),a.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:3},children:rG.map(m=>a.jsxs("button",{onClick:()=>f(m),title:m,style:{padding:"2px 6px",borderRadius:1,fontSize:8,cursor:"pointer",border:"1px solid",fontFamily:Bs,borderColor:e.intention===m?"rgba(255,0,132,0.4)":Gl,background:e.intention===m?"rgba(255,0,132,0.08)":"transparent",color:e.intention===m?qS:$l,textTransform:"capitalize",display:"flex",alignItems:"center",gap:3},children:[a.jsx("span",{style:{opacity:.6},children:oG[m]??""}),m]},m))})]}),a.jsx("div",{style:{padding:"8px 10px",display:"flex",flexDirection:"column",gap:7},children:WS.map(({key:m,label:y,desc:v})=>{const b=s.has(m);return a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,marginBottom:2},children:[a.jsx("button",{onClick:()=>u(m),title:b?"Unlock gene":"Lock gene",style:{background:"none",border:"none",cursor:"pointer",padding:0,color:b?i5:$l,fontSize:8,lineHeight:1,fontFamily:Bs},children:b?"":""}),a.jsx("span",{style:{flex:1,fontSize:8,color:$S,letterSpacing:"0.06em",fontFamily:Bs},children:y}),a.jsx("span",{style:{fontSize:8,color:$l,fontFamily:Bs},children:(e.genes[m]??0).toFixed(2)})]}),a.jsx("div",{style:{display:"flex",alignItems:"center",gap:4},children:a.jsx("input",{type:"range",min:0,max:1,step:.01,value:e.genes[m]??0,disabled:b,onChange:S=>i(m,parseFloat(S.target.value)),style:{flex:1,cursor:b?"not-allowed":"pointer",accentColor:b?i5:"rgba(255,255,255,0.4)",opacity:b?.4:1}})}),a.jsx("div",{style:{fontSize:7,color:"rgba(255,255,255,0.15)",marginTop:1,fontFamily:Bs},children:v})]},m)})}),a.jsxs("div",{style:{padding:"6px 10px",borderTop:`1px dashed ${Gl}`},children:[a.jsxs("div",{style:{fontSize:7,color:$l,marginBottom:5,letterSpacing:"0.14em",textTransform:"uppercase",fontFamily:Bs},children:["Quanta",a.jsx("span",{style:{color:$S},children:e.quantaCount})]}),a.jsx("input",{type:"range",min:0,max:3e3,step:1,value:e.quantaCount,onChange:m=>t({...e,quantaCount:parseInt(m.target.value)}),style:{width:"100%",cursor:"pointer",accentColor:i5,marginBottom:5}}),a.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:3},children:[0,1,5,10,50,200,600,1500,3e3].map(m=>a.jsx("button",{onClick:()=>t({...e,quantaCount:m}),style:{padding:"2px 5px",borderRadius:1,fontSize:7,cursor:"pointer",fontFamily:Bs,letterSpacing:"0.04em",border:"1px solid",borderColor:e.quantaCount===m?"rgba(255,0,132,0.4)":Gl,background:e.quantaCount===m?"rgba(255,0,132,0.08)":"transparent",color:e.quantaCount===m?qS:$l},children:m===0?"blank":m>=1e3?`${m/1e3}k`:m},m))})]}),a.jsxs("div",{style:{padding:"6px 10px",borderTop:`1px dashed ${Gl}`},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:3},children:[a.jsx("div",{style:{flex:1,fontSize:7,color:$l,letterSpacing:"0.14em",textTransform:"uppercase",fontFamily:Bs},children:"Palette"}),a.jsx("button",{onClick:()=>t({...e,palette:pg(e.palette.length)}),title:"Paleta aleatria",style:{fontSize:7,padding:"2px 7px",borderRadius:1,cursor:"pointer",border:`1px solid ${Gl}`,background:"rgba(255,255,255,0.02)",color:$l,letterSpacing:"0.08em",fontFamily:Bs,textTransform:"uppercase"},children:"rand"})]}),a.jsxs("div",{style:{display:"flex",gap:4,alignItems:"center"},children:[e.palette.map((m,y)=>a.jsx("label",{title:m,style:{cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:1},children:a.jsx("input",{type:"color",value:m,onChange:v=>{const b=[...e.palette];b[y]=v.target.value,t({...e,palette:b})},style:{width:22,height:22,border:"none",cursor:"pointer",background:"none",padding:0}})},y)),a.jsxs("label",{title:"Background",style:{cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center"},children:[a.jsx("span",{style:{fontSize:6,color:$l,marginBottom:1,fontFamily:Bs},children:"BG"}),a.jsx("input",{type:"color",value:e.background,onChange:m=>t({...e,background:m.target.value}),style:{width:22,height:22,border:"none",cursor:"pointer",background:"none",padding:0}})]})]})]}),a.jsxs("div",{style:{padding:"8px 10px",borderTop:`1px dashed ${Gl}`,display:"flex",flexDirection:"column",gap:4},children:[a.jsx("button",{onClick:c,style:Ny(!1),children:"RANDOMIZE GENES"}),a.jsx("button",{onClick:d,style:Ny(!1),children:"MUTATE (8 VARIANTS)"}),a.jsxs("button",{onClick:h,disabled:!o,title:o?`Cross with ${o.name??"pinned"}`:"No DNA pinned",style:Ny(!o),children:["CROSS ",o?`+ ${((g=o.name)==null?void 0:g.slice(0,12))??"pinned"}`:"(PIN ONE FIRST)"]})]})]})};function Ny(e){return{padding:"5px 8px",borderRadius:1,fontSize:7,cursor:e?"not-allowed":"pointer",fontFamily:Bs,letterSpacing:"0.12em",textTransform:"uppercase",border:`1px solid ${e?Gl:"rgba(255,0,132,0.2)"}`,background:e?"rgba(255,255,255,0.01)":"rgba(255,0,132,0.05)",color:e?"rgba(255,255,255,0.15)":"rgba(255,0,132,0.7)",transition:"all 0.12s"}}const HS={observation:"rgba(100,180,255,0.7)",suggestion:"rgba(180,140,255,0.7)",milestone:"rgba(100,220,140,0.7)"},sG=({archive:e,grimoire:t,onRestoreEntry:r,onDeleteEntry:o,onToggleFavorite:s,onTogglePin:l})=>{const[i,u]=w.useState("archive");return a.jsxs("div",{className:"flex flex-col h-full overflow-hidden",style:{background:"#000",fontFamily:"'IBM Plex Mono', monospace"},children:[a.jsx("div",{style:{display:"flex",borderBottom:"1px dashed rgba(255,255,255,0.06)"},children:["archive","grimoire"].map(c=>a.jsx("button",{onClick:()=>u(c),style:{flex:1,padding:"8px 0",border:"none",cursor:"pointer",background:i===c?"rgba(255,0,132,0.04)":"transparent",color:i===c?"#ff0084":"rgba(255,255,255,0.28)",fontSize:8,letterSpacing:"0.14em",textTransform:"uppercase",borderBottom:i===c?"1px solid #ff0084":"1px solid transparent",fontFamily:"'IBM Plex Mono', monospace"},children:c==="archive"?"ARCHIVE":"GRIMOIRE"},c))}),i==="archive"?a.jsx("div",{className:"flex-1 overflow-y-auto",style:{padding:"8px 6px"},children:e.length===0?a.jsxs("div",{style:{textAlign:"center",padding:"24px 12px",color:"rgba(255,255,255,0.2)",fontSize:10},children:["Nenhum snapshot salvo.",a.jsx("br",{}),"Use a camera icon para capturar."]}):a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:6},children:e.map(c=>a.jsx(iG,{entry:c,onRestore:()=>r(c),onDelete:()=>o(c.id),onFavorite:()=>s(c.id),onPin:()=>l(c.id)},c.id))})}):a.jsx("div",{className:"flex-1 overflow-y-auto",style:{padding:"8px 6px"},children:t.length===0?a.jsx("div",{style:{textAlign:"center",padding:"24px 12px",color:"rgba(255,255,255,0.2)",fontSize:10},children:"Grimoire vazio. Observacoes emergem durante a criacao."}):a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:t.map(c=>a.jsxs("div",{style:{padding:"6px 8px",borderRadius:4,background:"rgba(255,255,255,0.02)",borderLeft:`2px solid ${HS[c.type]}`},children:[a.jsxs("div",{style:{fontSize:7,color:"rgba(255,255,255,0.2)",marginBottom:2,fontFamily:"monospace"},children:[LH(c.timestamp),"  ",c.type]}),a.jsx("div",{style:{fontSize:9,color:HS[c.type],lineHeight:1.4},children:c.text})]},c.id))})})]})};function iG({entry:e,onRestore:t,onDelete:r,onFavorite:o,onPin:s}){const l=new Date(e.timestamp),i=`${l.getHours().toString().padStart(2,"0")}:${l.getMinutes().toString().padStart(2,"0")}`;return a.jsxs("div",{style:{border:"1px solid rgba(255,255,255,0.07)",borderRadius:4,background:e.pinned?"rgba(255,200,60,0.04)":"rgba(255,255,255,0.02)",overflow:"hidden"},children:[a.jsxs("div",{style:{display:"flex",gap:0},children:[a.jsx("button",{onClick:t,title:"Restaurar DNA e semente",style:{border:"none",padding:0,cursor:"pointer",flexShrink:0},children:a.jsx("img",{src:e.thumbnail,alt:"",style:{width:52,height:52,display:"block",objectFit:"cover"}})}),a.jsxs("div",{style:{flex:1,padding:"5px 7px",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[a.jsxs("div",{children:[a.jsx("div",{style:{fontSize:8,color:"rgba(255,255,255,0.25)",fontFamily:"monospace"},children:i}),e.dna.name&&a.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.6)",marginTop:1},children:e.dna.name}),a.jsx("div",{style:{display:"flex",gap:3,marginTop:3,flexWrap:"wrap"},children:e.dna.palette.map((u,c)=>a.jsx("div",{style:{width:10,height:10,borderRadius:2,background:u}},c))})]}),a.jsxs("div",{style:{display:"flex",gap:4,marginTop:4},children:[a.jsx("button",{onClick:o,style:{...Oy,color:e.favorite?"#f87171":"rgba(255,255,255,0.2)"},children:a.jsx(OC,{size:10,strokeWidth:1.5})}),a.jsx("button",{onClick:s,style:{...Oy,color:e.pinned?"#fbbf24":"rgba(255,255,255,0.2)"},children:a.jsx(LC,{size:10,strokeWidth:1.5})}),a.jsx("button",{onClick:r,style:{...Oy,color:"rgba(255,255,255,0.2)",marginLeft:"auto"},children:a.jsx(o0,{size:10,strokeWidth:1.5})})]})]})]}),e.gestures.length>0&&a.jsx("div",{style:{padding:"3px 7px",borderTop:"1px solid rgba(255,255,255,0.04)",fontSize:7,color:"rgba(255,255,255,0.2)",fontFamily:"monospace"},children:e.gestures.map(u=>u.toolId.replace("_"," ")).slice(0,5).join("  ")})]})}const Oy={background:"none",border:"none",cursor:"pointer",padding:0,display:"flex",alignItems:"center"};function lG(){const e=Iv(),[t,r]=w.useState({connected:!1,name:"",inputMode:"auto"}),o=w.useRef("auto");return w.useEffect(()=>{const l=u=>{r(c=>({...c,connected:!0,name:u.gamepad.id.slice(0,40)}))},i=()=>{r(u=>({...u,connected:!1,name:""}))};return window.addEventListener("gamepadconnected",l),window.addEventListener("gamepaddisconnected",i),()=>{window.removeEventListener("gamepadconnected",l),window.removeEventListener("gamepaddisconnected",i)}},[]),{manager:e,status:t,inputModeRef:o,setInputMode:l=>{o.current=l,r(i=>({...i,inputMode:l}))}}}function cG(e,t){return t==="mouse"?!1:t==="controller"?e.connected:e.connected&&(Math.abs(e.axes.lx)>.05||Math.abs(e.axes.ly)>.05||e.triggers.rt>.05||e.triggers.lt>.05||Object.values(e.buttons).some(Boolean))}const dG=({cursorRef:e,color:t="rgba(80,230,140,0.92)"})=>a.jsxs("div",{ref:e,style:{position:"absolute",pointerEvents:"none",display:"none",transform:"translate(-50%, -50%)",zIndex:50},children:[a.jsx("div",{style:{position:"absolute",width:28,height:28,left:-14,top:-14,borderRadius:"50%",border:`1px solid ${t}`,opacity:.6}}),a.jsx("div",{style:{position:"absolute",left:-10,top:-.5,width:20,height:1,background:t}}),a.jsx("div",{style:{position:"absolute",top:-10,left:-.5,height:20,width:1,background:t}}),a.jsx("div",{style:{position:"absolute",width:4,height:4,left:-2,top:-2,borderRadius:"50%",background:t}})]});function l5(){return{mode:"fluid",macroStructure:0,macroGesture:.28,macroContrast:.5,macroSilence:0,macroAtmosphere:0,macroCollage:0,snapAxes:0,gridStrength:0,gridSize:40,lineMastery:0,planeCasting:0,cutWindows:0,mixPoint:.3,mixLine:.3,mixRect:.2,mixArc:.1,mixPlane:.1,shapeOpacity:.85,fillSolidity:.35,strokeWeight:1,shapeScale:1,rotationDrift:0,vignetteStr:0,grainStr:0,bloomShape:0,zDepth:1,orbitSpeed:.2,camFOV:55,depthFog:.3,light3D:.5,particleSize3D:1,glowIntensity3D:.55,waveZ:.3,showGeoShapes:!0,solidShapes3D:!1,shapeGravity:0,angleDamping:0,boundaryMode:"wrap",showBorder:!1,trails3D:!1,trailLength3D:3}}function Eu(e){e.snapAxes=Math.min(1,e.macroStructure*1.2),e.gridStrength=Math.min(1,e.macroStructure*.9),e.lineMastery=Math.min(1,e.macroStructure*.7+e.macroContrast*.3),e.planeCasting=Math.min(1,e.macroCollage*.8+e.macroSilence*.2),e.cutWindows=Math.min(1,e.macroCollage*.6)}function kf(e,t){const r=e.length;if(r===0)return;const o=Math.max(0,Math.min(8,Math.round(t.macroAtmosphere*6))),s=t.mixPoint+t.mixLine+t.mixRect+t.mixArc+t.mixPlane,l=s>0?s:1,i=t.mixPoint/l,u=i+t.mixLine/l,c=u+t.mixRect/l,d=c+t.mixArc/l,h=r-o;for(let f=0;f<r;f++){const g=e[f];if(f<o){g.kind="gradientEmitter",g.qscale===void 0&&(g.qscale=1.5+Math.random()*2.5);continue}const m=h>0?(f-o)/h:0;let y;m<i?y="point":m<u?y="line":m<c?y="rect":m<d?y="arc":y="plane",g.kind=y,g.angle===void 0&&(g.angle=Math.atan2(g.vy,g.vx)+(Math.random()-.5)*.3),g.qscale===void 0&&(g.qscale=1.2+Math.random()*2),y==="line"&&g.length===void 0&&(g.length=30+Math.random()*80),y==="arc"&&g.length===void 0&&(g.length=16+Math.random()*40),y==="rect"&&g.thickness===void 0&&(g.thickness=1+Math.random()*2),y==="plane"&&g.fillAlpha===void 0&&(g.fillAlpha=.25+Math.random()*.25),y==="rect"&&g.fillAlpha===void 0&&(g.fillAlpha=0)}}function uG(e){for(const t of e)t.kind=void 0,t.angle=void 0,t.qscale=void 0,t.length=void 0,t.thickness=void 0,t.fillAlpha=void 0,t.qBlend=void 0}function hG(e,t,r,o){const s=t.snapAxes*.12,l=t.gridStrength*.08,i=t.gridSize/Math.max(r,o),u=t.macroSilence*.004,c=(t.rotationDrift??0)*8e-4,d=t.macroGesture??.5,h=.012+d*.055,f=d*.0012,g=t.angleDamping??0,m=h*(1-g*.85),y=(t.shapeGravity??0)*6e-4;for(const v of e){const b=v.kind;if(b==="line"||b==="rect"||b==="arc"||b==="plane"){if(Math.sqrt(v.vx*v.vx+v.vy*v.vy)>5e-5){const C=Math.atan2(v.vy,v.vx),k=v.angle??0;let R=C-k;for(;R>Math.PI;)R-=Math.PI*2;for(;R<-Math.PI;)R+=Math.PI*2;v.angle=k+R*m}c>0&&(v.angle=(v.angle??0)+c*(v.species%2===0?1:-1))}if(f>1e-4&&b!=="gradientEmitter"&&b!=="point"&&b!==void 0&&(v.vx+=(Math.random()-.5)*f,v.vy+=(Math.random()-.5)*f),y>1e-5&&b!=="gradientEmitter"){const S=.5-v.x,C=.5-v.y;v.vx+=S*y,v.vy+=C*y}if(s>.001&&(b==="line"||b==="rect")){const C=((v.angle??0)%Math.PI+Math.PI)%Math.PI,k=[0,Math.PI/4,Math.PI/2,Math.PI*3/4];let R=0,j=1/0;for(const _ of k){const P=Math.abs(C-_);P<j&&(j=P,R=_)}const T=R-C;v.angle=(v.angle??0)+T*s}if(l>.001&&i>.001&&(b==="rect"||b==="plane")){const S=Math.round(v.x/i)*i,C=Math.round(v.y/i)*i;v.vx+=(S-v.x)*l*.3,v.vy+=(C-v.y)*l*.3}if(u>0&&b!=="gradientEmitter"){const S=v.x-.5,C=v.y-.5,k=Math.sqrt(S*S+C*C)+.001;v.vx+=S/k*u,v.vy+=C/k*u}if(b==="line"&&t.lineMastery>.1){const S=40+t.lineMastery*140,C=v.length??30;C<S&&(v.length=C+t.lineMastery*.4)}}}function fG(e,t,r,o,s){const i=e.length;if(i===0)return;const u=s*80%i;if(t.planeCasting>.15){let c=0;for(let d=0;d<Math.min(80,i);d++){const h=e[(u+d)%i];if(h.kind==="rect"&&h.age>300&&Math.random()<t.planeCasting*.03&&(h.kind="plane",h.fillAlpha=(h.fillAlpha??.06)+.02,h.qBlend=t.macroCollage>.5?"multiply":"screen",c++,c>=2))break}}if(t.cutWindows>.1&&s%120===0){let c=0;for(let d=0;d<i&&c<2;d++){const h=e[(u+d)%i];h.kind==="plane"&&Math.random()<t.cutWindows*.15&&(h.kind="rect",c++)}}if(t.lineMastery>.3){let c=0;for(let d=0;d<i&&c<4;d++){const h=e[(u+d)%i];if(h.kind==="line"&&h.age>200){const f=60+t.lineMastery*180;(h.length??0)<f&&(h.length=(h.length??20)+t.lineMastery*1.2),c++}}}}const pG={constructive_score:{mode:"geometric",macroStructure:.92,macroGesture:.35,macroContrast:.95,macroSilence:.6,macroAtmosphere:0,macroCollage:.1,snapAxes:.95,gridStrength:.85,gridSize:48,lineMastery:.95,planeCasting:.05,cutWindows:0,mixPoint:.02,mixLine:.8,mixRect:.12,mixArc:.04,mixPlane:.02,shapeOpacity:.92,fillSolidity:.15,strokeWeight:1.8,shapeScale:1.2,rotationDrift:0,vignetteStr:.25,grainStr:.05,bloomShape:0,zDepth:1,orbitSpeed:.2,camFOV:55,depthFog:.3,light3D:.5,particleSize3D:1,glowIntensity3D:.55,waveZ:.3},geometric_orchestra:{mode:"hybrid",macroStructure:.3,macroGesture:.7,macroContrast:.85,macroSilence:.1,macroAtmosphere:.2,macroCollage:.15,snapAxes:.2,gridStrength:.1,gridSize:32,lineMastery:.2,planeCasting:.1,cutWindows:.05,mixPoint:.08,mixLine:.1,mixRect:.08,mixArc:.7,mixPlane:.04,shapeOpacity:.8,fillSolidity:.5,strokeWeight:1.3,shapeScale:1.1,rotationDrift:.3,vignetteStr:.15,grainStr:0,bloomShape:.35,zDepth:1,orbitSpeed:.2,camFOV:55,depthFog:.3,light3D:.5,particleSize3D:1,glowIntensity3D:.55,waveZ:.3},analytical_collage:{mode:"geometric",macroStructure:.55,macroGesture:.2,macroContrast:.9,macroSilence:.55,macroAtmosphere:0,macroCollage:.95,snapAxes:.6,gridStrength:.7,gridSize:64,lineMastery:.1,planeCasting:.9,cutWindows:.7,mixPoint:.02,mixLine:.05,mixRect:.28,mixArc:.02,mixPlane:.63,shapeOpacity:.88,fillSolidity:.75,strokeWeight:.8,shapeScale:1.4,rotationDrift:0,vignetteStr:.4,grainStr:.2,bloomShape:0,zDepth:1,orbitSpeed:.2,camFOV:55,depthFog:.3,light3D:.5,particleSize3D:1,glowIntensity3D:.55,waveZ:.3},spiritual_geometry:{mode:"geometric",macroStructure:.25,macroGesture:.15,macroContrast:.8,macroSilence:.8,macroAtmosphere:.3,macroCollage:.1,snapAxes:.15,gridStrength:.05,gridSize:80,lineMastery:.3,planeCasting:.05,cutWindows:0,mixPoint:.6,mixLine:.05,mixRect:.05,mixArc:.28,mixPlane:.02,shapeOpacity:.75,fillSolidity:.6,strokeWeight:1,shapeScale:.9,rotationDrift:.5,vignetteStr:.55,grainStr:.1,bloomShape:.45,zDepth:1,orbitSpeed:.2,camFOV:55,depthFog:.3,light3D:.5,particleSize3D:1,glowIntensity3D:.55,waveZ:.3},nebula_drift:{mode:"3d",macroStructure:.05,macroGesture:.65,macroContrast:.7,macroSilence:.2,macroAtmosphere:.8,macroCollage:0,snapAxes:0,gridStrength:0,gridSize:40,lineMastery:0,planeCasting:0,cutWindows:0,mixPoint:.8,mixLine:.1,mixRect:0,mixArc:.1,mixPlane:0,shapeOpacity:.85,fillSolidity:.35,strokeWeight:1,shapeScale:1,rotationDrift:0,vignetteStr:0,grainStr:0,bloomShape:0,zDepth:1.6,orbitSpeed:.15,camFOV:55,depthFog:.55,light3D:.45,particleSize3D:1.1,glowIntensity3D:.8,waveZ:.55},crystal_lattice:{mode:"3d",macroStructure:.88,macroGesture:.2,macroContrast:.95,macroSilence:.55,macroAtmosphere:.25,macroCollage:0,snapAxes:.9,gridStrength:.85,gridSize:48,lineMastery:.9,planeCasting:0,cutWindows:0,mixPoint:.05,mixLine:.85,mixRect:.05,mixArc:.05,mixPlane:0,shapeOpacity:.92,fillSolidity:.15,strokeWeight:1.6,shapeScale:1.1,rotationDrift:0,vignetteStr:0,grainStr:0,bloomShape:0,zDepth:.85,orbitSpeed:.08,camFOV:48,depthFog:.2,light3D:.8,particleSize3D:.85,glowIntensity3D:.4,waveZ:.12},void_bloom:{mode:"3d",macroStructure:0,macroGesture:.9,macroContrast:1,macroSilence:0,macroAtmosphere:.9,macroCollage:0,snapAxes:0,gridStrength:0,gridSize:40,lineMastery:0,planeCasting:0,cutWindows:0,mixPoint:.95,mixLine:.05,mixRect:0,mixArc:0,mixPlane:0,shapeOpacity:1,fillSolidity:.35,strokeWeight:1,shapeScale:1.3,rotationDrift:0,vignetteStr:0,grainStr:0,bloomShape:0,zDepth:2,orbitSpeed:.45,camFOV:65,depthFog:.7,light3D:.6,particleSize3D:1.3,glowIntensity3D:.95,waveZ:.75},solar_wind:{mode:"3d",macroStructure:.15,macroGesture:.95,macroContrast:.85,macroSilence:.05,macroAtmosphere:.5,macroCollage:0,snapAxes:0,gridStrength:0,gridSize:40,lineMastery:.25,planeCasting:0,cutWindows:0,mixPoint:.3,mixLine:.25,mixRect:0,mixArc:.45,mixPlane:0,shapeOpacity:.88,fillSolidity:.4,strokeWeight:1.2,shapeScale:1,rotationDrift:.3,vignetteStr:0,grainStr:0,bloomShape:0,zDepth:1.2,orbitSpeed:.3,camFOV:58,depthFog:.35,light3D:.65,particleSize3D:.9,glowIntensity3D:.65,waveZ:.4},quantum_foam:{mode:"3d",macroStructure:0,macroGesture:1,macroContrast:1,macroSilence:0,macroAtmosphere:.85,macroCollage:0,snapAxes:0,gridStrength:0,gridSize:40,lineMastery:0,planeCasting:0,cutWindows:0,mixPoint:.7,mixLine:.2,mixRect:0,mixArc:.1,mixPlane:0,shapeOpacity:1,fillSolidity:.35,strokeWeight:1,shapeScale:.75,rotationDrift:0,vignetteStr:0,grainStr:0,bloomShape:0,zDepth:1.9,orbitSpeed:.6,camFOV:72,depthFog:.72,light3D:.5,particleSize3D:.65,glowIntensity3D:1,waveZ:.95},deep_field:{mode:"3d",macroStructure:.05,macroGesture:.18,macroContrast:.75,macroSilence:.6,macroAtmosphere:.35,macroCollage:0,snapAxes:0,gridStrength:0,gridSize:40,lineMastery:0,planeCasting:0,cutWindows:0,mixPoint:.92,mixLine:.04,mixRect:0,mixArc:.04,mixPlane:0,shapeOpacity:.8,fillSolidity:.35,strokeWeight:1,shapeScale:.7,rotationDrift:0,vignetteStr:0,grainStr:0,bloomShape:0,zDepth:1.4,orbitSpeed:.05,camFOV:42,depthFog:.5,light3D:.35,particleSize3D:.72,glowIntensity3D:.55,waveZ:.18},rhizome_3d:{mode:"3d",macroStructure:.7,macroGesture:.8,macroContrast:.9,macroSilence:.3,macroAtmosphere:.45,macroCollage:0,snapAxes:.6,gridStrength:.3,gridSize:40,lineMastery:.85,planeCasting:0,cutWindows:0,mixPoint:.1,mixLine:.85,mixRect:0,mixArc:.05,mixPlane:0,shapeOpacity:.92,fillSolidity:.35,strokeWeight:1.5,shapeScale:1,rotationDrift:0,vignetteStr:0,grainStr:0,bloomShape:0,zDepth:.75,orbitSpeed:.12,camFOV:52,depthFog:.15,light3D:.7,particleSize3D:.65,glowIntensity3D:.6,waveZ:.08,trails3D:!0,trailLength3D:6,showGeoShapes:!0,solidShapes3D:!1}};function Y0(e,t,r){const o=e[t];return typeof o=="number"&&isFinite(o)?o:r}function mG(e,t,r,o,s,l){if(r.macroAtmosphere<.02)return;const i=t.filter(c=>c.kind==="gradientEmitter");if(i.length===0)return;const u=.04+r.macroAtmosphere*.09;for(const c of i){const d=c.x*s,h=c.y*l,f=Math.max(40,(c.qscale??1.5)*55*r.macroAtmosphere),g=o[c.species%o.length]??"#ffffff",m=e.createRadialGradient(d,h,0,d,h,f);m.addColorStop(0,_y(g,u)),m.addColorStop(.5,_y(g,u*.4)),m.addColorStop(1,_y(g,0)),e.globalCompositeOperation="source-over",e.fillStyle=m,e.beginPath(),e.arc(d,h,f,0,Math.PI*2),e.fill()}e.globalAlpha=1,e.globalCompositeOperation="source-over"}function GS(e,t,r,o,s,l,i){e.save();const u=Math.max(.25,o.macroContrast),c=o.macroSilence,d=Y0(o,"shapeOpacity",.85),h=Y0(o,"fillSolidity",.35),f=Y0(o,"strokeWeight",1),g=Y0(o,"shapeScale",1),m=d*(.6+u*.38),y=d*h*(.28+u*.5),{symmetry:v}=r.genes,b=MG(v),S=s/2,C=l/2,k={gradientEmitter:-1,mask:-1,plane:0,rect:1,arc:2,line:3,point:4},R=[...t].sort((P,I)=>(k[P.kind??"point"]??4)-(k[I.kind??"point"]??4));for(const P of R){const I=P.kind??"point";if(I==="gradientEmitter"||I==="mask")continue;const $=P.x*s,q=P.y*l,L=`hsl(${P.hue.toFixed(0)},${Math.min(100,P.sat*100).toFixed(0)}%,${Math.min(85,P.lit*100).toFixed(0)}%)`;if(!(c>.5&&Math.random()<c*.3))for(let H=0;H<b;H++){let G=$,oe=q;if(b>1){const le=H/b*Math.PI*2,pe=Math.cos(le),ce=Math.sin(le),te=$-S,F=q-C;G=S+te*pe-F*ce,oe=C+te*ce+F*pe}switch(I){case"point":gG(e,G,oe,P,L,m,y,s,g,f);break;case"line":yG(e,G,oe,P,L,m,g,f);break;case"arc":xG(e,G,oe,P,L,m,y,i,g,f);break;case"rect":bG(e,G,oe,P,L,m,y,g,f);break;case"plane":vG(e,G,oe,P,L,y,g);break}}}e.restore();const j=Y0(o,"bloomShape",0),T=Y0(o,"grainStr",0),_=Y0(o,"vignetteStr",0);j>.05&&SG(e,s,l,j),_>.02&&wG(e,s,l,_),T>.02&&CG(e,s,l,T,i)}function gG(e,t,r,o,s,l,i,u,c,d){const h=Math.max(2.5,o.size*(o.qscale??1)*(u/800)*c),f=o.species%5;switch(e.beginPath(),f){case 0:e.arc(t,r,h,0,Math.PI*2),e.globalAlpha=l,e.fillStyle=s,e.fill();break;case 1:e.globalAlpha=l,e.fillStyle=s,e.fillRect(t-h,r-h,h*2,h*2);break;case 2:e.moveTo(t,r-h*1.4),e.lineTo(t+h,r),e.lineTo(t,r+h*1.4),e.lineTo(t-h,r),e.closePath(),e.globalAlpha=i,e.fillStyle=s,e.fill(),e.globalAlpha=l,e.strokeStyle=s,e.lineWidth=Math.max(1.2,1*d),e.stroke();break;case 3:e.strokeStyle=s,e.lineWidth=Math.max(1.2,h*.6*d),e.lineCap="round",e.globalAlpha=l,e.moveTo(t-h,r),e.lineTo(t+h,r),e.moveTo(t,r-h),e.lineTo(t,r+h),e.stroke();break;case 4:e.moveTo(t,r-h*1.3),e.lineTo(t+h*1.1,r+h*.8),e.lineTo(t-h*1.1,r+h*.8),e.closePath(),e.globalAlpha=i,e.fillStyle=s,e.fill(),e.globalAlpha=l,e.strokeStyle=s,e.lineWidth=Math.max(1,.9*d),e.stroke();break}}function yG(e,t,r,o,s,l,i,u){const c=o.angle??0,h=Math.max(12,(o.length??40)*(o.qscale??1)*i)/2,f=Math.cos(c),g=Math.sin(c),m=Math.max(1.2,(o.thickness??1.5)*(o.qscale??1)*u);e.globalAlpha=l,e.strokeStyle=s,e.lineWidth=m,e.lineCap="round",e.globalCompositeOperation="source-over",e.beginPath(),e.moveTo(t-f*h,r-g*h),e.lineTo(t+f*h,r+g*h),e.stroke()}function xG(e,t,r,o,s,l,i,u,c,d){const h=Math.max(6,(o.length??22)*(o.qscale??1)*c),f=(o.age*.009+o.charge*.5)%(Math.PI*2),g=Math.PI*(.5+o.mood*1.2),m=f,y=f+g;e.globalAlpha=l,e.strokeStyle=s,e.lineWidth=Math.max(1.2,(o.thickness??1.8)*(o.qscale??1)*d),e.lineCap="round",e.globalCompositeOperation="source-over",e.beginPath(),e.arc(t,r,h,m,y),e.stroke(),i>.05&&g>=Math.PI&&(e.globalAlpha=i*.5,e.fillStyle=s,e.beginPath(),e.arc(t,r,h,m,y),e.closePath(),e.fill())}function bG(e,t,r,o,s,l,i,u,c){const d=Math.max(6,o.size*(o.qscale??1)*5*u),h=o.angle??0,f=Math.max(1,(o.thickness??1.5)*c),g=d,m=Math.max(4,d*(.45+o.mood*.75));e.save(),e.translate(t,r),e.rotate(h),i>.02&&(e.globalAlpha=i,e.fillStyle=s,e.fillRect(-g/2,-m/2,g,m)),e.globalAlpha=l,e.strokeStyle=s,e.lineWidth=f,e.globalCompositeOperation="source-over",e.strokeRect(-g/2,-m/2,g,m),e.restore()}function vG(e,t,r,o,s,l,i){const u=Math.max(24,o.size*(o.qscale??1)*20*i),c=Math.max(16,u*(.4+o.mood*.9)),d=o.angle??0;e.save(),e.translate(t,r),e.rotate(d);const h=Math.min(.92,l*1.6+.15);e.globalAlpha=h,e.fillStyle=s,e.globalCompositeOperation="source-over",e.fillRect(-u/2,-c/2,u,c),e.globalAlpha=Math.min(.85,h*.9),e.strokeStyle=s,e.lineWidth=.9,e.strokeRect(-u/2,-c/2,u,c),e.restore()}function SG(e,t,r,o){const s=document.createElement("canvas");s.width=t,s.height=r,s.getContext("2d").drawImage(e.canvas,0,0);const i=Math.round(4+o*18);e.save(),e.filter=`blur(${i}px)`,e.globalCompositeOperation="screen",e.globalAlpha=o*.55,e.drawImage(s,0,0),e.filter="none",e.restore()}function wG(e,t,r,o){const s=t/2,l=r/2,i=Math.sqrt(s*s+l*l),u=e.createRadialGradient(s,l,i*.25,s,l,i);u.addColorStop(0,"rgba(0,0,0,0)"),u.addColorStop(1,`rgba(0,0,0,${(o*.75).toFixed(3)})`),e.save(),e.globalCompositeOperation="source-over",e.globalAlpha=1,e.fillStyle=u,e.fillRect(0,0,t,r),e.restore()}function CG(e,t,r,o,s){if(s%2!==0)return;const l=s*1234567,i=Math.ceil(t/4),u=Math.ceil(r/4),c=o*.18;e.save(),e.globalCompositeOperation="source-over";for(let d=0;d<u;d++)for(let h=0;h<i;h++){let f=h*73856093^d*19349663^l;f=(f>>16^f)*73244475,f=f>>16^f;const g=(f&255)/255;g>.5&&(e.globalAlpha=c*(g-.5)*2,e.fillStyle=g>.75?"rgba(255,255,255,1)":"rgba(0,0,0,1)",e.fillRect(h*4,d*4,4,4))}e.restore()}function MG(e){return e<.28?1:e<.5?2:e<.66?4:e<.82?6:8}function _y(e,t){const r=e.replace("#","");if(r.length<6)return`rgba(128,128,128,${t.toFixed(4)})`;const s=parseInt(r.slice(0,2),16),l=parseInt(r.slice(2,4),16),i=parseInt(r.slice(4,6),16);return`rgba(${s},${l},${i},${t.toFixed(4)})`}function kG(e,t,r,o){const s=1/Math.tan(e*Math.PI/360),l=1/(r-o),i=new Float32Array(16);return i[0]=s/t,i[5]=s,i[10]=(o+r)*l,i[11]=-1,i[14]=2*o*r*l,i}function RG(e,t,r,o,s,l){let i=o-e,u=s-t,c=l-r;const d=Math.sqrt(i*i+u*u+c*c)||1;i/=d,u/=d,c/=d;let h=-c,f=0,g=i;const m=Math.sqrt(h*h+g*g)||1;h/=m,g/=m;const y=f*c-g*u,v=g*i-h*c,b=h*u-f*i,S=new Float32Array(16);return S[0]=h,S[1]=y,S[2]=-i,S[4]=f,S[5]=v,S[6]=-u,S[8]=g,S[9]=b,S[10]=-c,S[12]=-(h*e+f*t+g*r),S[13]=-(y*e+v*t+b*r),S[14]=i*e+u*t+c*r,S[15]=1,S}function AG(e,t){const r=new Float32Array(16);for(let o=0;o<4;o++)for(let s=0;s<4;s++){let l=0;for(let i=0;i<4;i++)l+=e[i*4+o]*t[s*4+i];r[s*4+o]=l}return r}const VS=`
attribute vec3  a_pos;
attribute vec4  a_color;
attribute float a_size;
uniform   mat4  u_mvp;
uniform   float u_ptScale;
uniform   float u_alphaScale;
varying   vec4  v_color;
void main() {
  vec4 clip    = u_mvp * vec4(a_pos, 1.0);
  gl_Position  = clip;
  float w      = max(0.12, clip.w);
  gl_PointSize = max(1.0, u_ptScale * a_size / w);
  v_color      = vec4(a_color.rgb, a_color.a * u_alphaScale);
}`,jG=`
precision mediump float;
varying vec4 v_color;
void main() {
  vec2  c  = gl_PointCoord - 0.5;
  float r2 = dot(c, c) * 4.0;
  float a  = exp(-r2 * 2.6);
  if (a < 0.005) discard;
  gl_FragColor = vec4(v_color.rgb, v_color.a * a);
}`,EG=`
precision mediump float;
varying vec4 v_color;
void main() {
  vec2  c = gl_PointCoord - 0.5;
  float r = length(c) * 2.0;
  float a = 1.0 - smoothstep(0.55, 1.0, r);
  if (a < 0.01) discard;
  gl_FragColor = vec4(v_color.rgb, v_color.a * a);
}`,TG=`
attribute vec3 a_pos;
attribute vec4 a_color;
uniform   mat4 u_mvp;
varying   vec4 v_color;
void main() {
  gl_Position = u_mvp * vec4(a_pos, 1.0);
  v_color     = a_color;
}`,IG=`
precision mediump float;
varying vec4 v_color;
void main() { gl_FragColor = v_color; }`,H5=8,Gs=7,pb=7,US=4096,Fd=32e3,mb=14e3,Jc=12,PG=2500;class FG{constructor(t){this.gl=null,this.glowB=null,this.crispB=null,this.lineB=null,this.ptBuf=null,this.lnBuf=null,this.triBuf=null,this.ptData=new Float32Array(US*H5),this.lnData=new Float32Array(Fd*Gs),this.triData=new Float32Array(mb*pb),this.theta=.4,this.phi=.22,this.radius=2.9,this.tTheta=.4,this.tPhi=.22,this.tRadius=2.9,this.lastW=0,this.lastH=0,this.dragging=!1,this.dragX=0,this.dragY=0,this.twoFingerDist=0,this._dragEndTime=0,this.canvas=t,this._md=u=>{u.button===0&&(this.dragging=!0,this.dragX=u.clientX,this.dragY=u.clientY,u.preventDefault())},this._mm=u=>{if(!this.dragging)return;const c=u.clientX-this.dragX,d=u.clientY-this.dragY;this.dragX=u.clientX,this.dragY=u.clientY,this.tTheta-=c*.006,this.tPhi=XS(this.tPhi+d*.005)},this._mu=()=>{this.dragging=!1,this._dragEndTime=performance.now()},this._mw=u=>{const c=u.deltaY>0?1.12:.89;this.tRadius=Wf(this.tRadius*c,.6,9),u.preventDefault()},this._dd=u=>{u.preventDefault(),this.resetCamera()},this._ts=u=>{u.touches.length===1?(this.dragging=!0,this.dragX=u.touches[0].clientX,this.dragY=u.touches[0].clientY):u.touches.length===2&&(this.twoFingerDist=ZS(u))},this._tm=u=>{if(u.touches.length===1&&this.dragging){const c=u.touches[0].clientX-this.dragX,d=u.touches[0].clientY-this.dragY;this.dragX=u.touches[0].clientX,this.dragY=u.touches[0].clientY,this.tTheta-=c*.006,this.tPhi=XS(this.tPhi+d*.005)}else if(u.touches.length===2&&this.twoFingerDist>0){const c=ZS(u),d=this.twoFingerDist/Math.max(1,c);this.tRadius=Wf(this.tRadius*(.5+d*.5),.6,9),this.twoFingerDist=c}u.preventDefault()},this._te=()=>{this.dragging=!1,this._dragEndTime=performance.now(),this.twoFingerDist=0};const r=t.getContext("webgl",{alpha:!0,antialias:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0});if(!r){console.warn("[MetaArt3D] WebGL unavailable");return}this.gl=r;const o=["u_mvp","u_ptScale","u_alphaScale"],s=["a_pos","a_color","a_size"],l=["u_mvp"],i=["a_pos","a_color"];this.glowB=Dy(r,VS,jG,o,s),this.crispB=Dy(r,VS,EG,o,s),this.lineB=Dy(r,TG,IG,l,i),this.ptBuf=r.createBuffer(),this.lnBuf=r.createBuffer(),this.triBuf=r.createBuffer()}get isReady(){return!!(this.gl&&this.glowB&&this.crispB&&this.lineB)}resetCamera(){this.tTheta=.4,this.tPhi=.22,this.tRadius=2.9}attachHandlers(){const t=this.canvas;t.addEventListener("mousedown",this._md,{passive:!1}),t.addEventListener("mousemove",this._mm),t.addEventListener("mouseup",this._mu),t.addEventListener("mouseleave",this._mu),t.addEventListener("wheel",this._mw,{passive:!1}),t.addEventListener("dblclick",this._dd,{passive:!1}),t.addEventListener("touchstart",this._ts,{passive:!1}),t.addEventListener("touchmove",this._tm,{passive:!1}),t.addEventListener("touchend",this._te)}detachHandlers(){const t=this.canvas;t.removeEventListener("mousedown",this._md),t.removeEventListener("mousemove",this._mm),t.removeEventListener("mouseup",this._mu),t.removeEventListener("mouseleave",this._mu),t.removeEventListener("wheel",this._mw),t.removeEventListener("dblclick",this._dd),t.removeEventListener("touchstart",this._ts),t.removeEventListener("touchmove",this._tm),t.removeEventListener("touchend",this._te)}resize(t,r){if(t===this.lastW&&r===this.lastH)return;this.lastW=t,this.lastH=r;const o=Math.min(window.devicePixelRatio||1,2);this.canvas.width=Math.round(t*o),this.canvas.height=Math.round(r*o),this.gl&&this.gl.viewport(0,0,this.canvas.width,this.canvas.height)}render(t,r,o,s,l,i,u){const c=this.gl;if(!c||!this.isReady||!this.ptBuf||!this.lnBuf||!this.triBuf)return;const d=this.canvas.width,h=this.canvas.height;if(d===0||h===0)return;const f=this.glowB,g=this.crispB,m=this.lineB,y=(o.orbitSpeed??.2)*.0014;this.dragging||(this._dragEndTime===0||performance.now()-this._dragEndTime>PG)&&(this.tTheta+=y),this.theta+=(this.tTheta-this.theta)*.07,this.phi+=(this.tPhi-this.phi)*.06,this.radius+=(this.tRadius-this.radius)*.05;const v=o.camFOV??55,b=Math.cos(this.phi),S=this.radius*b*Math.sin(this.theta),C=this.radius*Math.sin(this.phi),k=this.radius*b*Math.cos(this.theta),R=RG(S,C,k,0,0,0),j=kG(v,d/h,.05,30),T=AG(j,R),[_,P,I]=LG(r.background??"#060608");c.clearColor(_*.35,P*.35,I*.45,1),c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT),c.disable(c.DEPTH_TEST),c.enable(c.BLEND);const $=r.genes.contrast??.5,q=r.genes.rhythm??.3,L=r.genes.entropy??.3,H=r.genes.fragmentation??.3,G=r.genes.memory??.5,oe=(r.genes.linear??0)>.4,le=r.genes.linear??0,pe=o.zDepth??1,ce=o.waveZ??.3,te=o.depthFog??.3,F=o.light3D??.5,Q=o.particleSize3D??1,ae=h*.026*Q,we=Math.max(0,te-.25)*1.6,Re=Math.min(t.length,US);let ge=0;for(let dt=0;dt<Re;dt++){const Rt=t[dt],Wt=(Rt.x-.5)*2.2,Zt=(Rt.y-.5)*-2.2,$e=Rh(Rt,pe,ce,i),Ze=Math.abs($e)/Math.max(.1,pe),Fe=1-te*Math.min(1,Ze);let Xe=Rt.lit;$>.3&&(Xe=.5+(Rt.lit-.5)*(1+$*1.5),Xe=Math.max(.05,Math.min(.95,Xe)));const jt=1+F*(.5-Ze*.4);let[hn,an,it]=Ah(Rt.hue,Rt.sat,Xe);hn=Math.min(1,hn*jt),an=Math.min(1,an*jt),it=Math.min(1,it*jt);const kt=Fe*Math.min(1,Rt.ink*2.8+.4),On=Math.abs($e),sn=1+we*On*.9,Xn=1/(1+we*On*.55),Pt=q>.2?1+.35*q*Math.sin(i*.06*q+Rt.hue*.1):1,zt=L>.15?1+((Rt.age*7+13)%17/17-.5)*L*.7:1,jn=H>.5?Rt.species%2===0?.55:1.45:1,En=Math.max(1.5,Rt.size*(Rt.qscale??1)*2*sn*Pt*zt*jn),lt=kt*Xn,ht=ge*H5;this.ptData[ht]=Wt,this.ptData[ht+1]=Zt,this.ptData[ht+2]=$e,this.ptData[ht+3]=hn,this.ptData[ht+4]=an,this.ptData[ht+5]=it,this.ptData[ht+6]=lt,this.ptData[ht+7]=En,ge++}if(c.bindBuffer(c.ARRAY_BUFFER,this.ptBuf),c.bufferData(c.ARRAY_BUFFER,this.ptData.subarray(0,ge*H5),c.DYNAMIC_DRAW),o.solidShapes3D){const dt=DG(t,Re,pe,ce,i,s,o,this.triData);dt>0&&(c.bindBuffer(c.ARRAY_BUFFER,this.triBuf),c.bufferData(c.ARRAY_BUFFER,this.triData.subarray(0,dt*pb),c.DYNAMIC_DRAW),c.blendFunc(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA),c.useProgram(m.prog),c.uniformMatrix4fv(m.u.u_mvp,!1,T),YS(c,m),c.drawArrays(c.TRIANGLES,0,dt))}const Ae=o.glowIntensity3D??.5,tt=u?u.glow:Ae>.01,We=u!=null&&u.glow?Math.max(.3,Ae):Ae;tt&&We>.01&&(c.blendFunc(c.SRC_ALPHA,c.ONE),c.useProgram(f.prog),c.uniformMatrix4fv(f.u.u_mvp,!1,T),c.uniform1f(f.u.u_ptScale,ae*3.6),c.uniform1f(f.u.u_alphaScale,We*.055),Ly(c,f),c.drawArrays(c.POINTS,0,ge),c.uniform1f(f.u.u_ptScale,ae*2),c.uniform1f(f.u.u_alphaScale,We*.18),Ly(c,f),c.drawArrays(c.POINTS,0,ge)),c.blendFunc(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA),c.useProgram(g.prog),c.uniformMatrix4fv(g.u.u_mvp,!1,T),c.uniform1f(g.u.u_ptScale,ae),c.uniform1f(g.u.u_alphaScale,1),Ly(c,g),c.drawArrays(c.POINTS,0,ge);let J=0;const Le=(u?u.connections:!1)?Math.max(.4,Wf((o.macroAtmosphere??0)*.55+We*.35,0,.85)):Wf((o.macroAtmosphere??0)*.55+(o.glowIntensity3D??.5)*.35,0,.85);Le>.02&&Re>2&&(J=OG(t,Re,pe,ce,i,Le,this.lnData));const K=o.trails3D??!1,et=o.trailLength3D??3;if((K||oe)&&(J=KS(t,Re,pe,ce,i,r,oe?6:et,oe,le,J,this.lnData)),!K&&!oe&&G>.55){const dt=Math.round(1+(G-.55)*10);J=KS(t,Re,pe,ce,i,r,dt,!1,le,J,this.lnData)}o.showGeoShapes!==!1&&(J=_G(t,Re,pe,ce,i,s,o,J,this.lnData)),J>1&&(c.bindBuffer(c.ARRAY_BUFFER,this.lnBuf),c.bufferData(c.ARRAY_BUFFER,this.lnData.subarray(0,J*Gs),c.DYNAMIC_DRAW),c.blendFunc(c.SRC_ALPHA,c.ONE),c.useProgram(m.prog),c.uniformMatrix4fv(m.u.u_mvp,!1,T),YS(c,m),c.drawArrays(c.LINES,0,J)),c.blendFunc(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA),c.flush()}dispose(){const t=this.gl;t&&([this.ptBuf,this.lnBuf,this.triBuf].forEach(r=>r&&t.deleteBuffer(r)),[this.glowB,this.crispB,this.lineB].forEach(r=>{r&&t.deleteProgram(r.prog)}),this.gl=null)}}function Dy(e,t,r,o,s){const l=NG(e,t,r);if(!l)return null;const i={};for(const c of o)i[c]=e.getUniformLocation(l,c);const u={};for(const c of s)u[c]=e.getAttribLocation(l,c);return{prog:l,u:i,a:u}}function NG(e,t,r){const o=(u,c)=>{const d=e.createShader(u);return e.shaderSource(d,c),e.compileShader(d),e.getShaderParameter(d,e.COMPILE_STATUS)?d:(console.error("[MetaArt3D] Shader error:",e.getShaderInfoLog(d)),null)},s=o(e.VERTEX_SHADER,t),l=o(e.FRAGMENT_SHADER,r);if(!s||!l)return null;const i=e.createProgram();return e.attachShader(i,s),e.attachShader(i,l),e.linkProgram(i),e.getProgramParameter(i,e.LINK_STATUS)?i:(console.error("[MetaArt3D] Link error:",e.getProgramInfoLog(i)),null)}function Ly(e,t){const r=H5*4,{a:o}=t,s=o.a_pos,l=o.a_color,i=o.a_size;s>=0&&(e.enableVertexAttribArray(s),e.vertexAttribPointer(s,3,e.FLOAT,!1,r,0)),l>=0&&(e.enableVertexAttribArray(l),e.vertexAttribPointer(l,4,e.FLOAT,!1,r,12)),i>=0&&(e.enableVertexAttribArray(i),e.vertexAttribPointer(i,1,e.FLOAT,!1,r,28))}function YS(e,t){const r=Gs*4,{a:o}=t,s=o.a_pos,l=o.a_color;s>=0&&(e.enableVertexAttribArray(s),e.vertexAttribPointer(s,3,e.FLOAT,!1,r,0)),l>=0&&(e.enableVertexAttribArray(l),e.vertexAttribPointer(l,4,e.FLOAT,!1,r,12))}function Rh(e,t,r,o){const s=(e.species/6-.5)*.55,l=(e.charge-.5)*.85,i=Math.sin(e.age*.008+e.hue*.035+o*7e-4)*r;return(l+s+i)*t}function KS(e,t,r,o,s,l,i,u,c,d,h){let f=d;const g=6,m=Math.max(1,Math.min(g-1,i)),y=Math.max(1,Math.floor(t/700)),v=u?.55+c*.35:.25+(l.genes.memory??.5)*.35;for(let b=0;b<t&&!(f>=Fd-g*2-4);b+=y){const S=e[b];if(S.role==="FLOW"||S.role==="MASK"||S.ink<.04)continue;const[C,k,R]=Ah(S.hue,S.sat,Math.min(.9,S.lit+(u?.15:.05))),j=S.ink*S.alpha*v;if(!(j<.01))for(let T=0;T<m&&f<Fd-2;T++){const _=(S.memIdx+(g-m+T))%g,P=(S.memIdx+(g-m+T+1))%g,I=S.memX[_],$=S.memY[_],q=S.memX[P],L=S.memY[P];if(Math.abs(q-I)>.15||Math.abs(L-$)>.15)continue;const H=(I-.5)*2.2,G=($-.5)*-2.2,oe=(q-.5)*2.2,le=(L-.5)*-2.2,pe=Rh(S,r,o,s),ce=T/m,te=(T+1)/m,F=j*ce,Q=j*te;let ae=f*Gs;h[ae]=H,h[ae+1]=G,h[ae+2]=pe,h[ae+3]=C,h[ae+4]=k,h[ae+5]=R,h[ae+6]=F,f++,ae=f*Gs,h[ae]=oe,h[ae+1]=le,h[ae+2]=pe,h[ae+3]=C,h[ae+4]=k,h[ae+5]=R,h[ae+6]=Q,f++}}return f}function OG(e,t,r,o,s,l,i){const c=Math.max(1,Math.floor(t/600));let d=0;for(let h=0;h<t-c&&d<Fd-2;h+=c){const f=e[h],g=e[h+c],m=(f.x-.5)*2.2,y=(f.y-.5)*-2.2,v=(g.x-.5)*2.2,b=(g.y-.5)*-2.2,S=v-m,C=b-y;if(S*S+C*C>.1024)continue;const k=Rh(f,r,o,s),R=Rh(g,r,o,s),j=Math.sqrt(S*S+C*C),T=l*(1-j/.32)*.5,[_,P,I]=Ah(f.hue,f.sat,f.lit),[$,q,L]=Ah(g.hue,g.sat,g.lit);let H=d*Gs;i[H]=m,i[H+1]=y,i[H+2]=k,i[H+3]=_,i[H+4]=P,i[H+5]=I,i[H+6]=T,d++,H=d*Gs,i[H]=v,i[H+1]=b,i[H+2]=R,i[H+3]=$,i[H+4]=q,i[H+5]=L,i[H+6]=T*.6,d++}return d}function _G(e,t,r,o,s,l,i,u,c){let d=u;const h=Math.min(.92,i.shapeOpacity??.85),f=2.2/Math.max(1,l),g=i.shapeScale??1;for(let m=0;m<t&&!(d>=Fd-Jc*2-10);m++){const y=e[m];if(y.kind!=="line"&&y.kind!=="arc"&&y.kind!=="rect"&&y.kind!=="plane")continue;const v=(y.x-.5)*2.2,b=(y.y-.5)*-2.2,S=Rh(y,r,o,s),[C,k,R]=Ah(y.hue,y.sat,Math.min(.95,y.lit+.12));if(y.kind==="line"){const j=y.angle??0,T=(y.length??40)*f*(y.qscale??1)*g,_=Math.cos(j)*T,P=Math.sin(j)*T;let I=d*Gs;c[I]=v-_,c[I+1]=b-P,c[I+2]=S,c[I+3]=C,c[I+4]=k,c[I+5]=R,c[I+6]=h,d++,I=d*Gs,c[I]=v+_,c[I+1]=b+P,c[I+2]=S,c[I+3]=C,c[I+4]=k,c[I+5]=R,c[I+6]=h*.7,d++}else if(y.kind==="arc"){const j=(y.length??24)*f*(y.qscale??1)*g,T=y.angle??0,_=Math.PI*1.5;for(let P=0;P<Jc&&d<Fd-2;P++){const I=P/Jc,$=(P+1)/Jc,q=T+I*_,L=T+$*_,H=h*(.65+.35*(1-I));let G=d*Gs;c[G]=v+Math.cos(q)*j,c[G+1]=b+Math.sin(q)*j,c[G+2]=S,c[G+3]=C,c[G+4]=k,c[G+5]=R,c[G+6]=H,d++,G=d*Gs,c[G]=v+Math.cos(L)*j,c[G+1]=b+Math.sin(L)*j,c[G+2]=S,c[G+3]=C,c[G+4]=k,c[G+5]=R,c[G+6]=H*.9,d++}}else if(y.kind==="rect"||y.kind==="plane"){const j=(y.qscale??1)*g*22*f,T=j*.65,_=y.angle??0,P=Math.cos(_),I=Math.sin(_),$=y.kind==="plane"?h*.6:h*.85,q=[v+P*j-I*T,v-P*j-I*T,v-P*j+I*T,v+P*j+I*T],L=[b+I*j+P*T,b-I*j+P*T,b-I*j-P*T,b+I*j-P*T];for(let H=0;H<4&&d<Fd-2;H++){const G=(H+1)%4;let oe=d*Gs;c[oe]=q[H],c[oe+1]=L[H],c[oe+2]=S,c[oe+3]=C,c[oe+4]=k,c[oe+5]=R,c[oe+6]=$,d++,oe=d*Gs,c[oe]=q[G],c[oe+1]=L[G],c[oe+2]=S,c[oe+3]=C,c[oe+4]=k,c[oe+5]=R,c[oe+6]=$*.85,d++}}}return d}function DG(e,t,r,o,s,l,i,u){let c=0;const d=2.2/Math.max(1,l),h=i.shapeScale??1,f=Math.min(.88,i.shapeOpacity??.85),g=Math.max(.35,i.fillSolidity??.5),m=(y,v,b,S,C,k,R)=>{const j=c*pb;u[j]=y,u[j+1]=v,u[j+2]=b,u[j+3]=S,u[j+4]=C,u[j+5]=k,u[j+6]=R,c++};for(let y=0;y<t&&!(c>=mb-Jc*3-8);y++){const v=e[y];if(v.kind!=="arc"&&v.kind!=="rect"&&v.kind!=="plane")continue;const b=(v.x-.5)*2.2,S=(v.y-.5)*-2.2,C=Rh(v,r,o,s),[k,R,j]=Ah(v.hue,v.sat,Math.min(.88,v.lit*.9+.05));if(v.kind==="arc"){const T=(v.length??24)*d*(v.qscale??1)*h,_=v.angle??0,P=Math.PI*1.5,I=f*g*.85;for(let $=0;$<Jc&&c<mb-3;$++){const q=$/Jc,L=($+1)/Jc,H=_+q*P,G=_+L*P,oe=I*(.6+.4*(1-q));m(b,S,C,k,R,j,I),m(b+Math.cos(H)*T,S+Math.sin(H)*T,C,k,R,j,oe),m(b+Math.cos(G)*T,S+Math.sin(G)*T,C,k,R,j,oe*.9)}}else if(v.kind==="rect"||v.kind==="plane"){const T=(v.qscale??1)*h*22*d,_=T*.65,P=v.angle??0,I=Math.cos(P),$=Math.sin(P),q=v.kind==="plane"?f*g*.75:f*g*.55,L=b+I*T-$*_,H=S+$*T+I*_,G=b-I*T-$*_,oe=S-$*T+I*_,le=b-I*T+$*_,pe=S-$*T-I*_,ce=b+I*T+$*_,te=S+$*T-I*_;m(L,H,C,k,R,j,q),m(G,oe,C,k,R,j,q*.92),m(le,pe,C,k,R,j,q*.85),m(L,H,C,k,R,j,q),m(le,pe,C,k,R,j,q*.85),m(ce,te,C,k,R,j,q*.92)}}return c}function Ah(e,t,r){const o=(1-Math.abs(2*r-1))*t,s=e/60%6,l=o*(1-Math.abs(s%2-1)),i=r-o/2,u=Math.floor(s)%6;let c=0,d=0,h=0;return u===0?(c=o,d=l):u===1?(c=l,d=o):u===2?(d=o,h=l):u===3?(d=l,h=o):u===4?(c=l,h=o):(c=o,h=l),[c+i,d+i,h+i]}function LG(e){const t=e.replace("#","");return t.length<6?[.02,.02,.04]:[parseInt(t.slice(0,2),16)/255,parseInt(t.slice(2,4),16)/255,parseInt(t.slice(4,6),16)/255]}function Wf(e,t,r){return e<t?t:e>r?r:e}function XS(e){return Wf(e,-Math.PI*.45,Math.PI*.45)}function ZS(e){const t=e.touches[0].clientX-e.touches[1].clientX,r=e.touches[0].clientY-e.touches[1].clientY;return Math.sqrt(t*t+r*r)}const zy=["L","Sh","Fl","Ex","Mg","Gl"],By=["luminous","shadowed","flowing","expander","magnetic","glitch"],$y=["#ffd060","#7090d0","#40c8ff","#c060ff","#ff7040","#40ff90"],c5=[-.8,-.5,-.2,0,.2,.5,.8];function zG(e){const t=Math.max(-1,Math.min(1,e));if(t>.02){const r=t;return`rgba(${Math.round(20+r*12)},${Math.round(155+r*90)},${Math.round(50+r*15)},${(.28+r*.55).toFixed(2)})`}else if(t<-.02){const r=-t;return`rgba(${Math.round(160+r*85)},${Math.round(20+r*10)},${Math.round(20+r*8)},${(.28+r*.58).toFixed(2)})`}return"rgba(50,50,60,0.4)"}function BG(e){return`rgba(255,255,255,${(.4+Math.abs(Math.max(-1,Math.min(1,e)))*.5).toFixed(2)})`}function $G({matrix:e,onCellChange:t,onRandomize:r,onSymmetrize:o,onReset:s,onPreset:l}){const i=w.useRef(null),u=w.useCallback((S,C,k)=>{S.currentTarget.setPointerCapture(S.pointerId),i.current={i:C,j:k,startY:S.clientY,startVal:e[C*6+k]??0,moved:!1},S.preventDefault()},[e]),c=w.useCallback(S=>{if(!i.current)return;const C=i.current.startY-S.clientY;Math.abs(C)>3&&(i.current.moved=!0);const k=Math.max(-1,Math.min(1,i.current.startVal+C*.013));t(i.current.i,i.current.j,k)},[t]),d=w.useCallback(S=>{if(i.current&&!i.current.moved){const{i:C,j:k}=i.current,R=e[C*6+k]??0,T=(c5.reduce((_,P,I)=>Math.abs(P-R)<Math.abs(c5[_]-R)?I:_,0)+1)%c5.length;t(C,k,c5[T])}i.current=null},[e,t]),h="'IBM Plex Mono', monospace",f="#ff0084",g="rgba(255,255,255,0.28)",m="rgba(255,255,255,0.06)",y={padding:"12px 14px",display:"flex",flexDirection:"column",gap:10,fontFamily:h,color:"rgba(255,255,255,0.75)",overflowY:"auto",background:"#000"},v={fontSize:7,color:g,letterSpacing:"0.12em",textTransform:"uppercase",fontFamily:h},b={flex:1,padding:"4px 0",borderRadius:1,cursor:"pointer",fontSize:7,fontFamily:h,letterSpacing:"0.1em",background:"rgba(255,255,255,0.02)",border:`1px solid ${m}`,color:"rgba(255,255,255,0.5)",textTransform:"uppercase"};return a.jsxs("div",{style:y,children:[a.jsx("div",{style:{fontSize:8,color:f,letterSpacing:"0.16em",textTransform:"uppercase",fontWeight:400,fontFamily:h},children:"INTERACTION MATRIX"}),a.jsxs("div",{style:{fontSize:7,color:g,lineHeight:1.6,fontFamily:h},children:["Linha  emissora  Coluna  alvo",a.jsx("br",{}),a.jsx("span",{style:{color:"rgba(80,200,80,0.55)"},children:"verde = atrao"}),"  ",a.jsx("span",{style:{color:"rgba(220,80,80,0.55)"},children:"vermelho = repulso"}),a.jsx("br",{}),"Click = cicla  Drag  = contnuo"]}),a.jsxs("div",{children:[a.jsx("div",{style:{display:"flex",marginLeft:22,marginBottom:2},children:zy.map((S,C)=>a.jsx("div",{style:{flex:1,textAlign:"center",fontSize:7,fontFamily:"monospace",color:$y[C],letterSpacing:"0.04em"},children:S},C))}),Array.from({length:6},(S,C)=>a.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:1},children:[a.jsx("div",{style:{width:20,flexShrink:0,fontSize:7,fontFamily:"monospace",color:$y[C],textAlign:"right",paddingRight:2,letterSpacing:"0.04em"},children:zy[C]}),Array.from({length:6},(k,R)=>{const j=e[C*6+R]??0;return a.jsx("div",{style:{flex:1,height:25,marginLeft:1,background:zG(j),borderRadius:2,border:`1px solid rgba(255,255,255,${C===R?.28:.06})`,cursor:"ns-resize",display:"flex",alignItems:"center",justifyContent:"center",userSelect:"none",WebkitUserSelect:"none",fontSize:6,fontFamily:"monospace",color:BG(j),outline:C===R?"1px solid rgba(255,255,255,0.18)":"none",outlineOffset:"-2px"},onPointerDown:T=>u(T,C,R),onPointerMove:c,onPointerUp:d,title:`${By[C]}  ${By[R]}: ${j.toFixed(3)}`,children:j.toFixed(1)},R)})]},C))]}),a.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[a.jsxs("div",{style:{display:"flex",gap:3,alignItems:"center"},children:[a.jsx("div",{style:{width:10,height:6,borderRadius:1,background:"rgba(200,40,40,0.65)"}}),a.jsx("span",{style:{...v,color:"rgba(220,100,100,0.5)"},children:"repuls."})]}),a.jsxs("div",{style:{display:"flex",gap:3,alignItems:"center"},children:[a.jsx("div",{style:{width:10,height:6,borderRadius:1,background:"rgba(50,60,55,0.8)"}}),a.jsx("span",{style:{...v,color:"rgba(150,150,150,0.4)"},children:"neutro"})]}),a.jsxs("div",{style:{display:"flex",gap:3,alignItems:"center"},children:[a.jsx("div",{style:{width:10,height:6,borderRadius:1,background:"rgba(20,190,70,0.65)"}}),a.jsx("span",{style:{...v,color:"rgba(100,220,120,0.5)"},children:"atrao"})]})]}),a.jsxs("div",{children:[a.jsx("div",{style:{...v,marginBottom:5},children:"Utilitrios"}),a.jsxs("div",{style:{display:"flex",gap:3},children:[a.jsx("button",{onClick:r,style:b,title:"Gerar nova matriz aleatria",children:"Rand"}),a.jsx("button",{onClick:o,style:b,title:"Tornar a matriz simtrica (mdia AB)",children:"Sim"}),a.jsx("button",{onClick:s,style:{...b,color:"rgba(180,160,255,0.65)"},title:"Restaurar matriz calculada a partir do DNA atual",children:"DNA"})]})]}),a.jsxs("div",{children:[a.jsx("div",{style:{...v,marginBottom:5},children:"Dinmicas Pr-Definidas"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:3},children:[{id:"chaos",icon:"",label:"Caos",desc:"repulso entre todas as espcies"},{id:"harmony",icon:"",label:"Harmonia",desc:"atrao global  grande mistura"},{id:"predator",icon:"",label:"Predador",desc:"cadeia assimtrica 012 0"},{id:"bubbles",icon:"",label:"Bolhas",desc:"self+  cross  agrupa por espcie"}].map(({id:S,icon:C,label:k,desc:R})=>a.jsxs("button",{onClick:()=>l(S),style:{textAlign:"left",padding:"5px 8px",borderRadius:4,cursor:"pointer",background:"rgba(80,100,160,0.07)",border:"1px solid rgba(100,120,200,0.15)",color:"rgba(200,210,255,0.75)",fontSize:8,width:"100%"},children:[a.jsx("span",{style:{marginRight:5,opacity:.6},children:C}),a.jsx("span",{style:{fontWeight:600},children:k}),a.jsxs("span",{style:{marginLeft:5,color:"rgba(255,255,255,0.3)",fontSize:7},children:[" ",R]})]},S))})]}),a.jsxs("div",{children:[a.jsx("div",{style:{...v,marginBottom:5},children:"Espcies"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:3},children:zy.map((S,C)=>a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[a.jsx("div",{style:{width:7,height:7,borderRadius:"50%",flexShrink:0,background:$y[C]}}),a.jsxs("span",{style:{fontSize:7,fontFamily:"monospace",color:"rgba(255,255,255,0.3)"},children:[S,"  ",By[C]]})]},C))})]})]})}const Wg="'IBM Plex Mono', monospace",qG="#ff0084",IR="rgba(255,255,255,0.28)",gd={fontSize:7,color:IR,letterSpacing:"0.12em",textTransform:"uppercase",marginBottom:1,fontFamily:Wg},WG={padding:"12px 14px",display:"flex",flexDirection:"column",gap:8,fontFamily:Wg,color:"rgba(255,255,255,0.75)",overflowY:"auto",background:"#000"};function Ma({name:e,val:t,min:r,max:o,step:s,color:l="#60b0ff",fmt:i,onChange:u}){return a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[a.jsx("span",{style:{...gd,width:72,marginBottom:0,textAlign:"right"},children:e}),a.jsx("input",{type:"range",min:r,max:o,step:s,value:t,onChange:c=>u(parseFloat(c.target.value)),style:{flex:1,cursor:"pointer",accentColor:l}}),a.jsx("span",{style:{fontSize:7,color:IR,fontFamily:Wg,minWidth:32,textAlign:"right"},children:i?i(t):t.toFixed(2)})]})}function HG({name:e,val:t,color:r="#ff8060",onChange:o}){return a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:6},children:[a.jsx("span",{style:{...gd,marginBottom:0,width:72,textAlign:"right"},children:e}),a.jsx("button",{onClick:()=>o(!t),style:{flex:1,fontSize:8,padding:"3px 0",borderRadius:3,cursor:"pointer",background:t?`${r}22`:"rgba(255,255,255,0.04)",border:`1px solid ${t?`${r}55`:"rgba(255,255,255,0.1)"}`,color:t?r:"rgba(255,255,255,0.28)",fontFamily:"monospace"},children:t?" ON":" OFF"})]})}const GG=({physics:e,dna:t,onPhysics:r,onDNAGene:o})=>{const s=e,l=t.genes;return a.jsxs("div",{style:WG,children:[a.jsx("div",{style:{fontSize:8,color:qG,letterSpacing:"0.16em",textTransform:"uppercase",fontWeight:400,fontFamily:Wg},children:"PHYSICS & BEHAVIOR"}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:5},children:[a.jsx("div",{style:{...gd,color:"rgba(100,180,255,0.6)",marginBottom:3},children:"Interao PL"}),a.jsx(Ma,{name:"Raio Max",val:s.rMaxMul,min:.3,max:3,step:.05,color:"#60b0ff",fmt:i=>i.toFixed(2)+"x",onChange:i=>r({rMaxMul:i})}),a.jsx(Ma,{name:"Raio Min",val:s.rMinMul,min:.3,max:3,step:.05,color:"#80c0ff",fmt:i=>i.toFixed(2)+"x",onChange:i=>r({rMinMul:i})}),a.jsx(Ma,{name:"Fora",val:s.forceMul,min:.05,max:5,step:.05,color:"#ff9060",fmt:i=>i.toFixed(2)+"x",onChange:i=>r({forceMul:i})}),a.jsx(Ma,{name:"Amortec.",val:s.dampingMul,min:.3,max:1.5,step:.02,color:"#a0d0ff",fmt:i=>i.toFixed(2)+"x",onChange:i=>r({dampingMul:i})}),a.jsx(Ma,{name:"Velocidade",val:s.maxSpeedMul,min:.1,max:5,step:.05,color:"#60ffa0",fmt:i=>i.toFixed(2)+"x",onChange:i=>r({maxSpeedMul:i})}),a.jsx(Ma,{name:"Rudo",val:s.noiseMul,min:0,max:5,step:.05,color:"#ffaa60",fmt:i=>i.toFixed(2)+"x",onChange:i=>r({noiseMul:i})})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:5},children:[a.jsx("div",{style:{...gd,color:"rgba(180,140,255,0.6)",marginBottom:3},children:"Genes de Movimento"}),a.jsx(Ma,{name:"Fluxo",val:l.flow,min:0,max:1,step:.01,color:"#80d0ff",fmt:i=>i.toFixed(2),onChange:i=>o("flow",i)}),a.jsx(Ma,{name:"Entropia",val:l.entropy,min:0,max:1,step:.01,color:"#ffa080",fmt:i=>i.toFixed(2),onChange:i=>o("entropy",i)}),a.jsx(Ma,{name:"Coerncia",val:l.coherence,min:0,max:1,step:.01,color:"#80ffb0",fmt:i=>i.toFixed(2),onChange:i=>o("coherence",i)}),a.jsx(Ma,{name:"Fragmentao",val:l.fragmentation,min:0,max:1,step:.01,color:"#ffcc60",fmt:i=>i.toFixed(2),onChange:i=>o("fragmentation",i)}),a.jsx(Ma,{name:"Ritmo",val:l.rhythm,min:0,max:1,step:.01,color:"#ff80c0",fmt:i=>i.toFixed(2),onChange:i=>o("rhythm",i)}),a.jsx(Ma,{name:"Estrutura",val:l.structure,min:0,max:1,step:.01,color:"#c0a0ff",fmt:i=>i.toFixed(2),onChange:i=>o("structure",i)}),a.jsx(Ma,{name:"Eroso",val:l.erosion,min:0,max:1,step:.01,color:"#ff9060",fmt:i=>i.toFixed(2),onChange:i=>o("erosion",i)}),a.jsx(Ma,{name:"Isolamento",val:l.isolation??0,min:0,max:1,step:.01,color:"#ff6080",fmt:i=>i.toFixed(2),onChange:i=>o("isolation",i)})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:5},children:[a.jsx("div",{style:{...gd,color:"rgba(120,220,160,0.6)",marginBottom:3},children:"Espacial"}),a.jsx(Ma,{name:"Atrao Centro",val:s.centerPull,min:0,max:1,step:.02,color:"#60ffa0",fmt:i=>i.toFixed(2),onChange:i=>r({centerPull:i})}),a.jsx(Ma,{name:"Rep. Borda",val:s.borderRepulsion,min:0,max:1,step:.02,color:"#ff8060",fmt:i=>i.toFixed(2),onChange:i=>r({borderRepulsion:i})})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:5},children:[a.jsx("div",{style:{...gd,color:"rgba(255,180,80,0.6)",marginBottom:3},children:"Quadrantes"}),a.jsx(HG,{name:"Modo Quad.",val:s.quadrantMode,color:"#ffaa40",onChange:i=>r({quadrantMode:i})}),s.quadrantMode&&a.jsx(Ma,{name:"Fora Quad.",val:s.quadrantStrength,min:0,max:1,step:.02,color:"#ffaa40",fmt:i=>i.toFixed(2),onChange:i=>r({quadrantStrength:i})}),s.quadrantMode&&a.jsxs("div",{style:{fontSize:7,color:"rgba(255,180,80,0.4)",lineHeight:1.5,background:"rgba(255,140,0,0.06)",borderRadius:4,padding:"5px 8px"},children:[a.jsx("b",{children:"Esp. 0"}),"   TL  ",a.jsx("b",{children:"1"}),"   TR  ",a.jsx("b",{children:"2"}),"   BL",a.jsx("br",{}),a.jsx("b",{children:"3"}),"   BR  ",a.jsx("b",{children:"4"}),"   Top  ",a.jsx("b",{children:"5"}),"   Bot",a.jsx("br",{}),"Combine com Isolamento > 0.5 para segregao total."]})]}),a.jsxs("div",{children:[a.jsx("div",{style:{...gd,marginBottom:6,color:"rgba(255,255,255,0.35)"},children:"Presets Rpidos"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[{name:"Equilibrado",desc:"Fsica neutra, boa para explorar",apply:()=>r({rMaxMul:1,forceMul:1,dampingMul:1,noiseMul:1,maxSpeedMul:1,rMinMul:1,borderRepulsion:.25,centerPull:0})},{name:"Atrao Lenta",desc:"Clusters lentos e estveis",apply:()=>r({rMaxMul:1.5,forceMul:.5,dampingMul:1.3,noiseMul:.3,maxSpeedMul:.4,rMinMul:.8,borderRepulsion:.4})},{name:"Explosivo",desc:"Agentes rpidos e caticos",apply:()=>r({rMaxMul:.8,forceMul:3,dampingMul:.7,noiseMul:2.5,maxSpeedMul:3.5,rMinMul:1.2,borderRepulsion:.3})},{name:"Bolhas",desc:"Espcies em clusters segregados",apply:()=>r({rMaxMul:1.2,forceMul:1.8,dampingMul:1.1,noiseMul:.5,maxSpeedMul:.8,rMinMul:.6,borderRepulsion:.5,centerPull:.2})},{name:"Quadrantes ON",desc:"Cada espcie no seu territrio",apply:()=>r({quadrantMode:!0,quadrantStrength:.7,borderRepulsion:.4})}].map(i=>a.jsxs("button",{onClick:i.apply,style:{textAlign:"left",padding:"5px 7px",borderRadius:4,cursor:"pointer",background:"rgba(60,120,200,0.07)",border:"1px solid rgba(80,150,255,0.15)",color:"rgba(180,210,255,0.8)",fontSize:8},children:[a.jsx("div",{style:{fontWeight:600,marginBottom:1},children:i.name}),a.jsx("div",{style:{fontSize:7,color:"rgba(255,255,255,0.3)"},children:i.desc})]},i.name))})]})]})},VG=["Luminoso","Sombra","Fluxo","Expanso","Magntico","Glitch"],UG=[{id:"circle",icon:"",label:"Ponto"},{id:"brush",icon:"",label:"Pincel"},{id:"square",icon:"",label:"Quad."},{id:"diamond",icon:"",label:"Diam."},{id:"triangle",icon:"",label:"Tri."},{id:"star",icon:"",label:"Estrela"}],YG={padding:"12px 14px",display:"flex",flexDirection:"column",gap:10,fontFamily:"'IBM Plex Mono', monospace",color:"rgba(255,255,255,0.75)",overflowY:"auto",background:"#000"},Nc={fontSize:7,color:"rgba(255,255,255,0.28)",letterSpacing:"0.14em",textTransform:"uppercase",marginBottom:5,fontFamily:"'IBM Plex Mono', monospace"};function Rf({icon:e,label:t,color:r,desc:o,onClick:s}){return a.jsxs("button",{onClick:s,title:o,style:{flex:1,padding:"7px 4px",borderRadius:4,cursor:"pointer",border:`1px solid ${r}33`,background:`${r}11`,color:`${r}cc`,fontSize:8,letterSpacing:"0.06em",textTransform:"uppercase",display:"flex",flexDirection:"column",alignItems:"center",gap:3,transition:"all 0.1s"},onMouseEnter:l=>l.currentTarget.style.background=`${r}22`,onMouseLeave:l=>l.currentTarget.style.background=`${r}11`,children:[a.jsx("span",{style:{fontSize:14},children:e}),a.jsx("span",{children:t})]})}const KG=({dna:e,palette:t,onRecolorSpecies:r,onRandomPalette:o,onSetAllShape:s,brushTextureId:l,onBrushTexture:i,onDNAGene:u,onChaosInject:c,onFreezeAll:d,onPulseAll:h,onScatterAll:f,onHueRotate:g,onSatShift:m,onLitShift:y,onSizeAll:v,onRespawn:b})=>{const[S,C]=w.useState(30);return a.jsxs("div",{style:YG,children:[a.jsx("div",{style:{fontSize:8,color:"#ff0084",letterSpacing:"0.16em",textTransform:"uppercase",fontWeight:400,fontFamily:"'IBM Plex Mono', monospace"},children:"POWERS & INTERVENTIONS"}),a.jsxs("div",{children:[a.jsx("div",{style:Nc,children:"Intervenes Rpidas"}),a.jsxs("div",{style:{display:"flex",gap:4,flexWrap:"wrap"},children:[a.jsx(Rf,{icon:"",label:"Caos",color:"#ff6040",desc:"Injeta entropia mxima por 2s",onClick:c}),a.jsx(Rf,{icon:"",label:"Freeze",color:"#60c0ff",desc:"Congela todos os agentes",onClick:d}),a.jsx(Rf,{icon:"",label:"Pulso",color:"#ffd060",desc:"Exploso de velocidade em todos",onClick:h}),a.jsx(Rf,{icon:"",label:"Scatter",color:"#c060ff",desc:"Disperso centrfuga",onClick:f}),a.jsx(Rf,{icon:"",label:"Respawn",color:"#60ff90",desc:"Respawna com novo padro",onClick:b})]})]}),a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},children:[a.jsx("span",{style:Nc,children:"Cor por Espcie"}),a.jsx("button",{onClick:o,style:{fontSize:8,padding:"2px 8px",borderRadius:3,cursor:"pointer",border:"1px solid rgba(255,200,100,0.3)",background:"rgba(255,200,100,0.08)",color:"rgba(255,210,120,0.8)",letterSpacing:"0.06em",textTransform:"uppercase"},children:" Rand"})]}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:5},children:VG.map((k,R)=>{const j=t[R%t.length]??"#888888";return a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[a.jsx("div",{style:{width:8,height:8,borderRadius:"50%",background:j,flexShrink:0,border:"1px solid rgba(255,255,255,0.15)"}}),a.jsxs("span",{style:{fontSize:8,color:"rgba(255,255,255,0.45)",flex:1},children:[R," ",k]}),a.jsx("input",{type:"color",value:j.startsWith("#")?j:"#888888",onChange:T=>r(R,T.target.value),style:{width:28,height:20,padding:0,border:"1px solid rgba(255,255,255,0.15)",borderRadius:3,cursor:"pointer",background:"none"}})]},R)})})]}),a.jsxs("div",{children:[a.jsx("div",{style:Nc,children:"Rotao de Matiz (Todos)"}),a.jsxs("div",{style:{display:"flex",gap:5,alignItems:"center"},children:[a.jsx("input",{type:"range",min:0,max:180,step:5,value:S,onChange:k=>C(parseInt(k.target.value)),style:{flex:1,cursor:"pointer",accentColor:"#ff80c0"}}),a.jsxs("span",{style:{fontSize:8,color:"rgba(255,255,255,0.4)",fontFamily:"monospace",minWidth:30},children:["+",S,""]}),a.jsx("button",{onClick:()=>g(S),style:{padding:"4px 10px",borderRadius:3,cursor:"pointer",border:"1px solid rgba(255,100,180,0.3)",background:"rgba(255,100,180,0.1)",color:"rgba(255,150,200,0.9)",fontSize:8,letterSpacing:"0.06em",textTransform:"uppercase"},children:"Apply"})]}),a.jsx("div",{style:{display:"flex",gap:4,marginTop:4,flexWrap:"wrap"},children:[15,30,60,90,120,180].map(k=>a.jsxs("button",{onClick:()=>g(k),style:{padding:"3px 7px",borderRadius:3,cursor:"pointer",fontSize:7,border:"1px solid rgba(255,255,255,0.1)",background:"rgba(255,255,255,0.04)",color:"rgba(255,255,255,0.5)"},children:["+",k,""]},k))})]}),a.jsxs("div",{children:[a.jsx("div",{style:Nc,children:"Luminncia & Saturao"}),a.jsx("div",{style:{display:"flex",gap:4},children:[{icon:"",label:"-Sat",color:"#8080a0",onClick:()=>m(-.15)},{icon:"",label:"+Sat",color:"#ff80ff",onClick:()=>m(.15)},{icon:"",label:"-Lit",color:"#404060",onClick:()=>y(-.1)},{icon:"",label:"+Lit",color:"#ffe060",onClick:()=>y(.1)}].map(k=>a.jsxs("button",{onClick:k.onClick,style:{flex:1,padding:"5px 2px",borderRadius:3,cursor:"pointer",border:`1px solid ${k.color}33`,background:`${k.color}11`,color:`${k.color}cc`,fontSize:7,letterSpacing:"0.04em",display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:[a.jsx("span",{style:{fontSize:12},children:k.icon}),a.jsx("span",{style:{textTransform:"uppercase"},children:k.label})]},k.label))})]}),a.jsxs("div",{children:[a.jsx("div",{style:Nc,children:"Tamanho Global"}),a.jsx("div",{style:{display:"flex",gap:4},children:[{label:"0.5",mul:.5},{label:"0.75",mul:.75},{label:"1.25",mul:1.25},{label:"2",mul:2}].map(k=>a.jsx("button",{onClick:()=>v(k.mul),style:{flex:1,padding:"5px 2px",borderRadius:3,cursor:"pointer",border:"1px solid rgba(255,255,255,0.1)",background:"rgba(255,255,255,0.04)",color:"rgba(255,255,255,0.55)",fontSize:8,fontFamily:"monospace"},children:k.label},k.label))})]}),a.jsxs("div",{children:[a.jsx("div",{style:Nc,children:"Forma Global"}),a.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:3},children:UG.map(k=>a.jsxs("button",{onClick:()=>s(k.id),style:{padding:"5px 3px",borderRadius:3,cursor:"pointer",border:"1px solid rgba(255,255,255,0.1)",background:"rgba(255,255,255,0.04)",color:"rgba(255,255,255,0.6)",fontSize:8,display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:[a.jsx("span",{style:{fontSize:13},children:k.icon}),a.jsx("span",{style:{fontSize:6,letterSpacing:"0.04em",textTransform:"uppercase"},children:k.label})]},k.id))})]}),a.jsxs("div",{children:[a.jsx("div",{style:Nc,children:"Textura do Pincel (Global)"}),a.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:3},children:tp.map(k=>{const R=l===k.id;return a.jsxs("button",{onClick:()=>i(k.id),title:k.label,style:{padding:"4px 2px",borderRadius:3,cursor:"pointer",background:R?"rgba(255,200,80,0.16)":"rgba(255,255,255,0.03)",border:`1px solid ${R?"rgba(255,200,80,0.4)":"rgba(255,255,255,0.07)"}`,color:R?"rgba(255,210,100,0.9)":"rgba(255,255,255,0.35)",fontSize:7,display:"flex",flexDirection:"column",alignItems:"center",gap:1},children:[a.jsx("span",{style:{fontSize:11,lineHeight:1},children:k.emoji}),a.jsx("span",{style:{fontSize:5,textTransform:"uppercase",letterSpacing:"0.03em"},children:k.label})]},k.id)})})]}),a.jsxs("div",{children:[a.jsx("div",{style:Nc,children:"Injees de Gene"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[{label:"Entropia MAX",icon:"",key:"entropy",val:.95,color:"#ff6040"},{label:"Entropia MIN",icon:"",key:"entropy",val:.05,color:"#60c0ff"},{label:"Fluxo MAX",icon:"",key:"flow",val:.95,color:"#40b0ff"},{label:"Coheso MAX",icon:"",key:"coherence",val:.95,color:"#80ffb0"},{label:"Isolamento MAX",icon:"",key:"isolation",val:1,color:"#ff8040"},{label:"Isolamento OFF",icon:"",key:"isolation",val:0,color:"#80c0ff"}].map(k=>a.jsxs("button",{onClick:()=>u(k.key,k.val),style:{padding:"5px 8px",borderRadius:4,cursor:"pointer",background:`${k.color}0d`,border:`1px solid ${k.color}25`,color:`${k.color}bb`,fontSize:8,textAlign:"left",display:"flex",alignItems:"center",gap:6,letterSpacing:"0.04em"},children:[a.jsx("span",{children:k.icon}),a.jsx("span",{children:k.label})]},`${k.key}-${k.val}`))})]})]})},Hr="'IBM Plex Mono', monospace",Bi="#ff0084",qy="#000",Wy="rgba(255,255,255,0.02)",Oi="rgba(255,255,255,0.06)",co="rgba(255,255,255,0.28)",JS="rgba(255,255,255,0.5)",np="rgba(255,255,255,0.85)";function XG({geoParams:e,onParamChange:t,onApplyPreset:r}){const[o,s]=Yt.useState(!1),l=e,i={padding:"12px 14px",display:"flex",flexDirection:"column",gap:10,fontFamily:Hr},u={fontSize:8,color:co,letterSpacing:"0.12em",textTransform:"uppercase",marginBottom:1,fontFamily:Hr},c={strokeWeight:[.1,3],shapeScale:[.1,3],particleSize3D:[.1,3],zDepth:[0,2],camFOV:[20,90],shapeGravity:[0,1],angleDamping:[0,1],trailLength3D:[1,6]},d=(h,f,g="#60ff90")=>{const m=l[h],y=typeof m=="number"&&isFinite(m)?m:0,[v,b]=c[h]??[0,1];return a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[a.jsx("span",{style:{...u,width:62,marginBottom:0,textAlign:"right"},children:f}),a.jsx("input",{type:"range",min:v,max:b,step:b>1?.05:.01,value:y,onChange:S=>t(h,parseFloat(S.target.value)),style:{flex:1,cursor:"pointer",accentColor:g}}),a.jsx("span",{style:{fontSize:7,color:co,fontFamily:Hr,minWidth:28,textAlign:"right"},children:y.toFixed(2)})]},h)};return l.mode==="geometric"||l.mode==="hybrid"||l.mode,a.jsxs("div",{style:{...i,color:"rgba(255,255,255,0.75)",overflowY:"auto"},children:[a.jsx("div",{style:{fontSize:8,color:Bi,letterSpacing:"0.16em",textTransform:"uppercase",fontWeight:400,fontFamily:Hr},children:"COMPOSITOR GESTALT"}),a.jsxs("div",{children:[a.jsx("div",{style:u,children:"Modo"}),a.jsx("div",{style:{display:"flex",gap:3,flexWrap:"wrap"},children:["fluid","geometric","hybrid","3d"].map(h=>a.jsx("button",{title:h,onClick:()=>t("mode",h),style:{flex:1,minWidth:42,padding:"4px 0",borderRadius:1,cursor:"pointer",fontSize:7,fontFamily:Hr,letterSpacing:"0.1em",textTransform:"uppercase",background:l.mode===h?"rgba(255,0,132,0.08)":"rgba(255,255,255,0.02)",border:`1px solid ${l.mode===h?"rgba(255,0,132,0.3)":Oi}`,color:l.mode===h?Bi:co},children:h==="fluid"?"FLUID":h==="geometric"?"GEO":h==="hybrid"?"HYBRID":"3D"},h))})]}),l.mode==="3d"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:5},children:[a.jsx("div",{style:{...u,marginBottom:3,color:"rgba(200,130,255,0.75)"},children:" Cmera & Espao"}),d("zDepth","Z-Depth","#c080ff"),d("orbitSpeed","rbita","#a060ff"),d("camFOV","FOV","#8060ff"),d("depthFog","Fog","#607090")]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:5},children:[a.jsx("div",{style:{...u,marginBottom:3,color:"rgba(200,130,255,0.75)"},children:" Luz & Glow"}),d("light3D","Luz","#ffd060"),d("particleSize3D","Pt Size","#a0ffa0"),d("glowIntensity3D","Glow","#80c0ff"),d("waveZ","Z-Wave","#ff80c0"),d("fillSolidity","Fill Solid","#ffcc60"),d("shapeScale","Scale","#a0ffa0")]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:5},children:[a.jsx("div",{style:{...u,marginBottom:3,color:"rgba(200,130,255,0.75)"},children:" Conexes & Overlays"}),d("macroAtmosphere","Conexes","#ff80c0"),d("macroGesture","Flow","#60c0ff"),a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:6},children:[a.jsx("span",{style:{...u,marginBottom:0,width:60},children:"Rastros"}),a.jsx("button",{title:`Trails 3D: ${l.trails3D?"ON":"OFF"}`,onClick:()=>t("trails3D",!l.trails3D),style:{flex:1,fontSize:8,padding:"3px 0",borderRadius:3,cursor:"pointer",background:l.trails3D?"rgba(80,200,255,0.18)":"rgba(255,255,255,0.04)",border:`1px solid ${l.trails3D?"rgba(80,200,255,0.45)":"rgba(255,255,255,0.1)"}`,color:l.trails3D?"rgba(160,230,255,0.95)":"rgba(255,255,255,0.28)",fontFamily:"monospace"},children:l.trails3D?" ON":" OFF"})]}),l.trails3D&&d("trailLength3D","Trail Len","#80d0ff")]}),a.jsxs("div",{style:{fontSize:7,color:"rgba(200,130,255,0.4)",lineHeight:1.65,background:"rgba(140,60,255,0.06)",borderRadius:4,padding:"6px 8px"},children:[a.jsx("div",{style:{color:"rgba(200,130,255,0.6)",marginBottom:3,fontSize:8},children:" DNA  3D"}),a.jsx("div",{children:"Memory  auto-rastros  Entropy  jitter"}),a.jsx("div",{children:"Contrast  luminncia  Rhythm  pulso"}),a.jsx("div",{children:"Frag.  escala alternada  Linear  Rizoma"})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:5},children:[a.jsx("div",{style:{...u,marginBottom:2,color:"rgba(200,130,255,0.75)"},children:" Formas Geo"}),a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:6},children:[a.jsx("span",{style:{...u,marginBottom:0,width:60},children:"Wireframe"}),a.jsx("button",{title:`Geo Shapes: ${l.showGeoShapes!==!1?"ON":"OFF"}`,onClick:()=>t("showGeoShapes",l.showGeoShapes===!1),style:{flex:1,fontSize:8,padding:"3px 0",borderRadius:3,cursor:"pointer",background:l.showGeoShapes!==!1?"rgba(160,80,255,0.18)":"rgba(255,255,255,0.04)",border:`1px solid ${l.showGeoShapes!==!1?"rgba(200,100,255,0.45)":"rgba(255,255,255,0.1)"}`,color:l.showGeoShapes!==!1?"rgba(220,170,255,0.95)":"rgba(255,255,255,0.28)",fontFamily:"monospace"},children:l.showGeoShapes!==!1?" ON":" OFF"})]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:6},children:[a.jsx("span",{style:{...u,marginBottom:0,width:60},children:"Slido 3D"}),a.jsx("button",{title:`Solid 3D: ${l.solidShapes3D?"ON":"OFF"}`,onClick:()=>t("solidShapes3D",!l.solidShapes3D),style:{flex:1,fontSize:8,padding:"3px 0",borderRadius:3,cursor:"pointer",background:l.solidShapes3D?"rgba(255,160,60,0.18)":"rgba(255,255,255,0.04)",border:`1px solid ${l.solidShapes3D?"rgba(255,200,80,0.45)":"rgba(255,255,255,0.1)"}`,color:l.solidShapes3D?"rgba(255,220,150,0.95)":"rgba(255,255,255,0.28)",fontFamily:"monospace"},children:l.solidShapes3D?" ON":" OFF"})]}),a.jsxs("div",{style:{fontSize:7,color:"rgba(255,255,255,0.2)",lineHeight:1.5},children:["Slido: preenche rect/plane/arc com tringulos.",a.jsx("br",{}),"Ajusta Fill Solid para controlar a opacidade."]})]}),a.jsxs("div",{children:[a.jsx("div",{style:{...u,marginBottom:5,color:"rgba(200,130,255,0.6)"},children:"Presets 3D"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[{key:"nebula_drift",name:"Nebula Drift",desc:"rbita lenta  glow volumtrico  nvoa"},{key:"crystal_lattice",name:"Crystal Lattice",desc:"Estrutura  linhas frias  luz dura"},{key:"void_bloom",name:"Void Bloom",desc:"Vazio  exploso aditiva  rbita rpida"},{key:"solar_wind",name:"Solar Wind",desc:"Fluxo  arcos 3D  vento solar"},{key:"quantum_foam",name:"Quantum Foam",desc:"Turbulncia mxima  glow total  caos"},{key:"deep_field",name:"Deep Field",desc:"Campo estelar  deriva lenta  Hubble"},{key:"rhizome_3d",name:"Rizoma 3D",desc:"Linhas retas  rastros neon  rede viva"}].map(({key:h,name:f,desc:g})=>a.jsxs("button",{title:f,onClick:()=>r(h),style:{textAlign:"left",padding:"6px 8px",borderRadius:1,cursor:"pointer",background:"rgba(255,0,132,0.04)",border:"1px solid rgba(255,0,132,0.15)",color:np,fontSize:8,fontFamily:Hr},children:[a.jsx("div",{style:{fontWeight:400,marginBottom:2,letterSpacing:"0.06em"},children:f}),a.jsx("div",{style:{fontSize:7,color:co},children:g})]},h))})]}),a.jsxs("div",{style:{fontSize:8,color:"rgba(160,100,255,0.4)",lineHeight:1.65,borderTop:"1px solid rgba(160,80,255,0.12)",paddingTop:8},children:[" drag  rbita  scroll  zoom",a.jsx("br",{})," 2 dedos  pinch-zoom"]})]}),(l.mode==="geometric"||l.mode==="hybrid")&&a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[a.jsx("div",{style:{...u,marginBottom:4,color:"rgba(160,240,160,0.5)"},children:"Macros"}),d("macroStructure","Structure","#c0a0ff"),d("macroGesture","Gesture","#60c0ff"),d("macroContrast","Contrast","#ffd060"),d("macroSilence","Silence","#80ffa0"),d("macroAtmosphere","Atmosphere","#ff80c0"),d("macroCollage","Collage","#ff9060")]}),(l.mode==="geometric"||l.mode==="hybrid")&&a.jsxs("div",{children:[a.jsx("div",{style:{...u,marginBottom:6,color:"rgba(100,200,255,0.6)"},children:" Fsica das Formas"}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:5},children:[a.jsxs("div",{style:{fontSize:7,color:"rgba(255,255,255,0.22)",lineHeight:1.5,marginBottom:2},children:["Gesture  velocidade autnoma das formas (linha, arco, rect, plano).",a.jsx("br",{}),"Gravity  atrai formas para o centro. Ang.Damp  congela ngulo."]}),d("shapeGravity","Gravity","#ffaa40"),d("angleDamping","Ang. Damp","#80d0ff")]})]}),(l.mode==="geometric"||l.mode==="hybrid")&&a.jsxs("div",{children:[a.jsx("div",{style:{...u,marginBottom:6},children:"Primitive Mix"}),["mixPoint","mixLine","mixRect","mixArc","mixPlane"].map((h,f)=>{const g=[" Point"," Line"," Rect"," Arc"," Plane"],m=["#888","#60c0ff","#ffd060","#ff80c0","#c0a0ff"];return d(h,g[f],m[f])})]}),(l.mode==="geometric"||l.mode==="hybrid")&&a.jsxs("div",{children:[a.jsx("div",{style:{...u,marginBottom:6,color:"rgba(255,200,100,0.6)"},children:"Composio & FX"}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:5},children:[d("shapeOpacity","Opacity","#ffffff"),d("fillSolidity","Fill Solid","#ffcc60"),d("strokeWeight","Stroke W.","#60d0ff"),d("shapeScale","Scale","#a0ffa0"),d("rotationDrift","Rot. Drift","#ff80ff"),d("bloomShape","Bloom","#80c0ff"),d("vignetteStr","Vignette","#888888"),d("grainStr","Grain","#cccccc")]})]}),(l.mode==="geometric"||l.mode==="hybrid")&&a.jsxs("div",{children:[a.jsxs("button",{title:o?"Fechar avanado":"Abrir avanado",onClick:()=>s(h=>!h),style:{width:"100%",background:"none",border:"1px solid rgba(255,255,255,0.07)",borderRadius:4,padding:"4px 8px",cursor:"pointer",color:"rgba(255,255,255,0.3)",fontSize:8,display:"flex",alignItems:"center",justifyContent:"space-between",letterSpacing:"0.08em"},children:[a.jsx("span",{children:"AVANADO"}),a.jsx("span",{children:o?"":""})]}),o&&a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:5,marginTop:8},children:[d("snapAxes","Snap Axes","#c0a0ff"),d("gridStrength","Grid Str.","#ffd060"),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[a.jsx("span",{style:{...u,width:62,marginBottom:0,textAlign:"right"},children:"Grid Size"}),a.jsx("input",{type:"range",min:8,max:80,step:4,value:l.gridSize,onChange:h=>t("gridSize",parseInt(h.target.value)),style:{flex:1,cursor:"pointer",accentColor:"#ffd060"}}),a.jsxs("span",{style:{fontSize:8,color:"rgba(255,255,255,0.4)",fontFamily:"monospace",minWidth:28,textAlign:"right"},children:[l.gridSize,"px"]})]}),d("lineMastery","Line Mst.","#60ff90"),d("planeCasting","Planes","#ff9060"),d("cutWindows","Cut Win.","#ff6060")]})]}),l.mode!=="3d"&&a.jsxs("div",{children:[a.jsx("div",{style:{...u,marginBottom:6},children:"Presets Geomtricos"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[{key:"constructive_score",name:"Constructive Score",desc:"Linhas longas + grade + tenso"},{key:"geometric_orchestra",name:"Geometric Orchestra",desc:"Arcos + diagonais + halos"},{key:"analytical_collage",name:"Analytical Collage",desc:"Recortes + planos + colagem"},{key:"spiritual_geometry",name:"Spiritual Geometry",desc:"Minimal + aura + silncio"}].map(({key:h,name:f,desc:g})=>a.jsxs("button",{title:f,onClick:()=>r(h),style:{textAlign:"left",padding:"6px 8px",borderRadius:1,cursor:"pointer",background:"rgba(255,0,132,0.04)",border:"1px solid rgba(255,0,132,0.15)",color:np,fontSize:8,fontFamily:Hr},children:[a.jsx("div",{style:{fontWeight:400,marginBottom:2,letterSpacing:"0.06em"},children:f}),a.jsx("div",{style:{fontSize:7,color:co},children:g})]},h))})]}),(l.mode==="geometric"||l.mode==="hybrid")&&a.jsx("div",{style:{fontSize:8,color:"rgba(255,255,255,0.22)",lineHeight:1.55,borderTop:"1px solid rgba(255,255,255,0.06)",paddingTop:8},children:l.mode==="geometric"?"Modo Geomtrico: quanta renderizam como primitivas (linha, arco, retngulo, plano). Compositor Gestalt aplica snap-de-eixos, grade, crescimento de linhas e planos translcidos.":"Modo Hbrido: traos fluidos + primitivas geomtricas sobrepostos. Atmosphere + halos ativos."})]})}function ZG({card:e,selected:t,onSelect:r,onFavorite:o,onPin:s,onDiscard:l,onMutateFrom:i}){return a.jsxs("div",{style:{border:`1px solid ${t?"rgba(255,0,132,0.3)":Oi}`,borderRadius:1,overflow:"hidden",cursor:"pointer",background:t?"rgba(255,0,132,0.04)":"rgba(255,255,255,0.01)"},children:[a.jsx("img",{src:e.thumbnail,alt:e.label,onClick:r,style:{width:"100%",aspectRatio:"1",display:"block",objectFit:"cover"}}),a.jsxs("div",{style:{padding:"4px 5px"},children:[a.jsx("div",{style:{fontSize:7,color:co,marginBottom:3,fontFamily:Hr,letterSpacing:"0.1em"},children:e.label}),a.jsxs("div",{style:{display:"flex",gap:3,justifyContent:"space-between"},children:[a.jsx("button",{onClick:o,title:"Favoritar",style:{...d5,color:e.favorite?Bi:co},children:a.jsx(OC,{size:9,strokeWidth:1.2})}),a.jsx("button",{onClick:s,title:"Pinnar DNA",style:{...d5,color:e.pinned?Bi:co},children:a.jsx(LC,{size:9,strokeWidth:1.2})}),a.jsx("button",{onClick:i,title:"Mutar a partir deste",style:{...d5},children:a.jsx(Ch,{size:9,strokeWidth:1.2})}),a.jsx("button",{onClick:l,title:"Descartar",style:{...d5},children:a.jsx(o0,{size:9,strokeWidth:1.2})})]})]})]})}const d5={background:"none",border:"none",cursor:"pointer",padding:0,color:co,display:"flex",alignItems:"center"},JG=({active:e})=>{const t=w.useRef(null),r=w.useRef(null),o=w.useRef(null),s=w.useRef(0),l=w.useRef(0),i=w.useRef(G0[0]),u=w.useRef([]),c=w.useRef(Ey()),d=w.useRef([]),h=w.useRef(Date.now()),f=w.useRef(0),[g,m]=w.useState(G0[0]),[y,v]=w.useState([]),[b,S]=w.useState(zS()),[C,k]=w.useState("dna"),[R,j]=w.useState(!1),[T,_]=w.useState(!1),[P,I]=w.useState([]),[$,q]=w.useState([]),[L,H]=w.useState([]),[G,oe]=w.useState(null),[le,pe]=w.useState(null),[ce,te]=w.useState(null),[F,Q]=w.useState({connections:!1,glow:!1,pulse:!1}),[ae,we]=w.useState({W:window.innerWidth,H:window.innerHeight}),[Re,ge]=w.useState(1),[Ae,tt]=w.useState(1),[We,J]=w.useState(0),[ke,Le]=w.useState("scatter"),[K,et]=w.useState(!1),[dt,Rt]=w.useState(!1),Wt=w.useRef([]),Zt=w.useRef([]),$e=w.useRef(null),Ze=w.useRef([]),[Fe,Xe]=w.useState(0),jt=w.useRef(zS()),hn=w.useRef(!1),an=w.useRef({connections:!1,glow:!1,pulse:!1}),it=w.useRef([]),[kt,On]=w.useState(l5()),sn=w.useRef(l5()),[Xn,Pt]=w.useState(()=>Array(36).fill(0)),[zt,jn]=w.useState(BS()),En=w.useRef(BS()),[lt,ht]=w.useState("molhado"),_t=w.useRef(tp[0]),[Ie,at]=w.useState(6),St=w.useRef(0),ye=w.useRef(1),xe=w.useRef(1),gt=w.useRef("scatter"),Ge=w.useRef(!1),Ye=w.useRef(!1),Ve=w.useRef(null),[Oe,Gt]=w.useState("idle"),[Kt,fn]=w.useState(0);w.useEffect(()=>(Ve.current=new Nh(Gt),()=>{var re;return(re=Ve.current)==null?void 0:re.dispose()}),[]),w.useEffect(()=>{if(Oe!=="recording")return;const re=setInterval(()=>{var de;return fn(((de=Ve.current)==null?void 0:de.elapsed)??0)},500);return()=>clearInterval(re)},[Oe]);const zn=w.useCallback(re=>{var Se;const de=i.current;(Se=Ve.current)==null||Se.start(()=>[t.current],()=>({labName:`Meta-Arte: ${de.name??"untitled"}`,lines:[`quanta:${de.genes.particleCount??"?"}  flow:${(de.genes.flowStrength??0).toFixed(2)}`]}),30,void 0,{format:(re==null?void 0:re.format)??"auto",quality:(re==null?void 0:re.quality)??"standard"})},[]),rt=w.useCallback(()=>{var re;(re=Ve.current)==null||re.stop()},[]),{status:mt,inputModeRef:yt,setInputMode:Et}=lG(),Ft=w.useRef({x:.5,y:.5}),me=w.useRef(null),[cn,Xt]=w.useState(!0),[Dt,ne]=w.useState({connected:!1,name:"",axes:{lx:0,ly:0,rx:0,ry:0},triggers:{lt:0,rt:0},buttons:{},justPressed:{},justReleased:{}}),[Ne,Ke]=w.useState(!1),Ct=w.useRef(cn);w.useEffect(()=>{Ct.current=cn},[cn]);const ft=w.useRef(0),At=["spawn_brush","erase_agents","ink_brush","attractor","repulsor","flow_comb","vortex","glyph_stamp"],bt=w.useRef(0),nn=T?0:92,Bt=T||C===null?0:240,Jt=Math.max(200,ae.W-nn-Bt),Qt=Math.max(200,ae.H-40-36);w.useEffect(()=>{const re=()=>we({W:window.innerWidth,H:window.innerHeight});return window.addEventListener("resize",re),()=>window.removeEventListener("resize",re)},[]),w.useEffect(()=>{i.current=g},[g]),w.useEffect(()=>{jt.current=b},[b]),w.useEffect(()=>{hn.current=R},[R]),w.useEffect(()=>{an.current=F},[F]),w.useEffect(()=>{ye.current=Re},[Re]),w.useEffect(()=>{xe.current=Ae},[Ae]),w.useEffect(()=>{gt.current=ke},[ke]),w.useEffect(()=>{Ge.current=K},[K]),w.useEffect(()=>{Ye.current=dt},[dt]),w.useEffect(()=>{sn.current=kt},[kt]),w.useEffect(()=>{En.current=zt},[zt]),w.useEffect(()=>{const re=tp.find(de=>de.id===lt)??tp[0];_t.current=re},[lt]);const en=w.useCallback((re,de)=>{const Se=Jt,qe=Qt;i.current=re,h.current=de;const st=Ey();Ty(st,re,de),st.interactionMatrix=V0(re,de),c.current=st,u.current=re.quantaCount>0?UH(re,de,gt.current):[];const $t=sn.current;$t.mode!=="fluid"&&u.current.length>0&&(Eu($t),kf(u.current,$t)),J(u.current.length),Pt(Array.from(st.interactionMatrix));const Tt=EH(Se,qe);d.current=Tt,v(Tt.map(Ut=>({...Ut})))},[Jt,Qt]);w.useEffect(()=>{e&&en(i.current,Date.now())},[e]),w.useEffect(()=>{if(!e)return;const re=Iv(),de=.013;let Se=!1,qe=!1,st=!1,$t=!1,Tt=!1,Ut=!1,ln=!1,wt=!1,mn=0;const un=()=>{s.current=requestAnimationFrame(un);const $n=t.current;if(!$n)return;const It=$n.getContext("2d");if(!It)return;const dn=$n.width,gn=$n.height,Sn=re.poll(),nr=cG(Sn,yt.current);if(Sn.connected){Ft.current.x=Math.max(0,Math.min(1,Ft.current.x+Sn.axes.lx*de)),Ft.current.y=Math.max(0,Math.min(1,Ft.current.y+Sn.axes.ly*de));const Bn=me.current;if(Bn&&(Bn.style.display=nr?"block":"none",Bn.style.left=`${Ft.current.x*100}%`,Bn.style.top=`${Ft.current.y*100}%`),nr){const ar=Ft.current.x,_o=Ft.current.y,Ar=jt.current;if(Sn.triggers.rt>.08){const Nn=Sn.triggers.rt,Vn=Math.max(1,Math.round(Nn*Ar.pressure*Ar.size*.12)),ir=Ar.size/Math.max(dn,gn)*.4,mr=Sn.axes.lx*.004*Nn,Gr=Sn.axes.ly*.004*Nn,Dr=DS(i.current,ar,_o,mr,Gr,Vn,ir,Ar.colorIndex),Rr=sn.current;Rr.mode!=="fluid"&&Dr.length>0&&(Eu(Rr),kf(Dr,Rr)),u.current=[...u.current,...Dr].slice(-4e3);const Ho=performance.now();Ho-mn>80&&(re.rumble(Nn*.2,40,.6,.4),mn=Ho)}if(Sn.triggers.lt>.2){const Nn=Ar.size/Math.max(dn,gn)*.65,Vn=Nn*Nn;u.current=u.current.filter(ir=>{const mr=ir.x-ar,Gr=ir.y-_o;return mr*mr+Gr*Gr>Vn})}if(Math.abs(Sn.axes.ry)>.15&&S(Nn=>{const Vn={...Nn,size:Math.max(5,Math.min(180,Nn.size-Sn.axes.ry*2))};return jt.current=Vn,Vn}),Sn.buttons.lb&&!$t&&(bt.current=(bt.current-1+At.length)%At.length,S(Nn=>{const Vn={...Nn,activeToolId:At[bt.current]};return jt.current=Vn,Vn}),re.rumble(.15,40,.5,.5)),Sn.buttons.rb&&!Tt&&(bt.current=(bt.current+1)%At.length,S(Nn=>{const Vn={...Nn,activeToolId:At[bt.current]};return jt.current=Vn,Vn}),re.rumble(.15,40,.5,.5)),Sn.buttons.dpadLeft&&!ln){const Nn=[...G0,...Cf];ft.current=(ft.current-1+Nn.length)%Nn.length,br(Nn[ft.current]),re.rumble(.12,35,.5,.5)}if(Sn.buttons.dpadRight&&!wt){const Nn=[...G0,...Cf];ft.current=(ft.current+1)%Nn.length,br(Nn[ft.current]),re.rumble(.12,35,.5,.5)}Sn.buttons.y&&!Ut&&(Tr(),re.rumble(.3,80,.4,.6)),Sn.buttons.a&&!qe&&Xt(Nn=>!Nn),Sn.buttons.start&&!Se&&Ke(Nn=>!Nn),Sn.buttons.select&&!st&&_(Nn=>!Nn),l.current%4===0&&ne({...Sn})}Se=Sn.buttons.start,qe=Sn.buttons.a,st=Sn.buttons.select,$t=Sn.buttons.lb,Tt=Sn.buttons.rb,Ut=Sn.buttons.y,ln=Sn.buttons.dpadLeft,wt=Sn.buttons.dpadRight}else{const Bn=me.current;Bn&&(Bn.style.display="none")}if(!hn.current){const Bn=ye.current;xe.current;const ar=Bn>=1?Math.max(1,Math.round(Bn)):1,_o=Bn<1?Bn:1,Ar=sn.current,Nn=Ar.mode;for(let ir=0;ir<ar;ir++){const mr=l.current+ir;bH(u.current,c.current,i.current,jt.current,dn,gn,mr,_o,Ge.current,sn.current.boundaryMode??"wrap",En.current),(Wt.current.length>0||Zt.current.length>0)&&kH(u.current,Wt.current,Zt.current),Nn!=="fluid"&&hG(u.current,Ar,dn,gn),mH(c.current,i.current)}l.current+=ar,Nn!=="fluid"&&(St.current++,St.current>=30&&(St.current=0,fG(u.current,Ar,dn,gn,l.current)));const Vn=l.current;if(Nn==="3d"){!o.current&&r.current&&(o.current=new FG(r.current),o.current.attachHandlers()),o.current&&(o.current.resize(dn,gn),o.current.render(u.current,i.current,Ar,dn,gn,Vn,an.current));for(const ir of d.current)ir.canvas&&ir.canvas.getContext("2d").clearRect(0,0,ir.canvas.width,ir.canvas.height)}else{const ir=U0(d.current,"trail");if(ir!=null&&ir.canvas){Nn==="geometric"?ir.canvas.getContext("2d").clearRect(0,0,ir.canvas.width,ir.canvas.height):FH(ir,i.current,_o);const yn=ir.canvas.getContext("2d");(Nn==="fluid"||Nn==="hybrid")&&wH(yn,u.current,i.current,dn,gn,Vn,xe.current,_t.current),Nn!=="fluid"&&Ar.macroAtmosphere>.05&&mG(yn,u.current,Ar,i.current.palette,dn,gn)}const mr=U0(d.current,"particles");if(mr!=null&&mr.canvas){mr.opacity=Nn==="geometric"?1:Nn==="hybrid"?.85:.18;const yn=mr.canvas.getContext("2d");Nn==="fluid"?LS(yn,u.current,i.current,dn,gn,xe.current,_t.current):Nn==="hybrid"?(LS(yn,u.current,i.current,dn,gn,xe.current*.35,_t.current),GS(yn,u.current,i.current,Ar,dn,gn,Vn)):(yn.clearRect(0,0,dn,gn),GS(yn,u.current,i.current,Ar,dn,gn,Vn))}const Gr=U0(d.current,"connections");if(Gr!=null&&Gr.canvas)if(an.current.connections){const yn=Gr.canvas.getContext("2d");CH(yn,u.current,i.current,dn,gn)}else Gr.canvas.getContext("2d").clearRect(0,0,dn,gn);const Dr=U0(d.current,"glow");if(Dr!=null&&Dr.canvas)if(Nn==="geometric")Dr.canvas.getContext("2d").clearRect(0,0,dn,gn);else if(an.current.glow&&Vn%2===0){const yn=Dr.canvas.getContext("2d");MH(yn,u.current,i.current,dn,gn,xe.current)}else an.current.glow||Dr.canvas.getContext("2d").clearRect(0,0,dn,gn);const Rr=U0(d.current,"trail"),Ho=U0(d.current,"post");Ho!=null&&Ho.canvas&&(Nn==="geometric"?Ho.canvas.getContext("2d").clearRect(0,0,dn,gn):Rr&&Vn%8===0&&NH(Ho,Rr,i.current,dn,gn))}if(Vn%90===0){const ir=YH(c.current,u.current,f.current);f.current=ir.density,te(ir),J(u.current.length)}}IH(It,d.current,i.current.background,dn,gn);const Eo=sn.current;if(Eo.showBorder){It.save();const Bn=Eo.boundaryMode??"wrap",ar=Bn==="bounce"?"rgba(60,140,255,0.7)":Bn==="absorb"?"rgba(255,80,60,0.7)":Bn==="open"?"rgba(255,255,255,0.12)":"rgba(255,255,255,0.22)";if(It.strokeStyle=ar,It.lineWidth=Bn==="open"?1:2,It.globalAlpha=1,Bn==="wrap"?It.setLineDash([6,5]):It.setLineDash([]),It.strokeRect(1,1,dn-2,gn-2),Bn!=="open"){It.lineWidth=1,It.globalAlpha=.55;const _o=16;[[0,0],[dn,0],[0,gn],[dn,gn]].forEach(([Ar,Nn])=>{const Vn=Ar===0?1:-1,ir=Nn===0?1:-1;It.beginPath(),It.moveTo(Ar+Vn*_o,Nn),It.lineTo(Ar,Nn),It.lineTo(Ar,Nn+ir*_o),It.stroke()})}It.setLineDash([]),It.restore()}const ro=l.current;if((Wt.current.length>0||Zt.current.length>0)&&RH(It,Wt.current,Zt.current,dn,gn,ro),$e.current){const Bn=$e.current;It.save(),It.strokeStyle=Bn.type==="pinch"?"#a060ff":"#40b0ff",It.lineWidth=1.2,It.globalAlpha=.6,It.setLineDash([5,4]),It.beginPath(),It.moveTo(Bn.x1*dn,Bn.y1*gn),It.lineTo(Bn.x2*dn,Bn.y2*gn),It.stroke(),It.setLineDash([]),It.globalAlpha=.8,It.fillStyle=It.strokeStyle,It.beginPath(),It.arc(Bn.x1*dn,Bn.y1*gn,3,0,Math.PI*2),It.fill(),It.beginPath(),It.arc(Bn.x2*dn,Bn.y2*gn,3,0,Math.PI*2),It.fill(),It.restore()}if(Ze.current.length>1){It.save(),It.strokeStyle="rgba(255,255,255,0.4)",It.lineWidth=1.2,It.setLineDash([3,4]),It.lineCap="round",It.beginPath(),It.moveTo(Ze.current[0][0]*dn,Ze.current[0][1]*gn);for(let Bn=1;Bn<Ze.current.length;Bn++)It.lineTo(Ze.current[Bn][0]*dn,Ze.current[Bn][1]*gn);It.stroke(),It.setLineDash([]),It.restore()}AH(It,jt.current,dn,gn,ro)};return s.current=requestAnimationFrame(un),()=>{cancelAnimationFrame(s.current),o.current&&(o.current.detachHandlers(),o.current.dispose(),o.current=null)}},[e]);const vn=w.useCallback((re,de,Se,qe,st,$t)=>{const Tt=jt.current;if(Tt.activeToolId==="spawn_brush"){const Ut=re/st,ln=de/$t,wt=re-Se,mn=de-qe,un=Math.sqrt(wt*wt+mn*mn)+.001,$n=Tt.pressure*.007,It=wt/un*$n,dn=mn/un*$n,gn=Math.max(1,Math.round(Tt.pressure*Tt.size*.18)),Sn=Tt.size/Math.max(st,$t)*.55,nr=DS(i.current,Ut,ln,It,dn,gn,Sn,Tt.colorIndex),Eo=sn.current;Eo.mode!=="fluid"&&nr.length>0&&(Eu(Eo),kf(nr,Eo)),u.current=[...u.current,...nr].slice(-4e3),J(u.current.length)}else if(Tt.activeToolId==="erase_agents"){const Ut=re/st,ln=de/$t,wt=Tt.size/Math.max(st,$t)*.75,mn=wt*wt,un=u.current.length;u.current=u.current.filter($n=>{const It=$n.x-Ut,dn=$n.y-ln;return It*It+dn*dn>mn}),u.current.length!==un&&J(u.current.length)}},[]),Wn=w.useCallback(re=>{re.currentTarget.setPointerCapture(re.pointerId);const de=re.currentTarget.getBoundingClientRect(),Se=re.clientX-de.left,qe=re.clientY-de.top,st=re.currentTarget.width||Jt,$t=re.currentTarget.height||Qt;S(Tt=>{const Ut={...Tt,isDragging:!0,lastX:Se,lastY:qe};return jt.current=Ut,(Tt.activeToolId==="spawn_brush"||Tt.activeToolId==="erase_agents")&&vn(Se,qe,Se,qe,st,$t),["attractor","repulsor","flow_comb","vortex","solve","coagula"].includes(Tt.activeToolId)&&NS(c.current,Se/st,qe/$t,Tt.size/Math.max(st,$t),Tt.activeToolId,Tt.pressure,Math.atan2(0,1)),(Tt.activeToolId==="flow_paint"||Tt.activeToolId==="pinch")&&($e.current={x1:Se/st,y1:qe/$t,x2:Se/st,y2:qe/$t,type:Tt.activeToolId==="flow_paint"?"flow":"pinch"}),Tt.activeToolId==="channel"&&(Ze.current=[[Se/st,qe/$t]]),["ink_brush","dust_brush","glow_brush","eraser","mask_brush","glyph_stamp"].includes(Tt.activeToolId),it.current.push({toolId:Tt.activeToolId,x:Se,y:qe,size:Tt.size,timestamp:Date.now()}),it.current.length>100&&it.current.shift(),Ut})},[Jt,Qt,vn]),Gn=w.useCallback(re=>{if(!jt.current.isDragging)return;const de=re.currentTarget.getBoundingClientRect(),Se=re.clientX-de.left,qe=re.clientY-de.top,st=jt.current.lastX,$t=jt.current.lastY,Tt=re.currentTarget.width||Jt,Ut=re.currentTarget.height||Qt;S(ln=>{const wt=Se-st,mn=qe-$t,un=Math.sqrt(wt*wt+mn*mn)+1e-4,$n={...ln,lastX:Se,lastY:qe,dragDX:wt/un,dragDY:mn/un};if(jt.current=$n,(ln.activeToolId==="spawn_brush"||ln.activeToolId==="erase_agents")&&vn(Se,qe,st,$t,Tt,Ut),["attractor","repulsor","flow_comb","vortex","solve","coagula"].includes(ln.activeToolId)){const It=Math.atan2(qe-$t,Se-st);NS(c.current,Se/Tt,qe/Ut,ln.size/Math.max(Tt,Ut),ln.activeToolId,ln.pressure*.5,It)}if((ln.activeToolId==="flow_paint"||ln.activeToolId==="pinch")&&$e.current&&($e.current.x2=Se/Tt,$e.current.y2=qe/Ut),ln.activeToolId==="channel"&&Ze.current.length>0){const It=Ze.current[Ze.current.length-1],dn=Se/Tt-It[0],gn=qe/Ut-It[1];dn*dn+gn*gn>3e-5&&Ze.current.push([Se/Tt,qe/Ut])}return $n})},[Jt,Qt,vn]),cr=w.useCallback(()=>{const re=jt.current;if((re.activeToolId==="flow_paint"||re.activeToolId==="pinch")&&$e.current){const de=$e.current,Se=de.x2-de.x1,qe=de.y2-de.y1;if(Se*Se+qe*qe>.001){const st=i.current.palette[jt.current.colorIndex%i.current.palette.length]??"#40b0ff";Wt.current.push({id:`gl-${Date.now()}-${Math.random().toString(36).slice(2,6)}`,x1:de.x1,y1:de.y1,x2:de.x2,y2:de.y2,type:de.type,color:st,strength:re.pressure}),Xe(Wt.current.length+Zt.current.length)}$e.current=null}if(re.activeToolId==="channel"&&Ze.current.length>2){const de=i.current.palette[jt.current.colorIndex%i.current.palette.length]??"#40b0ff";Zt.current.push({id:`ch-${Date.now()}-${Math.random().toString(36).slice(2,6)}`,points:[...Ze.current],color:de,strength:re.pressure}),Xe(Wt.current.length+Zt.current.length)}Ze.current=[],S(de=>{const Se={...de,isDragging:!1};return jt.current=Se,Se})},[]),pr=w.useCallback(re=>{if(m(re),i.current=re,re.quantaCount!==u.current.length){if(re.quantaCount>u.current.length){const de=xH({...re,quantaCount:re.quantaCount-u.current.length},h.current+Date.now());u.current=[...u.current,...de]}else u.current=u.current.slice(0,re.quantaCount);J(u.current.length)}},[]),br=w.useCallback(re=>{const de={...re};pr(de),Ty(c.current,de,h.current);const Se=V0(de,h.current);c.current.interactionMatrix=Se,Pt(Array.from(Se)),q(qe=>Fc(qe,`DNA: ${re.name??"?"}`,"milestone"))},[pr]),hr=w.useCallback((re,de)=>{On(Se=>{const qe={...Se,[re]:de};Eu(qe),sn.current=qe;const st=re;return(st==="mode"||st.startsWith("mix")||st==="macroAtmosphere")&&u.current.length>0&&(qe.mode==="fluid"?uG(u.current):kf(u.current,qe)),st==="mode"&&de!=="3d"&&o.current&&(o.current.detachHandlers(),o.current.dispose(),o.current=null),qe})},[]),or=w.useCallback((re,de)=>{const Se=pG[re];if(!Se)return;const qe={...l5(),...Se};Eu(qe),sn.current=qe,On(qe),qe.mode!=="3d"&&o.current&&(o.current.detachHandlers(),o.current.dispose(),o.current=null),de?(m(de),en(de,Date.now())):u.current.length>0&&qe.mode!=="fluid"&&kf(u.current,qe)},[en]),uo=w.useCallback(()=>{const re=Q$();if(!re){q(qe=>Fc(qe,"Nenhum snapshot do MusicLab encontrado","observation")),k("dna");return}const de=nq(re);Q(de.overlays);const Se={...l5(),...de.geo};Eu(Se),sn.current=Se,On(Se),Se.mode!=="3d"&&o.current&&(o.current.detachHandlers(),o.current.dispose(),o.current=null),m(de.dna),en(de.dna,de.seed),k("dna"),q(qe=>Fc(qe,`Importado do MusicLab: ${re.preset.name}  ${re.preset.bpm}bpm  ${re.preset.root} ${re.preset.scale}`,"milestone"))},[en]),fr=w.useCallback(re=>{const de=re.length>0?re:ER(i.current,.28,8),Se=de.map((qe,st)=>({id:`vit-${Date.now()}-${st}`,dna:qe,thumbnail:$H(qe,96),pinned:!1,favorite:!1,seed:h.current+st*7919,label:`M${st+1}`}));H(Se),k("vitrine"),q(qe=>Fc(qe,`${de.length} variantes geradas`,"suggestion"))},[]),Tr=w.useCallback(()=>{const re=sn.current.mode==="3d"?r.current??t.current:t.current;if(!re)return;const de=DH(re,i.current,h.current,it.current);I(Se=>[de,...Se].slice(0,50)),k("archive"),q(Se=>Fc(Se,"snapshot capturado","milestone"))},[]),Ir=w.useCallback(()=>{for(const de of d.current)de.canvas&&(de.id==="trail"||de.id==="brush")&&de.canvas.getContext("2d").clearRect(0,0,de.canvas.width,de.canvas.height);const re=Ey();Ty(re,i.current,h.current),re.interactionMatrix=V0(i.current,h.current),c.current=re,Pt(Array.from(re.interactionMatrix)),q(de=>Fc(de,"tela limpa  reincio do gesto","observation"))},[]),jo=w.useCallback((re,de)=>{d.current=d.current.map(Se=>Se.id===re?{...Se,...de}:Se),v(d.current.map(Se=>({...Se})))},[]),bo=w.useCallback(re=>{const de=U0(d.current,re);de&&TH(de)},[]),vo=w.useCallback(re=>{oe(re.id),pr(re.dna)},[pr]),Zo=w.useCallback(re=>{H(de=>{const Se=de.find(qe=>qe.id===re);return Se&&pe(Se.dna),de.map(qe=>qe.id===re?{...qe,pinned:!qe.pinned}:qe)})},[]),Jo=w.useCallback(re=>{pr(re.dna),h.current=re.seed,q(de=>Fc(de,"snapshot restaurado","observation"))},[pr]),Ua=w.useCallback(()=>{const re=iH();m(re),en(re,Date.now()),q(de=>Fc(de,"DNA completamente aleatorio gerado","milestone"))},[en]),Na=w.useCallback(()=>{const re=i.current,de=t.current;de==null||de.width,de==null||de.height;const Se=re.palette,qe=Math.floor(Math.random()*Se.length),st=Se[qe]??"#ff88cc",[$t,Tt,Ut]=window.__metaHexToHSL?window.__metaHexToHSL(st):[300,.8,.6],ln=parseInt(st.slice(1,3),16)/255,wt=parseInt(st.slice(3,5),16)/255,mn=parseInt(st.slice(5,7),16)/255,un=Math.max(ln,wt,mn),$n=Math.min(ln,wt,mn);let It=0;const dn=un-$n;dn!==0&&(un===ln?It=((wt-mn)/dn+(wt<mn?6:0))/6:un===wt?It=((mn-ln)/dn+2)/6:It=((ln-wt)/dn+4)/6);const gn=(un+$n)/2,Sn=un===$n?0:gn>.5?dn/(2-un-$n):dn/(un+$n),nr={x:.5+(Math.random()-.5)*.1,y:.5+(Math.random()-.5)*.1,vx:(Math.random()-.5)*.004,vy:(Math.random()-.5)*.004,charge:.5,ink:1,mood:.5,role:"DRAW",species:qe%6,memX:new Float32Array([.5,.5,.5,.5,.5,.5]),memY:new Float32Array([.5,.5,.5,.5,.5,.5]),memIdx:0,age:0,hue:It*360,sat:Sn,lit:gn,alpha:1,size:Ie*3,glyphIndex:0,isSingleton:!0,angle:0};u.current=[...u.current,nr],J(u.current.length)},[Jt,Qt,Ie]),sa=w.useCallback((re,de)=>{const Se=parseInt(de.slice(1,3),16)/255,qe=parseInt(de.slice(3,5),16)/255,st=parseInt(de.slice(5,7),16)/255,$t=Math.max(Se,qe,st),Tt=Math.min(Se,qe,st);let Ut=0;const ln=$t-Tt;ln!==0&&($t===Se?Ut=((qe-st)/ln+(qe<st?6:0))/6:$t===qe?Ut=((st-Se)/ln+2)/6:Ut=((Se-qe)/ln+4)/6);const wt=($t+Tt)/2,mn=$t===Tt?0:wt>.5?ln/(2-$t-Tt):ln/($t+Tt),un=[...i.current.palette];un[re%un.length]=de;const $n={...i.current,palette:un};m($n),i.current=$n;for(const It of u.current)It.species===re&&(It.hue=Ut*360+(Math.random()-.5)*8,It.sat=Math.max(.2,Math.min(1,mn+(Math.random()-.5)*.05)),It.lit=Math.max(.15,Math.min(.85,wt+(Math.random()-.5)*.04)))},[]),So=w.useCallback(re=>{const de={...i.current,genes:{...i.current.genes,agentShape:re}};m(de),i.current=de},[]),Oo=w.useCallback(()=>{const re=i.current.genes.entropy,de={...i.current,genes:{...i.current.genes,entropy:.98}};m(de),i.current=de,setTimeout(()=>{const Se={...i.current,genes:{...i.current.genes,entropy:re}};m(Se),i.current=Se},2e3)},[]),U=w.useCallback(()=>{for(const re of u.current)re.vx=0,re.vy=0},[]),je=w.useCallback(()=>{for(const re of u.current){const de=Math.random()*Math.PI*2,Se=.012+Math.random()*.018;re.vx+=Math.cos(de)*Se,re.vy+=Math.sin(de)*Se}},[]),W=w.useCallback(()=>{for(const re of u.current)re.vx-=(.5-re.x)*.04,re.vy-=(.5-re.y)*.04},[]),X=w.useCallback(re=>{for(const qe of u.current)qe.hue=(qe.hue+re+360)%360;const de=i.current.palette.map(qe=>{const st=parseInt(qe.slice(1,3),16)/255,$t=parseInt(qe.slice(3,5),16)/255,Tt=parseInt(qe.slice(5,7),16)/255,Ut=Math.max(st,$t,Tt),ln=Math.min(st,$t,Tt);let wt=0;const mn=Ut-ln;mn!==0&&(Ut===st?wt=(($t-Tt)/mn+($t<Tt?6:0))*60:Ut===$t?wt=((Tt-st)/mn+2)*60:wt=((st-$t)/mn+4)*60);const un=(wt+re+360)%360,$n=(Ut+ln)/2,It=Ut===ln?0:$n>.5?mn/(2-Ut-ln):mn/(Ut+ln),dn=un/360,gn=It,Sn=$n,nr=(Ar,Nn,Vn)=>(Vn<0&&(Vn+=1),Vn>1&&(Vn-=1),Vn<1/6?Ar+(Nn-Ar)*6*Vn:Vn<1/2?Nn:Vn<2/3?Ar+(Nn-Ar)*(2/3-Vn)*6:Ar),Eo=Sn<.5?Sn*(1+gn):Sn+gn-Sn*gn,ro=2*Sn-Eo,Bn=Math.round(nr(ro,Eo,dn+1/3)*255),ar=Math.round(nr(ro,Eo,dn)*255),_o=Math.round(nr(ro,Eo,dn-1/3)*255);return`#${Bn.toString(16).padStart(2,"0")}${ar.toString(16).padStart(2,"0")}${_o.toString(16).padStart(2,"0")}`}),Se={...i.current,palette:de};m(Se),i.current=Se},[]),Te=w.useCallback(re=>{for(const de of u.current)de.sat=Math.max(.05,Math.min(1,de.sat+re))},[]),He=w.useCallback(re=>{for(const de of u.current)de.lit=Math.max(.05,Math.min(.95,de.lit+re))},[]),he=w.useCallback(re=>{for(const de of u.current)de.size=Math.max(.3,Math.min(30,de.size*re))},[]),fe=w.useCallback((re,de)=>{const Se={...i.current,genes:{...i.current.genes,[re]:de}};if(m(Se),i.current=Se,re==="isolation"){const qe=V0(Se,h.current,de>.5);c.current.interactionMatrix=qe,Pt(Array.from(qe))}},[]),be=w.useCallback((re,de,Se)=>{c.current.interactionMatrix[re*6+de]=Se,Pt(qe=>{const st=[...qe];return st[re*6+de]=Se,st})},[]),Ee=w.useCallback(()=>{const re=V0(i.current,Date.now());c.current.interactionMatrix=re,Pt(Array.from(re))},[]),Me=w.useCallback(()=>{const re=c.current.interactionMatrix,de=Array.from(re);for(let Se=0;Se<6;Se++)for(let qe=Se+1;qe<6;qe++){const st=(re[Se*6+qe]+re[qe*6+Se])/2;re[Se*6+qe]=st,re[qe*6+Se]=st,de[Se*6+qe]=st,de[qe*6+Se]=st}Pt(de)},[]),_e=w.useCallback(()=>{const re=V0(i.current,h.current);c.current.interactionMatrix=re,Pt(Array.from(re))},[]),Je=w.useCallback(re=>{const de=new Float32Array(36);switch(re){case"chaos":for(let Se=0;Se<6;Se++)for(let qe=0;qe<6;qe++)de[Se*6+qe]=Se===qe?0:-(.4+Math.random()*.4);break;case"harmony":for(let Se=0;Se<6;Se++)for(let qe=0;qe<6;qe++)de[Se*6+qe]=.25+Math.random()*.45;break;case"predator":for(let Se=0;Se<6;Se++)for(let qe=0;qe<6;qe++){const st=(qe-Se+6)%6;st===0?de[Se*6+qe]=.55:st===1?de[Se*6+qe]=.7:st===5?de[Se*6+qe]=-.6:de[Se*6+qe]=(Math.random()-.5)*.2}break;case"bubbles":for(let Se=0;Se<6;Se++)for(let qe=0;qe<6;qe++)de[Se*6+qe]=Se===qe?.7+Math.random()*.25:-(.35+Math.random()*.3);break}c.current.interactionMatrix=de,Pt(Array.from(de))},[]),Vt=w.useCallback(re=>{Q(de=>{const Se={...de,[re]:!de[re]};return an.current=Se,Se})},[]);if(!e)return null;const rn=mg.find(re=>re.id===b.activeToolId),pn=re=>({...vs,color:re?np:co,background:re?"rgba(255,0,132,0.06)":"transparent",borderBottom:re?`1px solid ${Bi}`:"1px solid transparent",borderRadius:1,padding:"3px 5px"});return a.jsxs("div",{style:{position:"fixed",inset:0,zIndex:5,display:"flex",flexDirection:"column",paddingTop:T?0:36,background:qy,fontFamily:Hr},children:[!T&&a.jsxs("div",{style:{height:38,display:"flex",alignItems:"center",gap:5,padding:"0 12px",borderBottom:`1px solid ${Oi}`,background:qy,flexShrink:0,zIndex:2},children:[a.jsxs("select",{value:"",onChange:re=>{const de=re.target.value,Se={"Nebula Drift":"nebula_drift","Crystal Lattice":"crystal_lattice","Void Bloom":"void_bloom","Solar Wind":"solar_wind","Quantum Foam":"quantum_foam","Deep Field":"deep_field","Rizoma 3D":"rhizome_3d"};if(Se[de]){or(Se[de]);return}const st=[...G0,...Cf,...PS].find($t=>$t.name===de);if(st){br(st);const Tt={"Constructive Score":"constructive_score","Geometric Orchestra":"geometric_orchestra","Analytical Collage":"analytical_collage","Spiritual Geometry":"spiritual_geometry"}[st.name??""];Tt&&or(Tt)}},style:{background:Wy,border:`1px solid ${Oi}`,color:JS,fontSize:9,padding:"3px 8px",borderRadius:2,cursor:"pointer",fontFamily:Hr,letterSpacing:"0.04em"},children:[a.jsx("option",{value:"",children:"PRESET"}),a.jsx("optgroup",{label:"Principais",children:G0.map(re=>a.jsx("option",{value:re.name??"",children:re.name},re.name))}),a.jsx("optgroup",{label:"Extra",children:Cf.map(re=>a.jsx("option",{value:re.name??"",children:re.name},re.name))}),a.jsx("optgroup",{label:" Geomtrico",children:PS.map(re=>a.jsxs("option",{value:re.name??"",children:[" ",re.name]},re.name))}),a.jsx("optgroup",{label:" 3D",children:["Nebula Drift","Crystal Lattice","Void Bloom","Solar Wind","Quantum Foam","Deep Field","Rizoma 3D"].map(re=>a.jsxs("option",{value:re,children:[" ",re]},re))})]}),a.jsx("select",{value:ke,onChange:re=>{const de=re.target.value;Le(de),gt.current=de},title:"Padro inicial dos agentes",style:{background:Wy,border:`1px solid ${Oi}`,color:co,fontSize:8,padding:"3px 6px",borderRadius:2,cursor:"pointer",maxWidth:90,fontFamily:Hr,letterSpacing:"0.04em"},children:Object.entries(VH).map(([re,de])=>a.jsx("option",{value:re,children:de},re))}),a.jsx(Af,{}),a.jsx("button",{onClick:()=>j(re=>!re),title:R?"Continuar":"Pausar",style:vs,children:R?a.jsx(wl,{size:12,strokeWidth:1.5}):a.jsx(s0,{size:12,strokeWidth:1.5})}),a.jsx("button",{onClick:Ir,title:"Limpar tela",style:vs,children:a.jsx(Wi,{size:12,strokeWidth:1.5})}),Fe>0&&a.jsxs("button",{onClick:()=>{Wt.current=[],Zt.current=[],Xe(0)},title:"Limpar guias e canais",style:{...vs,color:Bi,background:"rgba(255,0,132,0.06)",border:"1px solid rgba(255,0,132,0.2)",borderRadius:1,padding:"2px 6px"},children:[a.jsx(ya,{size:9,strokeWidth:1.2}),a.jsxs("span",{style:{fontSize:7,letterSpacing:"0.1em",fontFamily:Hr},children:["GUIAS (",Fe,")"]})]}),a.jsx("button",{onClick:()=>en(i.current,Date.now()),title:"Resetar simulao (novo seed, posies resetadas)",style:vs,children:a.jsx(Ch,{size:12,strokeWidth:1.5})}),a.jsx("button",{onClick:Ua,title:"Gerar DNA completamente aleatorio",style:{...vs,color:Bi},children:a.jsx("span",{style:{fontSize:8,letterSpacing:"0.08em",fontFamily:Hr},children:"RAND"})}),a.jsx("button",{onClick:()=>{const re=pg(Math.max(4,i.current.palette.length)),de={...i.current,palette:re};m(de),i.current=de,OS(u.current,re)},title:"Gerar paleta aleatoria e recolorir agentes",style:{...vs,color:"rgba(255,0,132,0.6)"},children:a.jsx("span",{style:{fontSize:8,letterSpacing:"0.08em",fontFamily:Hr},children:"CLR"})}),a.jsx(Af,{}),a.jsxs("select",{value:kt.boundaryMode??"wrap",onChange:re=>hr("boundaryMode",re.target.value),title:"Modo de bordas do canvas",style:{background:Wy,border:`1px solid ${Oi}`,color:co,fontSize:8,padding:"3px 6px",borderRadius:2,cursor:"pointer",fontFamily:Hr},children:[a.jsx("option",{value:"wrap",children:" Wrap"}),a.jsx("option",{value:"bounce",children:" Bounce"}),a.jsx("option",{value:"absorb",children:" Absorb"}),a.jsx("option",{value:"open",children:" Open"})]}),a.jsx("button",{onClick:()=>hr("showBorder",!kt.showBorder),title:"Exibir borda do canvas",style:{...vs,color:kt.showBorder?np:co,background:kt.showBorder?"rgba(255,0,132,0.06)":"transparent",borderRadius:1,padding:"2px 4px",borderBottom:kt.showBorder?`1px solid ${Bi}`:"1px solid transparent"},children:a.jsx("span",{style:{fontSize:8},children:""})}),a.jsx(Af,{}),a.jsxs("button",{onClick:()=>Vt("connections"),title:"Conexoes entre quanta",style:pn(F.connections),children:[a.jsx(_C,{size:12,strokeWidth:1.5}),a.jsx("span",{style:{fontSize:8,marginLeft:2},children:"CON"})]}),a.jsxs("button",{onClick:()=>Vt("glow"),title:"Brilho aditivo",style:pn(F.glow),children:[a.jsx(Es,{size:12,strokeWidth:1.5}),a.jsx("span",{style:{fontSize:8,marginLeft:2},children:"BRILHO"})]}),a.jsx(Af,{}),a.jsx("button",{onClick:uo,title:"Importar snapshot do MusicLab (gera capa)",style:{...vs,color:"rgba(55,178,218,0.65)"},children:a.jsx(Y5,{size:12,strokeWidth:1.5})}),a.jsx("button",{onClick:Tr,title:"Snapshot",style:vs,children:a.jsx(EC,{size:12,strokeWidth:1.5})}),a.jsx("button",{onClick:()=>{const re=sn.current.mode==="3d"?r.current??t.current:t.current;re&&qH(re,i.current.name??"metaarte-3d")},title:"Export PNG (captura canvas ativo  2D ou WebGL 3D)",style:vs,children:a.jsx(FC,{size:12,strokeWidth:1.5})}),a.jsx(Pp,{state:Oe,elapsed:Kt,onStart:zn,onStop:rt,showOptions:!0,className:"ml-1"}),a.jsx("button",{onClick:()=>WH(i.current,i.current.name??"recipe"),title:"Export DNA JSON",style:vs,children:a.jsx(X5,{size:12,strokeWidth:1.5})}),a.jsx(Af,{}),a.jsxs("span",{style:{fontSize:8,color:co,fontFamily:Hr,letterSpacing:"0.08em"},children:["Q:",a.jsx("span",{style:{color:We===0?Bi:JS,marginLeft:2},children:We})]}),a.jsx("div",{style:{flex:1}}),a.jsx("span",{style:{fontSize:9,color:co,letterSpacing:"0.1em",fontFamily:Hr,textTransform:"uppercase"},children:g.name??"custom"}),a.jsx("button",{onClick:()=>_(re=>!re),title:"Modo Cinematico",style:vs,children:a.jsx(DC,{size:12,strokeWidth:1.5})}),[["layers",a.jsx(mh,{size:11,strokeWidth:1.2},"l"),"LYR"],["dna",a.jsx(X5,{size:11,strokeWidth:1.2},"d"),"DNA"],["archive",a.jsx(Tj,{size:11,strokeWidth:1.2},"a"),"ARC"],["vitrine",null,"VIT"],["matrix",a.jsx(D9,{size:11,strokeWidth:1.2},"m"),"MTX"],["physics",null,"PHY"],["powers",null,"PWR"],["geo",null,"GEO"]].map(([re,de,Se])=>a.jsxs("button",{title:re,onClick:()=>k(qe=>qe===re?null:re),style:{...vs,color:C===re?np:co,background:C===re?"rgba(255,0,132,0.08)":"transparent",borderBottom:C===re?`1px solid ${Bi}`:"1px solid transparent",borderRadius:1,fontFamily:Hr,fontSize:7,letterSpacing:"0.12em",padding:"4px 5px",gap:3},children:[de,a.jsx("span",{children:Se})]},re))]}),T&&a.jsxs("button",{title:"Sair modo cinema",onClick:()=>_(!1),style:{position:"absolute",top:10,right:10,zIndex:100,background:"rgba(0,0,0,0.7)",border:`1px solid ${Oi}`,borderRadius:2,padding:"4px 10px",cursor:"pointer",color:co,display:"flex",alignItems:"center",gap:4,fontSize:8,fontFamily:Hr,letterSpacing:"0.12em",textTransform:"uppercase"},children:[a.jsx(ya,{size:10,strokeWidth:1.2})," EXIT"]}),a.jsxs("div",{style:{flex:1,display:"flex",overflow:"hidden"},children:[!T&&a.jsx(eG,{toolState:b,palette:g.palette,onToolChange:re=>S(de=>{const Se={...de,...re};return jt.current=Se,Se}),agentShape:g.genes.agentShape??"circle",onAgentShape:re=>{const de={...g,genes:{...g.genes,agentShape:re}};m(de),i.current=de},brushTextureId:lt,onBrushTexture:re=>ht(re),onSpawnSingleton:Na,singletonSize:Ie,onSingletonSize:at,sizeMul:Ae,onSizeMul:re=>{tt(re),xe.current=re},simSpeed:Re,onSimSpeed:re=>{ge(re),ye.current=re},staticAgents:K,onStaticAgents:()=>et(re=>(Ge.current=!re,!re)),isolatedSpecies:dt,onIsolated:()=>{const re=!Ye.current;Rt(re),Ye.current=re;const de=V0(i.current,h.current,re);c.current.interactionMatrix=de,Pt(Array.from(de))},linear:(g.genes.linear??0)>.5,onLinear:()=>{const re=g.genes.linear??0,de={...g,genes:{...g.genes,linear:re>.5?0:1}};m(de),i.current=de},geoMode:kt.mode,onGeoMode:re=>hr("mode",re),geoPanelOpen:C==="geo",onToggleGeoPanel:()=>k(re=>re==="geo"?null:"geo")}),a.jsxs("div",{style:{flex:1,position:"relative",overflow:"hidden"},children:[a.jsx("canvas",{ref:t,width:Jt,height:Qt,style:{display:"block",width:"100%",height:"100%",cursor:(rn==null?void 0:rn.cursor)??"crosshair",visibility:kt.mode==="3d"?"hidden":"visible",position:"absolute",inset:0},onPointerDown:Wn,onPointerMove:Gn,onPointerUp:cr,onPointerLeave:cr}),a.jsx("canvas",{ref:r,style:{display:"block",width:"100%",height:"100%",position:"absolute",inset:0,pointerEvents:kt.mode==="3d"?"auto":"none",opacity:kt.mode==="3d"?1:0,transition:"opacity 0.35s ease",background:"transparent"}}),kt.mode==="3d"&&!T&&a.jsxs("div",{style:{position:"absolute",top:10,left:"50%",transform:"translateX(-50%)",display:"flex",alignItems:"center",gap:6},children:[a.jsxs("div",{style:{padding:"4px 12px",borderRadius:1,background:"rgba(0,0,0,0.6)",border:`1px solid ${Oi}`,fontSize:7,color:co,letterSpacing:"0.12em",textTransform:"uppercase",display:"flex",alignItems:"center",gap:7,pointerEvents:"none",fontFamily:Hr},children:[a.jsx(Y5,{size:10,strokeWidth:1.2}),a.jsx("span",{children:"3D  DRAG=ORBIT  SCROLL=ZOOM"})]}),a.jsxs("button",{onClick:()=>{var re;return(re=o.current)==null?void 0:re.resetCamera()},title:"Reset cmera",style:{padding:"3px 8px",borderRadius:1,cursor:"pointer",background:"rgba(0,0,0,0.6)",border:`1px solid ${Oi}`,fontSize:7,color:co,letterSpacing:"0.1em",textTransform:"uppercase",display:"flex",alignItems:"center",gap:4,fontFamily:Hr},children:[a.jsx(Wi,{size:9,strokeWidth:1.2}),a.jsx("span",{children:"CAM"})]})]}),kt.mode==="3d"&&kt.showBorder&&(()=>{const re=kt.boundaryMode??"wrap",de=re==="bounce"?"rgba(60,140,255,0.7)":re==="absorb"?"rgba(255,80,60,0.7)":re==="open"?"rgba(255,255,255,0.12)":"rgba(255,255,255,0.22)",Se=re==="open"?1:2,qe=re==="wrap",st=re!=="open",$t=16,Tt=[{top:0,left:0,bt:Se,bl:Se,bb:0,br:0},{top:0,right:0,bt:Se,br:Se,bb:0,bl:0},{bottom:0,left:0,bb:Se,bl:Se,bt:0,br:0},{bottom:0,right:0,bb:Se,br:Se,bt:0,bl:0}];return a.jsxs("div",{style:{position:"absolute",inset:0,pointerEvents:"none",zIndex:5},children:[a.jsx("div",{style:{position:"absolute",inset:1,border:`${Se}px ${qe?"dashed":"solid"} ${de}`,boxSizing:"border-box"}}),st&&Tt.map((Ut,ln)=>a.jsx("div",{style:{position:"absolute",width:$t,height:$t,...Ut.top!==void 0?{top:Ut.top}:{},...Ut.bottom!==void 0?{bottom:Ut.bottom}:{},...Ut.left!==void 0?{left:Ut.left}:{},...Ut.right!==void 0?{right:Ut.right}:{},borderTop:Ut.bt>0?`${Ut.bt}px solid ${de}`:"none",borderBottom:Ut.bb>0?`${Ut.bb}px solid ${de}`:"none",borderLeft:Ut.bl>0?`${Ut.bl}px solid ${de}`:"none",borderRight:Ut.br>0?`${Ut.br}px solid ${de}`:"none",opacity:.55}},ln)),a.jsx("div",{style:{position:"absolute",bottom:6,left:"50%",transform:"translateX(-50%)",padding:"2px 8px",borderRadius:8,background:re==="bounce"?"rgba(30,80,200,0.18)":re==="absorb"?"rgba(200,40,30,0.18)":"rgba(255,255,255,0.06)",border:`1px solid ${de}`,fontSize:7,color:de,letterSpacing:"0.12em",textTransform:"uppercase"},children:re})]},"3d-border-overlay")})(),!T&&a.jsx("div",{style:{position:"absolute",bottom:10,left:"50%",transform:"translateX(-50%)",pointerEvents:"none"},children:a.jsxs("div",{style:{padding:"4px 14px",borderRadius:1,background:"rgba(0,0,0,0.6)",border:`1px solid ${Oi}`,fontSize:8,color:co,letterSpacing:"0.1em",fontFamily:Hr,textTransform:"uppercase"},children:[rn==null?void 0:rn.name,"  ",rn==null?void 0:rn.description]})}),ce&&!T&&a.jsx("div",{style:{position:"absolute",bottom:10,right:10,display:"flex",flexDirection:"column",gap:3,pointerEvents:"none"},children:[{label:"DENS",v:ce.density,c:"rgba(255,255,255,0.4)"},{label:"CNTR",v:ce.contrast,c:"rgba(255,255,255,0.3)"},{label:"SLNC",v:ce.silenceIndex,c:"rgba(255,255,255,0.25)"}].map(({label:re,v:de,c:Se})=>a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[a.jsx("span",{style:{fontSize:7,color:co,width:28,textAlign:"right",letterSpacing:"0.1em",fontFamily:Hr},children:re}),a.jsx("div",{style:{width:50,height:1,background:"rgba(255,255,255,0.06)"},children:a.jsx("div",{style:{width:`${de*100}%`,height:"100%",background:Se,transition:"width 0.5s"}})})]},re))}),!T&&(F.connections||F.glow)&&a.jsxs("div",{style:{position:"absolute",top:8,right:8,display:"flex",flexDirection:"column",gap:2,pointerEvents:"none"},children:[F.connections&&a.jsx("div",{style:{fontSize:7,color:co,letterSpacing:"0.12em",fontFamily:Hr},children:"CON "}),F.glow&&a.jsx("div",{style:{fontSize:7,color:co,letterSpacing:"0.12em",fontFamily:Hr},children:"GLOW "})]}),a.jsx(dG,{cursorRef:me}),a.jsx(rR,{ctrl:Dt,toolName:(rn==null?void 0:rn.name)??"",presetName:g.name??"",radius:b.size/180,intensity:Dt.triggers.rt,quantaCount:We,showHUD:cn}),mt.connected&&a.jsxs("div",{style:{position:"absolute",top:8,left:8,display:"flex",alignItems:"center",gap:5,zIndex:20},children:[a.jsx("div",{style:{width:5,height:5,borderRadius:"50%",background:"rgba(80,220,120,0.7)",flexShrink:0}}),a.jsx("span",{style:{fontSize:7,color:"rgba(80,220,120,0.55)",letterSpacing:"0.08em"},children:"CTRL"}),a.jsx("button",{onClick:()=>{const re=["auto","controller","mouse"],de=yt.current,Se=re[(re.indexOf(de)+1)%re.length];Et(Se)},title:"Modo de input: auto / controller / mouse",style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(80,220,120,0.3)",borderRadius:3,padding:"1px 5px",cursor:"pointer",fontSize:7,color:"rgba(80,220,120,0.7)",letterSpacing:"0.1em",textTransform:"uppercase"},children:mt.inputMode})]})]}),!T&&C!==null&&a.jsxs("div",{style:{width:Bt,flexShrink:0,display:"flex",flexDirection:"column",borderLeft:`1px solid ${Oi}`,background:qy,overflowY:"auto"},children:[C==="layers"&&a.jsx(nG,{layers:y,onChange:jo,onClearLayer:bo}),C==="dna"&&a.jsx(aG,{dna:g,onDNAChange:pr,onMutate:fr,pinnedDNA:le}),C==="archive"&&a.jsx(sG,{archive:P,grimoire:$,onRestoreEntry:Jo,onDeleteEntry:re=>I(de=>de.filter(Se=>Se.id!==re)),onToggleFavorite:re=>I(de=>de.map(Se=>Se.id===re?{...Se,favorite:!Se.favorite}:Se)),onTogglePin:re=>{I(Se=>Se.map(qe=>qe.id===re?{...qe,pinned:!qe.pinned}:qe));const de=P.find(Se=>Se.id===re);de&&pe(de.dna)}}),C==="geo"&&a.jsx(XG,{geoParams:kt,onParamChange:hr,onApplyPreset:or}),C==="matrix"&&a.jsx($G,{matrix:Xn,onCellChange:be,onRandomize:Ee,onSymmetrize:Me,onReset:_e,onPreset:Je}),C==="vitrine"&&a.jsx(QG,{vitrine:L,selectedId:G,onSelect:vo,onFavorite:re=>H(de=>de.map(Se=>Se.id===re?{...Se,favorite:!Se.favorite}:Se)),onPin:Zo,onDiscard:re=>H(de=>de.filter(Se=>Se.id!==re)),onMutateFrom:re=>{const de=L.find(Se=>Se.id===re);de&&fr(Array.from({length:8},(Se,qe)=>({...de.dna,id:`mut-${Date.now()}-${qe}`})))},onNewMutate:()=>fr([]),currentDNA:g}),C==="physics"&&a.jsx(GG,{physics:zt,dna:g,onPhysics:re=>{jn(de=>{const Se={...de,...re};return En.current=Se,Se})},onDNAGene:fe}),C==="powers"&&a.jsx(KG,{dna:g,palette:g.palette,onRecolorSpecies:sa,onRandomPalette:()=>{const re=pg(Math.max(4,i.current.palette.length)),de={...i.current,palette:re};m(de),i.current=de,OS(u.current,re)},onSetAllShape:So,brushTextureId:lt,onBrushTexture:re=>ht(re),onDNAGene:fe,onChaosInject:Oo,onFreezeAll:U,onPulseAll:je,onScatterAll:W,onHueRotate:X,onSatShift:Te,onLitShift:He,onSizeAll:he,onRespawn:()=>en(i.current,Date.now())})]})]}),a.jsx(oR,{open:Ne,onClose:()=>Ke(!1),ctrl:Dt,presetsSection:{label:"Presets",items:[...G0,...Cf],getLabel:re=>re.name??"?",onSelect:re=>br(re)},toolsSection:{label:"Ferramentas",items:At,getLabel:re=>{var de;return((de=mg.find(Se=>Se.id===re))==null?void 0:de.name)??re},onSelect:re=>S(de=>{const Se={...de,activeToolId:re};return jt.current=Se,Se})}})]})};function QG({vitrine:e,selectedId:t,onSelect:r,onFavorite:o,onPin:s,onDiscard:l,onMutateFrom:i,onNewMutate:u,currentDNA:c}){return a.jsxs("div",{style:{padding:"10px 8px",display:"flex",flexDirection:"column",gap:8,fontFamily:Hr},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.jsx("span",{style:{fontSize:8,color:Bi,letterSpacing:"0.16em",textTransform:"uppercase"},children:"VITRINE"}),a.jsx("button",{title:"Nova mutao",onClick:u,style:{fontSize:7,padding:"2px 8px",borderRadius:1,cursor:"pointer",border:"1px solid rgba(255,0,132,0.2)",background:"rgba(255,0,132,0.04)",color:"rgba(255,0,132,0.6)",fontFamily:Hr,letterSpacing:"0.1em",textTransform:"uppercase"},children:"+ GERAR"})]}),e.length===0?a.jsx("div",{style:{fontSize:8,color:co,textAlign:"center",padding:"20px 0",letterSpacing:"0.06em"},children:"Use MUTATE no painel DNA."}):a.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:5},children:e.map(d=>a.jsx(ZG,{card:d,selected:t===d.id,onSelect:()=>r(d),onFavorite:()=>o(d.id),onPin:()=>s(d.id),onDiscard:()=>l(d.id),onMutateFrom:()=>i(d.id)},d.id))})]})}const vs={background:"none",border:"none",cursor:"pointer",padding:"3px 5px",color:co,display:"flex",alignItems:"center",gap:2,borderRadius:1,fontFamily:Hr,fontSize:8};function Af(){return a.jsx("div",{style:{width:1,height:16,background:"rgba(255,255,255,0.06)",flexShrink:0,margin:"0 2px"}})}const Jn=64;function Fp(e){let t=e>>>0;return()=>{t+=1831565813;let r=t;return r=Math.imul(r^r>>>15,r|1),r^=r+Math.imul(r^r>>>7,r|61),((r^r>>>14)>>>0)/4294967296}}function eV(){const e=Jn*Jn;return{N:new Float32Array(e),L:new Float32Array(e),R:new Float32Array(e),size:Jn}}function PR(e,t){const r=Math.min(Jn-1,Math.max(0,Math.floor(e*Jn))),o=Math.min(Jn-1,Math.max(0,Math.floor(t*Jn)));return r+o*Jn}function Hy(e,t,r){return e[PR(t,r)]}const jh={STABLE_ORDER:"#5aff8a",POLARIZED:"#ffce5a",CONFLICT:"#ff9a3c",CRISIS:"#ff5a5a",EXCEPTION:"#c05aff",RECOVERY:"#4a9eff"},Eh={STABLE_ORDER:"Ordem Estvel",POLARIZED:"Polarizado",CONFLICT:"Conflito",CRISIS:"Crise",EXCEPTION:"Exceo",RECOVERY:"Recuperao"};function Gy(e=0){return{cohesion:.5,polarization:.3,conflictRate:.1,inequality:.3,legitimacyMean:.5,normMean:.4,scarcity:.3,volatility:.2,t:e}}const vh=.07,FR=Math.ceil(1/vh)+1;function tV(e){const t=new Map;for(let r=0;r<e.length;r++){const o=e[r],s=Math.floor(o.x/vh),l=Math.floor(o.y/vh),i=s+l*FR;let u=t.get(i);u||(u=[],t.set(i,u)),u.push(r)}return t}function nV(e,t,r,o){const s=[],l=Math.ceil(o/vh),i=Math.floor(t/vh),u=Math.floor(r/vh);for(let c=-l;c<=l;c++)for(let d=-l;d<=l;d++){const h=i+c+(u+d)*FR,f=e.get(h);if(f)for(const g of f)s.push(g)}return s}function rV(e,t,r,o){const s=r%2,l=Math.floor(r/2),i=.2,u=.2,c=s===0?.25:.75,d=l===0?.25:.75;return{x:Math.max(.01,Math.min(.99,c+(t()-.5)*i*2)),y:Math.max(.01,Math.min(.99,d+(t()-.5)*u*2)),vx:(t()-.5)*.02,vy:(t()-.5)*.02,factionId:r,wealth:.3+t()*.4,belief:.4+t()*.3,fear:t()*.2,status:t()*.5,id:e}}function oV(e,t,r){const o=Jn*Jn;for(let s=0;s<o;s++)e.N[s]=Math.max(0,Math.min(1,r.nBaseline+(t()-.5)*r.nNoise)),e.L[s]=Math.max(0,Math.min(1,r.lBaseline+(t()-.5)*r.lNoise)),e.R[s]=Math.max(0,Math.min(1,r.rBaseline+(t()-.5)*r.rNoise))}function aV(e){const t=Fp(e.seed),r=eV();oV(r,t,e);const o=[];for(let l=0;l<e.agentCount;l++){const i=l%e.factionCount;o.push(rV(l,t,i))}for(let l=o.length-1;l>0;l--){const i=Math.floor(t()*(l+1));[o[l],o[i]]=[o[i],o[l]]}for(let l=0;l<e.agentCount;l++)o[l].factionId=l%e.factionCount,o[l].id=l;const s=Array.from({length:e.factionCount},()=>({x:.5,y:.5,count:0}));return{agents:o,field:r,agentCount:e.agentCount,factionCount:e.factionCount,t:0,seed:e.seed,conflictAccum:0,conflictDecay:0,centroids:s}}function Nv(e){const t={N:new Float32Array(e.field.N),L:new Float32Array(e.field.L),R:new Float32Array(e.field.R),size:e.field.size};return{agents:e.agents.map(o=>({...o})),field:t,agentCount:e.agentCount,factionCount:e.factionCount,t:e.t,seed:e.seed,conflictAccum:e.conflictAccum,conflictDecay:e.conflictDecay,centroids:e.centroids.map(o=>({...o}))}}function gg(e){return e<0?e+1:e>=1?e-1:e}function ui(e){return e>.5?e-1:e<-.5?e+1:e}function sV(e){const{agents:t,factionCount:r,centroids:o}=e;for(let s=0;s<r;s++)o[s].x=0,o[s].y=0,o[s].count=0;for(const s of t){const l=o[s.factionId];l.x+=s.x,l.y+=s.y,l.count++}for(let s=0;s<r;s++){const l=o[s];l.count>0?(l.x/=l.count,l.y/=l.count):(l.x=.5,l.y=.5)}}const u5=.065,QS=.03,iV=.45,lV=.55,cV=.012,dV=.0015,uV=.008,ew=.88,Vy=.012,hV=.014,tw=.08,fV=.004,pV=.018,nw=.18,mV=.35,gV=.15;function yV(e,t,r,o){const s=PR(t,r);e[s]=Math.max(0,Math.min(1,e[s]+o))}function xV(e,t,r){const o=Math.min(Jn-1,Math.max(0,Math.floor(t*Jn))),s=Math.min(Jn-1,Math.max(0,Math.floor(r*Jn))),l=Math.min(Jn-1,o+1),i=Math.max(0,o-1),u=Math.min(Jn-1,s+1),c=Math.max(0,s-1),d=(e[l+s*Jn]-e[i+s*Jn])*.5,h=(e[o+u*Jn]-e[o+c*Jn])*.5;return[d,h]}function NR(e,t,r){const{agents:o,field:s}=e;let l=0;const i=tV(o);for(let u=0;u<o.length;u++){const c=o[u];let d=0,h=0;const f=Hy(s.R,c.x,c.y),g=Hy(s.N,c.x,c.y),m=Hy(s.L,c.x,c.y),[y,v]=xV(s.R,c.x,c.y);d+=y*nw,h+=v*nw;const b=nV(i,c.x,c.y,u5);for(const k of b){if(k===u)continue;const R=o[k],j=ui(R.x-c.x),T=ui(R.y-c.y),_=j*j+T*T;if(_===0||_>u5*u5)continue;const P=Math.sqrt(_),I=1-P/u5,$=j/P,q=T/P;if(c.factionId===R.factionId){const L=iV*I*(.5+c.belief*.5);if(d+=L*$,h+=L*q,r()<uV*t){const H=R.wealth-c.wealth;c.wealth=Math.max(0,Math.min(1,c.wealth+H*.05*(1+m)))}}else{const L=.25+.75*g,H=lV*I*L;if(d-=H*$,h-=H*q,P<QS*2&&(c.fear=Math.min(1,c.fear+.015*I)),P<QS&&(l++,c.status>R.status&&R.wealth>.05)){const G=Math.min(R.wealth*.02,.01);c.wealth=Math.min(1,c.wealth+G)}}}d-=c.fear*c.vx*.2,h-=c.fear*c.vy*.2;const S=f*cV*t;c.wealth=Math.min(1,c.wealth+S),yV(s.R,c.x,c.y,-S*.4),c.wealth=Math.max(0,c.wealth-dV*t),c.fear=Math.max(0,c.fear-.008*t),c.vx=(c.vx+d*t)*ew,c.vy=(c.vy+h*t)*ew;const C=Math.sqrt(c.vx*c.vx+c.vy*c.vy);C>Vy&&(c.vx=c.vx/C*Vy,c.vy=c.vy/C*Vy),c.x=gg(c.x+c.vx),c.y=gg(c.y+c.vy)}e.conflictAccum+=l,e.conflictDecay=e.conflictDecay*.92+l*.08,e.t+=t}function OR(e,t,r,o){const{field:s,agents:l}=e,i=Jn,u=i*i,c=new Float32Array(u);for(let h=0;h<i;h++)for(let f=0;f<i;f++){const g=f+h*i,m=[s.R[(f-1+i)%i+h*i],s.R[(f+1)%i+h*i],s.R[f+(h-1+i)%i*i],s.R[f+(h+1)%i*i]],y=(m[0]+m[1]+m[2]+m[3])/4;let v=s.R[g];v+=hV*t,v=v*(1-tw)+y*tw,c[g]=Math.max(0,Math.min(1,v))}s.R.set(c);for(let h=0;h<u;h++)s.N[h]=s.N[h]+(o-s.N[h])*fV*t,s.N[h]=Math.max(0,Math.min(1,s.N[h]));const d=r*.4*t;for(let h=0;h<i;h++)for(let f=0;f<i;f++){const g=f+h*i,m=s.R[g],y=s.N[g],v=Math.max(0,m*.6+(1-Math.max(0,y-.6)*1.2)*.3+.1);s.L[g]=s.L[g]+(v-s.L[g])*pV*t,s.L[g]=Math.max(0,Math.min(1,s.L[g]-d*.05))}sV(e)}function bV(e,t,r,o){const{agents:s,field:l}=e;for(let i=0;i<Jn;i++)for(let u=0;u<Jn;u++){const c=(u+.5)/Jn,d=(i+.5)/Jn,h=ui(c-t),f=ui(d-r),g=h*h+f*f;if(g<o*o){const m=1-Math.sqrt(g)/o,y=u+i*Jn;l.L[y]=Math.min(1,l.L[y]+mV*m*.01)}}for(const i of s){const u=ui(i.x-t),c=ui(i.y-r),d=u*u+c*c;if(d<o*o){const h=1-Math.sqrt(d)/o;i.fear=Math.max(0,i.fear-gV*h*.02),i.belief=Math.min(1,i.belief+.01*h)}}}function _R(e){if(e.length===0)return 0;const t=e.map(l=>l.wealth).sort((l,i)=>l-i),r=t.length;let o=0,s=0;for(let l=0;l<r;l++)o+=(2*(l+1)-r-1)*t[l],s+=t[l];return s===0?0:Math.max(0,Math.min(1,o/(r*s)))}function gb(e,t){const{agents:r,field:o,factionCount:s,centroids:l}=e;if(r.length===0)return{cohesion:.5,polarization:.3,conflictRate:0,inequality:0,legitimacyMean:.5,normMean:.5,scarcity:.5,volatility:0,t:e.t};const i=new Array(s).fill(0),u=new Array(s).fill(0);for(const q of r){const L=l[q.factionId];if(L.count===0)continue;const H=ui(q.x-L.x),G=ui(q.y-L.y);i[q.factionId]+=Math.sqrt(H*H+G*G),u[q.factionId]++}let c=0,d=0;for(let q=0;q<s;q++)u[q]>0&&(c+=i[q]/u[q],d++);const h=d>0?c/d:.5,f=Math.max(0,Math.min(1,1-h/.35));let g=0,m=0;for(let q=0;q<s;q++)for(let L=q+1;L<s;L++){const H=l[q],G=l[L];if(H.count===0||G.count===0)continue;const oe=ui(H.x-G.x),le=ui(H.y-G.y);g+=Math.sqrt(oe*oe+le*le),m++}const y=m>0?g/m:.3,v=Math.max(0,Math.min(1,y/.6)),b=Math.max(0,Math.min(1,t/(r.length*.015))),S=_R(r),C=Jn*Jn;let k=0,R=0,j=0;for(let q=0;q<C;q++)k+=o.L[q],R+=o.N[q],j+=o.R[q];const T=k/C,_=R/C,P=Math.max(0,1-j/C);let I=0;for(const q of r)I+=Math.sqrt(q.vx*q.vx+q.vy*q.vy);const $=Math.max(0,Math.min(1,I/r.length/.012));return{cohesion:f,polarization:v,conflictRate:b,inequality:S,legitimacyMean:T,normMean:_,scarcity:P,volatility:$,t:e.t}}function yg(e,t){const{conflictRate:r,inequality:o,legitimacyMean:s,normMean:l,polarization:i,cohesion:u}=e;if(r>.55||o>.65&&s<.28)return"CRISIS";if(l>.72&&r<.18&&o>.35)return"EXCEPTION";if(t){const c=t.conflictRate>.4||t.inequality>.6&&t.legitimacyMean<.35,d=r<t.conflictRate-.05||s>t.legitimacyMean+.03;if(c&&d)return"RECOVERY"}return r>.3||i>.55&&r>.18?"CONFLICT":i>.5||u>.5&&i>.35?"POLARIZED":"STABLE_ORDER"}const rw={STABLE_ORDER:["Coeso elevada sustenta a estrutura vigente.","As faces mantm distncia segura; a ordem prevalece.","Recursos equilibrados favorecem a cooperao intragrupal.","A legitimidade consolidada amortece tenses latentes.","Um equilbrio frgil mas funcional persiste no sistema."],POLARIZED:["Centralidades divergem: os grupos se afastam progressivamente.","A polarizao avana enquanto a confiana intermedia enfraquece.","Fronteiras identitrias se cristalizam nas regies de contato.","O abismo entre faces aprofunda-se sem ruptura imediata.","Grupos fecham-se sobre si mesmos; a heterofilia declina."],CONFLICT:["Incidentes de contato hostil aceleram na fronteira entre grupos.","A frequncia de conflito supera a capacidade de mediao.","Tenso converte-se em ao: confrontos se multiplicam.","O limiar de violncia foi cruzado; a volatilidade sobe.","Recursos disputados intensificam os embates interfaccionais."],CRISIS:["O sistema entra em colapso de coeso: mltiplos pontos de ruptura.","Desigualdade extrema destri a legitimidade institucional.","A espiral conflito-medo realimenta instabilidade global.","Crise total: previsibilidade histrica colapsa.","Todos os vetores apontam deteriorao simultnea."],EXCEPTION:["A norma se impe pela fora: ordem visvel, liberdade restrita.","Alta coero suprime o conflito sem resolver a desigualdade subjacente.","O estado de exceo normaliza-se gradualmente no tecido social.","Controle formal cresce enquanto legitimidade orgnica murcha.","Superfcie estvel; profundidade sob presso acumulada."],RECOVERY:["Sinais de recuperao: conflito cede, confiana reaparece lentamente.","Aps a crise, redistribuio emergente reduz tenses agudas.","O sistema busca novo equilbrio sobre as runas do anterior.","A legitimidade ressurge  frgil, condicional, ainda incerta.","Recuperao em curso: trajetria depende das intervenes subsequentes."]};function vV(e,t){if(!t)return"Condies iniciais ainda em transio.";const r=e.conflictRate-t.conflictRate,o=e.inequality-t.inequality,s=e.legitimacyMean-t.legitimacyMean,l=e.normMean-t.normMean,i=e.polarization-t.polarization,u=e.cohesion-t.cohesion,c=e.scarcity-t.scarcity,d=[];return Math.abs(r)>.04&&d.push(r>0?"conflito elevou-se":"conflito recuou"),Math.abs(o)>.03&&d.push(o>0?"desigualdade avanou":"desigualdade reduziu"),Math.abs(s)>.03&&d.push(s>0?"legitimidade cresceu":"legitimidade caiu"),Math.abs(l)>.05&&d.push(l>0?"coero normativa aumentou":"presso normativa recuou"),Math.abs(i)>.05&&d.push(i>0?"polarizao acentuou-se":"polarizao amenizou"),Math.abs(u)>.04&&d.push(u>0?"coeso interna fortaleceu":"coeso interna fragmentou"),Math.abs(c)>.04&&d.push(c>0?"escassez de recursos agravou":"abundncia de recursos melhorou"),o>.03&&s<-.02?"Desigualdade crescente erodiu a legitimidade institucional.":r>.05&&o>.02?"Disputa por recursos amplificou a desigualdade via conflito.":l>.06&&r<-.04?"Aumento coercitivo da norma suprimiu conflito visvel  a curto prazo.":s>.05&&r<-.03?"Recuperao de legitimidade amorteceu o ciclo de conflito.":e.normMean>.7&&e.inequality>.55?"A exceo se normalizou: ordem crescente, liberdade declinante.":d.length===0?"Tendncias se mantm estveis; sem mudana discernvel.":d.length===1?`${Uy(d[0])}.`:d.length===2?`${Uy(d[0])} enquanto ${d[1]}.`:`${Uy(d[0])}, ${d[1]} e ${d[2]}.`}function Uy(e){return e.charAt(0).toUpperCase()+e.slice(1)}function ow(e,t){const r=Math.floor(t)%e.length;return e[Math.max(0,r)]}function SV(e,t,r,o,s){const l=rw[e]??rw.STABLE_ORDER,i=o&&s?`Ato aplicado: ${s}. ${ow(l,t.t)}`:ow(l,t.t),u=vV(t,r);return{headline:i,causal:u}}function ql(e,t){for(let r=0;r<e.length;r++)e[r]=Math.max(0,Math.min(1,e[r]+t))}function wV(e,t,r,o,s){for(let l=0;l<Jn;l++)for(let i=0;i<Jn;i++){const u=(i+.5)/Jn,c=(l+.5)/Jn,d=ui(u-t),h=ui(c-r),f=Math.sqrt(d*d+h*h);if(f<o){const g=1-f/o,m=i+l*Jn;e[m]=Math.max(0,Math.min(1,e[m]+s*g))}}}const yb=[{id:"redistribute",name:"Redistribute",description:"Transferncia de riqueza: reduz desigualdade, drena R temporariamente.",cost:.15,cooldownSeconds:45,durationSeconds:30,color:"#5aff8a"},{id:"austerity",name:"Austerity",description:"Contrao fiscal: R aumenta curto prazo, desigualdade sobe.",cost:.05,cooldownSeconds:40,durationSeconds:25,color:"#ffce5a"},{id:"propaganda",name:"Propaganda Broadcast",description:"Boost de L para faco 0; polarizao cresce no longo prazo.",cost:.1,cooldownSeconds:35,durationSeconds:20,color:"#ff9a3c"},{id:"emergency_decree",name:"Emergency Decree",description:"N sobe fortemente; conflito cai curto prazo, risco EXCEPTION.",cost:.08,cooldownSeconds:60,durationSeconds:35,color:"#c05aff"},{id:"open_commons",name:"Open Commons",description:"R acessvel a todos; cooperao sobe, status de elites cai.",cost:.12,cooldownSeconds:38,durationSeconds:28,color:"#4a9eff"},{id:"taboo_wall",name:"Taboo Wall",description:"Fronteira simblica: coeso interna , conflito interfaccional .",cost:.06,cooldownSeconds:42,durationSeconds:40,color:"#ff5a5a"},{id:"ritual_unity",name:"Ritual of Unity",description:"Polarizao cai; custa wealth coletivo e fadiga.",cost:.18,cooldownSeconds:50,durationSeconds:25,color:"#ffd4f0"},{id:"amnesty",name:"Amnesty",description:"Medo cai, L sobe; transgresso curto prazo pode subir.",cost:.07,cooldownSeconds:35,durationSeconds:22,color:"#a0ffee"}];function DR(e,t,r){const{agents:o,field:s}=e,l=r*.016;switch(t){case"redistribute":{const i=o.map(d=>d.wealth).sort((d,h)=>d-h),u=i[Math.floor(i.length*.25)],c=i[Math.floor(i.length*.75)];for(const d of o)d.wealth>c&&(d.wealth=Math.max(u,d.wealth-.002*r)),d.wealth<u&&(d.wealth=Math.min(c,d.wealth+.002*r));ql(s.R,-.003*l);break}case"austerity":{ql(s.R,.006*l);for(const i of o){const u=i.status*.004*l;i.wealth=Math.min(1,i.wealth+u)}break}case"propaganda":{const i=e.centroids[0].x,u=e.centroids[0].y;wV(s.L,i,u,.35,.008*l);for(const c of o)c.factionId===0?c.belief=Math.min(1,c.belief+.003*l):c.fear=Math.min(1,c.fear+.001*l);break}case"emergency_decree":{ql(s.N,.015*l);for(const i of o)i.vx*=.97,i.vy*=.97,i.fear=Math.min(1,i.fear+.005*l);break}case"open_commons":{ql(s.R,.01*l);for(const i of o)i.status=i.status*(1-.005*l)+.5*.005*l;ql(s.L,.005*l);break}case"taboo_wall":{ql(s.N,.006*l);for(const i of o)i.belief=Math.min(1,i.belief+.003*l*(i.factionId===0?1:-.5));break}case"ritual_unity":{for(const i of o)i.vx+=(.5-i.x)*.001*l,i.vy+=(.5-i.y)*.001*l,i.wealth=Math.max(0,i.wealth-.001*l),i.fear=Math.max(0,i.fear-.005*l);ql(s.L,.008*l);break}case"amnesty":{for(const i of o)i.fear=Math.max(0,i.fear-.01*l),i.belief=Math.min(1,i.belief+.002*l);ql(s.L,.01*l),ql(s.N,-.004*l);break}}}function CV(e,t,r){const s={redistribute:"austerity",austerity:"redistribute",propaganda:"amnesty",emergency_decree:"amnesty",open_commons:"austerity",taboo_wall:"ritual_unity",ritual_unity:"taboo_wall",amnesty:"emergency_decree"}[t]??t;DR(e,s,r)}const Yy=[{id:"late_empire",name:"Late Empire",description:"Legitimidade alta, desigualdade crescente, norma coercitiva.",color:"#c05aff",worldOpts:{agentCount:300,factionCount:4,nBaseline:.6,lBaseline:.72,rBaseline:.45,nNoise:.15,lNoise:.1,rNoise:.2},nBaseline:.6,sceneDuration:30,expectedRegime:"Ordem inicial  Polarizao  Exceo"},{id:"frontier_republic",name:"Frontier Republic",description:"Norma fraca, recursos irregulares, alta mobilidade.",color:"#5aff8a",worldOpts:{agentCount:280,factionCount:4,nBaseline:.22,lBaseline:.5,rBaseline:.4,nNoise:.3,lNoise:.25,rNoise:.4},nBaseline:.22,sceneDuration:25,expectedRegime:"Conflito moderado  Ordem instvel"},{id:"discipline_state",name:"Discipline State",description:"N muito alto, L estvel; risco de Exceo rpida.",color:"#ff5a5a",worldOpts:{agentCount:320,factionCount:4,nBaseline:.82,lBaseline:.6,rBaseline:.38,nNoise:.08,lNoise:.12,rNoise:.18},nBaseline:.82,sceneDuration:30,expectedRegime:"Ordem forada  Exceo  Crise"},{id:"trade_league",name:"Trade League",description:"R alto, desigualdade sobe via prosperidade, L via comrcio.",color:"#ffce5a",worldOpts:{agentCount:260,factionCount:3,nBaseline:.3,lBaseline:.62,rBaseline:.75,nNoise:.12,lNoise:.15,rNoise:.15},nBaseline:.3,sceneDuration:35,expectedRegime:"Ordem estvel  Polarizao econmica"}],MV=.28,LR=45,zR=.28,aw=8e-4;function kV(){return{active:!1,x:.5,y:.5,charisma:0,age:0,radius:zR,factionId:0}}function RV(e,t,r,o){return!t||e.active?!1:Fp(r^o*2654435769)()<MV}function AV(e,t){const r=Fp(t^Date.now());return{active:!0,x:.1+r()*.8,y:.1+r()*.8,charisma:.75+r()*.25,age:0,radius:zR,factionId:Math.floor(r()*e.factionCount)}}function jV(e,t,r){if(!e.active)return!1;e.age+=r;const o=e.age*.3;return e.x=gg(e.x+Math.cos(o)*aw),e.y=gg(e.y+Math.sin(o*1.3)*aw),bV(t,e.x,e.y,e.radius),e.age>LR?(e.active=!1,!1):!0}function Ky(e){if(!e.active)return 0;const t=Math.min(1,e.age/LR),r=Math.sin(t*Math.PI);return e.charisma*r*.65}const EV=.12,TV=120,sw=6,Xy=3,IV=8,PV=45,BR=80,FV=30,NV=120,OV=4,_V=30;function Ov(e,t){const r=Nv(e);return r.agents.length>t&&(r.agents=r.agents.slice(0,t),r.agentCount=t),r}function DV(e,t){return{baseSnapshot:Ov(e,BR),rolloutsDone:0,totalRollouts:IV,horizonSeconds:PV,results:[],baseSeed:(e.seed^Math.floor(e.t*1e3+66))>>>0,nBaseline:t}}function LV(e,t){return{baseSnapshot:Ov(e,TV),rolloutsDone:0,totalRollouts:FV,horizonSeconds:NV,results:[],baseSeed:(e.seed^Math.floor(e.t*1e3+153))>>>0,nBaseline:t}}function iw(e,t){return{baseSnapshot:Ov(e,BR),rolloutsDone:0,totalRollouts:OV,horizonSeconds:_V,results:[],baseSeed:(e.seed^Math.floor(e.t*1e3+171))>>>0,nBaseline:t}}function $R(e,t){const r=e.baseSeed+e.rolloutsDone*2654435769>>>0,o=Fp(r),s=Nv(e.baseSnapshot);s.seed=r;const l=.04;for(let S=0;S<s.field.N.length;S++)s.field.N[S]=Math.max(0,Math.min(1,s.field.N[S]+(o()-.5)*l)),s.field.L[S]=Math.max(0,Math.min(1,s.field.L[S]+(o()-.5)*l)),s.field.R[S]=Math.max(0,Math.min(1,s.field.R[S]+(o()-.5)*l));for(const S of s.agents)S.vx+=(o()-.5)*.003,S.vy+=(o()-.5)*.003;const i=[],u=[],c=[],d=[];let h=0,f=0,g=0;const m=s.t;for(;s.t-m<e.horizonSeconds;){if(s.conflictAccum=0,NR(s,EV,o),g+=s.conflictAccum,s.t-f>=Xy){const S=zV(s.agents.map(C=>C.wealth));OR(s,Xy,S,t),f=s.t}if(s.t-h>=sw){const S=g/sw,C=gb(s,S);i.push(C),u.push(C.conflictRate),c.push(C.inequality),d.push(C.legitimacyMean),h=s.t,g=0}}const y=g/Math.max(1,Xy),v=gb(s,y);i.length===0&&i.push(v),u.push(v.conflictRate),c.push(v.inequality),d.push(v.legitimacyMean);const b=yg(v,i.length>1?i[i.length-2]:null);return{metrics:i,finalPhase:b,conflictLine:u,inequalityLine:c,legitimacyLine:d,seed:r}}function lw(e,t,r){const o=Math.min(e.rolloutsDone+r,e.totalRollouts);for(let s=e.rolloutsDone;s<o;s++)e.results.push($R(e,t)),e.rolloutsDone++;return e.rolloutsDone>=e.totalRollouts}function cw(e,t,r){const o=performance.now();for(;e.rolloutsDone<e.totalRollouts&&(e.results.push($R(e,t)),e.rolloutsDone++,!(performance.now()-o>r)););return e.rolloutsDone>=e.totalRollouts}function h5(e,t,r){const{results:o}=e;if(o.length===0)return{trajectories:[],probability:{},confidence:0,generatedAt:Date.now(),isMuleActive:t};const s={};for(const g of o)s[g.finalPhase]=(s[g.finalPhase]??0)+1;const l={};for(const[g,m]of Object.entries(s))l[g]=m/o.length;const i=o.map(g=>g.conflictLine[g.conflictLine.length-1]??0),u=i.reduce((g,m)=>g+m,0)/i.length,c=i.reduce((g,m)=>g+(m-u)**2,0)/i.length;let d=Math.max(0,Math.min(1,1-c*8));d=Math.max(0,d-r);const h=new Map;for(const g of o)h.has(g.finalPhase)||h.set(g.finalPhase,[]),h.get(g.finalPhase).push(g);const f=[];for(const[,g]of h)if(f.push(g[0]),f.length>=7)break;return{trajectories:f,probability:l,confidence:d,generatedAt:Date.now(),isMuleActive:t}}function zV(e){if(e.length===0)return 0;const t=[...e].sort((l,i)=>l-i),r=t.length;let o=0,s=0;for(let l=0;l<r;l++)o+=(2*(l+1)-r-1)*t[l],s+=t[l];return s===0?0:Math.max(0,Math.min(1,o/(r*s)))}function Zy({label:e,value:t,color:r}){return a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{style:{color:"rgba(255,255,255,0.45)",fontSize:9,width:30,flexShrink:0},children:e}),a.jsx("div",{style:{flex:1,height:3,background:"rgba(255,255,255,0.08)",borderRadius:2,overflow:"hidden"},children:a.jsx("div",{style:{width:`${t*100}%`,height:"100%",background:r,borderRadius:2,transition:"width 0.3s"}})})]})}const BV=({frames:e,selected:t,onSelect:r})=>{const o=w.useRef(null);return w.useEffect(()=>{var s;(s=o.current)==null||s.scrollIntoView({behavior:"smooth",block:"nearest"})},[e.length]),e.length===0?a.jsx("div",{style:{padding:"16px 12px",color:"rgba(255,255,255,0.25)",fontSize:11},children:"Aguardando primeira cena..."}):a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6,padding:"8px 6px",overflowY:"auto",maxHeight:"100%"},children:[e.map((s,l)=>{const i=t===l,u=jh[s.phaseLabel]??"#ffffff",c=!!s.isAct;return a.jsxs("div",{onClick:()=>r(l),style:{padding:"8px 10px",borderRadius:5,cursor:"pointer",background:i?"rgba(255,255,255,0.07)":"rgba(255,255,255,0.025)",border:`1px solid ${i?u+"55":"rgba(255,255,255,0.05)"}`,transition:"all 0.15s"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:5},children:[c&&a.jsx("span",{style:{fontSize:8,padding:"1px 4px",borderRadius:3,background:"rgba(255,200,90,0.18)",color:"#ffce5a",textTransform:"uppercase",letterSpacing:"0.06em",flexShrink:0},children:"Ato"}),a.jsx("span",{style:{fontSize:9,padding:"1px 5px",borderRadius:3,background:u+"22",color:u,textTransform:"uppercase",letterSpacing:"0.06em",flexShrink:0},children:Eh[s.phaseLabel]}),a.jsxs("span",{style:{fontSize:9,color:"rgba(255,255,255,0.35)",marginLeft:"auto"},children:["A",s.act,"C",s.scene]})]}),a.jsx("p",{style:{fontSize:10.5,color:"rgba(255,255,255,0.82)",lineHeight:1.35,marginBottom:4,margin:"0 0 5px"},children:s.headline}),a.jsx("p",{style:{fontSize:9.5,color:"rgba(255,255,255,0.45)",fontStyle:"italic",lineHeight:1.3,margin:"0 0 6px"},children:s.causal}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:3},children:[a.jsx(Zy,{label:"Cnflto",value:s.metrics.conflictRate,color:"#ff5a5a"}),a.jsx(Zy,{label:"Desig",value:s.metrics.inequality,color:"#ffce5a"}),a.jsx(Zy,{label:"Legit",value:s.metrics.legitimacyMean,color:"#5aff8a"})]})]},l)}),a.jsx("div",{ref:o})]})};function qR(e,t){const r=[];if(!t)return e.inequality>.5&&r.push({label:"Inequality",direction:"high",color:"#ffce5a",magnitude:e.inequality}),e.conflictRate>.3&&r.push({label:"Conflict",direction:"high",color:"#ff5a5a",magnitude:e.conflictRate}),e.legitimacyMean<.35&&r.push({label:"Legitimacy",direction:"low",color:"#5aff8a",magnitude:1-e.legitimacyMean}),e.normMean>.65&&r.push({label:"Norm",direction:"high",color:"#c05aff",magnitude:e.normMean}),e.polarization>.45&&r.push({label:"Polarization",direction:"high",color:"#ff9a3c",magnitude:e.polarization}),e.scarcity>.5&&r.push({label:"Scarcity",direction:"high",color:"#ff7788",magnitude:e.scarcity}),r.sort((s,l)=>l.magnitude-s.magnitude),r.slice(0,3);const o=[{label:"Inequality",val:e.inequality-t.inequality,abs:e.inequality,color:"#ffce5a"},{label:"Conflict",val:e.conflictRate-t.conflictRate,abs:e.conflictRate,color:"#ff5a5a"},{label:"Legitimacy",val:e.legitimacyMean-t.legitimacyMean,abs:e.legitimacyMean,color:"#5aff8a"},{label:"Polarization",val:e.polarization-t.polarization,abs:e.polarization,color:"#ff9a3c"},{label:"Norm",val:e.normMean-t.normMean,abs:e.normMean,color:"#c05aff"},{label:"Scarcity",val:e.scarcity-t.scarcity,abs:e.scarcity,color:"#ff7788"}];o.sort((s,l)=>{const i=Math.abs(s.val)*2+(s.abs>.6||s.abs<.25?.1:0);return Math.abs(l.val)*2+(l.abs>.6||l.abs<.25?.1:0)-i});for(let s=0;s<Math.min(3,o.length);s++){const l=o[s];(Math.abs(l.val)>.015||l.abs>.55||l.abs<.2)&&r.push({label:l.label,direction:l.val>=0?"up":"down",color:l.color,magnitude:Math.abs(l.val)})}return r.slice(0,3)}function $V(e,t,r){return r&&r.confidence<.35?"Futuro aberto: bifurcacao iminente (alta variancia).":t==="CRISIS"?e.inequality>.6&&e.scarcity>.5?"Atrator de crise: desigualdade e escassez dominam.":"Crise sistemica: multiplos vetores convergem para ruptura.":t==="EXCEPTION"?e.normMean>.7&&e.legitimacyMean<.45?"Ordem por coercao: N alto e L caindo -- excecao normalizante.":"Estado de excecao: controle formal substitui legitimidade organica.":t==="CONFLICT"?e.polarization>.5?"Conflito polarizado: faccoes em trajetoria de colisao.":"Tensao em escalada: limiar de violencia cruzado.":t==="POLARIZED"?e.cohesion>.5?"Coesao interna alta mas distancia interfaccional cresce.":"Polarizacao em curso: fronteiras identitarias cristalizam.":t==="RECOVERY"?"Recuperacao fragil: trajetoria depende das proximas intervencoes.":e.inequality>.45?"Ordem aparente com desigualdade latente -- equilbrio instvel.":e.legitimacyMean>.65?"Equilibrio sustentado por legitimidade: janela de oportunidade.":"Sistema estavel: dinmicas internas dentro de parametros."}function qV(e,t,r){const o=[],s=qR(e,t);for(const l of s){const i=l.direction==="up"||l.direction==="high"?"subiu":"caiu";o.push(`${l.label} ${i} -- correlacao com regime detectada.`)}return r&&r.confidence<.4&&o.push("Confianca baixa: variancia alta entre rollouts sugere bifurcacao."),e.inequality>.55&&e.legitimacyMean<.4&&o.push("Desigualdade alta + legitimidade baixa: padrao de crise historico."),o.length<3&&o.push("Tente inverter o ato para ver o contrafactual."),o.slice(0,4)}function xb(e){const t=r=>e[r]??0;return{order:t("STABLE_ORDER")+t("RECOVERY")*.6,conflict:t("POLARIZED")*.5+t("CONFLICT"),crisis:t("CRISIS")+t("EXCEPTION")*.65+t("POLARIZED")*.1}}function Jy({label:e,value:t,color:r}){return a.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:3},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"baseline"},children:[a.jsx("span",{style:{fontSize:10,color:r+"cc"},children:e}),a.jsxs("span",{style:{fontSize:12,color:r,fontFamily:"monospace"},children:[Math.round(t*100),"%"]})]}),a.jsx("div",{style:{height:6,background:"rgba(255,255,255,0.06)",borderRadius:3,overflow:"hidden"},children:a.jsx("div",{style:{width:`${Math.min(100,t*100)}%`,height:"100%",background:`linear-gradient(90deg, ${r}88, ${r})`,borderRadius:3,transition:"width 0.6s ease"}})})]})}function WV({chip:e}){const t=e.direction==="up"?"":e.direction==="down"?"":e.direction==="high"?"":"";return a.jsxs("span",{style:{fontSize:9,padding:"2px 6px",borderRadius:4,background:e.color+"18",color:e.color,display:"inline-flex",alignItems:"center",gap:2,border:`1px solid ${e.color}33`,whiteSpace:"nowrap"},children:[e.label,t]})}function HV({compare:e}){const{withAct:t,withoutAct:r,cardId:o}=e,s=xb(t.probability),l=xb(r.probability),i=[{label:"Order",val:s.order-l.order,color:"#5aff8a"},{label:"Conflict",val:s.conflict-l.conflict,color:"#ff9a3c"},{label:"Crisis",val:s.crisis-l.crisis,color:"#ff5a5a"}].filter(u=>Math.abs(u.val)>.01);return i.length===0?null:a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"4px 8px",background:"rgba(255,206,90,0.06)",borderRadius:4,border:"1px solid rgba(255,206,90,0.15)"},children:[a.jsx(Es,{size:10,strokeWidth:1.5,color:"#ffce5a"}),a.jsx("span",{style:{fontSize:9,color:"rgba(255,255,255,0.5)"},children:"Delta:"}),i.map(u=>{const c=u.val>=0?"+":"",d=u.label==="Order"&&u.val>0||u.label!=="Order"&&u.val<0;return a.jsxs("span",{style:{fontSize:9.5,fontFamily:"monospace",color:d?"#5aff8a":"#ff8888"},children:[u.label," ",c,Math.round(u.val*100),"%"]},u.label)})]})}function Qy({values:e,color:t,width:r=100,height:o=28}){if(e.length<2)return null;const s=Math.max(...e,.01),l=e.map((i,u)=>{const c=u/(e.length-1)*r,d=o-i/s*(o-4)-2;return`${c.toFixed(1)},${d.toFixed(1)}`}).join(" ");return a.jsxs("svg",{width:r,height:o,style:{display:"block"},children:[a.jsx("polyline",{points:l,fill:"none",stroke:t,strokeWidth:1.5,strokeLinejoin:"round",opacity:.85}),a.jsx("circle",{cx:r,cy:o-e[e.length-1]/s*(o-4)-2,r:2,fill:t})]})}function ex(e,t){const r=e.trajectories;if(r.length===0)return[];const o=r[0][t].length,s=[];for(let l=0;l<o;l++){const i=r.map(u=>u[t][l]??0);s.push(i.reduce((u,c)=>u+c,0)/i.length)}return s}const GV=({metrics:e,prevMetrics:t,phase:r,oracleResult:o,deepResult:s,isAutoRunning:l,isDeepRunning:i,deepProgress:u,jiangEnabled:c,onToggleJiang:d,onRunDeep:h,autoCompare:f,autoCompareVisible:g,muleActive:m})=>{const[y,v]=w.useState(!1),[b,S]=w.useState(!1),C=s??o,k=C?xb(C.probability):null,R=qR(e,t),j=jh[r],T=c?$V(e,r,C):"",_=c?qV(e,t,C):[];return a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:0,fontSize:10},children:[a.jsxs("div",{style:{padding:"8px 12px",display:"flex",alignItems:"center",gap:8,borderBottom:"1px solid rgba(255,255,255,0.06)",background:"rgba(0,0,0,0.15)"},children:[a.jsx("span",{style:{fontSize:9,padding:"2px 7px",borderRadius:4,background:j+"22",color:j,textTransform:"uppercase",letterSpacing:"0.08em",flexShrink:0},children:Eh[r]}),a.jsxs("div",{style:{flex:"0 0 60px"},children:[a.jsx("div",{style:{height:4,background:"rgba(255,255,255,0.07)",borderRadius:2,overflow:"hidden"},children:a.jsx("div",{style:{width:`${((C==null?void 0:C.confidence)??0)*100}%`,height:"100%",background:((C==null?void 0:C.confidence)??0)>.6?"#5aff8a":((C==null?void 0:C.confidence)??0)>.3?"#ffce5a":"#ff5a5a",borderRadius:2,transition:"width 0.5s"}})}),a.jsxs("div",{style:{fontSize:8,color:"rgba(255,255,255,0.35)",marginTop:1,textAlign:"center"},children:["Conf ",Math.round(((C==null?void 0:C.confidence)??0)*100),"%"]})]}),a.jsx("div",{style:{display:"flex",gap:4,flexWrap:"wrap",flex:1},children:R.map((P,I)=>a.jsx(WV,{chip:P},I))}),m&&a.jsx("span",{style:{fontSize:8,padding:"1px 5px",borderRadius:3,background:"rgba(192,90,255,0.15)",color:"#c05aff"},children:"MULE"}),l&&a.jsx("div",{style:{width:6,height:6,borderRadius:3,background:"#4a9eff",opacity:.7,animation:"pulse 1.2s ease-in-out infinite"}})]}),a.jsxs("div",{style:{padding:"8px 12px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:[k?a.jsxs("div",{style:{display:"flex",gap:10,marginBottom:c?6:0},children:[a.jsx(Jy,{label:"Order",value:k.order,color:"#5aff8a"}),a.jsx(Jy,{label:"Conflict",value:k.conflict,color:"#ff9a3c"}),a.jsx(Jy,{label:"Crisis",value:k.crisis,color:"#ff5a5a"})]}):a.jsxs("div",{style:{padding:"8px 0",color:"rgba(255,255,255,0.25)",fontSize:10,display:"flex",alignItems:"center",gap:6},children:[a.jsx("div",{style:{width:6,height:6,borderRadius:3,background:"rgba(74,158,255,0.4)",animation:l?"pulse 1.2s ease-in-out infinite":"none"}}),l?"Oraculo calculando...":"Oraculo aguardando dados..."]}),c&&T&&a.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:6,padding:"5px 8px",marginTop:4,background:"rgba(160,255,238,0.04)",borderRadius:4,border:"1px solid rgba(160,255,238,0.12)"},children:[a.jsx(jC,{size:12,strokeWidth:1.5,color:"#a0ffee",style:{flexShrink:0,marginTop:1}}),a.jsxs("div",{style:{flex:1},children:[a.jsx("span",{style:{fontSize:10,color:"#a0ffee",lineHeight:"1.35"},children:T}),a.jsx("button",{onClick:()=>S(P=>!P),style:{marginLeft:6,fontSize:8,color:"rgba(160,255,238,0.55)",background:"none",border:"none",cursor:"pointer",padding:0,textDecoration:"underline",textUnderlineOffset:2},children:b?"fechar":"Why?"}),b&&_.length>0&&a.jsx("div",{style:{marginTop:4,display:"flex",flexDirection:"column",gap:2},children:_.map((P,I)=>a.jsxs("div",{style:{fontSize:9,color:"rgba(160,255,238,0.5)",lineHeight:1.3},children:["- ",P]},I))})]})]}),g&&f&&a.jsx("div",{style:{marginTop:5},children:a.jsx(HV,{compare:f})}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,marginTop:6},children:[a.jsxs("button",{onClick:d,style:{fontSize:9,padding:"2px 7px",borderRadius:3,cursor:"pointer",background:c?"rgba(160,255,238,0.1)":"rgba(255,255,255,0.03)",border:`1px solid ${c?"rgba(160,255,238,0.35)":"rgba(255,255,255,0.08)"}`,color:c?"#a0ffee":"rgba(255,255,255,0.35)",display:"flex",alignItems:"center",gap:4},children:[a.jsx(vl,{size:9,strokeWidth:1.5}),"Jiang ",c?"On":"Off"]}),a.jsxs("button",{onClick:h,disabled:i,style:{fontSize:9,padding:"2px 7px",borderRadius:3,cursor:i?"default":"pointer",background:i?"rgba(74,158,255,0.08)":"rgba(74,158,255,0.12)",border:`1px solid ${i?"rgba(74,158,255,0.15)":"rgba(74,158,255,0.35)"}`,color:i?"rgba(74,158,255,0.5)":"#4a9eff",display:"flex",alignItems:"center",gap:4},children:[a.jsx(Es,{size:9,strokeWidth:1.5}),i?`Deep ${Math.round(u*100)}%`:"Deep Forecast"]}),a.jsx("div",{style:{flex:1}}),a.jsxs("button",{onClick:()=>v(P=>!P),style:{fontSize:8,color:"rgba(255,255,255,0.3)",background:"none",border:"none",cursor:"pointer",padding:0,display:"flex",alignItems:"center",gap:3},children:["Advanced ",y?a.jsx(e9,{size:10,strokeWidth:1.5}):a.jsx(Pa,{size:10,strokeWidth:1.5})]})]})]}),y&&a.jsxs("div",{style:{padding:"8px 12px",borderBottom:"1px solid rgba(255,255,255,0.06)",display:"flex",flexDirection:"column",gap:8},children:[C&&a.jsxs("div",{children:[a.jsxs("div",{style:{fontSize:8.5,color:"rgba(255,255,255,0.3)",textTransform:"uppercase",letterSpacing:"0.06em",marginBottom:4},children:["Distribuicao de regimes (",C.trajectories.length," rollouts)"]}),Object.entries(C.probability).sort((P,I)=>I[1]-P[1]).map(([P,I])=>{const $=jh[P]??"#888";return a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginBottom:2},children:[a.jsx("span",{style:{fontSize:8.5,color:$,width:75,flexShrink:0},children:Eh[P]}),a.jsx("div",{style:{flex:1,height:4,background:"rgba(255,255,255,0.06)",borderRadius:2,overflow:"hidden"},children:a.jsx("div",{style:{width:`${I*100}%`,height:"100%",background:$,borderRadius:2}})}),a.jsxs("span",{style:{fontSize:8,color:"rgba(255,255,255,0.4)",width:26,textAlign:"right"},children:[Math.round(I*100),"%"]})]},P)})]}),C&&C.trajectories.length>0&&a.jsxs("div",{children:[a.jsx("div",{style:{fontSize:8.5,color:"rgba(255,255,255,0.3)",textTransform:"uppercase",letterSpacing:"0.06em",marginBottom:5},children:"Tendencias"}),a.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8},children:[a.jsxs("div",{children:[a.jsx(Qy,{values:ex(C,"conflictLine"),color:"#ff5a5a",width:80,height:26}),a.jsx("div",{style:{fontSize:8,color:"rgba(255,255,255,0.3)",marginTop:1},children:"Conflito"})]}),a.jsxs("div",{children:[a.jsx(Qy,{values:ex(C,"inequalityLine"),color:"#ffce5a",width:80,height:26}),a.jsx("div",{style:{fontSize:8,color:"rgba(255,255,255,0.3)",marginTop:1},children:"Desig."})]}),a.jsxs("div",{children:[a.jsx(Qy,{values:ex(C,"legitimacyLine"),color:"#5aff8a",width:80,height:26}),a.jsx("div",{style:{fontSize:8,color:"rgba(255,255,255,0.3)",marginTop:1},children:"Legit."})]})]})]}),C&&a.jsxs("div",{style:{padding:"5px 8px",borderRadius:4,background:"rgba(255,255,255,0.02)",border:"1px solid rgba(255,255,255,0.05)"},children:[a.jsxs("div",{style:{fontSize:8.5,color:"rgba(255,255,255,0.35)",textTransform:"uppercase",letterSpacing:"0.06em",marginBottom:4,display:"flex",alignItems:"center",gap:4},children:[a.jsx(TC,{size:9,strokeWidth:1.5}),"Porque esta previsao?"]}),R.map((P,I)=>{const $=P.direction==="up"||P.direction==="high"?"subiu":"caiu";return a.jsxs("div",{style:{fontSize:9,color:"rgba(255,255,255,0.45)",lineHeight:1.35,marginBottom:2},children:[a.jsx("span",{style:{color:P.color},children:P.label})," ",$," -- correlacao com regime detectada."]},I)}),C.confidence<.4&&a.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.4)",lineHeight:1.35,marginTop:2},children:"Confianca baixa: variancia alta entre rollouts sugere bifurcacao."})]}),a.jsxs("div",{children:[a.jsx("div",{style:{fontSize:8.5,color:"rgba(255,255,255,0.3)",textTransform:"uppercase",letterSpacing:"0.06em",marginBottom:4},children:"Metricas completas"}),a.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:3},children:[{label:"Conflito",val:e.conflictRate,color:"#ff5a5a"},{label:"Desigualdade",val:e.inequality,color:"#ffce5a"},{label:"Legitimidade",val:e.legitimacyMean,color:"#5aff8a"},{label:"Norma",val:e.normMean,color:"#c05aff"},{label:"Coesao",val:e.cohesion,color:"#4a9eff"},{label:"Polarizacao",val:e.polarization,color:"#ff9a3c"},{label:"Escassez",val:e.scarcity,color:"#ff7788"},{label:"Volatilidade",val:e.volatility,color:"#ffd4f0"}].map(P=>a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[a.jsx("span",{style:{fontSize:8,color:"rgba(255,255,255,0.35)",width:60,flexShrink:0},children:P.label}),a.jsx("div",{style:{flex:1,height:3,background:"rgba(255,255,255,0.06)",borderRadius:2,overflow:"hidden"},children:a.jsx("div",{style:{width:`${P.val*100}%`,height:"100%",background:P.color,borderRadius:2}})}),a.jsx("span",{style:{fontSize:8,color:P.color,fontFamily:"monospace",width:22,textAlign:"right",flexShrink:0},children:Math.round(P.val*100)})]},P.label))})]})]})]})},VV=({cardCooldowns:e,activeInterventions:t,currentT:r,onApply:o})=>a.jsx("div",{style:{display:"flex",gap:6,padding:"6px 10px",overflowX:"auto",alignItems:"flex-start"},children:yb.map(s=>{const l=e[s.id]??0,i=r<l,u=Math.max(0,l-r),c=t.some(f=>f.cardId===s.id),d=t.find(f=>f.cardId===s.id),h=d?1-(d.endT-r)/(d.endT-d.startT):0;return a.jsx(UV,{card:s,onCooldown:i,remainCooldown:u,isActive:c,activeProgress:h,onApply:()=>o(s.id)},s.id)})});function UV({card:e,onCooldown:t,remainCooldown:r,isActive:o,activeProgress:s,onApply:l}){const i=!t&&!o,u=e.color;return a.jsxs("div",{onClick:i?l:void 0,title:e.description,style:{flexShrink:0,width:110,padding:"7px 8px",borderRadius:6,cursor:i?"pointer":"default",background:o?`${u}18`:t?"rgba(255,255,255,0.02)":"rgba(255,255,255,0.04)",border:`1px solid ${o?u+"55":t?"rgba(255,255,255,0.05)":u+"33"}`,opacity:t&&!o?.45:1,transition:"all 0.15s",position:"relative",overflow:"hidden"},children:[o&&a.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:`${s*100}%`,height:2,background:u,borderRadius:"0 0 6px 6px",transition:"width 0.5s"}}),a.jsx("div",{style:{fontSize:10,color:o?u:"rgba(255,255,255,0.8)",marginBottom:3,lineHeight:1.2},children:e.name}),a.jsx("div",{style:{fontSize:8.5,color:"rgba(255,255,255,0.4)",lineHeight:1.25,marginBottom:5,overflow:"hidden",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:e.description}),o?a.jsxs("div",{style:{fontSize:8,color:u,textTransform:"uppercase",letterSpacing:"0.06em"},children:["Ativo ",Math.round(s*100),"%"]}):t?a.jsxs("div",{style:{fontSize:8,color:"rgba(255,255,255,0.3)",textTransform:"uppercase",letterSpacing:"0.06em"},children:["Cd: ",r.toFixed(0),"s"]}):a.jsxs("div",{style:{fontSize:8,color:u,textTransform:"uppercase",letterSpacing:"0.06em",display:"flex",justifyContent:"space-between"},children:[a.jsx("span",{children:"Aplicar"}),a.jsxs("span",{style:{opacity:.6},children:["-",Math.round(e.cost*100),"R"]})]})]})}const dw=[{id:"late_empire_decay",name:"Late Empire Decay",description:"Legitimidade alta inercial, desigualdade crescente, norma coercitiva. Observe a transicao lenta de ordem para excecao.",color:"#c05aff",worldOpts:{agentCount:320,factionCount:4,nBaseline:.62,lBaseline:.72,rBaseline:.42,nNoise:.14,lNoise:.1,rNoise:.22},nBaseline:.62,sceneDuration:30,focusMetrics:["inequality","legitimacyMean","normMean"],expectedArc:"Ordem Estavel -> Polarizacao -> Excecao -> Crise"},{id:"inequality_spiral",name:"Inequality Spiral",description:"Recursos concentrados, mobilidade nula. A desigualdade alimenta conflito que alimenta desigualdade.",color:"#ffce5a",worldOpts:{agentCount:300,factionCount:4,nBaseline:.35,lBaseline:.45,rBaseline:.3,nNoise:.2,lNoise:.18,rNoise:.35},nBaseline:.35,sceneDuration:25,focusMetrics:["inequality","conflictRate","scarcity"],suggestedActs:["redistribute","open_commons"],actInterval:40,expectedArc:"Conflito Moderado -> Crise -> (Redistribuicao?) -> Recuperacao Fragil"},{id:"exception_trap",name:"Exception Trap",description:"N altissimo, conflito suprimido artificialmente. Ordem aparente, liberdade zero. Quanto tempo ate a ruptura?",color:"#ff5a5a",worldOpts:{agentCount:300,factionCount:4,nBaseline:.85,lBaseline:.55,rBaseline:.35,nNoise:.06,lNoise:.12,rNoise:.2},nBaseline:.85,sceneDuration:30,focusMetrics:["normMean","legitimacyMean","conflictRate"],suggestedActs:["amnesty"],actInterval:50,expectedArc:"Excecao -> Excecao Prolongada -> Crise Subita"},{id:"propaganda_polarization",name:"Propaganda Polarization",description:"Uma faccao domina a narrativa. Observe a coesao interna subir enquanto a distancia interfaccional cresce.",color:"#ff9a3c",worldOpts:{agentCount:280,factionCount:4,nBaseline:.4,lBaseline:.5,rBaseline:.5,nNoise:.15,lNoise:.2,rNoise:.15},nBaseline:.4,sceneDuration:25,focusMetrics:["polarization","cohesion","conflictRate"],suggestedActs:["propaganda","taboo_wall"],actInterval:35,expectedArc:"Polarizacao -> Conflito -> Crise ou Excecao"},{id:"commons_experiment",name:"Commons Experiment",description:"Recursos abundantes e abertos. A cooperacao emerge ou a tragedia dos comuns se instala?",color:"#5aff8a",worldOpts:{agentCount:260,factionCount:3,nBaseline:.25,lBaseline:.6,rBaseline:.8,nNoise:.12,lNoise:.15,rNoise:.1},nBaseline:.25,sceneDuration:30,focusMetrics:["scarcity","inequality","legitimacyMean"],suggestedActs:["open_commons","ritual_unity"],actInterval:45,expectedArc:"Ordem Estavel -> Polarizacao Economica -> ?"},{id:"border_war",name:"Border War",description:"Faccoes proximas, R disputado nas fronteiras. Conflito localizado que pode escalar.",color:"#4a9eff",worldOpts:{agentCount:340,factionCount:4,nBaseline:.3,lBaseline:.48,rBaseline:.38,nNoise:.25,lNoise:.2,rNoise:.3},nBaseline:.3,sceneDuration:22,focusMetrics:["conflictRate","polarization","volatility"],suggestedActs:["emergency_decree","taboo_wall"],actInterval:30,expectedArc:"Conflito -> Crise -> Excecao ou Recuperacao"},{id:"trade_boom_bust",name:"Trade Boom/Bust",description:"R alto mas volatil. Prosperidade gera desigualdade que gera instabilidade que drena R.",color:"#ffd4f0",worldOpts:{agentCount:260,factionCount:3,nBaseline:.3,lBaseline:.65,rBaseline:.78,nNoise:.12,lNoise:.14,rNoise:.25},nBaseline:.3,sceneDuration:35,focusMetrics:["inequality","scarcity","legitimacyMean"],suggestedActs:["austerity","redistribute"],actInterval:40,expectedArc:"Ordem -> Polarizacao Economica -> Conflito -> Boom/Bust"},{id:"anomaly_stress_test",name:"Anomaly Stress Test",description:"O Mulo ativado desde o inicio. Como o sistema lida com um agente carismatico imprevisivel?",color:"#a0ffee",worldOpts:{agentCount:300,factionCount:4,nBaseline:.45,lBaseline:.55,rBaseline:.5,nNoise:.18,lNoise:.18,rNoise:.2},nBaseline:.45,sceneDuration:28,focusMetrics:["legitimacyMean","cohesion","conflictRate"],expectedArc:"Imprevisivel: O Mulo distorce todas as previsoes."}],YV=({onSelect:e,onClose:t})=>{const[r,o]=w.useState(null);return a.jsxs("div",{style:{position:"absolute",inset:0,background:"rgba(7,7,18,0.92)",backdropFilter:"blur(12px)",zIndex:50,display:"flex",flexDirection:"column",fontFamily:"monospace"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"12px 16px",borderBottom:"1px solid rgba(255,255,255,0.08)"},children:[a.jsx(Rp,{size:14,strokeWidth:1.5,color:"rgba(255,255,255,0.6)"}),a.jsx("span",{style:{fontSize:12,color:"rgba(255,255,255,0.7)",flex:1},children:"Scenarios"}),a.jsxs("span",{style:{fontSize:9,color:"rgba(255,255,255,0.3)"},children:[dw.length," cenarios"]}),a.jsx("button",{onClick:t,style:{background:"none",border:"none",cursor:"pointer",padding:2,color:"rgba(255,255,255,0.4)"},children:a.jsx(ya,{size:14,strokeWidth:1.5})})]}),a.jsx("div",{style:{flex:1,overflowY:"auto",padding:"12px 16px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,alignContent:"start"},children:dw.map(s=>{const l=r===s.id;return a.jsxs("div",{onMouseEnter:()=>o(s.id),onMouseLeave:()=>o(null),onClick:()=>e(s),style:{padding:"10px 12px",borderRadius:6,cursor:"pointer",background:l?`${s.color}12`:"rgba(255,255,255,0.025)",border:`1px solid ${l?s.color+"44":"rgba(255,255,255,0.06)"}`,transition:"all 0.15s",display:"flex",flexDirection:"column",gap:4},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[a.jsx("div",{style:{width:6,height:6,borderRadius:3,background:s.color,flexShrink:0}}),a.jsx("span",{style:{fontSize:10.5,color:l?s.color:"rgba(255,255,255,0.8)",lineHeight:1.2},children:s.name}),l&&a.jsx(aa,{size:10,color:s.color,style:{marginLeft:"auto"}})]}),a.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.4)",lineHeight:1.3},children:s.description}),a.jsx("div",{style:{fontSize:8.5,color:"rgba(255,255,255,0.3)",fontStyle:"italic",lineHeight:1.25},children:s.expectedArc}),a.jsxs("div",{style:{display:"flex",gap:3,flexWrap:"wrap"},children:[s.focusMetrics.map(i=>a.jsx("span",{style:{fontSize:7.5,padding:"1px 4px",borderRadius:2,background:"rgba(255,255,255,0.05)",color:"rgba(255,255,255,0.35)",textTransform:"uppercase",letterSpacing:"0.04em"},children:i},i)),s.suggestedActs&&a.jsxs("span",{style:{fontSize:7.5,padding:"1px 4px",borderRadius:2,background:"rgba(255,206,90,0.08)",color:"rgba(255,206,90,0.5)",display:"flex",alignItems:"center",gap:2},children:[a.jsx(wl,{size:7,strokeWidth:1.5}),"auto-play"]})]})]},s.id)})}),a.jsx("div",{style:{padding:"8px 16px",borderTop:"1px solid rgba(255,255,255,0.06)",fontSize:9,color:"rgba(255,255,255,0.25)"},children:"Selecione um cenario. Voce pode brincar livremente apos iniciar."})]})},f5=[[74,158,255],[255,90,90],[90,255,138],[255,206,90]];function KV(e,t,r,o,s,l){const i=e.getContext("2d");if(!i)return;const u=e.width,c=e.height;i.fillStyle="#000",i.fillRect(0,0,u,c);const d=t.world;if(l){const m=i.createImageData(Jn,Jn);for(let b=0;b<Jn*Jn;b++){const S=d.field.R[b];if(S>.5){const C=(S-.5)*2;m.data[b*4+0]=90,m.data[b*4+1]=255,m.data[b*4+2]=138,m.data[b*4+3]=Math.round(C*30)}}const y=document.createElement("canvas");y.width=Jn,y.height=Jn,y.getContext("2d").putImageData(m,0,0),i.save(),i.imageSmoothingEnabled=!0,i.drawImage(y,0,0,u,c),i.restore()}if(s){const m=i.createImageData(Jn,Jn);for(let b=0;b<Jn*Jn;b++){const S=d.field.N[b],C=d.field.L[b],k=Math.max(0,S*.7-C*.4);if(k>.15){const R=(k-.15)*3;m.data[b*4+0]=255,m.data[b*4+1]=60,m.data[b*4+2]=60,m.data[b*4+3]=Math.round(Math.min(1,R)*22)}}const y=document.createElement("canvas");y.width=Jn,y.height=Jn,y.getContext("2d").putImageData(m,0,0),i.save(),i.imageSmoothingEnabled=!0,i.drawImage(y,0,0,u,c),i.restore()}if(r!=="off"){const m=r==="R"?d.field.R:r==="L"?d.field.L:d.field.N,y={R:[90,255,138],L:[74,158,255],N:[255,90,90]},[v,b,S]=y[r],C=i.createImageData(Jn,Jn);for(let j=0;j<Jn*Jn;j++){const T=m[j];C.data[j*4+0]=v,C.data[j*4+1]=b,C.data[j*4+2]=S,C.data[j*4+3]=Math.round(T*55)}const k=document.createElement("canvas");k.width=Jn,k.height=Jn,k.getContext("2d").putImageData(C,0,0),i.save(),i.imageSmoothingEnabled=!1,i.drawImage(k,0,0,u,c),i.restore()}for(let m=0;m<d.factionCount;m++){const y=d.centroids[m];if(y.count===0)continue;const v=y.x*u,b=y.y*c,[S,C,k]=f5[m%f5.length],R=i.createRadialGradient(v,b,0,v,b,55);R.addColorStop(0,`rgba(${S},${C},${k},0.12)`),R.addColorStop(1,`rgba(${S},${C},${k},0)`),i.fillStyle=R,i.beginPath(),i.arc(v,b,55,0,Math.PI*2),i.fill()}for(const m of d.agents){const y=m.x*u,v=m.y*c,[b,S,C]=f5[m.factionId%f5.length],k=.55+m.wealth*.45;i.fillStyle=`rgba(${b},${S},${C},${k.toFixed(2)})`,i.beginPath(),i.arc(y,v,2.2+m.status*1.2,0,Math.PI*2),i.fill()}if(t.mule.active){const m=t.mule.x*u,y=t.mule.y*c,v=1+Math.sin(t.world.t*3)*.2;i.strokeStyle="rgba(192,90,255,0.25)",i.lineWidth=1,i.beginPath(),i.arc(m,y,t.mule.radius*u*v,0,Math.PI*2),i.stroke();const b=i.createRadialGradient(m,y,0,m,y,7*v);b.addColorStop(0,"rgba(255,255,255,0.95)"),b.addColorStop(.4,"rgba(192,90,255,0.8)"),b.addColorStop(1,"rgba(192,90,255,0)"),i.fillStyle=b,i.beginPath(),i.arc(m,y,7*v,0,Math.PI*2),i.fill()}if(t.world.conflictDecay>2){const m=Math.min(.08,t.world.conflictDecay*.003);i.fillStyle=`rgba(255,90,90,${m})`,i.fillRect(0,0,u,c)}const h=t.world.t;for(const m of t.eventPings){const y=h-m.t;if(y<0||y>m.duration)continue;const v=y/m.duration,b=1-v,S=8+v*25,C=m.x*u,k=m.y*c;i.strokeStyle=m.color+Math.round(b*100).toString(16).padStart(2,"0"),i.lineWidth=1.5,i.beginPath(),i.arc(C,k,S,0,Math.PI*2),i.stroke(),v<.6&&(i.font="9px monospace",i.fillStyle=m.color+Math.round(b*200).toString(16).padStart(2,"0"),i.fillText(m.label,C+S+4,k+3))}const f=yg(t.metrics,t.prevMetrics),g=jh[f];i.font="11px monospace",i.fillStyle=g+"cc",i.fillText(Eh[f],10,c-12),i.font="10px monospace",i.fillStyle="rgba(255,255,255,0.35)",i.fillText(`A${t.currentAct} C${t.currentScene} T${d.t.toFixed(0)}s`,10,c-28)}function Tu({label:e,value:t,color:r}){return a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:3},children:[a.jsx("div",{style:{width:36,height:4,background:"rgba(255,255,255,0.07)",borderRadius:2,overflow:"hidden"},children:a.jsx("div",{style:{width:`${t*100}%`,height:"100%",background:r,borderRadius:2}})}),a.jsx("span",{style:{fontSize:8.5,color:"rgba(255,255,255,0.4)"},children:e}),a.jsx("span",{style:{fontSize:9,color:r,fontFamily:"monospace"},children:(t*100).toFixed(0)})]})}const uw=8,XV=({active:e})=>{const t=w.useRef(null),r=w.useRef(0),o=w.useRef(null),s=w.useRef(null);w.useRef(0),w.useRef(null);const[l,i]=w.useState(!0),[u,c]=w.useState(0),[d,h]=w.useState(Yy[0]),[f,g]=w.useState(30),[m,y]=w.useState("off"),[v,b]=w.useState(!1),[S,C]=w.useState(null),[k,R]=w.useState(!1),[j,T]=w.useState(!0),[_,P]=w.useState(!0),[I,$]=w.useState(!0),[q,L]=w.useState(Gy()),[H,G]=w.useState(null),[oe,le]=w.useState([]),[pe,ce]=w.useState("STABLE_ORDER"),[te,F]=w.useState(!1),[Q,ae]=w.useState(null),[we,Re]=w.useState(null),[ge,Ae]=w.useState(!1),[tt,We]=w.useState(!1),[J,ke]=w.useState(0),[Le,K]=w.useState(null),[et,dt]=w.useState(!1),[Rt,Wt]=w.useState(!0),[Zt,$e]=w.useState({}),[Ze,Fe]=w.useState([]),[Xe,jt]=w.useState(0),hn=w.useRef(0),an=w.useRef(0),it=w.useRef("STABLE_ORDER"),kt=w.useCallback((Ie,at,St)=>{const ye=at??Date.now()^Math.floor(Math.random()*4294967295),xe=Fp(ye);s.current=xe;const Ge={world:aV({...Ie.worldOpts,seed:ye}),metrics:Gy(),prevMetrics:null,history:[],activeInterventions:[],cardCooldowns:{},mule:kV(),currentAct:1,currentScene:0,sceneT:0,sceneDuration:Ie.sceneDuration,lastMacroT:0,macroTickInterval:1.5,forecastResult:null,forecastRunning:!1,forecastJob:null,counterfactualResults:null,anomalyEnabled:St??!1,lastAnomalyCheck:0,autoForecastResult:null,autoForecastJob:null,autoForecastRunning:!1,lastAutoForecastT:-uw,autoForecastCooldown:uw,autoCompareResult:null,autoCompareExpiry:0,jiangLensEnabled:!0,eventPings:[]};o.current=Ge,L(Gy()),G(null),le([]),ce("STABLE_ORDER"),F(!1),ae(null),Re(null),K(null),dt(!1),$e({}),Fe([]),Ae(!1),We(!1),ke(0),C(null),jt(0),it.current="STABLE_ORDER"},[]);w.useEffect(()=>{kt(Yy[0])},[kt]);const On=w.useCallback((Ie,at,St,ye)=>{const xe=o.current;if(!xe)return;const gt={x:St??.5,y:ye??.5,label:Ie,color:at,t:xe.world.t,duration:3};xe.eventPings.push(gt),xe.eventPings=xe.eventPings.filter(Ge=>xe.world.t-Ge.t<Ge.duration+1)},[]);w.useEffect(()=>{if(!e){cancelAnimationFrame(r.current);return}let Ie=0;const at=St=>{if(r.current=requestAnimationFrame(at),Ie===0){Ie=St;return}const ye=Math.min((St-Ie)/1e3,.05);Ie=St,hn.current++,St-an.current>=1e3&&(c(hn.current),hn.current=0,an.current=St);const xe=o.current;if(!xe)return;if(xe.forecastJob&&xe.forecastRunning){const Ge=cw(xe.forecastJob,xe.forecastJob.nBaseline,6);if(ke(xe.forecastJob.rolloutsDone/xe.forecastJob.totalRollouts),Ge){const Ye=Ky(xe.mule),Ve=h5(xe.forecastJob,xe.mule.active,Ye);xe.forecastResult=Ve,xe.forecastRunning=!1,xe.forecastJob=null,Re(Ve),We(!1),ke(1),xe.autoForecastResult=Ve,ae(Ve)}}if(xe.autoForecastJob&&xe.autoForecastRunning&&!xe.forecastRunning&&cw(xe.autoForecastJob,xe.autoForecastJob.nBaseline,4)){const Ye=Ky(xe.mule),Ve=h5(xe.autoForecastJob,xe.mule.active,Ye);xe.autoForecastResult=Ve,xe.autoForecastRunning=!1,xe.autoForecastJob=null,xe.lastAutoForecastT=xe.world.t,ae(Ve),Ae(!1)}if(!l){Xn(xe);return}const gt=ye;xe.activeInterventions=xe.activeInterventions.filter(Ge=>Ge.endT>xe.world.t);for(const Ge of xe.activeInterventions){const Ye=(xe.world.t-Ge.startT)/(Ge.endT-Ge.startT),Ve=Math.sin(Ye*Math.PI);DR(xe.world,Ge.cardId,Ve)}if(xe.mule.active&&(jV(xe.mule,xe.world,gt),xe.mule.active||(F(!1),On("Mule expired","#c05aff",xe.mule.x,xe.mule.y))),NR(xe.world,gt,s.current),xe.world.t-xe.lastMacroT>=xe.macroTickInterval){const Ge=xe.world.t-xe.lastMacroT,Ye=_R(xe.world.agents);OR(xe.world,Ge,Ye,d.nBaseline);const Ve=xe.world.conflictAccum/Math.max(.01,Ge);xe.world.conflictAccum=0;const Oe=gb(xe.world,Ve);xe.prevMetrics=xe.metrics,xe.metrics=Oe,xe.lastMacroT=xe.world.t,L({...Oe}),G(xe.prevMetrics?{...xe.prevMetrics}:null);const Gt=yg(Oe,xe.prevMetrics);if(ce(Gt),Gt!==it.current){const Kt=xe.world.centroids[0];On(`Phase: ${Eh[Gt]}`,jh[Gt],Kt.x,Kt.y),it.current=Gt}}xe.sceneT+=gt,xe.sceneT>=xe.sceneDuration&&(sn(xe),xe.sceneT=0),v&&!xe.mule.active&&xe.world.t-xe.lastAnomalyCheck>xe.sceneDuration&&(xe.lastAnomalyCheck=xe.world.t,RV(xe.mule,v,xe.world.seed,xe.currentScene)&&(xe.mule=AV(xe.world,xe.world.seed^xe.currentScene),F(!0),On("Anomaly: The Mule","#c05aff",xe.mule.x,xe.mule.y))),!xe.autoForecastRunning&&!xe.forecastRunning&&xe.world.t-xe.lastAutoForecastT>=xe.autoForecastCooldown&&(xe.autoForecastJob=DV(xe.world,d.nBaseline),xe.autoForecastRunning=!0,Ae(!0)),xe.autoCompareExpiry>0&&xe.world.t>xe.autoCompareExpiry&&dt(!1),xe.eventPings=xe.eventPings.filter(Ge=>xe.world.t-Ge.t<Ge.duration+1),jt(xe.world.t),Fe([...xe.activeInterventions]),Xn(xe)};return r.current=requestAnimationFrame(at),()=>cancelAnimationFrame(r.current)},[e,l,v,d,m,j,_]);function sn(Ie){var Ye;const at=yg(Ie.metrics,Ie.prevMetrics),St=Ie.activeInterventions.length>0?(Ye=yb.find(Ve=>Ve.id===Ie.activeInterventions[0].cardId))==null?void 0:Ye.name:void 0,ye=!!St,{headline:xe,causal:gt}=SV(at,Ie.metrics,Ie.prevMetrics,ye,St),Ge={act:Ie.currentAct,scene:Ie.currentScene,t:Ie.world.t,phaseLabel:at,metrics:{...Ie.metrics},headline:xe,causal:gt,isAct:ye,actName:St};Ie.history.push(Ge),Ie.currentScene++,Ie.currentScene%4===0&&Ie.currentAct++,le([...Ie.history]),Ie.lastAutoForecastT=Ie.world.t-Ie.autoForecastCooldown-1}function Xn(Ie){const at=t.current;at&&KV(at,Ie,m,!0,j,_)}const Pt=w.useCallback(Ie=>{const at=o.current;if(!at)return;const St=yb.find(Ge=>Ge.id===Ie);if(!St)return;const ye=at.cardCooldowns[Ie]??0;if(at.world.t<ye||at.activeInterventions.some(Ge=>Ge.cardId===Ie))return;const xe={cardId:Ie,startT:at.world.t,endT:at.world.t+St.durationSeconds,strength:1};at.activeInterventions.push(xe),at.cardCooldowns[Ie]=at.world.t+St.durationSeconds+St.cooldownSeconds,$e({...at.cardCooldowns}),Fe([...at.activeInterventions]);const gt=at.world.centroids[0];if(On(`Act: ${St.name}`,St.color,gt.x,gt.y),at.lastAutoForecastT=at.world.t-at.autoForecastCooldown-1,I)try{const Ge=iw(at.world,d.nBaseline);for(;Ge.rolloutsDone<Ge.totalRollouts;)lw(Ge,Ge.nBaseline,4);const Ye=Nv(at.world);CV(Ye,Ie,.3);const Ve=iw(Ye,d.nBaseline);for(;Ve.rolloutsDone<Ve.totalRollouts;)lw(Ve,Ve.nBaseline,4);const Oe=Ky(at.mule),Gt=h5(Ge,at.mule.active,Oe),Kt=h5(Ve,at.mule.active,Oe),fn={withAct:Gt,withoutAct:Kt,cardId:Ie,appliedAt:at.world.t};at.autoCompareResult=fn,at.autoCompareExpiry=at.world.t+5,K(fn),dt(!0)}catch{}},[d,On,I]),zt=w.useCallback(()=>{const Ie=o.current;if(!Ie||Ie.forecastRunning)return;const at=LV(Ie.world,d.nBaseline);Ie.forecastJob=at,Ie.forecastRunning=!0,We(!0),ke(0)},[d]),jn=w.useCallback(Ie=>{h(Ie),g(Ie.sceneDuration),kt(Ie)},[kt]),En=w.useCallback(Ie=>{const at={id:Ie.id,name:Ie.name,description:Ie.description,color:Ie.color,worldOpts:Ie.worldOpts,nBaseline:Ie.nBaseline,sceneDuration:Ie.sceneDuration,expectedRegime:Ie.expectedArc};h(at),g(Ie.sceneDuration);const St=Ie.id==="anomaly_stress_test";kt(at,void 0,St),St&&b(!0),R(!1)},[kt]),lt=w.useCallback(()=>{kt(d)},[d,kt]);if(w.useEffect(()=>{o.current&&(o.current.anomalyEnabled=v)},[v]),w.useEffect(()=>{o.current&&(o.current.sceneDuration=f)},[f]),!e)return null;const ht=Eh[pe],_t=jh[pe];return a.jsxs("div",{style:{position:"fixed",inset:0,top:36,background:"#000",display:"flex",flexDirection:"column",fontFamily:"monospace"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"6px 12px",background:"rgba(0,0,0,0.4)",borderBottom:"1px solid rgba(255,255,255,0.06)",flexShrink:0,flexWrap:"wrap"},children:[a.jsxs("button",{title:"Play",onClick:()=>i(Ie=>!Ie),style:{padding:"4px 10px",borderRadius:4,cursor:"pointer",background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.12)",color:"rgba(255,255,255,0.85)",display:"flex",alignItems:"center",gap:5},children:[l?a.jsx(s0,{size:11,strokeWidth:1.5}):a.jsx(wl,{size:11,strokeWidth:1.5}),a.jsx("span",{style:{fontSize:10},children:l?"Pausar":"Rodar"})]}),a.jsxs("button",{title:"Pausar",onClick:lt,style:{padding:"4px 10px",borderRadius:4,cursor:"pointer",background:"rgba(255,255,255,0.04)",border:"1px solid rgba(255,255,255,0.08)",color:"rgba(255,255,255,0.55)",display:"flex",alignItems:"center",gap:5},children:[a.jsx(Wi,{size:10,strokeWidth:1.5}),a.jsx("span",{style:{fontSize:10},children:"Reset"})]}),a.jsx("div",{style:{width:1,height:18,background:"rgba(255,255,255,0.08)"}}),Yy.map(Ie=>a.jsx("button",{title:"Pular",onClick:()=>jn(Ie),style:{padding:"3px 9px",borderRadius:4,cursor:"pointer",fontSize:9.5,background:d.id===Ie.id?`${Ie.color}22`:"transparent",border:`1px solid ${d.id===Ie.id?Ie.color+"55":"rgba(255,255,255,0.08)"}`,color:d.id===Ie.id?Ie.color:"rgba(255,255,255,0.45)",textTransform:"uppercase",letterSpacing:"0.06em"},children:Ie.name},Ie.id)),a.jsxs("button",{title:"Reiniciar",onClick:()=>R(!0),style:{padding:"3px 9px",borderRadius:4,cursor:"pointer",fontSize:9.5,background:"rgba(160,255,238,0.06)",border:"1px solid rgba(160,255,238,0.2)",color:"#a0ffee",display:"flex",alignItems:"center",gap:4,textTransform:"uppercase",letterSpacing:"0.06em"},children:[a.jsx(Rp,{size:10,strokeWidth:1.5}),"Scenarios"]}),a.jsx("div",{style:{width:1,height:18,background:"rgba(255,255,255,0.08)"}}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5},children:[a.jsx("span",{style:{fontSize:9,color:"rgba(255,255,255,0.35)"},children:"Cena"}),[20,30,60].map(Ie=>a.jsxs("button",{title:"Anterior",onClick:()=>g(Ie),style:{padding:"2px 7px",borderRadius:3,cursor:"pointer",fontSize:9,background:f===Ie?"rgba(255,255,255,0.1)":"transparent",border:`1px solid ${f===Ie?"rgba(255,255,255,0.2)":"rgba(255,255,255,0.06)"}`,color:f===Ie?"rgba(255,255,255,0.8)":"rgba(255,255,255,0.35)"},children:[Ie,"s"]},Ie))]}),a.jsx("div",{style:{width:1,height:18,background:"rgba(255,255,255,0.08)"}}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[a.jsx("span",{style:{fontSize:9,color:"rgba(255,255,255,0.35)"},children:"Campo"}),["off","R","L","N"].map(Ie=>a.jsx("button",{title:"Prximo",onClick:()=>y(Ie),style:{padding:"2px 7px",borderRadius:3,cursor:"pointer",fontSize:9,background:m===Ie?"rgba(255,255,255,0.1)":"transparent",border:`1px solid ${m===Ie?"rgba(255,255,255,0.2)":"rgba(255,255,255,0.06)"}`,color:m===Ie?Ie==="R"?"#5aff8a":Ie==="L"?"#4a9eff":Ie==="N"?"#ff5a5a":"rgba(255,255,255,0.7)":"rgba(255,255,255,0.35)"},children:Ie==="off"?"Off":Ie},Ie))]}),a.jsx("div",{style:{width:1,height:18,background:"rgba(255,255,255,0.08)"}}),a.jsx("button",{onClick:()=>T(Ie=>!Ie),title:"Tensao: N alto + L baixo = overlay vermelho sutil",style:{padding:"2px 7px",borderRadius:3,cursor:"pointer",fontSize:9,background:j?"rgba(255,90,90,0.1)":"transparent",border:`1px solid ${j?"rgba(255,90,90,0.3)":"rgba(255,255,255,0.06)"}`,color:j?"#ff5a5a":"rgba(255,255,255,0.35)"},children:"Tens"}),a.jsx("button",{onClick:()=>P(Ie=>!Ie),title:"Hotspots de recurso R",style:{padding:"2px 7px",borderRadius:3,cursor:"pointer",fontSize:9,background:_?"rgba(90,255,138,0.1)":"transparent",border:`1px solid ${_?"rgba(90,255,138,0.3)":"rgba(255,255,255,0.06)"}`,color:_?"#5aff8a":"rgba(255,255,255,0.35)"},children:"R"}),a.jsx("div",{style:{width:1,height:18,background:"rgba(255,255,255,0.08)"}}),a.jsxs("button",{title:"Fechar",onClick:()=>b(Ie=>!Ie),style:{padding:"3px 9px",borderRadius:4,cursor:"pointer",fontSize:9.5,display:"flex",alignItems:"center",gap:5,background:v?"rgba(192,90,255,0.15)":"rgba(255,255,255,0.03)",border:`1px solid ${v?"rgba(192,90,255,0.45)":"rgba(255,255,255,0.08)"}`,color:v?"#c05aff":"rgba(255,255,255,0.35)"},children:[a.jsx(tT,{size:10,strokeWidth:1.5}),a.jsxs("span",{children:["Mule ",v?"On":"Off"]})]}),a.jsxs("button",{onClick:()=>$(Ie=>!Ie),title:"Auto-Compare: mostra delta apos cada ato",style:{padding:"2px 7px",borderRadius:3,cursor:"pointer",fontSize:9,background:I?"rgba(255,206,90,0.08)":"transparent",border:`1px solid ${I?"rgba(255,206,90,0.25)":"rgba(255,255,255,0.06)"}`,color:I?"#ffce5a":"rgba(255,255,255,0.35)"},children:["Cmp ",I?"On":"Off"]}),te&&a.jsx("span",{style:{fontSize:9,padding:"2px 7px",borderRadius:3,background:"rgba(192,90,255,0.18)",color:"#c05aff"},children:"MULE ATIVA"}),a.jsxs("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center",gap:8},children:[a.jsx("span",{style:{fontSize:9,padding:"2px 7px",borderRadius:3,background:`${_t}18`,color:_t,textTransform:"uppercase",letterSpacing:"0.06em"},children:ht}),a.jsxs("span",{style:{fontSize:9,color:"rgba(255,255,255,0.3)"},children:[u,"fps"]}),a.jsxs("span",{style:{fontSize:9,color:"rgba(255,255,255,0.25)",fontFamily:"monospace"},children:["T",Xe.toFixed(0),"s"]})]})]}),a.jsxs("div",{style:{flex:1,display:"flex",overflow:"hidden",minHeight:0,position:"relative"},children:[a.jsxs("div",{style:{flex:"1 1 65%",position:"relative",overflow:"hidden"},children:[a.jsx("canvas",{ref:t,width:900,height:600,style:{width:"100%",height:"100%",display:"block",imageRendering:"pixelated"}}),a.jsxs("div",{style:{position:"absolute",bottom:14,right:14,display:"flex",gap:14,background:"rgba(0,0,0,0.55)",backdropFilter:"blur(6px)",borderRadius:6,padding:"7px 12px",border:"1px solid rgba(255,255,255,0.07)"},children:[a.jsx(Tu,{label:"Cnflto",value:q.conflictRate,color:"#ff5a5a"}),a.jsx(Tu,{label:"Desig",value:q.inequality,color:"#ffce5a"}),a.jsx(Tu,{label:"Legit",value:q.legitimacyMean,color:"#5aff8a"}),a.jsx(Tu,{label:"Norma",value:q.normMean,color:"#c05aff"}),a.jsx(Tu,{label:"Coes",value:q.cohesion,color:"#4a9eff"}),a.jsx(Tu,{label:"Polar",value:q.polarization,color:"#ff9a3c"})]}),tt&&a.jsxs("div",{style:{position:"absolute",top:12,left:"50%",transform:"translateX(-50%)",padding:"6px 14px",borderRadius:6,background:"rgba(7,7,18,0.85)",border:"1px solid rgba(74,158,255,0.25)",backdropFilter:"blur(6px)",display:"flex",alignItems:"center",gap:8},children:[a.jsx("div",{style:{width:8,height:8,borderRadius:4,background:"#4a9eff",opacity:.8,animation:"pulse 1s ease-in-out infinite"}}),a.jsxs("span",{style:{fontSize:10,color:"#4a9eff"},children:["Deep Forecast ",Math.round(J*100),"%"]}),a.jsx("div",{style:{width:60,height:3,background:"rgba(255,255,255,0.06)",borderRadius:2,overflow:"hidden"},children:a.jsx("div",{style:{width:`${J*100}%`,height:"100%",background:"#4a9eff",borderRadius:2,transition:"width 0.3s"}})})]})]}),a.jsxs("div",{style:{flex:"0 0 310px",display:"flex",flexDirection:"column",background:"rgba(0,0,0,0.3)",borderLeft:"1px solid rgba(255,255,255,0.06)",overflow:"hidden"},children:[a.jsx("div",{style:{overflowY:"auto",flexShrink:0,maxHeight:"55%",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:a.jsx(GV,{metrics:q,prevMetrics:H,phase:pe,oracleResult:Q,deepResult:we,isAutoRunning:ge,isDeepRunning:tt,deepProgress:J,jiangEnabled:Rt,onToggleJiang:()=>Wt(Ie=>!Ie),onRunDeep:zt,autoCompare:Le,autoCompareVisible:et,muleActive:te})}),a.jsxs("div",{style:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column"},children:[a.jsxs("div",{style:{padding:"6px 12px 4px",fontSize:9.5,color:"rgba(255,255,255,0.35)",textTransform:"uppercase",letterSpacing:"0.08em",borderBottom:"1px solid rgba(255,255,255,0.05)",flexShrink:0},children:["Linha do Tempo (",oe.length," cenas)"]}),a.jsx("div",{style:{flex:1,overflowY:"auto"},children:a.jsx(BV,{frames:oe,selected:S,onSelect:C})})]})]}),k&&a.jsx(YV,{onSelect:En,onClose:()=>R(!1)})]}),a.jsxs("div",{style:{flexShrink:0,background:"rgba(0,0,0,0.45)",borderTop:"1px solid rgba(255,255,255,0.06)"},children:[a.jsx("div",{style:{padding:"4px 10px 2px",fontSize:9,color:"rgba(255,255,255,0.3)",textTransform:"uppercase",letterSpacing:"0.07em"},children:"Atos Historicos"}),a.jsx(VV,{cardCooldowns:Zt,activeInterventions:Ze,currentT:Xe,onApply:Pt})]}),a.jsx("style",{children:`
        @keyframes pulse {
          0%, 100% { opacity: 0.4; transform: scale(1); }
          50% { opacity: 1; transform: scale(1.2); }
        }
      `})]})},bb=180,_r=30,Np=160,tx=3,xg=3.5,ZV={organismToIntensity:.38,visibility:.7,noise:.07,density:.32,multiplicidade:.42,linhasDeFuga:.28,territorializacao:.15,reterritorializacao:.35,hubs:.22,esquecimento:.12},_v={bgColor:"#000000",nodeColor:"#e0e0e0",entryColor:"#ffffff",hubColor:"#b0b0b0",hotColor:"#ffffff",linkColor:"#2a2a2a",flightColor:"#555555",labelColor:"#ffffff",glowIntensity:0,nodeSize:.48,linkOpacity:.6,linkWidth:.38,showLabels:!1,labelSize:.3,relSizeScale:.55,connSizeScale:.55,relDistScale:.5},Iu={rotX:.22,rotY:0,rotZ:0,zoom:1,fov:.55,zSpread:500,fog:.55,autoRotate:!1,autoSpeed:.18,panX:0,panY:0},hw=[{name:"Open Rhizome",description:"Multiplas entradas, baixa hierarquia, rede respira e se espalha.",params:{organismToIntensity:.65,visibility:.75,noise:.18,density:.6,multiplicidade:.85,linhasDeFuga:.55,territorializacao:.3,reterritorializacao:.25,hubs:.1,esquecimento:.28}},{name:"Territorial Clusters",description:"Territorios fortes e consolidados. Assentamentos e bordas claras.",params:{organismToIntensity:.6,visibility:.7,noise:.1,density:.7,multiplicidade:.55,linhasDeFuga:.2,territorializacao:.85,reterritorializacao:.75,hubs:.25,esquecimento:.18}},{name:"Line of Flight",description:"Pontes longas surgem o tempo todo. Saltos e conexoes improvaveis.",params:{organismToIntensity:.72,visibility:.8,noise:.22,density:.5,multiplicidade:.75,linhasDeFuga:.9,territorializacao:.35,reterritorializacao:.28,hubs:.18,esquecimento:.22}},{name:"Forgetting Storm",description:"Poda agressiva. Ruinas e renascimentos continuos.",params:{organismToIntensity:.55,visibility:.65,noise:.15,density:.6,multiplicidade:.6,linhasDeFuga:.4,territorializacao:.55,reterritorializacao:.4,hubs:.25,esquecimento:.92}},{name:"Hub Temptation",description:"A rede tenta virar tronco. Hubs crescem, mas entradas ainda competem.",params:{organismToIntensity:.6,visibility:.75,noise:.1,density:.65,multiplicidade:.55,linhasDeFuga:.22,territorializacao:.55,reterritorializacao:.55,hubs:.88,esquecimento:.22}},{name:"Anti-Hierarchy",description:"Sem troncos. Muitas entradas e pontes leves, sempre distribuido.",params:{organismToIntensity:.7,visibility:.8,noise:.22,density:.58,multiplicidade:.92,linhasDeFuga:.38,territorializacao:.3,reterritorializacao:.18,hubs:0,esquecimento:.38}},{name:"Crystal Garden",description:"Rede estavel, quase mineral. Crescimento lento e coesao alta.",params:{organismToIntensity:.5,visibility:.6,noise:.05,density:.42,multiplicidade:.38,linhasDeFuga:.08,territorializacao:.72,reterritorializacao:.88,hubs:.28,esquecimento:.08}},{name:"Schizo Drift",description:"Alta deriva e novidade. Instavel, multiplo e eletrico.",params:{organismToIntensity:.82,visibility:.88,noise:.38,density:.72,multiplicidade:.88,linhasDeFuga:.75,territorializacao:.22,reterritorializacao:.12,hubs:.12,esquecimento:.58}},{name:"Vacuum Explorers",description:"Nos solitarios navegam o vazio ate serem capturados por linhas de fuga.",params:{organismToIntensity:.75,visibility:.78,noise:.28,density:.45,multiplicidade:.5,linhasDeFuga:.8,territorializacao:.18,reterritorializacao:.2,hubs:.08,esquecimento:.35}}],JV=[{key:"organismToIntensity",label:"Intensidade"},{key:"visibility",label:"Visibilidade"},{key:"noise",label:"Rudo / Deriva"},{key:"density",label:"Densidade"},{key:"multiplicidade",label:"Multiplicidade",tooltip:"Multiplica pontos de entrada. Mais = mais inicios, mais territorios, menos centro unico."},{key:"linhasDeFuga",label:"Linhas de Fuga",tooltip:"Fora que atrai nos para conexoes de longa distancia. Nodes navegam o vacuo ate serem capturados."},{key:"territorializacao",label:"Territorializacao",tooltip:"Puxa formacoes para territorios. Mais = clusters; menos = deriva livre."},{key:"reterritorializacao",label:"Reterritorializacao",tooltip:"Consolida ligacoes locais. Mais = cristalizacao; menos = rede solta."},{key:"hubs",label:"Hubs",tooltip:"Tendencia a hierarquia por anexacao preferencial. Mais = troncos; menos = distribuicao."},{key:"esquecimento",label:"Esquecimento",tooltip:"Poda e renova. Mais = cortes e renascimentos; menos = acumulo e saturacao."}],WR=`
You are an epistemological cartographer building a RHIZOMATIC knowledge graph. Given the topic "{TOPIC}", generate a map with {COUNT} nodes.
Depth level: {DEPTH} (shallow=key concepts only, medium=includes sub-concepts and people, deep=includes edge cases, controversies, and peripheral thinkers).

Return a JSON array of node objects with this EXACT structure:
[
  {
    "label": "ConceptOrPersonName",
    "description": "One-sentence description of this concept or person and their relation to the topic",
    "category": "CategoryName",
    "isEntry": true,
    "relevance": 0.95,
    "popularity": 0.80,
    "directLink": true,
    "connections": ["OtherConceptLabel", ...],
    "typedEdges": [
      { "target": "OtherConceptLabel", "strength": 0.85, "relation": "influences" },
      { "target": "AnotherConcept",    "strength": 0.40, "relation": "contrasts" }
    ]
  }
]

EDGE RELATION TYPES (use exactly these strings):
- "influences"  A shaped B's thinking or development
- "contrasts"  A opposes, tensions with, or challenges B
- "bridges"  A connects disparate domains (LINE OF FLIGHT  cross-cluster unexpected link)
- "extends"  A builds upon or develops from B
- "contains"  A subsumes or includes B
- "co_occurs"  A and B frequently appear together in discourse
- "method_for"  A is a methodology used to study/approach B
- "example_of"  A is an instance or case study of B
- "critiques"  A fundamentally challenges B's premises
- "related"  generic semantic proximity

FIELD RULES:
- label: short (1-4 words). Include PEOPLE (thinkers, artists, scientists) by name.
- description: one sentence, factual, no invented bibliography
- category: group into 3-6 thematic categories
- relevance: 0..1  how central to "{TOPIC}" (1.0=core, 0.1=tangential). A concept that appears in many discussions of this topic should have HIGH relevance.
- popularity: 0..1  cultural/academic prominence (1.0=extremely well-known)
- directLink: true if directly connected to the central topic
- isEntry: mark 3-5 nodes as true (main entry points to navigate the map)
- connections: 2-6 other node labels (MUST be meaningful semantic connections, never random)
- typedEdges: for EACH connection, specify the target label, connection strength (0..1), and relation type. Strength should reflect how tightly coupled the concepts are in real academic/intellectual discourse.

STRUCTURAL RULES:
1. Ensure the network is FULLY CONNECTED (no isolated nodes)
2. Include at least 2-3 BRIDGE edges (relation="bridges") connecting different categories  these are LINES OF FLIGHT
3. Connection strength should vary meaningfully: core relationships = 0.7-1.0, peripheral = 0.2-0.5
4. If a concept is referenced by MANY other nodes, it should have HIGH relevance (it's a hub)
5. Create real CLUSTERS via category  nodes in the same category should be more densely connected

Return ONLY the JSON array, no other text.
`.trim(),HR=`
You are an academic genealogist. For the topic "{TOPIC}", list {COUNT} key PEOPLE  researchers, thinkers, artists, scientists, philosophers, and activists  directly associated with this field.
Depth: {DEPTH}.

Return a JSON array:
[
  {
    "label": "Person Name",
    "description": "One sentence: who they are and their contribution to {TOPIC}",
    "category": "their field or school (e.g. 'critical theory', 'biology', 'art')",
    "isEntry": true/false,
    "relevance": 0.0-1.0,
    "popularity": 0.0-1.0,
    "directLink": true/false,
    "connections": ["Name of intellectual influence or collaborator", ...],
    "typedEdges": [
      { "target": "Other Person", "strength": 0.85, "relation": "influences" },
      { "target": "Another Person", "strength": 0.60, "relation": "contrasts" }
    ]
  }
]

EDGE RELATION TYPES: "influences", "contrasts", "bridges", "extends", "co_occurs", "critiques", "related"

Rules:
- ONLY real people (no concepts, no movements as nodes)
- label = person's name (1-3 words)
- connections = other people in this list who influenced, collaborated, or debated with this person
- typedEdges: specify relationship TYPE and STRENGTH for each connection. Use "influences" for teacherstudent, "contrasts" for intellectual opponents, "bridges" for cross-disciplinary links, "co_occurs" for collaborators
- isEntry = true for 3-5 most central figures
- relevance: if this person is cited/referenced by MANY others in this list, they should have HIGH relevance
- ensure all names are connected (no isolated people)

Return ONLY the JSON array.
`.trim(),GR=`
You are a philosophical cartographer specializing in the work of a single thinker.
Map the intellectual universe of "{TOPIC}"  their key concepts, major works, influences, and legacy  as {COUNT} nodes.
Depth: {DEPTH}.

Return a JSON array:
[
  {
    "label": "Concept or Book Title",
    "description": "One sentence: what this is within {TOPIC}'s thought",
    "category": "core concept / major work / influence / student/heir / debate",
    "isEntry": true/false,
    "relevance": 0.0-1.0,
    "popularity": 0.0-1.0,
    "directLink": true/false,
    "connections": ["Related concept or work", ...],
    "typedEdges": [
      { "target": "RelatedConcept", "strength": 0.90, "relation": "extends" },
      { "target": "InfluentialWork", "strength": 0.70, "relation": "contains" }
    ]
  }
]

EDGE RELATION TYPES: "influences", "contrasts", "bridges", "extends", "contains", "co_occurs", "method_for", "example_of", "critiques", "related"

Rules:
- Include: key concepts, book/article titles (short), people who influenced them, students/heirs
- isEntry = true for the 3-5 most central concepts
- typedEdges: specify how each concept RELATES to others. "extends" for developments, "contains" for subsumption, "influences" for genealogy, "bridges" for cross-domain leaps
- connections must be meaningful (not random)
- relevance: concepts that are referenced by MANY other nodes should have HIGH relevance
- label max 4 words

Return ONLY the JSON array.
`.trim(),VR=`
You are a curriculum designer and expert in "{TOPIC}".
Create an optimal STUDY PATH of {COUNT} steps to master this topic from beginner to advanced.
Depth: {DEPTH}.

Return a JSON array ORDERED from first to last step:
[
  {
    "label": "Step Name",
    "description": "One sentence: what to study here and why it comes at this point",
    "category": "foundation / theory / method / advanced / practice",
    "isEntry": true/false,
    "relevance": 0.0-1.0,
    "popularity": 0.0-1.0,
    "directLink": true/false,
    "order": 1,
    "connections": ["Next step", "prerequisite step", ...],
    "typedEdges": [
      { "target": "Next Step", "strength": 0.90, "relation": "extends" },
      { "target": "Prerequisite", "strength": 0.80, "relation": "contains" }
    ]
  }
]

EDGE RELATION TYPES: "extends" (unlocks/builds-upon), "contains" (prerequisite), "bridges" (cross-domain leap), "co_occurs" (parallel study), "related"

Rules:
- order: integer starting at 1, increasing through the array
- The first 1-3 nodes are foundational (isEntry=true)
- connections should reflect prerequisites AND what this unlocks
- typedEdges: use "extends" for sequential progression, "contains" for prerequisites, "bridges" for unexpected cross-domain connections
- Each step connects to at least 2 others (prev/next or branching)
- label is a short name for this learning step

Return ONLY the JSON array.
`.trim(),UR=`
You are a scholar of academic disputes and intellectual history.
For "{TOPIC}", map the main CONTROVERSIES, tensions, competing schools, and unresolved debates as {COUNT} nodes.
Depth: {DEPTH}.

Return a JSON array:
[
  {
    "label": "Controversy or School Name",
    "description": "One sentence: what this debate or school is about",
    "category": "school / debate / tension / person / concept",
    "isEntry": true/false,
    "relevance": 0.0-1.0,
    "popularity": 0.0-1.0,
    "directLink": true/false,
    "connections": ["Opposing view", "related debate", ...],
    "typedEdges": [
      { "target": "Opposing School", "strength": 0.90, "relation": "contrasts" },
      { "target": "Related Debate", "strength": 0.60, "relation": "co_occurs" }
    ]
  }
]

EDGE RELATION TYPES: "contrasts" (opposition), "influences" (genealogy), "bridges" (cross-domain), "extends" (development), "critiques" (challenge), "co_occurs" (parallel), "related"

Rules:
- Include: opposing schools, key debates, contested figures, paradigm conflicts
- typedEdges: use "contrasts" for oppositions, "critiques" for challenges, "bridges" for surprising connections across domains, "influences" for genealogy of ideas
- connection strength should reflect intensity of the debate (0.9 = central dispute, 0.3 = tangential)
- isEntry = true for the 3-5 central fault lines
- Make tensions visible in the graph structure

Return ONLY the JSON array.
`.trim(),YR=`
You are a semantic indexer. For "{TOPIC}", generate a dense keyword/concept cloud of {COUNT} terms  the essential vocabulary to understand, search, and navigate this field.
Depth: {DEPTH}.

Return a JSON array:
[
  {
    "label": "Keyword",
    "description": "One sentence definition in context of {TOPIC}",
    "category": "term / method / entity / process / property",
    "isEntry": true/false,
    "relevance": 0.0-1.0,
    "popularity": 0.0-1.0,
    "directLink": true/false,
    "connections": ["Semantically related keyword", ...],
    "typedEdges": [
      { "target": "RelatedTerm", "strength": 0.80, "relation": "co_occurs" },
      { "target": "ParentConcept", "strength": 0.70, "relation": "contains" }
    ]
  }
]

EDGE RELATION TYPES: "co_occurs" (semantic proximity), "contains" (parent/child), "contrasts" (antonym/opposition), "extends" (specialization), "bridges" (cross-domain), "related"

Rules:
- labels are single words or short technical terms (1-2 words)
- connections = semantic proximity (synonyms, antonyms, parent/child concepts)
- typedEdges: use "co_occurs" for terms that frequently appear together, "contains" for hierarchy, "contrasts" for antonyms, "bridges" for cross-domain links
- strength should reflect co-occurrence frequency in academic literature (1.0 = always together, 0.2 = occasional)
- isEntry = true for 3-5 most fundamental terms
- high density: each node connects to 3-6 others

Return ONLY the JSON array.
`.trim();function QV(e){switch(e){case"names_only":return HR;case"person_theory":return GR;case"study_order":return VR;case"controversies":return UR;case"keywords":return YR;default:return WR}}const K0={concepts:WR,names_only:HR,person_theory:GR,study_order:VR,controversies:UR,keywords:YR},Sh={concepts:{icon:"",label:"Conceitos",hint:"Conceitos + pessoas misturados"},names_only:{icon:"",label:"S Nomes",hint:"Apenas pesquisadores e pensadores"},person_theory:{icon:"",label:"Teoria/Autor",hint:"Conceitos, obras e legado de um autor"},study_order:{icon:"",label:"Ordem Estudo",hint:"Caminho sequencial de aprendizado"},controversies:{icon:"",label:"Controvrsias",hint:"Debates, tenses e escolas opostas"},keywords:{icon:"",label:"Keywords",hint:"Vocabulrio essencial denso"}},nx={default:"#00ff66",philosophy:"#a78bfa",science:"#38bdf8",mathematics:"#fb923c",history:"#fbbf24",art:"#f472b6",politics:"#4ade80",economics:"#34d399",psychology:"#c084fc",biology:"#86efac",physics:"#60a5fa",category0:"#00ff66",category1:"#a78bfa",category2:"#38bdf8",category3:"#fb923c",category4:"#fbbf24",category5:"#f472b6"};function KR(e){if(!e)return nx.default;const t=e.toLowerCase();for(const s of Object.keys(nx))if(t.includes(s))return nx[s];let r=0;for(let s=0;s<e.length;s++)r=r*31+e.charCodeAt(s)&16777215;return`hsl(${r%360},70%,60%)`}function eU(e){if(e.apiKey)return e.apiKey;if(typeof window<"u"){const t=window.__APP_CONFIG__;if(t!=null&&t.OPENAI_API_KEY)return t.OPENAI_API_KEY}return null}async function tU(e,t,r,o=20){var f,g,m;const s=new AbortController,l=Math.max(9e4,o*1800),i=setTimeout(()=>s.abort(),l),u=Math.min(8e3,Math.max(4e3,o*280)),c=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":e,"anthropic-version":"2023-06-01"},body:JSON.stringify({model:t,max_tokens:u,messages:[{role:"user",content:r}]}),signal:s.signal});if(clearTimeout(i),!c.ok){let y=`Anthropic API error (${c.status})`;try{const v=await c.json();(f=v.error)!=null&&f.message&&(y=v.error.message)}catch{}throw new Error(y)}const h=(m=(g=(await c.json()).content)==null?void 0:g[0])==null?void 0:m.text;if(!h)throw new Error("Resposta vazia da API Anthropic.");return h}async function nU(e,t,r,o,s,l){var b,S,C,k;const i=Math.min(16e3,Math.max(4e3,s*300)),u=Math.max(9e4,s*1800),c=new AbortController,d=setTimeout(()=>c.abort(),u),h=await fetch(`${t}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({model:r,messages:[{role:"user",content:o}],temperature:.7,max_tokens:i,stream:!0}),signal:c.signal});if(clearTimeout(d),!h.ok){let R=`API error (${h.status})`;try{const j=await h.json();(b=j.error)!=null&&b.message&&(R=j.error.message)}catch{}throw h.status===401?new Error("API key invlida. Verifique a chave em Settings."):h.status===429?new Error("Limite de requisies excedido. Aguarde."):new Error(R)}const f=h.body.getReader(),g=new TextDecoder;let m="",y=0;function v(){let R=0,j=0;for(;R<m.length;){const T=m.indexOf("{",R);if(T===-1)break;let _=0,P=-1,I=!1,$=!1;for(let q=T;q<m.length;q++){const L=m[q];if($){$=!1;continue}if(L==="\\"&&I){$=!0;continue}if(L==='"'){I=!I;continue}if(!I&&(L==="{"&&_++,L==="}"&&(_--,_===0))){P=q;break}}if(P===-1)break;if(j++,j>y)try{const q=JSON.parse(m.slice(T,P+1));q&&typeof q.label=="string"&&q.label.trim()&&(y++,l({label:String(q.label).trim(),description:q.description?String(q.description):void 0,category:q.category?String(q.category).toLowerCase():"default",isEntry:!!q.isEntry,connections:Array.isArray(q.connections)?q.connections.filter(L=>typeof L=="string").map(L=>String(L).trim()):[],typedEdges:XR(q.typedEdges),relevance:typeof q.relevance=="number"?Math.max(0,Math.min(1,q.relevance)):.5,popularity:typeof q.popularity=="number"?Math.max(0,Math.min(1,q.popularity)):.5,directLink:!!(q.directLink??q.isEntry)}))}catch{}R=P+1}}try{for(;;){const{done:R,value:j}=await f.read();if(R)break;const T=g.decode(j,{stream:!0});for(const _ of T.split(`
`)){const P=_.trim();if(!P.startsWith("data:"))continue;const I=P.slice(5).trim();if(I==="[DONE]")return;try{const q=((k=(C=(S=JSON.parse(I).choices)==null?void 0:S[0])==null?void 0:C.delta)==null?void 0:k.content)??"";m+=q,v()}catch{}}}}finally{f.releaseLock()}}const rU=new Set(["influences","contrasts","bridges","extends","contains","co_occurs","method_for","example_of","critiques","related"]);function XR(e){if(!Array.isArray(e))return;const t=[];for(const r of e){if(!r||typeof r!="object"||typeof r.target!="string")continue;const o=rU.has(r.relation)?r.relation:"related",s=typeof r.strength=="number"?Math.max(0,Math.min(1,r.strength)):.5;t.push({target:r.target.trim(),strength:s,relation:o})}return t.length>0?t:void 0}function oU(e){let t=e.trim();const r=t.match(/```(?:json)?\s*([\s\S]*?)```/);r&&(t=r[1].trim());const o=t.indexOf("["),s=t.lastIndexOf("]");if(o===-1||s===-1||s<=o)throw new Error("Nenhum array JSON encontrado na resposta.");t=t.slice(o,s+1);let l;try{l=JSON.parse(t)}catch{l=[];const i=/\{[\s\S]*?\}/g;let u;for(;(u=i.exec(t))!==null;)try{l.push(JSON.parse(u[0]))}catch{}}if(!Array.isArray(l))throw new Error("Resposta no  um array JSON.");return l.filter(i=>i&&typeof i.label=="string"&&i.label.trim()).map(i=>({label:String(i.label).trim(),description:i.description?String(i.description):void 0,category:i.category?String(i.category).toLowerCase():"default",isEntry:!!i.isEntry,connections:Array.isArray(i.connections)?i.connections.filter(u=>typeof u=="string").map(u=>String(u).trim()):[],typedEdges:XR(i.typedEdges),relevance:typeof i.relevance=="number"?Math.max(0,Math.min(1,i.relevance)):.5,popularity:typeof i.popularity=="number"?Math.max(0,Math.min(1,i.popularity)):.5,directLink:!!(i.directLink??i.isEntry),order:typeof i.order=="number"?i.order:void 0}))}async function fw(e,t,r){const o=eU(e);if(!o){const c=aU(e);for(let d=0;d<c.nodes.length;d++)await new Promise(h=>setTimeout(h,80)),t(c.nodes[d],d);r(c.nodes.length);return}const l=QV(e.llmMode).replace(/{TOPIC}/g,e.topic).replace("{COUNT}",String(e.nodeCount)).replace("{DEPTH}",e.depth);let i=0;const u=c=>t(c,i++);try{if(e.provider==="anthropic"){const c=e.modelId||"claude-3-5-haiku-20241022",d=await tU(o,c,l,e.nodeCount);for(const h of oU(d))u(h)}else{const c=e.provider==="ollama",d=c?"http://localhost:11434/v1":"https://api.openai.com/v1",h=e.modelId||(c?"llama3.2":"gpt-4o-mini");await nU(c?o||"ollama":o,d,h,l,e.nodeCount,u)}}catch(c){throw c instanceof Error&&c.name==="AbortError"?new Error("Timeout. Tente um mapa menor."):c instanceof Error&&c.message.includes("Failed to fetch")?new Error("Erro de conexo. Verifique sua internet e a chave de API."):c}r(i)}function pw(e,t,r,o,s,l,i,u,c,d,h){if(e.nodes.length>=bb)return null;if(d!=null&&d.has(t.label)){const H=d.get(t.label);if(t.connections&&d)for(const G of t.connections){const oe=d.get(G);if(oe&&oe.id!==H.id&&!H.connections.has(oe.id)){const le=.35+Math.random()*.3;H.connections.set(oe.id,le),oe.connections.set(H.id,le)}}return H}const f=55,g=u??s*.5,m=c??l*.5,y=Math.min(s,l),v=t.relevance??(t.isEntry?.85:.5),b=t.popularity??.5,S=u!==void 0;let C;const k=Math.PI*(3-Math.sqrt(5));if(t.category&&t.category!=="default"&&h){if(!h.has(t.category)){const pe=h.size,ce=Math.max(6,h.size+3);h.set(t.category,pe/ce*Math.PI*2)}const H=h.get(t.category),oe=e.nodes.filter(pe=>pe.category===t.category).length*k;C=H+oe*.35+(Math.random()-.5)*.12}else C=r*k+(Math.random()-.5)*.18;const R=S?.12:.18,j=S?.4:.52,T=o>1?Math.sqrt(r/(o-1)):.5,_=R+T*(j-R)+(.5-v)*.1,P=y*Math.min(j,Math.max(R,_))+(Math.random()-.5)*(y*.06),I=Math.max(f,Math.min(s-f,g+Math.cos(C)*P)),$=Math.max(f,Math.min(l-f,m+Math.sin(C)*P)),q={id:e.nextId++,x:I,y:$,vx:(Math.random()-.5)*10,vy:(Math.random()-.5)*10,heat:.55+b*.45,isEntry:t.isEntry??!1,age:0,connections:new Map,label:t.label,description:t.description,connectionsLabels:t.connections,category:t.category,relevance:v,popularity:b,userPlaced:!1};e.nodes.push(q);const L=new Map;if(t.typedEdges)for(const H of t.typedEdges)L.set(H.target.toLowerCase(),H);if(d&&(d.set(t.label,q),t.connections))for(const H of t.connections){const G=d.get(H);if(G&&G.id!==q.id&&!q.connections.has(G.id)){const oe=L.get(H.toLowerCase()),le=oe?oe.strength:.35+Math.random()*.3;q.connections.set(G.id,le),G.connections.set(q.id,le),oe&&(q.edgeTypes||(q.edgeTypes=new Map),G.edgeTypes||(G.edgeTypes=new Map),q.edgeTypes.set(G.id,oe.relation),G.edgeTypes.set(q.id,oe.relation))}}if(i!==void 0){const H=e.nodes.find(G=>G.id===i);if(H&&!q.connections.has(i)&&(t.isEntry??!1)){const oe=.35+v*.15;q.connections.set(i,oe),H.connections.set(q.id,oe)}}return q}function aU(e){const t=e.topic.toLowerCase();let r;if(t.includes("deleuze")||t.includes("guattari")||t.includes("rizoma")||t.includes("rhizome"))r=mw.slice(0,Math.min(e.nodeCount,mw.length));else{const o=Math.min(e.nodeCount,16),s=["conceptual","methodological","historical","applied","theoretical"];r=Array.from({length:o},(l,i)=>({label:i===0?e.topic:`${e.topic} ${["fundamentos","contexto","mtodo","prtica","teoria","histria","crtica","extenses","variantes","debates","aplicaes","influncias","correntes","escolas","obras"][i]||`N ${i}`}`,isEntry:i<4,category:s[i%s.length],connections:i===0?Array.from({length:Math.min(4,o-1)},(u,c)=>`${e.topic} ${["fundamentos","contexto","mtodo","prtica","teoria"][c]}`):[e.topic,i>1?`${e.topic} ${["fundamentos","contexto","mtodo","prtica","teoria","histria","crtica","extenses","variantes","debates","aplicaes","influncias","correntes","escolas","obras"][i-1]}`:e.topic]}))}return{nodes:r,title:`${e.topic} [DEMO  configure API key]`,description:"Demo sem API key. Configure VITE_RHIZOME_LLM_API_KEY para usar LLM real.",generatedAt:Date.now()}}const mw=[{label:"Rizoma",category:"philosophy",isEntry:!0,relevance:.95,popularity:.9,description:"Modelo de pensamento no-hierrquico",connections:["Plat","Linhas de Fuga","Multiplicidade","Anti-Genealogia"],typedEdges:[{target:"Plat",strength:.9,relation:"co_occurs"},{target:"Linhas de Fuga",strength:.85,relation:"contains"},{target:"Multiplicidade",strength:.88,relation:"contains"},{target:"Anti-Genealogia",strength:.75,relation:"extends"}]},{label:"Plat",category:"philosophy",relevance:.8,popularity:.75,description:"Regio de intensidade contnua",connections:["Rizoma","Territrios","Corpo sem rgos"],typedEdges:[{target:"Rizoma",strength:.9,relation:"co_occurs"},{target:"Territrios",strength:.65,relation:"contrasts"},{target:"Corpo sem rgos",strength:.8,relation:"co_occurs"}]},{label:"Linhas de Fuga",category:"philosophy",isEntry:!0,relevance:.92,popularity:.85,description:"Movimento de desterritorializao",connections:["Rizoma","Devir","Multiplicidade","Esquizo"],typedEdges:[{target:"Rizoma",strength:.85,relation:"contains"},{target:"Devir",strength:.8,relation:"influences"},{target:"Multiplicidade",strength:.7,relation:"co_occurs"},{target:"Esquizo",strength:.6,relation:"bridges"}]},{label:"Territrios",category:"philosophy",relevance:.7,popularity:.65,description:"Zonas de estabilidade e identidade",connections:["Plat","Reterritorializao","Desterritorializao"],typedEdges:[{target:"Plat",strength:.65,relation:"contrasts"},{target:"Reterritorializao",strength:.9,relation:"co_occurs"},{target:"Desterritorializao",strength:.92,relation:"contrasts"}]},{label:"Multiplicidade",category:"philosophy",isEntry:!0,relevance:.88,popularity:.8,description:"Dimenso que escapa  unidade",connections:["Rizoma","Devir","Anti-Genealogia"],typedEdges:[{target:"Rizoma",strength:.88,relation:"contains"},{target:"Devir",strength:.75,relation:"co_occurs"},{target:"Anti-Genealogia",strength:.7,relation:"extends"}]},{label:"Devir",category:"philosophy",relevance:.82,popularity:.78,description:"Processo sem origem nem fim",connections:["Linhas de Fuga","Multiplicidade","Mquina de Guerra"],typedEdges:[{target:"Linhas de Fuga",strength:.8,relation:"influences"},{target:"Multiplicidade",strength:.75,relation:"co_occurs"},{target:"Mquina de Guerra",strength:.55,relation:"bridges"}]},{label:"Corpo sem rgos",category:"philosophy",relevance:.78,popularity:.72,description:"Plano de imanncia e intensidade",connections:["Plat","Esquizo","Intensidade"],typedEdges:[{target:"Plat",strength:.8,relation:"co_occurs"},{target:"Esquizo",strength:.75,relation:"influences"},{target:"Intensidade",strength:.85,relation:"contains"}]},{label:"Esquizo",category:"philosophy",relevance:.65,popularity:.6,description:"Processo esquizofrnico como modelo crtico",connections:["Linhas de Fuga","Corpo sem rgos","Anti-dipo"],typedEdges:[{target:"Linhas de Fuga",strength:.6,relation:"bridges"},{target:"Corpo sem rgos",strength:.75,relation:"influences"},{target:"Anti-dipo",strength:.9,relation:"co_occurs"}]},{label:"Anti-dipo",category:"philosophy",isEntry:!0,relevance:.9,popularity:.88,description:"Crtica  triangulao familiar",connections:["Esquizo","Mquinas Desejantes","Capitalismo"],typedEdges:[{target:"Esquizo",strength:.9,relation:"co_occurs"},{target:"Mquinas Desejantes",strength:.85,relation:"contains"},{target:"Capitalismo",strength:.8,relation:"critiques"}]},{label:"Mquinas Desejantes",category:"philosophy",relevance:.72,popularity:.65,description:"Produo desejante como mquina",connections:["Anti-dipo","Capitalismo","Intensidade"],typedEdges:[{target:"Anti-dipo",strength:.85,relation:"contains"},{target:"Capitalismo",strength:.55,relation:"contrasts"},{target:"Intensidade",strength:.6,relation:"co_occurs"}]},{label:"Capitalismo",category:"politics",relevance:.68,popularity:.75,description:"Axiomtica do capital",connections:["Anti-dipo","Reterritorializao","Mquinas Desejantes"],typedEdges:[{target:"Anti-dipo",strength:.8,relation:"critiques"},{target:"Reterritorializao",strength:.7,relation:"influences"},{target:"Mquinas Desejantes",strength:.55,relation:"contrasts"}]},{label:"Reterritorializao",category:"philosophy",relevance:.62,popularity:.55,description:"Recaptura aps linha de fuga",connections:["Territrios","Capitalismo","Estado"],typedEdges:[{target:"Territrios",strength:.9,relation:"co_occurs"},{target:"Capitalismo",strength:.7,relation:"influences"},{target:"Estado",strength:.65,relation:"co_occurs"}]},{label:"Desterritorializao",category:"philosophy",relevance:.75,popularity:.7,description:"Abandono do territrio",connections:["Territrios","Devir","Nmade"],typedEdges:[{target:"Territrios",strength:.92,relation:"contrasts"},{target:"Devir",strength:.7,relation:"co_occurs"},{target:"Nmade",strength:.75,relation:"influences"}]},{label:"Mquina de Guerra",category:"politics",relevance:.6,popularity:.55,description:"Exterior ao Estado, nmade",connections:["Devir","Nmade","Estado"],typedEdges:[{target:"Devir",strength:.55,relation:"bridges"},{target:"Nmade",strength:.8,relation:"co_occurs"},{target:"Estado",strength:.9,relation:"contrasts"}]},{label:"Nmade",category:"philosophy",isEntry:!0,relevance:.72,popularity:.68,description:"Pensamento e movimento sem fixao",connections:["Mquina de Guerra","Desterritorializao","Espao Liso"],typedEdges:[{target:"Mquina de Guerra",strength:.8,relation:"co_occurs"},{target:"Desterritorializao",strength:.75,relation:"influences"},{target:"Espao Liso",strength:.85,relation:"co_occurs"}]},{label:"Estado",category:"politics",relevance:.58,popularity:.7,description:"Mquina de captura e estriagem",connections:["Mquina de Guerra","Reterritorializao","Espao Estriado"],typedEdges:[{target:"Mquina de Guerra",strength:.9,relation:"contrasts"},{target:"Reterritorializao",strength:.65,relation:"co_occurs"},{target:"Espao Estriado",strength:.85,relation:"co_occurs"}]},{label:"Espao Liso",category:"philosophy",relevance:.55,popularity:.5,description:"Espao nmade e intensivo",connections:["Nmade","Devir","Intensidade"],typedEdges:[{target:"Nmade",strength:.85,relation:"co_occurs"},{target:"Devir",strength:.6,relation:"co_occurs"},{target:"Intensidade",strength:.65,relation:"bridges"}]},{label:"Espao Estriado",category:"philosophy",relevance:.5,popularity:.45,description:"Espao sedentrio e mtrico",connections:["Estado","Reterritorializao"],typedEdges:[{target:"Estado",strength:.85,relation:"co_occurs"},{target:"Reterritorializao",strength:.7,relation:"co_occurs"}]},{label:"Intensidade",category:"philosophy",relevance:.65,popularity:.6,description:"Diferena em si, sem negao",connections:["Corpo sem rgos","Espao Liso","Mquinas Desejantes"],typedEdges:[{target:"Corpo sem rgos",strength:.85,relation:"contains"},{target:"Espao Liso",strength:.65,relation:"bridges"},{target:"Mquinas Desejantes",strength:.6,relation:"co_occurs"}]},{label:"Anti-Genealogia",category:"philosophy",relevance:.55,popularity:.45,description:"Rejeio da origem e da rvore",connections:["Rizoma","Multiplicidade","Plat"],typedEdges:[{target:"Rizoma",strength:.75,relation:"extends"},{target:"Multiplicidade",strength:.7,relation:"extends"},{target:"Plat",strength:.5,relation:"co_occurs"}]}];function gw(e){const t=e.nodes;if(t.length<3)return;const r=new Map;for(const g of t){r.has(g.id)||r.set(g.id,new Set);for(const[m]of g.connections)r.get(g.id).add(m)}const o=new Map;for(const g of t)o.set(g.id,0);for(const g of t){const m=[],y=new Map,v=new Map,b=new Map;for(const k of t)y.set(k.id,[]),v.set(k.id,0),b.set(k.id,-1);v.set(g.id,1),b.set(g.id,0);const S=[g.id];for(;S.length>0;){const k=S.shift();m.push(k);for(const R of r.get(k)||[])b.get(R)<0&&(S.push(R),b.set(R,b.get(k)+1)),b.get(R)===b.get(k)+1&&(v.set(R,v.get(R)+v.get(k)),y.get(R).push(k))}const C=new Map;for(const k of t)C.set(k.id,0);for(;m.length>0;){const k=m.pop();for(const R of y.get(k))C.set(R,C.get(R)+v.get(R)/v.get(k)*(1+C.get(k)));k!==g.id&&o.set(k,o.get(k)+C.get(k))}}const s=t.length;if(s>2){const g=2/((s-1)*(s-2));for(const[m,y]of o)o.set(m,y*g)}const l=new Map;for(const g of t){const m=new Map,y=[g.id];for(m.set(g.id,0);y.length>0;){const S=y.shift();for(const C of r.get(S)||[])m.has(C)||(m.set(C,m.get(S)+1),y.push(C))}let v=0,b=0;for(const[S,C]of m)S!==g.id&&C>0&&(v+=C,b++);l.set(g.id,b>0?b/v:0)}const i=new Map;for(const g of t)i.set(g.id,g.id);let u=!0,c=0;for(;u&&c<10;){u=!1,c++;for(const g of t){const m=new Map;for(const b of r.get(g.id)||[]){const S=i.get(b);m.set(S,(m.get(S)||0)+(g.connections.get(b)||1))}let y=i.get(g.id),v=m.get(y)||0;for(const[b,S]of m)S>v&&(v=S,y=b);y!==i.get(g.id)&&(i.set(g.id,y),u=!0)}}const d=Math.max(...t.map(g=>g.connections.size),1),h=new Set(t.filter(g=>g.connections.size/d>=.6).map(g=>g.id)),f=new Set;for(const g of t){if((o.get(g.id)||0)<.2)continue;const y=new Set;for(const[v]of g.connections){const b=i.get(v);b!==void 0&&y.add(b)}y.size>=2&&f.add(g.id)}for(const g of t)if(g.betweenness=o.get(g.id)??0,g.closeness=l.get(g.id)??0,g.communityId=i.get(g.id),g.isHub=h.has(g.id),g.isBridge=f.has(g.id),g.mentionCount===void 0&&(g.mentionCount=g.connections.size),g.computedRelevance===void 0&&g.relevance!==void 0){const m=Math.min(g.connections.size/10,1);g.computedRelevance=Math.min(1,(g.relevance??.5)*.35+(g.betweenness??0)*.25+(g.closeness??0)*.2+m*.2)}}function sU(e){const t=new Set(e.nodes.filter(r=>r.label&&!r.userPlaced).map(r=>r.id));if(t.size!==0){e.nodes=e.nodes.filter(r=>!t.has(r.id));for(const r of e.nodes)for(const o of t)r.connections.delete(o)}}function ZR(e){let t=Math.abs(e|0)%2147483647||1;return{next(){return t=t*16807%2147483647,(t-1)/2147483646},getState(){return t},setState(r){t=r}}}function yo(e,t,r){return e+(t-e)*r}function Nd(e,t,r){return e<t?t:e>r?r:e}function Hg(e,t){const r=e.x-t.x,o=e.y-t.y;return Math.sqrt(r*r+o*o)}function r0(e,t,r,o){const s=e-r,l=t-o;return Math.sqrt(s*s+l*l)}function bg(e){const t=e()||1e-4,r=e();return Math.sqrt(-2*Math.log(t))*Math.cos(2*Math.PI*r)}function vb(e){return e.connections.size}function Sb(e,t,r,o){const s=ZR(r),l=[];let i=0;const u=[{x:e*.25,y:t*.35},{x:e*.75,y:t*.35},{x:e*.5,y:t*.72}];for(let d=0;d<tx;d++)l.push({id:i++,x:u[d].x,y:u[d].y,vx:(s.next()-.5)*15,vy:(s.next()-.5)*15,heat:1,isEntry:!0,age:0,connections:new Map});for(let d=0;d<l.length;d++)for(let h=d+1;h<l.length;h++)if(s.next()<.55){const f=.4+s.next()*.2;l[d].connections.set(l[h].id,f),l[h].connections.set(l[d].id,f)}const c=14;for(let d=0;d<c;d++){const h=s.next()<.3;let f,g;if(h)f=_r+s.next()*(e-2*_r),g=_r+s.next()*(t-2*_r);else{const y=Math.floor(s.next()*tx),v=l[y],b=70;f=Nd(v.x+bg(s.next.bind(s))*b,_r,e-_r),g=Nd(v.y+bg(s.next.bind(s))*b,_r,t-_r)}const m={id:i++,x:f,y:g,vx:(s.next()-.5)*30,vy:(s.next()-.5)*30,heat:.4+s.next()*.4,isEntry:!1,age:0,connections:new Map};if(!h){let y=l[0],v=1/0;for(let S=0;S<tx;S++){const C=r0(m.x,m.y,l[S].x,l[S].y);C<v&&(v=C,y=l[S])}const b=.4+s.next()*.4;m.connections.set(y.id,b),y.connections.set(m.id,b)}l.push(m)}return{nodes:l,nextId:i,params:{...o},aesthetics:{..._v},growthTimer:0,entryTimer:0,forgetTimer:0,reterritTimer:0,seed:r,rngState:s.getState()}}function JR(e,t,r,o,s,l){const i={id:e.nextId++,x:Nd(t,_r,o-_r),y:Nd(r,_r,s-_r),vx:(Math.random()-.5)*25,vy:(Math.random()-.5)*25,heat:1,isEntry:!1,age:0,connections:new Map,label:l,userPlaced:!0};if(e.nodes.length>0){let u=null,c=1/0;for(const d of e.nodes){const h=r0(i.x,i.y,d.x,d.y);h<c&&(c=h,u=d)}if(u){const d=.55+Math.random()*.3;i.connections.set(u.id,d),u.connections.set(i.id,d),u.heat=Math.min(1,u.heat+.6)}if(e.nodes.length>1&&c<200){let d=null,h=1/0;for(const f of e.nodes){if(i.connections.has(f.id))continue;const g=r0(i.x,i.y,f.x,f.y);g<h&&g<300&&(h=g,d=f)}if(d){const f=.35+Math.random()*.3;i.connections.set(d.id,f),d.connections.set(i.id,f)}}}return e.nodes.push(i),i}function QR(e,t,r,o){const s=Math.min(o,.033),l=e.params,i=ZR(0);i.setState(e.rngState);const u=i.next.bind(i),c=yo(9,2,l.multiplicidade),d=yo(1.8,.35,l.multiplicidade);e.entryTimer+=s,e.growthTimer+=s,e.forgetTimer+=s,e.reterritTimer+=s;for(const f of e.nodes)f.age+=s;if(e.entryTimer>=c){e.entryTimer=0;const f=Math.floor(1+l.multiplicidade*2),g=e.nodes.filter(m=>m.isEntry);for(let m=0;m<f&&!(e.nodes.length>=bb);m++){let y=_r+u()*(t-2*_r),v=_r+u()*(r-2*_r),b=0;for(let k=0;k<14;k++){const R=_r+u()*(t-2*_r),j=_r+u()*(r-2*_r);let T=1/0;for(const _ of g){const P=r0(_.x,_.y,R,j);P<T&&(T=P)}if(T>180){y=R,v=j;break}T>b&&(b=T,y=R,v=j)}const S={id:e.nextId++,x:y,y:v,vx:(u()-.5)*20,vy:(u()-.5)*20,heat:1,isEntry:!0,age:0,connections:new Map},C=1+Math.floor(u()*3);for(let k=0;k<C&&e.nodes.length>0;k++){let R=null,j=-1;for(let T=0;T<4;T++){const _=e.nodes[Math.floor(u()*e.nodes.length)];if(S.connections.has(_.id))continue;const I=1/(r0(_.x,_.y,S.x,S.y)+1);I>j&&(j=I,R=_)}if(R){const T=.4+u()*.3;S.connections.set(R.id,T),R.connections.set(S.id,T)}}e.nodes.push(S),g.push(S)}}if(e.growthTimer>=d){e.growthTimer=0;const f=Math.floor(1+l.density*2);for(let g=0;g<f&&!(e.nodes.length>=bb||e.nodes.length===0);g++){let m;if(l.hubs>0&&e.nodes.length>0){const k=yo(.2,1.4,l.hubs);let R=e.nodes[Math.floor(u()*e.nodes.length)],j=Math.pow(vb(R)+1,k);for(let T=1;T<6;T++){const _=e.nodes[Math.floor(u()*e.nodes.length)],P=Math.pow(vb(_)+1,k);P>j&&(j=P,R=_)}m=R}else m=e.nodes[Math.floor(u()*e.nodes.length)];if(!m)break;const y=yo(110,30,l.territorializacao),v=Nd(m.x+bg(u)*y,_r,t-_r),b=Nd(m.y+bg(u)*y,_r,r-_r),S={id:e.nextId++,x:v,y:b,vx:(u()-.5)*40,vy:(u()-.5)*40,heat:.6+u()*.3,isEntry:!1,age:0,connections:new Map},C=.4+u()*.4;if(S.connections.set(m.id,C),m.connections.set(S.id,C),u()<l.reterritorializacao*.55&&e.nodes.length>1){let k=null,R=1/0;const j=Math.min(14,e.nodes.length);for(let T=0;T<j;T++){const _=e.nodes[Math.floor(u()*e.nodes.length)];if(_.id===m.id||_.id===S.id)continue;const P=r0(_.x,_.y,S.x,S.y);P<R&&(R=P,k=_)}if(k){const T=.3+u()*.3;S.connections.set(k.id,T),k.connections.set(S.id,T)}}e.nodes.push(S)}l.reterritorializacao>0&&yw(e,u)}e.reterritTimer>=.5&&(e.reterritTimer=0,l.reterritorializacao>0&&yw(e,u)),iU(e,t,r,s,u),u()<l.linhasDeFuga*.1&&lU(e,u),e.forgetTimer>=1&&(e.forgetTimer=0,cU(e));const h=yo(80,220,l.linhasDeFuga);for(const f of e.nodes){if(f.pinned){f.vx=0,f.vy=0;continue}f.x+=f.vx*s,f.y+=f.vy*s,f.x<_r&&(f.vx*=-.55,f.x=_r),f.x>t-_r&&(f.vx*=-.55,f.x=t-_r),f.y<_r&&(f.vy*=-.55,f.y=_r),f.y>r-_r&&(f.vy*=-.55,f.y=r-_r);const g=Math.sqrt(f.vx*f.vx+f.vy*f.vy);g>h&&(f.vx=f.vx/g*h,f.vy=f.vy/g*h),f.heat=Nd(f.heat*(1-s*.22),0,1)}e.rngState=i.getState()}function iU(e,t,r,o,s){var m;const l=e.params,i=e.nodes,u=i.filter(y=>y.isEntry),c=new Map;for(const y of i)c.set(y.id,y);for(const y of i){if(y.pinned)continue;const v=yo(.96,.88,l.linhasDeFuga*.4+l.noise*.3);y.vx*=v,y.vy*=v;const b=vb(y),S=b===0?3.5:b===1?1.8:1,C=l.noise*18*S;y.vx+=(s()*2-1)*C,y.vy+=(s()*2-1)*C,y.isEntry&&(y.vx+=(s()*2-1)*l.noise*10,y.vy+=(s()*2-1)*l.noise*10);for(const[k,R]of y.connections){const j=c.get(k);if(!j)continue;const T=j.x-y.x,_=j.y-y.y,P=Math.sqrt(T*T+_*_)||.001,I=y.category&&j.category&&y.category.toLowerCase()===j.category.toLowerCase(),L=((m=y.edgeTypes)==null?void 0:m.get(k))==="bridges"||P>Np,H=L?yo(280,500,l.linhasDeFuga):I?yo(60,140,1-l.territorializacao):yo(180,380,1-l.territorializacao),G=L?yo(4,14,l.linhasDeFuga)*R:I?yo(14,35,l.reterritorializacao)*R:yo(4,12,l.reterritorializacao)*R*.5,oe=P-H,le=T/P*G*oe*o*.5,pe=_/P*G*oe*o*.5;y.vx+=le,y.vy+=pe}if(l.territorializacao>0&&!y.isEntry&&u.length>0){let k=u[0],R=1/0;for(const j of u){const T=r0(j.x,j.y,y.x,y.y);T<R&&(R=T,k=j)}if(R>80&&R<600){const j=l.territorializacao*10,T=k.x-y.x,_=k.y-y.y,P=1/R;y.vx+=T*P*j*o,y.vy+=_*P*j*o}}}for(let y=0;y<u.length;y++)for(let v=y+1;v<u.length;v++){const b=u[y],S=u[v];if(b.pinned&&S.pinned)continue;const C=S.x-b.x,k=S.y-b.y,R=Math.sqrt(C*C+k*k);if(R<300&&R>.01){const j=(1-R/300)*140*l.territorializacao,T=1/R;b.pinned||(b.vx-=C*T*j*o,b.vy-=k*T*j*o),S.pinned||(S.vx+=C*T*j*o,S.vy+=k*T*j*o)}}const d=i.length,h=Math.min(500,d*(d-1)/2);for(let y=0;y<h;y++){const v=Math.floor(s()*d),b=Math.floor(s()*d);if(v===b)continue;const S=i[v],C=i[b];if(S.pinned&&C.pinned)continue;const k=C.x-S.x,R=C.y-S.y,j=Math.sqrt(k*k+R*R),T=S.category&&C.category&&S.category.toLowerCase()===C.category.toLowerCase(),_=T?55:120,P=T?60:160;if(j<_&&j>.01){const I=(1-j/_)*P,$=1/j;S.pinned||(S.vx-=k*$*I*o,S.vy-=R*$*I*o),C.pinned||(C.vx+=k*$*I*o,C.vy+=R*$*I*o)}}const f=yo(50,120,l.linhasDeFuga),g=l.linhasDeFuga*.05;if(!e.searchMode)for(let y=0;y<Math.min(10,n);y++){const v=Math.floor(s()*n),b=i[v];if(b.connections.size>0)continue;const S=Math.floor(s()*n),C=i[S];if(S===v||C===b)continue;const R=b.category&&C.category&&b.category.toLowerCase()===C.category.toLowerCase()?g*4:g*.2;if(r0(b.x,b.y,C.x,C.y)<f&&s()<R){const T=.3+s()*.4;b.connections.set(C.id,T),C.connections.set(b.id,T),b.heat=Math.min(1,b.heat+.5),C.heat=Math.min(1,C.heat+.3)}}}function lU(e,t){const r=e.nodes;if(!(r.length<2))for(let o=0;o<12;o++){const s=r[Math.floor(t()*r.length)],l=r[Math.floor(t()*r.length)];if(s.id===l.id||s.pinned&&l.pinned||e.searchMode&&(s.category&&l.category&&s.category.toLowerCase()===l.category.toLowerCase()||!s.category||!l.category))continue;const i=Hg(s,l);if(i>Np&&!s.connections.has(l.id)){const u=.2+t()*.3;s.connections.set(l.id,u),l.connections.set(s.id,u),s.heat=Math.min(1,s.heat+.45),l.heat=Math.min(1,l.heat+.45),s.edgeTypes||(s.edgeTypes=new Map),l.edgeTypes||(l.edgeTypes=new Map),s.edgeTypes.set(l.id,"bridges"),l.edgeTypes.set(s.id,"bridges");const c=15+t()*20,d=l.x-s.x,h=l.y-s.y,f=1/(i||1);s.pinned||(s.vx-=d*f*c*.4,s.vy-=h*f*c*.4),l.pinned||(l.vx+=d*f*c*.4,l.vy+=h*f*c*.4);return}}}function yw(e,t){const r=e.params,o=e.nodes,s=Math.min(35,o.length);for(let l=0;l<s;l++){const i=o[Math.floor(t()*o.length)],u=[],c=Math.min(14,o.length);for(let d=0;d<c;d++){const h=o[Math.floor(t()*o.length)];if(h.id===i.id)continue;const f=Hg(i,h);u.length<2?(u.push({node:h,dist:f}),u.sort((g,m)=>g.dist-m.dist)):f<u[1].dist&&(u[1]={node:h,dist:f},u.sort((g,m)=>g.dist-m.dist))}for(const{node:d}of u)if(t()<r.reterritorializacao*.55){if(i.connections.has(d.id)){const h=Math.min(1,i.connections.get(d.id)+.05);i.connections.set(d.id,h),d.connections.set(i.id,h)}else if(!e.searchMode&&i.category&&d.category&&i.category.toLowerCase()===d.category.toLowerCase()&&t()<.3){const f=.2+t()*.25;i.connections.set(d.id,f),d.connections.set(i.id,f)}}}}function cU(e){var s;const t=e.params;if(t.esquecimento<=0)return;const r=new Map;for(const l of e.nodes)r.set(l.id,l);for(const l of e.nodes){const i=[];for(const[u,c]of l.connections){const d=c*(1-t.esquecimento*.09);d<.07?i.push(u):l.connections.set(u,d)}for(const u of i)l.connections.delete(u),(s=r.get(u))==null||s.connections.delete(l.id)}let o=0;e.nodes=e.nodes.filter(l=>o>=4?!0:!l.isEntry&&!l.userPlaced&&l.connections.size===0?(o++,!1):!0)}function wb(e){const t=e.nodes,r=t.length;if(r===0)return{nodeCount:0,entryCount:0,longLinkCount:0,avgDegree:0,hubness:0,isolatedCount:0};let o=0,s=0,l=0,i=0;const u=new Set,c=t.filter(d=>d.isEntry).length;for(const d of t){const h=d.connections.size;o+=h,h>s&&(s=h),h===0&&!d.isEntry&&i++;for(const[f]of d.connections){const g=d.id<f?`${d.id}-${f}`:`${f}-${d.id}`;if(!u.has(g)){u.add(g);const m=t.find(y=>y.id===f);m&&Hg(d,m)>Np&&l++}}}return{nodeCount:r,entryCount:c,longLinkCount:l,avgDegree:o/r,hubness:s/Math.max(1,r),isolatedCount:i}}function e7(e,t,r,o,s){var T,_;const l=t.params,i=t.aesthetics,u=t.nodes;if(e.fillStyle=i.bgColor,e.fillRect(0,0,r,o),u.length===0)return;const c=new Map;for(const P of u)c.set(P.id,P);const d=[],h=new Set;for(const P of u)for(const[I,$]of P.connections){const q=P.id<I?`${P.id}-${I}`:`${I}-${P.id}`;if(h.has(q))continue;h.add(q);const L=c.get(I);if(!L)continue;const H=Hg(P,L),G=((T=P.edgeTypes)==null?void 0:T.get(I))??((_=L.edgeTypes)==null?void 0:_.get(P.id)),oe=G==="bridges"||H>Np;d.push({a:P,b:L,w:$,d:H,isLong:oe,relation:G})}d.sort((P,I)=>I.w-P.w);const f=d.filter(P=>P.relation==="bridges"||P.isLong),g=d.filter(P=>P.relation!=="bridges"&&!P.isLong),m=.25,y=g.filter(P=>P.w>=m).slice(0,100),v=[...f,...y],b={influences:"#a78bfa",contrasts:"#ef4444",bridges:"#f472b6",extends:"#60a5fa",contains:"#4ade80",co_occurs:i.linkColor,method_for:"#fbbf24",example_of:"#fb923c",critiques:"#f87171",related:i.linkColor},S=yo(.5,3,i.linkWidth),C=i.linkOpacity;e.lineCap="round";for(const P of v){const I=P.relation?b[P.relation]??i.linkColor:i.linkColor;if(P.isLong||P.relation==="bridges"){const $=Math.min(.95,.3+P.w*.6);e.strokeStyle=P.relation==="bridges"?b.bridges:i.flightColor,e.lineWidth=S*(1.2+P.w*.8),e.globalAlpha=$*C*(.6+i.glowIntensity*.4),e.shadowColor=e.strokeStyle,e.shadowBlur=6*i.glowIntensity,e.beginPath(),e.moveTo(P.a.x,P.a.y),e.lineTo(P.b.x,P.b.y),e.stroke(),e.shadowBlur=0}else P.relation==="contrasts"||P.relation==="critiques"?(e.strokeStyle=I,e.lineWidth=S*.8,e.globalAlpha=C*P.w*.8,e.setLineDash([4,3]),e.beginPath(),e.moveTo(P.a.x,P.a.y),e.lineTo(P.b.x,P.b.y),e.stroke(),e.setLineDash([])):P.relation==="influences"||P.relation==="extends"?(e.strokeStyle=I,e.lineWidth=S*(.8+P.w*.5),e.globalAlpha=C*P.w,e.beginPath(),e.moveTo(P.a.x,P.a.y),e.lineTo(P.b.x,P.b.y),e.stroke()):(e.strokeStyle=I,e.lineWidth=S,e.globalAlpha=C*P.w,e.beginPath(),e.moveTo(P.a.x,P.a.y),e.lineTo(P.b.x,P.b.y),e.stroke())}e.globalAlpha=1;const k=yo(.4,2,i.nodeSize),R=yo(.1,2.5,i.connSizeScale??.5),j=.4+l.organismToIntensity*.6;for(const P of u){const I=Math.min(P.connections.size,20),q=1+(P.relevance??.5)*yo(0,1.6,i.relSizeScale??.5),L=(xg+I*.38*l.hubs*2*R)*k*q;let H;if(P.category?H=KR(P.category):P.isEntry?H=i.entryColor:I>=6&&l.hubs>.1?H=i.hubColor:P.heat>.6?H=i.hotColor:H=i.nodeColor,i.glowIntensity>.05&&(e.globalAlpha=.1*j*i.glowIntensity,e.fillStyle=H,e.shadowColor=H,e.shadowBlur=14,e.beginPath(),e.arc(P.x,P.y,L*4,0,Math.PI*2),e.fill(),e.shadowBlur=0,e.globalAlpha=.22*j*i.glowIntensity,e.beginPath(),e.arc(P.x,P.y,L*2,0,Math.PI*2),e.fill()),e.globalAlpha=(.65+P.heat*.35)*j,e.fillStyle=H,e.beginPath(),e.arc(P.x,P.y,L,0,Math.PI*2),e.fill(),P.isBridge){const G=Math.sin(P.age*3)*.15+.35;e.globalAlpha=G*j,e.strokeStyle="#f472b6",e.lineWidth=1.5,e.beginPath(),e.arc(P.x,P.y,L+6,0,Math.PI*2),e.stroke(),e.globalAlpha=G*.5*j,e.beginPath(),e.arc(P.x,P.y,L+10,0,Math.PI*2),e.stroke()}if(P.isHub&&!P.isBridge&&(e.globalAlpha=.25*j,e.strokeStyle=i.hubColor,e.lineWidth=2,e.beginPath(),e.arc(P.x,P.y,L+5,0,Math.PI*2),e.stroke()),P.isEntry&&(e.globalAlpha=.18*j,e.strokeStyle=i.entryColor,e.lineWidth=1,e.beginPath(),e.arc(P.x,P.y,L+4.5,0,Math.PI*2),e.stroke()),P.userPlaced&&P.age<3){const G=Math.sin(P.age*6)*.4+.6;e.globalAlpha=.5*G*j,e.strokeStyle="#ffffff",e.lineWidth=1,e.beginPath(),e.arc(P.x,P.y,L+7,0,Math.PI*2),e.stroke()}}if(i.showLabels){const P=t.nodes.filter(I=>I.label);if(P.length>0){const I=yo(6,10,i.labelSize),$=P.map(L=>{const H=L.connections.size,G=Math.min(1,H/10*.45+L.heat*.4+(L.isEntry?.25:0)+(L.isAnchor?.4:0)),oe=Math.round(I+G*2.5),le=oe*L.label.length*.52,pe=3,ce=xg*yo(.6,2.2,i.nodeSize)*(.6+L.heat*.7),te=L.x-le/2-pe,F=L.y+ce+2;return{n:L,importance:G,fs:oe,lx:te,ly:F,lw:le+pe*2,lh:oe+2,degraded:!1}});$.sort((L,H)=>H.importance-L.importance);const q=[];for(const L of $){const H=q.some(G=>G.importance>L.importance*.6&&L.lx<G.x+G.w+2&&L.lx+L.lw>G.x-2&&L.ly<G.y+G.h+2&&L.ly+L.lh>G.y-2);L.degraded=H,q.push({x:L.lx,y:L.ly,w:L.lw,h:L.lh,importance:L.importance})}e.textAlign="center",e.textBaseline="top";for(const L of $){const H=L.degraded?Math.max(5,L.fs-2):L.fs;if(e.font=`${H}px system-ui, sans-serif`,L.degraded){const G=.2+L.importance*.25;e.globalAlpha=G,e.fillStyle=i.labelColor,e.fillText(L.n.label,L.n.x,L.ly+1)}else{const G=e.measureText(L.n.label).width,oe=3,le=L.n.x-G/2-oe,pe=L.ly,ce=G+oe*2,te=H+2,F=3;e.globalAlpha=.52+L.importance*.28,e.fillStyle="rgba(0,0,0,0.78)",e.beginPath(),e.moveTo(le+F,pe),e.lineTo(le+ce-F,pe),e.quadraticCurveTo(le+ce,pe,le+ce,pe+F),e.lineTo(le+ce,pe+te-F),e.quadraticCurveTo(le+ce,pe+te,le+ce-F,pe+te),e.lineTo(le+F,pe+te),e.quadraticCurveTo(le,pe+te,le,pe+te-F),e.lineTo(le,pe+F),e.quadraticCurveTo(le,pe,le+F,pe),e.closePath(),e.fill(),e.globalAlpha=.7+L.importance*.28,e.fillStyle=i.labelColor,e.fillText(L.n.label,L.n.x,L.ly+1)}}e.textBaseline="alphabetic"}}e.globalAlpha=1,e.textAlign="left"}function t7(e,t,r,o,s,l){var L,H;const i=t.aesthetics,u=t.params,c=t.nodes;if(e.fillStyle=i.bgColor,e.fillRect(0,0,r,o),c.length===0)return;const d=r/2+s.panX,h=o/2+s.panY,g=Math.min(r,o)*s.fov+300,m=new Map;for(const G of c)m.set(G.id,G);const y=Math.cos(s.rotY),v=Math.sin(s.rotY),b=Math.cos(s.rotX),S=Math.sin(s.rotX),C=Math.cos(s.rotZ),k=Math.sin(s.rotZ);function R(G){const oe=G.connections.size,pe=(Math.min(1,oe/8*.5+G.heat*.45+(G.isEntry?.2:0)+(G.isAnchor?.4:0)+((G.relevance??.5)-.5)*.3)-.5)*s.zSpread+Math.sin(G.id*2.39996)*s.zSpread*.33;let ce=G.x-r/2,te=G.y-o/2,F=pe;const Q=ce*y+F*v,ae=-ce*v+F*y,we=te*b-ae*S,Re=te*S+ae*b,ge=Q*C-we*k,Ae=Q*k+we*C,tt=g/(Re+g)*s.zoom,We=d+ge*tt,J=h+Ae*tt,ke=Math.max(0,Math.min(1,(Re+s.zSpread)/(s.zSpread*2))),Le=s.fog>0?1-s.fog+s.fog*Math.max(.08,ke):1,K=Math.max(.15,tt/g*2.2);return{n:G,px:We,py:J,pz:Re,scale:K,alpha:Le}}const j=c.map(R);j.sort((G,oe)=>G.pz-oe.pz);const T=new Map;for(const G of j)T.set(G.n.id,G);const _=new Set,P=yo(.4,2.5,i.linkWidth),I={influences:"#a78bfa",contrasts:"#ef4444",bridges:"#f472b6",extends:"#60a5fa",contains:"#4ade80",co_occurs:i.linkColor,method_for:"#fbbf24",example_of:"#fb923c",critiques:"#f87171",related:i.linkColor};for(const G of j)for(const[oe,le]of G.n.connections){const pe=G.n.id<oe?`${G.n.id}-${oe}`:`${oe}-${G.n.id}`;if(_.has(pe))continue;_.add(pe);const ce=T.get(oe);if(!ce)continue;const te=(G.alpha+ce.alpha)/2,F=((L=G.n.edgeTypes)==null?void 0:L.get(oe))??((H=ce.n.edgeTypes)==null?void 0:H.get(G.n.id)),Q=F==="bridges"||Math.hypot(G.n.x-ce.n.x,G.n.y-ce.n.y)>Np,ae=F?I[F]??i.linkColor:i.linkColor;e.globalAlpha=i.linkOpacity*te*le*.85,e.strokeStyle=Q?i.flightColor:ae,e.lineWidth=P*(.7+te*.5),(F==="contrasts"||F==="critiques")&&(e.setLineDash([3,2]),e.strokeStyle=ae),e.beginPath(),e.moveTo(G.px,G.py),e.lineTo(ce.px,ce.py),e.stroke(),e.setLineDash([])}const $=yo(.4,2,i.nodeSize),q=yo(.1,2.5,i.connSizeScale??.5);for(const G of j){const{n:oe}=G,le=Math.min(oe.connections.size,20),ce=1+(oe.relevance??.5)*yo(0,1.6,i.relSizeScale??.5),te=(xg+le*.38*u.hubs*2*q)*$*G.scale*ce;let F;oe.category?F=KR(oe.category):oe.isAnchor||oe.isEntry?F=i.entryColor:le>=6?F=i.hubColor:oe.heat>.6?F=i.hotColor:F=i.nodeColor,i.glowIntensity>.05&&(e.globalAlpha=.09*G.alpha*i.glowIntensity,e.fillStyle=F,e.shadowColor=F,e.shadowBlur=14,e.beginPath(),e.arc(G.px,G.py,te*3.5,0,Math.PI*2),e.fill(),e.shadowBlur=0),e.globalAlpha=(.5+oe.heat*.4)*G.alpha,e.fillStyle=F,e.beginPath(),e.arc(G.px,G.py,Math.max(1.2,te),0,Math.PI*2),e.fill(),(oe.isEntry||oe.isAnchor)&&(e.globalAlpha=.18*G.alpha,e.strokeStyle=i.entryColor,e.lineWidth=.8,e.beginPath(),e.arc(G.px,G.py,Math.max(2,te+4.5),0,Math.PI*2),e.stroke())}if(i.showLabels){e.textAlign="center",e.textBaseline="top";const G=j.filter(le=>le.n.label).map(le=>{const pe=le.n.connections.size,ce=Math.min(1,pe/8*.45+le.n.heat*.35+(le.n.isEntry?.3:0)+(le.n.isAnchor?.5:0)+((le.n.relevance??.5)-.5)*.4);return{p3:le,importance:ce}}).filter(({importance:le})=>le>.28).sort((le,pe)=>pe.importance-le.importance),oe=yo(6,10,i.labelSize);for(const{p3:le,importance:pe}of G){const ce=Math.round(oe+pe*2.5+le.scale*1.5);e.font=`${ce}px system-ui, sans-serif`;const te=le.n.connections.size,F=(xg+te*.38)*$*le.scale,Q=le.py+Math.max(2,F)+2,ae=e.measureText(le.n.label).width,we=3;e.globalAlpha=Math.min(.9,le.alpha*(.5+pe*.4)),e.fillStyle="rgba(0,0,0,0.78)",e.fillRect(le.px-ae/2-we,Q,ae+we*2,ce+2),e.globalAlpha=Math.min(1,le.alpha*(.65+pe*.3)),e.fillStyle=i.labelColor,e.fillText(le.n.label,le.px,Q+1)}e.textBaseline="alphabetic"}e.globalAlpha=1,e.textAlign="left"}function dU(e){try{const r={nodes:e.nodes.map(o=>({...o,connections:Array.from(o.connections.entries())})),nextId:e.nextId,params:e.params,aesthetics:e.aesthetics,seed:e.seed,rngState:e.rngState};return JSON.stringify(r)}catch(t){return console.error("Failed to create snapshot:",t),""}}function uU(e,t,r){try{const o=JSON.parse(e);return{nodes:o.nodes.map(i=>({...i,connections:new Map(i.connections)})),nextId:o.nextId,params:o.params,aesthetics:o.aesthetics||_v,growthTimer:0,entryTimer:0,forgetTimer:0,reterritTimer:0,seed:o.seed,rngState:o.rngState}}catch(o){return console.error("Failed to restore from snapshot:",o),null}}const xw=Object.freeze(Object.defineProperty({__proto__:null,addNodeAtPosition:JR,computeRhizomeMetrics:wb,createRhizomeState:Sb,createSnapshot:dU,renderRhizome:e7,renderRhizome3D:t7,restoreFromSnapshot:uU,tickRhizome:QR},Symbol.toStringTag,{value:"Module"})),bw="'Doto', monospace",ko="'IBM Plex Mono', monospace";function hU({folders:e,onCreateFolder:t,onDeleteFolder:r,onSelectCard:o,onRemoveCard:s,onMoveCard:l,onClose:i}){const[u,c]=w.useState(new Set),[d,h]=w.useState(!1),[f,g]=w.useState(""),[m,y]=w.useState(""),[v,b]=w.useState(340),[S,C]=w.useState(!1),[k,R]=w.useState(null),[j,T]=w.useState(null),_=w.useRef(null),P=$=>{const q=new Set(u);q.has($)?q.delete($):q.add($),c(q)},I=()=>{f.trim()&&(t(f.trim(),m.trim()||void 0),g(""),y(""),h(!1))};return w.useEffect(()=>{if(!S)return;const $=L=>{const H=Math.max(280,Math.min(600,L.clientX));b(H)},q=()=>{C(!1)};return document.addEventListener("mousemove",$),document.addEventListener("mouseup",q),()=>{document.removeEventListener("mousemove",$),document.removeEventListener("mouseup",q)}},[S]),a.jsxs(a.Fragment,{children:[a.jsxs("div",{ref:_,style:{position:"absolute",top:0,left:0,width:v,height:"100%",background:"rgba(0,0,0,0.97)",backdropFilter:"blur(8px)",borderRight:"1px dashed rgba(255,255,255,0.06)",display:"flex",flexDirection:"column",overflow:"hidden",zIndex:50,boxShadow:"6px 0 32px rgba(0,0,0,0.4)"},children:[a.jsxs("div",{style:{padding:"16px 18px",borderBottom:"1px dashed rgba(255,255,255,0.06)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx(ph,{size:14,strokeWidth:1.5,style:{color:"rgba(255,255,255,0.45)"}}),a.jsx("span",{style:{fontFamily:bw,fontSize:11,color:"rgba(255,255,255,0.85)",letterSpacing:"0.08em",textTransform:"uppercase"},children:"COLEES"})]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[a.jsx("button",{onClick:()=>h($=>!$),style:{background:"rgba(255,255,255,0.05)",border:"1px dashed rgba(255,255,255,0.06)",borderRadius:1,padding:"4px 6px",cursor:"pointer",color:"rgba(255,255,255,0.65)",fontFamily:ko,letterSpacing:"0.06em",textTransform:"uppercase",display:"flex",alignItems:"center",transition:"all 0.15s"},onMouseEnter:$=>{$.currentTarget.style.background="rgba(255,255,255,0.08)",$.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},onMouseLeave:$=>{$.currentTarget.style.background="rgba(255,255,255,0.05)",$.currentTarget.style.borderColor="rgba(255,255,255,0.06)"},title:"Nova pasta",children:a.jsx(jg,{size:11,strokeWidth:1.5})}),a.jsx("button",{onClick:$=>{$.preventDefault(),$.stopPropagation(),i()},style:{background:"rgba(255,255,255,0.05)",border:"1px dashed rgba(255,255,255,0.06)",borderRadius:1,padding:"4px 6px",cursor:"pointer",color:"rgba(255,255,255,0.45)",fontFamily:ko,display:"flex",alignItems:"center",transition:"all 0.15s"},onMouseEnter:$=>{$.currentTarget.style.background="rgba(255,255,255,0.08)",$.currentTarget.style.borderColor="rgba(255,255,255,0.1)",$.currentTarget.style.color="rgba(255,255,255,0.65)"},onMouseLeave:$=>{$.currentTarget.style.background="rgba(255,255,255,0.05)",$.currentTarget.style.borderColor="rgba(255,255,255,0.06)",$.currentTarget.style.color="rgba(255,255,255,0.45)"},title:"Fechar",children:a.jsx(ya,{size:12,strokeWidth:2})})]})]}),a.jsx(Xc,{children:d&&a.jsx(to.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{borderBottom:"1px dashed rgba(255,255,255,0.06)",overflow:"hidden"},children:a.jsxs("div",{style:{padding:"12px 14px",display:"flex",flexDirection:"column",gap:8},children:[a.jsx("input",{type:"text",placeholder:"Nome da coleo",value:f,onChange:$=>g($.target.value),onKeyDown:$=>{$.key==="Enter"&&I()},style:{width:"100%",padding:"6px 8px",borderRadius:1,fontSize:10,fontFamily:ko,background:"rgba(255,255,255,0.05)",border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.85)",outline:"none"},autoFocus:!0}),a.jsx("input",{type:"text",placeholder:"Descrio (opcional)",value:m,onChange:$=>y($.target.value),onKeyDown:$=>{$.key==="Enter"&&I()},style:{width:"100%",padding:"6px 8px",borderRadius:1,fontSize:9,fontFamily:ko,background:"rgba(255,255,255,0.03)",border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.65)",outline:"none"}}),a.jsx("button",{onClick:I,style:{width:"100%",padding:"5px 0",borderRadius:1,fontSize:8,fontFamily:ko,background:"rgba(255,255,255,0.05)",border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.65)",cursor:"pointer",letterSpacing:"0.06em",textTransform:"uppercase",transition:"all 0.15s"},onMouseEnter:$=>{$.currentTarget.style.background="rgba(255,255,255,0.08)",$.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},onMouseLeave:$=>{$.currentTarget.style.background="rgba(255,255,255,0.05)",$.currentTarget.style.borderColor="rgba(255,255,255,0.06)"},children:"Criar"})]})})}),a.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"8px 0"},children:[e.length===0&&!d&&a.jsxs("div",{style:{padding:"24px 20px",textAlign:"center",fontSize:8,fontFamily:ko,color:"rgba(255,255,255,0.45)",lineHeight:1.5},children:["Nenhuma coleo ainda.",a.jsx("br",{}),"Clique ",a.jsx("span",{style:{color:"rgba(255,255,255,0.65)"},children:"+"})," para criar."]}),e.map($=>{const q=u.has($.id);return a.jsxs("div",{style:{marginBottom:2},children:[a.jsxs("div",{style:{padding:"8px 14px",display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",transition:"all 0.15s"},onClick:()=>P($.id),onMouseEnter:L=>L.currentTarget.style.background="rgba(255,255,255,0.05)",onMouseLeave:L=>L.currentTarget.style.background="transparent",children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:7,flex:1},children:[q?a.jsx(Pa,{size:10,strokeWidth:1.5,style:{color:"rgba(255,255,255,0.45)"}}):a.jsx(aa,{size:10,strokeWidth:1.5,style:{color:"rgba(255,255,255,0.45)"}}),a.jsx(ph,{size:12,strokeWidth:1.5,style:{color:$.color||"rgba(255,255,255,0.45)"}}),a.jsxs("div",{style:{flex:1},children:[a.jsx("div",{style:{fontFamily:ko,fontSize:10,color:"rgba(255,255,255,0.65)"},children:$.name}),$.description&&a.jsx("div",{style:{fontFamily:ko,fontSize:8,color:"rgba(255,255,255,0.45)",marginTop:1},children:$.description})]}),a.jsx("span",{style:{fontSize:8,color:"rgba(255,255,255,0.22)",fontFamily:ko},children:$.cards.length})]}),a.jsx("button",{onClick:L=>{L.stopPropagation(),r($.id)},style:{background:"none",border:"none",cursor:"pointer",color:"rgba(255,255,255,0.2)",padding:3,display:"flex",alignItems:"center"},onMouseEnter:L=>L.currentTarget.style.color="rgba(239,68,68,0.7)",onMouseLeave:L=>L.currentTarget.style.color="rgba(255,255,255,0.2)",title:"Deletar pasta",children:a.jsx(o0,{size:10,strokeWidth:1.5})})]}),a.jsx(Xc,{children:q&&a.jsx(to.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden",paddingLeft:32},children:$.cards.length===0?a.jsx("div",{style:{padding:"8px 12px",fontSize:8,fontFamily:ko,color:"rgba(255,255,255,0.22)",fontStyle:"italic"},children:"Vazio"}):$.cards.map(L=>{const H=k===L.id;return a.jsxs("div",{style:{marginBottom:4},children:[a.jsxs("div",{style:{padding:"6px 10px",margin:"2px 8px 2px 0",borderRadius:1,cursor:"pointer",background:H?"rgba(255,255,255,0.08)":"rgba(255,255,255,0.05)",border:`1px dashed ${H?"rgba(255,255,255,0.1)":"rgba(255,255,255,0.06)"}`,display:"flex",alignItems:"center",justifyContent:"space-between",transition:"all 0.15s"},onClick:()=>R(H?null:L.id),onMouseEnter:G=>{H||(G.currentTarget.style.background="rgba(255,255,255,0.08)",G.currentTarget.style.borderColor="rgba(255,255,255,0.1)")},onMouseLeave:G=>{H||(G.currentTarget.style.background="rgba(255,255,255,0.05)",G.currentTarget.style.borderColor="rgba(255,255,255,0.06)")},children:[a.jsx("div",{style:{flex:1,minWidth:0},children:a.jsx("div",{style:{fontFamily:ko,fontSize:9,color:"rgba(255,255,255,0.65)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:L.label})}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[a.jsx("button",{onClick:G=>{G.stopPropagation(),T({folderId:$.id,card:L})},style:{background:"none",border:"none",cursor:"pointer",color:"rgba(255,255,255,0.15)",padding:2,display:"flex",alignItems:"center"},onMouseEnter:G=>G.currentTarget.style.color="rgba(124,58,237,0.6)",onMouseLeave:G=>G.currentTarget.style.color="rgba(255,255,255,0.15)",title:"Mover para outra pasta",children:a.jsx(mE,{size:9,strokeWidth:1.5})}),a.jsx("button",{onClick:G=>{G.stopPropagation(),o(L)},style:{background:"none",border:"none",cursor:"pointer",color:"rgba(255,255,255,0.15)",padding:2,display:"flex",alignItems:"center"},onMouseEnter:G=>G.currentTarget.style.color="rgba(34,197,94,0.7)",onMouseLeave:G=>G.currentTarget.style.color="rgba(255,255,255,0.15)",title:"Abrir snapshot",children:a.jsx($b,{size:9,strokeWidth:1.5})}),a.jsx("button",{onClick:G=>{G.stopPropagation(),s($.id,L.id)},style:{background:"none",border:"none",cursor:"pointer",color:"rgba(255,255,255,0.15)",padding:2,display:"flex",alignItems:"center"},onMouseEnter:G=>G.currentTarget.style.color="rgba(239,68,68,0.6)",onMouseLeave:G=>G.currentTarget.style.color="rgba(255,255,255,0.15)",title:"Remover",children:a.jsx(o0,{size:8,strokeWidth:1.5})})]})]}),a.jsx(Xc,{children:H&&a.jsxs(to.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden",margin:"0 8px 0 0",padding:"8px 10px",background:"rgba(0,0,0,0.5)",borderRadius:1,border:"1px dashed rgba(255,255,255,0.06)"},children:[L.description&&a.jsxs("div",{style:{marginBottom:8},children:[a.jsx("div",{style:{fontFamily:ko,fontSize:7,color:"rgba(255,255,255,0.22)",marginBottom:3,textTransform:"uppercase",letterSpacing:"0.08em"},children:"Descrio"}),a.jsx("div",{style:{fontFamily:ko,fontSize:8,color:"rgba(255,255,255,0.65)",lineHeight:1.4},children:L.description})]}),L.tags&&L.tags.length>0&&a.jsxs("div",{style:{marginBottom:8},children:[a.jsxs("div",{style:{fontFamily:ko,fontSize:7,color:"rgba(255,255,255,0.22)",marginBottom:4,textTransform:"uppercase",letterSpacing:"0.08em",display:"flex",alignItems:"center",gap:4},children:[a.jsx(KE,{size:7}),"Tags"]}),a.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:4},children:L.tags.map((G,oe)=>a.jsx("span",{style:{fontFamily:ko,fontSize:7,padding:"2px 6px",borderRadius:1,background:"rgba(255,255,255,0.05)",border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.65)"},children:G},oe))})]}),L.links&&L.links.length>0&&a.jsxs("div",{style:{marginBottom:8},children:[a.jsx("div",{style:{fontFamily:ko,fontSize:7,color:"rgba(255,255,255,0.22)",marginBottom:4,textTransform:"uppercase",letterSpacing:"0.08em"},children:"Links"}),L.links.map((G,oe)=>a.jsxs("a",{href:G,target:"_blank",rel:"noopener noreferrer",style:{display:"block",fontFamily:ko,fontSize:8,color:"rgba(255,255,255,0.65)",textDecoration:"none",marginBottom:2,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},onMouseEnter:le=>le.currentTarget.style.color="rgba(255,255,255,0.85)",onMouseLeave:le=>le.currentTarget.style.color="rgba(255,255,255,0.65)",children:[" ",G]},oe))]}),L.connections&&L.connections.length>0&&a.jsxs("div",{children:[a.jsxs("div",{style:{fontFamily:ko,fontSize:7,color:"rgba(255,255,255,0.22)",marginBottom:4,textTransform:"uppercase",letterSpacing:"0.08em"},children:["Conexes (",L.connections.length,")"]}),a.jsx("div",{style:{fontFamily:ko,fontSize:7,color:"rgba(255,255,255,0.45)",lineHeight:1.4},children:L.connections.join(", ")})]})]})})]},L.id)})})})]},$.id)})]}),a.jsx("div",{style:{position:"absolute",top:0,right:0,width:6,height:"100%",cursor:"ew-resize",background:S?"rgba(255,255,255,0.08)":"transparent",transition:"all 0.15s"},onMouseDown:()=>C(!0),onMouseEnter:$=>{S||($.currentTarget.style.background="rgba(255,255,255,0.05)")},onMouseLeave:$=>{S||($.currentTarget.style.background="transparent")}})]}),a.jsx(Xc,{children:j&&a.jsx(to.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(8px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:100},onClick:()=>T(null),children:a.jsxs(to.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:$=>$.stopPropagation(),style:{background:"rgba(0,0,0,0.97)",border:"1px dashed rgba(255,255,255,0.06)",borderRadius:1,padding:"20px 24px",minWidth:300,maxWidth:400},children:[a.jsxs("div",{style:{fontFamily:bw,fontSize:12,color:"rgba(255,255,255,0.85)",marginBottom:12},children:['Mover "',j.card.label,'"']}),a.jsx("div",{style:{fontFamily:ko,fontSize:8,color:"rgba(255,255,255,0.45)",marginBottom:16,letterSpacing:"0.08em",textTransform:"uppercase"},children:"Escolha a pasta de destino:"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:6,marginBottom:16},children:e.filter($=>$.id!==j.folderId).map($=>a.jsxs("button",{onClick:()=>{l(j.folderId,$.id,j.card.id),T(null)},style:{padding:"8px 12px",borderRadius:1,background:"rgba(255,255,255,0.05)",border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.65)",fontFamily:ko,fontSize:10,cursor:"pointer",textAlign:"left",display:"flex",alignItems:"center",gap:8,letterSpacing:"0.06em",transition:"all 0.15s"},onMouseEnter:q=>{q.currentTarget.style.background="rgba(255,255,255,0.08)",q.currentTarget.style.borderColor="rgba(255,255,255,0.1)",q.currentTarget.style.color="rgba(255,255,255,0.85)"},onMouseLeave:q=>{q.currentTarget.style.background="rgba(255,255,255,0.05)",q.currentTarget.style.borderColor="rgba(255,255,255,0.06)",q.currentTarget.style.color="rgba(255,255,255,0.65)"},children:[a.jsx(ph,{size:12,strokeWidth:1.5,style:{color:$.color||"rgba(255,255,255,0.45)"}}),a.jsx("span",{style:{fontFamily:ko},children:$.name})]},$.id))}),a.jsx("button",{onClick:()=>T(null),style:{width:"100%",padding:"6px",borderRadius:1,background:"rgba(255,255,255,0.05)",border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.45)",fontFamily:ko,fontSize:8,cursor:"pointer",letterSpacing:"0.06em",textTransform:"uppercase",transition:"all 0.15s"},onMouseEnter:$=>{$.currentTarget.style.background="rgba(255,255,255,0.08)",$.currentTarget.style.borderColor="rgba(255,255,255,0.1)",$.currentTarget.style.color="rgba(255,255,255,0.65)"},onMouseLeave:$=>{$.currentTarget.style.background="rgba(255,255,255,0.05)",$.currentTarget.style.borderColor="rgba(255,255,255,0.06)",$.currentTarget.style.color="rgba(255,255,255,0.45)"},children:"Cancelar"})]})})})]})}const fU="https://api.are.na/v2";class vw{constructor(t){this.token=t.accessToken}async request(t,r="GET",o){const s=this.token.replace(/^Bearer\s+/i,"").trim(),l={Authorization:`Bearer ${s}`,"Content-Type":"application/json"},i={method:r,headers:l};o&&(i.body=JSON.stringify(o));const u=`${fU}${t}`;console.log(`[Are.na API] ${r} ${u}`,"Token:",s.substring(0,10)+"...");const c=await fetch(u,i);if(!c.ok){let d=`Are.na API error: ${c.status}`;try{const h=await c.json();h.message&&(d+=` - ${h.message}`),console.error("[Are.na API] Error response:",h)}catch{d+=` ${c.statusText}`}throw console.error(`[Are.na API] ${r} ${u} failed:`,d),new Error(d)}return c.json()}async getChannels(){return(await this.request("/users/me/channels?per=100")).channels||[]}async createChannel(t,r=!1){return await this.request("/channels","POST",{title:t,status:r?"public":"private"})}async addLinkToChannel(t,r,o){return await this.request(`/channels/${t}/blocks`,"POST",{source:r,title:o})}async addTextToChannel(t,r,o){return await this.request(`/channels/${t}/blocks`,"POST",{content:r,title:o})}async getChannel(t){const r=await this.request(`/channels/${t}`);return{channel:r,blocks:r.contents||[]}}}function n7(){return localStorage.getItem("arena_access_token")}function pU(e){localStorage.setItem("arena_access_token",e)}function mU(){localStorage.removeItem("arena_access_token")}function jf(){return!!n7()}function gU({onClose:e,onSaveToChannel:t}){const[r,o]=w.useState(""),[s,l]=w.useState(!1),[i,u]=w.useState(!1),[c,d]=w.useState([]),[h,f]=w.useState(""),[g,m]=w.useState(!1),y=r.trim().length>20&&!r.includes(" ");w.useEffect(()=>{const C=n7();C&&(o(C),u(!0),v(C))},[]);const v=async C=>{try{const R=await new vw({accessToken:C}).getChannels();d(R)}catch(k){console.warn("Failed to load channels:",k)}},b=async()=>{if(r.trim()){l(!0),f("");try{const k=await new vw({accessToken:r.trim()}).getChannels();pU(r.trim()),u(!0),d(k)}catch(C){const k=C instanceof Error?C.message:"Token invlido ou erro de conexo";f(k),console.error("Are.na connection error:",C)}finally{l(!1)}}},S=()=>{mU(),o(""),u(!1),d([])};return a.jsxs("div",{style:{position:"fixed",inset:0,zIndex:999,background:"rgba(0,0,0,0.75)",backdropFilter:"blur(8px)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:e,children:[a.jsxs(to.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},style:{width:480,maxHeight:"75vh",background:"rgba(10,8,18,0.95)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:12,overflow:"hidden",boxShadow:"0 24px 80px rgba(0,0,0,0.7)",display:"flex",flexDirection:"column"},onClick:C=>C.stopPropagation(),children:[a.jsxs("div",{style:{padding:"18px 22px",borderBottom:"1px solid rgba(255,255,255,0.08)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[a.jsx("div",{style:{width:28,height:28,borderRadius:6,background:"linear-gradient(135deg, rgba(196,181,253,0.15), rgba(124,58,237,0.15))",border:"1px solid rgba(196,181,253,0.25)",display:"flex",alignItems:"center",justifyContent:"center"},children:a.jsx($b,{size:14,strokeWidth:1.5,style:{color:"rgba(196,181,253,0.8)"}})}),a.jsxs("div",{children:[a.jsx("div",{style:{fontSize:12,color:"rgba(255,255,255,0.85)",fontWeight:600},children:"Conectar Are.na"}),a.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.35)",marginTop:2},children:"Salve cards diretamente nos seus channels"})]})]}),a.jsx("button",{onClick:e,style:{background:"none",border:"none",color:"rgba(255,255,255,0.3)",cursor:"pointer",fontSize:18,padding:0,lineHeight:1},children:""})]}),a.jsx("div",{style:{flex:1,overflowY:"auto",padding:"20px 22px"},children:i?a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:14},children:[a.jsxs("div",{style:{padding:"12px 14px",borderRadius:8,background:"rgba(34,197,94,0.1)",border:"1px solid rgba(34,197,94,0.3)",display:"flex",alignItems:"center",gap:10},children:[a.jsx(kx,{size:14,strokeWidth:1.5,style:{color:"rgba(34,197,94,0.9)"}}),a.jsxs("div",{style:{flex:1},children:[a.jsx("div",{style:{fontSize:10,color:"rgba(34,197,94,0.95)",fontWeight:500},children:"Conectado ao Are.na"}),a.jsxs("div",{style:{fontSize:8,color:"rgba(34,197,94,0.7)",marginTop:2},children:[c.length," channels encontrados"]})]}),a.jsx("button",{onClick:S,style:{background:"none",border:"none",color:"rgba(239,68,68,0.6)",cursor:"pointer",fontSize:9,textDecoration:"underline"},children:"Desconectar"})]}),a.jsxs("div",{children:[a.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.4)",textTransform:"uppercase",letterSpacing:"0.06em",marginBottom:8},children:"Seus Channels"}),c.length>0?a.jsx("div",{style:{maxHeight:240,overflowY:"auto",display:"flex",flexDirection:"column",gap:4},children:c.map(C=>a.jsxs("div",{style:{padding:"8px 12px",borderRadius:6,background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.06)",cursor:"pointer",transition:"all 0.15s"},onMouseEnter:k=>{k.currentTarget.style.background="rgba(124,58,237,0.1)",k.currentTarget.style.borderColor="rgba(124,58,237,0.25)"},onMouseLeave:k=>{k.currentTarget.style.background="rgba(255,255,255,0.03)",k.currentTarget.style.borderColor="rgba(255,255,255,0.06)"},children:[a.jsx("div",{style:{fontSize:10,color:"rgba(255,255,255,0.75)"},children:C.title}),a.jsxs("div",{style:{fontSize:8,color:"rgba(255,255,255,0.3)",marginTop:2},children:[C.length," blocks  ",C.public?"pblico":"privado"]})]},C.id))}):a.jsxs("div",{style:{padding:"20px 16px",borderRadius:6,background:"rgba(255,255,255,0.02)",border:"1px dashed rgba(255,255,255,0.1)",textAlign:"center"},children:[a.jsx("div",{style:{fontSize:10,color:"rgba(255,255,255,0.4)",marginBottom:8},children:"Nenhum channel encontrado"}),a.jsx("a",{href:"https://www.are.na/new",target:"_blank",rel:"noopener noreferrer",style:{display:"inline-block",padding:"6px 12px",borderRadius:5,fontSize:9,fontWeight:600,background:"rgba(124,58,237,0.2)",border:"1px solid rgba(124,58,237,0.4)",color:"rgba(196,181,253,0.9)",textDecoration:"none",cursor:"pointer"},children:"+ Criar primeiro channel"})]})]})]}):a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:14},children:[a.jsxs("div",{style:{background:"rgba(59,130,246,0.08)",border:"1px solid rgba(59,130,246,0.2)",borderRadius:8,padding:"12px 14px"},children:[a.jsx("div",{style:{fontSize:10,color:"rgba(147,197,253,0.95)",marginBottom:8,fontWeight:600},children:" Como obter seu token:"}),a.jsxs("div",{style:{fontSize:9,color:"rgba(255,255,255,0.65)",lineHeight:1.6,marginBottom:6},children:["1. Abra"," ",a.jsx("a",{href:"https://dev.are.na/oauth/applications",target:"_blank",rel:"noopener noreferrer",style:{color:"rgba(147,197,253,0.95)",textDecoration:"underline",fontWeight:600},children:"dev.are.na/oauth/applications"})," ","(faa login primeiro)"]}),a.jsxs("div",{style:{fontSize:9,color:"rgba(255,255,255,0.65)",lineHeight:1.6,marginBottom:6},children:["2. Role at ",a.jsx("strong",{style:{color:"rgba(147,197,253,0.9)"},children:'"Generate a Personal Access Token"'})]}),a.jsxs("div",{style:{fontSize:9,color:"rgba(255,255,255,0.65)",lineHeight:1.6,marginBottom:6},children:["3. Clique em ",a.jsx("strong",{style:{color:"rgba(147,197,253,0.9)"},children:'"Generate token"'})," e copie o cdigo gerado"]}),a.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.65)",lineHeight:1.6,marginBottom:8},children:'4. Cole o token abaixo (apenas o cdigo, sem "Bearer")'}),a.jsx("div",{style:{fontSize:8,color:"rgba(255,180,0,0.8)",lineHeight:1.5,background:"rgba(255,180,0,0.08)",padding:"6px 8px",borderRadius:4,border:"1px solid rgba(255,180,0,0.2)"},children:" Use apenas o token alfanumrico gerado"})]}),a.jsxs("div",{children:[a.jsx("label",{style:{fontSize:9,color:"rgba(255,255,255,0.5)",display:"block",marginBottom:6,fontWeight:500},children:"Personal Access Token"}),a.jsxs("div",{children:[a.jsx("input",{type:"text",placeholder:"ex: abc123def456ghi789jkl...",value:r,onChange:C=>{o(C.target.value),f("")},onKeyDown:C=>{C.key==="Enter"&&y&&b()},autoComplete:"off",spellCheck:!1,style:{width:"100%",padding:"10px 12px",borderRadius:6,fontSize:11,background:"rgba(255,255,255,0.04)",border:`1px solid ${r.length>0&&!y?"rgba(255,180,0,0.4)":"rgba(255,255,255,0.12)"}`,color:"#fff",outline:"none",fontFamily:"monospace"}}),r.length>0&&!y&&a.jsx("div",{style:{fontSize:8,color:"rgba(255,180,0,0.8)",marginTop:6,lineHeight:1.4},children:" Token parece muito curto ou contm espaos"}),r.toLowerCase().includes("bearer")&&a.jsx("div",{style:{fontSize:8,color:"rgba(239,68,68,0.8)",marginTop:6,lineHeight:1.4},children:' Remova "Bearer" do token - cole apenas o cdigo'})]})]}),h&&a.jsxs("div",{style:{padding:"12px 14px",borderRadius:6,background:"rgba(239,68,68,0.1)",border:"1px solid rgba(239,68,68,0.3)"},children:[a.jsx("div",{style:{fontSize:10,color:"rgba(239,68,68,0.95)",fontWeight:600,marginBottom:6},children:" Falha na autenticao"}),a.jsx("div",{style:{fontSize:9,color:"rgba(239,68,68,0.85)",lineHeight:1.4,marginBottom:8},children:h}),h.includes("401")&&a.jsxs("div",{children:[a.jsxs("div",{style:{fontSize:9,color:"rgba(255,255,255,0.6)",marginBottom:8,lineHeight:1.5},children:[" ",a.jsx("strong",{style:{color:"rgba(255,255,255,0.8)"},children:"Possveis causas:"}),a.jsx("br",{})," Token incorreto ou invlido",a.jsx("br",{})," Token expirado ou revogado",a.jsx("br",{}),' Formato incorreto (no inclua "Bearer")']}),a.jsx("a",{href:"https://dev.are.na/oauth/applications",target:"_blank",rel:"noopener noreferrer",style:{display:"inline-block",padding:"6px 10px",borderRadius:5,fontSize:9,fontWeight:600,background:"rgba(239,68,68,0.2)",border:"1px solid rgba(239,68,68,0.4)",color:"rgba(252,165,165,0.95)",textDecoration:"none"},children:" Gerar novo token"})]}),h.includes("404")&&a.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.6)",lineHeight:1.5},children:" Endpoint no encontrado. Verifique sua conexo de internet."})]}),a.jsx("button",{onClick:b,disabled:s||!y,style:{width:"100%",padding:"10px 0",borderRadius:7,fontSize:11,fontWeight:600,background:s||!y?"rgba(255,255,255,0.05)":"rgba(124,58,237,0.25)",border:`1px solid ${s||!y?"rgba(255,255,255,0.08)":"rgba(124,58,237,0.45)"}`,color:s||!y?"rgba(255,255,255,0.3)":"rgba(196,181,253,0.95)",cursor:s||!y?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:8},children:s?a.jsxs(a.Fragment,{children:[a.jsx(tE,{size:12,strokeWidth:1.5,style:{animation:"spin 1s linear infinite"}}),"Conectando..."]}):a.jsxs(a.Fragment,{children:[a.jsx(kx,{size:12,strokeWidth:1.5}),"Conectar"]})}),a.jsxs("button",{onClick:()=>m(!g),style:{width:"100%",padding:"8px 0",background:"none",border:"none",color:"rgba(255,255,255,0.4)",fontSize:9,cursor:"pointer",textAlign:"center",textDecoration:"underline"},children:[g?"":""," Problemas para conectar?"]}),g&&a.jsxs("div",{style:{padding:"12px 14px",borderRadius:6,background:"rgba(147,51,234,0.08)",border:"1px solid rgba(147,51,234,0.2)"},children:[a.jsx("div",{style:{fontSize:9,color:"rgba(196,181,253,0.95)",fontWeight:600,marginBottom:8},children:" Checklist de verificao:"}),a.jsxs("div",{style:{fontSize:9,color:"rgba(255,255,255,0.65)",lineHeight:1.7,marginLeft:4},children:["1. Faa login no ",a.jsx("strong",{style:{color:"rgba(196,181,253,0.9)"},children:"Are.na"})," antes de gerar o token",a.jsx("br",{}),"2. Use a seo ",a.jsx("strong",{style:{color:"rgba(196,181,253,0.9)"},children:'"Generate a Personal Access Token"'}),' (no "OAuth Applications")',a.jsx("br",{}),"3. Copie ",a.jsx("strong",{style:{color:"rgba(196,181,253,0.9)"},children:"apenas"}),' o cdigo gerado (sem espaos ou "Bearer")',a.jsx("br",{}),"4. O token deve ter pelo menos 40 caracteres alfanumricos",a.jsx("br",{}),"5. Se continuar falhando, tente gerar um novo token"]})]})]})})]}),a.jsx("style",{children:`
        @keyframes spin {
          to { transform: rotate(360deg); }
        }
      `})]})}const yU="'Doto', monospace",so="'IBM Plex Mono', monospace",xU={influences:{icon:"",color:"#a78bfa"},contrasts:{icon:"",color:"#ef4444"},bridges:{icon:"",color:"#f472b6"},extends:{icon:"",color:"#60a5fa"},contains:{icon:"",color:"#4ade80"},co_occurs:{icon:"",color:"#94a3b8"},method_for:{icon:"",color:"#fbbf24"},example_of:{icon:"",color:"#fb923c"},critiques:{icon:"",color:"#f87171"},related:{icon:"",color:"#64748b"}};function bU({node:e,allNodes:t,score:r,onClose:o,onSaveCard:s,onSendToArena:l,onExpand:i}){const u=Array.from(e.connections.keys()).map(c=>t.find(d=>d.id===c)).filter(Boolean);return a.jsxs(to.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},style:{position:"fixed",top:80,right:20,width:320,maxHeight:"calc(100vh - 120px)",background:"rgba(10,8,18,0.95)",backdropFilter:"blur(24px)",border:"1px dashed rgba(255,255,255,0.06)",borderRadius:1,boxShadow:"0 16px 48px rgba(0,0,0,0.5)",display:"flex",flexDirection:"column",overflow:"hidden",zIndex:100},children:[a.jsxs("div",{style:{padding:"14px 16px",borderBottom:"1px dashed rgba(255,255,255,0.06)",display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:10},children:[a.jsxs("div",{style:{flex:1,minWidth:0},children:[a.jsx("div",{style:{fontFamily:yU,fontSize:13,color:"rgba(255,255,255,0.85)",fontWeight:600,lineHeight:1.3},children:e.label||`Node ${e.id}`}),a.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:4,marginTop:4},children:[e.category&&a.jsx("div",{style:{display:"inline-block",padding:"2px 6px",borderRadius:1,fontSize:7,background:"rgba(124,58,237,0.15)",border:"1px dashed rgba(124,58,237,0.35)",color:"rgba(196,181,253,0.8)",textTransform:"uppercase",letterSpacing:"0.08em",fontFamily:so},children:e.category}),e.isBridge&&a.jsx("div",{style:{display:"inline-block",padding:"2px 6px",borderRadius:1,fontSize:7,background:"rgba(244,114,182,0.15)",border:"1px dashed rgba(244,114,182,0.35)",color:"rgba(244,114,182,0.9)",textTransform:"uppercase",letterSpacing:"0.08em",fontFamily:so},children:"BRIDGE"}),e.isHub&&a.jsx("div",{style:{display:"inline-block",padding:"2px 6px",borderRadius:1,fontSize:7,background:"rgba(251,191,36,0.15)",border:"1px dashed rgba(251,191,36,0.35)",color:"rgba(251,191,36,0.9)",textTransform:"uppercase",letterSpacing:"0.08em",fontFamily:so},children:"HUB"}),e.mentionCount!==void 0&&e.mentionCount>0&&a.jsxs("div",{style:{display:"inline-block",padding:"2px 6px",borderRadius:1,fontSize:7,background:"rgba(96,165,250,0.12)",border:"1px dashed rgba(96,165,250,0.30)",color:"rgba(96,165,250,0.85)",textTransform:"uppercase",letterSpacing:"0.08em",fontFamily:so},children:[e.mentionCount,"x CITED"]})]})]}),a.jsx("button",{onClick:o,style:{background:"none",border:"none",fontFamily:so,color:"rgba(255,255,255,0.45)",cursor:"pointer",fontSize:16,padding:0,lineHeight:1,transition:"all 0.15s"},children:""})]}),a.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"14px 16px"},children:[e.description&&a.jsx("div",{style:{fontFamily:so,fontSize:10,color:"rgba(255,255,255,0.45)",lineHeight:1.5,marginBottom:14},children:e.description}),r&&a.jsxs("div",{style:{marginBottom:14,padding:"10px 12px",borderRadius:1,background:"rgba(255,255,255,0.03)",border:"1px dashed rgba(255,255,255,0.06)"},children:[a.jsxs("div",{style:{fontFamily:so,fontSize:8,color:"rgba(255,255,255,0.22)",textTransform:"uppercase",letterSpacing:"0.08em",marginBottom:8,display:"flex",alignItems:"center",gap:5},children:[a.jsx(vE,{size:9,strokeWidth:1.5}),"Mtricas de Rede"]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.jsx("span",{style:{fontFamily:so,fontSize:9,color:"rgba(255,255,255,0.45)"},children:"Relevncia"}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[a.jsx("div",{style:{width:60,height:4,borderRadius:1,background:"rgba(255,255,255,0.1)",overflow:"hidden"},children:a.jsx("div",{style:{width:`${r.relevance*100}%`,height:"100%",background:"linear-gradient(90deg, rgba(124,58,237,0.6), rgba(196,181,253,0.8))"}})}),a.jsxs("span",{style:{fontSize:9,color:"rgba(255,255,255,0.65)",fontFamily:so,minWidth:28},children:[(r.relevance*100).toFixed(0),"%"]})]})]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.jsxs("span",{style:{fontFamily:so,fontSize:9,color:"rgba(255,255,255,0.45)"},children:["Ponte ",r.isBridge&&""]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[a.jsx("div",{style:{width:60,height:4,borderRadius:1,background:"rgba(255,255,255,0.1)",overflow:"hidden"},children:a.jsx("div",{style:{width:`${r.betweenness*100}%`,height:"100%",background:"linear-gradient(90deg, rgba(251,191,36,0.6), rgba(251,191,36,0.9))"}})}),a.jsxs("span",{style:{fontSize:9,color:"rgba(255,255,255,0.65)",fontFamily:so,minWidth:28},children:[(r.betweenness*100).toFixed(0),"%"]})]})]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.jsx("span",{style:{fontFamily:so,fontSize:9,color:"rgba(255,255,255,0.45)"},children:"Centralidade"}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[a.jsx("div",{style:{width:60,height:4,borderRadius:1,background:"rgba(255,255,255,0.1)",overflow:"hidden"},children:a.jsx("div",{style:{width:`${Math.min(r.closeness*100,100)}%`,height:"100%",background:"linear-gradient(90deg, rgba(34,197,94,0.6), rgba(34,197,94,0.9))"}})}),a.jsxs("span",{style:{fontSize:9,color:"rgba(255,255,255,0.65)",fontFamily:so,minWidth:28},children:[(Math.min(r.closeness,1)*100).toFixed(0),"%"]})]})]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.jsxs("span",{style:{fontFamily:so,fontSize:9,color:"rgba(255,255,255,0.45)"},children:["Conexes ",r.isHub&&""]}),a.jsx("span",{style:{fontSize:9,color:"rgba(255,255,255,0.65)",fontFamily:so},children:r.degree})]}),a.jsxs("div",{style:{marginTop:4,paddingTop:8,borderTop:"1px dashed rgba(255,255,255,0.06)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.jsx("span",{style:{fontFamily:so,fontSize:9,color:"rgba(255,255,255,0.45)",fontWeight:500},children:"Score Total"}),a.jsx("div",{style:{padding:"2px 7px",borderRadius:1,background:"rgba(124,58,237,0.2)",border:"1px dashed rgba(124,58,237,0.35)",fontSize:9,color:"rgba(196,181,253,0.95)",fontFamily:so,fontWeight:600},children:(r.combined*100).toFixed(0)})]})]})]}),u.length>0&&a.jsxs("div",{style:{marginBottom:14},children:[a.jsxs("div",{style:{fontFamily:so,fontSize:8,color:"rgba(255,255,255,0.22)",textTransform:"uppercase",letterSpacing:"0.08em",marginBottom:7},children:["Conexes (",u.length,")"]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:3},children:[u.slice(0,12).map(c=>{var g,m;const d=((g=e.edgeTypes)==null?void 0:g.get(c.id))??((m=c.edgeTypes)==null?void 0:m.get(e.id)),h=d?xU[d]:void 0,f=e.connections.get(c.id)??0;return a.jsxs("div",{style:{padding:"5px 8px",borderRadius:1,background:"rgba(255,255,255,0.02)",border:"1px dashed rgba(255,255,255,0.06)",fontSize:9,fontFamily:so,color:"rgba(255,255,255,0.65)",cursor:"pointer",transition:"all 0.15s",display:"flex",alignItems:"center",justifyContent:"space-between",gap:6},onClick:()=>i(c),onMouseEnter:y=>{y.currentTarget.style.background="rgba(124,58,237,0.08)",y.currentTarget.style.borderColor="rgba(124,58,237,0.2)"},onMouseLeave:y=>{y.currentTarget.style.background="rgba(255,255,255,0.02)",y.currentTarget.style.borderColor="rgba(255,255,255,0.06)"},children:[a.jsx("span",{style:{flex:1,minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:c.label||`Node ${c.id}`}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,flexShrink:0},children:[h&&a.jsxs("span",{style:{fontSize:7,color:h.color,fontFamily:so,opacity:.8},children:[h.icon," ",d]}),a.jsxs("span",{style:{fontSize:7,color:"rgba(255,255,255,0.25)",fontFamily:so},children:[(f*100).toFixed(0),"%"]})]})]},c.id)}),u.length>12&&a.jsxs("div",{style:{fontFamily:so,fontSize:8,color:"rgba(255,255,255,0.22)",marginTop:2,fontStyle:"italic"},children:["+",u.length-12," mais"]})]})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:5},children:[a.jsxs("button",{onClick:()=>s(e),style:{width:"100%",padding:"8px 12px",borderRadius:1,fontSize:10,fontFamily:so,fontWeight:500,background:"rgba(124,58,237,0.15)",border:"1px dashed rgba(124,58,237,0.35)",color:"rgba(196,181,253,0.9)",letterSpacing:"0.06em",textTransform:"uppercase",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:7,transition:"all 0.15s"},onMouseEnter:c=>{c.currentTarget.style.background="rgba(124,58,237,0.25)",c.currentTarget.style.borderColor="rgba(124,58,237,0.5)"},onMouseLeave:c=>{c.currentTarget.style.background="rgba(124,58,237,0.15)",c.currentTarget.style.borderColor="rgba(124,58,237,0.35)"},children:[a.jsx(Bb,{size:11,strokeWidth:1.5}),"Salvar em Coleo"]}),a.jsxs("button",{onClick:()=>l(e),style:{width:"100%",padding:"8px 12px",borderRadius:1,fontSize:10,fontFamily:so,fontWeight:500,background:"rgba(255,255,255,0.04)",border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.65)",letterSpacing:"0.06em",textTransform:"uppercase",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:7,transition:"all 0.15s"},onMouseEnter:c=>{c.currentTarget.style.background="rgba(255,255,255,0.08)",c.currentTarget.style.borderColor="rgba(255,255,255,0.12)"},onMouseLeave:c=>{c.currentTarget.style.background="rgba(255,255,255,0.04)",c.currentTarget.style.borderColor="rgba(255,255,255,0.06)"},children:[a.jsx($b,{size:11,strokeWidth:1.5}),"Enviar ao Are.na"]}),a.jsxs("button",{onClick:()=>i(e),style:{width:"100%",padding:"8px 12px",borderRadius:1,fontSize:10,fontFamily:so,fontWeight:500,background:"rgba(255,255,255,0.04)",border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.65)",letterSpacing:"0.06em",textTransform:"uppercase",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:7,transition:"all 0.15s"},onMouseEnter:c=>{c.currentTarget.style.background="rgba(255,255,255,0.08)",c.currentTarget.style.borderColor="rgba(255,255,255,0.12)"},onMouseLeave:c=>{c.currentTarget.style.background="rgba(255,255,255,0.04)",c.currentTarget.style.borderColor="rgba(255,255,255,0.06)"},children:[a.jsx(Es,{size:11,strokeWidth:1.5}),"Expandir Rizoma"]})]})]})]})}function vU({folders:e,onSelect:t,onCreateFolder:r,onClose:o}){const[s,l]=w.useState(!1),[i,u]=w.useState(""),[c,d]=w.useState(""),h=()=>{i.trim()&&(r(i.trim(),c.trim()||void 0),u(""),d(""),l(!1))};return a.jsx(to.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:200},onClick:o,children:a.jsxs(to.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:f=>f.stopPropagation(),style:{background:"rgba(10,8,20,0.95)",border:"1px solid rgba(255,255,255,0.15)",borderRadius:8,padding:"20px 24px",minWidth:340,maxWidth:420,maxHeight:"80vh",display:"flex",flexDirection:"column"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:16},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx(ph,{size:16,strokeWidth:1.5,style:{color:"rgba(196,181,253,0.6)"}}),a.jsx("div",{style:{fontSize:13,color:"rgba(255,255,255,0.9)",fontWeight:600},children:"Salvar em Coleo"})]}),a.jsx("button",{onClick:o,style:{background:"none",border:"none",cursor:"pointer",color:"rgba(255,255,255,0.4)",padding:4,display:"flex",alignItems:"center"},children:a.jsx(ya,{size:14,strokeWidth:1.5})})]}),a.jsxs("button",{onClick:()=>l(f=>!f),style:{padding:"8px 12px",borderRadius:6,background:s?"rgba(124,58,237,0.2)":"rgba(124,58,237,0.1)",border:`1px solid ${s?"rgba(124,58,237,0.4)":"rgba(124,58,237,0.25)"}`,color:"rgba(196,181,253,0.9)",fontSize:10,cursor:"pointer",display:"flex",alignItems:"center",gap:6,marginBottom:12,fontWeight:500},children:[a.jsx(jg,{size:11,strokeWidth:1.5}),"Nova Coleo"]}),a.jsx(Xc,{children:s&&a.jsx(to.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden",marginBottom:12},children:a.jsxs("div",{style:{padding:12,borderRadius:6,background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.08)",display:"flex",flexDirection:"column",gap:8},children:[a.jsx("input",{type:"text",placeholder:"Nome da coleo",value:i,onChange:f=>u(f.target.value),onKeyDown:f=>{f.key==="Enter"&&h()},style:{width:"100%",padding:"7px 10px",borderRadius:4,fontSize:10,background:"rgba(255,255,255,0.04)",border:"1px solid rgba(255,255,255,0.1)",color:"#fff",outline:"none"},autoFocus:!0}),a.jsx("input",{type:"text",placeholder:"Descrio (opcional)",value:c,onChange:f=>d(f.target.value),onKeyDown:f=>{f.key==="Enter"&&h()},style:{width:"100%",padding:"7px 10px",borderRadius:4,fontSize:9,background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",color:"rgba(255,255,255,0.7)",outline:"none"}}),a.jsx("button",{onClick:h,style:{width:"100%",padding:"6px 0",borderRadius:4,fontSize:9,background:"rgba(124,58,237,0.25)",border:"1px solid rgba(124,58,237,0.4)",color:"rgba(196,181,253,0.95)",cursor:"pointer",fontWeight:500,letterSpacing:"0.05em"},children:"Criar e Salvar Aqui"})]})})}),a.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.5)",marginBottom:10},children:"Escolha uma coleo existente:"}),a.jsx("div",{style:{flex:1,overflowY:"auto",display:"flex",flexDirection:"column",gap:6,marginBottom:16},children:e.length===0?a.jsxs("div",{style:{padding:"24px 20px",textAlign:"center",fontSize:9,color:"rgba(255,255,255,0.25)",lineHeight:1.5},children:["Nenhuma coleo ainda.",a.jsx("br",{}),"Crie uma nova acima."]}):e.map(f=>a.jsxs("button",{onClick:()=>t(f.id),style:{padding:"10px 12px",borderRadius:6,background:"rgba(124,58,237,0.1)",border:"1px solid rgba(124,58,237,0.25)",color:"rgba(196,181,253,0.9)",fontSize:10,cursor:"pointer",textAlign:"left",display:"flex",alignItems:"center",gap:10,transition:"all 0.15s"},onMouseEnter:g=>{g.currentTarget.style.background="rgba(124,58,237,0.2)",g.currentTarget.style.borderColor="rgba(124,58,237,0.4)"},onMouseLeave:g=>{g.currentTarget.style.background="rgba(124,58,237,0.1)",g.currentTarget.style.borderColor="rgba(124,58,237,0.25)"},children:[a.jsx(ph,{size:13,strokeWidth:1.5,style:{color:f.color||"rgba(196,181,253,0.6)"}}),a.jsxs("div",{style:{flex:1},children:[a.jsx("div",{style:{fontWeight:500},children:f.name}),f.description&&a.jsx("div",{style:{fontSize:8,color:"rgba(255,255,255,0.4)",marginTop:2},children:f.description})]}),a.jsx("span",{style:{fontSize:8,color:"rgba(255,255,255,0.3)",background:"rgba(255,255,255,0.05)",padding:"2px 6px",borderRadius:3,fontFamily:"monospace"},children:f.cards.length})]},f.id))}),a.jsx("button",{onClick:o,style:{width:"100%",padding:"7px",borderRadius:4,background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.5)",fontSize:9,cursor:"pointer"},children:"Cancelar"})]})})}const r7="rhizome_folders_v1",o7="saved_rhizomes_v1";function Rs(){try{const e=localStorage.getItem(r7);return e?JSON.parse(e):[]}catch{return[]}}function zd(e){try{localStorage.setItem(r7,JSON.stringify(e)),gl(()=>import("./rhizomeBackend-Bij1RBcf.js"),[]).then(t=>{t.saveFoldersToBackend(e).catch(r=>{console.warn("Backend sync failed:",r)})})}catch(t){console.warn("Failed to save folders:",t)}}function a7(e,t){const r={id:`folder_${Date.now()}_${Math.random().toString(36).slice(2,9)}`,name:e,description:t,cards:[],createdAt:Date.now(),updatedAt:Date.now(),isPublic:!1},o=Rs();return o.push(r),zd(o),r}function s7(e){const r=Rs().filter(o=>o.id!==e);zd(r)}function i7(e,t){const r=Rs(),o=r.find(s=>s.id===e);o&&(o.cards.some(l=>l.label===t.label||l.url&&l.url===t.url)||(o.cards.push(t),o.updatedAt=Date.now(),zd(r)))}function l7(e,t){const r=Rs(),o=r.find(s=>s.id===e);o&&(o.cards=o.cards.filter(s=>s.id!==t),o.updatedAt=Date.now(),zd(r))}function c7(e,t,r){const o=Rs(),s=o.find(i=>i.id===e),l=o.find(i=>i.id===t);if(s&&l){const i=s.cards.find(u=>u.id===r);i&&(s.cards=s.cards.filter(u=>u.id!==r),s.updatedAt=Date.now(),l.cards.find(u=>u.id===r)||(l.cards.push(i),l.updatedAt=Date.now()),zd(o))}}function vg(){try{const e=localStorage.getItem(o7);return e?JSON.parse(e):[]}catch{return[]}}function d7(e){try{localStorage.setItem(o7,JSON.stringify(e)),gl(()=>import("./rhizomeBackend-Bij1RBcf.js"),[]).then(t=>{t.saveRhizomesToBackend(e).catch(r=>{console.warn("Backend sync failed:",r)})})}catch(t){console.warn("Failed to save rhizomes:",t)}}function SU(e,t,r,o,s,l){const i={id:`rhizome_${Date.now()}_${Math.random().toString(36).slice(2,9)}`,title:e,description:t,topic:r,nodeCount:o,snapshot:s,savedAt:Date.now(),folderId:l},u=vg();return u.push(i),d7(u),i}function u7(e,t,r,o,s,l){return{id:`card_${Date.now()}_${Math.random().toString(36).slice(2,9)}`,label:e,description:t,category:r,tags:s??(r?[r]:[]),connections:o,links:l,savedAt:Date.now(),source:"rhizome"}}const rx=Object.freeze(Object.defineProperty({__proto__:null,addCardToFolder:i7,createCardFromNode:u7,createFolder:a7,deleteFolder:s7,loadFolders:Rs,loadSavedRhizomes:vg,moveCardBetweenFolders:c7,removeCardFromFolder:l7,saveFolders:zd,saveRhizome:SU,saveSavedRhizomes:d7},Symbol.toStringTag,{value:"Module"}));function Dv(e){const t=new Map;for(const r of e){t.has(r.id)||t.set(r.id,new Set);for(const[o]of r.connections)t.get(r.id).add(o)}return t}function wU(e,t,r){const o=new Map,s=[e];for(o.set(e,0);s.length>0;){const l=s.shift(),i=t.get(l)||new Set;for(const u of i)o.has(u)||(o.set(u,o.get(l)+1),s.push(u))}return o}function h7(e){new Map(e.map(s=>[s.id,s]));const t=Dv(e),r=new Map;for(const s of e)r.set(s.id,0);for(const s of e){const l=[],i=new Map,u=new Map,c=new Map;for(const f of e)i.set(f.id,[]),u.set(f.id,0),c.set(f.id,-1);u.set(s.id,1),c.set(s.id,0);const d=[s.id];for(;d.length>0;){const f=d.shift();l.push(f);const g=t.get(f)||new Set;for(const m of g)c.get(m)<0&&(d.push(m),c.set(m,c.get(f)+1)),c.get(m)===c.get(f)+1&&(u.set(m,u.get(m)+u.get(f)),i.get(m).push(f))}const h=new Map;for(const f of e)h.set(f.id,0);for(;l.length>0;){const f=l.pop();for(const g of i.get(f)){const m=u.get(g)/u.get(f)*(1+h.get(f));h.set(g,h.get(g)+m)}f!==s.id&&r.set(f,r.get(f)+h.get(f))}}const o=e.length;if(o>2){const s=2/((o-1)*(o-2));for(const[l,i]of r)r.set(l,i*s)}return r}function CU(e){new Map(e.map(o=>[o.id,o]));const t=Dv(e),r=new Map;for(const o of e){const s=wU(o.id,t);let l=0,i=0;for(const[u,c]of s)u!==o.id&&c>0&&(l+=c,i++);i>0?r.set(o.id,i/l):r.set(o.id,0)}return r}function MU(e){new Map(e.map(l=>[l.id,l]));const t=Dv(e),r=new Map;for(const l of e)r.set(l.id,l.id);let o=!0,s=0;for(;o&&s<10;){o=!1,s++;for(const l of e){const i=t.get(l.id)||new Set,u=new Map;for(const h of i){const f=r.get(h),g=l.connections.get(h)||1;u.set(f,(u.get(f)||0)+g)}let c=r.get(l.id),d=u.get(c)||0;for(const[h,f]of u)f>d&&(d=f,c=h);c!==r.get(l.id)&&(r.set(l.id,c),o=!0)}}return r}function kU(e,t=.7){const r=e.map(s=>s.connections.size),o=Math.max(...r,1);return e.filter(s=>s.connections.size/o>=t)}function RU(e){const t=h7(e),r=MU(e),o=[];for(const s of e){if((t.get(s.id)||0)<.3)continue;const i=new Set;for(const[u]of s.connections){const c=r.get(u);c!==void 0&&i.add(c)}i.size>=2&&o.push(s)}return o}function AU(e){const t=h7(e),r=CU(e),o=new Set(RU(e).map(i=>i.id)),s=new Set(kU(e,.6).map(i=>i.id)),l=new Map;for(const i of e){const u=t.get(i.id)||0,c=r.get(i.id)||0,d=i.connections.size,h=i.relevance||.5,f=Math.max(...e.map(y=>y.connections.size),1),g=d/f,m=h*.4+u*.3+c*.2+g*.1;l.set(i.id,{nodeId:i.id,relevance:h,betweenness:u,closeness:c,degree:d,combined:m,isBridge:o.has(i.id),isHub:s.has(i.id)})}return l}function Gg(e,t){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(r[o[s]]=e[o[s]]);return r}function jU(e,t,r,o){function s(l){return l instanceof r?l:new r(function(i){i(l)})}return new(r||(r=Promise))(function(l,i){function u(h){try{d(o.next(h))}catch(f){i(f)}}function c(h){try{d(o.throw(h))}catch(f){i(f)}}function d(h){h.done?l(h.value):s(h.value).then(u,c)}d((o=o.apply(e,t||[])).next())})}const EU=e=>e?(...t)=>e(...t):(...t)=>fetch(...t);class Lv extends Error{constructor(t,r="FunctionsError",o){super(t),this.name=r,this.context=o}}class TU extends Lv{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class Sw extends Lv{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class ww extends Lv{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var Cb;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(Cb||(Cb={}));class IU{constructor(t,{headers:r={},customFetch:o,region:s=Cb.Any}={}){this.url=t,this.headers=r,this.region=s,this.fetch=EU(o)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return jU(this,arguments,void 0,function*(r,o={}){var s;let l,i;try{const{headers:u,method:c,body:d,signal:h,timeout:f}=o;let g={},{region:m}=o;m||(m=this.region);const y=new URL(`${this.url}/${r}`);m&&m!=="any"&&(g["x-region"]=m,y.searchParams.set("forceFunctionRegion",m));let v;d&&(u&&!Object.prototype.hasOwnProperty.call(u,"Content-Type")||!u)?typeof Blob<"u"&&d instanceof Blob||d instanceof ArrayBuffer?(g["Content-Type"]="application/octet-stream",v=d):typeof d=="string"?(g["Content-Type"]="text/plain",v=d):typeof FormData<"u"&&d instanceof FormData?v=d:(g["Content-Type"]="application/json",v=JSON.stringify(d)):d&&typeof d!="string"&&!(typeof Blob<"u"&&d instanceof Blob)&&!(d instanceof ArrayBuffer)&&!(typeof FormData<"u"&&d instanceof FormData)?v=JSON.stringify(d):v=d;let b=h;f&&(i=new AbortController,l=setTimeout(()=>i.abort(),f),h?(b=i.signal,h.addEventListener("abort",()=>i.abort())):b=i.signal);const S=yield this.fetch(y.toString(),{method:c||"POST",headers:Object.assign(Object.assign(Object.assign({},g),this.headers),u),body:v,signal:b}).catch(j=>{throw new TU(j)}),C=S.headers.get("x-relay-error");if(C&&C==="true")throw new Sw(S);if(!S.ok)throw new ww(S);let k=((s=S.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),R;return k==="application/json"?R=yield S.json():k==="application/octet-stream"||k==="application/pdf"?R=yield S.blob():k==="text/event-stream"?R=S:k==="multipart/form-data"?R=yield S.formData():R=yield S.text(),{data:R,error:null,response:S}}catch(u){return{data:null,error:u,response:u instanceof ww||u instanceof Sw?u.context:void 0}}finally{l&&clearTimeout(l)}})}}var PU=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}},FU=class{constructor(e){var t,r,o;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=(t=e.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=e.signal,this.isMaybeSingle=(r=e.isMaybeSingle)!==null&&r!==void 0?r:!1,this.urlLengthLimit=(o=e.urlLengthLimit)!==null&&o!==void 0?o:8e3,e.fetch?this.fetch=e.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){var r=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const o=this.fetch;let s=o(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async l=>{let i=null,u=null,c=null,d=l.status,h=l.statusText;if(l.ok){var f,g;if(r.method!=="HEAD"){var m;const S=await l.text();S===""||(r.headers.get("Accept")==="text/csv"||r.headers.get("Accept")&&(!((m=r.headers.get("Accept"))===null||m===void 0)&&m.includes("application/vnd.pgrst.plan+text"))?u=S:u=JSON.parse(S))}const v=(f=r.headers.get("Prefer"))===null||f===void 0?void 0:f.match(/count=(exact|planned|estimated)/),b=(g=l.headers.get("content-range"))===null||g===void 0?void 0:g.split("/");v&&b&&b.length>1&&(c=parseInt(b[1])),r.isMaybeSingle&&r.method==="GET"&&Array.isArray(u)&&(u.length>1?(i={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,c=null,d=406,h="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{var y;const v=await l.text();try{i=JSON.parse(v),Array.isArray(i)&&l.status===404&&(u=[],i=null,d=200,h="OK")}catch{l.status===404&&v===""?(d=204,h="No Content"):i={message:v}}if(i&&r.isMaybeSingle&&(!(i==null||(y=i.details)===null||y===void 0)&&y.includes("0 rows"))&&(i=null,d=200,h="OK"),i&&r.shouldThrowOnError)throw new PU(i)}return{error:i,data:u,count:c,status:d,statusText:h}});return this.shouldThrowOnError||(s=s.catch(l=>{var i;let u="",c="",d="";const h=l==null?void 0:l.cause;if(h){var f,g,m,y;const S=(f=h==null?void 0:h.message)!==null&&f!==void 0?f:"",C=(g=h==null?void 0:h.code)!==null&&g!==void 0?g:"";u=`${(m=l==null?void 0:l.name)!==null&&m!==void 0?m:"FetchError"}: ${l==null?void 0:l.message}`,u+=`

Caused by: ${(y=h==null?void 0:h.name)!==null&&y!==void 0?y:"Error"}: ${S}`,C&&(u+=` (${C})`),h!=null&&h.stack&&(u+=`
${h.stack}`)}else{var v;u=(v=l==null?void 0:l.stack)!==null&&v!==void 0?v:""}const b=this.url.toString().length;return(l==null?void 0:l.name)==="AbortError"||(l==null?void 0:l.code)==="ABORT_ERR"?(d="",c="Request was aborted (timeout or manual cancellation)",b>this.urlLengthLimit&&(c+=`. Note: Your request URL is ${b} characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side.`)):((h==null?void 0:h.name)==="HeadersOverflowError"||(h==null?void 0:h.code)==="UND_ERR_HEADERS_OVERFLOW")&&(d="",c="HTTP headers exceeded server limits (typically 16KB)",b>this.urlLengthLimit&&(c+=`. Your request URL is ${b} characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead.`)),{error:{message:`${(i=l==null?void 0:l.name)!==null&&i!==void 0?i:"FetchError"}: ${l==null?void 0:l.message}`,details:u,hint:c,code:d},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}returns(){return this}overrideTypes(){return this}},NU=class extends FU{select(e){let t=!1;const r=(e??"*").split("").map(o=>/\s/.test(o)&&!t?"":(o==='"'&&(t=!t),o)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:o,referencedTable:s=o}={}){const l=s?`${s}.order`:"order",i=this.url.searchParams.get(l);return this.url.searchParams.set(l,`${i?`${i},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const o=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(o,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:o=r}={}){const s=typeof o>"u"?"offset":`${o}.offset`,l=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(s,`${e}`),this.url.searchParams.set(l,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:o=!1,wal:s=!1,format:l="text"}={}){var i;const u=[e?"analyze":null,t?"verbose":null,r?"settings":null,o?"buffers":null,s?"wal":null].filter(Boolean).join("|"),c=(i=this.headers.get("Accept"))!==null&&i!==void 0?i:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${l}; for="${c}"; options=${u};`),l==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};const Cw=new RegExp("[,()]");var Ju=class extends NU{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}regexMatch(e,t){return this.url.searchParams.append(e,`match.${t}`),this}regexIMatch(e,t){return this.url.searchParams.append(e,`imatch.${t}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}isDistinct(e,t){return this.url.searchParams.append(e,`isdistinct.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(o=>typeof o=="string"&&Cw.test(o)?`"${o}"`:`${o}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}notIn(e,t){const r=Array.from(new Set(t)).map(o=>typeof o=="string"&&Cw.test(o)?`"${o}"`:`${o}`).join(",");return this.url.searchParams.append(e,`not.in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:o}={}){let s="";o==="plain"?s="pl":o==="phrase"?s="ph":o==="websearch"&&(s="w");const l=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${s}fts${l}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const o=r?`${r}.or`:"or";return this.url.searchParams.append(o,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}},OU=class{constructor(e,{headers:t={},schema:r,fetch:o,urlLengthLimit:s=8e3}){this.url=e,this.headers=new Headers(t),this.schema=r,this.fetch=o,this.urlLengthLimit=s}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(e,t){const{head:r=!1,count:o}=t??{},s=r?"HEAD":"GET";let l=!1;const i=(e??"*").split("").map(d=>/\s/.test(d)&&!l?"":(d==='"'&&(l=!l),d)).join(""),{url:u,headers:c}=this.cloneRequestState();return u.searchParams.set("select",i),o&&c.append("Prefer",`count=${o}`),new Ju({method:s,url:u,headers:c,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}insert(e,{count:t,defaultToNull:r=!0}={}){var o;const s="POST",{url:l,headers:i}=this.cloneRequestState();if(t&&i.append("Prefer",`count=${t}`),r||i.append("Prefer","missing=default"),Array.isArray(e)){const u=e.reduce((c,d)=>c.concat(Object.keys(d)),[]);if(u.length>0){const c=[...new Set(u)].map(d=>`"${d}"`);l.searchParams.set("columns",c.join(","))}}return new Ju({method:s,url:l,headers:i,schema:this.schema,body:e,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch,urlLengthLimit:this.urlLengthLimit})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:o,defaultToNull:s=!0}={}){var l;const i="POST",{url:u,headers:c}=this.cloneRequestState();if(c.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),t!==void 0&&u.searchParams.set("on_conflict",t),o&&c.append("Prefer",`count=${o}`),s||c.append("Prefer","missing=default"),Array.isArray(e)){const d=e.reduce((h,f)=>h.concat(Object.keys(f)),[]);if(d.length>0){const h=[...new Set(d)].map(f=>`"${f}"`);u.searchParams.set("columns",h.join(","))}}return new Ju({method:i,url:u,headers:c,schema:this.schema,body:e,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch,urlLengthLimit:this.urlLengthLimit})}update(e,{count:t}={}){var r;const o="PATCH",{url:s,headers:l}=this.cloneRequestState();return t&&l.append("Prefer",`count=${t}`),new Ju({method:o,url:s,headers:l,schema:this.schema,body:e,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch,urlLengthLimit:this.urlLengthLimit})}delete({count:e}={}){var t;const r="DELETE",{url:o,headers:s}=this.cloneRequestState();return e&&s.append("Prefer",`count=${e}`),new Ju({method:r,url:o,headers:s,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch,urlLengthLimit:this.urlLengthLimit})}};function bp(e){"@babel/helpers - typeof";return bp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bp(e)}function _U(e,t){if(bp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var o=r.call(e,t);if(bp(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function DU(e){var t=_U(e,"string");return bp(t)=="symbol"?t:t+""}function LU(e,t,r){return(t=DU(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Mw(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,o)}return r}function p5(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Mw(Object(r),!0).forEach(function(o){LU(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Mw(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}var zU=class f7{constructor(t,{headers:r={},schema:o,fetch:s,timeout:l,urlLengthLimit:i=8e3}={}){this.url=t,this.headers=new Headers(r),this.schemaName=o,this.urlLengthLimit=i;const u=s??globalThis.fetch;l!==void 0&&l>0?this.fetch=(c,d)=>{const h=new AbortController,f=setTimeout(()=>h.abort(),l),g=d==null?void 0:d.signal;if(g){if(g.aborted)return clearTimeout(f),u(c,d);const m=()=>{clearTimeout(f),h.abort()};return g.addEventListener("abort",m,{once:!0}),u(c,p5(p5({},d),{},{signal:h.signal})).finally(()=>{clearTimeout(f),g.removeEventListener("abort",m)})}return u(c,p5(p5({},d),{},{signal:h.signal})).finally(()=>clearTimeout(f))}:this.fetch=u}from(t){if(!t||typeof t!="string"||t.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new OU(new URL(`${this.url}/${t}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}schema(t){return new f7(this.url,{headers:this.headers,schema:t,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}rpc(t,r={},{head:o=!1,get:s=!1,count:l}={}){var i;let u;const c=new URL(`${this.url}/rpc/${t}`);let d;const h=m=>m!==null&&typeof m=="object"&&(!Array.isArray(m)||m.some(h)),f=o&&Object.values(r).some(h);f?(u="POST",d=r):o||s?(u=o?"HEAD":"GET",Object.entries(r).filter(([m,y])=>y!==void 0).map(([m,y])=>[m,Array.isArray(y)?`{${y.join(",")}}`:`${y}`]).forEach(([m,y])=>{c.searchParams.append(m,y)})):(u="POST",d=r);const g=new Headers(this.headers);return f?g.set("Prefer",l?`count=${l},return=minimal`:"return=minimal"):l&&g.set("Prefer",`count=${l}`),new Ju({method:u,url:c,headers:g,schema:this.schemaName,body:d,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch,urlLengthLimit:this.urlLengthLimit})}};class BU{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const r=globalThis.process;if(r){const o=r.versions;if(o&&o.node){const s=o.node,l=parseInt(s.replace(/^v/,"").split(".")[0]);return l>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${l} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${l} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let r=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(r+=`

Suggested solution: ${t.workaround}`),new Error(r)}static createWebSocket(t,r){const o=this.getWebSocketConstructor();return new o(t,r)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const $U="2.97.0",qU=`realtime-js/${$U}`,WU="1.0.0",p7="2.0.0",kw=p7,Mb=1e4,HU=1e3,GU=100;var Wc;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(Wc||(Wc={}));var na;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(na||(na={}));var Di;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(Di||(Di={}));var kb;(function(e){e.websocket="websocket"})(kb||(kb={}));var yd;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(yd||(yd={}));class VU{constructor(t){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=t??[]}encode(t,r){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return r(this._binaryEncodeUserBroadcastPush(t));let o=[t.join_ref,t.ref,t.topic,t.event,t.payload];return r(JSON.stringify(o))}_binaryEncodeUserBroadcastPush(t){var r;return this._isArrayBuffer((r=t.payload)===null||r===void 0?void 0:r.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var r,o;const s=(o=(r=t.payload)===null||r===void 0?void 0:r.payload)!==null&&o!==void 0?o:new ArrayBuffer(0);return this._encodeUserBroadcastPush(t,this.BINARY_ENCODING,s)}_encodeJsonUserBroadcastPush(t){var r,o;const s=(o=(r=t.payload)===null||r===void 0?void 0:r.payload)!==null&&o!==void 0?o:{},i=new TextEncoder().encode(JSON.stringify(s)).buffer;return this._encodeUserBroadcastPush(t,this.JSON_ENCODING,i)}_encodeUserBroadcastPush(t,r,o){var s,l;const i=t.topic,u=(s=t.ref)!==null&&s!==void 0?s:"",c=(l=t.join_ref)!==null&&l!==void 0?l:"",d=t.payload.event,h=this.allowedMetadataKeys?this._pick(t.payload,this.allowedMetadataKeys):{},f=Object.keys(h).length===0?"":JSON.stringify(h);if(c.length>255)throw new Error(`joinRef length ${c.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`ref length ${u.length} exceeds maximum of 255`);if(i.length>255)throw new Error(`topic length ${i.length} exceeds maximum of 255`);if(d.length>255)throw new Error(`userEvent length ${d.length} exceeds maximum of 255`);if(f.length>255)throw new Error(`metadata length ${f.length} exceeds maximum of 255`);const g=this.USER_BROADCAST_PUSH_META_LENGTH+c.length+u.length+i.length+d.length+f.length,m=new ArrayBuffer(this.HEADER_LENGTH+g);let y=new DataView(m),v=0;y.setUint8(v++,this.KINDS.userBroadcastPush),y.setUint8(v++,c.length),y.setUint8(v++,u.length),y.setUint8(v++,i.length),y.setUint8(v++,d.length),y.setUint8(v++,f.length),y.setUint8(v++,r),Array.from(c,S=>y.setUint8(v++,S.charCodeAt(0))),Array.from(u,S=>y.setUint8(v++,S.charCodeAt(0))),Array.from(i,S=>y.setUint8(v++,S.charCodeAt(0))),Array.from(d,S=>y.setUint8(v++,S.charCodeAt(0))),Array.from(f,S=>y.setUint8(v++,S.charCodeAt(0)));var b=new Uint8Array(m.byteLength+o.byteLength);return b.set(new Uint8Array(m),0),b.set(new Uint8Array(o),m.byteLength),b.buffer}decode(t,r){if(this._isArrayBuffer(t)){let o=this._binaryDecode(t);return r(o)}if(typeof t=="string"){const o=JSON.parse(t),[s,l,i,u,c]=o;return r({join_ref:s,ref:l,topic:i,event:u,payload:c})}return r({})}_binaryDecode(t){const r=new DataView(t),o=r.getUint8(0),s=new TextDecoder;switch(o){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(t,r,s)}}_decodeUserBroadcast(t,r,o){const s=r.getUint8(1),l=r.getUint8(2),i=r.getUint8(3),u=r.getUint8(4);let c=this.HEADER_LENGTH+4;const d=o.decode(t.slice(c,c+s));c=c+s;const h=o.decode(t.slice(c,c+l));c=c+l;const f=o.decode(t.slice(c,c+i));c=c+i;const g=t.slice(c,t.byteLength),m=u===this.JSON_ENCODING?JSON.parse(o.decode(g)):g,y={type:this.BROADCAST_EVENT,event:h,payload:m};return i>0&&(y.meta=JSON.parse(f)),{join_ref:null,ref:null,topic:d,event:this.BROADCAST_EVENT,payload:y}}_isArrayBuffer(t){var r;return t instanceof ArrayBuffer||((r=t==null?void 0:t.constructor)===null||r===void 0?void 0:r.name)==="ArrayBuffer"}_pick(t,r){return!t||typeof t!="object"?{}:Object.fromEntries(Object.entries(t).filter(([o])=>r.includes(o)))}}class m7{constructor(t,r){this.callback=t,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Qr;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(Qr||(Qr={}));const Rw=(e,t,r={})=>{var o;const s=(o=r.skipTypes)!==null&&o!==void 0?o:[];return t?Object.keys(t).reduce((l,i)=>(l[i]=UU(i,e,t,s),l),{}):{}},UU=(e,t,r,o)=>{const s=t.find(u=>u.name===e),l=s==null?void 0:s.type,i=r[e];return l&&!o.includes(l)?g7(l,i):Rb(i)},g7=(e,t)=>{if(e.charAt(0)==="_"){const r=e.slice(1,e.length);return ZU(t,r)}switch(e){case Qr.bool:return YU(t);case Qr.float4:case Qr.float8:case Qr.int2:case Qr.int4:case Qr.int8:case Qr.numeric:case Qr.oid:return KU(t);case Qr.json:case Qr.jsonb:return XU(t);case Qr.timestamp:return JU(t);case Qr.abstime:case Qr.date:case Qr.daterange:case Qr.int4range:case Qr.int8range:case Qr.money:case Qr.reltime:case Qr.text:case Qr.time:case Qr.timestamptz:case Qr.timetz:case Qr.tsrange:case Qr.tstzrange:return Rb(t);default:return Rb(t)}},Rb=e=>e,YU=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},KU=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},XU=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e},ZU=(e,t)=>{if(typeof e!="string")return e;const r=e.length-1,o=e[r];if(e[0]==="{"&&o==="}"){let l;const i=e.slice(1,r);try{l=JSON.parse("["+i+"]")}catch{l=i?i.split(","):[]}return l.map(u=>g7(t,u))}return e},JU=e=>typeof e=="string"?e.replace(" ","T"):e,y7=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class ox{constructor(t,r,o={},s=Mb){this.channel=t,this.event=r,this.payload=o,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,r){var o;return this._hasReceived(t)&&r((o=this.receivedResp)===null||o===void 0?void 0:o.response),this.recHooks.push({status:t,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:r}){this.recHooks.filter(o=>o.status===t).forEach(o=>o.callback(r))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var Aw;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(Aw||(Aw={}));class rp{constructor(t,r){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const o=(r==null?void 0:r.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(o.state,{},s=>{const{onJoin:l,onLeave:i,onSync:u}=this.caller;this.joinRef=this.channel._joinRef(),this.state=rp.syncState(this.state,s,l,i),this.pendingDiffs.forEach(c=>{this.state=rp.syncDiff(this.state,c,l,i)}),this.pendingDiffs=[],u()}),this.channel._on(o.diff,{},s=>{const{onJoin:l,onLeave:i,onSync:u}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=rp.syncDiff(this.state,s,l,i),u())}),this.onJoin((s,l,i)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:l,newPresences:i})}),this.onLeave((s,l,i)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:l,leftPresences:i})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,r,o,s){const l=this.cloneDeep(t),i=this.transformState(r),u={},c={};return this.map(l,(d,h)=>{i[d]||(c[d]=h)}),this.map(i,(d,h)=>{const f=l[d];if(f){const g=h.map(b=>b.presence_ref),m=f.map(b=>b.presence_ref),y=h.filter(b=>m.indexOf(b.presence_ref)<0),v=f.filter(b=>g.indexOf(b.presence_ref)<0);y.length>0&&(u[d]=y),v.length>0&&(c[d]=v)}else u[d]=h}),this.syncDiff(l,{joins:u,leaves:c},o,s)}static syncDiff(t,r,o,s){const{joins:l,leaves:i}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return o||(o=()=>{}),s||(s=()=>{}),this.map(l,(u,c)=>{var d;const h=(d=t[u])!==null&&d!==void 0?d:[];if(t[u]=this.cloneDeep(c),h.length>0){const f=t[u].map(m=>m.presence_ref),g=h.filter(m=>f.indexOf(m.presence_ref)<0);t[u].unshift(...g)}o(u,h,c)}),this.map(i,(u,c)=>{let d=t[u];if(!d)return;const h=c.map(f=>f.presence_ref);d=d.filter(f=>h.indexOf(f.presence_ref)<0),t[u]=d,s(u,d,c),d.length===0&&delete t[u]}),t}static map(t,r){return Object.getOwnPropertyNames(t).map(o=>r(o,t[o]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((r,o)=>{const s=t[o];return"metas"in s?r[o]=s.metas.map(l=>(l.presence_ref=l.phx_ref,delete l.phx_ref,delete l.phx_ref_prev,l)):r[o]=s,r},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var jw;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(jw||(jw={}));var op;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(op||(op={}));var Ul;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(Ul||(Ul={}));class hh{constructor(t,r={config:{}},o){var s,l;if(this.topic=t,this.params=r,this.socket=o,this.bindings={},this.state=na.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new ox(this,Di.join,this.params,this.timeout),this.rejoinTimer=new m7(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=na.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=na.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=na.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=na.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=na.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Di.reply,{},(i,u)=>{this._trigger(this._replyEventName(u),i)}),this.presence=new rp(this),this.broadcastEndpointURL=y7(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((l=(s=this.params.config)===null||s===void 0?void 0:s.broadcast)===null||l===void 0)&&l.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,r=this.timeout){var o,s,l;if(this.socket.isConnected()||this.socket.connect(),this.state==na.closed){const{config:{broadcast:i,presence:u,private:c}}=this.params,d=(s=(o=this.bindings.postgres_changes)===null||o===void 0?void 0:o.map(m=>m.filter))!==null&&s!==void 0?s:[],h=!!this.bindings[op.PRESENCE]&&this.bindings[op.PRESENCE].length>0||((l=this.params.config.presence)===null||l===void 0?void 0:l.enabled)===!0,f={},g={broadcast:i,presence:Object.assign(Object.assign({},u),{enabled:h}),postgres_changes:d,private:c};this.socket.accessTokenValue&&(f.access_token=this.socket.accessTokenValue),this._onError(m=>t==null?void 0:t(Ul.CHANNEL_ERROR,m)),this._onClose(()=>t==null?void 0:t(Ul.CLOSED)),this.updateJoinPayload(Object.assign({config:g},f)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:m})=>{var y;if(this.socket._isManualToken()||this.socket.setAuth(),m===void 0){t==null||t(Ul.SUBSCRIBED);return}else{const v=this.bindings.postgres_changes,b=(y=v==null?void 0:v.length)!==null&&y!==void 0?y:0,S=[];for(let C=0;C<b;C++){const k=v[C],{filter:{event:R,schema:j,table:T,filter:_}}=k,P=m&&m[C];if(P&&P.event===R&&hh.isFilterValueEqual(P.schema,j)&&hh.isFilterValueEqual(P.table,T)&&hh.isFilterValueEqual(P.filter,_))S.push(Object.assign(Object.assign({},k),{id:P.id}));else{this.unsubscribe(),this.state=na.errored,t==null||t(Ul.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=S,t&&t(Ul.SUBSCRIBED);return}}).receive("error",m=>{this.state=na.errored,t==null||t(Ul.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(m).join(", ")||"error")))}).receive("timeout",()=>{t==null||t(Ul.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,r={}){return await this.send({type:"presence",event:"track",payload:t},r.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,r,o){return this.state===na.joined&&t===op.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(t,r,o)}async httpSend(t,r,o={}){var s;if(r==null)return Promise.reject("Payload is required for httpSend()");const l={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(l.Authorization=`Bearer ${this.socket.accessTokenValue}`);const i={method:"POST",headers:l,body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:r,private:this.private}]})},u=await this._fetchWithTimeout(this.broadcastEndpointURL,i,(s=o.timeout)!==null&&s!==void 0?s:this.timeout);if(u.status===202)return{success:!0};let c=u.statusText;try{const d=await u.json();c=d.error||d.message||c}catch{}return Promise.reject(new Error(c))}async send(t,r={}){var o,s;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:l,payload:i}=t,u={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(u.Authorization=`Bearer ${this.socket.accessTokenValue}`);const c={method:"POST",headers:u,body:JSON.stringify({messages:[{topic:this.subTopic,event:l,payload:i,private:this.private}]})};try{const d=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(o=r.timeout)!==null&&o!==void 0?o:this.timeout);return await((s=d.body)===null||s===void 0?void 0:s.cancel()),d.ok?"ok":"error"}catch(d){return d.name==="AbortError"?"timed out":"error"}}else return new Promise(l=>{var i,u,c;const d=this._push(t.type,t,r.timeout||this.timeout);t.type==="broadcast"&&!(!((c=(u=(i=this.params)===null||i===void 0?void 0:i.config)===null||u===void 0?void 0:u.broadcast)===null||c===void 0)&&c.ack)&&l("ok"),d.receive("ok",()=>l("ok")),d.receive("error",()=>l("error")),d.receive("timeout",()=>l("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=na.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Di.close,"leave",this._joinRef())};this.joinPush.destroy();let o=null;return new Promise(s=>{o=new ox(this,Di.leave,{},t),o.receive("ok",()=>{r(),s("ok")}).receive("timeout",()=>{r(),s("timed out")}).receive("error",()=>{s("error")}),o.send(),this._canPush()||o.trigger("ok",{})}).finally(()=>{o==null||o.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=na.closed,this.bindings={}}async _fetchWithTimeout(t,r,o){const s=new AbortController,l=setTimeout(()=>s.abort(),o),i=await this.socket.fetch(t,Object.assign(Object.assign({},r),{signal:s.signal}));return clearTimeout(l),i}_push(t,r,o=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new ox(this,t,r,o);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>GU){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(t,r,o){return r}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,r,o){var s,l;const i=t.toLocaleLowerCase(),{close:u,error:c,leave:d,join:h}=Di;if(o&&[u,c,d,h].indexOf(i)>=0&&o!==this._joinRef())return;let g=this._onMessage(i,r,o);if(r&&!g)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(m=>{var y,v,b;return((y=m.filter)===null||y===void 0?void 0:y.event)==="*"||((b=(v=m.filter)===null||v===void 0?void 0:v.event)===null||b===void 0?void 0:b.toLocaleLowerCase())===i}).map(m=>m.callback(g,o)):(l=this.bindings[i])===null||l===void 0||l.filter(m=>{var y,v,b,S,C,k;if(["broadcast","presence","postgres_changes"].includes(i))if("id"in m){const R=m.id,j=(y=m.filter)===null||y===void 0?void 0:y.event;return R&&((v=r.ids)===null||v===void 0?void 0:v.includes(R))&&(j==="*"||(j==null?void 0:j.toLocaleLowerCase())===((b=r.data)===null||b===void 0?void 0:b.type.toLocaleLowerCase()))}else{const R=(C=(S=m==null?void 0:m.filter)===null||S===void 0?void 0:S.event)===null||C===void 0?void 0:C.toLocaleLowerCase();return R==="*"||R===((k=r==null?void 0:r.event)===null||k===void 0?void 0:k.toLocaleLowerCase())}else return m.type.toLocaleLowerCase()===i}).map(m=>{if(typeof g=="object"&&"ids"in g){const y=g.data,{schema:v,table:b,commit_timestamp:S,type:C,errors:k}=y;g=Object.assign(Object.assign({},{schema:v,table:b,commit_timestamp:S,eventType:C,new:{},old:{},errors:k}),this._getPayloadRecords(y))}m.callback(g,o)})}_isClosed(){return this.state===na.closed}_isJoined(){return this.state===na.joined}_isJoining(){return this.state===na.joining}_isLeaving(){return this.state===na.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,r,o){const s=t.toLocaleLowerCase(),l={type:s,filter:r,callback:o};return this.bindings[s]?this.bindings[s].push(l):this.bindings[s]=[l],this}_off(t,r){const o=t.toLocaleLowerCase();return this.bindings[o]&&(this.bindings[o]=this.bindings[o].filter(s=>{var l;return!(((l=s.type)===null||l===void 0?void 0:l.toLocaleLowerCase())===o&&hh.isEqual(s.filter,r))})),this}static isEqual(t,r){if(Object.keys(t).length!==Object.keys(r).length)return!1;for(const o in t)if(t[o]!==r[o])return!1;return!0}static isFilterValueEqual(t,r){return(t??void 0)===(r??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(Di.close,{},t)}_onError(t){this._on(Di.error,{},r=>t(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=na.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const r={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(r.new=Rw(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(r.old=Rw(t.columns,t.old_record)),r}}const ax=()=>{},m5={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},QU=[1e3,2e3,5e3,1e4],eY=1e4,tY=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class nY{constructor(t,r){var o;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Mb,this.transport=null,this.heartbeatIntervalMs=m5.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=ax,this.ref=0,this.reconnectTimer=null,this.vsn=kw,this.logger=ax,this.conn=null,this.sendBuffer=[],this.serializer=new VU,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=s=>s?(...l)=>s(...l):(...l)=>fetch(...l),!(!((o=r==null?void 0:r.params)===null||o===void 0)&&o.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${t}/${kb.websocket}`,this.httpEndpoint=y7(t),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r==null?void 0:r.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=BU.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const r=t.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const o=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(o),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,r??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const r=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const t=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,r,o){this.logger(t,r,o)}connectionState(){switch(this.conn&&this.conn.readyState){case Wc.connecting:return yd.Connecting;case Wc.open:return yd.Open;case Wc.closing:return yd.Closing;default:return yd.Closed}}isConnected(){return this.connectionState()===yd.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,r={config:{}}){const o=`realtime:${t}`,s=this.getChannels().find(l=>l.topic===o);if(s)return s;{const l=new hh(`realtime:${t}`,r,this);return this.channels.push(l),l}}push(t){const{topic:r,event:o,payload:s,ref:l}=t,i=()=>{this.encode(t,u=>{var c;(c=this.conn)===null||c===void 0||c.send(u)})};this.log("push",`${r} ${o} (${l})`,s),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(r){this.log("error","error in heartbeat callback",r)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(r){this.log("error","error in heartbeat callback",r)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(HU,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},m5.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(r){this.log("error","error in heartbeat callback",r)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let r=this.channels.find(o=>o.topic===t&&(o._isJoined()||o._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${t}"`),r.unsubscribe())}_remove(t){this.channels=this.channels.filter(r=>r.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,r=>{if(r.topic==="phoenix"&&r.event==="phx_reply"&&r.ref&&r.ref===this.pendingHeartbeatRef){const d=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(r.payload.status==="ok"?"ok":"error",d)}catch(h){this.log("error","error in heartbeat callback",h)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:o,event:s,payload:l,ref:i}=r,u=i?`(${i})`:"",c=l.status||"";this.log("receive",`${c} ${o} ${s} ${u}`.trim(),l),this.channels.filter(d=>d._isMember(o)).forEach(d=>d._trigger(s,l,i)),this._triggerStateCallbacks("message",r)})}_clearTimer(t){var r;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t),this.conn.readyState===Wc.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===Wc.open||this.conn.readyState===Wc.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(r=>{this.log("error","error waiting for auth on connect",r),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this._terminateWorker()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(t){var r;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t);try{this.heartbeatCallback("error")}catch(r){this.log("error","error in heartbeat callback",r)}}_triggerChanError(){this.channels.forEach(t=>t._trigger(Di.error))}_appendParams(t,r){if(Object.keys(r).length===0)return t;const o=t.match(/\?/)?"&":"?",s=new URLSearchParams(r);return`${t}${o}${s}`}_workerObjectUrl(t){let r;if(t)r=t;else{const o=new Blob([tY],{type:"application/javascript"});r=URL.createObjectURL(o)}return r}_setConnectionState(t,r=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(t=null){let r,o=!1;if(t)r=t,o=!0;else if(this.accessToken)try{r=await this.accessToken()}catch(s){this.log("error","Error fetching access token from callback",s),r=this.accessTokenValue}else r=this.accessTokenValue;o?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(s=>{const l={access_token:r,version:qU};r&&s.updateJoinPayload(l),s.joinedOnce&&s._isJoined()&&s._push(Di.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this._isManualToken()||this.setAuth().catch(r=>{this.log("error",`Error setting auth in ${t}`,r)})}_triggerStateCallbacks(t,r){try{this.stateChangeCallbacks[t].forEach(o=>{try{o(r)}catch(s){this.log("error",`error in ${t} callback`,s)}})}catch(o){this.log("error",`error triggering ${t} callbacks`,o)}}_setupReconnectionTimer(){this.reconnectTimer=new m7(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},m5.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var r,o,s,l,i,u,c,d,h,f,g,m;switch(this.transport=(r=t==null?void 0:t.transport)!==null&&r!==void 0?r:null,this.timeout=(o=t==null?void 0:t.timeout)!==null&&o!==void 0?o:Mb,this.heartbeatIntervalMs=(s=t==null?void 0:t.heartbeatIntervalMs)!==null&&s!==void 0?s:m5.HEARTBEAT_INTERVAL,this.worker=(l=t==null?void 0:t.worker)!==null&&l!==void 0?l:!1,this.accessToken=(i=t==null?void 0:t.accessToken)!==null&&i!==void 0?i:null,this.heartbeatCallback=(u=t==null?void 0:t.heartbeatCallback)!==null&&u!==void 0?u:ax,this.vsn=(c=t==null?void 0:t.vsn)!==null&&c!==void 0?c:kw,t!=null&&t.params&&(this.params=t.params),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(d=t==null?void 0:t.reconnectAfterMs)!==null&&d!==void 0?d:(y=>QU[y-1]||eY),this.vsn){case WU:this.encode=(h=t==null?void 0:t.encode)!==null&&h!==void 0?h:((y,v)=>v(JSON.stringify(y))),this.decode=(f=t==null?void 0:t.decode)!==null&&f!==void 0?f:((y,v)=>v(JSON.parse(y)));break;case p7:this.encode=(g=t==null?void 0:t.encode)!==null&&g!==void 0?g:this.serializer.encode.bind(this.serializer),this.decode=(m=t==null?void 0:t.decode)!==null&&m!==void 0?m:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t==null?void 0:t.workerUrl}}}var vp=class extends Error{constructor(e,t){var r;super(e),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown=t.icebergType==="CommitStateUnknownException"||[500,502,504].includes(t.status)&&((r=t.icebergType)==null?void 0:r.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function rY(e,t,r){const o=new URL(t,e);if(r)for(const[s,l]of Object.entries(r))l!==void 0&&o.searchParams.set(s,l);return o.toString()}async function oY(e){return!e||e.type==="none"?{}:e.type==="bearer"?{Authorization:`Bearer ${e.token}`}:e.type==="header"?{[e.name]:e.value}:e.type==="custom"?await e.getHeaders():{}}function aY(e){const t=e.fetchImpl??globalThis.fetch;return{async request({method:r,path:o,query:s,body:l,headers:i}){const u=rY(e.baseUrl,o,s),c=await oY(e.auth),d=await t(u,{method:r,headers:{...l?{"Content-Type":"application/json"}:{},...c,...i},body:l?JSON.stringify(l):void 0}),h=await d.text(),f=(d.headers.get("content-type")||"").includes("application/json"),g=f&&h?JSON.parse(h):h;if(!d.ok){const m=f?g:void 0,y=m==null?void 0:m.error;throw new vp((y==null?void 0:y.message)??`Request failed with status ${d.status}`,{status:d.status,icebergType:y==null?void 0:y.type,icebergCode:y==null?void 0:y.code,details:m})}return{status:d.status,headers:d.headers,data:g}}}}function g5(e){return e.join("")}var sY=class{constructor(e,t=""){this.client=e,this.prefix=t}async listNamespaces(e){const t=e?{parent:g5(e.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(o=>({namespace:o}))}async createNamespace(e,t){const r={namespace:e.namespace,properties:t==null?void 0:t.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:r})).data}async dropNamespace(e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${g5(e.namespace)}`})}async loadNamespaceMetadata(e){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${g5(e.namespace)}`})).data.properties}}async namespaceExists(e){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${g5(e.namespace)}`}),!0}catch(t){if(t instanceof vp&&t.status===404)return!1;throw t}}async createNamespaceIfNotExists(e,t){try{return await this.createNamespace(e,t)}catch(r){if(r instanceof vp&&r.status===409)return;throw r}}};function Pu(e){return e.join("")}var iY=class{constructor(e,t="",r){this.client=e,this.prefix=t,this.accessDelegation=r}async listTables(e){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Pu(e.namespace)}/tables`})).data.identifiers}async createTable(e,t){const r={};return this.accessDelegation&&(r["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Pu(e.namespace)}/tables`,body:t,headers:r})).data.metadata}async updateTable(e,t){const r=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Pu(e.namespace)}/tables/${e.name}`,body:t});return{"metadata-location":r.data["metadata-location"],metadata:r.data.metadata}}async dropTable(e,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Pu(e.namespace)}/tables/${e.name}`,query:{purgeRequested:String((t==null?void 0:t.purge)??!1)}})}async loadTable(e){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Pu(e.namespace)}/tables/${e.name}`,headers:t})).data.metadata}async tableExists(e){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Pu(e.namespace)}/tables/${e.name}`,headers:t}),!0}catch(r){if(r instanceof vp&&r.status===404)return!1;throw r}}async createTableIfNotExists(e,t){try{return await this.createTable(e,t)}catch(r){if(r instanceof vp&&r.status===409)return await this.loadTable({namespace:e.namespace,name:t.name});throw r}}},lY=class{constructor(e){var o;let t="v1";e.catalogName&&(t+=`/${e.catalogName}`);const r=e.baseUrl.endsWith("/")?e.baseUrl:`${e.baseUrl}/`;this.client=aY({baseUrl:r,auth:e.auth,fetchImpl:e.fetch}),this.accessDelegation=(o=e.accessDelegation)==null?void 0:o.join(","),this.namespaceOps=new sY(this.client,t),this.tableOps=new iY(this.client,t,this.accessDelegation)}async listNamespaces(e){return this.namespaceOps.listNamespaces(e)}async createNamespace(e,t){return this.namespaceOps.createNamespace(e,t)}async dropNamespace(e){await this.namespaceOps.dropNamespace(e)}async loadNamespaceMetadata(e){return this.namespaceOps.loadNamespaceMetadata(e)}async listTables(e){return this.tableOps.listTables(e)}async createTable(e,t){return this.tableOps.createTable(e,t)}async updateTable(e,t){return this.tableOps.updateTable(e,t)}async dropTable(e,t){await this.tableOps.dropTable(e,t)}async loadTable(e){return this.tableOps.loadTable(e)}async namespaceExists(e){return this.namespaceOps.namespaceExists(e)}async tableExists(e){return this.tableOps.tableExists(e)}async createNamespaceIfNotExists(e,t){return this.namespaceOps.createNamespaceIfNotExists(e,t)}async createTableIfNotExists(e,t){return this.tableOps.createTableIfNotExists(e,t)}},Vg=class extends Error{constructor(e,t="storage",r,o){super(e),this.__isStorageError=!0,this.namespace=t,this.name=t==="vectors"?"StorageVectorsError":"StorageError",this.status=r,this.statusCode=o}};function Ug(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}var y5=class extends Vg{constructor(e,t,r,o="storage"){super(e,o,t,r),this.name=o==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},x7=class extends Vg{constructor(e,t,r="storage"){super(e,r),this.name=r==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=t}};const cY=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),dY=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},Ab=e=>{if(Array.isArray(e))return e.map(r=>Ab(r));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([r,o])=>{const s=r.replace(/([-_][a-z])/gi,l=>l.toUpperCase().replace(/[-_]/g,""));t[s]=Ab(o)}),t},uY=e=>!e||typeof e!="string"||e.length===0||e.length>100||e.trim()!==e||e.includes("/")||e.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(e);function Sp(e){"@babel/helpers - typeof";return Sp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Sp(e)}function hY(e,t){if(Sp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var o=r.call(e,t);if(Sp(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function fY(e){var t=hY(e,"string");return Sp(t)=="symbol"?t:t+""}function pY(e,t,r){return(t=fY(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ew(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,o)}return r}function Qn(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Ew(Object(r),!0).forEach(function(o){pY(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ew(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}const Tw=e=>{var t;return e.msg||e.message||e.error_description||(typeof e.error=="string"?e.error:(t=e.error)===null||t===void 0?void 0:t.message)||JSON.stringify(e)},mY=async(e,t,r,o)=>{if(e&&typeof e=="object"&&"status"in e&&"ok"in e&&typeof e.status=="number"&&!(r!=null&&r.noResolveJson)){const s=e,l=s.status||500;if(typeof s.json=="function")s.json().then(i=>{const u=(i==null?void 0:i.statusCode)||(i==null?void 0:i.code)||l+"";t(new y5(Tw(i),l,u,o))}).catch(()=>{if(o==="vectors"){const i=l+"";t(new y5(s.statusText||`HTTP ${l} error`,l,i,o))}else{const i=l+"";t(new y5(s.statusText||`HTTP ${l} error`,l,i,o))}});else{const i=l+"";t(new y5(s.statusText||`HTTP ${l} error`,l,i,o))}}else t(new x7(Tw(e),e,o))},gY=(e,t,r,o)=>{const s={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"||e==="HEAD"||!o?Qn(Qn({},s),r):(dY(o)?(s.headers=Qn({"Content-Type":"application/json"},t==null?void 0:t.headers),s.body=JSON.stringify(o)):s.body=o,t!=null&&t.duplex&&(s.duplex=t.duplex),Qn(Qn({},s),r))};async function Ef(e,t,r,o,s,l,i){return new Promise((u,c)=>{e(r,gY(t,o,s,l)).then(d=>{if(!d.ok)throw d;if(o!=null&&o.noResolveJson)return d;if(i==="vectors"){const h=d.headers.get("content-type");if(d.headers.get("content-length")==="0"||d.status===204)return{};if(!h||!h.includes("application/json"))return{}}return d.json()}).then(d=>u(d)).catch(d=>mY(d,c,o,i))})}function b7(e="storage"){return{get:async(t,r,o,s)=>Ef(t,"GET",r,o,s,void 0,e),post:async(t,r,o,s,l)=>Ef(t,"POST",r,s,l,o,e),put:async(t,r,o,s,l)=>Ef(t,"PUT",r,s,l,o,e),head:async(t,r,o,s)=>Ef(t,"HEAD",r,Qn(Qn({},o),{},{noResolveJson:!0}),s,void 0,e),remove:async(t,r,o,s,l)=>Ef(t,"DELETE",r,s,l,o,e)}}const yY=b7("storage"),{get:wp,post:_i,put:jb,head:xY,remove:zv}=yY,Vs=b7("vectors");var Dh=class{constructor(e,t={},r,o="storage"){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.fetch=cY(r),this.namespace=o}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Qn(Qn({},this.headers),{},{[e]:t}),this}async handleOperation(e){var t=this;try{return{data:await e(),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Ug(r))return{data:null,error:r};throw r}}},bY=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}async execute(){var e=this;try{return{data:(await e.downloadFn()).body,error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Ug(t))return{data:null,error:t};throw t}}};let v7;v7=Symbol.toStringTag;var vY=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[v7]="BlobDownloadBuilder",this.promise=null}asStream(){return new bY(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var e=this;try{return{data:await(await e.downloadFn()).blob(),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Ug(t))return{data:null,error:t};throw t}}};const SY={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Iw={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var wY=class extends Dh{constructor(e,t={},r,o){super(e,t,o,"storage"),this.bucketId=r}async uploadOrUpdate(e,t,r,o){var s=this;return s.handleOperation(async()=>{let l;const i=Qn(Qn({},Iw),o);let u=Qn(Qn({},s.headers),e==="POST"&&{"x-upsert":String(i.upsert)});const c=i.metadata;typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",i.cacheControl),c&&l.append("metadata",s.encodeMetadata(c)),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.has("cacheControl")||l.append("cacheControl",i.cacheControl),c&&!l.has("metadata")&&l.append("metadata",s.encodeMetadata(c))):(l=r,u["cache-control"]=`max-age=${i.cacheControl}`,u["content-type"]=i.contentType,c&&(u["x-metadata"]=s.toBase64(s.encodeMetadata(c))),(typeof ReadableStream<"u"&&l instanceof ReadableStream||l&&typeof l=="object"&&"pipe"in l&&typeof l.pipe=="function")&&!i.duplex&&(i.duplex="half")),o!=null&&o.headers&&(u=Qn(Qn({},u),o.headers));const d=s._removeEmptyFolders(t),h=s._getFinalPath(d),f=await(e=="PUT"?jb:_i)(s.fetch,`${s.url}/object/${h}`,l,Qn({headers:u},i!=null&&i.duplex?{duplex:i.duplex}:{}));return{path:d,id:f.Id,fullPath:f.Key}})}async upload(e,t,r){return this.uploadOrUpdate("POST",e,t,r)}async uploadToSignedUrl(e,t,r,o){var s=this;const l=s._removeEmptyFolders(e),i=s._getFinalPath(l),u=new URL(s.url+`/object/upload/sign/${i}`);return u.searchParams.set("token",t),s.handleOperation(async()=>{let c;const d=Qn({upsert:Iw.upsert},o),h=Qn(Qn({},s.headers),{"x-upsert":String(d.upsert)});return typeof Blob<"u"&&r instanceof Blob?(c=new FormData,c.append("cacheControl",d.cacheControl),c.append("",r)):typeof FormData<"u"&&r instanceof FormData?(c=r,c.append("cacheControl",d.cacheControl)):(c=r,h["cache-control"]=`max-age=${d.cacheControl}`,h["content-type"]=d.contentType),{path:l,fullPath:(await jb(s.fetch,u.toString(),c,{headers:h})).Key}})}async createSignedUploadUrl(e,t){var r=this;return r.handleOperation(async()=>{let o=r._getFinalPath(e);const s=Qn({},r.headers);t!=null&&t.upsert&&(s["x-upsert"]="true");const l=await _i(r.fetch,`${r.url}/object/upload/sign/${o}`,{},{headers:s}),i=new URL(r.url+l.url),u=i.searchParams.get("token");if(!u)throw new Vg("No token returned by API");return{signedUrl:i.toString(),path:e,token:u}})}async update(e,t,r){return this.uploadOrUpdate("PUT",e,t,r)}async move(e,t,r){var o=this;return o.handleOperation(async()=>await _i(o.fetch,`${o.url}/object/move`,{bucketId:o.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:o.headers}))}async copy(e,t,r){var o=this;return o.handleOperation(async()=>({path:(await _i(o.fetch,`${o.url}/object/copy`,{bucketId:o.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:o.headers})).Key}))}async createSignedUrl(e,t,r){var o=this;return o.handleOperation(async()=>{let s=o._getFinalPath(e),l=await _i(o.fetch,`${o.url}/object/sign/${s}`,Qn({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:o.headers});const i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{signedUrl:encodeURI(`${o.url}${l.signedURL}${i}`)}})}async createSignedUrls(e,t,r){var o=this;return o.handleOperation(async()=>{const s=await _i(o.fetch,`${o.url}/object/sign/${o.bucketId}`,{expiresIn:t,paths:e},{headers:o.headers}),l=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return s.map(i=>Qn(Qn({},i),{},{signedUrl:i.signedURL?encodeURI(`${o.url}${i.signedURL}${l}`):null}))})}download(e,t,r){const o=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),l=s?`?${s}`:"",i=this._getFinalPath(e),u=()=>wp(this.fetch,`${this.url}/${o}/${i}${l}`,{headers:this.headers,noResolveJson:!0},r);return new vY(u,this.shouldThrowOnError)}async info(e){var t=this;const r=t._getFinalPath(e);return t.handleOperation(async()=>Ab(await wp(t.fetch,`${t.url}/object/info/${r}`,{headers:t.headers})))}async exists(e){var t=this;const r=t._getFinalPath(e);try{return await xY(t.fetch,`${t.url}/object/${r}`,{headers:t.headers}),{data:!0,error:null}}catch(o){if(t.shouldThrowOnError)throw o;if(Ug(o)&&o instanceof x7){const s=o.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:o}}throw o}}getPublicUrl(e,t){const r=this._getFinalPath(e),o=[],s=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";s!==""&&o.push(s);const l=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});i!==""&&o.push(i);let u=o.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${r}${u}`)}}}async remove(e){var t=this;return t.handleOperation(async()=>await zv(t.fetch,`${t.url}/object/${t.bucketId}`,{prefixes:e},{headers:t.headers}))}async list(e,t,r){var o=this;return o.handleOperation(async()=>{const s=Qn(Qn(Qn({},SY),t),{},{prefix:e||""});return await _i(o.fetch,`${o.url}/object/list/${o.bucketId}`,s,{headers:o.headers},r)})}async listV2(e,t){var r=this;return r.handleOperation(async()=>{const o=Qn({},e);return await _i(r.fetch,`${r.url}/object/list-v2/${r.bucketId}`,o,{headers:r.headers},t)})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}};const CY="2.97.0",Op={"X-Client-Info":`storage-js/${CY}`};var MY=class extends Dh{constructor(e,t={},r,o){const s=new URL(e);o!=null&&o.useNewHostname&&/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase."));const l=s.href.replace(/\/$/,""),i=Qn(Qn({},Op),t);super(l,i,r,"storage")}async listBuckets(e){var t=this;return t.handleOperation(async()=>{const r=t.listBucketOptionsToQueryString(e);return await wp(t.fetch,`${t.url}/bucket${r}`,{headers:t.headers})})}async getBucket(e){var t=this;return t.handleOperation(async()=>await wp(t.fetch,`${t.url}/bucket/${e}`,{headers:t.headers}))}async createBucket(e,t={public:!1}){var r=this;return r.handleOperation(async()=>await _i(r.fetch,`${r.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:r.headers}))}async updateBucket(e,t){var r=this;return r.handleOperation(async()=>await jb(r.fetch,`${r.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:r.headers}))}async emptyBucket(e){var t=this;return t.handleOperation(async()=>await _i(t.fetch,`${t.url}/bucket/${e}/empty`,{},{headers:t.headers}))}async deleteBucket(e){var t=this;return t.handleOperation(async()=>await zv(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}))}listBucketOptionsToQueryString(e){const t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},kY=class extends Dh{constructor(e,t={},r){const o=e.replace(/\/$/,""),s=Qn(Qn({},Op),t);super(o,s,r,"storage")}async createBucket(e){var t=this;return t.handleOperation(async()=>await _i(t.fetch,`${t.url}/bucket`,{name:e},{headers:t.headers}))}async listBuckets(e){var t=this;return t.handleOperation(async()=>{const r=new URLSearchParams;(e==null?void 0:e.limit)!==void 0&&r.set("limit",e.limit.toString()),(e==null?void 0:e.offset)!==void 0&&r.set("offset",e.offset.toString()),e!=null&&e.sortColumn&&r.set("sortColumn",e.sortColumn),e!=null&&e.sortOrder&&r.set("sortOrder",e.sortOrder),e!=null&&e.search&&r.set("search",e.search);const o=r.toString(),s=o?`${t.url}/bucket?${o}`:`${t.url}/bucket`;return await wp(t.fetch,s,{headers:t.headers})})}async deleteBucket(e){var t=this;return t.handleOperation(async()=>await zv(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}))}from(e){var t=this;if(!uY(e))throw new Vg("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const r=new lY({baseUrl:this.url,catalogName:e,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),o=this.shouldThrowOnError;return new Proxy(r,{get(s,l){const i=s[l];return typeof i!="function"?i:async(...u)=>{try{return{data:await i.apply(s,u),error:null}}catch(c){if(o)throw c;return{data:null,error:c}}}}})}},RY=class extends Dh{constructor(e,t={},r){const o=e.replace(/\/$/,""),s=Qn(Qn({},Op),{},{"Content-Type":"application/json"},t);super(o,s,r,"vectors")}async createIndex(e){var t=this;return t.handleOperation(async()=>await Vs.post(t.fetch,`${t.url}/CreateIndex`,e,{headers:t.headers})||{})}async getIndex(e,t){var r=this;return r.handleOperation(async()=>await Vs.post(r.fetch,`${r.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:r.headers}))}async listIndexes(e){var t=this;return t.handleOperation(async()=>await Vs.post(t.fetch,`${t.url}/ListIndexes`,e,{headers:t.headers}))}async deleteIndex(e,t){var r=this;return r.handleOperation(async()=>await Vs.post(r.fetch,`${r.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:r.headers})||{})}},AY=class extends Dh{constructor(e,t={},r){const o=e.replace(/\/$/,""),s=Qn(Qn({},Op),{},{"Content-Type":"application/json"},t);super(o,s,r,"vectors")}async putVectors(e){var t=this;if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return t.handleOperation(async()=>await Vs.post(t.fetch,`${t.url}/PutVectors`,e,{headers:t.headers})||{})}async getVectors(e){var t=this;return t.handleOperation(async()=>await Vs.post(t.fetch,`${t.url}/GetVectors`,e,{headers:t.headers}))}async listVectors(e){var t=this;if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return t.handleOperation(async()=>await Vs.post(t.fetch,`${t.url}/ListVectors`,e,{headers:t.headers}))}async queryVectors(e){var t=this;return t.handleOperation(async()=>await Vs.post(t.fetch,`${t.url}/QueryVectors`,e,{headers:t.headers}))}async deleteVectors(e){var t=this;if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return t.handleOperation(async()=>await Vs.post(t.fetch,`${t.url}/DeleteVectors`,e,{headers:t.headers})||{})}},jY=class extends Dh{constructor(e,t={},r){const o=e.replace(/\/$/,""),s=Qn(Qn({},Op),{},{"Content-Type":"application/json"},t);super(o,s,r,"vectors")}async createBucket(e){var t=this;return t.handleOperation(async()=>await Vs.post(t.fetch,`${t.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{})}async getBucket(e){var t=this;return t.handleOperation(async()=>await Vs.post(t.fetch,`${t.url}/GetVectorBucket`,{vectorBucketName:e},{headers:t.headers}))}async listBuckets(e={}){var t=this;return t.handleOperation(async()=>await Vs.post(t.fetch,`${t.url}/ListVectorBuckets`,e,{headers:t.headers}))}async deleteBucket(e){var t=this;return t.handleOperation(async()=>await Vs.post(t.fetch,`${t.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{})}},EY=class extends jY{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new TY(this.url,this.headers,e,this.fetch)}async createBucket(e){var t=()=>super.createBucket,r=this;return t().call(r,e)}async getBucket(e){var t=()=>super.getBucket,r=this;return t().call(r,e)}async listBuckets(e={}){var t=()=>super.listBuckets,r=this;return t().call(r,e)}async deleteBucket(e){var t=()=>super.deleteBucket,r=this;return t().call(r,e)}},TY=class extends RY{constructor(e,t,r,o){super(e,t,o),this.vectorBucketName=r}async createIndex(e){var t=()=>super.createIndex,r=this;return t().call(r,Qn(Qn({},e),{},{vectorBucketName:r.vectorBucketName}))}async listIndexes(e={}){var t=()=>super.listIndexes,r=this;return t().call(r,Qn(Qn({},e),{},{vectorBucketName:r.vectorBucketName}))}async getIndex(e){var t=()=>super.getIndex,r=this;return t().call(r,r.vectorBucketName,e)}async deleteIndex(e){var t=()=>super.deleteIndex,r=this;return t().call(r,r.vectorBucketName,e)}index(e){return new IY(this.url,this.headers,this.vectorBucketName,e,this.fetch)}},IY=class extends AY{constructor(e,t,r,o,s){super(e,t,s),this.vectorBucketName=r,this.indexName=o}async putVectors(e){var t=()=>super.putVectors,r=this;return t().call(r,Qn(Qn({},e),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async getVectors(e){var t=()=>super.getVectors,r=this;return t().call(r,Qn(Qn({},e),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async listVectors(e={}){var t=()=>super.listVectors,r=this;return t().call(r,Qn(Qn({},e),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async queryVectors(e){var t=()=>super.queryVectors,r=this;return t().call(r,Qn(Qn({},e),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async deleteVectors(e){var t=()=>super.deleteVectors,r=this;return t().call(r,Qn(Qn({},e),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}},PY=class extends MY{constructor(e,t={},r,o){super(e,t,r,o)}from(e){return new wY(this.url,this.headers,e,this.fetch)}get vectors(){return new EY(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new kY(this.url+"/iceberg",this.headers,this.fetch)}};const S7="2.97.0",Qu=30*1e3,Eb=3,sx=Eb*Qu,FY="http://localhost:9999",NY="supabase.auth.token",OY={"X-Client-Info":`gotrue-js/${S7}`},Tb="X-Supabase-Api-Version",w7={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},_Y=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,DY=600*1e3;class Cp extends Error{constructor(t,r,o){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=o}}function Ln(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class LY extends Cp{constructor(t,r,o){super(t,r,o),this.name="AuthApiError",this.status=r,this.code=o}}function zY(e){return Ln(e)&&e.name==="AuthApiError"}class xd extends Cp{constructor(t,r){super(t),this.name="AuthUnknownError",this.originalError=r}}class rc extends Cp{constructor(t,r,o,s){super(t,o,s),this.name=r,this.status=o}}class $s extends rc{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function ix(e){return Ln(e)&&e.name==="AuthSessionMissingError"}class Fu extends rc{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class x5 extends rc{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class b5 extends rc{constructor(t,r=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function BY(e){return Ln(e)&&e.name==="AuthImplicitGrantRedirectError"}class Pw extends rc{constructor(t,r=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class $Y extends rc{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Ib extends rc{constructor(t,r){super(t,"AuthRetryableFetchError",r,void 0)}}function lx(e){return Ln(e)&&e.name==="AuthRetryableFetchError"}class Fw extends rc{constructor(t,r,o){super(t,"AuthWeakPasswordError",r,"weak_password"),this.reasons=o}}class Pb extends rc{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const Sg="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Nw=` 	
\r=`.split(""),qY=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<Nw.length;t+=1)e[Nw[t].charCodeAt(0)]=-2;for(let t=0;t<Sg.length;t+=1)e[Sg[t].charCodeAt(0)]=t;return e})();function Ow(e,t,r){if(e!==null)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const o=t.queue>>t.queuedBits-6&63;r(Sg[o]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const o=t.queue>>t.queuedBits-6&63;r(Sg[o]),t.queuedBits-=6}}function C7(e,t,r){const o=qY[e];if(o>-1)for(t.queue=t.queue<<6|o,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(o===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function _w(e){const t=[],r=i=>{t.push(String.fromCodePoint(i))},o={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},l=i=>{GY(i,o,r)};for(let i=0;i<e.length;i+=1)C7(e.charCodeAt(i),s,l);return t.join("")}function WY(e,t){if(e<=127){t(e);return}else if(e<=2047){t(192|e>>6),t(128|e&63);return}else if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|e&63);return}else if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function HY(e,t){for(let r=0;r<e.length;r+=1){let o=e.charCodeAt(r);if(o>55295&&o<=56319){const s=(o-55296)*1024&65535;o=(e.charCodeAt(r+1)-56320&65535|s)+65536,r+=1}WY(o,t)}}function GY(e,t,r){if(t.utf8seq===0){if(e<=127){r(e);return}for(let o=1;o<6;o+=1)if((e>>7-o&1)===0){t.utf8seq=o;break}if(t.utf8seq===2)t.codepoint=e&31;else if(t.utf8seq===3)t.codepoint=e&15;else if(t.utf8seq===4)t.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|e&63,t.utf8seq-=1,t.utf8seq===0&&r(t.codepoint)}}function wh(e){const t=[],r={queue:0,queuedBits:0},o=s=>{t.push(s)};for(let s=0;s<e.length;s+=1)C7(e.charCodeAt(s),r,o);return new Uint8Array(t)}function VY(e){const t=[];return HY(e,r=>t.push(r)),new Uint8Array(t)}function Cd(e){const t=[],r={queue:0,queuedBits:0},o=s=>{t.push(s)};return e.forEach(s=>Ow(s,r,o)),Ow(null,r,o),t.join("")}function UY(e){return Math.round(Date.now()/1e3)+e}function YY(){return Symbol("auth-callback")}const ja=()=>typeof window<"u"&&typeof document<"u",X0={tested:!1,writable:!1},M7=()=>{if(!ja())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(X0.tested)return X0.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),X0.tested=!0,X0.writable=!0}catch{X0.tested=!0,X0.writable=!1}return X0.writable};function KY(e){const t={},r=new URL(e);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((s,l)=>{t[l]=s})}catch{}return r.searchParams.forEach((o,s)=>{t[s]=o}),t}const k7=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),XY=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",eh=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},Z0=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch{return r}},ka=async(e,t)=>{await e.removeItem(t)};class Yg{constructor(){this.promise=new Yg.promiseConstructor((t,r)=>{this.resolve=t,this.reject=r})}}Yg.promiseConstructor=Promise;function v5(e){const t=e.split(".");if(t.length!==3)throw new Pb("Invalid JWT structure");for(let o=0;o<t.length;o++)if(!_Y.test(t[o]))throw new Pb("JWT not in base64url format");return{header:JSON.parse(_w(t[0])),payload:JSON.parse(_w(t[1])),signature:wh(t[2]),raw:{header:t[0],payload:t[1]}}}async function ZY(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function JY(e,t){return new Promise((o,s)=>{(async()=>{for(let l=0;l<1/0;l++)try{const i=await e(l);if(!t(l,null,i)){o(i);return}}catch(i){if(!t(l,i)){s(i);return}}})()})}function QY(e){return("0"+e.toString(16)).substr(-2)}function eK(){const t=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",o=r.length;let s="";for(let l=0;l<56;l++)s+=r.charAt(Math.floor(Math.random()*o));return s}return crypto.getRandomValues(t),Array.from(t,QY).join("")}async function tK(e){const r=new TextEncoder().encode(e),o=await crypto.subtle.digest("SHA-256",r),s=new Uint8Array(o);return Array.from(s).map(l=>String.fromCharCode(l)).join("")}async function nK(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const r=await tK(e);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Nu(e,t,r=!1){const o=eK();let s=o;r&&(s+="/PASSWORD_RECOVERY"),await eh(e,`${t}-code-verifier`,s);const l=await nK(o);return[l,o===l?"plain":"s256"]}const rK=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function oK(e){const t=e.headers.get(Tb);if(!t||!t.match(rK))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function aK(e){if(!e)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(e<=t)throw new Error("JWT has expired")}function sK(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const iK=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Ou(e){if(!iK.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function cx(){const e={};return new Proxy(e,{get:(t,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const o=r.toString();if(o==="Symbol(Symbol.toPrimitive)"||o==="Symbol(Symbol.toStringTag)"||o==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function lK(e,t){return new Proxy(e,{get:(r,o,s)=>{if(o==="__isInsecureUserWarningProxy")return!0;if(typeof o=="symbol"){const l=o.toString();if(l==="Symbol(Symbol.toPrimitive)"||l==="Symbol(Symbol.toStringTag)"||l==="Symbol(util.inspect.custom)"||l==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(r,o,s)}return!t.value&&typeof o=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(r,o,s)}})}function Dw(e){return JSON.parse(JSON.stringify(e))}const ld=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),cK=[502,503,504];async function Lw(e){var t;if(!XY(e))throw new Ib(ld(e),0);if(cK.includes(e.status))throw new Ib(ld(e),e.status);let r;try{r=await e.json()}catch(l){throw new xd(ld(l),l)}let o;const s=oK(e);if(s&&s.getTime()>=w7["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?o=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(o=r.error_code),o){if(o==="weak_password")throw new Fw(ld(r),e.status,((t=r.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(o==="session_not_found")throw new $s}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((l,i)=>l&&typeof i=="string",!0))throw new Fw(ld(r),e.status,r.weak_password.reasons);throw new LY(ld(r),e.status||500,o)}const dK=(e,t,r,o)=>{const s={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),s.body=JSON.stringify(o),Object.assign(Object.assign({},s),r))};async function er(e,t,r,o){var s;const l=Object.assign({},o==null?void 0:o.headers);l[Tb]||(l[Tb]=w7["2024-01-01"].name),o!=null&&o.jwt&&(l.Authorization=`Bearer ${o.jwt}`);const i=(s=o==null?void 0:o.query)!==null&&s!==void 0?s:{};o!=null&&o.redirectTo&&(i.redirect_to=o.redirectTo);const u=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",c=await uK(e,t,r+u,{headers:l,noResolveJson:o==null?void 0:o.noResolveJson},{},o==null?void 0:o.body);return o!=null&&o.xform?o==null?void 0:o.xform(c):{data:Object.assign({},c),error:null}}async function uK(e,t,r,o,s,l){const i=dK(t,o,s,l);let u;try{u=await e(r,Object.assign({},i))}catch(c){throw console.error(c),new Ib(ld(c),0)}if(u.ok||await Lw(u),o!=null&&o.noResolveJson)return u;try{return await u.json()}catch(c){await Lw(c)}}function Pi(e){var t;let r=null;pK(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=UY(e.expires_in)));const o=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:r,user:o},error:null}}function zw(e){const t=Pi(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((r,o)=>r&&typeof o=="string",!0)&&(t.data.weak_password=e.weak_password),t}function Uc(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function hK(e){return{data:e,error:null}}function fK(e){const{action_link:t,email_otp:r,hashed_token:o,redirect_to:s,verification_type:l}=e,i=Gg(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),u={action_link:t,email_otp:r,hashed_token:o,redirect_to:s,verification_type:l},c=Object.assign({},i);return{data:{properties:u,user:c},error:null}}function Bw(e){return e}function pK(e){return e.access_token&&e.refresh_token&&e.expires_in}const dx=["global","local","others"];class mK{constructor({url:t="",headers:r={},fetch:o}){this.url=t,this.headers=r,this.fetch=k7(o),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,r=dx[0]){if(dx.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${dx.join(", ")}`);try{return await er(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(o){if(Ln(o))return{data:null,error:o};throw o}}async inviteUserByEmail(t,r={}){try{return await er(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:Uc})}catch(o){if(Ln(o))return{data:{user:null},error:o};throw o}}async generateLink(t){try{const{options:r}=t,o=Gg(t,["options"]),s=Object.assign(Object.assign({},o),r);return"newEmail"in o&&(s.new_email=o==null?void 0:o.newEmail,delete s.newEmail),await er(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:fK,redirectTo:r==null?void 0:r.redirectTo})}catch(r){if(Ln(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(t){try{return await er(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:Uc})}catch(r){if(Ln(r))return{data:{user:null},error:r};throw r}}async listUsers(t){var r,o,s,l,i,u,c;try{const d={nextPage:null,lastPage:0,total:0},h=await er(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(o=(r=t==null?void 0:t.page)===null||r===void 0?void 0:r.toString())!==null&&o!==void 0?o:"",per_page:(l=(s=t==null?void 0:t.perPage)===null||s===void 0?void 0:s.toString())!==null&&l!==void 0?l:""},xform:Bw});if(h.error)throw h.error;const f=await h.json(),g=(i=h.headers.get("x-total-count"))!==null&&i!==void 0?i:0,m=(c=(u=h.headers.get("link"))===null||u===void 0?void 0:u.split(","))!==null&&c!==void 0?c:[];return m.length>0&&(m.forEach(y=>{const v=parseInt(y.split(";")[0].split("=")[1].substring(0,1)),b=JSON.parse(y.split(";")[1].split("=")[1]);d[`${b}Page`]=v}),d.total=parseInt(g)),{data:Object.assign(Object.assign({},f),d),error:null}}catch(d){if(Ln(d))return{data:{users:[]},error:d};throw d}}async getUserById(t){Ou(t);try{return await er(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Uc})}catch(r){if(Ln(r))return{data:{user:null},error:r};throw r}}async updateUserById(t,r){Ou(t);try{return await er(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:r,headers:this.headers,xform:Uc})}catch(o){if(Ln(o))return{data:{user:null},error:o};throw o}}async deleteUser(t,r=!1){Ou(t);try{return await er(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:r},xform:Uc})}catch(o){if(Ln(o))return{data:{user:null},error:o};throw o}}async _listFactors(t){Ou(t.userId);try{const{data:r,error:o}=await er(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:r,error:o}}catch(r){if(Ln(r))return{data:null,error:r};throw r}}async _deleteFactor(t){Ou(t.userId),Ou(t.id);try{return{data:await er(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(r){if(Ln(r))return{data:null,error:r};throw r}}async _listOAuthClients(t){var r,o,s,l,i,u,c;try{const d={nextPage:null,lastPage:0,total:0},h=await er(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(o=(r=t==null?void 0:t.page)===null||r===void 0?void 0:r.toString())!==null&&o!==void 0?o:"",per_page:(l=(s=t==null?void 0:t.perPage)===null||s===void 0?void 0:s.toString())!==null&&l!==void 0?l:""},xform:Bw});if(h.error)throw h.error;const f=await h.json(),g=(i=h.headers.get("x-total-count"))!==null&&i!==void 0?i:0,m=(c=(u=h.headers.get("link"))===null||u===void 0?void 0:u.split(","))!==null&&c!==void 0?c:[];return m.length>0&&(m.forEach(y=>{const v=parseInt(y.split(";")[0].split("=")[1].substring(0,1)),b=JSON.parse(y.split(";")[1].split("=")[1]);d[`${b}Page`]=v}),d.total=parseInt(g)),{data:Object.assign(Object.assign({},f),d),error:null}}catch(d){if(Ln(d))return{data:{clients:[]},error:d};throw d}}async _createOAuthClient(t){try{return await er(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Ln(r))return{data:null,error:r};throw r}}async _getOAuthClient(t){try{return await er(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Ln(r))return{data:null,error:r};throw r}}async _updateOAuthClient(t,r){try{return await er(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:r,headers:this.headers,xform:o=>({data:o,error:null})})}catch(o){if(Ln(o))return{data:null,error:o};throw o}}async _deleteOAuthClient(t){try{return await er(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Ln(r))return{data:null,error:r};throw r}}async _regenerateOAuthClientSecret(t){try{return await er(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Ln(r))return{data:null,error:r};throw r}}}function $w(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}const _u={debug:!!(globalThis&&M7()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class R7 extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class qw extends R7{}async function gK(e,t,r){_u.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const o=new globalThis.AbortController;t>0&&setTimeout(()=>{o.abort(),_u.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve();try{return await globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:o.signal},async s=>{if(s){_u.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,s.name);try{return await r()}finally{_u.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,s.name)}}else{if(t===0)throw _u.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new qw(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(_u.debug)try{const l=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(l,null,"  "))}catch(l){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",l)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}})}catch(s){throw(s==null?void 0:s.name)==="AbortError"?new qw(`Acquiring an exclusive Navigator LockManager lock "${e}" timed out waiting ${t}ms`):s}}function yK(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function A7(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function xK(e){return parseInt(e,16)}function bK(e){const t=new TextEncoder().encode(e);return"0x"+Array.from(t,o=>o.toString(16).padStart(2,"0")).join("")}function vK(e){var t;const{chainId:r,domain:o,expirationTime:s,issuedAt:l=new Date,nonce:i,notBefore:u,requestId:c,resources:d,scheme:h,uri:f,version:g}=e;{if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!o)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(i&&i.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${i}`);if(!f)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(g!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${g}`);if(!((t=e.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`)}const m=A7(e.address),y=h?`${h}://${o}`:o,v=e.statement?`${e.statement}
`:"",b=`${y} wants you to sign in with your Ethereum account:
${m}

${v}`;let S=`URI: ${f}
Version: ${g}
Chain ID: ${r}${i?`
Nonce: ${i}`:""}
Issued At: ${l.toISOString()}`;if(s&&(S+=`
Expiration Time: ${s.toISOString()}`),u&&(S+=`
Not Before: ${u.toISOString()}`),c&&(S+=`
Request ID: ${c}`),d){let C=`
Resources:`;for(const k of d){if(!k||typeof k!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${k}`);C+=`
- ${k}`}S+=C}return`${b}
${S}`}class Ko extends Error{constructor({message:t,code:r,cause:o,name:s}){var l;super(t,{cause:o}),this.__isWebAuthnError=!0,this.name=(l=s??(o instanceof Error?o.name:void 0))!==null&&l!==void 0?l:"Unknown Error",this.code=r}}class wg extends Ko{constructor(t,r){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r,message:t}),this.name="WebAuthnUnknownError",this.originalError=r}}function SK({error:e,options:t}){var r,o,s;const{publicKey:l}=t;if(!l)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Ko({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(((r=l.authenticatorSelection)===null||r===void 0?void 0:r.requireResidentKey)===!0)return new Ko({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(t.mediation==="conditional"&&((o=l.authenticatorSelection)===null||o===void 0?void 0:o.userVerification)==="required")return new Ko({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if(((s=l.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new Ko({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new Ko({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new Ko({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return l.pubKeyCredParams.filter(u=>u.type==="public-key").length===0?new Ko({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new Ko({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const i=window.location.hostname;if(j7(i)){if(l.rp.id!==i)return new Ko({message:`The RP ID "${l.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new Ko({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(l.user.id.byteLength<1||l.user.id.byteLength>64)return new Ko({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new Ko({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Ko({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function wK({error:e,options:t}){const{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Ko({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new Ko({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const o=window.location.hostname;if(j7(o)){if(r.rpId!==o)return new Ko({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new Ko({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new Ko({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Ko({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}class CK{createNewAbortSignal(){if(this.controller){const r=new Error("Cancelling existing WebAuthn API call for new one");r.name="AbortError",this.controller.abort(r)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const MK=new CK;function kK(e){if(!e)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:r,excludeCredentials:o}=e,s=Gg(e,["challenge","user","excludeCredentials"]),l=wh(t).buffer,i=Object.assign(Object.assign({},r),{id:wh(r.id).buffer}),u=Object.assign(Object.assign({},s),{challenge:l,user:i});if(o&&o.length>0){u.excludeCredentials=new Array(o.length);for(let c=0;c<o.length;c++){const d=o[c];u.excludeCredentials[c]=Object.assign(Object.assign({},d),{id:wh(d.id).buffer,type:d.type||"public-key",transports:d.transports})}}return u}function RK(e){if(!e)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:r}=e,o=Gg(e,["challenge","allowCredentials"]),s=wh(t).buffer,l=Object.assign(Object.assign({},o),{challenge:s});if(r&&r.length>0){l.allowCredentials=new Array(r.length);for(let i=0;i<r.length;i++){const u=r[i];l.allowCredentials[i]=Object.assign(Object.assign({},u),{id:wh(u.id).buffer,type:u.type||"public-key",transports:u.transports})}}return l}function AK(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const r=e;return{id:e.id,rawId:e.id,response:{attestationObject:Cd(new Uint8Array(e.response.attestationObject)),clientDataJSON:Cd(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:(t=r.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function jK(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const r=e,o=e.getClientExtensionResults(),s=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:Cd(new Uint8Array(s.authenticatorData)),clientDataJSON:Cd(new Uint8Array(s.clientDataJSON)),signature:Cd(new Uint8Array(s.signature)),userHandle:s.userHandle?Cd(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:o,authenticatorAttachment:(t=r.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function j7(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function Ww(){var e,t;return!!(ja()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.create)=="function"&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.get)=="function")}async function EK(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new wg("Browser returned unexpected credential type",t)}:{data:null,error:new wg("Empty credential response",t)}}catch(t){return{data:null,error:SK({error:t,options:e})}}}async function TK(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new wg("Browser returned unexpected credential type",t)}:{data:null,error:new wg("Empty credential response",t)}}catch(t){return{data:null,error:wK({error:t,options:e})}}}const IK={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},PK={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Cg(...e){const t=s=>s!==null&&typeof s=="object"&&!Array.isArray(s),r=s=>s instanceof ArrayBuffer||ArrayBuffer.isView(s),o={};for(const s of e)if(s)for(const l in s){const i=s[l];if(i!==void 0)if(Array.isArray(i))o[l]=i;else if(r(i))o[l]=i;else if(t(i)){const u=o[l];t(u)?o[l]=Cg(u,i):o[l]=Cg(i)}else o[l]=i}return o}function FK(e,t){return Cg(IK,e,t||{})}function NK(e,t){return Cg(PK,e,t||{})}class OK{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:r,friendlyName:o,signal:s},l){var i;try{const{data:u,error:c}=await this.client.mfa.challenge({factorId:t,webauthn:r});if(!u)return{data:null,error:c};const d=s??MK.createNewAbortSignal();if(u.webauthn.type==="create"){const{user:h}=u.webauthn.credential_options.publicKey;if(!h.name){const f=o;if(f)h.name=`${h.id}:${f}`;else{const m=(await this.client.getUser()).data.user,y=((i=m==null?void 0:m.user_metadata)===null||i===void 0?void 0:i.name)||(m==null?void 0:m.email)||(m==null?void 0:m.id)||"User";h.name=`${h.id}:${y}`}}h.displayName||(h.displayName=h.name)}switch(u.webauthn.type){case"create":{const h=FK(u.webauthn.credential_options.publicKey,l==null?void 0:l.create),{data:f,error:g}=await EK({publicKey:h,signal:d});return f?{data:{factorId:t,challengeId:u.id,webauthn:{type:u.webauthn.type,credential_response:f}},error:null}:{data:null,error:g}}case"request":{const h=NK(u.webauthn.credential_options.publicKey,l==null?void 0:l.request),{data:f,error:g}=await TK(Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:h,signal:d}));return f?{data:{factorId:t,challengeId:u.id,webauthn:{type:u.webauthn.type,credential_response:f}},error:null}:{data:null,error:g}}}}catch(u){return Ln(u)?{data:null,error:u}:{data:null,error:new xd("Unexpected error in challenge",u)}}}async _verify({challengeId:t,factorId:r,webauthn:o}){return this.client.mfa.verify({factorId:r,challengeId:t,webauthn:o})}async _authenticate({factorId:t,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:o=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},l){if(!r)return{data:null,error:new Cp("rpId is required for WebAuthn authentication")};try{if(!Ww())return{data:null,error:new xd("Browser does not support WebAuthn",null)};const{data:i,error:u}=await this.challenge({factorId:t,webauthn:{rpId:r,rpOrigins:o},signal:s},{request:l});if(!i)return{data:null,error:u};const{webauthn:c}=i;return this._verify({factorId:t,challengeId:i.challengeId,webauthn:{type:c.type,rpId:r,rpOrigins:o,credential_response:c.credential_response}})}catch(i){return Ln(i)?{data:null,error:i}:{data:null,error:new xd("Unexpected error in authenticate",i)}}}async _register({friendlyName:t,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:o=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},l){if(!r)return{data:null,error:new Cp("rpId is required for WebAuthn registration")};try{if(!Ww())return{data:null,error:new xd("Browser does not support WebAuthn",null)};const{data:i,error:u}=await this._enroll({friendlyName:t});if(!i)return await this.client.mfa.listFactors().then(h=>{var f;return(f=h.data)===null||f===void 0?void 0:f.all.find(g=>g.factor_type==="webauthn"&&g.friendly_name===t&&g.status!=="unverified")}).then(h=>h?this.client.mfa.unenroll({factorId:h==null?void 0:h.id}):void 0),{data:null,error:u};const{data:c,error:d}=await this._challenge({factorId:i.id,friendlyName:i.friendly_name,webauthn:{rpId:r,rpOrigins:o},signal:s},{create:l});return c?this._verify({factorId:i.id,challengeId:c.challengeId,webauthn:{rpId:r,rpOrigins:o,type:c.webauthn.type,credential_response:c.webauthn.credential_response}}):{data:null,error:d}}catch(i){return Ln(i)?{data:null,error:i}:{data:null,error:new xd("Unexpected error in register",i)}}}}yK();const _K={url:FY,storageKey:NY,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:OY,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4,skipAutoInitialize:!1};async function Hw(e,t,r){return await r()}const Du={};class Mp{get jwks(){var t,r;return(r=(t=Du[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(t){Du[this.storageKey]=Object.assign(Object.assign({},Du[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,r;return(r=(t=Du[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){Du[this.storageKey]=Object.assign(Object.assign({},Du[this.storageKey]),{cachedAt:t})}constructor(t){var r,o,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const l=Object.assign(Object.assign({},_K),t);if(this.storageKey=l.storageKey,this.instanceID=(r=Mp.nextInstanceID[this.storageKey])!==null&&r!==void 0?r:0,Mp.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!l.debug,typeof l.debug=="function"&&(this.logger=l.debug),this.instanceID>0&&ja()){const i=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(i),this.logDebugMessages&&console.trace(i)}if(this.persistSession=l.persistSession,this.autoRefreshToken=l.autoRefreshToken,this.admin=new mK({url:l.url,headers:l.headers,fetch:l.fetch}),this.url=l.url,this.headers=l.headers,this.fetch=k7(l.fetch),this.lock=l.lock||Hw,this.detectSessionInUrl=l.detectSessionInUrl,this.flowType=l.flowType,this.hasCustomAuthorizationHeader=l.hasCustomAuthorizationHeader,this.throwOnError=l.throwOnError,this.lockAcquireTimeout=l.lockAcquireTimeout,l.lock?this.lock=l.lock:this.persistSession&&ja()&&(!((o=globalThis==null?void 0:globalThis.navigator)===null||o===void 0)&&o.locks)?this.lock=gK:this.lock=Hw,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new OK(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(l.storage?this.storage=l.storage:M7()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=$w(this.memoryStorage)),l.userStorage&&(this.userStorage=l.userStorage)):(this.memoryStorage={},this.storage=$w(this.memoryStorage)),ja()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i);try{await this._notifyAllSubscribers(i.data.event,i.data.session,!1)}catch(u){this._debug("#broadcastChannel","error",u)}})}l.skipAutoInitialize||this.initialize().catch(i=>{this._debug("#initialize()","error",i)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${S7}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let r={},o="none";if(ja()&&(r=KY(window.location.href),this._isImplicitGrantCallback(r)?o="implicit":await this._isPKCECallback(r)&&(o="pkce")),ja()&&this.detectSessionInUrl&&o!=="none"){const{data:s,error:l}=await this._getSessionFromURL(r,o);if(l){if(this._debug("#_initialize()","error detecting session from URL",l),BY(l)){const c=(t=l.details)===null||t===void 0?void 0:t.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:l}}return{error:l}}const{session:i,redirectType:u}=s;return this._debug("#_initialize()","detected session in URL",i,"redirect type",u),await this._saveSession(i),setTimeout(async()=>{u==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return Ln(r)?this._returnResult({error:r}):this._returnResult({error:new xd("Unexpected error during initialization",r)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var r,o,s;try{const l=await er(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(o=(r=t==null?void 0:t.options)===null||r===void 0?void 0:r.data)!==null&&o!==void 0?o:{},gotrue_meta_security:{captcha_token:(s=t==null?void 0:t.options)===null||s===void 0?void 0:s.captchaToken}},xform:Pi}),{data:i,error:u}=l;if(u||!i)return this._returnResult({data:{user:null,session:null},error:u});const c=i.session,d=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:d,session:c},error:null})}catch(l){if(Ln(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}}async signUp(t){var r,o,s;try{let l;if("email"in t){const{email:h,password:f,options:g}=t;let m=null,y=null;this.flowType==="pkce"&&([m,y]=await Nu(this.storage,this.storageKey)),l=await er(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:g==null?void 0:g.emailRedirectTo,body:{email:h,password:f,data:(r=g==null?void 0:g.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken},code_challenge:m,code_challenge_method:y},xform:Pi})}else if("phone"in t){const{phone:h,password:f,options:g}=t;l=await er(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:h,password:f,data:(o=g==null?void 0:g.data)!==null&&o!==void 0?o:{},channel:(s=g==null?void 0:g.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken}},xform:Pi})}else throw new x5("You must provide either an email or phone number and a password");const{data:i,error:u}=l;if(u||!i)return await ka(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:u});const c=i.session,d=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:d,session:c},error:null})}catch(l){if(await ka(this.storage,`${this.storageKey}-code-verifier`),Ln(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}}async signInWithPassword(t){try{let r;if("email"in t){const{email:l,password:i,options:u}=t;r=await er(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:l,password:i,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken}},xform:zw})}else if("phone"in t){const{phone:l,password:i,options:u}=t;r=await er(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:l,password:i,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken}},xform:zw})}else throw new x5("You must provide either an email or phone number and a password");const{data:o,error:s}=r;if(s)return this._returnResult({data:{user:null,session:null},error:s});if(!o||!o.session||!o.user){const l=new Fu;return this._returnResult({data:{user:null,session:null},error:l})}return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),this._returnResult({data:Object.assign({user:o.user,session:o.session},o.weak_password?{weakPassword:o.weak_password}:null),error:s})}catch(r){if(Ln(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOAuth(t){var r,o,s,l;return await this._handleProviderSignIn(t.provider,{redirectTo:(r=t.options)===null||r===void 0?void 0:r.redirectTo,scopes:(o=t.options)===null||o===void 0?void 0:o.scopes,queryParams:(s=t.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(l=t.options)===null||l===void 0?void 0:l.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:r}=t;switch(r){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}}async signInWithEthereum(t){var r,o,s,l,i,u,c,d,h,f,g;let m,y;if("message"in t)m=t.message,y=t.signature;else{const{chain:v,wallet:b,statement:S,options:C}=t;let k;if(ja())if(typeof b=="object")k=b;else{const I=window;if("ethereum"in I&&typeof I.ethereum=="object"&&"request"in I.ethereum&&typeof I.ethereum.request=="function")k=I.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof b!="object"||!(C!=null&&C.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");k=b}const R=new URL((r=C==null?void 0:C.url)!==null&&r!==void 0?r:window.location.href),j=await k.request({method:"eth_requestAccounts"}).then(I=>I).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!j||j.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const T=A7(j[0]);let _=(o=C==null?void 0:C.signInWithEthereum)===null||o===void 0?void 0:o.chainId;if(!_){const I=await k.request({method:"eth_chainId"});_=xK(I)}const P={domain:R.host,address:T,statement:S,uri:R.href,version:"1",chainId:_,nonce:(s=C==null?void 0:C.signInWithEthereum)===null||s===void 0?void 0:s.nonce,issuedAt:(i=(l=C==null?void 0:C.signInWithEthereum)===null||l===void 0?void 0:l.issuedAt)!==null&&i!==void 0?i:new Date,expirationTime:(u=C==null?void 0:C.signInWithEthereum)===null||u===void 0?void 0:u.expirationTime,notBefore:(c=C==null?void 0:C.signInWithEthereum)===null||c===void 0?void 0:c.notBefore,requestId:(d=C==null?void 0:C.signInWithEthereum)===null||d===void 0?void 0:d.requestId,resources:(h=C==null?void 0:C.signInWithEthereum)===null||h===void 0?void 0:h.resources};m=vK(P),y=await k.request({method:"personal_sign",params:[bK(m),T]})}try{const{data:v,error:b}=await er(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:m,signature:y},!((f=t.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(g=t.options)===null||g===void 0?void 0:g.captchaToken}}:null),xform:Pi});if(b)throw b;if(!v||!v.session||!v.user){const S=new Fu;return this._returnResult({data:{user:null,session:null},error:S})}return v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),this._returnResult({data:Object.assign({},v),error:b})}catch(v){if(Ln(v))return this._returnResult({data:{user:null,session:null},error:v});throw v}}async signInWithSolana(t){var r,o,s,l,i,u,c,d,h,f,g,m;let y,v;if("message"in t)y=t.message,v=t.signature;else{const{chain:b,wallet:S,statement:C,options:k}=t;let R;if(ja())if(typeof S=="object")R=S;else{const T=window;if("solana"in T&&typeof T.solana=="object"&&("signIn"in T.solana&&typeof T.solana.signIn=="function"||"signMessage"in T.solana&&typeof T.solana.signMessage=="function"))R=T.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof S!="object"||!(k!=null&&k.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");R=S}const j=new URL((r=k==null?void 0:k.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in R&&R.signIn){const T=await R.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},k==null?void 0:k.signInWithSolana),{version:"1",domain:j.host,uri:j.href}),C?{statement:C}:null));let _;if(Array.isArray(T)&&T[0]&&typeof T[0]=="object")_=T[0];else if(T&&typeof T=="object"&&"signedMessage"in T&&"signature"in T)_=T;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in _&&"signature"in _&&(typeof _.signedMessage=="string"||_.signedMessage instanceof Uint8Array)&&_.signature instanceof Uint8Array)y=typeof _.signedMessage=="string"?_.signedMessage:new TextDecoder().decode(_.signedMessage),v=_.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in R)||typeof R.signMessage!="function"||!("publicKey"in R)||typeof R!="object"||!R.publicKey||!("toBase58"in R.publicKey)||typeof R.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");y=[`${j.host} wants you to sign in with your Solana account:`,R.publicKey.toBase58(),...C?["",C,""]:[""],"Version: 1",`URI: ${j.href}`,`Issued At: ${(s=(o=k==null?void 0:k.signInWithSolana)===null||o===void 0?void 0:o.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((l=k==null?void 0:k.signInWithSolana)===null||l===void 0)&&l.notBefore?[`Not Before: ${k.signInWithSolana.notBefore}`]:[],...!((i=k==null?void 0:k.signInWithSolana)===null||i===void 0)&&i.expirationTime?[`Expiration Time: ${k.signInWithSolana.expirationTime}`]:[],...!((u=k==null?void 0:k.signInWithSolana)===null||u===void 0)&&u.chainId?[`Chain ID: ${k.signInWithSolana.chainId}`]:[],...!((c=k==null?void 0:k.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${k.signInWithSolana.nonce}`]:[],...!((d=k==null?void 0:k.signInWithSolana)===null||d===void 0)&&d.requestId?[`Request ID: ${k.signInWithSolana.requestId}`]:[],...!((f=(h=k==null?void 0:k.signInWithSolana)===null||h===void 0?void 0:h.resources)===null||f===void 0)&&f.length?["Resources",...k.signInWithSolana.resources.map(_=>`- ${_}`)]:[]].join(`
`);const T=await R.signMessage(new TextEncoder().encode(y),"utf8");if(!T||!(T instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");v=T}}try{const{data:b,error:S}=await er(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:y,signature:Cd(v)},!((g=t.options)===null||g===void 0)&&g.captchaToken?{gotrue_meta_security:{captcha_token:(m=t.options)===null||m===void 0?void 0:m.captchaToken}}:null),xform:Pi});if(S)throw S;if(!b||!b.session||!b.user){const C=new Fu;return this._returnResult({data:{user:null,session:null},error:C})}return b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("SIGNED_IN",b.session)),this._returnResult({data:Object.assign({},b),error:S})}catch(b){if(Ln(b))return this._returnResult({data:{user:null,session:null},error:b});throw b}}async _exchangeCodeForSession(t){const r=await Z0(this.storage,`${this.storageKey}-code-verifier`),[o,s]=(r??"").split("/");try{if(!o&&this.flowType==="pkce")throw new $Y;const{data:l,error:i}=await er(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:o},xform:Pi});if(await ka(this.storage,`${this.storageKey}-code-verifier`),i)throw i;if(!l||!l.session||!l.user){const u=new Fu;return this._returnResult({data:{user:null,session:null,redirectType:null},error:u})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:Object.assign(Object.assign({},l),{redirectType:s??null}),error:i})}catch(l){if(await ka(this.storage,`${this.storageKey}-code-verifier`),Ln(l))return this._returnResult({data:{user:null,session:null,redirectType:null},error:l});throw l}}async signInWithIdToken(t){try{const{options:r,provider:o,token:s,access_token:l,nonce:i}=t,u=await er(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:o,id_token:s,access_token:l,nonce:i,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},xform:Pi}),{data:c,error:d}=u;if(d)return this._returnResult({data:{user:null,session:null},error:d});if(!c||!c.session||!c.user){const h=new Fu;return this._returnResult({data:{user:null,session:null},error:h})}return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),this._returnResult({data:c,error:d})}catch(r){if(Ln(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOtp(t){var r,o,s,l,i;try{if("email"in t){const{email:u,options:c}=t;let d=null,h=null;this.flowType==="pkce"&&([d,h]=await Nu(this.storage,this.storageKey));const{error:f}=await er(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:u,data:(r=c==null?void 0:c.data)!==null&&r!==void 0?r:{},create_user:(o=c==null?void 0:c.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:d,code_challenge_method:h},redirectTo:c==null?void 0:c.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:f})}if("phone"in t){const{phone:u,options:c}=t,{data:d,error:h}=await er(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:u,data:(s=c==null?void 0:c.data)!==null&&s!==void 0?s:{},create_user:(l=c==null?void 0:c.shouldCreateUser)!==null&&l!==void 0?l:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(i=c==null?void 0:c.channel)!==null&&i!==void 0?i:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:d==null?void 0:d.message_id},error:h})}throw new x5("You must provide either an email or phone number.")}catch(u){if(await ka(this.storage,`${this.storageKey}-code-verifier`),Ln(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async verifyOtp(t){var r,o;try{let s,l;"options"in t&&(s=(r=t.options)===null||r===void 0?void 0:r.redirectTo,l=(o=t.options)===null||o===void 0?void 0:o.captchaToken);const{data:i,error:u}=await er(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:l}}),redirectTo:s,xform:Pi});if(u)throw u;if(!i)throw new Error("An error occurred on token verification.");const c=i.session,d=i.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),this._returnResult({data:{user:d,session:c},error:null})}catch(s){if(Ln(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithSSO(t){var r,o,s,l,i;try{let u=null,c=null;this.flowType==="pkce"&&([u,c]=await Nu(this.storage,this.storageKey));const d=await er(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(o=(r=t.options)===null||r===void 0?void 0:r.redirectTo)!==null&&o!==void 0?o:void 0}),!((s=t==null?void 0:t.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:u,code_challenge_method:c}),headers:this.headers,xform:hK});return!((l=d.data)===null||l===void 0)&&l.url&&ja()&&!(!((i=t.options)===null||i===void 0)&&i.skipBrowserRedirect)&&window.location.assign(d.data.url),this._returnResult(d)}catch(u){if(await ka(this.storage,`${this.storageKey}-code-verifier`),Ln(u))return this._returnResult({data:null,error:u});throw u}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:r},error:o}=t;if(o)throw o;if(!r)throw new $s;const{error:s}=await er(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return this._returnResult({data:{user:null,session:null},error:s})})}catch(t){if(Ln(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const r=`${this.url}/resend`;if("email"in t){const{email:o,type:s,options:l}=t,{error:i}=await er(this.fetch,"POST",r,{headers:this.headers,body:{email:o,type:s,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},redirectTo:l==null?void 0:l.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:i})}else if("phone"in t){const{phone:o,type:s,options:l}=t,{data:i,error:u}=await er(this.fetch,"POST",r,{headers:this.headers,body:{phone:o,type:s,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:i==null?void 0:i.message_id},error:u})}throw new x5("You must provide either an email or phone number and a type")}catch(r){if(Ln(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async r=>r))}async _acquireLock(t,r){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const o=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await o,await r()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const o=r();for(this.pendingInLock.push((async()=>{try{await o}catch{}})()),await o;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await o}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await t(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const r=await Z0(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?t=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const o=t.expires_at?t.expires_at*1e3-Date.now()<sx:!1;if(this._debug("#__loadSession()",`session has${o?"":" not"} expired`,"expires_at",t.expires_at),!o){if(this.userStorage){const i=await Z0(this.userStorage,this.storageKey+"-user");i!=null&&i.user?t.user=i.user:t.user=cx()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const i={value:this.suppressGetSessionWarning};t.user=lK(t.user,i),i.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:s,error:l}=await this._callRefreshToken(t.refresh_token);return l?this._returnResult({data:{session:null},error:l}):this._returnResult({data:{session:s},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){if(t)return await this._getUser(t);await this.initializePromise;const r=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return r.data.user&&(this.suppressGetSessionWarning=!0),r}async _getUser(t){try{return t?await er(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:Uc}):await this._useSession(async r=>{var o,s,l;const{data:i,error:u}=r;if(u)throw u;return!(!((o=i.session)===null||o===void 0)&&o.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new $s}:await er(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(l=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&l!==void 0?l:void 0,xform:Uc})})}catch(r){if(Ln(r))return ix(r)&&(await this._removeSession(),await ka(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:r});throw r}}async updateUser(t,r={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(t,r))}async _updateUser(t,r={}){try{return await this._useSession(async o=>{const{data:s,error:l}=o;if(l)throw l;if(!s.session)throw new $s;const i=s.session;let u=null,c=null;this.flowType==="pkce"&&t.email!=null&&([u,c]=await Nu(this.storage,this.storageKey));const{data:d,error:h}=await er(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r==null?void 0:r.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:u,code_challenge_method:c}),jwt:i.access_token,xform:Uc});if(h)throw h;return i.user=d.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),this._returnResult({data:{user:i.user},error:null})})}catch(o){if(await ka(this.storage,`${this.storageKey}-code-verifier`),Ln(o))return this._returnResult({data:{user:null},error:o});throw o}}async setSession(t){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new $s;const r=Date.now()/1e3;let o=r,s=!0,l=null;const{payload:i}=v5(t.access_token);if(i.exp&&(o=i.exp,s=o<=r),s){const{data:u,error:c}=await this._callRefreshToken(t.refresh_token);if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!u)return{data:{user:null,session:null},error:null};l=u}else{const{data:u,error:c}=await this._getUser(t.access_token);if(c)return this._returnResult({data:{user:null,session:null},error:c});l={access_token:t.access_token,refresh_token:t.refresh_token,user:u.user,token_type:"bearer",expires_in:o-r,expires_at:o},await this._saveSession(l),await this._notifyAllSubscribers("SIGNED_IN",l)}return this._returnResult({data:{user:l.user,session:l},error:null})}catch(r){if(Ln(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async r=>{var o;if(!t){const{data:i,error:u}=r;if(u)throw u;t=(o=i.session)!==null&&o!==void 0?o:void 0}if(!(t!=null&&t.refresh_token))throw new $s;const{data:s,error:l}=await this._callRefreshToken(t.refresh_token);return l?this._returnResult({data:{user:null,session:null},error:l}):s?this._returnResult({data:{user:s.user,session:s},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(r){if(Ln(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async _getSessionFromURL(t,r){try{if(!ja())throw new b5("No browser detected.");if(t.error||t.error_description||t.error_code)throw new b5(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new Pw("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new b5("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new Pw("No code detected.");const{data:C,error:k}=await this._exchangeCodeForSession(t.code);if(k)throw k;const R=new URL(window.location.href);return R.searchParams.delete("code"),window.history.replaceState(window.history.state,"",R.toString()),{data:{session:C.session,redirectType:null},error:null}}const{provider_token:o,provider_refresh_token:s,access_token:l,refresh_token:i,expires_in:u,expires_at:c,token_type:d}=t;if(!l||!u||!i||!d)throw new b5("No session defined in URL");const h=Math.round(Date.now()/1e3),f=parseInt(u);let g=h+f;c&&(g=parseInt(c));const m=g-h;m*1e3<=Qu&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${m}s, should have been closer to ${f}s`);const y=g-f;h-y>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",y,g,h):h-y<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",y,g,h);const{data:v,error:b}=await this._getUser(l);if(b)throw b;const S={provider_token:o,provider_refresh_token:s,access_token:l,expires_in:f,expires_at:g,refresh_token:i,token_type:d,user:v.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:S,redirectType:t.type},error:null})}catch(o){if(Ln(o))return this._returnResult({data:{session:null,redirectType:null},error:o});throw o}}_isImplicitGrantCallback(t){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),t):!!(t.access_token||t.error_description)}async _isPKCECallback(t){const r=await Z0(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&r)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async r=>{var o;const{data:s,error:l}=r;if(l&&!ix(l))return this._returnResult({error:l});const i=(o=s.session)===null||o===void 0?void 0:o.access_token;if(i){const{error:u}=await this.admin.signOut(i,t);if(u&&!(zY(u)&&(u.status===404||u.status===401||u.status===403)||ix(u)))return this._returnResult({error:u})}return t!=="others"&&(await this._removeSession(),await ka(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const r=YY(),o={id:r,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,o),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:o}}}async _emitInitialSession(t){return await this._useSession(async r=>{var o,s;try{const{data:{session:l},error:i}=r;if(i)throw i;await((o=this.stateChangeEmitters.get(t))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",l)),this._debug("INITIAL_SESSION","callback id",t,"session",l)}catch(l){await((s=this.stateChangeEmitters.get(t))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",l),console.error(l)}})}async resetPasswordForEmail(t,r={}){let o=null,s=null;this.flowType==="pkce"&&([o,s]=await Nu(this.storage,this.storageKey,!0));try{return await er(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:o,code_challenge_method:s,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(l){if(await ka(this.storage,`${this.storageKey}-code-verifier`),Ln(l))return this._returnResult({data:null,error:l});throw l}}async getUserIdentities(){var t;try{const{data:r,error:o}=await this.getUser();if(o)throw o;return this._returnResult({data:{identities:(t=r.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(r){if(Ln(r))return this._returnResult({data:null,error:r});throw r}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var r;try{const{data:o,error:s}=await this._useSession(async l=>{var i,u,c,d,h;const{data:f,error:g}=l;if(g)throw g;const m=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(i=t.options)===null||i===void 0?void 0:i.redirectTo,scopes:(u=t.options)===null||u===void 0?void 0:u.scopes,queryParams:(c=t.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await er(this.fetch,"GET",m,{headers:this.headers,jwt:(h=(d=f.session)===null||d===void 0?void 0:d.access_token)!==null&&h!==void 0?h:void 0})});if(s)throw s;return ja()&&!(!((r=t.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(o==null?void 0:o.url),this._returnResult({data:{provider:t.provider,url:o==null?void 0:o.url},error:null})}catch(o){if(Ln(o))return this._returnResult({data:{provider:t.provider,url:null},error:o});throw o}}async linkIdentityIdToken(t){return await this._useSession(async r=>{var o;try{const{error:s,data:{session:l}}=r;if(s)throw s;const{options:i,provider:u,token:c,access_token:d,nonce:h}=t,f=await er(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(o=l==null?void 0:l.access_token)!==null&&o!==void 0?o:void 0,body:{provider:u,id_token:c,access_token:d,nonce:h,link_identity:!0,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},xform:Pi}),{data:g,error:m}=f;return m?this._returnResult({data:{user:null,session:null},error:m}):!g||!g.session||!g.user?this._returnResult({data:{user:null,session:null},error:new Fu}):(g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("USER_UPDATED",g.session)),this._returnResult({data:g,error:m}))}catch(s){if(await ka(this.storage,`${this.storageKey}-code-verifier`),Ln(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}})}async unlinkIdentity(t){try{return await this._useSession(async r=>{var o,s;const{data:l,error:i}=r;if(i)throw i;return await er(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(s=(o=l.session)===null||o===void 0?void 0:o.access_token)!==null&&s!==void 0?s:void 0})})}catch(r){if(Ln(r))return this._returnResult({data:null,error:r});throw r}}async _refreshAccessToken(t){const r=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(r,"begin");try{const o=Date.now();return await JY(async s=>(s>0&&await ZY(200*Math.pow(2,s-1)),this._debug(r,"refreshing attempt",s),await er(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:Pi})),(s,l)=>{const i=200*Math.pow(2,s);return l&&lx(l)&&Date.now()+i-o<Qu})}catch(o){if(this._debug(r,"error",o),Ln(o))return this._returnResult({data:{session:null,user:null},error:o});throw o}finally{this._debug(r,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,r){const o=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",r,"url",o),ja()&&!r.skipBrowserRedirect&&window.location.assign(o),{data:{provider:t,url:o},error:null}}async _recoverAndRefresh(){var t,r;const o="#_recoverAndRefresh()";this._debug(o,"begin");try{const s=await Z0(this.storage,this.storageKey);if(s&&this.userStorage){let i=await Z0(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!i&&(i={user:s.user},await eh(this.userStorage,this.storageKey+"-user",i)),s.user=(t=i==null?void 0:i.user)!==null&&t!==void 0?t:cx()}else if(s&&!s.user&&!s.user){const i=await Z0(this.storage,this.storageKey+"-user");i&&(i!=null&&i.user)?(s.user=i.user,await ka(this.storage,this.storageKey+"-user"),await eh(this.storage,this.storageKey,s)):s.user=cx()}if(this._debug(o,"session from storage",s),!this._isValidSession(s)){this._debug(o,"session is not valid"),s!==null&&await this._removeSession();return}const l=((r=s.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<sx;if(this._debug(o,`session has${l?"":" not"} expired with margin of ${sx}s`),l){if(this.autoRefreshToken&&s.refresh_token){const{error:i}=await this._callRefreshToken(s.refresh_token);i&&(console.error(i),lx(i)||(this._debug(o,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:i,error:u}=await this._getUser(s.access_token);!u&&(i!=null&&i.user)?(s.user=i.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(o,"could not get user data, skipping SIGNED_IN notification")}catch(i){console.error("Error getting user data:",i),this._debug(o,"error getting user data, skipping SIGNED_IN notification",i)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(o,"error",s),console.error(s);return}finally{this._debug(o,"end")}}async _callRefreshToken(t){var r,o;if(!t)throw new $s;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Yg;const{data:l,error:i}=await this._refreshAccessToken(t);if(i)throw i;if(!l.session)throw new $s;await this._saveSession(l.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",l.session);const u={data:l.session,error:null};return this.refreshingDeferred.resolve(u),u}catch(l){if(this._debug(s,"error",l),Ln(l)){const i={data:null,error:l};return lx(l)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(i),i}throw(o=this.refreshingDeferred)===null||o===void 0||o.reject(l),l}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(t,r,o=!0){const s=`#_notifyAllSubscribers(${t})`;this._debug(s,"begin",r,`broadcast = ${o}`);try{this.broadcastChannel&&o&&this.broadcastChannel.postMessage({event:t,session:r});const l=[],i=Array.from(this.stateChangeEmitters.values()).map(async u=>{try{await u.callback(t,r)}catch(c){l.push(c)}});if(await Promise.all(i),l.length>0){for(let u=0;u<l.length;u+=1)console.error(l[u]);throw l[0]}}finally{this._debug(s,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await ka(this.storage,`${this.storageKey}-code-verifier`);const r=Object.assign({},t),o=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!o&&r.user&&await eh(this.userStorage,this.storageKey+"-user",{user:r.user});const s=Object.assign({},r);delete s.user;const l=Dw(s);await eh(this.storage,this.storageKey,l)}else{const s=Dw(r);await eh(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await ka(this.storage,this.storageKey),await ka(this.storage,this.storageKey+"-code-verifier"),await ka(this.storage,this.storageKey+"-user"),this.userStorage&&await ka(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&ja()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),Qu);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t);const r=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=r,r&&typeof r=="object"&&typeof r.unref=="function"?r.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(r)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t);const r=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,r&&clearTimeout(r)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async r=>{const{data:{session:o}}=r;if(!o||!o.refresh_token||!o.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((o.expires_at*1e3-t)/Qu);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Qu}ms, refresh threshold is ${Eb} ticks`),s<=Eb&&await this._callRefreshToken(o.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof R7)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ja()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(t){this._debug("#visibilityChangedCallback","error",t)}},window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const r=`#_onVisibilityChanged(${t})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,r,o){const s=[`provider=${encodeURIComponent(r)}`];if(o!=null&&o.redirectTo&&s.push(`redirect_to=${encodeURIComponent(o.redirectTo)}`),o!=null&&o.scopes&&s.push(`scopes=${encodeURIComponent(o.scopes)}`),this.flowType==="pkce"){const[l,i]=await Nu(this.storage,this.storageKey),u=new URLSearchParams({code_challenge:`${encodeURIComponent(l)}`,code_challenge_method:`${encodeURIComponent(i)}`});s.push(u.toString())}if(o!=null&&o.queryParams){const l=new URLSearchParams(o.queryParams);s.push(l.toString())}return o!=null&&o.skipBrowserRedirect&&s.push(`skip_http_redirect=${o.skipBrowserRedirect}`),`${t}?${s.join("&")}`}async _unenroll(t){try{return await this._useSession(async r=>{var o;const{data:s,error:l}=r;return l?this._returnResult({data:null,error:l}):await er(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(o=s==null?void 0:s.session)===null||o===void 0?void 0:o.access_token})})}catch(r){if(Ln(r))return this._returnResult({data:null,error:r});throw r}}async _enroll(t){try{return await this._useSession(async r=>{var o,s;const{data:l,error:i}=r;if(i)return this._returnResult({data:null,error:i});const u=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:c,error:d}=await er(this.fetch,"POST",`${this.url}/factors`,{body:u,headers:this.headers,jwt:(o=l==null?void 0:l.session)===null||o===void 0?void 0:o.access_token});return d?this._returnResult({data:null,error:d}):(t.factorType==="totp"&&c.type==="totp"&&(!((s=c==null?void 0:c.totp)===null||s===void 0)&&s.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),this._returnResult({data:c,error:null}))})}catch(r){if(Ln(r))return this._returnResult({data:null,error:r});throw r}}async _verify(t){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async r=>{var o;const{data:s,error:l}=r;if(l)return this._returnResult({data:null,error:l});const i=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?AK(t.webauthn.credential_response):jK(t.webauthn.credential_response)})}:{code:t.code}),{data:u,error:c}=await er(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:i,headers:this.headers,jwt:(o=s==null?void 0:s.session)===null||o===void 0?void 0:o.access_token});return c?this._returnResult({data:null,error:c}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+u.expires_in},u)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",u),this._returnResult({data:u,error:c}))})}catch(r){if(Ln(r))return this._returnResult({data:null,error:r});throw r}})}async _challenge(t){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async r=>{var o;const{data:s,error:l}=r;if(l)return this._returnResult({data:null,error:l});const i=await er(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(o=s==null?void 0:s.session)===null||o===void 0?void 0:o.access_token});if(i.error)return i;const{data:u}=i;if(u.type!=="webauthn")return{data:u,error:null};switch(u.webauthn.type){case"create":return{data:Object.assign(Object.assign({},u),{webauthn:Object.assign(Object.assign({},u.webauthn),{credential_options:Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:kK(u.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},u),{webauthn:Object.assign(Object.assign({},u.webauthn),{credential_options:Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:RK(u.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(r){if(Ln(r))return this._returnResult({data:null,error:r});throw r}})}async _challengeAndVerify(t){const{data:r,error:o}=await this._challenge({factorId:t.factorId});return o?this._returnResult({data:null,error:o}):await this._verify({factorId:t.factorId,challengeId:r.id,code:t.code})}async _listFactors(){var t;const{data:{user:r},error:o}=await this.getUser();if(o)return{data:null,error:o};const s={all:[],phone:[],totp:[],webauthn:[]};for(const l of(t=r==null?void 0:r.factors)!==null&&t!==void 0?t:[])s.all.push(l),l.status==="verified"&&s[l.factor_type].push(l);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(t){var r,o,s,l;if(t)try{const{payload:m}=v5(t);let y=null;m.aal&&(y=m.aal);let v=y;const{data:{user:b},error:S}=await this.getUser(t);if(S)return this._returnResult({data:null,error:S});((o=(r=b==null?void 0:b.factors)===null||r===void 0?void 0:r.filter(R=>R.status==="verified"))!==null&&o!==void 0?o:[]).length>0&&(v="aal2");const k=m.amr||[];return{data:{currentLevel:y,nextLevel:v,currentAuthenticationMethods:k},error:null}}catch(m){if(Ln(m))return this._returnResult({data:null,error:m});throw m}const{data:{session:i},error:u}=await this.getSession();if(u)return this._returnResult({data:null,error:u});if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:c}=v5(i.access_token);let d=null;c.aal&&(d=c.aal);let h=d;((l=(s=i.user.factors)===null||s===void 0?void 0:s.filter(m=>m.status==="verified"))!==null&&l!==void 0?l:[]).length>0&&(h="aal2");const g=c.amr||[];return{data:{currentLevel:d,nextLevel:h,currentAuthenticationMethods:g},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async r=>{const{data:{session:o},error:s}=r;return s?this._returnResult({data:null,error:s}):o?await er(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:o.access_token,xform:l=>({data:l,error:null})}):this._returnResult({data:null,error:new $s})})}catch(r){if(Ln(r))return this._returnResult({data:null,error:r});throw r}}async _approveAuthorization(t,r){try{return await this._useSession(async o=>{const{data:{session:s},error:l}=o;if(l)return this._returnResult({data:null,error:l});if(!s)return this._returnResult({data:null,error:new $s});const i=await er(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"approve"},xform:u=>({data:u,error:null})});return i.data&&i.data.redirect_url&&ja()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(i.data.redirect_url),i})}catch(o){if(Ln(o))return this._returnResult({data:null,error:o});throw o}}async _denyAuthorization(t,r){try{return await this._useSession(async o=>{const{data:{session:s},error:l}=o;if(l)return this._returnResult({data:null,error:l});if(!s)return this._returnResult({data:null,error:new $s});const i=await er(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"deny"},xform:u=>({data:u,error:null})});return i.data&&i.data.redirect_url&&ja()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(i.data.redirect_url),i})}catch(o){if(Ln(o))return this._returnResult({data:null,error:o});throw o}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:r},error:o}=t;return o?this._returnResult({data:null,error:o}):r?await er(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,xform:s=>({data:s,error:null})}):this._returnResult({data:null,error:new $s})})}catch(t){if(Ln(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async r=>{const{data:{session:o},error:s}=r;return s?this._returnResult({data:null,error:s}):o?(await er(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:o.access_token,query:{client_id:t.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new $s})})}catch(r){if(Ln(r))return this._returnResult({data:null,error:r});throw r}}async fetchJwk(t,r={keys:[]}){let o=r.keys.find(u=>u.kid===t);if(o)return o;const s=Date.now();if(o=this.jwks.keys.find(u=>u.kid===t),o&&this.jwks_cached_at+DY>s)return o;const{data:l,error:i}=await er(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return!l.keys||l.keys.length===0||(this.jwks=l,this.jwks_cached_at=s,o=l.keys.find(u=>u.kid===t),!o)?null:o}async getClaims(t,r={}){try{let o=t;if(!o){const{data:m,error:y}=await this.getSession();if(y||!m.session)return this._returnResult({data:null,error:y});o=m.session.access_token}const{header:s,payload:l,signature:i,raw:{header:u,payload:c}}=v5(o);r!=null&&r.allowExpired||aK(l.exp);const d=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,r!=null&&r.keys?{keys:r.keys}:r==null?void 0:r.jwks);if(!d){const{error:m}=await this.getUser(o);if(m)throw m;return{data:{claims:l,header:s,signature:i},error:null}}const h=sK(s.alg),f=await crypto.subtle.importKey("jwk",d,h,!0,["verify"]);if(!await crypto.subtle.verify(h,f,i,VY(`${u}.${c}`)))throw new Pb("Invalid JWT signature");return{data:{claims:l,header:s,signature:i},error:null}}catch(o){if(Ln(o))return this._returnResult({data:null,error:o});throw o}}}Mp.nextInstanceID={};const DK=Mp,LK="2.97.0";let Hf="";typeof Deno<"u"?Hf="deno":typeof document<"u"?Hf="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Hf="react-native":Hf="node";const zK={"X-Client-Info":`supabase-js-${Hf}/${LK}`},BK={headers:zK},$K={schema:"public"},qK={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},WK={};function kp(e){"@babel/helpers - typeof";return kp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kp(e)}function HK(e,t){if(kp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var o=r.call(e,t);if(kp(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function GK(e){var t=HK(e,"string");return kp(t)=="symbol"?t:t+""}function VK(e,t,r){return(t=GK(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Gw(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,o)}return r}function Fo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Gw(Object(r),!0).forEach(function(o){VK(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Gw(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}const UK=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),YK=()=>Headers,KK=(e,t,r)=>{const o=UK(r),s=YK();return async(l,i)=>{var u;const c=(u=await t())!==null&&u!==void 0?u:e;let d=new s(i==null?void 0:i.headers);return d.has("apikey")||d.set("apikey",e),d.has("Authorization")||d.set("Authorization",`Bearer ${c}`),o(l,Fo(Fo({},i),{},{headers:d}))}};function XK(e){return e.endsWith("/")?e:e+"/"}function ZK(e,t){var r,o;const{db:s,auth:l,realtime:i,global:u}=e,{db:c,auth:d,realtime:h,global:f}=t,g={db:Fo(Fo({},c),s),auth:Fo(Fo({},d),l),realtime:Fo(Fo({},h),i),storage:{},global:Fo(Fo(Fo({},f),u),{},{headers:Fo(Fo({},(r=f==null?void 0:f.headers)!==null&&r!==void 0?r:{}),(o=u==null?void 0:u.headers)!==null&&o!==void 0?o:{})}),accessToken:async()=>""};return e.accessToken?g.accessToken=e.accessToken:delete g.accessToken,g}function JK(e){const t=e==null?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(XK(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var QK=class extends DK{constructor(e){super(e)}},eX=class{constructor(e,t,r){var o,s;this.supabaseUrl=e,this.supabaseKey=t;const l=JK(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const i=`sb-${l.hostname.split(".")[0]}-auth-token`,u={db:$K,realtime:WK,auth:Fo(Fo({},qK),{},{storageKey:i}),global:BK},c=ZK(r??{},u);if(this.storageKey=(o=c.auth.storageKey)!==null&&o!==void 0?o:"",this.headers=(s=c.global.headers)!==null&&s!==void 0?s:{},c.accessToken)this.accessToken=c.accessToken,this.auth=new Proxy({},{get:(h,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}});else{var d;this.auth=this._initSupabaseAuthClient((d=c.auth)!==null&&d!==void 0?d:{},this.headers,c.global.fetch)}this.fetch=KK(t,this._getAccessToken.bind(this),c.global.fetch),this.realtime=this._initRealtimeClient(Fo({headers:this.headers,accessToken:this._getAccessToken.bind(this)},c.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(h=>this.realtime.setAuth(h)).catch(h=>console.warn("Failed to set initial Realtime auth token:",h)),this.rest=new zU(new URL("rest/v1",l).href,{headers:this.headers,schema:c.db.schema,fetch:this.fetch,timeout:c.db.timeout,urlLengthLimit:c.db.urlLengthLimit}),this.storage=new PY(this.storageUrl.href,this.headers,this.fetch,r==null?void 0:r.storage),c.accessToken||this._listenForAuthEvents()}get functions(){return new IU(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e=this,t,r;if(e.accessToken)return await e.accessToken();const{data:o}=await e.auth.getSession();return(t=(r=o.session)===null||r===void 0?void 0:r.access_token)!==null&&t!==void 0?t:e.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:o,userStorage:s,storageKey:l,flowType:i,lock:u,debug:c,throwOnError:d},h,f){const g={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new QK({url:this.authUrl.href,headers:Fo(Fo({},g),h),storageKey:l,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:o,userStorage:s,flowType:i,lock:u,debug:c,throwOnError:d,fetch:f,hasCustomAuthorizationHeader:Object.keys(this.headers).some(m=>m.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new nY(this.realtimeUrl.href,Fo(Fo({},e),{},{params:Fo(Fo({},{apikey:this.supabaseKey}),e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",t==null?void 0:t.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const tX=(e,t,r)=>new eX(e,t,r);function nX(){if(typeof window<"u")return!1;const e=globalThis.process;if(!e)return!1;const t=e.version;if(t==null)return!1;const r=t.match(/^v(\d+)\./);return r?parseInt(r[1],10)<=18:!1}nX()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const E7="bszwzwfmrqmawgrblvhe",T7="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJzend6d2ZtcnFtYXdncmJsdmhlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4MTY0NTAsImV4cCI6MjA4NzM5MjQ1MH0.n18qb0rZARSiZXpnw6muaL9wTOLi5SZUWbUaTyVuMKo",rX=`https://${E7}.supabase.co/functions/v1/make-server-0834700c`,ap=tX(`https://${E7}.supabase.co`,T7);function oX({onClose:e,onAuthChange:t}){const[r,o]=w.useState("login"),[s,l]=w.useState(""),[i,u]=w.useState(""),[c,d]=w.useState(""),[h,f]=w.useState(!1),[g,m]=w.useState(!1),[y,v]=w.useState(""),[b,S]=w.useState(""),C={width:"100%",padding:"9px 12px",borderRadius:6,background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:"#fff",fontSize:12,outline:"none",fontFamily:"system-ui",boxSizing:"border-box",transition:"border-color 0.15s"},k=async j=>{var T,_,P;if(j.preventDefault(),!s.trim()||!i.trim()){v("Preencha email e senha.");return}m(!0),v("");try{const{data:I,error:$}=await ap.auth.signInWithPassword({email:s.trim(),password:i});if($)throw $;const q=(T=I.session)==null?void 0:T.user,L=(_=I.session)==null?void 0:_.access_token;if(!q||!L)throw new Error("Login falhou  sem sesso.");t({id:q.id,email:q.email,name:(P=q.user_metadata)==null?void 0:P.name,accessToken:L}),S("Login realizado! Colees sincronizadas."),setTimeout(()=>e(),1e3)}catch(I){v(I.message||"Erro ao fazer login.")}finally{m(!1)}},R=async j=>{var T,_,P;if(j.preventDefault(),!s.trim()||!i.trim()){v("Preencha email e senha.");return}if(i.length<6){v("Senha deve ter pelo menos 6 caracteres.");return}m(!0),v("");try{const I=await fetch(`${rX}/auth/signup`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${T7}`},body:JSON.stringify({email:s.trim(),password:i,name:c.trim()||void 0})}),$=await I.json();if(!I.ok||!$.success)throw new Error($.error||"Erro ao criar conta.");const{data:q,error:L}=await ap.auth.signInWithPassword({email:s.trim(),password:i});if(L)throw L;const H=(T=q.session)==null?void 0:T.user,G=(_=q.session)==null?void 0:_.access_token;if(!H||!G)throw new Error("Conta criada mas login falhou. Tente fazer login.");t({id:H.id,email:H.email,name:((P=H.user_metadata)==null?void 0:P.name)||c,accessToken:G}),S("Conta criada! Bem-vindo ao Rhizome."),setTimeout(()=>e(),1e3)}catch(I){v(I.message||"Erro ao criar conta.")}finally{m(!1)}};return a.jsxs("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,0.75)",backdropFilter:"blur(6px)",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"system-ui, sans-serif"},onClick:e,children:[a.jsxs("div",{style:{width:360,background:"rgba(8,5,20,0.98)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:12,padding:"28px 28px 24px",boxShadow:"0 24px 80px rgba(0,0,0,0.7)",position:"relative"},onClick:j=>j.stopPropagation(),children:[a.jsx("button",{title:"Fechar",onClick:e,style:{position:"absolute",top:14,right:14,background:"none",border:"none",cursor:"pointer",color:"rgba(255,255,255,0.3)",padding:4},children:a.jsx(ya,{size:14,strokeWidth:2})}),a.jsxs("div",{style:{marginBottom:22,textAlign:"center"},children:[a.jsx("div",{style:{fontSize:9,letterSpacing:"0.18em",color:"rgba(255,255,255,0.3)",textTransform:"uppercase",marginBottom:6},children:"Tools for Perception"}),a.jsx("div",{style:{fontSize:16,color:"rgba(255,255,255,0.85)",fontWeight:600,marginBottom:4},children:r==="login"?"Entrar":"Criar conta"}),a.jsx("div",{style:{fontSize:10,color:"rgba(255,255,255,0.38)"},children:r==="login"?"Colees sincronizadas entre dispositivos":"Pesquisa rizomtica persistente em todos os dispositivos"})]}),a.jsx("div",{style:{display:"flex",gap:4,marginBottom:20,background:"rgba(255,255,255,0.04)",borderRadius:7,padding:3},children:["login","register"].map(j=>a.jsx("button",{title:j,onClick:()=>{o(j),v(""),S("")},style:{flex:1,padding:"6px 0",borderRadius:5,cursor:"pointer",background:r===j?"rgba(124,58,237,0.3)":"transparent",border:`1px solid ${r===j?"rgba(124,58,237,0.5)":"transparent"}`,color:r===j?"rgba(196,181,253,0.95)":"rgba(255,255,255,0.4)",fontSize:10,fontWeight:r===j?600:400,transition:"all 0.15s"},children:j==="login"?"Entrar":"Cadastrar"},j))}),a.jsxs("form",{onSubmit:r==="login"?k:R,children:[r==="register"&&a.jsxs("div",{style:{marginBottom:12},children:[a.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.4)",letterSpacing:"0.06em",marginBottom:4,textTransform:"uppercase"},children:"Nome (opcional)"}),a.jsx("input",{type:"text",placeholder:"Seu nome",value:c,onChange:j=>d(j.target.value),style:C,onFocus:j=>j.currentTarget.style.borderColor="rgba(124,58,237,0.5)",onBlur:j=>j.currentTarget.style.borderColor="rgba(255,255,255,0.1)"})]}),a.jsxs("div",{style:{marginBottom:12},children:[a.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.4)",letterSpacing:"0.06em",marginBottom:4,textTransform:"uppercase"},children:"Email"}),a.jsx("input",{type:"email",placeholder:"seu@email.com",value:s,onChange:j=>l(j.target.value),style:C,autoFocus:!0,onFocus:j=>j.currentTarget.style.borderColor="rgba(124,58,237,0.5)",onBlur:j=>j.currentTarget.style.borderColor="rgba(255,255,255,0.1)"})]}),a.jsxs("div",{style:{marginBottom:20},children:[a.jsxs("div",{style:{fontSize:9,color:"rgba(255,255,255,0.4)",letterSpacing:"0.06em",marginBottom:4,textTransform:"uppercase"},children:["Senha ",r==="register"&&a.jsx("span",{style:{color:"rgba(255,255,255,0.25)"},children:"(mn. 6 caracteres)"})]}),a.jsxs("div",{style:{position:"relative"},children:[a.jsx("input",{type:h?"text":"password",placeholder:"",value:i,onChange:j=>u(j.target.value),style:{...C,paddingRight:36},onFocus:j=>j.currentTarget.style.borderColor="rgba(124,58,237,0.5)",onBlur:j=>j.currentTarget.style.borderColor="rgba(255,255,255,0.1)"}),a.jsx("button",{title:h?"Esconder senha":"Mostrar senha",type:"button",onClick:()=>f(j=>!j),style:{position:"absolute",right:10,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"rgba(255,255,255,0.3)"},children:h?a.jsx(Ag,{size:12}):a.jsx(vl,{size:12})})]})]}),y&&a.jsx("div",{style:{marginBottom:14,padding:"8px 12px",borderRadius:6,background:"rgba(239,68,68,0.1)",border:"1px solid rgba(239,68,68,0.25)",fontSize:10,color:"rgba(252,165,165,0.9)",lineHeight:1.4},children:y}),b&&a.jsx("div",{style:{marginBottom:14,padding:"8px 12px",borderRadius:6,background:"rgba(34,197,94,0.1)",border:"1px solid rgba(34,197,94,0.25)",fontSize:10,color:"rgba(134,239,172,0.9)"},children:b}),a.jsx("button",{title:g?"Carregando...":r==="login"?"Entrar":"Criar conta",type:"submit",disabled:g,style:{width:"100%",padding:"10px 0",borderRadius:7,cursor:g?"not-allowed":"pointer",background:g?"rgba(124,58,237,0.1)":"rgba(124,58,237,0.25)",border:`1px solid ${g?"rgba(124,58,237,0.2)":"rgba(124,58,237,0.5)"}`,color:g?"rgba(196,181,253,0.5)":"rgba(196,181,253,0.95)",fontSize:11,fontWeight:600,letterSpacing:"0.06em",display:"flex",alignItems:"center",justifyContent:"center",gap:7,transition:"all 0.15s"},children:g?a.jsxs(a.Fragment,{children:[a.jsx("span",{style:{fontSize:11,animation:"spin 1s linear infinite",display:"inline-block"},children:""}),r==="login"?"Entrando...":"Criando conta..."]}):r==="login"?a.jsxs(a.Fragment,{children:[a.jsx(sE,{size:11,strokeWidth:2})," Entrar"]}):a.jsxs(a.Fragment,{children:[a.jsx(lT,{size:11,strokeWidth:2})," Criar conta"]})})]}),a.jsxs("div",{style:{marginTop:16,fontSize:8,color:"rgba(255,255,255,0.2)",textAlign:"center",lineHeight:1.5},children:["Colees, pastas e mapas rizomticos sincronizados entre dispositivos.",a.jsx("br",{}),"Sem conta, dados ficam apenas neste browser."]})]}),a.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})}function aX(){const[e,t]=Yt.useState(null),[r,o]=Yt.useState(!0);return Yt.useEffect(()=>{ap.auth.getSession().then(({data:{session:i}})=>{var u;i!=null&&i.user&&(i!=null&&i.access_token)&&t({id:i.user.id,email:i.user.email,name:(u=i.user.user_metadata)==null?void 0:u.name,accessToken:i.access_token}),o(!1)});const{data:{subscription:l}}=ap.auth.onAuthStateChange((i,u)=>{var c;u!=null&&u.user&&(u!=null&&u.access_token)?t({id:u.user.id,email:u.user.email,name:(c=u.user.user_metadata)==null?void 0:c.name,accessToken:u.access_token}):t(null)});return()=>l.unsubscribe()},[]),{user:e,loading:r,signOut:async()=>{await ap.auth.signOut(),t(null)},setUser:t}}const Bv="'Doto', monospace",Xr="'IBM Plex Mono', monospace",sX=[{name:"Mono Dark",swatch:"#e0e0e0",ae:{bgColor:"#000000",nodeColor:"#e0e0e0",entryColor:"#ffffff",hubColor:"#b0b0b0",hotColor:"#ffffff",linkColor:"#2a2a2a",flightColor:"#555555",labelColor:"#ffffff",glowIntensity:0}},{name:"Mono Light",swatch:"#111111",ae:{bgColor:"#f0f0f0",nodeColor:"#111111",entryColor:"#000000",hubColor:"#444444",hotColor:"#222222",linkColor:"#cccccc",flightColor:"#888888",labelColor:"#111111",glowIntensity:0}},{name:"Cyber",swatch:"#00ff66",ae:{bgColor:"#000000",nodeColor:"#00ff66",entryColor:"#d8f2ff",hubColor:"#3aa3ff",hotColor:"#ff9b3a",linkColor:"#00ff66",flightColor:"#ff3bd5",labelColor:"#ffffff"}},{name:"Violet",swatch:"#a78bfa",ae:{bgColor:"#05020e",nodeColor:"#a78bfa",entryColor:"#f0e6ff",hubColor:"#ec4899",hotColor:"#fbbf24",linkColor:"#7c3aed",flightColor:"#f472b6",labelColor:"#ffffff"}},{name:"Ochre",swatch:"#fbbf24",ae:{bgColor:"#0a0800",nodeColor:"#fbbf24",entryColor:"#fff7ed",hubColor:"#f97316",hotColor:"#ef4444",linkColor:"#d97706",flightColor:"#fb923c",labelColor:"#ffffff"}},{name:"Arctic",swatch:"#38bdf8",ae:{bgColor:"#00060f",nodeColor:"#38bdf8",entryColor:"#e0f2fe",hubColor:"#818cf8",hotColor:"#34d399",linkColor:"#0ea5e9",flightColor:"#a78bfa",labelColor:"#ffffff"}},{name:"Blood",swatch:"#ef4444",ae:{bgColor:"#040000",nodeColor:"#ef4444",entryColor:"#fef2f2",hubColor:"#f87171",hotColor:"#fbbf24",linkColor:"#dc2626",flightColor:"#fb923c",labelColor:"#ffffff"}}];function zs({label:e,value:t,min:r=0,max:o=1,step:s=.01,tooltip:l,onChange:i}){const[u,c]=w.useState(!1);return a.jsxs("div",{style:{marginBottom:6},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:2,position:"relative"},children:[a.jsxs("span",{style:{fontSize:9,color:"rgba(255,255,255,0.45)",letterSpacing:"0.06em",textTransform:"uppercase",fontFamily:Xr,display:"flex",alignItems:"center",gap:4},children:[e,l&&a.jsx("span",{style:{cursor:"help",display:"flex",alignItems:"center"},onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:a.jsx(H9,{size:8,strokeWidth:1.5,style:{opacity:.25}})})]}),a.jsx("span",{style:{fontSize:8,color:"rgba(255,255,255,0.22)",fontFamily:Xr},children:t.toFixed(s<.1?2:0)}),u&&l&&a.jsx("div",{style:{position:"absolute",left:0,top:-44,zIndex:200,background:"rgba(0,0,0,0.97)",border:"1px dashed rgba(255,255,255,0.08)",borderRadius:1,padding:"5px 8px",fontSize:8,maxWidth:220,color:"rgba(255,255,255,0.55)",lineHeight:1.5,pointerEvents:"none",fontFamily:Xr},children:l})]}),a.jsx("input",{type:"range",min:r,max:o,step:s,value:t,onChange:d=>i(parseFloat(d.target.value)),style:{width:"100%",height:2,accentColor:"#10d45b",cursor:"pointer"}})]})}function J0({title:e,open:t,onToggle:r,children:o,accent:s="rgba(255,255,255,0.18)"}){return a.jsxs("div",{style:{borderTop:"1px dashed rgba(255,255,255,0.06)",paddingTop:10,marginTop:10},children:[a.jsxs("button",{title:"Expandir",onClick:r,style:{background:"none",border:"none",cursor:"pointer",color:s,fontSize:11,display:"flex",alignItems:"center",gap:5,padding:0,letterSpacing:"0.08em",textTransform:"uppercase",width:"100%",textAlign:"left",fontFamily:Bv},children:[t?a.jsx(Pa,{size:9}):a.jsx(aa,{size:9}),e]}),t&&a.jsx("div",{style:{marginTop:10},children:o})]})}function Oc({label:e,value:t,onChange:r}){return a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:5},children:[a.jsx("span",{style:{fontSize:8,color:"rgba(255,255,255,0.38)",letterSpacing:"0.06em",textTransform:"uppercase",fontFamily:Xr},children:e}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:4,cursor:"pointer"},children:[a.jsx("div",{style:{width:18,height:18,borderRadius:1,background:t,border:"1px dashed rgba(255,255,255,0.12)",flexShrink:0}}),a.jsx("input",{type:"color",value:t,onChange:o=>r(o.target.value),style:{opacity:0,position:"absolute",width:18,height:18,cursor:"pointer"}})]})]})}function iX({recState:e,elapsed:t,onStart:r,onStop:o,actualFmt:s}){const[l,i]=w.useState("auto"),[u,c]=w.useState("standard"),d=Gk(),h=f=>({padding:"3px 6px",borderRadius:1,fontSize:8,fontFamily:Xr,cursor:"pointer",background:f?"rgba(16,212,91,0.12)":"rgba(255,255,255,0.03)",border:`1px dashed ${f?"rgba(16,212,91,0.35)":"rgba(255,255,255,0.06)"}`,color:f?"rgba(255,255,255,0.80)":"rgba(255,255,255,0.30)",letterSpacing:"0.04em",textTransform:"uppercase",marginRight:3,marginBottom:3});return e==="saving"?a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"6px 0"},children:[a.jsx("span",{style:{width:6,height:6,borderRadius:"50%",background:"#fbbf24",animation:"pulse 1s infinite"}}),a.jsx("span",{style:{fontSize:9,color:"rgba(251,191,36,0.6)",fontFamily:"monospace",letterSpacing:"0.06em"},children:"SALVANDO"})]}):e==="recording"?a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:5},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[a.jsx("span",{style:{width:7,height:7,borderRadius:2,background:"#ef4444",animation:"pulse 0.8s infinite"}}),a.jsx("span",{style:{fontSize:10,color:"#ef4444",fontFamily:"monospace"},children:Sv(t)}),a.jsx("span",{style:{fontSize:8,color:"rgba(239,68,68,0.5)",letterSpacing:"0.08em"},children:s})]}),a.jsxs("button",{title:"Parar gravao",onClick:o,style:{width:"100%",padding:"5px 0",borderRadius:4,background:"rgba(239,68,68,0.15)",border:"1px solid rgba(239,68,68,0.35)",color:"rgba(239,68,68,0.8)",fontSize:10,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:4},children:[a.jsx("span",{children:""})," Parar Gravao"]})]}):a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:7},children:[a.jsxs("div",{children:[a.jsx("div",{style:{fontSize:8,color:"rgba(255,255,255,0.22)",letterSpacing:"0.07em",textTransform:"uppercase",marginBottom:4},children:"Formato"}),a.jsx("div",{style:{display:"flex",flexWrap:"wrap"},children:["auto","webm","mp4","mov"].map(f=>a.jsxs("button",{title:sg[f],style:h(l===f),onClick:()=>i(f),children:[sg[f],(f==="mp4"||f==="mov")&&!d&&a.jsx("span",{style:{fontSize:7,color:"rgba(251,191,36,0.5)",marginLeft:2},children:"*"})]},f))}),(l==="mp4"||l==="mov")&&!d&&a.jsxs("div",{style:{fontSize:8,color:"rgba(251,191,36,0.5)",lineHeight:1.4,marginTop:2},children:["* Seu browser no suporta MP4 nativo. Ser salvo como WebM.",a.jsx("br",{}),"Converta: ",a.jsx("span",{style:{fontFamily:"monospace"},children:"ffmpeg -i rec.webm out.mp4"})]})]}),a.jsxs("div",{children:[a.jsx("div",{style:{fontSize:8,color:"rgba(255,255,255,0.22)",letterSpacing:"0.07em",textTransform:"uppercase",marginBottom:4},children:"Qualidade"}),a.jsx("div",{style:{display:"flex",flexWrap:"wrap"},children:["draft","standard","high","ultra"].map(f=>a.jsx("button",{title:f,style:h(u===f),onClick:()=>c(f),children:f},f))})]}),a.jsxs("button",{title:"Iniciar gravao",onClick:()=>r(l,u),style:{width:"100%",padding:"6px 0",borderRadius:4,background:"rgba(124,58,237,0.18)",border:"1px solid rgba(124,58,237,0.35)",color:"rgba(196,181,253,0.85)",fontSize:10,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:5},children:[a.jsx(dT,{size:10,strokeWidth:1.5}),"Iniciar Gravao"]})]})}function lX({onClose:e}){const t=Object.keys(Sh),[r,o]=w.useState("concepts"),[s,l]=w.useState(()=>({concepts:K0.concepts,names_only:K0.names_only,person_theory:K0.person_theory,study_order:K0.study_order,controversies:K0.controversies,keywords:K0.keywords})),i=()=>{for(const c of t)K0[c]=s[c];e()},u=Sh[r];return a.jsx("div",{style:{position:"fixed",inset:0,zIndex:999,background:"rgba(0,0,0,0.82)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:e,children:a.jsxs("div",{style:{width:680,maxHeight:"85vh",display:"flex",flexDirection:"column",background:"#000",border:"1px dashed rgba(255,255,255,0.06)",borderRadius:1,overflow:"hidden",boxShadow:"0 24px 80px rgba(0,0,0,0.6)"},onClick:c=>c.stopPropagation(),children:[a.jsxs("div",{style:{padding:"14px 18px",borderBottom:"1px dashed rgba(255,255,255,0.06)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx(_d,{size:12,strokeWidth:1.5,style:{color:"rgba(196,181,253,0.7)"}}),a.jsx("span",{style:{fontSize:11,color:"rgba(255,255,255,0.7)",letterSpacing:"0.06em"},children:"EDITOR DE PROMPTS"})]}),a.jsx("button",{title:"Fechar",onClick:e,style:{background:"none",border:"none",color:"rgba(255,255,255,0.3)",cursor:"pointer",fontSize:16},children:""})]}),a.jsxs("div",{style:{display:"flex",flex:1,overflow:"hidden"},children:[a.jsx("div",{style:{width:140,borderRight:"1px solid rgba(255,255,255,0.06)",padding:"8px 0",flexShrink:0,overflowY:"auto"},children:t.map(c=>{const d=Sh[c],h=c===r;return a.jsxs("button",{title:c,onClick:()=>o(c),style:{width:"100%",padding:"8px 14px",textAlign:"left",border:"none",borderLeft:`2px solid ${h?"rgba(196,181,253,0.7)":"transparent"}`,background:h?"rgba(255,255,255,0.04)":"none",color:h?"rgba(255,255,255,0.8)":"rgba(255,255,255,0.35)",cursor:"pointer",fontSize:10,display:"flex",alignItems:"center",gap:7,transition:"all 0.1s"},children:[a.jsx("span",{style:{fontFamily:"monospace",fontSize:11,opacity:.7},children:d.icon}),a.jsx("span",{children:d.label})]},c)})}),a.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",padding:"12px 16px",overflow:"hidden"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[a.jsxs("div",{children:[a.jsx("div",{style:{fontSize:11,color:"rgba(255,255,255,0.65)"},children:u.label}),a.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.28)",marginTop:2},children:u.hint})]}),a.jsx("div",{style:{display:"flex",gap:6},children:a.jsxs("div",{style:{fontSize:8,color:"rgba(255,255,255,0.22)",fontFamily:"monospace",alignSelf:"center"},children:["{TOPIC}"," ","{COUNT}"," ","{DEPTH}"]})})]}),a.jsx("textarea",{value:s[r],onChange:c=>l(d=>({...d,[r]:c.target.value})),style:{flex:1,resize:"none",fontFamily:"'IBM Plex Mono', monospace",fontSize:10,background:"rgba(255,255,255,0.03)",border:"1px dashed rgba(255,255,255,0.06)",borderRadius:1,padding:"10px 12px",color:"rgba(255,255,255,0.7)",outline:"none",lineHeight:1.6,minHeight:280}})]})]}),a.jsxs("div",{style:{padding:"10px 18px",borderTop:"1px dashed rgba(255,255,255,0.06)",display:"flex",justifyContent:"flex-end",gap:8},children:[a.jsx("button",{onClick:e,style:{padding:"6px 14px",borderRadius:1,background:"none",border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.35)",fontSize:10,cursor:"pointer"},children:"Cancelar"}),a.jsxs("button",{title:"Configuraes",onClick:i,style:{padding:"6px 16px",borderRadius:1,background:"rgba(16,212,91,0.08)",border:"1px dashed rgba(16,212,91,0.35)",color:"rgba(16,212,91,0.9)",fontSize:10,cursor:"pointer",display:"flex",alignItems:"center",gap:6},children:[a.jsx(_d,{size:9,strokeWidth:1.5}),"Salvar Prompts"]})]})]})})}const Vw=[{id:"gpt-5",label:"GPT-5           frontier",group:"GPT-5"},{id:"gpt-5-mini",label:"GPT-5 mini      rpido ",group:"GPT-5"},{id:"gpt-4.5-preview",label:"GPT-4.5         qualidade",group:"GPT-4.5"},{id:"gpt-4.1-nano",label:"GPT-4.1 nano    ultra-rpido ",group:"GPT-4.1"},{id:"gpt-4.1-mini",label:"GPT-4.1 mini    rpido ",group:"GPT-4.1"},{id:"gpt-4.1",label:"GPT-4.1         qualidade",group:"GPT-4.1"},{id:"gpt-4o-mini",label:"GPT-4o mini     rpido ",group:"GPT-4o"},{id:"gpt-4o",label:"GPT-4o          qualidade",group:"GPT-4o"},{id:"o4-mini",label:"o4-mini         raciocnio ",group:"Raciocnio"},{id:"o3-mini",label:"o3-mini         raciocnio",group:"Raciocnio"},{id:"o3",label:"o3              raciocnio+",group:"Raciocnio"},{id:"gpt-3.5-turbo",label:"GPT-3.5         legado",group:"Legado"}];function cX({onGenerate:e,onClear:t,hasLLMNodes:r,onOpenPromptEditor:o,provider:s,setProvider:l,apiKey:i,setApiKey:u,modelId:c,setModelId:d,llmMode:h,setLlmMode:f}){const[g,m]=w.useState(""),[y,v]=w.useState("medium"),[b,S]=w.useState(22),[C,k]=w.useState(!1),R={width:"100%",padding:"5px 7px",borderRadius:1,fontSize:10,background:"rgba(255,255,255,0.04)",border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.7)",outline:"none",fontFamily:"'IBM Plex Mono', monospace",boxSizing:"border-box"},j={fontSize:8,color:"rgba(255,255,255,0.28)",letterSpacing:"0.07em",textTransform:"uppercase",marginBottom:3,display:"block"},T=()=>{if(!g.trim())return;const I={topic:g.trim(),depth:y,nodeCount:b,provider:s,apiKey:i||void 0,modelId:c||void 0,llmMode:h};e(I)},_=Object.keys(Sh),P=Sh[h];return a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[a.jsxs("div",{style:{position:"relative"},children:[a.jsx("input",{style:{...R,padding:"9px 38px 9px 12px",fontSize:11,borderRadius:7,border:"1px solid rgba(255,255,255,0.13)",background:"rgba(255,255,255,0.05)",color:"#fff",transition:"border-color 0.15s"},placeholder:"Tpico, conceito, pessoa...",value:g,onChange:I=>m(I.target.value),onKeyDown:I=>{I.key==="Enter"&&T()},onFocus:I=>I.currentTarget.style.borderColor="rgba(196,181,253,0.45)",onBlur:I=>I.currentTarget.style.borderColor="rgba(255,255,255,0.13)"}),a.jsx("button",{onClick:T,style:{position:"absolute",right:5,top:"50%",transform:"translateY(-50%)",background:"rgba(124,58,237,0.35)",border:"1px solid rgba(124,58,237,0.5)",borderRadius:5,padding:"3px 7px",cursor:"pointer",color:"rgba(196,181,253,0.9)",display:"flex",alignItems:"center"},title:"Gerar Rizoma (Enter)",children:a.jsx(Yi,{size:10,strokeWidth:1.5})})]}),a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:5},children:[a.jsx("span",{style:j,children:"Modo"}),a.jsxs("button",{onClick:o,title:"Editar prompts",style:{background:"none",border:"none",cursor:"pointer",color:"rgba(255,255,255,0.22)",display:"flex",alignItems:"center",gap:3,fontSize:8,padding:0},onMouseEnter:I=>I.currentTarget.style.color="rgba(196,181,253,0.6)",onMouseLeave:I=>I.currentTarget.style.color="rgba(255,255,255,0.22)",children:[a.jsx(_d,{size:8,strokeWidth:1.5})," prompts"]})]}),a.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:3},children:_.map(I=>{const $=Sh[I],q=I===h;return a.jsxs("button",{onClick:()=>f(I),title:$.hint,style:{padding:"5px 7px",borderRadius:5,cursor:"pointer",textAlign:"left",background:q?"rgba(124,58,237,0.2)":"rgba(255,255,255,0.02)",border:`1px solid ${q?"rgba(124,58,237,0.5)":"rgba(255,255,255,0.06)"}`,color:q?"rgba(196,181,253,0.92)":"rgba(255,255,255,0.35)",fontSize:9,display:"flex",alignItems:"center",gap:5,transition:"all 0.12s"},onMouseEnter:L=>{q||(L.currentTarget.style.borderColor="rgba(255,255,255,0.14)",L.currentTarget.style.color="rgba(255,255,255,0.55)")},onMouseLeave:L=>{q||(L.currentTarget.style.borderColor="rgba(255,255,255,0.06)",L.currentTarget.style.color="rgba(255,255,255,0.35)")},children:[a.jsx("span",{style:{fontFamily:"monospace",fontSize:10},children:$.icon}),$.label]},I)})}),a.jsx("div",{style:{fontSize:8,color:"rgba(196,181,253,0.4)",marginTop:4,fontStyle:"italic"},children:P.hint})]}),a.jsxs("div",{style:{display:"flex",gap:6},children:[a.jsxs("div",{style:{flex:1},children:[a.jsx("span",{style:j,children:"Profundidade"}),a.jsx("div",{style:{display:"flex",gap:2},children:["shallow","medium","deep"].map(I=>a.jsx("button",{title:`Profundidade ${I}`,onClick:()=>v(I),style:{flex:1,padding:"3px 0",borderRadius:3,fontSize:8,cursor:"pointer",fontFamily:"monospace",background:y===I?"rgba(124,58,237,0.25)":"rgba(255,255,255,0.03)",border:`1px solid ${y===I?"rgba(124,58,237,0.45)":"rgba(255,255,255,0.07)"}`,color:y===I?"rgba(196,181,253,0.9)":"rgba(255,255,255,0.28)",transition:"all 0.1s"},children:I==="shallow"?"Raso":I==="medium"?"Med.":"Fundo"},I))})]}),a.jsxs("div",{style:{width:60},children:[a.jsx("span",{style:j,children:"Ns"}),a.jsx("input",{type:"number",min:8,max:60,value:b,onChange:I=>S(Math.max(8,Math.min(60,parseInt(I.target.value)||18))),style:{...R,width:"100%",padding:"3px 6px",textAlign:"center"}})]})]}),a.jsxs("div",{children:[a.jsxs("button",{title:"Expandir",onClick:()=>k(I=>!I),style:{background:"none",border:"none",cursor:"pointer",color:"rgba(255,255,255,0.25)",fontSize:9,display:"flex",alignItems:"center",gap:4,padding:0,letterSpacing:"0.05em"},onMouseEnter:I=>I.currentTarget.style.color="rgba(255,255,255,0.5)",onMouseLeave:I=>I.currentTarget.style.color="rgba(255,255,255,0.25)",children:[C?a.jsx(Pa,{size:8}):a.jsx(aa,{size:8}),"Modelo / API Key"]}),C&&a.jsxs("div",{style:{marginTop:7,display:"flex",flexDirection:"column",gap:6},children:[a.jsxs("div",{children:[a.jsx("span",{style:j,children:"Provedor"}),a.jsxs("select",{value:s,onChange:I=>l(I.target.value),style:{...R,cursor:"pointer"},children:[a.jsx("option",{value:"openai",children:"OpenAI"}),a.jsx("option",{value:"anthropic",children:"Anthropic (Claude)"}),a.jsx("option",{value:"ollama",children:"Ollama (local)"}),a.jsx("option",{value:"custom",children:"Custom endpoint"})]})]}),a.jsxs("div",{children:[a.jsx("span",{style:j,children:"Modelo"}),s==="openai"?a.jsx("select",{value:c||"gpt-4.1-mini",onChange:I=>d(I.target.value),style:{...R,cursor:"pointer"},children:[...new Set(Vw.map($=>$.group))].map($=>a.jsx("optgroup",{label:$,children:Vw.filter(q=>q.group===$).map(q=>a.jsx("option",{value:q.id,children:q.label},q.id))},$))}):a.jsx("input",{style:R,placeholder:s==="anthropic"?"claude-3-5-haiku-20241022":s==="ollama"?"llama3.2":"model-id",value:c,onChange:I=>d(I.target.value)})]}),a.jsxs("div",{children:[a.jsxs("span",{style:j,children:["API Key ",s==="ollama"?"(no necessria)":""]}),a.jsx("input",{style:R,type:"password",placeholder:s==="openai"?"sk-...":s==="anthropic"?"sk-ant-...":"(no necessria)",value:i,onChange:I=>u(I.target.value)}),a.jsx("div",{style:{fontSize:7,color:"rgba(255,255,255,0.18)",marginTop:2},children:"Chave processada localmente. Streaming ativo para OpenAI."})]})]})]}),a.jsxs("div",{style:{display:"flex",gap:5},children:[a.jsxs("button",{title:"Gerar rizoma",onClick:T,style:{flex:1,padding:"8px 0",borderRadius:6,cursor:"pointer",background:"rgba(124,58,237,0.22)",border:"1px solid rgba(124,58,237,0.45)",color:"rgba(196,181,253,0.9)",fontSize:10,display:"flex",alignItems:"center",justifyContent:"center",gap:6,transition:"all 0.12s"},onMouseEnter:I=>{I.currentTarget.style.background="rgba(124,58,237,0.35)",I.currentTarget.style.borderColor="rgba(124,58,237,0.65)"},onMouseLeave:I=>{I.currentTarget.style.background="rgba(124,58,237,0.22)",I.currentTarget.style.borderColor="rgba(124,58,237,0.45)"},children:[a.jsx(Yi,{size:10,strokeWidth:1.5}),"Gerar Rizoma"]}),r&&a.jsx("button",{title:"Limpar",onClick:t,style:{padding:"8px 10px",borderRadius:6,cursor:"pointer",background:"rgba(239,68,68,0.06)",border:"1px solid rgba(239,68,68,0.18)",color:"rgba(239,68,68,0.55)",display:"flex",alignItems:"center",transition:"all 0.12s"},onMouseEnter:I=>{I.currentTarget.style.background="rgba(239,68,68,0.14)",I.currentTarget.style.borderColor="rgba(239,68,68,0.35)"},onMouseLeave:I=>{I.currentTarget.style.background="rgba(239,68,68,0.06)",I.currentTarget.style.borderColor="rgba(239,68,68,0.18)"},children:a.jsx(o0,{size:9,strokeWidth:1.5})})]})]})}function dX({node:e,allNodes:t,onClose:r,onExpand:o,onSave:s}){const l=e.connectionsLabels?e.connectionsLabels:Array.from(e.connections.keys()).map(h=>{var f;return(f=t.find(g=>g.id===h))==null?void 0:f.label}).filter(Boolean),i=e.category?(()=>{const h={philosophy:"#a78bfa",science:"#38bdf8",mathematics:"#fb923c",history:"#fbbf24",art:"#f472b6",politics:"#4ade80",economics:"#34d399",psychology:"#c084fc",biology:"#86efac",physics:"#60a5fa",default:"#00ff66"},f=e.category.toLowerCase();for(const[m,y]of Object.entries(h))if(f.includes(m))return y;let g=0;for(let m=0;m<e.category.length;m++)g=g*31+e.category.charCodeAt(m)&16777215;return`hsl(${g%360},70%,60%)`})():"#00ff66",u=encodeURIComponent(e.label??""),c=(e.category??"").toLowerCase(),d=[{label:"Wikipedia",icon:"W",url:`https://en.wikipedia.org/wiki/Special:Search?search=${u}`,color:"#e2e8f0"},{label:"Scholar",icon:"",url:`https://scholar.google.com/scholar?q=${u}`,color:"#60a5fa"},{label:"YouTube",icon:"",url:`https://www.youtube.com/results?search_query=${u}`,color:"#f87171"}];return c.includes("philos")||c.includes("concept")||c.includes("theory")||c.includes("method")?d.push({label:"SEP",icon:"",url:`https://plato.stanford.edu/search/searcher.py?query=${u}`,color:"#a78bfa"}):c.includes("physic")||c.includes("math")||c.includes("science")||c.includes("bio")?d.push({label:"arXiv",icon:"",url:`https://arxiv.org/search/?query=${u}&searchtype=all`,color:"#fb923c"}):c.includes("histor")||c.includes("art")||c.includes("cultur")?d.push({label:"JSTOR",icon:"J",url:`https://www.jstor.org/action/doBasicSearch?Query=${u}`,color:"#fbbf24"}):d.push({label:"Google",icon:"",url:`https://www.google.com/search?q=${u}`,color:"#4ade80"}),a.jsxs("div",{style:{position:"absolute",bottom:20,left:20,width:280,background:"rgba(0,0,0,0.97)",border:`1px dashed ${i}35`,borderRadius:1,padding:"14px 16px",zIndex:100,fontFamily:Xr,boxShadow:`0 0 24px ${i}15`},children:[a.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",marginBottom:8},children:[a.jsxs("div",{children:[a.jsx("div",{style:{fontSize:14,color:"#fff",marginBottom:4,lineHeight:1.2,fontFamily:Bv,letterSpacing:"0.04em"},children:e.label}),e.category&&a.jsx("div",{style:{display:"inline-block",fontSize:7,padding:"2px 6px",borderRadius:1,background:`${i}15`,border:`1px dashed ${i}40`,color:i,letterSpacing:"0.08em",textTransform:"uppercase"},children:e.category})]}),a.jsx("button",{title:"Fechar",onClick:r,style:{background:"none",border:"none",color:"rgba(255,255,255,0.3)",cursor:"pointer",padding:2,fontSize:14,lineHeight:1},children:""})]}),e.description&&a.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.55)",lineHeight:1.6,marginBottom:10,padding:"6px 8px",background:"rgba(255,255,255,0.03)",borderRadius:1,borderLeft:`2px dashed ${i}50`},children:e.description}),l.length>0&&a.jsxs("div",{style:{marginBottom:10},children:[a.jsxs("div",{style:{fontSize:7,color:"rgba(255,255,255,0.25)",letterSpacing:"0.08em",textTransform:"uppercase",marginBottom:5},children:["Conexes (",l.length,")"]}),a.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:3},children:[l.slice(0,8).map(h=>a.jsx("span",{style:{fontSize:7,padding:"2px 6px",borderRadius:1,background:"rgba(255,255,255,0.04)",border:"1px dashed rgba(255,255,255,0.08)",color:"rgba(255,255,255,0.50)"},children:h},h)),l.length>8&&a.jsxs("span",{style:{fontSize:7,color:"rgba(255,255,255,0.22)",padding:"2px 4px"},children:["+",l.length-8]})]})]}),a.jsxs("div",{style:{marginBottom:10},children:[a.jsx("div",{style:{fontSize:7,color:"rgba(255,255,255,0.25)",letterSpacing:"0.08em",textTransform:"uppercase",marginBottom:6,fontFamily:Xr},children:"Explorar"}),a.jsx("div",{style:{display:"flex",gap:4,flexWrap:"wrap"},children:d.map(h=>a.jsxs("a",{href:h.url,target:"_blank",rel:"noopener noreferrer",title:`Pesquisar "${e.label}" no ${h.label}`,style:{display:"inline-flex",alignItems:"center",gap:4,padding:"3px 8px",borderRadius:1,background:`${h.color}0A`,border:`1px dashed ${h.color}25`,color:h.color,fontSize:8,textDecoration:"none",cursor:"pointer",fontFamily:Xr,letterSpacing:"0.05em",textTransform:"uppercase"},onMouseEnter:f=>{f.currentTarget.style.background=`${h.color}25`,f.currentTarget.style.borderColor=`${h.color}60`},onMouseLeave:f=>{f.currentTarget.style.background=`${h.color}12`,f.currentTarget.style.borderColor=`${h.color}30`},children:[a.jsx("span",{style:{fontFamily:"monospace",fontSize:10,lineHeight:1,opacity:.85},children:h.icon}),h.label]},h.label))})]}),a.jsxs("button",{title:"Expandir n",onClick:()=>{o(e),r()},style:{marginTop:8,marginBottom:6,width:"100%",padding:"7px 0",borderRadius:1,cursor:"pointer",fontFamily:Xr,background:"rgba(124,58,237,0.10)",border:"1px dashed rgba(124,58,237,0.35)",color:"rgba(196,181,253,0.85)",fontSize:9,display:"flex",alignItems:"center",justifyContent:"center",gap:6,transition:"all 0.15s",letterSpacing:"0.04em",textTransform:"uppercase"},onMouseEnter:h=>{h.currentTarget.style.background="rgba(124,58,237,0.22)",h.currentTarget.style.borderColor="rgba(124,58,237,0.55)"},onMouseLeave:h=>{h.currentTarget.style.background="rgba(124,58,237,0.10)",h.currentTarget.style.borderColor="rgba(124,58,237,0.35)"},children:[a.jsx(Yi,{size:9,strokeWidth:1.5}),"Expandir  ",a.jsxs("span",{style:{maxWidth:120,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:['"',e.label,'"']})]}),a.jsxs("button",{title:"Salvar n",onClick:()=>s(e),style:{marginBottom:8,width:"100%",padding:"6px 0",borderRadius:1,cursor:"pointer",fontFamily:Xr,background:"rgba(34,197,94,0.08)",border:"1px dashed rgba(34,197,94,0.25)",color:"rgba(134,239,172,0.80)",fontSize:9,display:"flex",alignItems:"center",justifyContent:"center",gap:6,transition:"all 0.15s",letterSpacing:"0.04em",textTransform:"uppercase"},onMouseEnter:h=>{h.currentTarget.style.background="rgba(34,197,94,0.16)",h.currentTarget.style.borderColor="rgba(34,197,94,0.45)"},onMouseLeave:h=>{h.currentTarget.style.background="rgba(34,197,94,0.08)",h.currentTarget.style.borderColor="rgba(34,197,94,0.25)"},children:[a.jsx(Bb,{size:9,strokeWidth:1.5}),"Salvar em Coleo"]}),a.jsxs("div",{style:{fontSize:8,color:"rgba(255,255,255,0.18)",lineHeight:1.5,borderTop:"1px solid rgba(255,255,255,0.06)",paddingTop:8,fontStyle:"italic"},children:[" Descries geradas pela LLM  ",a.jsx("b",{style:{color:"rgba(251,191,36,0.45)"},children:"verifique fontes primrias"}),"."]})]})}const uX=({active:e})=>{var sa,So,Oo;const t=w.useRef(null),r=w.useRef(0),o=w.useRef(null),s=w.useRef(0),[l,i]=w.useState({...ZV}),[u,c]=w.useState({..._v}),[d,h]=w.useState(null),[f,g]=w.useState({W:window.innerWidth,H:window.innerHeight}),[m,y]=w.useState(!1),[v,b]=w.useState(!1),[S,C]=w.useState("idle"),[k,R]=w.useState(""),[j,T]=w.useState(""),[_,P]=w.useState(""),[I,$]=w.useState(null),[q,L]=w.useState(!1),[H,G]=w.useState(!0),[oe,le]=w.useState(!1),[pe,ce]=w.useState(!1),{user:te,signOut:F,setUser:Q}=aX(),ae=w.useRef({...Iu}),[we,Re]=w.useState({...Iu}),ge=w.useRef({active:!1,startX:0,startY:0,startRotX:0,startRotY:0,startRotZ:0,isRoll:!1}),Ae=w.useRef(0),tt=w.useRef(""),[We,J]=w.useState(!1),[ke,Le]=w.useState(!1),[K,et]=w.useState(!1),[dt,Rt]=w.useState(!0),[Wt,Zt]=w.useState(!1),$e=w.useRef(null),[Ze,Fe]=w.useState("idle"),[Xe,jt]=w.useState(0),[hn,an]=w.useState("WebM"),[it,kt]=w.useState([]),[On,sn]=w.useState([]),[Xn,Pt]=w.useState(!1),[zt,jn]=w.useState(!0),[En,lt]=w.useState(null),[ht,_t]=w.useState(new Map),[Ie,at]=w.useState("openai"),[St,ye]=w.useState(""),[xe,gt]=w.useState("gpt-4.1-mini"),[Ge,Ye]=w.useState("concepts"),Ve=w.useRef(l),Oe=w.useRef(u),Gt=w.useRef(!1),Kt=w.useRef(!0),fn=w.useRef("idle"),zn=w.useRef("openai"),rt=w.useRef(""),mt=w.useRef("gpt-4.1-mini"),yt=w.useRef({zoom:1,panX:0,panY:0}),[Et,Ft]=w.useState(1),me=w.useRef({active:!1,startX:0,startY:0,startPanX:0,startPanY:0,moved:!1});w.useEffect(()=>{Ve.current=l},[l]),w.useEffect(()=>{Oe.current=u},[u]),w.useEffect(()=>{Kt.current=H},[H]),w.useEffect(()=>{fn.current=S},[S]),w.useEffect(()=>{zn.current=Ie},[Ie]),w.useEffect(()=>{rt.current=St},[St]),w.useEffect(()=>{mt.current=xe},[xe]);const cn=250,Xt=36,Dt=Math.max(200,f.W-cn),ne=Math.max(200,f.H-Xt);w.useEffect(()=>{const U=()=>g({W:window.innerWidth,H:window.innerHeight});return window.addEventListener("resize",U),()=>window.removeEventListener("resize",U)},[]),w.useEffect(()=>($e.current=new Nh(U=>{Fe(U),U==="idle"&&jt(0)}),()=>{var U;return(U=$e.current)==null?void 0:U.dispose()}),[]),w.useEffect(()=>{if(Ze!=="recording")return;const U=setInterval(()=>{var je;return jt(((je=$e.current)==null?void 0:je.elapsed)??0)},500);return()=>clearInterval(U)},[Ze]);const Ne=w.useCallback((U,je,W)=>{const X=W??Date.now(),Te=Sb(Dt,ne,X,U);je&&(Te.aesthetics={...je}),o.current=Te,s.current=0,Gt.current=!1,b(!1),T(""),R(""),C("idle"),$(null),L(!1)},[Dt,ne]);w.useEffect(()=>{e&&Ne(Ve.current,Oe.current)},[e]),w.useEffect(()=>{kt(Rs()),gl(()=>import("./rhizomeBackend-Bij1RBcf.js"),[]).then(U=>{U.loadFoldersFromBackend().then(je=>{if(je.length>0){const W=Rs(),X=[...je];for(const Te of W){const He=X.findIndex(he=>he.id===Te.id);He>=0?Te.updatedAt>X[He].updatedAt&&(X[He]=Te):X.push(Te)}kt(X),zd(X)}}).catch(je=>{console.error("[RhizomeLab] Failed to load folders from backend:",je)})}).catch(U=>{console.error("[RhizomeLab] Failed to import rhizome backend:",U)})},[]),w.useEffect(()=>{sn(vg()),gl(()=>import("./rhizomeBackend-Bij1RBcf.js"),[]).then(U=>{U.loadRhizomesFromBackend().then(je=>{if(je.length>0){const W=vg(),X=[...je];for(const Te of W){const He=X.findIndex(he=>he.id===Te.id);He>=0?Te.savedAt>X[He].savedAt&&(X[He]=Te):X.push(Te)}gl(async()=>{const{saveSavedRhizomes:Te}=await Promise.resolve().then(()=>rx);return{saveSavedRhizomes:Te}},void 0).then(({saveSavedRhizomes:Te})=>{sn(X),Te(X)})}}).catch(je=>{console.error("[RhizomeLab] Failed to load rhizomes from backend:",je)})}).catch(U=>{console.error("[RhizomeLab] Failed to import rhizome backend:",U)})},[]),w.useEffect(()=>{if(!o.current||o.current.nodes.length===0){_t(new Map);return}const U=AU(o.current.nodes);_t(U)},[(sa=o.current)==null?void 0:sa.nodes.length]),w.useEffect(()=>{if(!e)return;let U=0;const je=W=>{r.current=requestAnimationFrame(je);const X=t.current,Te=o.current;if(!X||!Te)return;const He=X.getContext("2d");if(!He)return;s.current===0&&(s.current=W);const he=(W-s.current)/1e3;if(s.current=W,he<=0||he>.5)return;Te.params=Ve.current,Te.aesthetics=Oe.current,Gt.current?(Te.entryTimer=0,Te.growthTimer=0,Te.forgetTimer=0,Te.reterritTimer=0,Te.searchMode=!0):Te.searchMode=!1;const fe=X.width,be=X.height;QR(Te,fe,be,he);const Ee=yt.current;if(Kt.current){He.setTransform(1,0,0,1,0,0);const Me=ae.current;Me.autoRotate&&(Me.rotY+=he*Me.autoSpeed),t7(He,Te,fe,be,Me)}else He.setTransform(Ee.zoom,0,0,Ee.zoom,Ee.panX,Ee.panY),e7(He,Te,fe,be);He.setTransform(1,0,0,1,0,0),hX(He,Te,fe,Ee.zoom),U++,U>=30&&(U=0,h(wb(Te)),b(Te.nodes.some(Me=>Me.label&&!Me.userPlaced)))};return r.current=requestAnimationFrame(je),()=>cancelAnimationFrame(r.current)},[e]);const Ke=w.useCallback((U,je)=>{const W=t.current;if(!W)return{x:0,y:0};const X=W.getBoundingClientRect(),Te=W.width/X.width,He=W.height/X.height,he=yt.current;return{x:((U-X.left)*Te-he.panX)/he.zoom,y:((je-X.top)*He-he.panY)/he.zoom}},[]),Ct=w.useCallback((U,je,W)=>{const X=t.current;if(!X)return;const Te=X.getBoundingClientRect(),He=X.width/Te.width,he=X.height/Te.height,fe=(U-Te.left)*He,be=(je-Te.top)*he,Ee=yt.current,Me=Ee.zoom,_e=Math.max(.1,Math.min(16,Me*W));if(Math.abs(_e-Me)>.001){const Je=_e/Me;yt.current={zoom:_e,panX:fe-(fe-Ee.panX)*Je,panY:be-(be-Ee.panY)*Je},Ft(parseFloat(_e.toFixed(2)))}},[]),ft=w.useCallback(()=>{const U=t.current,je=o.current;if(!U||!je||je.nodes.length===0){yt.current={zoom:1,panX:0,panY:0},Ft(1);return}let W=1/0,X=1/0,Te=-1/0,He=-1/0;for(const Me of je.nodes)Me.x<W&&(W=Me.x),Me.y<X&&(X=Me.y),Me.x>Te&&(Te=Me.x),Me.y>He&&(He=Me.y);const he=80,fe=Te-W+he*2,be=He-X+he*2,Ee=Math.max(.15,Math.min(6,Math.min(U.width/fe,U.height/be)));yt.current={zoom:Ee,panX:U.width/2-(W+Te)/2*Ee,panY:U.height/2-(X+He)/2*Ee},Ft(parseFloat(Ee.toFixed(2)))},[]);w.useEffect(()=>{if(!e)return;const U=je=>{je.target instanceof HTMLInputElement||je.target instanceof HTMLTextAreaElement||((je.key==="f"||je.key==="F")&&ft(),(je.key==="="||je.key==="+")&&Ct(Dt/2,ne/2,1.25),(je.key==="-"||je.key==="_")&&Ct(Dt/2,ne/2,.8),je.key==="0"&&(yt.current={zoom:1,panX:0,panY:0},Ft(1)))};return window.addEventListener("keydown",U),()=>window.removeEventListener("keydown",U)},[e,ft,Ct,Dt,ne]),w.useEffect(()=>{const U=t.current;if(!U||!e)return;const je=W=>{if(W.preventDefault(),Kt.current){const Te=W.deltaY<0?1.12:.89,He=Math.max(.1,Math.min(5,ae.current.zoom*Te));ae.current.zoom=He;return}const X=W.ctrlKey?W.deltaY<0?1.06:.94:W.deltaY<0?1.18:.845;Ct(W.clientX,W.clientY,X)};return U.addEventListener("wheel",je,{passive:!1}),()=>U.removeEventListener("wheel",je)},[e,Ct]);const At=w.useCallback(U=>{if(m)return;if(Kt.current){ge.current={active:!0,startX:U.clientX,startY:U.clientY,startRotX:ae.current.rotX,startRotY:ae.current.rotY,startRotZ:ae.current.rotZ,isRoll:U.shiftKey||U.button===1};return}const je=t.current;if(!je)return;const W=je.getBoundingClientRect();me.current={active:!0,startX:(U.clientX-W.left)*(je.width/W.width),startY:(U.clientY-W.top)*(je.height/W.height),startPanX:yt.current.panX,startPanY:yt.current.panY,moved:!1}},[m]),bt=w.useCallback(U=>{if(Kt.current){const be=ge.current;if(!be.active)return;const Ee=U.clientX-be.startX,Me=U.clientY-be.startY,_e=.005;be.isRoll?ae.current.rotZ=be.startRotZ+Ee*_e:(ae.current.rotY=be.startRotY+Ee*_e,ae.current.rotX=Math.max(-Math.PI/2+.05,Math.min(Math.PI/2-.05,be.startRotX+Me*_e))),me.current.moved=!0;return}const je=me.current;if(!je.active)return;const W=t.current;if(!W)return;const X=W.getBoundingClientRect(),Te=(U.clientX-X.left)*(W.width/X.width),He=(U.clientY-X.top)*(W.height/X.height),he=Te-je.startX,fe=He-je.startY;(Math.abs(he)>4||Math.abs(fe)>4)&&(je.moved=!0),je.moved&&(yt.current={...yt.current,panX:je.startPanX+he,panY:je.startPanY+fe})},[]),nn=w.useCallback(()=>{me.current.active=!1,ge.current.active=!1},[]),Bt=w.useCallback(()=>{Kt.current&&(ae.current={...Iu},Re({...Iu}))},[]),Jt=w.useCallback(U=>{if(me.current.moved){me.current.moved=!1;return}if(!o.current)return;if(Kt.current){const he=t.current;if(!he)return;const fe=he.getBoundingClientRect(),be=he.width/fe.width,Ee=he.height/fe.height,Me=(U.clientX-fe.left)*be,_e=(U.clientY-fe.top)*Ee,Je=ae.current,Vt=he.width,rn=he.height,pn=Vt/2+Je.panX,re=rn/2+Je.panY,Se=Math.min(Vt,rn)*Je.fov+300,qe=Math.cos(Je.rotY),st=Math.sin(Je.rotY),$t=Math.cos(Je.rotX),Tt=Math.sin(Je.rotX),Ut=Math.cos(Je.rotZ),ln=Math.sin(Je.rotZ);let wt=null,mn=28;for(const un of o.current.nodes){const $n=un.connections.size,dn=(Math.min(1,$n/8*.5+un.heat*.45+(un.isEntry?.2:0)+(un.isAnchor?.4:0))-.5)*Je.zSpread+Math.sin(un.id*2.39996)*Je.zSpread*.33,gn=un.x-Vt/2,Sn=un.y-rn/2,nr=dn,Eo=gn*qe+nr*st,ro=-gn*st+nr*qe,Bn=Sn*$t-ro*Tt,ar=Sn*Tt+ro*$t,_o=Eo*Ut-Bn*ln,Ar=Eo*ln+Bn*Ut,Nn=Se/(ar+Se)*Je.zoom,Vn=pn+_o*Nn,ir=re+Ar*Nn,mr=Vn-Me,Gr=ir-_e,Dr=Math.sqrt(mr*mr+Gr*Gr);Dr<mn&&(mn=Dr,wt=un)}$(wt!=null&&wt.label?wt:null);return}const{x:je,y:W}=Ke(U.clientX,U.clientY);if(m){JR(o.current,je,W,Dt,ne),h(wb(o.current));return}const X=Math.max(6,Math.min(32,22/yt.current.zoom));let Te=null,He=X;for(const he of o.current.nodes){const fe=he.x-je,be=he.y-W,Ee=Math.sqrt(fe*fe+be*be);Ee<He&&(He=Ee,Te=he)}$(Te!=null&&Te.label?Te:null)},[m,Dt,ne,Ke]),Qt=w.useCallback(U=>{const je=hw[U];if(!je)return;const W={...je.params};i(W),Ve.current=W,Ne(W,Oe.current)},[Ne]),en=w.useCallback((U,je)=>{i(W=>{const X={...W,[U]:je};return Ve.current=X,o.current&&(o.current.params=X),X})},[]),vn=w.useCallback((U,je)=>{c(W=>{const X={...W,[U]:je};return Oe.current=X,o.current&&(o.current.aesthetics=X),X})},[]),Wn=w.useCallback(U=>{c(je=>{const W={...je,...U};return Oe.current=W,o.current&&(o.current.aesthetics=W),W})},[]),Gn=w.useCallback(()=>{const U=t.current;if(!U)return;const je=U.toDataURL("image/png"),W=document.createElement("a");W.href=je,W.download=`rhizome-${Date.now()}.png`,W.click()},[]),cr=w.useCallback((U,je)=>{const W=$e.current;if(!W)return;const X=Ve.current;W.start(()=>[t.current],()=>({labName:"Rhizome Lab",lines:[`intensidade:${X.organismToIntensity.toFixed(2)}  ruido:${X.noise.toFixed(2)}`,`l.fuga:${X.linhasDeFuga.toFixed(2)}  territ:${X.territorializacao.toFixed(2)}`,`hubs:${X.hubs.toFixed(2)}  esquec:${X.esquecimento.toFixed(2)}`]}),30,void 0,{format:U,quality:je}),an(W.actualFmt)},[]),pr=w.useCallback(()=>{var U;(U=$e.current)==null||U.stop()},[]),br=w.useCallback((U,je)=>{a7(U,je),kt(Rs())},[]),hr=w.useCallback(U=>{s7(U),kt(Rs())},[]),or=w.useCallback((U,je)=>{const W=U.connectionsLabels?[...U.connectionsLabels]:Array.from(U.connections.keys()).map(fe=>{var be,Ee;return(Ee=(be=o.current)==null?void 0:be.nodes.find(Me=>Me.id===fe))==null?void 0:Ee.label}).filter(Boolean),X=encodeURIComponent(U.label||""),Te=[`https://en.wikipedia.org/wiki/Special:Search?search=${X}`,`https://scholar.google.com/scholar?q=${X}`],He=U.category?[U.category]:[],he=u7(U.label||`Node ${U.id}`,U.description,U.category,W.length>0?W:void 0,He.length>0?He:void 0,Te);je?(i7(je,he),kt(Rs()),o.current&&gl(async()=>{const{createSnapshot:fe}=await Promise.resolve().then(()=>xw);return{createSnapshot:fe}},void 0).then(({createSnapshot:fe})=>{gl(async()=>{const{saveRhizome:be,loadSavedRhizomes:Ee,saveSavedRhizomes:Me}=await Promise.resolve().then(()=>rx);return{saveRhizome:be,loadSavedRhizomes:Ee,saveSavedRhizomes:Me}},void 0).then(({saveRhizome:be,loadSavedRhizomes:Ee,saveSavedRhizomes:Me})=>{const _e=fe(o.current);if(_e){const Je=be(U.label||`Rizoma ${Date.now()}`,U.description||"",j||U.label||"Untitled",o.current.nodes.length,_e,je);console.log("Saved rhizome snapshot:",Je.title)}})}),lt(null)):lt({node:U,card:he})},[it,j]),uo=w.useCallback((U,je)=>{l7(U,je),kt(Rs())},[]),fr=w.useCallback((U,je,W)=>{c7(U,je,W),kt(Rs())},[]),Tr=w.useCallback(U=>{console.log("Card selected:",U),gl(async()=>{const{loadSavedRhizomes:je}=await Promise.resolve().then(()=>rx);return{loadSavedRhizomes:je}},void 0).then(({loadSavedRhizomes:je})=>{const X=je().find(Te=>Te.title===U.label||Te.topic===U.label);X&&X.snapshot?gl(async()=>{const{restoreFromSnapshot:Te}=await Promise.resolve().then(()=>xw);return{restoreFromSnapshot:Te}},void 0).then(({restoreFromSnapshot:Te})=>{const He=Te(X.snapshot,Dt,ne);He&&(o.current=He,s.current=0,T(X.title),L(!0),Gt.current=!0,console.log("Restored rhizome from snapshot:",X.title))}):U.url&&window.open(U.url,"_blank")})},[Dt,ne]),Ir=w.useCallback(U=>{jf()?console.log("Send to Arena:",U):Pt(!0)},[]),jo=w.useCallback(U=>{const je={topic:U.label||`Node ${U.id}`,depth:"medium",nodeCount:18,provider:zn.current,apiKey:rt.current||void 0,modelId:mt.current||void 0,llmMode:Ge};bo(je)},[Ge]),bo=w.useCallback(async U=>{C("loading"),fn.current="loading",Ae.current=performance.now()/1e3,tt.current=U.topic,P(U.topic),R("Conectando  LLM..."),T(U.topic),$(null),Oe.current={...Oe.current,showLabels:!0},c(he=>({...he,showLabels:!0}));const je=Sb(Dt,ne,Date.now(),Ve.current);je.aesthetics={...Oe.current},je.nodes=[],je.nextId=0;const W={id:je.nextId++,x:Dt/2,y:ne/2,vx:0,vy:0,heat:1,isEntry:!0,age:0,connections:new Map,label:U.topic,description:"Tema central do mapa rizomtico",category:void 0,pinned:!0,userPlaced:!1,isAnchor:!0};je.nodes.push(W),je.searchMode=!0,o.current=je,s.current=0,Gt.current=!0,L(!0),b(!1),yt.current={zoom:1,panX:0,panY:0},Ft(1);const X=new Map;X.set(U.topic,W);const Te=new Map;let He=0;try{await fw(U,(he,fe)=>{o.current&&(He++,R(` ${He} ns...`),pw(o.current,he,fe,U.nodeCount,Dt,ne,W.id,void 0,void 0,X,Te))},he=>{o.current&&gw(o.current),b(!0),R(` ${he} conceitos  ${U.topic}`),C("done"),fn.current="done"})}catch(he){C("error"),fn.current="error",R(`Erro: ${he.message}`)}},[Dt,ne,vn]),vo=w.useCallback(()=>{o.current&&(sU(o.current),Gt.current=!1,L(!1),b(!1),T(""),R(""),C("idle"),$(null),vn("showLabels",!1))},[vn]),Zo=w.useCallback(async U=>{if(!o.current||fn.current==="loading")return;C("loading"),fn.current="loading",Ae.current=performance.now()/1e3,tt.current=U.label??"",R(` Expandindo "${U.label}"...`),$(null);const je={topic:U.label??"",depth:"medium",nodeCount:20,provider:zn.current,apiKey:rt.current||void 0,modelId:mt.current||void 0,llmMode:"concepts"},W=o.current;Gt.current=!0,L(!0),vn("showLabels",!0);const X=new Map;for(const be of W.nodes)be.label&&X.set(be.label,be);const Te=new Map,He=Math.PI*(3-Math.sqrt(5)),he=[];for(const be of W.nodes)be.category&&be.category!=="default"&&!he.includes(be.category)&&(Te.set(be.category,he.length*He*2.5),he.push(be.category));let fe=0;try{await fw(je,(be,Ee)=>{o.current&&(fe++,R(` "${U.label}"  ${fe} ns`),pw(o.current,be,Ee,je.nodeCount,Dt,ne,U.id,U.x,U.y,X,Te))},be=>{o.current&&gw(o.current),b(!0),R(` ${be} ns de "${U.label}"`),C("done"),fn.current="done"})}catch(be){C("error"),R(be.message),fn.current="error"}},[Dt,ne,vn]);if(!e)return null;const Jo="rgba(16,212,91,0.65)",Ua="rgba(16,212,91,0.55)",Na={width:"100%",padding:"4px 7px",borderRadius:1,fontSize:10,background:"rgba(255,255,255,0.04)",border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.65)",outline:"none",fontFamily:"'IBM Plex Mono', monospace",boxSizing:"border-box",cursor:"pointer"};return a.jsxs("div",{style:{position:"fixed",inset:0,zIndex:5,display:"flex",flexDirection:"column",paddingTop:Xt,background:"#000",fontFamily:"'IBM Plex Mono', monospace"},children:[a.jsxs("div",{style:{flex:1,display:"flex",overflow:"hidden",position:"relative"},children:[a.jsxs("div",{style:{flex:1,position:"relative",overflow:"hidden"},children:[a.jsx("canvas",{ref:t,width:Dt,height:ne,style:{display:"block",width:"100%",height:"100%",cursor:m?"crosshair":H&&ge.current.active?"grabbing":"grab"},onClick:Jt,onDoubleClick:Bt,onMouseDown:At,onMouseMove:bt,onMouseUp:nn,onMouseLeave:nn}),a.jsxs("div",{style:{position:"absolute",top:12,left:12,display:"flex",gap:6,zIndex:50},children:[a.jsxs("button",{onClick:()=>{console.log(" Boto colees clicado, estado atual:",zt),jn(U=>!U)},title:zt?"Esconder Colees":"Mostrar Colees",style:{padding:"6px 12px",borderRadius:1,fontFamily:Xr,background:zt?"rgba(16,212,91,0.10)":"rgba(0,0,0,0.92)",border:`1px dashed ${zt?"rgba(16,212,91,0.35)":"rgba(255,255,255,0.10)"}`,color:zt?"rgba(16,212,91,0.90)":"rgba(255,255,255,0.55)",fontSize:9,cursor:"pointer",display:"flex",alignItems:"center",gap:6,backdropFilter:"blur(8px)",transition:"all 0.15s",letterSpacing:"0.06em",textTransform:"uppercase"},onMouseEnter:U=>{zt||(U.currentTarget.style.background="rgba(16,212,91,0.08)",U.currentTarget.style.borderColor="rgba(16,212,91,0.25)",U.currentTarget.style.color="rgba(16,212,91,0.85)")},onMouseLeave:U=>{zt||(U.currentTarget.style.background="rgba(0,0,0,0.92)",U.currentTarget.style.borderColor="rgba(255,255,255,0.10)",U.currentTarget.style.color="rgba(255,255,255,0.55)")},children:[a.jsx(ph,{size:10,strokeWidth:1.5})," ",zt?"Esconder":"Colees"]}),a.jsxs("button",{onClick:()=>Pt(!0),title:"Conectar Are.na",style:{padding:"5px 10px",borderRadius:1,fontFamily:Xr,background:jf()?"rgba(34,197,94,0.10)":"rgba(0,0,0,0.88)",border:`1px dashed ${jf()?"rgba(34,197,94,0.30)":"rgba(255,255,255,0.08)"}`,color:jf()?"rgba(34,197,94,0.90)":"rgba(255,255,255,0.45)",fontSize:8,cursor:"pointer",display:"flex",alignItems:"center",gap:5,backdropFilter:"blur(8px)",letterSpacing:"0.06em",textTransform:"uppercase"},children:[jf()?"":""," Are.na"]}),a.jsx("button",{onClick:()=>te?F():ce(!0),title:te?`${te.email}  Clique para sair`:"Entrar para sincronizar colees",style:{padding:"5px 10px",borderRadius:1,fontFamily:Xr,background:te?"rgba(96,165,250,0.10)":"rgba(0,0,0,0.88)",border:`1px dashed ${te?"rgba(96,165,250,0.30)":"rgba(255,255,255,0.08)"}`,color:te?"rgba(147,197,253,0.90)":"rgba(255,255,255,0.40)",fontSize:8,cursor:"pointer",display:"flex",alignItems:"center",gap:5,backdropFilter:"blur(8px)",transition:"all 0.15s",letterSpacing:"0.04em"},children:te?` ${te.name||te.email.split("@")[0]}`:" Login"})]}),pe&&a.jsx(oX,{onClose:()=>ce(!1),onAuthChange:U=>{Q(U),ce(!1)}}),zt&&a.jsx(hU,{folders:it,onCreateFolder:br,onDeleteFolder:hr,onSelectCard:Tr,onRemoveCard:uo,onMoveCard:fr,onClose:()=>jn(!1)}),a.jsxs("div",{style:{position:"absolute",bottom:16,right:16,display:"flex",flexDirection:"column",gap:3,zIndex:50},children:[a.jsxs("div",{style:{textAlign:"center",fontSize:7,fontFamily:Xr,color:"rgba(255,255,255,0.22)",letterSpacing:"0.08em",marginBottom:2},children:[Math.round(Et*100),"%"]}),a.jsx("button",{onClick:()=>Ct(Dt/2,ne/2,1.35),title:"Zoom In (+)",style:{width:28,height:28,borderRadius:1,border:"1px dashed rgba(255,255,255,0.10)",background:"rgba(0,0,0,0.88)",color:"rgba(255,255,255,0.45)",fontSize:14,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",lineHeight:1,fontFamily:Xr},children:"+"}),a.jsx("button",{onClick:ft,title:"Encaixar tudo na tela (F)",style:{width:28,height:28,borderRadius:1,border:"1px dashed rgba(255,255,255,0.10)",background:"rgba(0,0,0,0.88)",color:"rgba(255,255,255,0.35)",fontSize:10,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:Xr},children:""}),a.jsx("button",{onClick:()=>Ct(Dt/2,ne/2,.74),title:"Zoom Out (-)",style:{width:28,height:28,borderRadius:1,border:"1px dashed rgba(255,255,255,0.10)",background:"rgba(0,0,0,0.88)",color:"rgba(255,255,255,0.45)",fontSize:16,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",lineHeight:1,fontFamily:Xr},children:""}),a.jsx("button",{onClick:()=>{yt.current={zoom:1,panX:0,panY:0},Ft(1)},title:"Reset zoom 1:1",style:{width:28,height:28,borderRadius:1,border:"1px dashed rgba(255,255,255,0.06)",background:"rgba(0,0,0,0.88)",color:"rgba(255,255,255,0.22)",fontSize:7,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:Xr,letterSpacing:"0.06em"},children:"1:1"})]}),m&&a.jsx("div",{style:{position:"absolute",top:8,left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.80)",border:"1px dashed rgba(16,212,91,0.30)",borderRadius:1,padding:"4px 12px",fontSize:8,color:"rgba(16,212,91,0.75)",fontFamily:Xr,letterSpacing:"0.08em",pointerEvents:"none",textTransform:"uppercase"},children:"+ clique no canvas para adicionar n"}),H&&!I&&a.jsxs("div",{style:{position:"absolute",top:8,left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.75)",border:"1px dashed rgba(56,189,248,0.18)",borderRadius:1,padding:"4px 14px",fontSize:7,color:"rgba(56,189,248,0.45)",fontFamily:Xr,pointerEvents:"none",backdropFilter:"blur(4px)",display:"flex",gap:10,alignItems:"center",letterSpacing:"0.06em",textTransform:"uppercase"},children:[a.jsx("span",{children:"drag = rbita"}),a.jsx("span",{style:{opacity:.3},children:"|"}),a.jsx("span",{children:"scroll = zoom"}),a.jsx("span",{style:{opacity:.3},children:"|"}),a.jsx("span",{children:"click = inspecionar"}),a.jsx("span",{style:{opacity:.3},children:"|"}),a.jsx("span",{children:"dbl-click = reset"})]}),S==="done"&&j&&a.jsxs("div",{style:{position:"absolute",bottom:14,left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.80)",border:"1px dashed rgba(255,255,255,0.08)",borderRadius:1,padding:"4px 14px",fontSize:8,color:"rgba(255,255,255,0.40)",fontFamily:Xr,pointerEvents:"none",whiteSpace:"nowrap",backdropFilter:"blur(6px)",letterSpacing:"0.06em",textTransform:"uppercase"},children:[" ",j]}),I&&a.jsx(dX,{node:I,allNodes:((So=o.current)==null?void 0:So.nodes)??[],onClose:()=>$(null),onExpand:Zo,onSave:or}),!m&&v&&!I&&a.jsxs("div",{style:{position:"absolute",top:8,right:8,fontSize:8,color:"rgba(255,255,255,0.18)",fontFamily:"monospace",pointerEvents:"none",textAlign:"right",lineHeight:1.7},children:["scroll  zoom",a.jsx("br",{}),"drag  pan",a.jsx("br",{}),"F  fit all",a.jsx("br",{}),"click  inspect"]})]}),a.jsxs("div",{style:{width:cn,flexShrink:0,overflow:"auto",borderLeft:"1px dashed rgba(255,255,255,0.06)",background:"rgba(0,0,0,0.99)",padding:"12px 14px",scrollbarWidth:"thin",fontFamily:Xr},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:14,borderBottom:"1px dashed rgba(255,255,255,0.06)",paddingBottom:10},children:[a.jsx("div",{style:{fontSize:13,letterSpacing:"0.1em",textTransform:"uppercase",color:"rgba(255,255,255,0.50)",fontFamily:Bv},children:"Rhizome Lab"}),a.jsxs("div",{style:{display:"flex",gap:4,alignItems:"center"},children:[d&&a.jsxs("div",{style:{fontSize:7,color:"rgba(255,255,255,0.18)",fontFamily:"monospace"},children:[d.nodeCount,"n"]}),a.jsxs("button",{onClick:()=>G(U=>!U),title:H?"Voltar para 2D":"Modo 3D",style:{padding:"3px 7px",borderRadius:1,cursor:"pointer",fontSize:8,fontFamily:Xr,background:H?"rgba(56,189,248,0.12)":"rgba(255,255,255,0.03)",border:`1px dashed ${H?"rgba(56,189,248,0.35)":"rgba(255,255,255,0.08)"}`,color:H?"rgba(56,189,248,0.85)":"rgba(255,255,255,0.3)",display:"flex",alignItems:"center",gap:4,transition:"all 0.15s",letterSpacing:"0.06em",textTransform:"uppercase"},onMouseEnter:U=>{H||(U.currentTarget.style.borderColor="rgba(56,189,248,0.3)",U.currentTarget.style.color="rgba(56,189,248,0.6)")},onMouseLeave:U=>{H||(U.currentTarget.style.borderColor="rgba(255,255,255,0.08)",U.currentTarget.style.color="rgba(255,255,255,0.3)")},children:[a.jsx(Y5,{size:8,strokeWidth:1.5})," 3D"]})]})]}),a.jsxs(J0,{title:"Pesquisa Epistmica",open:dt,onToggle:()=>Rt(U=>!U),accent:"rgba(16,212,91,0.65)",children:[a.jsx(cX,{onGenerate:bo,onClear:vo,hasLLMNodes:v,onOpenPromptEditor:()=>le(!0),provider:Ie,setProvider:U=>{at(U),zn.current=U},apiKey:St,setApiKey:U=>{ye(U),rt.current=U},modelId:xe,setModelId:U=>{gt(U),mt.current=U},llmMode:Ge,setLlmMode:U=>{Ye(U)}}),k&&S!=="idle"&&a.jsx("div",{style:{marginTop:7,fontSize:8,lineHeight:1.5,color:S==="done"?"rgba(74,222,128,0.7)":S==="error"?"rgba(248,113,113,0.7)":"rgba(251,191,36,0.6)",fontFamily:"monospace"},children:k})]}),a.jsxs("div",{style:{display:"flex",gap:4,marginBottom:0},children:[a.jsxs("button",{title:"Visualizar",onClick:()=>y(!1),style:{flex:1,padding:"5px 0",borderRadius:1,fontSize:8,cursor:"pointer",fontFamily:Xr,background:m?"rgba(255,255,255,0.02)":"rgba(255,255,255,0.06)",border:`1px dashed ${m?"rgba(255,255,255,0.06)":"rgba(255,255,255,0.15)"}`,color:m?"rgba(255,255,255,0.25)":"rgba(255,255,255,0.65)",display:"flex",alignItems:"center",justifyContent:"center",gap:4,transition:"all 0.15s",letterSpacing:"0.06em",textTransform:"uppercase"},children:[a.jsx(vl,{size:9,strokeWidth:1.5})," Observar"]}),a.jsxs("button",{title:"Adicionar",onClick:()=>y(!0),style:{flex:1,padding:"5px 0",borderRadius:1,fontSize:8,cursor:"pointer",fontFamily:Xr,background:m?"rgba(124,58,237,0.12)":"rgba(255,255,255,0.02)",border:`1px dashed ${m?"rgba(124,58,237,0.35)":"rgba(255,255,255,0.06)"}`,color:m?"rgba(196,181,253,0.80)":"rgba(255,255,255,0.25)",display:"flex",alignItems:"center",justifyContent:"center",gap:4,transition:"all 0.15s",letterSpacing:"0.06em",textTransform:"uppercase"},children:[a.jsx(jg,{size:9,strokeWidth:1.5})," N"]}),a.jsxs("select",{value:"",onChange:U=>{const je=parseInt(U.target.value,10);isNaN(je)||Qt(je)},style:{...Na,flex:1.4,fontSize:8,padding:"4px 4px"},children:[a.jsx("option",{value:"",children:"Preset"}),hw.map((U,je)=>a.jsx("option",{value:je,children:U.name},U.name))]})]}),a.jsx(J0,{title:q?"Dinmica do Mapa":"Fsica",open:We,onToggle:()=>J(U=>!U),accent:Jo,children:(q?fX:JV).map(U=>a.jsx(zs,{label:U.label,value:l[U.key],tooltip:U.tooltip,onChange:je=>en(U.key,je)},U.key))}),H&&a.jsxs(J0,{title:"Espao 3D",open:!0,onToggle:()=>{},accent:"rgba(56,189,248,0.65)",children:[a.jsx("div",{style:{fontSize:8,color:"rgba(255,255,255,0.28)",marginBottom:8,lineHeight:1.6},children:"Drag = rbita  Shift+drag = roll  Scroll = zoom  Dbl-click = reset"}),a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[a.jsx("span",{style:{fontSize:9,color:"rgba(255,255,255,0.45)"},children:"Auto-rotao"}),a.jsx("button",{title:"Auto-rotao",onClick:()=>{const U=!ae.current.autoRotate;ae.current.autoRotate=U,Re(je=>({...je,autoRotate:U}))},style:{padding:"2px 10px",borderRadius:4,cursor:"pointer",fontSize:8,background:we.autoRotate?"rgba(56,189,248,0.18)":"rgba(255,255,255,0.03)",border:`1px solid ${we.autoRotate?"rgba(56,189,248,0.45)":"rgba(255,255,255,0.08)"}`,color:we.autoRotate?"rgba(56,189,248,0.9)":"rgba(255,255,255,0.3)"},children:we.autoRotate?"ON":"OFF"})]}),a.jsx(zs,{label:"Velocidade Rotao",value:we.autoSpeed/.8,tooltip:"Velocidade da auto-rotao em modo automtico",onChange:U=>{ae.current.autoSpeed=U*.8,Re(je=>({...je,autoSpeed:U*.8}))}}),a.jsx(zs,{label:"Campo Visual (FOV)",value:(we.fov-.2)/1.3,tooltip:"Perspectiva: baixo = teleobjetiva, alto = grande angular",onChange:U=>{const je=.2+U*1.3;ae.current.fov=je,Re(W=>({...W,fov:je}))}}),a.jsx(zs,{label:"Profundidade Z",value:(we.zSpread-40)/460,tooltip:"Quo espalhados os ns ficam no eixo de profundidade",onChange:U=>{const je=40+U*460;ae.current.zSpread=je,Re(W=>({...W,zSpread:je}))}}),a.jsx(zs,{label:"Nvoa de Profundidade",value:we.fog,tooltip:"Ns distantes ficam mais escuros e transparentes",onChange:U=>{ae.current.fog=U,Re(je=>({...je,fog:U}))}}),a.jsx("button",{title:"Resetar cmera",onClick:()=>{ae.current={...Iu},Re({...Iu})},style:{marginTop:6,width:"100%",padding:"4px 0",borderRadius:4,cursor:"pointer",fontSize:8,letterSpacing:"0.05em",background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",color:"rgba(255,255,255,0.3)"},children:" Resetar cmera"})]}),q&&a.jsxs(J0,{title:"Semntica Visual",open:!0,onToggle:()=>{},accent:"rgba(196,181,253,0.65)",children:[a.jsx("div",{style:{fontSize:8,color:"rgba(255,255,255,0.28)",marginBottom:8,lineHeight:1.6},children:"Como dados da LLM afetam o visual do rizoma."}),a.jsx(zs,{label:"Relevncia  Tamanho",value:u.relSizeScale,tooltip:"Ns mais relevantes para o tema ficam visualmente maiores",onChange:U=>vn("relSizeScale",U)}),a.jsx(zs,{label:"Conexes  Tamanho",value:u.connSizeScale,tooltip:"Ns com mais conexes (hubs) crescem mais",onChange:U=>vn("connSizeScale",U)}),a.jsx(zs,{label:"Relevncia  Distncia",value:u.relDistScale,tooltip:"Ns relevantes ficam mais perto do centro; perifricos se afastam",onChange:U=>vn("relDistScale",U)})]}),a.jsxs(J0,{title:"Esttica",open:ke,onToggle:()=>Le(U=>!U),accent:Ua,children:[a.jsxs("div",{style:{marginBottom:10},children:[a.jsx("div",{style:{fontSize:7,color:"rgba(255,255,255,0.22)",letterSpacing:"0.08em",textTransform:"uppercase",marginBottom:6,fontFamily:Xr},children:"Paletas"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:3},children:sX.map(U=>a.jsxs("button",{title:U.name,onClick:()=>Wn(U.ae),style:{display:"flex",alignItems:"center",gap:8,width:"100%",padding:"5px 8px",borderRadius:1,cursor:"pointer",border:"1px dashed rgba(255,255,255,0.06)",background:"rgba(255,255,255,0.02)",transition:"all 0.15s",textAlign:"left"},onMouseEnter:je=>{je.currentTarget.style.background="rgba(255,255,255,0.06)",je.currentTarget.style.borderColor="rgba(255,255,255,0.15)"},onMouseLeave:je=>{je.currentTarget.style.background="rgba(255,255,255,0.02)",je.currentTarget.style.borderColor="rgba(255,255,255,0.06)"},children:[a.jsxs("div",{style:{display:"flex",borderRadius:1,overflow:"hidden",flexShrink:0,border:"1px solid rgba(255,255,255,0.10)"},children:[a.jsx("div",{style:{width:10,height:12,background:U.ae.bgColor??"#000"}}),a.jsx("div",{style:{width:10,height:12,background:U.swatch}})]}),a.jsx("span",{style:{fontSize:8,color:"rgba(255,255,255,0.45)",letterSpacing:"0.05em",fontFamily:Xr,textTransform:"uppercase"},children:U.name})]},U.name))})]}),a.jsx(Oc,{label:"Background",value:u.bgColor,onChange:U=>vn("bgColor",U)}),a.jsx(Oc,{label:"Ns normais",value:u.nodeColor,onChange:U=>vn("nodeColor",U)}),a.jsx(Oc,{label:"Entradas",value:u.entryColor,onChange:U=>vn("entryColor",U)}),a.jsx(Oc,{label:"Hubs",value:u.hubColor,onChange:U=>vn("hubColor",U)}),a.jsx(Oc,{label:"Ns ativos",value:u.hotColor,onChange:U=>vn("hotColor",U)}),a.jsx(Oc,{label:"Links",value:u.linkColor,onChange:U=>vn("linkColor",U)}),a.jsx(Oc,{label:"Linhas de Fuga",value:u.flightColor,onChange:U=>vn("flightColor",U)}),a.jsx(Oc,{label:"Labels",value:u.labelColor,onChange:U=>vn("labelColor",U)}),a.jsxs("div",{style:{marginTop:8},children:[a.jsx(zs,{label:"Glow",value:u.glowIntensity,onChange:U=>vn("glowIntensity",U)}),a.jsx(zs,{label:"Tamanho ns",value:u.nodeSize,onChange:U=>vn("nodeSize",U)}),a.jsx(zs,{label:"Opac. links",value:u.linkOpacity,onChange:U=>vn("linkOpacity",U)}),a.jsx(zs,{label:"Esp. links",value:u.linkWidth,onChange:U=>vn("linkWidth",U)})]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:6,marginBottom:6},children:[a.jsx("span",{style:{fontSize:10,color:"rgba(255,255,255,0.45)"},children:"Mostrar Labels"}),a.jsx("button",{title:`Labels: ${u.showLabels?"ON":"OFF"}`,onClick:()=>vn("showLabels",!u.showLabels),style:{padding:"3px 8px",borderRadius:3,fontSize:9,cursor:"pointer",background:u.showLabels?"rgba(0,255,102,0.15)":"rgba(255,255,255,0.04)",border:`1px solid ${u.showLabels?"rgba(0,255,102,0.35)":"rgba(255,255,255,0.08)"}`,color:u.showLabels?"rgba(0,255,102,0.85)":"rgba(255,255,255,0.3)"},children:u.showLabels?"ON":"OFF"})]}),u.showLabels&&a.jsx(zs,{label:"Tamanho labels",value:u.labelSize,onChange:U=>vn("labelSize",U)}),a.jsxs("button",{title:"Exportar PNG",onClick:Gn,style:{marginTop:6,width:"100%",padding:"5px 0",borderRadius:4,cursor:"pointer",background:"rgba(255,255,255,0.04)",border:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.5)",fontSize:10,display:"flex",alignItems:"center",justifyContent:"center",gap:5},children:[a.jsx(EC,{size:10,strokeWidth:1.5}),"Exportar Frame PNG"]})]}),a.jsx(J0,{title:"Gravao",open:K,onToggle:()=>et(U=>!U),accent:"rgba(239,68,68,0.55)",children:a.jsx(iX,{recState:Ze,elapsed:Xe,actualFmt:hn,onStart:cr,onStop:pr})}),a.jsxs(J0,{title:"Debug / Mtricas",open:Wt,onToggle:()=>Zt(U=>!U),children:[d&&a.jsx("div",{style:{marginBottom:8},children:[{label:"Ns",v:d.nodeCount},{label:"Entradas",v:d.entryCount},{label:"Links longos",v:d.longLinkCount},{label:"Isolados",v:d.isolatedCount},{label:"Grau mdio",v:d.avgDegree.toFixed(2)},{label:"Hubness",v:d.hubness.toFixed(3)}].map(U=>a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:9,color:"rgba(255,255,255,0.32)",marginBottom:3},children:[a.jsx("span",{children:U.label}),a.jsx("span",{style:{fontFamily:"monospace",color:"rgba(255,255,255,0.5)"},children:U.v})]},U.label))}),a.jsxs("button",{title:"Reset",onClick:()=>Ne(Ve.current,Oe.current),style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:5,padding:"5px 0",borderRadius:4,cursor:"pointer",background:"rgba(255,255,255,0.04)",border:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.45)",fontSize:10},children:[a.jsx(Wi,{size:10,strokeWidth:1.5}),"Reset (novo seed)"]})]})]})]}),oe&&a.jsx(lX,{onClose:()=>le(!1)}),I&&a.jsx(bU,{node:I,allNodes:((Oo=o.current)==null?void 0:Oo.nodes)||[],score:ht.get(I.id),onClose:()=>$(null),onSaveCard:U=>or(U),onSendToArena:U=>Ir(U),onExpand:U=>jo(U)}),Xn&&a.jsx(gU,{onClose:()=>Pt(!1)}),En&&a.jsx(vU,{folders:it,onSelect:U=>{or(En.node,U)},onCreateFolder:(U,je)=>{br(U,je);const W=Rs(),X=W[W.length-1];X&&or(En.node,X.id)},onClose:()=>lt(null)})]})};function hX(e,t,r,o=1){const s=t.nodes;if(s.length===0)return;const l=s.filter(u=>u.isEntry).length,i=s.filter(u=>u.connections.size===0&&!u.isEntry).length;e.save(),e.font="9px monospace",e.fillStyle="rgba(255,255,255,0.20)",e.fillText(`nodes:${s.length}  entries:${l}  isolated:${i}`,10,14),e.restore()}const fX=[{key:"territorializacao",label:"Coeso ao Centro",tooltip:"Quo fortemente os conceitos so puxados de volta ao tema central. Alto = mapa compacto; baixo = conceitos se dispersam livremente."},{key:"linhasDeFuga",label:"Disperso Semntica",tooltip:"Conceitos tangenciais se distanciam do centro. Alto = conceitos perifricos voam para longe; baixo = tudo fica prximo."},{key:"noise",label:"Deriva Conceitual",tooltip:"Quanto os ns derivam aleatoriamente no espao epistmico. Alto = layout mais catico; baixo = posies estveis."},{key:"hubs",label:"Popularidade / Hub",tooltip:"Conceitos populares e muito conectados crescem mais. Alto = figuras centrais dominam visualmente; baixo = igualdade entre ns."},{key:"reterritorializacao",label:"Re-Conexo",tooltip:"Fora que cria novas conexes entre conceitos prximos. Alto = rede densa e interligada; baixo = conexes esparsas."},{key:"esquecimento",label:"Filtragem",tooltip:"Conexes fracas desaparecem com o tempo. Alto = apenas relaes fortes sobrevivem (mapa mais limpo); baixo = acumulo de conexes."},{key:"visibility",label:"Visibilidade"}],ux=Math.PI*2;function pX(e){const{quanta:t}=e;if(!t.length)return Fb();const r=t.length,o=8,s=new Float32Array(o*o);for(const te of t){const F=Math.min(o-1,Math.floor(te.x*o)),Q=Math.min(o-1,Math.floor(te.y*o));s[Q*o+F]++}const l=o*o;let i=0,u=0;for(let te=0;te<l;te++)i+=s[te];const c=i/l;for(let te=0;te<l;te++){const F=s[te]-c;u+=F*F}const d=Math.min(1,Math.sqrt(u/l)/(r/l+1));let h=0,f=0;for(const te of t)h+=Math.sin(te.phase),f+=Math.cos(te.phase);const g=Math.sqrt(h*h+f*f)/r;let m=0,y=0;for(const te of t)m+=te.coherence,y+=te.coherence*te.coherence;const v=m/r,b=Math.min(1,Math.sqrt(Math.max(0,y/r-v*v)));let S=0;const C=.5;for(const te of t)te.coherence*te.scribeAffinity>C&&S++;S=S/r;const k=s.slice(0,l/4).reduce((te,F)=>te+F,0),R=s.slice(l/4,l/2).reduce((te,F)=>te+F,0),j=s.slice(l/2,3*l/4).reduce((te,F)=>te+F,0),T=s.slice(3*l/4).reduce((te,F)=>te+F,0),_=Math.max(k,R,j,T,1),P=1-(Math.abs(k-T)+Math.abs(R-j))/(2*_);let I=0,$=0;for(const te of t)I+=te.vx,$+=te.vy;const q=(Math.atan2($/r,I/r)%ux+ux)%ux,L=Math.min(1,e.recentEventCount/20);let H=0;if(e.snapshots.length>=2){const te=e.snapshots[e.snapshots.length-2],F=e.snapshots[e.snapshots.length-1];te&&F&&(H=Math.abs(F.syncIndex-te.syncIndex)+Math.abs(F.coherenceMean-te.coherenceMean)*.5,H=Math.min(1,H*4))}let G=0,oe=0;for(const te of t)te.intent<-.2?G++:te.intent>.2&&oe++;const le=Math.min(1,Math.abs(G-oe)/(r*.3)),ce=Array.from(s).filter(te=>te<.5).length/l;return{densityMean:Math.min(1,c/(r/l)),densityVariance:d,syncIndex:g,coherenceMean:v,coherenceVariance:b,loopCount:S,symmetryIndex:Math.max(0,Math.min(1,P)),polarityAxis:q,eventRate:L,noveltyIndex:H,tensionIndex:le,silenceIndex:ce,slot13:0,slot14:0}}function mX(e,t){if(!e.length)return Fb();let r=0;const o={syncIndex:0,coherenceMean:0,loopCount:0,eventRate:0};for(let s=0;s<e.length;s++){const l=(s+1)**t,i=e[s];o.syncIndex+=i.syncIndex*l,o.coherenceMean+=i.coherenceMean*l,o.loopCount+=i.loopCount*l,o.eventRate+=i.eventRate*l,r+=l}return r===0?Fb():(o.syncIndex/=r,o.coherenceMean/=r,o.loopCount/=r,o.eventRate/=r,{densityMean:.5,densityVariance:.3,syncIndex:Math.min(1,o.syncIndex),coherenceMean:Math.min(1,o.coherenceMean),coherenceVariance:.2,loopCount:Math.min(1,o.loopCount),symmetryIndex:.5,polarityAxis:0,eventRate:Math.min(1,o.eventRate),noveltyIndex:.3,tensionIndex:.2,silenceIndex:.4,slot13:0,slot14:0})}function Gf(e,t){const r=pX(e);if(t.timeScope<.05)return r;const o=Math.max(1,Math.round(t.timeScope*e.snapshots.length)),s=e.snapshots.slice(-o),l=mX(s,1.5),i=t.timeScope;return gX(r,l,i)}function gX(e,t,r){const o=(s,l)=>s*(1-r)+l*r;return{densityMean:o(e.densityMean,t.densityMean),densityVariance:o(e.densityVariance,t.densityVariance),syncIndex:o(e.syncIndex,t.syncIndex),coherenceMean:o(e.coherenceMean,t.coherenceMean),coherenceVariance:o(e.coherenceVariance,t.coherenceVariance),loopCount:o(e.loopCount,t.loopCount),symmetryIndex:o(e.symmetryIndex,t.symmetryIndex),polarityAxis:e.polarityAxis,eventRate:o(e.eventRate,t.eventRate),noveltyIndex:o(e.noveltyIndex,t.noveltyIndex),tensionIndex:o(e.tensionIndex,t.tensionIndex),silenceIndex:o(e.silenceIndex,t.silenceIndex),slot13:0,slot14:0}}function Fb(){return{densityMean:0,densityVariance:0,syncIndex:0,coherenceMean:0,coherenceVariance:0,loopCount:0,symmetryIndex:.5,polarityAxis:0,eventRate:0,noveltyIndex:0,tensionIndex:0,silenceIndex:1,slot13:0,slot14:0}}const Nb=Math.PI*2,I7=.5,P7=.5,F7=.28,N7=.095,O7=.345,Uw=.44,Yw=.03;function yX(e){return function(){e|=0,e=e+1831565813|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}function xX(e){return e.charge<.2?N7:e.scribeAffinity>.72?O7+(e.scribeAffinity-.72)*.15:F7}function hx(e){const t=yX(e.seed^3735884340),r=e.agentCount,o=[];for(let s=0;s<r;s++){const l=t(),i=t(),u=(t()-.5)*2,c=l<.2?N7:i>.72?O7:F7,d=t()*Nb,h=(t()-.5)*.06,f=c+h,g=I7+Math.cos(d)*f,m=P7+Math.sin(d)*f,y=.006+t()*.006,v=u>0?1:-1,b=-Math.sin(d)*y*v,S=Math.cos(d)*y*v;o.push({id:s,x:g,y:m,vx:b,vy:S,phase:t()*Nb,phaseVel:.5+t()*1.5,charge:l,coherence:t()*.3,intent:u,ink:.4+t()*.5,scribeAffinity:i})}return{quanta:o,strokes:[],flowGrid:{w:1,h:1,vx:new Float32Array(1),vy:new Float32Array(1)},tick:0,time:0,snapshots:[],snapshotInterval:2,lastSnapshotTime:0,recentEventCount:0,prevObservables:null}}function bX(e,t){const r={time:e.time,densityGrid:new Float32Array(256),syncIndex:t.syncIndex,coherenceMean:t.coherenceMean,loopCount:t.loopCount,eventRate:t.eventRate};for(const o of e.quanta){const s=Math.min(15,Math.floor(o.x*16)),l=Math.min(15,Math.floor(o.y*16));r.densityGrid[l*16+s]++}e.snapshots.push(r),e.snapshots.length>60&&e.snapshots.shift(),e.lastSnapshotTime=e.time}function vX(e,t,r,o){r=Math.min(r,.04),e.time+=r,e.tick++;const{quanta:s}=e,l=r*60,i=.55+t.loopThreshold*.3,u=t.dance*.007,c=t.entrainment,d=16,h=new Array(d*d).fill(null).map(()=>[]);for(const g of s){const m=Math.min(d-1,Math.max(0,Math.floor(g.x*d))),y=Math.min(d-1,Math.max(0,Math.floor(g.y*d)));h[y*d+m].push(g)}function f(g,m){const y=Math.ceil(m*d)+1,v=Math.max(0,Math.floor(g.x*d)-y),b=Math.min(d-1,Math.floor(g.x*d)+y),S=Math.max(0,Math.floor(g.y*d)-y),C=Math.min(d-1,Math.floor(g.y*d)+y),k=[];for(let R=S;R<=C;R++)for(let j=v;j<=b;j++)for(const T of h[R*d+j]){if(T===g)continue;const _=T.x-g.x,P=T.y-g.y;_*_+P*P<m*m&&k.push(T)}return k}for(const g of o)if(!(g.duration<=0)){g.duration-=r;for(const m of s){const y=m.x-g.targetX,v=m.y-g.targetY,b=y*y+v*v;if(b>g.radius*g.radius)continue;const S=(1-Math.sqrt(b)/g.radius)*g.strength*r;switch(g.kind){case"CONVERGE":m.intent=Math.max(-1,m.intent-S*3),m.coherence=Math.min(1,m.coherence+S*2),m.vx-=y*S*4,m.vy-=v*S*4;break;case"DIVERGE":m.intent=Math.min(1,m.intent+S*3),m.coherence=Math.max(0,m.coherence-S*2),m.vx+=y*S*3,m.vy+=v*S*3;break;case"SILENCE":m.vx*=1-S*4,m.vy*=1-S*4,m.ink=Math.max(0,m.ink-S*2);break;case"AMPLIFY":m.ink=Math.min(1,m.ink+S*3),m.scribeAffinity=Math.min(1,m.scribeAffinity+S*2);break;case"CUT":{const C=Math.sqrt(b)+1e-5;b<g.radius*.3*(g.radius*.3)&&(m.vx+=y/C*S*5,m.vy+=v/C*S*5);break}}}}for(const g of s){g.phase=(g.phase+g.phaseVel*r*(.6+t.dance*1.4))%Nb;const m=g.x-I7,y=g.y-P7,v=Math.sqrt(m*m+y*y)+1e-7,b=Math.atan2(y,m),S=Math.sin(e.time*1.2+b*2)*.012+Math.sin(e.time*.7+b*3+g.phase)*.006+Math.sin(e.time*2.1+g.id*.3)*.004,C=m/v,k=y/v,R=-k,j=C,T=xX(g)+S,P=-(v-T)*i*(.7+.3*Math.cos(e.time*.5+g.id*.1));g.vx+=C*P*l,g.vy+=k*P*l;const I=g.intent<0?1:-.4+g.scribeAffinity*.6,$=1+Math.sin(e.time*.8+b*1.5)*t.dance*.4,q=u*(.4+g.coherence*.6)*$;g.vx+=R*q*I*l,g.vy+=j*q*I*l;const L=f(g,.1);if(L.length>0){let oe=0,le=0;for(const F of L)oe+=Math.sin(F.phase),le+=Math.cos(F.phase);const ce=Math.atan2(oe/L.length,le/L.length)-g.phase,te=Math.cos(ce);g.phase+=ce*c*r*.9,g.coherence=Math.min(1,g.coherence+(te>.55?.025:-.012)*r*5);for(const F of L){const Q=F.x-g.x,ae=F.y-g.y,we=Math.sqrt(Q*Q+ae*ae)+1e-6,ge=Math.cos(F.phase-g.phase)*8e-4*(1+g.coherence)*t.dance;we>.012&&we<.08&&(g.vx+=Q/we*ge*l,g.vy+=ae/we*ge*l),we<.015&&(g.vx-=Q/we*.0015*l,g.vy-=ae/we*.0015*l)}}else g.coherence=Math.max(0,g.coherence-.008*r);if(v>Uw){const oe=(v-Uw)*.6;g.vx-=C*oe*l,g.vy-=k*oe*l}if(v<Yw){const oe=(Yw-v)*.5;g.vx+=C*oe*l,g.vy+=k*oe*l}g.scribeAffinity>.78&&v>T*.85&&Math.sin(g.phase*3)>.85&&(g.vx+=C*.003*g.scribeAffinity*l,g.vy+=k*.003*g.scribeAffinity*l);const H=Math.sqrt(g.vx*g.vx+g.vy*g.vy),G=.022;H>G&&(g.vx=g.vx/H*G,g.vy=g.vy/H*G),g.vx*=.984,g.vy*=.984,g.x=Math.max(.02,Math.min(.98,g.x+g.vx*l)),g.y=Math.max(.02,Math.min(.98,g.y+g.vy*l)),g.ink=Math.min(1,g.ink+.025*r)}if(e.time-e.lastSnapshotTime>=e.snapshotInterval){const g=Gf(e,t);bX(e,g)}}function SX(e,t){let r=null,o=null;try{r=new OffscreenCanvas(e,t),o=r.getContext("2d",{alpha:!0})}catch{}return{offscreen:r,offCtx:o,width:e,height:t,lastFadeTime:0}}function wX(e,t,r){const{quanta:o}=e,s=60-t.inkDecay*30,l=[];for(const i of e.strokes)i.age+=r,i.alpha=Math.max(0,1-i.age/i.maxAge),i.age<i.maxAge&&l.push(i);e.strokes=l;for(const i of o){const u=i.coherence*i.scribeAffinity;if(u<.35||i.ink<.25||Math.random()>u*.04*r*60)continue;const c=3+Math.floor(u*8),d=[{x:i.x,y:i.y}];let h=i.x,f=i.y;for(let g=1;g<c;g++)h+=i.vx*.6/60,f+=i.vy*.6/60,d.push({x:(h%1+1)%1,y:(f%1+1)%1});e.strokes.push({points:d,thickness:1.5+u*3.5,alpha:.6+i.ink*.35,age:0,maxAge:s*(.7+i.scribeAffinity*.3)}),i.ink=Math.max(0,i.ink-.06*u)}e.strokes.length>800&&(e.strokes=e.strokes.slice(e.strokes.length-800))}const Q0=Math.PI*2;function CX(e){let t=2166136261;for(const r of e){const o=Math.round(r*100);t^=o,t=t*16777619>>>0}return t.toString(16).padStart(8,"0")}function Ei(e){return e=e^e<<13,e=e^e>>7,e=e^e<<17,(e>>>0)/4294967296}function ed(e,t){return Math.round(Math.max(0,Math.min(1,e))*t)/t}function MX(e,t,r,o=""){const s=ed(e.syncIndex,10),l=ed(e.coherenceMean,8),i=ed(e.loopCount,8),u=ed(e.symmetryIndex,6),c=ed(e.tensionIndex,6),d=ed(e.noveltyIndex,6),h=ed(e.densityMean,8),f=Math.round(e.polarityAxis/Q0*8)/8,g=[s,l,i,u,c,d,h,f],m=CX(g),y=`glyph_${m}_${o||Date.now()}`,v=.7+s*.2,b=t==="heptapod"||t==="recursive"?.07+l*.09:.05+h*.07,S=Math.max(0,e.tensionIndex*.4+e.noveltyIndex*.2),C={radius:v,thickness:b,roughness:S};let k;t==="recursive"?k=2+Math.round(i*3+u*2):k=1+Math.round(i*2);const R=[];for(let L=0;L<k;L++){let H;t==="recursive"?H=Math.pow(.618033988749895,L+1):H=(L+1)/(k+1),R.push({radius:v*(.15+H*.55),thickness:b*(.5+L*.1),phaseOffset:t==="recursive"?Ei(g[L%g.length]*1e3+L)*Q0+L*Math.PI*.382:Ei(g[L%g.length]*1e3+L)*Q0})}let j;t==="heptapod"||t==="recursive"?j=1+Math.round(c*1):j=Math.round((c+d)*.5*3);const T=[];for(let L=0;L<Math.min(3,j);L++){const H=L/Math.max(1,j)*Q0,G=(Ei(g[5]*1e3+L*77)-.5)*.5;T.push({angle:H+G,depth:.4+c*.5,width:.18+Ei(L*113)*.14})}let _;t==="linear"?_=0:t==="recursive"?_=Math.round(u*5+2):t==="heptapod"?_=Math.round(u*3+1):_=Math.round(e.eventRate*4);const P=[];for(let L=0;L<_;L++){const H=L/_*Q0+Ei(L*200)*.5,G=t==="recursive"?.15+Ei(L*300+1)*1.2:.3+Ei(L*300+1)*.8;P.push({startAngle:H,endAngle:H+G,radius:v*(t==="recursive"?.2+Ei(L*400)*.65:.5+Ei(L*400)*.35),thickness:b*.6})}const I=Math.round(t==="heptapod"||t==="recursive"?(1-e.silenceIndex)*e.densityMean*6:e.densityMean*3),$=[];for(let L=0;L<Math.min(6,I);L++)$.push({angle:L/Math.max(1,I)*Q0+Ei(L*500)*Q0*.3,radius:.3+Ei(L*600)*.55,size:.4+e.densityMean*.6,alpha:.4+e.coherenceMean*.5});const q={angle:e.polarityAxis,strength:Math.min(1,e.syncIndex*1.5)};return{outerRing:C,innerRings:R,notches:T,arcs:P,blots:$,axis:q,signatureHash:m,observables:e,timestamp:r,id:y}}const Qc=Math.PI*2;function S5(e,t,r,o){return e<.33?t:e<.67?r:o}function kX(e){const t=Math.round((e%Qc+Qc)%Qc/Qc*8)%8;return["E","NE","N","NW","W","SW","S","SE"][t]}function RX(e){return e<.4?"low":e<.7?"med":"high"}function _7(e){const t=e.observables,r=1+e.innerRings.length,o=e.notches.length,s=e.arcs.length,l=e.blots.length,i=RX(t.symmetryIndex),u=kX(t.polarityAxis),c=S5(t.densityMean,"sparse","normal","dense"),d=S5(t.coherenceMean,"chaos","mixed","coherent"),h=S5(t.tensionIndex,"calm","mid","tense"),f=S5(t.noveltyIndex,"stale","shifting","novel"),g=[`R${r}`,...o>0?[`N${o}`]:[],...s>0?[`A${s}`]:[],...l>0?[`B${l}`]:[],`SYM_${i.toUpperCase()}`,`AX_${u}`,`DEN_${c.toUpperCase()}`,`COH_${d.toUpperCase()}`,`TEN_${h.toUpperCase()}`,`NOV_${f.toUpperCase()}`],m=[r/4,o/5,s/4,l/6,t.symmetryIndex,(t.polarityAxis%Qc+Qc)%Qc/Qc,t.densityMean,t.coherenceMean,t.tensionIndex,t.noveltyIndex,t.syncIndex,t.loopCount,t.silenceIndex,t.eventRate];return{ringCount:r,notchCount:o,arcCount:s,blotCount:l,symmetryBin:i,axisBin:u,densityBin:c,coherenceBin:d,tensionBin:h,noveltyBin:f,tokens:g,embedding:m}}function AX(e,t){if(e.length!==t.length)return 0;let r=0,o=0,s=0;for(let l=0;l<e.length;l++)r+=e[l]*t[l],o+=e[l]*e[l],s+=t[l]*t[l];return r/(Math.sqrt(o)*Math.sqrt(s)+1e-8)}function jX(e){const t=new Set(e);return t.has("COH_COHERENT")&&t.has("SYM_HIGH")?"CONVERGE":t.has("COH_CHAOS")||t.has("TEN_TENSE")?"DIVERGE":t.has("DEN_SPARSE")&&t.has("NOV_STALE")?"SILENCE":t.has("DEN_DENSE")&&t.has("COH_COHERENT")?"AMPLIFY":t.has("N3")||t.has("N4")||t.has("N5")?"CUT":"CONVERGE"}function EX(e,t,r,o){const s=_7(e),l=jX(s.tokens),i=o.speakIntensity,u=.12+i*.18+s.ringCount*.02,c=2+i*6+s.arcCount*.5;return{glyphId:e.id,kind:l,strength:.3+i*.7,radius:u,duration:c,targetX:t,targetY:r,timestamp:Date.now()}}const Kw={CONVERGE:{label:"UNIR",color:"#60c0ff",desc:"Alinha fases, favorece loops e sincronizao"},DIVERGE:{label:"DISPERSAR",color:"#ff6060",desc:"Fragmenta, repele, reduz coerncia"},SILENCE:{label:"SILENCIAR",color:"#80ff80",desc:"Acalma velocidades, reduz depsito de tinta"},AMPLIFY:{label:"AMPLIFICAR",color:"#ffd060",desc:"Intensifica escrita e tinta, aumenta loops"},CUT:{label:"CORTAR",color:"#ff80ff",desc:"Cria fronteira local por tempo limitado"}};function TX(e,t){const r=t.filter(l=>l.status==="accepted").length,o=t.length>0?r/t.length:0,s=t.length>0?t.reduce((l,i)=>l+i.confidence,0)/t.length:0;return{sync:e.syncIndex,coherence:e.coherenceMean,novelty:e.noveltyIndex,loopDensity:e.loopCount,lexiconHealth:o,lexiconSize:t.length,avgConfidence:s}}const D7=[{id:"first_contact",name:"First Contact",emoji:"",description:"Anel limpo e estvel. Glifos bem formados. LLM ativo.",params:{agentCount:720,seed:127473,timeScope:.12,dance:.42,entrainment:.72,inkDecay:.25,loopThreshold:.86,speakIntensity:.65,dictionaryMode:"heptapod",llmAutoRefine:!0,preset:"first_contact"}},{id:"two_rings",name:"Two Rings",emoji:"",description:"Dois anis concntricos visveis  leitura no-linear.",params:{agentCount:600,seed:41651,timeScope:.2,dance:.34,entrainment:.62,inkDecay:.2,loopThreshold:.78,speakIntensity:.55,dictionaryMode:"heptapod",llmAutoRefine:!0,preset:"two_rings"}},{id:"glossolalia",name:"Glossolalia",emoji:"",description:"Muitos glifos  anel turb, splatters frequentes, lxico cresce rpido.",params:{agentCount:900,seed:24837,timeScope:.22,dance:.6,entrainment:.3,inkDecay:.55,loopThreshold:.5,speakIntensity:.72,dictionaryMode:"experimental",llmAutoRefine:!1,preset:"glossolalia"}},{id:"true_names",name:"True Names",emoji:"",description:"Anel denso e imvel. Poucos glifos nicos, Speak potente.",params:{agentCount:480,seed:30583,timeScope:.05,dance:.2,entrainment:.9,inkDecay:.15,loopThreshold:.92,speakIntensity:.95,dictionaryMode:"heptapod",llmAutoRefine:!0,preset:"true_names"}},{id:"nonlinear_time",name:"Nonlinear Time",emoji:"",description:"TimeScope alto  anel holstico, glifos estveis e cclicos.",params:{agentCount:650,seed:61680,timeScope:.78,dance:.44,entrainment:.54,inkDecay:.12,loopThreshold:.68,speakIntensity:.5,dictionaryMode:"heptapod",llmAutoRefine:!1,preset:"nonlinear_time"}}],fx=D7[0].params,xo=Math.PI*2;function go(e){const t=Math.sin(e*9301+49297)*233280;return t-Math.floor(t)}function L7(e,t){const r=(e%xo+xo)%xo;for(const o of t){const s=(o.angle%xo+xo)%xo,l=o.width*.22;if(Math.abs((r-s+Math.PI*3)%xo-Math.PI)<l)return!0}return!1}function z7(e,t,r){let o=1;o+=.2*Math.sin(e*xo*3+t*.011),o+=.12*Math.sin(e*xo*5+t*.023),o+=.07*Math.sin(e*xo*8+t*.037);for(const s of r){const l=(s.angle%xo+xo)%xo,i=e*xo,u=Math.abs((i-l+Math.PI*3)%xo-Math.PI);if(u<s.width*2.5){const c=u/(s.width*2.5);o*=.18+.82*c}}return Math.max(.05,o)}function Xw(e,t,r,o,s,l,i,u=!1){if(o<=1)return;const c=u?60:o<40?100:o<80?160:220,d=o*.105,h=u?[{widthMult:1,alpha:.88,rOff:0}]:[{widthMult:2,alpha:.09,rOff:1.2},{widthMult:1.35,alpha:.22,rOff:.4},{widthMult:1,alpha:.91,rOff:0},{widthMult:.45,alpha:.52,rOff:-.5}];for(const f of h)for(let g=0;g<c;g++){const m=g/c,y=(g+1)/c,v=m*xo-Math.PI/2,b=y*xo-Math.PI/2;if(L7(v,s))continue;const S=z7(m,i,s),C=i+g*7+f.rOff*1e3,k=i+(g+1)*7+f.rOff*1e3,R=l>.01?(go(C)-.5)*l*o*.14:0,j=l>.01?(go(k)-.5)*l*o*.14:0,T=Math.max(.1,o+f.rOff+R),_=Math.max(.1,o+f.rOff+j);e.beginPath(),e.moveTo(t+Math.cos(v)*T,r+Math.sin(v)*T),e.lineTo(t+Math.cos(b)*_,r+Math.sin(b)*_),e.lineWidth=Math.max(.5,d*f.widthMult*S),e.strokeStyle=`rgba(8,5,2,${f.alpha})`,e.lineCap="round",e.stroke()}}function IX(e,t,r,o,s,l){const i=o*(.14+go(l)*.18),u=Math.max(.5,i*(.28+go(l+1)*.22));e.beginPath(),e.arc(t,r,u,0,xo),e.fillStyle="rgba(6,4,2,0.96)",e.fill();for(let d=0;d<4;d++){const h=s+(go(l+d*3+10)-.5)*Math.PI*.6,f=u*(.35+go(l+d*3+11)*.55),g=Math.max(.4,u*(.35+go(l+d*3+12)*.65));e.beginPath(),e.arc(t+Math.cos(h)*f,r+Math.sin(h)*f,g,0,xo),e.fillStyle=`rgba(6,4,2,${.72+go(l+d*3+13)*.24})`,e.fill()}const c=3+Math.floor(go(l+2)*6);for(let d=0;d<c;d++){const f=go(l+d*7+20)>.18?s:s+Math.PI,g=(go(l+d*7+21)-.5)*Math.PI*.9,m=f+g,y=i*(.7+go(l+d*7+22)*2.8),v=Math.max(.4,i*(.035+go(l+d*7+23)*.1)),b=.5+go(l+d*7+24)*.46,S=(go(l+d*7+25)-.5)*.8,C=y*(.3+go(l+d*7+26)*.35),k=t+Math.cos(m+S)*C,R=r+Math.sin(m+S)*C,j=t+Math.cos(m)*y,T=r+Math.sin(m)*y;e.beginPath(),e.moveTo(t,r),e.quadraticCurveTo(k,R,j,T),e.lineWidth=v,e.strokeStyle=`rgba(6,4,2,${b})`,e.lineCap="round",e.stroke();const _=Math.max(.3,v*(1+go(l+d*7+27)*1.8));if(e.beginPath(),e.arc(j,T,_,0,xo),e.fillStyle=`rgba(6,4,2,${b*.88})`,e.fill(),y>i*.85&&go(l+d*7+28)>.42){const P=1+Math.floor(go(l+d*7+29)*2);for(let I=0;I<P;I++){const $=.42+go(l+d*7+I*31+30)*.38,q=1-$,L=q*q*t+2*q*$*k+$*$*j,H=q*q*r+2*q*$*R+$*$*T,G=m+(go(l+d*7+I*31+31)-.5)*Math.PI*.75,oe=y*(.14+go(l+d*7+I*31+32)*.32);e.beginPath(),e.moveTo(L,H),e.lineTo(L+Math.cos(G)*oe,H+Math.sin(G)*oe),e.lineWidth=Math.max(.3,v*.55),e.strokeStyle=`rgba(6,4,2,${b*.65})`,e.stroke()}}}}function Zw(e,t,r,o,s,l,i,u){if(o<=1)return;const c=o<40?100:o<80?160:220,d=o*.105,h=[{widthMult:2,alpha:.07,rOff:1.5},{widthMult:1.35,alpha:.18,rOff:.6},{widthMult:1,alpha:.88,rOff:0},{widthMult:.45,alpha:.45,rOff:-.6}];for(const f of h)for(let g=0;g<c;g++){const m=g/c,y=(g+1)/c,v=m*xo-Math.PI/2,b=y*xo-Math.PI/2;if(L7(v,s))continue;const S=z7(m,i,s),C=u*1.8+i*.001,k=.85+.15*Math.sin(v*3+C)+.1*Math.sin(v*5-C*.7)+.05*Math.sin(v*8+C*1.3),R=Math.sin(u*.9+v*2)*o*.015+Math.sin(u*1.7+v*4)*o*.008,j=i+g*7+f.rOff*1e3,T=i+(g+1)*7+f.rOff*1e3,_=l>.01?(go(j)-.5)*l*o*.14:0,P=l>.01?(go(T)-.5)*l*o*.14:0,I=Math.max(.1,o+f.rOff+_+R),$=Math.max(.1,o+f.rOff+P+R);e.beginPath(),e.moveTo(t+Math.cos(v)*I,r+Math.sin(v)*I),e.lineTo(t+Math.cos(b)*$,r+Math.sin(b)*$),e.lineWidth=Math.max(.5,d*f.widthMult*S*k),e.strokeStyle=`rgba(8,5,2,${f.alpha*k})`,e.lineCap="round",e.stroke()}}function Dd(e,t,r,o,s,l={}){if(s<=2)return;const{alpha:i=1,skipBackground:u=!1,fast:c=s<32,animated:d=!1,time:h=0}=l,f=(parseInt(t.signatureHash.slice(0,8),16)||1)>>>0,g=Math.max(2,s*Math.max(.55,t.outerRing.radius));if(e.save(),e.globalAlpha=i,u||(e.beginPath(),e.arc(r,o,s*1.08,0,xo),e.fillStyle="rgba(250,248,244,0.97)",e.fill(),c||(e.beginPath(),e.arc(r,o,s*1.08,0,xo),e.strokeStyle="rgba(190,180,165,0.25)",e.lineWidth=.8,e.stroke())),d&&!c?Zw(e,r,o,g,t.notches,t.outerRing.roughness,f,h):Xw(e,r,o,g,t.notches,t.outerRing.roughness,f,c),!c&&t.innerRings.length>0)for(let y=0;y<t.innerRings.length;y++){const v=t.innerRings[y],b=Math.max(2,s*Math.max(.2,v.radius)),S=d?h*.5*(y%2===0?1:-1)+v.phaseOffset:v.phaseOffset;e.save(),e.translate(r,o),e.rotate(S),e.translate(-r,-o),d?Zw(e,r,o,b,[],t.outerRing.roughness*.5,f+y*999+7777,h):Xw(e,r,o,b,[],t.outerRing.roughness*.5,f+y*999+7777,!1),e.restore()}const m=c?Math.min(1,t.notches.length):t.notches.length;for(let y=0;y<m;y++){const b=t.notches[y].angle+(d?Math.sin(h*.6+y*1.2)*.06:0),S=g+(d?Math.sin(h*1.1+y)*s*.02:0),C=r+Math.cos(b)*S,k=o+Math.sin(b)*S;IX(e,C,k,s,b,f+y*4001)}e.restore()}function PX({spec:e,lexEntry:t,selected:r,onClick:o,onSpeak:s}){const l=w.useRef(null),i=w.useRef(0),u=w.useRef(0),c=54;w.useEffect(()=>{let f=!0;const g=()=>{if(!f)return;const m=l.current;if(m){const y=m.getContext("2d");y&&(y.clearRect(0,0,c,c),u.current+=.016,Dd(y,e,c/2,c/2,c*.44,{alpha:.96,animated:r,time:u.current}))}i.current=requestAnimationFrame(g)};return g(),()=>{f=!1,cancelAnimationFrame(i.current)}},[e,r]);const d=(t==null?void 0:t.confidence)??0,h=d>.7?"#2a9a50":d>.4?"#b07a10":"#aa3020";return a.jsxs("div",{title:t?`${t.gloss}  conf ${Math.round(d*100)}%`:e.signatureHash.slice(0,8),style:{position:"relative",cursor:"pointer",flexShrink:0,borderRadius:6,border:r?"2px solid rgba(40,30,20,0.6)":"1px solid rgba(180,170,155,0.45)",overflow:"hidden",background:"rgba(250,248,244,0.97)",transition:"border-color 0.2s, transform 0.15s",transform:r?"scale(1.07)":"scale(1)"},onClick:o,onDoubleClick:s,children:[a.jsx("div",{style:{filter:"none"},children:a.jsx("canvas",{ref:l,width:c,height:c,style:{display:"block"}})}),t&&a.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,background:"rgba(248,244,238,0.88)",fontSize:7,color:"rgba(40,30,20,0.7)",textAlign:"center",padding:"1px 2px",letterSpacing:"0.05em",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},children:t.gloss}),a.jsx("div",{style:{position:"absolute",top:3,right:3,width:4,height:4,borderRadius:"50%",background:t?h:"rgba(100,90,80,0.2)"}})]})}function FX({glyphs:e,lexicon:t,selectedId:r,onSelect:o,onSpeak:s}){const l=new Map(t.map(i=>[i.signatureHash,i]));return a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"6px 10px",borderTop:"1px solid rgba(160,150,135,0.2)",overflowX:"auto",overflowY:"hidden",scrollbarWidth:"thin",scrollbarColor:"rgba(100,80,60,0.2) transparent",minHeight:70,background:"rgba(248,245,240,0.97)"},children:[a.jsx("div",{style:{fontSize:7,color:"rgba(100,85,65,0.45)",letterSpacing:"0.15em",textTransform:"uppercase",flexShrink:0,paddingRight:4,writingMode:"vertical-rl"},children:"STREAM"}),e.length===0&&a.jsx("div",{style:{fontSize:9,color:"rgba(100,85,65,0.4)",letterSpacing:"0.1em",padding:"0 10px"},children:"aguardando glifos..."}),[...e].reverse().map(i=>a.jsx(PX,{spec:i,lexEntry:l.get(i.signatureHash),selected:r===i.id,onClick:()=>o(i),onSpeak:()=>s(i)},i.id))]})}function NX({spec:e,size:t=140}){const r=w.useRef(null),o=w.useRef(0),s=w.useRef(0);return w.useEffect(()=>{let l=!0;const i=()=>{if(!l)return;const u=r.current;if(u){const c=u.getContext("2d");c&&(c.clearRect(0,0,t,t),s.current+=.016,Dd(c,e,t/2,t/2,t*.46,{alpha:.96,animated:!0,time:s.current}))}o.current=requestAnimationFrame(i)};return i(),()=>{l=!1,cancelAnimationFrame(o.current)}},[e,t]),a.jsx("canvas",{ref:r,width:t,height:t,style:{display:"block",borderRadius:8,boxShadow:"0 2px 12px rgba(0,0,0,0.25)"}})}function OX({spec:e,entry:t,allEntries:r,llmLoading:o,onAskLLM:s,onAccept:l,onEdit:i,onLink:u,onClose:c,onSpeak:d}){const[h,f]=w.useState(null),[g,m]=w.useState(""),[y,v]=w.useState(""),[b,S]=w.useState(!1),C={position:"absolute",top:60,right:8,zIndex:30,width:280,background:"rgba(8,6,20,0.97)",border:"1px solid rgba(160,80,255,0.25)",borderRadius:10,padding:14,fontFamily:"system-ui, sans-serif",color:"rgba(230,220,210,0.9)",backdropFilter:"blur(12px)",boxShadow:"0 4px 32px rgba(0,0,0,0.6)",maxHeight:"calc(100vh - 140px)",overflowY:"auto"},k={fontSize:8,letterSpacing:"0.14em",textTransform:"uppercase",color:"rgba(160,80,255,0.7)",marginBottom:2},R={fontSize:11,color:"rgba(235,225,210,0.85)",marginBottom:10,lineHeight:1.5},j=(t==null?void 0:t.confidence)??0,T=Math.round(j*100),_=j>.7?"#80ff80":j>.4?"#ffd060":"#ff8060",P=y.length>0?r.filter(I=>I.gloss.toLowerCase().includes(y.toLowerCase())&&I.glyphId!==e.id).slice(0,5):[];return a.jsxs("div",{style:C,children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:12},children:[a.jsxs("div",{children:[a.jsxs("div",{style:{fontSize:7,color:"rgba(160,80,255,0.5)",letterSpacing:"0.12em"},children:["HEPTAPOD  ",e.signatureHash.slice(0,8)]}),a.jsx("div",{style:{fontSize:15,color:"rgba(242,232,215,0.95)",marginTop:2},children:(t==null?void 0:t.gloss)??""}),t&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,marginTop:3},children:[a.jsx("div",{style:{width:5,height:5,borderRadius:"50%",background:_}}),a.jsxs("span",{style:{fontSize:8,color:_},children:[T,"% conf"]}),t.status==="accepted"&&a.jsx(K5,{size:9,color:"#80ff80"}),t.needs_verification&&a.jsx(IC,{size:9,color:"#ffd060"})]})]}),a.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center"},children:[a.jsx("button",{onClick:()=>d(e),style:{fontSize:8,padding:"3px 8px",borderRadius:5,cursor:"pointer",background:"rgba(160,80,255,0.15)",border:"1px solid rgba(160,80,255,0.3)",color:"rgba(200,160,255,0.9)",letterSpacing:"0.1em"},children:"SPEAK"}),a.jsx("button",{onClick:c,style:{background:"none",border:"none",cursor:"pointer",color:"rgba(255,255,255,0.3)"},children:a.jsx(ya,{size:12})})]})]}),a.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:12},children:a.jsx(NX,{spec:e,size:130})}),a.jsx("div",{style:k,children:"Tokens"}),a.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:3,marginBottom:10},children:[e.observables&&((t==null?void 0:t.tokens)??[]).map(I=>a.jsx("span",{style:{fontSize:8,padding:"1px 5px",borderRadius:3,background:"rgba(160,80,255,0.12)",border:"1px solid rgba(160,80,255,0.2)",color:"rgba(200,170,255,0.8)"},children:I},I)),!t&&e.id&&a.jsx("span",{style:{fontSize:8,color:"rgba(255,255,255,0.25)"},children:"sem verbete ainda"})]}),t&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:k,children:"Definio"}),h==="definition"?a.jsx("textarea",{value:g,onChange:I=>m(I.target.value),onBlur:()=>{i(e.id,"definition",g),f(null)},autoFocus:!0,style:{width:"100%",fontSize:10,background:"rgba(0,0,0,0.5)",border:"1px solid rgba(160,80,255,0.3)",color:"rgba(235,225,210,0.9)",borderRadius:4,padding:4,resize:"vertical",minHeight:50}}):a.jsx("div",{style:R,onClick:()=>{f("definition"),m(t.definition)},children:t.definition||""}),a.jsx("div",{style:k,children:"Uso"}),a.jsx("div",{style:R,children:t.usage||""}),t.contrasts.length>0&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:k,children:"Contrasta com"}),a.jsx("div",{style:{...R,display:"flex",flexWrap:"wrap",gap:3},children:t.contrasts.map(I=>a.jsx("span",{style:{fontSize:9,padding:"1px 5px",borderRadius:3,background:"rgba(255,80,60,0.1)",border:"1px solid rgba(255,80,60,0.2)",color:"rgba(255,140,120,0.8)"},children:I},I))})]}),t.examples.length>0&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:k,children:["Ocorrncias (",t.frequency,")"]}),a.jsx("div",{style:{fontSize:9,color:"rgba(200,190,180,0.6)",marginBottom:10},children:t.examples.slice(-3).map((I,$)=>a.jsxs("div",{children:[" ",new Date(I.timestamp).toLocaleTimeString()]},$))})]}),t.tags.length>0&&a.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:3,marginBottom:10},children:t.tags.map(I=>a.jsxs("span",{style:{fontSize:7,padding:"1px 5px",borderRadius:3,background:"rgba(60,160,255,0.1)",border:"1px solid rgba(60,160,255,0.2)",color:"rgba(120,180,255,0.7)"},children:["#",I]},I))})]}),a.jsxs("div",{style:{display:"flex",gap:5,flexWrap:"wrap",marginTop:4},children:[a.jsxs("button",{onClick:()=>s(e,t),disabled:o,style:{flex:1,fontSize:8,padding:"4px 6px",borderRadius:5,cursor:o?"wait":"pointer",background:o?"rgba(160,80,255,0.05)":"rgba(160,80,255,0.14)",border:"1px solid rgba(160,80,255,0.3)",color:"rgba(200,160,255,0.9)",display:"flex",alignItems:"center",justifyContent:"center",gap:4,opacity:o?.5:1},children:[a.jsx(Yi,{size:9}),o?"Pensando":"Ask LLM"]}),t&&a.jsxs(a.Fragment,{children:[a.jsxs("button",{onClick:()=>l(e.id),style:{fontSize:8,padding:"4px 7px",borderRadius:5,cursor:"pointer",background:t.status==="accepted"?"rgba(80,200,80,0.15)":"rgba(255,255,255,0.06)",border:"1px solid rgba(80,200,80,0.25)",color:"rgba(140,220,140,0.9)",display:"flex",alignItems:"center",gap:3},children:[a.jsx(K5,{size:9}),t.status==="accepted"?"Aceito":"Aceitar"]}),a.jsxs("button",{onClick:()=>S(!b),style:{fontSize:8,padding:"4px 7px",borderRadius:5,cursor:"pointer",background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.1)",color:"rgba(200,200,200,0.8)",display:"flex",alignItems:"center",gap:3},children:[a.jsx(_C,{size:9}),"Link"]})]})]}),b&&a.jsxs("div",{style:{marginTop:8},children:[a.jsx("input",{value:y,onChange:I=>v(I.target.value),placeholder:"buscar gloss",style:{width:"100%",fontSize:9,padding:"3px 6px",borderRadius:4,boxSizing:"border-box",background:"rgba(0,0,0,0.5)",border:"1px solid rgba(160,80,255,0.2)",color:"rgba(235,225,210,0.85)",outline:"none"}}),P.map(I=>a.jsx("div",{onClick:()=>{u(e.id,I.gloss),S(!1),v("")},style:{padding:"4px 6px",cursor:"pointer",fontSize:9,color:"rgba(200,190,180,0.8)",borderBottom:"1px solid rgba(255,255,255,0.04)"},children:I.gloss},I.glyphId))]})]})}const B7="heptapod_lexicon_v1",_X="heptapod_sessions_v1";function td(e){try{localStorage.setItem(B7,JSON.stringify(e))}catch{}}function DX(){try{const e=localStorage.getItem(B7);return e?JSON.parse(e):[]}catch{return[]}}function LX(){try{const e=localStorage.getItem(_X);return e?JSON.parse(e):[]}catch{return[]}}function zX(e,t){const r={version:1,exportedAt:new Date().toISOString(),lexicon:e,sessions:t},o=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),s=URL.createObjectURL(o),l=document.createElement("a");l.href=s,l.download=`heptapod_grimoire_${Date.now()}.json`,l.click(),URL.revokeObjectURL(s)}function BX(e,t,r){const o=new FileReader;o.onload=s=>{var l;try{const i=JSON.parse((l=s.target)==null?void 0:l.result);if(!Array.isArray(i.lexicon))throw new Error("Invalid format");t(i)}catch(i){r(i.message)}},o.readAsText(e)}function Jw(e,t){const r=e.findIndex(o=>o.glyphId===t.glyphId);if(r>=0){const o=[...e];return o[r]={...o[r],...t,lastUpdated:Date.now()},o}return[...e,{...t,lastUpdated:Date.now()}]}function $X({entry:e,onClick:t}){const r=w.useRef(null),o=36;Yt.useEffect(()=>{const i=r.current;if(!i)return;const u=i.getContext("2d");u&&(u.clearRect(0,0,o,o),u.fillStyle="rgba(0,0,0,0.5)",u.fillRect(0,0,o,o),Dd(u,e.miniGlyphSpec,o/2,o/2,o*.43,{alpha:.88}))},[e.miniGlyphSpec,o]);const s=e.confidence,l=s>.7?"#80ff80":s>.4?"#ffd060":"#ff8060";return a.jsxs("div",{onClick:t,style:{display:"flex",alignItems:"center",gap:8,padding:"6px 10px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.04)",transition:"background 0.15s"},onMouseEnter:i=>i.currentTarget.style.background="rgba(160,80,255,0.07)",onMouseLeave:i=>i.currentTarget.style.background="transparent",children:[a.jsx("canvas",{ref:r,width:o,height:o,style:{borderRadius:4,flexShrink:0}}),a.jsxs("div",{style:{flex:1,minWidth:0},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5},children:[a.jsx("span",{style:{fontSize:11,color:"rgba(242,232,215,0.92)",fontWeight:500},children:e.gloss||"(sem gloss)"}),e.status==="accepted"?a.jsx(K5,{size:9,color:"#80ff80"}):a.jsx(IC,{size:9,color:"rgba(255,255,255,0.2)"})]}),a.jsx("div",{style:{fontSize:9,color:"rgba(200,190,180,0.6)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.definition||e.tokens.slice(0,4).join("  ")}),a.jsxs("div",{style:{display:"flex",gap:6,marginTop:2},children:[a.jsxs("span",{style:{fontSize:7,color:l},children:[Math.round(s*100),"%"]}),a.jsxs("span",{style:{fontSize:7,color:"rgba(255,255,255,0.2)"},children:[e.frequency,""]}),e.tags.slice(0,2).map(i=>a.jsxs("span",{style:{fontSize:7,color:"rgba(100,160,255,0.6)"},children:["#",i]},i))]})]})]})}function qX({entries:e,clusters:t,sessions:r,onSelect:o,onClose:s,onImport:l}){const[i,u]=w.useState(""),[c,d]=w.useState("recent"),[h,f]=w.useState(null),g=w.useRef(null),m=w.useMemo(()=>{let b=[...e];if(h&&(b=b.filter(S=>S.clusterId===h)),i.trim()){const S=i.toLowerCase();b=b.filter(C=>C.gloss.toLowerCase().includes(S)||C.definition.toLowerCase().includes(S)||C.tags.some(k=>k.toLowerCase().includes(S))||C.tokens.some(k=>k.toLowerCase().includes(S)))}return b.sort((S,C)=>c==="confidence"?C.confidence-S.confidence:c==="frequency"?C.frequency-S.frequency:C.lastUpdated-S.lastUpdated),b},[e,i,c,h]),y={position:"fixed",top:0,right:0,bottom:0,width:320,zIndex:50,background:"rgba(6,4,18,0.98)",borderLeft:"1px solid rgba(160,80,255,0.2)",display:"flex",flexDirection:"column",fontFamily:"system-ui, sans-serif",backdropFilter:"blur(16px)",boxShadow:"-4px 0 40px rgba(0,0,0,0.7)"},v=["#a070ff","#60c0ff","#ff8060","#80ff80","#ffd060"];return a.jsxs("div",{style:y,children:[a.jsxs("div",{style:{padding:"12px 14px 8px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10},children:[a.jsxs("div",{children:[a.jsx("div",{style:{fontSize:8,letterSpacing:"0.18em",color:"rgba(160,80,255,0.6)",textTransform:"uppercase"},children:"Grimrio Heptapod"}),a.jsxs("div",{style:{fontSize:13,color:"rgba(242,232,215,0.9)",marginTop:1},children:[e.length," verbetes"]})]}),a.jsxs("div",{style:{display:"flex",gap:5},children:[a.jsx("button",{onClick:()=>zX(e,r),title:"Exportar JSON",style:{background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:5,padding:"4px 6px",cursor:"pointer",color:"rgba(200,200,200,0.7)"},children:a.jsx(FC,{size:11})}),a.jsx("button",{onClick:()=>{var b;return(b=g.current)==null?void 0:b.click()},title:"Importar JSON",style:{background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:5,padding:"4px 6px",cursor:"pointer",color:"rgba(200,200,200,0.7)"},children:a.jsx(sT,{size:11})}),a.jsx("input",{ref:g,type:"file",accept:".json",style:{display:"none"},onChange:b=>{var C;const S=(C=b.target.files)==null?void 0:C[0];S&&BX(S,k=>l(k.lexicon),k=>alert(k)),b.target.value=""}}),a.jsx("button",{onClick:s,style:{background:"none",border:"none",cursor:"pointer",color:"rgba(255,255,255,0.3)"},children:a.jsx(ya,{size:13})})]})]}),a.jsxs("div",{style:{position:"relative"},children:[a.jsx(NE,{size:10,style:{position:"absolute",left:8,top:"50%",transform:"translateY(-50%)",color:"rgba(255,255,255,0.2)"}}),a.jsx("input",{value:i,onChange:b=>u(b.target.value),placeholder:"buscar gloss, tag, token",style:{width:"100%",fontSize:10,padding:"5px 8px 5px 24px",borderRadius:5,background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,255,255,0.1)",color:"rgba(235,225,210,0.85)",outline:"none",boxSizing:"border-box"}})]})]}),t.length>0&&a.jsxs("div",{style:{padding:"6px 14px",borderBottom:"1px solid rgba(255,255,255,0.04)",display:"flex",gap:5,flexWrap:"wrap"},children:[a.jsx("button",{onClick:()=>f(null),style:{fontSize:8,padding:"2px 7px",borderRadius:10,cursor:"pointer",background:h?"rgba(255,255,255,0.05)":"rgba(160,80,255,0.2)",border:`1px solid ${h?"rgba(255,255,255,0.08)":"rgba(160,80,255,0.4)"}`,color:h?"rgba(200,200,200,0.5)":"rgba(200,160,255,0.9)"},children:"todos"}),t.map((b,S)=>a.jsxs("button",{onClick:()=>f(h===b.id?null:b.id),style:{fontSize:8,padding:"2px 7px",borderRadius:10,cursor:"pointer",background:h===b.id?`${v[S%v.length]}22`:"rgba(255,255,255,0.05)",border:`1px solid ${h===b.id?v[S%v.length]+"55":"rgba(255,255,255,0.08)"}`,color:v[S%v.length]+"cc"},children:[b.label," (",b.members.length,")"]},b.id))]}),a.jsxs("div",{style:{padding:"4px 14px",borderBottom:"1px solid rgba(255,255,255,0.04)",display:"flex",gap:5,alignItems:"center"},children:[a.jsx(Nj,{size:9,style:{color:"rgba(255,255,255,0.2)"}}),["confidence","recent","frequency"].map(b=>a.jsx("button",{onClick:()=>d(b),style:{fontSize:7,padding:"1px 6px",borderRadius:3,cursor:"pointer",background:c===b?"rgba(160,80,255,0.15)":"transparent",border:`1px solid ${c===b?"rgba(160,80,255,0.3)":"transparent"}`,color:c===b?"rgba(200,160,255,0.9)":"rgba(200,200,200,0.35)",textTransform:"uppercase",letterSpacing:"0.08em"},children:b},b)),a.jsx("span",{style:{marginLeft:"auto",fontSize:7,color:"rgba(255,255,255,0.2)"},children:m.length})]}),a.jsxs("div",{style:{flex:1,overflowY:"auto",scrollbarWidth:"thin",scrollbarColor:"rgba(160,80,255,0.15) transparent"},children:[m.length===0&&a.jsx("div",{style:{padding:20,fontSize:10,color:"rgba(255,255,255,0.2)",textAlign:"center"},children:e.length===0?"Dicionrio vazio  Listen por 1 minuto!":"Nenhum resultado."}),m.map(b=>a.jsx($X,{entry:b,onClick:()=>o(b)},b.glyphId))]})]})}var e0={};function $7(){var e;return typeof process<"u"&&(e0!=null&&e0.OPENAI_API_KEY)?e0.OPENAI_API_KEY:typeof window<"u"&&((e=window.__APP_CONFIG__)!=null&&e.OPENAI_API_KEY)?window.__APP_CONFIG__.OPENAI_API_KEY:null}function WX(){var e;return typeof process<"u"&&(e0!=null&&e0.OPENAI_MODEL)?e0.OPENAI_MODEL:typeof window<"u"&&((e=window.__APP_CONFIG__)!=null&&e.OPENAI_MODEL)?window.__APP_CONFIG__.OPENAI_MODEL??"gpt-4o-mini":"gpt-4o-mini"}async function q7(e,t=2e4){var l,i,u;const r=$7();if(!r)throw new Error("OPENAI_API_KEY no configurada. Defina em process.env.OPENAI_API_KEY ou window.__APP_CONFIG__.OPENAI_API_KEY");const o=new AbortController,s=setTimeout(()=>o.abort(),t);try{const c=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({model:WX(),messages:e,temperature:.3,max_tokens:512,response_format:{type:"json_object"}}),signal:o.signal});if(!c.ok){const h=await c.text().catch(()=>c.statusText);throw new Error(`OpenAI ${c.status}: ${h}`)}return((u=(i=(l=(await c.json()).choices)==null?void 0:l[0])==null?void 0:i.message)==null?void 0:u.content)??""}finally{clearTimeout(s)}}function HX(){return $7()!==null}function GX({status:e,events:t,lastRationale:r,onConfigKey:o}){const[s,l]=w.useState(!0),[i,u]=w.useState(!1),[c,d]=w.useState(""),h=HX(),f=e.state==="ok"?"#80ff80":e.state==="loading"?"#ffd060":e.state==="error"?"#ff6060":"rgba(255,255,255,0.2)",g={background:"rgba(6,4,18,0.92)",border:"1px solid rgba(160,80,255,0.2)",borderRadius:8,margin:"0 0 0 0",fontFamily:"system-ui, sans-serif",overflow:"hidden"},m={display:"flex",alignItems:"center",gap:7,padding:"7px 10px",cursor:"pointer",borderBottom:s?"1px solid rgba(255,255,255,0.05)":"none"};return a.jsxs("div",{style:g,children:[a.jsxs("div",{style:m,onClick:()=>l(!s),children:[a.jsx(Yi,{size:11,color:"rgba(200,160,255,0.7)"}),a.jsx("span",{style:{fontSize:9,letterSpacing:"0.14em",textTransform:"uppercase",color:"rgba(200,160,255,0.8)",flex:1},children:"Lexicgrafo LLM"}),a.jsx("div",{style:{width:6,height:6,borderRadius:"50%",background:f}}),s?a.jsx(Pa,{size:10,color:"rgba(255,255,255,0.3)"}):a.jsx(aa,{size:10,color:"rgba(255,255,255,0.3)"})]}),s&&a.jsxs("div",{style:{padding:"8px 10px"},children:[!h&&!i&&a.jsxs("div",{style:{marginBottom:8},children:[a.jsxs("div",{style:{fontSize:9,color:"#ffd060",marginBottom:4,display:"flex",gap:4,alignItems:"center"},children:[a.jsx(n9,{size:10}),"OPENAI_API_KEY no configurada"]}),a.jsxs("button",{onClick:()=>u(!0),style:{fontSize:8,padding:"3px 8px",borderRadius:4,cursor:"pointer",background:"rgba(255,200,60,0.12)",border:"1px solid rgba(255,200,60,0.3)",color:"rgba(255,220,120,0.9)",display:"flex",alignItems:"center",gap:4},children:[a.jsx(Y9,{size:9})," Configurar key temporria"]})]}),i&&a.jsxs("div",{style:{marginBottom:8},children:[a.jsx("input",{value:c,onChange:y=>d(y.target.value),placeholder:"sk-",type:"password",style:{width:"100%",fontSize:9,padding:"4px 6px",borderRadius:4,boxSizing:"border-box",background:"rgba(0,0,0,0.6)",border:"1px solid rgba(255,200,60,0.3)",color:"rgba(255,230,150,0.9)",outline:"none"}}),a.jsxs("div",{style:{display:"flex",gap:4,marginTop:4},children:[a.jsx("button",{onClick:()=>{o(c),u(!1),d("")},style:{fontSize:8,padding:"3px 8px",borderRadius:4,cursor:"pointer",background:"rgba(80,200,80,0.15)",border:"1px solid rgba(80,200,80,0.3)",color:"rgba(140,220,140,0.9)"},children:"Salvar"}),a.jsx("button",{onClick:()=>u(!1),style:{fontSize:8,padding:"3px 8px",borderRadius:4,cursor:"pointer",background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.1)",color:"rgba(200,200,200,0.5)"},children:"Cancelar"})]}),a.jsx("div",{style:{fontSize:7,color:"rgba(255,200,60,0.5)",marginTop:4,lineHeight:1.4},children:" A key no  enviada a servidores externos alm da OpenAI API. Figma Make no  indicado para coletar dados sensveis."})]}),h&&e.state==="idle"&&a.jsxs("div",{style:{fontSize:9,color:"rgba(140,220,140,0.6)",marginBottom:6,display:"flex",gap:4,alignItems:"center"},children:[a.jsx(K5,{size:9}),'Pronto  clique "Ask LLM" em qualquer glifo']}),e.state==="loading"&&a.jsx("div",{style:{fontSize:9,color:"#ffd060",marginBottom:6},children:" Consultando lexicgrafo"}),e.state==="error"&&a.jsxs("div",{style:{fontSize:9,color:"#ff8060",marginBottom:6,lineHeight:1.4},children:[" ",e.lastError]}),r&&a.jsxs("div",{style:{marginBottom:8},children:[a.jsx("div",{style:{fontSize:7,color:"rgba(160,80,255,0.5)",letterSpacing:"0.1em",textTransform:"uppercase",marginBottom:3},children:"ltimo raciocnio"}),a.jsx("div",{style:{fontSize:9,color:"rgba(210,200,190,0.7)",lineHeight:1.5,borderLeft:"2px solid rgba(160,80,255,0.25)",paddingLeft:6},children:r})]}),t.length>0&&a.jsxs("div",{children:[a.jsx("div",{style:{fontSize:7,color:"rgba(255,255,255,0.2)",letterSpacing:"0.1em",textTransform:"uppercase",marginBottom:4},children:"Eventos recentes"}),t.slice(-5).reverse().map(y=>a.jsxs("div",{style:{fontSize:8,color:"rgba(200,190,180,0.6)",marginBottom:2,display:"flex",gap:5},children:[a.jsx("span",{style:{color:"rgba(160,80,255,0.5)",flexShrink:0},children:y.kind==="GLYPH_SHIFT"?"":y.kind==="PATTERN_STABLE"?"":y.kind==="SPEAK_EFFECT"?"":""}),a.jsx("span",{children:y.description})]},y.id))]})]})]})}const nd={fontSize:8,padding:"3px 8px",borderRadius:4,cursor:"pointer",letterSpacing:"0.1em",textTransform:"uppercase",display:"flex",alignItems:"center",gap:4},W7={display:"flex",alignItems:"center",gap:6,marginBottom:4};function rd({label:e,value:t,min:r=0,max:o=1,step:s=.01,onChange:l}){return a.jsxs("div",{style:W7,children:[a.jsx("span",{style:{fontSize:7,color:"rgba(200,190,180,0.5)",width:70,letterSpacing:"0.08em",textTransform:"uppercase",flexShrink:0},children:e}),a.jsx("input",{type:"range",min:r,max:o,step:s,value:t,onChange:i=>l(parseFloat(i.target.value)),style:{flex:1,height:2,accentColor:"rgba(160,80,255,0.8)",cursor:"pointer"}}),a.jsx("span",{style:{fontSize:7,color:"rgba(200,190,180,0.4)",width:24,textAlign:"right"},children:t.toFixed(2)})]})}const Qw=[{id:"listen",label:"Listen",icon:a.jsx(S9,{size:9}),color:"#60c0ff"},{id:"speak",label:"Speak",icon:a.jsx(cE,{size:9}),color:"#ffd060"},{id:"train",label:"Train",icon:a.jsx(jC,{size:9}),color:"#80ff80"}],VX=[{id:"world",label:"World",color:"#60c0ff"},{id:"glyphs",label:"Glyphs",color:"#e0d8cc"},{id:"events",label:"Events",color:"#ff8060"},{id:"map",label:"Map",color:"#80ff90"},{id:"phase",label:"Phase",color:"#a070ff"},{id:"meaning",label:"Meaning",color:"#ffd060"}];function UX({params:e,mode:t,lens:r,running:o,onParams:s,onMode:l,onLens:i,onReset:u,onOpenLexicon:c,onPreset:d,onToggleRunning:h}){var b;const[f,g]=w.useState(!1),m={display:"flex",flexDirection:"column",gap:0,background:"rgba(6,4,18,0.95)",borderRight:"1px solid rgba(255,255,255,0.05)",width:200,flexShrink:0,fontFamily:"system-ui, sans-serif",overflowY:"auto",scrollbarWidth:"none",padding:"10px 0"},y={padding:"6px 10px 4px",borderBottom:"1px solid rgba(255,255,255,0.04)"},v={fontSize:7,color:"rgba(160,80,255,0.5)",letterSpacing:"0.14em",textTransform:"uppercase",marginBottom:5};return a.jsxs("div",{style:m,children:[a.jsxs("div",{style:{padding:"2px 10px 8px"},children:[a.jsx("div",{style:{fontSize:7,letterSpacing:"0.18em",color:"rgba(160,80,255,0.5)",textTransform:"uppercase"},children:"Language Lab"}),a.jsx("div",{style:{fontSize:11,color:"rgba(242,232,215,0.85)"},children:"Heptapod "})]}),a.jsxs("div",{style:y,children:[a.jsx("div",{style:v,children:"Preset"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:2},children:D7.map(S=>a.jsxs("button",{onClick:()=>d(S),style:{...nd,background:e.preset===S.id?"rgba(160,80,255,0.15)":"rgba(255,255,255,0.04)",border:`1px solid ${e.preset===S.id?"rgba(160,80,255,0.35)":"rgba(255,255,255,0.07)"}`,color:e.preset===S.id?"rgba(200,160,255,0.9)":"rgba(200,190,180,0.5)",textAlign:"left",justifyContent:"flex-start",width:"100%"},children:[a.jsx("span",{children:S.emoji}),a.jsx("span",{style:{fontSize:8},children:S.name})]},S.id))})]}),a.jsxs("div",{style:y,children:[a.jsx("div",{style:v,children:"Modo"}),a.jsx("div",{style:{display:"flex",gap:3},children:Qw.map(S=>a.jsx("button",{onClick:()=>l(S.id),title:S.label,style:{...nd,flex:1,justifyContent:"center",background:t===S.id?`${S.color}22`:"rgba(255,255,255,0.04)",border:`1px solid ${t===S.id?S.color+"55":"rgba(255,255,255,0.07)"}`,color:t===S.id?S.color:"rgba(200,190,180,0.4)",padding:"4px 4px"},children:S.icon},S.id))}),a.jsx("div",{style:{fontSize:8,color:"rgba(200,190,180,0.4)",textAlign:"center",marginTop:3},children:(b=Qw.find(S=>S.id===t))==null?void 0:b.label})]}),a.jsxs("div",{style:y,children:[a.jsx("div",{style:v,children:"Mapa Semntico"}),a.jsxs("select",{value:e.dictionaryMode,onChange:S=>s({dictionaryMode:S.target.value}),style:{width:"100%",fontSize:9,padding:"3px 4px",borderRadius:4,cursor:"pointer",background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,255,255,0.1)",color:"rgba(200,190,180,0.8)",outline:"none"},children:[a.jsx("option",{value:"linear",children:"Linear"}),a.jsx("option",{value:"heptapod",children:"Heptapod"}),a.jsx("option",{value:"recursive",children:"Recursive"}),a.jsx("option",{value:"experimental",children:"Experimental"})]})]}),a.jsxs("div",{style:y,children:[a.jsx("div",{style:v,children:"Fsica"}),a.jsx(rd,{label:"Agents",value:e.agentCount,min:100,max:1200,step:50,onChange:S=>s({agentCount:Math.round(S)})}),a.jsx(rd,{label:"Dance",value:e.dance,onChange:S=>s({dance:S})}),a.jsx(rd,{label:"Entrainment",value:e.entrainment,onChange:S=>s({entrainment:S})}),a.jsx(rd,{label:"Ring Spring",value:e.loopThreshold,onChange:S=>s({loopThreshold:S})}),a.jsx(rd,{label:"InkDecay",value:e.inkDecay,onChange:S=>s({inkDecay:S})}),a.jsx(rd,{label:"TimeScope",value:e.timeScope,onChange:S=>s({timeScope:S})}),t==="speak"&&a.jsx(rd,{label:"Intensity",value:e.speakIntensity,onChange:S=>s({speakIntensity:S})})]}),a.jsxs("div",{style:y,children:[a.jsxs("div",{style:v,children:[a.jsx(vl,{size:8,style:{display:"inline",marginRight:4}}),"Lens"]}),a.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:3},children:VX.map(S=>a.jsx("button",{onClick:()=>i(S.id),style:{...nd,background:r===S.id?`${S.color}22`:"rgba(255,255,255,0.04)",border:`1px solid ${r===S.id?S.color+"55":"rgba(255,255,255,0.06)"}`,color:r===S.id?S.color:"rgba(200,190,180,0.35)",fontSize:7,padding:"3px 7px"},children:S.label},S.id))})]}),a.jsxs("div",{style:{padding:"8px 10px",display:"flex",flexDirection:"column",gap:5},children:[a.jsxs("button",{onClick:c,style:{...nd,background:"rgba(160,80,255,0.12)",border:"1px solid rgba(160,80,255,0.25)",color:"rgba(200,160,255,0.9)",justifyContent:"center",padding:"5px 8px"},children:[a.jsx(Rp,{size:10}),"Abrir Grimrio"]}),a.jsxs("div",{style:{display:"flex",gap:4},children:[a.jsxs("button",{onClick:h,style:{...nd,flex:1,justifyContent:"center",background:o?"rgba(255,200,60,0.1)":"rgba(80,200,80,0.1)",border:`1px solid ${o?"rgba(255,200,60,0.25)":"rgba(80,200,80,0.25)"}`,color:o?"rgba(255,220,120,0.8)":"rgba(140,220,140,0.8)",padding:"4px"},children:[o?"":""," ",o?"Pausa":"Play"]}),a.jsx("button",{onClick:u,title:"Reset simulao",style:{...nd,background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.09)",color:"rgba(200,190,180,0.5)",padding:"4px 7px"},children:a.jsx(Ch,{size:9})})]})]}),a.jsxs("div",{style:{padding:"0 10px 8px"},children:[a.jsxs("button",{onClick:()=>g(!f),style:{...nd,background:"none",border:"none",color:"rgba(200,190,180,0.3)",width:"100%",justifyContent:"flex-start",padding:"4px 0"},children:[a.jsx(_d,{size:9}),"Avanado",f?a.jsx(Pa,{size:9}):a.jsx(aa,{size:9})]}),f&&a.jsxs("div",{style:{background:"rgba(0,0,0,0.3)",borderRadius:5,padding:"8px 8px 4px",border:"1px solid rgba(255,255,255,0.06)",marginTop:4},children:[a.jsxs("div",{style:{...W7,marginBottom:6},children:[a.jsx("span",{style:{fontSize:7,color:"rgba(200,190,180,0.4)",width:60,textTransform:"uppercase",letterSpacing:"0.08em"},children:"Seed"}),a.jsx("input",{type:"number",value:e.seed,onChange:S=>s({seed:parseInt(S.target.value)||0}),style:{flex:1,fontSize:8,padding:"2px 4px",borderRadius:3,background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,255,255,0.1)",color:"rgba(200,190,180,0.8)",outline:"none"}})]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginTop:4},children:[a.jsx("input",{type:"checkbox",id:"autorefine",checked:e.llmAutoRefine,onChange:S=>s({llmAutoRefine:S.target.checked}),style:{accentColor:"rgba(160,80,255,0.8)"}}),a.jsx("label",{htmlFor:"autorefine",style:{fontSize:8,color:"rgba(200,190,180,0.5)",letterSpacing:"0.08em",textTransform:"uppercase",cursor:"pointer"},children:"LLM Auto-Refine"})]})]})]})]})}function $i(e){return typeof e=="string"}function YX(e){return typeof e=="number"&&isFinite(e)}function sp(e){return Array.isArray(e)}function Ob(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function KX(e){if(!Ob(e))return{ok:!1,error:"Not an object"};const t=e.gloss,r=e.definition,o=e.usage,s=e.contrasts,l=e.tags,i=e.confidence,u=e.needs_verification,c=e.rationale;return $i(t)?$i(r)?$i(o)?sp(s)?sp(l)?YX(i)?typeof u!="boolean"?{ok:!1,error:"needs_verification must be boolean"}:$i(c)?{ok:!0,data:{gloss:t.slice(0,60),definition:r.slice(0,200),usage:o.slice(0,200),contrasts:s.filter($i).map(d=>d.slice(0,40)),tags:l.filter($i).map(d=>d.slice(0,30)),confidence:Math.max(0,Math.min(1,i)),needs_verification:u,rationale:c.slice(0,300)}}:{ok:!1,error:"Missing rationale"}:{ok:!1,error:"confidence must be number"}:{ok:!1,error:"tags must be array"}:{ok:!1,error:"contrasts must be array"}:{ok:!1,error:"Missing usage"}:{ok:!1,error:"Missing definition"}:{ok:!1,error:"Missing gloss"}}function XX(e){if(!Ob(e))return{ok:!1,error:"Not an object"};const t=e.clusters,r=e.bridges,o=e.notes;return sp(t)?sp(r)?$i(o)?{ok:!0,data:{clusters:t.filter(Ob).map(l=>({id:$i(l.id)?l.id:String(Math.random()),label:$i(l.label)?l.label:"cluster",members:sp(l.members)?l.members.filter($i):[]})),bridges:r.filter($i),notes:o.slice(0,400)}}:{ok:!1,error:"Missing notes"}:{ok:!1,error:"bridges must be array"}:{ok:!1,error:"clusters must be array"}}function H7(e){try{const t=e.replace(/^```[a-z]*\n?/,"").replace(/\n?```$/,"").trim();return JSON.parse(t)}catch{return null}}const G7=`Voc  um lexicgrafo de uma linguagem experimental chamada Heptapod.
Voc APENAS pode inferir significado a partir de:
- Tokens/forma do glifo fornecidos
- Mtricas observadas no mundo (fsica simulada)
- Efeito real aps aplicar o glifo (Speak)
- Labels humanos (se fornecidos)

Nunca afirme fatos externos ou invenes. Retorne SOMENTE JSON vlido conforme o schema solicitado.
Seja conciso, operacional e verificvel. Confidence < 0.5  needs_verification: true.`;async function ZX(e,t,r,o,s){var h,f,g,m;const l=r?`Efeito aps Speak  antes: sync=${(h=r.before.syncIndex)==null?void 0:h.toFixed(2)} coh=${(f=r.before.coherenceMean)==null?void 0:f.toFixed(2)} | depois: sync=${(g=r.after.syncIndex)==null?void 0:g.toFixed(2)} coh=${(m=r.after.coherenceMean)==null?void 0:m.toFixed(2)}`:"Sem dados de Speak ainda.",i=o!=null&&o.length?`Labels do usurio: ${o.join(", ")}`:"Nenhum label humano ainda.",u=s!=null&&s.length?`Glosses existentes no dicionrio: ${s.slice(0,12).join(", ")}`:"",c=`
Glifo: ${e.glyphId}
Tokens/features: ${e.tokens.join(", ")}
Observveis: sync=${t.syncIndex.toFixed(2)} coherence=${t.coherenceMean.toFixed(2)} tension=${t.tensionIndex.toFixed(2)} novelty=${t.noveltyIndex.toFixed(2)} loops=${t.loopCount.toFixed(2)} silence=${t.silenceIndex.toFixed(2)}
${l}
${i}
${u}
Definio prvia: "${e.gloss}"  "${e.definition}"

Retorne JSON com campos: gloss (13 palavras), definition (12 frases), usage (1 frase), contrasts (array strings), tags (array), confidence (0..1), needs_verification (bool), rationale (12 frases).`;let d="";for(let y=0;y<2;y++)try{const v=await q7([{role:"system",content:G7},{role:"user",content:c}],2e4),b=H7(v),S=KX(b);if(S.ok)return S.data;d=S.error}catch(v){d=v.message}throw new Error(`LLM refine failed: ${d}`)}async function JX(e){if(e.length<3)throw new Error("Dicionrio muito pequeno para clusterizar");const t=e.slice(0,30).map(s=>({id:s.glyphId,gloss:s.gloss,tokens:s.tokens.slice(0,6).join(" "),confidence:s.confidence.toFixed(2)})),r=`
Dicionrio Heptapod (${t.length} entradas):
${t.map(s=>`- id=${s.id} gloss="${s.gloss}" tokens=[${s.tokens}] conf=${s.confidence}`).join(`
`)}

Identifique 25 clusters temticos/funcionais. Retorne JSON com:
clusters (array de {id, label, members: [glyphId...]}),
bridges (glyphIds que conectam clusters),
notes (1 frase geral).`;let o="";for(let s=0;s<2;s++)try{const l=await q7([{role:"system",content:G7},{role:"user",content:r}],2e4),i=H7(l),u=XX(i);if(u.ok)return u.data;o=u.error}catch(l){o=l.message}throw new Error(`LLM cluster failed: ${o}`)}const _c=Math.PI*2,QX=1.1;function eZ({active:e}){const t=w.useRef(null),r=w.useRef(null),o=w.useRef(hx(fx)),s=w.useRef({...fx}),l=w.useRef([]),i=w.useRef(SX(800,600)),u=w.useRef(0),c=w.useRef(0),d=w.useRef(null),h=w.useRef(0),f=w.useRef(0),g=w.useRef("listen"),m=w.useRef("world"),y=w.useRef(!0),v=w.useRef(""),[b,S]=w.useState({...fx}),[C,k]=w.useState("listen"),[R,j]=w.useState("world"),[T,_]=w.useState(!0),[P,I]=w.useState([]),[$,q]=w.useState(null),[L,H]=w.useState(()=>DX()),[G,oe]=w.useState([]),[le,pe]=w.useState(()=>LX()),[ce,te]=w.useState([]),[F,Q]=w.useState({state:"idle"}),[ae,we]=w.useState(""),[Re,ge]=w.useState(!1),[Ae,tt]=w.useState(null),[We,J]=w.useState(null),[ke,Le]=w.useState({w:800,h:600}),[K,et]=w.useState(0),dt=w.useRef(L);dt.current=L;const Rt=w.useRef(G);Rt.current=G,w.useEffect(()=>{var Ie;const lt=(Ie=t.current)==null?void 0:Ie.parentElement;if(!lt)return;const ht=(at,St)=>{const ye=Math.max(1,Math.floor(at)),xe=Math.max(1,Math.floor(St));Le({w:ye,h:xe}),i.current.width=ye,i.current.height=xe};ht(lt.clientWidth,lt.clientHeight);const _t=new ResizeObserver(at=>{for(const St of at)ht(St.contentRect.width,St.contentRect.height)});return _t.observe(lt),()=>_t.disconnect()},[]),w.useEffect(()=>{s.current=b},[b]),w.useEffect(()=>{g.current=C},[C]),w.useEffect(()=>{m.current=R},[R]),w.useEffect(()=>{y.current=T},[T]);const Wt=w.useCallback(lt=>{const ht=_7(lt);return{glyphId:lt.id,signatureHash:lt.signatureHash,miniGlyphSpec:lt,gloss:`${ht.densityBin}-${ht.coherenceBin}`,definition:"",usage:"",contrasts:[],tokens:ht.tokens,embedding:ht.embedding,examples:[{timestamp:lt.timestamp,snapshotMetrics:lt.observables}],confidence:0,status:"tentative",lastUpdated:Date.now(),tags:[],clusterId:"",frequency:1}},[]),Zt=w.useCallback(()=>{const lt=o.current,ht=s.current,_t=g.current,Ie=Gf(lt,ht),at=MX(Ie,ht.dictionaryMode,Date.now());I(Ge=>[...Ge,at].slice(-12));const St=dt.current,ye=St.find(Ge=>Ge.signatureHash===at.signatureHash);let xe;if(ye){const Ge={...ye,frequency:ye.frequency+1,examples:[...ye.examples.slice(-4),{timestamp:at.timestamp,snapshotMetrics:Ie}],lastUpdated:Date.now()};xe=St.map(Ye=>Ye.glyphId===ye.glyphId?Ge:Ye),ye.frequency%3===0&&te(Ye=>[...Ye.slice(-19),{id:Date.now().toString(),kind:"PATTERN_STABLE",timestamp:Date.now(),description:`Padro "${ye.gloss||ye.signatureHash.slice(0,6)}" reforado (${Ge.frequency})`}])}else{const Ge=Wt(at);xe=[...St,Ge].slice(-200),te(Ye=>[...Ye.slice(-19),{id:Date.now().toString(),kind:"GLYPH_SHIFT",timestamp:Date.now(),description:`Novo glifo: ${at.signatureHash.slice(0,8)}  ${Ge.tokens.slice(0,3).join(" ")}`}]),ht.llmAutoRefine&&Ze(at,Ge,Ie,xe).catch(()=>{})}H(xe),td(xe);const gt=TX(Ie,xe);if(J(gt),et(Ie.coherenceMean),_t==="train"){const Ge=xe.filter(Ye=>Ye.confidence<.4&&Ye.frequency>=2).sort((Ye,Ve)=>Ye.confidence-Ve.confidence)[0];Ge&&!Ae&&tt({spec:Ge.miniGlyphSpec,question:`"${Ge.tokens.slice(0,3).join(", ")}"  esse glifo significa mais:`})}d.current=Ie},[Wt,Ae]),$e=w.useRef(Zt);$e.current=Zt;const Ze=w.useCallback(async(lt,ht,_t,Ie)=>{Q({state:"loading"});try{const at=Ie.filter(Ge=>Ge.gloss&&Ge.glyphId!==ht.glyphId).map(Ge=>Ge.gloss),St=d.current,xe=await ZX(ht,_t,St?{before:St,after:_t}:void 0,[],at);we(xe.rationale);const gt={...ht,gloss:xe.gloss,definition:xe.definition,usage:xe.usage,contrasts:xe.contrasts,tags:xe.tags,confidence:xe.confidence,status:xe.needs_verification?"tentative":ht.status,lastUpdated:Date.now()};H(Ge=>{const Ye=Jw(Ge,gt);return td(Ye),Ye}),Q({state:"ok"})}catch(at){Q({state:"error",lastError:at.message})}},[]),Fe=w.useCallback((lt,ht)=>{const _t=Gf(o.current,s.current),Ie=ht??Wt(lt),at=dt.current;Ze(lt,Ie,_t,at)},[Wt,Ze]),Xe=w.useCallback((lt,ht,_t)=>{const Ie=o.current,at=s.current;let St=.5,ye=.5;if(Ie.quanta.length){let Ge=0,Ye=0;for(const Ve of Ie.quanta)Ge+=Ve.x,Ye+=Ve.y;St=Ge/Ie.quanta.length,ye=Ye/Ie.quanta.length}const xe=EX(lt,ht??St,_t??ye,at);l.current.push(xe);const gt=Gf(Ie,at);te(Ge=>[...Ge.slice(-19),{id:Date.now().toString(),kind:"SPEAK_EFFECT",timestamp:Date.now(),description:`Speak: ${Kw[xe.kind].label} r=${xe.radius.toFixed(2)} dur=${xe.duration.toFixed(1)}s`}]),{...gt},setTimeout(()=>{const Ge=Gf(o.current,s.current);H(Ye=>{const Ve=Ye.findIndex(Gt=>Gt.glyphId===lt.id);if(Ve<0)return Ye;const Oe=Ye[Ve];return s.current.llmAutoRefine&&Ze(lt,Oe,Ge,Ye),Ye})},3e3)},[Ze]),jt=w.useCallback(lt=>{if(g.current!=="speak")return;const ht=t.current;if(!ht)return;const _t=ht.getBoundingClientRect(),Ie=(lt.clientX-_t.left)*(ht.width/_t.width),at=(lt.clientY-_t.top)*(ht.height/_t.height),St=Math.min(ht.width,ht.height),ye=(ht.width-St)*.5,xe=(ht.height-St)*.5,gt=(Ie-ye)/St,Ge=(at-xe)/St,Ye=$??P[P.length-1];Ye&&Xe(Ye,gt,Ge)},[$,P,Xe]),hn=w.useCallback(lt=>{Ae&&(H(ht=>{const _t=ht.findIndex(ye=>ye.glyphId===Ae.spec.id);if(_t<0)return ht;const Ie=ht[_t],at={...Ie,confidence:Math.min(1,Ie.confidence+.25),tags:[...new Set([...Ie.tags,lt.toLowerCase()])],lastUpdated:Date.now()},St=Jw(ht,at);return td(St),St}),tt(null))},[Ae]),an=w.useCallback(async()=>{const lt=dt.current;if(!(lt.length<3)){Q({state:"loading"});try{const ht=await JX(lt),_t=["#a070ff","#60c0ff","#ff8060","#80ff80","#ffd060"],Ie=ht.clusters.map((at,St)=>({id:at.id,label:at.label,members:at.members,color:_t[St%_t.length]}));oe(Ie),H(at=>{const St=new Map;for(const ye of ht.clusters)for(const xe of ye.members)St.set(xe,ye.id);return at.map(ye=>({...ye,clusterId:St.get(ye.glyphId)??ye.clusterId}))}),Q({state:"ok",lastOutput:ht.notes})}catch(ht){Q({state:"error",lastError:ht.message})}}},[]);w.useEffect(()=>{if(!e)return;const lt=t.current,ht=r.current;if(!lt||!ht)return;let _t=0;u.current=performance.now();const Ie=at=>{f.current=requestAnimationFrame(Ie);const St=(at-u.current)/1e3,ye=Math.min(St>0?St:.016,.05);if(u.current=at,h.current+=ye,!y.current){const Xt=lt.width,Dt=lt.height;if(Xt<2||Dt<2||!lt.getContext("2d"))return;const Ne=it.current;if(Ne.length>0){const Ke=Ne[Ne.length-1],Ct=ht.getContext("2d");Ct.clearRect(0,0,ht.width,ht.height);const ft=Math.min(ht.width,ht.height)*.44;Dd(Ct,Ke,ht.width/2,ht.height/2,ft,{alpha:.96,animated:!0,time:h.current})}return}const xe=o.current,gt=s.current,Ge=l.current;vX(xe,gt,ye,Ge),l.current=Ge.filter(Xt=>Xt.duration>0),wX(xe,gt,ye),c.current+=ye,c.current>=QX&&(c.current=0,$e.current());const Ye=lt.width,Ve=lt.height,Oe=lt.getContext("2d"),Gt=m.current,Kt=Math.min(Ye,Ve),fn=(Ye-Kt)*.5,zn=(Ve-Kt)*.5,rt=fn+Kt*.5,mt=zn+Kt*.5,yt=Kt*.47,Et=yt*.97,Ft=Et*Et;if(_t===0?(Oe.fillStyle="rgb(248,245,240)",Oe.fillRect(0,0,Ye,Ve)):(Oe.fillStyle="rgba(248,245,240,0.92)",Oe.fillRect(0,0,Ye,Ve)),Oe.save(),Oe.beginPath(),Oe.arc(rt,mt,Et,0,_c),Oe.clip(),Gt==="meaning")tZ(Oe,dt.current,Rt.current,Ye,Ve);else{const Xt=xe.quanta,Dt=Xt.length;if(Gt==="world"||Gt==="glyphs"){const ne=h.current;Oe.lineCap="round";for(let Ne=0;Ne<Dt;Ne++){const Ke=Xt[Ne],Ct=fn+Ke.x*Kt,ft=zn+Ke.y*Kt,At=Ct-rt,bt=ft-mt;if(!(At*At+bt*bt>Ft))for(let nn=Ne+1;nn<Dt;nn++){const Bt=Xt[nn],Jt=Bt.x-Ke.x,Qt=Bt.y-Ke.y,en=Jt*Jt+Qt*Qt,vn=.035;if(en>vn*vn)continue;const Wn=Math.sqrt(en),Gn=Math.cos(Ke.phase-Bt.phase);if(Gn<.3)continue;const cr=fn+Bt.x*Kt,pr=zn+Bt.y*Kt,br=(1-Wn/vn)*Gn*.35,hr=(Ke.coherence+Bt.coherence)*.5,or=Math.round(10+(1-hr)*30);Oe.beginPath(),Oe.moveTo(Ct,ft);const uo=(Ct+cr)*.5,fr=(ft+pr)*.5,Tr=-(pr-ft)*.15*Math.sin(ne*2+Ne*.1),Ir=(cr-Ct)*.15*Math.sin(ne*2+Ne*.1);Oe.quadraticCurveTo(uo+Tr,fr+Ir,cr,pr),Oe.strokeStyle=`rgba(${or},${or},${or},${br.toFixed(3)})`,Oe.lineWidth=.6+hr*.8,Oe.stroke()}}for(let Ne=0;Ne<Dt;Ne++){const Ke=Xt[Ne],Ct=fn+Ke.x*Kt,ft=zn+Ke.y*Kt,At=Ct-rt,bt=ft-mt;if(At*At+bt*bt>Ft)continue;const nn=Math.sqrt(At*At+bt*bt)/Et,Bt=Math.max(0,1-nn*nn*2.5),Jt=Math.max(0,Math.min(1,Ke.coherence)),Qt=1+Math.sin(Ke.phase+ne*1.5)*.25*Jt,en=Math.max(.5,(1.6+Jt*1.2)*Qt),vn=Math.min(.94,(.42+Jt*.5+Ke.ink*.1)*Bt);Oe.globalAlpha=vn;const Wn=Math.sqrt(Ke.vx*Ke.vx+Ke.vy*Ke.vy),Gn=Math.round(6+(1-Jt)*42);if(Oe.fillStyle=`rgb(${Gn},${Gn},${Gn})`,Wn>5e-4){const cr=Math.max(en,Math.min(en*5,Wn*Kt*14)),pr=Ke.vx/Wn,br=Ke.vy/Wn;Oe.save(),Oe.strokeStyle=Oe.fillStyle,Oe.lineWidth=en*1.8,Oe.lineCap="round",Oe.beginPath(),Oe.moveTo(Ct-pr*cr*.25,ft-br*cr*.25),Oe.lineTo(Ct+pr*cr*.75,ft+br*cr*.75),Oe.stroke(),Oe.restore()}else Oe.beginPath(),Oe.arc(Ct,ft,en,0,_c),Oe.fill()}Oe.globalAlpha=1}if(Gt==="events"){for(const ne of Xt){const Ne=fn+ne.x*Kt,Ke=zn+ne.y*Kt,Ct=Ne-rt,ft=Ke-mt;if(Ct*Ct+ft*ft>Ft)continue;const At=Math.max(0,ne.coherence),bt=Math.abs(ne.intent),nn=Math.round(30+Math.max(0,ne.intent)*200),Bt=Math.round(20+(1-bt)*100),Jt=Math.round(30+Math.max(0,-ne.intent)*220);Oe.globalAlpha=Math.min(.9,.35+At*.55+bt*.25),Oe.fillStyle=`rgb(${nn},${Bt},${Jt})`,Oe.beginPath(),Oe.arc(Ne,Ke,Math.max(.5,1.4+At*.8),0,_c),Oe.fill()}Oe.globalAlpha=1}if(Gt==="map"){const Ne=new Float32Array(4096);for(const ft of Xt){const At=Math.min(63,Math.max(0,Math.floor(ft.x*64))),bt=Math.min(63,Math.max(0,Math.floor(ft.y*64)));Ne[bt*64+At]+=ft.ink*(.5+Math.max(0,ft.coherence)*.5)}let Ke=.01;for(let ft=0;ft<4096;ft++)Ne[ft]>Ke&&(Ke=Ne[ft]);const Ct=Kt/64;for(let ft=0;ft<64;ft++)for(let At=0;At<64;At++){const bt=Ne[ft*64+At]/Ke;if(bt<.03)continue;const nn=fn+(At+.5)*Ct,Bt=zn+(ft+.5)*Ct;if((nn-rt)*(nn-rt)+(Bt-mt)*(Bt-mt)>Ft)continue;const Qt=Math.round(bt<.5?bt*2*30:30+(bt-.5)*2*60),en=Math.round(bt*180),vn=Math.round(60+bt*180);Oe.fillStyle=`rgb(${Qt},${en},${vn})`,Oe.globalAlpha=Math.min(.95,bt*1.2),Oe.fillRect(nn-Ct*.5,Bt-Ct*.5,Ct,Ct)}Oe.globalAlpha=1}if(Gt==="phase"){for(const ne of Xt){const Ne=fn+ne.x*Kt,Ke=zn+ne.y*Kt,Ct=Ne-rt,ft=Ke-mt;if(Ct*Ct+ft*ft>Ft)continue;const At=Math.max(0,ne.coherence),bt=Math.round((ne.phase/_c*360+xe.time*18)%360),nn=Math.round(28+At*38);Oe.globalAlpha=Math.max(.05,.22+At*.72),Oe.fillStyle=`hsl(${bt},82%,${nn}%)`,Oe.beginPath(),Oe.arc(Ne,Ke,Math.max(.4,1.2+At*1.2),0,_c),Oe.fill()}Oe.globalAlpha=1}}Oe.restore();const me=Oe.createRadialGradient(rt,mt,yt*.72,rt,mt,yt*1.02);if(me.addColorStop(0,"rgba(248,245,240,0)"),me.addColorStop(.6,"rgba(248,245,240,0.04)"),me.addColorStop(.84,"rgba(248,245,240,0.75)"),me.addColorStop(1,"rgba(248,245,240,0.99)"),Oe.fillStyle=me,Oe.fillRect(0,0,Ye,Ve),Oe.save(),Oe.beginPath(),Oe.arc(rt,mt,Et,0,_c),Oe.strokeStyle="rgba(140,130,118,0.20)",Oe.lineWidth=1.2,Oe.stroke(),Oe.restore(),l.current.length>0){Oe.save(),Oe.beginPath(),Oe.arc(rt,mt,Et,0,_c),Oe.clip();for(const Xt of l.current){const Dt=Kw[Xt.kind];Oe.save(),Oe.strokeStyle=Dt.color,Oe.lineWidth=1.5,Oe.globalAlpha=Math.min(.8,Xt.duration/8*.7),Oe.setLineDash([4,4]);const ne=fn+Xt.targetX*Kt,Ne=zn+Xt.targetY*Kt;Oe.beginPath(),Oe.arc(ne,Ne,Math.max(1,Xt.radius*Kt),0,_c),Oe.stroke(),Oe.setLineDash([]),Oe.restore()}Oe.restore()}const cn=it.current;if(cn.length>0){const Xt=cn[cn.length-1],Dt=ht.getContext("2d");Dt.clearRect(0,0,ht.width,ht.height);const ne=Math.min(ht.width,ht.height)*.44;Dd(Dt,Xt,ht.width/2,ht.height/2,ne,{alpha:.96,animated:!0,time:h.current}),v.current=Xt.id}_t++};return f.current=requestAnimationFrame(Ie),()=>cancelAnimationFrame(f.current)},[e]);const it=w.useRef([]);w.useEffect(()=>{it.current=P},[P]);const kt=w.useCallback(lt=>{S(ht=>{const _t={...ht,...lt};return s.current=_t,_t})},[]),On=w.useCallback(lt=>{const ht={...lt.params};S(ht),s.current=ht,o.current=hx(ht),l.current=[],I([])},[]),sn=w.useCallback(()=>{o.current=hx(s.current),l.current=[],I([]),te([]),c.current=0},[]),Xn=w.useCallback(lt=>{H(ht=>{const _t=ht.map(Ie=>Ie.glyphId===lt?{...Ie,status:"accepted",lastUpdated:Date.now()}:Ie);return td(_t),_t})},[]),Pt=w.useCallback((lt,ht,_t)=>{H(Ie=>{const at=Ie.map(St=>St.glyphId===lt?{...St,[ht]:_t,lastUpdated:Date.now()}:St);return td(at),at})},[]),zt=w.useCallback((lt,ht)=>{H(_t=>{const Ie=_t.map(at=>at.glyphId===lt?{...at,contrasts:[...new Set([...at.contrasts,ht])],lastUpdated:Date.now()}:at);return td(Ie),Ie})},[]),jn=w.useCallback(lt=>{typeof window<"u"&&(window.__APP_CONFIG__={...window.__APP_CONFIG__,OPENAI_API_KEY:lt}),Q({state:"idle"})},[]),En=$?dt.current.find(lt=>lt.glyphId===$.id)??null:null;return e?a.jsxs("div",{style:{position:"fixed",inset:0,top:38,display:"flex",flexDirection:"column",background:"#040210",fontFamily:"system-ui, sans-serif",zIndex:1},children:[a.jsxs("div",{style:{flex:1,display:"flex",overflow:"hidden",minHeight:0},children:[a.jsx(UX,{params:b,mode:C,lens:R,running:T,onParams:kt,onMode:lt=>{k(lt),g.current=lt},onLens:lt=>{j(lt),m.current=lt},onReset:sn,onOpenLexicon:()=>ge(!0),onPreset:On,onToggleRunning:()=>_(lt=>{const ht=!lt;return y.current=ht,ht})}),a.jsxs("div",{style:{flex:1,position:"relative",display:"flex",flexDirection:"column",minWidth:0},children:[a.jsxs("div",{style:{flex:1,position:"relative",overflow:"hidden",background:"#f8f5f0"},children:[a.jsx("canvas",{ref:t,width:ke.w,height:ke.h,style:{position:"absolute",inset:0,display:"block",cursor:C==="speak"?"crosshair":"default"},onClick:jt}),(()=>{const lt=Math.max(0,Math.pow(1-K,1.8)*14).toFixed(1);return a.jsxs("div",{style:{position:"absolute",top:12,right:12,borderRadius:14,overflow:"hidden",border:"1px solid rgba(180,170,155,0.4)",boxShadow:"0 4px 24px rgba(0,0,0,0.18)",transition:"filter 0.8s ease",filter:`blur(${lt}px)`},children:[a.jsx("canvas",{ref:r,width:140,height:140,style:{display:"block"}}),We&&a.jsxs("div",{style:{position:"absolute",bottom:0,left:0,right:0,background:"rgba(250,248,244,0.9)",textAlign:"center",fontSize:7,color:"rgba(60,45,30,0.5)",letterSpacing:"0.1em",padding:"2px 0 3px"},children:["sync ",We.sync.toFixed(2),"  coh ",We.coherence.toFixed(2)]})]})})(),C==="speak"&&a.jsx("div",{style:{position:"absolute",top:10,left:"50%",transform:"translateX(-50%)",padding:"4px 14px",borderRadius:20,background:"rgba(255,200,60,0.1)",border:"1px solid rgba(255,200,60,0.25)",fontSize:8,color:"rgba(255,220,120,0.8)",letterSpacing:"0.12em",textTransform:"uppercase",pointerEvents:"none"},children:"SPEAK  clique no canvas para emitir  duplo-clique no glifo no stream"}),C==="train"&&Ae&&a.jsx(nZ,{spec:Ae.spec,question:Ae.question,onChoice:hn,onSkip:()=>tt(null)}),We&&a.jsx("div",{style:{position:"absolute",bottom:8,left:8,display:"flex",flexDirection:"column",gap:2,pointerEvents:"none"},children:[{label:"sync",v:We.sync,c:"#60c0ff"},{label:"cohere",v:We.coherence,c:"#a070ff"},{label:"loop",v:We.loopDensity,c:"#ffd060"},{label:"novel",v:We.novelty,c:"#ff8060"}].map(({label:lt,v:ht,c:_t})=>a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[a.jsx("span",{style:{fontSize:7,color:"rgba(255,255,255,0.2)",width:36,textAlign:"right",letterSpacing:"0.07em",textTransform:"uppercase"},children:lt}),a.jsx("div",{style:{width:50,height:2.5,background:"rgba(255,255,255,0.07)",borderRadius:2},children:a.jsx("div",{style:{width:`${Math.min(100,ht*100)}%`,height:"100%",background:_t,borderRadius:2,transition:"width 0.5s"}})})]},lt))}),a.jsxs("div",{style:{position:"absolute",top:8,left:"50%",transform:"translateX(-50%)",padding:"2px 10px",borderRadius:10,background:"rgba(0,0,0,0.4)",border:"1px solid rgba(255,255,255,0.06)",fontSize:7,color:"rgba(255,255,255,0.25)",letterSpacing:"0.14em",textTransform:"uppercase",pointerEvents:"none"},children:[R,"  ",b.preset.replace("_"," "),"  ",b.agentCount," quanta"]})]}),a.jsx(FX,{glyphs:P,lexicon:L,selectedId:($==null?void 0:$.id)??null,onSelect:q,onSpeak:lt=>Xe(lt)})]}),a.jsxs("div",{style:{width:210,flexShrink:0,display:"flex",flexDirection:"column",borderLeft:"1px solid rgba(255,255,255,0.05)",background:"rgba(4,2,14,0.95)",overflowY:"auto",scrollbarWidth:"none",padding:"8px 0",gap:0},children:[a.jsx(GX,{status:F,events:ce,lastRationale:ae,onConfigKey:jn}),L.length>=3&&a.jsx("div",{style:{padding:"8px 10px 4px"},children:a.jsx("button",{title:"Executar",onClick:an,disabled:F.state==="loading",style:{width:"100%",fontSize:8,padding:"4px",borderRadius:5,cursor:"pointer",background:"rgba(160,80,255,0.1)",border:"1px solid rgba(160,80,255,0.2)",color:"rgba(200,160,255,0.7)",letterSpacing:"0.1em",textTransform:"uppercase",opacity:F.state==="loading"?.5:1},children:"Clusterizar Lexicon"})}),We&&a.jsxs("div",{style:{padding:"8px 10px",borderTop:"1px solid rgba(255,255,255,0.04)",marginTop:4},children:[a.jsx("div",{style:{fontSize:7,letterSpacing:"0.14em",color:"rgba(160,80,255,0.45)",textTransform:"uppercase",marginBottom:5},children:"Lexicon"}),a.jsxs("div",{style:{fontSize:9,color:"rgba(200,190,180,0.6)",lineHeight:1.7},children:[a.jsxs("div",{children:[We.lexiconSize," verbetes"]}),a.jsxs("div",{children:[Math.round(We.lexiconHealth*100),"% aceitos"]}),a.jsxs("div",{children:["conf mdia ",We.avgConfidence.toFixed(2)]})]})]})]})]}),Re&&a.jsx(qX,{entries:L,clusters:G,sessions:le,onSelect:lt=>{q(lt.miniGlyphSpec),ge(!1)},onClose:()=>ge(!1),onImport:lt=>{H(lt),td(lt)}}),$&&a.jsx(OX,{spec:$,entry:En,allEntries:L,llmLoading:F.state==="loading",onAskLLM:Fe,onAccept:Xn,onEdit:Pt,onLink:zt,onClose:()=>q(null),onSpeak:Xe})]}):null}function tZ(e,t,r,o,s){if(t.length===0)return;const l=Math.min(t.length,60),i=t.slice(0,l),u=Math.ceil(Math.sqrt(l)),c=Math.min(o,s)/(u+1),d=(o-(u-1)*c)/2,h=(s-(Math.ceil(l/u)-1)*c)/2,f=new Map,g=["#a070ff","#60c0ff","#ff8060","#80ff80","#ffd060"];r.forEach((y,v)=>f.set(y.id,g[v%g.length]));const m=.75;for(let y=0;y<i.length;y++)for(let v=y+1;v<i.length;v++){const b=AX(i[y].embedding,i[v].embedding);if(b<m)continue;const S=d+y%u*c,C=h+Math.floor(y/u)*c,k=d+v%u*c,R=h+Math.floor(v/u)*c;e.save(),e.strokeStyle="rgba(160,80,255,0.2)",e.lineWidth=(b-m)*4,e.beginPath(),e.moveTo(S,C),e.lineTo(k,R),e.stroke(),e.restore()}for(let y=0;y<i.length;y++){const v=i[y],b=d+y%u*c,S=h+Math.floor(y/u)*c,C=18+v.confidence*8;f.get(v.clusterId),Dd(e,v.miniGlyphSpec,b,S,C,{alpha:.55+v.confidence*.4}),v.gloss&&(e.fillStyle="rgba(230,220,210,0.45)",e.font="7px system-ui",e.textAlign="center",e.fillText(v.gloss.slice(0,10),b,S+C+9))}}function nZ({spec:e,question:t,onChoice:r,onSkip:o}){const s=w.useRef(null),l=w.useRef(0),i=w.useRef(0),u=80;w.useEffect(()=>{let h=!0;const f=()=>{var m;if(!h)return;const g=(m=s.current)==null?void 0:m.getContext("2d");g&&(g.clearRect(0,0,u,u),l.current+=.02,Dd(g,e,u/2,u/2,u*.44,{alpha:.9,animated:!0,time:l.current})),i.current=requestAnimationFrame(f)};return f(),()=>{h=!1,cancelAnimationFrame(i.current)}},[e]);const c=["UNIR","CORTAR","ABRIR","SILENCIAR"],d={UNIR:"#60c0ff",CORTAR:"#ff8060",ABRIR:"#80ff80",SILENCIAR:"#a070ff"};return a.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(4,2,12,0.7)",backdropFilter:"blur(6px)",zIndex:20},children:a.jsxs("div",{style:{background:"rgba(8,6,20,0.96)",border:"1px solid rgba(160,80,255,0.3)",borderRadius:14,padding:"20px 24px",maxWidth:340,textAlign:"center"},children:[a.jsx("div",{style:{fontSize:7,color:"rgba(160,80,255,0.5)",letterSpacing:"0.16em",textTransform:"uppercase",marginBottom:10},children:"Training  Active Learning"}),a.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:14},children:a.jsx("canvas",{ref:s,width:u,height:u,style:{background:"rgba(0,0,0,0.4)",borderRadius:8}})}),a.jsx("div",{style:{fontSize:10,color:"rgba(230,220,210,0.85)",marginBottom:14,lineHeight:1.5},children:t}),a.jsx("div",{style:{display:"flex",gap:6,justifyContent:"center",flexWrap:"wrap"},children:c.map(h=>a.jsx("button",{title:h,onClick:()=>r(h),style:{fontSize:9,padding:"5px 12px",borderRadius:6,cursor:"pointer",background:`${d[h]}18`,border:`1px solid ${d[h]}55`,color:d[h],letterSpacing:"0.1em",textTransform:"uppercase"},children:h},h))}),a.jsx("button",{title:"Pular",onClick:o,style:{marginTop:12,fontSize:8,background:"none",border:"none",cursor:"pointer",color:"rgba(200,190,180,0.3)",letterSpacing:"0.1em"},children:"PULAR"})]})})}const Lu=[{id:"select",icon:"",label:"Scry",color:"#94a3b8",desc:"Inspect any element on the Tree"},{id:"drag",icon:"",label:"Drag",color:"#e2e8f0",desc:"Move sephiroth and paths"},{id:"invoke",icon:"",label:"Invoke",color:"#ffd060",desc:"Channel energy into a sephirah"},{id:"banish",icon:"",label:"Banish",color:"#ff6040",desc:"Dispel blockages and excess"},{id:"trace",icon:"",label:"Trace",color:"#60c0ff",desc:"Draw the Lightning Flash path"},{id:"seal",icon:"",label:"Seal",color:"#34d399",desc:"Lock energy into crystalline form"},{id:"transmute",icon:"",label:"Transmute",color:"#a78bfa",desc:"Alchemical transformation of forces"},{id:"portal",icon:"",label:"Portal",color:"#f472b6",desc:"Open a gateway between worlds"}],Md=[{id:"kether",num:1,label:"Kether",labelHeb:"",meaning:"The Crown",pillar:"balance",nx:.5,ny:.04,color:"#f0ece0",planet:"Primum Mobile",element:"Spirit",gdGrade:"10=1 Ipsissimus",divineName:"Eheieh",archangel:"Metatron"},{id:"chokmah",num:2,label:"Chokmah",labelHeb:"",meaning:"Wisdom",pillar:"mercy",nx:.83,ny:.17,color:"#d0c8a0",planet:"Fixed Stars / Zodiac",element:"Fire (primal)",gdGrade:"9=2 Magus",divineName:"Yah",archangel:"Ratziel"},{id:"binah",num:3,label:"Binah",labelHeb:"",meaning:"Understanding",pillar:"severity",nx:.17,ny:.17,color:"#303048",planet:"Saturn",element:"Water (primal)",gdGrade:"8=3 Magister Templi",divineName:"YHVH Elohim",archangel:"Tzaphkiel"},{id:"chesed",num:4,label:"Chesed",labelHeb:"",meaning:"Mercy",pillar:"mercy",nx:.83,ny:.4,color:"#6090d0",planet:"Jupiter",element:"Water",gdGrade:"7=4 Adeptus Exemptus",divineName:"El",archangel:"Tzadkiel"},{id:"geburah",num:5,label:"Geburah",labelHeb:"",meaning:"Severity",pillar:"severity",nx:.17,ny:.4,color:"#c03030",planet:"Mars",element:"Fire",gdGrade:"6=5 Adeptus Major",divineName:"Elohim Gibor",archangel:"Khamael"},{id:"tiphereth",num:6,label:"Tiphareth",labelHeb:"",meaning:"Beauty",pillar:"balance",nx:.5,ny:.52,color:"#e8c830",planet:"Sol",element:"Air",gdGrade:"5=6 Adeptus Minor",divineName:"YHVH Eloah va-Daath",archangel:"Raphael"},{id:"netzach",num:7,label:"Netzach",labelHeb:"",meaning:"Victory",pillar:"mercy",nx:.83,ny:.65,color:"#50a840",planet:"Venus",element:"Fire (lesser)",gdGrade:"4=7 Philosophus",divineName:"YHVH Tzabaoth",archangel:"Haniel"},{id:"hod",num:8,label:"Hod",labelHeb:"",meaning:"Splendour",pillar:"severity",nx:.17,ny:.65,color:"#b06820",planet:"Mercury",element:"Water (lesser)",gdGrade:"3=8 Practicus",divineName:"Elohim Tzabaoth",archangel:"Michael"},{id:"yesod",num:9,label:"Yesod",labelHeb:"",meaning:"The Foundation",pillar:"balance",nx:.5,ny:.78,color:"#8060c0",planet:"Luna",element:"Air (astral)",gdGrade:"2=9 Theoricus",divineName:"Shaddai El Chai",archangel:"Gabriel"},{id:"malkuth",num:10,label:"Malkuth",labelHeb:"",meaning:"The Kingdom",pillar:"balance",nx:.5,ny:.94,color:"#806040",planet:"Earth",element:"Earth",gdGrade:"1=10 Zelator",divineName:"Adonai ha-Aretz",archangel:"Sandalphon"}],li=new Map(Md.map(e=>[e.id,e])),Od=[{pathId:11,from:"kether",to:"chokmah",arcanaId:0,hebrewLetter:"",pillarBias:"mercy",attribution:"Air (Element)"},{pathId:12,from:"kether",to:"binah",arcanaId:1,hebrewLetter:"",pillarBias:"severity",attribution:"Mercury (Planet)"},{pathId:13,from:"kether",to:"tiphereth",arcanaId:2,hebrewLetter:"",pillarBias:"balance",attribution:"Luna (Planet)"},{pathId:14,from:"chokmah",to:"binah",arcanaId:3,hebrewLetter:"",pillarBias:"all",attribution:"Venus (Planet)"},{pathId:15,from:"chokmah",to:"tiphereth",arcanaId:4,hebrewLetter:"",pillarBias:"mercy",attribution:"Aries (Zodiac)"},{pathId:16,from:"chokmah",to:"chesed",arcanaId:5,hebrewLetter:"",pillarBias:"mercy",attribution:"Taurus (Zodiac)"},{pathId:17,from:"binah",to:"tiphereth",arcanaId:6,hebrewLetter:"",pillarBias:"balance",attribution:"Gemini (Zodiac)"},{pathId:18,from:"binah",to:"geburah",arcanaId:7,hebrewLetter:"",pillarBias:"severity",attribution:"Cancer (Zodiac)"},{pathId:19,from:"chesed",to:"geburah",arcanaId:8,hebrewLetter:"",pillarBias:"all",attribution:"Leo (Zodiac)"},{pathId:20,from:"chesed",to:"tiphereth",arcanaId:9,hebrewLetter:"",pillarBias:"mercy",attribution:"Virgo (Zodiac)"},{pathId:21,from:"chesed",to:"netzach",arcanaId:10,hebrewLetter:"",pillarBias:"mercy",attribution:"Jupiter (Planet)"},{pathId:22,from:"geburah",to:"tiphereth",arcanaId:11,hebrewLetter:"",pillarBias:"balance",attribution:"Libra (Zodiac)"},{pathId:23,from:"geburah",to:"hod",arcanaId:12,hebrewLetter:"",pillarBias:"severity",attribution:"Water (Element)"},{pathId:24,from:"tiphereth",to:"netzach",arcanaId:13,hebrewLetter:"",pillarBias:"mercy",attribution:"Scorpio (Zodiac)"},{pathId:25,from:"tiphereth",to:"yesod",arcanaId:14,hebrewLetter:"",pillarBias:"balance",attribution:"Sagittarius (Zodiac)"},{pathId:26,from:"tiphereth",to:"hod",arcanaId:15,hebrewLetter:"",pillarBias:"severity",attribution:"Capricorn (Zodiac)"},{pathId:27,from:"netzach",to:"hod",arcanaId:16,hebrewLetter:"",pillarBias:"all",attribution:"Mars (Planet)"},{pathId:28,from:"netzach",to:"yesod",arcanaId:17,hebrewLetter:"",pillarBias:"mercy",attribution:"Aquarius (Zodiac)"},{pathId:29,from:"netzach",to:"malkuth",arcanaId:18,hebrewLetter:"",pillarBias:"mercy",attribution:"Pisces (Zodiac)"},{pathId:30,from:"hod",to:"yesod",arcanaId:19,hebrewLetter:"",pillarBias:"balance",attribution:"Sol (Planet)"},{pathId:31,from:"hod",to:"malkuth",arcanaId:20,hebrewLetter:"",pillarBias:"severity",attribution:"Fire (Element)"},{pathId:32,from:"yesod",to:"malkuth",arcanaId:21,hebrewLetter:"",pillarBias:"balance",attribution:"Saturn (Planet) / Earth"}],G5=new Map(Od.map(e=>[e.pathId,e]));new Map(Od.map(e=>[e.arcanaId,e.pathId]));const eC={mercy:["chokmah","chesed","netzach"],severity:["binah","geburah","hod"]},V7=[{id:0,canonicalName:"The Fool",hebrewLetter:"",symbol:"",pillarAffinity:"all",pathId:11,operator:{primary:"OPEN_GATE",secondary:"DIVERGE",magnitude:.72,reversed:{primary:"CLOSE_GATE",secondary:"DELAY",costFactor:.3}}},{id:1,canonicalName:"The Magician",hebrewLetter:"",symbol:"",pillarAffinity:"mercy",pathId:12,operator:{primary:"AMPLIFY",magnitude:.8,reversed:{primary:"SILENCE",secondary:"SLOW",costFactor:.25}}},{id:2,canonicalName:"The High Priestess",hebrewLetter:"",symbol:"",pillarAffinity:"balance",pathId:13,operator:{primary:"SILENCE",secondary:"MEMORY",magnitude:.7,reversed:{primary:"DIVERGE",secondary:"SHOCK",costFactor:.35}}},{id:3,canonicalName:"The Empress",hebrewLetter:"",symbol:"",pillarAffinity:"mercy",pathId:14,operator:{primary:"AMPLIFY",secondary:"OPEN_GATE",magnitude:.75,reversed:{primary:"CLOSE_GATE",secondary:"SLOW",costFactor:.2}}},{id:4,canonicalName:"The Emperor",hebrewLetter:"",symbol:"",pillarAffinity:"severity",pathId:15,operator:{primary:"CLOSE_GATE",secondary:"CONVERGE",magnitude:.78,reversed:{primary:"DIVERGE",secondary:"SHOCK",costFactor:.3}}},{id:5,canonicalName:"The Hierophant",hebrewLetter:"",symbol:"",pillarAffinity:"balance",pathId:16,operator:{primary:"RITUAL_PULSE",magnitude:.65,reversed:{primary:"DIVERGE",costFactor:.35}}},{id:6,canonicalName:"The Lovers",hebrewLetter:"",symbol:"",pillarAffinity:"all",pathId:17,operator:{primary:"BRIDGE",secondary:"CONVERGE",magnitude:.72,reversed:{primary:"CUT",secondary:"DIVERGE",costFactor:.4}}},{id:7,canonicalName:"The Chariot",hebrewLetter:"",symbol:"",pillarAffinity:"severity",pathId:18,operator:{primary:"OPEN_GATE",secondary:"SPEED",magnitude:.75,reversed:{primary:"DELAY",secondary:"CLOSE_GATE",costFactor:.3}}},{id:8,canonicalName:"Strength",hebrewLetter:"",symbol:"",pillarAffinity:"balance",pathId:19,operator:{primary:"BALANCE",magnitude:.8,reversed:{primary:"DIVERGE",secondary:"SHOCK",costFactor:.35}}},{id:9,canonicalName:"The Hermit",hebrewLetter:"",symbol:"",pillarAffinity:"balance",pathId:20,operator:{primary:"SILENCE",secondary:"SLOW",magnitude:.65,reversed:{primary:"OPEN_GATE",secondary:"DIVERGE",costFactor:.2}}},{id:10,canonicalName:"Wheel of Fortune",hebrewLetter:"",symbol:"",pillarAffinity:"all",pathId:21,operator:{primary:"SHOCK",magnitude:.6,reversed:{primary:"DELAY",secondary:"LOOP",costFactor:.3}}},{id:11,canonicalName:"Justice",hebrewLetter:"",symbol:"",pillarAffinity:"balance",pathId:22,operator:{primary:"BALANCE",secondary:"CLOSE_GATE",magnitude:.78,reversed:{primary:"DIVERGE",secondary:"LOOP",costFactor:.35}}},{id:12,canonicalName:"The Hanged Man",hebrewLetter:"",symbol:"",pillarAffinity:"severity",pathId:23,operator:{primary:"DELAY",secondary:"MEMORY",magnitude:.65,reversed:{primary:"SPEED",secondary:"OPEN_GATE",costFactor:.25}}},{id:13,canonicalName:"Death",hebrewLetter:"",symbol:"",pillarAffinity:"severity",pathId:24,operator:{primary:"CUT",magnitude:.85,reversed:{primary:"LOOP",secondary:"CLOSE_GATE",costFactor:.45}}},{id:14,canonicalName:"Temperance",hebrewLetter:"",symbol:"",pillarAffinity:"balance",pathId:25,operator:{primary:"BALANCE",secondary:"STABILIZE",magnitude:.8,reversed:{primary:"SHOCK",secondary:"DIVERGE",costFactor:.3}}},{id:15,canonicalName:"The Devil",hebrewLetter:"",symbol:"",pillarAffinity:"severity",pathId:26,operator:{primary:"CONVERGE",secondary:"LOOP",magnitude:.75,reversed:{primary:"OPEN_GATE",secondary:"DIVERGE",costFactor:.4}}},{id:16,canonicalName:"The Tower",hebrewLetter:"",symbol:"",pillarAffinity:"all",pathId:27,operator:{primary:"SHOCK",magnitude:.9,reversed:{primary:"STABILIZE",secondary:"CLOSE_GATE",costFactor:.2}}},{id:17,canonicalName:"The Star",hebrewLetter:"",symbol:"",pillarAffinity:"mercy",pathId:28,operator:{primary:"CONVERGE",magnitude:.6,reversed:{primary:"DIVERGE",secondary:"SILENCE",costFactor:.25}}},{id:18,canonicalName:"The Moon",hebrewLetter:"",symbol:"",pillarAffinity:"balance",pathId:29,operator:{primary:"LOOP",secondary:"DELAY",magnitude:.65,reversed:{primary:"CLARIFY",secondary:"CUT",costFactor:.35}}},{id:19,canonicalName:"The Sun",hebrewLetter:"",symbol:"",pillarAffinity:"mercy",pathId:30,operator:{primary:"CLARIFY",secondary:"AMPLIFY",magnitude:.8,reversed:{primary:"SILENCE",secondary:"CLOSE_GATE",costFactor:.2}}},{id:20,canonicalName:"Judgement",hebrewLetter:"",symbol:"",pillarAffinity:"balance",pathId:31,operator:{primary:"REVIEW",magnitude:.75,reversed:{primary:"LOOP",secondary:"DELAY",costFactor:.35}}},{id:21,canonicalName:"The World",hebrewLetter:"",symbol:"",pillarAffinity:"all",pathId:32,operator:{primary:"INTEGRATE",magnitude:.85,reversed:{primary:"CUT",secondary:"DIVERGE",costFactor:.4}}}],Yc=new Map(V7.map(e=>[e.id,e])),rZ={id:"rws",label:"RiderWaiteSmith",description:"Imaginal narrative tradition. Story-rich, symbol-dense, accessible.",tradition:"Golden Dawn (A.E. Waite / Pamela Colman Smith)",mentorTone:"imaginal",bias:{operators:{}},majors:{0:{name:"The Fool",keywords:["leap","potential","spirit"],tone:"imaginal",microNote:"Spirit descending into matter  pure potential before the first step."},1:{name:"The Magician",keywords:["will","channel","As Above"],tone:"imaginal",microNote:`Mercury's power  "As Above, So Below." Focus of the adept.`},2:{name:"The High Priestess",keywords:["mystery","veil","memory"],tone:"imaginal",microNote:"Guardian of the veil between Kether and Tiphareth. Lunar gnosis."},3:{name:"The Empress",keywords:["abundance","venus","creation"],tone:"imaginal",microNote:"Venus bridges Chokmah and Binah  primal creative force."},4:{name:"The Emperor",keywords:["structure","aries","authority"],tone:"logical",microNote:"Aries fire of will forging order from chaos."},5:{name:"The Hierophant",keywords:["tradition","taurus","initiation"],tone:"ritual",microNote:"Hierophant of the Mysteries  the inner teacher transmits."},6:{name:"The Lovers",keywords:["union","gemini","choice"],tone:"imaginal",microNote:"Alchemical marriage of opposites. The path of discernment."},7:{name:"The Chariot",keywords:["triumph","cancer","willpower"],tone:"logical",microNote:"The victorious charioteer masters opposing forces."},8:{name:"Strength",keywords:["fortitude","leo","taming"],tone:"imaginal",microNote:"The lion and the maiden  mastery through love, not force."},9:{name:"The Hermit",keywords:["solitude","virgo","lantern"],tone:"imaginal",microNote:"Inner light illuminating the solitary path."},10:{name:"Wheel of Fortune",keywords:["cycle","jupiter","karma"],tone:"imaginal",microNote:"Jupiter's wheel turns  cycles of fortune and karma."},11:{name:"Justice",keywords:["balance","libra","truth"],tone:"logical",microNote:"Ma'at's scales  cosmic equilibrium enacted."},12:{name:"The Hanged Man",keywords:["surrender","water","inversion"],tone:"ritual",microNote:"Suspension between worlds  seeing from the Other Side."},13:{name:"Death",keywords:["transformation","scorpio","rebirth"],tone:"imaginal",microNote:"Scorpionic death of form  the alchemical nigredo."},14:{name:"Temperance",keywords:["alchemy","sagittarius","blend"],tone:"imaginal",microNote:"The Angel of Art  blending fire and water in the Great Work."},15:{name:"The Devil",keywords:["shadow","capricorn","bondage"],tone:"imaginal",microNote:"Chains of matter  recognise them to transcend."},16:{name:"The Tower",keywords:["lightning","mars","revelation"],tone:"imaginal",microNote:"The Lightning Flash destroys false structures."},17:{name:"The Star",keywords:["hope","aquarius","guidance"],tone:"imaginal",microNote:"Nuit pours forth the waters of life. Stellar consciousness."},18:{name:"The Moon",keywords:["illusion","pisces","threshold"],tone:"imaginal",microNote:"Astral tides and deception  the path through darkness."},19:{name:"The Sun",keywords:["clarity","sol","illumination"],tone:"imaginal",microNote:"Tiphareth's radiance  the inner sun fully revealed."},20:{name:"Judgement",keywords:["awakening","fire","resurrection"],tone:"ritual",microNote:"The trumpet calls  the dead rise in spiritual rebirth."},21:{name:"The World",keywords:["completion","saturn","wholeness"],tone:"imaginal",microNote:"Saturn's completion  the dancer in the cosmic mandala."}}},oZ={id:"marseille",label:"Marseille",description:"Structural-archetype tradition. Precise, architectural, classical.",tradition:"French esoteric tradition (Eliphas Lvi / Papus)",mentorTone:"logical",bias:{operators:{CLOSE_GATE:1.1,CUT:1.1,BALANCE:1.1}},majors:{0:{name:"Le Mat",keywords:["errance","zero","departure"],tone:"logical",microNote:"The unmapped wanderer at the edge of the Abyss."},1:{name:"Le Bateleur",keywords:["skill","tools","craft"],tone:"logical",microNote:"The artisan of the elements  mastery of the table."},2:{name:"La Papesse",keywords:["secret","book","threshold"],tone:"logical",microNote:"Hidden knowledge guarded behind the temple veil."},3:{name:"L'Impratrice",keywords:["reign","fertility","form"],tone:"logical",microNote:"Fertile form generating structure across worlds."},4:{name:"L'Empereur",keywords:["empire","law","stone"],tone:"logical",microNote:"Architected order  the cubic stone of foundation."},5:{name:"Le Pape",keywords:["keys","rite","transmission"],tone:"ritual",microNote:"Ritual transmission between inner and outer orders."},6:{name:"L'Amoureux",keywords:["choice","fork","duality"],tone:"logical",microNote:"The crossroads where the adept must choose."},7:{name:"Le Chariot",keywords:["movement","mastery","direction"],tone:"logical",microNote:"Directed force traversing the path between pillars."},8:{name:"La Justice",keywords:["sword","scales","measure"],tone:"logical",microNote:"Structural equilibration  the blade of discernment."},9:{name:"L'Ermite",keywords:["retreat","lamp","patience"],tone:"logical",microNote:"Solitary watchman with the lamp of Hermes."},10:{name:"La Roue de Fortune",keywords:["cycle","reversal","fate"],tone:"logical",microNote:"The wheel turns  ascent and descent are one motion."},11:{name:"La Force",keywords:["endurance","gentleness","grip"],tone:"logical",microNote:"Silent mastery of the inner beast through patience."},12:{name:"Le Pendu",keywords:["inversion","waiting","release"],tone:"ritual",microNote:"Suspended between worlds  memory deepens."},13:{name:"L'Arcane sans nom",keywords:["scythe","passage","harvest"],tone:"logical",microNote:"The unnamed force reaping what is no longer needed."},14:{name:"La Temprance",keywords:["flow","mixing","measure"],tone:"logical",microNote:"Steady blending of opposing currents."},15:{name:"Le Diable",keywords:["chains","shadow","attraction"],tone:"logical",microNote:"Bound by material attachment  the shadow is the teacher."},16:{name:"La Maison-Dieu",keywords:["lightning","collapse","opening"],tone:"logical",microNote:"The House of God struck open by divine fire."},17:{name:"L'toile",keywords:["hope","pouring","star"],tone:"logical",microNote:"Patient coherence poured into the great work."},18:{name:"La Lune",keywords:["illusion","drift","nocturne"],tone:"logical",microNote:"Nocturnal ambiguity  the path through the waters."},19:{name:"Le Soleil",keywords:["clarity","bloom","day"],tone:"logical",microNote:"Diurnal clarity  the twin pillars illuminated."},20:{name:"Le Jugement",keywords:["awakening","review","trumpet"],tone:"ritual",microNote:"Review and consolidation at the threshold of rebirth."},21:{name:"Le Monde",keywords:["totality","dance","completion"],tone:"logical",microNote:"Total integration as cosmic dance."}}},aZ={id:"thoth",label:"Thoth",description:"Alchemical-energetic tradition. Transformative, intense, esoteric.",tradition:"Thelemic tradition (Aleister Crowley / Frieda Harris)",mentorTone:"ritual",bias:{operators:{AMPLIFY:1.1,SHOCK:1.1,LOOP:1.1}},majors:{0:{name:"The Fool",keywords:["spirit","limitless","aethyr"],tone:"ritual",microNote:"Pure spirit before manifestation  Aleph, the breath."},1:{name:"The Magus",keywords:["mercury","logos","power"],tone:"ritual",microNote:"The Word as focused operator  Beth, the house of the Magus."},2:{name:"The Priestess",keywords:["moon","silver","gnosis"],tone:"ritual",microNote:"Lunar gnosis behind the veil of Paroketh."},3:{name:"The Empress",keywords:["venus","daleth","gateway"],tone:"ritual",microNote:"Venus as the luminous gateway of creation."},4:{name:"The Emperor",keywords:["aries","heh","vision"],tone:"logical",microNote:"Constituting Intelligence  the window of sight."},5:{name:"The Hierophant",keywords:["taurus","vau","nail"],tone:"ritual",microNote:"The Nail that fixes spirit into form  inner teaching."},6:{name:"The Lovers",keywords:["gemini","zayin","sword"],tone:"ritual",microNote:"The Sword that divides and reunites  alchemical solve."},7:{name:"The Chariot",keywords:["cancer","grail","triumph"],tone:"ritual",microNote:"The Holy Grail borne across the Abyss."},8:{name:"Lust",keywords:["leo","babalon","ecstasy"],tone:"ritual",microNote:"Babalon rides the Beast  creative fire unleashed."},9:{name:"The Hermit",keywords:["virgo","yod","seed"],tone:"ritual",microNote:"The Seed of Light hidden in the darkness of the earth."},10:{name:"Fortune",keywords:["jupiter","kaph","wheel"],tone:"ritual",microNote:"Jupiter's wheel  the three gunas in rotation."},11:{name:"Adjustment",keywords:["libra","lamed","equilibrium"],tone:"logical",microNote:"Adjustment of all imbalance  the Daughter of the Lords."},12:{name:"The Hanged Man",keywords:["water","mem","sacrifice"],tone:"ritual",microNote:"Redemption through water  the drowned god rises."},13:{name:"Death",keywords:["scorpio","nun","putrefaction"],tone:"ritual",microNote:"Putrefactio  the alchemical black dissolves false form."},14:{name:"Art",keywords:["sagittarius","samekh","opus"],tone:"ritual",microNote:"The Art of transmutation  rainbow of the Great Work."},15:{name:"The Devil",keywords:["capricorn","ayin","matter"],tone:"ritual",microNote:"Lord of the Gates of Matter  creative energy in chains."},16:{name:"The Tower",keywords:["mars","peh","destruction"],tone:"ritual",microNote:"War-engine of Mars  the lightning flash liberates."},17:{name:"The Star",keywords:["aquarius","tzaddi","nuit"],tone:"ritual",microNote:'Nuit reveals herself  "Every man and every woman is a star."'},18:{name:"The Moon",keywords:["pisces","qoph","midnight"],tone:"ritual",microNote:"Midnight sun behind the gates of dream and illusion."},19:{name:"The Sun",keywords:["sol","resh","glory"],tone:"ritual",microNote:"Ra-Hoor-Khuit in full radiance  the crowned child."},20:{name:"The Aeon",keywords:["fire","shin","horus"],tone:"ritual",microNote:"The Aeon of Horus  the crowned and conquering child."},21:{name:"The Universe",keywords:["saturn","tav","completion"],tone:"ritual",microNote:"Saturn's cosmic dance  the Universe as complete temple."}}},U7=[rZ,oZ,aZ],_b=new Map(U7.map(e=>[e.id,e]));function sZ(e,t){return{id:e,charge:.3,coherence:.2,tension:.15,openness:.5,memory:.1,...t}}function iZ(e){return{pathId:e,flow:.2,blockage:.1,pulseAcc:0,recentOps:[]}}function Y7(e){const t=new Map;for(const s of Md)t.set(s.id,sZ(s.id));const r=t.get("malkuth");r.charge=.55,r.openness=.65;const o=new Map;for(const s of Od)o.set(s.pathId,iZ(s.pathId));return{sephirot:t,paths:o,tick:0,time:0,globalCoherence:.2,globalTension:.15,expansionAccum:0,severityAccum:0,events:[],novelty:0,veilsEnabled:e.veilsEnabled,pillarsEnabled:e.pillarsEnabled}}function px(e,t){Object.assign(e,Y7(t))}function lZ(e){return eC.mercy.includes(e)?{mercy:.12,severity:0}:eC.severity.includes(e)?{mercy:0,severity:.12}:{mercy:.06,severity:.06}}function $v(e){let t=0,r=0,o=0;for(const l of e.sephirot.values())t+=l.coherence,r+=l.tension,o++;const s=e.globalCoherence;e.globalCoherence=t/o,e.globalTension=r/o,e.novelty=Math.abs(e.globalCoherence-s)*10}function cZ(e,t,r){e.time+=t,e.tick++;const o=r.ritualIntensity??.5,s=r.astralClarity??.5;for(const c of e.sephirot.values()){const d=lZ(c.id),h=e.pillarsEnabled?d.mercy*.08:0,f=e.pillarsEnabled?d.severity*.08:0;c.charge=qt(c.charge-.005*t+h*t*.5),c.coherence=qt(c.coherence-.003*t+h*t+f*t*.5+s*.002*t),c.tension=qt(c.tension-.004*t+f*t),c.openness=qt(c.openness+(.5-c.openness)*.01*t),c.memory=qt(c.memory-.002*t)}for(const c of e.paths.values())c.pulseAcc+=t,c.blockage=qt(c.blockage-.005*t),c.flow=qt(c.flow+(.2-c.flow)*.01*t),c.recentOps.length>3&&(c.recentOps=c.recentOps.slice(-3));const l=e.sephirot.get("chesed"),i=e.sephirot.get("geburah");l.charge>.7?e.expansionAccum+=t:e.expansionAccum=Math.max(0,e.expansionAccum-t*.5),i.tension>.7?e.severityAccum+=t:e.severityAccum=Math.max(0,e.severityAccum-t*.5),e.expansionAccum>18&&(e.expansionAccum=0,ip(e,"DISSOLUTION","Chesed overflow: Mercy without Severity dissolves form. Apply Banish or Seal to restore balance.")),e.severityAccum>18&&(e.severityAccum=0,ip(e,"CRYSTALLIZATION","Geburah excess: Severity crystallises the astral field. Invoke or open gates to restore flow."));const u=[...e.sephirot.values()].reduce((c,d)=>c+d.openness,0)/10;if(e.globalCoherence>.6&&u>.6&&o>.4&&Math.random()<t*.05){ip(e,"GREAT_WORK_PULSE","The Great Work resonates  a pulse of alchemical harmony radiates through the Tree.");for(const c of e.sephirot.values())c.charge=qt(c.charge+.02),c.coherence=qt(c.coherence+.01)}$v(e)}function dZ(e,t,r){const o=Yc.get(t.arcanaId);if(!o)return;const s=_b.get(t.lensId),l=(s==null?void 0:s.bias.operators)??{},i=t.reversed?o.operator.reversed:o.operator,c=((t.reversed?o.operator.reversed.costFactor:o.operator.magnitude)??.7)*(r.strictness*.4+.6)*(1+(r.ritualIntensity??.5)*.3);if(t.targetType==="sephirah"){const d=e.sephirot.get(t.targetId);d&&(mx(d,i.primary,c,l),i.secondary&&mx(d,i.secondary,c*.5,l),t.reversed&&(d.tension=qt(d.tension+o.operator.reversed.costFactor*.3)))}else if(t.targetType==="path"){const d=e.paths.get(t.targetId);d&&(nC(d,i.primary,c,l),i.secondary&&nC(d,i.secondary,c*.5,l))}else{const d=c*.35;for(const h of e.sephirot.values())mx(h,i.primary,d,l)}$v(e),e.veilsEnabled&&uZ(e)}function tC(e,t,r,o,s){const l=s.ritualIntensity??.5;if(o==="sephirah"){const i=e.sephirot.get(r);if(!i)return;switch(t){case"invoke":i.charge=qt(i.charge+.15*l),i.openness=qt(i.openness+.08*l);break;case"banish":i.tension=qt(i.tension-.15*l),i.blockage&&(i.memory=qt(i.memory-.05)),i.memory=qt(i.memory-.08*l);break;case"seal":i.coherence=qt(i.coherence+.12*l),i.openness=qt(i.openness-.06*l);break;case"transmute":const u=Math.max(i.tension-.3,0);i.tension=qt(i.tension-u*.6),i.charge=qt(i.charge+u*.4),i.coherence=qt(i.coherence+u*.2);break;case"portal":i.openness=qt(i.openness+.2*l),i.charge=qt(i.charge+.1*l),i.tension=qt(i.tension+.05*l);break;case"trace":i.charge=qt(i.charge+.08*l),i.coherence=qt(i.coherence+.05*l);break}}else{const i=e.paths.get(r);if(!i)return;switch(t){case"invoke":i.flow=qt(i.flow+.15*l),i.blockage=qt(i.blockage-.08*l);break;case"banish":i.blockage=qt(i.blockage-.2*l),i.flow=qt(i.flow+.05*l);break;case"seal":i.blockage=qt(i.blockage+.12*l);break;case"transmute":i.flow=qt(i.flow+.1*l),i.blockage=qt(i.blockage*(1-.3*l));break;case"portal":i.flow=qt(i.flow+.2*l),i.blockage=qt(i.blockage-.15*l);break;case"trace":i.flow=qt(i.flow+.12*l);break}}$v(e)}function K7(e,t){return t[e]??1}function mx(e,t,r,o){const s=r*K7(t,o);switch(t){case"OPEN_GATE":e.openness=qt(e.openness+s*.5);break;case"CLOSE_GATE":e.openness=qt(e.openness-s*.4);break;case"AMPLIFY":e.charge=qt(e.charge+s*.6),e.coherence=qt(e.coherence+s*.2);break;case"SILENCE":e.tension=qt(e.tension-s*.4),e.charge=qt(e.charge-s*.2);break;case"CONVERGE":e.coherence=qt(e.coherence+s*.5);break;case"DIVERGE":e.coherence=qt(e.coherence-s*.3),e.tension=qt(e.tension+s*.2);break;case"CUT":e.memory=qt(e.memory-s*.6),e.tension=qt(e.tension-s*.3);break;case"BALANCE":e.tension=qt(e.tension-s*.4),e.coherence=qt(e.coherence+s*.3);break;case"SHOCK":e.tension=qt(e.tension+s*.5),e.charge=qt(e.charge+s*.4);break;case"LOOP":e.memory=qt(e.memory+s*.4);break;case"MEMORY":e.memory=qt(e.memory+s*.5);break;case"STABILIZE":e.tension=qt(e.tension*(1-s*.3)),e.coherence=qt(e.coherence+s*.2);break;case"CLARIFY":e.coherence=qt(e.coherence+s*.4),e.tension=qt(e.tension-s*.3);break;case"REVIEW":e.memory=qt(e.memory+s*.3),e.coherence=qt(e.coherence+s*.2);break;case"INTEGRATE":e.coherence=qt(e.coherence+s*.5),e.memory=qt(e.memory+s*.3),e.tension=qt(e.tension*(1-s*.4));break;case"SPEED":e.openness=qt(e.openness+s*.3);break;case"SLOW":e.openness=qt(e.openness-s*.2),e.memory=qt(e.memory+s*.2);break;case"DELAY":e.openness=qt(e.openness-s*.3),e.memory=qt(e.memory+s*.4);break;case"BRIDGE":e.openness=qt(e.openness+s*.4),e.coherence=qt(e.coherence+s*.2);break;case"RITUAL_PULSE":e.charge=qt(e.charge+s*.3),e.memory=qt(e.memory+s*.2);break;case"INVOKE":e.charge=qt(e.charge+s*.5),e.openness=qt(e.openness+s*.3);break;case"BANISH":e.tension=qt(e.tension-s*.5),e.memory=qt(e.memory-s*.3);break;case"TRANSMUTE":{const l=Math.max(e.tension-.3,0)*s;e.tension=qt(e.tension-l),e.charge=qt(e.charge+l*.5),e.coherence=qt(e.coherence+l*.3);break}case"SEAL":e.coherence=qt(e.coherence+s*.4),e.openness=qt(e.openness-s*.2);break}}function nC(e,t,r,o){const s=r*K7(t,o);switch(e.recentOps=[...e.recentOps.slice(-2),t],t){case"OPEN_GATE":e.flow=qt(e.flow+s*.5),e.blockage=qt(e.blockage-s*.3);break;case"CLOSE_GATE":e.flow=qt(e.flow-s*.4);break;case"CUT":e.blockage=qt(e.blockage+s*.5),e.flow=qt(e.flow-s*.4);break;case"AMPLIFY":e.flow=qt(e.flow+s*.6);break;case"DELAY":e.blockage=qt(e.blockage+s*.4);break;case"SPEED":e.flow=qt(e.flow+s*.6),e.blockage=qt(e.blockage-s*.2);break;case"RITUAL_PULSE":e.pulseAcc=0,e.flow=qt(e.flow+s*.3);break;case"INVOKE":e.flow=qt(e.flow+s*.5),e.blockage=qt(e.blockage-s*.2);break;case"BANISH":e.blockage=qt(e.blockage-s*.5),e.flow=qt(e.flow+s*.1);break;case"TRANSMUTE":e.flow=qt(e.flow+s*.3),e.blockage=qt(e.blockage*(1-s*.4));break;case"SEAL":e.blockage=qt(e.blockage+s*.3);break;default:e.flow=qt(e.flow+s*.2);break}}function uZ(e){const t=["kether","chokmah","binah","chesed","geburah"];for(const o of t){const s=e.sephirot.get(o);e.globalCoherence<.45&&s.charge>.65&&(s.charge=.65,ip(e,"VEIL_BREACH",`Veil of Paroketh: insufficient coherence (${(e.globalCoherence*100).toFixed(0)}%) to sustain charge in ${o}. Strengthen the lower Tree first.`))}const r=e.sephirot.get("kether");e.globalTension>.55&&r.charge>.5&&(r.charge=.5,ip(e,"VEIL_BREACH",`Veil of the Abyss: tension too high (${(e.globalTension*100).toFixed(0)}%) to access Kether. Purify the astral before attempting the crossing.`))}function ip(e,t,r){e.events=[...e.events.slice(-19),{id:Date.now().toString(),kind:t,timestamp:Date.now(),description:r}]}function qt(e){return Math.max(0,Math.min(1,e))}function Ti(e){let t=0,r=0,o=0;for(const s of e.sephirot.values())t+=s.memory,r+=s.openness,o++;return{coherence:e.globalCoherence,tension:e.globalTension,memory:t/o,openness:r/o,novelty:e.novelty}}let gx=Date.now();function rC(){return gx=gx*1664525+1013904223&4294967295,(gx>>>0)/4294967295}function Tf(e,t=[]){const r=Array.from({length:22},(s,l)=>l).filter(s=>!t.includes(s)),o=[];for(;o.length<e&&r.length>0;){const s=Math.floor(rC()*r.length);o.push({id:r[s],reversed:rC()<.25}),r.splice(s,1)}return o}const hZ=[{id:"neophyte",name:"Neophyte Awakening",emoji:"",description:"Enter at Malkuth. First steps on the path. Gentle, exploratory.",recommendedLens:"rws",drawRate:3,strictness:.35,veilsEnabled:!1,pillarsEnabled:!0,gdGrade:"0=0 Neophyte",ritualTheme:"Purification and dedication",initialState:{malkuth:{charge:.6,coherence:.3,tension:.1,openness:.65,memory:.15},yesod:{charge:.25,coherence:.15,openness:.45},tiphereth:{charge:.1,coherence:.1,openness:.3}}},{id:"middlepillar",name:"Middle Pillar Ritual",emoji:"",description:"Kether to Malkuth along the axis of equilibrium. Classic GD practice.",recommendedLens:"rws",drawRate:3,strictness:.5,veilsEnabled:!0,pillarsEnabled:!0,gdGrade:"2=9 Theoricus",ritualTheme:"Equilibrium and circulation of light",initialState:{kether:{charge:.4,coherence:.55,tension:.05,openness:.5,memory:.25},tiphereth:{charge:.5,coherence:.45,tension:.15,openness:.6},yesod:{charge:.45,coherence:.35,tension:.15,openness:.55},malkuth:{charge:.55,coherence:.3,tension:.15,openness:.65}}},{id:"lbrp",name:"Lesser Banishing",emoji:"",description:"Cleanse the astral temple. High structure, Marseille precision.",recommendedLens:"marseille",drawRate:3,strictness:.7,veilsEnabled:!1,pillarsEnabled:!0,gdGrade:"1=10 Zelator",ritualTheme:"Banishing and protection",initialState:{geburah:{charge:.5,coherence:.4,tension:.3,openness:.4},binah:{charge:.35,coherence:.35,tension:.2},malkuth:{charge:.55,coherence:.4,tension:.2}}},{id:"alchemical",name:"Alchemical Great Work",emoji:"",description:"Solve et Coagula. Thoth lens. High energy transformative flux.",recommendedLens:"thoth",drawRate:5,strictness:.35,veilsEnabled:!1,pillarsEnabled:!1,gdGrade:"5=6 Adeptus Minor",ritualTheme:"Nigredo, Albedo, Rubedo  the alchemical stages",initialState:{netzach:{charge:.7,coherence:.2,tension:.4,openness:.8},chesed:{charge:.6,coherence:.25,tension:.3},tiphereth:{charge:.55,coherence:.3,tension:.25}}},{id:"astralvision",name:"Astral Scrying",emoji:"",description:"Yesod-centred dreamwork. Moon cycles, memory loops, subtle visions.",recommendedLens:"rws",drawRate:4,strictness:.3,veilsEnabled:!1,pillarsEnabled:!0,gdGrade:"2=9 Theoricus",ritualTheme:"Lunar scrying and astral travel",initialState:{yesod:{charge:.65,coherence:.15,tension:.2,memory:.55,openness:.6},hod:{charge:.4,coherence:.2,tension:.25,memory:.35},netzach:{charge:.45,coherence:.15,tension:.3,memory:.3}}},{id:"abysscrossing",name:"Crossing the Abyss",emoji:"",description:"Maximum challenge. Veils on, high tension. Dare the Dweller on the Threshold.",recommendedLens:"thoth",drawRate:5,strictness:.9,veilsEnabled:!0,pillarsEnabled:!0,gdGrade:"8=3 Magister Templi",ritualTheme:"Dissolution of ego at the Abyss",initialState:{geburah:{charge:.8,tension:.6,coherence:.1,openness:.25},binah:{charge:.7,tension:.5,coherence:.15,openness:.3},malkuth:{charge:.65,tension:.45,coherence:.2,openness:.35}}},{id:"rosecross",name:"Rose Cross Meditation",emoji:"",description:"Tiphareth-centred heart ritual. Balance, beauty, and the inner sun.",recommendedLens:"rws",drawRate:4,strictness:.45,veilsEnabled:!1,pillarsEnabled:!0,gdGrade:"5=6 Adeptus Minor",ritualTheme:"The Rosy Cross  union of opposites at the heart",initialState:{tiphereth:{charge:.65,coherence:.5,tension:.1,openness:.7,memory:.3},chesed:{charge:.4,coherence:.35,tension:.15},geburah:{charge:.4,coherence:.35,tension:.15},netzach:{charge:.35,coherence:.25,openness:.55},hod:{charge:.35,coherence:.25,openness:.55}}},{id:"elemental",name:"Elemental Initiation",emoji:"",description:"Journey through Earth, Water, Air, Fire. Four lower grades in sequence.",recommendedLens:"marseille",drawRate:4,strictness:.55,veilsEnabled:!1,pillarsEnabled:!0,gdGrade:"1=10 to 4=7",ritualTheme:"Elemental grades and purification",initialState:{malkuth:{charge:.55,coherence:.35,tension:.15,openness:.5},yesod:{charge:.4,coherence:.25,tension:.2,openness:.5},hod:{charge:.35,coherence:.2,tension:.25,openness:.45},netzach:{charge:.35,coherence:.2,tension:.25,openness:.45}}}],yx={deckLens:"rws",preset:"neophyte",veilsEnabled:!1,pillarsEnabled:!0,drawRate:3,strictness:.4,ritualIntensity:.5,astralClarity:.5,speed:1},io=Math.PI*2,Mg=540,kg=900,eo=26;function yl(e){return e*Mg-Mg*.5}function xl(e){return e*kg-kg*.5}function X7(e,t,r,o){const s=(e+r)/2,l=(t+o)/2,i=Math.sqrt(s*s+l*l)+1,u=22;return{x:s+s/i*u,y:l+l/i*u}}function V5(e,t,r,o,s,l,i){const u=1-e;return{x:u*u*t+2*u*e*o+e*e*l,y:u*u*r+2*u*e*s+e*e*i}}const Z7="tol_grimoire_v3";function fZ(){try{return JSON.parse(localStorage.getItem(Z7)??"[]")}catch{return[]}}function oC(e){try{localStorage.setItem(Z7,JSON.stringify(e.slice(-60)))}catch{}}function pZ(e,t){return e==="mercy"||t==="mercy"?[80,150,255]:e==="severity"||t==="severity"?[220,70,60]:[220,185,80]}const mZ={kether:{world:"Atziluth  Archetypal Plane",plane:"The Limitless Light / LVX",divineName:'Eheieh  "I Am"',archangel:"Metatron  Angel of the Presence",gdGrade:"10=1 Ipsissimus",planet:"Primum Mobile  the First Swirlings",body:"Crown of the Head (Sahasrara)",color:"#f0ece0",summary:"The Crown  point of first emanation from the Limitless Light. Beyond thought, beyond form.",spiritual:'Kether is the first point where the Infinite concentrates itself to create. It is pure undifferentiated consciousness  the "I" before any experience. The Ipsissimus grade represents unity with the All. As the Emerald Tablet teaches: that which is Above is as that which is Below  and Kether is the ultimate Above. It cannot be grasped by the mind, only touched through the deepest meditation.',lightningFlash:"Kether is the SOURCE of the Lightning Flash. The Limitless Light (LVX) descends from the unmanifest, striking like lightning through all 10 Sephiroth until it grounds in Malkuth. This is the descent of spirit into matter  the Great Work begins here.",serpentOfWisdom:"When the Serpent of Wisdom returns, Kether RECEIVES it back, completing the sacred cycle. The light returns to its origin, transformed by the full experience of Creation. This is the completion of the Great Work  the Magnum Opus.",practice:"Observe how Kether's charge flows to Chokmah and Binah. Apply INVOKE or CLARIFY to initiate the Lightning Flash. High coherence in Kether means the descending light flows freely."},chokmah:{world:"Atziluth  Archetypal Plane",plane:"The Zodiac / Fixed Stars",divineName:"Yah  the first flash of awareness",archangel:"Ratziel  Secret of God",gdGrade:"9=2 Magus",planet:"Fixed Stars / Zodiac",body:"Right hemisphere  creative intuition",color:"#d0c8a0",summary:"Wisdom  the primal flash of existence, the dynamic force from which all possibility emerges.",spiritual:'Chokmah is the Supernal Father  primal masculine force, the first differentiation. In the Magus grade, one wields the Word of creation. It is Wisdom not as knowledge but as the raw flash of insight, the lightning-bolt of inspiration. On the Pillar of Mercy, it represents unlimited expansive force. "Every man and every woman is a star"  Chokmah is the stellar force within.',lightningFlash:"Receives the Lightning Flash from Kether as an unfiltered ray  immediate, blazing. On the Pillar of Mercy, Chokmah transmits this fire to Binah (which gives it form) and to Chesed (which expands it). It is the Supernal Father.",serpentOfWisdom:'Reflects the Serpent of Wisdom back to Kether: all wisdom gathered through manifestation returns to the source, enriching the Divine Mind. The Wisdom that descended returns as deep gnosis  "As Above, So Below."',practice:"INVOKE and AMPLIFY at Chokmah expand the flow on the Pillar of Mercy. Observe how its charge feeds Chesed below. High charge here accelerates the Lightning Flash."},binah:{world:"Atziluth  Archetypal Plane",plane:"Saturnian Sphere",divineName:"YHVH Elohim  the formative divine principle",archangel:"Tzaphkiel  Beholder of God",gdGrade:"8=3 Magister Templi",planet:"Saturn  limitation, form and time",body:"Left hemisphere  structure and reason",color:"#5055a0",summary:"Understanding  the Great Mother, the womb in which all forms are gestated. Across the Abyss.",spiritual:"Binah is the Supernal Mother who gives birth to all forms. She is both Aima (the Bright Mother) and Ama (the Dark Mother). The Magister Templi has crossed the Abyss and surrendered all to the Cup of Babalon. Saturn gives her dominion over time and boundary  without Binah, nothing could take shape, and therefore nothing could exist. She is the Great Sea, the root of Water.",lightningFlash:'Receives the Lightning Flash from Kether and Chokmah. Binah "gives birth" to forms: here the formless light gains structure that will descend through the worlds. It is the first "No" that creates boundaries and makes existence possible.',serpentOfWisdom:'Receiving the Serpent of Wisdom from below, Binah recognizes the completed patterns  full "understanding" of the cycle. She seals the comprehension before passing it to Kether: all experience understood and integrated.',practice:"MEMORY and SEAL at Binah crystallize patterns. CLOSE_GATE here creates structuring limitation. High coherence in Binah means stable forms flowing through the Tree."},chesed:{world:"Beriah  Creative Plane",plane:"Jovian Sphere",divineName:"El  God of Grace and Abundance",archangel:"Tzadkiel  Righteousness of God",gdGrade:"7=4 Adeptus Exemptus",planet:"Jupiter  expansion, blessing and abundance",body:"Right arm  the arm that gives",color:"#6090d0",summary:"Mercy  unconditional love, expansion and divine grace. The benevolent King.",spiritual:"Chesed is divine love in its most generous form  the Adeptus Exemptus embodies this masterful compassion. The archetype of the benevolent ruler who gives freely. In the Golden Dawn, this is where the Adept begins to command the forces below with wisdom. Without Geburah to balance it, Chesed would become infinite indulgence, dissolving all structure.",lightningFlash:"Receives the Lightning Flash from the Supernals via direct path. On the Pillar of Mercy, Chesed expands the flow of light, making it more accessible and abundant for the lower Sephiroth.",serpentOfWisdom:"Chesed reflects the ascending Serpent as accumulated love and compassion  all experience of giving and receiving returns as gratitude to the Creator. Human love is the ascending light  divine grace reflected back.",practice:"AMPLIFY at Chesed expands flow for the entire Mercy column. Balance with Geburah via path 19 (Strength/Lust). High charge here benefits Netzach and Tiphereth."},geburah:{world:"Beriah  Creative Plane",plane:"Martian Sphere",divineName:"Elohim Gibor  God of Strength and Judgment",archangel:"Khamael  Burner of God",gdGrade:"6=5 Adeptus Major",planet:"Mars  strength, courage and delimitation",body:"Left arm  the arm that cuts",color:"#c03030",summary:"Severity  strength, justice and the necessary limitation that gives meaning to existence.",spiritual:'Geburah is the divine principle of restriction and justice. What Chesed expands, Geburah delimits. The Adeptus Major wields the Sword of discernment. Also called Pachad (Fear) or Din (Judgment)  not cruelty, but precision. As the alchemists say, solve et coagula: Geburah is the "solve," the dissolution of the unnecessary.',lightningFlash:'Receives the Lightning Flash from Binah and Chesed. Geburah "cuts" and refines the light, removing what is not essential  like the smith forging steel with fire and hammer. The light passing through Geburah becomes more concentrated and powerful.',serpentOfWisdom:'Geburah reflects the ascending Serpent as discernment and clarity. The power to distinguish, to judge wisely, to say "no" when needed  all returns to the Source as purity. What was pruned was limiting growth.',practice:"CUT and BANISH at Geburah remove blockages. SHOCK for strong interventions. High tension here may indicate excessive severity  balance with Chesed via path 19."},tiphereth:{world:"Beriah  Creative Plane",plane:"Solar Sphere",divineName:"YHVH Eloah va-Daath  the Mediator",archangel:"Raphael  Healer of God",gdGrade:"5=6 Adeptus Minor",planet:"Sun  the center, beauty, harmony",body:"Heart and chest  the vital center",color:"#e8c830",summary:"Beauty  heart of the Tree, point of perfect balance between the Lightning Flash and the Serpent of Wisdom.",spiritual:'Tiphereth is the Sun of the Tree of Life  the center where ALL forces equilibrate. It is the meeting point of the descending Lightning Flash and the ascending Serpent of Wisdom. The Adeptus Minor stands at the crossroads of the universe. It corresponds to the solar archetype  Osiris, the Christos, the resurrected King. The Great Work of the Golden Dawn centers here: "To know, to will, to dare, to keep silence."',lightningFlash:"Tiphereth is the CENTER of the descending flow. All light from Kether, Chokmah, Binah, Chesed and Geburah converges here  like sunlight illuminating all planets from the center.",serpentOfWisdom:'Tiphereth is the TURNING POINT of the Serpent of Wisdom. Here the light received from Netzach, Hod and Yesod is transmuted and elevated. The heart that has integrated all experience of the lower worlds begins the great return. This is the "Fiat LVX" of the ascending light.',practice:"BALANCE and INTEGRATE at Tiphereth affect the entire Tree. This is the most important hub. AMPLIFY here has global effect. Observe how its charge synchronizes with Kether above and Yesod below."},netzach:{world:"Yetzirah  Formative Plane",plane:"Venusian Sphere",divineName:"YHVH Tzabaoth  Lord of Hosts",archangel:"Haniel  Grace of God",gdGrade:"4=7 Philosophus",planet:"Venus  beauty, desire, instinct and nature",body:"Right hip  the generative force",color:"#50a840",summary:"Victory  instinct, emotion, the force of nature and the persistence of divine desire.",spiritual:'Netzach is the realm of emotions, wild nature, sensory beauty and instinct. The Philosophus grade explores the fire of desire and passion. It is where the nature deities dwell  archetypes, elementals, natural forces. The "victory" is the persistence of divine will to manifest. In astral vision, Netzach reveals the green ray of creative force.',lightningFlash:'Receives the Lightning Flash from Chesed, Tiphereth and partially from Geburah. Here the light becomes emotional and instinctive  it is the "feeling" of Creation, the divine pleasure in its works.',serpentOfWisdom:"Netzach reflects the ascending Serpent as love for creation, beauty and instinctive gratitude. The purest emotions  awe, ecstasy, love of life  flow back to the Source. Human desire for the Divine is the ascending Serpent of Netzach.",practice:"INVOKE at Netzach releases creative expression and emotional flow. AMPLIFY here empowers the entire lower Mercy column. Observe how it feeds Hod via path 27 (The Tower)."},hod:{world:"Yetzirah  Formative Plane",plane:"Mercurial Sphere",divineName:"Elohim Tzabaoth  God of Form and Order",archangel:"Michael  Who is like God",gdGrade:"3=8 Practicus",planet:"Mercury  communication, reason and analysis",body:"Left hip  analytical precision",color:"#b06820",summary:"Splendor  intellect, language, analysis and the gift of naming. The domain of ceremonial magic.",spiritual:"Hod is the rational faculty, the gift of language and analysis. The Practicus works with the Water element and the structured mind. It is where magicians and scientists operate  transforming experience into structured knowledge. Hod is the seat of ceremonial magic in the Golden Dawn system  ritual, formulae, vibration of divine names. It complements Netzach: where Netzach feels, Hod analyzes.",lightningFlash:"Receives the Lightning Flash from Geburah, Tiphereth and Netzach. Here the light gains precision and articulation  becoming thought, language, intellectual form.",serpentOfWisdom:"Hod reflects the ascending Serpent as structured comprehension  maps, models and languages returning to the Divine. All human knowledge is the ascending light of Hod: the human mind reflecting the cosmic mind back to the Source.",practice:"CLARIFY and MEMORY at Hod structure intellectual patterns. BRIDGE connects Hod to Netzach for balancing reason and emotion. High memory here means consolidated cognitive patterns."},yesod:{world:"Yetzirah  Formative Plane",plane:"Lunar Sphere",divineName:"Shaddai El Chai  the Almighty Living God",archangel:"Gabriel  Strength of God",gdGrade:"2=9 Theoricus",planet:"Moon  reflection, the unconscious and cycles",body:"Reproductive organs  the vital foundation",color:"#8060c0",summary:"The Foundation  the astral plane, the collective unconscious, the mould of reality.",spiritual:"Yesod is the intermediate plane between spirit and matter  the astral light. The Theoricus explores this lunar realm of vision and imagination. It is the foundation upon which Malkuth rests. It corresponds to the astral body, dreams and the Akashic memory. The Moon governs Yesod: cycles, tides, the hidden rhythm of reality. In astral travel, Yesod is the first sphere encountered.",lightningFlash:'Receives the Lightning Flash from Tiphereth, Netzach and Hod. Here spiritual light compresses into etheric patterns that will manifest in Malkuth. Yesod is the "mould" of physical reality  everything in Malkuth first exists in Yesod.',serpentOfWisdom:"Yesod reflects the ascending Serpent as collective memory and dreams  all human experience accumulates here before being elevated. It is the great reservoir of ascending light: it purifies and concentrates the returning current before sending it to Tiphereth.",practice:"MEMORY at Yesod strengthens the foundation of the entire Tree. RITUAL_PULSE creates waves affecting Malkuth and Tiphereth simultaneously. High coherence here means Malkuth manifests clearly."},malkuth:{world:"Assiah  Material Plane",plane:"The Sphere of the Elements",divineName:"Adonai ha-Aretz  Lord of Earth",archangel:"Sandalphon  Co-Brother",gdGrade:"1=10 Zelator",planet:"Earth  the physical world fully manifest",body:"The feet and base  connection to earth",color:"#806040",summary:"The Kingdom  the physical world, the lowest point and simultaneously the starting point of the return.",spiritual:'Malkuth is the world we inhabit  the kingdom of matter, body and the senses. The Zelator stands at the gate of the mysteries. It is where all spiritual light manifests as concrete reality. It is both the lowest point of descent and the STARTING POINT of the Serpent of Wisdom. "The stone the builders rejected has become the cornerstone." In the Hermetic tradition, matter is not fallen  it is Spirit made dense. The Great Work begins in Malkuth.',lightningFlash:'Malkuth is the FINAL DESTINATION of the Lightning Flash. All divine light, after traversing the 10 Sephiroth, manifests here as physical reality. When Malkuth is "full" of charge, the Lightning Flash has completed its journey of descent.',serpentOfWisdom:"Malkuth is the SOURCE of the Serpent of Wisdom! When Malkuth's charge reaches fullness, conscious matter recognizes its divine origin and light begins to reflect upward. When Malkuth exceeds 50% charge, VIOLET PARTICLES begin to RISE through the Tree  the ascending Serpent in action. This symbolizes spiritual awakening, the beginning of the Great Work  the Magnum Opus.",practice:"Watch Malkuth with special attention. When its charge rises, the Serpent of Wisdom activates  violet particles ascend the Tree. Apply RITUAL_PULSE here to create return waves. AMPLIFY accelerates the ascent. This is the point of greatest spiritual significance."}},gZ={title:"The Limitless Light  LVX",text:'Before Kether, there is the Ain Soph Aur: the Limitless Light. It is the absolute unconditioned, beyond any form or description. In the Hermetic tradition, this is the source of all  the hidden root from which the Tree springs. "That which is Above is as that which is Below, and that which is Below is as that which is Above, to accomplish the miracle of the One Thing."  The Emerald Tablet.'},yZ={title:"Lightning Flash   Descending Light",text:"The Lightning Flash descends from the Limitless Light through all 10 Sephiroth. Each Sephirah receives, transforms and passes the current onward. The descent ends in Malkuth  spirit fully manifest as matter. In visualization: golden/colored particles descending along the paths. This is the involutionary current  the descent of the divine into manifestation."},xZ={title:"Serpent of Wisdom   Ascending Light",text:"When the Lightning Flash reaches Malkuth, matter awakens to its divine origin and reflects light back upward  the Serpent of Wisdom. This ascending current returns purified by the complete experience of Creation. It is the foundation of all spiritual practice: the adept as a mirror reflecting light back to the Source. In visualization: violet particles rising along the paths. This is the evolutionary current  the Great Work of return."},bZ={title:"The Great Work  Magnum Opus",text:'When the Lightning Flash and the Serpent of Wisdom flow in simultaneous equilibrium  light descending and returning in harmony  the Great Work is accomplished. Each conscious act that elevates light from matter to spirit is an act of alchemy. The Tree in perfect balance represents the completed Magnum Opus. As the alchemists say: "Visita Interiora Terrae Rectificando Invenies Occultum Lapidem"  V.I.T.R.I.O.L.'},vZ=[{name:"Atziluth",heb:"",meaning:"Archetypal",sephirot:"Kether, Chokmah, Binah",desc:"The world of archetypes  divine emanation in its purest form. Here the light is nearly identical to the Source. The realm of the Supernals, beyond the Abyss."},{name:"Beriah",heb:"",meaning:"Creative",sephirot:"Chesed, Geburah, Tiphereth",desc:"The creative world  archetypal forces differentiated into patterns. The realm of the Adept grades. Here the Great Work is consciously undertaken."},{name:"Yetzirah",heb:"",meaning:"Formative",sephirot:"Netzach, Hod, Yesod",desc:"The astral/formative world  etheric patterns that mould physical reality. The realm of astral vision, ceremonial magic and elemental forces."},{name:"Assiah",heb:"",meaning:"Material",sephirot:"Malkuth",desc:"The manifest physical world  action, matter, the kingdom we inhabit. The starting point of the Great Work and the ground of the Temple."}],aC=[{id:"q1",text:"How drawn are you to structure vs. flow?",low:"Pure flow",high:"Pure structure",target:"strictness"},{id:"q2",text:"Do you seek clarity or embrace mystery?",low:"Deep mystery",high:"Crystal clarity",target:"astralClarity"},{id:"q3",text:"How intense is your inner fire?",low:"Gentle ember",high:"Blazing inferno",target:"ritualIntensity"},{id:"q4",text:"Are you more earthly or celestial?",low:"Rooted in earth",high:"Dwelling in stars",target:"earthCelestial"},{id:"q5",text:"Do you seek power or wisdom?",low:"Wisdom alone",high:"Power to act",target:"powerWisdom"},{id:"q6",text:"How open are your inner gates?",low:"Sealed tight",high:"Wide open",target:"openness"},{id:"q7",text:"Do you favor mercy or justice?",low:"Pure mercy",high:"Strict justice",target:"mercyJustice"},{id:"q8",text:"How deep is your memory of past lives?",low:"Blank slate",high:"Ancient soul",target:"memory"},{id:"q9",text:"Are you drawn to the sun or moon?",low:"Silver moon",high:"Golden sun",target:"sunMoon"},{id:"q10",text:"How ready are you to cross the Abyss?",low:"Not yet",high:"I am prepared",target:"abyssCrossing"}],sC={sephiroth:!0,paths:!0,orYashar:!0,orChozer:!0,pillars:!0,aura:!0,particles:!0,veils:!0};function SZ({active:e}){var Ft,me,cn,Xt,Dt;const[t,r]=w.useState({...yx}),o=w.useRef({...yx}),s=w.useRef(Y7(yx)),[l,i]=w.useState(()=>Ti(s.current)),[u,c]=w.useState(!0),d=w.useRef(!0),h=w.useRef(0),f=w.useRef(0),g=w.useRef(null),[m,y]=w.useState({w:800,h:600}),[v,b]=w.useState(!1),S=w.useRef({zoom:1,px:0,py:0}),C=w.useRef({active:!1,sx:0,sy:0,opx:0,opy:0}),k=w.useRef(new Map),R=w.useRef(new Map),j=w.useRef(new Map),T=w.useRef(new Map),_=w.useRef(new Map),P=w.useRef({level:0,greatWorkPulse:0,greatWorkFlash:0,lightningFlashLevel:0}),[I,$]=w.useState({level:0,greatWorkPulse:0,greatWorkFlash:0,lightningFlashLevel:0}),q=w.useRef([]),L=w.useRef(new Map),H=w.useRef(new Map),[G,oe]=w.useState(null),[le,pe]=w.useState(null),[ce,te]=w.useState({x:0,y:0}),[F,Q]=w.useState(null),[ae,we]=w.useState(null),[Re,ge]=w.useState([]),[Ae,tt]=w.useState(null),[We,J]=w.useState([]),[ke,Le]=w.useState(()=>fZ()),[K,et]=w.useState("journey"),[dt,Rt]=w.useState(!1),Wt=w.useRef([]),Zt=w.useRef(Ti(s.current)),[$e,Ze]=w.useState("select"),[Fe,Xe]=w.useState({...sC}),jt=w.useRef({...sC}),[hn,an]=w.useState(!1),[it,kt]=w.useState(()=>{const ne={};for(const Ne of aC)ne[Ne.id]=.5;return ne});w.useEffect(()=>{jt.current=Fe},[Fe]);const On=w.useCallback(ne=>{Xe(Ne=>({...Ne,[ne]:!Ne[ne]}))},[]),sn=w.useCallback(()=>{const ne=k.current,Ne=R.current,Ke=j.current;ne.clear(),Ne.clear(),Ke.clear(),T.current.clear(),_.current.clear();for(const Ct of Md){const ft=8+Math.round(Math.random()*4);ne.set(Ct.id,Array.from({length:ft},(At,bt)=>({angle:bt/ft*io+Math.random()*.3,angVel:(.5+Math.random()*.6)*(Math.random()>.5?1:-1),radius:eo*1.4+Math.random()*eo*.6,alpha:.4+Math.random()*.5})))}for(const Ct of Od)Ne.set(Ct.pathId,[]),Ke.set(Ct.pathId,[]),T.current.set(Ct.pathId,Math.random()),_.current.set(Ct.pathId,Math.random()*.5)},[]);w.useEffect(()=>{sn()},[]),w.useEffect(()=>{var ft;const ne=(ft=g.current)==null?void 0:ft.parentElement;if(!ne)return;const Ne=(At,bt)=>y({w:Math.max(1,Math.floor(At)),h:Math.max(1,Math.floor(bt))});Ne(ne.clientWidth,ne.clientHeight);const Ke=globalThis.ResizeObserver;if(!Ke){const At=()=>Ne(ne.clientWidth,ne.clientHeight);return addEventListener("resize",At),()=>removeEventListener("resize",At)}const Ct=new Ke(At=>{for(const bt of At)Ne(bt.contentRect.width,bt.contentRect.height)});return Ct.observe(ne),()=>Ct.disconnect()},[v]),w.useEffect(()=>{o.current=t},[t]),w.useEffect(()=>{d.current=u},[u]),w.useEffect(()=>{if(!e)return;let ne=0;const Ne=Ke=>{h.current=requestAnimationFrame(Ne);const Ct=Math.min((Ke-f.current)/1e3,.1);f.current=Ke;const ft=Ct*o.current.speed;d.current&&(cZ(s.current,ft,o.current),s.current.events.length>0&&J(At=>{const bt=[...At,...s.current.events].slice(-40);return s.current.events=[],bt}),ne%25===0&&i(Ti(s.current)));for(const[At,bt]of L.current)L.current.set(At,bt+ft);for(const[At,bt]of H.current)H.current.set(At,bt+ft);Xn(ft,s.current),q.current=q.current.map(At=>({...At,age:At.age+ft})).filter(At=>At.age<At.life),ne%20===0&&$({...P.current}),MZ(g.current,s.current,o.current,S.current,q.current,k.current,R.current,j.current,P.current,F,ae,L.current,H.current,jt.current),ne++};return f.current=performance.now(),h.current=requestAnimationFrame(Ne),()=>cancelAnimationFrame(h.current)},[e,F,ae]);function Xn(ne,Ne){var vn,Wn;const Ke=k.current,Ct=R.current,ft=j.current;for(const Gn of Md){const cr=Ke.get(Gn.id);if(!cr)continue;const pr=Ne.sephirot.get(Gn.id),br=.6+pr.charge*.8+pr.tension*.4;for(const hr of cr)hr.angle+=hr.angVel*br*ne,hr.radius=eo*(1.4+pr.coherence*.5)+Math.sin(hr.angle*3)*4,hr.alpha=.25+pr.charge*.5}const At=Ne.sephirot.get("malkuth"),bt=Ne.sephirot.get("kether"),nn=Ne.sephirot.get("tiphereth"),Bt=Math.max(0,At.charge-.35)*(1/.65),Jt=P.current;Jt.level=Jt.level+(Bt-Jt.level)*ne*.8;const Qt=(bt.charge+(((vn=Ne.sephirot.get("chokmah"))==null?void 0:vn.charge)??0)+(((Wn=Ne.sephirot.get("binah"))==null?void 0:Wn.charge)??0))/3;Jt.lightningFlashLevel=Jt.lightningFlashLevel+(Qt-Jt.lightningFlashLevel)*ne*.6;const en=Jt.level>.4&&Jt.lightningFlashLevel>.4?Math.min(Jt.level,Jt.lightningFlashLevel)*nn.coherence:0;Jt.greatWorkPulse=Jt.greatWorkPulse+(en-Jt.greatWorkPulse)*ne*.5,Jt.greatWorkFlash>0&&(Jt.greatWorkFlash=Math.max(0,Jt.greatWorkFlash-ne)),Jt.greatWorkPulse>.6&&Math.random()<ne*.3&&(Jt.greatWorkFlash=1.2,q.current.push({kind:"ripple",wx:yl(.5),wy:xl(.52),color:"#c080ff",age:0,life:2,r:200}));for(const Gn of Od){const cr=Ne.paths.get(Gn.pathId),pr=Ct.get(Gn.pathId),br=cr.flow,or=1-cr.blockage;for(let Tr=pr.length-1;Tr>=0;Tr--){const Ir=pr[Tr];if(Ir.t+=Ir.speed*ne,Ir.t>or){pr.splice(Tr,1);const jo=Ne.sephirot.get(Gn.to);jo&&(jo.charge=Math.min(1,jo.charge+.008))}}if(br>.05){const Tr=1/(br*5+.5),Ir=T.current.get(Gn.pathId)+ne;T.current.set(Gn.pathId,Ir),Ir>Tr&&pr.length<14&&(T.current.set(Gn.pathId,0),pr.push({t:0,speed:.18+br*.22+(Math.random()-.5)*.05,size:1.8+br*2+Math.random()*1.2,energy:.5+br*.5}))}const uo=ft.get(Gn.pathId),fr=Jt.level*br;for(let Tr=uo.length-1;Tr>=0;Tr--){const Ir=uo[Tr];if(Ir.t+=Ir.speed*ne,Ir.t>1){uo.splice(Tr,1);const jo=Ne.sephirot.get(Gn.from);jo&&(jo.coherence=Math.min(1,jo.coherence+.004))}}if(fr>.08){const Tr=1/(fr*4+.3),Ir=_.current.get(Gn.pathId)+ne;_.current.set(Gn.pathId,Ir),Ir>Tr&&uo.length<10&&(_.current.set(Gn.pathId,0),uo.push({t:0,speed:.12+fr*.18+(Math.random()-.5)*.04,size:1.5+fr*1.8+Math.random()*1,energy:.4+fr*.5}))}}}const Pt=w.useCallback((ne,Ne,Ke)=>{const Ct={arcanaId:ne.id,reversed:ne.reversed,targetType:Ne,targetId:Ke,timestamp:Date.now(),lensId:o.current.deckLens};Zt.current=Ti(s.current),dZ(s.current,Ct,o.current),Wt.current.push(Ct),tt(null),i(Ti(s.current));const ft=Yc.get(ne.id);zt(ft.operator.primary,Ne,Ke),setTimeout(()=>jn(),500)},[]);function zt(ne,Ne,Ke){let Ct=0,ft=0;if(Ne==="sephirah"){const Bt=li.get(Ke);Ct=yl(Bt.nx),ft=xl(Bt.ny),L.current.set(Ke,0)}else if(Ne==="path"){const Bt=G5.get(Ke),Jt=li.get(Bt.from),Qt=li.get(Bt.to);Ct=(yl(Jt.nx)+yl(Qt.nx))/2,ft=(xl(Jt.ny)+xl(Qt.ny))/2,H.current.set(Ke,0)}else for(const Bt of Md)L.current.set(Bt.id,0);const bt={AMPLIFY:"#ffd060",SHOCK:"#ff6040",CUT:"#ff4040",OPEN_GATE:"#60ff90",CLOSE_GATE:"#ff8060",BALANCE:"#60d0ff",CONVERGE:"#a060ff",CLARIFY:"#ffffff",INTEGRATE:"#c0ff80",SILENCE:"#6080ff",RITUAL_PULSE:"#ff80ff",INVOKE:"#ffd060",BANISH:"#ff6040",TRANSMUTE:"#a78bfa",SEAL:"#34d399"}[ne]??"#c0c0ff",nn=ne==="SHOCK"?"burst":ne==="CUT"?"dissolve":"ripple";q.current.push({kind:nn,wx:Ct,wy:ft,color:bt,age:0,life:1.2,r:60})}const jn=w.useCallback(()=>{if(Wt.current.length===0)return;const ne=Ti(s.current),Ne=Zt.current,Ke=[...Wt.current];Wt.current=[];const Ct=_b.get(o.current.deckLens),ft=Ke[0],At=ft?Ct.majors[ft.arcanaId]:null,bt=ft!=null&&ft.reversed?" (inv)":"",nn=At?`${At.name}${bt}  ${ft.targetType==="global"?"global":ft.targetId}. ${At.keywords.join(", ")}. Coh ${(ne.coherence*100).toFixed(0)}%, Ten ${(ne.tension*100).toFixed(0)}%.`:"Session recorded.",Bt={id:Date.now().toString(),timestamp:Date.now(),lens:o.current.deckLens,preset:o.current.preset,cards:Ke,snapshot:ne,deltas:{coherence:ne.coherence-Ne.coherence,tension:ne.tension-Ne.tension,memory:ne.memory-Ne.memory,openness:ne.openness-Ne.openness,novelty:ne.novelty-Ne.novelty},tags:Ke.flatMap(Jt=>{const Qt=Yc.get(Jt.arcanaId);return Qt?[Jt.reversed?Qt.operator.reversed.primary:Qt.operator.primary]:[]}),text:nn};Le(Jt=>{const Qt=[...Jt,Bt];return oC(Qt),Qt})},[]),En=(ne,Ne,Ke,Ct)=>({x:(ne-Ke/2-S.current.px)/S.current.zoom,y:(Ne-Ct/2-S.current.py)/S.current.zoom}),lt=w.useCallback(ne=>{ne.preventDefault();const Ne=g.current;if(!Ne)return;const Ke=Ne.getBoundingClientRect(),Ct=ne.clientX-Ke.left,ft=ne.clientY-Ke.top,At=Ne.width,bt=Ne.height,nn=ne.deltaY<0?1.13:1/1.13,Bt=Math.max(.2,Math.min(4,S.current.zoom*nn)),Jt=Ct-At/2-(Ct-At/2-S.current.px)*Bt/S.current.zoom,Qt=ft-bt/2-(ft-bt/2-S.current.py)*Bt/S.current.zoom;S.current={zoom:Bt,px:Jt,py:Qt}},[]),ht=w.useCallback(ne=>{ne.button===0&&(C.current={active:!0,sx:ne.clientX,sy:ne.clientY,opx:S.current.px,opy:S.current.py})},[]),_t=w.useCallback(ne=>{const Ne=g.current;if(!Ne)return;const Ke=Ne.getBoundingClientRect(),Ct=(ne.clientX-Ke.left)*(Ne.width/Ke.width),ft=(ne.clientY-Ke.top)*(Ne.height/Ke.height);if(C.current.active){const Qt=ne.clientX-C.current.sx,en=ne.clientY-C.current.sy;S.current={...S.current,px:C.current.opx+Qt,py:C.current.opy+en}}const At=Ne.width,bt=Ne.height,nn=En(Ct,ft,At,bt);te({x:ne.clientX,y:ne.clientY});let Bt=null,Jt=null;for(const Qt of Md){const en=nn.x-yl(Qt.nx),vn=nn.y-xl(Qt.ny);if(en*en+vn*vn<(eo+8)*(eo+8)){Bt=Qt.id;break}}if(!Bt)for(const Qt of Od){const en=li.get(Qt.from),vn=li.get(Qt.to),Wn=yl(en.nx),Gn=xl(en.ny),cr=yl(vn.nx),pr=xl(vn.ny),br=X7(Wn,Gn,cr,pr);for(let hr=0;hr<=10;hr++){const or=V5(hr/10,Wn,Gn,br.x,br.y,cr,pr),uo=nn.x-or.x,fr=nn.y-or.y;if(uo*uo+fr*fr<80){Jt=Qt.pathId;break}}if(Jt!==null)break}oe(Bt),pe(Jt)},[]),Ie=w.useCallback(ne=>{const Ne=C.current.active&&(Math.abs(ne.clientX-C.current.sx)>5||Math.abs(ne.clientY-C.current.sy)>5);if(C.current.active=!1,Ne)return;const Ke=$e;Ke==="select"||Ke==="drag"?G?Ae?(Pt(Ae,"sephirah",G),Q(G),we(null)):(Q(G===F?null:G),we(null),et("journey")):le!==null?Ae?(Pt(Ae,"path",le),we(le),Q(null)):(we(le===ae?null:le),Q(null),et("journey")):(Q(null),we(null)):G?(tC(s.current,Ke,G,"sephirah",o.current),L.current.set(G,0),zt(Ke.toUpperCase(),"sephirah",G),i(Ti(s.current)),Q(G),we(null)):le!==null&&(tC(s.current,Ke,le,"path",o.current),H.current.set(le,0),zt(Ke.toUpperCase(),"path",le),i(Ti(s.current)),we(le),Q(null))},[G,le,Ae,F,ae,Pt,$e]),at=w.useCallback(()=>{px(s.current,o.current),sn(),P.current={level:0,greatWorkPulse:0,greatWorkFlash:0,lightningFlashLevel:0},i(Ti(s.current)),Q(null),we(null),ge(Tf(o.current.drawRate)),tt(null)},[sn]),St=w.useCallback(ne=>{const Ne={...o.current,preset:ne.id,drawRate:ne.drawRate,strictness:ne.strictness,veilsEnabled:ne.veilsEnabled,pillarsEnabled:ne.pillarsEnabled};r(Ne),o.current=Ne,px(s.current,Ne);for(const[Ke,Ct]of Object.entries(ne.initialState)){const ft=s.current.sephirot.get(Ke);ft&&Object.assign(ft,Ct)}sn(),i(Ti(s.current)),ge(Tf(Ne.drawRate))},[sn]),ye=w.useCallback(ne=>{r(Ne=>{const Ke={...Ne,...ne};return o.current=Ke,s.current.veilsEnabled=Ke.veilsEnabled,s.current.pillarsEnabled=Ke.pillarsEnabled,Ke})},[]),xe=w.useCallback(()=>{const ne=it,Ne={...o.current,preset:"mystical_journey",strictness:ne.q1,astralClarity:ne.q2,ritualIntensity:ne.q3,veilsEnabled:ne.q10>.6,pillarsEnabled:!0,speed:1};r(Ne),o.current=Ne,px(s.current,Ne);const Ke=s.current,Ct=Ke.sephirot.get("malkuth");Ct.charge=.3+(1-ne.q4)*.5,Ct.openness=ne.q6;const ft=Ke.sephirot.get("kether");ft.charge=.2+ne.q4*.5;const At=Ke.sephirot.get("chokmah");At.charge=.2+(1-ne.q5)*.4;const bt=Ke.sephirot.get("geburah");bt.charge=.2+ne.q5*.4,bt.tension=ne.q7*.3;const nn=Ke.sephirot.get("chesed");nn.charge=.2+(1-ne.q7)*.4;const Bt=Ke.sephirot.get("tiphereth");Bt.charge=.2+ne.q9*.4;const Jt=Ke.sephirot.get("yesod");Jt.charge=.2+(1-ne.q9)*.4;for(const Qt of Ke.sephirot.values())Qt.openness=Math.max(Qt.openness,ne.q6*.6),Qt.memory=Math.max(Qt.memory,ne.q8*.4);if(ne.q10>.5){const Qt=Ke.sephirot.get("binah");Qt.tension=ne.q10*.3}sn(),i(Ti(s.current)),ge(Tf(Ne.drawRate)),an(!1)},[it,sn]);if(w.useEffect(()=>{ge(Tf(t.drawRate))},[]),!e)return null;const gt=_b.get(t.deckLens),Ge=F?li.get(F):null,Ye=F?s.current.sephirot.get(F):null,Ve=ae!==null?G5.get(ae):null,Oe=Ve?Yc.get(Ve.arcanaId):null,Gt=Oe?gt.majors[Oe.id]:null,Kt=G&&G!==F?li.get(G):null,fn=le!==null&&le!==ae?G5.get(le):null,zn=v?{position:"fixed",inset:0,zIndex:100}:{position:"fixed",inset:0,top:38,zIndex:1},rt=Math.round(I.level*100),mt=Math.round(I.lightningFlashLevel*100),yt=Math.round(I.greatWorkPulse*100),Et=[{key:"sephiroth",label:"Sephiroth",icon:""},{key:"paths",label:"Paths",icon:""},{key:"orYashar",label:"Lightning Flash ",icon:""},{key:"orChozer",label:"Serpent ",icon:""},{key:"pillars",label:"Pillars",icon:""},{key:"aura",label:"Aura",icon:""},{key:"particles",label:"Particles",icon:""},{key:"veils",label:"Veils",icon:""}];return a.jsxs("div",{style:{...zn,display:"flex",flexDirection:"column",background:"#000",fontFamily:"system-ui, sans-serif"},children:[hn&&a.jsx("div",{style:{position:"fixed",inset:0,zIndex:200,background:"rgba(0,0,0,0.85)",backdropFilter:"blur(8px)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>an(!1),children:a.jsxs("div",{onClick:ne=>ne.stopPropagation(),style:{width:440,maxHeight:"85vh",overflowY:"auto",background:"rgba(10,6,30,0.98)",border:"1px solid rgba(180,120,255,0.3)",borderRadius:12,padding:"24px 28px",boxShadow:"0 20px 60px rgba(100,40,180,0.3)"},children:[a.jsx("div",{style:{fontSize:16,color:"rgba(240,230,210,0.95)",marginBottom:4,fontWeight:500},children:"Mystical Journey"}),a.jsx("div",{style:{fontSize:9,color:"rgba(180,160,200,0.5)",marginBottom:16,lineHeight:1.5},children:"Answer these questions to create a personalized Tree configuration. Let your intuition guide you  there are no wrong answers."}),aC.map(ne=>a.jsxs("div",{style:{marginBottom:14},children:[a.jsx("div",{style:{fontSize:9,color:"rgba(210,195,240,0.8)",marginBottom:6},children:ne.text}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx("span",{style:{fontSize:7,color:"rgba(180,160,200,0.4)",width:60,textAlign:"right",flexShrink:0},children:ne.low}),a.jsx("input",{type:"range",min:0,max:1,step:.01,value:it[ne.id],onChange:Ne=>kt(Ke=>({...Ke,[ne.id]:parseFloat(Ne.target.value)})),style:{flex:1,height:3,accentColor:"#a78bfa",cursor:"pointer"}}),a.jsx("span",{style:{fontSize:7,color:"rgba(180,160,200,0.4)",width:60,flexShrink:0},children:ne.high})]})]},ne.id)),a.jsxs("div",{style:{display:"flex",gap:8,marginTop:16},children:[a.jsx("button",{title:"Aplicar respostas da jornada",onClick:xe,style:{flex:1,padding:"8px 14px",borderRadius:6,cursor:"pointer",background:"rgba(160,100,255,0.2)",border:"1px solid rgba(180,120,255,0.5)",color:"rgba(220,200,255,0.95)",fontSize:10,letterSpacing:"0.08em"},children:"Begin the Journey"}),a.jsx("button",{title:"Cancelar jornada",onClick:()=>an(!1),style:{padding:"8px 14px",borderRadius:6,cursor:"pointer",background:"rgba(255,255,255,0.04)",border:"1px solid rgba(255,255,255,0.1)",color:"rgba(180,165,150,0.5)",fontSize:10},children:"Cancel"})]})]})}),a.jsxs("div",{style:{flex:1,display:"flex",overflow:"hidden",minHeight:0},children:[a.jsxs("div",{style:{width:210,flexShrink:0,overflowY:"auto",scrollbarWidth:"none",background:"rgba(0,0,0,0.97)",borderRight:"1px solid rgba(255,255,255,0.05)",display:"flex",flexDirection:"column",padding:"10px 0"},children:[a.jsxs("div",{style:{padding:"0 12px 8px"},children:[a.jsx("div",{style:{fontSize:6.5,color:"rgba(180,120,255,0.5)",letterSpacing:"0.2em",textTransform:"uppercase"},children:"Tree of Life"}),a.jsx("div",{style:{fontSize:13,color:"rgba(240,230,210,0.9)"},children:"Hermetic Qabalah  Tarot"}),a.jsx("div",{style:{fontSize:7.5,color:"rgba(180,160,200,0.4)",marginTop:2},children:"Journey through the 10 Sephiroth & 22 Paths"})]}),a.jsx(Wl,{}),a.jsxs(od,{label:"Ritual Tools",children:[a.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:3},children:Lu.map(ne=>a.jsx("button",{onClick:()=>Ze(ne.id),title:ne.desc,style:{width:30,height:28,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:5,cursor:"pointer",fontSize:13,background:$e===ne.id?`${ne.color}25`:"rgba(255,255,255,0.025)",border:$e===ne.id?`1px solid ${ne.color}80`:"1px solid rgba(255,255,255,0.06)",color:$e===ne.id?ne.color:"rgba(180,165,150,0.35)",transition:"all 0.15s"},children:ne.icon},ne.id))}),a.jsx("div",{style:{fontSize:6,color:"rgba(180,160,200,0.35)",marginTop:4},children:((Ft=Lu.find(ne=>ne.id===$e))==null?void 0:Ft.desc)??""})]}),a.jsx(Wl,{}),a.jsxs("div",{style:{padding:"6px 10px 8px"},children:[a.jsx("div",{style:{fontSize:6.5,color:"rgba(180,120,255,0.4)",letterSpacing:"0.14em",textTransform:"uppercase",marginBottom:6},children:"Flow of Light"}),a.jsxs("div",{style:{marginBottom:5},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[a.jsx("span",{style:{fontSize:7,color:"rgba(220,185,80,0.7)",letterSpacing:"0.05em"},children:" Lightning Flash"}),a.jsxs("span",{style:{fontSize:7,color:"rgba(220,185,80,0.8)",fontFamily:"monospace"},children:[mt,"%"]})]}),a.jsx("div",{style:{height:3,background:"rgba(255,255,255,0.06)",borderRadius:2},children:a.jsx("div",{style:{width:`${mt}%`,height:"100%",borderRadius:2,transition:"width 0.4s",background:"linear-gradient(90deg, #c0a040, #ffe080)"}})})]}),a.jsxs("div",{style:{marginBottom:5},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[a.jsx("span",{style:{fontSize:7,color:"rgba(160,90,255,0.7)",letterSpacing:"0.05em"},children:" Serpent of Wisdom"}),a.jsxs("span",{style:{fontSize:7,color:rt>30?"#c080ff":"rgba(160,90,255,0.5)",fontFamily:"monospace"},children:[rt,"%"]})]}),a.jsx("div",{style:{height:3,background:"rgba(255,255,255,0.06)",borderRadius:2},children:a.jsx("div",{style:{width:`${rt}%`,height:"100%",borderRadius:2,transition:"width 0.4s",background:"linear-gradient(90deg, #6020c0, #c080ff)"}})})]}),a.jsxs("div",{style:{padding:"4px 7px",borderRadius:5,marginTop:4,background:yt>40?"rgba(96,20,128,0.15)":"rgba(255,255,255,0.02)",border:`1px solid ${yt>40?"rgba(180,100,255,0.3)":"rgba(255,255,255,0.05)"}`,transition:"all 0.5s"},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[a.jsx("span",{style:{fontSize:7,color:yt>40?"rgba(210,170,255,0.8)":"rgba(170,155,140,0.35)",letterSpacing:"0.05em"},children:" The Great Work"}),a.jsxs("span",{style:{fontSize:7,fontFamily:"monospace",color:yt>40?"#e0c0ff":"rgba(170,155,140,0.3)"},children:[yt,"%"]})]}),a.jsx("div",{style:{height:3,background:"rgba(255,255,255,0.06)",borderRadius:2},children:a.jsx("div",{style:{width:`${yt}%`,height:"100%",borderRadius:2,transition:"width 0.5s",background:"linear-gradient(90deg, #8040e0, #e0b0ff, #ffe080)"}})}),yt<10&&a.jsx("div",{style:{fontSize:6,color:"rgba(160,145,130,0.3)",marginTop:3},children:"Raise Malkuth to activate the Serpent of Wisdom"}),yt>40&&a.jsx("div",{style:{fontSize:6.5,color:"rgba(210,170,255,0.7)",marginTop:3},children:"Magnum Opus in progress  lights in harmony"})]})]}),a.jsx(Wl,{}),a.jsx(od,{label:"Overlays",children:a.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:2},children:Et.map(ne=>a.jsxs("button",{onClick:()=>On(ne.key),title:ne.label,style:{padding:"2px 6px",borderRadius:4,cursor:"pointer",fontSize:7,display:"flex",alignItems:"center",gap:3,background:Fe[ne.key]?"rgba(180,120,255,0.12)":"rgba(255,255,255,0.02)",border:`1px solid ${Fe[ne.key]?"rgba(180,120,255,0.3)":"rgba(255,255,255,0.06)"}`,color:Fe[ne.key]?"rgba(210,185,255,0.85)":"rgba(170,155,140,0.3)"},children:[a.jsx("span",{style:{fontSize:9},children:ne.icon})," ",ne.label]},ne.key))})}),a.jsx(Wl,{}),a.jsx(od,{label:"Tarot Lens",hint:"Changes vocabulary and emphasis. Base mechanics identical.",children:U7.map(ne=>a.jsx(kZ,{active:t.deckLens===ne.id,label:ne.label,desc:ne.description.slice(0,42)+"",onClick:()=>ye({deckLens:ne.id})},ne.id))}),a.jsx(Wl,{}),a.jsxs(od,{label:"Journey Presets",children:[a.jsx("button",{title:"Iniciar jornada mstica",onClick:()=>an(!0),style:{width:"100%",padding:"5px 8px",marginBottom:4,borderRadius:5,cursor:"pointer",background:"linear-gradient(135deg, rgba(160,80,255,0.12), rgba(220,180,60,0.08))",border:"1px solid rgba(180,120,255,0.3)",color:"rgba(220,200,255,0.85)",fontSize:8,letterSpacing:"0.08em",textAlign:"left"},children:" Mystical Journey Questionnaire"}),hZ.map(ne=>a.jsxs("button",{title:`${ne.name}: ${ne.desc}`,onClick:()=>St(ne),style:{display:"flex",alignItems:"flex-start",gap:5,width:"100%",padding:"4px 8px",marginBottom:2,borderRadius:4,cursor:"pointer",textAlign:"left",background:t.preset===ne.id?"rgba(96,20,128,0.18)":"rgba(255,255,255,0.025)",border:`1px solid ${t.preset===ne.id?"rgba(180,120,255,0.35)":"rgba(255,255,255,0.05)"}`,color:t.preset===ne.id?"rgba(210,180,255,0.9)":"rgba(180,165,150,0.45)"},children:[a.jsx("span",{style:{fontSize:11,flexShrink:0,marginTop:1},children:ne.emoji}),a.jsxs("div",{children:[a.jsx("div",{style:{fontSize:8},children:ne.name}),a.jsxs("div",{style:{fontSize:6,opacity:.55},children:[ne.description.slice(0,38),""]})]})]},ne.id))]}),a.jsx(Wl,{}),a.jsxs(od,{label:"Parameters",children:[a.jsx(If,{label:"Strictness",value:t.strictness,onChange:ne=>ye({strictness:ne})}),a.jsx(If,{label:"Ritual Int.",value:t.ritualIntensity,onChange:ne=>ye({ritualIntensity:ne})}),a.jsx(If,{label:"Astral Clar.",value:t.astralClarity,onChange:ne=>ye({astralClarity:ne})}),a.jsx(If,{label:"Draw",value:(t.drawRate-3)/2,onChange:ne=>ye({drawRate:Math.round(ne*2+3)}),display:`${t.drawRate} cards`}),a.jsx(iC,{label:"Pillars",active:t.pillarsEnabled,hint:"Field bias from the 3 pillars",onChange:ne=>ye({pillarsEnabled:ne})}),a.jsx(iC,{label:"Veils",active:t.veilsEnabled,hint:"Coherence thresholds for upper sephiroth",onChange:ne=>ye({veilsEnabled:ne})})]}),a.jsx(Wl,{}),a.jsx(od,{label:"Speed",children:a.jsx(If,{label:"Speed",value:(t.speed-.25)/2.75,onChange:ne=>ye({speed:Math.round((ne*2.75+.25)*100)/100}),display:`${t.speed.toFixed(2)}x`})}),a.jsx(Wl,{}),a.jsxs(od,{label:"Global State",children:[a.jsx(w5,{label:"Coherence",v:l.coherence,c:"#60c0ff"}),a.jsx(w5,{label:"Tension",v:l.tension,c:"#ff7050"}),a.jsx(w5,{label:"Memory",v:l.memory,c:"#a070ff"}),a.jsx(w5,{label:"Openness",v:l.openness,c:"#50d080"})]}),a.jsx(Wl,{}),a.jsxs("div",{style:{padding:"6px 10px",display:"flex",flexDirection:"column",gap:4},children:[a.jsxs("div",{style:{display:"flex",gap:3},children:[a.jsx(xx,{onClick:()=>c(ne=>!ne),c:u?"#ffd060":"#60c080",children:u?a.jsxs(a.Fragment,{children:[a.jsx(s0,{size:9}),"Pause"]}):a.jsxs(a.Fragment,{children:[a.jsx(wl,{size:9}),"Play"]})}),a.jsxs(xx,{onClick:at,c:"#7070a0",children:[a.jsx(Ch,{size:9}),"Reset"]})]}),a.jsxs(xx,{onClick:()=>ge(Tf(t.drawRate)),c:"#c0a0ff",children:[a.jsx(Es,{size:9})," Draw ",t.drawRate," Cards"]})]}),a.jsxs("div",{style:{padding:"0 10px 6px"},children:[a.jsxs("button",{title:dt?"Fechar avanado":"Grimrio & configurao",onClick:()=>Rt(!dt),style:{display:"flex",alignItems:"center",gap:4,width:"100%",fontSize:7,background:"none",border:"none",cursor:"pointer",color:"rgba(180,165,150,0.3)",letterSpacing:"0.1em",textTransform:"uppercase"},children:[a.jsx(_d,{size:8})," Advanced ",dt?a.jsx(Pa,{size:8}):a.jsx(aa,{size:8})]}),dt&&a.jsxs("div",{style:{background:"rgba(0,0,0,0.35)",borderRadius:4,padding:"8px",border:"1px solid rgba(255,255,255,0.06)",marginTop:3},children:[a.jsxs("div",{style:{fontSize:6.5,color:"rgba(180,165,150,0.35)",lineHeight:1.6},children:["Lens: ",a.jsx("b",{style:{color:"rgba(200,165,255,0.7)"},children:t.deckLens}),a.jsx("br",{}),"Preset: ",a.jsx("b",{style:{color:"rgba(200,165,255,0.7)"},children:t.preset}),a.jsx("br",{}),"Chapters: ",ke.length]}),a.jsx("button",{title:"Limpar grimrio",onClick:()=>{Le([]),oC([])},style:{marginTop:5,fontSize:7,background:"rgba(255,50,30,0.08)",border:"1px solid rgba(255,50,30,0.18)",borderRadius:3,padding:"2px 6px",cursor:"pointer",color:"rgba(255,110,90,0.55)"},children:"Clear Grimoire"})]})]})]}),a.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",minWidth:0,position:"relative"},children:[a.jsxs("div",{style:{flex:1,position:"relative",overflow:"hidden",background:"#000"},children:[a.jsx("canvas",{ref:g,width:m.w,height:m.h,style:{position:"absolute",inset:0,display:"block",cursor:C.current.active?"grabbing":$e!=="select"&&$e!=="drag"?"crosshair":G||le!==null?"pointer":"grab"},onWheel:ne=>{ne.preventDefault(),lt(ne)},onMouseDown:ht,onMouseMove:_t,onMouseUp:Ie,onMouseLeave:()=>{C.current.active=!1,oe(null),pe(null)}}),a.jsxs("div",{style:{position:"absolute",top:8,left:"50%",transform:"translateX(-50%)",padding:"3px 14px",borderRadius:12,background:"rgba(0,0,0,0.55)",border:"1px solid rgba(96,20,128,0.3)",fontSize:7,color:"rgba(200,175,255,0.6)",letterSpacing:"0.14em",textTransform:"uppercase",pointerEvents:"none"},children:[gt.label,"  ",t.preset,t.veilsEnabled?"  Veils ON":"",t.pillarsEnabled?"  Pillars":""]}),rt>20&&a.jsxs("div",{style:{position:"absolute",top:8,left:12,padding:"3px 8px",borderRadius:8,background:"rgba(48,10,64,0.75)",border:"1px solid rgba(96,20,128,0.5)",fontSize:7,color:"rgba(200,150,255,0.9)",letterSpacing:"0.08em",pointerEvents:"none",backdropFilter:"blur(4px)",boxShadow:"0 0 12px rgba(160,80,255,0.2)"},children:[" Serpent of Wisdom ",rt,"%"]}),$e!=="select"&&a.jsxs("div",{style:{position:"absolute",top:8,right:rt>20?12:"auto",left:rt>20?"auto":12,padding:"3px 8px",borderRadius:8,background:"rgba(0,0,0,0.65)",border:`1px solid ${((me=Lu.find(ne=>ne.id===$e))==null?void 0:me.color)??"#888"}60`,fontSize:7,color:((cn=Lu.find(ne=>ne.id===$e))==null?void 0:cn.color)??"#888",letterSpacing:"0.08em",pointerEvents:"none"},children:[(Xt=Lu.find(ne=>ne.id===$e))==null?void 0:Xt.icon," ",(Dt=Lu.find(ne=>ne.id===$e))==null?void 0:Dt.label]}),I.greatWorkFlash>0&&a.jsx("div",{style:{position:"absolute",inset:0,pointerEvents:"none",background:`rgba(96,20,128,${I.greatWorkFlash*.05})`,transition:"background 0.3s"}}),a.jsx("div",{style:{position:"absolute",bottom:12,left:12,display:"flex",flexDirection:"column",gap:4},children:[{ico:a.jsx(zC,{size:12}),action:()=>{S.current={...S.current,zoom:Math.min(4,S.current.zoom*1.25)}}},{ico:a.jsx(BC,{size:12}),action:()=>{S.current={...S.current,zoom:Math.max(.2,S.current.zoom*.8)}}},{ico:a.jsx(Ch,{size:11}),action:()=>{S.current={zoom:1,px:0,py:0}}},{ico:a.jsx(DC,{size:11}),action:()=>b(ne=>!ne)}].map(({ico:ne,action:Ne},Ke)=>a.jsx("button",{title:label,onClick:Ne,style:{width:28,height:28,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:6,cursor:"pointer",background:"rgba(0,0,0,0.55)",border:"1px solid rgba(255,255,255,0.08)",color:"rgba(200,185,255,0.6)"},children:ne},Ke))}),Ae&&a.jsx("button",{title:"Jogar carta selecionada",onClick:()=>Pt(Ae,"global","global"),style:{position:"absolute",top:8,right:12,padding:"4px 14px",borderRadius:6,cursor:"pointer",background:"rgba(255,200,60,0.12)",border:"1px solid rgba(255,200,60,0.3)",fontSize:8,color:"rgba(255,220,100,0.9)",letterSpacing:"0.1em"},children:" Apply Globally"}),(Ge||Ve)&&a.jsxs("div",{style:{position:"absolute",bottom:8,left:"50%",transform:"translateX(-50%)",padding:"8px 16px",borderRadius:10,maxWidth:380,background:"rgba(6,3,20,0.92)",border:"1px solid rgba(180,120,255,0.3)",fontSize:8,color:"rgba(220,210,195,0.85)",textAlign:"center",pointerEvents:"none",backdropFilter:"blur(8px)"},children:[Ge&&Ye&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{fontSize:11,color:"rgba(210,185,255,0.95)",letterSpacing:"0.05em"},children:[Ge.label,a.jsx("span",{style:{fontSize:7.5,color:"rgba(180,160,240,0.5)",marginLeft:6},children:Ge.labelHeb})]}),a.jsxs("div",{style:{fontSize:7.5,color:"rgba(180,165,200,0.6)",marginBottom:5},children:[Ge.meaning,"  Pillar of ",Ge.pillar==="mercy"?"Mercy":Ge.pillar==="severity"?"Severity":"Balance"]}),a.jsx("div",{style:{display:"flex",justifyContent:"center",gap:8},children:[{l:"Charge",v:Ye.charge,c:"#ffd060"},{l:"Coh",v:Ye.coherence,c:"#60c0ff"},{l:"Tension",v:Ye.tension,c:"#ff7050"},{l:"Memory",v:Ye.memory,c:"#a070ff"}].map(({l:ne,v:Ne,c:Ke})=>a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("div",{style:{fontSize:6,color:"rgba(180,165,200,0.5)",letterSpacing:"0.1em"},children:ne}),a.jsxs("div",{style:{fontSize:10,color:Ke},children:[Math.round(Ne*100),"%"]})]},ne))}),Ge.id==="malkuth"&&rt>20&&a.jsx("div",{style:{marginTop:4,fontSize:7,color:"#c080ff"},children:" Serpent Active  light ascending to Source"}),Ae&&a.jsx("div",{style:{marginTop:4,color:"rgba(255,220,80,0.8)"},children:" Click to apply card"})]}),Ve&&Oe&&Gt&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{fontSize:11,color:"rgba(210,185,255,0.95)"},children:[Gt.name,a.jsxs("span",{style:{fontSize:7.5,color:"rgba(180,160,240,0.5)",marginLeft:6},children:[Oe.hebrewLetter,"  Path ",ae]})]}),a.jsxs("div",{style:{fontSize:7.5,color:"rgba(180,165,200,0.6)",marginBottom:3},children:[Ve.from,"  ",Ve.to]}),a.jsx("div",{style:{fontSize:7.5,marginBottom:3},children:Gt.keywords.join("  ")}),a.jsxs("div",{style:{fontSize:7,color:"rgba(200,185,165,0.5)"},children:["Op: ",Oe.operator.primary,Oe.operator.secondary?` + ${Oe.operator.secondary}`:""," "," ",Gt.microNote]}),Ae&&a.jsx("div",{style:{marginTop:4,color:"rgba(255,220,80,0.8)"},children:" Click to apply card"})]})]}),(Kt||fn)&&a.jsxs("div",{style:{position:"fixed",left:ce.x+14,top:ce.y-10,padding:"5px 10px",borderRadius:6,zIndex:10,background:"rgba(8,4,22,0.9)",border:"1px solid rgba(180,120,255,0.2)",fontSize:8,color:"rgba(220,210,200,0.85)",pointerEvents:"none",maxWidth:200,backdropFilter:"blur(6px)"},children:[Kt&&a.jsxs(a.Fragment,{children:[a.jsx("b",{style:{color:"rgba(210,185,255,0.9)"},children:Kt.label}),"  ",Kt.meaning,a.jsx("br",{}),a.jsxs("span",{style:{fontSize:7,color:"rgba(180,160,200,0.55)"},children:[Kt.planet,"  ",Kt.pillar==="mercy"?" Mercy":Kt.pillar==="severity"?" Severity":"| Balance",Ae?"  Click to apply":"  Click to explore "]})]}),fn&&(()=>{const ne=Yc.get(fn.arcanaId),Ne=gt.majors[ne.id];return a.jsxs(a.Fragment,{children:[a.jsx("b",{style:{color:"rgba(210,185,255,0.9)"},children:Ne.name}),a.jsx("br",{}),a.jsxs("span",{style:{fontSize:7,color:"rgba(180,160,200,0.5)"},children:[ne.hebrewLetter,"  ",Ne.keywords.join(", ")]})]})})()]})]}),a.jsxs("div",{style:{flexShrink:0,display:"flex",alignItems:"center",gap:5,padding:"8px 12px",borderTop:"1px solid rgba(255,255,255,0.05)",background:"rgba(3,1,12,0.97)",overflowX:"auto",scrollbarWidth:"thin",minHeight:108},children:[a.jsx("div",{style:{fontSize:6.5,color:"rgba(200,170,255,0.3)",letterSpacing:"0.15em",textTransform:"uppercase",flexShrink:0,writingMode:"vertical-rl"},children:"HAND"}),Re.map((ne,Ne)=>{const Ke=Yc.get(ne.id),Ct=gt.majors[ne.id],ft=(Ae==null?void 0:Ae.id)===ne.id&&(Ae==null?void 0:Ae.reversed)===ne.reversed;return a.jsx("div",{onClick:()=>tt(ft?null:ne),style:{flexShrink:0,width:58,borderRadius:8,overflow:"hidden",cursor:"pointer",userSelect:"none",border:ft?"2px solid rgba(255,220,80,0.8)":ne.reversed?"1px solid rgba(255,70,50,0.3)":"1px solid rgba(180,120,255,0.2)",background:"rgba(8,4,24,0.98)",transform:ft?"translateY(-10px) scale(1.05)":"none",transition:"transform 0.2s, border-color 0.2s",boxShadow:ft?"0 4px 20px rgba(255,220,80,0.2)":"none"},children:a.jsx(RZ,{ar:Ke,ld:Ct,reversed:ne.reversed})},`${ne.id}-${Ne}`)}),a.jsx("div",{style:{flexShrink:0,marginLeft:4,fontSize:7,color:"rgba(160,145,200,0.2)",maxWidth:70,lineHeight:1.5},children:Ae?" click on node or path":"Select a card"})]})]}),a.jsxs("div",{style:{width:250,flexShrink:0,display:"flex",flexDirection:"column",borderLeft:"1px solid rgba(255,255,255,0.05)",background:"rgba(3,1,14,0.97)"},children:[a.jsx("div",{style:{display:"flex",borderBottom:"1px solid rgba(255,255,255,0.05)"},children:[{id:"journey",label:"Journey",ico:""},{id:"grimoire",label:"Grimoire",ico:""},{id:"glossary",label:"Glossary",ico:""}].map(ne=>a.jsxs("button",{title:ne.label,onClick:()=>et(ne.id),style:{flex:1,padding:"7px 3px",fontSize:7,border:"none",cursor:"pointer",letterSpacing:"0.08em",textTransform:"uppercase",background:K===ne.id?"rgba(180,120,255,0.1)":"transparent",borderBottom:K===ne.id?"2px solid rgba(180,120,255,0.5)":"2px solid transparent",color:K===ne.id?"rgba(210,180,255,0.9)":"rgba(170,155,140,0.3)"},children:[ne.ico," ",ne.label]},ne.id))}),a.jsxs("div",{style:{flex:1,overflowY:"auto",scrollbarWidth:"thin",padding:"8px 10px"},children:[K==="journey"&&a.jsx(wZ,{selectedSeph:F,selectedPath:ae,snap:l,params:t,events:We,serpentSnap:I,lens:gt}),K==="grimoire"&&a.jsxs("div",{children:[a.jsxs("div",{style:{fontSize:6.5,color:"rgba(180,120,255,0.4)",letterSpacing:"0.12em",textTransform:"uppercase",marginBottom:6},children:["Grimoire  ",ke.length," chapters"]}),ke.length===0&&a.jsx("div",{style:{fontSize:7.5,color:"rgba(170,155,140,0.3)",padding:"10px 0"},children:"Play cards to record chapters automatically."}),[...ke].reverse().slice(0,24).map(ne=>a.jsxs("div",{style:{marginBottom:7,padding:"6px 8px",borderRadius:5,background:"rgba(255,255,255,0.02)",border:"1px solid rgba(180,120,255,0.09)"},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[a.jsxs("span",{style:{fontSize:6,color:"rgba(180,120,255,0.5)",letterSpacing:"0.1em"},children:[ne.lens.toUpperCase(),"  ",new Date(ne.timestamp).toLocaleTimeString()]}),a.jsx("span",{style:{fontSize:6,color:"rgba(170,155,140,0.4)"},children:ne.tags.slice(0,2).join(", ")})]}),a.jsx("div",{style:{fontSize:7.5,color:"rgba(210,200,185,0.7)",lineHeight:1.45},children:ne.text}),a.jsxs("div",{style:{display:"flex",gap:4,marginTop:3,flexWrap:"wrap"},children:[a.jsx(bx,{label:"coh",delta:ne.deltas.coherence}),a.jsx(bx,{label:"ten",delta:ne.deltas.tension,invert:!0}),a.jsx(bx,{label:"mem",delta:ne.deltas.memory})]})]},ne.id))]}),K==="glossary"&&a.jsxs("div",{children:[a.jsxs("div",{style:{fontSize:6.5,color:"rgba(180,120,255,0.4)",letterSpacing:"0.12em",textTransform:"uppercase",marginBottom:6},children:["Glossary  ",gt.label]}),V7.map(ne=>{const Ne=gt.majors[ne.id];return a.jsx("div",{style:{marginBottom:5,padding:"4px 7px",borderRadius:4,background:"rgba(255,255,255,0.02)",border:"1px solid rgba(255,255,255,0.04)"},children:a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5},children:[a.jsx("span",{style:{fontSize:14,color:"rgba(220,210,195,0.65)",width:18,flexShrink:0},children:ne.symbol}),a.jsxs("div",{style:{flex:1},children:[a.jsx("span",{style:{fontSize:7.5,color:"rgba(220,210,195,0.82)",fontWeight:500},children:Ne.name}),a.jsx("span",{style:{fontSize:6,color:"rgba(180,120,255,0.5)",marginLeft:4},children:ne.hebrewLetter}),a.jsxs("div",{style:{fontSize:6,color:"rgba(170,155,200,0.45)"},children:[Ne.keywords.join("  "),"  ",ne.operator.primary]})]})]})},ne.id)})]})]})]})]})]})}function wZ({selectedSeph:e,selectedPath:t,snap:r,params:o,events:s,serpentSnap:l,lens:i}){const[u,c]=w.useState(!1),[d,h]=w.useState(!1),[f,g]=w.useState(!0),m=e?mZ[e]:null,y=e?li.get(e):null,v=t!==null?G5.get(t):null,b=v?Yc.get(v.arcanaId):null,S=b&&i?i.majors[b.id]:null,C={fontSize:7.5,color:"rgba(200,190,175,0.7)",lineHeight:1.55,marginBottom:6},k={fontSize:7,color:"rgba(180,120,255,0.55)",letterSpacing:"0.12em",textTransform:"uppercase",marginBottom:4,marginTop:8},R={padding:"7px 9px",borderRadius:6,marginBottom:6,background:"rgba(255,255,255,0.025)",border:"1px solid rgba(180,120,255,0.1)"},j={padding:"7px 9px",borderRadius:6,marginBottom:6,background:"rgba(100,30,180,0.07)",border:"1px solid rgba(160,80,255,0.2)"},T={padding:"7px 9px",borderRadius:6,marginBottom:6,background:"rgba(180,140,30,0.07)",border:"1px solid rgba(220,180,60,0.2)"};if(e&&m&&y){const _=e==="malkuth";return a.jsxs("div",{children:[a.jsxs("div",{style:{...R,border:`1px solid ${y.color}40`,background:`${y.color}0a`,marginBottom:8},children:[a.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:8,marginBottom:3},children:[a.jsx("span",{style:{fontSize:16,color:y.color,filter:`drop-shadow(0 0 6px ${y.color}80)`},children:""}),a.jsxs("div",{children:[a.jsx("div",{style:{fontSize:13,color:"rgba(240,235,220,0.95)",fontWeight:500},children:y.label}),a.jsxs("div",{style:{fontSize:8,color:"rgba(200,185,255,0.5)"},children:[y.labelHeb,"  Sephirah ",y.num]})]})]}),a.jsx("div",{style:{fontSize:7.5,color:"rgba(200,190,170,0.6)",marginBottom:3},children:m.divineName}),a.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[a.jsxs("span",{style:{fontSize:6.5,padding:"2px 6px",borderRadius:10,background:"rgba(255,255,255,0.05)",color:"rgba(200,185,170,0.5)"},children:[" ",m.world]}),a.jsxs("span",{style:{fontSize:6.5,padding:"2px 6px",borderRadius:10,background:"rgba(255,255,255,0.05)",color:"rgba(200,185,170,0.5)"},children:[" ",y.planet]}),a.jsxs("span",{style:{fontSize:6.5,padding:"2px 6px",borderRadius:10,background:"rgba(255,255,255,0.05)",color:"rgba(200,185,170,0.5)"},children:[" ",m.gdGrade]})]}),a.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap",marginTop:4},children:[a.jsxs("span",{style:{fontSize:6.5,padding:"2px 6px",borderRadius:10,background:"rgba(255,255,255,0.05)",color:"rgba(200,185,170,0.5)"},children:[" ",m.archangel]}),a.jsxs("span",{style:{fontSize:6.5,padding:"2px 6px",borderRadius:10,background:"rgba(255,255,255,0.05)",color:"rgba(200,185,170,0.5)"},children:[" ",m.body]})]})]}),a.jsx("div",{style:k,children:"Spiritual Meaning"}),a.jsx("div",{style:C,children:m.spiritual}),a.jsxs("div",{style:T,children:[a.jsx("div",{style:{fontSize:7,color:"rgba(220,185,80,0.7)",letterSpacing:"0.1em",marginBottom:4},children:" LIGHTNING FLASH  Descending Light"}),a.jsx("div",{style:C,children:m.lightningFlash})]}),a.jsxs("div",{style:{...j,border:_&&l.level>.2?"1px solid rgba(160,80,255,0.5)":"1px solid rgba(160,80,255,0.2)",boxShadow:_&&l.level>.2?"0 0 12px rgba(160,80,255,0.15)":"none"},children:[a.jsx("div",{style:{fontSize:7,color:"rgba(160,90,255,0.8)",letterSpacing:"0.1em",marginBottom:4},children:" SERPENT OF WISDOM  Ascending Light"}),a.jsx("div",{style:C,children:m.serpentOfWisdom}),_&&l.level>.15&&a.jsxs("div",{style:{fontSize:7,padding:"4px 7px",borderRadius:4,marginTop:4,background:"rgba(160,80,255,0.12)",border:"1px solid rgba(160,80,255,0.3)",color:"rgba(210,160,255,0.9)"},children:[" Serpent active (",Math.round(l.level*100),"%)  violet particles ascending"]})]}),a.jsx("div",{style:k,children:"In the Simulation"}),a.jsx("div",{style:{...R,borderColor:"rgba(100,180,255,0.15)",background:"rgba(60,120,200,0.05)"},children:a.jsx("div",{style:C,children:m.practice})}),a.jsx("div",{style:{fontSize:6,color:"rgba(160,145,130,0.3)",marginTop:8,textAlign:"center"},children:"Click another Sephirah to explore  Click empty space to return"})]})}if(t!==null&&v&&b&&S){const _=li.get(v.from),P=li.get(v.to);return a.jsxs("div",{children:[a.jsxs("div",{style:{...R,marginBottom:8},children:[a.jsxs("div",{style:{fontSize:11,color:"rgba(210,185,255,0.95)",marginBottom:3},children:[b.symbol," ",S.name]}),a.jsxs("div",{style:{fontSize:7.5,color:"rgba(180,165,200,0.6)",marginBottom:5},children:["Path ",t,"  Letter ",b.hebrewLetter,"  ",v.attribution]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,fontSize:7.5},children:[a.jsx("span",{style:{color:_.color},children:_.label}),a.jsx("span",{style:{color:"rgba(200,185,165,0.4)"},children:""}),a.jsx("span",{style:{color:P.color},children:P.label})]})]}),a.jsx("div",{style:k,children:"This Path"}),a.jsxs("div",{style:C,children:["Path ",t," connects ",a.jsx("b",{style:{color:_.color},children:_.label})," (",_.meaning,") to ",a.jsx("b",{style:{color:P.color},children:P.label})," (",P.meaning,"). In the Hermetic tradition, each of the 22 paths is governed by a Major Arcana and a Hebrew letter. Attribution: ",v.attribution,"."]}),a.jsxs("div",{style:T,children:[a.jsx("div",{style:{fontSize:7,color:"rgba(220,185,80,0.7)",marginBottom:3},children:" Lightning Flash on this Path"}),a.jsxs("div",{style:C,children:["Light descends from ",a.jsx("b",{style:{color:"rgba(200,185,165,0.7)"},children:_.label})," to ",a.jsx("b",{style:{color:"rgba(200,185,165,0.7)"},children:P.label}),". The arcanum ",a.jsx("b",{style:{color:"rgba(210,185,255,0.8)"},children:S.name})," regulates the quality of this transmission."]})]}),a.jsxs("div",{style:j,children:[a.jsx("div",{style:{fontSize:7,color:"rgba(160,90,255,0.8)",marginBottom:3},children:" Serpent of Wisdom on this Path"}),a.jsxs("div",{style:C,children:["When the Serpent is active, violet particles ascend from ",a.jsx("b",{style:{color:"rgba(200,185,165,0.7)"},children:P.label})," to ",a.jsx("b",{style:{color:"rgba(200,185,165,0.7)"},children:_.label}),"  the light returns purified by experience. As Above, So Below."]})]}),a.jsxs("div",{style:k,children:["Arcanum  ",S.name]}),a.jsxs("div",{style:R,children:[a.jsx("div",{style:{fontSize:7.5,color:"rgba(220,210,195,0.75)",marginBottom:3},children:S.keywords.join("  ")}),a.jsx("div",{style:{fontSize:7,color:"rgba(180,165,145,0.55)"},children:S.microNote})]}),a.jsx("div",{style:k,children:"Magical Operator"}),a.jsxs("div",{style:{...R,borderColor:"rgba(255,200,80,0.2)",background:"rgba(180,140,30,0.04)"},children:[a.jsxs("div",{style:{fontSize:8,color:"rgba(220,190,90,0.8)",marginBottom:2},children:[b.operator.primary,b.operator.secondary?` + ${b.operator.secondary}`:""]}),a.jsxs("div",{style:{fontSize:7,color:"rgba(180,165,145,0.55)"},children:["Reversed: ",b.operator.reversed.primary]})]})]})}return a.jsxs("div",{children:[a.jsxs("div",{style:{padding:"8px 10px",borderRadius:7,marginBottom:8,background:l.greatWorkPulse>.3?"linear-gradient(135deg, rgba(180,120,30,0.08), rgba(120,40,200,0.08))":"rgba(255,255,255,0.02)",border:l.greatWorkPulse>.3?"1px solid rgba(180,120,255,0.25)":"1px solid rgba(255,255,255,0.05)",transition:"all 0.5s"},children:[a.jsx("div",{style:{fontSize:7,color:"rgba(200,175,255,0.5)",letterSpacing:"0.12em",textTransform:"uppercase",marginBottom:5},children:"State of Light"}),a.jsxs("div",{style:{display:"flex",gap:8,marginBottom:5},children:[a.jsxs("div",{style:{flex:1,textAlign:"center"},children:[a.jsx("div",{style:{fontSize:8,color:"rgba(220,185,80,0.7)",marginBottom:2},children:" Lightning Flash"}),a.jsxs("div",{style:{fontSize:14,color:"#ffe080",fontFamily:"monospace"},children:[Math.round(l.lightningFlashLevel*100),"%"]})]}),a.jsx("div",{style:{width:1,background:"rgba(255,255,255,0.06)"}}),a.jsxs("div",{style:{flex:1,textAlign:"center"},children:[a.jsx("div",{style:{fontSize:8,color:"rgba(160,90,255,0.7)",marginBottom:2},children:" Serpent"}),a.jsxs("div",{style:{fontSize:14,color:"#c080ff",fontFamily:"monospace"},children:[Math.round(l.level*100),"%"]})]}),a.jsx("div",{style:{width:1,background:"rgba(255,255,255,0.06)"}}),a.jsxs("div",{style:{flex:1,textAlign:"center"},children:[a.jsx("div",{style:{fontSize:8,color:"rgba(200,160,255,0.7)",marginBottom:2},children:" Great Work"}),a.jsxs("div",{style:{fontSize:14,color:l.greatWorkPulse>.3?"#e8c0ff":"rgba(200,185,165,0.3)",fontFamily:"monospace"},children:[Math.round(l.greatWorkPulse*100),"%"]})]})]}),l.greatWorkPulse<.1&&a.jsx("div",{style:{fontSize:7,color:"rgba(170,155,140,0.35)",textAlign:"center"},children:"Raise Malkuth to awaken the Serpent of Wisdom "}),l.greatWorkPulse>.3&&a.jsx("div",{style:{fontSize:7.5,color:"rgba(210,170,255,0.8)",textAlign:"center"},children:" The Great Work  Magnum Opus in progress"})]}),a.jsxs("div",{style:{padding:"6px 8px",borderRadius:5,marginBottom:8,background:"rgba(180,120,255,0.06)",border:"1px solid rgba(180,120,255,0.15)"},children:[a.jsx("div",{style:{fontSize:7,color:"rgba(200,175,255,0.6)",letterSpacing:"0.1em",textTransform:"uppercase",marginBottom:5},children:"How to Play"}),[["1","Click a Sephirah or path to explore its meaning"],["2","Draw cards and apply them to modulate the flows"],["3","Observe the Lightning Flash (gold ) and Serpent (violet )"],["4","Raise Malkuth to activate the Serpent of Wisdom  the ascent"],["","Seek equilibrium: The Great Work"]].map(([_,P])=>a.jsxs("div",{style:{display:"flex",gap:6,marginBottom:3,alignItems:"flex-start"},children:[a.jsx("span",{style:{fontSize:7,color:"rgba(180,120,255,0.5)",width:12,flexShrink:0,marginTop:.5},children:_}),a.jsx("span",{style:{fontSize:7,color:"rgba(200,190,175,0.65)",lineHeight:1.4},children:P})]},_))]}),a.jsxs("div",{style:{marginBottom:6},children:[a.jsxs("button",{title:d?"Ocultar Luz & Lore":"Luz & Lore",onClick:()=>h(!d),style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"5px 8px",borderRadius:5,cursor:"pointer",background:"rgba(180,120,60,0.06)",border:"1px solid rgba(220,185,80,0.15)",color:"rgba(220,185,80,0.7)",fontSize:7.5,letterSpacing:"0.08em"},children:[a.jsx("span",{children:" Lightning Flash & Serpent  The Cycle of Light"}),d?a.jsx(Pa,{size:10}):a.jsx(aa,{size:10})]}),d&&a.jsx("div",{style:{padding:"6px 8px",background:"rgba(0,0,0,0.2)",borderRadius:"0 0 5px 5px",border:"1px solid rgba(220,185,80,0.1)",borderTop:"none"},children:[gZ,yZ,xZ,bZ].map((_,P)=>a.jsxs("div",{style:{marginBottom:P<3?8:0},children:[a.jsx("div",{style:{fontSize:7.5,color:P<2?"rgba(220,185,80,0.8)":P===2?"rgba(160,90,255,0.8)":"rgba(200,160,255,0.8)",marginBottom:3},children:_.title}),a.jsx("div",{style:{fontSize:7,color:"rgba(190,180,165,0.65)",lineHeight:1.5},children:_.text})]},P))})]}),a.jsxs("div",{style:{marginBottom:6},children:[a.jsxs("button",{title:u?"Ocultar Mundos":"Mundos",onClick:()=>c(!u),style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"5px 8px",borderRadius:5,cursor:"pointer",background:"rgba(80,120,200,0.06)",border:"1px solid rgba(100,150,220,0.15)",color:"rgba(120,170,255,0.7)",fontSize:7.5,letterSpacing:"0.08em"},children:[a.jsx("span",{children:" The Four Worlds (Hermetic Planes)"}),u?a.jsx(Pa,{size:10}):a.jsx(aa,{size:10})]}),u&&a.jsx("div",{style:{padding:"6px 8px",background:"rgba(0,0,0,0.2)",borderRadius:"0 0 5px 5px",border:"1px solid rgba(100,150,220,0.1)",borderTop:"none"},children:vZ.map((_,P)=>a.jsxs("div",{style:{marginBottom:P<3?8:0},children:[a.jsxs("div",{style:{display:"flex",gap:5,alignItems:"baseline",marginBottom:2},children:[a.jsx("span",{style:{fontSize:8,color:"rgba(200,185,165,0.85)"},children:_.name}),a.jsx("span",{style:{fontSize:7,color:"rgba(180,120,255,0.5)"},children:_.heb}),a.jsxs("span",{style:{fontSize:6.5,color:"rgba(160,150,135,0.5)"},children:[" ",_.meaning]})]}),a.jsxs("div",{style:{fontSize:6.5,color:"rgba(160,145,130,0.5)",marginBottom:2},children:["Sephiroth: ",_.sephirot]}),a.jsx("div",{style:{fontSize:7,color:"rgba(190,180,165,0.6)",lineHeight:1.45},children:_.desc})]},_.name))})]}),a.jsxs("div",{style:{padding:"6px 8px",borderRadius:5,marginBottom:8,background:"rgba(255,255,255,0.02)",border:"1px solid rgba(255,255,255,0.05)"},children:[a.jsx("div",{style:{fontSize:7,color:"rgba(200,175,255,0.45)",letterSpacing:"0.1em",textTransform:"uppercase",marginBottom:5},children:"Current State"}),a.jsx(CZ,{snap:r,params:o,serpent:l})]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginBottom:5,cursor:"pointer"},onClick:()=>g(_=>!_),children:[a.jsx("div",{style:{fontSize:7,color:"rgba(200,175,255,0.4)",letterSpacing:"0.1em",textTransform:"uppercase",flex:1},children:"Events"}),f?a.jsx(Pa,{size:9,color:"rgba(180,120,255,0.4)"}):a.jsx(aa,{size:9,color:"rgba(180,120,255,0.4)"})]}),f&&a.jsxs(a.Fragment,{children:[s.length===0&&a.jsx("div",{style:{fontSize:7.5,color:"rgba(170,155,140,0.3)"},children:"No events yet. Play cards to activate."}),[...s].reverse().slice(0,12).map(_=>a.jsxs("div",{style:{marginBottom:5,padding:"4px 7px",borderRadius:4,background:"rgba(255,255,255,0.025)",borderLeft:`2px solid ${_.kind==="DISSOLUTION"?"#60c0ff":_.kind==="CRYSTALLIZATION"?"#ffd060":_.kind==="VEIL_BREACH"?"#ff6040":_.kind==="GREAT_WORK_PULSE"?"#e0c0ff":_.kind==="GRADE_ADVANCEMENT"?"#50d080":_.kind==="QLIPHOTIC_WARNING"?"#ff4040":"rgba(180,120,255,0.4)"}`},children:[a.jsx("div",{style:{fontSize:6,color:"rgba(180,120,255,0.5)",marginBottom:1},children:_.kind}),a.jsx("div",{style:{fontSize:7.5,color:"rgba(210,200,185,0.65)",lineHeight:1.4},children:_.description})]},_.id))]}),a.jsxs("div",{style:{fontSize:6.5,color:"rgba(160,145,130,0.25)",marginTop:10,textAlign:"center",lineHeight:1.6},children:["Click any Sephirah or path",a.jsx("br",{}),"to explore its spiritual meaning"]})]})}function CZ({snap:e,params:t,serpent:r}){const o=[];return e.coherence>.6&&o.push({text:" High coherence  Lightning Flash flowing well."}),e.coherence<.25&&o.push({text:" Low coherence  system dispersed."}),e.tension>.55&&o.push({text:" High tension  risk of CRYSTALLIZATION."}),e.tension<.15&&o.push({text:" Minimal tension  system stable."}),e.memory>.5&&o.push({text:" High memory  patterns consolidated."}),e.openness>.65&&o.push({text:" High openness  paths easily traversed."}),t.veilsEnabled&&o.push({text:" Veils active  coherence required for upper gates."}),r.level>.3&&o.push({text:" Serpent of Wisdom active  light ascending.",color:"#c080ff"}),r.greatWorkPulse>.4&&o.push({text:" The Great Work  Magnum Opus in progress!",color:"#e0c0ff"}),o.length||o.push({text:"System in neutral state. Play cards to begin."}),a.jsx(a.Fragment,{children:o.map((s,l)=>a.jsx("div",{style:{fontSize:7.5,color:s.color??"rgba(200,190,175,0.65)",lineHeight:1.45,marginBottom:2},children:s.text},l))})}function MZ(e,t,r,o,s,l,i,u,c,d,h,f,g,m){if(!e)return;const y=e.getContext("2d");if(!y)return;const v=e.width,b=e.height,S=t.time;y.fillStyle="#050210",y.fillRect(0,0,v,b);const C=y.createRadialGradient(v/2,b/2,0,v/2,b/2,Math.max(v,b)*.7);if(C.addColorStop(0,"rgba(20,10,60,0.4)"),C.addColorStop(.5,"rgba(8,4,30,0.3)"),C.addColorStop(1,"rgba(0,0,0,0)"),y.fillStyle=C,y.fillRect(0,0,v,b),c.greatWorkPulse>.2){const k=y.createRadialGradient(v/2,b/2,0,v/2,b/2,Math.max(v,b)*.5);k.addColorStop(0,`rgba(160,80,255,${c.greatWorkPulse*.06})`),k.addColorStop(1,"rgba(0,0,0,0)"),y.fillStyle=k,y.fillRect(0,0,v,b)}y.save();for(let k=0;k<120;k++){const R=(k*18731+5)%v,j=(k*37311+17)%b,T=.04+k%7*.015+Math.sin(S*.5+k)*.01;y.fillStyle=`rgba(220,215,255,${T})`,y.fillRect(R,j,1.2,1.2)}if(y.restore(),y.save(),y.translate(v/2+o.px,b/2+o.py),y.scale(o.zoom,o.zoom),m.pillars&&r.pillarsEnabled){const k=[[-200,0,200,"rgba(180,40,40,0.06)"],[200,0,200,"rgba(40,80,200,0.06)"],[0,0,160,"rgba(200,170,60,0.05)"]];for(const[R,j,T,_]of k){const P=y.createRadialGradient(R,j,0,R,j,T*3);P.addColorStop(0,_),P.addColorStop(1,"rgba(0,0,0,0)"),y.fillStyle=P,y.fillRect(-Mg,-kg*.6,Mg*2,kg*1.2)}}if(m.paths)for(const k of Od){const R=li.get(k.from),j=li.get(k.to);if(!R||!j)continue;const T=yl(R.nx),_=xl(R.ny),P=yl(j.nx),I=xl(j.ny),$=X7(T,_,P,I),q=t.paths.get(k.pathId);if(!q)continue;const L=q.flow,H=q.blockage,G=h===k.pathId,oe=g.get(k.pathId)??99,le=Math.max(0,1-oe/2),[pe,ce,te]=pZ(R.pillar,j.pillar);y.save();const F=()=>{y.beginPath(),y.moveTo(T,_),y.quadraticCurveTo($.x,$.y,P,I),y.stroke()};y.strokeStyle=`rgba(${pe},${ce},${te},${.04+L*.06+le*.12})`,y.lineWidth=12+le*8,y.filter="blur(4px)",F(),y.filter="none",y.strokeStyle=`rgba(${pe},${ce},${te},${.08+L*.12+le*.2})`,y.lineWidth=4,F(),H>.3&&y.setLineDash([5,5]),y.strokeStyle=G?`rgba(255,220,80,${.4+L*.4})`:`rgba(${pe},${ce},${te},${.2+L*.4+le*.3})`,y.lineWidth=G?2:.6+L*1.4,F(),y.setLineDash([]),m.orChozer&&c.level>.15&&(y.strokeStyle=`rgba(140,60,255,${c.level*.06*L})`,y.lineWidth=6,y.filter="blur(2px)",F(),y.filter="none");const Q=V5(.5,T,_,$.x,$.y,P,I);y.fillStyle=`rgba(${pe},${ce},${te},${.3+L*.25})`,y.font=`${Math.round(10+L*3)}px serif`,y.textAlign="center",y.textBaseline="middle";const ae=Yc.get(k.arcanaId);if(ae&&y.fillText(ae.hebrewLetter,Q.x,Q.y),m.orYashar){const we=i.get(k.pathId)??[];for(const Re of we){const ge=V5(Re.t,T,_,$.x,$.y,P,I),Ae=Math.min(Re.t*5,(1-Re.t)*5,1),tt=Re.energy*Ae,We=Re.size*(1+H*.5);y.filter="blur(3px)";const J=y.createRadialGradient(ge.x,ge.y,0,ge.x,ge.y,We*3);J.addColorStop(0,`rgba(${pe},${ce},${te},${tt*.5})`),J.addColorStop(1,`rgba(${pe},${ce},${te},0)`),y.fillStyle=J,y.beginPath(),y.arc(ge.x,ge.y,We*3,0,io),y.fill(),y.filter="none",y.fillStyle=`rgba(${pe+60},${ce+60},${te+60},${tt})`,y.beginPath(),y.arc(ge.x,ge.y,We,0,io),y.fill()}}if(m.orChozer){const we=u.get(k.pathId)??[];for(const Re of we){const ge=V5(1-Re.t,T,_,$.x,$.y,P,I),Ae=Math.min(Re.t*5,(1-Re.t)*5,1),tt=Re.energy*Ae*c.level,We=Re.size;y.filter="blur(3px)";const J=y.createRadialGradient(ge.x,ge.y,0,ge.x,ge.y,We*3.5);J.addColorStop(0,`rgba(160,80,255,${tt*.6})`),J.addColorStop(1,"rgba(100,40,200,0)"),y.fillStyle=J,y.beginPath(),y.arc(ge.x,ge.y,We*3.5,0,io),y.fill(),y.filter="none",y.fillStyle=`rgba(200,140,255,${tt})`,y.beginPath(),y.arc(ge.x,ge.y,We*.8,0,io),y.fill(),y.fillStyle=`rgba(240,220,255,${tt*.6})`,y.beginPath(),y.arc(ge.x,ge.y,We*.3,0,io),y.fill()}}y.restore()}if(m.sephiroth)for(const k of Md){const R=yl(k.nx),j=xl(k.ny),T=t.sephirot.get(k.id),_=d===k.id,P=f.get(k.id)??99,I=Math.max(0,1-P/2.5),$=k.color,[q,L,H]=[parseInt($.slice(1,3),16),parseInt($.slice(3,5),16),parseInt($.slice(5,7),16)],G=k.id==="malkuth",oe=k.id==="kether";if(y.save(),m.aura&&G&&c.level>.2){const pe=eo*(4+c.level*4);y.filter="blur(8px)";const ce=y.createRadialGradient(R,j,eo,R,j,pe);ce.addColorStop(0,`rgba(140,60,220,${c.level*.3})`),ce.addColorStop(1,"rgba(100,30,180,0)"),y.fillStyle=ce,y.beginPath(),y.arc(R,j,pe,0,io),y.fill(),y.filter="none"}if(m.aura&&oe&&c.level>.4){const pe=c.greatWorkPulse;y.filter="blur(6px)";const ce=y.createRadialGradient(R,j,eo,R,j,eo*5);ce.addColorStop(0,`rgba(200,160,255,${pe*.25})`),ce.addColorStop(1,"rgba(180,120,255,0)"),y.fillStyle=ce,y.beginPath(),y.arc(R,j,eo*5,0,io),y.fill(),y.filter="none"}if(m.aura){const pe=eo*(3+T.charge*3+I*2),ce=y.createRadialGradient(R,j,eo*.5,R,j,pe);ce.addColorStop(0,`rgba(${q},${L},${H},${T.charge*.25+I*.35})`),ce.addColorStop(.4,`rgba(${q},${L},${H},${T.charge*.08})`),ce.addColorStop(1,"rgba(0,0,0,0)"),y.fillStyle=ce,y.filter="blur(2px)",y.beginPath(),y.arc(R,j,pe,0,io),y.fill(),y.filter="none"}if(m.particles){const pe=l.get(k.id)??[];for(const ce of pe){const te=R+Math.cos(ce.angle)*ce.radius,F=j+Math.sin(ce.angle)*ce.radius;y.fillStyle=`rgba(${q+40},${L+40},${H+40},${ce.alpha*T.charge})`,y.beginPath(),y.arc(te,F,1.5+T.charge*1.5,0,io),y.fill()}}const le=y.createRadialGradient(R-eo*.25,j-eo*.25,2,R,j,eo);if(le.addColorStop(0,`rgba(${q},${L},${H},${.35+T.charge*.35+I*.2})`),le.addColorStop(1,`rgba(${q},${L},${H},${.06+T.charge*.1})`),y.fillStyle=le,y.beginPath(),y.arc(R,j,eo,0,io),y.fill(),T.tension>.1){const pe=.4+Math.sin(S*4+k.num)*.3;y.strokeStyle=`rgba(220,60,40,${T.tension*pe})`,y.lineWidth=1,y.beginPath(),y.arc(R,j,eo*(.8+T.tension*.4),0,io),y.stroke()}if(T.coherence>.1&&(y.strokeStyle=`rgba(80,180,255,${T.coherence*.4})`,y.lineWidth=.8,y.beginPath(),y.arc(R,j,eo*1.15,0,io*T.coherence),y.stroke()),G&&c.level>.1){const pe=.5+Math.sin(S*2)*.3;y.strokeStyle=`rgba(160,80,255,${c.level*pe*.8})`,y.lineWidth=1.5+c.level*1.5,y.beginPath(),y.arc(R,j,eo*1.3,0,io),y.stroke()}if(oe&&c.greatWorkPulse>.2){const pe=.5+Math.sin(S*1.5)*.4;y.strokeStyle=`rgba(200,150,255,${c.greatWorkPulse*pe*.9})`,y.lineWidth=2,y.beginPath(),y.arc(R,j,eo*1.5,0,io),y.stroke()}I>0&&(y.strokeStyle=`rgba(255,220,80,${I*.7})`,y.lineWidth=2+I*2,y.beginPath(),y.arc(R,j,eo*(1+I*.5),0,io),y.stroke()),_&&(y.strokeStyle="rgba(255,220,80,0.9)",y.lineWidth=2.5,y.beginPath(),y.arc(R,j,eo+3,0,io),y.stroke()),y.strokeStyle=_?"rgba(255,220,80,0.5)":`rgba(${q},${L},${H},${.3+T.coherence*.4})`,y.lineWidth=_?1.5:.8,y.beginPath(),y.arc(R,j,eo,0,io),y.stroke(),y.fillStyle=`rgba(240,235,220,${.6+T.coherence*.3})`,y.font=`${Math.round(eo*.52)}px system-ui`,y.textAlign="center",y.textBaseline="middle",y.fillText(k.label,R,j),y.fillStyle=`rgba(${q+30},${L+30},${H+30},0.4)`,y.font=`${Math.round(eo*.42)}px serif`,y.fillText(k.num.toString(),R,j+eo*1.4),y.restore()}for(const k of s){const R=Math.max(0,1-k.age/k.life),j=k.age/k.life;if(y.save(),k.kind==="ripple")y.strokeStyle=k.color+Math.round(R*255).toString(16).padStart(2,"0"),y.lineWidth=2*R,y.beginPath(),y.arc(k.wx,k.wy,k.r*j,0,io),y.stroke(),j>.3&&(y.strokeStyle=k.color+Math.round(R*.5*255).toString(16).padStart(2,"0"),y.lineWidth=1,y.beginPath(),y.arc(k.wx,k.wy,k.r*j*1.6,0,io),y.stroke());else if(k.kind==="burst"){for(let _=0;_<12;_++){const P=_/12*io+j,I=k.r*.3,$=k.r*j;y.strokeStyle=k.color+Math.round(R*200).toString(16).padStart(2,"0"),y.lineWidth=1.5*R,y.beginPath(),y.moveTo(k.wx+Math.cos(P)*I,k.wy+Math.sin(P)*I),y.lineTo(k.wx+Math.cos(P)*$,k.wy+Math.sin(P)*$),y.stroke()}y.filter="blur(3px)";const T=y.createRadialGradient(k.wx,k.wy,0,k.wx,k.wy,k.r*.5);T.addColorStop(0,k.color+Math.round(R*180).toString(16).padStart(2,"0")),T.addColorStop(1,k.color+"00"),y.fillStyle=T,y.beginPath(),y.arc(k.wx,k.wy,k.r*.5,0,io),y.fill(),y.filter="none"}else if(k.kind==="flash")y.filter="blur(8px)",y.fillStyle=k.color+Math.round(R*180).toString(16).padStart(2,"0"),y.beginPath(),y.arc(k.wx,k.wy,k.r*.8,0,io),y.fill(),y.filter="none";else if(k.kind==="dissolve")for(let T=0;T<8;T++){const _=T/8*io,P=k.r*.7*j,I=Math.cos(_)*P,$=Math.sin(_)*P;y.fillStyle=k.color+Math.round(R*180).toString(16).padStart(2,"0"),y.beginPath(),y.arc(k.wx+I,k.wy+$,3*R,0,io),y.fill()}y.restore()}if(y.restore(),m.pillars&&r.pillarsEnabled&&(y.save(),y.font="9px system-ui",y.textAlign="center",y.fillStyle="rgba(180,40,40,0.20)",y.save(),y.translate(18,b/2),y.rotate(-Math.PI/2),y.fillText("SEVERITY",0,0),y.restore(),y.fillStyle="rgba(40,80,200,0.20)",y.save(),y.translate(v-18,b/2),y.rotate(Math.PI/2),y.fillText("MERCY",0,0),y.restore(),y.restore()),c.level>.05){y.save();const k=80,R=4,j=v-k-12,T=b-14;y.fillStyle="rgba(0,0,0,0.4)",y.fillRect(j-2,T-2,k+4,R+4),y.fillStyle=`rgba(140,60,220,${c.level*.6})`,y.fillRect(j,T,k*c.level,R),y.fillStyle=`rgba(200,150,255,${c.level*.9})`,y.font="7px system-ui",y.textAlign="right",y.fillText(` Serpent ${Math.round(c.level*100)}%`,v-12,T-4),y.restore()}}function Wl(){return a.jsx("div",{style:{height:1,background:"rgba(255,255,255,0.04)",margin:"3px 0"}})}function od({label:e,hint:t,children:r}){return a.jsxs("div",{style:{padding:"6px 10px 4px"},title:t,children:[a.jsx("div",{style:{fontSize:6.5,color:"rgba(180,120,255,0.4)",letterSpacing:"0.14em",textTransform:"uppercase",marginBottom:5},children:e}),r]})}function kZ({label:e,desc:t,active:r,onClick:o}){return a.jsxs("button",{title:e,onClick:o,style:{display:"flex",flexDirection:"column",width:"100%",padding:"4px 8px",marginBottom:2,borderRadius:4,cursor:"pointer",textAlign:"left",background:r?"rgba(180,120,255,0.12)":"rgba(255,255,255,0.025)",border:`1px solid ${r?"rgba(180,120,255,0.35)":"rgba(255,255,255,0.05)"}`,color:r?"rgba(210,185,255,0.95)":"rgba(175,160,145,0.45)"},children:[a.jsx("span",{style:{fontSize:8.5,letterSpacing:"0.05em"},children:e}),a.jsx("span",{style:{fontSize:6,opacity:.5,letterSpacing:"0.04em",lineHeight:1.3},children:t})]})}function If({label:e,value:t,onChange:r,display:o}){return a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginBottom:4},children:[a.jsx("span",{style:{fontSize:6.5,color:"rgba(185,175,160,0.45)",width:58,textTransform:"uppercase",letterSpacing:"0.07em"},children:e}),a.jsx("input",{type:"range",min:0,max:1,step:.01,value:t,onChange:s=>r(parseFloat(s.target.value)),style:{flex:1,height:2,accentColor:"rgba(180,120,255,0.8)",cursor:"pointer"}}),a.jsx("span",{style:{fontSize:6.5,color:"rgba(185,175,160,0.4)",width:28,textAlign:"right"},children:o??t.toFixed(2)})]})}function iC({label:e,active:t,hint:r,onChange:o}){return a.jsxs("div",{title:r,style:{display:"flex",alignItems:"center",gap:6,marginBottom:4,cursor:"pointer"},onClick:()=>o(!t),children:[a.jsx("div",{style:{width:22,height:12,borderRadius:6,position:"relative",background:t?"rgba(180,120,255,0.6)":"rgba(255,255,255,0.1)",transition:"background 0.2s"},children:a.jsx("div",{style:{position:"absolute",top:2,left:t?12:2,width:8,height:8,borderRadius:"50%",background:"white",transition:"left 0.2s"}})}),a.jsx("span",{style:{fontSize:7.5,textTransform:"uppercase",letterSpacing:"0.08em",color:t?"rgba(210,185,255,0.8)":"rgba(175,160,145,0.4)"},children:e})]})}function w5({label:e,v:t,c:r}){return a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginBottom:3},children:[a.jsx("span",{style:{fontSize:6.5,color:"rgba(185,175,160,0.45)",width:52,textTransform:"uppercase",letterSpacing:"0.06em"},children:e}),a.jsx("div",{style:{flex:1,height:3,background:"rgba(255,255,255,0.06)",borderRadius:2},children:a.jsx("div",{style:{width:`${Math.round(t*100)}%`,height:"100%",background:r,borderRadius:2,transition:"width 0.4s"}})}),a.jsxs("span",{style:{fontSize:6.5,color:"rgba(185,175,160,0.4)",width:24,textAlign:"right"},children:[Math.round(t*100),"%"]})]})}function xx({onClick:e,c:t,children:r}){return a.jsx("button",{title:label,onClick:e,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:4,padding:"4px 5px",borderRadius:4,cursor:"pointer",fontSize:8,textTransform:"uppercase",letterSpacing:"0.07em",background:`${t}15`,border:`1px solid ${t}40`,color:t},children:r})}function bx({label:e,delta:t,invert:r=!1}){const s=(r?t<0:t>0)?"#50b870":"#b05050";return Math.abs(t)<.005?null:a.jsxs("span",{style:{fontSize:6,padding:"1px 4px",borderRadius:3,background:`${s}15`,border:`1px solid ${s}35`,color:s},children:[e," ",t>0?"+":"",(t*100).toFixed(0),"%"]})}function RZ({ar:e,ld:t,reversed:r}){const s={logical:"#60c0ff",imaginal:"#c090ff",ritual:"#ffd060"}[t.tone]??"#b0a8c0";return a.jsxs("div",{style:{padding:"6px 4px",textAlign:"center",background:"linear-gradient(155deg, rgba(18,12,38,0.95), rgba(8,5,20,0.98))",minHeight:88,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:3,transform:r?"rotate(180deg)":"none"},children:[a.jsx("div",{style:{fontSize:22,color:s,lineHeight:1,filter:`drop-shadow(0 0 4px ${s}80)`},children:e.symbol}),a.jsx("div",{style:{fontSize:6.5,color:"rgba(225,215,200,0.88)",lineHeight:1.2,fontWeight:500},children:t.name}),a.jsx("div",{style:{fontSize:5.5,color:"rgba(180,165,200,0.5)",lineHeight:1.3},children:t.keywords.join(`
`)}),r&&a.jsx("div",{style:{fontSize:5,color:"rgba(255,90,70,0.6)",letterSpacing:"0.08em"},children:"INV"})]})}const fi=64;function vx(){return{organismo:.5,intensidade:.5,hierarquia:.5,rigidez:.5,desorganizacao:.3,crueldade:.5,antiHabito:.3,multiplicidade:.3,linhasDeFuga:.3,territorializacao:.5,reterritorializacao:.3,hubs:.3,esquecimento:.2,ruido:.25,densidade:.5}}function AZ(e){return Math.min(1,Math.max(0,(1-e.organismo)*.25+e.intensidade*.15+e.desorganizacao*.2+(1-e.hierarquia)*.15+e.linhasDeFuga*.1+e.ruido*.1+e.antiHabito*.05))}function jZ(e){return{organismo:.85-e*.75,intensidade:.15+e*.75,hierarquia:.8-e*.7,rigidez:.75-e*.6,desorganizacao:.05+e*.8,crueldade:.6-e*.3,antiHabito:.05+e*.7,multiplicidade:.1+e*.6,linhasDeFuga:.05+e*.75,territorializacao:.7-e*.45,reterritorializacao:.5-e*.3,hubs:.5-e*.3,esquecimento:.1+e*.4,ruido:.1+e*.45,densidade:.5}}function J7(e){return Math.min(1,Math.max(0,e.organismo*.35+e.hierarquia*.3+e.rigidez*.2+(1-e.desorganizacao)*.15))}function EZ(){const e=fi*fi;return{consistency:new Float32Array(e),territory:new Float32Array(e),size:fi}}const Sx=[{id:"select",icon:"",label:"Selecionar",color:"#94a3b8",desc:"Inspecionar qualquer elemento"},{id:"arrastar",icon:"",label:"Arrastar",color:"#e2e8f0",desc:"Arrastar orgaos, nos, zonas"},{id:"criarIntensidade",icon:"",label:"Criar Afetos",color:"#fbbf24",desc:"Criar particulas de intensidade"},{id:"criarOrgao",icon:"",label:"Criar Orgao",color:"#60a5fa",desc:"Adicionar orgao ao corpo"},{id:"criarNoRizoma",icon:"",label:"Criar No",color:"#34d399",desc:"Adicionar no ao rizoma"},{id:"criarEntrada",icon:"",label:"Criar Entrada",color:"#6ee7b7",desc:"Adicionar portal de entrada"},{id:"criarZona",icon:"",label:"Criar Zona",color:"#a78bfa",desc:"Criar zona de afeto"},{id:"remover",icon:"",label:"Remover",color:"#ef4444",desc:"Remover orgao/no/zona mais proximo"},{id:"empurrar",icon:"",label:"Empurrar",color:"#f472b6",desc:"Empurrar tudo para fora"},{id:"puxar",icon:"",label:"Puxar",color:"#a78bfa",desc:"Atrair tudo para o cursor"},{id:"sopro",icon:"",label:"Sopro",color:"#fbbf24",desc:"Injetar ruido local"},{id:"selo",icon:"",label:"Selo",color:"#34d399",desc:"Aumentar traco territorial"},{id:"rasura",icon:"",label:"Rasura",color:"#ef4444",desc:"Apagar campos localmente"},{id:"fuga",icon:"",label:"Fuga",color:"#a78bfa",desc:"Burst de fuga"},{id:"gradiente",icon:"",label:"Gradiente",color:"#60a5fa",desc:"Pintar plano de consistencia"}];function TZ(){return{fps:60,nAffects:0,nOrgans:0,nRhizomeNodes:0,nRhizomeEdges:0,hubDominance:0,plateauScore:0,plateauLabel:"Indeterminado",fieldEntropy:.5,memoryLoad:0,K:.5,meanIntensity:.5,ruptureRate:0,crueltyPressure:0}}const fh=Math.PI*2,Db=28,lC=400;function IZ(e){const t=[],r=8+Math.round(e.organismo*12),o={v:0};for(let u=0;u<r;u++){const c=u/r*fh,d=.15+Math.random()*.35;t.push({id:o.v++,x:Math.cos(c)*d,y:Math.sin(c)*d,vx:0,vy:0,radius:.03+Math.random()*.04,importance:.3+Math.random()*.7,connections:[],hue:200+u/r*50,health:.8+Math.random()*.2})}for(let u=0;u<r;u++){const c=(u+1)%r;if(t[u].connections.includes(t[c].id)||(t[u].connections.push(t[c].id),t[c].connections.push(t[u].id)),e.hierarquia>.3&&Math.random()<e.hierarquia*.3){const d=Math.floor(Math.random()*r);d!==u&&!t[u].connections.includes(t[d].id)&&(t[u].connections.push(t[d].id),t[d].connections.push(t[u].id))}}const s=50+Math.round(e.densidade*200),l=[];for(let u=0;u<s;u++){const c=Math.random()*fh,d=.1+Math.random()*.5,h=Math.cos(c)*d,f=Math.sin(c)*d;l.push({x:h,y:f,vx:(Math.random()-.5)*.005,vy:(Math.random()-.5)*.005,intensity:.3+Math.random()*.5,hue:Math.random()*360,phase:Math.random()*fh,life:600+Math.floor(Math.random()*1200),trailX:new Array(Db).fill(h),trailY:new Array(Db).fill(f)})}const i=[];for(let u=0;u<3;u++)i.push({x:(Math.random()-.5)*.8,y:(Math.random()-.5)*.8,vx:(Math.random()-.5)*.002,vy:(Math.random()-.5)*.002,radius:.15+Math.random()*.15,strength:.3+Math.random()*.5,hue:u*120,pulse:Math.random()*fh});return{organs:t,affects:l,zones:i,events:[],nextId:o.v,crueltyAccum:0,ruptureCount:0}}function PZ(e,t,r,o,s){s=Math.min(s,.04);const{organs:l,affects:i,zones:u,events:c}=e,d=new Map;for(const y of l)d.set(y.id,y);for(const y of l){let v=0,b=0;for(const C of y.connections){const k=d.get(C);if(!k)continue;const R=k.x-y.x,j=k.y-y.y,T=Math.sqrt(R*R+j*j)+.001,_=.12+(1-t.rigidez)*.15,P=(T-_)*t.rigidez*2;v+=R/T*P,b+=j/T*P}for(const C of l){if(C.id===y.id)continue;const k=C.x-y.x,R=C.y-y.y,j=k*k+R*R;if(j<.04&&j>1e-6){const T=Math.sqrt(j);v-=k/T*.08/(T+.01),b-=R/T*.08/(T+.01)}}t.ruido>.01&&(v+=Math.sin(o*.8+y.id*2.1)*t.ruido*.02,b+=Math.cos(o*.8+y.id*1.7)*t.ruido*.02),y.health=Math.max(.05,y.health-t.desorganizacao*.002*s+t.organismo*.001*s),y.health=Math.min(1,y.health),y.vx=(y.vx+v*s)*.96,y.vy=(y.vy+b*s)*.96;const S=Math.sqrt(y.vx*y.vx+y.vy*y.vy);S>.004&&(y.vx=y.vx/S*.004,y.vy=y.vy/S*.004),y.x+=y.vx,y.y+=y.vy,y.x=Math.max(-.9,Math.min(.9,y.x)),y.y=Math.max(-.9,Math.min(.9,y.y))}if(t.desorganizacao>.1&&Math.random()<t.desorganizacao*.02*s){const y=Math.floor(Math.random()*l.length),v=l[y];if(v&&v.connections.length>1){const b=Math.floor(Math.random()*v.connections.length),S=v.connections[b];v.connections.splice(b,1);const C=d.get(S);if(C){const k=C.connections.indexOf(v.id);k>=0&&C.connections.splice(k,1)}if(t.antiHabito>.2&&Math.random()<t.antiHabito){const k=l.filter(R=>R.id!==v.id&&!v.connections.includes(R.id));if(k.length>0){const R=k[Math.floor(Math.random()*k.length)];v.connections.push(R.id),R.connections.push(v.id),c.push({time:o,x:(v.x+R.x)*.5,y:(v.y+R.y)*.5,type:"reconexao",message:"Reconexo anti-hbito",color:"#a78bfa",ttl:120})}}}}for(const y of u)y.pulse+=s*2,y.x+=y.vx,y.y+=y.vy,(y.x<-.85||y.x>.85)&&(y.vx*=-1),(y.y<-.85||y.y>.85)&&(y.vy*=-1),y.x=Math.max(-.9,Math.min(.9,y.x)),y.y=Math.max(-.9,Math.min(.9,y.y)),y.vx+=(Math.random()-.5)*5e-4,y.vy+=(Math.random()-.5)*5e-4,y.vx*=.98,y.vy*=.98;for(let y=i.length-1;y>=0;y--){const v=i[y];if(v.life--,v.life<=0){i.splice(y,1);continue}v.phase+=s*(.6+v.intensity*.8);let b=0,S=0;for(const _ of u){const P=_.x-v.x,I=_.y-v.y,$=Math.sqrt(P*P+I*I)+.001;if($<_.radius){const q=_.strength*(1-$/_.radius)*.1;b+=P/$*q,S+=I/$*q,v.intensity=Math.min(1,v.intensity+_.strength*.01*s),v.hue+=(_.hue-v.hue)*.01*s}}b+=Math.sin(o*1.2+y*1.3)*t.ruido*.02,S+=Math.cos(o*1.2+y*.9)*t.ruido*.02;const C=Math.sin(v.phase)*t.intensidade*.02;v.intensity=Math.max(.05,Math.min(1,v.intensity+C*s));const k=fi,R=Math.max(0,Math.min(k-1,(v.x+1)*.5*k|0)),j=Math.max(0,Math.min(k-1,(v.y+1)*.5*k|0));r.consistency[j*k+R]=Math.min(1,r.consistency[j*k+R]+v.intensity*.035*s),v.vx=(v.vx+b*s)*.975,v.vy=(v.vy+S*s)*.975;const T=Math.sqrt(v.vx*v.vx+v.vy*v.vy);T>.006&&(v.vx=v.vx/T*.006,v.vy=v.vy/T*.006),v.x+=v.vx,v.y+=v.vy,v.x=Math.max(-.95,Math.min(.95,v.x)),v.y=Math.max(-.95,Math.min(.95,v.y)),v.trailX.push(v.x),v.trailY.push(v.y),v.trailX.length>Db&&(v.trailX.shift(),v.trailY.shift())}const h=50+Math.round(t.densidade*300);for(;i.length<h&&i.length<lC;){const y=Math.random()*fh,v=.1+Math.random()*.4,b=Math.cos(y)*v,S=Math.sin(y)*v;i.push({x:b,y:S,vx:(Math.random()-.5)*.005,vy:(Math.random()-.5)*.005,intensity:.2+Math.random()*.4,hue:Math.random()*360,phase:Math.random()*fh,life:400+Math.floor(Math.random()*800),trailX:[b],trailY:[S]})}let f=0;const g=i.length>0?i.reduce((y,v)=>y+v.intensity,0)/i.length:0;f+=g*t.intensidade*.05*s,f+=i.length/lC*t.densidade*.03*s,e.crueltyAccum=Math.min(1,e.crueltyAccum+f);const m=.3+(1-t.crueldade)*.5;if(e.crueltyAccum>m){e.crueltyAccum=0,e.ruptureCount++;let y=0,v=0;if(u.length>0){const b=u[Math.floor(Math.random()*u.length)];y=b.x,v=b.y}for(const b of i){const S=b.x-y,C=b.y-v,k=S*S+C*C;if(k<.09&&k>1e-6){const R=Math.sqrt(k),j=(1-R/.3)*.04;b.vx+=S/R*j,b.vy+=C/R*j,b.intensity=Math.min(1,b.intensity+.3)}}for(const b of l){const S=b.x-y,C=b.y-v;if(S*S+C*C<.15&&b.connections.length>1){b.connections.pop(),b.health=Math.max(.05,b.health-.2);break}}c.push({time:o,x:y,y:v,type:"ruptura",message:`Ruptura  crueldade excedeu limiar (${e.ruptureCount})`,color:"#ef4444",ttl:180})}for(let y=c.length-1;y>=0;y--)c[y].ttl--,c[y].ttl<=0&&c.splice(y,1)}const cC=150;function FZ(){const e=[];for(let t=0;t<3;t++){const r=t/3*Math.PI*2+Math.random()*.3,o=.25+Math.random()*.15;e.push({id:t,x:Math.cos(r)*o,y:Math.sin(r)*o,vx:0,vy:0,isEntry:!0,connections:[],heat:.8+Math.random()*.2,age:0,territory:.3})}return e[0].connections.push(1),e[1].connections.push(0,2),e[2].connections.push(1),{nodes:e,nextId:3,growthTimer:0,flightEdges:[]}}function NZ(e,t,r,o,s){s=Math.min(s,.04);const{nodes:l}=e;if(l.length===0)return;const i=new Map;for(const d of l)i.set(d.id,d);e.growthTimer+=s;const u=.8-t.multiplicidade*.5;if(e.growthTimer>u&&l.length<cC){e.growthTimer=0;let d;if(t.hubs>.4&&Math.random()<t.hubs){let m=l[0],y=l[0].connections.length;for(const v of l)v.connections.length>y&&(m=v,y=v.connections.length);d=m}else d=l[Math.floor(Math.random()*l.length)];const h=Math.random()*Math.PI*2,f=.06+Math.random()*.08,g={id:e.nextId++,x:d.x+Math.cos(h)*f,y:d.y+Math.sin(h)*f,vx:0,vy:0,isEntry:!1,connections:[d.id],heat:d.heat*.7+Math.random()*.3,age:0,territory:t.territorializacao*.5};if(g.x=Math.max(-.9,Math.min(.9,g.x)),g.y=Math.max(-.9,Math.min(.9,g.y)),d.connections.push(g.id),l.push(g),t.multiplicidade>.5&&Math.random()<(t.multiplicidade-.5)*.15){const m=1+Math.floor(Math.random()*2);for(let y=0;y<m&&l.length<cC;y++){const v=Math.random()*Math.PI*2,b=.3+Math.random()*.3,S={id:e.nextId++,x:Math.cos(v)*b,y:Math.sin(v)*b,vx:0,vy:0,isEntry:!0,connections:[],heat:.7+Math.random()*.3,age:0,territory:.2};let C=l[0],k=999;for(const R of l){const j=(R.x-S.x)**2+(R.y-S.y)**2;j<k&&(C=R,k=j)}S.connections.push(C.id),C.connections.push(S.id),l.push(S)}}}if(e.flightEdges=[],t.linhasDeFuga>.1&&Math.random()<t.linhasDeFuga*.04*s&&l.length>4){const d=l[Math.floor(Math.random()*l.length)];let h=null,f=0;for(const g of l){if(g.id===d.id||d.connections.includes(g.id))continue;const m=(g.x-d.x)**2+(g.y-d.y)**2;m>f&&(h=g,f=m)}h&&f>.04&&(d.connections.push(h.id),h.connections.push(d.id),e.flightEdges.push({from:d.id,to:h.id,heat:1,isFlight:!0}))}if(t.esquecimento>.1&&Math.random()<t.esquecimento*.03*s){const d=l.filter(h=>!h.isEntry&&h.heat<.3&&h.connections.length>0);if(d.length>0){const h=d[Math.floor(Math.random()*d.length)];if(h.connections.length>0){const f=h.connections.pop(),g=i.get(f);if(g){const m=g.connections.indexOf(h.id);m>=0&&g.connections.splice(m,1)}}}}for(let d=l.length-1;d>=0;d--){const h=l[d];!h.isEntry&&h.connections.length===0&&h.age>60&&l.splice(d,1)}const c=.015;for(let d=0;d<l.length;d++){const h=l[d];h.age++;let f=0,g=0;const m=Math.max(1,l.length/40|0);for(let S=0;S<l.length;S+=m){if(S===d)continue;const C=l[S],k=C.x-h.x,R=C.y-h.y,j=k*k+R*R;if(j<c&&j>1e-6){const T=Math.sqrt(j),_=.003/(T+.005);f-=k/T*_,g-=R/T*_}}for(const S of h.connections){const C=i.get(S);if(!C)continue;const k=C.x-h.x,R=C.y-h.y,j=Math.sqrt(k*k+R*R)+.001,T=.08+(1-t.territorializacao)*.05,_=(j-T)*.5;f+=k/j*_,g+=R/j*_}t.reterritorializacao>.2&&Math.sqrt(h.x*h.x+h.y*h.y)>.3&&(f-=h.x*t.reterritorializacao*.05,g-=h.y*t.reterritorializacao*.05),f+=Math.sin(o*2+h.id*1.7)*t.ruido*.02,g+=Math.cos(o*2+h.id*2.3)*t.ruido*.02;const y=fi,v=Math.max(0,Math.min(y-1,(h.x+1)*.5*y|0)),b=Math.max(0,Math.min(y-1,(h.y+1)*.5*y|0));if(r.territory[b*y+v]=Math.min(1,r.territory[b*y+v]+h.territory*.05*s),h.heat=Math.max(.05,h.heat-.002*s),h.connections.length>0&&Math.random()<.05){const S=h.connections[Math.floor(Math.random()*h.connections.length)],C=i.get(S);if(C){const k=(h.heat-C.heat)*.1;h.heat-=k*.5,C.heat+=k*.5}}h.vx=(h.vx+f*s)*.88,h.vy=(h.vy+g*s)*.88,h.x+=h.vx,h.y+=h.vy,h.x=Math.max(-.92,Math.min(.92,h.x)),h.y=Math.max(-.92,Math.min(.92,h.y))}}function qv(e){const t=[],r=new Set,o=new Map;for(const s of e.nodes)o.set(s.id,s);for(const s of e.nodes)for(const l of s.connections){const i=s.id<l?`${s.id}-${l}`:`${l}-${s.id}`;if(r.has(i))continue;r.add(i);const u=o.get(l);if(!u)continue;const c=e.flightEdges.some(d=>d.from===s.id&&d.to===l||d.from===l&&d.to===s.id);t.push({from:s.id,to:l,heat:(s.heat+u.heat)*.5,isFlight:c})}return t}function OZ(e){if(e.length<2)return 0;let t=0,r=0;for(const s of e)s.connections.length>t&&(t=s.connections.length),r+=s.connections.length;const o=r/e.length;return o>0?Math.min(1,t/(o*3)):0}function dC(e){return{cso:IZ(e),rhizome:FZ(),fields:EZ(),time:0,tick:0}}function _Z(e,t,r){const o=fi*fi,s=fi,l=(1-t.territorializacao*.5-t.reterritorializacao*.3)*.03*r,i=.004*r;for(let u=0;u<o;u++)e.territory[u]=Math.max(0,e.territory[u]-l),e.consistency[u]=Math.max(0,e.consistency[u]-i);if(t.territorializacao>.2){const u=t.territorializacao*.012*r;for(let c=1;c<s-1;c++)for(let d=1;d<s-1;d++){const h=c*s+d,f=(e.territory[h-1]+e.territory[h+1]+e.territory[h-s]+e.territory[h+s])*.25;e.territory[h]+=(f-e.territory[h])*u}}}function DZ(e,t,r){r=Math.min(r,.04),e.time+=r,e.tick++,PZ(e.cso,t,e.fields,e.time,r),NZ(e.rhizome,t,e.fields,e.time,r),_Z(e.fields,t,r)}function uC(e,t,r,o,s,l=.15){const{fields:i,cso:u}=e,c=fi;switch(t){case"criarIntensidade":{const d=5+Math.floor(s.densidade*10);for(let h=0;h<d&&u.affects.length<500;h++){const f=Math.random()*Math.PI*2,g=Math.random()*l*.6;u.affects.push({x:r+Math.cos(f)*g,y:o+Math.sin(f)*g,vx:(Math.random()-.5)*.008,vy:(Math.random()-.5)*.008,intensity:.5+Math.random()*.4,hue:Math.random()*360,phase:Math.random()*Math.PI*2,life:600+Math.floor(Math.random()*800),trailX:[r],trailY:[o]})}break}case"empurrar":{for(const d of e.rhizome.nodes){const h=d.x-r,f=d.y-o,g=h*h+f*f;if(g<l*l&&g>1e-6){const m=Math.sqrt(g);d.vx+=h/m*.01*(1-m/l),d.vy+=f/m*.01*(1-m/l)}}for(const d of u.affects){const h=d.x-r,f=d.y-o,g=h*h+f*f;if(g<l*l&&g>1e-6){const m=Math.sqrt(g),y=(1-m/l)*.03;d.vx+=h/m*y,d.vy+=f/m*y}}for(const d of u.organs){const h=d.x-r,f=d.y-o,g=h*h+f*f;if(g<l*l&&g>1e-6){const m=Math.sqrt(g);d.vx+=h/m*.008*(1-m/l),d.vy+=f/m*.008*(1-m/l)}}break}case"puxar":{for(const d of u.organs){const h=r-d.x,f=o-d.y,g=h*h+f*f;if(g<l*2*(l*2)&&g>1e-6){const m=Math.sqrt(g),y=Math.min(.01,.003/(m+.01));d.vx+=h/m*y,d.vy+=f/m*y}}for(const d of e.rhizome.nodes){const h=r-d.x,f=o-d.y,g=h*h+f*f;if(g<l*2*(l*2)&&g>1e-6){const m=Math.sqrt(g),y=Math.min(.01,.003/(m+.01));d.vx+=h/m*y,d.vy+=f/m*y}}for(const d of u.affects){const h=r-d.x,f=o-d.y,g=h*h+f*f;if(g<l*2*(l*2)&&g>1e-6){const m=Math.sqrt(g),y=Math.min(.02,.005/(m+.01));d.vx+=h/m*y,d.vy+=f/m*y}}break}case"sopro":{for(const d of u.affects){const h=d.x-r,f=d.y-o;h*h+f*f<l*l&&(d.vx+=(Math.random()-.5)*.025,d.vy+=(Math.random()-.5)*.025,d.intensity=Math.min(1,d.intensity+.15))}for(const d of u.organs){const h=d.x-r,f=d.y-o;h*h+f*f<l*l&&(d.vx+=(Math.random()-.5)*.01,d.vy+=(Math.random()-.5)*.01)}break}case"selo":{const d=(r+1)*.5*c|0,h=(o+1)*.5*c|0,f=Math.max(1,l*.5*c|0);for(let g=-f;g<=f;g++)for(let m=-f;m<=f;m++){const y=d+m,v=h+g;if(y<0||y>=c||v<0||v>=c||m*m+g*g>f*f)continue;const b=1-Math.sqrt(m*m+g*g)/f;i.territory[v*c+y]=Math.min(1,i.territory[v*c+y]+.7*b)}break}case"rasura":{const d=(r+1)*.5*c|0,h=(o+1)*.5*c|0,f=Math.max(1,l*.5*c|0);for(let g=-f;g<=f;g++)for(let m=-f;m<=f;m++){const y=d+m,v=h+g;if(y<0||y>=c||v<0||v>=c||m*m+g*g>f*f)continue;const b=v*c+y;i.territory[b]=0,i.consistency[b]=0}break}case"fuga":{for(const d of u.affects){const h=d.x-r,f=d.y-o,g=h*h+f*f;if(g<l*l&&g>1e-6){const m=Math.sqrt(g),y=(1-m/l)*.04;d.vx+=h/m*y,d.vy+=f/m*y}}for(const d of e.rhizome.nodes){const h=d.x-r,f=d.y-o,g=h*h+f*f;if(g<l*l&&g>1e-6){const m=Math.sqrt(g);d.vx+=h/m*.015*(1-m/l),d.vy+=f/m*.015*(1-m/l)}}break}case"criarOrgao":{const d=u.nextId++,h={id:d,x:r,y:o,vx:0,vy:0,radius:.03+Math.random()*.04,importance:.3+Math.random()*.5,connections:[],hue:200+Math.random()*50,health:1};let f=null,g=1/0;for(const m of u.organs){const y=Math.sqrt((m.x-r)**2+(m.y-o)**2);y<g&&(g=y,f=m)}f&&g<.5&&(h.connections.push(f.id),f.connections.push(d)),u.organs.push(h),u.events.push({time:e.time,x:r,y:o,type:"nascimento",message:"Novo orgao criado",color:"#60a5fa",ttl:120});break}case"criarNoRizoma":{const d=e.rhizome.nextId++,h={id:d,x:r,y:o,vx:0,vy:0,isEntry:!1,connections:[],heat:.5,age:0,territory:.3};let f=null,g=1/0;for(const m of e.rhizome.nodes){const y=Math.sqrt((m.x-r)**2+(m.y-o)**2);y<g&&(g=y,f=m)}f&&g<.5&&(h.connections.push(f.id),f.connections.push(d)),e.rhizome.nodes.push(h);break}case"criarEntrada":{const d=e.rhizome.nextId++,h={id:d,x:r,y:o,vx:0,vy:0,isEntry:!0,connections:[],heat:.8,age:0,territory:.1};let f=null,g=1/0;for(const m of e.rhizome.nodes){const y=Math.sqrt((m.x-r)**2+(m.y-o)**2);y<g&&(g=y,f=m)}f&&g<.6&&(h.connections.push(f.id),f.connections.push(d)),e.rhizome.nodes.push(h),u.events.push({time:e.time,x:r,y:o,type:"nascimento",message:"Nova entrada rizomatica",color:"#34d399",ttl:120});break}case"criarZona":{u.zones.push({x:r,y:o,vx:(Math.random()-.5)*.002,vy:(Math.random()-.5)*.002,radius:.12+Math.random()*.15,strength:.4+Math.random()*.4,hue:Math.random()*360,pulse:Math.random()*Math.PI*2});break}case"remover":{let d="",h=-1,f=.1;for(let g=0;g<u.organs.length;g++){const m=u.organs[g],y=Math.sqrt((m.x-r)**2+(m.y-o)**2);y<f&&(f=y,d="organ",h=g)}for(let g=0;g<e.rhizome.nodes.length;g++){const m=e.rhizome.nodes[g],y=Math.sqrt((m.x-r)**2+(m.y-o)**2);y<f&&(f=y,d="rnode",h=g)}for(let g=0;g<u.zones.length;g++){const m=u.zones[g],y=Math.sqrt((m.x-r)**2+(m.y-o)**2);y<f&&(f=y,d="zone",h=g)}if(d==="organ"&&h>=0){const g=u.organs[h];for(const m of u.organs)m.connections=m.connections.filter(y=>y!==g.id);u.organs.splice(h,1),u.events.push({time:e.time,x:r,y:o,type:"dissolucao",message:"Orgao removido",color:"#ef4444",ttl:120})}else if(d==="rnode"&&h>=0){const g=e.rhizome.nodes[h];for(const m of e.rhizome.nodes)m.connections=m.connections.filter(y=>y!==g.id);e.rhizome.nodes.splice(h,1),u.events.push({time:e.time,x:r,y:o,type:"dissolucao",message:"No rizoma removido",color:"#ef4444",ttl:120})}else d==="zone"&&h>=0&&(u.zones.splice(h,1),u.events.push({time:e.time,x:r,y:o,type:"dissolucao",message:"Zona removida",color:"#ef4444",ttl:120}));break}case"gradiente":{const d=(r+1)*.5*c|0,h=(o+1)*.5*c|0,f=Math.max(1,l*.75*c|0);for(let g=-f;g<=f;g++)for(let m=-f;m<=f;m++){const y=d+m,v=h+g;if(y<0||y>=c||v<0||v>=c||m*m+g*g>f*f)continue;const b=1-Math.sqrt(m*m+g*g)/f;i.consistency[v*c+y]=Math.min(1,i.consistency[v*c+y]+.5*b)}break}}}function LZ(e,t,r){const{cso:o,rhizome:s,fields:l}=e,i=o.affects.length;let u=0;for(const j of o.affects)u+=j.intensity;const c=i>0?u/i:0,d=OZ(s.nodes),h=qv(s),f=fi*fi;let g=0,m=0;for(let j=0;j<f;j++)g+=l.consistency[j],m+=l.territory[j];const y=m/f;let v=0;const b=g+m;if(b>.01){for(let j=0;j<f;j++){const T=(l.consistency[j]+l.territory[j])/b;T>1e-6&&(v-=T*Math.log2(T))}v=Math.min(1,v/Math.log2(f))}const S=J7(t),C=[1-Math.abs(c-.5)*.5,d>.1?1-Math.abs(d-.5):.3,Math.min(1,i/100)],k=Math.max(0,C.reduce((j,T)=>j+T,0)/C.length);let R="Indeterminado";return k>.45&&(S>.65&&d>.4?R="Captura (Proto-Estado)":S<.25&&c>.5?R="Simbiose Vibrante":t.linhasDeFuga>.5?R="Nomadismo":d>.5&&t.linhasDeFuga>.3?R="Metstase":y>.2&&S>.4?R="Reterritorializao":t.desorganizacao>.6&&c>.6?R="Delrio Controlado":R="Simbiose Vibrante"),{fps:r,nAffects:i,nOrgans:o.organs.length,nRhizomeNodes:s.nodes.length,nRhizomeEdges:h.length,hubDominance:d,plateauScore:k,plateauLabel:R,fieldEntropy:v,memoryLoad:y,K:S,meanIntensity:c,ruptureRate:o.ruptureCount,crueltyPressure:o.crueltyAccum}}const Ld=Math.PI*2;function Fa(e,t,r,o=1){return`hsla(${e|0},${t*100|0}%,${r*100|0}%,${o})`}function zZ(e,t,r,o,s,l,i,u,c,d,h={zoom:1,panX:0,panY:0},f){e.clearRect(0,0,t,r),e.fillStyle="#040408",e.fillRect(0,0,t,r);const g=t*.5+h.panX,m=r*.5+h.panY,y=Math.min(t,r)*.47*h.zoom;i.has("heatConsistency")&&hC(e,g,m,y,l.consistency,220,.5,d),i.has("heatTerritory")&&hC(e,g,m,y,l.territory,30,.55,d),i.has("cso")&&($Z(e,g,m,y,o.zones,d),VZ(e,g,m,y,o.events,d)),i.has("afetos")&&(qZ(e,g,m,y,o.affects),WZ(e,g,m,y,o.affects,d)),(i.has("connections")||i.has("cso"))&&(HZ(e,g,m,y,o.organs,u),GZ(e,g,m,y,o.organs,u,d)),i.has("rizoma")&&(UZ(e,g,m,y,s,c),YZ(e,g,m,y,s.nodes,d)),i.has("flights")&&KZ(e,g,m,y,s,c,d),f&&BZ(e,t,r,f,d)}function BZ(e,t,r,o,s){const l=.6+Math.sin(s*.3)*.15;e.save(),e.font="600 11px 'Doto', monospace",e.textAlign="center",e.fillStyle=`rgba(99,102,241,${.35*l})`,e.fillText(o.plateauLabel,t*.5,40),e.font="500 8px 'IBM Plex Mono', monospace",e.fillStyle="rgba(255,255,255,0.15)",e.fillText(`K=${o.K.toFixed(2)}  intensidade=${o.meanIntensity.toFixed(2)}`,t*.5,54),e.restore()}function hC(e,t,r,o,s,l,i,u){const c=fi,d=o*2/c,h=o*2/c,f=t-o,g=r-o;for(let m=0;m<c;m++)for(let y=0;y<c;y++){const v=s[m*c+y];if(v<.003)continue;const b=Math.sin(u*1.2+y*.2+m*.2)*.05+1;e.globalAlpha=Math.min(i,v*i*b),e.fillStyle=Fa(l+v*20,.6+v*.3,.15+v*.35),e.fillRect(f+y*d,g+m*h,d+.5,h+.5)}e.globalAlpha=1}function $Z(e,t,r,o,s,l){for(const i of s){const u=t+i.x*o,c=r+i.y*o,h=i.radius*o*(1+Math.sin(i.pulse+l*1.5)*.08),f=e.createRadialGradient(u,c,0,u,c,h);f.addColorStop(0,Fa(i.hue,.7,.5,i.strength*.12)),f.addColorStop(.7,Fa(i.hue,.5,.3,i.strength*.06)),f.addColorStop(1,"transparent"),e.fillStyle=f,e.fillRect(u-h,c-h,h*2,h*2)}}function qZ(e,t,r,o,s){e.lineCap="round",e.lineJoin="round";for(const l of s){const i=l.trailX.length;if(!(i<2))for(let u=1;u<i;u++){const c=u/i;e.beginPath(),e.moveTo(t+l.trailX[u-1]*o,r+l.trailY[u-1]*o),e.lineTo(t+l.trailX[u]*o,r+l.trailY[u]*o),e.lineWidth=(.4+l.intensity*1.2)*c,e.strokeStyle=Fa(l.hue,.5,.45,(.03+l.intensity*.06)*c),e.stroke()}}}function WZ(e,t,r,o,s,l){for(const i of s){const u=t+i.x*o,c=r+i.y*o,d=1+Math.sin(i.phase+l*.6)*.12,h=(1+i.intensity*2)*d;i.intensity>.3&&(e.beginPath(),e.arc(u,c,h*3.5,0,Ld),e.fillStyle=Fa(i.hue,.5,.5,i.intensity*.03),e.fill()),e.beginPath(),e.arc(u,c,h,0,Ld),e.fillStyle=Fa(i.hue,.6,.5+i.intensity*.15,.35+i.intensity*.3),e.fill()}}function HZ(e,t,r,o,s,l){const i=new Map;for(const c of s)i.set(c.id,c);const u=new Set;e.lineCap="round";for(const c of s)for(const d of c.connections){const h=c.id<d?`${c.id}-${d}`:`${d}-${c.id}`;if(u.has(h))continue;u.add(h);const f=i.get(d);if(!f)continue;const g=t+c.x*o,m=r+c.y*o,y=t+f.x*o,v=r+f.y*o,b=(c.importance+f.importance)*.5;e.lineWidth=.5+b*2.5*l.hierarquia;const S=(c.health+f.health)*.5;e.globalAlpha=S*.5,e.strokeStyle=Fa((c.hue+f.hue)*.5,.4,.5),e.beginPath(),e.moveTo(g,m),e.lineTo(y,v),e.stroke()}e.globalAlpha=1}function GZ(e,t,r,o,s,l,i){for(const u of s){const c=t+u.x*o,d=r+u.y*o,h=u.radius*o*(.8+u.importance*.4),f=u.health*(.3+l.organismo*.6);e.beginPath(),e.arc(c,d,h,0,Ld),e.strokeStyle=Fa(u.hue,.5,.6,f*.6),e.lineWidth=1.5,e.globalAlpha=f,e.stroke();const g=e.createRadialGradient(c,d,0,c,d,h);if(g.addColorStop(0,Fa(u.hue,.6,.55,f*.35)),g.addColorStop(1,"transparent"),e.fillStyle=g,e.fill(),u.importance>.5){const m=1+Math.sin(i*2+u.id)*.2;e.beginPath(),e.arc(c,d,h*.3*m,0,Ld),e.fillStyle=Fa(u.hue,.7,.7,f*.5),e.fill()}}e.globalAlpha=1}function VZ(e,t,r,o,s,l){for(const i of s){const u=t+i.x*o,c=r+i.y*o,d=1-i.ttl/180,h=5+d*30,f=Math.max(0,1-d*1.2);if(e.beginPath(),e.arc(u,c,h,0,Ld),e.strokeStyle=i.color,e.lineWidth=2-d*1.5,e.globalAlpha=f*.4,e.stroke(),i.type==="ruptura"){const g=h*.6;for(let m=0;m<4;m++){const y=m/4*Ld+l*3;e.beginPath(),e.moveTo(u,c),e.lineTo(u+Math.cos(y)*g,c+Math.sin(y)*g),e.lineWidth=1,e.globalAlpha=f*.3,e.strokeStyle=i.color,e.stroke()}}}e.globalAlpha=1}function UZ(e,t,r,o,s,l,i){const u=new Map;for(const c of s.nodes)u.set(c.id,c);e.lineCap="round";for(const c of l){if(c.isFlight)continue;const d=u.get(c.from),h=u.get(c.to);if(!d||!h)continue;const f=t+d.x*o,g=r+d.y*o,m=t+h.x*o,y=r+h.y*o,v=c.heat>.5?Fa(50+c.heat*30,.7,.5+c.heat*.2,.25+c.heat*.2):Fa(200,.3,.4,.15+c.heat*.15);e.lineWidth=.6+c.heat*1.5,e.strokeStyle=v,e.beginPath();const b=(f+m)*.5+(y-g)*.08,S=(g+y)*.5-(m-f)*.08;e.moveTo(f,g),e.quadraticCurveTo(b,S,m,y),e.stroke()}}function YZ(e,t,r,o,s,l){for(const i of s){const u=t+i.x*o,c=r+i.y*o,d=2+i.heat*3;if(i.isEntry){const h=1+Math.sin(l*2+i.id)*.15,f=d*1.5*h;e.save(),e.translate(u,c),e.rotate(Math.PI/4),e.beginPath(),e.rect(-f,-f,f*2,f*2),e.strokeStyle=Fa(160,.8,.6,.6),e.lineWidth=1.5,e.stroke(),e.fillStyle=Fa(160,.6,.5,.15),e.fill(),e.restore()}else e.beginPath(),e.arc(u,c,d,0,Ld),e.fillStyle=Fa(200+i.heat*40,.5,.4+i.heat*.3,.3+i.heat*.4),e.fill()}}function KZ(e,t,r,o,s,l,i){const u=new Map;for(const c of s.nodes)u.set(c.id,c);e.lineCap="round",e.setLineDash([4,6]),e.lineDashOffset=-i*20;for(const c of l){if(!c.isFlight)continue;const d=u.get(c.from),h=u.get(c.to);if(!d||!h)continue;const f=t+d.x*o,g=r+d.y*o,m=t+h.x*o,y=r+h.y*o;e.lineWidth=1.5,e.strokeStyle=Fa(280,.8,.6,.5),e.beginPath(),e.moveTo(f,g),e.lineTo(m,y),e.stroke();const v=(f+m)*.5,b=(g+y)*.5,S=Math.atan2(y-g,m-f);e.setLineDash([]),e.beginPath(),e.moveTo(v+Math.cos(S)*5,b+Math.sin(S)*5),e.lineTo(v+Math.cos(S+2.5)*4,b+Math.sin(S+2.5)*4),e.lineTo(v+Math.cos(S-2.5)*4,b+Math.sin(S-2.5)*4),e.closePath(),e.fillStyle=Fa(280,.8,.6,.4),e.fill(),e.setLineDash([4,6])}e.setLineDash([]),e.lineDashOffset=0}const C5=[{id:"organismo-puro",name:"Organismo Puro",icon:"",description:"Hierarquia mxima. rgos rgidos, zero plasticidade.",plateauRef:"Plat 6  28 de novembro de 1947: Como criar para si um Corpo sem rgos",theory:'O organismo  o inimigo do CsO. Deleuze e Guattari descrevem como o corpo se organiza em rgos com funes fixas, criando uma hierarquia que captura os fluxos de intensidade. O organismo puro  o corpo totalmente estratificado: cada parte tem funo, cada fluxo tem direo. "Os estratos so atos de captura, so como buracos negros ou ocluses que se esforam para reter tudo o que estiver ao alcance." Observe como os rgos mantm posies rgidas e as conexes so espessas   o corpo enquanto mquina funcional, antes de qualquer linha de fuga.',params:{organismo:.95,intensidade:.1,hierarquia:.9,rigidez:.9,desorganizacao:.02,crueldade:.8,antiHabito:.02,multiplicidade:.05,linhasDeFuga:.02,territorializacao:.85,reterritorializacao:.7,hubs:.75,esquecimento:.02,ruido:.05,densidade:.3},overlays:["cso","afetos","connections","heatTerritory"]},{id:"estratos-geologicos",name:"Estratos Geolgicos",icon:"",description:"Camadas sedimentares. Territrios profundos, sem mobilidade.",plateauRef:"Plat 3  10.000 a.C.: A geologia da moral",theory:'"A geologia da moral" descreve como a matria se organiza em estratos  camadas de sedimentao que capturam os fluxos. O estrato  dupla articulao: contedo e expresso. Deleuze e Guattari distinguem trs grandes estratos: o fsico-qumico, o orgnico e o antropomrfico. Cada camada se deposita sobre a anterior, endurecendo, territorializando. O campo de territrio (mbar) mostra essa sedimentao: a memria encarnada na matria, o passado que se recusa a soltar.',params:{organismo:.85,intensidade:.15,hierarquia:.8,rigidez:.85,desorganizacao:.05,crueldade:.75,antiHabito:.03,multiplicidade:.08,linhasDeFuga:.03,territorializacao:.9,reterritorializacao:.65,hubs:.6,esquecimento:.03,ruido:.08,densidade:.35},overlays:["cso","afetos","heatTerritory","connections"]},{id:"aparelho-estado",name:"Aparelho de Estado",icon:"",description:"Captura estatal. Hubs dominantes capturam todos os fluxos.",plateauRef:"Plat 13  7000 a.C.: Aparelho de captura",theory:'"Aparelho de captura" analisa como o Estado opera por captura: os fluxos que circulam livremente so interceptados, codificados, sobrecodificados. O Estado no nasce da guerra  precede a guerra, opera por antecipao. Os hubs no rizoma so pontos de captura que centralizam conexes, criando hierarquia onde havia multiplicidade. "O Estado  soberania. Mas a soberania s reina sobre aquilo que  capaz de interiorizar." Observe como poucos ns dominam toda a rede   a centralizao como mecanismo de poder.',params:{organismo:.8,intensidade:.2,hierarquia:.85,rigidez:.75,desorganizacao:.08,crueldade:.65,antiHabito:.05,multiplicidade:.15,linhasDeFuga:.05,territorializacao:.7,reterritorializacao:.6,hubs:.9,esquecimento:.05,ruido:.1,densidade:.4},overlays:["rizoma","connections","heatTerritory"]},{id:"sobrecodificacao",name:"Sobrecodificao",icon:"",description:"Cdigos sobre cdigos. Rigidez extrema com presso interna.",plateauRef:"Plat 5  587 a.C.  70 d.C.: Sobre alguns regimes de signos",theory:'"Sobre alguns regimes de signos" descreve como os cdigos se empilham: signos sobre signos, interpretaes sobre interpretaes. A sobrecodificao  o excesso de estratificao  quando o sistema produz mais regulao do que pode suportar, gerando presso interna. O regime significante  paranico: tudo faz signo, tudo remete a um centro de significncia. Observe a tenso: as conexes so rgidas, mas a crueldade se acumula  a presso que vai explodir est ali, latente.',params:{organismo:.85,intensidade:.25,hierarquia:.8,rigidez:.8,desorganizacao:.1,crueldade:.7,antiHabito:.05,multiplicidade:.1,linhasDeFuga:.08,territorializacao:.75,reterritorializacao:.55,hubs:.65,esquecimento:.05,ruido:.12,densidade:.45},overlays:["cso","afetos","connections"]},{id:"maquina-despotica",name:"Mquina Desptica",icon:"",description:"Significante desptico. Um centro irradia ordem totalitria.",plateauRef:"Plat 13  7000 a.C.: Aparelho de captura",theory:'O dspota  o significante mestre que subordina todos os fluxos a um centro nico. Em "Aparelho de captura", Deleuze e Guattari mostram como a mquina desptica opera por sobrecodificao total: um ponto irradia ordem sobre todos os outros, apagando a multiplicidade. "O dspota faz a terra, o territrio, depender de sua unidade superior transcendente."  a forma mais extrema de captura: hub dominante, hierarquia mxima, territrio como propriedade do centro.',params:{organismo:.9,intensidade:.15,hierarquia:.9,rigidez:.85,desorganizacao:.03,crueldade:.8,antiHabito:.02,multiplicidade:.05,linhasDeFuga:.02,territorializacao:.8,reterritorializacao:.75,hubs:.85,esquecimento:.02,ruido:.05,densidade:.35},overlays:["connections","heatTerritory","cso","afetos"]},{id:"fissura-inicial",name:"Fissura Inicial",icon:"",description:"Primeiras rachaduras. rgos comeam a perder rigidez.",plateauRef:'Plat 8  1874: Trs novelas, ou "O que se passou?"',theory:'"Trs novelas" explora as linhas que compem uma vida: a linha molar (segmentos rgidos), a linha molecular (fissuras) e a linha de fuga. A fissura inicial  o primeiro tremor molecular  algo se moveu sob a superfcie antes que a estrutura perceba. "Alguma coisa se passou, mas no sei dizer exatamente o qu." Observe como a rigidez comea a ceder: os rgos j no mantm suas posies com a mesma firmeza, as intensidades comeam a circular com mais liberdade.',params:{organismo:.7,intensidade:.3,hierarquia:.65,rigidez:.6,desorganizacao:.2,crueldade:.55,antiHabito:.15,multiplicidade:.15,linhasDeFuga:.1,territorializacao:.6,reterritorializacao:.45,hubs:.5,esquecimento:.1,ruido:.18,densidade:.45},overlays:["cso","afetos","connections"]},{id:"tremor-organico",name:"Tremor Orgnico",icon:"",description:"Vibrao interna. Intensidades crescem dentro da estrutura.",plateauRef:"Plat 6  28 de novembro de 1947: Como criar para si um Corpo sem rgos",theory:'No plat do CsO, Deleuze e Guattari descrevem como as intensidades comeam a percorrer o corpo antes que a organizao se dissolva. O tremor  a vibrao molecular que precede a desestratificao  os afetos crescem dentro da estrutura sem ainda romp-la. "As intensidades se produzem em um spatium ele mesmo intensivo, que no comporta distncias nem medidas." Ative a camada de Consistncia (azul) para ver as intensidades se acumulando nos interstcios da organizao.',params:{organismo:.65,intensidade:.4,hierarquia:.55,rigidez:.55,desorganizacao:.25,crueldade:.5,antiHabito:.2,multiplicidade:.2,linhasDeFuga:.15,territorializacao:.5,reterritorializacao:.4,hubs:.4,esquecimento:.12,ruido:.22,densidade:.5},overlays:["cso","afetos","heatConsistency"]},{id:"erosao-territorial",name:"Eroso Territorial",icon:"",description:"Territrios se dissolvem lentamente. Memria enfraquece.",plateauRef:"Plat 11  1837: Acerca do ritornelo",theory:'"Do ritornelo" descreve como o territrio se forma e se dissolve. O territrio no  um espao geogrfico   um ato expressivo, um motivo que marca e organiza. A eroso territorial  a desterritorializao lenta: as marcas que definem o territrio comeam a se apagar, a memria enfraquece, os limites se tornam porosos. "O territrio  o produto de uma territorializao dos meios e dos ritmos." Observe o campo de territrio (mbar) se dissolvendo gradualmente.',params:{organismo:.55,intensidade:.4,hierarquia:.5,rigidez:.45,desorganizacao:.3,crueldade:.45,antiHabito:.25,multiplicidade:.25,linhasDeFuga:.2,territorializacao:.35,reterritorializacao:.3,hubs:.35,esquecimento:.25,ruido:.25,densidade:.5},overlays:["heatTerritory","cso","afetos"]},{id:"primeira-ruptura",name:"Primeira Ruptura",icon:"",description:"Crueldade excede limiar. Primeira ruptura violenta.",plateauRef:"Plat 9  1933: Micropoltica e segmentaridade",theory:'"Micropoltica e segmentaridade" distingue entre segmentaridade dura (molar) e flexvel (molecular). A primeira ruptura  o momento em que a crueldade acumulada  intensidades reprimidas dentro da organizao  excede o limiar e rompe a estrutura molar. "Tudo  poltico, mas toda poltica  ao mesmo tempo macropoltica e micropoltica." O anel de ruptura (vermelho) marca o ponto onde a acumulao se tornou insustentvel   o evento, a singularidade que muda tudo.',params:{organismo:.6,intensidade:.5,hierarquia:.5,rigidez:.45,desorganizacao:.35,crueldade:.25,antiHabito:.3,multiplicidade:.2,linhasDeFuga:.25,territorializacao:.4,reterritorializacao:.3,hubs:.35,esquecimento:.15,ruido:.3,densidade:.55},overlays:["cso","afetos","connections","flights"]},{id:"descodificacao",name:"Descodificao",icon:"",description:"Cdigos se soltam. Anti-hbito comea a dominar.",plateauRef:"Plat 5  587 a.C.  70 d.C.: Sobre alguns regimes de signos",theory:'A descodificao  o processo inverso da sobrecodificao: os cdigos se soltam, os signos perdem suas referncias fixas. O anti-hbito comea a dominar  cada conexo pode ser re-feita de forma improvvel, cada signo pode significar outra coisa. "Os fluxos descodificados escorrem por todos os lados, atravessam as muralhas." Observe como CsO e Rizoma comeam a coexistir: a hierarquia orgnica e o grafo acntrico ocupam o mesmo espao, criando tenso produtiva.',params:{organismo:.5,intensidade:.5,hierarquia:.4,rigidez:.4,desorganizacao:.4,crueldade:.4,antiHabito:.4,multiplicidade:.3,linhasDeFuga:.3,territorializacao:.35,reterritorializacao:.25,hubs:.3,esquecimento:.2,ruido:.3,densidade:.55},overlays:["cso","afetos","rizoma"]},{id:"desterritorializacao",name:"Desterritorializao",icon:"",description:"Fuga ativa dos territrios. Conexes se rompem.",plateauRef:"Plat 14  1440: O liso e o estriado",theory:'"O liso e o estriado" descreve dois espaos: o estriado (organizado, medido, territorizado) e o liso (aberto, intensivo, nmade). A desterritorializao  a passagem do estriado ao liso  o abandono ativo dos territrios. "O espao liso  percorrido por um trao que no tem comeo nem fim, que passa entre os pontos." As linhas de fuga (traos pontilhados roxos) mostram essa travessia: conexes improvveis que perfuram o espao estriado.',params:{organismo:.4,intensidade:.55,hierarquia:.3,rigidez:.3,desorganizacao:.5,crueldade:.35,antiHabito:.5,multiplicidade:.35,linhasDeFuga:.6,territorializacao:.2,reterritorializacao:.15,hubs:.2,esquecimento:.3,ruido:.35,densidade:.55},overlays:["flights","cso","afetos","rizoma"]},{id:"nomadismo",name:"Nomadismo",icon:"",description:"Mquina de guerra nmade. Mobilidade constante.",plateauRef:"Plat 12  1227: Tratado de nomadologia  A mquina de guerra",theory:'"Tratado de nomadologia" ope a mquina de guerra nmade ao aparelho de Estado. O nmade no  quem viaja, mas quem ocupa o espao liso: sem territrio fixo, sem hierarquia, mobilidade como modo de existncia. "O nmade tem um territrio, segue trajetos costumeiros, vai de um ponto a outro, no ignora os pontos. Mas a questo  que o ponto existe apenas como ponto de passagem." As partculas de intensidade (afetos) vagam sem destino fixo, e as linhas de fuga conectam os pontos mais distantes.',params:{organismo:.3,intensidade:.55,hierarquia:.2,rigidez:.2,desorganizacao:.5,crueldade:.4,antiHabito:.6,multiplicidade:.5,linhasDeFuga:.7,territorializacao:.1,reterritorializacao:.1,hubs:.15,esquecimento:.4,ruido:.45,densidade:.5},overlays:["cso","afetos","rizoma","flights"]},{id:"linhas-de-fuga",name:"Linhas de Fuga",icon:"",description:"Escape puro. Conexes improvveis dominam.",plateauRef:"Plat 9  1933: Micropoltica e segmentaridade",theory:'As linhas de fuga so o terceiro tipo de linha em "Micropoltica": nem molares (segmentos rgidos) nem moleculares (fissuras), so linhas de ruptura absoluta. Conexes improvveis entre pontos distantes que abrem o espao para o novo. "Uma linha de fuga j  algo complexo, e os perigos que comporta so mltiplos." O escape criativo que desorganiza todos os estratos  mas que tambm pode se destruir, virar linha de abolio. Observe a proliferao de linhas tracejadas roxas no espao.',params:{organismo:.25,intensidade:.6,hierarquia:.15,rigidez:.15,desorganizacao:.6,crueldade:.35,antiHabito:.65,multiplicidade:.55,linhasDeFuga:.9,territorializacao:.08,reterritorializacao:.05,hubs:.15,esquecimento:.35,ruido:.4,densidade:.55},overlays:["flights","rizoma","heatConsistency","afetos"]},{id:"devir-animal",name:"Devir-Animal",icon:"",description:"Transformao molecular. Fronteiras de tipo se dissolvem.",plateauRef:"Plat 10  1730: Devir-intenso, devir-animal, devir-imperceptvel...",theory:'"Devir-intenso, devir-animal" descreve como as fronteiras entre espcies, entre tipos, se dissolvem em processos moleculares. No  imitao nem semelhana:  entrar na zona de indiscernibilidade onde as identidades fixas se transformam. "Devir , a partir das formas que se tem, do sujeito que se , extrair partculas entre as quais se instauram relaes de velocidade e lentido mais prximas daquilo em que se est devindo." As partculas de hue variado mostram essa dissoluo de fronteiras de tipo.',params:{organismo:.3,intensidade:.65,hierarquia:.2,rigidez:.15,desorganizacao:.55,crueldade:.3,antiHabito:.55,multiplicidade:.45,linhasDeFuga:.55,territorializacao:.2,reterritorializacao:.1,hubs:.2,esquecimento:.25,ruido:.4,densidade:.6},overlays:["cso","afetos","heatConsistency"]},{id:"devir-imperceptivel",name:"Devir-Imperceptvel",icon:"",description:"Dissoluo gradual. Partculas perdem identidade.",plateauRef:"Plat 10  1730: Devir-intenso, devir-animal, devir-imperceptvel...",theory:'O devir-imperceptvel  o limite de todos os devires: dissolver-se no mundo, tornar-se partcula entre partculas, perder a identidade sem perder a singularidade. "Fazer como todo mundo"  mas de forma que esse "todo mundo" j no signifique nada de molar. "Reduzir-se a uma ou vrias linhas abstratas que vo se continuar e se conjugar com outras, para produzir imediatamente, diretamente, um mundo." Observe a baixa densidade, o esquecimento alto  o sistema se dissolve mantendo apenas vestgios de consistncia.',params:{organismo:.15,intensidade:.45,hierarquia:.1,rigidez:.1,desorganizacao:.7,crueldade:.3,antiHabito:.7,multiplicidade:.3,linhasDeFuga:.5,territorializacao:.1,reterritorializacao:.05,hubs:.1,esquecimento:.5,ruido:.35,densidade:.4},overlays:["cso","afetos","heatConsistency"]},{id:"cso-pulsante",name:"CsO Pulsante",icon:"",description:"Intensidades dominam. Pulso vital sem hierarquia.",plateauRef:"Plat 6  28 de novembro de 1947: Como criar para si um Corpo sem rgos",theory:'O CsO no  o corpo destrudo, mas o corpo liberado da organizao. Em "28 de novembro de 1947",  descrito como superfcie de intensidades puras: sem rgos que distribuam funes, restam apenas pulsaes, fluxos, afetos que percorrem uma superfcie sem estratificao. "O CsO  o que resta quando tudo foi retirado. E o que se retira  justamente o fantasma, o conjunto de significncias e subjetivaes." As zonas pulsantes mostram regies de intensidade que modulam os afetos sem organiz-los.',params:{organismo:.1,intensidade:.9,hierarquia:.1,rigidez:.1,desorganizacao:.8,crueldade:.3,antiHabito:.75,multiplicidade:.4,linhasDeFuga:.5,territorializacao:.1,reterritorializacao:.08,hubs:.1,esquecimento:.3,ruido:.45,densidade:.7},overlays:["cso","afetos","heatConsistency"]},{id:"cso-profundo",name:"CsO Profundo",icon:"",description:"Plano de consistncia pleno. Zero especializao.",plateauRef:"Plat 6  28 de novembro de 1947: Como criar para si um Corpo sem rgos",theory:'O plano de consistncia  o CsO levado ao limite: zero especializao, pura imanncia. Cada intensidade circula sem obstculo, sem hierarquia, sem memria. O perigo aqui  o CsO vazio  a catatonia, o corpo esvaziado que nada mais produz. "Tipos ou gneros de CsO: existem CsO vazios, cancerosos, totalitrios, fascistas." Deleuze e Guattari insistem: o CsO  desejo, no destruio.  preciso faz-lo com prudncia. As linhas de fuga e o plano de consistncia (azul) coexistem num espao sem centro.',params:{organismo:.05,intensidade:.85,hierarquia:.05,rigidez:.05,desorganizacao:.9,crueldade:.25,antiHabito:.85,multiplicidade:.5,linhasDeFuga:.6,territorializacao:.05,reterritorializacao:.03,hubs:.05,esquecimento:.35,ruido:.5,densidade:.65},overlays:["cso","afetos","heatConsistency","flights"]},{id:"plano-imanencia",name:"Plano de Imanncia",icon:"",description:"Pura imanncia. Sem transcendncia, puro fluxo.",plateauRef:"Plat 15  Concluso: Regras concretas e mquinas abstratas",theory:'Na concluso de Mil Plats, o plano de imanncia  apresentado como o horizonte de todos os agenciamentos: o campo transcendental sem transcendncia, onde tudo coexiste sem hierarquia. "O plano de imanncia ou de consistncia no  um plano no sentido de um programa, um desgnio, mesmo que virtual. Tambm no  um plano no sentido de nvel ou dimenso.  o plano de proliferao, de povoamento, de contgio." Puro fluxo, sem sujeito, sem objeto  apenas relaes de velocidade e lentido entre partculas.',params:{organismo:.05,intensidade:.8,hierarquia:.05,rigidez:.05,desorganizacao:.85,crueldade:.2,antiHabito:.8,multiplicidade:.55,linhasDeFuga:.55,territorializacao:.05,reterritorializacao:.03,hubs:.05,esquecimento:.3,ruido:.55,densidade:.75},overlays:["cso","afetos","heatConsistency"]},{id:"ovo-intenso",name:"Ovo Intenso",icon:"",description:"O ovo como CsO: superfcie pr-organizacional de intensidades.",plateauRef:"Plat 6  28 de novembro de 1947: Como criar para si um Corpo sem rgos",theory:'O ovo  a metfora do CsO em estado germinal: superfcie pr-organizacional percorrida por intensidades, gradientes, limiares. Antes de haver rgos, h apenas zonas de intensidade que definem o que o corpo pode. "O ovo intenso  definido por eixos e vetores, gradientes e limiares, tendncias dinmicas com mutao de energia." O ovo intenso  potncia pura  observe como a alta densidade de afetos preenche o espao de forma homognea, sem hierarquia, como uma superfcie vibrante.',params:{organismo:.08,intensidade:.95,hierarquia:.05,rigidez:.05,desorganizacao:.85,crueldade:.2,antiHabito:.8,multiplicidade:.35,linhasDeFuga:.4,territorializacao:.08,reterritorializacao:.05,hubs:.05,esquecimento:.2,ruido:.4,densidade:.8},overlays:["cso","afetos","heatConsistency"]},{id:"delirio-controlado",name:"Delrio Controlado",icon:"",description:"Caos produtivo. Rupturas frequentes geram novos padres.",plateauRef:"Plat 6  28 de novembro de 1947: Como criar para si um Corpo sem rgos",theory:'Deleuze e Guattari advertem:  preciso prudncia ao criar o CsO. No se desmonta a organizao com golpes de martelo. "Lodged on the stratum, an experimentation on a body without organs can be carried out only prudently." O delrio controlado  a desestratificao prudente  rupturas frequentes mas administrveis, caos produtivo que gera novos padres sem aniquilar. A crueldade est baixa (rupturas fceis) mas a multiplicidade e as linhas de fuga mantm o sistema produtivo, no destrutivo.',params:{organismo:.15,intensidade:.9,hierarquia:.12,rigidez:.1,desorganizacao:.8,crueldade:.12,antiHabito:.85,multiplicidade:.65,linhasDeFuga:.7,territorializacao:.08,reterritorializacao:.05,hubs:.1,esquecimento:.4,ruido:.55,densidade:.8},overlays:["cso","afetos","flights","heatConsistency"]},{id:"rizoma-nascente",name:"Rizoma Nascente",icon:"",description:"Primeiras conexes. Multiplicidade baixa, crescimento lento.",plateauRef:"Plat 1  Introduo: Rizoma",theory:'A introduo de Mil Plats apresenta o rizoma como modelo anti-hierrquico: sem comeo nem fim, sem centro, mltiplas entradas. "O rizoma conecta um ponto qualquer a outro ponto qualquer, e cada um de seus traos no remete necessariamente a traos de mesma natureza." O rizoma nascente so as primeiras conexes  qualquer ponto pode conectar a qualquer outro, mas o crescimento ainda  tmido. Os diamantes verdes marcam as entradas: portais por onde o rizoma pode ser acessado.',params:{organismo:.45,intensidade:.35,hierarquia:.35,rigidez:.35,desorganizacao:.25,crueldade:.45,antiHabito:.2,multiplicidade:.2,linhasDeFuga:.15,territorializacao:.4,reterritorializacao:.3,hubs:.25,esquecimento:.1,ruido:.2,densidade:.45},overlays:["rizoma","connections","afetos"]},{id:"rizoma-proliferante",name:"Rizoma Proliferante",icon:"",description:"Crescimento explosivo. Novas entradas surgem constantemente.",plateauRef:"Plat 1  Introduo: Rizoma",theory:"Os seis princpios do rizoma: 1 e 2  conexo e heterogeneidade: qualquer ponto pode conectar a qualquer outro. 3  multiplicidade: no h unidade que sirva de piv, no h sujeito nem objeto. 4  ruptura assignificante: pode ser cortado e recomear. 5 e 6  cartografia e decalcomania: o rizoma faz mapa, no decalque. Quando a multiplicidade se intensifica, novas entradas surgem constantemente  o sistema cresce por proliferao, no por diviso hierrquica.",params:{organismo:.3,intensidade:.5,hierarquia:.2,rigidez:.2,desorganizacao:.5,crueldade:.4,antiHabito:.5,multiplicidade:.85,linhasDeFuga:.4,territorializacao:.25,reterritorializacao:.15,hubs:.3,esquecimento:.15,ruido:.35,densidade:.55},overlays:["rizoma","cso","afetos"]},{id:"maquina-guerra",name:"Mquina de Guerra",icon:"",description:"Rizoma como arma. Conexes improvveis destroem hierarquias.",plateauRef:"Plat 12  1227: Tratado de nomadologia  A mquina de guerra",theory:'A mquina de guerra  exterior ao Estado: no nasce para fazer guerra, mas para criar espao liso. "A mquina de guerra  a inveno dos nmades (enquanto se conjuga com a mquina de guerra nmade)." Em "Tratado de nomadologia", o rizoma se torna arma  conexes improvveis que destroem hierarquias, linhas de fuga que dissolvem os aparelhos de captura. A guerra  o resultado quando o Estado se apropria da mquina de guerra, no sua essncia. Observe a proliferao de linhas de fuga (roxas) e a ausncia de hubs dominantes.',params:{organismo:.2,intensidade:.65,hierarquia:.1,rigidez:.1,desorganizacao:.7,crueldade:.25,antiHabito:.7,multiplicidade:.6,linhasDeFuga:.85,territorializacao:.1,reterritorializacao:.05,hubs:.1,esquecimento:.3,ruido:.5,densidade:.6},overlays:["rizoma","flights","cso","afetos"]},{id:"rizoma-frio",name:"Rizoma Frio",icon:"",description:"Esquecimento ativo. Estruturas se formam e dissolvem.",plateauRef:"Plat 1  Introduo: Rizoma",theory:'O rizoma no  eterno  um de seus princpios  a ruptura assignificante: pode ser cortado em qualquer ponto e recomear segundo outra de suas linhas. "Todo rizoma compreende linhas de segmentaridade segundo as quais ele  estratificado, territorializado, organizado, significado, atribudo, etc.; mas compreende tambm linhas de desterritorializao pelas quais ele foge sem parar." O rizoma frio  o esquecimento ativo: estruturas se formam e dissolvem, a poda  to essencial quanto o crescimento.',params:{organismo:.4,intensidade:.25,hierarquia:.35,rigidez:.35,desorganizacao:.3,crueldade:.5,antiHabito:.2,multiplicidade:.3,linhasDeFuga:.2,territorializacao:.35,reterritorializacao:.25,hubs:.3,esquecimento:.8,ruido:.2,densidade:.35},overlays:["rizoma","connections"]},{id:"rede-acentrada",name:"Rede Acentrada",icon:"",description:"Sem hierarquia, sem hubs. Igualdade radical de conexes.",plateauRef:"Plat 1  Introduo: Rizoma",theory:'O rizoma como rede acentrada se ope tanto  rvore (modelo hierrquico) quanto ao fascculo (falso rizoma com centro oculto). "Diferentemente das rvores ou de suas razes, o rizoma conecta um ponto qualquer com outro ponto qualquer." Sem hubs, sem hierarquia: igualdade radical de conexes, onde nenhum ponto domina os outros. Observe como a Hub Dominance nos diagnsticos fica prxima de zero   a rede distribuda em sua forma mais pura, sem captura.',params:{organismo:.2,intensidade:.45,hierarquia:.1,rigidez:.15,desorganizacao:.55,crueldade:.4,antiHabito:.5,multiplicidade:.5,linhasDeFuga:.45,territorializacao:.2,reterritorializacao:.15,hubs:.02,esquecimento:.25,ruido:.35,densidade:.5},overlays:["rizoma","cso","afetos"]},{id:"simbiose-vibrante",name:"Simbiose Vibrante",icon:"",description:"Equilbrio dinmico. Todas as camadas coexistem em harmonia.",plateauRef:"Plat 10  1730: Devir-intenso, devir-animal, devir-imperceptvel...",theory:'A simbiose vibrante  o plat como estado: um equilbrio dinmico onde todas as camadas coexistem sem que uma domine. Como Deleuze e Guattari definem: "Um plat no  um ponto culminante; tampouco est no topo ou no fundo de algo.  uma regio contnua de intensidades, vibrando sobre si mesma, sem orientao para um ponto culminante ou uma finalidade exterior." Este  o conceito que nomeia o livro inteiro  cada captulo  um plat, uma regio de intensidade autossuficiente. Observe todas as camadas ativas coexistindo.',params:{organismo:.45,intensidade:.55,hierarquia:.4,rigidez:.35,desorganizacao:.35,crueldade:.45,antiHabito:.35,multiplicidade:.4,linhasDeFuga:.35,territorializacao:.35,reterritorializacao:.3,hubs:.3,esquecimento:.2,ruido:.3,densidade:.55},overlays:["cso","afetos","rizoma","heatConsistency"]},{id:"metastase",name:"Metstase",icon:"",description:"Hubs capturam mas linhas de fuga proliferam. Tenso mxima.",plateauRef:"Plat 13  7000 a.C.: Aparelho de captura + Plat 12  Nomadologia",theory:'A metstase  o ponto de tenso mxima entre captura e fuga: os hubs tentam centralizar enquanto linhas de fuga proliferam.  o momento em que o aparelho de captura e a mquina de guerra coexistem em conflito aberto, sem resoluo. "O Estado no para de produzir e de reproduzir segmentos ideais, e a mquina de guerra no para de fazer explodir esses segmentos." No h sntese dialtica aqui  apenas coexistncia tensa, processos que se parasitam mutuamente.',params:{organismo:.5,intensidade:.6,hierarquia:.45,rigidez:.4,desorganizacao:.45,crueldade:.3,antiHabito:.5,multiplicidade:.55,linhasDeFuga:.6,territorializacao:.3,reterritorializacao:.2,hubs:.65,esquecimento:.2,ruido:.4,densidade:.6},overlays:["rizoma","flights","cso","afetos"]},{id:"reterritorializacao",name:"Reterritorializao",icon:"",description:"Recaptura gradual. Memria reconstri territrios perdidos.",plateauRef:"Plat 11  1837: Acerca do ritornelo",theory:'"Do ritornelo" mostra que toda desterritorializao  acompanhada de reterritorializao: no se pode fugir sem recriar algum tipo de territrio. "A desterritorializao, por sua vez, deve ser pensada como potncia perfeitamente positiva, que tem seus graus e seus limiares (epistrato) e que sempre  relativa, tendo um reverso, uma reterritorializao." A memria reconstri, o hbito se refaz, mas nunca identicamente  repetio com diferena. O campo de territrio (mbar) cresce de volta, mas com outra configurao.',params:{organismo:.6,intensidade:.35,hierarquia:.55,rigidez:.5,desorganizacao:.15,crueldade:.5,antiHabito:.1,multiplicidade:.2,linhasDeFuga:.1,territorializacao:.7,reterritorializacao:.8,hubs:.45,esquecimento:.08,ruido:.15,densidade:.45},overlays:["heatTerritory","connections","afetos"]},{id:"agenciamento",name:"Agenciamento",icon:"",description:"Composio maqunica. rgos + intensidades + rizoma coexistem.",plateauRef:"Plat 15  Concluso: Regras concretas e mquinas abstratas",theory:'O agenciamento  o conceito central de Mil Plats: composio de corpos (agenciamento maqunico de corpos) e enunciados (agenciamento coletivo de enunciao). "Um agenciamento comporta dois segmentos: um de contedo, o outro de expresso."  a unidade mnima do pensamento deleuziano: nem sujeito nem objeto, mas a composio que os atravessa. Todo agenciamento tem uma ponta territorial (reterritorializao) e uma ponta de fuga (desterritorializao). Observe como todas as camadas coexistem: rgos, intensidades, rizoma  agenciadas, no fundidas.',params:{organismo:.5,intensidade:.5,hierarquia:.45,rigidez:.4,desorganizacao:.4,crueldade:.4,antiHabito:.4,multiplicidade:.45,linhasDeFuga:.4,territorializacao:.4,reterritorializacao:.3,hubs:.35,esquecimento:.2,ruido:.3,densidade:.55},overlays:["cso","afetos","rizoma","connections"]},{id:"ritornelo",name:"Ritornelo",icon:"",description:"Repetio com diferena. Ciclos de territorializao e fuga.",plateauRef:"Plat 11  1837: Acerca do ritornelo",theory:'"Do ritornelo"  talvez o plat mais musical: um motivo sonoro que marca territrio, que organiza o caos em cosmos. Deleuze e Guattari descrevem trs momentos: 1) traar um centro no caos (a criana que cantarola no escuro), 2) organizar um espao em torno desse centro (o territrio como ato expressivo), 3) abrir-se ao cosmos (a linha de fuga do territrio). "O ritornelo  o contedo propriamente musical, o bloco de contedo prprio da msica." O ciclo  territorializar, desterritorializar, reterritorializar   o ritmo fundamental, repetio que nunca retorna ao mesmo.',params:{organismo:.55,intensidade:.5,hierarquia:.45,rigidez:.4,desorganizacao:.35,crueldade:.4,antiHabito:.35,multiplicidade:.35,linhasDeFuga:.45,territorializacao:.55,reterritorializacao:.5,hubs:.35,esquecimento:.25,ruido:.3,densidade:.5},overlays:["cso","afetos","heatTerritory","flights"]}],lo="'IBM Plex Mono', monospace",M5="'Doto', monospace",Jr="#6366f1",fC=e=>Math.min(1,Math.max(0,e)),XZ=()=>Math.random().toString(36).slice(2,8),pC=[{key:"organismo",label:"Organismo",color:"#f472b6"},{key:"intensidade",label:"Intensidade",color:"#fbbf24"},{key:"hierarquia",label:"Hierarquia",color:"#fb923c"},{key:"rigidez",label:"Rigidez",color:"#ef4444"},{key:"desorganizacao",label:"Desorganizacao",color:"#a78bfa"},{key:"crueldade",label:"Crueldade",color:"#dc2626"},{key:"antiHabito",label:"Anti-habito",color:"#818cf8"}],mC=[{key:"multiplicidade",label:"Multiplicidade",color:"#34d399"},{key:"linhasDeFuga",label:"Linhas de Fuga",color:"#a78bfa"},{key:"territorializacao",label:"Territorializacao",color:"#f97316"},{key:"reterritorializacao",label:"Reterritorializacao",color:"#fb923c"},{key:"hubs",label:"Hubs",color:"#60a5fa"},{key:"esquecimento",label:"Esquecimento",color:"#94a3b8"}],ZZ=[{key:"ruido",label:"Ruido",color:"#38bdf8"},{key:"densidade",label:"Densidade",color:"#6ee7b7"}],JZ=[{key:"cso",label:"CsO"},{key:"afetos",label:"Afetos"},{key:"rizoma",label:"Rizoma"},{key:"heatConsistency",label:"Consistencia"},{key:"heatTerritory",label:"Territorio"},{key:"connections",label:"Conexoes"},{key:"flights",label:"Fugas"}],QZ={afeto:{title:"AFETO (Intensidade)",desc:"Particula de intensidade que percorre o CsO. Fluxo de desejo sem organizacao.",color:"#fbbf24"},orgao:{title:"ORGAO (Estrato)",desc:"No da hierarquia organica. Conectado por springs. Saude diminui com desorganizacao.",color:"#60a5fa"},"no-rizoma":{title:"NO RIZOMA (Multiplicidade)",desc:"Ponto do grafo acentrico. Diamantes verdes = entradas. Heat = atividade local.",color:"#34d399"},zona:{title:"ZONA DE AFETO",desc:"Campo movel que modula intensidades. Atrai afetos, mistura hues, deposita consistencia.",color:"#a78bfa"}},eJ=[.1,.25,.5,1,2,3];function wx(e,t,r){e=(e%360+360)%360;const o=(1-Math.abs(2*r-1))*t,s=o*(1-Math.abs(e/60%2-1)),l=r-o/2;let i=0,u=0,c=0;return e<60?(i=o,u=s):e<120?(i=s,u=o):e<180?(u=o,c=s):e<240?(u=s,c=o):e<300?(i=s,c=o):(i=o,c=s),[i+l,u+l,c+l]}function tJ(e,t){const r=[],o=[],s=new Map;if(t.has("cso")||t.has("connections")){for(const l of e.cso.organs){const i=r.length;s.set("o"+l.id,i);const[u,c,d]=wx(l.hue,.5,.55);r.push({nx:l.x,ny:l.y,z:l.importance*.5,r:u,g:c,b:d})}for(const l of e.cso.organs){const i=s.get("o"+l.id);if(i!==void 0)for(const u of l.connections){const c=s.get("o"+u);c!==void 0&&i<c&&o.push({a:i,b:c})}}}if(t.has("afetos"))for(const l of e.cso.affects){const[i,u,c]=wx(l.hue,.6,.5+l.intensity*.15);r.push({nx:l.x,ny:l.y,z:l.intensity*.3,r:i,g:u,b:c})}if(t.has("rizoma")){for(const i of e.rhizome.nodes){const u=r.length;s.set("r"+i.id,u);const[c,d,h]=wx(160+i.heat*40,.6,.45+i.heat*.2);r.push({nx:i.x,ny:i.y,z:i.heat*.4+.05,r:c,g:d,b:h})}const l=qv(e.rhizome);for(const i of l){const u=s.get("r"+i.from),c=s.get("r"+i.to);u!==void 0&&c!==void 0&&o.push({a:u,b:c})}}return{particles:r,links:o}}const nJ=({active:e})=>{var at,St;const[t,r]=w.useState(!0),[o,s]=w.useState(vx),[l,i]=w.useState("cso"),[u,c]=w.useState("select"),[d,h]=w.useState(new Set(["cso","afetos","rizoma","connections"])),[f,g]=w.useState(TZ),[m,y]=w.useState(""),[v,b]=w.useState(null),[S,C]=w.useState(!0),[k,R]=w.useState(1),[j,T]=w.useState(1),[_,P]=w.useState("2d"),[I,$]=w.useState(()=>{try{const ye=localStorage.getItem("mp_snapshots");return ye?JSON.parse(ye):[]}catch{return[]}}),q=w.useRef(null),L=w.useRef(null),H=w.useRef(null),G=w.useRef({...Td,showTrails:!0,trailLen:8,showBonds:!0,ptSize:4,camera:{yaw:.55,pitch:.48,dist:3,panX:0,panY:0}}),oe=w.useRef(dC(vx())),le=w.useRef(o),pe=w.useRef(t),ce=w.useRef(u),te=w.useRef(d),F=w.useRef([]),Q=w.useRef(f),ae=w.useRef(0),we=w.useRef(0),Re=w.useRef([]),ge=w.useRef(0),Ae=w.useRef(0),tt=w.useRef({zoom:1,panX:0,panY:0}),We=w.useRef(!1),J=w.useRef({x:0,y:0,vpx:0,vpy:0}),ke=w.useRef(j),Le=w.useRef(_),K=w.useRef(null),[et,dt]=w.useState(!1),[Rt,Wt]=w.useState(0),[Zt,$e]=w.useState([]);le.current=o,pe.current=t,ce.current=u,te.current=d,ke.current=j,Le.current=_;const Ze=w.useCallback(ye=>{oe.current=dC(ye),F.current=[],b(null)},[]),Fe=w.useCallback(ye=>{const xe=C5.find(gt=>gt.id===ye);xe&&(s({...xe.params}),h(new Set(xe.overlays)),y(ye),Ze(xe.params))},[Ze]),Xe=AZ(o),jt=w.useCallback(ye=>{s(jZ(ye)),y("")},[]),hn=w.useCallback(ye=>{h(xe=>{const gt=new Set(xe);return gt.has(ye)?gt.delete(ye):gt.add(ye),gt})},[]),an=w.useCallback((ye,xe)=>{const gt=q.current;if(!gt)return null;const Ge=gt.getBoundingClientRect(),Ye=tt.current,Ve=gt.width*.5+Ye.panX,Oe=gt.height*.5+Ye.panY,Gt=Math.min(gt.width,gt.height)*.47*Ye.zoom;return{wx:(ye-Ge.left-Ve)/Gt,wy:(xe-Ge.top-Oe)/Gt}},[]),it=w.useCallback(ye=>{if(ye.preventDefault(),ye.stopPropagation(),Le.current==="3d"){const Ve=G.current.camera;Ve.dist=Math.max(1,Math.min(10,Ve.dist+(ye.deltaY>0?.2:-.2)));return}const xe=tt.current,gt=ye.deltaY>0?.92:1.08,Ge=Math.max(.25,Math.min(5,xe.zoom*gt)),Ye=q.current;if(Ye){const Ve=Ye.getBoundingClientRect(),Oe=ye.clientX-Ve.left-Ye.width*.5,Gt=ye.clientY-Ve.top-Ye.height*.5,Kt=Ge/xe.zoom;xe.panX=Oe-(Oe-xe.panX)*Kt,xe.panY=Gt-(Gt-xe.panY)*Kt}xe.zoom=Ge,R(Ge)},[]),kt=w.useCallback((ye,xe)=>{const gt=oe.current;let Ge=.08,Ye=null;for(const Ve of gt.cso.organs){const Oe=Math.sqrt((Ve.x-ye)**2+(Ve.y-xe)**2);Oe<Ge&&(Ge=Oe,Ye={type:"orgao",id:Ve.id,x:Ve.x,y:Ve.y,importance:Ve.importance,health:Ve.health,nConns:Ve.connections.length,hue:Ve.hue})}for(const Ve of gt.rhizome.nodes){const Oe=Math.sqrt((Ve.x-ye)**2+(Ve.y-xe)**2);Oe<Ge&&(Ge=Oe,Ye={type:"no-rizoma",id:Ve.id,x:Ve.x,y:Ve.y,heat:Ve.heat,territory:Ve.territory,isEntry:Ve.isEntry,nConns:Ve.connections.length})}for(const Ve of gt.cso.zones){const Oe=Math.sqrt((Ve.x-ye)**2+(Ve.y-xe)**2);Oe<Ve.radius&&Oe<Ge+.05&&(Ye={type:"zona",x:Ve.x,y:Ve.y,strength:Ve.strength,hue:Ve.hue,radius:Ve.radius},Ge=Oe)}for(const Ve of gt.cso.affects){const Oe=Math.sqrt((Ve.x-ye)**2+(Ve.y-xe)**2);Oe<Math.min(Ge,.04)&&(Ge=Oe,Ye={type:"afeto",x:Ve.x,y:Ve.y,intensity:Ve.intensity,hue:Ve.hue,life:Ve.life})}b(Ye)},[]),On=w.useCallback(ye=>{if(ye.button===1||ye.button===0&&ye.altKey){if(ye.preventDefault(),We.current=!0,Le.current==="3d")J.current={x:ye.clientX,y:ye.clientY,vpx:G.current.camera.yaw,vpy:G.current.camera.pitch};else{const Ge=tt.current;J.current={x:ye.clientX,y:ye.clientY,vpx:Ge.panX,vpy:Ge.panY}}return}if(Le.current==="3d")return;const xe=an(ye.clientX,ye.clientY);if(!xe)return;const gt=ce.current;if(gt==="select"){kt(xe.wx,xe.wy);return}if(gt==="arrastar"){const Ge=oe.current;let Ye=.1,Ve=null;for(let Oe=0;Oe<Ge.cso.organs.length;Oe++){const Gt=Ge.cso.organs[Oe],Kt=Math.sqrt((Gt.x-xe.wx)**2+(Gt.y-xe.wy)**2);Kt<Ye&&(Ye=Kt,Ve={type:"organ",idx:Oe})}for(let Oe=0;Oe<Ge.rhizome.nodes.length;Oe++){const Gt=Ge.rhizome.nodes[Oe],Kt=Math.sqrt((Gt.x-xe.wx)**2+(Gt.y-xe.wy)**2);Kt<Ye&&(Ye=Kt,Ve={type:"rnode",idx:Oe})}for(let Oe=0;Oe<Ge.cso.zones.length;Oe++){const Gt=Ge.cso.zones[Oe],Kt=Math.sqrt((Gt.x-xe.wx)**2+(Gt.y-xe.wy)**2);Kt<Ye&&(Ye=Kt,Ve={type:"zone",idx:Oe})}K.current=Ve;return}uC(oe.current,gt,xe.wx,xe.wy,le.current,.15)},[an,kt]),sn=w.useCallback(ye=>{if(We.current){if(Le.current==="3d"){const Ge=G.current.camera;Ge.yaw=J.current.vpx+(ye.clientX-J.current.x)*.005,Ge.pitch=Math.max(.1,Math.min(1.4,J.current.vpy-(ye.clientY-J.current.y)*.005))}else{const Ge=tt.current;Ge.panX=J.current.vpx+(ye.clientX-J.current.x),Ge.panY=J.current.vpy+(ye.clientY-J.current.y)}return}if(ye.buttons!==1||Le.current==="3d")return;const xe=ce.current;if(xe==="select")return;if(xe==="arrastar"&&K.current){const Ge=an(ye.clientX,ye.clientY);if(!Ge)return;const Ye=oe.current,Ve=K.current;Ve.type==="organ"&&Ye.cso.organs[Ve.idx]?(Ye.cso.organs[Ve.idx].x=Ge.wx,Ye.cso.organs[Ve.idx].y=Ge.wy,Ye.cso.organs[Ve.idx].vx=0,Ye.cso.organs[Ve.idx].vy=0):Ve.type==="rnode"&&Ye.rhizome.nodes[Ve.idx]?(Ye.rhizome.nodes[Ve.idx].x=Ge.wx,Ye.rhizome.nodes[Ve.idx].y=Ge.wy,Ye.rhizome.nodes[Ve.idx].vx=0,Ye.rhizome.nodes[Ve.idx].vy=0):Ve.type==="zone"&&Ye.cso.zones[Ve.idx]&&(Ye.cso.zones[Ve.idx].x=Ge.wx,Ye.cso.zones[Ve.idx].y=Ge.wy);return}const gt=an(ye.clientX,ye.clientY);gt&&uC(oe.current,xe,gt.wx,gt.wy,le.current,.15)},[an]),Xn=w.useCallback(()=>{We.current=!1,K.current=null},[]),Pt=w.useCallback(()=>{const ye=Q.current,xe={id:XZ(),label:ye.plateauLabel,timestamp:Date.now(),params:{...le.current},K:ye.K,metrics:{...ye}};$(gt=>{const Ge=[xe,...gt].slice(0,6);return localStorage.setItem("mp_snapshots",JSON.stringify(Ge)),Ge})},[]),zt=w.useCallback(ye=>{s({...ye.params}),y("")},[]),jn=w.useCallback(()=>{tt.current={zoom:1,panX:0,panY:0},R(1)},[]),En=[{q:"Como voce se sente em relacao a estrutura e ordem na sua vida?",low:"Caos total",high:"Tudo organizado",params:["organismo","hierarquia"]},{q:"Qual a intensidade dos seus sentimentos agora?",low:"Amortecido",high:"Muito intenso",params:["intensidade","crueldade"]},{q:"Quanto desejo de romper padroes voce sente?",low:"Nenhum",high:"Quero destruir tudo",params:["desorganizacao","antiHabito"]},{q:"Como voce se sente em relacao a rigidez das suas conexoes?",low:"Tudo fluido",high:"Muito rigido",params:["rigidez"]},{q:"Quanta vontade de fugir, de escapar voce sente?",low:"Estou bem aqui",high:"Preciso sair",params:["linhasDeFuga"]},{q:"Quao conectado(a) voce se sente com diferentes mundos/pessoas?",low:"Isolado",high:"Hiperconectado",params:["multiplicidade","hubs"]},{q:"Quanto territorio voce quer marcar, defender?",low:"Sou nomade",high:"Defendo meu espaco",params:["territorializacao","reterritorializacao"]},{q:"Quanta turbulencia, ruido mental voce sente?",low:"Mente clara",high:"Muito ruido",params:["ruido"]},{q:"Quao povoado e o seu mundo interno?",low:"Vazio",high:"Transbordando",params:["densidade"]},{q:"Quanto voce quer esquecer, deixar ir?",low:"Guardo tudo",high:"Quero apagar",params:["esquecimento"]}],lt=w.useCallback(()=>{const ye=vx(),xe=Zt,gt=En;for(let Ge=0;Ge<gt.length&&Ge<xe.length;Ge++){const Ye=xe[Ge];for(const Ve of gt[Ge].params)ye[Ve]=Ye}s(ye),y(""),Ze(ye),dt(!1),Wt(0),$e([])},[Zt,Ze]);if(w.useEffect(()=>{if(!e||_!=="3d")return;const ye=L.current;if(!ye)return;H.current||(H.current=new Tv(ye));const xe=ye.parentElement;xe&&H.current.resize(xe.clientWidth,xe.clientHeight)},[e,_]),w.useEffect(()=>{if(!e)return;let ye=!1;we.current=performance.now();const xe=gt=>{if(ye)return;const Ge=gt-we.current;we.current=gt;const Ye=Math.min(Ge*.001,.04)*ke.current;if(Re.current.push(Ge),Re.current.length>60&&Re.current.shift(),pe.current&&DZ(oe.current,le.current,Ye),ge.current+=Ge,ge.current>125){ge.current=0;const Ve=Re.current.reduce((Kt,fn)=>Kt+fn,0)/Re.current.length,Oe=Ve>0?1e3/Ve:60,Gt=LZ(oe.current,le.current,Oe);Q.current=Gt,g(Gt)}if(Ae.current+=Ge,Ae.current>200&&(Ae.current=0,(te.current.has("rizoma")||te.current.has("flights"))&&(F.current=qv(oe.current.rhizome))),Le.current==="2d"){const Ve=q.current;if(Ve){const Oe=Ve.getContext("2d");if(Oe){const Gt=Q.current;zZ(Oe,Ve.width,Ve.height,oe.current.cso,oe.current.rhizome,oe.current.fields,te.current,le.current,F.current,oe.current.time,tt.current,{plateauLabel:Gt.plateauLabel,K:Gt.K,meanIntensity:Gt.meanIntensity})}}}else{const Ve=H.current;if(Ve&&Ve.isReady){const{particles:Oe,links:Gt}=tJ(oe.current,te.current);Ve.render(Oe,G.current,void 0,Gt)}}ae.current=requestAnimationFrame(xe)};return ae.current=requestAnimationFrame(xe),()=>{ye=!0,cancelAnimationFrame(ae.current)}},[e]),w.useEffect(()=>{if(!e)return;const ye=()=>{const xe=q.current;if(xe){const Ge=xe.parentElement;Ge&&(xe.width=Ge.clientWidth,xe.height=Ge.clientHeight)}const gt=L.current;if(gt&&H.current){const Ge=gt.parentElement;Ge&&H.current.resize(Ge.clientWidth,Ge.clientHeight)}};return ye(),window.addEventListener("resize",ye),()=>window.removeEventListener("resize",ye)},[e]),w.useEffect(()=>{var gt;if(!e)return;const ye=(gt=q.current)==null?void 0:gt.parentElement;if(!ye)return;const xe=Ge=>{Ge.preventDefault()};return ye.addEventListener("wheel",xe,{passive:!1}),()=>ye.removeEventListener("wheel",xe)},[e]),!e)return null;const ht=J7(o),_t=l==="cso"?pC:l==="rizoma"?mC:[...pC,...mC],Ie=v?QZ[v.type]:null;return a.jsxs("div",{className:"fixed inset-0 flex",style:{fontFamily:lo,background:"#040408",color:"rgba(255,255,255,0.88)"},children:[a.jsxs("div",{className:"flex-1 relative",style:{minWidth:0},children:[a.jsx("canvas",{ref:q,onWheel:it,onMouseDown:On,onMouseMove:sn,onMouseUp:Xn,onMouseLeave:Xn,onContextMenu:ye=>ye.preventDefault(),style:{width:"100%",height:"100%",cursor:u!=="select"?"crosshair":"pointer",display:_==="2d"?"block":"none"}}),a.jsx("canvas",{ref:L,onWheel:it,onMouseDown:On,onMouseMove:sn,onMouseUp:Xn,onMouseLeave:Xn,onContextMenu:ye=>ye.preventDefault(),style:{width:"100%",height:"100%",display:_==="3d"?"block":"none"}}),a.jsxs("div",{style:{position:"absolute",top:56,right:312,display:"flex",gap:2},children:[a.jsx("button",{onClick:()=>P("2d"),title:"Visualizao 2D",style:{background:_==="2d"?"rgba(99,102,241,0.2)":"rgba(0,0,0,0.6)",border:_==="2d"?`1px solid ${Jr}`:"1px solid rgba(255,255,255,0.1)",borderRadius:3,padding:"3px 8px",cursor:"pointer",fontSize:7.5,fontWeight:600,color:_==="2d"?Jr:"rgba(255,255,255,0.4)",fontFamily:lo},children:"2D"}),a.jsx("button",{onClick:()=>P("3d"),title:"Visualizao 3D",style:{background:_==="3d"?"rgba(99,102,241,0.2)":"rgba(0,0,0,0.6)",border:_==="3d"?`1px solid ${Jr}`:"1px solid rgba(255,255,255,0.1)",borderRadius:3,padding:"3px 8px",cursor:"pointer",fontSize:7.5,fontWeight:600,color:_==="3d"?Jr:"rgba(255,255,255,0.4)",fontFamily:lo},children:"3D"})]}),a.jsxs("div",{style:{position:"absolute",top:56,left:12,display:"flex",gap:2,alignItems:"center"},children:[a.jsx("span",{style:{fontSize:6.5,color:"rgba(255,255,255,0.25)",fontFamily:lo},children:"VEL"}),eJ.map(ye=>a.jsxs("button",{onClick:()=>T(ye),title:`Velocidade ${ye}x`,style:{background:j===ye?"rgba(99,102,241,0.2)":"rgba(0,0,0,0.6)",border:j===ye?`1px solid ${Jr}`:"1px solid rgba(255,255,255,0.08)",borderRadius:3,padding:"2px 5px",cursor:"pointer",fontSize:7,color:j===ye?Jr:"rgba(255,255,255,0.35)",fontFamily:lo},children:[ye,"x"]},ye))]}),_==="2d"&&a.jsxs("div",{style:{position:"absolute",bottom:12,right:312,background:"rgba(0,0,0,0.75)",borderRadius:4,padding:"3px 8px",fontSize:7,color:"rgba(255,255,255,0.35)",fontFamily:lo,pointerEvents:"none"},children:[(k*100).toFixed(0),"% | alt+arraste = pan | scroll = zoom"]}),_==="3d"&&a.jsx("div",{style:{position:"absolute",bottom:12,right:312,background:"rgba(0,0,0,0.75)",borderRadius:4,padding:"3px 8px",fontSize:7,color:"rgba(255,255,255,0.35)",fontFamily:lo,pointerEvents:"none"},children:"3D | alt+arraste = orbitar | scroll = distancia"}),k!==1&&_==="2d"&&a.jsx("button",{onClick:jn,title:"Resetar zoom",style:{position:"absolute",bottom:30,right:312,background:"rgba(0,0,0,0.75)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:4,padding:"3px 8px",cursor:"pointer",fontSize:7,color:Jr,fontFamily:lo},children:"Reset zoom"}),u!=="select"&&a.jsxs("div",{style:{position:"absolute",bottom:12,left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.85)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:6,padding:"4px 14px",fontSize:8.5,color:"rgba(255,255,255,0.5)",fontFamily:lo,pointerEvents:"none"},children:[(at=Sx.find(ye=>ye.id===u))==null?void 0:at.icon," ",(St=Sx.find(ye=>ye.id===u))==null?void 0:St.label]}),v&&Ie&&a.jsx(Qf,{id:"mp_inspect",title:Ie.title,titleColor:Ie.color,defaultX:12,defaultY:80,zIndex:40,width:220,children:a.jsxs("div",{style:{padding:"6px 10px",fontSize:8,color:"rgba(255,255,255,0.7)",fontFamily:lo},children:[a.jsx("div",{style:{fontSize:7,color:"rgba(255,255,255,0.35)",marginBottom:5,lineHeight:1.4},children:Ie.desc}),a.jsxs("div",{style:{borderTop:"1px solid rgba(255,255,255,0.06)",paddingTop:4},children:[v.type==="afeto"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:["Intensidade: ",a.jsx("span",{style:{color:"#fbbf24"},children:v.intensity.toFixed(2)})]}),a.jsxs("div",{children:["Hue: ",a.jsx("span",{style:{color:`hsl(${v.hue},70%,60%)`},children:v.hue.toFixed(0)})]}),a.jsxs("div",{children:["Vida: ",a.jsx("span",{style:{color:"#6ee7b7"},children:v.life})]})]}),v.type==="orgao"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:["Importancia: ",a.jsx("span",{style:{color:"#60a5fa"},children:v.importance.toFixed(2)})]}),a.jsxs("div",{children:["Saude: ",a.jsx("span",{style:{color:v.health>.5?"#6ee7b7":"#ef4444"},children:v.health.toFixed(2)})]}),a.jsxs("div",{children:["Conexoes: ",a.jsx("span",{style:{color:"#fb923c"},children:v.nConns})]})]}),v.type==="no-rizoma"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:["Heat: ",a.jsx("span",{style:{color:"#fbbf24"},children:v.heat.toFixed(2)})]}),a.jsxs("div",{children:["Territorio: ",a.jsx("span",{style:{color:"#f97316"},children:v.territory.toFixed(2)})]}),a.jsxs("div",{children:["Entrada: ",a.jsx("span",{style:{color:v.isEntry?"#34d399":"#94a3b8"},children:v.isEntry?"Sim":"Nao"})]}),a.jsxs("div",{children:["Conexoes: ",a.jsx("span",{style:{color:"#60a5fa"},children:v.nConns})]})]}),v.type==="zona"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:["Forca: ",a.jsx("span",{style:{color:"#a78bfa"},children:v.strength.toFixed(2)})]}),a.jsxs("div",{children:["Raio: ",a.jsx("span",{style:{color:"#60a5fa"},children:v.radius.toFixed(3)})]})]}),a.jsxs("div",{style:{color:"rgba(255,255,255,0.20)",marginTop:2},children:["(",v.x.toFixed(3),", ",v.y.toFixed(3),")"]})]})]})}),a.jsx(Qf,{id:"mp_legend",title:"LEGENDA",titleColor:"rgba(255,255,255,0.25)",defaultX:12,defaultY:Math.max(200,window.innerHeight-200),zIndex:35,width:160,children:a.jsxs("div",{style:{padding:"4px 8px 6px",fontSize:6.5,fontFamily:lo,color:"rgba(255,255,255,0.35)",lineHeight:1.7},children:[a.jsxs("div",{children:[a.jsx("span",{style:{color:"#60a5fa"},children:""})," Orgaos (estratificacao)"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#fbbf24"},children:""})," Afetos (intensidades)"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#34d399"},children:""})," Nos rizoma (entradas)"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#60a5fa"},children:""})," Conexoes rizoma"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#a78bfa"},children:"- -"})," Linhas de fuga"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"rgba(99,102,241,0.5)"},children:""})," Consistencia (azul)"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"rgba(251,191,36,0.5)"},children:""})," Territorio (ambar)"]}),a.jsx("div",{style:{marginTop:2,color:"rgba(255,255,255,0.15)"},children:"clique = inspecionar"})]})}),oe.current.cso.events.length>0&&a.jsx("div",{style:{position:"absolute",top:80,right:312,maxWidth:240,pointerEvents:"none"},children:oe.current.cso.events.slice(-4).map((ye,xe)=>a.jsxs("div",{style:{fontSize:7.5,color:ye.color,fontFamily:lo,background:"rgba(0,0,0,0.7)",padding:"2px 6px",borderRadius:3,marginBottom:2,opacity:Math.min(1,ye.ttl/60)},children:[ye.type==="ruptura"?"!":ye.type==="reconexao"?"~":"*"," ",ye.message]},xe))})]}),a.jsxs("div",{className:"flex-shrink-0 overflow-y-auto",style:{width:300,borderLeft:"1px solid rgba(255,255,255,0.06)",background:"rgba(0,0,0,0.93)",padding:"52px 10px 16px"},children:[a.jsx("div",{style:{fontFamily:M5,fontSize:15,fontWeight:700,color:Jr,marginBottom:1},children:"MIL PLATOS"}),a.jsx("div",{style:{fontSize:8,color:"rgba(255,255,255,0.30)",marginBottom:6,lineHeight:1.4},children:"Clique em qualquer elemento para inspecionar. Scroll = zoom. Alt+arraste = pan."}),a.jsxs("div",{style:{display:"flex",gap:4,marginBottom:6},children:[a.jsx(k5,{label:t?"II":">",onClick:()=>r(!t)}),a.jsx(k5,{label:"R",onClick:()=>Ze(o)}),a.jsx("div",{style:{flex:1}}),a.jsx(k5,{label:"+ Plato",onClick:Pt}),a.jsx(k5,{label:"Jornada",onClick:()=>{dt(!0),Wt(0),$e([])}})]}),a.jsx(ad,{label:"EIXO CsO"}),a.jsxs("div",{style:{fontSize:7,color:"rgba(255,255,255,0.25)",display:"flex",justifyContent:"space-between",marginBottom:2},children:[a.jsx("span",{children:"Corpo c/ Orgaos"}),a.jsx("span",{children:"CsO"})]}),a.jsx("input",{type:"range",min:0,max:1,step:.01,value:Xe,onChange:ye=>jt(parseFloat(ye.target.value)),style:{width:"100%",accentColor:Jr}}),a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[a.jsxs("span",{style:{fontSize:8,color:Jr},children:[(Xe*100).toFixed(0),"% CsO"]}),a.jsxs("span",{style:{fontSize:8,color:"#f472b6"},children:["K=",ht.toFixed(2)]})]}),a.jsx("div",{style:{display:"flex",gap:2,marginBottom:4},children:["cso","rizoma","platos"].map(ye=>a.jsx("button",{onClick:()=>i(ye),title:ye==="cso"?"Corpo sem rgos":ye==="rizoma"?"Rizoma":"Plats",style:{flex:1,padding:"3px 0",borderRadius:3,cursor:"pointer",fontSize:7.5,fontWeight:600,fontFamily:lo,textTransform:"uppercase",background:l===ye?"rgba(99,102,241,0.15)":"rgba(255,255,255,0.03)",border:l===ye?`1px solid ${Jr}`:"1px solid rgba(255,255,255,0.06)",color:l===ye?Jr:"rgba(255,255,255,0.4)"},children:ye==="cso"?"CsO":ye==="rizoma"?"Rizoma":"Platos"},ye))}),a.jsx(ad,{label:l==="cso"?"PARAMETROS CsO":l==="rizoma"?"PARAMETROS RIZOMA":"TODOS OS PARAMETROS"}),_t.map(ye=>a.jsx(gC,{label:ye.label,color:ye.color,value:o[ye.key],onChange:xe=>{s(gt=>({...gt,[ye.key]:xe})),y("")}},ye.key)),ZZ.map(ye=>a.jsx(gC,{label:ye.label,color:ye.color,value:o[ye.key],onChange:xe=>{s(gt=>({...gt,[ye.key]:xe})),y("")}},ye.key)),a.jsx(ad,{label:"INTERVENCOES"}),a.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",gap:2,marginBottom:6},children:Sx.map(ye=>a.jsxs("button",{onClick:()=>c(ye.id),title:ye.desc,style:{background:u===ye.id?"rgba(255,255,255,0.10)":"rgba(255,255,255,0.02)",border:u===ye.id?`1px solid ${ye.color}`:"1px solid rgba(255,255,255,0.05)",borderRadius:3,padding:"3px 2px",cursor:"pointer",fontSize:7,color:u===ye.id?ye.color:"rgba(255,255,255,0.4)",textAlign:"center",fontFamily:lo,lineHeight:1.3},children:[a.jsx("div",{style:{fontSize:11},children:ye.icon}),ye.label]},ye.id))}),a.jsx(ad,{label:"CAMADAS"}),a.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:2,marginBottom:6},children:JZ.map(ye=>a.jsx("button",{onClick:()=>hn(ye.key),title:ye.label,style:{background:d.has(ye.key)?"rgba(99,102,241,0.12)":"rgba(255,255,255,0.02)",border:d.has(ye.key)?`1px solid ${Jr}`:"1px solid rgba(255,255,255,0.05)",borderRadius:3,padding:"2px 6px",cursor:"pointer",fontSize:7,color:d.has(ye.key)?Jr:"rgba(255,255,255,0.35)",fontFamily:lo},children:ye.label},ye.key))}),a.jsx(ad,{label:"DIAGNOSTICOS"}),a.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1px 8px",marginBottom:4},children:[a.jsx(zu,{label:"FPS",value:f.fps.toFixed(0),color:"#6ee7b7"}),a.jsx(zu,{label:"Afetos",value:`${f.nAffects}`,color:"#fbbf24"}),a.jsx(zu,{label:"Orgaos",value:`${f.nOrgans}`,color:"#60a5fa"}),a.jsx(zu,{label:"Nos",value:`${f.nRhizomeNodes}`,color:"#34d399"}),a.jsx(zu,{label:"Arestas",value:`${f.nRhizomeEdges}`,color:"#60a5fa"}),a.jsx(zu,{label:"Rupturas",value:`${f.ruptureRate}`,color:"#ef4444"})]}),a.jsx(Pf,{label:"Hub Dominance",value:f.hubDominance,color:"#f472b6"}),a.jsx(Pf,{label:"Crueldade",value:f.crueltyPressure,color:"#ef4444"}),a.jsx(Pf,{label:"Intensidade",value:f.meanIntensity,color:"#fbbf24"}),a.jsx(Pf,{label:"Entropia",value:f.fieldEntropy,color:"#38bdf8"}),a.jsx(Pf,{label:"Memoria",value:f.memoryLoad,color:"#f97316"}),a.jsxs("div",{style:{textAlign:"center",padding:"4px 6px",margin:"4px 0",background:"rgba(99,102,241,0.06)",border:"1px solid rgba(99,102,241,0.10)",borderRadius:4},children:[a.jsx("div",{style:{fontSize:6.5,color:"rgba(255,255,255,0.25)",textTransform:"uppercase",letterSpacing:1},children:"Plato"}),a.jsx("div",{style:{fontSize:10,fontFamily:M5,fontWeight:600,color:Jr},children:f.plateauLabel})]}),m&&(()=>{const ye=C5.find(xe=>xe.id===m);return ye!=null&&ye.theory?a.jsxs("div",{style:{margin:"6px 0",padding:"8px 10px",background:"rgba(99,102,241,0.04)",border:"1px solid rgba(99,102,241,0.10)",borderRadius:5},children:[a.jsx("div",{style:{fontSize:6.5,fontWeight:600,color:"rgba(255,255,255,0.22)",textTransform:"uppercase",letterSpacing:1.5,marginBottom:4,fontFamily:lo,borderBottom:"1px solid rgba(255,255,255,0.03)",paddingBottom:2},children:"TEORIA"}),ye.plateauRef&&a.jsx("div",{style:{fontSize:7.5,color:Jr,fontWeight:600,marginBottom:5,fontFamily:M5,lineHeight:1.3},children:ye.plateauRef}),a.jsx("div",{style:{fontSize:7.5,color:"rgba(255,255,255,0.50)",lineHeight:1.55,fontFamily:lo,textAlign:"justify"},children:ye.theory})]}):null})(),I.length>0&&a.jsxs(a.Fragment,{children:[a.jsx(ad,{label:"PLATOS CAPTURADOS"}),I.map(ye=>a.jsxs("button",{onClick:()=>zt(ye),title:`Carregar: ${ye.label}`,style:{width:"100%",padding:"3px 5px",borderRadius:3,cursor:"pointer",background:"rgba(255,255,255,0.02)",border:"1px solid rgba(255,255,255,0.05)",color:"rgba(255,255,255,0.55)",fontSize:7,fontFamily:lo,textAlign:"left",marginBottom:2},children:[a.jsx("strong",{style:{color:Jr},children:ye.label}),a.jsxs("span",{style:{color:"rgba(255,255,255,0.25)",marginLeft:4},children:["K=",ye.K.toFixed(2)]})]},ye.id))]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",cursor:"pointer",marginTop:6},onClick:()=>C(!S),children:[a.jsx(ad,{label:`PRESETS (${C5.length})`}),a.jsx("span",{style:{fontSize:10,color:"rgba(255,255,255,0.25)",marginLeft:"auto",marginTop:4},children:S?"v":">"})]}),S&&a.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2,marginTop:2},children:C5.map(ye=>a.jsxs("button",{onClick:()=>Fe(ye.id),title:`${ye.name}: ${ye.description}`,style:{background:m===ye.id?"rgba(99,102,241,0.12)":"rgba(255,255,255,0.02)",border:m===ye.id?`1px solid ${Jr}`:"1px solid rgba(255,255,255,0.04)",borderRadius:3,padding:"4px 4px 3px",cursor:"pointer",textAlign:"left"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:3,marginBottom:1},children:[a.jsx("span",{style:{fontSize:10},children:ye.icon}),a.jsx("span",{style:{fontSize:7,fontWeight:500,color:m===ye.id?Jr:"rgba(255,255,255,0.55)"},children:ye.name})]}),a.jsx("div",{style:{fontSize:6,color:"rgba(255,255,255,0.20)",lineHeight:1.2},children:ye.description})]},ye.id))}),et&&a.jsx("div",{style:{position:"fixed",inset:0,zIndex:100,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.85)"},children:a.jsxs("div",{style:{background:"rgba(10,10,20,0.98)",border:"1px solid rgba(99,102,241,0.2)",borderRadius:8,padding:"24px 32px",maxWidth:460,width:"90%",fontFamily:lo},children:[a.jsx("div",{style:{fontFamily:M5,fontSize:14,fontWeight:700,color:Jr,marginBottom:4},children:"JORNADA CsO"}),a.jsxs("div",{style:{fontSize:7.5,color:"rgba(255,255,255,0.3)",marginBottom:16},children:["Pergunta ",Rt+1," de ",En.length]}),Rt<En.length?a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{fontSize:10,color:"rgba(255,255,255,0.8)",marginBottom:16,lineHeight:1.5},children:En[Rt].q}),a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:7,color:"rgba(255,255,255,0.3)",marginBottom:4},children:[a.jsx("span",{children:En[Rt].low}),a.jsx("span",{children:En[Rt].high})]}),a.jsx("input",{type:"range",min:0,max:1,step:.05,value:Zt[Rt]??.5,onChange:ye=>{const xe=parseFloat(ye.target.value);$e(gt=>{const Ge=[...gt];return Ge[Rt]=xe,Ge})},style:{width:"100%",accentColor:Jr,marginBottom:16}}),a.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[Rt>0&&a.jsx("button",{onClick:()=>Wt(ye=>ye-1),title:"Voltar  pergunta anterior",style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:4,padding:"6px 16px",cursor:"pointer",color:"rgba(255,255,255,0.5)",fontSize:9,fontFamily:lo},children:"Voltar"}),a.jsx("button",{onClick:()=>{Zt[Rt]===void 0&&$e(ye=>{const xe=[...ye];return xe[Rt]=.5,xe}),Wt(ye=>ye+1)},title:"Prximo passo",style:{background:"rgba(99,102,241,0.15)",border:"1px solid "+Jr,borderRadius:4,padding:"6px 16px",cursor:"pointer",color:Jr,fontSize:9,fontFamily:lo,fontWeight:600},children:Rt<En.length-1?"Proximo":"Gerar CsO"})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{fontSize:10,color:"rgba(255,255,255,0.7)",marginBottom:16,lineHeight:1.5},children:"Seu Corpo sem Orgaos esta pronto. Clique para gerar a simulacao personalizada."}),a.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[a.jsx("button",{onClick:()=>dt(!1),title:"Cancelar jornada",style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:4,padding:"6px 16px",cursor:"pointer",color:"rgba(255,255,255,0.5)",fontSize:9,fontFamily:lo},children:"Cancelar"}),a.jsx("button",{onClick:lt,title:"Gerar seu Corpo sem rgos",style:{background:"rgba(99,102,241,0.15)",border:"1px solid "+Jr,borderRadius:4,padding:"6px 16px",cursor:"pointer",color:Jr,fontSize:9,fontFamily:lo,fontWeight:600},children:"Gerar meu CsO"})]})]})]})})]})]})},ad=({label:e})=>a.jsx("div",{style:{fontSize:6.5,fontWeight:600,color:"rgba(255,255,255,0.22)",textTransform:"uppercase",letterSpacing:1.5,marginBottom:3,marginTop:6,fontFamily:lo,borderBottom:"1px solid rgba(255,255,255,0.03)",paddingBottom:2},children:e}),gC=({label:e,color:t,value:r,onChange:o})=>a.jsxs("div",{style:{marginBottom:3},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:7,marginBottom:1},children:[a.jsx("span",{style:{color:t},children:e}),a.jsx("span",{style:{color:"rgba(255,255,255,0.35)"},children:r.toFixed(2)})]}),a.jsx("input",{type:"range",min:0,max:1,step:.01,value:r,onChange:s=>o(parseFloat(s.target.value)),style:{width:"100%",height:3,accentColor:t}})]}),zu=({label:e,value:t,color:r})=>a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:7,marginBottom:1},children:[a.jsx("span",{style:{color:"rgba(255,255,255,0.35)"},children:e}),a.jsx("span",{style:{color:r,fontWeight:500},children:t})]}),Pf=({label:e,value:t,color:r})=>a.jsxs("div",{style:{marginBottom:2},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:6.5,marginBottom:1},children:[a.jsx("span",{style:{color:"rgba(255,255,255,0.30)"},children:e}),a.jsxs("span",{style:{color:r},children:[(fC(t)*100).toFixed(0),"%"]})]}),a.jsx("div",{style:{height:2.5,background:"rgba(255,255,255,0.05)",borderRadius:2,overflow:"hidden"},children:a.jsx("div",{style:{height:"100%",width:`${fC(t)*100}%`,background:r,borderRadius:2,transition:"width 0.15s"}})})]}),k5=({label:e,onClick:t})=>a.jsx("button",{onClick:t,title:e,style:{background:"rgba(255,255,255,0.04)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:3,padding:"3px 8px",cursor:"pointer",color:Jr,fontSize:10,fontFamily:lo},children:e}),ha={p127a1200:"M30.8298 9.68937C27.8936 9.68937 25.8383 7.63405 25.8383 4.69787C25.8383 2.05533 27.8936 0 30.8298 0C33.4724 0 35.5277 2.05533 35.5277 4.69787C35.5277 7.63405 33.4724 9.68937 30.8298 9.68937ZM56.6681 190.851C53.732 190.851 51.6766 188.796 51.6766 185.86C51.6766 183.217 53.732 181.162 56.6681 181.162C59.3107 181.162 61.366 183.217 61.366 185.86C61.366 188.796 59.3107 190.851 56.6681 190.851ZM30.8298 160.902C27.8936 160.902 25.8383 158.847 25.8383 155.911C25.8383 153.268 27.8936 151.213 30.8298 151.213C33.4724 151.213 35.5277 153.268 35.5277 155.911C35.5277 158.847 33.4724 160.902 30.8298 160.902ZM82.5064 190.851C79.5703 190.851 77.5149 188.796 77.5149 185.86C77.5149 183.217 79.5703 181.162 82.5064 181.162C85.149 181.162 87.2043 183.217 87.2043 185.86C87.2043 188.796 85.149 190.851 82.5064 190.851ZM30.8298 130.66C27.8936 130.66 25.8383 128.604 25.8383 125.668C25.8383 123.026 28.1873 120.97 30.8298 120.97C33.4724 120.97 35.5277 123.026 35.5277 125.668C35.5277 128.604 33.4724 130.66 30.8298 130.66ZM108.051 190.851C105.115 190.851 103.06 188.796 103.06 185.86C103.06 183.217 105.115 181.162 108.051 181.162C110.694 181.162 112.749 183.217 112.749 185.86C112.749 188.796 110.694 190.851 108.051 190.851ZM30.8298 100.417C27.8936 100.417 25.8383 98.3618 25.8383 95.4256C25.8383 92.783 28.1873 90.7277 30.8298 90.7277C33.4724 90.7277 35.5277 92.783 35.5277 95.4256C35.5277 98.3618 33.4724 100.417 30.8298 100.417ZM4.99149 70.1745C2.05532 70.1745 0 68.1192 0 65.183C0 62.5405 2.05532 60.4851 4.99149 60.4851C7.63405 60.4851 9.68937 62.5405 9.68937 65.183C9.68937 68.1192 7.63405 70.1745 4.99149 70.1745ZM30.8298 70.1745C27.8936 70.1745 25.8383 68.1192 25.8383 65.183C25.8383 62.5405 27.8936 60.4851 30.8298 60.4851C33.4724 60.4851 35.5277 62.5405 35.5277 65.183C35.5277 68.1192 33.4724 70.1745 30.8298 70.1745ZM56.6681 70.1745C53.732 70.1745 51.6766 68.1192 51.6766 65.183C51.6766 62.5405 53.732 60.4851 56.6681 60.4851C59.3107 60.4851 61.366 62.5405 61.366 65.183C61.366 68.1192 59.3107 70.1745 56.6681 70.1745ZM30.8298 39.9319C27.8936 39.9319 25.8383 37.8766 25.8383 34.9405C25.8383 32.2979 27.8936 30.2426 30.8298 30.2426C33.4724 30.2426 35.5277 32.2979 35.5277 34.9405C35.5277 37.8766 33.4724 39.9319 30.8298 39.9319ZM82.5064 70.1745C79.5703 70.1745 77.5149 68.1192 77.5149 65.183C77.5149 62.5405 79.5703 60.4851 82.5064 60.4851C85.149 60.4851 87.2043 62.5405 87.2043 65.183C87.2043 68.1192 85.149 70.1745 82.5064 70.1745Z",p161bb100:"M383.733 249.438C380.796 249.438 378.741 247.382 378.741 244.446C378.741 241.804 380.796 239.748 383.733 239.748C386.375 239.748 388.431 241.804 388.431 244.446C388.431 247.382 386.375 249.438 383.733 249.438ZM280.379 370.114C277.443 370.114 275.388 368.059 275.388 365.123C275.388 362.48 277.443 360.425 280.379 360.425C283.022 360.425 285.077 362.48 285.077 365.123C285.077 368.059 283.022 370.114 280.379 370.114ZM306.218 370.114C303.282 370.114 301.226 368.059 301.226 365.123C301.226 362.48 303.282 360.425 306.218 360.425C308.86 360.425 310.916 362.48 310.916 365.123C310.916 368.059 308.86 370.114 306.218 370.114ZM332.056 370.114C329.12 370.114 327.065 368.059 327.065 365.123C327.065 362.48 329.12 360.425 332.056 360.425C334.699 360.425 336.754 362.48 336.754 365.123C336.754 368.059 334.699 370.114 332.056 370.114ZM306.218 340.165C303.282 340.165 301.226 338.11 301.226 335.174C301.226 332.531 303.282 330.476 306.218 330.476C308.86 330.476 310.916 332.531 310.916 335.174C310.916 338.11 308.86 340.165 306.218 340.165ZM357.894 370.114C354.958 370.114 352.903 368.059 352.903 365.123C352.903 362.48 354.958 360.425 357.894 360.425C360.537 360.425 362.592 362.48 362.592 365.123C362.592 368.059 360.537 370.114 357.894 370.114ZM306.218 309.923C303.282 309.923 301.226 307.867 301.226 304.931C301.226 302.289 303.575 300.233 306.218 300.233C308.86 300.233 310.916 302.289 310.916 304.931C310.916 307.867 308.86 309.923 306.218 309.923ZM306.218 279.68C303.282 279.68 301.226 277.625 301.226 274.689C301.226 272.046 303.575 269.991 306.218 269.991C308.86 269.991 310.916 272.046 310.916 274.689C310.916 277.625 308.86 279.68 306.218 279.68ZM280.379 249.438C277.443 249.438 275.388 247.382 275.388 244.446C275.388 241.804 277.443 239.748 280.379 239.748C283.022 239.748 285.077 241.804 285.077 244.446C285.077 247.382 283.022 249.438 280.379 249.438ZM332.056 279.68C329.12 279.68 327.065 277.625 327.065 274.689C327.065 272.046 329.413 269.991 332.056 269.991C334.699 269.991 336.754 272.046 336.754 274.689C336.754 277.625 334.699 279.68 332.056 279.68ZM306.218 249.438C303.282 249.438 301.226 247.382 301.226 244.446C301.226 241.804 303.282 239.748 306.218 239.748C308.86 239.748 310.916 241.804 310.916 244.446C310.916 247.382 308.86 249.438 306.218 249.438ZM357.894 249.438C354.958 249.438 352.903 247.382 352.903 244.446C352.903 241.804 354.958 239.748 357.894 239.748C360.537 239.748 362.592 241.804 362.592 244.446C362.592 247.382 360.537 249.438 357.894 249.438Z",p17fb5300:"M221.477 249.438C218.541 249.438 216.486 247.382 216.486 244.446C216.486 241.804 218.541 239.748 221.477 239.748C224.12 239.748 226.175 241.804 226.175 244.446C226.175 247.382 224.12 249.438 221.477 249.438ZM169.8 370.114C166.864 370.114 164.809 368.059 164.809 365.123C164.809 362.48 166.864 360.425 169.8 360.425C172.443 360.425 174.498 362.48 174.498 365.123C174.498 368.059 172.443 370.114 169.8 370.114ZM143.962 340.165C141.026 340.165 138.971 338.11 138.971 335.174C138.971 332.531 141.026 330.476 143.962 330.476C146.605 330.476 148.66 332.531 148.66 335.174C148.66 338.11 146.605 340.165 143.962 340.165ZM195.639 370.114C192.703 370.114 190.647 368.059 190.647 365.123C190.647 362.48 192.703 360.425 195.639 360.425C198.281 360.425 200.337 362.48 200.337 365.123C200.337 368.059 198.281 370.114 195.639 370.114ZM143.962 309.923C141.026 309.923 138.971 307.867 138.971 304.931C138.971 302.289 141.32 300.233 143.962 300.233C146.605 300.233 148.66 302.289 148.66 304.931C148.66 307.867 146.605 309.923 143.962 309.923ZM221.477 370.114C218.541 370.114 216.486 368.059 216.486 365.123C216.486 362.48 218.541 360.425 221.477 360.425C224.12 360.425 226.175 362.48 226.175 365.123C226.175 368.059 224.12 370.114 221.477 370.114ZM169.8 309.923C166.864 309.923 164.809 307.867 164.809 304.931C164.809 302.289 167.158 300.233 169.8 300.233C172.443 300.233 174.498 302.289 174.498 304.931C174.498 307.867 172.443 309.923 169.8 309.923ZM143.962 279.68C141.026 279.68 138.971 277.625 138.971 274.689C138.971 272.046 141.32 269.991 143.962 269.991C146.605 269.991 148.66 272.046 148.66 274.689C148.66 277.625 146.605 279.68 143.962 279.68ZM247.315 370.114C244.379 370.114 242.324 368.059 242.324 365.123C242.324 362.48 244.379 360.425 247.315 360.425C249.958 360.425 252.013 362.48 252.013 365.123C252.013 368.059 249.958 370.114 247.315 370.114ZM195.639 309.923C192.703 309.923 190.647 307.867 190.647 304.931C190.647 302.289 192.996 300.233 195.639 300.233C198.281 300.233 200.337 302.289 200.337 304.931C200.337 307.867 198.281 309.923 195.639 309.923ZM221.477 309.923C218.541 309.923 216.486 307.867 216.486 304.931C216.486 302.289 218.834 300.233 221.477 300.233C224.12 300.233 226.175 302.289 226.175 304.931C226.175 307.867 224.12 309.923 221.477 309.923ZM169.8 249.438C166.864 249.438 164.809 247.382 164.809 244.446C164.809 241.804 166.864 239.748 169.8 239.748C172.443 239.748 174.498 241.804 174.498 244.446C174.498 247.382 172.443 249.438 169.8 249.438ZM247.315 309.923C244.379 309.923 242.324 307.867 242.324 304.931C242.324 302.289 244.673 300.233 247.315 300.233C249.958 300.233 252.013 302.289 252.013 304.931C252.013 307.867 249.958 309.923 247.315 309.923ZM195.639 249.438C192.703 249.438 190.647 247.382 190.647 244.446C190.647 241.804 192.703 239.748 195.639 239.748C198.281 239.748 200.337 241.804 200.337 244.446C200.337 247.382 198.281 249.438 195.639 249.438ZM247.315 279.68C244.379 279.68 242.324 277.625 242.324 274.689C242.324 272.046 244.673 269.991 247.315 269.991C249.958 269.991 252.013 272.046 252.013 274.689C252.013 277.625 249.958 279.68 247.315 279.68Z",p1fde8480:"M1017.96 188.952C1015.02 188.952 1012.97 186.897 1012.97 183.961C1012.97 181.318 1015.02 179.263 1017.96 179.263C1020.6 179.263 1022.66 181.318 1022.66 183.961C1022.66 186.897 1020.6 188.952 1017.96 188.952ZM940.445 370.114C937.509 370.114 935.453 368.059 935.453 365.123C935.453 362.48 937.509 360.425 940.445 360.425C943.087 360.425 945.143 362.48 945.143 365.123C945.143 368.059 943.087 370.114 940.445 370.114ZM966.283 370.114C963.347 370.114 961.292 368.059 961.292 365.123C961.292 362.48 963.347 360.425 966.283 360.425C968.926 360.425 970.981 362.48 970.981 365.123C970.981 368.059 968.926 370.114 966.283 370.114ZM992.121 370.114C989.185 370.114 987.13 368.059 987.13 365.123C987.13 362.48 989.185 360.425 992.121 360.425C994.764 360.425 996.819 362.48 996.819 365.123C996.819 368.059 994.764 370.114 992.121 370.114ZM1017.96 370.114C1015.02 370.114 1012.97 368.059 1012.97 365.123C1012.97 362.48 1015.02 360.425 1017.96 360.425C1020.6 360.425 1022.66 362.48 1022.66 365.123C1022.66 368.059 1020.6 370.114 1017.96 370.114ZM992.121 340.165C989.185 340.165 987.13 338.11 987.13 335.174C987.13 332.531 989.185 330.476 992.121 330.476C994.764 330.476 996.819 332.531 996.819 335.174C996.819 338.11 994.764 340.165 992.121 340.165ZM1043.8 370.114C1040.86 370.114 1038.81 368.059 1038.81 365.123C1038.81 362.48 1040.86 360.425 1043.8 360.425C1046.44 360.425 1048.5 362.48 1048.5 365.123C1048.5 368.059 1046.44 370.114 1043.8 370.114ZM992.121 309.923C989.185 309.923 987.13 307.867 987.13 304.931C987.13 302.289 989.479 300.233 992.121 300.233C994.764 300.233 996.819 302.289 996.819 304.931C996.819 307.867 994.764 309.923 992.121 309.923ZM940.445 249.438C937.509 249.438 935.453 247.382 935.453 244.446C935.453 241.804 937.509 239.748 940.445 239.748C943.087 239.748 945.143 241.804 945.143 244.446C945.143 247.382 943.087 249.438 940.445 249.438ZM992.121 279.68C989.185 279.68 987.13 277.625 987.13 274.689C987.13 272.046 989.479 269.991 992.121 269.991C994.764 269.991 996.819 272.046 996.819 274.689C996.819 277.625 994.764 279.68 992.121 279.68ZM966.283 249.438C963.347 249.438 961.292 247.382 961.292 244.446C961.292 241.804 963.347 239.748 966.283 239.748C968.926 239.748 970.981 241.804 970.981 244.446C970.981 247.382 968.926 249.438 966.283 249.438ZM992.121 249.438C989.185 249.438 987.13 247.382 987.13 244.446C987.13 241.804 989.185 239.748 992.121 239.748C994.764 239.748 996.819 241.804 996.819 244.446C996.819 247.382 994.764 249.438 992.121 249.438ZM992.121 188.952C989.185 188.952 987.13 186.897 987.13 183.961C987.13 181.318 989.185 179.263 992.121 179.263C994.764 179.263 996.819 181.318 996.819 183.961C996.819 186.897 994.764 188.952 992.121 188.952Z",p21125400:"M452.707 9.68937C449.771 9.68937 447.716 7.63405 447.716 4.69787C447.716 2.05533 449.771 0 452.707 0C455.35 0 457.405 2.05533 457.405 4.69787C457.405 7.63405 455.35 9.68937 452.707 9.68937ZM401.031 190.851C398.094 190.851 396.039 188.796 396.039 185.86C396.039 183.217 398.094 181.162 401.031 181.162C403.673 181.162 405.729 183.217 405.729 185.86C405.729 188.796 403.673 190.851 401.031 190.851ZM426.869 190.851C423.933 190.851 421.877 188.796 421.877 185.86C421.877 183.217 423.933 181.162 426.869 181.162C429.512 181.162 431.567 183.217 431.567 185.86C431.567 188.796 429.512 190.851 426.869 190.851ZM452.707 190.851C449.771 190.851 447.716 188.796 447.716 185.86C447.716 183.217 449.771 181.162 452.707 181.162C455.35 181.162 457.405 183.217 457.405 185.86C457.405 188.796 455.35 190.851 452.707 190.851ZM478.546 190.851C475.609 190.851 473.554 188.796 473.554 185.86C473.554 183.217 475.609 181.162 478.546 181.162C481.188 181.162 483.243 183.217 483.243 185.86C483.243 188.796 481.188 190.851 478.546 190.851ZM452.707 160.902C449.771 160.902 447.716 158.847 447.716 155.911C447.716 153.268 449.771 151.213 452.707 151.213C455.35 151.213 457.405 153.268 457.405 155.911C457.405 158.847 455.35 160.902 452.707 160.902ZM504.384 190.851C501.448 190.851 499.392 188.796 499.392 185.86C499.392 183.217 501.448 181.162 504.384 181.162C507.026 181.162 509.082 183.217 509.082 185.86C509.082 188.796 507.026 190.851 504.384 190.851ZM452.707 130.66C449.771 130.66 447.716 128.604 447.716 125.668C447.716 123.026 450.065 120.97 452.707 120.97C455.35 120.97 457.405 123.026 457.405 125.668C457.405 128.604 455.35 130.66 452.707 130.66ZM452.707 100.417C449.771 100.417 447.716 98.3618 447.716 95.4256C447.716 92.783 450.065 90.7277 452.707 90.7277C455.35 90.7277 457.405 92.783 457.405 95.4256C457.405 98.3618 455.35 100.417 452.707 100.417ZM452.707 70.1745C449.771 70.1745 447.716 68.1192 447.716 65.183C447.716 62.5405 449.771 60.4851 452.707 60.4851C455.35 60.4851 457.405 62.5405 457.405 65.183C457.405 68.1192 455.35 70.1745 452.707 70.1745ZM401.031 9.68937C398.094 9.68937 396.039 7.63405 396.039 4.69787C396.039 2.05533 398.094 0 401.031 0C403.673 0 405.729 2.05533 405.729 4.69787C405.729 7.63405 403.673 9.68937 401.031 9.68937ZM452.707 39.9319C449.771 39.9319 447.716 37.8766 447.716 34.9405C447.716 32.2979 449.771 30.2426 452.707 30.2426C455.35 30.2426 457.405 32.2979 457.405 34.9405C457.405 37.8766 455.35 39.9319 452.707 39.9319ZM426.869 9.68937C423.933 9.68937 421.877 7.63405 421.877 4.69787C421.877 2.05533 423.933 0 426.869 0C429.512 0 431.567 2.05533 431.567 4.69787C431.567 7.63405 429.512 9.68937 426.869 9.68937Z",p21538800:"M489.614 249.438C486.678 249.438 484.622 247.382 484.622 244.446C484.622 241.804 486.678 239.748 489.614 239.748C492.256 239.748 494.312 241.804 494.312 244.446C494.312 247.382 492.256 249.438 489.614 249.438ZM437.937 370.114C435.001 370.114 432.946 368.059 432.946 365.123C432.946 362.48 435.001 360.425 437.937 360.425C440.58 360.425 442.635 362.48 442.635 365.123C442.635 368.059 440.58 370.114 437.937 370.114ZM412.099 340.165C409.163 340.165 407.107 338.11 407.107 335.174C407.107 332.531 409.163 330.476 412.099 330.476C414.741 330.476 416.797 332.531 416.797 335.174C416.797 338.11 414.741 340.165 412.099 340.165ZM463.775 370.114C460.839 370.114 458.784 368.059 458.784 365.123C458.784 362.48 460.839 360.425 463.775 360.425C466.418 360.425 468.473 362.48 468.473 365.123C468.473 368.059 466.418 370.114 463.775 370.114ZM412.099 309.923C409.163 309.923 407.107 307.867 407.107 304.931C407.107 302.289 409.163 300.233 412.099 300.233C414.741 300.233 416.797 302.289 416.797 304.931C416.797 307.867 414.741 309.923 412.099 309.923ZM489.614 370.114C486.678 370.114 484.622 368.059 484.622 365.123C484.622 362.48 486.678 360.425 489.614 360.425C492.256 360.425 494.312 362.48 494.312 365.123C494.312 368.059 492.256 370.114 489.614 370.114ZM412.099 279.68C409.163 279.68 407.107 277.625 407.107 274.689C407.107 272.046 409.163 269.991 412.099 269.991C414.741 269.991 416.797 272.046 416.797 274.689C416.797 277.625 414.741 279.68 412.099 279.68ZM515.746 340.165C512.81 340.165 510.754 338.11 510.754 335.174C510.754 332.531 512.81 330.476 515.746 330.476C518.388 330.476 520.444 332.531 520.444 335.174C520.444 338.11 518.388 340.165 515.746 340.165ZM437.937 249.438C435.001 249.438 432.946 247.382 432.946 244.446C432.946 241.804 435.001 239.748 437.937 239.748C440.58 239.748 442.635 241.804 442.635 244.446C442.635 247.382 440.58 249.438 437.937 249.438ZM463.775 249.438C460.839 249.438 458.784 247.382 458.784 244.446C458.784 241.804 460.839 239.748 463.775 239.748C466.418 239.748 468.473 241.804 468.473 244.446C468.473 247.382 466.418 249.438 463.775 249.438ZM515.452 279.68C512.516 279.68 510.461 277.625 510.461 274.689C510.461 272.046 512.516 269.991 515.452 269.991C518.095 269.991 520.15 272.046 520.15 274.689C520.15 277.625 518.095 279.68 515.452 279.68Z",p25265000:"M834.27 188.952C831.334 188.952 829.278 186.897 829.278 183.961C829.278 181.318 831.334 179.263 834.27 179.263C836.913 179.263 838.968 181.318 838.968 183.961C838.968 186.897 836.913 188.952 834.27 188.952ZM860.108 370.114C857.172 370.114 855.117 368.059 855.117 365.123C855.117 362.48 857.172 360.425 860.108 360.425C862.751 360.425 864.806 362.48 864.806 365.123C864.806 368.059 862.751 370.114 860.108 370.114ZM834.27 340.165C831.334 340.165 829.278 338.11 829.278 335.174C829.278 332.531 831.334 330.476 834.27 330.476C836.913 330.476 838.968 332.531 838.968 335.174C838.968 338.11 836.913 340.165 834.27 340.165ZM885.947 370.114C883.01 370.114 880.955 368.059 880.955 365.123C880.955 362.48 883.01 360.425 885.947 360.425C888.589 360.425 890.644 362.48 890.644 365.123C890.644 368.059 888.589 370.114 885.947 370.114ZM834.27 309.923C831.334 309.923 829.278 307.867 829.278 304.931C829.278 302.289 831.627 300.233 834.27 300.233C836.913 300.233 838.968 302.289 838.968 304.931C838.968 307.867 836.913 309.923 834.27 309.923ZM911.491 370.114C908.555 370.114 906.5 368.059 906.5 365.123C906.5 362.48 908.555 360.425 911.491 360.425C914.134 360.425 916.189 362.48 916.189 365.123C916.189 368.059 914.134 370.114 911.491 370.114ZM834.27 279.68C831.334 279.68 829.278 277.625 829.278 274.689C829.278 272.046 831.627 269.991 834.27 269.991C836.913 269.991 838.968 272.046 838.968 274.689C838.968 277.625 836.913 279.68 834.27 279.68ZM808.432 249.438C805.495 249.438 803.44 247.382 803.44 244.446C803.44 241.804 805.495 239.748 808.432 239.748C811.074 239.748 813.13 241.804 813.13 244.446C813.13 247.382 811.074 249.438 808.432 249.438ZM834.27 249.438C831.334 249.438 829.278 247.382 829.278 244.446C829.278 241.804 831.334 239.748 834.27 239.748C836.913 239.748 838.968 241.804 838.968 244.446C838.968 247.382 836.913 249.438 834.27 249.438ZM860.108 249.438C857.172 249.438 855.117 247.382 855.117 244.446C855.117 241.804 857.172 239.748 860.108 239.748C862.751 239.748 864.806 241.804 864.806 244.446C864.806 247.382 862.751 249.438 860.108 249.438ZM834.27 219.195C831.334 219.195 829.278 217.14 829.278 214.204C829.278 211.561 831.334 209.506 834.27 209.506C836.913 209.506 838.968 211.561 838.968 214.204C838.968 217.14 836.913 219.195 834.27 219.195ZM885.947 249.438C883.01 249.438 880.955 247.382 880.955 244.446C880.955 241.804 883.01 239.748 885.947 239.748C888.589 239.748 890.644 241.804 890.644 244.446C890.644 247.382 888.589 249.438 885.947 249.438Z",p2b8b7000:"M1307.37 70.1745C1304.43 70.1745 1302.38 68.1192 1302.38 65.183C1302.38 62.5405 1304.43 60.4851 1307.37 60.4851C1310.01 60.4851 1312.07 62.5405 1312.07 65.183C1312.07 68.1192 1310.01 70.1745 1307.37 70.1745ZM1204.02 190.851C1201.08 190.851 1199.03 188.796 1199.03 185.86C1199.03 183.217 1201.08 181.162 1204.02 181.162C1206.66 181.162 1208.72 183.217 1208.72 185.86C1208.72 188.796 1206.66 190.851 1204.02 190.851ZM1229.86 190.851C1226.92 190.851 1224.86 188.796 1224.86 185.86C1224.86 183.217 1226.92 181.162 1229.86 181.162C1232.5 181.162 1234.55 183.217 1234.55 185.86C1234.55 188.796 1232.5 190.851 1229.86 190.851ZM1255.69 190.851C1252.76 190.851 1250.7 188.796 1250.7 185.86C1250.7 183.217 1252.76 181.162 1255.69 181.162C1258.34 181.162 1260.39 183.217 1260.39 185.86C1260.39 188.796 1258.34 190.851 1255.69 190.851ZM1229.86 160.902C1226.92 160.902 1224.86 158.847 1224.86 155.911C1224.86 153.268 1226.92 151.213 1229.86 151.213C1232.5 151.213 1234.55 153.268 1234.55 155.911C1234.55 158.847 1232.5 160.902 1229.86 160.902ZM1281.53 190.851C1278.6 190.851 1276.54 188.796 1276.54 185.86C1276.54 183.217 1278.6 181.162 1281.53 181.162C1284.18 181.162 1286.23 183.217 1286.23 185.86C1286.23 188.796 1284.18 190.851 1281.53 190.851ZM1229.86 130.66C1226.92 130.66 1224.86 128.604 1224.86 125.668C1224.86 123.026 1227.21 120.97 1229.86 120.97C1232.5 120.97 1234.55 123.026 1234.55 125.668C1234.55 128.604 1232.5 130.66 1229.86 130.66ZM1229.86 100.417C1226.92 100.417 1224.86 98.3618 1224.86 95.4256C1224.86 92.783 1227.21 90.7277 1229.86 90.7277C1232.5 90.7277 1234.55 92.783 1234.55 95.4256C1234.55 98.3618 1232.5 100.417 1229.86 100.417ZM1204.02 70.1745C1201.08 70.1745 1199.03 68.1192 1199.03 65.183C1199.03 62.5405 1201.08 60.4851 1204.02 60.4851C1206.66 60.4851 1208.72 62.5405 1208.72 65.183C1208.72 68.1192 1206.66 70.1745 1204.02 70.1745ZM1255.69 100.417C1252.76 100.417 1250.7 98.3618 1250.7 95.4256C1250.7 92.783 1253.05 90.7277 1255.69 90.7277C1258.34 90.7277 1260.39 92.783 1260.39 95.4256C1260.39 98.3618 1258.34 100.417 1255.69 100.417ZM1229.86 70.1745C1226.92 70.1745 1224.86 68.1192 1224.86 65.183C1224.86 62.5405 1226.92 60.4851 1229.86 60.4851C1232.5 60.4851 1234.55 62.5405 1234.55 65.183C1234.55 68.1192 1232.5 70.1745 1229.86 70.1745ZM1281.53 70.1745C1278.6 70.1745 1276.54 68.1192 1276.54 65.183C1276.54 62.5405 1278.6 60.4851 1281.53 60.4851C1284.18 60.4851 1286.23 62.5405 1286.23 65.183C1286.23 68.1192 1284.18 70.1745 1281.53 70.1745Z",p2d0f700:"M93.5746 249.438C90.9321 249.438 88.8768 247.382 88.8768 244.74C88.8768 241.804 90.9321 239.748 93.5746 239.748C96.5108 239.748 98.5661 241.804 98.5661 244.74C98.5661 247.382 96.5108 249.438 93.5746 249.438ZM16.0597 430.599C13.4171 430.599 11.3618 428.544 11.3618 425.902C11.3618 422.965 13.4171 420.91 16.0597 420.91C18.9959 420.91 21.0512 422.965 21.0512 425.902C21.0512 428.544 18.9959 430.599 16.0597 430.599ZM16.0597 400.357C13.4171 400.357 11.3618 398.302 11.3618 395.659C11.3618 392.723 13.4171 390.668 16.0597 390.668C18.9959 390.668 21.0512 392.723 21.0512 395.659C21.0512 398.302 18.9959 400.357 16.0597 400.357ZM16.0597 370.114C13.4171 370.114 11.3618 368.059 11.3618 365.416C11.3618 362.48 13.4171 360.425 16.0597 360.425C18.9959 360.425 21.0512 362.48 21.0512 365.416C21.0512 368.059 18.9959 370.114 16.0597 370.114ZM41.898 370.114C39.2555 370.114 37.2001 368.059 37.2001 365.416C37.2001 362.48 39.2555 360.425 41.898 360.425C44.8342 360.425 46.8895 362.48 46.8895 365.416C46.8895 367.472 44.5406 370.114 41.898 370.114ZM16.0597 339.872C13.4171 339.872 11.3618 337.816 11.3618 335.174C11.3618 332.238 13.4171 330.182 16.0597 330.182C18.9959 330.182 21.0512 332.238 21.0512 335.174C21.0512 337.816 18.7022 339.872 16.0597 339.872ZM67.7363 370.114C65.0938 370.114 63.0384 368.059 63.0384 365.416C63.0384 362.48 65.0938 360.425 67.7363 360.425C70.6725 360.425 72.7278 362.48 72.7278 365.416C72.7278 368.059 70.6725 370.114 67.7363 370.114ZM16.0597 309.629C13.4171 309.629 11.3618 307.574 11.3618 304.931C11.3618 301.995 13.4171 299.94 16.0597 299.94C18.9959 299.94 21.0512 301.995 21.0512 304.931C21.0512 307.574 18.7022 309.629 16.0597 309.629ZM93.5746 370.114C90.9321 370.114 88.8768 368.059 88.8768 365.416C88.8768 362.48 90.9321 360.425 93.5746 360.425C96.5108 360.425 98.5661 362.48 98.5661 365.416C98.5661 368.059 96.5108 370.114 93.5746 370.114ZM16.0597 279.387C13.4171 279.387 11.3618 277.331 11.3618 274.689C11.3618 271.753 13.4171 269.697 16.0597 269.697C18.9959 269.697 21.0512 271.753 21.0512 274.689C21.0512 277.331 18.9959 279.387 16.0597 279.387ZM119.413 339.872C116.77 339.872 114.715 337.816 114.715 335.174C114.715 332.238 116.77 330.182 119.413 330.182C122.349 330.182 124.404 332.238 124.404 335.174C124.404 337.816 122.056 339.872 119.413 339.872ZM41.898 249.438C39.2555 249.438 37.2001 247.382 37.2001 244.74C37.2001 241.804 39.2555 239.748 41.898 239.748C44.8342 239.748 46.8895 241.804 46.8895 244.74C46.8895 247.382 44.8342 249.438 41.898 249.438ZM119.413 309.629C116.77 309.629 114.715 307.574 114.715 304.931C114.715 301.995 116.77 299.94 119.413 299.94C122.349 299.94 124.404 301.995 124.404 304.931C124.404 307.574 122.056 309.629 119.413 309.629ZM67.7363 249.438C65.0938 249.438 63.0384 247.382 63.0384 244.74C63.0384 241.804 65.0938 239.748 67.7363 239.748C70.6725 239.748 72.7278 241.804 72.7278 244.74C72.7278 247.382 70.6725 249.438 67.7363 249.438ZM119.413 279.387C116.77 279.387 114.715 277.331 114.715 274.689C114.715 271.753 116.77 269.697 119.413 269.697C122.349 269.697 124.404 271.753 124.404 274.689C124.404 277.331 122.349 279.387 119.413 279.387Z",p2fae140:"M1149.68 249.438C1146.74 249.438 1144.69 247.382 1144.69 244.446C1144.69 241.804 1146.74 239.748 1149.68 239.748C1152.32 239.748 1154.38 241.804 1154.38 244.446C1154.38 247.382 1152.32 249.438 1149.68 249.438ZM1098 370.114C1095.07 370.114 1093.01 368.059 1093.01 365.123C1093.01 362.48 1095.07 360.425 1098 360.425C1100.64 360.425 1102.7 362.48 1102.7 365.123C1102.7 368.059 1100.64 370.114 1098 370.114ZM1072.16 340.165C1069.23 340.165 1067.17 338.11 1067.17 335.174C1067.17 332.531 1069.23 330.476 1072.16 330.476C1074.81 330.476 1076.86 332.531 1076.86 335.174C1076.86 338.11 1074.81 340.165 1072.16 340.165ZM1123.84 370.114C1120.9 370.114 1118.85 368.059 1118.85 365.123C1118.85 362.48 1120.9 360.425 1123.84 360.425C1126.48 360.425 1128.54 362.48 1128.54 365.123C1128.54 368.059 1126.48 370.114 1123.84 370.114ZM1072.16 309.923C1069.23 309.923 1067.17 307.867 1067.17 304.931C1067.17 302.289 1069.52 300.233 1072.16 300.233C1074.81 300.233 1076.86 302.289 1076.86 304.931C1076.86 307.867 1074.81 309.923 1072.16 309.923ZM1149.68 370.114C1146.74 370.114 1144.69 368.059 1144.69 365.123C1144.69 362.48 1146.74 360.425 1149.68 360.425C1152.32 360.425 1154.38 362.48 1154.38 365.123C1154.38 368.059 1152.32 370.114 1149.68 370.114ZM1072.16 279.68C1069.23 279.68 1067.17 277.625 1067.17 274.689C1067.17 272.046 1069.52 269.991 1072.16 269.991C1074.81 269.991 1076.86 272.046 1076.86 274.689C1076.86 277.625 1074.81 279.68 1072.16 279.68ZM1175.52 340.165C1172.58 340.165 1170.53 338.11 1170.53 335.174C1170.53 332.531 1172.58 330.476 1175.52 330.476C1178.16 330.476 1180.22 332.531 1180.22 335.174C1180.22 338.11 1178.16 340.165 1175.52 340.165ZM1098 249.438C1095.07 249.438 1093.01 247.382 1093.01 244.446C1093.01 241.804 1095.07 239.748 1098 239.748C1100.64 239.748 1102.7 241.804 1102.7 244.446C1102.7 247.382 1100.64 249.438 1098 249.438ZM1175.52 309.923C1172.58 309.923 1170.53 307.867 1170.53 304.931C1170.53 302.289 1172.87 300.233 1175.52 300.233C1178.16 300.233 1180.22 302.289 1180.22 304.931C1180.22 307.867 1178.16 309.923 1175.52 309.923ZM1123.84 249.438C1120.9 249.438 1118.85 247.382 1118.85 244.446C1118.85 241.804 1120.9 239.748 1123.84 239.748C1126.48 239.748 1128.54 241.804 1128.54 244.446C1128.54 247.382 1126.48 249.438 1123.84 249.438ZM1175.52 279.68C1172.58 279.68 1170.53 277.625 1170.53 274.689C1170.53 272.046 1172.87 269.991 1175.52 269.991C1178.16 269.991 1180.22 272.046 1180.22 274.689C1180.22 277.625 1178.16 279.68 1175.52 279.68Z",p3116aa00:"M346.239 70.1745C343.303 70.1745 341.247 68.1192 341.247 65.183C341.247 62.5405 343.303 60.4851 346.239 60.4851C348.881 60.4851 350.937 62.5405 350.937 65.183C350.937 68.1192 348.881 70.1745 346.239 70.1745ZM294.562 190.851C291.626 190.851 289.571 188.796 289.571 185.86C289.571 183.217 291.626 181.162 294.562 181.162C297.205 181.162 299.26 183.217 299.26 185.86C299.26 188.796 297.205 190.851 294.562 190.851ZM268.724 160.902C265.788 160.902 263.732 158.847 263.732 155.911C263.732 153.268 265.788 151.213 268.724 151.213C271.367 151.213 273.422 153.268 273.422 155.911C273.422 158.847 271.367 160.902 268.724 160.902ZM320.401 190.851C317.464 190.851 315.409 188.796 315.409 185.86C315.409 183.217 317.464 181.162 320.401 181.162C323.043 181.162 325.098 183.217 325.098 185.86C325.098 188.796 323.043 190.851 320.401 190.851ZM268.724 130.66C265.788 130.66 263.732 128.604 263.732 125.668C263.732 123.026 266.081 120.97 268.724 120.97C271.367 120.97 273.422 123.026 273.422 125.668C273.422 128.604 271.367 130.66 268.724 130.66ZM346.239 190.851C343.303 190.851 341.247 188.796 341.247 185.86C341.247 183.217 343.303 181.162 346.239 181.162C348.881 181.162 350.937 183.217 350.937 185.86C350.937 188.796 348.881 190.851 346.239 190.851ZM268.724 100.417C265.788 100.417 263.732 98.3618 263.732 95.4256C263.732 92.783 266.081 90.7277 268.724 90.7277C271.367 90.7277 273.422 92.783 273.422 95.4256C273.422 98.3618 271.367 100.417 268.724 100.417ZM372.077 160.902C369.141 160.902 367.086 158.847 367.086 155.911C367.086 153.268 369.141 151.213 372.077 151.213C374.72 151.213 376.775 153.268 376.775 155.911C376.775 158.847 374.72 160.902 372.077 160.902ZM294.562 70.1745C291.626 70.1745 289.571 68.1192 289.571 65.183C289.571 62.5405 291.626 60.4851 294.562 60.4851C297.205 60.4851 299.26 62.5405 299.26 65.183C299.26 68.1192 297.205 70.1745 294.562 70.1745ZM372.077 130.66C369.141 130.66 367.086 128.604 367.086 125.668C367.086 123.026 369.435 120.97 372.077 120.97C374.72 120.97 376.775 123.026 376.775 125.668C376.775 128.604 374.72 130.66 372.077 130.66ZM320.401 70.1745C317.464 70.1745 315.409 68.1192 315.409 65.183C315.409 62.5405 317.464 60.4851 320.401 60.4851C323.043 60.4851 325.098 62.5405 325.098 65.183C325.098 68.1192 323.043 70.1745 320.401 70.1745ZM372.077 100.417C369.141 100.417 367.086 98.3618 367.086 95.4256C367.086 92.783 369.435 90.7277 372.077 90.7277C374.72 90.7277 376.775 92.783 376.775 95.4256C376.775 98.3618 374.72 100.417 372.077 100.417Z",p3459ed80:"M617.516 249.438C614.58 249.438 612.525 247.382 612.525 244.446C612.525 241.804 614.58 239.748 617.516 239.748C620.159 239.748 622.214 241.804 622.214 244.446C622.214 247.382 620.159 249.438 617.516 249.438ZM565.84 370.114C562.903 370.114 560.848 368.059 560.848 365.123C560.848 362.48 562.903 360.425 565.84 360.425C568.482 360.425 570.537 362.48 570.537 365.123C570.537 368.059 568.482 370.114 565.84 370.114ZM540.001 340.165C537.065 340.165 535.01 338.11 535.01 335.174C535.01 332.531 537.065 330.476 540.001 330.476C542.644 330.476 544.699 332.531 544.699 335.174C544.699 338.11 542.644 340.165 540.001 340.165ZM591.678 370.114C588.742 370.114 586.686 368.059 586.686 365.123C586.686 362.48 588.742 360.425 591.678 360.425C594.32 360.425 596.376 362.48 596.376 365.123C596.376 368.059 594.32 370.114 591.678 370.114ZM540.001 309.923C537.065 309.923 535.01 307.867 535.01 304.931C535.01 302.289 537.359 300.233 540.001 300.233C542.644 300.233 544.699 302.289 544.699 304.931C544.699 307.867 542.644 309.923 540.001 309.923ZM617.516 370.114C614.58 370.114 612.525 368.059 612.525 365.123C612.525 362.48 614.58 360.425 617.516 360.425C620.159 360.425 622.214 362.48 622.214 365.123C622.214 368.059 620.159 370.114 617.516 370.114ZM565.84 309.923C562.903 309.923 560.848 307.867 560.848 304.931C560.848 302.289 563.197 300.233 565.84 300.233C568.482 300.233 570.537 302.289 570.537 304.931C570.537 307.867 568.482 309.923 565.84 309.923ZM540.001 279.68C537.065 279.68 535.01 277.625 535.01 274.689C535.01 272.046 537.359 269.991 540.001 269.991C542.644 269.991 544.699 272.046 544.699 274.689C544.699 277.625 542.644 279.68 540.001 279.68ZM643.354 370.114C640.418 370.114 638.363 368.059 638.363 365.123C638.363 362.48 640.418 360.425 643.354 360.425C645.997 360.425 648.052 362.48 648.052 365.123C648.052 368.059 645.997 370.114 643.354 370.114ZM591.678 309.923C588.742 309.923 586.686 307.867 586.686 304.931C586.686 302.289 589.035 300.233 591.678 300.233C594.32 300.233 596.376 302.289 596.376 304.931C596.376 307.867 594.32 309.923 591.678 309.923ZM617.516 309.923C614.58 309.923 612.525 307.867 612.525 304.931C612.525 302.289 614.874 300.233 617.516 300.233C620.159 300.233 622.214 302.289 622.214 304.931C622.214 307.867 620.159 309.923 617.516 309.923ZM565.84 249.438C562.903 249.438 560.848 247.382 560.848 244.446C560.848 241.804 562.903 239.748 565.84 239.748C568.482 239.748 570.537 241.804 570.537 244.446C570.537 247.382 568.482 249.438 565.84 249.438ZM643.354 309.923C640.418 309.923 638.363 307.867 638.363 304.931C638.363 302.289 640.712 300.233 643.354 300.233C645.997 300.233 648.052 302.289 648.052 304.931C648.052 307.867 645.997 309.923 643.354 309.923ZM591.678 249.438C588.742 249.438 586.686 247.382 586.686 244.446C586.686 241.804 588.742 239.748 591.678 239.748C594.32 239.748 596.376 241.804 596.376 244.446C596.376 247.382 594.32 249.438 591.678 249.438ZM643.354 279.68C640.418 279.68 638.363 277.625 638.363 274.689C638.363 272.046 640.712 269.991 643.354 269.991C645.997 269.991 648.052 272.046 648.052 274.689C648.052 277.625 645.997 279.68 643.354 279.68Z",p3810b500:"M636.103 70.1745C633.167 70.1745 631.112 68.1192 631.112 65.183C631.112 62.5405 633.167 60.4851 636.103 60.4851C638.746 60.4851 640.801 62.5405 640.801 65.183C640.801 68.1192 638.746 70.1745 636.103 70.1745ZM532.75 190.851C529.814 190.851 527.759 188.796 527.759 185.86C527.759 183.217 529.814 181.162 532.75 181.162C535.393 181.162 537.448 183.217 537.448 185.86C537.448 188.796 535.393 190.851 532.75 190.851ZM558.588 190.851C555.652 190.851 553.597 188.796 553.597 185.86C553.597 183.217 555.652 181.162 558.588 181.162C561.231 181.162 563.286 183.217 563.286 185.86C563.286 188.796 561.231 190.851 558.588 190.851ZM584.427 190.851C581.491 190.851 579.435 188.796 579.435 185.86C579.435 183.217 581.491 181.162 584.427 181.162C587.069 181.162 589.125 183.217 589.125 185.86C589.125 188.796 587.069 190.851 584.427 190.851ZM610.265 190.851C607.329 190.851 605.273 188.796 605.273 185.86C605.273 183.217 607.329 181.162 610.265 181.162C612.908 181.162 614.963 183.217 614.963 185.86C614.963 188.796 612.908 190.851 610.265 190.851ZM558.588 130.66C555.652 130.66 553.597 128.604 553.597 125.668C553.597 123.026 555.946 120.97 558.588 120.97C561.231 120.97 563.286 123.026 563.286 125.668C563.286 128.604 561.231 130.66 558.588 130.66ZM532.75 100.417C529.814 100.417 527.759 98.3618 527.759 95.4256C527.759 92.783 530.108 90.7277 532.75 90.7277C535.393 90.7277 537.448 92.783 537.448 95.4256C537.448 98.3618 535.393 100.417 532.75 100.417ZM584.427 130.66C581.491 130.66 579.435 128.604 579.435 125.668C579.435 123.026 581.784 120.97 584.427 120.97C587.069 120.97 589.125 123.026 589.125 125.668C589.125 128.604 587.069 130.66 584.427 130.66ZM636.103 160.902C633.167 160.902 631.112 158.847 631.112 155.911C631.112 153.268 633.167 151.213 636.103 151.213C638.746 151.213 640.801 153.268 640.801 155.911C640.801 158.847 638.746 160.902 636.103 160.902ZM610.265 130.66C607.329 130.66 605.273 128.604 605.273 125.668C605.273 123.026 607.622 120.97 610.265 120.97C612.908 120.97 614.963 123.026 614.963 125.668C614.963 128.604 612.908 130.66 610.265 130.66ZM558.588 70.1745C555.652 70.1745 553.597 68.1192 553.597 65.183C553.597 62.5405 555.652 60.4851 558.588 60.4851C561.231 60.4851 563.286 62.5405 563.286 65.183C563.286 68.1192 561.231 70.1745 558.588 70.1745ZM584.427 70.1745C581.491 70.1745 579.435 68.1192 579.435 65.183C579.435 62.5405 581.491 60.4851 584.427 60.4851C587.069 60.4851 589.125 62.5405 589.125 65.183C589.125 68.1192 587.069 70.1745 584.427 70.1745ZM610.265 70.1745C607.329 70.1745 605.273 68.1192 605.273 65.183C605.273 62.5405 607.329 60.4851 610.265 60.4851C612.908 60.4851 614.963 62.5405 614.963 65.183C614.963 68.1192 612.908 70.1745 610.265 70.1745Z",p39a3e180:"M214.226 70.1745C211.29 70.1745 209.234 68.1192 209.234 65.183C209.234 62.5405 211.29 60.4851 214.226 60.4851C216.868 60.4851 218.924 62.5405 218.924 65.183C218.924 68.1192 216.868 70.1745 214.226 70.1745ZM162.549 190.851C159.613 190.851 157.558 188.796 157.558 185.86C157.558 183.217 159.613 181.162 162.549 181.162C165.192 181.162 167.247 183.217 167.247 185.86C167.247 188.796 165.192 190.851 162.549 190.851ZM136.711 160.902C133.775 160.902 131.719 158.847 131.719 155.911C131.719 153.268 133.775 151.213 136.711 151.213C139.353 151.213 141.409 153.268 141.409 155.911C141.409 158.847 139.353 160.902 136.711 160.902ZM188.388 190.851C185.451 190.851 183.396 188.796 183.396 185.86C183.396 183.217 185.451 181.162 188.388 181.162C191.03 181.162 193.085 183.217 193.085 185.86C193.085 188.796 191.03 190.851 188.388 190.851ZM136.711 130.66C133.775 130.66 131.719 128.604 131.719 125.668C131.719 123.026 134.068 120.97 136.711 120.97C139.353 120.97 141.409 123.026 141.409 125.668C141.409 128.604 139.353 130.66 136.711 130.66ZM214.226 190.851C211.29 190.851 209.234 188.796 209.234 185.86C209.234 183.217 211.29 181.162 214.226 181.162C216.868 181.162 218.924 183.217 218.924 185.86C218.924 188.796 216.868 190.851 214.226 190.851ZM136.711 100.417C133.775 100.417 131.719 98.3618 131.719 95.4256C131.719 92.783 134.068 90.7277 136.711 90.7277C139.353 90.7277 141.409 92.783 141.409 95.4256C141.409 98.3618 139.353 100.417 136.711 100.417ZM240.064 160.902C237.128 160.902 235.073 158.847 235.073 155.911C235.073 153.268 237.128 151.213 240.064 151.213C242.707 151.213 244.762 153.268 244.762 155.911C244.762 158.847 242.707 160.902 240.064 160.902ZM162.549 70.1745C159.613 70.1745 157.558 68.1192 157.558 65.183C157.558 62.5405 159.613 60.4851 162.549 60.4851C165.192 60.4851 167.247 62.5405 167.247 65.183C167.247 68.1192 165.192 70.1745 162.549 70.1745ZM240.064 130.66C237.128 130.66 235.073 128.604 235.073 125.668C235.073 123.026 237.422 120.97 240.064 120.97C242.707 120.97 244.762 123.026 244.762 125.668C244.762 128.604 242.707 130.66 240.064 130.66ZM188.388 70.1745C185.451 70.1745 183.396 68.1192 183.396 65.183C183.396 62.5405 185.451 60.4851 188.388 60.4851C191.03 60.4851 193.085 62.5405 193.085 65.183C193.085 68.1192 191.03 70.1745 188.388 70.1745ZM240.064 100.417C237.128 100.417 235.073 98.3618 235.073 95.4256C235.073 92.783 237.422 90.7277 240.064 90.7277C242.707 90.7277 244.762 92.783 244.762 95.4256C244.762 98.3618 242.707 100.417 240.064 100.417Z",p3dc6840:"M1149.23 70.1745C1146.29 70.1745 1144.23 68.1192 1144.23 65.183C1144.23 62.5405 1146.29 60.4851 1149.23 60.4851C1151.87 60.4851 1153.92 62.5405 1153.92 65.183C1153.92 68.1192 1151.87 70.1745 1149.23 70.1745ZM1097.55 190.851C1094.61 190.851 1092.56 188.796 1092.56 185.86C1092.56 183.217 1094.61 181.162 1097.55 181.162C1100.19 181.162 1102.25 183.217 1102.25 185.86C1102.25 188.796 1100.19 190.851 1097.55 190.851ZM1071.71 160.902C1068.77 160.902 1066.72 158.847 1066.72 155.911C1066.72 153.268 1068.77 151.213 1071.71 151.213C1074.35 151.213 1076.41 153.268 1076.41 155.911C1076.41 158.847 1074.35 160.902 1071.71 160.902ZM1123.39 190.851C1120.45 190.851 1118.4 188.796 1118.4 185.86C1118.4 183.217 1120.45 181.162 1123.39 181.162C1126.03 181.162 1128.09 183.217 1128.09 185.86C1128.09 188.796 1126.03 190.851 1123.39 190.851ZM1071.71 130.66C1068.77 130.66 1066.72 128.604 1066.72 125.668C1066.72 123.026 1069.07 120.97 1071.71 120.97C1074.35 120.97 1076.41 123.026 1076.41 125.668C1076.41 128.604 1074.35 130.66 1071.71 130.66ZM1149.23 190.851C1146.29 190.851 1144.23 188.796 1144.23 185.86C1144.23 183.217 1146.29 181.162 1149.23 181.162C1151.87 181.162 1153.92 183.217 1153.92 185.86C1153.92 188.796 1151.87 190.851 1149.23 190.851ZM1071.71 100.417C1068.77 100.417 1066.72 98.3618 1066.72 95.4256C1066.72 92.783 1069.07 90.7277 1071.71 90.7277C1074.35 90.7277 1076.41 92.783 1076.41 95.4256C1076.41 98.3618 1074.35 100.417 1071.71 100.417ZM1175.06 160.902C1172.13 160.902 1170.07 158.847 1170.07 155.911C1170.07 153.268 1172.13 151.213 1175.06 151.213C1177.71 151.213 1179.76 153.268 1179.76 155.911C1179.76 158.847 1177.71 160.902 1175.06 160.902ZM1097.55 70.1745C1094.61 70.1745 1092.56 68.1192 1092.56 65.183C1092.56 62.5405 1094.61 60.4851 1097.55 60.4851C1100.19 60.4851 1102.25 62.5405 1102.25 65.183C1102.25 68.1192 1100.19 70.1745 1097.55 70.1745ZM1175.06 130.66C1172.13 130.66 1170.07 128.604 1170.07 125.668C1170.07 123.026 1172.42 120.97 1175.06 120.97C1177.71 120.97 1179.76 123.026 1179.76 125.668C1179.76 128.604 1177.71 130.66 1175.06 130.66ZM1123.39 70.1745C1120.45 70.1745 1118.4 68.1192 1118.4 65.183C1118.4 62.5405 1120.45 60.4851 1123.39 60.4851C1126.03 60.4851 1128.09 62.5405 1128.09 65.183C1128.09 68.1192 1126.03 70.1745 1123.39 70.1745ZM1175.06 100.417C1172.13 100.417 1170.07 98.3618 1170.07 95.4256C1170.07 92.783 1172.42 90.7277 1175.06 90.7277C1177.71 90.7277 1179.76 92.783 1179.76 95.4256C1179.76 98.3618 1177.71 100.417 1175.06 100.417Z",p3f52de00:"M1284.33 249.438C1281.4 249.438 1279.34 247.382 1279.34 244.446C1279.34 241.804 1281.4 239.748 1284.33 239.748C1286.98 239.748 1289.03 241.804 1289.03 244.446C1289.03 247.382 1286.98 249.438 1284.33 249.438ZM1206.82 370.114C1203.88 370.114 1201.83 368.059 1201.83 365.123C1201.83 362.48 1203.88 360.425 1206.82 360.425C1209.46 360.425 1211.52 362.48 1211.52 365.123C1211.52 368.059 1209.46 370.114 1206.82 370.114ZM1206.82 340.165C1203.88 340.165 1201.83 338.11 1201.83 335.174C1201.83 332.531 1203.88 330.476 1206.82 330.476C1209.46 330.476 1211.52 332.531 1211.52 335.174C1211.52 338.11 1209.46 340.165 1206.82 340.165ZM1206.82 309.923C1203.88 309.923 1201.83 307.867 1201.83 304.931C1201.83 302.289 1203.88 300.233 1206.82 300.233C1209.46 300.233 1211.52 302.289 1211.52 304.931C1211.52 307.867 1209.46 309.923 1206.82 309.923ZM1206.82 279.68C1203.88 279.68 1201.83 277.625 1201.83 274.689C1201.83 272.046 1204.18 269.991 1206.82 269.991C1209.46 269.991 1211.52 272.046 1211.52 274.689C1211.52 277.625 1209.46 279.68 1206.82 279.68ZM1309 370.114C1306.06 370.114 1304.01 368.059 1304.01 365.123C1304.01 362.48 1306.06 360.425 1309 360.425C1311.64 360.425 1313.7 362.48 1313.7 365.123C1313.7 368.059 1311.64 370.114 1309 370.114ZM1232.66 279.68C1229.72 279.68 1227.67 277.625 1227.67 274.689C1227.67 272.046 1229.72 269.991 1232.66 269.991C1235.3 269.991 1237.36 272.046 1237.36 274.689C1237.36 277.625 1235.3 279.68 1232.66 279.68ZM1206.82 249.438C1203.88 249.438 1201.83 247.382 1201.83 244.446C1201.83 241.804 1203.88 239.748 1206.82 239.748C1209.46 239.748 1211.52 241.804 1211.52 244.446C1211.52 247.382 1209.46 249.438 1206.82 249.438ZM1309 340.165C1306.06 340.165 1304.01 338.11 1304.01 335.174C1304.01 332.531 1306.06 330.476 1309 330.476C1311.64 330.476 1313.7 332.531 1313.7 335.174C1313.7 338.11 1311.64 340.165 1309 340.165ZM1309 309.923C1306.06 309.923 1304.01 307.867 1304.01 304.931C1304.01 302.289 1306.06 300.233 1309 300.233C1311.64 300.233 1313.7 302.289 1313.7 304.931C1313.7 307.867 1311.64 309.923 1309 309.923ZM1258.5 249.438C1255.56 249.438 1253.5 247.382 1253.5 244.446C1253.5 241.804 1255.56 239.748 1258.5 239.748C1261.14 239.748 1263.19 241.804 1263.19 244.446C1263.19 247.382 1261.14 249.438 1258.5 249.438ZM1309 279.68C1306.06 279.68 1304.01 277.625 1304.01 274.689C1304.01 272.046 1306.06 269.991 1309 269.991C1311.64 269.991 1313.7 272.046 1313.7 274.689C1313.7 277.625 1311.64 279.68 1309 279.68Z",p7993e00:"M753.64 249.438C750.997 249.438 748.942 247.382 748.942 244.74C748.942 241.804 750.997 239.748 753.64 239.748C756.576 239.748 758.631 241.804 758.631 244.74C758.631 247.382 756.576 249.438 753.64 249.438ZM676.125 430.599C673.482 430.599 671.427 428.544 671.427 425.902C671.427 422.965 673.482 420.91 676.125 420.91C679.061 420.91 681.116 422.965 681.116 425.902C681.116 428.544 679.061 430.599 676.125 430.599ZM676.125 400.357C673.482 400.357 671.427 398.302 671.427 395.659C671.427 392.723 673.482 390.668 676.125 390.668C679.061 390.668 681.116 392.723 681.116 395.659C681.116 398.302 679.061 400.357 676.125 400.357ZM676.125 370.114C673.482 370.114 671.427 368.059 671.427 365.416C671.427 362.48 673.482 360.425 676.125 360.425C679.061 360.425 681.116 362.48 681.116 365.416C681.116 368.059 679.061 370.114 676.125 370.114ZM701.963 370.114C699.321 370.114 697.265 368.059 697.265 365.416C697.265 362.48 699.321 360.425 701.963 360.425C704.899 360.425 706.955 362.48 706.955 365.416C706.955 367.472 704.606 370.114 701.963 370.114ZM676.125 339.872C673.482 339.872 671.427 337.816 671.427 335.174C671.427 332.238 673.482 330.182 676.125 330.182C679.061 330.182 681.116 332.238 681.116 335.174C681.116 337.816 678.767 339.872 676.125 339.872ZM727.802 370.114C725.159 370.114 723.104 368.059 723.104 365.416C723.104 362.48 725.159 360.425 727.802 360.425C730.738 360.425 732.793 362.48 732.793 365.416C732.793 368.059 730.738 370.114 727.802 370.114ZM676.125 309.629C673.482 309.629 671.427 307.574 671.427 304.931C671.427 301.995 673.482 299.94 676.125 299.94C679.061 299.94 681.116 301.995 681.116 304.931C681.116 307.574 678.767 309.629 676.125 309.629ZM753.64 370.114C750.997 370.114 748.942 368.059 748.942 365.416C748.942 362.48 750.997 360.425 753.64 360.425C756.576 360.425 758.631 362.48 758.631 365.416C758.631 368.059 756.576 370.114 753.64 370.114ZM676.125 279.387C673.482 279.387 671.427 277.331 671.427 274.689C671.427 271.753 673.482 269.697 676.125 269.697C679.061 269.697 681.116 271.753 681.116 274.689C681.116 277.331 679.061 279.387 676.125 279.387ZM779.478 339.872C776.836 339.872 774.78 337.816 774.78 335.174C774.78 332.238 776.836 330.182 779.478 330.182C782.414 330.182 784.47 332.238 784.47 335.174C784.47 337.816 782.121 339.872 779.478 339.872ZM701.963 249.438C699.321 249.438 697.265 247.382 697.265 244.74C697.265 241.804 699.321 239.748 701.963 239.748C704.899 239.748 706.955 241.804 706.955 244.74C706.955 247.382 704.899 249.438 701.963 249.438ZM779.478 309.629C776.836 309.629 774.78 307.574 774.78 304.931C774.78 301.995 776.836 299.94 779.478 299.94C782.414 299.94 784.47 301.995 784.47 304.931C784.47 307.574 782.121 309.629 779.478 309.629ZM727.802 249.438C725.159 249.438 723.104 247.382 723.104 244.74C723.104 241.804 725.159 239.748 727.802 239.748C730.738 239.748 732.793 241.804 732.793 244.74C732.793 247.382 730.738 249.438 727.802 249.438ZM779.478 279.387C776.836 279.387 774.78 277.331 774.78 274.689C774.78 271.753 776.836 269.697 779.478 269.697C782.414 269.697 784.47 271.753 784.47 274.689C784.47 277.331 782.414 279.387 779.478 279.387Z",pbcf7c00:"M1044.52 9.68937C1041.58 9.68937 1039.53 7.63405 1039.53 4.69787C1039.53 2.05533 1041.58 0 1044.52 0C1047.16 0 1049.22 2.05533 1049.22 4.69787C1049.22 7.63405 1047.16 9.68937 1044.52 9.68937ZM939.992 190.851C937.055 190.851 935 188.796 935 185.86C935 183.217 937.055 181.162 939.992 181.162C942.634 181.162 944.689 183.217 944.689 185.86C944.689 188.796 942.634 190.851 939.992 190.851ZM965.83 190.851C962.894 190.851 960.838 188.796 960.838 185.86C960.838 183.217 962.894 181.162 965.83 181.162C968.472 181.162 970.528 183.217 970.528 185.86C970.528 188.796 968.472 190.851 965.83 190.851ZM991.668 190.851C988.732 190.851 986.677 188.796 986.677 185.86C986.677 183.217 988.732 181.162 991.668 181.162C994.311 181.162 996.366 183.217 996.366 185.86C996.366 188.796 994.311 190.851 991.668 190.851ZM1017.51 190.851C1014.57 190.851 1012.51 188.796 1012.51 185.86C1012.51 183.217 1014.57 181.162 1017.51 181.162C1020.15 181.162 1022.2 183.217 1022.2 185.86C1022.2 188.796 1020.15 190.851 1017.51 190.851ZM991.668 160.902C988.732 160.902 986.677 158.847 986.677 155.911C986.677 153.268 988.732 151.213 991.668 151.213C994.311 151.213 996.366 153.268 996.366 155.911C996.366 158.847 994.311 160.902 991.668 160.902ZM1043.34 190.851C1040.41 190.851 1038.35 188.796 1038.35 185.86C1038.35 183.217 1040.41 181.162 1043.34 181.162C1045.99 181.162 1048.04 183.217 1048.04 185.86C1048.04 188.796 1045.99 190.851 1043.34 190.851ZM991.668 130.66C988.732 130.66 986.677 128.604 986.677 125.668C986.677 123.026 989.026 120.97 991.668 120.97C994.311 120.97 996.366 123.026 996.366 125.668C996.366 128.604 994.311 130.66 991.668 130.66ZM939.698 70.1745C937.055 70.1745 935 68.1192 935 65.183C935 62.5405 937.055 60.4851 939.698 60.4851C942.634 60.4851 944.689 62.5405 944.689 65.183C944.689 68.1192 942.634 70.1745 939.698 70.1745ZM991.668 100.417C988.732 100.417 986.677 98.3618 986.677 95.4256C986.677 92.783 989.026 90.7277 991.668 90.7277C994.311 90.7277 996.366 92.783 996.366 95.4256C996.366 98.3618 994.311 100.417 991.668 100.417ZM965.536 70.1745C962.894 70.1745 960.838 68.1192 960.838 65.183C960.838 62.5405 962.894 60.4851 965.536 60.4851C968.472 60.4851 970.528 62.5405 970.528 65.183C970.528 68.1192 968.472 70.1745 965.536 70.1745ZM991.375 70.1745C988.732 70.1745 986.677 68.1192 986.677 65.183C986.677 62.5405 988.732 60.4851 991.375 60.4851C994.311 60.4851 996.366 62.5405 996.366 65.183C996.366 68.1192 994.311 70.1745 991.375 70.1745ZM1017.21 70.1745C1014.57 70.1745 1012.51 68.1192 1012.51 65.183C1012.51 62.5405 1014.57 60.4851 1017.21 60.4851C1020.15 60.4851 1022.2 62.5405 1022.2 65.183C1022.2 68.1192 1020.15 70.1745 1017.21 70.1745ZM991.668 39.9319C988.732 39.9319 986.677 37.8766 986.677 34.9405C986.677 32.2979 988.732 30.2426 991.668 30.2426C994.311 30.2426 996.366 32.2979 996.366 34.9405C996.366 37.8766 994.311 39.9319 991.668 39.9319ZM1043.05 70.1745C1040.41 70.1745 1038.35 68.1192 1038.35 65.183C1038.35 62.5405 1040.41 60.4851 1043.05 60.4851C1045.99 60.4851 1048.04 62.5405 1048.04 65.183C1048.04 68.1192 1045.99 70.1745 1043.05 70.1745ZM1018.68 9.68937C1015.74 9.68937 1013.69 7.63405 1013.69 4.69787C1013.69 2.05533 1015.74 0 1018.68 0C1021.32 0 1023.38 2.05533 1023.38 4.69787C1023.38 7.63405 1021.32 9.68937 1018.68 9.68937Z"},Ra="'IBM Plex Mono', monospace",Bc="'Doto', monospace",rJ=[{id:"complexityLife",num:"01.",symbol:"",name:"Complexity Lab",tag:"FOUNDATION",tagColor:"#ffd400",statusLabel:"ALPHA V0",description:"APRENDA A OPERAR COM O ALGORITMO DA VIDA ARTIFICIAL ATRAVS DE EXPERIMENTOS, PRESETS E PARMETROS VARIVEIS INTERATIVOS.",enabled:!0},{id:"metaArtLab",num:"02.",symbol:"",name:"Meta-Gen-Art",tag:"GENERATIVE ART",tagColor:"#ff0084",statusLabel:"EXPERIMENTAL BUILD",description:'LABORATRIO DE CRIAO VIVA. EXPERIMENTE FAZER ARTE GENERATIVA ATRAVS DE "TINTA" COM VIDA PRPRIA.',enabled:!0},{id:"psycheLab",num:"03.",symbol:"",name:"Psyche Lab",tag:"NEURAL FIELDS",tagColor:"#8b5cf6",statusLabel:"ALPHA V0",description:"CAMPOS NEURAIS E DINMICAS DE CONSCINCIA. EXPERIMENTE FLUXOS PSQUICOS EMERGENTES ATRAVS DE AGENTES ARQUETPICOS.",enabled:!0},{id:"musicLab",num:"04.",symbol:"",name:"Complex Music Lab",tag:"INSTRUMENT",tagColor:"#37b2da",statusLabel:"ALPHA V0",description:"INSTRUMENTO MUSICAL DIGITAL COMPLEXO. USE PARTCULAS COM VIDA PRPRIA PRA FAZER MSICA EXPERIMENTAL.",enabled:!0},{id:"rhizomeLab",num:"05.",symbol:"",name:"Rhizome Search",tag:"EPISTEMIC SEARCH",tagColor:"#10d45b",statusLabel:"ALPHA V0",description:"FERRAMENTA PARA PESQUISAS EPISTEMOLGICAS NO-LINEARES. VEJA CONCEITOS/NOMES/BIBLIOGRAFIAS ATRAVS DE RIZOMAS EXPANSVEIS.",enabled:!0},{id:"alchemyLab",num:"06.",symbol:"",name:"Alchemy Table",tag:"ALCHEMY + CHEMISTRY",tagColor:"#d6552d",statusLabel:"ALPHA V0",description:"APRENDA O CONCEITO BSICO DE EMERGNCIA, TRANSMUTAO E COMPLEXIDADE DE ELEMENTOS QUMICOS E METAFRICOS.",enabled:!0},{id:"treeOfLife",num:"07.",symbol:"",name:"Tree of Life",tag:"HERMETIC QABALAH",tagColor:"#601480",statusLabel:"ALPHA V0",description:"HERMETIC QABALAH SIMULATOR. EXPLORE THE 10 SEPHIROTH, 22 PATHS, TAROT ARCANA, RITUAL TOOLS AND THE GREAT WORK. GOLDEN DAWN TRADITION.",enabled:!0},{id:"sociogenesis",num:"08.",symbol:"",name:"Sociogenesis",tag:"SOCIOLOGIA",tagColor:"#9f1111",statusLabel:"EXPERIMENTAL BUILD",description:"DESCUBRA A EMERGNCIA DE SMBOLOS, INSTITUIES, MITOS, TOTENS E TABUS ENTRE AGENTES E COMO ISSO ALTERA O CAMPO.",enabled:!0},{id:"milPlatos",num:"09.",symbol:"",name:"Mil Plats",tag:"CsO LENS",tagColor:"#6366f1",statusLabel:"EXPERIMENTAL BUILD",description:"LENTE OPERACIONAL DELEUZE & GUATTARI. SIMULE ESTRATIFICAO  CORPO SEM RGOS, PLATS, RIZOMA E LINHAS DE FUGA.",enabled:!0},{id:"languageLab",num:"10.",symbol:"",name:"Recursive Language",tag:"",tagColor:"#191919",statusLabel:"",description:"EM BREVE",enabled:!1},{id:"asimovTheater",num:"11.",symbol:"",name:"Psico-history Theater",tag:"",tagColor:"#191919",statusLabel:"",description:"EM BREVE",enabled:!1},{id:"physicsSandbox",num:"12.",symbol:"",name:"Physics Sandbox",tag:"",tagColor:"#141414",statusLabel:"",description:"EM BREVE",enabled:!1}],oJ=[ha.p127a1200,ha.p39a3e180,ha.p3116aa00,ha.p21125400,ha.p3810b500,ha.pbcf7c00,ha.p3dc6840,ha.p2b8b7000,ha.p2d0f700,ha.p17fb5300,ha.p161bb100,ha.p21538800,ha.p3459ed80,ha.p7993e00,ha.p25265000,ha.p1fde8480,ha.p2fae140,ha.p3f52de00],Cx={t:[[0,1],[1,1],[2,1],[1,0],[1,2],[1,3],[1,4]],four:[[0,0],[0,1],[0,2],[1,2],[2,0],[2,1],[2,2],[2,3],[2,4]],p:[[0,0],[0,1],[0,2],[0,3],[0,4],[1,0],[1,2],[2,0],[2,1],[2,2]]};function aJ({onComplete:e}){const t=w.useRef(!1);w.useEffect(()=>{const s=setTimeout(()=>{t.current||(t.current=!0,e())},4200);return()=>clearTimeout(s)},[e]);const r={hidden:{scale:0,opacity:0},visible:s=>({scale:1,opacity:1,transition:{delay:.3+s*.07,type:"spring",stiffness:120,damping:18,mass:1.2}}),exit:s=>({scale:0,opacity:0,y:-8+Math.random()*-16,x:(Math.random()-.5)*20,transition:{delay:s*.025,duration:.9,ease:[.4,0,.2,1]}})},o=(s,l)=>a.jsx("div",{className:"relative",style:{width:60,height:100},children:s.map(([i,u],c)=>a.jsx(to.div,{custom:c+l*5,variants:r,initial:"hidden",animate:"visible",exit:"exit",className:"absolute rounded-full bg-white",style:{width:10,height:10,left:i*20+1,top:u*20+1,boxShadow:"0 0 6px rgba(255,255,255,0.3)"}},`${l}-${c}`))});return a.jsx(to.div,{className:"fixed inset-0 flex items-center justify-center z-50 pointer-events-none",initial:{opacity:1},exit:{opacity:0,transition:{duration:1.2,ease:[.4,0,.2,1]}},children:a.jsxs("div",{className:"flex gap-8",children:[o(Cx.t,0),o(Cx.four,1),o(Cx.p,2)]})})}function Q7(e){return Math.min(1,Math.max(0,e))}function R5(e,t,r){const o=Q7(r),s=f=>[parseInt(f.slice(0,2),16),parseInt(f.slice(2,4),16),parseInt(f.slice(4,6),16)],[l,i,u]=s(e.replace("#","")),[c,d,h]=s(t.replace("#",""));return`rgb(${Math.round(l+(c-l)*o)},${Math.round(i+(d-i)*o)},${Math.round(u+(h-u)*o)})`}const sJ=[{at:0,x:50,y:28,s:1,o:1,cr:0,sr:0,tr:0,cp:0,dec:0},{at:.12,x:50,y:28,s:1,o:1,cr:0,sr:0,tr:0,cp:0,dec:0},{at:.22,x:38,y:40,s:.82,o:.6,cr:14,sr:-16,tr:10,cp:0,dec:0},{at:.3,x:38,y:40,s:.78,o:.5,cr:24,sr:-22,tr:16,cp:.4,dec:0},{at:.38,x:50,y:48,s:.36,o:.5,cr:0,sr:0,tr:0,cp:1,dec:0},{at:.44,x:50,y:48,s:.38,o:.4,cr:0,sr:0,tr:0,cp:1,dec:.3},{at:.52,x:50,y:46,s:.45,o:.18,cr:40,sr:-55,tr:80,cp:1,dec:.8},{at:.58,x:50,y:44,s:.55,o:0,cr:80,sr:-110,tr:160,cp:1,dec:1}];function iJ(e){const t=sJ;if(e<=t[0].at)return t[0];if(e>=t[t.length-1].at)return t[t.length-1];for(let r=0;r<t.length-1;r++){const o=t[r],s=t[r+1];if(e>=o.at&&e<=s.at){const l=(e-o.at)/(s.at-o.at),i=l*l*(3-2*l),u=c=>o[c]+(s[c]-o[c])*i;return{at:e,x:u("x"),y:u("y"),s:u("s"),o:u("o"),cr:u("cr"),sr:u("sr"),tr:u("tr"),cp:u("cp"),dec:u("dec")}}}return t[t.length-1]}function lJ({scrollTarget:e}){const t=w.useRef(null),r=w.useRef(null),o=w.useRef(null),s=w.useRef(0),l=w.useRef(0);return w.useEffect(()=>{let i;l.current=performance.now();const u=c=>{s.current+=(e.current-s.current)*.09;const d=iJ(s.current);if(!o.current||!r.current||!t.current){i=requestAnimationFrame(u);return}if(d.o<.005){o.current.style.display="none",i=requestAnimationFrame(u);return}o.current.style.display="",o.current.style.opacity=String(d.o),r.current.style.left=`${d.x}%`,r.current.style.top=`${d.y}%`,r.current.style.transform=`translate(-50%,-50%) scale(${d.s})`;const h=(c-l.current)/1e3,f=d.dec,g=1+f*3,m=d.cr+Math.sin(h*.3*g)*(12+f*35)+h*4*g,y=d.sr+Math.cos(h*.22*g)*(10+f*30)-h*3*g,v=d.tr+Math.sin(h*.28*g+1.2)*(14+f*45)+h*3.5*g,b=Math.sin(h*.18*g+2.4)*(8+f*22)-h*2.5*g,S=1.5,C=f*f,k=Math.sin(h*.23+.5)*(S+C*20)-C*12,R=Math.cos(h*.19+1)*(S*.8+C*14)-C*10,j=Math.cos(h*.26+2)*(S+C*18)+C*14,T=Math.sin(h*.21+.3)*(S*.7+C*16)+C*8,_=Math.sin(h*.3+3)*(S*1.2+C*20)+C*6,P=Math.cos(h*.17+1.5)*(S+C*22)+C*16,I=Math.cos(h*.24+.8)*(S*.9+C*15)-C*8,$=Math.sin(h*.2+2.5)*(S*.6+C*18)-C*14,q=.55+d.cp*.55,L=R5("#888888","#37B2DA",d.cp),H=R5("#888888","#FF0084",d.cp),G=R5("#888888","#FFD500",d.cp),oe=R5("#888888","#14801A",d.cp),pe=t.current.querySelectorAll(":scope > g");pe[0].setAttribute("transform",`rotate(${m} 50 50) translate(${k} ${R})`);const ce=pe[0].firstElementChild;ce.setAttribute("stroke",L),ce.setAttribute("stroke-width",String(q)),ce.style.opacity=String(1-f*.35),pe[1].setAttribute("transform",`rotate(${y} 50 50) translate(${j} ${T})`);const te=pe[1].firstElementChild;te.setAttribute("stroke",H),te.setAttribute("stroke-width",String(q)),te.style.opacity=String(1-f*.35),pe[2].setAttribute("transform",`rotate(${v} 50 50) translate(${_} ${P})`);const F=pe[2].firstElementChild;F.setAttribute("stroke",G),F.setAttribute("stroke-width",String(q)),F.style.opacity=String(1-f*.35),pe[3].setAttribute("transform",`rotate(${b} 50 50) translate(${I} ${$})`);const Q=pe[3].firstElementChild;Q.setAttribute("stroke",oe),Q.setAttribute("stroke-width",String(q)),Q.style.opacity=String(1-f*.45),i=requestAnimationFrame(u)};return i=requestAnimationFrame(u),()=>cancelAnimationFrame(i)},[e]),a.jsx("div",{ref:o,className:"fixed inset-0 z-[1] pointer-events-none",children:a.jsx("div",{ref:r,className:"absolute",style:{width:400,height:400,left:"50%",top:"28%",transform:"translate(-50%,-50%)"},children:a.jsxs("svg",{ref:t,viewBox:"0 0 100 100",className:"w-full h-full",children:[a.jsx("g",{children:a.jsx("circle",{cx:"50",cy:"50",r:"46",fill:"none",stroke:"#888",strokeWidth:"0.55"})}),a.jsx("g",{children:a.jsx("rect",{x:"17.5",y:"17.5",width:"65",height:"65",fill:"none",stroke:"#888",strokeWidth:"0.55"})}),a.jsx("g",{children:a.jsx("path",{d:"M50 26.2 L82.5 82.5 L17.5 82.5 Z",fill:"none",stroke:"#888",strokeWidth:"0.55"})}),a.jsx("g",{children:a.jsx("circle",{cx:"50",cy:"63.7",r:"18.8",fill:"none",stroke:"#888",strokeWidth:"0.55"})})]})})})}function cJ({active:e}){const t=w.useRef(null),r=w.useRef([]),o=w.useRef(null),s=w.useRef(null),l=w.useRef(!1),i=w.useRef(!1),u=w.useRef(!1),c=w.useRef([[],[]]);return w.useEffect(()=>{const d=t.current;if(!d)return;const h=d.getContext("2d");if(!h)return;const f=()=>{const S=d.parentElement,C=(S==null?void 0:S.clientWidth)??innerWidth,k=(S==null?void 0:S.clientHeight)??innerHeight;d.width=Math.floor(C*devicePixelRatio),d.height=Math.floor(k*devicePixelRatio),d.style.width=`${C}px`,d.style.height=`${k}px`,h.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0)},g=()=>{f();const S=d.clientWidth,C=d.clientHeight;r.current=[{x:-20,y:C*.42,vx:2.4,vy:.4,z:1,predator:!0,kind:"duelist"},{x:S+20,y:C*.58,vx:-2.4,vy:-.4,z:1,predator:!0,kind:"duelist"}],c.current=[[],[]],l.current=i.current=u.current=!1,s.current=null},m=(S,C,k)=>{const R=Math.hypot(S.vx,S.vy)||.001;R>k?(S.vx=S.vx/R*k,S.vy=S.vy/R*k):R<C&&(S.vx=S.vx/R*C,S.vy=S.vy/R*C)},y=(S,C,k)=>{const R=d.clientWidth,j=d.clientHeight;for(let T=0;T<C;T++){const _=Math.random(),P=_<.06?1.5+Math.random()*.4:_<.22?1.15+Math.random()*.35:.35+Math.random()*.8,I=.55+P*.45;r.current.push({x:S?-8-Math.random()*40:R+8+Math.random()*40,y:j*.15+Math.random()*j*.7,vx:(S?1:-1)*(1.2+Math.random()*1.6)*I,vy:(Math.random()-.5)*1.8*I,z:P,predator:T>=C*(1-k),kind:"swarm"})}},v=S=>{s.current||(s.current=S);const C=(S-s.current)/1e3,k=d.clientWidth,R=d.clientHeight,j=r.current,T=k/2,_=R/2;if(C>6&&!l.current&&(y(!0,30,0),l.current=!0),C>6.5&&!i.current&&(y(!1,30,0),i.current=!0),C>7.2&&!u.current&&(y(Math.random()<.5,6,1),u.current=!0),h.clearRect(0,0,k,R),C>1.2&&C<7&&j.length>=2){const P=j[0],I=j[1],$=Math.hypot(P.x-I.x,P.y-I.y),q=Math.max(0,1-$/220);h.save(),h.beginPath(),h.moveTo(P.x,P.y),h.lineTo(I.x,I.y),h.strokeStyle=`rgba(255,255,255,${(.06+Math.sin(C*4.5)*.04)*q})`,h.lineWidth=.4,h.setLineDash([3,4]),h.stroke(),h.setLineDash([]),h.restore()}for(let P=0;P<j.length;P++){const I=j[P];if(C<7&&I.kind==="duelist"){const G=j[P===0?1:0],oe=G.x-I.x,le=G.y-I.y,pe=Math.hypot(oe,le)||.001,ce=oe/pe,te=le/pe,F=T-I.x,Q=_-I.y,ae=Math.hypot(F,Q)||.001,we=Math.max(24,100-C*14),Re=pe-we,ge=.6+C*.12;I.vx+=F/ae*.065+-te*.13*ge+ce*Re*.0035+Math.sin(C*8.1+P*3)*.12,I.vy+=Q/ae*.065+ce*.13*ge+te*Re*.0035+Math.cos(C*6.3+P*5)*.12,C%1.2<.15&&P===Math.floor(C/1.2)%2&&(I.vx+=ce*.65,I.vy+=te*.65),m(I,1.4,3.2),P<2&&(c.current[P].push({x:I.x,y:I.y}),c.current[P].length>20&&c.current[P].shift())}else{let G=0,oe=0,le=0,pe=0,ce=0,te=0,F=0,Q=0,ae=0,we=0,Re=0,ge=0;for(let Ae=0;Ae<j.length;Ae++){if(P===Ae)continue;const tt=j[Ae],We=tt.x-I.x,J=tt.y-I.y,ke=Math.hypot(We,J)||.001;!I.predator&&tt.predator&&ke<150&&(Re-=We/ke,ge-=J/ke),I.predator&&!tt.predator&&ke<190&&(Q+=We/ke,ae+=J/ke,we++),I.predator===tt.predator&&ke<(I.predator?130:95)&&(G+=tt.vx,oe+=tt.vy,le+=tt.x,pe+=tt.y,F++,ke<22&&(ce-=We/ke,te-=J/ke))}F>0&&(G/=F,oe/=F,le=le/F-I.x,pe=pe/F-I.y),I.predator?(I.vx+=G*.022+le*6e-4+ce*.12,I.vy+=oe*.022+pe*6e-4+te*.12,we>0&&(I.vx+=Q/we*.1,I.vy+=ae/we*.1),m(I,1.3,2.8)):(I.vx+=G*.034+le*.0018+ce*.15+Re*.09,I.vy+=oe*.034+pe*.0018+te*.15+ge*.09,m(I,.7,2.3))}if(I.x+=I.vx,I.y+=I.vy,I.x<-30&&(I.x+=k+60),I.x>k+30&&(I.x-=k+60),I.y<-30&&(I.y+=R+60),I.y>R+30&&(I.y-=R+60),I.kind==="duelist"&&P<2&&C<9){const G=c.current[P];for(let le=1;le<G.length;le++)h.beginPath(),h.moveTo(G[le-1].x,G[le-1].y),h.lineTo(G[le].x,G[le].y),h.strokeStyle=`rgba(255,255,255,${le/G.length*.2})`,h.lineWidth=1.2*(le/G.length),h.stroke();const oe=h.createRadialGradient(I.x,I.y,0,I.x,I.y,12);oe.addColorStop(0,"rgba(255,255,255,0.12)"),oe.addColorStop(1,"rgba(255,255,255,0)"),h.fillStyle=oe,h.beginPath(),h.arc(I.x,I.y,12,0,Math.PI*2),h.fill()}const $=Math.atan2(I.vy,I.vx),q=I.z,L=(I.kind==="duelist"?4.5:I.predator?3.2:2)*q,H=I.kind==="duelist"?1:Q7(.25+q*.55);if(q>1.2&&I.kind!=="duelist"){const G=L*4,oe=h.createRadialGradient(I.x,I.y,0,I.x,I.y,G);oe.addColorStop(0,`rgba(255,255,255,${.05*q})`),oe.addColorStop(1,"rgba(255,255,255,0)"),h.fillStyle=oe,h.beginPath(),h.arc(I.x,I.y,G,0,Math.PI*2),h.fill()}h.save(),h.translate(I.x,I.y),h.rotate($),h.beginPath(),h.moveTo(L*2.2,0),h.lineTo(-L,L*.85),h.lineTo(-L*.3,0),h.lineTo(-L,-L*.85),h.closePath(),h.fillStyle=I.kind==="duelist"?"#fff":I.predator?`rgba(255,255,255,${.92*H})`:`rgba(200,200,200,${.72*H})`,h.fill(),h.restore()}e&&(o.current=requestAnimationFrame(v))};e&&(g(),o.current=requestAnimationFrame(v));const b=()=>f();return addEventListener("resize",b),()=>{removeEventListener("resize",b),o.current&&cancelAnimationFrame(o.current)}},[e]),a.jsx("canvas",{ref:t,className:"absolute inset-0 w-full h-full opacity-55"})}function yC({onClick:e}){const t=["#FF0084","#FFD500","#37B2DA","#14801A","#601480"];return a.jsx(to.div,{className:"flex gap-2 cursor-pointer group justify-center",whileHover:{gap:"12px"},onClick:e,children:["T","O","O","L","S"].map((r,o)=>a.jsx(to.div,{className:"w-10 h-10 rounded-full flex items-center justify-center bg-zinc-800 border border-transparent group-hover:border-white/20 transition-all",whileHover:{scale:1.2,backgroundColor:t[o]},children:a.jsx("span",{className:"font-bold text-sm text-white/50 group-hover:text-white transition-colors",style:{fontFamily:Bc},children:r})},o))})}function dJ({onEnterLab:e,onOpenAdmin:t,adminMode:r=!1}){const[o,s]=w.useState(!1),l=w.useRef(null),i=w.useRef(0),u=w.useRef(null),[c,d]=w.useState(!1);w.useEffect(()=>{const g=u.current;if(!g)return;const m=new IntersectionObserver(([y])=>d(y.isIntersecting&&y.intersectionRatio>=.4),{threshold:[.15,.4,.7]});return m.observe(g),()=>m.disconnect()},[]);const h=()=>{const g=l.current;g&&(i.current=g.scrollTop/Math.max(1,g.scrollHeight-g.clientHeight))},f=()=>{var g;return(g=document.getElementById("labs-section"))==null?void 0:g.scrollIntoView({behavior:"smooth"})};return a.jsxs("div",{className:"fixed inset-0 bg-black text-white overflow-hidden",children:[t&&a.jsx("button",{onClick:t,className:"fixed top-3 right-3 z-20 px-3 py-2 rounded-xl border border-dashed border-white/15 bg-black/60 hover:bg-white/5 transition-colors",style:{fontFamily:Ra,fontSize:10,letterSpacing:"0.2em",textTransform:"uppercase",color:r?"#f59e0b":"rgba(255,255,255,0.45)"},title:r?"Admin Mode (ativado)":"Admin Mode (senha)",children:r?"ADMIN ON":"ADMIN"}),a.jsx(Xc,{children:!o&&a.jsx(aJ,{onComplete:()=>s(!0)})}),o&&a.jsx(lJ,{scrollTarget:i}),a.jsxs(to.div,{ref:l,onScroll:h,className:"h-full w-full overflow-y-auto overflow-x-hidden relative z-10 snap-y snap-mandatory scroll-smooth",initial:{opacity:0},animate:{opacity:o?1:0},transition:{duration:.9,ease:"easeOut"},children:[a.jsxs("section",{className:"h-[100svh] snap-start flex flex-col items-center justify-center px-6",children:[a.jsx("div",{style:{flex:"1 1 0",minHeight:"12vh"}}),a.jsx(to.div,{className:"w-[min(92vw,1040px)]",initial:{opacity:0,y:18},whileInView:{opacity:1,y:0},viewport:{once:!0,amount:.5},transition:{duration:1,delay:.15},children:a.jsx("svg",{className:"w-full",viewBox:"0 0 1313.7 430.6",fill:"white",children:oJ.map((g,m)=>a.jsx("path",{d:g},m))})}),a.jsx(to.p,{className:"mt-5 text-zinc-500 text-[10px] md:text-xs tracking-[0.5em] text-center",style:{fontFamily:Ra},initial:{opacity:0},whileInView:{opacity:1},viewport:{once:!0},transition:{delay:.4,duration:.7},children:"ALPHA TEST"}),a.jsx(to.div,{className:"mt-8",initial:{opacity:0},whileInView:{opacity:1},viewport:{once:!0},transition:{delay:.55,duration:.6},children:a.jsx(yC,{onClick:f})}),a.jsx("div",{style:{flex:"1.6 1 0",minHeight:"16vh"}})]}),a.jsx("section",{className:"h-[100svh] snap-start flex items-center px-6 lg:px-16 py-16",children:a.jsxs(to.div,{className:"w-full max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-[1fr_auto] gap-10 lg:gap-16 items-center",initial:{opacity:0,y:28},whileInView:{opacity:1,y:0},viewport:{amount:.4},transition:{duration:1},children:[a.jsxs("div",{className:"space-y-5 text-center lg:text-left",children:[a.jsx("p",{className:"text-zinc-500 text-[10px] tracking-[0.35em] uppercase",style:{fontFamily:Ra},children:" um projeto"}),a.jsx("h2",{className:"text-[clamp(30px,5.6vw,72px)] leading-[0.92] uppercase",style:{fontFamily:Bc},children:"Epistemolgico Operacional"}),a.jsx("p",{className:"text-zinc-400 text-[11px] md:text-xs leading-relaxed uppercase max-w-lg mx-auto lg:mx-0",style:{fontFamily:Ra},children:"Criamos ferramentas para perceber e estudar de forma heurstica, sistemas dinmicos e complexos, atravs de processos semiticos, experimentais, metafricos e no-lineares."}),a.jsx("p",{className:"text-zinc-500 text-[10px] md:text-[11px] leading-relaxed uppercase max-w-lg mx-auto lg:mx-0 pt-2",style:{fontFamily:Ra},children:"Queremos propor um processo operacional epistemolgico contnuo e recursivo para experimentar processos de auto-percepo, criao e formulao de hipteses."})]}),a.jsxs("div",{className:"text-center lg:text-right space-y-2 lg:pr-4",children:[a.jsx("p",{className:"text-zinc-500 text-[10px] tracking-[0.3em] uppercase",style:{fontFamily:Ra},children:"as ferramentas so"}),a.jsx("p",{className:"text-white text-[clamp(32px,5vw,64px)] uppercase leading-none",style:{fontFamily:Bc},children:'"LENTES"'})]})]})}),a.jsxs("section",{ref:u,className:"h-[100svh] snap-start relative overflow-hidden flex items-center px-6 py-16",children:[a.jsx(cJ,{active:c}),a.jsxs(to.div,{className:"relative z-10 w-full max-w-5xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-16 items-center",initial:{opacity:0,y:24},whileInView:{opacity:1,y:0},viewport:{amount:.35},transition:{duration:1},children:[a.jsxs("div",{className:"space-y-4 text-center lg:text-left",children:[a.jsx("h3",{className:"text-[clamp(24px,4vw,42px)] uppercase",style:{fontFamily:Bc},children:"Algoritmo"}),a.jsx("p",{className:"text-zinc-400 text-[11px] md:text-xs leading-relaxed uppercase max-w-sm mx-auto lg:mx-0",style:{fontFamily:Ra},children:"Todas as nossas ferramentas utilizam o mesmo princpio e algoritmo de vida artificial customizado (ALife), baseado em partculas com arqutipos variveis, mutveis e influenciveis."}),a.jsx("p",{className:"text-zinc-600 text-[9px] tracking-[0.2em] uppercase pt-1",style:{fontFamily:Ra},children:"simulao rodando em tempo real no background"})]}),a.jsxs("div",{className:"flex flex-col items-center lg:items-end gap-2",style:{fontFamily:Bc},children:[a.jsx("span",{className:"text-[#FFD500] text-[clamp(14px,2vw,22px)] uppercase",children:"[ Campo ]"}),a.jsx("span",{className:"text-zinc-500 text-[clamp(14px,2vw,22px)]",children:""}),a.jsxs("div",{className:"flex items-center gap-2 whitespace-nowrap flex-wrap justify-center lg:justify-end",children:[a.jsx("span",{className:"text-[#14801A] text-[clamp(14px,2vw,22px)] uppercase",children:"[ Agentes ]"}),a.jsx("span",{className:"text-zinc-500 text-[clamp(14px,2vw,22px)]",children:""}),a.jsx("span",{className:"text-[#FF0084] text-[clamp(14px,2vw,22px)] uppercase",children:"[ Interaes ]"})]}),a.jsx("span",{className:"text-zinc-500 text-[clamp(14px,2vw,22px)]",children:""}),a.jsx("span",{className:"text-[#FFD500] text-[clamp(14px,2vw,22px)] uppercase",children:"[ Campo ]"}),a.jsx("span",{className:"text-zinc-400 text-[clamp(11px,1.5vw,16px)] normal-case mt-1",children:" (recursividade)"})]})]})]}),a.jsx("section",{className:"h-[100svh] snap-start flex flex-col items-center justify-center px-6 py-16",children:a.jsxs(to.div,{className:"max-w-5xl w-full text-center space-y-10",initial:{opacity:0,y:24},whileInView:{opacity:1,y:0},viewport:{amount:.45},transition:{duration:1},children:[a.jsx("p",{className:"text-zinc-300 text-[clamp(15px,2.5vw,34px)] leading-[1.4] uppercase tracking-[0.1em]",style:{fontFamily:Bc},children:"Acreditamos que o processo de construir uma hiptese deve ser livre, varivel, contnuo, visual e meta-lingustico."}),a.jsx("p",{className:"text-zinc-300 text-[clamp(15px,2.5vw,34px)] leading-[1.4] uppercase tracking-[0.1em]",style:{fontFamily:Bc},children:'A ideia no  achar verdade definitiva, e sim propor uma lente que  anttese a equaes lineares e "fechadas".'}),a.jsxs("div",{className:"pt-6 flex flex-col items-center gap-5",children:[a.jsx(yC,{onClick:f}),a.jsx("p",{className:"text-zinc-600 text-[10px] tracking-[0.25em] uppercase",style:{fontFamily:Ra},children:"9 ferramentas disponveis + 3 em breve."}),a.jsx("p",{className:"text-zinc-700 text-[9px] tracking-[0.15em] uppercase",style:{fontFamily:Ra},children:"(grtis durante alpha test)"})]})]})}),a.jsxs("section",{id:"labs-section",className:"snap-start pb-24 pt-16 px-4 md:px-12 max-w-[1600px] mx-auto w-full",children:[a.jsx("div",{className:"mb-16 border-b border-dashed border-white/10 pb-4",children:a.jsx("h3",{className:"text-zinc-500 text-sm tracking-widest",style:{fontFamily:Ra},children:"AVAILABLE TOOLS (9) + SOON (3)"})}),a.jsxs("div",{className:"grid gap-0",children:[rJ.map((g,m)=>a.jsxs(to.div,{initial:{opacity:0,y:14},whileInView:{opacity:1,y:0},viewport:{once:!0,amount:.2},transition:{delay:m*.04,duration:.5},className:`group border-t border-dashed border-white/10 py-8 grid grid-cols-1 md:grid-cols-12 gap-6 items-start hover:bg-white/5 transition-colors cursor-pointer ${!g.enabled&&!r?"opacity-40":""}`,onClick:()=>(g.enabled||r)&&e(g.id),children:[a.jsx("div",{className:"col-span-1 md:col-span-1 text-2xl text-zinc-600 font-light",style:{fontFamily:Ra},children:g.num}),a.jsxs("div",{className:"col-span-1 md:col-span-4 flex items-center gap-4",children:[a.jsx("span",{className:"text-3xl filter grayscale group-hover:grayscale-0 transition-all",style:{color:g.tagColor},children:g.symbol}),a.jsx("h4",{className:"text-2xl md:text-3xl font-light uppercase tracking-tight",style:{fontFamily:Bc},children:g.name})]}),a.jsxs("div",{className:"col-span-1 md:col-span-3 flex flex-col gap-2",children:[g.tag&&a.jsxs("span",{className:"text-[10px] tracking-widest uppercase font-bold",style:{color:g.tagColor,fontFamily:Ra},children:["[",g.tag,"]"]}),a.jsx("span",{className:"text-[10px] text-zinc-600 tracking-widest uppercase",style:{fontFamily:Ra},children:!g.enabled&&!r?g.statusLabel||"TRANCADO":g.statusLabel||""})]}),a.jsx("div",{className:"col-span-1 md:col-span-4",children:a.jsx("p",{className:"text-xs text-zinc-400 leading-relaxed uppercase",style:{fontFamily:Ra},children:g.description})})]},g.id)),a.jsx("div",{className:"border-t border-dashed border-white/10"})]})]}),a.jsxs("footer",{className:"py-24 text-center snap-start",children:[a.jsx("div",{className:"flex justify-center gap-2 mb-8",children:["T","O","O","L","S"].map((g,m)=>a.jsx("div",{className:"w-6 h-6 rounded-full bg-zinc-900 text-zinc-600 flex items-center justify-center text-[10px] font-bold",style:{fontFamily:Ra},children:g},m))}),a.jsx("p",{className:"text-zinc-700 text-[10px] tracking-widest uppercase",style:{fontFamily:Ra},children:"Tools for Perception  2026"})]})]})]})}class uJ extends Yt.Component{constructor(){super(...arguments),this.state={error:null},this.reset=()=>{this.setState({error:null})}}static getDerivedStateFromError(t){return{error:t}}componentDidCatch(t,r){var o,s;(s=(o=this.props).onError)==null||s.call(o,t,r)}componentDidUpdate(t){if(!this.state.error)return;const r=t.resetKeys??[],o=this.props.resetKeys??[];hJ(r,o)||this.reset()}render(){var r,o;const{error:t}=this.state;return t?((o=(r=this.props).fallbackRender)==null?void 0:o.call(r,{error:t,reset:this.reset}))??null:this.props.children}}function hJ(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!Object.is(e[r],t[r]))return!1;return!0}const fJ=()=>({enabled:!1,strength:.25,intervalFrames:10,smoothing:.85,chaosClamp:.75}),Th={entropyLike:0,clustering:0,conflict:0,diversity:0,stagnation:0,energy:0},eA={chokhmah:0,binah:0,chesed:0,gevurah:0,tiferet:0},Rg={force:0,drag:0,entropy:0,beta:0,rmax:0,mutationRate:0},Lb=()=>({config:fJ(),metrics:{...Th},activations:{...eA},modulation:{...Rg},metricsHistory:[],historyMaxLen:20,phase:0,phaseLabel:"Bloom",frameCounter:0,runawayCounter:0}),Aa=16,pJ=500;function qi(e,t,r){return e+(t-e)*r}function Ia(e){return Math.max(0,Math.min(1,e))}function Bu(e,t){return Math.max(-t,Math.min(t,e))}function mJ(e,t){const r=e.count;if(r===0)return{...Th};const o=Math.max(1,t.typesCount),s=Math.max(1,Math.floor(r/pJ));let l=0;const i=new Uint16Array(Aa*Aa*o),u=new Uint16Array(Aa*Aa);let c=0,d=0;const h=new Float32Array(o);for(let I=0;I<r;I+=s){const $=e.type[I];if($===Jl)continue;const q=Math.min(Aa-1,Math.max(0,Math.floor((e.x[I]+1)*.5*Aa))),H=Math.min(Aa-1,Math.max(0,Math.floor((e.y[I]+1)*.5*Aa)))*Aa+q,G=Math.min(o-1,Math.max(0,$));i[H*o+G]++,u[H]++,G<o&&h[G]++;const oe=Math.sqrt(e.vx[I]*e.vx[I]+e.vy[I]*e.vy[I]);c+=oe,oe>t.speedClamp*.55&&d++,l++}if(l===0)return{...Th};let f=0,g=0;const m=Math.log2(Math.max(2,o));for(let I=0;I<Aa*Aa;I++){const $=u[I];if($===0)continue;g++;let q=0;for(let L=0;L<o;L++){const H=i[I*o+L];if(H>0){const G=H/$;q-=G*Math.log2(G)}}f+=q/m}const y=g>0?Ia(f/g):0,v=l/(Aa*Aa);let b=0;for(let I=0;I<Aa*Aa;I++){const $=u[I]-v;b+=$*$}b/=Aa*Aa;const S=Math.max(1,v*v*6),C=Ia(b/S),k=Ia(d/l*2.2),R=Math.max(1,l*.02);let j=0;for(let I=0;I<o;I++)h[I]>=R&&j++;const T=o>1?Ia(j/o):1,_=c/l,P=Ia(_/Math.max(.001,t.speedClamp));return{entropyLike:y,clustering:C,conflict:k,diversity:T,stagnation:0,energy:P}}function gJ(e){const t=e.length;if(t<4)return 0;const r=e.slice(-Math.min(5,t)),o=e.slice(-Math.min(10,t),-Math.min(5,t));if(o.length===0)return 0;const s=xC(r),l=xC(o),i=(Math.abs(s.entropyLike-l.entropyLike)+Math.abs(s.clustering-l.clustering)+Math.abs(s.conflict-l.conflict)+Math.abs(s.diversity-l.diversity)+Math.abs(s.energy-l.energy))/5;return Ia(1-i*4)}function xC(e){const t=e.length;if(t===0)return{...Th};const r={...Th};for(const o of e)r.entropyLike+=o.entropyLike,r.clustering+=o.clustering,r.conflict+=o.conflict,r.diversity+=o.diversity,r.energy+=o.energy,r.stagnation+=o.stagnation;return{entropyLike:r.entropyLike/t,clustering:r.clustering/t,conflict:r.conflict/t,diversity:r.diversity/t,energy:r.energy/t,stagnation:r.stagnation/t}}function yJ(e,t,r){const{entropyLike:o,clustering:s,conflict:l,diversity:i,stagnation:u}=e;let c=0,d=0,h=0,f=0;if(u>.5){const R=u-.5;c+=R*1.2,h+=R*.7}if(l>.6){const R=l-.6;d+=R*1.5,f+=R*1}o<.45&&(c+=(.45-o)*1.3),o>.7&&(f+=(o-.7)*1.4,d+=(o-.7)*.6),i<.3&&(c+=(.3-i)*1.5),s>.7&&(f+=(s-.7)*1.2),s<.3&&(h+=(.3-s)*1.2);const g=Math.max(0,Math.abs(o-.575)-.125),m=Math.max(0,Math.abs(l-.4)-.2),y=Math.max(0,Math.abs(i-.6)-.3),v=Math.max(0,Math.abs(s-.5)-.2),b=(g+m+y+v)*.25,S=Ia(b*2.5),C={chokhmah:Ia(c),binah:Ia(d),chesed:Ia(h),gevurah:Ia(f),tiferet:S},k=Ia(1-r);return{chokhmah:qi(t.chokhmah,C.chokhmah,k),binah:qi(t.binah,C.binah,k),chesed:qi(t.chesed,C.chesed,k),gevurah:qi(t.gevurah,C.gevurah,k),tiferet:qi(t.tiferet,C.tiferet,k)}}const xJ=.016,bJ=.025,vJ=.01;function SJ(e,t){const{stagnation:r,conflict:o}=e.metrics,s=Math.max(.004,xJ+bJ*r-vJ*o);e.phase=(e.phase+s*t)%1,e.phase<.25?e.phaseLabel="Bloom":e.phase<.5?e.phaseLabel="Consolidate":e.phase<.75?e.phaseLabel="Prune":e.phaseLabel="Renew"}function wJ(e,t,r,o){const s=t*Math.PI*2,l=r*.3,i=Math.sin(s)*l,u=Math.cos(s)*l*.8,c=Ia(e.chesed+i),d=Ia(e.gevurah-i),h=Ia(e.chokhmah+u),f=Ia(e.binah-u),g=.2*Math.min(1,o)*Math.min(1,r),m=Bu((c-d)*.55,g),y=Bu((f-h)*.45,g),v=Bu(h*.35,g),b=Bu((d-c)*.18,g),S=Bu((c-d)*.12,g),C=Bu(h*.4,g);return{force:m,drag:y,entropy:v,beta:b,rmax:S,mutationRate:C}}function CJ(e,t){const r={force:e.force,drag:e.drag,entropy:e.entropy,beta:e.beta,rmax:e.rmax,mutationRate:e.mutationRate};return e.force=Math.max(.05,e.force*(1+t.force)),e.drag=Math.max(.05,Math.min(10,e.drag*(1+t.drag))),e.entropy=Math.max(0,Math.min(.05,e.entropy*(1+t.entropy)+Math.abs(t.entropy)*.001)),e.beta=Math.max(.05,Math.min(.95,e.beta*(1+t.beta))),e.rmax=Math.max(.04,Math.min(.5,e.rmax*(1+t.rmax))),e.mutationRate=Math.max(0,Math.min(.01,e.mutationRate*(1+t.mutationRate))),r}function MJ(e,t){e.force=t.force,e.drag=t.drag,e.entropy=t.entropy,e.beta=t.beta,e.rmax=t.rmax,e.mutationRate=t.mutationRate}function kJ(e,t,r,o){if(e.frameCounter++,!e.config.enabled){e.modulation={...Rg};return}if(e.frameCounter<e.config.intervalFrames)return;e.frameCounter=0;const s=e.config,l=s.intervalFrames*(1/60),i=mJ(t,r);e.metricsHistory.push({...i}),e.metricsHistory.length>e.historyMaxLen&&e.metricsHistory.shift(),i.stagnation=gJ(e.metricsHistory);const u=Ia(1-s.smoothing*.5),c=e.metrics;if(e.metrics={entropyLike:qi(c.entropyLike,i.entropyLike,u),clustering:qi(c.clustering,i.clustering,u),conflict:qi(c.conflict,i.conflict,u),diversity:qi(c.diversity,i.diversity,u),stagnation:qi(c.stagnation,i.stagnation,u),energy:qi(c.energy,i.energy,u)},e.metrics.conflict>.95||e.metrics.energy>.97){if(e.runawayCounter++,e.runawayCounter>4){e.modulation={...Rg},e.runawayCounter=0;return}}else e.runawayCounter=Math.max(0,e.runawayCounter-1);e.activations=yJ(e.metrics,e.activations,s.smoothing),SJ(e,l),e.modulation=wJ(e.activations,e.phase,s.strength,s.chaosClamp)}function RJ(e){e.metricsHistory=[],e.metrics={...Th},e.activations={...eA},e.modulation={...Rg},e.phase=0,e.phaseLabel="Bloom",e.runawayCounter=0,e.frameCounter=0}const bC=!0;function AJ(){const e=["particleLife","energy","field","genes","metamorphosis","reconfig","mitosis","archetypes","feedbackLens","render"],t={};for(const r of e)t[r]={ms:0,active:!0};return t}const jJ=.12;function Vf(e,t,r){const o=e[t];o.ms=o.ms+jJ*(r-o.ms)}function EJ(e,t=3){return Object.keys(e).map(o=>({id:o,ms:e[o].ms})).sort((o,s)=>s.ms-o.ms).slice(0,t)}function tA(){return{births:0,deaths:0,mutations:0,deathsByStarvation:0,deathsByAge:0,deathsByCollision:0,deathsByPredation:0,windowMs:0,lastRates:{birthsPerSec:0,deathsPerSec:0,mutationsPerSec:0,deathsByStarvation:0,deathsByAge:0,deathsByCollision:0,deathsByPredation:0}}}const TJ=1e3;function IJ(e,t,r,o,s){if(e.births+=r,e.deaths+=o,e.mutations+=s,e.windowMs+=t,e.windowMs>=TJ){const l=e.windowMs/1e3;e.lastRates={birthsPerSec:e.births/l,deathsPerSec:e.deaths/l,mutationsPerSec:e.mutations/l,deathsByStarvation:e.deathsByStarvation/l,deathsByAge:e.deathsByAge/l,deathsByCollision:e.deathsByCollision/l,deathsByPredation:e.deathsByPredation/l},e.births=0,e.deaths=0,e.mutations=0,e.deathsByStarvation=0,e.deathsByAge=0,e.deathsByCollision=0,e.deathsByPredation=0,e.windowMs=0}}function nA(e){return{perturbacao:e.chokhmah,autoOrganizacao:e.binah,amplificacao:e.chesed,regulacao:e.gevurah,coerencia:e.tiferet}}function rA(e){return{variedade:e.entropyLike,coesao:e.clustering,atrito:e.conflict,resiliencia:e.diversity,persistencia:e.stagnation,metabolismo:e.energy}}const PJ={Expanso:"#50ff90",Estruturao:"#60d0ff",Seleo:"#ff6050",Reorganizao:"#c080ff"},FJ={Expanso:"",Estruturao:"",Seleo:"",Reorganizao:""},NJ={Expanso:"Loops de reforo dominantes. Crescimento, diversificao.",Estruturao:"Auto-organizao emergindo. Padres se consolidam.",Seleo:"Presso seletiva alta. Loops de balano freiam o crescimento.",Reorganizao:"Perturbao  crise  nova ordem. Motor de emergncia e renovao."};function OJ(e){return{Bloom:"Expanso",Consolidate:"Estruturao",Prune:"Seleo",Renew:"Reorganizao"}[e]}function vC(){const e=Lb();return{feedback:e,metrics:rA(e.metrics),forces:nA(e.activations),systemPhase:"Expanso",modulation:{force:0,drag:0,entropy:0,beta:0,rmax:0,mutationRate:0},moduleTelemetry:AJ(),vitalRates:tA().lastRates,systemHealth:1,emergenceIndex:0}}function _J(e){const t=e.resiliencia,r=e.metabolismo,o=Math.max(0,e.atrito-.6)*2,s=e.persistencia>.7?(e.persistencia-.7)*1.5:0,l=t*.45+r*.3-o*.15-s*.1;return Math.max(0,Math.min(1,l))}function DJ(e){const t=e.variedade*.35+e.coesao*.35+(1-e.persistencia)*.3;return Math.max(0,Math.min(1,t))}function LJ(e,t,r,o){const s=performance.now();kJ(e.feedback,t,r),Vf(e.moduleTelemetry,"feedbackLens",performance.now()-s),e.metrics=rA(e.feedback.metrics),e.forces=nA(e.feedback.activations),e.systemPhase=OJ(e.feedback.phaseLabel),e.modulation=e.feedback.modulation,e.systemHealth=_J(e.metrics),e.emergenceIndex=DJ(e.metrics)}const U5="'Doto', monospace",oa="'IBM Plex Mono', monospace",Ea="#37b2da",Li="rgba(255,255,255,0.18)",Wv="rgba(255,255,255,0.32)";function $u({label:e,open:t,onToggle:r,accent:o}){return a.jsxs("div",{onClick:r,style:{display:"flex",alignItems:"center",gap:4,fontFamily:U5,fontSize:9,letterSpacing:"0.10em",textTransform:"uppercase",color:o??Li,marginBottom:t?7:0,cursor:"pointer",userSelect:"none"},children:[t?a.jsx(Pa,{size:8}):a.jsx(aa,{size:8}),e]})}function qu({label:e,value:t,color:r,hint:o}){const s=Math.round(t*100);return a.jsxs("div",{style:{marginBottom:4},title:o,children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:1.5},children:[a.jsx("span",{style:{fontFamily:oa,fontSize:9,color:Li,letterSpacing:"0.05em"},children:e}),a.jsxs("span",{style:{fontFamily:oa,fontSize:9,color:r+"bb"},children:[s,"%"]})]}),a.jsx("div",{style:{height:2,background:"rgba(255,255,255,0.04)"},children:a.jsx("div",{style:{height:"100%",width:`${s}%`,background:`linear-gradient(90deg,${r}55,${r}aa)`,transition:"width 0.3s"}})})]})}function Ff({label:e,value:t,color:r,hint:o}){const s=Math.round(t*100);return a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginBottom:4},title:o,children:[a.jsx("span",{style:{fontFamily:oa,fontSize:9,color:Wv,width:78,flexShrink:0,letterSpacing:"0.03em"},children:e}),a.jsx("div",{style:{flex:1,height:2,background:"rgba(255,255,255,0.04)"},children:a.jsx("div",{style:{height:"100%",width:`${s}%`,background:`linear-gradient(90deg,${r}55,${r}aa)`,transition:"width 0.25s"}})}),a.jsxs("span",{style:{fontFamily:oa,fontSize:9,color:r+"99",width:22,textAlign:"right",flexShrink:0},children:[s,"%"]})]})}function fa({icon:e,label:t,hint:r,value:o,min:s,max:l,step:i,display:u,onChange:c}){return a.jsxs("div",{style:{marginBottom:7},title:r,children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2,alignItems:"center"},children:[a.jsxs("span",{style:{fontFamily:oa,fontSize:9,color:Wv,letterSpacing:"0.05em",textTransform:"uppercase",display:"flex",alignItems:"center",gap:4},children:[e&&a.jsx("span",{style:{fontSize:10},children:e}),t]}),a.jsx("span",{style:{fontFamily:oa,fontSize:9,color:`${Ea}99`},children:u??o.toFixed(2)})]}),a.jsx("input",{type:"range",min:s,max:l,step:i,value:o,onChange:d=>c(parseFloat(d.target.value)),style:{width:"100%",height:2,accentColor:Ea,cursor:"pointer"}})]})}function Wu({label:e,value:t,unit:r,color:o}){return a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:3.5},children:[a.jsx("span",{style:{fontFamily:oa,fontSize:9,color:Li},children:e}),a.jsxs("span",{style:{fontFamily:oa,fontSize:9.5,color:o??Wv},children:[typeof t=="number"?t.toFixed(1):t,r&&a.jsx("span",{style:{color:Li,fontSize:8,marginLeft:2},children:r})]})]})}function zJ({lensState:e,fps:t,agentCount:r,vitalRates:o,moduleTelemetry:s,onConfigChange:l,onResetMemory:i,microConfig:u,onMicroChange:c,fieldConfig:d,onFieldChange:h,life:f,onLifeChange:g,targetParticleCount:m,onTargetParticleCountChange:y}){const[v,b]=w.useState(!1),[S,C]=w.useState(!0),[k,R]=w.useState(!1),[j,T]=w.useState(!1),[_,P]=w.useState(!0),[I,$]=w.useState(!0),[q,L]=w.useState(!0),[H,G]=w.useState(!1),{feedback:oe,metrics:le,forces:pe,systemPhase:ce,modulation:te,systemHealth:F,emergenceIndex:Q}=e,ae=oe.config,we=PJ[ce],Re=FJ[ce],ge=NJ[ce],Ae=EJ(s,3),tt=t>=50?"#60ff90":t>=30?"#ffc840":"#ff6050",We=o.birthsPerSec-o.deathsPerSec;return a.jsxs("div",{"data-ui-overlay":"true",style:{position:"absolute",bottom:72,left:8,zIndex:30,width:240,maxHeight:"calc(100vh - 160px)",background:"rgba(6,8,12,0.96)",border:`1px dashed ${ae.enabled?`${Ea}22`:"rgba(255,255,255,0.06)"}`,transition:"border-color 0.3s",display:"flex",flexDirection:"column"},children:[a.jsxs("div",{onClick:()=>b(J=>!J),style:{display:"flex",alignItems:"center",gap:6,padding:"7px 10px",cursor:"pointer",flexShrink:0,background:ae.enabled?`${Ea}04`:"transparent",borderBottom:v?"1px dashed rgba(255,255,255,0.05)":"none"},children:[a.jsx("span",{style:{fontSize:10,color:ae.enabled?Ea:Li},children:""}),a.jsxs("div",{style:{flex:1},children:[a.jsx("div",{style:{fontFamily:U5,fontSize:9,color:ae.enabled?`${Ea}cc`:"rgba(255,255,255,0.35)",letterSpacing:"0.08em",textTransform:"uppercase"},children:"Sistema Complexo"}),a.jsx("div",{style:{fontFamily:oa,fontSize:8,color:"rgba(255,255,255,0.16)",letterSpacing:"0.04em"},children:"Retroao  Emergncia  Autopoiese"})]}),ae.enabled&&a.jsxs("div",{title:ge,style:{fontFamily:oa,fontSize:8.5,padding:"1px 5px",background:`${we}0c`,color:we,border:`1px dashed ${we}30`,letterSpacing:"0.04em"},children:[Re," ",ce]}),v?a.jsx(Pa,{size:10,style:{color:Li}}):a.jsx(aa,{size:10,style:{color:Li}})]}),v&&a.jsxs("div",{style:{overflowY:"auto",flex:1},children:[a.jsxs("div",{style:{padding:"8px 10px",borderBottom:"1px dashed rgba(255,255,255,0.04)"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5},children:[a.jsx("button",{onClick:()=>l({enabled:!ae.enabled}),style:{fontFamily:oa,fontSize:9,padding:"3px 8px",cursor:"pointer",background:ae.enabled?`${Ea}0c`:"transparent",border:`1px dashed ${ae.enabled?`${Ea}40`:"rgba(255,255,255,0.08)"}`,color:ae.enabled?`${Ea}cc`:"rgba(255,255,255,0.30)",letterSpacing:"0.06em",textTransform:"uppercase"},children:ae.enabled?" ATIVO":" INATIVO"}),ae.enabled&&a.jsx("button",{onClick:i,title:"Limpa memria e reinicia fase",style:{fontFamily:oa,fontSize:9,padding:"3px 6px",cursor:"pointer",background:"transparent",border:"1px dashed rgba(255,255,255,0.06)",color:Li,letterSpacing:"0.05em"},children:""}),a.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:4},children:[a.jsxs("div",{title:"Sade sistmica",style:{fontFamily:oa,fontSize:8.5,padding:"2px 4px",background:`rgba(${F>.6?"80,255,130":F>.35?"255,200,80":"255,80,80"},0.06)`,border:`1px dashed rgba(${F>.6?"80,255,130":F>.35?"255,200,80":"255,80,80"},0.25)`,color:F>.6?"#60ff90":F>.35?"#ffc840":"#ff6050"},children:[" ",Math.round(F*100),"%"]}),a.jsxs("div",{title:"ndice de emergncia",style:{fontFamily:oa,fontSize:8.5,padding:"2px 4px",background:`${Ea}06`,border:`1px dashed ${Ea}20`,color:`${Ea}bb`},children:[" ",Math.round(Q*100),"%"]})]})]}),ae.enabled&&a.jsx("div",{style:{marginTop:7},children:a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5},children:[a.jsx("span",{style:{fontFamily:oa,fontSize:8,color:Li,textTransform:"uppercase",letterSpacing:"0.08em"},children:"Fase"}),a.jsx("div",{style:{flex:1,height:2,background:"rgba(255,255,255,0.04)"},children:a.jsx("div",{style:{height:"100%",width:`${oe.phase%1*100}%`,background:`linear-gradient(90deg,${we}55,${we}aa)`,transition:"width 0.3s"}})}),a.jsxs("span",{style:{fontFamily:oa,fontSize:8.5,color:we,padding:"1px 4px",background:`${we}0c`,border:`1px dashed ${we}22`},children:[Re," ",ce]})]})})]}),a.jsxs("div",{style:{padding:"8px 10px",borderBottom:"1px dashed rgba(255,255,255,0.04)"},children:[a.jsx($u,{label:"Telemetria",open:S,onToggle:()=>C(J=>!J)}),S&&a.jsxs("div",{children:[a.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"2px 8px",marginBottom:6},children:[a.jsx(Wu,{label:"FPS",value:Math.round(t),color:tt}),a.jsx(Wu,{label:"Agentes",value:r}),a.jsx(Wu,{label:"Nascimentos",value:o.birthsPerSec.toFixed(1),unit:"/s",color:"#60ff90"}),a.jsx(Wu,{label:"Mortes",value:o.deathsPerSec.toFixed(1),unit:"/s",color:"#ff7060"}),a.jsx(Wu,{label:"Mutaes",value:o.mutationsPerSec.toFixed(1),unit:"/s",color:"#c080ff"}),a.jsx(Wu,{label:"Balano",value:We>=0?`+${We.toFixed(1)}`:We.toFixed(1),unit:"/s",color:We>=0?"#60ff90":"#ff7060"})]}),a.jsxs("div",{children:[a.jsx("div",{style:{fontFamily:U5,fontSize:8,color:"rgba(255,255,255,0.14)",marginBottom:3,letterSpacing:"0.09em",textTransform:"uppercase"},children:"Mdulos (ms/frame)"}),Ae.map(({id:J,ms:ke})=>a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2.5},children:[a.jsx("span",{style:{fontFamily:oa,fontSize:9,color:Li},children:J}),a.jsxs("span",{style:{fontFamily:oa,fontSize:9,color:ke>5?"#ff7060":ke>2?"#ffc840":`${Ea}99`},children:[ke.toFixed(2)," ms"]})]},J))]})]})]}),a.jsxs("div",{style:{padding:"8px 10px",borderBottom:"1px dashed rgba(255,255,255,0.04)"},children:[a.jsx($u,{label:"Estado Emergente",open:k,onToggle:()=>R(J=>!J)}),k&&a.jsxs("div",{children:[a.jsx(qu,{label:"Variedade",value:le.variedade,color:"#c080ff",hint:"Diversidade de tipos no espao. Alta variedade = alto potencial de resilincia (Lei de Ashby)."}),a.jsx(qu,{label:"Coeso",value:le.coesao,color:"#60d0ff",hint:"Aglomerao espacial. Nicho emergindo  padro de auto-organizao local."}),a.jsx(qu,{label:"Atrito",value:le.atrito,color:"#ff6050",hint:"Presso competitiva. Fora de seleo ativa: loop de balano."}),a.jsx(qu,{label:"Resilincia",value:le.resiliencia,color:"#50ff90",hint:"Frao de espcies ativas. Diversidade = capacidade de absorver perturbao."}),a.jsx(qu,{label:"Persistncia",value:le.persistencia,color:"#ffd060",hint:"Homeostase. Alta persistncia = sistema estagnado (derive para baixa performance)."}),a.jsx(qu,{label:"Metabolismo",value:le.metabolismo,color:"#80c0ff",hint:"Fluxo de energia cintica. Stocks e flows  vitalidade do sistema."}),a.jsx("div",{style:{height:1,background:"rgba(255,255,255,0.05)",margin:"6px 0"}}),a.jsxs("div",{style:{marginBottom:0},children:[a.jsx("div",{style:{fontFamily:U5,fontSize:8,color:Li,marginBottom:5,letterSpacing:"0.09em",textTransform:"uppercase"},children:"Foras Ativas"}),a.jsx(Ff,{label:"Perturbao",value:pe.perturbacao,color:"#e0c860",hint:"Desordem criativa. Injeta imprevisibilidade  motor de emergncia."}),a.jsx(Ff,{label:"Auto-Org",value:pe.autoOrganizacao,color:"#6090e0",hint:"Consolida estruturas espontneas. Padro sem controle externo."}),a.jsx(Ff,{label:"Amplificao",value:pe.amplificacao,color:"#50e080",hint:"Loop de reforo R. Crescimento se auto-alimenta."}),a.jsx(Ff,{label:"Regulao",value:pe.regulacao,color:"#e05050",hint:"Loop de balano B. Freia runaway."}),a.jsx(Ff,{label:"Coerncia",value:pe.coerencia,color:"#d4a060",hint:"Sade global. O todo  mais do que a soma das partes."})]}),ae.enabled&&a.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:3,marginTop:5},children:[{k:"force",v:te.force},{k:"drag",v:te.drag},{k:"entrop",v:te.entropy},{k:"beta",v:te.beta},{k:"rmax",v:te.rmax},{k:"mut",v:te.mutationRate}].map(({k:J,v:ke})=>{const Le=Math.abs(ke)<.01?"rgba(255,255,255,0.14)":ke>=0?"#70e080":"#e07070";return a.jsxs("div",{style:{fontFamily:oa,fontSize:8,padding:"1px 3px",background:`${Le}0c`,border:`1px dashed ${Le}22`,color:Le},children:[J," ",ke>=0&&Math.abs(ke)>.001?"+":"",(ke*100).toFixed(1),"%"]},J)})})]})]}),a.jsxs("div",{style:{padding:"8px 10px",borderBottom:"1px dashed rgba(255,255,255,0.04)"},children:[a.jsx($u,{label:"Interao",open:_,onToggle:()=>P(J=>!J),accent:`${Ea}88`}),_&&a.jsxs("div",{children:[a.jsx(fa,{icon:"",label:"Acoplamento",hint:"Raio de interao entre agentes. Alto acoplamento = mais interconexes. (rmax)",value:u.rmax,min:.04,max:.5,step:.01,onChange:J=>c({rmax:J})}),a.jsx(fa,{icon:"",label:"Fora de Atrao",hint:"Magnitude das foras de atrao/repulso. Amplitude dos loops de interao. (force)",value:u.force,min:.05,max:1,step:.01,onChange:J=>c({force:J})}),a.jsx(fa,{icon:"",label:"Limiar Auto-Org",hint:"Raio central de repulso (beta). Controla quando agentes se organizam em estruturas vs. se dispersam.",value:u.beta,min:.05,max:.95,step:.01,onChange:J=>c({beta:J})}),a.jsx(fa,{icon:"",label:"Entropia",hint:"Rudo injetado por frame. Alta entropia = perturbao criativa. Baixa = sistema determinstico.",value:u.entropy,min:0,max:.05,step:.001,display:u.entropy.toFixed(3),onChange:J=>c({entropy:J})}),a.jsx(fa,{icon:"",label:"Dialgica",hint:"Intensidade da dependncia circular entre tipos. Cria tenso ordem/desordem  opostos que coexistem.",value:u.circularDependency,min:0,max:1,step:.01,onChange:J=>c({circularDependency:J})})]})]}),a.jsxs("div",{style:{padding:"8px 10px",borderBottom:"1px dashed rgba(255,255,255,0.04)"},children:[a.jsx($u,{label:"Metabolismo",open:I,onToggle:()=>$(J=>!J),accent:`${Ea}88`}),I&&a.jsxs("div",{children:[a.jsx(fa,{icon:"",label:"Taxa de Absoro",hint:"Velocidade de ganho de energia ao interagir com outros. Stocks e flows: taxa de entrada no estoque de energia.",value:f.energyFeedRate,min:.005,max:.15,step:.005,display:f.energyFeedRate.toFixed(3),onChange:J=>g({energyFeedRate:J})}),a.jsx(fa,{icon:"",label:"Custo Metablico",hint:"Decaimento de energia por frame. Presso de seleo: agentes de baixo custo sobrevivem mais. (energyDecay)",value:f.energyDecay,min:5e-4,max:.01,step:5e-4,display:f.energyDecay.toFixed(4),onChange:J=>g({energyDecay:J})}),a.jsx(fa,{icon:"",label:"Limiar de Reproduo",hint:"Energia necessria para se reproduzir. Alto limiar = seleo mais rgida. (reproductionThreshold)",value:f.energyReproThreshold,min:.5,max:5,step:.1,onChange:J=>g({energyReproThreshold:J})}),a.jsx(fa,{icon:"",label:"Capacidade de Suporte",hint:"Nmero mximo de agentes. Define o teto do estoque populacional. (targetParticleCount)",value:m,min:100,max:3e3,step:50,display:`${m}`,onChange:J=>y(Math.round(J))}),a.jsx(fa,{icon:"",label:"Mutao",hint:"Dial de mutao [0..1]. Alto = tipos evoluem rapidamente, baixa estabilidade. (mutationDial)",value:f.mutationDial,min:0,max:1,step:.01,onChange:J=>g({mutationDial:J})})]})]}),a.jsxs("div",{style:{padding:"8px 10px",borderBottom:"1px dashed rgba(255,255,255,0.04)"},children:[a.jsx($u,{label:"Retroalimentao",open:q,onToggle:()=>L(J=>!J),accent:`${Ea}88`}),q&&a.jsxs("div",{children:[a.jsx(fa,{icon:"",label:"Fora dos Loops",hint:"Intensidade dos loops de feedback. 0 = sistema aberto. 1 = retroao mxima nos parmetros. (strength)",value:ae.strength,min:0,max:1,step:.01,onChange:J=>l({strength:J})}),a.jsx(fa,{icon:"",label:"Atraso Sistmico",hint:"Delay entre causa e efeito do loop de feedback. Atrasos longos  instabilidade e oscilaes. (intervalFrames)",value:ae.intervalFrames,min:1,max:60,step:1,display:`${ae.intervalFrames} fr`,onChange:J=>l({intervalFrames:Math.round(J)})}),a.jsx(fa,{icon:"",label:"Memria do Sistema",hint:"Inrcia do loop de feedback. Alta memria = sistema 'lembra' perturbaes. Correlato de histria acumulada. (smoothing)",value:ae.smoothing,min:0,max:.99,step:.01,onChange:J=>l({smoothing:J})}),a.jsx(fa,{icon:"",label:"Regulao Mxima",hint:"Teto da autorregulao. Limita quanto os loops de balano podem comprimir os parmetros. (chaosClamp)",value:ae.chaosClamp,min:0,max:1,step:.01,onChange:J=>l({chaosClamp:J})})]})]}),a.jsxs("div",{style:{padding:"8px 10px"},children:[a.jsx($u,{label:"Campo / Ambiente",open:H,onToggle:()=>G(J=>!J),accent:`${Ea}88`}),H&&a.jsxs("div",{children:[a.jsx(fa,{icon:"",label:"Recursividade",hint:"Fora com que o campo alimenta de volta os agentes. Efeito se torna causa: agentes modificam o campo que os modifica. (influenceStrength)",value:d.influenceStrength,min:0,max:2,step:.05,onChange:J=>h({influenceStrength:J})}),a.jsx(fa,{icon:"",label:"Hologramtico",hint:"Intensidade do depsito local no campo global. Cada parte escreve o todo. O trace local emerge como padro global. (depositStrength)",value:d.depositStrength,min:0,max:3,step:.05,onChange:J=>h({depositStrength:J})}),a.jsx(fa,{icon:"",label:"Difuso do Campo",hint:"Velocidade de difuso do campo espacial. Alta difuso = efeitos locais se propagam rapidamente. (diffusion)",value:d.diffusion,min:.01,max:.5,step:.01,onChange:J=>h({diffusion:J})}),a.jsx(fa,{icon:"",label:"Decaimento do Campo",hint:"Velocidade de decaimento das memrias de campo. Baixo decay = campo tem memria longa. (decay)",value:d.decay,min:.001,max:.1,step:.001,display:d.decay.toFixed(3),onChange:J=>h({decay:J})})]})]})]})]})}const BJ=32,$J=32;function qJ(){return{enabled:!1,resourceMode:"FIELD_DERIVED",resourceRegen:.06,resourceHarvest:.08,metabolism:.015,claimGain:.12,claimDecay:.02,claimDiffusion:.08,giniAlert:.45}}function WJ(){const e=BJ,t=$J,r=e*t;return{R:new Float32Array(r).fill(.25),R_static:new Float32Array(r).fill(.25),claimOwner:new Int16Array(r).fill(-1),claimStrength:new Float32Array(r),tmp:new Float32Array(r),gridW:e,gridH:t}}function HJ(){return{meanEnergy:.5,gini:0,scarcityRatio:0,dominantGroup:-1,territoryShare:0,fatigueCount:0,famineConsecutive:0}}function oA(e,t,r,o){const s=Math.max(0,Math.min(r-1,Math.floor((e+1)*.5*r)));return Math.max(0,Math.min(o-1,Math.floor((t+1)*.5*o)))*r+s}function GJ(e,t,r,o){const s=Math.max(0,Math.min(r-1,Math.floor((e+1)*.5*r)));return Math.max(0,Math.min(o-1,Math.floor((t+1)*.5*o)))*r+s}function VJ(e,t,r){const{R:o,R_static:s,gridW:l,gridH:i}=e,u=l*i;s.fill(.08);const c=5;for(let d=0;d<c;d++){const h=r.next()*(l-2)+1,f=r.next()*(i-2)+1,g=2.5+r.next()*4.5,m=.55+r.next()*.45;for(let y=0;y<i;y++)for(let v=0;v<l;v++){const b=v-h,S=y-f,C=b*b+S*S,k=m*Math.exp(-C/(2*g*g)),R=y*l+v;s[R]=Math.min(1,s[R]+k)}}for(let d=0;d<u;d++)o[d]=s[d];e.claimOwner.fill(-1),e.claimStrength.fill(0)}function UJ(e,t,r,o){const{R:s,R_static:l,gridW:i,gridH:u}=e;if(t.resourceMode==="FIELD_DERIVED"&&r){const c=r.width,d=r.height;for(let h=0;h<u;h++)for(let f=0;f<i;f++){const g=Math.floor(f/i*c),y=Math.floor(h/u*d)*c+g,v=r.cohesion[y]||0,b=r.scarcity[y]||0,S=r.tension[y]||0,C=h*i+f,k=Math.max(0,Math.min(1,l[C]*.5+.2+v*.35-b*.28-S*.12));s[C]+=(k-s[C])*o*.4+t.resourceRegen*o*(1-s[C]),s[C]<0&&(s[C]=0),s[C]>1&&(s[C]=1)}}else{const c=i*u,d=t.resourceRegen*o;for(let h=0;h<c;h++)s[h]+=d*(l[h]-s[h])*2,s[h]<0&&(s[h]=0),s[h]>1&&(s[h]=1)}}const YJ=.22,SC=.92;function KJ(e,t,r,o,s){const{R:l,gridW:i,gridH:u}=e;for(let c=0;c<r.count;c++){r.energy[c]===0&&(r.energy[c]=1),r.energy[c]-=t.metabolism*s;const d=oA(r.x[c],r.y[c],i,u),h=l[d];if(h>YJ){let f=1;if(o){const m=GJ(r.x[c],r.y[c],o.width,o.height),y=o.cohesion.length-1,v=m>y?y:m;f+=o.cohesion[v]*.2-o.tension[v]*.2}const g=t.resourceHarvest*h*f*s;r.energy[c]+=g,l[d]-=g*.55,l[d]<0&&(l[d]=0)}r.energy[c]<.1&&(r.vx[c]*=SC,r.vy[c]*=SC),r.energy[c]<0&&(r.energy[c]=0),r.energy[c]>1&&(r.energy[c]=1)}}const XJ=.01,ZJ=.004;function JJ(e,t,r,o,s){const l=r.lastTickTime;for(const i of r.rituals){const u=r.totems.find(f=>f.id===i.totemId);if(!u||!((l-i.bornAt)%i.periodSec/i.periodSec<i.dutyCycle))continue;const h=u.radius*u.radius;for(let f=0;f<o.count;f++){const g=o.x[f]-u.pos.x,m=o.y[f]-u.pos.y;g*g+m*m<h&&(o.energy[f]-=XJ*s*i.intensity,o.energy[f]<0&&(o.energy[f]=0))}}for(const i of r.totems){if(i.kind==="ARCHIVE")continue;const u=i.radius*i.radius;for(let c=0;c<o.count;c++){const d=o.x[c]-i.pos.x,h=o.y[c]-i.pos.y;d*d+h*h<u&&(o.energy[c]-=ZJ*s*i.strength,o.energy[c]<0&&(o.energy[c]=0))}}}function QJ(e,t,r,o,s){const{claimOwner:l,claimStrength:i,tmp:u,gridW:c,gridH:d}=e,h=c*d,f=Math.max(0,1-t.claimDecay*s);for(let m=0;m<h;m++)i[m]*=f;for(let m=0;m<r.count;m++){const y=oA(r.x[m],r.y[m],c,d),v=o?o.memeId[m]:r.type[m];l[y]<0||l[y]===v?(l[y]=v,i[y]=Math.min(1,i[y]+t.claimGain*s)):(i[y]=Math.max(0,i[y]-t.claimGain*s*.6),i[y]<.08&&(l[y]=v,i[y]=.08))}u.fill(0);const g=t.claimDiffusion*s*.06;for(let m=0;m<d;m++)for(let y=0;y<c;y++){const v=m*c+y;if(i[v]<.06)continue;const b=l[v],S=i[v]*g,C=m>0?(m-1)*c+y:-1,k=m<d-1?(m+1)*c+y:-1,R=y>0?m*c+(y-1):-1,j=y<c-1?m*c+(y+1):-1;for(const T of[C,k,R,j])T<0||l[T]>=0||(l[T]=b,u[T]+=S)}for(let m=0;m<h;m++)i[m]=Math.min(1,i[m]+u[m]),i[m]<.015&&(l[m]=-1,i[m]=0)}function eQ(e,t,r,o){const{R:s,claimOwner:l,gridW:i,gridH:u}=e,c=i*u,d=r.count,h=[];if(d===0)return{metrics:{...o},events:h};const f=Math.max(1,Math.floor(d/200)),g=[];let m=0;for(let I=0;I<d;I+=f){const $=r.energy[I];g.push($),$<.1&&m++}const y=g.length,v=y>0?g.reduce((I,$)=>I+$,0)/y:.5;g.sort((I,$)=>I-$);let b=0;if(y>1){let I=0;const $=g.reduce((q,L)=>q+L,0);for(let q=0;q<y;q++)I+=(2*(q+1)-y-1)*g[q];b=$>0?Math.max(0,Math.min(1,I/(y*$))):0}let S=0;for(let I=0;I<c;I++)s[I]<.25&&S++;const C=S/c,k=new Map;let R=0;for(let I=0;I<c;I++){const $=l[I];$>=0&&(k.set($,(k.get($)||0)+1),R++)}let j=-1,T=0;k.forEach((I,$)=>{I>T&&(T=I,j=$)});const _=R>0?T/R:0,P=v<.2?o.famineConsecutive+1:0;return P===3&&h.push({icon:"",message:`FAMINE  energy critically low (${(v*100).toFixed(0)}%)`,color:"#ef4444"}),b>o.gini+.05&&b>.4&&h.push({icon:"",message:`INEQUALITY SPIKE  Gini ${b.toFixed(2)}`,color:"#fbbf24"}),j!==o.dominantGroup&&j>=0&&h.push({icon:"",message:`TERRITORY SHIFT  group ${j} now dominant`,color:"#a78bfa"}),{metrics:{meanEnergy:v,gini:b,scarcityRatio:C,dominantGroup:j,territoryShare:_,fatigueCount:m,famineConsecutive:P},events:h}}const tQ=.2,A5=.15,wC=12;function nQ(e,t,r=!1,o){const s=e.count;if(s===0)return{cohesion:0,segregation:0,borderStrength:0,volatility:0,ritualSync:0,phase:"DISPERSED"};const l=Math.max(10,Math.floor(s*tQ)),i=Math.floor(s/l);let u=0;for(let T=0;T<s;T+=i){let _=0;const P=e.x[T],I=e.y[T],$=A5*A5;for(let q=0;q<s;q++){if(T===q)continue;const L=e.x[q]-P,H=e.y[q]-I;L*L+H*H<$&&_++}u+=_}const c=u/l,d=Math.min(1,c/8);let h=0,f=0;for(let T=0;T<s;T+=i){const _=e.x[T],P=e.y[T],I=e.type[T],$=A5*A5;for(let q=0;q<s;q++){if(T===q)continue;const L=e.x[q]-_,H=e.y[q]-P;L*L+H*H<$&&(f++,e.type[q]===I&&h++)}}const g=f>0?h/f:0,m=new Map;for(let T=0;T<s;T++){const _=Math.floor((e.x[T]+1)*wC/2),P=Math.floor((e.y[T]+1)*wC/2),I=`${_},${P}`;m.has(I)||m.set(I,{count:0,types:new Map});const $=m.get(I);$.count++;const q=e.type[T];$.types.set(q,($.types.get(q)||0)+1)}let y=0,v=0;for(const[T,_]of m.entries()){const[P,I]=T.split(","),$=parseInt(P),q=parseInt(I);let L=0;for(const[H,G]of[[-1,0],[1,0],[0,-1],[0,1]]){const oe=`${$+H},${q+G}`,le=m.get(oe);if(le){const pe=_.types.size,ce=le.types.size;L+=Math.abs(pe-ce)}}y+=L,v++}const b=v>0?Math.min(1,y/(v*4)):0;let S=0;for(let T=0;T<s;T++){const _=Math.sqrt(e.vx[T]*e.vx[T]+e.vy[T]*e.vy[T]);S+=_}const C=S/s,k=Math.min(1,C*20);let R=0;if(r&&o){let T=0,_=0;const P=.25*.25;for(let I=0;I<s;I++){const $=e.x[I]-o.x,q=e.y[I]-o.y,L=$*$+q*q;if(L<P&&L>.001){const H=Math.sqrt(L),G=-q/H,oe=$/H,le=e.vx[I]*G+e.vy[I]*oe;T+=Math.abs(le),_++}}_>0&&(R=Math.min(1,T/_*15))}const j=rQ(d,g,b,k,R);return{cohesion:d,segregation:g,borderStrength:b,volatility:k,ritualSync:R,phase:j}}function rQ(e,t,r,o,s){return s>.6?"RITUALIZED":o>.7&&e<.3?"COLLAPSE":t>.7&&r>.5?"SEGREGATED":e>.6&&t<.5?"CLUSTER":o>.5&&e>.4?"SWARM":"DISPERSED"}let ws=null;const pl={borderFormed:.6,borderDissolved:.3,ritualPeak:.65,cohesionSpike:.7,volatilitySpike:.75};function oQ(e){ws={lastPhase:e.phase,lastObs:e,phaseStability:0,history:[{time:0,obs:e}]}}function aQ(e,t){if(!ws)return oQ(e),[];const r=[],o=ws.lastObs;if(e.phase!==ws.lastPhase?ws.phaseStability=0:ws.phaseStability++,ws.phaseStability===2&&e.phase!==o.phase&&r.push({time:t,kind:"PHASE_SHIFT",title:`Phase Shift: ${o.phase}  ${e.phase}`,detail:`System transitioned to ${e.phase}`,icon:"",tags:["phase","transition"],evidence:{phase:e.phase,cohesion:e.cohesion,volatility:e.volatility}}),o.borderStrength<pl.borderFormed&&e.borderStrength>=pl.borderFormed&&r.push({time:t,kind:"BORDER_FORMED",title:"Borders Crystallizing",detail:`Border strength: ${(e.borderStrength*100).toFixed(0)}%`,icon:"",tags:["border","structure"],evidence:{borderStrength:e.borderStrength,segregation:e.segregation}}),o.borderStrength>=pl.borderDissolved&&e.borderStrength<pl.borderDissolved&&r.push({time:t,kind:"BORDER_DISSOLVED",title:"Borders Dissolving",detail:"Types mixing - boundaries eroding",icon:"",tags:["border","mixing"],evidence:{borderStrength:e.borderStrength}}),e.ritualSync>0&&o.ritualSync<pl.ritualPeak&&e.ritualSync>=pl.ritualPeak&&r.push({time:t,kind:"RITUAL_SYNC_PEAK",title:"Ritual Synchronization",detail:`Sync: ${(e.ritualSync*100).toFixed(0)}% - coordinated motion`,icon:"",tags:["ritual","sync"],evidence:{ritualSync:e.ritualSync,volatility:e.volatility}}),o.cohesion<pl.cohesionSpike&&e.cohesion>=pl.cohesionSpike&&r.push({time:t,kind:"COHESION_SPIKE",title:"High Cohesion Achieved",detail:"Tight clustering formed",icon:"",tags:["cohesion","cluster"],evidence:{cohesion:e.cohesion}}),o.volatility<pl.volatilitySpike&&e.volatility>=pl.volatilitySpike&&r.push({time:t,kind:"VOLATILITY_SPIKE",title:"Turbulence Spike",detail:"System entering chaotic regime",icon:"",tags:["volatility","chaos"],evidence:{volatility:e.volatility}}),ws.history.length>=3){const s=ws.history.slice(-3);s.every((i,u)=>u===0||i.obs.cohesion>s[u-1].obs.cohesion)&&o.cohesion<.4&&e.cohesion>=.4&&r.push({time:t,kind:"RECOVERY",title:"System Recovery",detail:"Cohesion rebuilding after collapse",icon:"",tags:["recovery","cohesion"],evidence:{cohesion:e.cohesion}})}return ws.lastPhase=e.phase,ws.lastObs=e,ws.history.push({time:t,obs:e}),ws.history.length>10&&ws.history.shift(),r}const CC="t4p_admin_mode_v1",sQ="morin2026";function iQ({onUnlock:e}){const[t,r]=Yt.useState(""),[o,s]=Yt.useState(!1),l=i=>{i.preventDefault(),t.trim().toLowerCase()==="meadow2026"?e():(s(!0),setTimeout(()=>s(!1),1500))};return a.jsx("div",{style:{position:"fixed",inset:0,zIndex:50,background:"radial-gradient(ellipse at 50% 40%, #0c0a18 0%, #040308 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",fontFamily:"system-ui, sans-serif"},children:a.jsxs("div",{style:{textAlign:"center",maxWidth:340,padding:"0 20px"},children:[a.jsx("div",{style:{fontSize:36,marginBottom:16,color:"rgba(124,111,205,0.6)",filter:"drop-shadow(0 0 12px rgba(124,111,205,0.3))"},children:""}),a.jsx("div",{style:{fontSize:13,letterSpacing:"0.18em",textTransform:"uppercase",color:"rgba(255,255,255,0.6)",marginBottom:6},children:"Asimov Theater"}),a.jsx("div",{style:{fontSize:10,color:"rgba(255,255,255,0.3)",marginBottom:24},children:"Acesso restrito. Insira a senha para continuar."}),a.jsxs("form",{onSubmit:l,style:{display:"flex",gap:8},children:[a.jsx("input",{type:"password",value:t,onChange:i=>r(i.target.value),placeholder:"Senha...",autoFocus:!0,style:{flex:1,padding:"8px 12px",borderRadius:6,background:"rgba(255,255,255,0.05)",border:o?"1px solid rgba(255,80,80,0.5)":"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.8)",fontSize:12,outline:"none",fontFamily:"monospace",transition:"border-color 0.2s"}}),a.jsx("button",{type:"submit",style:{padding:"8px 16px",borderRadius:6,cursor:"pointer",background:"rgba(124,111,205,0.15)",border:"1px solid rgba(124,111,205,0.3)",color:"rgba(124,111,205,0.9)",fontSize:11,letterSpacing:"0.08em",textTransform:"uppercase"},children:"Entrar"})]}),o&&a.jsx("div",{style:{marginTop:12,fontSize:10,color:"rgba(255,80,80,0.7)"},children:"Senha incorreta."})]})})}function lQ({onUnlock:e,onClose:t}){const[r,o]=Yt.useState(""),[s,l]=Yt.useState(!1),i=u=>{u.preventDefault(),r.trim().toLowerCase()===sQ?e():(l(!0),setTimeout(()=>l(!1),1200))};return a.jsx("div",{style:{position:"fixed",inset:0,zIndex:60,background:"rgba(0,0,0,0.82)",backdropFilter:"blur(8px)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",fontFamily:"system-ui, sans-serif"},children:a.jsxs("div",{style:{width:"min(420px, 92vw)",background:"rgba(8,6,14,0.98)",border:"1px dashed rgba(245,158,11,0.35)",borderRadius:14,padding:"18px 18px",boxShadow:"0 24px 90px rgba(0,0,0,0.7)"},children:[a.jsx("div",{style:{fontSize:11,letterSpacing:"0.18em",textTransform:"uppercase",color:"rgba(245,158,11,0.9)",marginBottom:8,fontFamily:"monospace"},children:"Admin Mode"}),a.jsx("div",{style:{fontSize:10,color:"rgba(255,255,255,0.45)",lineHeight:1.6,marginBottom:14},children:"Libera acesso a tools trancadas/em breve. (Gate de UI  no  segurana real.)"}),a.jsxs("form",{onSubmit:i,style:{display:"flex",gap:8},children:[a.jsx("input",{type:"password",value:r,onChange:u=>o(u.target.value),placeholder:"Senha...",autoFocus:!0,style:{flex:1,padding:"9px 12px",borderRadius:10,background:"rgba(255,255,255,0.04)",border:s?"1px solid rgba(255,80,80,0.55)":"1px solid rgba(255,255,255,0.12)",color:"rgba(255,255,255,0.82)",fontSize:12,outline:"none",fontFamily:"monospace",transition:"border-color 0.2s"}}),a.jsx("button",{type:"submit",style:{padding:"9px 14px",borderRadius:10,cursor:"pointer",background:"rgba(245,158,11,0.15)",border:"1px dashed rgba(245,158,11,0.35)",color:"rgba(245,158,11,0.92)",fontSize:11,letterSpacing:"0.10em",textTransform:"uppercase",fontFamily:"monospace"},children:"Entrar"})]}),a.jsx("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:12},children:a.jsx("button",{onClick:t,style:{padding:"7px 10px",borderRadius:10,cursor:"pointer",background:"rgba(255,255,255,0.04)",border:"1px dashed rgba(255,255,255,0.12)",color:"rgba(255,255,255,0.55)",fontSize:10,letterSpacing:"0.10em",textTransform:"uppercase",fontFamily:"monospace"},children:"Cancelar"})})]})})}const cQ=()=>{const e=w.useRef(null),t=w.useRef(null),r=w.useRef(null),o=w.useRef(null),[s,l]=w.useState({width:window.innerWidth,height:window.innerHeight}),i=w.useRef(GT()),u=w.useRef(new cd(Date.now())),c=w.useRef(QT(1e3)),d=w.useRef(eI()),h=w.useRef(Mi(4)),f=w.useRef(Mi(4)),g=w.useRef(hf(48,27)),m=w.useRef(bI()),y=w.useRef(g2(64)),v=w.useRef({field:dI(Q4()),cfg:Q4()}),[b,S]=w.useState(!1),[C,k]=w.useState({size:64,diffusion:{nutrient:.15,tension:.12,memory:.1,entropy:.15,sigilBond:.04,sigilRift:.05,sigilBloom:.03,sigilOath:.06},decay:{nutrient:.08,tension:.12,memory:.03,entropy:.1,sigilBond:.9,sigilRift:1.2,sigilBloom:.7,sigilOath:.8},injection:{nutrientFromFood:.35,nutrientFromAgents:0,tensionFromCrowding:.5,memoryFromMotion:.25,entropyFromInstability:.3},clamps:{nutrient:{min:0,max:1},tension:{min:0,max:1},memory:{min:0,max:1},entropy:{min:0,max:1},sigilBond:{min:0,max:1},sigilRift:{min:0,max:1},sigilBloom:{min:0,max:1},sigilOath:{min:0,max:1}},delays:{nutrient:.2,tension:.3,memory:.5,entropy:.25,sigilBond:.15,sigilRift:.12,sigilBloom:.18,sigilOath:.2}}),R=w.useRef(wI()),j=w.useRef(CI()),T=w.useRef(EI()),_=w.useRef(TI()),P=w.useRef(PP()),I=w.useRef(Lb()),[$,q]=w.useState(()=>({...Lb()})),L=w.useRef(vC()),H=w.useRef(tA()),[G,oe]=w.useState(()=>vC()),le=w.useRef(ZD()),[pe]=w.useState({baseRate:.002,entropyGain:.01,step:.08}),ce=w.useRef(0),te=w.useRef(0),F=w.useRef({births:0,deaths:0}),Q=w.useRef(iL()),ae=w.useRef(dL(32,32)),[we,Re]=w.useState(uL()),ge=w.useRef(we);w.useEffect(()=>{ge.current=we},[we]);const Ae=w.useRef([]),[tt,We]=w.useState([]),J=w.useRef([]),ke=w.useRef(0),[Le,K]=w.useState(()=>D2(oL)),et=w.useRef(Le);w.useEffect(()=>{et.current=Le},[Le]);const dt=w.useRef(sL()),[Rt,Wt]=w.useState(dt.current),Zt=w.useRef(yI()),$e=sP(),[Ze,Fe]=w.useState({totalBeats:0,totalSpeciations:0,totalInstitutions:0,totalMutations:0,totalMitosis:0,totalMetamorphosis:0,peakParticleCount:0,peakDiversity:0,peakTension:0,peakCohesion:0,simulationStartTime:Date.now()}),Xe=w.useRef({stableClusters:0,borderStrength:0,oscillation:0,scarcityCrisis:!1,noveltyBurst:!1,avgTension:0,avgCohesion:0,avgScarcity:0,avgNovelty:0,avgMythic:0}),jt=w.useRef(null),hn=w.useRef(null),an=w.useRef(null),[it,kt]=w.useState("2D"),[On,sn]=w.useState(Td),Xn=w.useRef(null),Pt=w.useRef(null),zt=w.useRef({mode:"2D",cfg:Td}),jn=w.useRef({active:!1,lastX:0,lastY:0,shift:!1}),En=w.useRef(null),[lt,ht]=w.useState("idle"),[_t,Ie]=w.useState(0),at=w.useRef({zoom:1,panX:0,panY:0}),St=w.useRef({active:!1,lastX:0,lastY:0}),ye=w.useRef(new Set),[xe,gt]=w.useState(1),[Ge,Ye]=w.useState(!1),[Ve,Oe]=w.useState(!1),[Gt,Kt]=w.useState(!1),[fn,zn]=w.useState(!1),[rt,mt]=w.useState("tension"),[yt,Et]=w.useState(0),[Ft,me]=w.useState(0),[cn,Xt]=w.useState(!1),[Dt,ne]=w.useState(!1),[Ne,Ke]=w.useState(!1),[Ct,ft]=w.useState("Orbit"),[At,bt]=w.useState(Date.now()),[nn,Bt]=w.useState(null),[Jt,Qt]=w.useState(3.5),[en,vn]=w.useState(.96),[Wn,Gn]=w.useState(.5),[cr,pr]=w.useState(0),[br,hr]=w.useState("dots"),[or,uo]=w.useState(8),[fr,Tr]=w.useState(2),[Ir,jo]=w.useState(null),bo=w.useRef(0),[vo,Zo]=w.useState(!1),[Jo,Ua]=w.useState(.1),[Na,sa]=w.useState(.1),[So,Oo]=w.useState(!1),[U,je]=w.useState(20),[W,X]=w.useState(.1),[Te,He]=w.useState(""),he=w.useRef(cP("poetic")),[fe,be]=w.useState("poetic"),[Ee,Me]=w.useState([]),_e=w.useRef({name:"Gnese",since:0,reason:"init"}),[Je,Vt]=w.useState(!1),[rn,pn]=w.useState("random"),[re,de]=w.useState(0),[Se,qe]=w.useState(0),[st,$t]=w.useState(0),[Tt,Ut]=w.useState(0),ln=w.useRef({simMs:0,renderMs:0,frames:0}),[wt,mn]=w.useState("pulse"),un=w.useRef(1),[$n,It]=w.useState(!1),[dn,gn]=w.useState(!1),Sn=w.useRef(XT()),[nr,Eo]=w.useState("FAST"),[ro,Bn]=w.useState(80),[ar,_o]=w.useState(25),[Ar,Nn]=w.useState(50),[Vn,ir]=w.useState(.3),[mr,Gr]=w.useState(!1),Dr=HD(),[Rr,Ho]=w.useState(!0),[yn,Vr]=w.useState("complexityLife"),pi=w.useRef(yn),[Us,Ml]=w.useState(!1),[mi,Lh]=w.useState(()=>{try{return localStorage.getItem(CC)==="1"}catch{return!1}}),[Bd,Oa]=w.useState(!1),wn=w.useRef(I6()),[zh,Ys]=w.useState(0),wo=w.useRef({cursorX:-1,cursorY:-1}),ia=w.useRef({width:0,height:0,valid:!1});w.useEffect(()=>{pi.current=yn},[yn]);const is=w.useRef(WJ()),_a=w.useRef(qJ()),oc=w.useRef(HJ()),$d=w.useRef(!1),[Bh,Zi]=w.useState(_a.current),[_p,$h]=w.useState(oc.current),Dp=w.useRef(null),l0=w.useRef(0),[Ts,qh]=w.useState("off"),[qd,Ji]=w.useState(null),[c0,ac]=w.useState([]),sc=w.useRef(!1),[gi,kl]=w.useState("BOND"),[ic,Wh]=w.useState("NO_ENTER"),[Qi,Hh]=w.useState("GATHER"),d0=w.useRef(0),lc=w.useRef(0),Da=w.useRef([]),Wd=w.useRef(0),u0=["complexityLife","metaArtLab","musicLab","rhizomeLab","alchemyLab","treeOfLife","sociogenesis","psycheLab","milPlatos"],Hd=["complexityLife","metaArtLab","musicLab","rhizomeLab","alchemyLab","treeOfLife","sociogenesis","psycheLab","milPlatos","languageLab","asimovTheater","physicsSandbox"],cc=w.useCallback(Z=>mi?!0:u0.includes(Z),[mi]),Gd=mi?Hd:u0,[el,Rl]=w.useState("radial-gradient(circle, #000000 0%, #000000 100%)"),[Gh,yi]=w.useState(!1),[Vd,h0]=w.useState(!1),f0=WP({setFieldHeatmap:zn,setTrails:Kt,fieldHeatmap:fn,trails:Gt,onSpeedChange:Z=>{i.current.speed=Z,me(Ue=>Ue+1)},isPaused:()=>Vd,onPauseToggle:()=>h0(Z=>!Z),onNewUniverse:()=>{x0(Date.now())},onApplyRecipe:Z=>{const Ue=th.find(ut=>ut.id===Z);Ue&&dc(Ue,!0)},timeSpeed:i.current.speed,canvasRef:e}),xa=BP(f0);w.useEffect(()=>{if(Dr.latestAchievement){const Z=Dr.latestAchievement;$e.push({t:i.current.elapsed,type:"achievement",title:`${Z.icon} ${Z.name}`,sigil:Z.icon,detail:Z.description,meta:Z})}},[Dr.latestAchievement]);const Is=w.useRef(300),[p0,Ks]=w.useState(300),Tn=w.useRef({down:!1,id:-1,x:0,y:0,prevX:0,prevY:0,cursorX:0,cursorY:0,shift:!1,alt:!1,mode:"PULSE"});w.useEffect(()=>(En.current=new Nh(ht),()=>{var Z;return(Z=En.current)==null?void 0:Z.dispose()}),[]),w.useEffect(()=>{if(lt!=="recording"){Ie(0);return}const Z=setInterval(()=>{var Ue;return Ie(((Ue=En.current)==null?void 0:Ue.elapsed)??0)},500);return()=>clearInterval(Z)},[lt]),w.useEffect(()=>{const Z=r.current;if(!Z)return;const Ue=()=>{const De=o.current;if(!De)return;const{zoom:ct,panX:pt,panY:on}=at.current;De.style.transform=`translate(${pt}px,${on}px) scale(${ct})`,De.style.transformOrigin="50% 50%"},ut=De=>{var oo;if(yn!=="complexityLife")return;const ct=De.target;if((oo=ct==null?void 0:ct.closest)!=null&&oo.call(ct,"[data-ui-overlay]"))return;De.preventDefault();const pt=Z.getBoundingClientRect(),on=De.clientX-pt.left-pt.width/2,kn=De.clientY-pt.top-pt.height/2,xn=at.current,Zn=De.deltaY>0?1/1.12:1.12,dr=Math.max(.12,Math.min(14,xn.zoom*Zn)),Ur=dr/xn.zoom;at.current={zoom:dr,panX:on+(xn.panX-on)*Ur,panY:kn+(xn.panY-kn)*Ur},Ue(),gt(dr),Ye(Math.abs(at.current.panX)>2||Math.abs(at.current.panY)>2)},E=De=>{yn==="complexityLife"&&(De.button!==1&&De.button!==2||(St.current={active:!0,lastX:De.clientX,lastY:De.clientY},De.button===1&&De.preventDefault()))},D=De=>{if(!St.current.active)return;const ct=De.clientX-St.current.lastX,pt=De.clientY-St.current.lastY;St.current.lastX=De.clientX,St.current.lastY=De.clientY,at.current={...at.current,panX:at.current.panX+ct,panY:at.current.panY+pt},Ue(),Ye(!0)},z=()=>{St.current.active=!1,Ye(Math.abs(at.current.panX)>2||Math.abs(at.current.panY)>2)},ee=De=>{var on;if(yn!=="complexityLife")return;const ct=(on=document.activeElement)==null?void 0:on.tagName;if(ct==="INPUT"||ct==="TEXTAREA"||ct==="SELECT")return;const pt=De.key;["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(pt)&&(ye.current.add(pt),De.preventDefault()),pt==="Home"&&(at.current={zoom:1,panX:0,panY:0},Ue(),gt(1),Ye(!1))},ue=De=>{ye.current.delete(De.key)},Ce=De=>{yn==="complexityLife"&&De.preventDefault()},ze=setInterval(()=>{if(ye.current.size===0)return;const De=6/at.current.zoom,{panX:ct,panY:pt,zoom:on}=at.current;let kn=ct,xn=pt;ye.current.has("ArrowLeft")&&(kn+=De),ye.current.has("ArrowRight")&&(kn-=De),ye.current.has("ArrowUp")&&(xn+=De),ye.current.has("ArrowDown")&&(xn-=De),at.current={zoom:on,panX:kn,panY:xn},Ue()},16);return Z.addEventListener("wheel",ut,{passive:!1}),Z.addEventListener("mousedown",E),Z.addEventListener("contextmenu",Ce),window.addEventListener("mousemove",D),window.addEventListener("mouseup",z),window.addEventListener("keydown",ee),window.addEventListener("keyup",ue),()=>{clearInterval(ze),Z.removeEventListener("wheel",ut),Z.removeEventListener("mousedown",E),Z.removeEventListener("contextmenu",Ce),window.removeEventListener("mousemove",D),window.removeEventListener("mouseup",z),window.removeEventListener("keydown",ee),window.removeEventListener("keyup",ue)}},[yn]),w.useEffect(()=>{const Z=e.current,Ue=t.current;if(!Z||!Ue)return;jt.current=_I(Z),a2(At),jt.current||(hn.current=Z.getContext("2d")),an.current=Ue.getContext("2d"),$e.push({t:0,type:"system",title:" MetaLifeLab Started",sigil:"",detail:"System initialized and ready",meta:{version:"1.0"}});const ut=()=>{if(r.current){const z=r.current.getBoundingClientRect();l({width:z.width,height:z.height})}else l({width:window.innerWidth,height:window.innerHeight});ia.current.valid=!1},E=()=>{document.hidden||(ia.current.valid=!1)};document.addEventListener("visibilitychange",E),ut();const D=z=>{var Ce,ze;if(z.defaultPrevented)return;const ee=(Ce=document.activeElement)==null?void 0:Ce.tagName,ue=(ze=document.activeElement)==null?void 0:ze.isContentEditable;if(!(ee==="INPUT"||ee==="TEXTAREA"||ee==="SELECT"||ue))if(z.key==="h"||z.key==="H"){if(pi.current==="musicLab")return;Xt(De=>!De)}else z.key==="Tab"?(z.preventDefault(),ne(De=>!De)):z.key===" "?(z.preventDefault(),i.current.running=!i.current.running,me(De=>De+1)):z.key==="1"?(i.current.speed=1,me(De=>De+1)):z.key==="2"?(i.current.speed=2,me(De=>De+1)):z.key==="3"?(i.current.speed=3,me(De=>De+1)):z.key==="4"?(i.current.speed=5,me(De=>De+1)):(z.key==="s"||z.key==="S")&&(Ke(De=>!De),Re(De=>({...De,showOverlay:!De.showOverlay})))};return window.addEventListener("resize",ut),window.addEventListener("keydown",D),()=>{window.removeEventListener("resize",ut),window.removeEventListener("keydown",D),document.removeEventListener("visibilitychange",E)}},[]),w.useEffect(()=>{zt.current.mode=it,zt.current.cfg=On},[it,On]),w.useEffect(()=>{const Z=Xn.current;if(!Z)return;Pt.current=new Tv(Z);const{width:Ue,height:ut}=s;return Pt.current.resize(Ue,ut),()=>{var E;(E=Pt.current)==null||E.dispose(),Pt.current=null}},[]),w.useEffect(()=>{var Z;(Z=Pt.current)==null||Z.resize(s.width,s.height)},[s]),w.useEffect(()=>{const Z=Xn.current;if(!Z)return;const Ue=z=>{jn.current={active:!0,lastX:z.clientX,lastY:z.clientY,shift:z.shiftKey}},ut=z=>{if(!jn.current.active)return;const ee=z.clientX-jn.current.lastX,ue=z.clientY-jn.current.lastY;jn.current.lastX=z.clientX,jn.current.lastY=z.clientY;const Ce=zt.current.cfg;jn.current.shift||z.shiftKey?zt.current.cfg={...Ce,camera:{...Ce.camera,panX:Ce.camera.panX+ee*.002,panY:Ce.camera.panY+ue*.002}}:zt.current.cfg={...Ce,camera:{...Ce.camera,yaw:Ce.camera.yaw+ee*.008,pitch:n0(Ce.camera.pitch+ue*.008,.04,Math.PI/2-.04)}},sn({...zt.current.cfg})},E=()=>{jn.current.active=!1},D=z=>{z.preventDefault();const ee=zt.current.cfg;zt.current.cfg={...ee,camera:{...ee.camera,dist:n0(ee.camera.dist*(1+z.deltaY*.001),.5,8)}},sn({...zt.current.cfg})};return Z.addEventListener("mousedown",Ue),Z.addEventListener("mousemove",ut),Z.addEventListener("mouseup",E),Z.addEventListener("mouseleave",E),Z.addEventListener("wheel",D,{passive:!1}),()=>{Z.removeEventListener("mousedown",Ue),Z.removeEventListener("mousemove",ut),Z.removeEventListener("mouseup",E),Z.removeEventListener("mouseleave",E),Z.removeEventListener("wheel",D)}},[]),w.useEffect(()=>{oI((Z,Ue)=>{const ut=y.current,E=ms(ut,"nutrient",Z,Ue),D=ms(ut,"tension",Z,Ue),z=ms(ut,"memory",Z,Ue),ee=ms(ut,"entropy",Z,Ue),ue=ms(ut,"sigilBond",Z,Ue),Ce=ms(ut,"sigilRift",Z,Ue),ze=ms(ut,"sigilBloom",Z,Ue),De=ms(ut,"sigilOath",Z,Ue),ct=Math.max(0,Math.min(1,1-E)),pt=Math.max(0,Math.min(1,z*.9-ee*.7)),on=Math.max(0,Math.min(1,D*.8+ee*.8));return{nutrient:E,tension:D,memory:z,entropy:ee,scarcity:ct,cohesion:pt,volatility:on,sigilBond:ue,sigilRift:Ce,sigilBloom:ze,sigilOath:De}}),aI((Z,Ue)=>{const ut=ge.current;if(!ut.enabled)return{bond:0,rift:0,bloom:0,oath:0};const E=Bk(ae.current,Z,Ue);return{bond:E.bond*ut.influence,rift:E.rift*ut.influence,bloom:E.bloom*ut.influence,oath:E.oath*ut.influence}}),sI((Z,Ue,ut,E)=>{const D=ge.current;D.enabled&&hL(ae.current,Ue,ut,Z,E*D.deposit)})},[]),w.useEffect(()=>{let Z,Ue=0,ut=0;const E=D=>{var Do,Lo;if(document.hidden){Z=requestAnimationFrame(E);return}if(Rr||yn!=="complexityLife"&&yn!=="sociogenesis")return;if(!i.current.running){g0(),Z=requestAnimationFrame(E);return}if(Ue++,Ue>=240){const vt=i.current.fps,Mt=Date.now();ut=JT(vt,Mt,ut,c.current.count,(xt,Mn)=>{c.current.count=xt,Is.current=xt,Ks(xt),Kn(` Performance: ${xt} partculas (${Mn})`,{duration:3e3,style:{background:"#1a1a2e",color:"#94a3b8",border:"1px solid #334155",fontSize:"11px"}})}),Ue=0}i.current.maxStepsPerFrame=Sn.current.maxStepsPerFrame;const{stepCount:z,fieldTick:ee,reconfigTick:ue}=UT(i.current,D,j.current.interval),Ce=performance.now();for(let vt=0;vt<z;vt++){d.current.dt=Kl;const Mt=et.current;d.current.foodEnabled=Mt.foodEnabled,d.current.foodRatio=Mt.foodRatio,d.current.energyEnabled=Mt.energyEnabled,d.current.energyDecay=Mt.energyDecay,d.current.energyFeedRate=Mt.energyFeedRate,d.current.energyReproThreshold=Mt.energyReproThreshold,d.current.metamorphosisEnabled=Mt.mode==="EVOLUTIVE"||Mt.mode==="FULL",d.current.mutationRate=Mt.mutationRate,d.current.typeStability=Mt.typeStability,j.current.mutationRate=Mt.reconfigRate,j.current.mutationAmount=Mt.reconfigAmount;const xt=L.current,Mn=xt.feedback.config.enabled,Rn=Mn?CJ(d.current,xt.feedback.modulation):null,Hn=performance.now();if((Lo=(Do=v.current)==null?void 0:Do.cfg)!=null&&Lo.enabled?e8(c.current,d.current,h.current,(In,sr)=>{const bn=Df(g.current,In,sr);return{tension:bn.tension*m.current.influenceStrength,cohesion:bn.cohesion*m.current.influenceStrength,scarcity:bn.scarcity*m.current.influenceStrength}},u.current,i.current.tick,v.current):Uf(c.current,d.current,h.current,(In,sr)=>{const bn=Df(g.current,In,sr);return{tension:bn.tension*m.current.influenceStrength,cohesion:bn.cohesion*m.current.influenceStrength,scarcity:bn.scarcity*m.current.influenceStrength}},u.current,i.current.tick),Vf(xt.moduleTelemetry,"particleLife",performance.now()-Hn),Mn&&Rn&&MJ(d.current,Rn),d.current.energyEnabled&&c.current.count<1500){const In=Zt.current;In.enabled=!0,In.baseDecay=Mt.energyDecay,In.feedRate=Mt.energyFeedRate,In.reproductionThreshold=Mt.energyReproThreshold,In.mutationChance=.02+Mt.mutationDial*.18,In.deathThreshold=.18+(1-Mt.mutationDial)*.12;const sr=performance.now(),bn=xI(c.current,h.current,In,u.current,c.current.maxCount);Vf(xt.moduleTelemetry,"energy",performance.now()-sr);const Yr=bn.births??0,Kr=bn.deaths??0;Yr&&(dt.current.births+=Yr,F.current.births+=Yr),Kr&&(dt.current.deaths+=Kr,F.current.deaths+=Kr),IJ(H.current,1e3/60,Yr,Kr,0)}}const ze=y.current,De=Math.max(1,Math.floor(c.current.count/150));for(let vt=0;vt<c.current.count;vt+=De){const Mt=c.current.x[vt],xt=c.current.y[vt],Mn=c.current.vx[vt],Rn=c.current.vy[vt],Hn=Math.sqrt(Mn*Mn+Rn*Rn);Lm(ze,"memory",Mt,xt,C.injection.memoryFromMotion*Hn*.08),Lm(ze,"entropy",Mt,xt,C.injection.entropyFromInstability*Math.max(0,Hn-.15)*.08),c.current.type[vt]===Jl&&Lm(ze,"nutrient",Mt,xt,C.injection.nutrientFromFood*.08)}const ct=z*Kl;{const vt=performance.now();qP(ze,C,ct),Vf(L.current.moduleTelemetry,"field",performance.now()-vt)}{const vt=performance.now();rL(c.current,(Mt,xt)=>{const Mn=y.current,Rn=ms(Mn,"nutrient",Mt,xt),Hn=ms(Mn,"tension",Mt,xt),In=ms(Mn,"memory",Mt,xt),sr=ms(Mn,"entropy",Mt,xt),bn=Math.max(0,Math.min(1,1-Rn)),Yr=Math.max(0,Math.min(1,In*.9-sr*.7)),Kr=Math.max(0,Math.min(1,Hn*.8+sr*.8));return{nutrient:Rn,tension:Hn,memory:In,entropy:sr,scarcity:bn,cohesion:Yr,volatility:Kr}},ct,pe),Vf(L.current.moduleTelemetry,"genes",performance.now()-vt)}const pt=i.current.elapsed;if(pt-ce.current>15){ce.current=pt;const vt=nL(c.current,200);if(vt){const Mt=c8(ze),xt={volatility:Mt.volatility,scarcity:Mt.scarcity,cohesion:Mt.cohesion},Mn=JD(le.current,pt,vt.centroid,xt);if(Mn){const Rn=cL(Mn.notes),Hn=(u.current.next()-.5)*1.5,In=(u.current.next()-.5)*1.5;E6(Q.current,Hn,In,Mn.sigil,Rn,Mn.name,6),$e.push({t:pt,type:"beat",title:`${Mn.sigil} Novo Arqutipo: ${Mn.name}`,sigil:Mn.sigil,detail:`Uma nova espcie emergiu atravs de especiao gentica!

Condies de nascimento: ${Mn.notes.join(", ")}
Perfil gentico:
   Gene A (Atrao): ${Mn.genes.a.toFixed(2)}
   Gene B (Mobilidade): ${Mn.genes.b.toFixed(2)}
   Gene C (Coeso): ${Mn.genes.c.toFixed(2)}
   Gene D (Sensibilidade): ${Mn.genes.d.toFixed(2)}

Contexto do campo:
   Volatilidade: ${(xt.volatility*100).toFixed(0)}%
   Escassez: ${(xt.scarcity*100).toFixed(0)}%
   Coeso: ${(xt.cohesion*100).toFixed(0)}%`,meta:{archetype:Mn,signal:xt}}),Fe(sr=>({...sr,totalSpeciations:sr.totalSpeciations+1}))}}}if(pt-te.current>15){te.current=pt;const vt=F.current;(vt.births>5||vt.deaths>5)&&$e.push({t:pt,type:"system",title:"Dinmica Populacional",sigil:vt.births>vt.deaths?"+":"-",detail:`Mudanas na populao nos ltimos 15 segundos:

+ Nascimentos: ${vt.births} novos agentes
- Mortes: ${vt.deaths} agentes eliminados
 Saldo: ${vt.births-vt.deaths>0?"+":""}${vt.births-vt.deaths}

Populao atual: ${c.current.count} agentes`}),F.current.births=0,F.current.deaths=0}if(ge.current.enabled&&fL(ae.current,ge.current,ct),ge.current.enabled&&(Ae.current=mL(Ae.current,c.current,ct,pt),pt-ke.current>1.5)){ke.current=pt;for(const vt of Ae.current){const Mt=yL(vt,g.current,ae.current);if(Mt&&!J.current.find(xt=>xt.id===vt.id)){const xt=xL(vt,Mt,pt);J.current=[xt,...J.current].slice(0,60),We([...J.current]),fu(T.current,{time:pt,type:"speciation",message:`${xt.sigil} Archetype emerged: ${xt.name}`,sigil:xt.sigil});const Mn=xt.kind==="VINCULO"?"#64c8ff":xt.kind==="RUPTURA"?"#ff6478":xt.kind==="FLORESCER"?"#78ff8c":xt.kind==="JURAMENTO"?"#c8b4ff":"#ffffff";E6(Q.current,xt.locus.x,xt.locus.y,xt.sigil,Mn,xt.name,6),Fe(Rn=>({...Rn,totalSpeciations:Rn.totalSpeciations+1}))}}}if(LJ(L.current,c.current,d.current,1/Math.max(1,i.current.fps||60)),I.current=L.current.feedback,bo.current++,bo.current>=20){bo.current=0;const vt=L.current;oe({feedback:vt.feedback,metrics:{...vt.metrics},forces:{...vt.forces},systemPhase:vt.systemPhase,modulation:{...vt.modulation},moduleTelemetry:vt.moduleTelemetry,vitalRates:{...H.current.lastRates},systemHealth:vt.systemHealth,emergenceIndex:vt.emergenceIndex}),q({config:{...vt.feedback.config},metrics:{...vt.feedback.metrics},activations:{...vt.feedback.activations},modulation:{...vt.feedback.modulation},metricsHistory:vt.feedback.metricsHistory,historyMaxLen:vt.feedback.historyMaxLen,phase:vt.feedback.phase,phaseLabel:vt.feedback.phaseLabel,frameCounter:vt.feedback.frameCounter,runawayCounter:vt.feedback.runawayCounter});const Mt=c8(ze);jo(Mt),Wt({...dt.current}),dt.current.births=Math.floor(dt.current.births*.6),dt.current.deaths=Math.floor(dt.current.deaths*.6),dt.current.mutations=Math.floor(dt.current.mutations*.6);const xt=i.current.elapsed,Mn=pP(xt,{scarcity:Mt.scarcity,cohesion:Mt.cohesion,volatility:Mt.volatility},_e.current);Mn&&(_e.current=Mn,he.current.currentArc=Mn.name,$e.push({t:xt,type:"system",title:` ${Mn.name}`,sigil:"",detail:Mn.reason,meta:Mn})),he.current.tone=fe;const Rn=uP({t:xt,loops:{scarcity:Mt.scarcity,cohesion:Mt.cohesion,volatility:Mt.volatility,avgNutrient:Mt.avgNutrient,avgTension:Mt.avgTension,avgMemory:Mt.avgMemory,avgEntropy:Mt.avgEntropy},events:$e.events.slice(0,6)},he.current);Rn&&(Me(In=>[Rn,...In].slice(0,120)),$e.push({t:xt,type:"pattern",title:Rn.title,sigil:"",detail:Rn.text,meta:{tags:Rn.tags}}));const Hn=Mt.scarcity;for(let In=0;In<c.current.count;In+=De*2){const sr=c.current.x[In],bn=c.current.y[In];Lm(ze,"tension",sr,bn,C.injection.tensionFromCrowding*Hn*.05)}}const kn=performance.now()-Ce;if(ee&&c.current.count<2e3){SI(c.current,g.current,m.current.depositStrength),vI(g.current,m.current);for(const vt of R.current.artifacts)vt.effect.type==="field"&&vt.effect.fieldMod&&Lf(g.current,vt.x,vt.y,vt.effect.fieldMod.layer,vt.effect.fieldMod.delta)}if(ue){const vt=f2(c.current,d.current.typesCount);Fe(Mt=>({...Mt,peakParticleCount:Math.max(Mt.peakParticleCount,c.current.count),peakTension:Math.max(Mt.peakTension,Xe.current.avgTension),peakCohesion:Math.max(Mt.peakCohesion,Xe.current.avgCohesion),peakDiversity:Math.max(Mt.peakDiversity,vt)}))}if(ue&&c.current.count<1200){Xe.current=AI(c.current,g.current);const vt=jI(c.current,d.current,h.current,R.current,Xe.current,j.current.mutationStrength,j.current.speciationRate,j.current.institutionRate,u.current,i.current.elapsed);if(vt){fu(T.current,vt),Fe(xt=>({...xt,totalBeats:xt.totalBeats+1,totalSpeciations:xt.totalSpeciations+(vt.type==="speciation"?1:0),totalInstitutions:xt.totalInstitutions+(vt.type==="institution"?1:0),totalMutations:xt.totalMutations+(vt.type==="mutation"?1:0)}));const Mt=QI(vt,Xe.current);$e.push({t:i.current.elapsed,type:"beat",title:Mt.title,sigil:vt.sigil,detail:Mt.description,meta:{beatType:vt.type,typesCount:d.current.typesCount,mood:Mt.mood,significance:Mt.significance}}),Kn.success(Mt.title,{description:Mt.description,duration:4e3}),Pm(_.current,d.current,h.current,f.current,R.current,i.current.elapsed),me(xt=>xt+1)}if(nn&&nn.mitosisRate>.01&&c.current.count<1200){const Mt=jP(nn.mitosisRate),xt=TP(c.current,h.current,Mt,u.current);if(xt.success&&xt.message){Fe(Rn=>({...Rn,totalMitosis:Rn.totalMitosis+1}));const Mn=tP(xt.parentSize||50,xt.childrenCount||2,i.current.elapsed);$e.push({t:i.current.elapsed,type:"mitosis",title:Mn.title,sigil:"",detail:Mn.description,meta:{childrenCreated:xt.childrenCount||0,particleCount:c.current.count,mood:Mn.mood,significance:Mn.significance}}),Kn.success(Mn.title,{description:Mn.description,duration:4e3})}}}So&&KI(c.current,U),lL(Q.current,i.current.elapsed);let xn=!1;if(yn==="sociogenesis"&&Da.current.length>0){for(const vt of Da.current)vt.particleIndex<c.current.count&&(vt.x=c.current.x[vt.particleIndex],vt.y=c.current.y[vt.particleIndex]);fz(c.current,Da.current,wn.current.config.influenceGain*wn.current.config.simSpeed)}if(yn==="sociogenesis"&&$L(wn.current,i.current.elapsed)){wn.current.lastTickTime=i.current.elapsed,!sc.current&&c.current.count>0&&(sc.current=!0,SL(c.current,wn.current.culture,wn.current.cultureConfig.memeCount));const vt=zL(wn.current,c.current,i.current.elapsed);if(vt.length>0){for(const Mt of vt){wn.current.chronicle.unshift(Mt),fu(T.current,{time:i.current.elapsed,type:"institution",message:`${Mt.icon} ${Mt.message}`,sigil:Mt.icon});const xt=Mt.cause.includes("crossed")?"#ef4444":Mt.cause.includes("Case")?"#fbbf24":"#94a3b8";Ai(i.current.elapsed,`${Mt.icon} ${Mt.message}`,xt)}xn=!0}if(sc.current&&wn.current.cultureConfig.enabled){const Mt=i.current.elapsed,xt=wn.current.config.cadenceSec/wn.current.config.simSpeed,Mn=wL(Mt,c.current,wn.current.culture,wn.current.cultureConfig,u.current,(bn,Yr)=>({a:ms(y.current,"memory",bn,Yr),s:ms(y.current,"tension",bn,Yr)}));for(const bn of Mn){const Yr=bn.type==="CONVERSION_WAVE"?"->":bn.type==="CULT_DOMINANCE"?"*":"x",Kr=bn.type==="CULT_DOMINANCE"?"#ffd166":bn.type==="SCHISM_WARNING"?"#ef476f":"#06d6a0";if(bn.type!=="CULT_DOMINANCE"||wn.current.chronicle.length===0||!wn.current.chronicle[0].message.includes("DOMINANCE")){const ho={time:Mt,icon:Yr,message:`${bn.type.replace(/_/g," ")}: ${bn.evidence}`,cause:bn.evidence,consequence:bn.type==="CULT_DOMINANCE"?"Cultural homogenization":"Cultural flux"};wn.current.chronicle.unshift(ho),Ai(Mt,`${Yr} ${bn.evidence}`,Kr)}(bn.wx!==0||bn.wy!==0)&&kc(bn.wx,bn.wy,bn.type==="CULT_DOMINANCE"?"*":"->",Kr,Mt,5)}const Rn=RL(xt,c.current,wn.current.culture,wn.current,Mt);for(const bn of Rn){const Yr="#c084fc";wn.current.chronicle.find(ho=>ho.icon===""&&Mt-ho.time<15)||(wn.current.chronicle.unshift({time:Mt,icon:"",message:`LEADER EMERGES: ${bn.evidence}`,cause:bn.evidence,consequence:"Accelerates meme spread in local area"}),Ai(Mt,` LEADER: ${bn.evidence}`,Yr),kc(bn.wx,bn.wy,"LEADER",Yr,Mt,6))}const Hn=$k(c.current,wn.current.culture,wn.current.cultureConfig.memeCount);Ji(Hn);const In=AL(c.current,wn.current.culture,5);ac(In),xn=!0;const sr=80;wn.current.chronicle.length>sr&&(wn.current.chronicle.length=sr)}if(i.current.elapsed-d0.current>10&&(d0.current=i.current.elapsed,ZL(wn.current,c.current,i.current.elapsed),xn=!0),i.current.elapsed-Wd.current>8&&(Wd.current=i.current.elapsed,Da.current=hz(c.current,wn.current,i.current.elapsed)),wn.current.tribes.length>0&&uz(h.current,wn.current),Ts!=="off"&&dz(h.current,Ts,wn.current),wn.current.config.autoEmergence&&cz(lc.current,i.current.elapsed)){lc.current=i.current.elapsed;const Mt=wn.current.totems.length,xt=wn.current.taboos.length,Mn=wn.current.rituals.length;rz(wn.current,c.current,i.current.elapsed);const Rn=i.current.elapsed;for(let Hn=Mt;Hn<wn.current.totems.length;Hn++){const In=wn.current.totems[Hn],sr=In.kind==="BOND"?"#5ac8fa":In.kind==="RIFT"?"#ff6b6b":In.kind==="ORACLE"?"#c084fc":"#94a3b8";kc(In.pos.x,In.pos.y,`${In.kind} totem`,sr,Rn),Ai(Rn,`Totem emerged: ${In.name} (${In.kind})`,sr)}for(let Hn=xt;Hn<wn.current.taboos.length;Hn++){const In=wn.current.taboos[Hn],sr=In.kind==="NO_ENTER"?"#ef4444":"#f97316";kc(In.pos.x,In.pos.y,`${In.kind.replace("_"," ")} zone`,sr,Rn),Ai(Rn,`Taboo emerged: ${In.kind.replace("_"," ")} boundary`,sr)}for(let Hn=Mn;Hn<wn.current.rituals.length;Hn++){const In=wn.current.rituals[Hn],sr=wn.current.totems.find(bn=>bn.id===In.totemId);sr&&(kc(sr.pos.x,sr.pos.y,`${In.kind} ritual`,"#34d399",Rn),Ai(Rn,`Ritual emerged: ${In.kind} at ${sr.name}`,"#34d399"))}xn=!0}}if(yn==="sociogenesis"){const vt=i.current.elapsed-l0.current;if(vt>=2){const Mt=i.current.elapsed,xt=wn.current.rituals.find(bn=>(Mt-bn.bornAt)%bn.periodSec/bn.periodSec<bn.dutyCycle),Mn=!!xt,Rn=xt?wn.current.totems.find(bn=>bn.id===xt.totemId):void 0,Hn=Rn?Rn.pos:void 0,In=nQ(c.current,d.current.typesCount,Mn,Hn);Dp.current=In;const sr=aQ(In,i.current.elapsed);for(const bn of sr){wn.current.chronicle.unshift({time:bn.time,icon:bn.icon,message:bn.title,cause:bn.detail,consequence:`Phase: ${In.phase}`});const Yr=bn.kind==="PHASE_SHIFT"?"#a78bfa":bn.kind==="VOLATILITY_SPIKE"?"#fbbf24":bn.kind==="COHESION_SPIKE"?"#34d399":bn.kind==="BORDER_FORMED"?"#f97316":"#94a3b8";Ai(bn.time,`${bn.icon} ${bn.title}`,Yr)}if(l0.current=i.current.elapsed,xn=!0,_a.current.enabled){const bn=vt;$d.current||($d.current=!0,VJ(is.current,_a.current,u.current)),UJ(is.current,_a.current,g.current,bn),KJ(is.current,_a.current,c.current,g.current,bn),QJ(is.current,_a.current,c.current,wn.current.culture,bn);const{metrics:Yr,events:Kr}=eQ(is.current,_a.current,c.current,oc.current);oc.current=Yr;for(const ho of Kr)wn.current.chronicle.unshift({time:Mt,icon:ho.icon,message:ho.message,cause:"Economy engine",consequence:""}),Ai(Mt,`${ho.icon} ${ho.message}`,ho.color);$h({...Yr}),xn=!0}}}if(yn==="sociogenesis"&&_a.current.enabled&&wn.current.rituals.length>0){const vt=wn.current.config.cadenceSec/wn.current.config.simSpeed;JJ(is.current,_a.current,wn.current,c.current,vt)}if(xn&&Ys(vt=>vt+1),MI(R.current,Kl),i.current.tick%600===0){const vt=new Map;for(let Rn=0;Rn<c.current.count;Rn++){const Hn=c.current.archetypeId[Rn];vt.set(Hn,(vt.get(Hn)||0)+1)}const Mt=Array.from(vt.entries()).map(([Rn,Hn])=>{const In=le.current.list.find(sr=>sr.id===Rn);return{id:(In==null?void 0:In.sigil)||"?",age:i.current.elapsed-((In==null?void 0:In.bornAt)||0),stability:.5,particleCount:Hn}}),xt=eP(Xe.current,c.current.count,i.current.elapsed);if(i.current.tick%3600===0&&i.current.elapsed>10){const Rn=nP(xt);He(Rn),$e.push({t:i.current.elapsed,type:"system",title:" Estado do Universo",sigil:"",detail:Rn,meta:{stability:xt.score.toFixed(2),entropy:xt.entropy.toFixed(2),complexity:xt.complexity.toFixed(2),resilience:xt.resilience.toFixed(2)}})}const Mn=$e.events.slice(-10).map(Rn=>Rn.title);Dr.checkAchievements({currentTime:i.current.elapsed,particleCount:c.current.count,typesCount:d.current.typesCount,organisms:Mt,stabilityScore:xt.score,entropyLevel:xt.entropy,recentEvents:Mn,configSummary:nn?Dm(nn):"N/A",borderStrength:Xe.current.borderStrength,stableClusters:Xe.current.stableClusters,oscillation:Xe.current.oscillation,diversityIndex:f2(c.current,d.current.typesCount),avgTension:Xe.current.avgTension,avgCohesion:Xe.current.avgCohesion,totalBeats:Ze.totalBeats,totalSpeciations:Ze.totalSpeciations,totalMutations:Ze.totalMutations,totalMitosis:Ze.totalMitosis,peakParticleCount:Ze.peakParticleCount})}if(i.current.tick%30===0){const vt=c.current.count,Mt=Is.current;if(vt<Mt){const xt=Math.min(10,Mt-vt);for(let Mn=0;Mn<xt;Mn++){let Rn;if(d.current.foodEnabled){const Hn=Math.floor(Mt*d.current.foodRatio);Array.from(c.current.type.slice(0,vt)).filter(sr=>sr===255).length<Hn&&u.current.next()<.5?Rn=255:Rn=u.current.int(0,d.current.typesCount-1)}else Rn=u.current.int(0,d.current.typesCount-1);$4(c.current,u.current.next()*2-1,u.current.next()*2-1,Rn)}}else if(vt>Mt){const xt=Math.min(10,vt-Mt);c.current.count-=xt}}const Zn=performance.now();g0(),zt.current.mode==="3D"&&yn!=="psycheLab"&&m0();const Ur=performance.now()-Zn,oo=UC();ln.current.simMs+=kn,ln.current.renderMs+=Ur,ln.current.frames+=1,ln.current.frames>=60&&(de(ln.current.simMs/ln.current.frames),qe(ln.current.renderMs/ln.current.frames),$t(oo.neighborsChecked),Ut(oo.interactionsApplied),ln.current.simMs=0,ln.current.renderMs=0,ln.current.frames=0),Z=requestAnimationFrame(E)};return Z=requestAnimationFrame(E),()=>{cancelAnimationFrame(Z)}},[Gt,fn,rt,s,Jt,en,Wn,cr,br,or,nn,fr,nr,rn,vo,So,yn,Ts,Rr]);const m0=w.useCallback(()=>{const Z=Pt.current;if(!(Z!=null&&Z.isReady))return;const{mode:Ue,cfg:ut}=zt.current;if(Ue!=="3D"||yn==="psycheLab")return;const E=c.current,D=[],z=d.current.typesCount,ee=yn==="sociogenesis"?wn.current:null;for(let ue=0;ue<E.count;ue++){const Ce=m$(E.vx[ue],E.vy[ue],E.energy[ue],E.geneA[ue],E.age[ue],ut.zVar);let[ze,De,ct]=p$(E.type[ue],z);if(ee&&yn==="sociogenesis"){const pt=ee.culture.memeId[ue]??0,on=ks[pt%ks.length]??"#aaa";ze=parseInt(on.slice(1,3),16)/255,De=parseInt(on.slice(3,5),16)/255,ct=parseInt(on.slice(5,7),16)/255,ut.zVar==="prestige"?D.push({nx:E.x[ue],ny:E.y[ue],z:n0(ee.culture.prestige[ue],0,1),r:ze,g:De,b:ct}):D.push({nx:E.x[ue],ny:E.y[ue],z:Ce,r:ze,g:De,b:ct});continue}D.push({nx:E.x[ue],ny:E.y[ue],z:Ce,r:ze,g:De,b:ct})}Z.render(D,ut)},[yn]),g0=w.useCallback(()=>{var ut,E,D;const Z=e.current,Ue=t.current;if(!(!Z||!Ue)){if(jt.current)LI(jt.current,{pointSize:Jt,fade:en,glow:Wn,paletteIndex:cr}),BI(jt.current,c.current,d.current.typesCount,s.width,s.height);else if(hn.current){const z=Gt&&!vo&&!So;qI(hn.current,c.current,s.width,s.height,z,br,or,Sn.current.renderQuality,fr)}if(an.current||(an.current=Ue.getContext("2d")),an.current){const z=an.current,ee=Math.min(window.devicePixelRatio||1,1.5);if(!ia.current.valid){const ct=Ue.getBoundingClientRect();ia.current.width=ct.width,ia.current.height=ct.height,ia.current.valid=!0}const ue=ia.current.width,Ce=ia.current.height,ze=Math.floor(ue*ee),De=Math.floor(Ce*ee);if((Ue.width!==ze||Ue.height!==De)&&(Ue.width=ze,Ue.height=De,z.setTransform(ee,0,0,ee,0,0)),z.clearRect(0,0,ue,Ce),fn){const pt={tension:"tension",cohesion:"memory",scarcity:"nutrient",novelty:"entropy",mythic:"sigilBond"}[rt]??"tension";HI(z,y.current,pt,ue,Ce,1.2)}if(GI(z,R.current.artifacts,ue,Ce),vo){const ct={maxDistance:Jo,opacity:Na,thickness:1.5};XI(z,c.current,ct,cr)}if(So){const ct={opacity:W};ZI(z,c.current,ct,cr)}if(Ne&&YI(z,Q.current.pings,ue,Ce),ge.current.enabled&&ge.current.showOverlay&&JI(z,ae.current,ge.current,ue,Ce),yn==="sociogenesis"){if(WL(z,wn.current,ue,Ce,i.current.elapsed,c.current,Ts),b&&((E=(ut=v.current)==null?void 0:ut.cfg)!=null&&E.enabled)&&((D=v.current)!=null&&D.field)&&KC(z,v.current.field,ue,Ce),Ts==="economy"&&_a.current.enabled&&JL(z,is.current,oc.current,ue,Ce),Ts==="territory"&&_a.current.enabled&&QL(z,is.current,ue,Ce),Da.current.length>0&&Ts!=="culture"){const ct=ci[cr%ci.length]||ci[0];pz(z,Da.current,ue,Ce,ct)}wo.current.cursorX>=0&&wo.current.cursorY>=0&&XL(z,wn.current.tool,wo.current.cursorX,wo.current.cursorY,ue,Ce,wn.current.tool==="TOTEM"?gi:wn.current.tool==="TABOO"?ic:wn.current.tool==="RITUAL"?Qi:void 0)}if(Tn.current.cursorX>0&&Tn.current.cursorY>0&&(mr||Tn.current.down)&&VI(z,Tn.current.cursorX,Tn.current.cursorY,ro,Tn.current.mode),cn){const ct=T.current.beats[T.current.beats.length-1];UI(z,c.current.count,d.current.typesCount,ct?ct.message.substring(0,20):"None",ue,Ce)}}}},[Gt,fn,rt,s,ro,cn,Jt,en,Wn,cr,br,or,fr,vo,Jo,Na,So,U,W,Ne,yn,gi,ic,Qi,mr,Ts,b]),y0=()=>{Fe({totalBeats:0,totalSpeciations:0,totalInstitutions:0,totalMutations:0,totalMitosis:0,totalMetamorphosis:0,peakParticleCount:0,peakDiversity:0,peakTension:0,peakCohesion:0,simulationStartTime:Date.now()})},Ud=Z=>{const Ue=gI[Z];y0(),yn==="sociogenesis"&&(wn.current=I6(),Ys(ut=>ut+1)),Ue.showSigils&&Ke(!0),$e.push({t:i.current.elapsed,type:"system",title:`Preset Loaded: ${Ue.name}`,sigil:"",detail:`${Ue.typesCount} types, ${Ue.particleCount} particles`,meta:{preset:Ue.name}}),d.current.typesCount=Ue.typesCount,Object.assign(d.current,Ue.config),h.current=Mi(Ue.typesCount),Ue.matrixInit(h.current),f.current=Mi(Ue.typesCount),rs(h.current,f.current),d.current.circularDependency>0&&ki(h.current,d.current.circularDependency),ft(Ue.name),c.current.count=0,i8(),i2(c.current,Ue.particleCount,u.current,Ue.typesCount,et.current.foodEnabled,et.current.foodRatio);for(let ut=0;ut<c.current.count;ut++){const E=u.current.next()*Math.PI*2,D=u.current.next()*.008;c.current.vx[ut]=Math.cos(E)*D,c.current.vy[ut]=Math.sin(E)*D}Is.current=Ue.particleCount,Ks(Ue.particleCount),g.current=hf(48,27),y.current=g2(64),T.current.beats=[],R.current.artifacts=[],_.current.snapshots=[],Pm(_.current,d.current,h.current,f.current,R.current,i.current.elapsed),i.current.running=!0,me(ut=>ut+1),Kn.success(`${Ue.name} | ${Ue.typesCount} types | ${Ue.particleCount} particles`)},Ya=Z=>{K(Ue=>D2({...Ue,...Z}))},Al=Z=>{const Ue=th.find(ut=>ut.id===Z);Ue?dc(Ue,!1):Kn.error(`Preset ${Z} not found`)},dc=(Z,Ue=!1)=>{y0(),$e.push({t:i.current.elapsed,type:"system",title:`Creative Preset: ${Z.name}`,sigil:"",detail:Z.description,meta:{preset:Z.name,seed:Z.seed}}),u.current=new cd(Z.seed),bt(Z.seed),a2(Z.seed),d.current.typesCount=Z.typesCount,Object.assign(d.current,Z.micro),Object.assign(m.current,Z.field),Object.assign(j.current,Z.reconfig),Z.matrix?h.current=CT(Z.matrix.style,Z.typesCount,u.current,d.current.rmax):(h.current=Mi(Z.typesCount),l2(h.current,u.current,d.current.rmax)),f.current=Mi(Z.typesCount),rs(h.current,f.current),d.current.circularDependency&&d.current.circularDependency>0&&ki(h.current,d.current.circularDependency),ft(Z.name),(Z.id.includes("sigil")||Z.id.includes("archetype"))&&(Ke(!0),Kn.info("Sigil Overlay Ativado",{description:"Observe os smbolos emergentes aparecerem nos campos!",duration:4e3})),Ue&&(localStorage.getItem("guide_completed")||(Oe(!0),setTimeout(()=>Oe(!1),1e4))),c.current.count=0,i8();const ut=Math.min(Z.particleCount,800);i2(c.current,ut,u.current,Z.typesCount,et.current.foodEnabled,et.current.foodRatio),Is.current=ut,Ks(ut);for(let E=0;E<c.current.count;E++){const D=u.current.next()*Math.PI*2,z=u.current.next()*.01;c.current.vx[E]=Math.cos(D)*z,c.current.vy[E]=Math.sin(D)*z,d.current.energyEnabled&&(c.current.energy[E]=1.2)}g.current=hf(48,27),y.current=g2(64),T.current.beats=[],R.current.artifacts=[],_.current.snapshots=[],Pm(_.current,d.current,h.current,f.current,R.current,i.current.elapsed),i.current.running=!0,me(E=>E+1),$D(),Kn.success(Z.name,{description:Z.description})},x0=Z=>{bt(Z),u.current=new cd(Z),a2(Z),Kn.info(`Seed updated: ${Z}`)},Yd=Z=>{ZT(Sn.current,Z),Eo(Z),Kn.info(`Quality: ${Z}`,{description:`Max steps: ${Sn.current.maxStepsPerFrame}`,duration:2e3}),me(Ue=>Ue+1)},Kd=Z=>{pn(Z);const Ue=mP.find(ut=>ut.id===Z);if(Ue){const ut=c.current.count,{positions:E,types:D}=gP(Ue,ut,d.current.typesCount,2,2);c.current.count=ut;for(let z=0;z<ut;z++)c.current.x[z]=E[z*2]-1,c.current.y[z]=E[z*2+1]-1,c.current.type[z]=D[z],c.current.vx[z]=0,c.current.vy[z]=0,c.current.energy[z]=1;me(z=>z+1),Kn.info(Ue.name,{description:Ue.description,duration:3e3})}else{const ut=c.current.count;c.current.count=0,W4(c.current,ut,Z,u.current,d.current.typesCount,et.current.foodEnabled,et.current.foodRatio);for(let E=0;E<c.current.count;E++)c.current.vx[E]=0,c.current.vy[E]=0,c.current.energy[E]=1;me(E=>E+1),Kn.info(`Spawn: ${Z}`,{description:"Particles repositioned",duration:2e3})}},jl=(Z,Ue)=>{y0(),$e.push({t:i.current.elapsed,type:"system",title:"New DNA Applied",sigil:"",detail:`${Z.speciesCount} species, ${Z.matrixMode} matrix`,meta:{seed:Ue,matrixMode:Z.matrixMode}}),u.current=new cd(Ue),bt(Ue),Bt(Z),dP(he.current,Ue),_e.current={name:"Gnese",since:0,reason:"init"},Me([]);const ut=1200;let E=Z.speciesCount*Z.particlesPerSpecies;console.log(` DNA: ${Z.speciesCount} species  ${Z.particlesPerSpecies} = ${E} particles`),E>ut&&(console.warn(` ULTRA CAP: ${E}  ${ut} particles`),E=ut),d.current.typesCount=Z.speciesCount,d.current.beta=Z.beta,d.current.coreRepel=Z.coreRepel,d.current.rmax=Z.rmax,d.current.force=Z.forceGain,d.current.drag=Z.drag,d.current.speedClamp=Z.speedClamp,d.current.useDrag=!0,d.current.kernelMode="classic",h.current=yP(Z.speciesCount,Z.matrixMode,Z.matrixSparsity,Z.radiusSpread,u.current),f.current=Mi(Z.speciesCount),rs(h.current,f.current),hr(Z.renderMode),vn(Z.trailsFade),pr(Z.paletteId),pn(Z.spawnPattern),c.current.count=0,W4(c.current,E,Z.spawnPattern,u.current,Z.speciesCount,et.current.foodEnabled,et.current.foodRatio);for(let D=0;D<c.current.count;D++){const z=u.current.next()*Math.PI*2,ee=u.current.next()*.01;c.current.vx[D]=Math.cos(z)*ee,c.current.vy[D]=Math.sin(z)*ee,c.current.energy[D]=1}Is.current=E,Ks(E),g.current=hf(48,27),T.current.beats=[],R.current.artifacts=[],_.current.snapshots=[],d.current.energyEnabled=Z.energyEnabled,Z.metamorphosisEnabled!==void 0&&(d.current.metamorphosisEnabled=Z.metamorphosisEnabled),Z.mutationRate!==void 0&&(d.current.mutationRate=Z.mutationRate),Z.typeStability!==void 0&&(d.current.typeStability=Z.typeStability),i.current.tick=0,i.current.elapsed=0,i.current.running=!0,me(D=>D+1),Kn.success("DNA Applied",{description:Dm(Z),duration:4e3})},Vh=Z=>{const Ue=Date.now(),ut=RP(Z,Ue);jl(ut,Ue),ft(Z.charAt(0).toUpperCase()+Z.slice(1)),Z==="darwin"&&setTimeout(()=>{Kn.success("Evoluo Ativa",{description:"Observe partculas mudando de cor (tipo), crescendo com energia e pulsando ao evoluir.",duration:7e3})},1500)},Uh=()=>{const Z=Date.now();let Ue=Nx(Z);Ue=AP(Ue,u.current),jl(Ue,Z),ft("Chaos"),Kn("CHAOS SEED",{description:"Extreme randomization applied",duration:3e3})},tl=()=>{const Z=Date.now(),Ue=Nx(Z);jl(Ue,Z),ft("New Universe"),$e.push({t:0,type:"system",title:" Sistema de Arqutipos Ativo",sigil:"",detail:`O MetaLifeLab agora observa a evoluo gentica dos agentes!

 Como funciona:
 Cada partcula possui 4 genes (A, B, C, D) que influenciam seu comportamento
 Os genes mutam gradualmente atravs de campos de entropia
 Quando genes divergem o suficiente, uma nova ESPCIE emerge (arqutipo)
 Cada arqutipo recebe um nome, sigil nico e perfil gentico

 Especiao acontece a cada ~10 segundos se as condies forem adequadas.
Aguarde... novas espcies podem surgir a qualquer momento!`})},b0=()=>{const Z=Date.now();u.current=new cd(Z),bt(Z);const Ue=u.current.int(0,5),ut=u.current.int(3,7),E=u.current.int(1500,3e3);if(d.current.typesCount=ut,d.current.rmax=.1+u.current.next()*.08,d.current.force=.9+u.current.next()*.6,d.current.friction=.9+u.current.next()*.06,d.current.speedClamp=.08+u.current.next()*.08,d.current.entropy=u.current.next()*.001,h.current=Mi(ut),Ue===0){for(let z=0;z<ut;z++)for(let ee=0;ee<ut;ee++){const ue=(ee-z+ut)%ut;ue===0?h.current.attract[z][ee]=.2+u.current.next()*.3:ue===1?h.current.attract[z][ee]=.5+u.current.next()*.4:ue===ut-1?h.current.attract[z][ee]=-.5-u.current.next()*.3:h.current.attract[z][ee]=-.2+u.current.next()*.3,h.current.radius[z][ee]=d.current.rmax*(.7+u.current.next()*.4),h.current.falloff[z][ee]=1+u.current.next()*.5}ft("Orbital"),Kn.info("Orbital regime",{description:"Cyclic attraction patterns"})}else if(Ue===1){for(let z=0;z<ut;z++)for(let ee=0;ee<ut;ee++)z===ee?h.current.attract[z][ee]=.4+u.current.next()*.3:h.current.attract[z][ee]=-.3-u.current.next()*.4,h.current.radius[z][ee]=d.current.rmax*(.6+u.current.next()*.5),h.current.falloff[z][ee]=.9+u.current.next()*.6;ft("Clustering"),Kn.info("Clustering regime",{description:"Tribal segregation"})}else if(Ue===2){for(let z=0;z<ut;z++){const ee=(z+1)%ut;for(let ue=0;ue<ut;ue++)ue===ee||ue===z?h.current.attract[z][ue]=.6+u.current.next()*.3:h.current.attract[z][ue]=-.2-u.current.next()*.3,h.current.radius[z][ue]=d.current.rmax*(.7+u.current.next()*.4),h.current.falloff[z][ue]=1.2+u.current.next()*.4}c2(h.current),ft("Symbiotic"),Kn.info("Symbiotic regime",{description:"Paired dependencies"})}else if(Ue===3){l2(h.current,u.current,d.current.rmax),c2(h.current);for(let z=0;z<ut;z++)for(let ee=0;ee<ut;ee++)h.current.attract[z][ee]*=.7;ft("Wave"),Kn.info("Wave regime",{description:"Symmetric oscillations"})}else if(Ue===4){const z=u.current.int(0,ut-1);for(let ee=0;ee<ut;ee++)for(let ue=0;ue<ut;ue++)ue===z?h.current.attract[ee][ue]=.5+u.current.next()*.4:ee===z?h.current.attract[ee][ue]=-.3+u.current.next()*.2:ee===ue?h.current.attract[ee][ue]=.3+u.current.next()*.2:h.current.attract[ee][ue]=-.4-u.current.next()*.3,h.current.radius[ee][ue]=d.current.rmax*(.6+u.current.next()*.5),h.current.falloff[ee][ue]=1.1+u.current.next()*.5;ft("Hierarchy"),Kn.info("Hierarchy regime",{description:"Dominant center structure"})}else{const z=Math.max(2,Math.floor(ut/2));for(let ee=0;ee<ut;ee++){const ue=Math.floor(ee/z);for(let Ce=0;Ce<ut;Ce++){const ze=Math.floor(Ce/z);ee===Ce?h.current.attract[ee][Ce]=.4+u.current.next()*.2:ue===ze?h.current.attract[ee][Ce]=.2+u.current.next()*.3:h.current.attract[ee][Ce]=-.4-u.current.next()*.3,h.current.radius[ee][Ce]=d.current.rmax*(.7+u.current.next()*.4),h.current.falloff[ee][Ce]=1+u.current.next()*.6}}ft("Fractal"),Kn.info("Fractal regime",{description:"Nested communities"})}f.current=Mi(ut),rs(h.current,f.current),d.current.circularDependency>0&&ki(h.current,d.current.circularDependency),c.current.count=0;const D=Math.min(800,E);i2(c.current,D,u.current,ut,et.current.foodEnabled,et.current.foodRatio);for(let z=0;z<c.current.count;z++){const ee=u.current.next()*Math.PI*2,ue=u.current.next()*.01;c.current.vx[z]=Math.cos(ee)*ue,c.current.vy[z]=Math.sin(ee)*ue}Is.current=E,Ks(E),m.current.diffusion=.12+u.current.next()*.08,m.current.decay=.025+u.current.next()*.02,m.current.influenceStrength=.5+u.current.next()*.8,j.current.mutationStrength=.05+u.current.next()*.15,j.current.speciationRate=.3+u.current.next()*.4,j.current.institutionRate=.15+u.current.next()*.35,g.current=hf(48,27),T.current.beats=[],R.current.artifacts=[],_.current.snapshots=[],Pm(_.current,d.current,h.current,f.current,R.current,i.current.elapsed),i.current.running=!0,me(z=>z+1)},El=Z=>PI(c.current,d.current,h.current,f.current,g.current,m.current,R.current,j.current,T.current,Z),v0=Z=>{FI(Z,c.current,d.current,h.current,f.current,g.current,m.current,R.current,j.current,T.current),me(Ue=>Ue+1),Kn.success(`Loaded: ${Z.name}`)},Xd=Z=>{const Ue=P.current.organisms.find(E=>E.id===Z);if(!Ue)return;const ut=NP(Ue,c.current,0,0,1);ut>0?Kn.success(`Summoned: ${Ue.name}`,{description:`${ut} particles spawned`}):Kn.error("Failed to summon organism",{description:"Particle limit reached"})},uc=Z=>{OP(P.current,Z)&&(Kn.success("Organism deleted"),me(ut=>ut+1))},nl=(Z,Ue)=>{_P(P.current,Z,Ue)&&me(E=>E+1)},Ps=(Z,Ue,ut)=>{const E=e.current;if(!E)return;E.getBoundingClientRect();const D=window.devicePixelRatio||1,z=Z*D,ee=Ue*D,ue=ut*D,Ce=160,ze=document.createElement("canvas");ze.width=Ce,ze.height=Ce;const De=ze.getContext("2d");if(!De)return;const ct=Math.max(0,z-ue),pt=Math.max(0,ee-ue),on=Math.min(E.width-ct,ue*2),kn=Math.min(E.height-pt,ue*2);De.fillStyle="#0a0a0f",De.fillRect(0,0,Ce,Ce);const xn=Ce/(ue*2),Zn=(Ce-on*xn)/2,dr=(Ce-kn*xn)/2;try{return De.drawImage(E,ct,pt,on,kn,Zn,dr,on*xn,kn*xn),ze.toDataURL("image/png")}catch(Ur){console.error("Failed to capture thumbnail:",Ur);return}},rl=(Z,Ue)=>{const ut=e.current;if(!ut)return[0,0];const E=ut.getBoundingClientRect(),D=(Z-E.left)/E.width*2-1,z=-((Ue-E.top)/E.height*2-1);return[D,z]},ba=w.useCallback((Z,Ue,ut)=>{const E=wn.current,D=E.tool;if(D==="SELECT"){let z=.04,ee=null;for(const ue of E.totems){const Ce=(ue.pos.x-Z)**2+(ue.pos.y-Ue)**2;Ce<z&&(z=Ce,ee={type:"totem",id:ue.id})}for(const ue of E.taboos){const Ce=(ue.pos.x-Z)**2+(ue.pos.y-Ue)**2;Ce<z&&(z=Ce,ee={type:"taboo",id:ue.id})}E.selected=ee,Ys(ue=>ue+1);return}if(D==="TOTEM"){if(E.totems.length>=E.config.maxTotems){Kn.warning("Max totems reached");return}const z=gi,ee=qk(z),ue={id:Ql(E,"totem"),kind:z,pos:{x:Z,y:Ue},radius:.15,strength:.8,pinned:!0,bornAt:i.current.elapsed,name:ee};E.totems.push(ue);const Ce=bl("TOTEM_FOUNDED",{kind:z,name:ee},i.current.elapsed);E.chronicle.unshift(Ce),fu(T.current,{time:i.current.elapsed,type:"institution",message:`${Ce.icon} ${Ce.message}`,sigil:Ce.icon});const ze=z==="BOND"?"#5ac8fa":z==="RIFT"?"#ff6b6b":z==="ORACLE"?"#c084fc":"#94a3b8";kc(Z,Ue,`${z} placed`,ze,i.current.elapsed),Ai(i.current.elapsed,`Totem placed: ${ee} (${z})`,ze),Ys(De=>De+1);return}if(D==="TABOO"){const z=ic;let ee;if(z==="NO_MIX"){const De=new Map;for(let pt=0;pt<c.current.count;pt++)if((c.current.x[pt]-Z)**2+(c.current.y[pt]-Ue)**2<.04){const kn=c.current.type[pt];De.set(kn,(De.get(kn)||0)+1)}let ct=0;for(const[pt,on]of De)on>ct&&(ct=on,ee=pt)}const ue={id:Ql(E,"taboo"),kind:z,pos:{x:Z,y:Ue},radius:.12,intensity:.7,targetType:ee,bornAt:i.current.elapsed};E.taboos.push(ue);const Ce=bl("TABOO_DECLARED",{kind:z},i.current.elapsed);E.chronicle.unshift(Ce),fu(T.current,{time:i.current.elapsed,type:"institution",message:`${Ce.icon} ${Ce.message}`,sigil:Ce.icon});const ze=z==="NO_ENTER"?"#ef4444":"#f97316";kc(Z,Ue,`${z.replace("_"," ")} taboo`,ze,i.current.elapsed),Ai(i.current.elapsed,`Taboo declared: ${z.replace("_"," ")}`,ze),Ys(De=>De+1);return}if(D==="RITUAL"){let z=null,ee=.06;for(const ct of E.totems){const pt=(ct.pos.x-Z)**2+(ct.pos.y-Ue)**2;pt<ee&&(ee=pt,z=ct)}if(!z){Kn.warning("Click on a totem to create a ritual");return}if(E.rituals.length>=E.config.maxRituals){Kn.warning("Max rituals reached");return}const ue=E.rituals.find(ct=>ct.totemId===z.id);let Ce=Qi;if(ue){if(ue.kind===Qi){const pt=["GATHER","PROCESSION","OFFERING"],on=pt.indexOf(ue.kind);Ce=pt[(on+1)%pt.length]}ue.kind=Ce;const ct=bl("RITUAL_STARTED",{kind:Ce,totemName:z.name},i.current.elapsed);E.chronicle.unshift(ct),Ys(pt=>pt+1),Kn.success(`Ritual changed to ${Ce}`,{duration:2e3});return}const ze={id:Ql(E,"ritual"),kind:Ce,totemId:z.id,periodSec:8,dutyCycle:.4,intensity:.7,bornAt:i.current.elapsed};E.rituals.push(ze);const De=bl("RITUAL_STARTED",{kind:Ce,totemName:z.name},i.current.elapsed);E.chronicle.unshift(De),fu(T.current,{time:i.current.elapsed,type:"institution",message:`${De.icon} ${De.message}`,sigil:De.icon}),kc(z.pos.x,z.pos.y,`${Ce} ritual`,"#34d399",i.current.elapsed),Ai(i.current.elapsed,`Ritual started: ${Ce} at ${z.name}`,"#34d399"),Ys(ct=>ct+1);return}},[gi,ic,Qi]),la=Z=>{const Ue=e.current;if(!Ue)return;Z.preventDefault(),Ue.setPointerCapture(Z.pointerId);const ut=Ue.getBoundingClientRect();if(Tn.current.down=!0,Tn.current.id=Z.pointerId,Tn.current.x=Z.clientX,Tn.current.y=Z.clientY,Tn.current.prevX=Z.clientX,Tn.current.prevY=Z.clientY,Tn.current.cursorX=Z.clientX-ut.left,Tn.current.cursorY=Z.clientY-ut.top,Tn.current.shift=Z.shiftKey,Tn.current.alt=Z.altKey,yn==="sociogenesis"){const[ee,ue]=rl(Z.clientX,Z.clientY);ba(ee,ue,Z.shiftKey);return}mr?Tn.current.mode="CAPTURE":Z.altKey?Tn.current.mode="ERASE":Z.shiftKey?Tn.current.mode="SEED":Tn.current.mode=wt.toUpperCase();const[E,D]=rl(Z.clientX,Z.clientY),z=ro/Math.min(ut.width,ut.height)*2;if(Tn.current.mode==="CAPTURE"){const ee=Ps(Z.clientX-ut.left,Z.clientY-ut.top,ro),ue=FP(P.current,c.current,E,D,z,d.current.typesCount,cr,At,ee);ue?(Kn.success(`Captured: ${ue.name}`,{description:`${ue.particles.length} particles`}),me(Ce=>Ce+1)):Kn.error("No particles in capture area")}else Tn.current.mode==="PULSE"?d2(c.current,E,D,z,50*(ar/100)):Tn.current.mode==="WHITE-HOLE"?(G4(c.current,E,D,z,250*(ar/100)),Im(g.current,E,D,z*.5,500*(ar/100),0)):Tn.current.mode==="BLACK-HOLE"?(V4(c.current,E,D,z,250*(ar/100)),Im(g.current,E,D,z*.5,0,500*(ar/100))):Tn.current.mode==="WIND"?d2(c.current,E,D,z,25*(ar/100)):Tn.current.mode==="VORTEX"?U4(c.current,E,D,z,80*(ar/100)):Tn.current.mode==="FREEZE"?Y4(c.current,E,D,z,Math.min(.98,.6*(ar/100))):Tn.current.mode==="CHAOS"?K4(c.current,E,D,z,80*(ar/100)):Tn.current.mode==="QUAKE"?X4(c.current,E,D,z,80*(ar/100),i.current.elapsed):Tn.current.mode==="NOVA"?(Z4(c.current,E,D,z,500*(ar/100),un.current),un.current=un.current===0?1:0):Tn.current.mode==="MAGNETIZE"?J4(c.current,E,D,z,.4*(ar/100),yt):Tn.current.mode==="ERASE"&&q4(c.current,E,D,z,1)},Xs=Z=>{const Ue=e.current;if(!Ue)return;const ut=Ue.getBoundingClientRect();if(yn==="sociogenesis"&&(wo.current.cursorX=Z.clientX-ut.left,wo.current.cursorY=Z.clientY-ut.top),mr||Tn.current.down?(Tn.current.cursorX=Z.clientX-ut.left,Tn.current.cursorY=Z.clientY-ut.top,mr&&(Tn.current.mode="CAPTURE")):(Tn.current.cursorX=-1,Tn.current.cursorY=-1),!Tn.current.down||Tn.current.id!==Z.pointerId)return;const[E,D]=rl(Z.clientX,Z.clientY),[z,ee]=rl(Tn.current.prevX,Tn.current.prevY),ue=ro/Math.min(ut.width,ut.height)*2;if(Tn.current.mode==="WIND"){const Ce=E-z,ze=D-ee;cI(c.current,E,D,ue,Ce*500*(ar/100),ze*500*(ar/100))}else if(Tn.current.mode==="PULSE")d2(c.current,E,D,ue,50*(ar/100));else if(Tn.current.mode==="WHITE-HOLE")G4(c.current,E,D,ue,250*(ar/100)),Im(g.current,E,D,ue*.5,400*(ar/100),0);else if(Tn.current.mode==="BLACK-HOLE")V4(c.current,E,D,ue,250*(ar/100)),Im(g.current,E,D,ue*.5,0,400*(ar/100));else if(Tn.current.mode==="VORTEX")U4(c.current,E,D,ue,80*(ar/100));else if(Tn.current.mode==="FREEZE")Y4(c.current,E,D,ue,Math.min(.98,.6*(ar/100)));else if(Tn.current.mode==="CHAOS")K4(c.current,E,D,ue,80*(ar/100));else if(Tn.current.mode==="QUAKE")X4(c.current,E,D,ue,80*(ar/100),i.current.elapsed);else if(Tn.current.mode==="NOVA")Z4(c.current,E,D,ue,500*(ar/100),un.current);else if(Tn.current.mode==="MAGNETIZE")J4(c.current,E,D,ue,.25*(ar/100),yt);else if(Tn.current.mode==="SEED"){const Ce=Math.max(1,Math.floor(Ar/30));for(let ze=0;ze<Ce;ze++)$4(c.current,E+(Math.random()-.5)*ue*.5,D+(Math.random()-.5)*ue*.5,yt)}else Tn.current.mode==="ERASE"&&q4(c.current,E,D,ue,Vn*.3);Tn.current.prevX=Z.clientX,Tn.current.prevY=Z.clientY},S0=Z=>{const Ue=e.current;Ue&&Tn.current.id===Z.pointerId&&Ue.releasePointerCapture(Z.pointerId),Tn.current.down=!1,Tn.current.cursorX=-1,Tn.current.cursorY=-1},Zd=Z=>{S0(Z)},w0=w.useCallback(Z=>{var Ue;(Ue=En.current)==null||Ue.start(()=>it==="3D"?[e.current,t.current,Xn.current]:[e.current,t.current],()=>({labName:"Complexity Life Lab",lines:[`partculas: ${c.current.count}    espcies: ${d.current.typesCount}`,`qualidade: ${nr}    fps: ${Math.round(i.current.fps)}`,nn?`dna: ${Dm(nn).slice(0,28)}`:`regime: ${Ct}`]}),30,void 0,{format:(Z==null?void 0:Z.format)??"auto",quality:(Z==null?void 0:Z.quality)??"standard"})},[it,nr,nn,Ct]),C0=w.useCallback(()=>{var Z;return(Z=En.current)==null?void 0:Z.stop()},[]);return a.jsxs("div",{className:"w-full h-screen overflow-hidden flex",style:{background:el},children:[a.jsxs("div",{ref:r,className:"flex-1 relative overflow-hidden",style:{display:Rr?"none":void 0},children:[a.jsxs("div",{ref:o,className:"absolute inset-0",style:{willChange:"transform"},children:[a.jsx("canvas",{ref:e,className:"absolute inset-0 cursor-crosshair",style:{width:"100%",height:"100%",touchAction:"none"},onPointerDown:la,onPointerMove:Xs,onPointerUp:S0,onPointerCancel:Zd}),a.jsx("canvas",{ref:t,className:"absolute inset-0 pointer-events-none",style:{width:"100%",height:"100%"}}),a.jsx("canvas",{ref:Xn,className:"absolute inset-0",style:{width:"100%",height:"100%",display:it==="3D"&&yn!=="psycheLab"?"block":"none",pointerEvents:it==="3D"&&yn!=="psycheLab"?"auto":"none",cursor:"grab"}})]}),yn==="complexityLife"&&a.jsx(Pp,{state:lt,elapsed:_t,onStart:w0,onStop:C0,showOptions:!0,className:"absolute bottom-4 right-4 z-20"}),yn==="complexityLife"&&bC&&a.jsx(zJ,{lensState:G,fps:i.current.fps??60,agentCount:c.current.count,vitalRates:G.vitalRates,moduleTelemetry:G.moduleTelemetry,microConfig:{...d.current},fieldConfig:{...m.current},life:et.current,targetParticleCount:p0,onMicroChange:Z=>{Object.assign(d.current,Z)},onFieldChange:Z=>{Object.assign(m.current,Z)},onLifeChange:Z=>{K(Ue=>D2({...Ue,...Z}))},onTargetParticleCountChange:Z=>{Is.current=Z,Ks(Z)},onConfigChange:Z=>{Object.assign(L.current.feedback.config,Z),oe(Ue=>({...Ue,feedback:{...Ue.feedback,config:{...L.current.feedback.config}}}))},onResetMemory:()=>{RJ(L.current.feedback),oe(Z=>({...Z,feedback:{...Z.feedback,config:{...L.current.feedback.config},metrics:{...L.current.feedback.metrics},activations:{...L.current.feedback.activations},modulation:{...L.current.feedback.modulation},phase:L.current.feedback.phase,phaseLabel:L.current.feedback.phaseLabel}}))}}),yn==="complexityLife"&&!bC,yn==="complexityLife"&&(xe<.99||xe>1.01||Ge)&&a.jsxs("div",{className:"absolute bottom-4 left-4 z-20 flex flex-col items-start gap-1 pointer-events-auto",children:[a.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1",style:{background:"rgba(0,0,0,0.92)",border:"1px dashed rgba(255,255,255,0.06)"},children:[a.jsx("span",{className:"text-[8px] font-mono text-white/30 uppercase tracking-widest",children:"zoom"}),a.jsxs("span",{className:"text-[9px] font-mono text-cyan-300/70",children:[xe.toFixed(2),""]})]}),a.jsx("button",{onClick:()=>{at.current={zoom:1,panX:0,panY:0},o.current&&(o.current.style.transform=""),gt(1),Ye(!1)},className:"px-2 py-0.5 text-[8px] font-mono text-white/35 hover:text-white/70 transition-colors",style:{background:"rgba(0,0,0,0.85)",border:"1px dashed rgba(255,255,255,0.06)"},children:"[Home] reset"}),a.jsx("div",{className:"px-1.5 py-0.5",style:{background:"rgba(0,0,0,0.70)",border:"1px dashed rgba(255,255,255,0.04)"},children:a.jsx("span",{className:"text-[7px] font-mono text-white/18",children:"roda=zoom  rclique+drag=pan  =nav"})})]})]}),!cn&&!Rr&&a.jsxs(a.Fragment,{children:[a.jsx(wT,{running:i.current.running,speed:i.current.speed,fps:i.current.fps,trails:Gt,fieldHeatmap:fn,canUndo:YC(_.current),particleCount:c.current.count,speciesCount:d.current.typesCount,mode:yn==="sociogenesis"?wn.current.tool:Tn.current.mode,regime:Ct,circularDependency:d.current.circularDependency,dnaString:nn?Dm(nn):void 0,simQuality:nr,simMs:re,renderMs:Se,neighborsChecked:st,interactionsApplied:Tt,narrativeStatus:Te,activeLab:yn,availableLabs:Gd,adminMode:mi,onOpenAdmin:()=>Oa(!0),socioStats:yn==="sociogenesis"?{totems:wn.current.totems.length,taboos:wn.current.taboos.length,rituals:wn.current.rituals.length,tribes:wn.current.tribes.length,openCases:wn.current.cases.filter(Z=>Z.status==="OPEN").length}:void 0,onGoHome:()=>Ho(!0),onLabChange:Z=>{if(!cc(Z)){Kn.info("Tool trancada",{description:"Ative Admin Mode (morin2026) para acessar.",duration:2500}),Oa(!0);return}Vr(Z),Ho(!1);const Ue={complexityLife:["Complexity Life Lab","Particle life simulation"],sociogenesis:["Sociogenesis Tool","Place totems, declare taboos, bind rituals"],psycheLab:["Psyche Lab","Neural fields & consciousness dynamics"],musicLab:["Music Lab","Synesthetic Quanta Instrument"],alchemyLab:["Alchemy Lab","Transmutation  The Great Work"],metaArtLab:["Meta-Arte Tool","Experimental Spiritual Photoshop"],rhizomeLab:["Rhizome Lab","Heuristic-Exact  Rede rizomatica viva"],asimovTheater:["Asimov Theater","Psychohistory  Previsao por agentes complexos"],languageLab:["Language Lab","Heptapod  Linguagem no-linear viva"],physicsSandbox:["Physics Sandbox","Build Robot  Live Learning via CEM"]},[ut,E]=Ue[Z]??[Z,""];Kn.info(ut,{description:E,duration:2e3})},onTogglePlay:()=>{i.current.running=!i.current.running,me(Z=>Z+1)},onStep:()=>{var Ue,ut;d.current.dt=Kl;const Z=et.current;d.current.foodEnabled=Z.foodEnabled,d.current.foodRatio=Z.foodRatio,d.current.energyEnabled=Z.energyEnabled,d.current.energyDecay=Z.energyDecay,d.current.energyFeedRate=Z.energyFeedRate,d.current.energyReproThreshold=Z.energyReproThreshold,d.current.metamorphosisEnabled=Z.mode==="EVOLUTIVE"||Z.mode==="FULL",d.current.mutationRate=Z.mutationRate,d.current.typeStability=Z.typeStability,j.current.mutationRate=Z.reconfigRate,j.current.mutationAmount=Z.reconfigAmount,(ut=(Ue=v.current)==null?void 0:Ue.cfg)!=null&&ut.enabled?e8(c.current,d.current,h.current,(E,D)=>{const z=Df(g.current,E,D);return{tension:z.tension*m.current.influenceStrength,cohesion:z.cohesion*m.current.influenceStrength,scarcity:z.scarcity*m.current.influenceStrength}},u.current,i.current.tick,v.current):Uf(c.current,d.current,h.current,(E,D)=>{const z=Df(g.current,E,D);return{tension:z.tension*m.current.influenceStrength,cohesion:z.cohesion*m.current.influenceStrength,scarcity:z.scarcity*m.current.influenceStrength}},u.current,i.current.tick),i.current.tick++,i.current.elapsed+=Kl,me(E=>E+1)},onSetSpeed:Z=>{i.current.speed=Z,me(Ue=>Ue+1)},onReset:()=>{Ud(0)},onToggleTrails:()=>Kt(Z=>!Z),onToggleFieldHeatmap:()=>zn(Z=>!Z),fieldLayer:rt,onFieldLayerChange:Z=>mt(Z),hideUI:cn,onToggleHideUI:()=>Xt(Z=>!Z),onUndo:()=>{II(_.current,d.current,h.current,f.current,R.current)&&(Kn.info("Undone"),me(Z=>Z+1))},onOpenGuide:()=>{Oe(!1),xa.startGuide()},achievementCount:Dr.unlockedCount,onOpenAchievements:()=>gn(!0),onOpenWorldLog:()=>It(!0),onOpenChronicle:()=>Vt(!0),viewMode:it,onViewModeToggle:()=>kt(Z=>Z==="2D"?"3D":"2D")}),it==="3D"&&yn!=="psycheLab"&&a.jsx(nR,{activeLab:yn,config:On,onChange:Z=>sn(Ue=>({...Ue,...Z})),onReset:()=>sn(Td)}),!Rr&&yn==="sociogenesis"&&a.jsx(lB,{onLeave:()=>Vr("complexityLife")}),!1,!Dt&&yn==="complexityLife"&&a.jsx(HT,{microConfig:{...d.current},fieldConfig:{...m.current},reconfigConfig:{...j.current},matrix:h.current,chronicle:T.current,artifacts:R.current.artifacts,diversity:f2(c.current,d.current.typesCount),clusterCount:Xe.current.stableClusters,borderStrength:Xe.current.borderStrength,avgTension:Xe.current.avgTension,avgCohesion:Xe.current.avgCohesion,avgScarcity:Xe.current.avgScarcity,brushRadius:ro,brushStrength:ar,seedRate:Ar,eraseRate:Vn,selectedType:yt,selectedPower:wt,targetParticleCount:p0,fps:i.current.fps,particleCount:c.current.count,onBrushRadiusChange:Bn,onBrushStrengthChange:_o,onSeedRateChange:Nn,onEraseRateChange:ir,onSelectedTypeChange:Et,onSelectedPowerChange:mn,onTargetParticleCountChange:Z=>{Is.current=Z,Ks(Z)},onSaveSnapshot:El,onLoadSnapshot:v0,pointSize:Jt,fadeFactor:en,glowIntensity:Wn,paletteIndex:cr,onPointSizeChange:Qt,onFadeFactorChange:vn,onGlowIntensityChange:Gn,onPaletteIndexChange:Z=>{var ut;pr(Z);const Ue=((ut=ci[Z%ci.length])==null?void 0:ut.name)||`Paleta ${Z}`;if(Z===ci.length-1){const E=NT(At);Kn.success(`${Ue}: ${E}`,{duration:2500})}else Kn.success(Ue,{duration:1500})},trails:Gt,fieldHeatmap:fn,onToggleTrails:()=>Kt(Z=>!Z),onToggleFieldHeatmap:()=>zn(Z=>!Z),onMicroChange:Z=>{var Ue,ut,E,D;if(Z.metamorphosisEnabled!==void 0&&Z.metamorphosisEnabled!==d.current.metamorphosisEnabled&&Z.metamorphosisEnabled===!0&&Kn.success("Metamorfose Ativada",{description:"Partculas agora evoluem e mudam de tipo! Observe anis dourados ao mutar e tamanhos variando com energia.",duration:6e3}),Z.typesCount!==void 0&&Z.typesCount!==d.current.typesCount){const z=d.current.typesCount,ee=Math.max(2,Math.min(16,Z.typesCount));if(d.current.typesCount=ee,ee>z)jx(h.current,ee,u.current,d.current.rmax),jx(f.current,ee,u.current,d.current.rmax);else if(ee<z){const Ce=Mi(ee),ze=Mi(ee);for(let De=0;De<ee;De++)for(let ct=0;ct<ee;ct++)h.current.attract[De]&&h.current.attract[De][ct]!==void 0&&(Ce.attract[De][ct]=h.current.attract[De][ct],Ce.radius[De][ct]=h.current.radius[De][ct],Ce.falloff[De][ct]=((ut=(Ue=h.current.falloff)==null?void 0:Ue[De])==null?void 0:ut[ct])??1.2),f.current.attract[De]&&f.current.attract[De][ct]!==void 0&&(ze.attract[De][ct]=f.current.attract[De][ct],ze.radius[De][ct]=f.current.radius[De][ct],ze.falloff[De][ct]=((D=(E=f.current.falloff)==null?void 0:E[De])==null?void 0:D[ct])??1.2);h.current=Ce,f.current=ze}rs(h.current,f.current),d.current.circularDependency>0&&ki(h.current,d.current.circularDependency);let ue=0;for(let Ce=0;Ce<c.current.count;Ce++){const ze=c.current.type[Ce];(ze===255||ze>=0&&ze<ee)&&(ue!==Ce&&(c.current.x[ue]=c.current.x[Ce],c.current.y[ue]=c.current.y[Ce],c.current.vx[ue]=c.current.vx[Ce],c.current.vy[ue]=c.current.vy[Ce],c.current.type[ue]=c.current.type[Ce],c.current.energy[ue]=c.current.energy[Ce]),ue++)}c.current.count=ue,yt>=ee&&Et(0),Kn.success(`Archetypes: ${z}  ${ee}`),me(Ce=>Ce+1)}if(Z.circularDependency!==void 0){Object.assign(d.current,Z),rs(f.current,h.current),ki(h.current,Z.circularDependency),Z.circularDependency>0?Kn.success(`Circular Drive: ${Math.round(Z.circularDependency*100)}%`,{description:"Cyclical attraction layer applied"}):Kn.info("Circular Drive disabled",{description:"Reverted to base matrix"}),me(z=>z+1);return}Object.assign(d.current,Z),me(z=>z+1)},onFieldChange:Z=>{Object.assign(m.current,Z),me(Ue=>Ue+1)},onReconfigChange:Z=>{Object.assign(j.current,Z),me(Ue=>Ue+1)},onMatrixChange:Z=>{rs(Z,h.current),rs(h.current,f.current),d.current.circularDependency>0&&ki(h.current,d.current.circularDependency),me(Ue=>Ue+1)},onMatrixRandomize:()=>{l2(h.current,u.current,d.current.rmax),rs(h.current,f.current),d.current.circularDependency>0&&ki(h.current,d.current.circularDependency),me(Z=>Z+1)},onMatrixSoften:()=>{tI(h.current),rs(h.current,f.current),d.current.circularDependency>0&&ki(h.current,d.current.circularDependency),me(Z=>Z+1)},onMatrixSymmetrize:()=>{c2(h.current),rs(h.current,f.current),d.current.circularDependency>0&&ki(h.current,d.current.circularDependency),me(Z=>Z+1)},onMatrixInvert:()=>{nI(h.current),rs(h.current,f.current),d.current.circularDependency>0&&ki(h.current,d.current.circularDependency),me(Z=>Z+1)},onMatrixNormalize:()=>{rI(h.current),rs(h.current,f.current),d.current.circularDependency>0&&ki(h.current,d.current.circularDependency),me(Z=>Z+1)},onLoadPreset:Ud,onRandomizeAll:b0,onApplyRecipe:Vh,onNewUniverse:tl,onChaosSeed:Uh,onLoadCreativePreset:Al,renderMode:br,streakLength:or,onRenderModeChange:hr,onStreakLengthChange:uo,simQuality:nr,dotSize:fr,onSimQualityChange:Yd,onDotSizeChange:Tr,spawnPattern:rn,onSpawnPatternChange:Kd,onBackgroundClick:()=>yi(!0),showBonds:vo,bondsDistance:Jo,bondsOpacity:Na,showTrails:So,trailsLength:U,trailsOpacity:W,onShowBondsChange:Zo,onBondsDistanceChange:Ua,onBondsOpacityChange:sa,onShowTrailsChange:Oo,onTrailsLengthChange:je,onTrailsOpacityChange:X,organisms:P.current.organisms,onSpawnOrganism:Xd,onDeleteOrganism:uc,onRenameOrganism:nl,captureMode:mr,onCaptureModeChange:Gr,archetypes:le.current,microState:c.current,showSigils:Ne,onToggleSigils:()=>Ke(Z=>!Z),fieldCellCount:d.current.typesCount*d.current.typesCount,artifactCount:R.current.artifacts.length,speciesCount:d.current.typesCount,currentSeed:At,onLoadSeed:x0,stats:Ze,life:Le,onLifeChange:Ya,lifeStats:Rt,sigilConfig:we,onSigilConfigChange:Z=>Re(Ue=>({...Ue,...Z})),archetypesDetected:tt,archetypeRegistry:le.current,onClearSigils:()=>{ae.current.bond.fill(0),ae.current.rift.fill(0),ae.current.bloom.fill(0),ae.current.oath.fill(0),Kn.info(" Sigils limpos",{duration:2e3})}})]}),a.jsx(b$,{active:!Rr&&yn==="psycheLab",viewMode:it,view3DConfig:On,onView3DConfigChange:Z=>sn(Ue=>({...Ue,...Z}))}),a.jsx(Cq,{active:!Rr&&yn==="musicLab"}),a.jsx(rH,{active:!Rr&&yn==="alchemyLab"}),a.jsx(JG,{active:!Rr&&yn==="metaArtLab"}),a.jsx(uX,{active:!Rr&&yn==="rhizomeLab"}),!Rr&&yn==="asimovTheater"&&!Us&&!mi?a.jsx(iQ,{onUnlock:()=>Ml(!0)}):a.jsx(XV,{active:!Rr&&yn==="asimovTheater"&&(Us||mi)}),a.jsx(eZ,{active:!Rr&&yn==="languageLab"}),a.jsx(uJ,{resetKeys:[Rr,yn],fallbackRender:({error:Z,reset:Ue})=>Rr||yn!=="treeOfLife"?null:a.jsx("div",{style:{position:"fixed",inset:0,zIndex:500,background:"rgba(0,0,0,0.92)",color:"rgba(255,255,255,0.9)",display:"flex",alignItems:"center",justifyContent:"center",padding:24,fontFamily:"system-ui, sans-serif"},children:a.jsxs("div",{style:{width:720,maxWidth:"95vw"},children:[a.jsx("div",{style:{fontSize:16,letterSpacing:"0.08em",textTransform:"uppercase",marginBottom:10},children:"Tree of Life falhou ao carregar"}),a.jsx("div",{style:{fontSize:12,color:"rgba(255,255,255,0.7)",lineHeight:1.5},children:"O lab disparou um erro de runtime. Voc pode tentar novamente ou voltar para a Home."}),a.jsxs("div",{style:{display:"flex",gap:10,marginTop:14},children:[a.jsx("button",{onClick:()=>Ue(),style:{padding:"10px 12px",borderRadius:10,border:"1px solid rgba(255,255,255,0.18)",background:"rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.9)",cursor:"pointer"},children:"Tentar novamente"}),a.jsx("button",{onClick:()=>{Ue(),Ho(!0)},style:{padding:"10px 12px",borderRadius:10,border:"1px solid rgba(255,255,255,0.18)",background:"rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.9)",cursor:"pointer"},children:"Voltar pra Home"})]}),a.jsx("div",{style:{marginTop:16,padding:12,borderRadius:12,border:"1px dashed rgba(255,255,255,0.14)",background:"rgba(0,0,0,0.35)",fontFamily:"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace",fontSize:11,color:"rgba(255,255,255,0.75)",whiteSpace:"pre-wrap",lineHeight:1.45,maxHeight:"40vh",overflow:"auto"},children:String((Z==null?void 0:Z.stack)??(Z==null?void 0:Z.message)??Z)})]})}),children:a.jsx(SZ,{active:!Rr&&yn==="treeOfLife"})}),a.jsx(Jq,{active:!Rr&&yn==="physicsSandbox"}),a.jsx(nJ,{active:!Rr&&yn==="milPlatos"}),a.jsx(Cj,{position:"bottom-right",theme:"dark"}),a.jsx(VD,{achievement:Dr.latestAchievement,onDismiss:Dr.dismissLatest}),dn&&a.jsx(GD,{achievements:Dr.achievements,onClose:()=>gn(!1),onClearAll:()=>{Dr.clearAll()}}),$n&&a.jsx(iP,{events:$e.events,visible:$n,onClose:()=>It(!1)}),a.jsx(lP,{isOpen:Je,onClose:()=>Vt(!1),paragraphs:Ee,currentArc:_e.current.name,tone:fe,setTone:be}),Gh&&a.jsx(YD,{currentBg:el,onBgChange:Z=>{Rl(Z),yi(!1)},onClose:()=>yi(!1)}),a.jsx(XD,{targetSelector:"[data-guide-button]",show:Ve&&xa.mode==="hidden"}),!Rr&&xa.mode==="welcome"&&a.jsx(LD,{onStart:()=>{Oe(!1);const Z=th[Math.floor(Math.random()*th.length)];dc(Z,!0),xa.startGuide()},onSkip:()=>{Oe(!1),I5(),xa.skipGuide()}}),xa.mode==="active"&&xa.guideState&&a.jsx(DD,{guideState:xa.guideState,onComplete:()=>{I5(),xa.hideGuide(),Kn.success("Guide completed!",{description:"You earned all badges"})},onSkip:()=>{I5(),xa.skipGuide()}}),Rr&&a.jsx(dJ,{onEnterLab:Z=>{if(!cc(Z)){Kn.info("Tool trancada",{description:"Ative Admin Mode (morin2026) para acessar.",duration:2500}),Oa(!0);return}Vr(Z),Ho(!1)},onOpenAdmin:()=>Oa(!0),adminMode:mi}),Bd&&a.jsx(lQ,{onClose:()=>Oa(!1),onUnlock:()=>{Lh(!0);try{localStorage.setItem(CC,"1")}catch{}Oa(!1),Kn.success("Admin Mode ativado",{description:"Acesso liberado.",duration:2e3})}})]})},aA=document.getElementById("root");if(!aA)throw new Error("Root element not found");YA.createRoot(aA).render(a.jsx(Yt.StrictMode,{children:a.jsx(cQ,{})}));export{mo as R,T7 as a,a as j,E7 as p,w as r};
