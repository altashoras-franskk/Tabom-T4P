import{r as n,j as ee,R as N}from"./index-CwEvqJNo.js";import{S as te,C,F as ne,P as re,W as se,A as ce,a as oe,b as P,G as ae,c as ie,I as ue,M as le,d as fe,V as pe,B as he,L as me,e as Me}from"./three-vendor-D35H-43L.js";const de=28;function Re(m){return new C().setHSL(.6-m*.58,1,.32+m*.38)}function ye(m){const u=Math.min(m/.22,1);return new C().setHSL(.65-u*.65,1,.33+u*.28)}const we=({state:m,width:u,height:M,cameraMode:g,paused:W,showGrid:k=!0,showAxes:I=!1,showTrails:F=!0,colorMode:z="role"})=>{const v=n.useRef(null),f=n.useRef(null),H=n.useRef(null),d=n.useRef(null),w=n.useRef(new Map),j=n.useRef(new Map),b=n.useRef(new Map),X=n.useRef(0),D=n.useRef(0),Y=n.useRef(null),B=n.useRef(null),R=n.useRef({theta:0,phi:.42,r:9}),L=n.useRef(!1),S=n.useRef({x:0,y:0});n.useEffect(()=>{if(!v.current)return;const t=new te;t.background=new C(131848),t.fog=new ne(131848,.038),H.current=t;const o=new re(62,u/M,.05,200);o.position.set(0,3,9),o.lookAt(0,0,0),d.current=o;const r=new se({antialias:!0,alpha:!1});r.setSize(u,M),r.setPixelRatio(Math.min(window.devicePixelRatio,2)),r.toneMapping=ce,r.toneMappingExposure=1.3,f.current=r,v.current.appendChild(r.domElement),t.add(new oe(3162208,.7));const A=new P(54527,2.5,28);A.position.set(6,7,6),t.add(A);const a=new P(16720469,1.8,24);a.position.set(-6,4,-6),t.add(a);const c=new P(16763972,1,20);c.position.set(0,-4,8),t.add(c);const y=new P(11158783,.8,18);y.position.set(-4,8,-3),t.add(y);const e=new ae(32,32,2241348,1122867);e.position.y=-3,e.visible=k,t.add(e),Y.current=e;const s=new ie(5);return s.visible=I,t.add(s),B.current=s,()=>{var E;if(cancelAnimationFrame(X.current),f.current&&v.current)try{v.current.removeChild(f.current.domElement)}catch{}(E=f.current)==null||E.dispose(),w.current.clear(),b.current.clear()}},[]),n.useEffect(()=>{Y.current&&(Y.current.visible=k)},[k]),n.useEffect(()=>{B.current&&(B.current.visible=I)},[I]),n.useEffect(()=>{!d.current||!f.current||(d.current.aspect=u/M,d.current.updateProjectionMatrix(),f.current.setSize(u,M))},[u,M]),n.useEffect(()=>{if(!H.current||!d.current||!f.current)return;const t=()=>{X.current=requestAnimationFrame(t),W||(D.current+=.016);const o=H.current,r=d.current,A=f.current,a=R.current,c=D.current;if(g==="3d-orbital"){a.theta+=.007,a.phi=.3+Math.sin(c*.055)*.18;const e=a.r+Math.sin(c*.09)*1.8;r.position.x=e*Math.sin(a.phi)*Math.cos(a.theta),r.position.z=e*Math.sin(a.phi)*Math.sin(a.theta),r.position.y=e*Math.cos(a.phi),r.lookAt(0,0,0)}else if(g==="3d-fpp"){const e=c*.1;r.position.set(Math.cos(e)*2,.6+Math.sin(e*.6)*.4,Math.sin(e)*2),r.lookAt(Math.cos(e+1.2)*3,0,Math.sin(e+1.2)*3)}else if(g==="3d-top"){const e=c*.03;r.position.set(Math.cos(e)*.8,13,Math.sin(e)*.8),r.lookAt(0,0,0)}else if(g==="3d-side"){const e=c*.05;r.position.set(13+Math.sin(e)*2,2.5+Math.sin(e*.8)*1.2,Math.cos(e)*2),r.lookAt(0,0,0)}const y=new Set;m.quanta.forEach((e,s)=>{y.add(s);const E=e.x*5,_=e.y*5,U=(e.charge-.5)*3.5+Math.sin(e.phase*Math.PI*2+c)*.6,J=Math.sqrt(e.vx*e.vx+e.vy*e.vy);let p;z==="charge"?p=Re(e.charge):z==="velocity"?p=ye(J):p=new C(N[e.role]??"#ffffff");let l=w.current.get(s);if(!l){const i=new ue(.11,1),O=new le({color:p,emissive:p,emissiveIntensity:.55,metalness:.25,roughness:.38});l=new fe(i,O),o.add(l),w.current.set(s,l)}l.position.set(E,U,_);const G=l.material;G.color.copy(p),G.emissive.copy(p),G.emissiveIntensity=.4+e.brightness*.9+e.charge*.25+Math.sin(c*5+s*.4)*.05;const $=.65+e.charge*.85+J*1.5;if(l.scale.setScalar($),l.rotation.y=c*.55+e.phase*Math.PI*2,l.rotation.x=Math.sin(c*.35+s*.12)*.4,F){let i=j.current.get(s);if(i||(i=[],j.current.set(s,i)),i.push({x:E,y:U,z:_}),i.length>de&&i.shift(),i.length>=2){const O=i.map(x=>new pe(x.x,x.y,x.z)),K=new he().setFromPoints(O);let h=b.current.get(s);if(h)h.geometry.dispose(),h.geometry=K,h.material.color.copy(p).multiplyScalar(.65),h.material.opacity=.22+e.charge*.2;else{const x=new C(N[e.role]??"#ffffff").multiplyScalar(.7),q=new me({color:x,transparent:!0,opacity:.32});h=new Me(K,q),o.add(h),b.current.set(s,h)}}}}),w.current.forEach((e,s)=>{y.has(s)||(o.remove(e),e.geometry.dispose(),e.material.dispose(),w.current.delete(s))}),b.current.forEach((e,s)=>{(!y.has(s)||!F)&&(o.remove(e),e.geometry.dispose(),e.material.dispose(),b.current.delete(s),j.current.delete(s))}),A.render(o,r)};return t(),()=>cancelAnimationFrame(X.current)},[m,g,W,F,z]);const Q=n.useCallback(t=>{L.current=!0,S.current={x:t.clientX,y:t.clientY}},[]),T=n.useCallback(t=>{if(!L.current)return;const o=t.clientX-S.current.x,r=t.clientY-S.current.y;R.current.theta-=o*.006,R.current.phi=Math.max(.05,Math.min(Math.PI-.05,R.current.phi+r*.006)),S.current={x:t.clientX,y:t.clientY}},[]),V=n.useCallback(()=>{L.current=!1},[]),Z=n.useCallback(t=>{R.current.r=Math.max(2.5,Math.min(28,R.current.r+t.deltaY*.012))},[]);return ee.jsx("div",{ref:v,style:{width:u,height:M,position:"relative",overflow:"hidden",cursor:L.current?"grabbing":"grab"},onMouseDown:Q,onMouseMove:T,onMouseUp:V,onMouseLeave:V,onWheel:Z})};export{we as Music3DRenderer,we as default};
