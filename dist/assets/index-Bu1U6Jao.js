const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/music3DRenderer-CCQwiosw.js","assets/three-vendor-D35H-43L.js"])))=>i.map(i=>d[i]);
(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();function qk(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Q1={exports:{}},tp={},Z1={exports:{}},Zr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var B3;function pT(){if(B3)return Zr;B3=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),i=Symbol.for("react.provider"),s=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),h=Symbol.iterator;function m(V){return V===null||typeof V!="object"?null:(V=h&&V[h]||V["@@iterator"],typeof V=="function"?V:null)}var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,x={};function v(V,fe,ye){this.props=V,this.context=fe,this.refs=x,this.updater=ye||f}v.prototype.isReactComponent={},v.prototype.setState=function(V,fe){if(typeof V!="object"&&typeof V!="function"&&V!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,V,fe,"setState")},v.prototype.forceUpdate=function(V){this.updater.enqueueForceUpdate(this,V,"forceUpdate")};function b(){}b.prototype=v.prototype;function w(V,fe,ye){this.props=V,this.context=fe,this.refs=x,this.updater=ye||f}var M=w.prototype=new b;M.constructor=w,g(M,v.prototype),M.isPureReactComponent=!0;var k=Array.isArray,R=Object.prototype.hasOwnProperty,j={current:null},I={key:!0,ref:!0,__self:!0,__source:!0};function E(V,fe,ye){var Se,we={},ke=null,De=null;if(fe!=null)for(Se in fe.ref!==void 0&&(De=fe.ref),fe.key!==void 0&&(ke=""+fe.key),fe)R.call(fe,Se)&&!I.hasOwnProperty(Se)&&(we[Se]=fe[Se]);var _e=arguments.length-2;if(_e===1)we.children=ye;else if(1<_e){for(var ae=Array(_e),Re=0;Re<_e;Re++)ae[Re]=arguments[Re+2];we.children=ae}if(V&&V.defaultProps)for(Se in _e=V.defaultProps,_e)we[Se]===void 0&&(we[Se]=_e[Se]);return{$$typeof:e,type:V,key:ke,ref:De,props:we,_owner:j.current}}function O(V,fe){return{$$typeof:e,type:V.type,key:fe,ref:V.ref,props:V.props,_owner:V._owner}}function L(V){return typeof V=="object"&&V!==null&&V.$$typeof===e}function $(V){var fe={"=":"=0",":":"=2"};return"$"+V.replace(/[=:]/g,function(ye){return fe[ye]})}var F=/\/+/g;function B(V,fe){return typeof V=="object"&&V!==null&&V.key!=null?$(""+V.key):fe.toString(36)}function W(V,fe,ye,Se,we){var ke=typeof V;(ke==="undefined"||ke==="boolean")&&(V=null);var De=!1;if(V===null)De=!0;else switch(ke){case"string":case"number":De=!0;break;case"object":switch(V.$$typeof){case e:case t:De=!0}}if(De)return De=V,we=we(De),V=Se===""?"."+B(De,0):Se,k(we)?(ye="",V!=null&&(ye=V.replace(F,"$&/")+"/"),W(we,fe,ye,"",function(Re){return Re})):we!=null&&(L(we)&&(we=O(we,ye+(!we.key||De&&De.key===we.key?"":(""+we.key).replace(F,"$&/")+"/")+V)),fe.push(we)),1;if(De=0,Se=Se===""?".":Se+":",k(V))for(var _e=0;_e<V.length;_e++){ke=V[_e];var ae=Se+B(ke,_e);De+=W(ke,fe,ye,ae,we)}else if(ae=m(V),typeof ae=="function")for(V=ae.call(V),_e=0;!(ke=V.next()).done;)ke=ke.value,ae=Se+B(ke,_e++),De+=W(ke,fe,ye,ae,we);else if(ke==="object")throw fe=String(V),Error("Objects are not valid as a React child (found: "+(fe==="[object Object]"?"object with keys {"+Object.keys(V).join(", ")+"}":fe)+"). If you meant to render a collection of children, use an array instead.");return De}function re(V,fe,ye){if(V==null)return V;var Se=[],we=0;return W(V,Se,"","",function(ke){return fe.call(ye,ke,we++)}),Se}function oe(V){if(V._status===-1){var fe=V._result;fe=fe(),fe.then(function(ye){(V._status===0||V._status===-1)&&(V._status=1,V._result=ye)},function(ye){(V._status===0||V._status===-1)&&(V._status=2,V._result=ye)}),V._status===-1&&(V._status=0,V._result=fe)}if(V._status===1)return V._result.default;throw V._result}var te={current:null},J={transition:null},pe={ReactCurrentDispatcher:te,ReactCurrentBatchConfig:J,ReactCurrentOwner:j};function P(){throw Error("act(...) is not supported in production builds of React.")}return Zr.Children={map:re,forEach:function(V,fe,ye){re(V,function(){fe.apply(this,arguments)},ye)},count:function(V){var fe=0;return re(V,function(){fe++}),fe},toArray:function(V){return re(V,function(fe){return fe})||[]},only:function(V){if(!L(V))throw Error("React.Children.only expected to receive a single React element child.");return V}},Zr.Component=v,Zr.Fragment=n,Zr.Profiler=a,Zr.PureComponent=w,Zr.StrictMode=r,Zr.Suspense=l,Zr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=pe,Zr.act=P,Zr.cloneElement=function(V,fe,ye){if(V==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+V+".");var Se=g({},V.props),we=V.key,ke=V.ref,De=V._owner;if(fe!=null){if(fe.ref!==void 0&&(ke=fe.ref,De=j.current),fe.key!==void 0&&(we=""+fe.key),V.type&&V.type.defaultProps)var _e=V.type.defaultProps;for(ae in fe)R.call(fe,ae)&&!I.hasOwnProperty(ae)&&(Se[ae]=fe[ae]===void 0&&_e!==void 0?_e[ae]:fe[ae])}var ae=arguments.length-2;if(ae===1)Se.children=ye;else if(1<ae){_e=Array(ae);for(var Re=0;Re<ae;Re++)_e[Re]=arguments[Re+2];Se.children=_e}return{$$typeof:e,type:V.type,key:we,ref:ke,props:Se,_owner:De}},Zr.createContext=function(V){return V={$$typeof:s,_currentValue:V,_currentValue2:V,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},V.Provider={$$typeof:i,_context:V},V.Consumer=V},Zr.createElement=E,Zr.createFactory=function(V){var fe=E.bind(null,V);return fe.type=V,fe},Zr.createRef=function(){return{current:null}},Zr.forwardRef=function(V){return{$$typeof:c,render:V}},Zr.isValidElement=L,Zr.lazy=function(V){return{$$typeof:u,_payload:{_status:-1,_result:V},_init:oe}},Zr.memo=function(V,fe){return{$$typeof:d,type:V,compare:fe===void 0?null:fe}},Zr.startTransition=function(V){var fe=J.transition;J.transition={};try{V()}finally{J.transition=fe}},Zr.unstable_act=P,Zr.useCallback=function(V,fe){return te.current.useCallback(V,fe)},Zr.useContext=function(V){return te.current.useContext(V)},Zr.useDebugValue=function(){},Zr.useDeferredValue=function(V){return te.current.useDeferredValue(V)},Zr.useEffect=function(V,fe){return te.current.useEffect(V,fe)},Zr.useId=function(){return te.current.useId()},Zr.useImperativeHandle=function(V,fe,ye){return te.current.useImperativeHandle(V,fe,ye)},Zr.useInsertionEffect=function(V,fe){return te.current.useInsertionEffect(V,fe)},Zr.useLayoutEffect=function(V,fe){return te.current.useLayoutEffect(V,fe)},Zr.useMemo=function(V,fe){return te.current.useMemo(V,fe)},Zr.useReducer=function(V,fe,ye){return te.current.useReducer(V,fe,ye)},Zr.useRef=function(V){return te.current.useRef(V)},Zr.useState=function(V){return te.current.useState(V)},Zr.useSyncExternalStore=function(V,fe,ye){return te.current.useSyncExternalStore(V,fe,ye)},Zr.useTransition=function(){return te.current.useTransition()},Zr.version="18.3.1",Zr}var $3;function tS(){return $3||($3=1,Z1.exports=pT()),Z1.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var q3;function mT(){if(q3)return tp;q3=1;var e=tS(),t=Symbol.for("react.element"),n=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,a=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function s(c,l,d){var u,h={},m=null,f=null;d!==void 0&&(m=""+d),l.key!==void 0&&(m=""+l.key),l.ref!==void 0&&(f=l.ref);for(u in l)r.call(l,u)&&!i.hasOwnProperty(u)&&(h[u]=l[u]);if(c&&c.defaultProps)for(u in l=c.defaultProps,l)h[u]===void 0&&(h[u]=l[u]);return{$$typeof:t,type:c,key:m,ref:f,props:h,_owner:a.current}}return tp.Fragment=n,tp.jsx=s,tp.jsxs=s,tp}var H3;function gT(){return H3||(H3=1,Q1.exports=mT()),Q1.exports}var o=gT(),S=tS();const on=qk(S);var dg={},e2={exports:{}},Ri={},t2={exports:{}},n2={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var W3;function yT(){return W3||(W3=1,(function(e){function t(J,pe){var P=J.length;J.push(pe);e:for(;0<P;){var V=P-1>>>1,fe=J[V];if(0<a(fe,pe))J[V]=pe,J[P]=fe,P=V;else break e}}function n(J){return J.length===0?null:J[0]}function r(J){if(J.length===0)return null;var pe=J[0],P=J.pop();if(P!==pe){J[0]=P;e:for(var V=0,fe=J.length,ye=fe>>>1;V<ye;){var Se=2*(V+1)-1,we=J[Se],ke=Se+1,De=J[ke];if(0>a(we,P))ke<fe&&0>a(De,we)?(J[V]=De,J[ke]=P,V=ke):(J[V]=we,J[Se]=P,V=Se);else if(ke<fe&&0>a(De,P))J[V]=De,J[ke]=P,V=ke;else break e}}return pe}function a(J,pe){var P=J.sortIndex-pe.sortIndex;return P!==0?P:J.id-pe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var s=Date,c=s.now();e.unstable_now=function(){return s.now()-c}}var l=[],d=[],u=1,h=null,m=3,f=!1,g=!1,x=!1,v=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function M(J){for(var pe=n(d);pe!==null;){if(pe.callback===null)r(d);else if(pe.startTime<=J)r(d),pe.sortIndex=pe.expirationTime,t(l,pe);else break;pe=n(d)}}function k(J){if(x=!1,M(J),!g)if(n(l)!==null)g=!0,oe(R);else{var pe=n(d);pe!==null&&te(k,pe.startTime-J)}}function R(J,pe){g=!1,x&&(x=!1,b(E),E=-1),f=!0;var P=m;try{for(M(pe),h=n(l);h!==null&&(!(h.expirationTime>pe)||J&&!$());){var V=h.callback;if(typeof V=="function"){h.callback=null,m=h.priorityLevel;var fe=V(h.expirationTime<=pe);pe=e.unstable_now(),typeof fe=="function"?h.callback=fe:h===n(l)&&r(l),M(pe)}else r(l);h=n(l)}if(h!==null)var ye=!0;else{var Se=n(d);Se!==null&&te(k,Se.startTime-pe),ye=!1}return ye}finally{h=null,m=P,f=!1}}var j=!1,I=null,E=-1,O=5,L=-1;function $(){return!(e.unstable_now()-L<O)}function F(){if(I!==null){var J=e.unstable_now();L=J;var pe=!0;try{pe=I(!0,J)}finally{pe?B():(j=!1,I=null)}}else j=!1}var B;if(typeof w=="function")B=function(){w(F)};else if(typeof MessageChannel<"u"){var W=new MessageChannel,re=W.port2;W.port1.onmessage=F,B=function(){re.postMessage(null)}}else B=function(){v(F,0)};function oe(J){I=J,j||(j=!0,B())}function te(J,pe){E=v(function(){J(e.unstable_now())},pe)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(J){J.callback=null},e.unstable_continueExecution=function(){g||f||(g=!0,oe(R))},e.unstable_forceFrameRate=function(J){0>J||125<J?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<J?Math.floor(1e3/J):5},e.unstable_getCurrentPriorityLevel=function(){return m},e.unstable_getFirstCallbackNode=function(){return n(l)},e.unstable_next=function(J){switch(m){case 1:case 2:case 3:var pe=3;break;default:pe=m}var P=m;m=pe;try{return J()}finally{m=P}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(J,pe){switch(J){case 1:case 2:case 3:case 4:case 5:break;default:J=3}var P=m;m=J;try{return pe()}finally{m=P}},e.unstable_scheduleCallback=function(J,pe,P){var V=e.unstable_now();switch(typeof P=="object"&&P!==null?(P=P.delay,P=typeof P=="number"&&0<P?V+P:V):P=V,J){case 1:var fe=-1;break;case 2:fe=250;break;case 5:fe=1073741823;break;case 4:fe=1e4;break;default:fe=5e3}return fe=P+fe,J={id:u++,callback:pe,priorityLevel:J,startTime:P,expirationTime:fe,sortIndex:-1},P>V?(J.sortIndex=P,t(d,J),n(l)===null&&J===n(d)&&(x?(b(E),E=-1):x=!0,te(k,P-V))):(J.sortIndex=fe,t(l,J),g||f||(g=!0,oe(R))),J},e.unstable_shouldYield=$,e.unstable_wrapCallback=function(J){var pe=m;return function(){var P=m;m=pe;try{return J.apply(this,arguments)}finally{m=P}}}})(n2)),n2}var G3;function bT(){return G3||(G3=1,t2.exports=yT()),t2.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var V3;function xT(){if(V3)return Ri;V3=1;var e=tS(),t=bT();function n(p){for(var y="https://reactjs.org/docs/error-decoder.html?invariant="+p,C=1;C<arguments.length;C++)y+="&args[]="+encodeURIComponent(arguments[C]);return"Minified React error #"+p+"; visit "+y+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,a={};function i(p,y){s(p,y),s(p+"Capture",y)}function s(p,y){for(a[p]=y,p=0;p<y.length;p++)r.add(y[p])}var c=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,u={},h={};function m(p){return l.call(h,p)?!0:l.call(u,p)?!1:d.test(p)?h[p]=!0:(u[p]=!0,!1)}function f(p,y,C,A){if(C!==null&&C.type===0)return!1;switch(typeof y){case"function":case"symbol":return!0;case"boolean":return A?!1:C!==null?!C.acceptsBooleans:(p=p.toLowerCase().slice(0,5),p!=="data-"&&p!=="aria-");default:return!1}}function g(p,y,C,A){if(y===null||typeof y>"u"||f(p,y,C,A))return!0;if(A)return!1;if(C!==null)switch(C.type){case 3:return!y;case 4:return y===!1;case 5:return isNaN(y);case 6:return isNaN(y)||1>y}return!1}function x(p,y,C,A,N,z,Q){this.acceptsBooleans=y===2||y===3||y===4,this.attributeName=A,this.attributeNamespace=N,this.mustUseProperty=C,this.propertyName=p,this.type=y,this.sanitizeURL=z,this.removeEmptyString=Q}var v={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(p){v[p]=new x(p,0,!1,p,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(p){var y=p[0];v[y]=new x(y,1,!1,p[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(p){v[p]=new x(p,2,!1,p.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(p){v[p]=new x(p,2,!1,p,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(p){v[p]=new x(p,3,!1,p.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(p){v[p]=new x(p,3,!0,p,null,!1,!1)}),["capture","download"].forEach(function(p){v[p]=new x(p,4,!1,p,null,!1,!1)}),["cols","rows","size","span"].forEach(function(p){v[p]=new x(p,6,!1,p,null,!1,!1)}),["rowSpan","start"].forEach(function(p){v[p]=new x(p,5,!1,p.toLowerCase(),null,!1,!1)});var b=/[\-:]([a-z])/g;function w(p){return p[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(p){var y=p.replace(b,w);v[y]=new x(y,1,!1,p,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(p){var y=p.replace(b,w);v[y]=new x(y,1,!1,p,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(p){var y=p.replace(b,w);v[y]=new x(y,1,!1,p,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(p){v[p]=new x(p,1,!1,p.toLowerCase(),null,!1,!1)}),v.xlinkHref=new x("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(p){v[p]=new x(p,1,!1,p.toLowerCase(),null,!0,!0)});function M(p,y,C,A){var N=v.hasOwnProperty(y)?v[y]:null;(N!==null?N.type!==0:A||!(2<y.length)||y[0]!=="o"&&y[0]!=="O"||y[1]!=="n"&&y[1]!=="N")&&(g(y,C,N,A)&&(C=null),A||N===null?m(y)&&(C===null?p.removeAttribute(y):p.setAttribute(y,""+C)):N.mustUseProperty?p[N.propertyName]=C===null?N.type===3?!1:"":C:(y=N.attributeName,A=N.attributeNamespace,C===null?p.removeAttribute(y):(N=N.type,C=N===3||N===4&&C===!0?"":""+C,A?p.setAttributeNS(A,y,C):p.setAttribute(y,C))))}var k=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,R=Symbol.for("react.element"),j=Symbol.for("react.portal"),I=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),O=Symbol.for("react.profiler"),L=Symbol.for("react.provider"),$=Symbol.for("react.context"),F=Symbol.for("react.forward_ref"),B=Symbol.for("react.suspense"),W=Symbol.for("react.suspense_list"),re=Symbol.for("react.memo"),oe=Symbol.for("react.lazy"),te=Symbol.for("react.offscreen"),J=Symbol.iterator;function pe(p){return p===null||typeof p!="object"?null:(p=J&&p[J]||p["@@iterator"],typeof p=="function"?p:null)}var P=Object.assign,V;function fe(p){if(V===void 0)try{throw Error()}catch(C){var y=C.stack.trim().match(/\n( *(at )?)/);V=y&&y[1]||""}return`
`+V+p}var ye=!1;function Se(p,y){if(!p||ye)return"";ye=!0;var C=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(y)if(y=function(){throw Error()},Object.defineProperty(y.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(y,[])}catch(gt){var A=gt}Reflect.construct(p,[],y)}else{try{y.call()}catch(gt){A=gt}p.call(y.prototype)}else{try{throw Error()}catch(gt){A=gt}p()}}catch(gt){if(gt&&A&&typeof gt.stack=="string"){for(var N=gt.stack.split(`
`),z=A.stack.split(`
`),Q=N.length-1,Ce=z.length-1;1<=Q&&0<=Ce&&N[Q]!==z[Ce];)Ce--;for(;1<=Q&&0<=Ce;Q--,Ce--)if(N[Q]!==z[Ce]){if(Q!==1||Ce!==1)do if(Q--,Ce--,0>Ce||N[Q]!==z[Ce]){var Ne=`
`+N[Q].replace(" at new "," at ");return p.displayName&&Ne.includes("<anonymous>")&&(Ne=Ne.replace("<anonymous>",p.displayName)),Ne}while(1<=Q&&0<=Ce);break}}}finally{ye=!1,Error.prepareStackTrace=C}return(p=p?p.displayName||p.name:"")?fe(p):""}function we(p){switch(p.tag){case 5:return fe(p.type);case 16:return fe("Lazy");case 13:return fe("Suspense");case 19:return fe("SuspenseList");case 0:case 2:case 15:return p=Se(p.type,!1),p;case 11:return p=Se(p.type.render,!1),p;case 1:return p=Se(p.type,!0),p;default:return""}}function ke(p){if(p==null)return null;if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case I:return"Fragment";case j:return"Portal";case O:return"Profiler";case E:return"StrictMode";case B:return"Suspense";case W:return"SuspenseList"}if(typeof p=="object")switch(p.$$typeof){case $:return(p.displayName||"Context")+".Consumer";case L:return(p._context.displayName||"Context")+".Provider";case F:var y=p.render;return p=p.displayName,p||(p=y.displayName||y.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case re:return y=p.displayName||null,y!==null?y:ke(p.type)||"Memo";case oe:y=p._payload,p=p._init;try{return ke(p(y))}catch{}}return null}function De(p){var y=p.type;switch(p.tag){case 24:return"Cache";case 9:return(y.displayName||"Context")+".Consumer";case 10:return(y._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return p=y.render,p=p.displayName||p.name||"",y.displayName||(p!==""?"ForwardRef("+p+")":"ForwardRef");case 7:return"Fragment";case 5:return y;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ke(y);case 8:return y===E?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof y=="function")return y.displayName||y.name||null;if(typeof y=="string")return y}return null}function _e(p){switch(typeof p){case"boolean":case"number":case"string":case"undefined":return p;case"object":return p;default:return""}}function ae(p){var y=p.type;return(p=p.nodeName)&&p.toLowerCase()==="input"&&(y==="checkbox"||y==="radio")}function Re(p){var y=ae(p)?"checked":"value",C=Object.getOwnPropertyDescriptor(p.constructor.prototype,y),A=""+p[y];if(!p.hasOwnProperty(y)&&typeof C<"u"&&typeof C.get=="function"&&typeof C.set=="function"){var N=C.get,z=C.set;return Object.defineProperty(p,y,{configurable:!0,get:function(){return N.call(this)},set:function(Q){A=""+Q,z.call(this,Q)}}),Object.defineProperty(p,y,{enumerable:C.enumerable}),{getValue:function(){return A},setValue:function(Q){A=""+Q},stopTracking:function(){p._valueTracker=null,delete p[y]}}}}function Fe(p){p._valueTracker||(p._valueTracker=Re(p))}function Oe(p){if(!p)return!1;var y=p._valueTracker;if(!y)return!0;var C=y.getValue(),A="";return p&&(A=ae(p)?p.checked?"true":"false":p.value),p=A,p!==C?(y.setValue(p),!0):!1}function ne(p){if(p=p||(typeof document<"u"?document:void 0),typeof p>"u")return null;try{return p.activeElement||p.body}catch{return p.body}}function nt(p,y){var C=y.checked;return P({},y,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:C??p._wrapperState.initialChecked})}function pt(p,y){var C=y.defaultValue==null?"":y.defaultValue,A=y.checked!=null?y.checked:y.defaultChecked;C=_e(y.value!=null?y.value:C),p._wrapperState={initialChecked:A,initialValue:C,controlled:y.type==="checkbox"||y.type==="radio"?y.checked!=null:y.value!=null}}function Et(p,y){y=y.checked,y!=null&&M(p,"checked",y,!1)}function _t(p,y){Et(p,y);var C=_e(y.value),A=y.type;if(C!=null)A==="number"?(C===0&&p.value===""||p.value!=C)&&(p.value=""+C):p.value!==""+C&&(p.value=""+C);else if(A==="submit"||A==="reset"){p.removeAttribute("value");return}y.hasOwnProperty("value")?Xe(p,y.type,C):y.hasOwnProperty("defaultValue")&&Xe(p,y.type,_e(y.defaultValue)),y.checked==null&&y.defaultChecked!=null&&(p.defaultChecked=!!y.defaultChecked)}function Ct(p,y,C){if(y.hasOwnProperty("value")||y.hasOwnProperty("defaultValue")){var A=y.type;if(!(A!=="submit"&&A!=="reset"||y.value!==void 0&&y.value!==null))return;y=""+p._wrapperState.initialValue,C||y===p.value||(p.value=y),p.defaultValue=y}C=p.name,C!==""&&(p.name=""),p.defaultChecked=!!p._wrapperState.initialChecked,C!==""&&(p.name=C)}function Xe(p,y,C){(y!=="number"||ne(p.ownerDocument)!==p)&&(C==null?p.defaultValue=""+p._wrapperState.initialValue:p.defaultValue!==""+C&&(p.defaultValue=""+C))}var Ut=Array.isArray;function Le(p,y,C,A){if(p=p.options,y){y={};for(var N=0;N<C.length;N++)y["$"+C[N]]=!0;for(C=0;C<p.length;C++)N=y.hasOwnProperty("$"+p[C].value),p[C].selected!==N&&(p[C].selected=N),N&&A&&(p[C].defaultSelected=!0)}else{for(C=""+_e(C),y=null,N=0;N<p.length;N++){if(p[N].value===C){p[N].selected=!0,A&&(p[N].defaultSelected=!0);return}y!==null||p[N].disabled||(y=p[N])}y!==null&&(y.selected=!0)}}function Ke(p,y){if(y.dangerouslySetInnerHTML!=null)throw Error(n(91));return P({},y,{value:void 0,defaultValue:void 0,children:""+p._wrapperState.initialValue})}function mt(p,y){var C=y.value;if(C==null){if(C=y.children,y=y.defaultValue,C!=null){if(y!=null)throw Error(n(92));if(Ut(C)){if(1<C.length)throw Error(n(93));C=C[0]}y=C}y==null&&(y=""),C=y}p._wrapperState={initialValue:_e(C)}}function an(p,y){var C=_e(y.value),A=_e(y.defaultValue);C!=null&&(C=""+C,C!==p.value&&(p.value=C),y.defaultValue==null&&p.defaultValue!==C&&(p.defaultValue=C)),A!=null&&(p.defaultValue=""+A)}function gn(p){var y=p.textContent;y===p._wrapperState.initialValue&&y!==""&&y!==null&&(p.value=y)}function Be(p){switch(p){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ft(p,y){return p==null||p==="http://www.w3.org/1999/xhtml"?Be(y):p==="http://www.w3.org/2000/svg"&&y==="foreignObject"?"http://www.w3.org/1999/xhtml":p}var Qt,nr=(function(p){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(y,C,A,N){MSApp.execUnsafeLocalFunction(function(){return p(y,C,A,N)})}:p})(function(p,y){if(p.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in p)p.innerHTML=y;else{for(Qt=Qt||document.createElement("div"),Qt.innerHTML="<svg>"+y.valueOf().toString()+"</svg>",y=Qt.firstChild;p.firstChild;)p.removeChild(p.firstChild);for(;y.firstChild;)p.appendChild(y.firstChild)}});function _n(p,y){if(y){var C=p.firstChild;if(C&&C===p.lastChild&&C.nodeType===3){C.nodeValue=y;return}}p.textContent=y}var Rn={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},sn=["Webkit","ms","Moz","O"];Object.keys(Rn).forEach(function(p){sn.forEach(function(y){y=y+p.charAt(0).toUpperCase()+p.substring(1),Rn[y]=Rn[p]})});function Cn(p,y,C){return y==null||typeof y=="boolean"||y===""?"":C||typeof y!="number"||y===0||Rn.hasOwnProperty(p)&&Rn[p]?(""+y).trim():y+"px"}function wt(p,y){p=p.style;for(var C in y)if(y.hasOwnProperty(C)){var A=C.indexOf("--")===0,N=Cn(C,y[C],A);C==="float"&&(C="cssFloat"),A?p.setProperty(C,N):p[C]=N}}var st=P({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Zt(p,y){if(y){if(st[p]&&(y.children!=null||y.dangerouslySetInnerHTML!=null))throw Error(n(137,p));if(y.dangerouslySetInnerHTML!=null){if(y.children!=null)throw Error(n(60));if(typeof y.dangerouslySetInnerHTML!="object"||!("__html"in y.dangerouslySetInnerHTML))throw Error(n(61))}if(y.style!=null&&typeof y.style!="object")throw Error(n(62))}}function Pe(p,y){if(p.indexOf("-")===-1)return typeof y.is=="string";switch(p){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ct=null;function vt(p){return p=p.target||p.srcElement||window,p.correspondingUseElement&&(p=p.correspondingUseElement),p.nodeType===3?p.parentNode:p}var xe=null,ge=null,Ee=null;function me(p){if(p=dt(p)){if(typeof xe!="function")throw Error(n(280));var y=p.stateNode;y&&(y=Yt(y),xe(p.stateNode,p.type,y))}}function je(p){ge?Ee?Ee.push(p):Ee=[p]:ge=p}function Te(){if(ge){var p=ge,y=Ee;if(Ee=ge=null,me(p),y)for(p=0;p<y.length;p++)me(y[p])}}function Ae(p,y){return p(y)}function Tt(){}var xt=!1;function en(p,y,C){if(xt)return p(y,C);xt=!0;try{return Ae(p,y,C)}finally{xt=!1,(ge!==null||Ee!==null)&&(Tt(),Te())}}function At(p,y){var C=p.stateNode;if(C===null)return null;var A=Yt(C);if(A===null)return null;C=A[y];e:switch(y){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(A=!A.disabled)||(p=p.type,A=!(p==="button"||p==="input"||p==="select"||p==="textarea")),p=!A;break e;default:p=!1}if(p)return null;if(C&&typeof C!="function")throw Error(n(231,y,typeof C));return C}var Ze=!1;if(c)try{var yt={};Object.defineProperty(yt,"passive",{get:function(){Ze=!0}}),window.addEventListener("test",yt,yt),window.removeEventListener("test",yt,yt)}catch{Ze=!1}function Mt(p,y,C,A,N,z,Q,Ce,Ne){var gt=Array.prototype.slice.call(arguments,3);try{y.apply(C,gt)}catch(Kt){this.onError(Kt)}}var bn=!1,Pt=null,An=!1,cr=null,Tn={onError:function(p){bn=!0,Pt=p}};function Sr(p,y,C,A,N,z,Q,Ce,Ne){bn=!1,Pt=null,Mt.apply(Tn,arguments)}function de(p,y,C,A,N,z,Q,Ce,Ne){if(Sr.apply(this,arguments),bn){if(bn){var gt=Pt;bn=!1,Pt=null}else throw Error(n(198));An||(An=!0,cr=gt)}}function $e(p){var y=p,C=p;if(p.alternate)for(;y.return;)y=y.return;else{p=y;do y=p,(y.flags&4098)!==0&&(C=y.return),p=y.return;while(p)}return y.tag===3?C:null}function et(p){if(p.tag===13){var y=p.memoizedState;if(y===null&&(p=p.alternate,p!==null&&(y=p.memoizedState)),y!==null)return y.dehydrated}return null}function zt(p){if($e(p)!==p)throw Error(n(188))}function Nt(p){var y=p.alternate;if(!y){if(y=$e(p),y===null)throw Error(n(188));return y!==p?null:p}for(var C=p,A=y;;){var N=C.return;if(N===null)break;var z=N.alternate;if(z===null){if(A=N.return,A!==null){C=A;continue}break}if(N.child===z.child){for(z=N.child;z;){if(z===C)return zt(N),p;if(z===A)return zt(N),y;z=z.sibling}throw Error(n(188))}if(C.return!==A.return)C=N,A=z;else{for(var Q=!1,Ce=N.child;Ce;){if(Ce===C){Q=!0,C=N,A=z;break}if(Ce===A){Q=!0,A=N,C=z;break}Ce=Ce.sibling}if(!Q){for(Ce=z.child;Ce;){if(Ce===C){Q=!0,C=z,A=N;break}if(Ce===A){Q=!0,A=z,C=N;break}Ce=Ce.sibling}if(!Q)throw Error(n(189))}}if(C.alternate!==A)throw Error(n(190))}if(C.tag!==3)throw Error(n(188));return C.stateNode.current===C?p:y}function ln(p){return p=Nt(p),p!==null?Rt(p):null}function Rt(p){if(p.tag===5||p.tag===6)return p;for(p=p.child;p!==null;){var y=Rt(p);if(y!==null)return y;p=p.sibling}return null}var Nn=t.unstable_scheduleCallback,It=t.unstable_cancelCallback,xn=t.unstable_shouldYield,Ln=t.unstable_requestPaint,zn=t.unstable_now,Or=t.unstable_getCurrentPriorityLevel,wr=t.unstable_ImmediatePriority,vn=t.unstable_UserBlockingPriority,Gr=t.unstable_NormalPriority,hn=t.unstable_LowPriority,jr=t.unstable_IdlePriority,_r=null,Zn=null;function lo(p){if(Zn&&typeof Zn.onCommitFiberRoot=="function")try{Zn.onCommitFiberRoot(_r,p,void 0,(p.current.flags&128)===128)}catch{}}var ir=Math.clz32?Math.clz32:Eo,to=Math.log,Er=Math.LN2;function Eo(p){return p>>>=0,p===0?32:31-(to(p)/Er|0)|0}var oa=64,ja=4194304;function Co(p){switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return p&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return p}}function Ya(p,y){var C=p.pendingLanes;if(C===0)return 0;var A=0,N=p.suspendedLanes,z=p.pingedLanes,Q=C&268435455;if(Q!==0){var Ce=Q&~N;Ce!==0?A=Co(Ce):(z&=Q,z!==0&&(A=Co(z)))}else Q=C&~N,Q!==0?A=Co(Q):z!==0&&(A=Co(z));if(A===0)return 0;if(y!==0&&y!==A&&(y&N)===0&&(N=A&-A,z=y&-y,N>=z||N===16&&(z&4194240)!==0))return y;if((A&4)!==0&&(A|=C&16),y=p.entangledLanes,y!==0)for(p=p.entanglements,y&=A;0<y;)C=31-ir(y),N=1<<C,A|=p[C],y&=~N;return A}function qo(p,y){switch(p){case 1:case 2:case 4:return y+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return y+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function os(p,y){for(var C=p.suspendedLanes,A=p.pingedLanes,N=p.expirationTimes,z=p.pendingLanes;0<z;){var Q=31-ir(z),Ce=1<<Q,Ne=N[Q];Ne===-1?((Ce&C)===0||(Ce&A)!==0)&&(N[Q]=qo(Ce,y)):Ne<=y&&(p.expiredLanes|=Ce),z&=~Ce}}function Ho(p){return p=p.pendingLanes&-1073741825,p!==0?p:p&1073741824?1073741824:0}function fs(){var p=oa;return oa<<=1,(oa&4194240)===0&&(oa=64),p}function To(p){for(var y=[],C=0;31>C;C++)y.push(p);return y}function Xo(p,y,C){p.pendingLanes|=y,y!==536870912&&(p.suspendedLanes=0,p.pingedLanes=0),p=p.eventTimes,y=31-ir(y),p[y]=C}function ks(p,y){var C=p.pendingLanes&~y;p.pendingLanes=y,p.suspendedLanes=0,p.pingedLanes=0,p.expiredLanes&=y,p.mutableReadLanes&=y,p.entangledLanes&=y,y=p.entanglements;var A=p.eventTimes;for(p=p.expirationTimes;0<C;){var N=31-ir(C),z=1<<N;y[N]=0,A[N]=-1,p[N]=-1,C&=~z}}function D(p,y){var C=p.entangledLanes|=y;for(p=p.entanglements;C;){var A=31-ir(C),N=1<<A;N&y|p[A]&y&&(p[A]|=y),C&=~N}}var ee=0;function Ie(p){return p&=-p,1<p?4<p?(p&268435455)!==0?16:536870912:4:1}var Qe,X,Z,ce,ue,be=!1,H=[],le=null,Je=null,tt=null,St=new Map,$t=new Map,rt=[],Ft="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Xt(p,y){switch(p){case"focusin":case"focusout":le=null;break;case"dragenter":case"dragleave":Je=null;break;case"mouseover":case"mouseout":tt=null;break;case"pointerover":case"pointerout":St.delete(y.pointerId);break;case"gotpointercapture":case"lostpointercapture":$t.delete(y.pointerId)}}function dn(p,y,C,A,N,z){return p===null||p.nativeEvent!==z?(p={blockedOn:y,domEventName:C,eventSystemFlags:A,nativeEvent:z,targetContainers:[N]},y!==null&&(y=dt(y),y!==null&&X(y)),p):(p.eventSystemFlags|=A,y=p.targetContainers,N!==null&&y.indexOf(N)===-1&&y.push(N),p)}function kn(p,y,C,A,N){switch(y){case"focusin":return le=dn(le,p,y,C,A,N),!0;case"dragenter":return Je=dn(Je,p,y,C,A,N),!0;case"mouseover":return tt=dn(tt,p,y,C,A,N),!0;case"pointerover":var z=N.pointerId;return St.set(z,dn(St.get(z)||null,p,y,C,A,N)),!0;case"gotpointercapture":return z=N.pointerId,$t.set(z,dn($t.get(z)||null,p,y,C,A,N)),!0}return!1}function ar(p){var y=at(p.target);if(y!==null){var C=$e(y);if(C!==null){if(y=C.tag,y===13){if(y=et(C),y!==null){p.blockedOn=y,ue(p.priority,function(){Z(C)});return}}else if(y===3&&C.stateNode.current.memoizedState.isDehydrated){p.blockedOn=C.tag===3?C.stateNode.containerInfo:null;return}}}p.blockedOn=null}function jn(p){if(p.blockedOn!==null)return!1;for(var y=p.targetContainers;0<y.length;){var C=Ea(p.domEventName,p.eventSystemFlags,y[0],p.nativeEvent);if(C===null){C=p.nativeEvent;var A=new C.constructor(C.type,C);ct=A,C.target.dispatchEvent(A),ct=null}else return y=dt(C),y!==null&&X(y),p.blockedOn=C,!1;y.shift()}return!0}function yr(p,y,C){jn(p)&&C.delete(y)}function Bt(){be=!1,le!==null&&jn(le)&&(le=null),Je!==null&&jn(Je)&&(Je=null),tt!==null&&jn(tt)&&(tt=null),St.forEach(yr),$t.forEach(yr)}function qt(p,y){p.blockedOn===y&&(p.blockedOn=null,be||(be=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Bt)))}function mn(p){function y(N){return qt(N,p)}if(0<H.length){qt(H[0],p);for(var C=1;C<H.length;C++){var A=H[C];A.blockedOn===p&&(A.blockedOn=null)}}for(le!==null&&qt(le,p),Je!==null&&qt(Je,p),tt!==null&&qt(tt,p),St.forEach(y),$t.forEach(y),C=0;C<rt.length;C++)A=rt[C],A.blockedOn===p&&(A.blockedOn=null);for(;0<rt.length&&(C=rt[0],C.blockedOn===null);)ar(C),C.blockedOn===null&&rt.shift()}var dr=k.ReactCurrentBatchConfig,rr=!0;function Dr(p,y,C,A){var N=ee,z=dr.transition;dr.transition=null;try{ee=1,Vr(p,y,C,A)}finally{ee=N,dr.transition=z}}function ho(p,y,C,A){var N=ee,z=dr.transition;dr.transition=null;try{ee=4,Vr(p,y,C,A)}finally{ee=N,dr.transition=z}}function Vr(p,y,C,A){if(rr){var N=Ea(p,y,C,A);if(N===null)q(p,y,A,ko,C),Xt(p,A);else if(kn(N,p,y,C,A))A.stopPropagation();else if(Xt(p,A),y&4&&-1<Ft.indexOf(p)){for(;N!==null;){var z=dt(N);if(z!==null&&Qe(z),z=Ea(p,y,C,A),z===null&&q(p,y,A,ko,C),z===N)break;N=z}N!==null&&A.stopPropagation()}else q(p,y,A,null,C)}}var ko=null;function Ea(p,y,C,A){if(ko=null,p=vt(A),p=at(p),p!==null)if(y=$e(p),y===null)p=null;else if(C=y.tag,C===13){if(p=et(y),p!==null)return p;p=null}else if(C===3){if(y.stateNode.current.memoizedState.isDehydrated)return y.tag===3?y.stateNode.containerInfo:null;p=null}else y!==p&&(p=null);return ko=p,null}function no(p){switch(p){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Or()){case wr:return 1;case vn:return 4;case Gr:case hn:return 16;case jr:return 536870912;default:return 16}default:return 16}}var go=null,qs=null,Ka=null;function Jo(){if(Ka)return Ka;var p,y=qs,C=y.length,A,N="value"in go?go.value:go.textContent,z=N.length;for(p=0;p<C&&y[p]===N[p];p++);var Q=C-p;for(A=1;A<=Q&&y[C-A]===N[z-A];A++);return Ka=N.slice(p,1<A?1-A:void 0)}function La(p){var y=p.keyCode;return"charCode"in p?(p=p.charCode,p===0&&y===13&&(p=13)):p=y,p===10&&(p=13),32<=p||p===13?p:0}function za(){return!0}function Rs(){return!1}function Qo(p){function y(C,A,N,z,Q){this._reactName=C,this._targetInst=N,this.type=A,this.nativeEvent=z,this.target=Q,this.currentTarget=null;for(var Ce in p)p.hasOwnProperty(Ce)&&(C=p[Ce],this[Ce]=C?C(z):z[Ce]);return this.isDefaultPrevented=(z.defaultPrevented!=null?z.defaultPrevented:z.returnValue===!1)?za:Rs,this.isPropagationStopped=Rs,this}return P(y.prototype,{preventDefault:function(){this.defaultPrevented=!0;var C=this.nativeEvent;C&&(C.preventDefault?C.preventDefault():typeof C.returnValue!="unknown"&&(C.returnValue=!1),this.isDefaultPrevented=za)},stopPropagation:function(){var C=this.nativeEvent;C&&(C.stopPropagation?C.stopPropagation():typeof C.cancelBubble!="unknown"&&(C.cancelBubble=!0),this.isPropagationStopped=za)},persist:function(){},isPersistent:za}),y}var vo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(p){return p.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},va=Qo(vo),Js=P({},vo,{view:0,detail:0}),$i=Qo(Js),pi,ps,No,mi=P({},Js,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:yi,button:0,buttons:0,relatedTarget:function(p){return p.relatedTarget===void 0?p.fromElement===p.srcElement?p.toElement:p.fromElement:p.relatedTarget},movementX:function(p){return"movementX"in p?p.movementX:(p!==No&&(No&&p.type==="mousemove"?(pi=p.screenX-No.screenX,ps=p.screenY-No.screenY):ps=pi=0,No=p),pi)},movementY:function(p){return"movementY"in p?p.movementY:ps}}),Tr=Qo(mi),bd=P({},mi,{dataTransfer:0}),Lc=Qo(bd),ll=P({},Js,{relatedTarget:0}),gi=Qo(ll),Wo=P({},vo,{animationName:0,elapsedTime:0,pseudoElement:0}),qi=Qo(Wo),cc=P({},vo,{clipboardData:function(p){return"clipboardData"in p?p.clipboardData:window.clipboardData}}),Xa=Qo(cc),Hi=P({},vo,{data:0}),xd=Qo(Hi),Ro={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},dc={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},On={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function zc(p){var y=this.nativeEvent;return y.getModifierState?y.getModifierState(p):(p=On[p])?!!y[p]:!1}function yi(){return zc}var Bc=P({},Js,{key:function(p){if(p.key){var y=Ro[p.key]||p.key;if(y!=="Unidentified")return y}return p.type==="keypress"?(p=La(p),p===13?"Enter":String.fromCharCode(p)):p.type==="keydown"||p.type==="keyup"?dc[p.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:yi,charCode:function(p){return p.type==="keypress"?La(p):0},keyCode:function(p){return p.type==="keydown"||p.type==="keyup"?p.keyCode:0},which:function(p){return p.type==="keypress"?La(p):p.type==="keydown"||p.type==="keyup"?p.keyCode:0}}),vd=Qo(Bc),Go=P({},mi,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),bi=Qo(Go),Sd=P({},Js,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:yi}),xi=Qo(Sd),yn=P({},vo,{propertyName:0,elapsedTime:0,pseudoElement:0}),wd=Qo(yn),Qs=P({},mi,{deltaX:function(p){return"deltaX"in p?p.deltaX:"wheelDeltaX"in p?-p.wheelDeltaX:0},deltaY:function(p){return"deltaY"in p?p.deltaY:"wheelDeltaY"in p?-p.wheelDeltaY:"wheelDelta"in p?-p.wheelDelta:0},deltaZ:0,deltaMode:0}),As=Qo(Qs),G=[9,13,27,32],he=c&&"CompositionEvent"in window,ve=null;c&&"documentMode"in document&&(ve=document.documentMode);var He=c&&"TextEvent"in window&&!ve,ut=c&&(!he||ve&&8<ve&&11>=ve),pn=" ",cn=!1;function Jt(p,y){switch(p){case"keyup":return G.indexOf(y.keyCode)!==-1;case"keydown":return y.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Pn(p){return p=p.detail,typeof p=="object"&&"data"in p?p.data:null}var Hn=!1;function Ir(p,y){switch(p){case"compositionend":return Pn(y);case"keypress":return y.which!==32?null:(cn=!0,pn);case"textInput":return p=y.data,p===pn&&cn?null:p;default:return null}}function Ur(p,y){if(Hn)return p==="compositionend"||!he&&Jt(p,y)?(p=Jo(),Ka=qs=go=null,Hn=!1,p):null;switch(p){case"paste":return null;case"keypress":if(!(y.ctrlKey||y.altKey||y.metaKey)||y.ctrlKey&&y.altKey){if(y.char&&1<y.char.length)return y.char;if(y.which)return String.fromCharCode(y.which)}return null;case"compositionend":return ut&&y.locale!=="ko"?null:y.data;default:return null}}var qr={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function tn(p){var y=p&&p.nodeName&&p.nodeName.toLowerCase();return y==="input"?!!qr[p.type]:y==="textarea"}function Fn(p,y,C,A){je(A),y=Me(y,"onChange"),0<y.length&&(C=new va("onChange","change",null,C,A),p.push({event:C,listeners:y}))}var Wn=null,Yn=null;function co(p){Ed(p,0)}function Ao(p){var y=it(p);if(Oe(y))return p}function as(p,y){if(p==="change")return y}var Zo=!1;if(c){var Io;if(c){var Zs="oninput"in document;if(!Zs){var ms=document.createElement("div");ms.setAttribute("oninput","return;"),Zs=typeof ms.oninput=="function"}Io=Zs}else Io=!1;Zo=Io&&(!document.documentMode||9<document.documentMode)}function Ja(){Wn&&(Wn.detachEvent("onpropertychange",Ba),Yn=Wn=null)}function Ba(p){if(p.propertyName==="value"&&Ao(Yn)){var y=[];Fn(y,Yn,p,vt(p)),en(co,y)}}function Pl(p,y,C){p==="focusin"?(Ja(),Wn=y,Yn=C,Wn.attachEvent("onpropertychange",Ba)):p==="focusout"&&Ja()}function hr(p){if(p==="selectionchange"||p==="keyup"||p==="keydown")return Ao(Yn)}function Vo(p,y){if(p==="click")return Ao(y)}function $a(p,y){if(p==="input"||p==="change")return Ao(y)}function aa(p,y){return p===y&&(p!==0||1/p===1/y)||p!==p&&y!==y}var fr=typeof Object.is=="function"?Object.is:aa;function Oo(p,y){if(fr(p,y))return!0;if(typeof p!="object"||p===null||typeof y!="object"||y===null)return!1;var C=Object.keys(p),A=Object.keys(y);if(C.length!==A.length)return!1;for(A=0;A<C.length;A++){var N=C[A];if(!l.call(y,N)||!fr(p[N],y[N]))return!1}return!0}function qa(p){for(;p&&p.firstChild;)p=p.firstChild;return p}function Po(p,y){var C=qa(p);p=0;for(var A;C;){if(C.nodeType===3){if(A=p+C.textContent.length,p<=y&&A>=y)return{node:C,offset:y-p};p=A}e:{for(;C;){if(C.nextSibling){C=C.nextSibling;break e}C=C.parentNode}C=void 0}C=qa(C)}}function uc(p,y){return p&&y?p===y?!0:p&&p.nodeType===3?!1:y&&y.nodeType===3?uc(p,y.parentNode):"contains"in p?p.contains(y):p.compareDocumentPosition?!!(p.compareDocumentPosition(y)&16):!1:!1}function Wi(){for(var p=window,y=ne();y instanceof p.HTMLIFrameElement;){try{var C=typeof y.contentWindow.location.href=="string"}catch{C=!1}if(C)p=y.contentWindow;else break;y=ne(p.document)}return y}function cl(p){var y=p&&p.nodeName&&p.nodeName.toLowerCase();return y&&(y==="input"&&(p.type==="text"||p.type==="search"||p.type==="tel"||p.type==="url"||p.type==="password")||y==="textarea"||p.contentEditable==="true")}function Gi(p){var y=Wi(),C=p.focusedElem,A=p.selectionRange;if(y!==C&&C&&C.ownerDocument&&uc(C.ownerDocument.documentElement,C)){if(A!==null&&cl(C)){if(y=A.start,p=A.end,p===void 0&&(p=y),"selectionStart"in C)C.selectionStart=y,C.selectionEnd=Math.min(p,C.value.length);else if(p=(y=C.ownerDocument||document)&&y.defaultView||window,p.getSelection){p=p.getSelection();var N=C.textContent.length,z=Math.min(A.start,N);A=A.end===void 0?z:Math.min(A.end,N),!p.extend&&z>A&&(N=A,A=z,z=N),N=Po(C,z);var Q=Po(C,A);N&&Q&&(p.rangeCount!==1||p.anchorNode!==N.node||p.anchorOffset!==N.offset||p.focusNode!==Q.node||p.focusOffset!==Q.offset)&&(y=y.createRange(),y.setStart(N.node,N.offset),p.removeAllRanges(),z>A?(p.addRange(y),p.extend(Q.node,Q.offset)):(y.setEnd(Q.node,Q.offset),p.addRange(y)))}}for(y=[],p=C;p=p.parentNode;)p.nodeType===1&&y.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof C.focus=="function"&&C.focus(),C=0;C<y.length;C++)p=y[C],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var Em=c&&"documentMode"in document&&11>=document.documentMode,Fl=null,Md=null,vi=null,Cd=!1;function E0(p,y,C){var A=C.window===C?C.document:C.nodeType===9?C:C.ownerDocument;Cd||Fl==null||Fl!==ne(A)||(A=Fl,"selectionStart"in A&&cl(A)?A={start:A.selectionStart,end:A.selectionEnd}:(A=(A.ownerDocument&&A.ownerDocument.defaultView||window).getSelection(),A={anchorNode:A.anchorNode,anchorOffset:A.anchorOffset,focusNode:A.focusNode,focusOffset:A.focusOffset}),vi&&Oo(vi,A)||(vi=A,A=Me(Md,"onSelect"),0<A.length&&(y=new va("onSelect","select",null,y,C),p.push({event:y,listeners:A}),y.target=Fl)))}function kd(p,y){var C={};return C[p.toLowerCase()]=y.toLowerCase(),C["Webkit"+p]="webkit"+y,C["Moz"+p]="moz"+y,C}var _l={animationend:kd("Animation","AnimationEnd"),animationiteration:kd("Animation","AnimationIteration"),animationstart:kd("Animation","AnimationStart"),transitionend:kd("Transition","TransitionEnd")},T0={},I0={};c&&(I0=document.createElement("div").style,"AnimationEvent"in window||(delete _l.animationend.animation,delete _l.animationiteration.animation,delete _l.animationstart.animation),"TransitionEvent"in window||delete _l.transitionend.transition);function Rd(p){if(T0[p])return T0[p];if(!_l[p])return p;var y=_l[p],C;for(C in y)if(y.hasOwnProperty(C)&&C in I0)return T0[p]=y[C];return p}var Vu=Rd("animationend"),Ad=Rd("animationiteration"),Uu=Rd("animationstart"),Yu=Rd("transitionend"),Ku=new Map,ei="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ss(p,y){Ku.set(p,y),i(y,[p])}for(var Si=0;Si<ei.length;Si++){var wi=ei[Si],ti=wi.toLowerCase(),js=wi[0].toUpperCase()+wi.slice(1);ss(ti,"on"+js)}ss(Vu,"onAnimationEnd"),ss(Ad,"onAnimationIteration"),ss(Uu,"onAnimationStart"),ss("dblclick","onDoubleClick"),ss("focusin","onFocus"),ss("focusout","onBlur"),ss(Yu,"onTransitionEnd"),s("onMouseEnter",["mouseout","mouseover"]),s("onMouseLeave",["mouseout","mouseover"]),s("onPointerEnter",["pointerout","pointerover"]),s("onPointerLeave",["pointerout","pointerover"]),i("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),i("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),i("onBeforeInput",["compositionend","keypress","textInput","paste"]),i("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ot="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),jd=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ot));function Xu(p,y,C){var A=p.type||"unknown-event";p.currentTarget=C,de(A,y,void 0,p),p.currentTarget=null}function Ed(p,y){y=(y&4)!==0;for(var C=0;C<p.length;C++){var A=p[C],N=A.event;A=A.listeners;e:{var z=void 0;if(y)for(var Q=A.length-1;0<=Q;Q--){var Ce=A[Q],Ne=Ce.instance,gt=Ce.currentTarget;if(Ce=Ce.listener,Ne!==z&&N.isPropagationStopped())break e;Xu(N,Ce,gt),z=Ne}else for(Q=0;Q<A.length;Q++){if(Ce=A[Q],Ne=Ce.instance,gt=Ce.currentTarget,Ce=Ce.listener,Ne!==z&&N.isPropagationStopped())break e;Xu(N,Ce,gt),z=Ne}}}if(An)throw p=cr,An=!1,cr=null,p}function So(p,y){var C=y[We];C===void 0&&(C=y[We]=new Set);var A=p+"__bubble";C.has(A)||(T(y,p,2,!1),C.add(A))}function $c(p,y,C){var A=0;y&&(A|=4),T(C,p,A,y)}var qc="_reactListening"+Math.random().toString(36).slice(2);function hc(p){if(!p[qc]){p[qc]=!0,r.forEach(function(C){C!=="selectionchange"&&(jd.has(C)||$c(C,!1,p),$c(C,!0,p))});var y=p.nodeType===9?p:p.ownerDocument;y===null||y[qc]||(y[qc]=!0,$c("selectionchange",!1,y))}}function T(p,y,C,A){switch(no(y)){case 1:var N=Dr;break;case 4:N=ho;break;default:N=Vr}C=N.bind(null,y,C,p),N=void 0,!Ze||y!=="touchstart"&&y!=="touchmove"&&y!=="wheel"||(N=!0),A?N!==void 0?p.addEventListener(y,C,{capture:!0,passive:N}):p.addEventListener(y,C,!0):N!==void 0?p.addEventListener(y,C,{passive:N}):p.addEventListener(y,C,!1)}function q(p,y,C,A,N){var z=A;if((y&1)===0&&(y&2)===0&&A!==null)e:for(;;){if(A===null)return;var Q=A.tag;if(Q===3||Q===4){var Ce=A.stateNode.containerInfo;if(Ce===N||Ce.nodeType===8&&Ce.parentNode===N)break;if(Q===4)for(Q=A.return;Q!==null;){var Ne=Q.tag;if((Ne===3||Ne===4)&&(Ne=Q.stateNode.containerInfo,Ne===N||Ne.nodeType===8&&Ne.parentNode===N))return;Q=Q.return}for(;Ce!==null;){if(Q=at(Ce),Q===null)return;if(Ne=Q.tag,Ne===5||Ne===6){A=z=Q;continue e}Ce=Ce.parentNode}}A=A.return}en(function(){var gt=z,Kt=vt(C),rn=[];e:{var Gt=Ku.get(p);if(Gt!==void 0){var Dn=va,Xn=p;switch(p){case"keypress":if(La(C)===0)break e;case"keydown":case"keyup":Dn=vd;break;case"focusin":Xn="focus",Dn=gi;break;case"focusout":Xn="blur",Dn=gi;break;case"beforeblur":case"afterblur":Dn=gi;break;case"click":if(C.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Dn=Tr;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Dn=Lc;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Dn=xi;break;case Vu:case Ad:case Uu:Dn=qi;break;case Yu:Dn=wd;break;case"scroll":Dn=$i;break;case"wheel":Dn=As;break;case"copy":case"cut":case"paste":Dn=Xa;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Dn=bi}var Qn=(y&4)!==0,Ha=!Qn&&p==="scroll",ot=Qn?Gt!==null?Gt+"Capture":null:Gt;Qn=[];for(var qe=gt,lt;qe!==null;){lt=qe;var un=lt.stateNode;if(lt.tag===5&&un!==null&&(lt=un,ot!==null&&(un=At(qe,ot),un!=null&&Qn.push(U(qe,un,lt)))),Ha)break;qe=qe.return}0<Qn.length&&(Gt=new Dn(Gt,Xn,null,C,Kt),rn.push({event:Gt,listeners:Qn}))}}if((y&7)===0){e:{if(Gt=p==="mouseover"||p==="pointerover",Dn=p==="mouseout"||p==="pointerout",Gt&&C!==ct&&(Xn=C.relatedTarget||C.fromElement)&&(at(Xn)||Xn[Ye]))break e;if((Dn||Gt)&&(Gt=Kt.window===Kt?Kt:(Gt=Kt.ownerDocument)?Gt.defaultView||Gt.parentWindow:window,Dn?(Xn=C.relatedTarget||C.toElement,Dn=gt,Xn=Xn?at(Xn):null,Xn!==null&&(Ha=$e(Xn),Xn!==Ha||Xn.tag!==5&&Xn.tag!==6)&&(Xn=null)):(Dn=null,Xn=gt),Dn!==Xn)){if(Qn=Tr,un="onMouseLeave",ot="onMouseEnter",qe="mouse",(p==="pointerout"||p==="pointerover")&&(Qn=bi,un="onPointerLeave",ot="onPointerEnter",qe="pointer"),Ha=Dn==null?Gt:it(Dn),lt=Xn==null?Gt:it(Xn),Gt=new Qn(un,qe+"leave",Dn,C,Kt),Gt.target=Ha,Gt.relatedTarget=lt,un=null,at(Kt)===gt&&(Qn=new Qn(ot,qe+"enter",Xn,C,Kt),Qn.target=lt,Qn.relatedTarget=Ha,un=Qn),Ha=un,Dn&&Xn)t:{for(Qn=Dn,ot=Xn,qe=0,lt=Qn;lt;lt=Ve(lt))qe++;for(lt=0,un=ot;un;un=Ve(un))lt++;for(;0<qe-lt;)Qn=Ve(Qn),qe--;for(;0<lt-qe;)ot=Ve(ot),lt--;for(;qe--;){if(Qn===ot||ot!==null&&Qn===ot.alternate)break t;Qn=Ve(Qn),ot=Ve(ot)}Qn=null}else Qn=null;Dn!==null&&ht(rn,Gt,Dn,Qn,!1),Xn!==null&&Ha!==null&&ht(rn,Ha,Xn,Qn,!0)}}e:{if(Gt=gt?it(gt):window,Dn=Gt.nodeName&&Gt.nodeName.toLowerCase(),Dn==="select"||Dn==="input"&&Gt.type==="file")var or=as;else if(tn(Gt))if(Zo)or=$a;else{or=hr;var br=Pl}else(Dn=Gt.nodeName)&&Dn.toLowerCase()==="input"&&(Gt.type==="checkbox"||Gt.type==="radio")&&(or=Vo);if(or&&(or=or(p,gt))){Fn(rn,or,C,Kt);break e}br&&br(p,Gt,gt),p==="focusout"&&(br=Gt._wrapperState)&&br.controlled&&Gt.type==="number"&&Xe(Gt,"number",Gt.value)}switch(br=gt?it(gt):window,p){case"focusin":(tn(br)||br.contentEditable==="true")&&(Fl=br,Md=gt,vi=null);break;case"focusout":vi=Md=Fl=null;break;case"mousedown":Cd=!0;break;case"contextmenu":case"mouseup":case"dragend":Cd=!1,E0(rn,C,Kt);break;case"selectionchange":if(Em)break;case"keydown":case"keyup":E0(rn,C,Kt)}var xr;if(he)e:{switch(p){case"compositionstart":var Pr="onCompositionStart";break e;case"compositionend":Pr="onCompositionEnd";break e;case"compositionupdate":Pr="onCompositionUpdate";break e}Pr=void 0}else Hn?Jt(p,C)&&(Pr="onCompositionEnd"):p==="keydown"&&C.keyCode===229&&(Pr="onCompositionStart");Pr&&(ut&&C.locale!=="ko"&&(Hn||Pr!=="onCompositionStart"?Pr==="onCompositionEnd"&&Hn&&(xr=Jo()):(go=Kt,qs="value"in go?go.value:go.textContent,Hn=!0)),br=Me(gt,Pr),0<br.length&&(Pr=new xd(Pr,p,null,C,Kt),rn.push({event:Pr,listeners:br}),xr?Pr.data=xr:(xr=Pn(C),xr!==null&&(Pr.data=xr)))),(xr=He?Ir(p,C):Ur(p,C))&&(gt=Me(gt,"onBeforeInput"),0<gt.length&&(Kt=new xd("onBeforeInput","beforeinput",null,C,Kt),rn.push({event:Kt,listeners:gt}),Kt.data=xr))}Ed(rn,y)})}function U(p,y,C){return{instance:p,listener:y,currentTarget:C}}function Me(p,y){for(var C=y+"Capture",A=[];p!==null;){var N=p,z=N.stateNode;N.tag===5&&z!==null&&(N=z,z=At(p,C),z!=null&&A.unshift(U(p,z,N)),z=At(p,y),z!=null&&A.push(U(p,z,N))),p=p.return}return A}function Ve(p){if(p===null)return null;do p=p.return;while(p&&p.tag!==5);return p||null}function ht(p,y,C,A,N){for(var z=y._reactName,Q=[];C!==null&&C!==A;){var Ce=C,Ne=Ce.alternate,gt=Ce.stateNode;if(Ne!==null&&Ne===A)break;Ce.tag===5&&gt!==null&&(Ce=gt,N?(Ne=At(C,z),Ne!=null&&Q.unshift(U(C,Ne,Ce))):N||(Ne=At(C,z),Ne!=null&&Q.push(U(C,Ne,Ce)))),C=C.return}Q.length!==0&&p.push({event:y,listeners:Q})}var kt=/\r\n?/g,Ht=/\u0000|\uFFFD/g;function $n(p){return(typeof p=="string"?p:""+p).replace(kt,`
`).replace(Ht,"")}function In(p,y,C){if(y=$n(y),$n(p)!==y&&C)throw Error(n(425))}function er(){}var pr=null,Mr=null;function Fr(p,y){return p==="textarea"||p==="noscript"||typeof y.children=="string"||typeof y.children=="number"||typeof y.dangerouslySetInnerHTML=="object"&&y.dangerouslySetInnerHTML!==null&&y.dangerouslySetInnerHTML.__html!=null}var uo=typeof setTimeout=="function"?setTimeout:void 0,ha=typeof clearTimeout=="function"?clearTimeout:void 0,Ta=typeof Promise=="function"?Promise:void 0,Qa=typeof queueMicrotask=="function"?queueMicrotask:typeof Ta<"u"?function(p){return Ta.resolve(null).then(p).catch(is)}:uo;function is(p){setTimeout(function(){throw p})}function fa(p,y){var C=y,A=0;do{var N=C.nextSibling;if(p.removeChild(C),N&&N.nodeType===8)if(C=N.data,C==="/$"){if(A===0){p.removeChild(N),mn(y);return}A--}else C!=="$"&&C!=="$?"&&C!=="$!"||A++;C=N}while(C);mn(y)}function Ia(p){for(;p!=null;p=p.nextSibling){var y=p.nodeType;if(y===1||y===3)break;if(y===8){if(y=p.data,y==="$"||y==="$!"||y==="$?")break;if(y==="/$")return null}}return p}function Lr(p){p=p.previousSibling;for(var y=0;p;){if(p.nodeType===8){var C=p.data;if(C==="$"||C==="$!"||C==="$?"){if(y===0)return p;y--}else C==="/$"&&y++}p=p.previousSibling}return null}var Za=Math.random().toString(36).slice(2),Y="__reactFiber$"+Za,ze="__reactProps$"+Za,Ye="__reactContainer$"+Za,We="__reactEvents$"+Za,jt="__reactListeners$"+Za,Ge="__reactHandles$"+Za;function at(p){var y=p[Y];if(y)return y;for(var C=p.parentNode;C;){if(y=C[Ye]||C[Y]){if(C=y.alternate,y.child!==null||C!==null&&C.child!==null)for(p=Lr(p);p!==null;){if(C=p[Y])return C;p=Lr(p)}return y}p=C,C=p.parentNode}return null}function dt(p){return p=p[Y]||p[Ye],!p||p.tag!==5&&p.tag!==6&&p.tag!==13&&p.tag!==3?null:p}function it(p){if(p.tag===5||p.tag===6)return p.stateNode;throw Error(n(33))}function Yt(p){return p[ze]||null}var Ue=[],Dt=-1;function wn(p){return{current:p}}function Wt(p){0>Dt||(p.current=Ue[Dt],Ue[Dt]=null,Dt--)}function Kn(p,y){Dt++,Ue[Dt]=p.current,p.current=y}var ro={},Gn=wn(ro),Jr=wn(!1),zr=ro;function oo(p,y){var C=p.type.contextTypes;if(!C)return ro;var A=p.stateNode;if(A&&A.__reactInternalMemoizedUnmaskedChildContext===y)return A.__reactInternalMemoizedMaskedChildContext;var N={},z;for(z in C)N[z]=y[z];return A&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=y,p.__reactInternalMemoizedMaskedChildContext=N),N}function Uo(p){return p=p.childContextTypes,p!=null}function ni(){Wt(Jr),Wt(Gn)}function Hs(p,y,C){if(Gn.current!==ro)throw Error(n(168));Kn(Gn,y),Kn(Jr,C)}function Lf(p,y,C){var A=p.stateNode;if(y=y.childContextTypes,typeof A.getChildContext!="function")return C;A=A.getChildContext();for(var N in A)if(!(N in y))throw Error(n(108,De(p)||"Unknown",N));return P({},C,A)}function P0(p){return p=(p=p.stateNode)&&p.__reactInternalMemoizedMergedChildContext||ro,zr=Gn.current,Kn(Gn,p),Kn(Jr,Jr.current),!0}function zf(p,y,C){var A=p.stateNode;if(!A)throw Error(n(169));C?(p=Lf(p,y,zr),A.__reactInternalMemoizedMergedChildContext=p,Wt(Jr),Wt(Gn),Kn(Gn,p)):Wt(Jr),Kn(Jr,C)}var dl=null,F0=!1,Ju=!1;function Bf(p){dl===null?dl=[p]:dl.push(p)}function Tm(p){F0=!0,Bf(p)}function Nl(){if(!Ju&&dl!==null){Ju=!0;var p=0,y=ee;try{var C=dl;for(ee=1;p<C.length;p++){var A=C[p];do A=A(!0);while(A!==null)}dl=null,F0=!1}catch(N){throw dl!==null&&(dl=dl.slice(p+1)),Nn(wr,Nl),N}finally{ee=y,Ju=!1}}return null}var bt=[],Lt=0,Sn=null,lr=0,Mn=[],En=0,Un=null,qn=1,fn="";function Qr(p,y){bt[Lt++]=lr,bt[Lt++]=Sn,Sn=p,lr=y}function Sa(p,y,C){Mn[En++]=qn,Mn[En++]=fn,Mn[En++]=Un,Un=p;var A=qn;p=fn;var N=32-ir(A)-1;A&=~(1<<N),C+=1;var z=32-ir(y)+N;if(30<z){var Q=N-N%5;z=(A&(1<<Q)-1).toString(32),A>>=Q,N-=Q,qn=1<<32-ir(y)+N|C<<N|A,fn=z+p}else qn=1<<z|C<<N|A,fn=p}function sa(p){p.return!==null&&(Qr(p,1),Sa(p,1,0))}function Vi(p){for(;p===Sn;)Sn=bt[--Lt],bt[Lt]=null,lr=bt[--Lt],bt[Lt]=null;for(;p===Un;)Un=Mn[--En],Mn[En]=null,fn=Mn[--En],Mn[En]=null,qn=Mn[--En],Mn[En]=null}var Es=null,Ts=null,pa=!1,Ol=null;function fw(p,y){var C=pl(5,null,null,0);C.elementType="DELETED",C.stateNode=y,C.return=p,y=p.deletions,y===null?(p.deletions=[C],p.flags|=16):y.push(C)}function pw(p,y){switch(p.tag){case 5:var C=p.type;return y=y.nodeType!==1||C.toLowerCase()!==y.nodeName.toLowerCase()?null:y,y!==null?(p.stateNode=y,Es=p,Ts=Ia(y.firstChild),!0):!1;case 6:return y=p.pendingProps===""||y.nodeType!==3?null:y,y!==null?(p.stateNode=y,Es=p,Ts=null,!0):!1;case 13:return y=y.nodeType!==8?null:y,y!==null?(C=Un!==null?{id:qn,overflow:fn}:null,p.memoizedState={dehydrated:y,treeContext:C,retryLane:1073741824},C=pl(18,null,null,0),C.stateNode=y,C.return=p,p.child=C,Es=p,Ts=null,!0):!1;default:return!1}}function Zy(p){return(p.mode&1)!==0&&(p.flags&128)===0}function e1(p){if(pa){var y=Ts;if(y){var C=y;if(!pw(p,y)){if(Zy(p))throw Error(n(418));y=Ia(C.nextSibling);var A=Es;y&&pw(p,y)?fw(A,C):(p.flags=p.flags&-4097|2,pa=!1,Es=p)}}else{if(Zy(p))throw Error(n(418));p.flags=p.flags&-4097|2,pa=!1,Es=p}}}function mw(p){for(p=p.return;p!==null&&p.tag!==5&&p.tag!==3&&p.tag!==13;)p=p.return;Es=p}function Im(p){if(p!==Es)return!1;if(!pa)return mw(p),pa=!0,!1;var y;if((y=p.tag!==3)&&!(y=p.tag!==5)&&(y=p.type,y=y!=="head"&&y!=="body"&&!Fr(p.type,p.memoizedProps)),y&&(y=Ts)){if(Zy(p))throw gw(),Error(n(418));for(;y;)fw(p,y),y=Ia(y.nextSibling)}if(mw(p),p.tag===13){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(n(317));e:{for(p=p.nextSibling,y=0;p;){if(p.nodeType===8){var C=p.data;if(C==="/$"){if(y===0){Ts=Ia(p.nextSibling);break e}y--}else C!=="$"&&C!=="$!"&&C!=="$?"||y++}p=p.nextSibling}Ts=null}}else Ts=Es?Ia(p.stateNode.nextSibling):null;return!0}function gw(){for(var p=Ts;p;)p=Ia(p.nextSibling)}function Qu(){Ts=Es=null,pa=!1}function t1(p){Ol===null?Ol=[p]:Ol.push(p)}var _E=k.ReactCurrentBatchConfig;function $f(p,y,C){if(p=C.ref,p!==null&&typeof p!="function"&&typeof p!="object"){if(C._owner){if(C=C._owner,C){if(C.tag!==1)throw Error(n(309));var A=C.stateNode}if(!A)throw Error(n(147,p));var N=A,z=""+p;return y!==null&&y.ref!==null&&typeof y.ref=="function"&&y.ref._stringRef===z?y.ref:(y=function(Q){var Ce=N.refs;Q===null?delete Ce[z]:Ce[z]=Q},y._stringRef=z,y)}if(typeof p!="string")throw Error(n(284));if(!C._owner)throw Error(n(290,p))}return p}function Pm(p,y){throw p=Object.prototype.toString.call(y),Error(n(31,p==="[object Object]"?"object with keys {"+Object.keys(y).join(", ")+"}":p))}function yw(p){var y=p._init;return y(p._payload)}function bw(p){function y(ot,qe){if(p){var lt=ot.deletions;lt===null?(ot.deletions=[qe],ot.flags|=16):lt.push(qe)}}function C(ot,qe){if(!p)return null;for(;qe!==null;)y(ot,qe),qe=qe.sibling;return null}function A(ot,qe){for(ot=new Map;qe!==null;)qe.key!==null?ot.set(qe.key,qe):ot.set(qe.index,qe),qe=qe.sibling;return ot}function N(ot,qe){return ot=Dd(ot,qe),ot.index=0,ot.sibling=null,ot}function z(ot,qe,lt){return ot.index=lt,p?(lt=ot.alternate,lt!==null?(lt=lt.index,lt<qe?(ot.flags|=2,qe):lt):(ot.flags|=2,qe)):(ot.flags|=1048576,qe)}function Q(ot){return p&&ot.alternate===null&&(ot.flags|=2),ot}function Ce(ot,qe,lt,un){return qe===null||qe.tag!==6?(qe=V1(lt,ot.mode,un),qe.return=ot,qe):(qe=N(qe,lt),qe.return=ot,qe)}function Ne(ot,qe,lt,un){var or=lt.type;return or===I?Kt(ot,qe,lt.props.children,un,lt.key):qe!==null&&(qe.elementType===or||typeof or=="object"&&or!==null&&or.$$typeof===oe&&yw(or)===qe.type)?(un=N(qe,lt.props),un.ref=$f(ot,qe,lt),un.return=ot,un):(un=ng(lt.type,lt.key,lt.props,null,ot.mode,un),un.ref=$f(ot,qe,lt),un.return=ot,un)}function gt(ot,qe,lt,un){return qe===null||qe.tag!==4||qe.stateNode.containerInfo!==lt.containerInfo||qe.stateNode.implementation!==lt.implementation?(qe=U1(lt,ot.mode,un),qe.return=ot,qe):(qe=N(qe,lt.children||[]),qe.return=ot,qe)}function Kt(ot,qe,lt,un,or){return qe===null||qe.tag!==7?(qe=$0(lt,ot.mode,un,or),qe.return=ot,qe):(qe=N(qe,lt),qe.return=ot,qe)}function rn(ot,qe,lt){if(typeof qe=="string"&&qe!==""||typeof qe=="number")return qe=V1(""+qe,ot.mode,lt),qe.return=ot,qe;if(typeof qe=="object"&&qe!==null){switch(qe.$$typeof){case R:return lt=ng(qe.type,qe.key,qe.props,null,ot.mode,lt),lt.ref=$f(ot,null,qe),lt.return=ot,lt;case j:return qe=U1(qe,ot.mode,lt),qe.return=ot,qe;case oe:var un=qe._init;return rn(ot,un(qe._payload),lt)}if(Ut(qe)||pe(qe))return qe=$0(qe,ot.mode,lt,null),qe.return=ot,qe;Pm(ot,qe)}return null}function Gt(ot,qe,lt,un){var or=qe!==null?qe.key:null;if(typeof lt=="string"&&lt!==""||typeof lt=="number")return or!==null?null:Ce(ot,qe,""+lt,un);if(typeof lt=="object"&&lt!==null){switch(lt.$$typeof){case R:return lt.key===or?Ne(ot,qe,lt,un):null;case j:return lt.key===or?gt(ot,qe,lt,un):null;case oe:return or=lt._init,Gt(ot,qe,or(lt._payload),un)}if(Ut(lt)||pe(lt))return or!==null?null:Kt(ot,qe,lt,un,null);Pm(ot,lt)}return null}function Dn(ot,qe,lt,un,or){if(typeof un=="string"&&un!==""||typeof un=="number")return ot=ot.get(lt)||null,Ce(qe,ot,""+un,or);if(typeof un=="object"&&un!==null){switch(un.$$typeof){case R:return ot=ot.get(un.key===null?lt:un.key)||null,Ne(qe,ot,un,or);case j:return ot=ot.get(un.key===null?lt:un.key)||null,gt(qe,ot,un,or);case oe:var br=un._init;return Dn(ot,qe,lt,br(un._payload),or)}if(Ut(un)||pe(un))return ot=ot.get(lt)||null,Kt(qe,ot,un,or,null);Pm(qe,un)}return null}function Xn(ot,qe,lt,un){for(var or=null,br=null,xr=qe,Pr=qe=0,bs=null;xr!==null&&Pr<lt.length;Pr++){xr.index>Pr?(bs=xr,xr=null):bs=xr.sibling;var wo=Gt(ot,xr,lt[Pr],un);if(wo===null){xr===null&&(xr=bs);break}p&&xr&&wo.alternate===null&&y(ot,xr),qe=z(wo,qe,Pr),br===null?or=wo:br.sibling=wo,br=wo,xr=bs}if(Pr===lt.length)return C(ot,xr),pa&&Qr(ot,Pr),or;if(xr===null){for(;Pr<lt.length;Pr++)xr=rn(ot,lt[Pr],un),xr!==null&&(qe=z(xr,qe,Pr),br===null?or=xr:br.sibling=xr,br=xr);return pa&&Qr(ot,Pr),or}for(xr=A(ot,xr);Pr<lt.length;Pr++)bs=Dn(xr,ot,Pr,lt[Pr],un),bs!==null&&(p&&bs.alternate!==null&&xr.delete(bs.key===null?Pr:bs.key),qe=z(bs,qe,Pr),br===null?or=bs:br.sibling=bs,br=bs);return p&&xr.forEach(function(Ld){return y(ot,Ld)}),pa&&Qr(ot,Pr),or}function Qn(ot,qe,lt,un){var or=pe(lt);if(typeof or!="function")throw Error(n(150));if(lt=or.call(lt),lt==null)throw Error(n(151));for(var br=or=null,xr=qe,Pr=qe=0,bs=null,wo=lt.next();xr!==null&&!wo.done;Pr++,wo=lt.next()){xr.index>Pr?(bs=xr,xr=null):bs=xr.sibling;var Ld=Gt(ot,xr,wo.value,un);if(Ld===null){xr===null&&(xr=bs);break}p&&xr&&Ld.alternate===null&&y(ot,xr),qe=z(Ld,qe,Pr),br===null?or=Ld:br.sibling=Ld,br=Ld,xr=bs}if(wo.done)return C(ot,xr),pa&&Qr(ot,Pr),or;if(xr===null){for(;!wo.done;Pr++,wo=lt.next())wo=rn(ot,wo.value,un),wo!==null&&(qe=z(wo,qe,Pr),br===null?or=wo:br.sibling=wo,br=wo);return pa&&Qr(ot,Pr),or}for(xr=A(ot,xr);!wo.done;Pr++,wo=lt.next())wo=Dn(xr,ot,Pr,wo.value,un),wo!==null&&(p&&wo.alternate!==null&&xr.delete(wo.key===null?Pr:wo.key),qe=z(wo,qe,Pr),br===null?or=wo:br.sibling=wo,br=wo);return p&&xr.forEach(function(fT){return y(ot,fT)}),pa&&Qr(ot,Pr),or}function Ha(ot,qe,lt,un){if(typeof lt=="object"&&lt!==null&&lt.type===I&&lt.key===null&&(lt=lt.props.children),typeof lt=="object"&&lt!==null){switch(lt.$$typeof){case R:e:{for(var or=lt.key,br=qe;br!==null;){if(br.key===or){if(or=lt.type,or===I){if(br.tag===7){C(ot,br.sibling),qe=N(br,lt.props.children),qe.return=ot,ot=qe;break e}}else if(br.elementType===or||typeof or=="object"&&or!==null&&or.$$typeof===oe&&yw(or)===br.type){C(ot,br.sibling),qe=N(br,lt.props),qe.ref=$f(ot,br,lt),qe.return=ot,ot=qe;break e}C(ot,br);break}else y(ot,br);br=br.sibling}lt.type===I?(qe=$0(lt.props.children,ot.mode,un,lt.key),qe.return=ot,ot=qe):(un=ng(lt.type,lt.key,lt.props,null,ot.mode,un),un.ref=$f(ot,qe,lt),un.return=ot,ot=un)}return Q(ot);case j:e:{for(br=lt.key;qe!==null;){if(qe.key===br)if(qe.tag===4&&qe.stateNode.containerInfo===lt.containerInfo&&qe.stateNode.implementation===lt.implementation){C(ot,qe.sibling),qe=N(qe,lt.children||[]),qe.return=ot,ot=qe;break e}else{C(ot,qe);break}else y(ot,qe);qe=qe.sibling}qe=U1(lt,ot.mode,un),qe.return=ot,ot=qe}return Q(ot);case oe:return br=lt._init,Ha(ot,qe,br(lt._payload),un)}if(Ut(lt))return Xn(ot,qe,lt,un);if(pe(lt))return Qn(ot,qe,lt,un);Pm(ot,lt)}return typeof lt=="string"&&lt!==""||typeof lt=="number"?(lt=""+lt,qe!==null&&qe.tag===6?(C(ot,qe.sibling),qe=N(qe,lt),qe.return=ot,ot=qe):(C(ot,qe),qe=V1(lt,ot.mode,un),qe.return=ot,ot=qe),Q(ot)):C(ot,qe)}return Ha}var Zu=bw(!0),xw=bw(!1),Fm=wn(null),_m=null,eh=null,n1=null;function r1(){n1=eh=_m=null}function o1(p){var y=Fm.current;Wt(Fm),p._currentValue=y}function a1(p,y,C){for(;p!==null;){var A=p.alternate;if((p.childLanes&y)!==y?(p.childLanes|=y,A!==null&&(A.childLanes|=y)):A!==null&&(A.childLanes&y)!==y&&(A.childLanes|=y),p===C)break;p=p.return}}function th(p,y){_m=p,n1=eh=null,p=p.dependencies,p!==null&&p.firstContext!==null&&((p.lanes&y)!==0&&(Mi=!0),p.firstContext=null)}function ul(p){var y=p._currentValue;if(n1!==p)if(p={context:p,memoizedValue:y,next:null},eh===null){if(_m===null)throw Error(n(308));eh=p,_m.dependencies={lanes:0,firstContext:p}}else eh=eh.next=p;return y}var _0=null;function s1(p){_0===null?_0=[p]:_0.push(p)}function vw(p,y,C,A){var N=y.interleaved;return N===null?(C.next=C,s1(y)):(C.next=N.next,N.next=C),y.interleaved=C,Hc(p,A)}function Hc(p,y){p.lanes|=y;var C=p.alternate;for(C!==null&&(C.lanes|=y),C=p,p=p.return;p!==null;)p.childLanes|=y,C=p.alternate,C!==null&&(C.childLanes|=y),C=p,p=p.return;return C.tag===3?C.stateNode:null}var Td=!1;function i1(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Sw(p,y){p=p.updateQueue,y.updateQueue===p&&(y.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,effects:p.effects})}function Wc(p,y){return{eventTime:p,lane:y,tag:0,payload:null,callback:null,next:null}}function Id(p,y,C){var A=p.updateQueue;if(A===null)return null;if(A=A.shared,(yo&2)!==0){var N=A.pending;return N===null?y.next=y:(y.next=N.next,N.next=y),A.pending=y,Hc(p,C)}return N=A.interleaved,N===null?(y.next=y,s1(A)):(y.next=N.next,N.next=y),A.interleaved=y,Hc(p,C)}function Nm(p,y,C){if(y=y.updateQueue,y!==null&&(y=y.shared,(C&4194240)!==0)){var A=y.lanes;A&=p.pendingLanes,C|=A,y.lanes=C,D(p,C)}}function ww(p,y){var C=p.updateQueue,A=p.alternate;if(A!==null&&(A=A.updateQueue,C===A)){var N=null,z=null;if(C=C.firstBaseUpdate,C!==null){do{var Q={eventTime:C.eventTime,lane:C.lane,tag:C.tag,payload:C.payload,callback:C.callback,next:null};z===null?N=z=Q:z=z.next=Q,C=C.next}while(C!==null);z===null?N=z=y:z=z.next=y}else N=z=y;C={baseState:A.baseState,firstBaseUpdate:N,lastBaseUpdate:z,shared:A.shared,effects:A.effects},p.updateQueue=C;return}p=C.lastBaseUpdate,p===null?C.firstBaseUpdate=y:p.next=y,C.lastBaseUpdate=y}function Om(p,y,C,A){var N=p.updateQueue;Td=!1;var z=N.firstBaseUpdate,Q=N.lastBaseUpdate,Ce=N.shared.pending;if(Ce!==null){N.shared.pending=null;var Ne=Ce,gt=Ne.next;Ne.next=null,Q===null?z=gt:Q.next=gt,Q=Ne;var Kt=p.alternate;Kt!==null&&(Kt=Kt.updateQueue,Ce=Kt.lastBaseUpdate,Ce!==Q&&(Ce===null?Kt.firstBaseUpdate=gt:Ce.next=gt,Kt.lastBaseUpdate=Ne))}if(z!==null){var rn=N.baseState;Q=0,Kt=gt=Ne=null,Ce=z;do{var Gt=Ce.lane,Dn=Ce.eventTime;if((A&Gt)===Gt){Kt!==null&&(Kt=Kt.next={eventTime:Dn,lane:0,tag:Ce.tag,payload:Ce.payload,callback:Ce.callback,next:null});e:{var Xn=p,Qn=Ce;switch(Gt=y,Dn=C,Qn.tag){case 1:if(Xn=Qn.payload,typeof Xn=="function"){rn=Xn.call(Dn,rn,Gt);break e}rn=Xn;break e;case 3:Xn.flags=Xn.flags&-65537|128;case 0:if(Xn=Qn.payload,Gt=typeof Xn=="function"?Xn.call(Dn,rn,Gt):Xn,Gt==null)break e;rn=P({},rn,Gt);break e;case 2:Td=!0}}Ce.callback!==null&&Ce.lane!==0&&(p.flags|=64,Gt=N.effects,Gt===null?N.effects=[Ce]:Gt.push(Ce))}else Dn={eventTime:Dn,lane:Gt,tag:Ce.tag,payload:Ce.payload,callback:Ce.callback,next:null},Kt===null?(gt=Kt=Dn,Ne=rn):Kt=Kt.next=Dn,Q|=Gt;if(Ce=Ce.next,Ce===null){if(Ce=N.shared.pending,Ce===null)break;Gt=Ce,Ce=Gt.next,Gt.next=null,N.lastBaseUpdate=Gt,N.shared.pending=null}}while(!0);if(Kt===null&&(Ne=rn),N.baseState=Ne,N.firstBaseUpdate=gt,N.lastBaseUpdate=Kt,y=N.shared.interleaved,y!==null){N=y;do Q|=N.lane,N=N.next;while(N!==y)}else z===null&&(N.shared.lanes=0);D0|=Q,p.lanes=Q,p.memoizedState=rn}}function Mw(p,y,C){if(p=y.effects,y.effects=null,p!==null)for(y=0;y<p.length;y++){var A=p[y],N=A.callback;if(N!==null){if(A.callback=null,A=C,typeof N!="function")throw Error(n(191,N));N.call(A)}}}var qf={},fc=wn(qf),Hf=wn(qf),Wf=wn(qf);function N0(p){if(p===qf)throw Error(n(174));return p}function l1(p,y){switch(Kn(Wf,y),Kn(Hf,p),Kn(fc,qf),p=y.nodeType,p){case 9:case 11:y=(y=y.documentElement)?y.namespaceURI:ft(null,"");break;default:p=p===8?y.parentNode:y,y=p.namespaceURI||null,p=p.tagName,y=ft(y,p)}Wt(fc),Kn(fc,y)}function nh(){Wt(fc),Wt(Hf),Wt(Wf)}function Cw(p){N0(Wf.current);var y=N0(fc.current),C=ft(y,p.type);y!==C&&(Kn(Hf,p),Kn(fc,C))}function c1(p){Hf.current===p&&(Wt(fc),Wt(Hf))}var wa=wn(0);function Dm(p){for(var y=p;y!==null;){if(y.tag===13){var C=y.memoizedState;if(C!==null&&(C=C.dehydrated,C===null||C.data==="$?"||C.data==="$!"))return y}else if(y.tag===19&&y.memoizedProps.revealOrder!==void 0){if((y.flags&128)!==0)return y}else if(y.child!==null){y.child.return=y,y=y.child;continue}if(y===p)break;for(;y.sibling===null;){if(y.return===null||y.return===p)return null;y=y.return}y.sibling.return=y.return,y=y.sibling}return null}var d1=[];function u1(){for(var p=0;p<d1.length;p++)d1[p]._workInProgressVersionPrimary=null;d1.length=0}var Lm=k.ReactCurrentDispatcher,h1=k.ReactCurrentBatchConfig,O0=0,Ma=null,ls=null,gs=null,zm=!1,Gf=!1,Vf=0,NE=0;function Ws(){throw Error(n(321))}function f1(p,y){if(y===null)return!1;for(var C=0;C<y.length&&C<p.length;C++)if(!fr(p[C],y[C]))return!1;return!0}function p1(p,y,C,A,N,z){if(O0=z,Ma=y,y.memoizedState=null,y.updateQueue=null,y.lanes=0,Lm.current=p===null||p.memoizedState===null?zE:BE,p=C(A,N),Gf){z=0;do{if(Gf=!1,Vf=0,25<=z)throw Error(n(301));z+=1,gs=ls=null,y.updateQueue=null,Lm.current=$E,p=C(A,N)}while(Gf)}if(Lm.current=qm,y=ls!==null&&ls.next!==null,O0=0,gs=ls=Ma=null,zm=!1,y)throw Error(n(300));return p}function m1(){var p=Vf!==0;return Vf=0,p}function pc(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return gs===null?Ma.memoizedState=gs=p:gs=gs.next=p,gs}function hl(){if(ls===null){var p=Ma.alternate;p=p!==null?p.memoizedState:null}else p=ls.next;var y=gs===null?Ma.memoizedState:gs.next;if(y!==null)gs=y,ls=p;else{if(p===null)throw Error(n(310));ls=p,p={memoizedState:ls.memoizedState,baseState:ls.baseState,baseQueue:ls.baseQueue,queue:ls.queue,next:null},gs===null?Ma.memoizedState=gs=p:gs=gs.next=p}return gs}function Uf(p,y){return typeof y=="function"?y(p):y}function g1(p){var y=hl(),C=y.queue;if(C===null)throw Error(n(311));C.lastRenderedReducer=p;var A=ls,N=A.baseQueue,z=C.pending;if(z!==null){if(N!==null){var Q=N.next;N.next=z.next,z.next=Q}A.baseQueue=N=z,C.pending=null}if(N!==null){z=N.next,A=A.baseState;var Ce=Q=null,Ne=null,gt=z;do{var Kt=gt.lane;if((O0&Kt)===Kt)Ne!==null&&(Ne=Ne.next={lane:0,action:gt.action,hasEagerState:gt.hasEagerState,eagerState:gt.eagerState,next:null}),A=gt.hasEagerState?gt.eagerState:p(A,gt.action);else{var rn={lane:Kt,action:gt.action,hasEagerState:gt.hasEagerState,eagerState:gt.eagerState,next:null};Ne===null?(Ce=Ne=rn,Q=A):Ne=Ne.next=rn,Ma.lanes|=Kt,D0|=Kt}gt=gt.next}while(gt!==null&&gt!==z);Ne===null?Q=A:Ne.next=Ce,fr(A,y.memoizedState)||(Mi=!0),y.memoizedState=A,y.baseState=Q,y.baseQueue=Ne,C.lastRenderedState=A}if(p=C.interleaved,p!==null){N=p;do z=N.lane,Ma.lanes|=z,D0|=z,N=N.next;while(N!==p)}else N===null&&(C.lanes=0);return[y.memoizedState,C.dispatch]}function y1(p){var y=hl(),C=y.queue;if(C===null)throw Error(n(311));C.lastRenderedReducer=p;var A=C.dispatch,N=C.pending,z=y.memoizedState;if(N!==null){C.pending=null;var Q=N=N.next;do z=p(z,Q.action),Q=Q.next;while(Q!==N);fr(z,y.memoizedState)||(Mi=!0),y.memoizedState=z,y.baseQueue===null&&(y.baseState=z),C.lastRenderedState=z}return[z,A]}function kw(){}function Rw(p,y){var C=Ma,A=hl(),N=y(),z=!fr(A.memoizedState,N);if(z&&(A.memoizedState=N,Mi=!0),A=A.queue,b1(Ew.bind(null,C,A,p),[p]),A.getSnapshot!==y||z||gs!==null&&gs.memoizedState.tag&1){if(C.flags|=2048,Yf(9,jw.bind(null,C,A,N,y),void 0,null),ys===null)throw Error(n(349));(O0&30)!==0||Aw(C,y,N)}return N}function Aw(p,y,C){p.flags|=16384,p={getSnapshot:y,value:C},y=Ma.updateQueue,y===null?(y={lastEffect:null,stores:null},Ma.updateQueue=y,y.stores=[p]):(C=y.stores,C===null?y.stores=[p]:C.push(p))}function jw(p,y,C,A){y.value=C,y.getSnapshot=A,Tw(y)&&Iw(p)}function Ew(p,y,C){return C(function(){Tw(y)&&Iw(p)})}function Tw(p){var y=p.getSnapshot;p=p.value;try{var C=y();return!fr(p,C)}catch{return!0}}function Iw(p){var y=Hc(p,1);y!==null&&Bl(y,p,1,-1)}function Pw(p){var y=pc();return typeof p=="function"&&(p=p()),y.memoizedState=y.baseState=p,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Uf,lastRenderedState:p},y.queue=p,p=p.dispatch=LE.bind(null,Ma,p),[y.memoizedState,p]}function Yf(p,y,C,A){return p={tag:p,create:y,destroy:C,deps:A,next:null},y=Ma.updateQueue,y===null?(y={lastEffect:null,stores:null},Ma.updateQueue=y,y.lastEffect=p.next=p):(C=y.lastEffect,C===null?y.lastEffect=p.next=p:(A=C.next,C.next=p,p.next=A,y.lastEffect=p)),p}function Fw(){return hl().memoizedState}function Bm(p,y,C,A){var N=pc();Ma.flags|=p,N.memoizedState=Yf(1|y,C,void 0,A===void 0?null:A)}function $m(p,y,C,A){var N=hl();A=A===void 0?null:A;var z=void 0;if(ls!==null){var Q=ls.memoizedState;if(z=Q.destroy,A!==null&&f1(A,Q.deps)){N.memoizedState=Yf(y,C,z,A);return}}Ma.flags|=p,N.memoizedState=Yf(1|y,C,z,A)}function _w(p,y){return Bm(8390656,8,p,y)}function b1(p,y){return $m(2048,8,p,y)}function Nw(p,y){return $m(4,2,p,y)}function Ow(p,y){return $m(4,4,p,y)}function Dw(p,y){if(typeof y=="function")return p=p(),y(p),function(){y(null)};if(y!=null)return p=p(),y.current=p,function(){y.current=null}}function Lw(p,y,C){return C=C!=null?C.concat([p]):null,$m(4,4,Dw.bind(null,y,p),C)}function x1(){}function zw(p,y){var C=hl();y=y===void 0?null:y;var A=C.memoizedState;return A!==null&&y!==null&&f1(y,A[1])?A[0]:(C.memoizedState=[p,y],p)}function Bw(p,y){var C=hl();y=y===void 0?null:y;var A=C.memoizedState;return A!==null&&y!==null&&f1(y,A[1])?A[0]:(p=p(),C.memoizedState=[p,y],p)}function $w(p,y,C){return(O0&21)===0?(p.baseState&&(p.baseState=!1,Mi=!0),p.memoizedState=C):(fr(C,y)||(C=fs(),Ma.lanes|=C,D0|=C,p.baseState=!0),y)}function OE(p,y){var C=ee;ee=C!==0&&4>C?C:4,p(!0);var A=h1.transition;h1.transition={};try{p(!1),y()}finally{ee=C,h1.transition=A}}function qw(){return hl().memoizedState}function DE(p,y,C){var A=Nd(p);if(C={lane:A,action:C,hasEagerState:!1,eagerState:null,next:null},Hw(p))Ww(y,C);else if(C=vw(p,y,C,A),C!==null){var N=oi();Bl(C,p,A,N),Gw(C,y,A)}}function LE(p,y,C){var A=Nd(p),N={lane:A,action:C,hasEagerState:!1,eagerState:null,next:null};if(Hw(p))Ww(y,N);else{var z=p.alternate;if(p.lanes===0&&(z===null||z.lanes===0)&&(z=y.lastRenderedReducer,z!==null))try{var Q=y.lastRenderedState,Ce=z(Q,C);if(N.hasEagerState=!0,N.eagerState=Ce,fr(Ce,Q)){var Ne=y.interleaved;Ne===null?(N.next=N,s1(y)):(N.next=Ne.next,Ne.next=N),y.interleaved=N;return}}catch{}finally{}C=vw(p,y,N,A),C!==null&&(N=oi(),Bl(C,p,A,N),Gw(C,y,A))}}function Hw(p){var y=p.alternate;return p===Ma||y!==null&&y===Ma}function Ww(p,y){Gf=zm=!0;var C=p.pending;C===null?y.next=y:(y.next=C.next,C.next=y),p.pending=y}function Gw(p,y,C){if((C&4194240)!==0){var A=y.lanes;A&=p.pendingLanes,C|=A,y.lanes=C,D(p,C)}}var qm={readContext:ul,useCallback:Ws,useContext:Ws,useEffect:Ws,useImperativeHandle:Ws,useInsertionEffect:Ws,useLayoutEffect:Ws,useMemo:Ws,useReducer:Ws,useRef:Ws,useState:Ws,useDebugValue:Ws,useDeferredValue:Ws,useTransition:Ws,useMutableSource:Ws,useSyncExternalStore:Ws,useId:Ws,unstable_isNewReconciler:!1},zE={readContext:ul,useCallback:function(p,y){return pc().memoizedState=[p,y===void 0?null:y],p},useContext:ul,useEffect:_w,useImperativeHandle:function(p,y,C){return C=C!=null?C.concat([p]):null,Bm(4194308,4,Dw.bind(null,y,p),C)},useLayoutEffect:function(p,y){return Bm(4194308,4,p,y)},useInsertionEffect:function(p,y){return Bm(4,2,p,y)},useMemo:function(p,y){var C=pc();return y=y===void 0?null:y,p=p(),C.memoizedState=[p,y],p},useReducer:function(p,y,C){var A=pc();return y=C!==void 0?C(y):y,A.memoizedState=A.baseState=y,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:y},A.queue=p,p=p.dispatch=DE.bind(null,Ma,p),[A.memoizedState,p]},useRef:function(p){var y=pc();return p={current:p},y.memoizedState=p},useState:Pw,useDebugValue:x1,useDeferredValue:function(p){return pc().memoizedState=p},useTransition:function(){var p=Pw(!1),y=p[0];return p=OE.bind(null,p[1]),pc().memoizedState=p,[y,p]},useMutableSource:function(){},useSyncExternalStore:function(p,y,C){var A=Ma,N=pc();if(pa){if(C===void 0)throw Error(n(407));C=C()}else{if(C=y(),ys===null)throw Error(n(349));(O0&30)!==0||Aw(A,y,C)}N.memoizedState=C;var z={value:C,getSnapshot:y};return N.queue=z,_w(Ew.bind(null,A,z,p),[p]),A.flags|=2048,Yf(9,jw.bind(null,A,z,C,y),void 0,null),C},useId:function(){var p=pc(),y=ys.identifierPrefix;if(pa){var C=fn,A=qn;C=(A&~(1<<32-ir(A)-1)).toString(32)+C,y=":"+y+"R"+C,C=Vf++,0<C&&(y+="H"+C.toString(32)),y+=":"}else C=NE++,y=":"+y+"r"+C.toString(32)+":";return p.memoizedState=y},unstable_isNewReconciler:!1},BE={readContext:ul,useCallback:zw,useContext:ul,useEffect:b1,useImperativeHandle:Lw,useInsertionEffect:Nw,useLayoutEffect:Ow,useMemo:Bw,useReducer:g1,useRef:Fw,useState:function(){return g1(Uf)},useDebugValue:x1,useDeferredValue:function(p){var y=hl();return $w(y,ls.memoizedState,p)},useTransition:function(){var p=g1(Uf)[0],y=hl().memoizedState;return[p,y]},useMutableSource:kw,useSyncExternalStore:Rw,useId:qw,unstable_isNewReconciler:!1},$E={readContext:ul,useCallback:zw,useContext:ul,useEffect:b1,useImperativeHandle:Lw,useInsertionEffect:Nw,useLayoutEffect:Ow,useMemo:Bw,useReducer:y1,useRef:Fw,useState:function(){return y1(Uf)},useDebugValue:x1,useDeferredValue:function(p){var y=hl();return ls===null?y.memoizedState=p:$w(y,ls.memoizedState,p)},useTransition:function(){var p=y1(Uf)[0],y=hl().memoizedState;return[p,y]},useMutableSource:kw,useSyncExternalStore:Rw,useId:qw,unstable_isNewReconciler:!1};function Dl(p,y){if(p&&p.defaultProps){y=P({},y),p=p.defaultProps;for(var C in p)y[C]===void 0&&(y[C]=p[C]);return y}return y}function v1(p,y,C,A){y=p.memoizedState,C=C(A,y),C=C==null?y:P({},y,C),p.memoizedState=C,p.lanes===0&&(p.updateQueue.baseState=C)}var Hm={isMounted:function(p){return(p=p._reactInternals)?$e(p)===p:!1},enqueueSetState:function(p,y,C){p=p._reactInternals;var A=oi(),N=Nd(p),z=Wc(A,N);z.payload=y,C!=null&&(z.callback=C),y=Id(p,z,N),y!==null&&(Bl(y,p,N,A),Nm(y,p,N))},enqueueReplaceState:function(p,y,C){p=p._reactInternals;var A=oi(),N=Nd(p),z=Wc(A,N);z.tag=1,z.payload=y,C!=null&&(z.callback=C),y=Id(p,z,N),y!==null&&(Bl(y,p,N,A),Nm(y,p,N))},enqueueForceUpdate:function(p,y){p=p._reactInternals;var C=oi(),A=Nd(p),N=Wc(C,A);N.tag=2,y!=null&&(N.callback=y),y=Id(p,N,A),y!==null&&(Bl(y,p,A,C),Nm(y,p,A))}};function Vw(p,y,C,A,N,z,Q){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(A,z,Q):y.prototype&&y.prototype.isPureReactComponent?!Oo(C,A)||!Oo(N,z):!0}function Uw(p,y,C){var A=!1,N=ro,z=y.contextType;return typeof z=="object"&&z!==null?z=ul(z):(N=Uo(y)?zr:Gn.current,A=y.contextTypes,z=(A=A!=null)?oo(p,N):ro),y=new y(C,z),p.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,y.updater=Hm,p.stateNode=y,y._reactInternals=p,A&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=N,p.__reactInternalMemoizedMaskedChildContext=z),y}function Yw(p,y,C,A){p=y.state,typeof y.componentWillReceiveProps=="function"&&y.componentWillReceiveProps(C,A),typeof y.UNSAFE_componentWillReceiveProps=="function"&&y.UNSAFE_componentWillReceiveProps(C,A),y.state!==p&&Hm.enqueueReplaceState(y,y.state,null)}function S1(p,y,C,A){var N=p.stateNode;N.props=C,N.state=p.memoizedState,N.refs={},i1(p);var z=y.contextType;typeof z=="object"&&z!==null?N.context=ul(z):(z=Uo(y)?zr:Gn.current,N.context=oo(p,z)),N.state=p.memoizedState,z=y.getDerivedStateFromProps,typeof z=="function"&&(v1(p,y,z,C),N.state=p.memoizedState),typeof y.getDerivedStateFromProps=="function"||typeof N.getSnapshotBeforeUpdate=="function"||typeof N.UNSAFE_componentWillMount!="function"&&typeof N.componentWillMount!="function"||(y=N.state,typeof N.componentWillMount=="function"&&N.componentWillMount(),typeof N.UNSAFE_componentWillMount=="function"&&N.UNSAFE_componentWillMount(),y!==N.state&&Hm.enqueueReplaceState(N,N.state,null),Om(p,C,N,A),N.state=p.memoizedState),typeof N.componentDidMount=="function"&&(p.flags|=4194308)}function rh(p,y){try{var C="",A=y;do C+=we(A),A=A.return;while(A);var N=C}catch(z){N=`
Error generating stack: `+z.message+`
`+z.stack}return{value:p,source:y,stack:N,digest:null}}function w1(p,y,C){return{value:p,source:null,stack:C??null,digest:y??null}}function M1(p,y){try{console.error(y.value)}catch(C){setTimeout(function(){throw C})}}var qE=typeof WeakMap=="function"?WeakMap:Map;function Kw(p,y,C){C=Wc(-1,C),C.tag=3,C.payload={element:null};var A=y.value;return C.callback=function(){Xm||(Xm=!0,L1=A),M1(p,y)},C}function Xw(p,y,C){C=Wc(-1,C),C.tag=3;var A=p.type.getDerivedStateFromError;if(typeof A=="function"){var N=y.value;C.payload=function(){return A(N)},C.callback=function(){M1(p,y)}}var z=p.stateNode;return z!==null&&typeof z.componentDidCatch=="function"&&(C.callback=function(){M1(p,y),typeof A!="function"&&(Fd===null?Fd=new Set([this]):Fd.add(this));var Q=y.stack;this.componentDidCatch(y.value,{componentStack:Q!==null?Q:""})}),C}function Jw(p,y,C){var A=p.pingCache;if(A===null){A=p.pingCache=new qE;var N=new Set;A.set(y,N)}else N=A.get(y),N===void 0&&(N=new Set,A.set(y,N));N.has(C)||(N.add(C),p=nT.bind(null,p,y,C),y.then(p,p))}function Qw(p){do{var y;if((y=p.tag===13)&&(y=p.memoizedState,y=y!==null?y.dehydrated!==null:!0),y)return p;p=p.return}while(p!==null);return null}function Zw(p,y,C,A,N){return(p.mode&1)===0?(p===y?p.flags|=65536:(p.flags|=128,C.flags|=131072,C.flags&=-52805,C.tag===1&&(C.alternate===null?C.tag=17:(y=Wc(-1,1),y.tag=2,Id(C,y,1))),C.lanes|=1),p):(p.flags|=65536,p.lanes=N,p)}var HE=k.ReactCurrentOwner,Mi=!1;function ri(p,y,C,A){y.child=p===null?xw(y,null,C,A):Zu(y,p.child,C,A)}function e3(p,y,C,A,N){C=C.render;var z=y.ref;return th(y,N),A=p1(p,y,C,A,z,N),C=m1(),p!==null&&!Mi?(y.updateQueue=p.updateQueue,y.flags&=-2053,p.lanes&=~N,Gc(p,y,N)):(pa&&C&&sa(y),y.flags|=1,ri(p,y,A,N),y.child)}function t3(p,y,C,A,N){if(p===null){var z=C.type;return typeof z=="function"&&!G1(z)&&z.defaultProps===void 0&&C.compare===null&&C.defaultProps===void 0?(y.tag=15,y.type=z,n3(p,y,z,A,N)):(p=ng(C.type,null,A,y,y.mode,N),p.ref=y.ref,p.return=y,y.child=p)}if(z=p.child,(p.lanes&N)===0){var Q=z.memoizedProps;if(C=C.compare,C=C!==null?C:Oo,C(Q,A)&&p.ref===y.ref)return Gc(p,y,N)}return y.flags|=1,p=Dd(z,A),p.ref=y.ref,p.return=y,y.child=p}function n3(p,y,C,A,N){if(p!==null){var z=p.memoizedProps;if(Oo(z,A)&&p.ref===y.ref)if(Mi=!1,y.pendingProps=A=z,(p.lanes&N)!==0)(p.flags&131072)!==0&&(Mi=!0);else return y.lanes=p.lanes,Gc(p,y,N)}return C1(p,y,C,A,N)}function r3(p,y,C){var A=y.pendingProps,N=A.children,z=p!==null?p.memoizedState:null;if(A.mode==="hidden")if((y.mode&1)===0)y.memoizedState={baseLanes:0,cachePool:null,transitions:null},Kn(ah,Ui),Ui|=C;else{if((C&1073741824)===0)return p=z!==null?z.baseLanes|C:C,y.lanes=y.childLanes=1073741824,y.memoizedState={baseLanes:p,cachePool:null,transitions:null},y.updateQueue=null,Kn(ah,Ui),Ui|=p,null;y.memoizedState={baseLanes:0,cachePool:null,transitions:null},A=z!==null?z.baseLanes:C,Kn(ah,Ui),Ui|=A}else z!==null?(A=z.baseLanes|C,y.memoizedState=null):A=C,Kn(ah,Ui),Ui|=A;return ri(p,y,N,C),y.child}function o3(p,y){var C=y.ref;(p===null&&C!==null||p!==null&&p.ref!==C)&&(y.flags|=512,y.flags|=2097152)}function C1(p,y,C,A,N){var z=Uo(C)?zr:Gn.current;return z=oo(y,z),th(y,N),C=p1(p,y,C,A,z,N),A=m1(),p!==null&&!Mi?(y.updateQueue=p.updateQueue,y.flags&=-2053,p.lanes&=~N,Gc(p,y,N)):(pa&&A&&sa(y),y.flags|=1,ri(p,y,C,N),y.child)}function a3(p,y,C,A,N){if(Uo(C)){var z=!0;P0(y)}else z=!1;if(th(y,N),y.stateNode===null)Gm(p,y),Uw(y,C,A),S1(y,C,A,N),A=!0;else if(p===null){var Q=y.stateNode,Ce=y.memoizedProps;Q.props=Ce;var Ne=Q.context,gt=C.contextType;typeof gt=="object"&&gt!==null?gt=ul(gt):(gt=Uo(C)?zr:Gn.current,gt=oo(y,gt));var Kt=C.getDerivedStateFromProps,rn=typeof Kt=="function"||typeof Q.getSnapshotBeforeUpdate=="function";rn||typeof Q.UNSAFE_componentWillReceiveProps!="function"&&typeof Q.componentWillReceiveProps!="function"||(Ce!==A||Ne!==gt)&&Yw(y,Q,A,gt),Td=!1;var Gt=y.memoizedState;Q.state=Gt,Om(y,A,Q,N),Ne=y.memoizedState,Ce!==A||Gt!==Ne||Jr.current||Td?(typeof Kt=="function"&&(v1(y,C,Kt,A),Ne=y.memoizedState),(Ce=Td||Vw(y,C,Ce,A,Gt,Ne,gt))?(rn||typeof Q.UNSAFE_componentWillMount!="function"&&typeof Q.componentWillMount!="function"||(typeof Q.componentWillMount=="function"&&Q.componentWillMount(),typeof Q.UNSAFE_componentWillMount=="function"&&Q.UNSAFE_componentWillMount()),typeof Q.componentDidMount=="function"&&(y.flags|=4194308)):(typeof Q.componentDidMount=="function"&&(y.flags|=4194308),y.memoizedProps=A,y.memoizedState=Ne),Q.props=A,Q.state=Ne,Q.context=gt,A=Ce):(typeof Q.componentDidMount=="function"&&(y.flags|=4194308),A=!1)}else{Q=y.stateNode,Sw(p,y),Ce=y.memoizedProps,gt=y.type===y.elementType?Ce:Dl(y.type,Ce),Q.props=gt,rn=y.pendingProps,Gt=Q.context,Ne=C.contextType,typeof Ne=="object"&&Ne!==null?Ne=ul(Ne):(Ne=Uo(C)?zr:Gn.current,Ne=oo(y,Ne));var Dn=C.getDerivedStateFromProps;(Kt=typeof Dn=="function"||typeof Q.getSnapshotBeforeUpdate=="function")||typeof Q.UNSAFE_componentWillReceiveProps!="function"&&typeof Q.componentWillReceiveProps!="function"||(Ce!==rn||Gt!==Ne)&&Yw(y,Q,A,Ne),Td=!1,Gt=y.memoizedState,Q.state=Gt,Om(y,A,Q,N);var Xn=y.memoizedState;Ce!==rn||Gt!==Xn||Jr.current||Td?(typeof Dn=="function"&&(v1(y,C,Dn,A),Xn=y.memoizedState),(gt=Td||Vw(y,C,gt,A,Gt,Xn,Ne)||!1)?(Kt||typeof Q.UNSAFE_componentWillUpdate!="function"&&typeof Q.componentWillUpdate!="function"||(typeof Q.componentWillUpdate=="function"&&Q.componentWillUpdate(A,Xn,Ne),typeof Q.UNSAFE_componentWillUpdate=="function"&&Q.UNSAFE_componentWillUpdate(A,Xn,Ne)),typeof Q.componentDidUpdate=="function"&&(y.flags|=4),typeof Q.getSnapshotBeforeUpdate=="function"&&(y.flags|=1024)):(typeof Q.componentDidUpdate!="function"||Ce===p.memoizedProps&&Gt===p.memoizedState||(y.flags|=4),typeof Q.getSnapshotBeforeUpdate!="function"||Ce===p.memoizedProps&&Gt===p.memoizedState||(y.flags|=1024),y.memoizedProps=A,y.memoizedState=Xn),Q.props=A,Q.state=Xn,Q.context=Ne,A=gt):(typeof Q.componentDidUpdate!="function"||Ce===p.memoizedProps&&Gt===p.memoizedState||(y.flags|=4),typeof Q.getSnapshotBeforeUpdate!="function"||Ce===p.memoizedProps&&Gt===p.memoizedState||(y.flags|=1024),A=!1)}return k1(p,y,C,A,z,N)}function k1(p,y,C,A,N,z){o3(p,y);var Q=(y.flags&128)!==0;if(!A&&!Q)return N&&zf(y,C,!1),Gc(p,y,z);A=y.stateNode,HE.current=y;var Ce=Q&&typeof C.getDerivedStateFromError!="function"?null:A.render();return y.flags|=1,p!==null&&Q?(y.child=Zu(y,p.child,null,z),y.child=Zu(y,null,Ce,z)):ri(p,y,Ce,z),y.memoizedState=A.state,N&&zf(y,C,!0),y.child}function s3(p){var y=p.stateNode;y.pendingContext?Hs(p,y.pendingContext,y.pendingContext!==y.context):y.context&&Hs(p,y.context,!1),l1(p,y.containerInfo)}function i3(p,y,C,A,N){return Qu(),t1(N),y.flags|=256,ri(p,y,C,A),y.child}var R1={dehydrated:null,treeContext:null,retryLane:0};function A1(p){return{baseLanes:p,cachePool:null,transitions:null}}function l3(p,y,C){var A=y.pendingProps,N=wa.current,z=!1,Q=(y.flags&128)!==0,Ce;if((Ce=Q)||(Ce=p!==null&&p.memoizedState===null?!1:(N&2)!==0),Ce?(z=!0,y.flags&=-129):(p===null||p.memoizedState!==null)&&(N|=1),Kn(wa,N&1),p===null)return e1(y),p=y.memoizedState,p!==null&&(p=p.dehydrated,p!==null)?((y.mode&1)===0?y.lanes=1:p.data==="$!"?y.lanes=8:y.lanes=1073741824,null):(Q=A.children,p=A.fallback,z?(A=y.mode,z=y.child,Q={mode:"hidden",children:Q},(A&1)===0&&z!==null?(z.childLanes=0,z.pendingProps=Q):z=rg(Q,A,0,null),p=$0(p,A,C,null),z.return=y,p.return=y,z.sibling=p,y.child=z,y.child.memoizedState=A1(C),y.memoizedState=R1,p):j1(y,Q));if(N=p.memoizedState,N!==null&&(Ce=N.dehydrated,Ce!==null))return WE(p,y,Q,A,Ce,N,C);if(z){z=A.fallback,Q=y.mode,N=p.child,Ce=N.sibling;var Ne={mode:"hidden",children:A.children};return(Q&1)===0&&y.child!==N?(A=y.child,A.childLanes=0,A.pendingProps=Ne,y.deletions=null):(A=Dd(N,Ne),A.subtreeFlags=N.subtreeFlags&14680064),Ce!==null?z=Dd(Ce,z):(z=$0(z,Q,C,null),z.flags|=2),z.return=y,A.return=y,A.sibling=z,y.child=A,A=z,z=y.child,Q=p.child.memoizedState,Q=Q===null?A1(C):{baseLanes:Q.baseLanes|C,cachePool:null,transitions:Q.transitions},z.memoizedState=Q,z.childLanes=p.childLanes&~C,y.memoizedState=R1,A}return z=p.child,p=z.sibling,A=Dd(z,{mode:"visible",children:A.children}),(y.mode&1)===0&&(A.lanes=C),A.return=y,A.sibling=null,p!==null&&(C=y.deletions,C===null?(y.deletions=[p],y.flags|=16):C.push(p)),y.child=A,y.memoizedState=null,A}function j1(p,y){return y=rg({mode:"visible",children:y},p.mode,0,null),y.return=p,p.child=y}function Wm(p,y,C,A){return A!==null&&t1(A),Zu(y,p.child,null,C),p=j1(y,y.pendingProps.children),p.flags|=2,y.memoizedState=null,p}function WE(p,y,C,A,N,z,Q){if(C)return y.flags&256?(y.flags&=-257,A=w1(Error(n(422))),Wm(p,y,Q,A)):y.memoizedState!==null?(y.child=p.child,y.flags|=128,null):(z=A.fallback,N=y.mode,A=rg({mode:"visible",children:A.children},N,0,null),z=$0(z,N,Q,null),z.flags|=2,A.return=y,z.return=y,A.sibling=z,y.child=A,(y.mode&1)!==0&&Zu(y,p.child,null,Q),y.child.memoizedState=A1(Q),y.memoizedState=R1,z);if((y.mode&1)===0)return Wm(p,y,Q,null);if(N.data==="$!"){if(A=N.nextSibling&&N.nextSibling.dataset,A)var Ce=A.dgst;return A=Ce,z=Error(n(419)),A=w1(z,A,void 0),Wm(p,y,Q,A)}if(Ce=(Q&p.childLanes)!==0,Mi||Ce){if(A=ys,A!==null){switch(Q&-Q){case 4:N=2;break;case 16:N=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:N=32;break;case 536870912:N=268435456;break;default:N=0}N=(N&(A.suspendedLanes|Q))!==0?0:N,N!==0&&N!==z.retryLane&&(z.retryLane=N,Hc(p,N),Bl(A,p,N,-1))}return W1(),A=w1(Error(n(421))),Wm(p,y,Q,A)}return N.data==="$?"?(y.flags|=128,y.child=p.child,y=rT.bind(null,p),N._reactRetry=y,null):(p=z.treeContext,Ts=Ia(N.nextSibling),Es=y,pa=!0,Ol=null,p!==null&&(Mn[En++]=qn,Mn[En++]=fn,Mn[En++]=Un,qn=p.id,fn=p.overflow,Un=y),y=j1(y,A.children),y.flags|=4096,y)}function c3(p,y,C){p.lanes|=y;var A=p.alternate;A!==null&&(A.lanes|=y),a1(p.return,y,C)}function E1(p,y,C,A,N){var z=p.memoizedState;z===null?p.memoizedState={isBackwards:y,rendering:null,renderingStartTime:0,last:A,tail:C,tailMode:N}:(z.isBackwards=y,z.rendering=null,z.renderingStartTime=0,z.last=A,z.tail=C,z.tailMode=N)}function d3(p,y,C){var A=y.pendingProps,N=A.revealOrder,z=A.tail;if(ri(p,y,A.children,C),A=wa.current,(A&2)!==0)A=A&1|2,y.flags|=128;else{if(p!==null&&(p.flags&128)!==0)e:for(p=y.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&c3(p,C,y);else if(p.tag===19)c3(p,C,y);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===y)break e;for(;p.sibling===null;){if(p.return===null||p.return===y)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}A&=1}if(Kn(wa,A),(y.mode&1)===0)y.memoizedState=null;else switch(N){case"forwards":for(C=y.child,N=null;C!==null;)p=C.alternate,p!==null&&Dm(p)===null&&(N=C),C=C.sibling;C=N,C===null?(N=y.child,y.child=null):(N=C.sibling,C.sibling=null),E1(y,!1,N,C,z);break;case"backwards":for(C=null,N=y.child,y.child=null;N!==null;){if(p=N.alternate,p!==null&&Dm(p)===null){y.child=N;break}p=N.sibling,N.sibling=C,C=N,N=p}E1(y,!0,C,null,z);break;case"together":E1(y,!1,null,null,void 0);break;default:y.memoizedState=null}return y.child}function Gm(p,y){(y.mode&1)===0&&p!==null&&(p.alternate=null,y.alternate=null,y.flags|=2)}function Gc(p,y,C){if(p!==null&&(y.dependencies=p.dependencies),D0|=y.lanes,(C&y.childLanes)===0)return null;if(p!==null&&y.child!==p.child)throw Error(n(153));if(y.child!==null){for(p=y.child,C=Dd(p,p.pendingProps),y.child=C,C.return=y;p.sibling!==null;)p=p.sibling,C=C.sibling=Dd(p,p.pendingProps),C.return=y;C.sibling=null}return y.child}function GE(p,y,C){switch(y.tag){case 3:s3(y),Qu();break;case 5:Cw(y);break;case 1:Uo(y.type)&&P0(y);break;case 4:l1(y,y.stateNode.containerInfo);break;case 10:var A=y.type._context,N=y.memoizedProps.value;Kn(Fm,A._currentValue),A._currentValue=N;break;case 13:if(A=y.memoizedState,A!==null)return A.dehydrated!==null?(Kn(wa,wa.current&1),y.flags|=128,null):(C&y.child.childLanes)!==0?l3(p,y,C):(Kn(wa,wa.current&1),p=Gc(p,y,C),p!==null?p.sibling:null);Kn(wa,wa.current&1);break;case 19:if(A=(C&y.childLanes)!==0,(p.flags&128)!==0){if(A)return d3(p,y,C);y.flags|=128}if(N=y.memoizedState,N!==null&&(N.rendering=null,N.tail=null,N.lastEffect=null),Kn(wa,wa.current),A)break;return null;case 22:case 23:return y.lanes=0,r3(p,y,C)}return Gc(p,y,C)}var u3,T1,h3,f3;u3=function(p,y){for(var C=y.child;C!==null;){if(C.tag===5||C.tag===6)p.appendChild(C.stateNode);else if(C.tag!==4&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===y)break;for(;C.sibling===null;){if(C.return===null||C.return===y)return;C=C.return}C.sibling.return=C.return,C=C.sibling}},T1=function(){},h3=function(p,y,C,A){var N=p.memoizedProps;if(N!==A){p=y.stateNode,N0(fc.current);var z=null;switch(C){case"input":N=nt(p,N),A=nt(p,A),z=[];break;case"select":N=P({},N,{value:void 0}),A=P({},A,{value:void 0}),z=[];break;case"textarea":N=Ke(p,N),A=Ke(p,A),z=[];break;default:typeof N.onClick!="function"&&typeof A.onClick=="function"&&(p.onclick=er)}Zt(C,A);var Q;C=null;for(gt in N)if(!A.hasOwnProperty(gt)&&N.hasOwnProperty(gt)&&N[gt]!=null)if(gt==="style"){var Ce=N[gt];for(Q in Ce)Ce.hasOwnProperty(Q)&&(C||(C={}),C[Q]="")}else gt!=="dangerouslySetInnerHTML"&&gt!=="children"&&gt!=="suppressContentEditableWarning"&&gt!=="suppressHydrationWarning"&&gt!=="autoFocus"&&(a.hasOwnProperty(gt)?z||(z=[]):(z=z||[]).push(gt,null));for(gt in A){var Ne=A[gt];if(Ce=N!=null?N[gt]:void 0,A.hasOwnProperty(gt)&&Ne!==Ce&&(Ne!=null||Ce!=null))if(gt==="style")if(Ce){for(Q in Ce)!Ce.hasOwnProperty(Q)||Ne&&Ne.hasOwnProperty(Q)||(C||(C={}),C[Q]="");for(Q in Ne)Ne.hasOwnProperty(Q)&&Ce[Q]!==Ne[Q]&&(C||(C={}),C[Q]=Ne[Q])}else C||(z||(z=[]),z.push(gt,C)),C=Ne;else gt==="dangerouslySetInnerHTML"?(Ne=Ne?Ne.__html:void 0,Ce=Ce?Ce.__html:void 0,Ne!=null&&Ce!==Ne&&(z=z||[]).push(gt,Ne)):gt==="children"?typeof Ne!="string"&&typeof Ne!="number"||(z=z||[]).push(gt,""+Ne):gt!=="suppressContentEditableWarning"&&gt!=="suppressHydrationWarning"&&(a.hasOwnProperty(gt)?(Ne!=null&&gt==="onScroll"&&So("scroll",p),z||Ce===Ne||(z=[])):(z=z||[]).push(gt,Ne))}C&&(z=z||[]).push("style",C);var gt=z;(y.updateQueue=gt)&&(y.flags|=4)}},f3=function(p,y,C,A){C!==A&&(y.flags|=4)};function Kf(p,y){if(!pa)switch(p.tailMode){case"hidden":y=p.tail;for(var C=null;y!==null;)y.alternate!==null&&(C=y),y=y.sibling;C===null?p.tail=null:C.sibling=null;break;case"collapsed":C=p.tail;for(var A=null;C!==null;)C.alternate!==null&&(A=C),C=C.sibling;A===null?y||p.tail===null?p.tail=null:p.tail.sibling=null:A.sibling=null}}function Gs(p){var y=p.alternate!==null&&p.alternate.child===p.child,C=0,A=0;if(y)for(var N=p.child;N!==null;)C|=N.lanes|N.childLanes,A|=N.subtreeFlags&14680064,A|=N.flags&14680064,N.return=p,N=N.sibling;else for(N=p.child;N!==null;)C|=N.lanes|N.childLanes,A|=N.subtreeFlags,A|=N.flags,N.return=p,N=N.sibling;return p.subtreeFlags|=A,p.childLanes=C,y}function VE(p,y,C){var A=y.pendingProps;switch(Vi(y),y.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Gs(y),null;case 1:return Uo(y.type)&&ni(),Gs(y),null;case 3:return A=y.stateNode,nh(),Wt(Jr),Wt(Gn),u1(),A.pendingContext&&(A.context=A.pendingContext,A.pendingContext=null),(p===null||p.child===null)&&(Im(y)?y.flags|=4:p===null||p.memoizedState.isDehydrated&&(y.flags&256)===0||(y.flags|=1024,Ol!==null&&($1(Ol),Ol=null))),T1(p,y),Gs(y),null;case 5:c1(y);var N=N0(Wf.current);if(C=y.type,p!==null&&y.stateNode!=null)h3(p,y,C,A,N),p.ref!==y.ref&&(y.flags|=512,y.flags|=2097152);else{if(!A){if(y.stateNode===null)throw Error(n(166));return Gs(y),null}if(p=N0(fc.current),Im(y)){A=y.stateNode,C=y.type;var z=y.memoizedProps;switch(A[Y]=y,A[ze]=z,p=(y.mode&1)!==0,C){case"dialog":So("cancel",A),So("close",A);break;case"iframe":case"object":case"embed":So("load",A);break;case"video":case"audio":for(N=0;N<Ot.length;N++)So(Ot[N],A);break;case"source":So("error",A);break;case"img":case"image":case"link":So("error",A),So("load",A);break;case"details":So("toggle",A);break;case"input":pt(A,z),So("invalid",A);break;case"select":A._wrapperState={wasMultiple:!!z.multiple},So("invalid",A);break;case"textarea":mt(A,z),So("invalid",A)}Zt(C,z),N=null;for(var Q in z)if(z.hasOwnProperty(Q)){var Ce=z[Q];Q==="children"?typeof Ce=="string"?A.textContent!==Ce&&(z.suppressHydrationWarning!==!0&&In(A.textContent,Ce,p),N=["children",Ce]):typeof Ce=="number"&&A.textContent!==""+Ce&&(z.suppressHydrationWarning!==!0&&In(A.textContent,Ce,p),N=["children",""+Ce]):a.hasOwnProperty(Q)&&Ce!=null&&Q==="onScroll"&&So("scroll",A)}switch(C){case"input":Fe(A),Ct(A,z,!0);break;case"textarea":Fe(A),gn(A);break;case"select":case"option":break;default:typeof z.onClick=="function"&&(A.onclick=er)}A=N,y.updateQueue=A,A!==null&&(y.flags|=4)}else{Q=N.nodeType===9?N:N.ownerDocument,p==="http://www.w3.org/1999/xhtml"&&(p=Be(C)),p==="http://www.w3.org/1999/xhtml"?C==="script"?(p=Q.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild)):typeof A.is=="string"?p=Q.createElement(C,{is:A.is}):(p=Q.createElement(C),C==="select"&&(Q=p,A.multiple?Q.multiple=!0:A.size&&(Q.size=A.size))):p=Q.createElementNS(p,C),p[Y]=y,p[ze]=A,u3(p,y,!1,!1),y.stateNode=p;e:{switch(Q=Pe(C,A),C){case"dialog":So("cancel",p),So("close",p),N=A;break;case"iframe":case"object":case"embed":So("load",p),N=A;break;case"video":case"audio":for(N=0;N<Ot.length;N++)So(Ot[N],p);N=A;break;case"source":So("error",p),N=A;break;case"img":case"image":case"link":So("error",p),So("load",p),N=A;break;case"details":So("toggle",p),N=A;break;case"input":pt(p,A),N=nt(p,A),So("invalid",p);break;case"option":N=A;break;case"select":p._wrapperState={wasMultiple:!!A.multiple},N=P({},A,{value:void 0}),So("invalid",p);break;case"textarea":mt(p,A),N=Ke(p,A),So("invalid",p);break;default:N=A}Zt(C,N),Ce=N;for(z in Ce)if(Ce.hasOwnProperty(z)){var Ne=Ce[z];z==="style"?wt(p,Ne):z==="dangerouslySetInnerHTML"?(Ne=Ne?Ne.__html:void 0,Ne!=null&&nr(p,Ne)):z==="children"?typeof Ne=="string"?(C!=="textarea"||Ne!=="")&&_n(p,Ne):typeof Ne=="number"&&_n(p,""+Ne):z!=="suppressContentEditableWarning"&&z!=="suppressHydrationWarning"&&z!=="autoFocus"&&(a.hasOwnProperty(z)?Ne!=null&&z==="onScroll"&&So("scroll",p):Ne!=null&&M(p,z,Ne,Q))}switch(C){case"input":Fe(p),Ct(p,A,!1);break;case"textarea":Fe(p),gn(p);break;case"option":A.value!=null&&p.setAttribute("value",""+_e(A.value));break;case"select":p.multiple=!!A.multiple,z=A.value,z!=null?Le(p,!!A.multiple,z,!1):A.defaultValue!=null&&Le(p,!!A.multiple,A.defaultValue,!0);break;default:typeof N.onClick=="function"&&(p.onclick=er)}switch(C){case"button":case"input":case"select":case"textarea":A=!!A.autoFocus;break e;case"img":A=!0;break e;default:A=!1}}A&&(y.flags|=4)}y.ref!==null&&(y.flags|=512,y.flags|=2097152)}return Gs(y),null;case 6:if(p&&y.stateNode!=null)f3(p,y,p.memoizedProps,A);else{if(typeof A!="string"&&y.stateNode===null)throw Error(n(166));if(C=N0(Wf.current),N0(fc.current),Im(y)){if(A=y.stateNode,C=y.memoizedProps,A[Y]=y,(z=A.nodeValue!==C)&&(p=Es,p!==null))switch(p.tag){case 3:In(A.nodeValue,C,(p.mode&1)!==0);break;case 5:p.memoizedProps.suppressHydrationWarning!==!0&&In(A.nodeValue,C,(p.mode&1)!==0)}z&&(y.flags|=4)}else A=(C.nodeType===9?C:C.ownerDocument).createTextNode(A),A[Y]=y,y.stateNode=A}return Gs(y),null;case 13:if(Wt(wa),A=y.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(pa&&Ts!==null&&(y.mode&1)!==0&&(y.flags&128)===0)gw(),Qu(),y.flags|=98560,z=!1;else if(z=Im(y),A!==null&&A.dehydrated!==null){if(p===null){if(!z)throw Error(n(318));if(z=y.memoizedState,z=z!==null?z.dehydrated:null,!z)throw Error(n(317));z[Y]=y}else Qu(),(y.flags&128)===0&&(y.memoizedState=null),y.flags|=4;Gs(y),z=!1}else Ol!==null&&($1(Ol),Ol=null),z=!0;if(!z)return y.flags&65536?y:null}return(y.flags&128)!==0?(y.lanes=C,y):(A=A!==null,A!==(p!==null&&p.memoizedState!==null)&&A&&(y.child.flags|=8192,(y.mode&1)!==0&&(p===null||(wa.current&1)!==0?cs===0&&(cs=3):W1())),y.updateQueue!==null&&(y.flags|=4),Gs(y),null);case 4:return nh(),T1(p,y),p===null&&hc(y.stateNode.containerInfo),Gs(y),null;case 10:return o1(y.type._context),Gs(y),null;case 17:return Uo(y.type)&&ni(),Gs(y),null;case 19:if(Wt(wa),z=y.memoizedState,z===null)return Gs(y),null;if(A=(y.flags&128)!==0,Q=z.rendering,Q===null)if(A)Kf(z,!1);else{if(cs!==0||p!==null&&(p.flags&128)!==0)for(p=y.child;p!==null;){if(Q=Dm(p),Q!==null){for(y.flags|=128,Kf(z,!1),A=Q.updateQueue,A!==null&&(y.updateQueue=A,y.flags|=4),y.subtreeFlags=0,A=C,C=y.child;C!==null;)z=C,p=A,z.flags&=14680066,Q=z.alternate,Q===null?(z.childLanes=0,z.lanes=p,z.child=null,z.subtreeFlags=0,z.memoizedProps=null,z.memoizedState=null,z.updateQueue=null,z.dependencies=null,z.stateNode=null):(z.childLanes=Q.childLanes,z.lanes=Q.lanes,z.child=Q.child,z.subtreeFlags=0,z.deletions=null,z.memoizedProps=Q.memoizedProps,z.memoizedState=Q.memoizedState,z.updateQueue=Q.updateQueue,z.type=Q.type,p=Q.dependencies,z.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),C=C.sibling;return Kn(wa,wa.current&1|2),y.child}p=p.sibling}z.tail!==null&&zn()>sh&&(y.flags|=128,A=!0,Kf(z,!1),y.lanes=4194304)}else{if(!A)if(p=Dm(Q),p!==null){if(y.flags|=128,A=!0,C=p.updateQueue,C!==null&&(y.updateQueue=C,y.flags|=4),Kf(z,!0),z.tail===null&&z.tailMode==="hidden"&&!Q.alternate&&!pa)return Gs(y),null}else 2*zn()-z.renderingStartTime>sh&&C!==1073741824&&(y.flags|=128,A=!0,Kf(z,!1),y.lanes=4194304);z.isBackwards?(Q.sibling=y.child,y.child=Q):(C=z.last,C!==null?C.sibling=Q:y.child=Q,z.last=Q)}return z.tail!==null?(y=z.tail,z.rendering=y,z.tail=y.sibling,z.renderingStartTime=zn(),y.sibling=null,C=wa.current,Kn(wa,A?C&1|2:C&1),y):(Gs(y),null);case 22:case 23:return H1(),A=y.memoizedState!==null,p!==null&&p.memoizedState!==null!==A&&(y.flags|=8192),A&&(y.mode&1)!==0?(Ui&1073741824)!==0&&(Gs(y),y.subtreeFlags&6&&(y.flags|=8192)):Gs(y),null;case 24:return null;case 25:return null}throw Error(n(156,y.tag))}function UE(p,y){switch(Vi(y),y.tag){case 1:return Uo(y.type)&&ni(),p=y.flags,p&65536?(y.flags=p&-65537|128,y):null;case 3:return nh(),Wt(Jr),Wt(Gn),u1(),p=y.flags,(p&65536)!==0&&(p&128)===0?(y.flags=p&-65537|128,y):null;case 5:return c1(y),null;case 13:if(Wt(wa),p=y.memoizedState,p!==null&&p.dehydrated!==null){if(y.alternate===null)throw Error(n(340));Qu()}return p=y.flags,p&65536?(y.flags=p&-65537|128,y):null;case 19:return Wt(wa),null;case 4:return nh(),null;case 10:return o1(y.type._context),null;case 22:case 23:return H1(),null;case 24:return null;default:return null}}var Vm=!1,Vs=!1,YE=typeof WeakSet=="function"?WeakSet:Set,Vn=null;function oh(p,y){var C=p.ref;if(C!==null)if(typeof C=="function")try{C(null)}catch(A){Pa(p,y,A)}else C.current=null}function I1(p,y,C){try{C()}catch(A){Pa(p,y,A)}}var p3=!1;function KE(p,y){if(pr=rr,p=Wi(),cl(p)){if("selectionStart"in p)var C={start:p.selectionStart,end:p.selectionEnd};else e:{C=(C=p.ownerDocument)&&C.defaultView||window;var A=C.getSelection&&C.getSelection();if(A&&A.rangeCount!==0){C=A.anchorNode;var N=A.anchorOffset,z=A.focusNode;A=A.focusOffset;try{C.nodeType,z.nodeType}catch{C=null;break e}var Q=0,Ce=-1,Ne=-1,gt=0,Kt=0,rn=p,Gt=null;t:for(;;){for(var Dn;rn!==C||N!==0&&rn.nodeType!==3||(Ce=Q+N),rn!==z||A!==0&&rn.nodeType!==3||(Ne=Q+A),rn.nodeType===3&&(Q+=rn.nodeValue.length),(Dn=rn.firstChild)!==null;)Gt=rn,rn=Dn;for(;;){if(rn===p)break t;if(Gt===C&&++gt===N&&(Ce=Q),Gt===z&&++Kt===A&&(Ne=Q),(Dn=rn.nextSibling)!==null)break;rn=Gt,Gt=rn.parentNode}rn=Dn}C=Ce===-1||Ne===-1?null:{start:Ce,end:Ne}}else C=null}C=C||{start:0,end:0}}else C=null;for(Mr={focusedElem:p,selectionRange:C},rr=!1,Vn=y;Vn!==null;)if(y=Vn,p=y.child,(y.subtreeFlags&1028)!==0&&p!==null)p.return=y,Vn=p;else for(;Vn!==null;){y=Vn;try{var Xn=y.alternate;if((y.flags&1024)!==0)switch(y.tag){case 0:case 11:case 15:break;case 1:if(Xn!==null){var Qn=Xn.memoizedProps,Ha=Xn.memoizedState,ot=y.stateNode,qe=ot.getSnapshotBeforeUpdate(y.elementType===y.type?Qn:Dl(y.type,Qn),Ha);ot.__reactInternalSnapshotBeforeUpdate=qe}break;case 3:var lt=y.stateNode.containerInfo;lt.nodeType===1?lt.textContent="":lt.nodeType===9&&lt.documentElement&&lt.removeChild(lt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(n(163))}}catch(un){Pa(y,y.return,un)}if(p=y.sibling,p!==null){p.return=y.return,Vn=p;break}Vn=y.return}return Xn=p3,p3=!1,Xn}function Xf(p,y,C){var A=y.updateQueue;if(A=A!==null?A.lastEffect:null,A!==null){var N=A=A.next;do{if((N.tag&p)===p){var z=N.destroy;N.destroy=void 0,z!==void 0&&I1(y,C,z)}N=N.next}while(N!==A)}}function Um(p,y){if(y=y.updateQueue,y=y!==null?y.lastEffect:null,y!==null){var C=y=y.next;do{if((C.tag&p)===p){var A=C.create;C.destroy=A()}C=C.next}while(C!==y)}}function P1(p){var y=p.ref;if(y!==null){var C=p.stateNode;switch(p.tag){case 5:p=C;break;default:p=C}typeof y=="function"?y(p):y.current=p}}function m3(p){var y=p.alternate;y!==null&&(p.alternate=null,m3(y)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(y=p.stateNode,y!==null&&(delete y[Y],delete y[ze],delete y[We],delete y[jt],delete y[Ge])),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}function g3(p){return p.tag===5||p.tag===3||p.tag===4}function y3(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||g3(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function F1(p,y,C){var A=p.tag;if(A===5||A===6)p=p.stateNode,y?C.nodeType===8?C.parentNode.insertBefore(p,y):C.insertBefore(p,y):(C.nodeType===8?(y=C.parentNode,y.insertBefore(p,C)):(y=C,y.appendChild(p)),C=C._reactRootContainer,C!=null||y.onclick!==null||(y.onclick=er));else if(A!==4&&(p=p.child,p!==null))for(F1(p,y,C),p=p.sibling;p!==null;)F1(p,y,C),p=p.sibling}function _1(p,y,C){var A=p.tag;if(A===5||A===6)p=p.stateNode,y?C.insertBefore(p,y):C.appendChild(p);else if(A!==4&&(p=p.child,p!==null))for(_1(p,y,C),p=p.sibling;p!==null;)_1(p,y,C),p=p.sibling}var Is=null,Ll=!1;function Pd(p,y,C){for(C=C.child;C!==null;)b3(p,y,C),C=C.sibling}function b3(p,y,C){if(Zn&&typeof Zn.onCommitFiberUnmount=="function")try{Zn.onCommitFiberUnmount(_r,C)}catch{}switch(C.tag){case 5:Vs||oh(C,y);case 6:var A=Is,N=Ll;Is=null,Pd(p,y,C),Is=A,Ll=N,Is!==null&&(Ll?(p=Is,C=C.stateNode,p.nodeType===8?p.parentNode.removeChild(C):p.removeChild(C)):Is.removeChild(C.stateNode));break;case 18:Is!==null&&(Ll?(p=Is,C=C.stateNode,p.nodeType===8?fa(p.parentNode,C):p.nodeType===1&&fa(p,C),mn(p)):fa(Is,C.stateNode));break;case 4:A=Is,N=Ll,Is=C.stateNode.containerInfo,Ll=!0,Pd(p,y,C),Is=A,Ll=N;break;case 0:case 11:case 14:case 15:if(!Vs&&(A=C.updateQueue,A!==null&&(A=A.lastEffect,A!==null))){N=A=A.next;do{var z=N,Q=z.destroy;z=z.tag,Q!==void 0&&((z&2)!==0||(z&4)!==0)&&I1(C,y,Q),N=N.next}while(N!==A)}Pd(p,y,C);break;case 1:if(!Vs&&(oh(C,y),A=C.stateNode,typeof A.componentWillUnmount=="function"))try{A.props=C.memoizedProps,A.state=C.memoizedState,A.componentWillUnmount()}catch(Ce){Pa(C,y,Ce)}Pd(p,y,C);break;case 21:Pd(p,y,C);break;case 22:C.mode&1?(Vs=(A=Vs)||C.memoizedState!==null,Pd(p,y,C),Vs=A):Pd(p,y,C);break;default:Pd(p,y,C)}}function x3(p){var y=p.updateQueue;if(y!==null){p.updateQueue=null;var C=p.stateNode;C===null&&(C=p.stateNode=new YE),y.forEach(function(A){var N=oT.bind(null,p,A);C.has(A)||(C.add(A),A.then(N,N))})}}function zl(p,y){var C=y.deletions;if(C!==null)for(var A=0;A<C.length;A++){var N=C[A];try{var z=p,Q=y,Ce=Q;e:for(;Ce!==null;){switch(Ce.tag){case 5:Is=Ce.stateNode,Ll=!1;break e;case 3:Is=Ce.stateNode.containerInfo,Ll=!0;break e;case 4:Is=Ce.stateNode.containerInfo,Ll=!0;break e}Ce=Ce.return}if(Is===null)throw Error(n(160));b3(z,Q,N),Is=null,Ll=!1;var Ne=N.alternate;Ne!==null&&(Ne.return=null),N.return=null}catch(gt){Pa(N,y,gt)}}if(y.subtreeFlags&12854)for(y=y.child;y!==null;)v3(y,p),y=y.sibling}function v3(p,y){var C=p.alternate,A=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:if(zl(y,p),mc(p),A&4){try{Xf(3,p,p.return),Um(3,p)}catch(Qn){Pa(p,p.return,Qn)}try{Xf(5,p,p.return)}catch(Qn){Pa(p,p.return,Qn)}}break;case 1:zl(y,p),mc(p),A&512&&C!==null&&oh(C,C.return);break;case 5:if(zl(y,p),mc(p),A&512&&C!==null&&oh(C,C.return),p.flags&32){var N=p.stateNode;try{_n(N,"")}catch(Qn){Pa(p,p.return,Qn)}}if(A&4&&(N=p.stateNode,N!=null)){var z=p.memoizedProps,Q=C!==null?C.memoizedProps:z,Ce=p.type,Ne=p.updateQueue;if(p.updateQueue=null,Ne!==null)try{Ce==="input"&&z.type==="radio"&&z.name!=null&&Et(N,z),Pe(Ce,Q);var gt=Pe(Ce,z);for(Q=0;Q<Ne.length;Q+=2){var Kt=Ne[Q],rn=Ne[Q+1];Kt==="style"?wt(N,rn):Kt==="dangerouslySetInnerHTML"?nr(N,rn):Kt==="children"?_n(N,rn):M(N,Kt,rn,gt)}switch(Ce){case"input":_t(N,z);break;case"textarea":an(N,z);break;case"select":var Gt=N._wrapperState.wasMultiple;N._wrapperState.wasMultiple=!!z.multiple;var Dn=z.value;Dn!=null?Le(N,!!z.multiple,Dn,!1):Gt!==!!z.multiple&&(z.defaultValue!=null?Le(N,!!z.multiple,z.defaultValue,!0):Le(N,!!z.multiple,z.multiple?[]:"",!1))}N[ze]=z}catch(Qn){Pa(p,p.return,Qn)}}break;case 6:if(zl(y,p),mc(p),A&4){if(p.stateNode===null)throw Error(n(162));N=p.stateNode,z=p.memoizedProps;try{N.nodeValue=z}catch(Qn){Pa(p,p.return,Qn)}}break;case 3:if(zl(y,p),mc(p),A&4&&C!==null&&C.memoizedState.isDehydrated)try{mn(y.containerInfo)}catch(Qn){Pa(p,p.return,Qn)}break;case 4:zl(y,p),mc(p);break;case 13:zl(y,p),mc(p),N=p.child,N.flags&8192&&(z=N.memoizedState!==null,N.stateNode.isHidden=z,!z||N.alternate!==null&&N.alternate.memoizedState!==null||(D1=zn())),A&4&&x3(p);break;case 22:if(Kt=C!==null&&C.memoizedState!==null,p.mode&1?(Vs=(gt=Vs)||Kt,zl(y,p),Vs=gt):zl(y,p),mc(p),A&8192){if(gt=p.memoizedState!==null,(p.stateNode.isHidden=gt)&&!Kt&&(p.mode&1)!==0)for(Vn=p,Kt=p.child;Kt!==null;){for(rn=Vn=Kt;Vn!==null;){switch(Gt=Vn,Dn=Gt.child,Gt.tag){case 0:case 11:case 14:case 15:Xf(4,Gt,Gt.return);break;case 1:oh(Gt,Gt.return);var Xn=Gt.stateNode;if(typeof Xn.componentWillUnmount=="function"){A=Gt,C=Gt.return;try{y=A,Xn.props=y.memoizedProps,Xn.state=y.memoizedState,Xn.componentWillUnmount()}catch(Qn){Pa(A,C,Qn)}}break;case 5:oh(Gt,Gt.return);break;case 22:if(Gt.memoizedState!==null){M3(rn);continue}}Dn!==null?(Dn.return=Gt,Vn=Dn):M3(rn)}Kt=Kt.sibling}e:for(Kt=null,rn=p;;){if(rn.tag===5){if(Kt===null){Kt=rn;try{N=rn.stateNode,gt?(z=N.style,typeof z.setProperty=="function"?z.setProperty("display","none","important"):z.display="none"):(Ce=rn.stateNode,Ne=rn.memoizedProps.style,Q=Ne!=null&&Ne.hasOwnProperty("display")?Ne.display:null,Ce.style.display=Cn("display",Q))}catch(Qn){Pa(p,p.return,Qn)}}}else if(rn.tag===6){if(Kt===null)try{rn.stateNode.nodeValue=gt?"":rn.memoizedProps}catch(Qn){Pa(p,p.return,Qn)}}else if((rn.tag!==22&&rn.tag!==23||rn.memoizedState===null||rn===p)&&rn.child!==null){rn.child.return=rn,rn=rn.child;continue}if(rn===p)break e;for(;rn.sibling===null;){if(rn.return===null||rn.return===p)break e;Kt===rn&&(Kt=null),rn=rn.return}Kt===rn&&(Kt=null),rn.sibling.return=rn.return,rn=rn.sibling}}break;case 19:zl(y,p),mc(p),A&4&&x3(p);break;case 21:break;default:zl(y,p),mc(p)}}function mc(p){var y=p.flags;if(y&2){try{e:{for(var C=p.return;C!==null;){if(g3(C)){var A=C;break e}C=C.return}throw Error(n(160))}switch(A.tag){case 5:var N=A.stateNode;A.flags&32&&(_n(N,""),A.flags&=-33);var z=y3(p);_1(p,z,N);break;case 3:case 4:var Q=A.stateNode.containerInfo,Ce=y3(p);F1(p,Ce,Q);break;default:throw Error(n(161))}}catch(Ne){Pa(p,p.return,Ne)}p.flags&=-3}y&4096&&(p.flags&=-4097)}function XE(p,y,C){Vn=p,S3(p)}function S3(p,y,C){for(var A=(p.mode&1)!==0;Vn!==null;){var N=Vn,z=N.child;if(N.tag===22&&A){var Q=N.memoizedState!==null||Vm;if(!Q){var Ce=N.alternate,Ne=Ce!==null&&Ce.memoizedState!==null||Vs;Ce=Vm;var gt=Vs;if(Vm=Q,(Vs=Ne)&&!gt)for(Vn=N;Vn!==null;)Q=Vn,Ne=Q.child,Q.tag===22&&Q.memoizedState!==null?C3(N):Ne!==null?(Ne.return=Q,Vn=Ne):C3(N);for(;z!==null;)Vn=z,S3(z),z=z.sibling;Vn=N,Vm=Ce,Vs=gt}w3(p)}else(N.subtreeFlags&8772)!==0&&z!==null?(z.return=N,Vn=z):w3(p)}}function w3(p){for(;Vn!==null;){var y=Vn;if((y.flags&8772)!==0){var C=y.alternate;try{if((y.flags&8772)!==0)switch(y.tag){case 0:case 11:case 15:Vs||Um(5,y);break;case 1:var A=y.stateNode;if(y.flags&4&&!Vs)if(C===null)A.componentDidMount();else{var N=y.elementType===y.type?C.memoizedProps:Dl(y.type,C.memoizedProps);A.componentDidUpdate(N,C.memoizedState,A.__reactInternalSnapshotBeforeUpdate)}var z=y.updateQueue;z!==null&&Mw(y,z,A);break;case 3:var Q=y.updateQueue;if(Q!==null){if(C=null,y.child!==null)switch(y.child.tag){case 5:C=y.child.stateNode;break;case 1:C=y.child.stateNode}Mw(y,Q,C)}break;case 5:var Ce=y.stateNode;if(C===null&&y.flags&4){C=Ce;var Ne=y.memoizedProps;switch(y.type){case"button":case"input":case"select":case"textarea":Ne.autoFocus&&C.focus();break;case"img":Ne.src&&(C.src=Ne.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(y.memoizedState===null){var gt=y.alternate;if(gt!==null){var Kt=gt.memoizedState;if(Kt!==null){var rn=Kt.dehydrated;rn!==null&&mn(rn)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(n(163))}Vs||y.flags&512&&P1(y)}catch(Gt){Pa(y,y.return,Gt)}}if(y===p){Vn=null;break}if(C=y.sibling,C!==null){C.return=y.return,Vn=C;break}Vn=y.return}}function M3(p){for(;Vn!==null;){var y=Vn;if(y===p){Vn=null;break}var C=y.sibling;if(C!==null){C.return=y.return,Vn=C;break}Vn=y.return}}function C3(p){for(;Vn!==null;){var y=Vn;try{switch(y.tag){case 0:case 11:case 15:var C=y.return;try{Um(4,y)}catch(Ne){Pa(y,C,Ne)}break;case 1:var A=y.stateNode;if(typeof A.componentDidMount=="function"){var N=y.return;try{A.componentDidMount()}catch(Ne){Pa(y,N,Ne)}}var z=y.return;try{P1(y)}catch(Ne){Pa(y,z,Ne)}break;case 5:var Q=y.return;try{P1(y)}catch(Ne){Pa(y,Q,Ne)}}}catch(Ne){Pa(y,y.return,Ne)}if(y===p){Vn=null;break}var Ce=y.sibling;if(Ce!==null){Ce.return=y.return,Vn=Ce;break}Vn=y.return}}var JE=Math.ceil,Ym=k.ReactCurrentDispatcher,N1=k.ReactCurrentOwner,fl=k.ReactCurrentBatchConfig,yo=0,ys=null,es=null,Ps=0,Ui=0,ah=wn(0),cs=0,Jf=null,D0=0,Km=0,O1=0,Qf=null,Ci=null,D1=0,sh=1/0,Vc=null,Xm=!1,L1=null,Fd=null,Jm=!1,_d=null,Qm=0,Zf=0,z1=null,Zm=-1,eg=0;function oi(){return(yo&6)!==0?zn():Zm!==-1?Zm:Zm=zn()}function Nd(p){return(p.mode&1)===0?1:(yo&2)!==0&&Ps!==0?Ps&-Ps:_E.transition!==null?(eg===0&&(eg=fs()),eg):(p=ee,p!==0||(p=window.event,p=p===void 0?16:no(p.type)),p)}function Bl(p,y,C,A){if(50<Zf)throw Zf=0,z1=null,Error(n(185));Xo(p,C,A),((yo&2)===0||p!==ys)&&(p===ys&&((yo&2)===0&&(Km|=C),cs===4&&Od(p,Ps)),ki(p,A),C===1&&yo===0&&(y.mode&1)===0&&(sh=zn()+500,F0&&Nl()))}function ki(p,y){var C=p.callbackNode;os(p,y);var A=Ya(p,p===ys?Ps:0);if(A===0)C!==null&&It(C),p.callbackNode=null,p.callbackPriority=0;else if(y=A&-A,p.callbackPriority!==y){if(C!=null&&It(C),y===1)p.tag===0?Tm(R3.bind(null,p)):Bf(R3.bind(null,p)),Qa(function(){(yo&6)===0&&Nl()}),C=null;else{switch(Ie(A)){case 1:C=wr;break;case 4:C=vn;break;case 16:C=Gr;break;case 536870912:C=jr;break;default:C=Gr}C=_3(C,k3.bind(null,p))}p.callbackPriority=y,p.callbackNode=C}}function k3(p,y){if(Zm=-1,eg=0,(yo&6)!==0)throw Error(n(327));var C=p.callbackNode;if(ih()&&p.callbackNode!==C)return null;var A=Ya(p,p===ys?Ps:0);if(A===0)return null;if((A&30)!==0||(A&p.expiredLanes)!==0||y)y=tg(p,A);else{y=A;var N=yo;yo|=2;var z=j3();(ys!==p||Ps!==y)&&(Vc=null,sh=zn()+500,z0(p,y));do try{eT();break}catch(Ce){A3(p,Ce)}while(!0);r1(),Ym.current=z,yo=N,es!==null?y=0:(ys=null,Ps=0,y=cs)}if(y!==0){if(y===2&&(N=Ho(p),N!==0&&(A=N,y=B1(p,N))),y===1)throw C=Jf,z0(p,0),Od(p,A),ki(p,zn()),C;if(y===6)Od(p,A);else{if(N=p.current.alternate,(A&30)===0&&!QE(N)&&(y=tg(p,A),y===2&&(z=Ho(p),z!==0&&(A=z,y=B1(p,z))),y===1))throw C=Jf,z0(p,0),Od(p,A),ki(p,zn()),C;switch(p.finishedWork=N,p.finishedLanes=A,y){case 0:case 1:throw Error(n(345));case 2:B0(p,Ci,Vc);break;case 3:if(Od(p,A),(A&130023424)===A&&(y=D1+500-zn(),10<y)){if(Ya(p,0)!==0)break;if(N=p.suspendedLanes,(N&A)!==A){oi(),p.pingedLanes|=p.suspendedLanes&N;break}p.timeoutHandle=uo(B0.bind(null,p,Ci,Vc),y);break}B0(p,Ci,Vc);break;case 4:if(Od(p,A),(A&4194240)===A)break;for(y=p.eventTimes,N=-1;0<A;){var Q=31-ir(A);z=1<<Q,Q=y[Q],Q>N&&(N=Q),A&=~z}if(A=N,A=zn()-A,A=(120>A?120:480>A?480:1080>A?1080:1920>A?1920:3e3>A?3e3:4320>A?4320:1960*JE(A/1960))-A,10<A){p.timeoutHandle=uo(B0.bind(null,p,Ci,Vc),A);break}B0(p,Ci,Vc);break;case 5:B0(p,Ci,Vc);break;default:throw Error(n(329))}}}return ki(p,zn()),p.callbackNode===C?k3.bind(null,p):null}function B1(p,y){var C=Qf;return p.current.memoizedState.isDehydrated&&(z0(p,y).flags|=256),p=tg(p,y),p!==2&&(y=Ci,Ci=C,y!==null&&$1(y)),p}function $1(p){Ci===null?Ci=p:Ci.push.apply(Ci,p)}function QE(p){for(var y=p;;){if(y.flags&16384){var C=y.updateQueue;if(C!==null&&(C=C.stores,C!==null))for(var A=0;A<C.length;A++){var N=C[A],z=N.getSnapshot;N=N.value;try{if(!fr(z(),N))return!1}catch{return!1}}}if(C=y.child,y.subtreeFlags&16384&&C!==null)C.return=y,y=C;else{if(y===p)break;for(;y.sibling===null;){if(y.return===null||y.return===p)return!0;y=y.return}y.sibling.return=y.return,y=y.sibling}}return!0}function Od(p,y){for(y&=~O1,y&=~Km,p.suspendedLanes|=y,p.pingedLanes&=~y,p=p.expirationTimes;0<y;){var C=31-ir(y),A=1<<C;p[C]=-1,y&=~A}}function R3(p){if((yo&6)!==0)throw Error(n(327));ih();var y=Ya(p,0);if((y&1)===0)return ki(p,zn()),null;var C=tg(p,y);if(p.tag!==0&&C===2){var A=Ho(p);A!==0&&(y=A,C=B1(p,A))}if(C===1)throw C=Jf,z0(p,0),Od(p,y),ki(p,zn()),C;if(C===6)throw Error(n(345));return p.finishedWork=p.current.alternate,p.finishedLanes=y,B0(p,Ci,Vc),ki(p,zn()),null}function q1(p,y){var C=yo;yo|=1;try{return p(y)}finally{yo=C,yo===0&&(sh=zn()+500,F0&&Nl())}}function L0(p){_d!==null&&_d.tag===0&&(yo&6)===0&&ih();var y=yo;yo|=1;var C=fl.transition,A=ee;try{if(fl.transition=null,ee=1,p)return p()}finally{ee=A,fl.transition=C,yo=y,(yo&6)===0&&Nl()}}function H1(){Ui=ah.current,Wt(ah)}function z0(p,y){p.finishedWork=null,p.finishedLanes=0;var C=p.timeoutHandle;if(C!==-1&&(p.timeoutHandle=-1,ha(C)),es!==null)for(C=es.return;C!==null;){var A=C;switch(Vi(A),A.tag){case 1:A=A.type.childContextTypes,A!=null&&ni();break;case 3:nh(),Wt(Jr),Wt(Gn),u1();break;case 5:c1(A);break;case 4:nh();break;case 13:Wt(wa);break;case 19:Wt(wa);break;case 10:o1(A.type._context);break;case 22:case 23:H1()}C=C.return}if(ys=p,es=p=Dd(p.current,null),Ps=Ui=y,cs=0,Jf=null,O1=Km=D0=0,Ci=Qf=null,_0!==null){for(y=0;y<_0.length;y++)if(C=_0[y],A=C.interleaved,A!==null){C.interleaved=null;var N=A.next,z=C.pending;if(z!==null){var Q=z.next;z.next=N,A.next=Q}C.pending=A}_0=null}return p}function A3(p,y){do{var C=es;try{if(r1(),Lm.current=qm,zm){for(var A=Ma.memoizedState;A!==null;){var N=A.queue;N!==null&&(N.pending=null),A=A.next}zm=!1}if(O0=0,gs=ls=Ma=null,Gf=!1,Vf=0,N1.current=null,C===null||C.return===null){cs=1,Jf=y,es=null;break}e:{var z=p,Q=C.return,Ce=C,Ne=y;if(y=Ps,Ce.flags|=32768,Ne!==null&&typeof Ne=="object"&&typeof Ne.then=="function"){var gt=Ne,Kt=Ce,rn=Kt.tag;if((Kt.mode&1)===0&&(rn===0||rn===11||rn===15)){var Gt=Kt.alternate;Gt?(Kt.updateQueue=Gt.updateQueue,Kt.memoizedState=Gt.memoizedState,Kt.lanes=Gt.lanes):(Kt.updateQueue=null,Kt.memoizedState=null)}var Dn=Qw(Q);if(Dn!==null){Dn.flags&=-257,Zw(Dn,Q,Ce,z,y),Dn.mode&1&&Jw(z,gt,y),y=Dn,Ne=gt;var Xn=y.updateQueue;if(Xn===null){var Qn=new Set;Qn.add(Ne),y.updateQueue=Qn}else Xn.add(Ne);break e}else{if((y&1)===0){Jw(z,gt,y),W1();break e}Ne=Error(n(426))}}else if(pa&&Ce.mode&1){var Ha=Qw(Q);if(Ha!==null){(Ha.flags&65536)===0&&(Ha.flags|=256),Zw(Ha,Q,Ce,z,y),t1(rh(Ne,Ce));break e}}z=Ne=rh(Ne,Ce),cs!==4&&(cs=2),Qf===null?Qf=[z]:Qf.push(z),z=Q;do{switch(z.tag){case 3:z.flags|=65536,y&=-y,z.lanes|=y;var ot=Kw(z,Ne,y);ww(z,ot);break e;case 1:Ce=Ne;var qe=z.type,lt=z.stateNode;if((z.flags&128)===0&&(typeof qe.getDerivedStateFromError=="function"||lt!==null&&typeof lt.componentDidCatch=="function"&&(Fd===null||!Fd.has(lt)))){z.flags|=65536,y&=-y,z.lanes|=y;var un=Xw(z,Ce,y);ww(z,un);break e}}z=z.return}while(z!==null)}T3(C)}catch(or){y=or,es===C&&C!==null&&(es=C=C.return);continue}break}while(!0)}function j3(){var p=Ym.current;return Ym.current=qm,p===null?qm:p}function W1(){(cs===0||cs===3||cs===2)&&(cs=4),ys===null||(D0&268435455)===0&&(Km&268435455)===0||Od(ys,Ps)}function tg(p,y){var C=yo;yo|=2;var A=j3();(ys!==p||Ps!==y)&&(Vc=null,z0(p,y));do try{ZE();break}catch(N){A3(p,N)}while(!0);if(r1(),yo=C,Ym.current=A,es!==null)throw Error(n(261));return ys=null,Ps=0,cs}function ZE(){for(;es!==null;)E3(es)}function eT(){for(;es!==null&&!xn();)E3(es)}function E3(p){var y=F3(p.alternate,p,Ui);p.memoizedProps=p.pendingProps,y===null?T3(p):es=y,N1.current=null}function T3(p){var y=p;do{var C=y.alternate;if(p=y.return,(y.flags&32768)===0){if(C=VE(C,y,Ui),C!==null){es=C;return}}else{if(C=UE(C,y),C!==null){C.flags&=32767,es=C;return}if(p!==null)p.flags|=32768,p.subtreeFlags=0,p.deletions=null;else{cs=6,es=null;return}}if(y=y.sibling,y!==null){es=y;return}es=y=p}while(y!==null);cs===0&&(cs=5)}function B0(p,y,C){var A=ee,N=fl.transition;try{fl.transition=null,ee=1,tT(p,y,C,A)}finally{fl.transition=N,ee=A}return null}function tT(p,y,C,A){do ih();while(_d!==null);if((yo&6)!==0)throw Error(n(327));C=p.finishedWork;var N=p.finishedLanes;if(C===null)return null;if(p.finishedWork=null,p.finishedLanes=0,C===p.current)throw Error(n(177));p.callbackNode=null,p.callbackPriority=0;var z=C.lanes|C.childLanes;if(ks(p,z),p===ys&&(es=ys=null,Ps=0),(C.subtreeFlags&2064)===0&&(C.flags&2064)===0||Jm||(Jm=!0,_3(Gr,function(){return ih(),null})),z=(C.flags&15990)!==0,(C.subtreeFlags&15990)!==0||z){z=fl.transition,fl.transition=null;var Q=ee;ee=1;var Ce=yo;yo|=4,N1.current=null,KE(p,C),v3(C,p),Gi(Mr),rr=!!pr,Mr=pr=null,p.current=C,XE(C),Ln(),yo=Ce,ee=Q,fl.transition=z}else p.current=C;if(Jm&&(Jm=!1,_d=p,Qm=N),z=p.pendingLanes,z===0&&(Fd=null),lo(C.stateNode),ki(p,zn()),y!==null)for(A=p.onRecoverableError,C=0;C<y.length;C++)N=y[C],A(N.value,{componentStack:N.stack,digest:N.digest});if(Xm)throw Xm=!1,p=L1,L1=null,p;return(Qm&1)!==0&&p.tag!==0&&ih(),z=p.pendingLanes,(z&1)!==0?p===z1?Zf++:(Zf=0,z1=p):Zf=0,Nl(),null}function ih(){if(_d!==null){var p=Ie(Qm),y=fl.transition,C=ee;try{if(fl.transition=null,ee=16>p?16:p,_d===null)var A=!1;else{if(p=_d,_d=null,Qm=0,(yo&6)!==0)throw Error(n(331));var N=yo;for(yo|=4,Vn=p.current;Vn!==null;){var z=Vn,Q=z.child;if((Vn.flags&16)!==0){var Ce=z.deletions;if(Ce!==null){for(var Ne=0;Ne<Ce.length;Ne++){var gt=Ce[Ne];for(Vn=gt;Vn!==null;){var Kt=Vn;switch(Kt.tag){case 0:case 11:case 15:Xf(8,Kt,z)}var rn=Kt.child;if(rn!==null)rn.return=Kt,Vn=rn;else for(;Vn!==null;){Kt=Vn;var Gt=Kt.sibling,Dn=Kt.return;if(m3(Kt),Kt===gt){Vn=null;break}if(Gt!==null){Gt.return=Dn,Vn=Gt;break}Vn=Dn}}}var Xn=z.alternate;if(Xn!==null){var Qn=Xn.child;if(Qn!==null){Xn.child=null;do{var Ha=Qn.sibling;Qn.sibling=null,Qn=Ha}while(Qn!==null)}}Vn=z}}if((z.subtreeFlags&2064)!==0&&Q!==null)Q.return=z,Vn=Q;else e:for(;Vn!==null;){if(z=Vn,(z.flags&2048)!==0)switch(z.tag){case 0:case 11:case 15:Xf(9,z,z.return)}var ot=z.sibling;if(ot!==null){ot.return=z.return,Vn=ot;break e}Vn=z.return}}var qe=p.current;for(Vn=qe;Vn!==null;){Q=Vn;var lt=Q.child;if((Q.subtreeFlags&2064)!==0&&lt!==null)lt.return=Q,Vn=lt;else e:for(Q=qe;Vn!==null;){if(Ce=Vn,(Ce.flags&2048)!==0)try{switch(Ce.tag){case 0:case 11:case 15:Um(9,Ce)}}catch(or){Pa(Ce,Ce.return,or)}if(Ce===Q){Vn=null;break e}var un=Ce.sibling;if(un!==null){un.return=Ce.return,Vn=un;break e}Vn=Ce.return}}if(yo=N,Nl(),Zn&&typeof Zn.onPostCommitFiberRoot=="function")try{Zn.onPostCommitFiberRoot(_r,p)}catch{}A=!0}return A}finally{ee=C,fl.transition=y}}return!1}function I3(p,y,C){y=rh(C,y),y=Kw(p,y,1),p=Id(p,y,1),y=oi(),p!==null&&(Xo(p,1,y),ki(p,y))}function Pa(p,y,C){if(p.tag===3)I3(p,p,C);else for(;y!==null;){if(y.tag===3){I3(y,p,C);break}else if(y.tag===1){var A=y.stateNode;if(typeof y.type.getDerivedStateFromError=="function"||typeof A.componentDidCatch=="function"&&(Fd===null||!Fd.has(A))){p=rh(C,p),p=Xw(y,p,1),y=Id(y,p,1),p=oi(),y!==null&&(Xo(y,1,p),ki(y,p));break}}y=y.return}}function nT(p,y,C){var A=p.pingCache;A!==null&&A.delete(y),y=oi(),p.pingedLanes|=p.suspendedLanes&C,ys===p&&(Ps&C)===C&&(cs===4||cs===3&&(Ps&130023424)===Ps&&500>zn()-D1?z0(p,0):O1|=C),ki(p,y)}function P3(p,y){y===0&&((p.mode&1)===0?y=1:(y=ja,ja<<=1,(ja&130023424)===0&&(ja=4194304)));var C=oi();p=Hc(p,y),p!==null&&(Xo(p,y,C),ki(p,C))}function rT(p){var y=p.memoizedState,C=0;y!==null&&(C=y.retryLane),P3(p,C)}function oT(p,y){var C=0;switch(p.tag){case 13:var A=p.stateNode,N=p.memoizedState;N!==null&&(C=N.retryLane);break;case 19:A=p.stateNode;break;default:throw Error(n(314))}A!==null&&A.delete(y),P3(p,C)}var F3;F3=function(p,y,C){if(p!==null)if(p.memoizedProps!==y.pendingProps||Jr.current)Mi=!0;else{if((p.lanes&C)===0&&(y.flags&128)===0)return Mi=!1,GE(p,y,C);Mi=(p.flags&131072)!==0}else Mi=!1,pa&&(y.flags&1048576)!==0&&Sa(y,lr,y.index);switch(y.lanes=0,y.tag){case 2:var A=y.type;Gm(p,y),p=y.pendingProps;var N=oo(y,Gn.current);th(y,C),N=p1(null,y,A,p,N,C);var z=m1();return y.flags|=1,typeof N=="object"&&N!==null&&typeof N.render=="function"&&N.$$typeof===void 0?(y.tag=1,y.memoizedState=null,y.updateQueue=null,Uo(A)?(z=!0,P0(y)):z=!1,y.memoizedState=N.state!==null&&N.state!==void 0?N.state:null,i1(y),N.updater=Hm,y.stateNode=N,N._reactInternals=y,S1(y,A,p,C),y=k1(null,y,A,!0,z,C)):(y.tag=0,pa&&z&&sa(y),ri(null,y,N,C),y=y.child),y;case 16:A=y.elementType;e:{switch(Gm(p,y),p=y.pendingProps,N=A._init,A=N(A._payload),y.type=A,N=y.tag=sT(A),p=Dl(A,p),N){case 0:y=C1(null,y,A,p,C);break e;case 1:y=a3(null,y,A,p,C);break e;case 11:y=e3(null,y,A,p,C);break e;case 14:y=t3(null,y,A,Dl(A.type,p),C);break e}throw Error(n(306,A,""))}return y;case 0:return A=y.type,N=y.pendingProps,N=y.elementType===A?N:Dl(A,N),C1(p,y,A,N,C);case 1:return A=y.type,N=y.pendingProps,N=y.elementType===A?N:Dl(A,N),a3(p,y,A,N,C);case 3:e:{if(s3(y),p===null)throw Error(n(387));A=y.pendingProps,z=y.memoizedState,N=z.element,Sw(p,y),Om(y,A,null,C);var Q=y.memoizedState;if(A=Q.element,z.isDehydrated)if(z={element:A,isDehydrated:!1,cache:Q.cache,pendingSuspenseBoundaries:Q.pendingSuspenseBoundaries,transitions:Q.transitions},y.updateQueue.baseState=z,y.memoizedState=z,y.flags&256){N=rh(Error(n(423)),y),y=i3(p,y,A,C,N);break e}else if(A!==N){N=rh(Error(n(424)),y),y=i3(p,y,A,C,N);break e}else for(Ts=Ia(y.stateNode.containerInfo.firstChild),Es=y,pa=!0,Ol=null,C=xw(y,null,A,C),y.child=C;C;)C.flags=C.flags&-3|4096,C=C.sibling;else{if(Qu(),A===N){y=Gc(p,y,C);break e}ri(p,y,A,C)}y=y.child}return y;case 5:return Cw(y),p===null&&e1(y),A=y.type,N=y.pendingProps,z=p!==null?p.memoizedProps:null,Q=N.children,Fr(A,N)?Q=null:z!==null&&Fr(A,z)&&(y.flags|=32),o3(p,y),ri(p,y,Q,C),y.child;case 6:return p===null&&e1(y),null;case 13:return l3(p,y,C);case 4:return l1(y,y.stateNode.containerInfo),A=y.pendingProps,p===null?y.child=Zu(y,null,A,C):ri(p,y,A,C),y.child;case 11:return A=y.type,N=y.pendingProps,N=y.elementType===A?N:Dl(A,N),e3(p,y,A,N,C);case 7:return ri(p,y,y.pendingProps,C),y.child;case 8:return ri(p,y,y.pendingProps.children,C),y.child;case 12:return ri(p,y,y.pendingProps.children,C),y.child;case 10:e:{if(A=y.type._context,N=y.pendingProps,z=y.memoizedProps,Q=N.value,Kn(Fm,A._currentValue),A._currentValue=Q,z!==null)if(fr(z.value,Q)){if(z.children===N.children&&!Jr.current){y=Gc(p,y,C);break e}}else for(z=y.child,z!==null&&(z.return=y);z!==null;){var Ce=z.dependencies;if(Ce!==null){Q=z.child;for(var Ne=Ce.firstContext;Ne!==null;){if(Ne.context===A){if(z.tag===1){Ne=Wc(-1,C&-C),Ne.tag=2;var gt=z.updateQueue;if(gt!==null){gt=gt.shared;var Kt=gt.pending;Kt===null?Ne.next=Ne:(Ne.next=Kt.next,Kt.next=Ne),gt.pending=Ne}}z.lanes|=C,Ne=z.alternate,Ne!==null&&(Ne.lanes|=C),a1(z.return,C,y),Ce.lanes|=C;break}Ne=Ne.next}}else if(z.tag===10)Q=z.type===y.type?null:z.child;else if(z.tag===18){if(Q=z.return,Q===null)throw Error(n(341));Q.lanes|=C,Ce=Q.alternate,Ce!==null&&(Ce.lanes|=C),a1(Q,C,y),Q=z.sibling}else Q=z.child;if(Q!==null)Q.return=z;else for(Q=z;Q!==null;){if(Q===y){Q=null;break}if(z=Q.sibling,z!==null){z.return=Q.return,Q=z;break}Q=Q.return}z=Q}ri(p,y,N.children,C),y=y.child}return y;case 9:return N=y.type,A=y.pendingProps.children,th(y,C),N=ul(N),A=A(N),y.flags|=1,ri(p,y,A,C),y.child;case 14:return A=y.type,N=Dl(A,y.pendingProps),N=Dl(A.type,N),t3(p,y,A,N,C);case 15:return n3(p,y,y.type,y.pendingProps,C);case 17:return A=y.type,N=y.pendingProps,N=y.elementType===A?N:Dl(A,N),Gm(p,y),y.tag=1,Uo(A)?(p=!0,P0(y)):p=!1,th(y,C),Uw(y,A,N),S1(y,A,N,C),k1(null,y,A,!0,p,C);case 19:return d3(p,y,C);case 22:return r3(p,y,C)}throw Error(n(156,y.tag))};function _3(p,y){return Nn(p,y)}function aT(p,y,C,A){this.tag=p,this.key=C,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=y,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=A,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function pl(p,y,C,A){return new aT(p,y,C,A)}function G1(p){return p=p.prototype,!(!p||!p.isReactComponent)}function sT(p){if(typeof p=="function")return G1(p)?1:0;if(p!=null){if(p=p.$$typeof,p===F)return 11;if(p===re)return 14}return 2}function Dd(p,y){var C=p.alternate;return C===null?(C=pl(p.tag,y,p.key,p.mode),C.elementType=p.elementType,C.type=p.type,C.stateNode=p.stateNode,C.alternate=p,p.alternate=C):(C.pendingProps=y,C.type=p.type,C.flags=0,C.subtreeFlags=0,C.deletions=null),C.flags=p.flags&14680064,C.childLanes=p.childLanes,C.lanes=p.lanes,C.child=p.child,C.memoizedProps=p.memoizedProps,C.memoizedState=p.memoizedState,C.updateQueue=p.updateQueue,y=p.dependencies,C.dependencies=y===null?null:{lanes:y.lanes,firstContext:y.firstContext},C.sibling=p.sibling,C.index=p.index,C.ref=p.ref,C}function ng(p,y,C,A,N,z){var Q=2;if(A=p,typeof p=="function")G1(p)&&(Q=1);else if(typeof p=="string")Q=5;else e:switch(p){case I:return $0(C.children,N,z,y);case E:Q=8,N|=8;break;case O:return p=pl(12,C,y,N|2),p.elementType=O,p.lanes=z,p;case B:return p=pl(13,C,y,N),p.elementType=B,p.lanes=z,p;case W:return p=pl(19,C,y,N),p.elementType=W,p.lanes=z,p;case te:return rg(C,N,z,y);default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case L:Q=10;break e;case $:Q=9;break e;case F:Q=11;break e;case re:Q=14;break e;case oe:Q=16,A=null;break e}throw Error(n(130,p==null?p:typeof p,""))}return y=pl(Q,C,y,N),y.elementType=p,y.type=A,y.lanes=z,y}function $0(p,y,C,A){return p=pl(7,p,A,y),p.lanes=C,p}function rg(p,y,C,A){return p=pl(22,p,A,y),p.elementType=te,p.lanes=C,p.stateNode={isHidden:!1},p}function V1(p,y,C){return p=pl(6,p,null,y),p.lanes=C,p}function U1(p,y,C){return y=pl(4,p.children!==null?p.children:[],p.key,y),y.lanes=C,y.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},y}function iT(p,y,C,A,N){this.tag=y,this.containerInfo=p,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=To(0),this.expirationTimes=To(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=To(0),this.identifierPrefix=A,this.onRecoverableError=N,this.mutableSourceEagerHydrationData=null}function Y1(p,y,C,A,N,z,Q,Ce,Ne){return p=new iT(p,y,C,Ce,Ne),y===1?(y=1,z===!0&&(y|=8)):y=0,z=pl(3,null,null,y),p.current=z,z.stateNode=p,z.memoizedState={element:A,isDehydrated:C,cache:null,transitions:null,pendingSuspenseBoundaries:null},i1(z),p}function lT(p,y,C){var A=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:j,key:A==null?null:""+A,children:p,containerInfo:y,implementation:C}}function N3(p){if(!p)return ro;p=p._reactInternals;e:{if($e(p)!==p||p.tag!==1)throw Error(n(170));var y=p;do{switch(y.tag){case 3:y=y.stateNode.context;break e;case 1:if(Uo(y.type)){y=y.stateNode.__reactInternalMemoizedMergedChildContext;break e}}y=y.return}while(y!==null);throw Error(n(171))}if(p.tag===1){var C=p.type;if(Uo(C))return Lf(p,C,y)}return y}function O3(p,y,C,A,N,z,Q,Ce,Ne){return p=Y1(C,A,!0,p,N,z,Q,Ce,Ne),p.context=N3(null),C=p.current,A=oi(),N=Nd(C),z=Wc(A,N),z.callback=y??null,Id(C,z,N),p.current.lanes=N,Xo(p,N,A),ki(p,A),p}function og(p,y,C,A){var N=y.current,z=oi(),Q=Nd(N);return C=N3(C),y.context===null?y.context=C:y.pendingContext=C,y=Wc(z,Q),y.payload={element:p},A=A===void 0?null:A,A!==null&&(y.callback=A),p=Id(N,y,Q),p!==null&&(Bl(p,N,Q,z),Nm(p,N,Q)),Q}function ag(p){if(p=p.current,!p.child)return null;switch(p.child.tag){case 5:return p.child.stateNode;default:return p.child.stateNode}}function D3(p,y){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var C=p.retryLane;p.retryLane=C!==0&&C<y?C:y}}function K1(p,y){D3(p,y),(p=p.alternate)&&D3(p,y)}function cT(){return null}var L3=typeof reportError=="function"?reportError:function(p){console.error(p)};function X1(p){this._internalRoot=p}sg.prototype.render=X1.prototype.render=function(p){var y=this._internalRoot;if(y===null)throw Error(n(409));og(p,y,null,null)},sg.prototype.unmount=X1.prototype.unmount=function(){var p=this._internalRoot;if(p!==null){this._internalRoot=null;var y=p.containerInfo;L0(function(){og(null,p,null,null)}),y[Ye]=null}};function sg(p){this._internalRoot=p}sg.prototype.unstable_scheduleHydration=function(p){if(p){var y=ce();p={blockedOn:null,target:p,priority:y};for(var C=0;C<rt.length&&y!==0&&y<rt[C].priority;C++);rt.splice(C,0,p),C===0&&ar(p)}};function J1(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)}function ig(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11&&(p.nodeType!==8||p.nodeValue!==" react-mount-point-unstable "))}function z3(){}function dT(p,y,C,A,N){if(N){if(typeof A=="function"){var z=A;A=function(){var gt=ag(Q);z.call(gt)}}var Q=O3(y,A,p,0,null,!1,!1,"",z3);return p._reactRootContainer=Q,p[Ye]=Q.current,hc(p.nodeType===8?p.parentNode:p),L0(),Q}for(;N=p.lastChild;)p.removeChild(N);if(typeof A=="function"){var Ce=A;A=function(){var gt=ag(Ne);Ce.call(gt)}}var Ne=Y1(p,0,!1,null,null,!1,!1,"",z3);return p._reactRootContainer=Ne,p[Ye]=Ne.current,hc(p.nodeType===8?p.parentNode:p),L0(function(){og(y,Ne,C,A)}),Ne}function lg(p,y,C,A,N){var z=C._reactRootContainer;if(z){var Q=z;if(typeof N=="function"){var Ce=N;N=function(){var Ne=ag(Q);Ce.call(Ne)}}og(y,Q,p,N)}else Q=dT(C,y,p,N,A);return ag(Q)}Qe=function(p){switch(p.tag){case 3:var y=p.stateNode;if(y.current.memoizedState.isDehydrated){var C=Co(y.pendingLanes);C!==0&&(D(y,C|1),ki(y,zn()),(yo&6)===0&&(sh=zn()+500,Nl()))}break;case 13:L0(function(){var A=Hc(p,1);if(A!==null){var N=oi();Bl(A,p,1,N)}}),K1(p,1)}},X=function(p){if(p.tag===13){var y=Hc(p,134217728);if(y!==null){var C=oi();Bl(y,p,134217728,C)}K1(p,134217728)}},Z=function(p){if(p.tag===13){var y=Nd(p),C=Hc(p,y);if(C!==null){var A=oi();Bl(C,p,y,A)}K1(p,y)}},ce=function(){return ee},ue=function(p,y){var C=ee;try{return ee=p,y()}finally{ee=C}},xe=function(p,y,C){switch(y){case"input":if(_t(p,C),y=C.name,C.type==="radio"&&y!=null){for(C=p;C.parentNode;)C=C.parentNode;for(C=C.querySelectorAll("input[name="+JSON.stringify(""+y)+'][type="radio"]'),y=0;y<C.length;y++){var A=C[y];if(A!==p&&A.form===p.form){var N=Yt(A);if(!N)throw Error(n(90));Oe(A),_t(A,N)}}}break;case"textarea":an(p,C);break;case"select":y=C.value,y!=null&&Le(p,!!C.multiple,y,!1)}},Ae=q1,Tt=L0;var uT={usingClientEntryPoint:!1,Events:[dt,it,Yt,je,Te,q1]},ep={findFiberByHostInstance:at,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},hT={bundleType:ep.bundleType,version:ep.version,rendererPackageName:ep.rendererPackageName,rendererConfig:ep.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:k.ReactCurrentDispatcher,findHostInstanceByFiber:function(p){return p=ln(p),p===null?null:p.stateNode},findFiberByHostInstance:ep.findFiberByHostInstance||cT,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var cg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!cg.isDisabled&&cg.supportsFiber)try{_r=cg.inject(hT),Zn=cg}catch{}}return Ri.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=uT,Ri.createPortal=function(p,y){var C=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!J1(y))throw Error(n(200));return lT(p,y,null,C)},Ri.createRoot=function(p,y){if(!J1(p))throw Error(n(299));var C=!1,A="",N=L3;return y!=null&&(y.unstable_strictMode===!0&&(C=!0),y.identifierPrefix!==void 0&&(A=y.identifierPrefix),y.onRecoverableError!==void 0&&(N=y.onRecoverableError)),y=Y1(p,1,!1,null,null,C,!1,A,N),p[Ye]=y.current,hc(p.nodeType===8?p.parentNode:p),new X1(y)},Ri.findDOMNode=function(p){if(p==null)return null;if(p.nodeType===1)return p;var y=p._reactInternals;if(y===void 0)throw typeof p.render=="function"?Error(n(188)):(p=Object.keys(p).join(","),Error(n(268,p)));return p=ln(y),p=p===null?null:p.stateNode,p},Ri.flushSync=function(p){return L0(p)},Ri.hydrate=function(p,y,C){if(!ig(y))throw Error(n(200));return lg(null,p,y,!0,C)},Ri.hydrateRoot=function(p,y,C){if(!J1(p))throw Error(n(405));var A=C!=null&&C.hydratedSources||null,N=!1,z="",Q=L3;if(C!=null&&(C.unstable_strictMode===!0&&(N=!0),C.identifierPrefix!==void 0&&(z=C.identifierPrefix),C.onRecoverableError!==void 0&&(Q=C.onRecoverableError)),y=O3(y,null,p,1,C??null,N,!1,z,Q),p[Ye]=y.current,hc(p),A)for(p=0;p<A.length;p++)C=A[p],N=C._getVersion,N=N(C._source),y.mutableSourceEagerHydrationData==null?y.mutableSourceEagerHydrationData=[C,N]:y.mutableSourceEagerHydrationData.push(C,N);return new sg(y)},Ri.render=function(p,y,C){if(!ig(y))throw Error(n(200));return lg(null,p,y,!1,C)},Ri.unmountComponentAtNode=function(p){if(!ig(p))throw Error(n(40));return p._reactRootContainer?(L0(function(){lg(null,null,p,!1,function(){p._reactRootContainer=null,p[Ye]=null})}),!0):!1},Ri.unstable_batchedUpdates=q1,Ri.unstable_renderSubtreeIntoContainer=function(p,y,C,A){if(!ig(C))throw Error(n(200));if(p==null||p._reactInternals===void 0)throw Error(n(38));return lg(p,y,C,!1,A)},Ri.version="18.3.1-next-f1338f8080-20240426",Ri}var U3;function Hk(){if(U3)return e2.exports;U3=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),e2.exports=xT(),e2.exports}var Y3;function vT(){if(Y3)return dg;Y3=1;var e=Hk();return dg.createRoot=e.createRoot,dg.hydrateRoot=e.hydrateRoot,dg}var ST=vT(),wT=Hk();const MT=qk(wT);function CT(e){if(typeof document>"u")return;let t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",t.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}const kT=e=>{switch(e){case"success":return jT;case"info":return TT;case"warning":return ET;case"error":return IT;default:return null}},RT=Array(12).fill(0),AT=({visible:e,className:t})=>on.createElement("div",{className:["sonner-loading-wrapper",t].filter(Boolean).join(" "),"data-visible":e},on.createElement("div",{className:"sonner-spinner"},RT.map((n,r)=>on.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${r}`})))),jT=on.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},on.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),ET=on.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},on.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),TT=on.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},on.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),IT=on.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},on.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),PT=on.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},on.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),on.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),FT=()=>{const[e,t]=on.useState(document.hidden);return on.useEffect(()=>{const n=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",n),()=>window.removeEventListener("visibilitychange",n)},[]),e};let Dx=1;class _T{constructor(){this.subscribe=t=>(this.subscribers.push(t),()=>{const n=this.subscribers.indexOf(t);this.subscribers.splice(n,1)}),this.publish=t=>{this.subscribers.forEach(n=>n(t))},this.addToast=t=>{this.publish(t),this.toasts=[...this.toasts,t]},this.create=t=>{var n;const{message:r,...a}=t,i=typeof(t==null?void 0:t.id)=="number"||((n=t.id)==null?void 0:n.length)>0?t.id:Dx++,s=this.toasts.find(l=>l.id===i),c=t.dismissible===void 0?!0:t.dismissible;return this.dismissedToasts.has(i)&&this.dismissedToasts.delete(i),s?this.toasts=this.toasts.map(l=>l.id===i?(this.publish({...l,...t,id:i,title:r}),{...l,...t,id:i,dismissible:c,title:r}):l):this.addToast({title:r,...a,dismissible:c,id:i}),i},this.dismiss=t=>(t?(this.dismissedToasts.add(t),requestAnimationFrame(()=>this.subscribers.forEach(n=>n({id:t,dismiss:!0})))):this.toasts.forEach(n=>{this.subscribers.forEach(r=>r({id:n.id,dismiss:!0}))}),t),this.message=(t,n)=>this.create({...n,message:t}),this.error=(t,n)=>this.create({...n,message:t,type:"error"}),this.success=(t,n)=>this.create({...n,type:"success",message:t}),this.info=(t,n)=>this.create({...n,type:"info",message:t}),this.warning=(t,n)=>this.create({...n,type:"warning",message:t}),this.loading=(t,n)=>this.create({...n,type:"loading",message:t}),this.promise=(t,n)=>{if(!n)return;let r;n.loading!==void 0&&(r=this.create({...n,promise:t,type:"loading",message:n.loading,description:typeof n.description!="function"?n.description:void 0}));const a=Promise.resolve(t instanceof Function?t():t);let i=r!==void 0,s;const c=a.then(async d=>{if(s=["resolve",d],on.isValidElement(d))i=!1,this.create({id:r,type:"default",message:d});else if(OT(d)&&!d.ok){i=!1;const h=typeof n.error=="function"?await n.error(`HTTP error! status: ${d.status}`):n.error,m=typeof n.description=="function"?await n.description(`HTTP error! status: ${d.status}`):n.description,g=typeof h=="object"&&!on.isValidElement(h)?h:{message:h};this.create({id:r,type:"error",description:m,...g})}else if(d instanceof Error){i=!1;const h=typeof n.error=="function"?await n.error(d):n.error,m=typeof n.description=="function"?await n.description(d):n.description,g=typeof h=="object"&&!on.isValidElement(h)?h:{message:h};this.create({id:r,type:"error",description:m,...g})}else if(n.success!==void 0){i=!1;const h=typeof n.success=="function"?await n.success(d):n.success,m=typeof n.description=="function"?await n.description(d):n.description,g=typeof h=="object"&&!on.isValidElement(h)?h:{message:h};this.create({id:r,type:"success",description:m,...g})}}).catch(async d=>{if(s=["reject",d],n.error!==void 0){i=!1;const u=typeof n.error=="function"?await n.error(d):n.error,h=typeof n.description=="function"?await n.description(d):n.description,f=typeof u=="object"&&!on.isValidElement(u)?u:{message:u};this.create({id:r,type:"error",description:h,...f})}}).finally(()=>{i&&(this.dismiss(r),r=void 0),n.finally==null||n.finally.call(n)}),l=()=>new Promise((d,u)=>c.then(()=>s[0]==="reject"?u(s[1]):d(s[1])).catch(u));return typeof r!="string"&&typeof r!="number"?{unwrap:l}:Object.assign(r,{unwrap:l})},this.custom=(t,n)=>{const r=(n==null?void 0:n.id)||Dx++;return this.create({jsx:t(r),id:r,...n}),r},this.getActiveToasts=()=>this.toasts.filter(t=>!this.dismissedToasts.has(t.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}}const _i=new _T,NT=(e,t)=>{const n=(t==null?void 0:t.id)||Dx++;return _i.addToast({title:e,...t,id:n}),n},OT=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",DT=NT,LT=()=>_i.toasts,zT=()=>_i.getActiveToasts(),gr=Object.assign(DT,{success:_i.success,info:_i.info,warning:_i.warning,error:_i.error,custom:_i.custom,message:_i.message,promise:_i.promise,dismiss:_i.dismiss,loading:_i.loading},{getHistory:LT,getToasts:zT});CT("[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}[data-sonner-toaster][data-lifted=true]{transform:translateY(-8px)}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}");function ug(e){return e.label!==void 0}const BT=3,$T="24px",qT="16px",K3=4e3,HT=356,WT=14,GT=45,VT=200;function gc(...e){return e.filter(Boolean).join(" ")}function UT(e){const[t,n]=e.split("-"),r=[];return t&&r.push(t),n&&r.push(n),r}const YT=e=>{var t,n,r,a,i,s,c,l,d;const{invert:u,toast:h,unstyled:m,interacting:f,setHeights:g,visibleToasts:x,heights:v,index:b,toasts:w,expanded:M,removeToast:k,defaultRichColors:R,closeButton:j,style:I,cancelButtonStyle:E,actionButtonStyle:O,className:L="",descriptionClassName:$="",duration:F,position:B,gap:W,expandByDefault:re,classNames:oe,icons:te,closeButtonAriaLabel:J="Close toast"}=e,[pe,P]=on.useState(null),[V,fe]=on.useState(null),[ye,Se]=on.useState(!1),[we,ke]=on.useState(!1),[De,_e]=on.useState(!1),[ae,Re]=on.useState(!1),[Fe,Oe]=on.useState(!1),[ne,nt]=on.useState(0),[pt,Et]=on.useState(0),_t=on.useRef(h.duration||F||K3),Ct=on.useRef(null),Xe=on.useRef(null),Ut=b===0,Le=b+1<=x,Ke=h.type,mt=h.dismissible!==!1,an=h.className||"",gn=h.descriptionClassName||"",Be=on.useMemo(()=>v.findIndex(je=>je.toastId===h.id)||0,[v,h.id]),ft=on.useMemo(()=>{var je;return(je=h.closeButton)!=null?je:j},[h.closeButton,j]),Qt=on.useMemo(()=>h.duration||F||K3,[h.duration,F]),nr=on.useRef(0),_n=on.useRef(0),Rn=on.useRef(0),sn=on.useRef(null),[Cn,wt]=B.split("-"),st=on.useMemo(()=>v.reduce((je,Te,Ae)=>Ae>=Be?je:je+Te.height,0),[v,Be]),Zt=FT(),Pe=h.invert||u,ct=Ke==="loading";_n.current=on.useMemo(()=>Be*W+st,[Be,st]),on.useEffect(()=>{_t.current=Qt},[Qt]),on.useEffect(()=>{Se(!0)},[]),on.useEffect(()=>{const je=Xe.current;if(je){const Te=je.getBoundingClientRect().height;return Et(Te),g(Ae=>[{toastId:h.id,height:Te,position:h.position},...Ae]),()=>g(Ae=>Ae.filter(Tt=>Tt.toastId!==h.id))}},[g,h.id]),on.useLayoutEffect(()=>{if(!ye)return;const je=Xe.current,Te=je.style.height;je.style.height="auto";const Ae=je.getBoundingClientRect().height;je.style.height=Te,Et(Ae),g(Tt=>Tt.find(en=>en.toastId===h.id)?Tt.map(en=>en.toastId===h.id?{...en,height:Ae}:en):[{toastId:h.id,height:Ae,position:h.position},...Tt])},[ye,h.title,h.description,g,h.id]);const vt=on.useCallback(()=>{ke(!0),nt(_n.current),g(je=>je.filter(Te=>Te.toastId!==h.id)),setTimeout(()=>{k(h)},VT)},[h,k,g,_n]);on.useEffect(()=>{if(h.promise&&Ke==="loading"||h.duration===1/0||h.type==="loading")return;let je;return M||f||Zt?(()=>{if(Rn.current<nr.current){const Tt=new Date().getTime()-nr.current;_t.current=_t.current-Tt}Rn.current=new Date().getTime()})():(()=>{_t.current!==1/0&&(nr.current=new Date().getTime(),je=setTimeout(()=>{h.onAutoClose==null||h.onAutoClose.call(h,h),vt()},_t.current))})(),()=>clearTimeout(je)},[M,f,h,Ke,Zt,vt]),on.useEffect(()=>{h.delete&&vt()},[vt,h.delete]);function xe(){var je;if(te!=null&&te.loading){var Te;return on.createElement("div",{className:gc(oe==null?void 0:oe.loader,h==null||(Te=h.classNames)==null?void 0:Te.loader,"sonner-loader"),"data-visible":Ke==="loading"},te.loading)}return on.createElement(AT,{className:gc(oe==null?void 0:oe.loader,h==null||(je=h.classNames)==null?void 0:je.loader),visible:Ke==="loading"})}const ge=h.icon||(te==null?void 0:te[Ke])||kT(Ke);var Ee,me;return on.createElement("li",{tabIndex:0,ref:Xe,className:gc(L,an,oe==null?void 0:oe.toast,h==null||(t=h.classNames)==null?void 0:t.toast,oe==null?void 0:oe.default,oe==null?void 0:oe[Ke],h==null||(n=h.classNames)==null?void 0:n[Ke]),"data-sonner-toast":"","data-rich-colors":(Ee=h.richColors)!=null?Ee:R,"data-styled":!(h.jsx||h.unstyled||m),"data-mounted":ye,"data-promise":!!h.promise,"data-swiped":Fe,"data-removed":we,"data-visible":Le,"data-y-position":Cn,"data-x-position":wt,"data-index":b,"data-front":Ut,"data-swiping":De,"data-dismissible":mt,"data-type":Ke,"data-invert":Pe,"data-swipe-out":ae,"data-swipe-direction":V,"data-expanded":!!(M||re&&ye),style:{"--index":b,"--toasts-before":b,"--z-index":w.length-b,"--offset":`${we?ne:_n.current}px`,"--initial-height":re?"auto":`${pt}px`,...I,...h.style},onDragEnd:()=>{_e(!1),P(null),sn.current=null},onPointerDown:je=>{ct||!mt||(Ct.current=new Date,nt(_n.current),je.target.setPointerCapture(je.pointerId),je.target.tagName!=="BUTTON"&&(_e(!0),sn.current={x:je.clientX,y:je.clientY}))},onPointerUp:()=>{var je,Te,Ae;if(ae||!mt)return;sn.current=null;const Tt=Number(((je=Xe.current)==null?void 0:je.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),xt=Number(((Te=Xe.current)==null?void 0:Te.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),en=new Date().getTime()-((Ae=Ct.current)==null?void 0:Ae.getTime()),At=pe==="x"?Tt:xt,Ze=Math.abs(At)/en;if(Math.abs(At)>=GT||Ze>.11){nt(_n.current),h.onDismiss==null||h.onDismiss.call(h,h),fe(pe==="x"?Tt>0?"right":"left":xt>0?"down":"up"),vt(),Re(!0);return}else{var yt,Mt;(yt=Xe.current)==null||yt.style.setProperty("--swipe-amount-x","0px"),(Mt=Xe.current)==null||Mt.style.setProperty("--swipe-amount-y","0px")}Oe(!1),_e(!1),P(null)},onPointerMove:je=>{var Te,Ae,Tt;if(!sn.current||!mt||((Te=window.getSelection())==null?void 0:Te.toString().length)>0)return;const en=je.clientY-sn.current.y,At=je.clientX-sn.current.x;var Ze;const yt=(Ze=e.swipeDirections)!=null?Ze:UT(B);!pe&&(Math.abs(At)>1||Math.abs(en)>1)&&P(Math.abs(At)>Math.abs(en)?"x":"y");let Mt={x:0,y:0};const bn=Pt=>1/(1.5+Math.abs(Pt)/20);if(pe==="y"){if(yt.includes("top")||yt.includes("bottom"))if(yt.includes("top")&&en<0||yt.includes("bottom")&&en>0)Mt.y=en;else{const Pt=en*bn(en);Mt.y=Math.abs(Pt)<Math.abs(en)?Pt:en}}else if(pe==="x"&&(yt.includes("left")||yt.includes("right")))if(yt.includes("left")&&At<0||yt.includes("right")&&At>0)Mt.x=At;else{const Pt=At*bn(At);Mt.x=Math.abs(Pt)<Math.abs(At)?Pt:At}(Math.abs(Mt.x)>0||Math.abs(Mt.y)>0)&&Oe(!0),(Ae=Xe.current)==null||Ae.style.setProperty("--swipe-amount-x",`${Mt.x}px`),(Tt=Xe.current)==null||Tt.style.setProperty("--swipe-amount-y",`${Mt.y}px`)}},ft&&!h.jsx&&Ke!=="loading"?on.createElement("button",{"aria-label":J,"data-disabled":ct,"data-close-button":!0,onClick:ct||!mt?()=>{}:()=>{vt(),h.onDismiss==null||h.onDismiss.call(h,h)},className:gc(oe==null?void 0:oe.closeButton,h==null||(r=h.classNames)==null?void 0:r.closeButton)},(me=te==null?void 0:te.close)!=null?me:PT):null,(Ke||h.icon||h.promise)&&h.icon!==null&&((te==null?void 0:te[Ke])!==null||h.icon)?on.createElement("div",{"data-icon":"",className:gc(oe==null?void 0:oe.icon,h==null||(a=h.classNames)==null?void 0:a.icon)},h.promise||h.type==="loading"&&!h.icon?h.icon||xe():null,h.type!=="loading"?ge:null):null,on.createElement("div",{"data-content":"",className:gc(oe==null?void 0:oe.content,h==null||(i=h.classNames)==null?void 0:i.content)},on.createElement("div",{"data-title":"",className:gc(oe==null?void 0:oe.title,h==null||(s=h.classNames)==null?void 0:s.title)},h.jsx?h.jsx:typeof h.title=="function"?h.title():h.title),h.description?on.createElement("div",{"data-description":"",className:gc($,gn,oe==null?void 0:oe.description,h==null||(c=h.classNames)==null?void 0:c.description)},typeof h.description=="function"?h.description():h.description):null),on.isValidElement(h.cancel)?h.cancel:h.cancel&&ug(h.cancel)?on.createElement("button",{"data-button":!0,"data-cancel":!0,style:h.cancelButtonStyle||E,onClick:je=>{ug(h.cancel)&&mt&&(h.cancel.onClick==null||h.cancel.onClick.call(h.cancel,je),vt())},className:gc(oe==null?void 0:oe.cancelButton,h==null||(l=h.classNames)==null?void 0:l.cancelButton)},h.cancel.label):null,on.isValidElement(h.action)?h.action:h.action&&ug(h.action)?on.createElement("button",{"data-button":!0,"data-action":!0,style:h.actionButtonStyle||O,onClick:je=>{ug(h.action)&&(h.action.onClick==null||h.action.onClick.call(h.action,je),!je.defaultPrevented&&vt())},className:gc(oe==null?void 0:oe.actionButton,h==null||(d=h.classNames)==null?void 0:d.actionButton)},h.action.label):null)};function X3(){if(typeof window>"u"||typeof document>"u")return"ltr";const e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}function KT(e,t){const n={};return[e,t].forEach((r,a)=>{const i=a===1,s=i?"--mobile-offset":"--offset",c=i?qT:$T;function l(d){["top","right","bottom","left"].forEach(u=>{n[`${s}-${u}`]=typeof d=="number"?`${d}px`:d})}typeof r=="number"||typeof r=="string"?l(r):typeof r=="object"?["top","right","bottom","left"].forEach(d=>{r[d]===void 0?n[`${s}-${d}`]=c:n[`${s}-${d}`]=typeof r[d]=="number"?`${r[d]}px`:r[d]}):l(c)}),n}const XT=on.forwardRef(function(t,n){const{invert:r,position:a="bottom-right",hotkey:i=["altKey","KeyT"],expand:s,closeButton:c,className:l,offset:d,mobileOffset:u,theme:h="light",richColors:m,duration:f,style:g,visibleToasts:x=BT,toastOptions:v,dir:b=X3(),gap:w=WT,icons:M,containerAriaLabel:k="Notifications"}=t,[R,j]=on.useState([]),I=on.useMemo(()=>Array.from(new Set([a].concat(R.filter(V=>V.position).map(V=>V.position)))),[R,a]),[E,O]=on.useState([]),[L,$]=on.useState(!1),[F,B]=on.useState(!1),[W,re]=on.useState(h!=="system"?h:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),oe=on.useRef(null),te=i.join("+").replace(/Key/g,"").replace(/Digit/g,""),J=on.useRef(null),pe=on.useRef(!1),P=on.useCallback(V=>{j(fe=>{var ye;return(ye=fe.find(Se=>Se.id===V.id))!=null&&ye.delete||_i.dismiss(V.id),fe.filter(({id:Se})=>Se!==V.id)})},[]);return on.useEffect(()=>_i.subscribe(V=>{if(V.dismiss){requestAnimationFrame(()=>{j(fe=>fe.map(ye=>ye.id===V.id?{...ye,delete:!0}:ye))});return}setTimeout(()=>{MT.flushSync(()=>{j(fe=>{const ye=fe.findIndex(Se=>Se.id===V.id);return ye!==-1?[...fe.slice(0,ye),{...fe[ye],...V},...fe.slice(ye+1)]:[V,...fe]})})})}),[R]),on.useEffect(()=>{if(h!=="system"){re(h);return}if(h==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?re("dark"):re("light")),typeof window>"u")return;const V=window.matchMedia("(prefers-color-scheme: dark)");try{V.addEventListener("change",({matches:fe})=>{re(fe?"dark":"light")})}catch{V.addListener(({matches:ye})=>{try{re(ye?"dark":"light")}catch(Se){console.error(Se)}})}},[h]),on.useEffect(()=>{R.length<=1&&$(!1)},[R]),on.useEffect(()=>{const V=fe=>{var ye;if(i.every(ke=>fe[ke]||fe.code===ke)){var we;$(!0),(we=oe.current)==null||we.focus()}fe.code==="Escape"&&(document.activeElement===oe.current||(ye=oe.current)!=null&&ye.contains(document.activeElement))&&$(!1)};return document.addEventListener("keydown",V),()=>document.removeEventListener("keydown",V)},[i]),on.useEffect(()=>{if(oe.current)return()=>{J.current&&(J.current.focus({preventScroll:!0}),J.current=null,pe.current=!1)}},[oe.current]),on.createElement("section",{ref:n,"aria-label":`${k} ${te}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},I.map((V,fe)=>{var ye;const[Se,we]=V.split("-");return R.length?on.createElement("ol",{key:V,dir:b==="auto"?X3():b,tabIndex:-1,ref:oe,className:l,"data-sonner-toaster":!0,"data-sonner-theme":W,"data-y-position":Se,"data-lifted":L&&R.length>1&&!s,"data-x-position":we,style:{"--front-toast-height":`${((ye=E[0])==null?void 0:ye.height)||0}px`,"--width":`${HT}px`,"--gap":`${w}px`,...g,...KT(d,u)},onBlur:ke=>{pe.current&&!ke.currentTarget.contains(ke.relatedTarget)&&(pe.current=!1,J.current&&(J.current.focus({preventScroll:!0}),J.current=null))},onFocus:ke=>{ke.target instanceof HTMLElement&&ke.target.dataset.dismissible==="false"||pe.current||(pe.current=!0,J.current=ke.relatedTarget)},onMouseEnter:()=>$(!0),onMouseMove:()=>$(!0),onMouseLeave:()=>{F||$(!1)},onDragEnd:()=>$(!1),onPointerDown:ke=>{ke.target instanceof HTMLElement&&ke.target.dataset.dismissible==="false"||B(!0)},onPointerUp:()=>B(!1)},R.filter(ke=>!ke.position&&fe===0||ke.position===V).map((ke,De)=>{var _e,ae;return on.createElement(YT,{key:ke.id,icons:M,index:De,toast:ke,defaultRichColors:m,duration:(_e=v==null?void 0:v.duration)!=null?_e:f,className:v==null?void 0:v.className,descriptionClassName:v==null?void 0:v.descriptionClassName,invert:r,visibleToasts:x,closeButton:(ae=v==null?void 0:v.closeButton)!=null?ae:c,interacting:F,position:V,style:v==null?void 0:v.style,unstyled:v==null?void 0:v.unstyled,classNames:v==null?void 0:v.classNames,cancelButtonStyle:v==null?void 0:v.cancelButtonStyle,actionButtonStyle:v==null?void 0:v.actionButtonStyle,closeButtonAriaLabel:v==null?void 0:v.closeButtonAriaLabel,removeToast:P,toasts:R.filter(Re=>Re.position==ke.position),heights:E.filter(Re=>Re.position==ke.position),setHeights:O,expandByDefault:s,gap:w,expanded:L,swipeDirections:t.swipeDirections})})):null}))});/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JT=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),QT=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,n,r)=>r?r.toUpperCase():n.toLowerCase()),J3=e=>{const t=QT(e);return t.charAt(0).toUpperCase()+t.slice(1)},Wk=(...e)=>e.filter((t,n,r)=>!!t&&t.trim()!==""&&r.indexOf(t)===n).join(" ").trim();/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var ZT={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eI=S.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:a="",children:i,iconNode:s,...c},l)=>S.createElement("svg",{ref:l,...ZT,width:t,height:t,stroke:e,strokeWidth:r?Number(n)*24/Number(t):n,className:Wk("lucide",a),...c},[...s.map(([d,u])=>S.createElement(d,u)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=(e,t)=>{const n=S.forwardRef(({className:r,...a},i)=>S.createElement(eI,{ref:i,iconNode:t,className:Wk(`lucide-${JT(J3(e))}`,`lucide-${e}`,r),...a}));return n.displayName=J3(e),n};/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tI=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],o0=Vt("activity",tI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nI=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],rI=Vt("arrow-left",nI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oI=[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M11 12h4",key:"q8tih4"}],["path",{d:"M11 16h7",key:"uosisv"}],["path",{d:"M11 20h10",key:"jvxblo"}]],aI=Vt("arrow-up-narrow-wide",oI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sI=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["path",{d:"M20.2 20.2c2.04-2.03.02-7.36-4.5-11.9-4.54-4.52-9.87-6.54-11.9-4.5-2.04 2.03-.02 7.36 4.5 11.9 4.54 4.52 9.87 6.54 11.9 4.5Z",key:"1l2ple"}],["path",{d:"M15.7 15.7c4.52-4.54 6.54-9.87 4.5-11.9-2.03-2.04-7.36-.02-11.9 4.5-4.52 4.54-6.54 9.87-4.5 11.9 2.03 2.04 7.36.02 11.9-4.5Z",key:"1wam0m"}]],iI=Vt("atom",sI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lI=[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]],cI=Vt("award",lI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dI=[["circle",{cx:"11",cy:"13",r:"9",key:"hd149"}],["path",{d:"M14.35 4.65 16.3 2.7a2.41 2.41 0 0 1 3.4 0l1.6 1.6a2.4 2.4 0 0 1 0 3.4l-1.95 1.95",key:"jp4j1b"}],["path",{d:"m22 2-1.5 1.5",key:"ay92ug"}]],uI=Vt("bomb",dI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hI=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],Sf=Vt("book-open",hI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fI=[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}],["path",{d:"M8 11h8",key:"vwpz6n"}],["path",{d:"M8 7h6",key:"1f0q6e"}]],Lx=Vt("book-text",fI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pI=[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]],Q3=Vt("book",pI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mI=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]],nS=Vt("bookmark",mI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gI=[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]],Kp=Vt("box",gI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yI=[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]],Gk=Vt("brain",yI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bI=[["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M9 7.13v-1a3.003 3.003 0 1 1 6 0v1",key:"d7y7pr"}],["path",{d:"M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6",key:"xs1cw7"}],["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M6.53 9C4.6 8.8 3 7.1 3 5",key:"32zzws"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"M3 21c0-2.1 1.7-3.9 3.8-4",key:"4p0ekp"}],["path",{d:"M20.97 5c0 2.1-1.6 3.8-3.5 4",key:"18gb23"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M17.2 17c2.1.1 3.8 1.9 3.8 4",key:"k3fwyw"}]],hg=Vt("bug",bI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xI=[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Vk=Vt("camera",xI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vI=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],zx=Vt("check",vI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SI=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Ms=Vt("chevron-down",SI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wI=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],ym=Vt("chevron-left",wI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MI=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],hs=Vt("chevron-right",MI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CI=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Uk=Vt("chevron-up",CI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kI=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],RI=Vt("circle-alert",kI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AI=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],G5=Vt("circle-check-big",AI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jI=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]],EI=Vt("circle-dot",jI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TI=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Yk=Vt("circle-help",TI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const II=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],PI=Vt("circle",II);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FI=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],Bu=Vt("clock",FI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _I=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],rS=Vt("cloud",_I);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NI=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Kk=Vt("copy",NI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OI=[["rect",{width:"16",height:"16",x:"4",y:"4",rx:"2",key:"14l7u7"}],["rect",{width:"6",height:"6",x:"9",y:"9",rx:"1",key:"5aljv4"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]],DI=Vt("cpu",OI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LI=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]],Z3=Vt("crosshair",LI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zI=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],r2=Vt("database",zI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BI=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M16 8h.01",key:"cr5u4v"}],["path",{d:"M8 8h.01",key:"1e4136"}],["path",{d:"M8 16h.01",key:"18s6g9"}],["path",{d:"M16 16h.01",key:"1f9h7w"}],["path",{d:"M12 12h.01",key:"1mp3jc"}]],$I=Vt("dice-5",BI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qI=[["path",{d:"m10 16 1.5 1.5",key:"11lckj"}],["path",{d:"m14 8-1.5-1.5",key:"1ohn8i"}],["path",{d:"M15 2c-1.798 1.998-2.518 3.995-2.807 5.993",key:"80uv8i"}],["path",{d:"m16.5 10.5 1 1",key:"696xn5"}],["path",{d:"m17 6-2.891-2.891",key:"xu6p2f"}],["path",{d:"M2 15c6.667-6 13.333 0 20-6",key:"1pyr53"}],["path",{d:"m20 9 .891.891",key:"3xwk7g"}],["path",{d:"M3.109 14.109 4 15",key:"q76aoh"}],["path",{d:"m6.5 12.5 1 1",key:"cs35ky"}],["path",{d:"m7 18 2.891 2.891",key:"1sisit"}],["path",{d:"M9 22c1.798-1.998 2.518-3.995 2.807-5.993",key:"q3hbxp"}]],oS=Vt("dna",qI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HI=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],aS=Vt("download",HI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WI=[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]],eM=Vt("droplets",WI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GI=[["path",{d:"M6 8.5a6.5 6.5 0 1 1 13 0c0 6-6 6-6 10a3.5 3.5 0 1 1-7 0",key:"1dfaln"}],["path",{d:"M15 8.5a2.5 2.5 0 0 0-5 0v1a2 2 0 1 1 0 4",key:"1qnva7"}]],VI=Vt("ear",GI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UI=[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21",key:"182aya"}],["path",{d:"M22 21H7",key:"t4ddhn"}],["path",{d:"m5 11 9 9",key:"1mo9qw"}]],M5=Vt("eraser",UI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YI=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],sS=Vt("external-link",YI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KI=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Xp=Vt("eye-off",KI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XI=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],jl=Vt("eye",XI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JI=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Bx=Vt("file-text",JI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QI=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]],ZI=Vt("film",QI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eP=[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]],tP=Vt("flame",eP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nP=[["path",{d:"M14 2v6a2 2 0 0 0 .245.96l5.51 10.08A2 2 0 0 1 18 22H6a2 2 0 0 1-1.755-2.96l5.51-10.08A2 2 0 0 0 10 8V2",key:"18mbvz"}],["path",{d:"M6.453 15h11.094",key:"3shlmq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}]],rP=Vt("flask-conical",nP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oP=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],lf=Vt("folder",oP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aP=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Xk=Vt("funnel",aP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sP=[["path",{d:"M18 11V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2",key:"1fvzgz"}],["path",{d:"M14 10V4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v2",key:"1kc0my"}],["path",{d:"M10 10.5V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2v8",key:"10h0bg"}],["path",{d:"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"1s1gnw"}]],iP=Vt("hand",sP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lP=[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]],Jk=Vt("heart",lP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cP=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],tM=Vt("image",cP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dP=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],uP=Vt("info",dP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hP=[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]],nM=Vt("key-round",hP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fP=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],pP=Vt("key",fP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mP=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],cf=Vt("layers",mP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gP=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],rM=Vt("layout-grid",gP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yP=[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]],o2=Vt("leaf",yP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bP=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],Qk=Vt("link-2",bP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xP=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],vP=Vt("loader",xP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SP=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]],wP=Vt("lock-open",SP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MP=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],$x=Vt("lock",MP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CP=[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]],kP=Vt("log-in",CP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RP=[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]],Zk=Vt("maximize-2",RP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AP=[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]],jP=Vt("menu",AP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EP=[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],TP=Vt("mic",EP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IP=[["path",{d:"M5 12h14",key:"1ays0h"}]],PP=Vt("minus",IP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FP=[["path",{d:"M4.037 4.688a.495.495 0 0 1 .651-.651l16 6.5a.5.5 0 0 1-.063.947l-6.124 1.58a2 2 0 0 0-1.438 1.435l-1.579 6.126a.5.5 0 0 1-.947.063z",key:"edeuup"}]],_P=Vt("mouse-pointer-2",FP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NP=[["path",{d:"M18 8L22 12L18 16",key:"1r0oui"}],["path",{d:"M2 12H22",key:"1m8cig"}]],OP=Vt("move-right",NP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DP=[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]],LP=Vt("move",DP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zP=[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]],a2=Vt("music",zP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BP=[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]],$P=Vt("network",BP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qP=[["path",{d:"m14.622 17.897-10.68-2.913",key:"vj2p1u"}],["path",{d:"M18.376 2.622a1 1 0 1 1 3.002 3.002L17.36 9.643a.5.5 0 0 0 0 .707l.944.944a2.41 2.41 0 0 1 0 3.408l-.944.944a.5.5 0 0 1-.707 0L8.354 7.348a.5.5 0 0 1 0-.707l.944-.944a2.41 2.41 0 0 1 3.408 0l.944.944a.5.5 0 0 0 .707 0z",key:"18tc5c"}],["path",{d:"M9 8c-1.804 2.71-3.97 3.46-6.583 3.948a.507.507 0 0 0-.302.819l7.32 8.883a1 1 0 0 0 1.185.204C12.735 20.405 16 16.792 16 15",key:"ytzfxy"}]],HP=Vt("paintbrush",qP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WP=[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]],GP=Vt("palette",WP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VP=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]],md=Vt("pause",VP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UP=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],YP=Vt("pencil",UP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KP=[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]],eR=Vt("pin",KP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XP=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],sc=Vt("play",XP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JP=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Iy=Vt("plus",JP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QP=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],wf=Vt("refresh-cw",QP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZP=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],El=Vt("rotate-ccw",ZP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eF=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Jp=Vt("save",eF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tF=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],nF=Vt("search",tF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rF=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],$u=Vt("settings",rF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oF=[["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 18h1.973a4 4 0 0 0 3.3-1.7l5.454-8.6a4 4 0 0 1 3.3-1.7H22",key:"1ailkh"}],["path",{d:"M2 6h1.972a4 4 0 0 1 3.6 2.2",key:"km57vx"}],["path",{d:"M22 18h-6.041a4 4 0 0 1-3.3-1.8l-.359-.45",key:"os18l9"}]],aF=Vt("shuffle",oF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sF=[["line",{x1:"4",x2:"4",y1:"21",y2:"14",key:"1p332r"}],["line",{x1:"4",x2:"4",y1:"10",y2:"3",key:"gb41h5"}],["line",{x1:"12",x2:"12",y1:"21",y2:"12",key:"hf2csr"}],["line",{x1:"12",x2:"12",y1:"8",y2:"3",key:"1kfi7u"}],["line",{x1:"20",x2:"20",y1:"21",y2:"16",key:"1lhrwl"}],["line",{x1:"20",x2:"20",y1:"12",y2:"3",key:"16vvfq"}],["line",{x1:"2",x2:"6",y1:"14",y2:"14",key:"1uebub"}],["line",{x1:"10",x2:"14",y1:"8",y2:"8",key:"1yglbp"}],["line",{x1:"18",x2:"22",y1:"16",y2:"16",key:"1jxqpz"}]],iF=Vt("sliders-vertical",sF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lF=[["path",{d:"m10 20-1.25-2.5L6 18",key:"18frcb"}],["path",{d:"M10 4 8.75 6.5 6 6",key:"7mghy3"}],["path",{d:"m14 20 1.25-2.5L18 18",key:"1chtki"}],["path",{d:"m14 4 1.25 2.5L18 6",key:"1b4wsy"}],["path",{d:"m17 21-3-6h-4",key:"15hhxa"}],["path",{d:"m17 3-3 6 1.5 3",key:"11697g"}],["path",{d:"M2 12h6.5L10 9",key:"kv9z4n"}],["path",{d:"m20 10-1.5 2 1.5 2",key:"1swlpi"}],["path",{d:"M22 12h-6.5L14 15",key:"1mxi28"}],["path",{d:"m4 10 1.5 2L4 14",key:"k9enpj"}],["path",{d:"m7 21 3-6-1.5-3",key:"j8hb9u"}],["path",{d:"m7 3 3 6h4",key:"1otusx"}]],cF=Vt("snowflake",lF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dF=[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]],ic=Vt("sparkles",dF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uF=[["path",{d:"M7 20h10",key:"e6iznv"}],["path",{d:"M10 20c5.5-2.5.8-6.4 3-10",key:"161w41"}],["path",{d:"M9.5 9.4c1.1.8 1.8 2.2 2.3 3.7-2 .4-3.5.4-4.8-.3-1.2-.6-2.3-1.9-3-4.2 2.8-.5 4.4 0 5.5.8z",key:"9gtqwd"}],["path",{d:"M14.1 6a7 7 0 0 0-1.1 4c1.9-.1 3.3-.6 4.3-1.4 1-1 1.6-2.3 1.7-4.6-2.7.1-4 1-4.9 2z",key:"bkxnd2"}]],fg=Vt("sprout",uF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hF=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],fF=Vt("square",hF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pF=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],mF=Vt("star",pF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gF=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],yF=Vt("tag",gF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bF=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],Qp=Vt("target",bF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xF=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],il=Vt("trash-2",xF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vF=[["path",{d:"m17 14 3 3.3a1 1 0 0 1-.7 1.7H4.7a1 1 0 0 1-.7-1.7L7 14h-.3a1 1 0 0 1-.7-1.7L9 9h-.2A1 1 0 0 1 8 7.3L12 3l4 4.3a1 1 0 0 1-.8 1.7H15l3 3.3a1 1 0 0 1-.7 1.7H17Z",key:"cpyugq"}],["path",{d:"M12 22v-3",key:"kmzjlo"}]],SF=Vt("tree-pine",vF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wF=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],MF=Vt("triangle-alert",wF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CF=[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]],V5=Vt("trophy",CF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kF=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],oM=Vt("undo-2",kF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RF=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],Tu=Vt("upload",RF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AF=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],jF=Vt("user-plus",AF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EF=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],TF=Vt("video",EF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IF=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],PF=Vt("volume-2",IF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FF=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Cs=Vt("x",FF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _F=[["path",{d:"M10.513 4.856 13.12 2.17a.5.5 0 0 1 .86.46l-1.377 4.317",key:"193nxd"}],["path",{d:"M15.656 10H20a1 1 0 0 1 .78 1.63l-1.72 1.773",key:"27a7lr"}],["path",{d:"M16.273 16.273 10.88 21.83a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14H4a1 1 0 0 1-.78-1.63l4.507-4.643",key:"1e0qe9"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],NF=Vt("zap-off",_F);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OF=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],zi=Vt("zap",OF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DF=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],tR=Vt("zoom-in",DF);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LF=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],nR=Vt("zoom-out",LF),rR={home_entrar:"Sign in",home_entrar_title:"Sign in or register",home_admin:"ADMIN",home_admin_on:"ADMIN ON",home_admin_title:"Admin Mode (active)",home_admin_title_off:"Admin Mode (password)",home_alphaTest:"ALPHA TEST",home_hello:"Hello,",home_toolsNav:"TOOLS",home_devicesTag:"devices for intuition",home_projectTitle:"A living lab to think with the body  and perception.",home_projectDesc:"We build tools to perceive and study, heuristically, visually and non-linearly, complex dynamics: systems that change, self-organize, enter crisis, reinvent themselves.",home_projectDesc2:"We build lenses to test hypotheses in real time  a machine for generating questions, not final answers.",home_toolsAre:"the tools are",home_lenses:'"LENSES"',home_biblio_thesis:"Continuous Thesis",home_biblio_bibliography:"Bibliography",home_algorithm:"Algorithm",home_algorithmDesc:"All our tools use the same custom artificial life (ALife) principle and algorithm, based on particles with variable, mutable and influenceable archetypes.",home_simBackground:"simulation running in real time in the background",home_field:"[ Field ]",home_agents:"[ Agents ]",home_interactions:"[ Interactions ]",home_recursivity:" (recursivity)",home_manifesto1:"We believe the act of forming a hypothesis should stay free, variable, continuous, visual  and meta-linguistic.",home_manifesto2:"The point is not definitive truth, but lenses that resist linear, closed equations.",home_toolsAvailable:"9 tools available + 3 coming soon.",home_freeAlpha:"(free during alpha test)",home_availableTools:"AVAILABLE TOOLS (9) + SOON (3)",home_entrarToAccess:"Sign in (top right) to access the tools.",home_locked:"LOCKED",home_footer:"Devices for Intuition  2026",lab_complexityLife_name:"Complexity Lab",lab_complexityLife_desc:"LEARN TO OPERATE THE ARTIFICIAL LIFE ALGORITHM THROUGH EXPERIMENTS, PRESETS AND INTERACTIVE VARIABLE PARAMETERS.",lab_metaArtLab_name:"Meta-Gen-Art",lab_metaArtLab_desc:'LIVING CREATION LAB. EXPERIMENT WITH GENERATIVE ART THROUGH "INK" WITH A LIFE OF ITS OWN.',lab_psycheLab_name:"Psyche Lab",lab_psycheLab_desc:"NEURAL FIELDS AND CONSCIOUSNESS DYNAMICS. EXPERIMENT WITH EMERGENT PSYCHIC FLOWS THROUGH ARCHETYPAL AGENTS.",lab_musicLab_name:"Complex Music Lab",lab_musicLab_desc:"COMPLEX DIGITAL MUSICAL INSTRUMENT. USE PARTICLES WITH A LIFE OF THEIR OWN TO MAKE EXPERIMENTAL MUSIC.",lab_rhizomeLab_name:"Rhizome Search",lab_rhizomeLab_desc:"TOOL FOR NON-LINEAR EPISTEMOLOGICAL RESEARCH. SEE CONCEPTS/NAMES/BIBLIOGRAPHIES THROUGH EXPANDABLE RHIZOMES.",lab_alchemyLab_name:"Alchemy Table",lab_alchemyLab_desc:"LEARN THE BASIC CONCEPT OF EMERGENCE, TRANSMUTATION AND COMPLEXITY OF CHEMICAL AND METAPHORICAL ELEMENTS.",lab_treeOfLife_name:"Tree of Life",lab_treeOfLife_desc:"HERMETIC QABALAH SIMULATOR. EXPLORE THE 10 SEPHIROTH, 22 PATHS, TAROT ARCANA, RITUAL TOOLS AND THE GREAT WORK. GOLDEN DAWN TRADITION.",lab_sociogenesis_name:"Sociogenesis",lab_sociogenesis_desc:"DISCOVER THE EMERGENCE OF SYMBOLS, INSTITUTIONS, MYTHS, TOTEMS AND TABOOS AMONG AGENTS AND HOW THIS CHANGES THE FIELD.",lab_milPlatos_name:"Mil Plats",lab_milPlatos_desc:"DELEUZE & GUATTARI OPERATIONAL LENS. SIMULATE STRATIFICATION  BODY WITHOUT ORGANS, PLATEAUS, RHIZOME AND LINES OF FLIGHT.",lab_languageLab_name:"Recursive Language",lab_languageLab_desc:"COMING SOON",lab_asimovTheater_name:"Psico-history Theater",lab_asimovTheater_desc:"COMING SOON",lab_physicsSandbox_name:"Physics Sandbox",lab_physicsSandbox_desc:"COMING SOON",lab_status_alpha:"ALPHA V0",lab_status_experimental:"EXPERIMENTAL BUILD",topHud_goHome:"Back to Labs",topHud_tools:"TOOLS",topHud_admin:"ADMIN",topHud_admin_title:"Admin Mode (active)",topHud_admin_title_off:"Admin Mode (password)",topHud_3d:"3D",topHud_3d_title:"Back to 2D",topHud_3d_title_off:"3D mode",topHud_play:"Play",topHud_pause:"Pause",topHud_reset:"Reset",topHud_undo:"Undo",topHud_field:"FIELD",topHud_field_title:"Energy Field",topHud_guide:"Guided Tour",topHud_achievements:"Achievements",topHud_worldLog:"World Log",topHud_chronicle:"Chronicle",topHud_cinematic:"Cinematic mode (H)",topHud_circular:"CIRCULAR",tab_complexityLife:"Complexity Life",tab_metaArtLab:"Meta-Gen-Art",tab_musicLab:"Music Lab",tab_rhizomeLab:"Rhizome",tab_alchemyLab:"Alchemy",tab_treeOfLife:"Tree of Life",tab_sociogenesis:"Sociogenesis",tab_psycheLab:"Psyche",tab_milPlatos:"Mil Plats",tab_languageLab:"Language",tab_asimovTheater:"Asimov",tab_physicsSandbox:"Physics",layer_tension:"Tension",layer_cohesion:"Cohesion",layer_scarcity:"Nutrition",layer_novelty:"Entropy",adminGate_title:"Admin Mode",adminGate_desc:"Unlocks access to locked/coming soon tools. (UI gate  not real security.)",adminGate_placeholder:"Password...",adminGate_submit:"Unlock",adminGate_close:"Close",toast_adminActivated:"Admin Mode activated",toast_adminDesc:"Access granted.",guide_emergence_1_title:"Take your time",guide_emergence_1_copy:"You're looking at a living canvas. Each dot is an agent; each colour is a species. They move by simple rules of attraction and repulsion. For a few seconds, just watch  there's nothing to do yet. When you're ready, click Next below.",guide_emergence_2_title:"One small change",guide_emergence_2_copy:"In the bar at the top, find the Speed control (or the numbers 14 next to it). Try moving the speed a little  faster or slower. Watch how the same scene changes rhythm. When you've tried it, click Next.",guide_emergence_3_title:"What you just saw",guide_emergence_3_copy:"That change is called emergence: the same rules, with a different rhythm, create different patterns  rings, flocks, or chaos. Nothing was programmed to look like that; it emerges from the rules. You can keep exploring: open the panel on the right for presets, or drag on the canvas to push the agents.",guide_cl_1_title:"The living canvas",guide_cl_1_copy:"Each dot is an agent; each colour is a species. They move by simple rules of attraction and repulsion. Take a moment to watch  no action needed yet. When ready, click Next.",guide_cl_2_title:"Speed controls the rhythm",guide_cl_2_copy:"In the top bar, find the Speed control (110). Change it slightly and watch how the same rules produce different patterns: rings, flocks, or chaos. Same rules, different rhythm = emergence.",guide_cl_3_title:"The invisible field",guide_cl_3_copy:"Behind the agents there is a field: tension, cohesion, scarcity. Turn the Field overlay ON in the top bar to see why patterns form where they do. Then turn it OFF again if you prefer a clean view.",guide_cl_4_title:"Presets = ready-made worlds",guide_cl_4_copy:"Open the panel on the right (tap Painel on mobile). The first tab shows Presets: one-click worlds (Orbit, Chaos, Flock). Try one  it rewrites the forces and species so you can feel the systems range.",guide_cl_5_title:"Physics and behaviour",guide_cl_5_copy:"In the same panel, scroll to Physics and Life: sliders for range, force, viscosity, species count, mutation. Small changes here have big effects. Experiment without fear  you can always Reset.",guide_cl_6_title:"Connections (bonds)",guide_cl_6_copy:"When Bonds are ON, lines appear between nearby agents of the same species. Distance and opacity are in the panel. This layer reveals hidden structure; turn it OFF for a simpler view.",guide_cl_7_title:"Intervene with the brush",guide_cl_7_copy:"Click and drag on the canvas to push or pull agents. You become part of the system. Try different tools in the panel (Pulse, Vortex, etc.) to see how the system responds and reorganises.",guide_cl_8_title:"Youre ready to explore",guide_cl_8_copy:"Youve seen: canvas, speed, field, presets, physics, bonds, and intervention. Nothing here was programmed to look like that  it emerges. Keep experimenting; the guide is always available from the menu."},zF={home_entrar:"Entrar",home_entrar_title:"Entrar ou cadastrar",home_admin:"ADMIN",home_admin_on:"ADMIN ON",home_admin_title:"Admin Mode (ativado)",home_admin_title_off:"Admin Mode (senha)",home_alphaTest:"ALPHA TEST",home_hello:"Ol,",home_toolsNav:"FERRAMENTAS",home_devicesTag:"devices for intuition",home_projectTitle:"Um laboratrio vivo para pensar com o corpo  e percepo.",home_projectDesc:"Criamos ferramentas para perceber e estudar, de forma heurstica, visual e no linear, dinmicas complexas: sistemas que mudam, se organizam, entram em crise, se reinventam.",home_projectDesc2:"Construmos lentes para testar hipteses em tempo real  uma mquina de gerar perguntas, no respostas finais.",home_toolsAre:"as ferramentas so",home_lenses:'"LENTES"',home_biblio_thesis:"Tese Contnua",home_biblio_bibliography:"Bibliografia",home_algorithm:"Algoritmo",home_algorithmDesc:"Todas as nossas ferramentas utilizam o mesmo princpio e algoritmo de vida artificial customizado (ALife), baseado em partculas com arqutipos variveis, mutveis e influenciveis.",home_simBackground:"simulao rodando em tempo real no background",home_field:"[ Campo ]",home_agents:"[ Agentes ]",home_interactions:"[ Interaes ]",home_recursivity:" (recursividade)",home_manifesto1:"Acreditamos que o gesto de construir uma hiptese deve permanecer livre, varivel, contnuo, visual  e meta-lingustico.",home_manifesto2:"A ideia no  verdade definitiva, e sim lentes que resistem a equaes lineares e fechadas.",home_toolsAvailable:"9 ferramentas disponveis + 3 em breve.",home_freeAlpha:"(grtis durante alpha test)",home_availableTools:"AVAILABLE TOOLS (9) + SOON (3)",home_entrarToAccess:"Entrar (canto superior) para acessar as ferramentas.",home_locked:"TRANCADO",home_footer:"Devices for Intuition  2026",lab_complexityLife_name:"Complexity Lab",lab_complexityLife_desc:"APRENDA A OPERAR COM O ALGORITMO DA VIDA ARTIFICIAL ATRAVS DE EXPERIMENTOS, PRESETS E PARMETROS VARIVEIS INTERATIVOS.",lab_metaArtLab_name:"Meta-Gen-Art",lab_metaArtLab_desc:'LABORATRIO DE CRIAO VIVA. EXPERIMENTE FAZER ARTE GENERATIVA ATRAVS DE "TINTA" COM VIDA PRPRIA.',lab_psycheLab_name:"Psyche Lab",lab_psycheLab_desc:"CAMPOS NEURAIS E DINMICAS DE CONSCINCIA. EXPERIMENTE FLUXOS PSQUICOS EMERGENTES ATRAVS DE AGENTES ARQUETPICOS.",lab_musicLab_name:"Complex Music Lab",lab_musicLab_desc:"INSTRUMENTO MUSICAL DIGITAL COMPLEXO. USE PARTCULAS COM VIDA PRPRIA PRA FAZER MSICA EXPERIMENTAL.",lab_rhizomeLab_name:"Rhizome Search",lab_rhizomeLab_desc:"FERRAMENTA PARA PESQUISAS EPISTEMOLGICAS NO-LINEARES. VEJA CONCEITOS/NOMES/BIBLIOGRAFIAS ATRAVS DE RIZOMAS EXPANSVEIS.",lab_alchemyLab_name:"Alchemy Table",lab_alchemyLab_desc:"APRENDA O CONCEITO BSICO DE EMERGNCIA, TRANSMUTAO E COMPLEXIDADE DE ELEMENTOS QUMICOS E METAFRICOS.",lab_treeOfLife_name:"Tree of Life",lab_treeOfLife_desc:"HERMETIC QABALAH SIMULATOR. EXPLORE THE 10 SEPHIROTH, 22 PATHS, TAROT ARCANA, RITUAL TOOLS AND THE GREAT WORK. GOLDEN DAWN TRADITION.",lab_sociogenesis_name:"Sociogenesis",lab_sociogenesis_desc:"DESCUBRA A EMERGNCIA DE SMBOLOS, INSTITUIES, MITOS, TOTENS E TABUS ENTRE AGENTES E COMO ISSO ALTERA O CAMPO.",lab_milPlatos_name:"Mil Plats",lab_milPlatos_desc:"LENTE OPERACIONAL DELEUZE & GUATTARI. SIMULE ESTRATIFICAO  CORPO SEM RGOS, PLATS, RIZOMA E LINHAS DE FUGA.",lab_languageLab_name:"Recursive Language",lab_languageLab_desc:"EM BREVE",lab_asimovTheater_name:"Psico-history Theater",lab_asimovTheater_desc:"EM BREVE",lab_physicsSandbox_name:"Physics Sandbox",lab_physicsSandbox_desc:"EM BREVE",lab_status_alpha:"ALPHA V0",lab_status_experimental:"EXPERIMENTAL BUILD",topHud_goHome:"Voltar para Labs",topHud_tools:"FERRAMENTAS",topHud_admin:"ADMIN",topHud_admin_title:"Admin Mode (ativado)",topHud_admin_title_off:"Admin Mode (senha)",topHud_3d:"3D",topHud_3d_title:"Voltar para 2D",topHud_3d_title_off:"Modo 3D",topHud_play:"Reproduzir",topHud_pause:"Pausar",topHud_reset:"Reiniciar",topHud_undo:"Desfazer",topHud_field:"CAMPO",topHud_field_title:"Campo de Energia",topHud_guide:"Tour Guiado",topHud_achievements:"Conquistas",topHud_worldLog:"World Log",topHud_chronicle:"Chronicle",topHud_cinematic:"Modo Cinematico (H)",topHud_circular:"CIRCULAR",tab_complexityLife:"Complexity Life",tab_metaArtLab:"Meta-Gen-Art",tab_musicLab:"Music Lab",tab_rhizomeLab:"Rhizome",tab_alchemyLab:"Alchemy",tab_treeOfLife:"Tree of Life",tab_sociogenesis:"Sociogenesis",tab_psycheLab:"Psyche",tab_milPlatos:"Mil Plats",tab_languageLab:"Idioma",tab_asimovTheater:"Asimov",tab_physicsSandbox:"Fsica",layer_tension:"Tensao",layer_cohesion:"Coesao",layer_scarcity:"Nutricao",layer_novelty:"Entropia",adminGate_title:"Admin Mode",adminGate_desc:'Libera acesso a tools trancadas/"em breve". (Gate de UI  no  segurana real.)',adminGate_placeholder:"Senha...",adminGate_submit:"Desbloquear",adminGate_close:"Fechar",toast_adminActivated:"Admin Mode ativado",toast_adminDesc:"Acesso liberado.",guide_emergence_1_title:"Olhe com calma",guide_emergence_1_copy:"Voc est vendo uma tela viva. Cada ponto  um agente; cada cor  uma espcie. Eles se movem por regras simples de atrao e repulso. Por alguns segundos, apenas observe  no h nada a fazer ainda. Quando quiser, clique em Prximo abaixo.",guide_emergence_2_title:"Um ajuste s",guide_emergence_2_copy:"Na barra no topo, procure o controle de Velocidade (ou os nmeros 14 ao lado). Tente mudar um pouco  mais rpido ou mais devagar. Veja como a mesma cena muda de ritmo. Quando tiver experimentado, clique em Prximo.",guide_emergence_3_title:"O que voc viu",guide_emergence_3_copy:"Essa mudana se chama emergncia: as mesmas regras, com outro ritmo, geram outros padres  anis, cardumes ou caos. Nada foi programado para ficar daquele jeito; surge das regras. Voc pode continuar explorando: abra o painel  direita para ver presets, ou arraste no canvas para empurrar os agentes.",guide_cl_1_title:"A tela viva",guide_cl_1_copy:"Cada ponto  um agente; cada cor  uma espcie. Eles se movem por regras simples de atrao e repulso. Observe um pouco  ainda no precisa fazer nada. Quando quiser, clique em Prximo.",guide_cl_2_title:"A velocidade controla o ritmo",guide_cl_2_copy:"Na barra do topo, procure o controle de Velocidade (110). Mude um pouco e veja como as mesmas regras geram outros padres: anis, cardumes ou caos. Mesmas regras, outro ritmo = emergncia.",guide_cl_3_title:"O campo invisvel",guide_cl_3_copy:"Por trs dos agentes existe um campo: tenso, coeso, nutrio. Ligue o overlay de Campo na barra do topo para ver por que os padres surgem onde surgem. Depois desligue se preferir a vista limpa.",guide_cl_4_title:"Presets = mundos prontos",guide_cl_4_copy:"Abra o painel  direita (toque em Painel no mobile). A primeira aba mostra Presets: mundos em um clique (Orbit, Chaos, Flock). Experimente um  ele reconfigura foras e espcies para voc sentir o alcance do sistema.",guide_cl_5_title:"Fsica e comportamento",guide_cl_5_copy:"No mesmo painel, role at Fsica e Vida: sliders de alcance, fora, viscosidade, nmero de espcies, mutao. Pequenas mudanas aqui tm efeito grande. Experimente sem medo  voc pode sempre dar Reset.",guide_cl_6_title:"Conexes (bonds)",guide_cl_6_copy:"Com Bonds ligados, aparecem linhas entre agentes prximos da mesma espcie. Distncia e opacidade ficam no painel. Essa camada revela estrutura oculta; desligue para uma vista mais limpa.",guide_cl_7_title:"Intervenha com o pincel",guide_cl_7_copy:"Clique e arraste no canvas para empurrar ou puxar os agentes. Voc vira parte do sistema. Teste as ferramentas do painel (Pulse, Vortex, etc.) para ver como o sistema responde e se reorganiza.",guide_cl_8_title:"Pronto para explorar",guide_cl_8_copy:"Voc viu: canvas, velocidade, campo, presets, fsica, bonds e interveno. Nada aqui foi programado para ficar daquele jeito  emerge. Continue experimentando; o guia est sempre no menu."},BF={en:rR,"pt-BR":zF};function $F(e,t){const n=BF[e];return(n&&n[t])??rR[t]??String(t)}const oR="t4p_locale";function qF(){try{if(typeof window>"u")return"pt-BR";const e=localStorage.getItem(oR);return e==="en"||e==="pt-BR"?e:"pt-BR"}catch{return"pt-BR"}}function HF(e){try{typeof window<"u"&&localStorage.setItem(oR,e)}catch{}}const aR=S.createContext(null);function WF({children:e}){const[t,n]=S.useState(qF),r=S.useCallback(i=>{n(i),HF(i)},[]),a=S.useMemo(()=>({locale:t,setLocale:r,t:i=>$F(t,i)}),[t,r]);return o.jsx(aR.Provider,{value:a,children:e})}function bm(){const e=S.useContext(aR);if(!e)throw new Error("useI18n must be used within I18nProvider");return e}function iS(){const{locale:e}=bm();return S.useCallback((t,n)=>e==="en"?n:t,[e])}const s2=768;function lS(){const[e,t]=S.useState(void 0);return S.useEffect(()=>{const n=window.matchMedia(`(max-width: ${s2-1}px)`),r=()=>{t(window.innerWidth<s2)};return n.addEventListener("change",r),t(window.innerWidth<s2),()=>n.removeEventListener("change",r)},[]),!!e}const GF=[{id:"tension",label:"T",titleKey:"layer_tension",color:"#ff4444"},{id:"cohesion",label:"C",titleKey:"layer_cohesion",color:"#4488ff"},{id:"scarcity",label:"N",titleKey:"layer_scarcity",color:"#44ff88"},{id:"novelty",label:"E",titleKey:"layer_novelty",color:"#ffaa44"}],aM="'Doto', monospace",xs="'IBM Plex Mono', monospace",sM={complexityLife:"#ffd400",metaArtLab:"#ff0084",musicLab:"#37b2da",rhizomeLab:"#10d45b",alchemyLab:"#d6552d",treeOfLife:"#601480",sociogenesis:"#601480",psycheLab:"#8b5cf6",languageLab:"#c8bfaa",asimovTheater:"#7c6fcd",physicsSandbox:"#22d3ee",milPlatos:"#6366f1"},VF={complexityLife:"",metaArtLab:"",musicLab:"",rhizomeLab:"",alchemyLab:"",treeOfLife:"",sociogenesis:"",psycheLab:"",languageLab:"",asimovTheater:"",physicsSandbox:"",milPlatos:""},UF=({running:e,speed:t,fps:n,trails:r,fieldHeatmap:a,fieldLayer:i="tension",canUndo:s,particleCount:c,speciesCount:l,mode:d,regime:u,circularDependency:h,dnaString:m,simQuality:f,achievementCount:g=0,simMs:x,renderMs:v,neighborsChecked:b,interactionsApplied:w,narrativeStatus:M,activeLab:k,hideUI:R=!1,socioStats:j,viewMode:I,onLabChange:E,onGoHome:O,availableLabs:L,adminMode:$=!1,onOpenAdmin:F,onTogglePlay:B,onStep:W,onSetSpeed:re,onReset:oe,onToggleTrails:te,onToggleFieldHeatmap:J,onFieldLayerChange:pe,onUndo:P,onOpenGuide:V,onOpenAchievements:fe,onOpenWorldLog:ye,onOpenChronicle:Se,onToggleHideUI:we,onViewModeToggle:ke})=>{var Xe,Ut,Le;const{t:De,locale:_e,setLocale:ae}=bm(),Re=[{id:"complexityLife",labelKey:"tab_complexityLife"},{id:"metaArtLab",labelKey:"tab_metaArtLab"},{id:"musicLab",labelKey:"tab_musicLab"},{id:"rhizomeLab",labelKey:"tab_rhizomeLab"},{id:"alchemyLab",labelKey:"tab_alchemyLab"},{id:"treeOfLife",labelKey:"tab_treeOfLife"},{id:"sociogenesis",labelKey:"tab_sociogenesis"},{id:"psycheLab",labelKey:"tab_psycheLab"},{id:"milPlatos",labelKey:"tab_milPlatos"},{id:"languageLab",labelKey:"tab_languageLab"},{id:"asimovTheater",labelKey:"tab_asimovTheater"},{id:"physicsSandbox",labelKey:"tab_physicsSandbox"}],Fe=L&&L.length?Re.filter(Ke=>L.includes(Ke.id)):Re,Oe=sM[k]??"#ffd400",ne=lS(),[nt,pt]=S.useState(!1),Et=(Ke,...mt)=>()=>{try{Ke==null||Ke(...mt)}catch(an){console.error("[TopHUD] action failed",an)}},_t={minHeight:48,padding:"12px 16px",display:"flex",alignItems:"center",gap:12,borderBottom:"1px solid rgba(255,255,255,0.06)"},Ct=(Ke,mt=!0)=>()=>{try{Ke==null||Ke(),mt&&pt(!1)}catch(an){console.error("[TopHUD] menu action failed",an)}};return ne?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"fixed top-0 left-0 right-0 z-[900] pointer-events-auto flex items-center justify-between px-2 py-2 safe-top",style:{fontFamily:xs,background:"rgba(0,0,0,0.94)",borderBottom:"1px dashed rgba(255,255,255,0.06)",minHeight:48,paddingTop:"max(8px, env(safe-area-inset-top))"},children:[o.jsx("button",{onClick:()=>{try{pt(!0)}catch(Ke){console.error(Ke)}},"aria-label":"Menu",className:"flex items-center justify-center rounded-xl transition-all active:opacity-80",style:{width:48,height:48,background:"rgba(255,255,255,0.06)",color:Oe,border:"1px dashed rgba(255,255,255,0.1)"},children:o.jsx(jP,{size:22,strokeWidth:1.8})}),o.jsx("span",{style:{fontFamily:aM,fontSize:11,color:"rgba(255,255,255,0.6)",letterSpacing:"0.08em",textTransform:"uppercase"},children:De(((Xe=Fe.find(Ke=>Ke.id===k))==null?void 0:Xe.labelKey)||"tab_complexityLife")}),we&&o.jsx("button",{onClick:we,"aria-label":De("topHud_cinematic"),className:"flex items-center justify-center rounded-xl transition-all active:opacity-80",style:{width:48,height:48,background:R?`${Oe}15`:"rgba(255,255,255,0.06)",color:R?Oe:"rgba(255,255,255,0.5)",border:"1px dashed rgba(255,255,255,0.1)"},children:o.jsx(jl,{size:20,strokeWidth:1.8})})]}),nt&&o.jsx("div",{className:"fixed inset-0 z-[950]",style:{background:"rgba(0,0,0,0.6)",backdropFilter:"blur(4px)"},onClick:()=>pt(!1),"aria-hidden":"false",children:o.jsxs("div",{className:"absolute left-0 right-0 bottom-0 overflow-y-auto",style:{maxHeight:"85vh",background:"rgba(0,0,0,0.98)",borderTopLeftRadius:20,borderTopRightRadius:20,borderTop:"1px dashed rgba(255,255,255,0.1)",paddingBottom:"env(safe-area-inset-bottom, 0px)",fontFamily:xs},onClick:Ke=>Ke.stopPropagation(),children:[o.jsx("div",{style:{..._t,justifyContent:"center",padding:"16px"},children:o.jsx("span",{style:{fontSize:10,letterSpacing:"0.2em",color:"rgba(255,255,255,0.4)",textTransform:"uppercase"},children:"Menu"})}),O&&o.jsxs("button",{onClick:Ct(O),style:{width:"100%",..._t,background:"transparent",border:"none",color:"rgba(255,255,255,0.85)",fontSize:13,cursor:"pointer",textAlign:"left"},children:[o.jsx(rM,{size:20,strokeWidth:1.5}),De("topHud_tools")," / Labs"]}),o.jsx("div",{style:{..._t,background:"rgba(255,255,255,0.02)"},children:o.jsxs("button",{onClick:()=>Ct(B,!1)(),style:{flex:1,display:"flex",alignItems:"center",gap:12,background:"none",border:"none",color:"inherit",cursor:"pointer",fontSize:14},children:[e?o.jsx(md,{size:22}):o.jsx(sc,{size:22}),De(e?"topHud_pause":"topHud_play")]})}),o.jsxs("div",{style:{..._t,gap:16},children:[o.jsx("span",{style:{fontSize:12,color:"rgba(255,255,255,0.5)"},children:"Velocidade"}),o.jsx("select",{value:t,onChange:Ke=>{try{re(Number(Ke.target.value))}catch(mt){console.error(mt)}},"data-guide":"speed-control",style:{flex:1,maxWidth:100,padding:"10px 12px",fontSize:14,background:"rgba(255,255,255,0.06)",border:"1px dashed rgba(255,255,255,0.15)",color:"#fff",borderRadius:10},children:[1,2,3,4,5,6,7,8,9,10].map(Ke=>o.jsxs("option",{value:Ke,children:[Ke,"x"]},Ke))})]}),o.jsxs("button",{onClick:Ct(oe),style:{width:"100%",..._t,background:"transparent",border:"none",color:"rgba(255,255,255,0.8)",fontSize:13,cursor:"pointer",textAlign:"left"},children:[o.jsx(El,{size:20,strokeWidth:1.5}),De("topHud_reset")]}),o.jsxs("button",{onClick:Ct(P),disabled:!s,style:{width:"100%",..._t,background:"transparent",border:"none",color:s?"rgba(255,255,255,0.8)":"rgba(255,255,255,0.3)",fontSize:13,cursor:s?"pointer":"default",textAlign:"left"},children:[o.jsx(oM,{size:20,strokeWidth:1.5}),De("topHud_undo")]}),k==="complexityLife"&&J&&o.jsxs("button",{onClick:()=>Ct(J,!1)(),style:{width:"100%",..._t,background:"transparent",border:"none",color:a?"#ffaa44":"rgba(255,255,255,0.7)",fontSize:13,cursor:"pointer",textAlign:"left"},children:[o.jsx(cf,{size:20,strokeWidth:1.5}),De("topHud_field")," ",a?"ON":"OFF"]}),V&&o.jsxs("button",{onClick:Ct(V),style:{width:"100%",..._t,background:"transparent",border:"none",color:"#ffd400",fontSize:13,cursor:"pointer",textAlign:"left"},children:[o.jsx(Sf,{size:20,strokeWidth:1.5}),De("topHud_guide")]}),fe&&o.jsxs("button",{onClick:Ct(fe),style:{width:"100%",..._t,background:"transparent",border:"none",color:"#ffd400",fontSize:13,cursor:"pointer",textAlign:"left"},children:[o.jsx(V5,{size:20,strokeWidth:1.5}),De("topHud_achievements")," ",g>0?`(${g})`:""]}),ye&&o.jsxs("button",{onClick:Ct(ye),style:{width:"100%",..._t,background:"transparent",border:"none",color:"#37b2da",fontSize:13,cursor:"pointer",textAlign:"left"},children:[o.jsx(Bx,{size:20,strokeWidth:1.5}),"World Log"]}),Se&&o.jsxs("button",{onClick:Ct(Se),style:{width:"100%",..._t,background:"transparent",border:"none",color:"#8b5cf6",fontSize:13,cursor:"pointer",textAlign:"left"},children:[o.jsx(Lx,{size:20,strokeWidth:1.5}),"Chronicle"]}),we&&o.jsxs("button",{onClick:Ct(we),style:{width:"100%",..._t,background:"transparent",border:"none",color:R?Oe:"rgba(255,255,255,0.7)",fontSize:13,cursor:"pointer",textAlign:"left"},children:[R?o.jsx(jl,{size:20}):o.jsx(Xp,{size:20}),R?"Mostrar UI":"Canvas inteiro"]}),ke&&o.jsxs("button",{onClick:Ct(ke),style:{width:"100%",..._t,background:"transparent",border:"none",color:I==="3D"?"#a78bfa":"rgba(255,255,255,0.7)",fontSize:13,cursor:"pointer",textAlign:"left"},children:[o.jsx(Kp,{size:20,strokeWidth:1.5}),"3D ",I==="3D"?"ON":"OFF"]}),F&&o.jsxs("button",{onClick:Ct(F),style:{width:"100%",..._t,background:"transparent",border:"none",color:$?"#f59e0b":"rgba(255,255,255,0.5)",fontSize:13,cursor:"pointer",textAlign:"left"},children:[o.jsx(nM,{size:20,strokeWidth:1.5}),De("topHud_admin")," ",$?"ON":""]}),o.jsx("div",{style:{padding:"20px 16px",borderTop:"1px dashed rgba(255,255,255,0.06)"},children:o.jsx("button",{onClick:()=>pt(!1),style:{width:"100%",padding:"14px",borderRadius:12,border:"1px dashed rgba(255,255,255,0.2)",background:"transparent",color:"rgba(255,255,255,0.6)",fontSize:12,letterSpacing:"0.1em",textTransform:"uppercase",cursor:"pointer"},children:"Fechar"})})]})})]}):o.jsxs("div",{className:"fixed top-0 left-0 right-0 z-[900] pointer-events-none",style:{fontFamily:xs},children:[o.jsxs("div",{className:"flex items-stretch pointer-events-auto",style:{borderBottom:"1px dashed rgba(255,255,255,0.06)",background:"rgba(0,0,0,0.94)"},children:[O&&o.jsxs("button",{onClick:O,title:De("topHud_goHome"),className:"flex items-center gap-2 px-4 py-2 transition-all shrink-0",style:{background:"transparent",borderRight:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.40)",fontFamily:aM,fontSize:"10px",fontWeight:400,letterSpacing:"1.5px",textTransform:"uppercase"},children:[o.jsx(rM,{size:10,strokeWidth:1.5}),o.jsx("span",{className:"hidden sm:inline",children:De("topHud_tools")})]}),o.jsx("div",{className:"flex items-stretch overflow-x-auto flex-1",style:{scrollbarWidth:"none"},children:Fe.map(Ke=>{const mt=k===Ke.id,an=sM[Ke.id]||"#fff";return o.jsxs("button",{onClick:Et(E,Ke.id),title:De(Ke.labelKey),className:"flex items-center gap-1.5 px-3 py-2 transition-all whitespace-nowrap shrink-0 relative",style:{color:mt?an:"rgba(255,255,255,0.25)",fontFamily:xs,fontSize:"10px",fontWeight:mt?400:200,letterSpacing:"0.5px",textTransform:"uppercase",background:mt?`${an}06`:"transparent",borderRight:"1px dashed rgba(255,255,255,0.03)"},children:[o.jsx("span",{style:{fontSize:"13px",lineHeight:1},children:VF[Ke.id]}),o.jsx("span",{className:"hidden lg:inline",children:De(Ke.labelKey)}),mt&&o.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-px",style:{background:an+"55"}})]},Ke.id)})}),o.jsx("div",{className:"flex items-center shrink-0",style:{borderLeft:"1px dashed rgba(255,255,255,0.06)"},children:o.jsxs("select",{value:_e,onChange:Ke=>ae(Ke.target.value),title:_e==="en"?"English":"Portugus (Brasil)",className:"cursor-pointer transition-colors focus:outline-none",style:{fontFamily:xs,fontSize:"9px",fontWeight:300,color:"rgba(255,255,255,0.55)",background:"rgba(255,255,255,0.03)",border:"1px dashed rgba(255,255,255,0.08)",padding:"2px 6px",margin:"0 8px",textTransform:"uppercase",letterSpacing:"0.6px"},children:[o.jsx("option",{value:"pt-BR",style:{background:"#000",color:"#fff"},children:"PT"}),o.jsx("option",{value:"en",style:{background:"#000",color:"#fff"},children:"EN"})]})}),F&&o.jsxs("button",{onClick:Et(F),title:De($?"topHud_admin_title":"topHud_admin_title_off"),className:"flex items-center gap-1 px-3 py-2 transition-all shrink-0",style:{borderLeft:"1px dashed rgba(255,255,255,0.06)",background:$?"rgba(245,158,11,0.10)":"transparent",color:$?"#f59e0b":"rgba(255,255,255,0.25)",fontFamily:xs,fontSize:"9px",fontWeight:300,letterSpacing:"1px",textTransform:"uppercase"},children:[o.jsx(nM,{size:10,strokeWidth:1.5}),o.jsx("span",{className:"hidden sm:inline",children:De("topHud_admin")})]}),ke&&o.jsxs("button",{onClick:ke,title:De(I==="3D"?"topHud_3d_title":"topHud_3d_title_off"),className:"flex items-center gap-1 px-3 py-2 transition-all shrink-0",style:{borderLeft:"1px dashed rgba(255,255,255,0.06)",background:I==="3D"?"rgba(139,92,246,0.06)":"transparent",color:I==="3D"?"#a78bfa":"rgba(255,255,255,0.25)",fontFamily:xs,fontSize:"9px",fontWeight:300,letterSpacing:"1px",textTransform:"uppercase"},children:[o.jsx(Kp,{size:10,strokeWidth:1.5}),"3D"]})]}),k!=="psycheLab"&&k!=="musicLab"&&k!=="alchemyLab"&&k!=="metaArtLab"&&k!=="rhizomeLab"&&k!=="asimovTheater"&&k!=="languageLab"&&k!=="treeOfLife"&&k!=="physicsSandbox"&&k!=="milPlatos"&&o.jsxs("div",{className:"flex items-center justify-between px-3 py-1.5 gap-2 pointer-events-auto",style:{background:"rgba(0,0,0,0.92)",borderBottom:"1px dashed rgba(255,255,255,0.06)"},children:[o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx("button",{onClick:Et(B),className:"p-1.5 transition-all",title:De(e?"topHud_pause":"topHud_play"),"data-guide":"play-button",style:{color:e?Oe:"rgba(255,255,255,0.7)",background:e?`${Oe}10`:"transparent",border:e?`1px dashed ${Oe}30`:"1px dashed transparent"},children:e?o.jsx(md,{size:12,strokeWidth:1.5}):o.jsx(sc,{size:12,strokeWidth:1.5})}),o.jsx("div",{className:"w-px h-3",style:{borderLeft:"1px dashed rgba(255,255,255,0.12)"}}),o.jsx("div",{"data-guide":"speed-control",children:o.jsx("select",{value:t,onChange:Ke=>re(Number(Ke.target.value)),className:"cursor-pointer transition-colors focus:outline-none",style:{fontFamily:xs,fontSize:"10px",fontWeight:300,color:"rgba(255,255,255,0.7)",background:"rgba(255,255,255,0.04)",border:"1px dashed rgba(255,255,255,0.08)",padding:"2px 4px"},children:[1,2,3,4,5,6,7,8,9,10].map(Ke=>o.jsxs("option",{value:Ke,style:{background:"#000",color:"#fff"},children:[Ke,"x"]},Ke))})}),o.jsx("div",{className:"w-px h-3",style:{borderLeft:"1px dashed rgba(255,255,255,0.12)"}}),o.jsx("button",{onClick:Et(oe),className:"p-1.5 transition-colors",title:De("topHud_reset"),style:{color:"rgba(255,255,255,0.45)"},children:o.jsx(El,{size:11,strokeWidth:1.5})}),o.jsx("button",{onClick:Et(P),className:"p-1.5 transition-colors disabled:opacity-20",title:De("topHud_undo"),disabled:!s,style:{color:"rgba(255,255,255,0.45)"},children:o.jsx(oM,{size:11,strokeWidth:1.5})}),k==="complexityLife"&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-px h-3",style:{borderLeft:"1px dashed rgba(255,255,255,0.12)"}}),o.jsxs("button",{"data-guide":"overlay-field",onClick:Et(J),className:"flex items-center gap-1 p-1.5 transition-all",title:De("topHud_field_title"),style:{color:a?"#ffaa44":"rgba(255,255,255,0.30)",background:a?"rgba(255,170,68,0.06)":"transparent",border:a?"1px dashed rgba(255,170,68,0.25)":"1px dashed transparent",fontFamily:xs,fontSize:"9px",fontWeight:200,letterSpacing:"0.5px",textTransform:"uppercase"},children:[o.jsx(cf,{size:10,strokeWidth:1.5}),o.jsx("span",{className:"hidden sm:inline",children:De("topHud_field")})]}),a&&pe&&o.jsx("div",{className:"flex items-center gap-0.5",children:GF.map(Ke=>o.jsx("button",{onClick:()=>pe(Ke.id),title:De(Ke.titleKey),className:"w-5 h-5 transition-all flex items-center justify-center",style:{fontSize:"8px",fontFamily:xs,fontWeight:i===Ke.id?400:200,color:i===Ke.id?Ke.color:"rgba(255,255,255,0.25)",background:i===Ke.id?`${Ke.color}0c`:"transparent",border:i===Ke.id?`1px dashed ${Ke.color}35`:"1px dashed transparent"},children:Ke.label},Ke.id))})]}),V&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-px h-3",style:{borderLeft:"1px dashed rgba(255,255,255,0.12)"}}),o.jsx("button",{onClick:Et(V),className:"p-1.5 transition-colors",title:De("topHud_guide"),"data-guide-button":!0,style:{color:"#ffd400"},children:o.jsx(Sf,{size:11,strokeWidth:1.5})})]}),fe&&o.jsxs("button",{onClick:Et(fe),className:"relative p-1.5 transition-colors",title:De("topHud_achievements"),style:{color:"#ffd400"},children:[o.jsx(V5,{size:11,strokeWidth:1.5}),g>0&&o.jsx("div",{className:"absolute -top-0.5 -right-0.5 w-3 h-3 flex items-center justify-center",style:{background:"#ffd400"},children:o.jsx("span",{style:{fontSize:"7px",fontWeight:600,color:"#000"},children:g>9?"9+":g})})]}),ye&&o.jsx("button",{onClick:Et(ye),className:"p-1.5 transition-colors",title:"World Log",style:{color:"#37b2da"},children:o.jsx(Bx,{size:11,strokeWidth:1.5})}),Se&&o.jsx("button",{onClick:Et(Se),className:"p-1.5 transition-colors",title:"Chronicle",style:{color:"#8b5cf6"},children:o.jsx(Lx,{size:11,strokeWidth:1.5})}),we&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-px h-3",style:{borderLeft:"1px dashed rgba(255,255,255,0.12)"}}),o.jsx("button",{onClick:Et(we),className:"p-1.5 transition-colors",title:De("topHud_cinematic"),style:{color:R?"#37b2da":"rgba(255,255,255,0.30)"},children:R?o.jsx(Xp,{size:11,strokeWidth:1.5}):o.jsx(jl,{size:11,strokeWidth:1.5})})]})]}),o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx("span",{style:{fontFamily:xs,fontSize:"9px",fontWeight:300,color:"rgba(255,255,255,0.4)"},children:n}),(x!==void 0||v!==void 0)&&o.jsxs(o.Fragment,{children:[o.jsx("span",{style:{color:"rgba(255,255,255,0.15)"},children:"/"}),o.jsxs("span",{style:{fontFamily:xs,fontSize:"9px",fontWeight:200,color:"rgba(255,255,255,0.3)"},children:[((Ut=x==null?void 0:x.toFixed)==null?void 0:Ut.call(x,1))??"-","+",((Le=v==null?void 0:v.toFixed)==null?void 0:Le.call(v,1))??"-","ms"]})]}),f&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-px h-3",style:{borderLeft:"1px dashed rgba(255,255,255,0.08)"}}),o.jsx("span",{style:{fontFamily:xs,fontSize:"9px",fontWeight:200,color:"rgba(255,255,255,0.25)",textTransform:"uppercase",letterSpacing:"0.5px"},children:f})]}),o.jsx("div",{className:"w-px h-3",style:{borderLeft:"1px dashed rgba(255,255,255,0.08)"}}),o.jsxs("span",{style:{fontFamily:xs,fontSize:"9px",fontWeight:300,color:"rgba(255,255,255,0.5)"},children:[c,o.jsx("span",{style:{color:"rgba(255,255,255,0.2)",margin:"0 2px"},children:"/"}),o.jsx("span",{style:{color:Oe},children:l})]}),o.jsx("div",{className:"w-px h-3",style:{borderLeft:"1px dashed rgba(255,255,255,0.08)"}}),o.jsx("span",{style:{fontFamily:xs,fontSize:"9px",fontWeight:300,color:Oe,textTransform:"uppercase",letterSpacing:"1px"},children:u}),M&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-px h-3",style:{borderLeft:"1px dashed rgba(255,255,255,0.08)"}}),o.jsx("span",{style:{fontFamily:xs,fontSize:"9px",fontWeight:200,color:"#37b2da",fontStyle:"italic"},children:M})]}),h>0&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-px h-3",style:{borderLeft:"1px dashed rgba(255,255,255,0.08)"}}),o.jsxs("span",{style:{fontFamily:xs,fontSize:"9px",fontWeight:300,color:"rgba(255,255,255,0.5)"},children:["CIRCULAR ",Math.round(h*100),"%"]})]}),j&&k==="sociogenesis"&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-px h-3",style:{borderLeft:"1px dashed rgba(255,255,255,0.08)"}}),o.jsxs("span",{style:{fontFamily:xs,fontSize:"9px",fontWeight:300},children:[o.jsxs("span",{style:{color:"#37b2da"},children:["T",j.totems]})," ",o.jsxs("span",{style:{color:"#ff4444"},children:["X",j.taboos]})," ",o.jsxs("span",{style:{color:"#8b5cf6"},children:["R",j.rituals]}),j.tribes>0&&o.jsxs(o.Fragment,{children:[" ",o.jsxs("span",{style:{color:"#10d45b"},children:["G",j.tribes]})]})]})]})]})]})]})},Cp=[{id:"crystal_lattice",name:"Crystal Lattice",description:"Grades peridicas cristalizam. Alta coeso, entropia zero.",category:"stable",tags:["crystal","stable","grid"],seed:7777,particleCount:600,typesCount:3,micro:{force:.65,drag:2.4,entropy:0,rmax:.26,beta:.48,coreRepel:1.2,speedClamp:.05},field:{diffusionRate:.55,decayRate:.008},reconfig:{detectionInterval:6},matrix:{style:"harmonic"}},{id:"orbital_dance",name:"Orbital Dance",description:"Clusters orbitam em ciclos estveis. Dependncia circular cria rbitas.",category:"stable",tags:["orbit","cyclic","rotation"],seed:3141,particleCount:500,typesCount:4,micro:{force:1.15,drag:1.45,entropy:.04,rmax:.19,circularDependency:.65,speedClamp:.12},field:{diffusionRate:.68,decayRate:.014},reconfig:{detectionInterval:4.5},matrix:{style:"ring"}},{id:"membrane_world",name:"Membrane World",description:"Cascas celulares ocas colidem e fundem. Padro biolgico emergente.",category:"stable",tags:["membrane","shells","cell-like"],seed:2718,particleCount:550,typesCount:4,micro:{force:.85,drag:1.9,entropy:.02,rmax:.21,beta:.42,coreRepel:.95},field:{diffusionRate:.62,decayRate:.011},reconfig:{detectionInterval:5},matrix:{style:"mitosis"}},{id:"predator_wave",name:"Predator Wave",description:"Ondas ecolgicas: populaes oscilam em ciclos Lotka-Volterra.",category:"living",tags:["predator","prey","ecology","cycles"],seed:2002,particleCount:700,typesCount:4,micro:{force:1.45,drag:1.05,entropy:.09,rmax:.2,foodEnabled:!0,foodRatio:.22},field:{diffusionRate:.78,decayRate:.02},reconfig:{detectionInterval:3.5},matrix:{style:"predator"}},{id:"cell_division",name:"Cell Division",description:"Clulas com energia reproduzem por diviso. Observe a populao crescer.",category:"living",tags:["mitosis","energy","reproduction","growth"],seed:2001,particleCount:200,typesCount:3,micro:{force:.95,drag:1.5,entropy:.02,rmax:.16,energyEnabled:!0,energyDecay:8e-4,energyFeedRate:.1,energyReproThreshold:1.6},field:{diffusionRate:.58,decayRate:.018},reconfig:{detectionInterval:3},matrix:{style:"mitosis"}},{id:"symbiotic_web",name:"Symbiotic Web",description:"Espcies co-dependentes tecem redes de cooperao mtua.",category:"living",tags:["symbiosis","cooperation","clusters"],seed:2003,particleCount:600,typesCount:5,micro:{force:1.05,drag:1.65,entropy:.03,rmax:.24,beta:.36},field:{diffusionRate:.66,decayRate:.013},reconfig:{detectionInterval:4.5},matrix:{style:"symbiotic"}},{id:"spiral_galaxy",name:"Spiral Galaxy",description:"Braos espirais giram como uma galxia. Dependncia circular mxima.",category:"wild",tags:["spiral","galaxy","rotation"],seed:9001,particleCount:800,typesCount:5,micro:{force:1.25,drag:1.2,entropy:.06,rmax:.22,circularDependency:.72},field:{diffusionRate:.74,decayRate:.016},reconfig:{detectionInterval:4},matrix:{style:"cyclic"}},{id:"reaction_diffusion",name:"Reaction Diffusion",description:"Padres de Turing: ondas, manchas e listras auto-organizam.",category:"wild",tags:["turing","patterns","waves"],seed:1618,particleCount:750,typesCount:2,micro:{force:1.8,drag:.85,entropy:.28,rmax:.14,beta:.25,speedClamp:.18},field:{diffusionRate:.92,decayRate:.03},reconfig:{detectionInterval:3},matrix:{style:"sparse"}}],Yh=[...Cp,{id:"pollock",name:"Pollock Drip",description:"Chaotic splatter patterns, high entropy expressionism",seed:1001,particleCount:800,typesCount:6,micro:{force:2,drag:.8,entropy:.25,rmax:.18,speedClamp:.15},field:{diffusionRate:.85,decayRate:.02},reconfig:{detectionInterval:4},matrix:{style:"chaotic"}},{id:"kandinsky",name:"Kandinsky Circles",description:"Geometric balance, harmonic color orbits",seed:1002,particleCount:600,typesCount:5,micro:{force:1.2,drag:1.5,entropy:.05,rmax:.25,beta:.4,coreRepel:.8},field:{diffusionRate:.7,decayRate:.015},reconfig:{detectionInterval:5},matrix:{style:"harmonic"}},{id:"mondrian",name:"Mondrian Grid",description:"Orthogonal structure, minimal palette",seed:1003,particleCount:400,typesCount:3,micro:{force:.8,drag:2,entropy:0,rmax:.3,beta:.5},field:{diffusionRate:.5,decayRate:.01},reconfig:{detectionInterval:6},matrix:{style:"harmonic"}},{id:"miro",name:"Mir Dream",description:"Surreal slow drift, biomorphic shapes",seed:1004,particleCount:500,typesCount:4,micro:{force:.6,drag:1.8,entropy:.1,rmax:.22,circularDependency:.3},field:{diffusionRate:.9,decayRate:.005},reconfig:{detectionInterval:5.5},matrix:{style:"symbiotic"}},{id:"rothko",name:"Rothko Fields",description:"Color field meditation, soft boundaries",seed:1005,particleCount:350,typesCount:3,micro:{force:.4,drag:2.2,entropy:.02,rmax:.35,beta:.3},field:{diffusionRate:.95,decayRate:.004},reconfig:{detectionInterval:7},matrix:{style:"harmonic"}},{id:"klee",name:"Klee Mosaic",description:"Tiled patterns, playful geometry",seed:1006,particleCount:550,typesCount:7,micro:{force:1,drag:1.6,entropy:.08,rmax:.2,beta:.4},field:{diffusionRate:.72,decayRate:.016},reconfig:{detectionInterval:4.8},matrix:{style:"block"}},{id:"malevich",name:"Malevich Supremacy",description:"Pure geometric abstraction, minimal forms",seed:1007,particleCount:300,typesCount:2,micro:{force:.7,drag:2.1,entropy:0,rmax:.28,beta:.5},field:{diffusionRate:.55,decayRate:.008},reconfig:{detectionInterval:8},matrix:{style:"harmonic"}},{id:"dekooning",name:"De Kooning Gesture",description:"Violent brush strokes, abstract expressionism",seed:1008,particleCount:750,typesCount:5,micro:{force:2.3,drag:.85,entropy:.22,rmax:.16,speedClamp:.14},field:{diffusionRate:.88,decayRate:.028},reconfig:{detectionInterval:3.5},matrix:{style:"chaotic"}},{id:"mitosis",name:"Mitosis",description:"Cell division cascade, exponential growth",seed:2001,particleCount:200,typesCount:3,micro:{force:1,drag:1.4,entropy:.02,rmax:.15,energyEnabled:!0,energyDecay:.001,energyFeedRate:.08,energyReproThreshold:1.8},field:{diffusionRate:.6,decayRate:.02},reconfig:{detectionInterval:3},matrix:{style:"mitosis"}},{id:"predator_prey",name:"Predator-Prey",description:"Ecological cycles, population waves",seed:2002,particleCount:700,typesCount:4,micro:{force:1.5,drag:1.1,entropy:.08,rmax:.2,foodEnabled:!0,foodRatio:.2},field:{diffusionRate:.75,decayRate:.018},reconfig:{detectionInterval:3.5},matrix:{style:"predator"}},{id:"symbiosis",name:"Symbiosis",description:"Mutual cooperation, stable clusters",seed:2003,particleCount:600,typesCount:5,micro:{force:1.1,drag:1.6,entropy:.03,rmax:.24,beta:.35},field:{diffusionRate:.65,decayRate:.012},reconfig:{detectionInterval:4.5},matrix:{style:"symbiotic"}},{id:"parasitism",name:"Parasitism",description:"One-sided exploitation, chase dynamics",seed:2004,particleCount:800,typesCount:6,micro:{force:1.8,drag:.9,entropy:.12,rmax:.19,circularDependency:.5},field:{diffusionRate:.8,decayRate:.025},reconfig:{detectionInterval:3},matrix:{style:"predator"}},{id:"coral_reef",name:"Coral Reef",description:"Sessile organisms, branching structures",seed:2005,particleCount:650,typesCount:6,micro:{force:.9,drag:2,entropy:.04,rmax:.22,beta:.4},field:{diffusionRate:.68,decayRate:.01},reconfig:{detectionInterval:5.2},matrix:{style:"symbiotic"}},{id:"mycelium",name:"Mycelium Network",description:"Fungal threads, underground intelligence",seed:2006,particleCount:900,typesCount:4,micro:{force:.7,drag:1.8,entropy:.06,rmax:.28,circularDependency:.2},field:{diffusionRate:.82,decayRate:.009},reconfig:{detectionInterval:4.8},matrix:{style:"sparse"}},{id:"slime_mold",name:"Slime Mold",description:"Collective intelligence, path optimization",seed:2007,particleCount:750,typesCount:3,micro:{force:1.2,drag:1.3,entropy:.07,rmax:.25,beta:.3},field:{diffusionRate:.78,decayRate:.014},reconfig:{detectionInterval:4.2},matrix:{style:"symbiotic"}},{id:"bacteria",name:"Bacterial Colony",description:"Rapid reproduction, biofilm formation",seed:2008,particleCount:1e3,typesCount:5,micro:{force:1.3,drag:1,entropy:.1,rmax:.18,energyEnabled:!0,energyDecay:.002,energyFeedRate:.1,energyReproThreshold:1.5},field:{diffusionRate:.85,decayRate:.022},reconfig:{detectionInterval:2.8},matrix:{style:"mitosis"}},{id:"virus",name:"Viral Outbreak",description:"Infection spread, exponential cascade",seed:2009,particleCount:500,typesCount:4,micro:{force:2,drag:.8,entropy:.15,rmax:.2,speedClamp:.16},field:{diffusionRate:.9,decayRate:.03},reconfig:{detectionInterval:2.5},matrix:{style:"predator"}},{id:"immune",name:"Immune Response",description:"White cells hunting pathogens",seed:2010,particleCount:800,typesCount:6,micro:{force:1.7,drag:1.1,entropy:.09,rmax:.21},field:{diffusionRate:.76,decayRate:.02},reconfig:{detectionInterval:3.3},matrix:{style:"predator"}},{id:"nebula",name:"Nebula",description:"Gas cloud swirls, slow gravitational dance",seed:3001,particleCount:1e3,typesCount:4,micro:{force:.5,drag:2.5,entropy:.15,rmax:.35,beta:.2,coreRepel:.3},field:{diffusionRate:.95,decayRate:.003},reconfig:{detectionInterval:6},matrix:{style:"harmonic"}},{id:"supernova",name:"Supernova",description:"Explosive expansion, shock waves",seed:3002,particleCount:600,typesCount:5,micro:{force:3,drag:.6,entropy:.3,rmax:.12,speedClamp:.2},field:{diffusionRate:.92,decayRate:.04},reconfig:{detectionInterval:2.5},matrix:{style:"chaotic"}},{id:"black_hole",name:"Black Hole",description:"Gravitational collapse, accretion disk",seed:3003,particleCount:700,typesCount:3,micro:{force:2.5,drag:1,entropy:.05,rmax:.28,beta:.1,coreRepel:2},field:{diffusionRate:.6,decayRate:.008},reconfig:{detectionInterval:4},matrix:{style:"cyclic"}},{id:"galaxy",name:"Galaxy Spiral",description:"Rotating arms, orbital mechanics",seed:3004,particleCount:900,typesCount:6,micro:{force:1.3,drag:1.4,entropy:.07,rmax:.26,circularDependency:.7},field:{diffusionRate:.7,decayRate:.01},reconfig:{detectionInterval:5},matrix:{style:"cyclic"}},{id:"pulsar",name:"Pulsar Beacon",description:"Rhythmic pulses, radio waves",seed:3005,particleCount:450,typesCount:3,micro:{force:1.8,drag:1.2,entropy:.12,rmax:.24,beta:.5},field:{diffusionRate:.88,decayRate:.025},reconfig:{detectionInterval:3.2},matrix:{style:"ring"}},{id:"quasar",name:"Quasar Jet",description:"High-energy beams, relativistic speeds",seed:3006,particleCount:550,typesCount:4,micro:{force:2.8,drag:.7,entropy:.2,rmax:.15,speedClamp:.18},field:{diffusionRate:.9,decayRate:.035},reconfig:{detectionInterval:2.8},matrix:{style:"chaotic"}},{id:"asteroid",name:"Asteroid Belt",description:"Orbital debris, collision dynamics",seed:3007,particleCount:800,typesCount:5,micro:{force:1.1,drag:1.5,entropy:.11,rmax:.23},field:{diffusionRate:.73,decayRate:.015},reconfig:{detectionInterval:4.5},matrix:{style:"sparse"}},{id:"comet",name:"Comet Tail",description:"Solar wind trails, ice sublimation",seed:3008,particleCount:650,typesCount:4,micro:{force:1.6,drag:1,entropy:.16,rmax:.2,speedClamp:.12},field:{diffusionRate:.86,decayRate:.027},reconfig:{detectionInterval:3.6},matrix:{style:"chaotic"}},{id:"revolution",name:"Revolution",description:"Uprising waves, regime change cycles",seed:4001,particleCount:800,typesCount:5,micro:{force:2.2,drag:.85,entropy:.18,rmax:.17,speedClamp:.12},field:{diffusionRate:.88,decayRate:.03},reconfig:{detectionInterval:2.8,speciationThreshold:.6},matrix:{style:"chaotic"}},{id:"harmony",name:"Harmony",description:"Peaceful coexistence, balanced equilibrium",seed:4002,particleCount:600,typesCount:4,micro:{force:.9,drag:1.7,entropy:.01,rmax:.27,beta:.4},field:{diffusionRate:.65,decayRate:.01},reconfig:{detectionInterval:6},matrix:{style:"harmonic"}},{id:"market",name:"Market Chaos",description:"Economic fluctuations, boom-bust cycles",seed:4003,particleCount:750,typesCount:6,micro:{force:1.6,drag:1,entropy:.14,rmax:.21},field:{diffusionRate:.78,decayRate:.022},reconfig:{detectionInterval:3.2},matrix:{style:"chaotic"}},{id:"tribe",name:"Tribal Clusters",description:"Group formation, territorial boundaries",seed:4004,particleCount:700,typesCount:5,micro:{force:1.4,drag:1.3,entropy:.06,rmax:.23,beta:.35,coreRepel:1.2},field:{diffusionRate:.68,decayRate:.015},reconfig:{detectionInterval:4.5},matrix:{style:"symbiotic"}},{id:"propaganda",name:"Propaganda Spread",description:"Information cascade, viral memes",seed:4005,particleCount:850,typesCount:4,micro:{force:1.9,drag:.9,entropy:.17,rmax:.19},field:{diffusionRate:.91,decayRate:.032},reconfig:{detectionInterval:2.9},matrix:{style:"predator"}},{id:"migration",name:"Migration",description:"Mass movement, cultural diffusion",seed:4006,particleCount:700,typesCount:5,micro:{force:1.3,drag:1.2,entropy:.1,rmax:.22},field:{diffusionRate:.8,decayRate:.019},reconfig:{detectionInterval:3.8},matrix:{style:"chaotic"}},{id:"quantum",name:"Quantum Foam",description:"Uncertainty principle, probabilistic motion",seed:5001,particleCount:500,typesCount:7,micro:{force:1,drag:1.2,entropy:.35,rmax:.16,speedClamp:.08},field:{diffusionRate:.92,decayRate:.035},reconfig:{detectionInterval:2.5},matrix:{style:"chaotic"}},{id:"plasma",name:"Plasma Storm",description:"Ionized gas, electromagnetic chaos",seed:5002,particleCount:900,typesCount:6,micro:{force:2.1,drag:.8,entropy:.23,rmax:.17,speedClamp:.14},field:{diffusionRate:.89,decayRate:.029},reconfig:{detectionInterval:3},matrix:{style:"chaotic"}},{id:"superconductor",name:"Superconductor",description:"Zero resistance, perfect flow",seed:5003,particleCount:550,typesCount:3,micro:{force:1.5,drag:.1,entropy:0,rmax:.26,beta:.5},field:{diffusionRate:.98,decayRate:.001},reconfig:{detectionInterval:7},matrix:{style:"harmonic"}},{id:"ferrofluid",name:"Ferrofluid",description:"Magnetic liquid, spike formations",seed:5004,particleCount:650,typesCount:4,micro:{force:1.4,drag:1.4,entropy:.08,rmax:.21,coreRepel:1.5},field:{diffusionRate:.7,decayRate:.013},reconfig:{detectionInterval:4},matrix:{style:"block"}},{id:"crystal",name:"Crystal Growth",description:"Lattice formation, periodic structure",seed:5005,particleCount:700,typesCount:5,micro:{force:1,drag:1.9,entropy:.02,rmax:.24,beta:.45},field:{diffusionRate:.62,decayRate:.008},reconfig:{detectionInterval:5.5},matrix:{style:"harmonic"}},{id:"turbulence",name:"Turbulence",description:"Chaotic fluid flow, vortex cascade",seed:5006,particleCount:850,typesCount:6,micro:{force:1.8,drag:.95,entropy:.2,rmax:.19,circularDependency:.6},field:{diffusionRate:.87,decayRate:.026},reconfig:{detectionInterval:3.1},matrix:{style:"chaotic"}},{id:"bose_einstein",name:"Bose-Einstein",description:"Quantum condensate, collective state",seed:5007,particleCount:400,typesCount:2,micro:{force:.6,drag:2.3,entropy:0,rmax:.32,beta:.5},field:{diffusionRate:.97,decayRate:.002},reconfig:{detectionInterval:8},matrix:{style:"harmonic"}},{id:"sonoluminescence",name:"Sonoluminescence",description:"Sound-to-light, bubble collapse",seed:5008,particleCount:550,typesCount:4,micro:{force:2.4,drag:1.1,entropy:.13,rmax:.18,coreRepel:1.8},field:{diffusionRate:.84,decayRate:.024},reconfig:{detectionInterval:3.4},matrix:{style:"ring"}},{id:"fractal",name:"Fractal Bloom",description:"Self-similar patterns, recursive emergence",seed:6001,particleCount:650,typesCount:5,micro:{force:1.1,drag:1.5,entropy:.04,rmax:.2,beta:.3},field:{diffusionRate:.72,decayRate:.012},reconfig:{detectionInterval:4,speciationThreshold:.7},matrix:{style:"cyclic"}},{id:"neural",name:"Neural Net",description:"Synaptic connections, learning dynamics",seed:6002,particleCount:800,typesCount:6,micro:{force:1.3,drag:1.1,entropy:.09,rmax:.24,circularDependency:.4},field:{diffusionRate:.75,decayRate:.018},reconfig:{detectionInterval:3.5},matrix:{style:"cyclic"}},{id:"emergence",name:"Pure Emergence",description:"Minimal rules, maximum complexity",seed:6003,particleCount:700,typesCount:4,micro:{force:1.4,drag:1.2,entropy:.11,rmax:.22},field:{diffusionRate:.8,decayRate:.02},reconfig:{detectionInterval:3.8},matrix:{style:"symbiotic"}},{id:"swarm",name:"Swarm Intelligence",description:"Collective behavior, stigmergy",seed:6004,particleCount:950,typesCount:5,micro:{force:1.2,drag:1.3,entropy:.1,rmax:.21,circularDependency:.3},field:{diffusionRate:.77,decayRate:.017},reconfig:{detectionInterval:3.9},matrix:{style:"symbiotic"}},{id:"autopilot",name:"Autopilot",description:"Self-organization, spontaneous order",seed:6005,particleCount:600,typesCount:4,micro:{force:1.1,drag:1.4,entropy:.06,rmax:.23,beta:.35},field:{diffusionRate:.7,decayRate:.014},reconfig:{detectionInterval:4.3},matrix:{style:"harmonic"}},{id:"cascade",name:"Cascade",description:"Chain reactions, avalanche dynamics",seed:6006,particleCount:750,typesCount:6,micro:{force:1.9,drag:.95,entropy:.16,rmax:.2},field:{diffusionRate:.85,decayRate:.028},reconfig:{detectionInterval:2.9},matrix:{style:"predator"}},{id:"attractor",name:"Strange Attractor",description:"Chaotic orbits, sensitive dependence",seed:6007,particleCount:550,typesCount:5,micro:{force:1.5,drag:1.1,entropy:.19,rmax:.22,circularDependency:.8},field:{diffusionRate:.82,decayRate:.021},reconfig:{detectionInterval:3.3},matrix:{style:"chaotic"}},{id:"percolation",name:"Percolation",description:"Threshold transition, critical point",seed:6008,particleCount:650,typesCount:4,micro:{force:1.2,drag:1.4,entropy:.12,rmax:.25},field:{diffusionRate:.75,decayRate:.019},reconfig:{detectionInterval:3.7},matrix:{style:"sparse"}},{id:"resonance",name:"Resonance",description:"Harmonic coupling, synchronized oscillation",seed:6009,particleCount:600,typesCount:5,micro:{force:1.1,drag:1.5,entropy:.05,rmax:.24,beta:.4},field:{diffusionRate:.71,decayRate:.013},reconfig:{detectionInterval:4.6},matrix:{style:"harmonic"}},{id:"bifurcation",name:"Bifurcation",description:"Period doubling, route to chaos",seed:6010,particleCount:700,typesCount:6,micro:{force:1.6,drag:1,entropy:.14,rmax:.21},field:{diffusionRate:.79,decayRate:.023},reconfig:{detectionInterval:3.4},matrix:{style:"chaotic"}},{id:"aurora",name:"Aurora Borealis",description:"Magnetic curtains, solar wind dance",seed:7001,particleCount:750,typesCount:5,micro:{force:1.4,drag:1.6,entropy:.11,rmax:.23,beta:.35},field:{diffusionRate:.88,decayRate:.016},reconfig:{detectionInterval:4.2},matrix:{style:"harmonic"}},{id:"volcano",name:"Volcanic Eruption",description:"Magma plumes, pyroclastic flow",seed:7002,particleCount:850,typesCount:6,micro:{force:2.1,drag:.9,entropy:.18,rmax:.19,speedClamp:.15},field:{diffusionRate:.83,decayRate:.026},reconfig:{detectionInterval:3.1},matrix:{style:"chaotic"}},{id:"tornado",name:"Tornado Vortex",description:"Spiral winds, destructive rotation",seed:7003,particleCount:700,typesCount:4,micro:{force:1.8,drag:1,entropy:.13,rmax:.21,circularDependency:.9},field:{diffusionRate:.81,decayRate:.023},reconfig:{detectionInterval:3.4},matrix:{style:"cyclic"}},{id:"tsunami",name:"Tsunami Wave",description:"Tidal surge, underwater earthquake",seed:7004,particleCount:900,typesCount:5,micro:{force:1.6,drag:1.3,entropy:.14,rmax:.22},field:{diffusionRate:.86,decayRate:.021},reconfig:{detectionInterval:3.6},matrix:{style:"chaotic"}},{id:"lightning",name:"Lightning Storm",description:"Electric discharge, fractal branching",seed:7005,particleCount:600,typesCount:4,micro:{force:2.3,drag:.8,entropy:.21,rmax:.17,speedClamp:.17},field:{diffusionRate:.91,decayRate:.031},reconfig:{detectionInterval:2.7},matrix:{style:"sparse"}},{id:"earthquake",name:"Earthquake",description:"Tectonic shift, seismic waves",seed:7006,particleCount:800,typesCount:5,micro:{force:1.9,drag:1.1,entropy:.16,rmax:.2},field:{diffusionRate:.79,decayRate:.024},reconfig:{detectionInterval:3.3},matrix:{style:"chaotic"}},{id:"sandstorm",name:"Sandstorm",description:"Desert winds, dust devils",seed:7007,particleCount:950,typesCount:6,micro:{force:1.5,drag:1.2,entropy:.19,rmax:.21},field:{diffusionRate:.87,decayRate:.027},reconfig:{detectionInterval:3.2},matrix:{style:"chaotic"}},{id:"avalanche",name:"Avalanche",description:"Snow cascade, critical slope",seed:7008,particleCount:750,typesCount:4,micro:{force:1.7,drag:1,entropy:.15,rmax:.22},field:{diffusionRate:.82,decayRate:.025},reconfig:{detectionInterval:3.1},matrix:{style:"predator"}},{id:"geyser",name:"Geyser",description:"Periodic eruption, hydrothermal pressure",seed:7009,particleCount:550,typesCount:3,micro:{force:2.2,drag:1,entropy:.12,rmax:.19,coreRepel:1.6},field:{diffusionRate:.84,decayRate:.022},reconfig:{detectionInterval:3.5},matrix:{style:"ring"}},{id:"wildfire",name:"Wildfire",description:"Forest blaze, exponential spread",seed:7010,particleCount:850,typesCount:5,micro:{force:1.8,drag:.95,entropy:.17,rmax:.2},field:{diffusionRate:.89,decayRate:.029},reconfig:{detectionInterval:2.9},matrix:{style:"predator"}},{id:"symphony",name:"Symphony",description:"Orchestral harmony, multi-voice counterpoint",seed:8001,particleCount:800,typesCount:7,micro:{force:1.1,drag:1.6,entropy:.04,rmax:.25,beta:.42},field:{diffusionRate:.72,decayRate:.011},reconfig:{detectionInterval:5},matrix:{style:"harmonic"}},{id:"jazz",name:"Jazz Improvisation",description:"Syncopated rhythms, spontaneous creation",seed:8002,particleCount:650,typesCount:5,micro:{force:1.4,drag:1.2,entropy:.14,rmax:.22,circularDependency:.5},field:{diffusionRate:.8,decayRate:.02},reconfig:{detectionInterval:3.7},matrix:{style:"chaotic"}},{id:"techno",name:"Techno Pulse",description:"Repetitive beats, hypnotic loops",seed:8003,particleCount:700,typesCount:4,micro:{force:1.3,drag:1.3,entropy:.08,rmax:.23,beta:.38},field:{diffusionRate:.74,decayRate:.017},reconfig:{detectionInterval:4.1},matrix:{style:"cyclic"}},{id:"ambient",name:"Ambient Drift",description:"Atmospheric textures, slow evolution",seed:8004,particleCount:500,typesCount:3,micro:{force:.7,drag:2.1,entropy:.06,rmax:.29,beta:.3},field:{diffusionRate:.93,decayRate:.006},reconfig:{detectionInterval:6.5},matrix:{style:"harmonic"}},{id:"drum_circle",name:"Drum Circle",description:"Polyrhythms, tribal synchronization",seed:8005,particleCount:750,typesCount:6,micro:{force:1.5,drag:1.1,entropy:.1,rmax:.21},field:{diffusionRate:.77,decayRate:.019},reconfig:{detectionInterval:3.8},matrix:{style:"ring"}},{id:"glitch",name:"Glitch",description:"Digital artifacts, broken transmission",seed:8006,particleCount:600,typesCount:5,micro:{force:1.6,drag:1,entropy:.26,rmax:.18,speedClamp:.11},field:{diffusionRate:.85,decayRate:.028},reconfig:{detectionInterval:2.8},matrix:{style:"chaotic"}},{id:"dubstep",name:"Dubstep Drop",description:"Bass wobbles, half-time breaks",seed:8007,particleCount:700,typesCount:5,micro:{force:1.9,drag:.95,entropy:.15,rmax:.2,coreRepel:1.3},field:{diffusionRate:.83,decayRate:.024},reconfig:{detectionInterval:3.3},matrix:{style:"block"}},{id:"choir",name:"Choir",description:"Vocal harmonics, layered voices",seed:8008,particleCount:650,typesCount:6,micro:{force:1,drag:1.7,entropy:.03,rmax:.26,beta:.45},field:{diffusionRate:.68,decayRate:.012},reconfig:{detectionInterval:5.2},matrix:{style:"harmonic"}},{id:"metal",name:"Metal Blast",description:"Distorted power, aggressive energy",seed:8009,particleCount:800,typesCount:6,micro:{force:2,drag:.85,entropy:.2,rmax:.18,speedClamp:.13},field:{diffusionRate:.86,decayRate:.027},reconfig:{detectionInterval:3},matrix:{style:"chaotic"}},{id:"binaural",name:"Binaural Beats",description:"Phase interference, brain entrainment",seed:8010,particleCount:550,typesCount:4,micro:{force:1.2,drag:1.5,entropy:.07,rmax:.24,beta:.4},field:{diffusionRate:.75,decayRate:.014},reconfig:{detectionInterval:4.4},matrix:{style:"harmonic"}},{id:"hilma_af_klint",name:"Hilma af Klint",description:"Spiritual geometry, theosophical abstraction",seed:9001,particleCount:650,typesCount:5,micro:{force:1,drag:1.7,entropy:.03,rmax:.26,beta:.42,circularDependency:.4},field:{diffusionRate:.68,decayRate:.009},reconfig:{detectionInterval:5.5},matrix:{style:"harmonic"}},{id:"agnes_martin",name:"Agnes Martin",description:"Minimal grids, meditative repetition",seed:9002,particleCount:400,typesCount:3,micro:{force:.65,drag:2.2,entropy:.01,rmax:.3,beta:.5},field:{diffusionRate:.55,decayRate:.006},reconfig:{detectionInterval:7.5},matrix:{style:"harmonic"}},{id:"cy_twombly",name:"Cy Twombly",description:"Calligraphic gestures, scratched surfaces",seed:9003,particleCount:700,typesCount:6,micro:{force:1.6,drag:1,entropy:.18,rmax:.19,speedClamp:.13},field:{diffusionRate:.85,decayRate:.024},reconfig:{detectionInterval:3.4},matrix:{style:"chaotic"}},{id:"yayoi_kusama",name:"Yayoi Kusama",description:"Infinity nets, obsessive dots",seed:9004,particleCount:900,typesCount:7,micro:{force:1.1,drag:1.6,entropy:.06,rmax:.22,beta:.35},field:{diffusionRate:.72,decayRate:.012},reconfig:{detectionInterval:4.6},matrix:{style:"block"}},{id:"gerhard_richter",name:"Gerhard Richter",description:"Squeegee abstraction, color blur",seed:9005,particleCount:750,typesCount:6,micro:{force:1.4,drag:1.3,entropy:.12,rmax:.21,beta:.3},field:{diffusionRate:.88,decayRate:.018},reconfig:{detectionInterval:4},matrix:{style:"chaotic"}},{id:"kazimir_malevich_black",name:"Malevich Black Square",description:"Ultimate reduction, void suprematism",seed:9006,particleCount:250,typesCount:2,micro:{force:.5,drag:2.4,entropy:0,rmax:.32,beta:.5},field:{diffusionRate:.5,decayRate:.005},reconfig:{detectionInterval:9},matrix:{style:"harmonic"}},{id:"bridget_riley",name:"Bridget Riley",description:"Op art waves, optical vibration",seed:9007,particleCount:600,typesCount:4,micro:{force:1.3,drag:1.4,entropy:.05,rmax:.23,beta:.45,circularDependency:.6},field:{diffusionRate:.7,decayRate:.013},reconfig:{detectionInterval:4.8},matrix:{style:"cyclic"}},{id:"franz_kline",name:"Franz Kline",description:"Bold black strokes, architectural gesture",seed:9008,particleCount:550,typesCount:3,micro:{force:2.1,drag:.9,entropy:.15,rmax:.18,speedClamp:.14},field:{diffusionRate:.82,decayRate:.026},reconfig:{detectionInterval:3.2},matrix:{style:"chaotic"}},{id:"ellsworth_kelly",name:"Ellsworth Kelly",description:"Hard edge color fields, pure shape",seed:9009,particleCount:450,typesCount:4,micro:{force:.8,drag:1.9,entropy:.02,rmax:.28,beta:.48},field:{diffusionRate:.6,decayRate:.008},reconfig:{detectionInterval:6.2},matrix:{style:"block"}},{id:"robert_motherwell",name:"Robert Motherwell",description:"Spanish elegies, existential abstraction",seed:9010,particleCount:650,typesCount:5,micro:{force:1.5,drag:1.2,entropy:.1,rmax:.22,beta:.35},field:{diffusionRate:.78,decayRate:.017},reconfig:{detectionInterval:4.2},matrix:{style:"harmonic"}},{id:"bond_sigil",name:" Bond Archetype",description:"Cohesive attraction sigils, stable species bonds",seed:9101,particleCount:600,typesCount:4,micro:{force:1.2,drag:1.4,entropy:.15,rmax:.22,beta:.35,metamorphosisEnabled:!0,mutationRate:.002},field:{diffusionRate:.75,decayRate:.015},reconfig:{detectionInterval:3.5,speciationThreshold:.65},matrix:{style:"symbiotic"}},{id:"rift_sigil",name:" Rift Archetype",description:"Conflict repulsion sigils, fractured territories",seed:9102,particleCount:700,typesCount:5,micro:{force:1.6,drag:1.1,entropy:.18,rmax:.2,beta:.25,metamorphosisEnabled:!0,mutationRate:.0025},field:{diffusionRate:.8,decayRate:.02},reconfig:{detectionInterval:3,speciationThreshold:.7},matrix:{style:"predator"}},{id:"bloom_sigil",name:" Bloom Archetype",description:"Growth and feeding sigils, flourishing populations",seed:9103,particleCount:550,typesCount:4,micro:{force:1.1,drag:1.5,entropy:.12,rmax:.24,beta:.38,foodEnabled:!0,foodRatio:.25,metamorphosisEnabled:!0,mutationRate:.0018},field:{diffusionRate:.7,decayRate:.012},reconfig:{detectionInterval:4,speciationThreshold:.6},matrix:{style:"symbiotic"}},{id:"oath_sigil",name:" Oath Archetype",description:"Ritual path sigils, cyclic ceremonies",seed:9104,particleCount:650,typesCount:5,micro:{force:1.3,drag:1.3,entropy:.16,rmax:.23,beta:.4,circularDependency:.5,metamorphosisEnabled:!0,mutationRate:.002},field:{diffusionRate:.73,decayRate:.016},reconfig:{detectionInterval:3.8,speciationThreshold:.68},matrix:{style:"cyclic"}},{id:"genesis_sigils",name:" Genesis Sigils",description:"All sigils emerge together, primordial chaos",seed:9105,particleCount:750,typesCount:6,micro:{force:1.4,drag:1.2,entropy:.2,rmax:.21,beta:.32,metamorphosisEnabled:!0,mutationRate:.003},field:{diffusionRate:.82,decayRate:.018},reconfig:{detectionInterval:3.2,speciationThreshold:.72},matrix:{style:"chaotic"}},{id:"symbiotic_sigils",name:" Symbiotic Archetypes",description:"Mutual bond sigils, cooperative species emergence",seed:9106,particleCount:600,typesCount:5,micro:{force:1,drag:1.6,entropy:.14,rmax:.25,beta:.36,circularDependency:.3,metamorphosisEnabled:!0,mutationRate:.0015},field:{diffusionRate:.68,decayRate:.013},reconfig:{detectionInterval:4.5,speciationThreshold:.62},matrix:{style:"symbiotic"}},{id:"warring_sigils",name:" Warring Archetypes",description:"Rift-dominated sigils, eternal conflicts between species",seed:9107,particleCount:800,typesCount:6,micro:{force:1.7,drag:1,entropy:.19,rmax:.19,beta:.28,metamorphosisEnabled:!0,mutationRate:.0028},field:{diffusionRate:.85,decayRate:.022},reconfig:{detectionInterval:2.9,speciationThreshold:.74},matrix:{style:"predator"}},{id:"harmonic_sigils",name:" Harmonic Archetypes",description:"Resonant sigils, species in perfect balance",seed:9108,particleCount:500,typesCount:4,micro:{force:.9,drag:1.7,entropy:.08,rmax:.26,beta:.42,metamorphosisEnabled:!0,mutationRate:.001},field:{diffusionRate:.65,decayRate:.01},reconfig:{detectionInterval:5,speciationThreshold:.58},matrix:{style:"harmonic"}},{id:"cascade_sigils",name:" Cascade Archetypes",description:"Chain-reaction sigils, avalanche of new species",seed:9109,particleCount:700,typesCount:5,micro:{force:1.5,drag:1.1,entropy:.22,rmax:.2,beta:.3,metamorphosisEnabled:!0,mutationRate:.0032},field:{diffusionRate:.88,decayRate:.024},reconfig:{detectionInterval:2.7,speciationThreshold:.76},matrix:{style:"chaotic"}},{id:"eternal_sigils",name:" Eternal Archetypes",description:"Persistent sigils, ancient species that never fade",seed:9110,particleCount:450,typesCount:3,micro:{force:.8,drag:1.9,entropy:.06,rmax:.28,beta:.45,metamorphosisEnabled:!0,mutationRate:8e-4},field:{diffusionRate:.62,decayRate:.008},reconfig:{detectionInterval:5.5,speciationThreshold:.55},matrix:{style:"harmonic"}}],YF=(e,t,n,r=.2)=>{const a=t,i=[],s=[],c=[];for(let l=0;l<a;l++)i[l]=new Array(a),s[l]=new Array(a),c[l]=new Array(a);switch(e){case"pollock":case"chaotic":for(let l=0;l<a;l++)for(let d=0;d<a;d++)i[l][d]=n.next()*2-1,s[l][d]=r*(.8+n.next()*.4),c[l][d]=.5+n.next()*1.5;break;case"kandinsky":case"harmonic":for(let l=0;l<a;l++)for(let d=0;d<a;d++){const u=(l-d)/a*Math.PI*2;i[l][d]=Math.cos(u)*.8,s[l][d]=r*(1+Math.abs(Math.sin(u))*.2),c[l][d]=1}break;case"mitosis":for(let l=0;l<a;l++)for(let d=0;d<a;d++)l===d?(i[l][d]=.7,s[l][d]=r*1.2,c[l][d]=.8):(i[l][d]=-.5,s[l][d]=r*.8,c[l][d]=1.2);break;case"predator":for(let l=0;l<a;l++){const d=(l+1)%a,u=(l-1+a)%a;for(let h=0;h<a;h++)h===d?(i[l][h]=.9,s[l][h]=r*1.3,c[l][h]=.7):h===u?(i[l][h]=-.8,s[l][h]=r*1.1,c[l][h]=1.5):(i[l][h]=(n.next()-.5)*.4,s[l][h]=r,c[l][h]=1)}break;case"symbiotic":for(let l=0;l<a;l++)for(let d=0;d<a;d++){const u=Math.min(Math.abs(l-d),a-Math.abs(l-d));i[l][d]=.6-u*.2,s[l][d]=r*(.9+u*.1),c[l][d]=.8+u*.1}break;case"cyclic":for(let l=0;l<a;l++)for(let d=0;d<a;d++){const u=(d-l+a)%a;u===1?(i[l][d]=.8,s[l][d]=r*1.2,c[l][d]=.9):u===a-1?(i[l][d]=-.7,s[l][d]=r*1.1,c[l][d]=1.3):(i[l][d]=(n.next()-.5)*.3,s[l][d]=r,c[l][d]=1)}break;case"sparse":for(let l=0;l<a;l++)for(let d=0;d<a;d++)n.next()<.3?(i[l][d]=n.next()*1.6-.3,s[l][d]=r*(1+n.next()*.5),c[l][d]=.6+n.next()*.8):(i[l][d]=(n.next()-.5)*.2,s[l][d]=r*.9,c[l][d]=1.2);break;case"block":for(let l=0;l<a;l++)for(let d=0;d<a;d++){const u=Math.floor(l/(a/3)),h=Math.floor(d/(a/3));u===h?(i[l][d]=.5+n.next()*.4,s[l][d]=r*1.1,c[l][d]=.9):(i[l][d]=-.3+n.next()*.2,s[l][d]=r*.9,c[l][d]=1.1)}break;case"ring":for(let l=0;l<a;l++)for(let d=0;d<a;d++){const u=Math.min(Math.abs(l-d),a-Math.abs(l-d));u<=1?(i[l][d]=.7,s[l][d]=r*1.2,c[l][d]=.8):u===Math.floor(a/2)?(i[l][d]=-.6,s[l][d]=r*1,c[l][d]=1.4):(i[l][d]=(n.next()-.5)*.3,s[l][d]=r,c[l][d]=1)}break;default:for(let l=0;l<a;l++)for(let d=0;d<a;d++)i[l][d]=n.next()*2-1,s[l][d]=r*(.8+n.next()*.4),c[l][d]=.5+n.next()*1.5}return{attract:i,radius:s,falloff:c}};class sR{constructor(t){this.seed=t}next(){return this.seed=(this.seed*9301+49297)%233280,this.seed/233280}range(t,n){return t+this.next()*(n-t)}int(t,n){return Math.floor(this.range(t,n+1))}}const KF=(e,t,n)=>{e=e%360,t=Math.max(0,Math.min(100,t))/100,n=Math.max(0,Math.min(100,n))/100;const r=(1-Math.abs(2*n-1))*t,a=r*(1-Math.abs(e/60%2-1)),i=n-r/2;let s=0,c=0,l=0;return e>=0&&e<60?(s=r,c=a,l=0):e>=60&&e<120?(s=a,c=r,l=0):e>=120&&e<180?(s=0,c=r,l=a):e>=180&&e<240?(s=0,c=a,l=r):e>=240&&e<300?(s=a,c=0,l=r):(s=r,c=0,l=a),[s+i,c+i,l+i]},XF=e=>{const t=e.range(0,360),n=e.range(70,95);e.range(50,65);const r=[],a=[30,40,50,60,70,45,55,65],i=[0,-10,5,-5,-15,10,-20,15];for(let d=0;d<8;d++)r.push({h:t+e.range(-3,3),s:Math.max(50,Math.min(100,n+i[d])),l:a[d]});const s=(t+180)%360,c=[30,40,50,60,70,45,55,65],l=[0,-10,5,-5,-15,10,-20,15];for(let d=0;d<8;d++)r.push({h:s+e.range(-3,3),s:Math.max(50,Math.min(100,n+l[d])),l:c[d]});return r},JF=e=>{const t=e.range(0,360),n=e.range(70,90),r=e.range(50,65),a=e.range(20,35),i=[],s=[-3,-2,-1,0,1,2,3,4];for(let c of s){const l=(t+c*a)%360;i.push({h:l,s:Math.max(60,Math.min(100,n+e.range(-10,10))),l:Math.max(40,Math.min(65,r+e.range(-5,5)))}),i.push({h:l,s:Math.max(50,Math.min(100,n-15)),l:Math.max(55,Math.min(75,r+15))})}return i},QF=e=>{const t=e.range(0,360),n=e.range(70,95),r=e.range(50,65),a=[],i=[{s:0,l:-20},{s:-10,l:-10},{s:0,l:0},{s:-5,l:10},{s:-15,l:20}];for(let s=0;s<3;s++){const c=(t+s*120)%360;for(let l of i)a.push({h:c+e.range(-3,3),s:Math.max(50,Math.min(100,n+l.s)),l:Math.max(30,Math.min(75,r+l.l))})}return a.push({h:(t+60)%360,s:n-20,l:55}),a},ZF=e=>{const t=e.range(0,360),n=e.range(70,90),r=e.range(50,62),a=[],i=[{s:0,l:0},{s:-10,l:-15},{s:-5,l:12},{s:-20,l:20}];for(let s=0;s<4;s++){const c=(t+s*90)%360;for(let l of i)a.push({h:c+e.range(-2,2),s:Math.max(50,Math.min(100,n+l.s)),l:Math.max(30,Math.min(75,r+l.l))})}return a},e_=e=>{const t=e.range(0,360),n=e.range(75,95);e.range(50,62);const r=e.range(25,35),a=[],i=(t+180)%360,s=[35,45,55,65,50,60];for(let h=0;h<6;h++)a.push({h:t+e.range(-3,3),s:Math.max(60,Math.min(100,n-h*5)),l:s[h]});const c=(i-r+360)%360,l=[35,45,55,65,50];for(let h=0;h<5;h++)a.push({h:c+e.range(-3,3),s:Math.max(60,Math.min(100,n-h*5)),l:l[h]});const d=(i+r)%360,u=[35,45,55,65,50];for(let h=0;h<5;h++)a.push({h:d+e.range(-3,3),s:Math.max(60,Math.min(100,n-h*5)),l:u[h]});return a},t_=e=>{const t=e.range(0,360),n=e.range(70,95),r=[],a=[{s:0,l:25},{s:-10,l:35},{s:5,l:40},{s:-5,l:45},{s:0,l:50},{s:-15,l:55},{s:10,l:60},{s:-20,l:65},{s:0,l:70},{s:-5,l:75},{s:5,l:42},{s:-10,l:52},{s:15,l:58},{s:-25,l:68},{s:0,l:38},{s:-15,l:48}];for(let i of a)r.push({h:t+e.range(-5,5),s:Math.max(40,Math.min(100,n+i.s)),l:i.l});return r},n_=e=>{const t=e.range(0,360),n=e.range(75,95),r=e.range(50,65),a=[],i=360/16;for(let s=0;s<16;s++){const c=(t+s*i)%360,l=e.range(-10,10),d=e.range(-8,8);a.push({h:c,s:Math.max(65,Math.min(100,n+l)),l:Math.max(45,Math.min(70,r+d))})}return a},r_=e=>{const t=e.range(0,360),n=(t+90)%360,r=e.range(75,95);e.range(50,65);const a=[],i=[35,45,55,65,50,60,40,70],s=[0,-10,5,-5,-15,10,-20,15];for(let c=0;c<4;c++)a.push({h:t+e.range(-3,3),s:Math.max(60,Math.min(100,r+s[c])),l:i[c]});for(let c=0;c<4;c++)a.push({h:(t+180)%360+e.range(-3,3),s:Math.max(60,Math.min(100,r+s[c+4])),l:i[c+4]});for(let c=0;c<4;c++)a.push({h:n+e.range(-3,3),s:Math.max(60,Math.min(100,r+s[c])),l:i[c]});for(let c=0;c<4;c++)a.push({h:(n+180)%360+e.range(-3,3),s:Math.max(60,Math.min(100,r+s[c+4])),l:i[c+4]});return a},o_=(e,t=16)=>{const n=new sR(e),r=["complementary","analogous","triadic","tetradic","split-complementary","monochromatic","rainbow","double-complementary"],a=n.int(0,r.length-1),i=r[a];let s=[];switch(i){case"complementary":s=XF(n);break;case"analogous":s=JF(n);break;case"triadic":s=QF(n);break;case"tetradic":s=ZF(n);break;case"split-complementary":s=e_(n);break;case"monochromatic":s=t_(n);break;case"rainbow":s=n_(n);break;case"double-complementary":s=r_(n);break}const c=Math.max(t,16);for(;s.length<c;){const d=s.length%(s.length>0?s.length:1),u=s[d]||{h:0,s:70,l:50};s.push({h:(u.h+n.range(10,20))%360,s:Math.max(50,Math.min(100,u.s+n.range(-10,10))),l:Math.max(30,Math.min(75,u.l+n.range(-10,10)))})}const l=[];for(let d=0;d<c;d++){const u=s[d%s.length];l.push(KF(u.h,u.s,u.l))}return console.log(` Generated ${i} palette with ${l.length} colors (seed ${e})`),l},a_=e=>{const t=new sR(e),n=["complementary","analogous","triadic","tetradic","split-complementary","monochromatic","rainbow","double-complementary"],r=t.int(0,n.length-1),a=n[r];return{complementary:"Complementar",analogous:"Anloga",triadic:"Tridica",tetradic:"Tetrdica","split-complementary":"Complementar Dividida",monochromatic:"Monocromtica",rainbow:"Arco-ris (Mximo Contraste)","double-complementary":"Dupla Complementar"}[a]},_=e=>{const t=parseInt(e.slice(1,3),16)/255,n=parseInt(e.slice(3,5),16)/255,r=parseInt(e.slice(5,7),16)/255;return[t,n,r]},kl=[{name:"Classic",colors:[_("#FF4444"),_("#44FF44"),_("#4444FF"),_("#FFFF44"),_("#FF44FF"),_("#44FFFF"),_("#FF8844"),_("#8844FF"),_("#44FF88"),_("#FF4488"),_("#88FF44"),_("#4488FF"),_("#FFAA44"),_("#AA44FF"),_("#44FFAA"),_("#FF44AA")]},{name:"Neon Bio",colors:[_("#00FFAA"),_("#FF00AA"),_("#AAFF00"),_("#FF6600"),_("#0066FF"),_("#FF0066"),_("#66FF00"),_("#FF00FF"),_("#00FFFF"),_("#FFFF00"),_("#FF0099"),_("#99FF00"),_("#00FF99"),_("#9900FF"),_("#FF9900"),_("#0099FF")]},{name:"Alien Dusk",colors:[_("#FF6B9D"),_("#C44569"),_("#FFA07A"),_("#FA8072"),_("#E17055"),_("#FDCB6E"),_("#6C5CE7"),_("#A29BFE"),_("#74B9FF"),_("#00B894"),_("#00CEC9"),_("#81ECEC"),_("#55EFC4"),_("#FD79A8"),_("#E84393"),_("#D63031")]},{name:"Fungal",colors:[_("#8B4513"),_("#A0522D"),_("#CD853F"),_("#DEB887"),_("#F0E68C"),_("#9ACD32"),_("#6B8E23"),_("#556B2F"),_("#2F4F4F"),_("#8FBC8F"),_("#20B2AA"),_("#48D1CC"),_("#40E0D0"),_("#7FFFD4"),_("#98FB98"),_("#90EE90")]},{name:"Oceanic",colors:[_("#001F3F"),_("#0074D9"),_("#7FDBFF"),_("#39CCCC"),_("#3D9970"),_("#2ECC40"),_("#01FF70"),_("#FFDC00"),_("#FF851B"),_("#FF4136"),_("#85144B"),_("#F012BE"),_("#B10DC9"),_("#111111"),_("#AAAAAA"),_("#DDDDDD")]},{name:"Plasma",colors:[_("#FF00FF"),_("#FF00CC"),_("#FF0099"),_("#FF0066"),_("#FF3300"),_("#FF6600"),_("#FF9900"),_("#FFCC00"),_("#FFFF00"),_("#CCFF00"),_("#99FF00"),_("#66FF00"),_("#33FF00"),_("#00FF33"),_("#00FF66"),_("#00FF99")]},{name:"Sunset",colors:[_("#FF6B35"),_("#F7931E"),_("#FDC830"),_("#F37335"),_("#FE4A49"),_("#D63447"),_("#FF5733"),_("#C70039"),_("#900C3F"),_("#FF8C42"),_("#FFA351"),_("#FFB85C"),_("#FF9966"),_("#E85D75"),_("#FF4500"),_("#B33000")]},{name:"Cherry Blossom",colors:[_("#FFB7C5"),_("#FFC0CB"),_("#FFD1DC"),_("#E6A8D7"),_("#D291BC"),_("#957DAD"),_("#FEA3AA"),_("#F0B7A4"),_("#FFC8A2"),_("#D3D0CB"),_("#A997DF"),_("#F7CAC9"),_("#FFAAC1"),_("#E8B4D0"),_("#C89FBB"),_("#B57FA6")]},{name:"Northern Lights",colors:[_("#00FFC6"),_("#00FFE7"),_("#00E4FF"),_("#00C5FF"),_("#00A6FF"),_("#4D88FF"),_("#8B5CF6"),_("#A78BFA"),_("#C4B5FD"),_("#7DD3FC"),_("#38BDF8"),_("#0EA5E9"),_("#00FFB3"),_("#5D9FFF"),_("#9B73F7"),_("#60D8F8")]},{name:"Desert",colors:[_("#EDC9AF"),_("#E6BC98"),_("#D2A76E"),_("#C19A6B"),_("#AA8B5C"),_("#9C6F46"),_("#F4A460"),_("#DAA520"),_("#CD853F"),_("#8B7355"),_("#A0826D"),_("#C2B280"),_("#D4A373"),_("#B8956A"),_("#E8C4A0"),_("#967554")]},{name:"Toxic",colors:[_("#39FF14"),_("#00FF41"),_("#0FFF50"),_("#7FFF00"),_("#ADFF2F"),_("#CCFF00"),_("#DFFF00"),_("#F0FF00"),_("#FFFF00"),_("#FF00FF"),_("#FF10F0"),_("#FF1493"),_("#00FF7F"),_("#BBFF00"),_("#FF00DD"),_("#FF3399")]},{name:"Galaxy",colors:[_("#2C003E"),_("#512B58"),_("#9D44C0"),_("#EC53B0"),_("#FFA0D2"),_("#FF6FCF"),_("#C724B1"),_("#8B2FC9"),_("#5C2E7E"),_("#2E1F3B"),_("#1C0F2A"),_("#0F0520"),_("#B83FD8"),_("#D967E8"),_("#3D1A52"),_("#FF88DD")]},{name:"Cyberpunk",colors:[_("#FF006E"),_("#FB5607"),_("#FFBE0B"),_("#8338EC"),_("#3A86FF"),_("#00F5FF"),_("#FF00FF"),_("#00FFFF"),_("#FFFF00"),_("#FF0080"),_("#0080FF"),_("#80FF00"),_("#FF3399"),_("#AA00FF"),_("#00FFAA"),_("#FFAA00")]},{name:"Retro Wave",colors:[_("#FF6EC7"),_("#FF10F0"),_("#BF00FF"),_("#8000FF"),_("#4000FF"),_("#0040FF"),_("#0080FF"),_("#00C0FF"),_("#00FFFF"),_("#FF007F"),_("#FF00BF"),_("#FF0050"),_("#9F00FF"),_("#6000FF"),_("#0060FF"),_("#00A0FF")]},{name:"Coral Reef",colors:[_("#FF7F50"),_("#FF6347"),_("#FFB347"),_("#FFA07A"),_("#FA8072"),_("#E9967A"),_("#00CED1"),_("#48D1CC"),_("#40E0D0"),_("#7FFFD4"),_("#66CDAA"),_("#20B2AA"),_("#FF9966"),_("#FF8866"),_("#5FE5E0"),_("#8FFFEE")]},{name:"Midnight",colors:[_("#191970"),_("#000080"),_("#00008B"),_("#0000CD"),_("#0000FF"),_("#1E90FF"),_("#4169E1"),_("#6495ED"),_("#87CEEB"),_("#4682B4"),_("#5F9EA0"),_("#708090"),_("#0C0C50"),_("#0000AA"),_("#2E7FE1"),_("#7AB8ED")]},{name:"Lava",colors:[_("#8B0000"),_("#A52A2A"),_("#B22222"),_("#DC143C"),_("#FF0000"),_("#FF4500"),_("#FF6347"),_("#FF7F50"),_("#FFA500"),_("#FF8C00"),_("#FFD700"),_("#FFFF00"),_("#990000"),_("#EE1111"),_("#FF5522"),_("#FFB800")]},{name:"Ice",colors:[_("#E0FFFF"),_("#AFEEEE"),_("#B0E0E6"),_("#ADD8E6"),_("#87CEEB"),_("#87CEFA"),_("#00BFFF"),_("#1E90FF"),_("#6495ED"),_("#4682B4"),_("#5F9EA0"),_("#B0C4DE"),_("#CCFFFF"),_("#99DDEE"),_("#77D8FF"),_("#A0D4EE")]},{name:"Forest",colors:[_("#228B22"),_("#32CD32"),_("#00FF00"),_("#7CFC00"),_("#7FFF00"),_("#ADFF2F"),_("#9ACD32"),_("#6B8E23"),_("#556B2F"),_("#8FBC8F"),_("#90EE90"),_("#98FB98"),_("#3DA83D"),_("#5FCC5F"),_("#88DD00"),_("#A0E8A0")]},{name:"Pastel Dream",colors:[_("#FFB3BA"),_("#FFDFBA"),_("#FFFFBA"),_("#BAFFC9"),_("#BAE1FF"),_("#E0BBE4"),_("#FFDFD3"),_("#FEC8D8"),_("#D4A5A5"),_("#C9E4DE"),_("#FFCCF9"),_("#FCCBCB"),_("#FFC8D0"),_("#FFE8C8"),_("#D8FFE8"),_("#F0D8FF")]},{name:"Volcano",colors:[_("#610000"),_("#8B0000"),_("#B22222"),_("#DC143C"),_("#FF0000"),_("#FF4500"),_("#FFA500"),_("#FFD700"),_("#FFFF00"),_("#696969"),_("#808080"),_("#A9A9A9"),_("#450000"),_("#CC1111"),_("#FF6611"),_("#555555")]},{name:"Cotton Candy",colors:[_("#FFB3D9"),_("#FFC9E6"),_("#FFDFF2"),_("#E6B3FF"),_("#D9B3FF"),_("#CCB3FF"),_("#B3D9FF"),_("#B3E6FF"),_("#B3F2FF"),_("#FFB3E6"),_("#FFB3D9"),_("#FFB3CC"),_("#FFA8D4"),_("#DDA8FF"),_("#BFC8FF"),_("#FFC0DC")]},{name:"Autumn",colors:[_("#8B4513"),_("#A0522D"),_("#D2691E"),_("#CD5C5C"),_("#F08080"),_("#FA8072"),_("#FFA07A"),_("#FFB347"),_("#FFC04C"),_("#FADA5E"),_("#FFD700"),_("#DAA520"),_("#B8621E"),_("#E8775F"),_("#FFD466"),_("#CC9933")]},{name:"Spring",colors:[_("#FFB7CE"),_("#FFC9E6"),_("#FFE5F1"),_("#E6FFE6"),_("#CCFFCC"),_("#B3FFB3"),_("#FFFFCC"),_("#FFFFE0"),_("#FFFACD"),_("#D4F1F4"),_("#B4E5E7"),_("#9FD8DB"),_("#FFCCE0"),_("#DDFFD0"),_("#FFFFD8"),_("#C8ECEE")]},{name:"Deep Sea",colors:[_("#001F3F"),_("#003B5C"),_("#005C7A"),_("#007A99"),_("#0099B8"),_("#00B8D7"),_("#1BD4E4"),_("#36E4F2"),_("#51F4FF"),_("#012840"),_("#013A5A"),_("#014C73"),_("#00334D"),_("#008AAA"),_("#00CCEE"),_("#025E88")]},{name:"Candy",colors:[_("#FF69B4"),_("#FF1493"),_("#FF00FF"),_("#DA70D6"),_("#BA55D3"),_("#9370DB"),_("#8A2BE2"),_("#9400D3"),_("#8B008B"),_("#FF00FF"),_("#EE82EE"),_("#DDA0DD"),_("#FF4FB8"),_("#CC44EE"),_("#AA22DD"),_("#F090E8")]},{name:"Mint",colors:[_("#00FA9A"),_("#00FF7F"),_("#3CB371"),_("#2E8B57"),_("#8FBC8F"),_("#90EE90"),_("#98FB98"),_("#AFEEEE"),_("#7FFFD4"),_("#40E0D0"),_("#48D1CC"),_("#00CED1"),_("#11DD88"),_("#66EE99"),_("#99FFCC"),_("#55E8D8")]},{name:"Fire",colors:[_("#FF0000"),_("#FF4500"),_("#FF6347"),_("#FF7F50"),_("#FFA500"),_("#FFB347"),_("#FFC04C"),_("#FFD700"),_("#FFFF00"),_("#FF8C00"),_("#FF6600"),_("#FF4400"),_("#FF1100"),_("#FF5522"),_("#FF9933"),_("#FFEE11")]},{name:"Neon Nights",colors:[_("#FF00FF"),_("#FF00AA"),_("#FF0055"),_("#00FFFF"),_("#00AAFF"),_("#0055FF"),_("#00FF00"),_("#00FF55"),_("#00FFAA"),_("#FFFF00"),_("#FFAA00"),_("#FF5500"),_("#DD00DD"),_("#0088DD"),_("#11FF11"),_("#FFCC00")]},{name:"Lavender",colors:[_("#E6E6FA"),_("#D8BFD8"),_("#DDA0DD"),_("#EE82EE"),_("#DA70D6"),_("#FF00FF"),_("#BA55D3"),_("#9370DB"),_("#8A2BE2"),_("#9400D3"),_("#9932CC"),_("#8B008B"),_("#CCC8E8"),_("#B088E8"),_("#AA44EE"),_("#7700BB")]},{name:"Earth",colors:[_("#8B7355"),_("#A0826D"),_("#C2B280"),_("#DEB887"),_("#D2B48C"),_("#F5DEB3"),_("#8B4513"),_("#A0522D"),_("#BC8F8F"),_("#CD853F"),_("#D2691E"),_("#DAA520"),_("#9A8066"),_("#CCB090"),_("#B86F30"),_("#E0C080")]},{name:"Tropical",colors:[_("#00CED1"),_("#20B2AA"),_("#48D1CC"),_("#40E0D0"),_("#00FA9A"),_("#00FF7F"),_("#FFD700"),_("#FFA500"),_("#FF8C00"),_("#FF69B4"),_("#FF1493"),_("#C71585"),_("#00E4E8"),_("#22DD88"),_("#FFCC22"),_("#FF3388")]},{name:"Rainbow",colors:[_("#FF0000"),_("#FF7F00"),_("#FFFF00"),_("#00FF00"),_("#0000FF"),_("#4B0082"),_("#9400D3"),_("#FF00FF"),_("#FF007F"),_("#FF00BF"),_("#7F00FF"),_("#00FFFF"),_("#FF4400"),_("#AAFF00"),_("#0088FF"),_("#CC00FF")]},{name:"Mono Chrome",colors:[_("#000000"),_("#1A1A1A"),_("#333333"),_("#4D4D4D"),_("#666666"),_("#808080"),_("#999999"),_("#B3B3B3"),_("#CCCCCC"),_("#E6E6E6"),_("#F2F2F2"),_("#FFFFFF")]},{name:"Blood Moon",colors:[_("#8B0000"),_("#A00000"),_("#B50000"),_("#CA0000"),_("#E00000"),_("#FF0000"),_("#330000"),_("#4D0000"),_("#660000"),_("#800000"),_("#990000"),_("#B30000"),_("#700000"),_("#DD0000"),_("#550000"),_("#AA0000")]},{name:"Aurora",colors:[_("#00FFC6"),_("#00FFE7"),_("#00FFFF"),_("#00E4FF"),_("#00C5FF"),_("#00A6FF"),_("#4D88FF"),_("#8B5CF6"),_("#A855F7"),_("#C084FC"),_("#D8B4FE"),_("#E9D5FF"),_("#00FFB8"),_("#00D4FF"),_("#6A77FF"),_("#B877F9")]},{name:"Hilma af Klint",colors:[_("#FFD700"),_("#FDB931"),_("#FFA500"),_("#FF69B4"),_("#FF1493"),_("#FF85C1"),_("#4169E1"),_("#6495ED"),_("#87CEEB"),_("#9370DB"),_("#8A2BE2"),_("#9932CC"),_("#FFCC00"),_("#FF4488"),_("#5588EE"),_("#AA55DD")]},{name:"Cosmic Dust",colors:[_("#1A1A2E"),_("#16213E"),_("#0F3460"),_("#533483"),_("#9D4EDD"),_("#C77DFF"),_("#E0AAFF"),_("#F72585"),_("#B5179E"),_("#7209B7"),_("#560BAD"),_("#3C096C"),_("#202038"),_("#6644AA"),_("#DD88FF"),_("#EE3399")]},{name:"Bioluminescence",colors:[_("#00FF41"),_("#00FF88"),_("#00FFCC"),_("#00FFFF"),_("#00CCFF"),_("#0088FF"),_("#0044FF"),_("#4400FF"),_("#8800FF"),_("#00FF00"),_("#88FF00"),_("#FFFF00"),_("#00FF66"),_("#00AAFF"),_("#6600FF"),_("#AAFF00")]},{name:"Steampunk",colors:[_("#8B4513"),_("#A0522D"),_("#CD853F"),_("#D2691E"),_("#B8860B"),_("#DAA520"),_("#696969"),_("#708090"),_("#778899"),_("#2F4F4F"),_("#556B2F"),_("#8B7355"),_("#996633"),_("#CC9944"),_("#8899AA"),_("#445544")]},{name:"Prismatic",colors:[_("#FF0000"),_("#FF3300"),_("#FF6600"),_("#FF9900"),_("#FFCC00"),_("#FFFF00"),_("#CCFF00"),_("#99FF00"),_("#66FF00"),_("#33FF00"),_("#00FF00"),_("#00FF33"),_("#FF1100"),_("#FF7711"),_("#AAFF00"),_("#11FF11")]},{name:"Void",colors:[_("#000000"),_("#0D0D0D"),_("#1A1A1A"),_("#2A0A2E"),_("#3F0F4F"),_("#5A145F"),_("#7A1A7F"),_("#8B008B"),_("#9400D3"),_("#4B0082"),_("#2E0854"),_("#1A0033"),_("#111111"),_("#440E55"),_("#6A1170"),_("#220044")]},{name:"Sakura Night",colors:[_("#FFB7D5"),_("#FFA6C9"),_("#FF95BE"),_("#2A1A3D"),_("#3E2856"),_("#52366F"),_("#1C1035"),_("#2D1B4E"),_("#3E2667"),_("#FFD6E8"),_("#FFC2DC"),_("#FFAED0"),_("#FFCCDD"),_("#342047"),_("#462C60"),_("#FFB8CC")]},{name:"Ancient Gold",colors:[_("#FFD700"),_("#FFC700"),_("#FFB700"),_("#FFA700"),_("#FF9700"),_("#FF8700"),_("#8B7355"),_("#A0826D"),_("#B8956A"),_("#D4AF37"),_("#E6BE5A"),_("#F8CD7D"),_("#FFEE00"),_("#FFAA00"),_("#9A8066"),_("#CCAA44")]},{name:"Nebula",colors:[_("#FF006E"),_("#FB5607"),_("#FFBE0B"),_("#8338EC"),_("#3A86FF"),_("#06FFA5"),_("#FF1654"),_("#FF477E"),_("#FF87AB"),_("#B5E48C"),_("#76C893"),_("#52B69A"),_("#FF3388"),_("#9944FF"),_("#4499FF"),_("#88DD88")]},{name:"Vaporwave",colors:[_("#FF71CE"),_("#01CDFE"),_("#05FFA1"),_("#B967FF"),_("#FFFB96"),_("#FF6AD5"),_("#C774E8"),_("#94D0FF"),_("#8795E8"),_("#FF10F0"),_("#00D9FF"),_("#00FFC8"),_("#FF88DD"),_("#22DDFF"),_("#AA77FF"),_("#FFEE88")]},{name:"Random (Color Theory)",colors:[]}],C5=new Map;let kp=Date.now();const i2=e=>{kp=e,C5.clear(),console.log(` Random palette seed set to: ${e}`),typeof window<"u"&&window.dispatchEvent(new CustomEvent("palette-changed"))},s_=e=>{const t=Math.max(e,16);if(!C5.has(kp)){const n=o_(kp,t);C5.set(kp,n)}return C5.get(kp)},iR=(e,t,n=16)=>{const r=e%kl.length,a=kl[r];if(r===kl.length-1){const s=s_(n);return s[t%s.length]}return a.colors[t%a.colors.length]},Py=(e,t=0,n=16)=>{const[r,a,i]=iR(t,e,n);return`rgb(${Math.floor(r*255)}, ${Math.floor(a*255)}, ${Math.floor(i*255)})`},d0="'IBM Plex Mono', monospace",Do=({label:e,value:t,min:n,max:r,step:a,onChange:i,unit:s})=>{const c=t??n??0,l=a>=1?0:a>=.1?1:a>=.01?2:3,d=(c-n)/(r-n)*100;return o.jsxs("div",{className:"flex flex-col gap-1 group",children:[o.jsxs("div",{className:"flex items-baseline justify-between",children:[o.jsx("label",{style:{fontFamily:d0,fontSize:"9px",fontWeight:200,letterSpacing:"0.5px",color:"rgba(255,255,255,0.35)",textTransform:"uppercase"},children:e}),o.jsxs("span",{style:{fontFamily:d0,fontSize:"9px",fontWeight:300,color:"rgba(255,255,255,0.5)",fontVariantNumeric:"tabular-nums"},children:[c.toFixed(l),s]})]}),o.jsxs("div",{className:"relative h-3 flex items-center",children:[o.jsx("div",{className:"absolute left-0 right-0 h-px",style:{background:"rgba(255,255,255,0.08)"}}),o.jsx("div",{className:"absolute left-0 h-px",style:{width:`${d}%`,background:"rgba(255,212,0,0.3)"}}),o.jsx("input",{type:"range",min:n,max:r,step:a,value:c,onChange:u=>i(parseFloat(u.target.value)),className:`absolute w-full h-3 appearance-none cursor-pointer bg-transparent
            [&::-webkit-slider-thumb]:appearance-none
            [&::-webkit-slider-thumb]:w-1.5
            [&::-webkit-slider-thumb]:h-3
            [&::-webkit-slider-thumb]:bg-white/50
            [&::-webkit-slider-thumb]:transition-colors
            [&::-moz-range-thumb]:w-1.5
            [&::-moz-range-thumb]:h-3
            [&::-moz-range-thumb]:bg-white/50
            [&::-moz-range-thumb]:border-0
            [&::-moz-range-thumb]:transition-colors`,style:{zIndex:1}})]})]})},iM=({microConfig:e,fieldConfig:t,reconfigConfig:n,targetParticleCount:r,onMicroChange:a,onFieldChange:i,onReconfigChange:s,onTargetParticleCountChange:c,onRandomizeAll:l,life:d,onLifeChange:u,lifeStats:h,pointSize:m=4,fadeFactor:f=.92,glowIntensity:g=.5,paletteIndex:x=0,onPointSizeChange:v,onFadeFactorChange:b,onGlowIntensityChange:w,onPaletteIndexChange:M,trails:k=!0,fieldHeatmap:R=!1,onToggleTrails:j,onToggleFieldHeatmap:I,onApplyRecipe:E,onNewUniverse:O,onChaosSeed:L,onLoadPreset:$,renderMode:F="dots",streakLength:B=8,onRenderModeChange:W,onStreakLengthChange:re,simQuality:oe="HIGH",dotSize:te=2,onSimQualityChange:J,onDotSizeChange:pe,spawnPattern:P="random",onSpawnPatternChange:V,onBackgroundClick:fe,showBonds:ye=!1,bondsDistance:Se=.07,bondsOpacity:we=.1,showTrails:ke=!1,trailsLength:De=20,trailsOpacity:_e=.6,onShowBondsChange:ae,onBondsDistanceChange:Re,onBondsOpacityChange:Fe,onShowTrailsChange:Oe,onTrailsLengthChange:ne,onTrailsOpacityChange:nt,sigilConfig:pt,onSigilConfigChange:Et,archetypesDetected:_t,onClearSigils:Ct,hideCoreControls:Xe=!1})=>{var Ut;return o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"space-y-2 pb-3",style:{borderBottom:"1px dashed rgba(255,255,255,0.08)"},children:[o.jsxs("h2",{style:{fontFamily:"'Doto', monospace",fontSize:"11px",fontWeight:400,letterSpacing:"0.1em",color:"#ffd400",textTransform:"uppercase"},children:[""," Algoritmo"]}),o.jsx("p",{style:{fontFamily:d0,fontSize:"9px",fontWeight:200,color:"rgba(255,255,255,0.35)",lineHeight:1.4},children:"Motor central do MetaLifeLab. Controle a fisica, quimica e estetica do universo."})]}),(E||O||L||V)&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"space-y-3",children:[o.jsx("h3",{style:{fontFamily:"'Doto', monospace",fontSize:10,color:"rgba(255,255,255,0.55)",letterSpacing:"0.1em",textTransform:"uppercase",paddingBottom:5,borderBottom:"1px dashed rgba(255,255,255,0.05)"},children:"Ecossistema"}),o.jsx("p",{className:"text-white/30 text-[9px] font-light italic leading-relaxed",children:"Gere universos com o sistema WorldDNA"}),V&&o.jsxs("div",{children:[o.jsx("label",{className:"text-white/40 text-[9px] tracking-wide uppercase font-light block mb-1.5",children:"Padro Inicial"}),o.jsxs("select",{value:P,onChange:Le=>V(Le.target.value),style:{fontFamily:d0,fontSize:10,border:"1px dashed rgba(255,255,255,0.08)",background:"transparent",color:"rgba(255,255,255,0.55)",padding:"5px 8px"},className:"w-full focus:outline-none transition-colors",children:[o.jsxs("optgroup",{label:"Bsicos",className:"bg-black",children:[o.jsx("option",{value:"random",className:"bg-black",children:"Random Chaos"}),o.jsx("option",{value:"center_cluster",className:"bg-black",children:"Center Cluster"}),o.jsx("option",{value:"grid",className:"bg-black",children:"Grid"}),o.jsx("option",{value:"perimeter",className:"bg-black",children:"Perimeter"})]}),o.jsxs("optgroup",{label:"Circulares",className:"bg-black",children:[o.jsx("option",{value:"ring",className:"bg-black",children:"Ring"}),o.jsx("option",{value:"concentric_rings",className:"bg-black",children:"Concentric Rings"}),o.jsx("option",{value:"spiral",className:"bg-black",children:"Spiral"}),o.jsx("option",{value:"vortex",className:"bg-black",children:"Vortex"})]}),o.jsxs("optgroup",{label:"Geomtricos",className:"bg-black",children:[o.jsx("option",{value:"triangle",className:"bg-black",children:"Triangle"}),o.jsx("option",{value:"cross",className:"bg-black",children:"Cross"}),o.jsx("option",{value:"checkerboard",className:"bg-black",children:"Checkerboard"}),o.jsx("option",{value:"corners",className:"bg-black",children:"Four Corners"})]}),o.jsxs("optgroup",{label:"Bandas",className:"bg-black",children:[o.jsx("option",{value:"vertical_bands",className:"bg-black",children:"Vertical Bands"}),o.jsx("option",{value:"horizontal_bands",className:"bg-black",children:"Horizontal Bands"})]}),o.jsxs("optgroup",{label:"Especiais",className:"bg-black",children:[o.jsx("option",{value:"two_clusters",className:"bg-black",children:"Two Clusters"}),o.jsx("option",{value:"double_helix",className:"bg-black",children:"Double Helix"}),o.jsx("option",{value:"sunburst",className:"bg-black",children:"Sunburst"}),o.jsx("option",{value:"wave",className:"bg-black",children:"Wave"}),o.jsx("option",{value:"fractal_dust",className:"bg-black",children:"Fractal Dust"}),o.jsx("option",{value:"yin_yang",className:"bg-black",children:"Yin Yang"})]})]})]}),(O||L)&&o.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[O&&o.jsx("button",{onClick:O,className:"text-[10px] py-1.5 px-2 transition-all uppercase",style:{border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.45)",fontFamily:"'IBM Plex Mono', monospace",letterSpacing:"0.06em"},children:"Novo Universo"}),L&&o.jsx("button",{onClick:L,className:"text-[10px] py-1.5 px-2 transition-all uppercase",style:{border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.45)",fontFamily:"'IBM Plex Mono', monospace",letterSpacing:"0.06em"},children:"Semente do Caos"})]}),E&&o.jsxs("div",{children:[o.jsx("label",{className:"text-white/40 text-[9px] tracking-wide uppercase font-light block mb-1.5",children:"Receitas"}),o.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[o.jsx("button",{onClick:()=>E("pollock"),className:"text-[10px] py-1.5 px-2 transition-all uppercase",style:{border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.40)",fontFamily:"'IBM Plex Mono', monospace"},title:"Chaotic streaking patterns",children:"Pollock"}),o.jsx("button",{onClick:()=>E("mitosis"),className:"text-[10px] py-1.5 px-2 transition-all uppercase",style:{border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.40)",fontFamily:"'IBM Plex Mono', monospace"},title:"Self-dividing clusters",children:"Mitosis"}),o.jsx("button",{onClick:()=>E("alliances"),className:"text-[10px] py-1.5 px-2 transition-all uppercase",style:{border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.40)",fontFamily:"'IBM Plex Mono', monospace"},title:"Symbiotic coalitions",children:"Alliances"}),o.jsx("button",{onClick:()=>E("planets"),className:"text-[10px] py-1.5 px-2 transition-all uppercase",style:{border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.40)",fontFamily:"'IBM Plex Mono', monospace"},title:"Orbital ring structures",children:"Planets"}),o.jsx("button",{onClick:()=>E("field"),className:"text-[10px] py-1.5 px-2 transition-all uppercase",style:{border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.40)",fontFamily:"'IBM Plex Mono', monospace"},title:"Sparse high-energy field",children:"Field"}),o.jsx("button",{onClick:()=>E("gems"),className:"text-[10px] py-1.5 px-2 transition-all uppercase",style:{border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.40)",fontFamily:"'IBM Plex Mono', monospace"},title:"Dense crystalline clusters",children:"Gems"}),o.jsx("button",{onClick:()=>E("drift"),className:"text-[10px] py-1.5 px-2 transition-all uppercase",style:{border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.40)",fontFamily:"'IBM Plex Mono', monospace"},title:"Flowing sparse patterns",children:"Drift"}),o.jsx("button",{onClick:()=>E("simplify"),className:"text-[10px] py-1.5 px-2 transition-all uppercase",style:{border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.40)",fontFamily:"'IBM Plex Mono', monospace"},title:"Minimal stable structures",children:"Simplify"}),o.jsx("button",{onClick:()=>E("darwin"),className:"text-[10px] py-1.5 px-2 transition-all uppercase",style:{border:"1px dashed rgba(16,212,91,0.20)",color:"rgba(16,212,91,0.70)",fontFamily:"'IBM Plex Mono', monospace"},title:"Evolution with mutations and adaptations",children:"Darwin"})]})]}),$&&o.jsxs("div",{className:"space-y-2",children:[o.jsx("div",{className:"flex items-center justify-between",children:o.jsxs("label",{className:"text-white/50 text-[9px] tracking-wide uppercase font-light",children:[" Featured (",Cp.length,")"]})}),["stable","living","wild"].map(Le=>{const Ke=Cp.filter(Be=>Be.category===Le),mt=Le==="stable"?" Stable Forms":Le==="living"?" Living Systems":" Wild / Oracle",an=Le==="stable"?"text-cyan-400/70":Le==="living"?"text-green-400/70":"text-purple-400/70",gn=Le==="stable"?"border-cyan-500/20 hover:border-cyan-500/40":Le==="living"?"border-green-500/20 hover:border-green-500/40":"border-purple-500/20 hover:border-purple-500/40";return o.jsxs("div",{className:"space-y-1",children:[o.jsx("div",{className:`text-[8px] tracking-widest uppercase font-light ${an} pl-0.5`,children:mt}),Ke.map(Be=>o.jsxs("button",{onClick:()=>$(Be.id),className:`w-full border ${gn} text-white/60 hover:text-white/90 text-left py-2 px-2.5 transition-all group`,children:[o.jsxs("div",{className:"flex items-baseline justify-between gap-1",children:[o.jsx("span",{className:"text-[10px] font-medium text-white/80",children:Be.name}),o.jsxs("span",{className:"text-[8px] text-white/25 font-mono shrink-0",children:[Be.particleCount,"p/",Be.typesCount,"t"]})]}),o.jsx("div",{className:"text-[8px] text-white/40 leading-tight mt-0.5 line-clamp-2",children:Be.description}),Be.tags&&o.jsx("div",{className:"flex flex-wrap gap-0.5 mt-1",children:Be.tags.slice(0,3).map(ft=>o.jsx("span",{className:"text-[7px] px-1 py-px bg-white/5 text-white/30 border border-white/[0.06]",children:ft},ft))})]},Be.id))]},Le)}),o.jsxs("details",{className:"group",children:[o.jsxs("summary",{className:"cursor-pointer text-white/30 text-[9px] tracking-wide uppercase font-light py-1 hover:text-white/50 transition-colors select-none",children:[" All Presets (",Yh.length-Cp.length," more)"]}),o.jsx("div",{className:`mt-1.5 grid grid-cols-2 gap-1 max-h-[300px] overflow-y-auto pr-1
                    [&::-webkit-scrollbar]:w-1 [&::-webkit-scrollbar-track]:bg-white/5
                    [&::-webkit-scrollbar-thumb]:bg-white/20`,children:Yh.filter(Le=>!Cp.find(Ke=>Ke.id===Le.id)).map(Le=>o.jsxs("button",{onClick:()=>$(Le.id),className:"text-white/50 hover:text-white/80 text-[9px] py-1.5 px-2 transition-all text-left",style:{border:"1px dashed rgba(255,255,255,0.05)",fontFamily:"'IBM Plex Mono', monospace"},title:Le.description,children:[o.jsx("div",{className:"truncate font-medium",children:Le.name}),o.jsxs("div",{className:"text-[7px] text-white/25 mt-0.5",children:[Le.typesCount," types"]})]},Le.id))})]})]})]}),o.jsx("div",{className:"h-px bg-white/[0.04]"})]}),l&&o.jsxs(o.Fragment,{children:[o.jsx("div",{children:o.jsx("button",{onClick:l,className:"w-full text-[10px] py-2 px-2 transition-all uppercase",style:{border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.45)",fontFamily:"'IBM Plex Mono', monospace",letterSpacing:"0.06em"},children:"Aleatorizar Tudo"})}),o.jsx("div",{className:"h-px bg-white/[0.04]"})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("h3",{className:"text-[10px] uppercase pb-1.5",style:{fontFamily:"'Doto', monospace",color:"rgba(255,255,255,0.50)",letterSpacing:"0.08em",borderBottom:"1px dashed rgba(255,255,255,0.05)"},children:"Visual"}),j&&o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx("input",{type:"checkbox",id:"enableTrails",checked:k,onChange:j,className:"w-2.5 h-2.5 bg-transparent border border-white/15 checked:bg-white/20 cursor-pointer"}),o.jsx("label",{htmlFor:"enableTrails",className:"text-white/40 text-[10px] font-light cursor-pointer uppercase tracking-wide",children:"Rastros (Trails)"})]}),I&&o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx("input",{type:"checkbox",id:"enableFieldHeatmap",checked:R,onChange:I,className:"w-2.5 h-2.5 bg-transparent border border-white/15 checked:bg-white/20 cursor-pointer"}),o.jsx("label",{htmlFor:"enableFieldHeatmap",className:"text-white/40 text-[10px] font-light cursor-pointer uppercase tracking-wide",children:"Campo (Heatmap)"})]})]}),o.jsx("div",{className:"h-px bg-white/[0.04]"}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("h3",{className:"text-[10px] uppercase pb-1.5",style:{fontFamily:"'Doto', monospace",color:"rgba(255,255,255,0.50)",letterSpacing:"0.08em",borderBottom:"1px dashed rgba(255,255,255,0.05)"},children:"Populao"}),o.jsx(Do,{label:"Agentes",value:r,min:100,max:5e3,step:100,onChange:c}),o.jsx(Do,{label:"Espcies",value:e.typesCount,min:2,max:16,step:1,onChange:Le=>a({typesCount:Le})}),o.jsxs("div",{className:"flex items-center gap-1.5 pt-1",children:[o.jsx("input",{type:"checkbox",id:"foodEnabled",checked:e.foodEnabled,onChange:Le=>a({foodEnabled:Le.target.checked}),className:"w-2.5 h-2.5 bg-transparent border border-white/15 checked:bg-white/20 cursor-pointer"}),o.jsx("label",{htmlFor:"foodEnabled",className:"text-white/40 text-[10px] font-light cursor-pointer uppercase tracking-wide",children:"Ativar Partculas de Alimento"})]}),e.foodEnabled&&o.jsx(Do,{label:"Proporo de Alimento",value:e.foodRatio,min:.05,max:.5,step:.05,onChange:Le=>a({foodRatio:Le}),unit:"%"})]}),o.jsx("div",{className:"h-px bg-white/[0.04]"}),!Xe&&o.jsxs("div",{className:"space-y-3","data-guide":"guide-params",children:[o.jsx("h3",{className:"text-[10px] uppercase pb-1.5",style:{fontFamily:"'Doto', monospace",color:"rgba(255,255,255,0.50)",letterSpacing:"0.08em",borderBottom:"1px dashed rgba(255,255,255,0.05)"},children:"Fsica"}),o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx("input",{type:"checkbox",id:"wrapBoundaries",checked:e.wrap,onChange:Le=>a({wrap:Le.target.checked}),className:"w-2.5 h-2.5 bg-transparent border border-white/15 checked:bg-white/20 cursor-pointer"}),o.jsx("label",{htmlFor:"wrapBoundaries",className:"text-white/40 text-[10px] font-light cursor-pointer uppercase tracking-wide",children:e.wrap?"Universo Infinito (Wrap)":"Bordas Fechadas"})]}),o.jsx(Do,{label:"Alcance de Interao",value:e.rmax,min:.1,max:.5,step:.01,onChange:Le=>a({rmax:Le})}),o.jsx(Do,{label:"Ganho de Fora",value:e.force,min:.2,max:4,step:.1,onChange:Le=>a({force:Le})}),o.jsx(Do,{label:"Arrasto (Viscosidade)",value:e.drag,min:.1,max:5,step:.1,onChange:Le=>a({drag:Le})}),o.jsx(Do,{label:"Limite de Velocidade",value:e.speedClamp,min:.02,max:.5,step:.01,onChange:Le=>a({speedClamp:Le})}),o.jsx(Do,{label:"Entropia (Caos)",value:e.entropy,min:0,max:1,step:.01,onChange:Le=>a({entropy:Le})}),o.jsx(Do,{label:"Repulso Central (Beta)",value:e.beta,min:.05,max:.95,step:.01,onChange:Le=>a({beta:Le})})]}),o.jsx("div",{className:"h-px bg-white/[0.04]"}),!Xe&&d&&u&&o.jsxs("div",{className:"space-y-3",children:[o.jsx("h3",{className:"text-[10px] uppercase pb-1.5",style:{fontFamily:"'Doto', monospace",color:"rgba(255,255,255,0.50)",letterSpacing:"0.08em",borderBottom:"1px dashed rgba(255,255,255,0.05)"},children:"VIDA (4.5)"}),o.jsx("p",{className:"text-white/30 text-[9px] font-light italic leading-relaxed",children:"Sistema unificado de energia, mutao e evoluo"}),o.jsxs("div",{children:[o.jsx("label",{className:"text-white/40 text-[9px] tracking-wide uppercase font-light block mb-1.5",children:"Modo"}),o.jsxs("select",{value:d.mode,onChange:Le=>u({mode:Le.target.value}),className:"w-full text-white/70 text-[10px] py-1.5 px-2 focus:outline-none transition-colors",style:{background:"rgba(0,0,0,0.4)",border:"1px dashed rgba(255,255,255,0.08)",fontFamily:"'IBM Plex Mono', monospace"},children:[o.jsx("option",{value:"OFF",children:"OFF (Esttico)"}),o.jsx("option",{value:"METABOLIC",children:"METABLICO (Apenas energia)"}),o.jsx("option",{value:"EVOLUTIVE",children:"EVOLUTIVO (Apenas mutao)"}),o.jsx("option",{value:"FULL",children:"COMPLETO (Todos os sistemas)"})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx("input",{type:"checkbox",id:"foodEnabled",checked:d.foodEnabled,onChange:Le=>u({foodEnabled:Le.target.checked}),className:"w-2.5 h-2.5 bg-transparent border border-white/15 checked:bg-white/20 cursor-pointer"}),o.jsx("label",{htmlFor:"foodEnabled",className:"text-white/40 text-[10px] font-light cursor-pointer uppercase tracking-wide",children:"Comida Ativada"})]}),d.foodEnabled&&o.jsx(Do,{label:"Proporo de Comida",value:d.foodRatio,min:.05,max:.5,step:.05,onChange:Le=>u({foodRatio:Le})})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx("input",{type:"checkbox",id:"energyEnabled",checked:d.energyEnabled,onChange:Le=>u({energyEnabled:Le.target.checked}),className:"w-2.5 h-2.5 bg-transparent border border-white/15 checked:bg-white/20 cursor-pointer"}),o.jsx("label",{htmlFor:"energyEnabled",className:"text-white/40 text-[10px] font-light cursor-pointer uppercase tracking-wide",children:"Energia Ativada"})]}),d.energyEnabled&&o.jsxs(o.Fragment,{children:[o.jsx(Do,{label:"Decaimento de Energia",value:d.energyDecay,min:1e-4,max:.01,step:1e-4,onChange:Le=>u({energyDecay:Le})}),o.jsx(Do,{label:"Taxa de Alimentao",value:d.energyFeedRate,min:.01,max:.2,step:.01,onChange:Le=>u({energyFeedRate:Le})}),o.jsx(Do,{label:"Limiar de Reproduo",value:d.energyReproThreshold,min:1.5,max:3,step:.1,onChange:Le=>u({energyReproThreshold:Le})})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(Do,{label:"Dial de Mutao",value:d.mutationDial,min:0,max:1,step:.01,onChange:Le=>u({mutationDial:Le})}),o.jsxs("div",{className:"space-y-0.5 p-2 bg-white/[0.02]",style:{border:"1px dashed rgba(255,255,255,0.04)"},children:[o.jsxs("div",{className:"flex justify-between text-[9px]",children:[o.jsx("span",{className:"text-white/30",children:"Taxa de Mutao:"}),o.jsx("span",{className:"text-white/60 font-mono",children:d.mutationRate.toFixed(5)})]}),o.jsxs("div",{className:"flex justify-between text-[9px]",children:[o.jsx("span",{className:"text-white/30",children:"Estabilidade de Tipo:"}),o.jsx("span",{className:"text-white/60 font-mono",children:d.typeStability.toFixed(3)})]}),o.jsxs("div",{className:"flex justify-between text-[9px]",children:[o.jsx("span",{className:"text-white/30",children:"Intensidade de Mutao:"}),o.jsx("span",{className:"text-white/60 font-mono",children:d.mutationAmount.toFixed(3)})]}),o.jsxs("div",{className:"flex justify-between text-[9px]",children:[o.jsx("span",{className:"text-white/30",children:"Taxa de Reconfigurao:"}),o.jsx("span",{className:"text-white/60 font-mono",children:d.reconfigRate.toFixed(3)})]})]})]}),o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx("input",{type:"checkbox",id:"reconfigEnabled",checked:d.reconfigEnabled,onChange:Le=>u({reconfigEnabled:Le.target.checked}),className:"w-2.5 h-2.5 bg-transparent border border-white/15 checked:bg-white/20 cursor-pointer"}),o.jsx("label",{htmlFor:"reconfigEnabled",className:"text-white/40 text-[10px] font-light cursor-pointer uppercase tracking-wide",children:"Mutao Macro (Reconfig)"})]}),h&&o.jsxs("div",{className:"space-y-1 p-2",style:{background:"rgba(16,212,91,0.04)",border:"1px dashed rgba(16,212,91,0.10)"},children:[o.jsx("div",{className:"text-white/50 text-[9px] uppercase tracking-wide mb-1",children:"Estatsticas ao Vivo"}),o.jsxs("div",{className:"grid grid-cols-2 gap-x-2 gap-y-0.5 text-[9px]",children:[o.jsx("span",{className:"text-white/30",children:"Nascimentos:"}),o.jsx("span",{className:"text-green-400/80 font-mono text-right",children:h.births}),o.jsx("span",{className:"text-white/30",children:"Mortes:"}),o.jsx("span",{className:"text-red-400/80 font-mono text-right",children:h.deaths}),o.jsx("span",{className:"text-white/30",children:"Mutaes:"}),o.jsx("span",{className:"text-purple-400/80 font-mono text-right",children:h.mutations}),o.jsx("span",{className:"text-white/30",children:"Especiao:"}),o.jsx("span",{className:"text-blue-400/80 font-mono text-right",children:h.speciation})]}),h.lastEvent&&o.jsx("div",{className:"text-white/40 text-[9px] mt-1 italic",children:h.lastEvent})]})]}),o.jsx("div",{className:"h-px bg-white/[0.04]"}),!Xe&&o.jsxs("div",{className:"space-y-3",children:[o.jsx("h3",{className:"text-[10px] uppercase pb-1.5",style:{fontFamily:"'Doto', monospace",color:"rgba(255,255,255,0.50)",letterSpacing:"0.08em",borderBottom:"1px dashed rgba(255,255,255,0.05)"},children:"Campo"}),o.jsx(Do,{label:"Difuso (Espalha)",value:t.diffusion,min:.3,max:.99,step:.01,onChange:Le=>i({diffusion:Le})}),o.jsx(Do,{label:"Decaimento (Evap.)",value:t.decay,min:0,max:.2,step:.001,onChange:Le=>i({decay:Le})})]}),o.jsx("div",{className:"h-px bg-white/[0.04]"}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("h3",{className:"text-[10px] uppercase pb-1.5",style:{fontFamily:"'Doto', monospace",color:"rgba(255,255,255,0.50)",letterSpacing:"0.08em",borderBottom:"1px dashed rgba(255,255,255,0.05)"},children:"Renderizao"}),J&&o.jsxs("div",{children:[o.jsx("label",{className:"text-white/40 text-[9px] tracking-wide uppercase font-light block mb-1.5",children:"Qualidade"}),o.jsx("div",{className:"grid grid-cols-3 gap-1.5",children:["FAST","HIGH","ULTRA"].map(Le=>o.jsx("button",{onClick:()=>J(Le),className:"text-[10px] py-1 px-1.5 transition-all uppercase",style:{fontFamily:d0,border:oe===Le?"1px dashed rgba(255,212,0,0.25)":"1px dashed rgba(255,255,255,0.06)",color:oe===Le?"#ffd400":"rgba(255,255,255,0.40)",background:oe===Le?"rgba(255,212,0,0.04)":"transparent"},children:Le},Le))})]}),pe&&o.jsx(Do,{label:"Tamanho do Ponto",value:te,min:1,max:6,step:.5,onChange:pe,unit:"px"}),v&&o.jsx(Do,{label:"Brilho do Ponto",value:m,min:1,max:12,step:.5,onChange:v,unit:"px"}),w&&o.jsx(Do,{label:"Intensidade Glow",value:g,min:0,max:2,step:.1,onChange:w}),M&&o.jsxs("div",{className:"space-y-1.5",children:[o.jsxs("div",{className:"flex items-baseline justify-between",children:[o.jsx("label",{className:"text-white/40 text-[9px] tracking-wide uppercase font-light",children:"Paleta de Cores"}),o.jsx("span",{className:"text-white/80 text-[11px] font-mono font-semibold",children:((Ut=kl[x%kl.length])==null?void 0:Ut.name)||`#${x}`})]}),o.jsx("button",{type:"button",onClick:Le=>{Le.preventDefault(),Le.stopPropagation();const Ke=Math.floor(Math.random()*kl.length);console.log("[Patchboard] Randomizing palette:",{old:x,new:Ke}),M(Ke)},className:"w-full text-[10px] py-2.5 px-2 transition-all uppercase cursor-pointer",style:{border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.45)",fontFamily:d0,letterSpacing:"0.06em"},children:"Randomizar Cores"})]}),o.jsx("div",{children:o.jsx("button",{onClick:()=>{fe&&fe()},className:"w-full text-[10px] py-2.5 px-2 transition-all uppercase cursor-pointer",style:{border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.45)",fontFamily:d0,letterSpacing:"0.06em"},children:"Fundo do Canvas"})})]}),o.jsx("div",{className:"h-px bg-white/[0.04]"}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("h3",{className:"text-[10px] uppercase pb-1.5",style:{fontFamily:"'Doto', monospace",color:"rgba(255,255,255,0.50)",letterSpacing:"0.08em",borderBottom:"1px dashed rgba(255,255,255,0.05)"},children:"Overlays"}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{"data-guide":"guide-bonds",children:[o.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[o.jsx("input",{type:"checkbox",id:"showBonds",checked:ye,onChange:Le=>ae==null?void 0:ae(Le.target.checked),className:"w-3 h-3 border-white/15 bg-white/[0.05] checked:bg-cyan-500/50 cursor-pointer"}),o.jsx("label",{htmlFor:"showBonds",className:"text-white/70 text-[10px] font-light cursor-pointer",children:"Conexes (Bonds)"})]}),ye&&o.jsxs("div",{className:"space-y-2 pl-4",children:[Re&&o.jsx(Do,{label:"Distncia",value:Se,min:.01,max:.5,step:.01,onChange:Re}),Fe&&o.jsx(Do,{label:"Opacidade",value:we,min:.05,max:1,step:.05,onChange:Fe})]})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[o.jsx("input",{type:"checkbox",id:"showTrails",checked:ke,onChange:Le=>Oe==null?void 0:Oe(Le.target.checked),className:"w-3 h-3 border-white/15 bg-white/[0.05] checked:bg-cyan-500/50 cursor-pointer"}),o.jsx("label",{htmlFor:"showTrails",className:"text-white/70 text-[10px] font-light cursor-pointer",children:"Rastros (Trails)"})]}),ke&&o.jsxs("div",{className:"space-y-2 pl-4",children:[ne&&o.jsx(Do,{label:"Comprimento",value:De,min:5,max:60,step:5,onChange:ne,unit:" pts"}),nt&&o.jsx(Do,{label:"Opacidade",value:_e,min:.1,max:1,step:.05,onChange:nt})]})]})]})]}),o.jsx("div",{className:"h-px bg-white/[0.04]"}),pt&&Et&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"space-y-3",children:[o.jsx("h3",{className:"text-[10px] uppercase pb-1.5",style:{fontFamily:"'Doto', monospace",color:"rgba(255,255,255,0.50)",letterSpacing:"0.08em",borderBottom:"1px dashed rgba(255,255,255,0.05)"},children:"SIGILS (RecursiveLab)"}),o.jsx("p",{className:"text-white/30 text-[9px] font-light italic leading-relaxed",children:"Sistema de deteco de arqutipos baseado em smbolos depositados por interaes locais."}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("input",{type:"checkbox",id:"sigilsEnabled",checked:pt.enabled,onChange:Le=>Et({enabled:Le.target.checked}),className:"w-3 h-3 border-white/15 bg-white/[0.05] checked:bg-cyan-500/50 cursor-pointer"}),o.jsx("label",{htmlFor:"sigilsEnabled",className:"text-white/70 text-[10px] font-light cursor-pointer",children:"Sistema de Sigils Ativo"})]}),pt.enabled&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex items-center gap-2 pl-4",children:[o.jsx("input",{type:"checkbox",id:"sigilsShowOverlay",checked:pt.showOverlay,onChange:Le=>Et({showOverlay:Le.target.checked}),className:"w-3 h-3 border-white/15 bg-white/[0.05] checked:bg-cyan-500/50 cursor-pointer"}),o.jsx("label",{htmlFor:"sigilsShowOverlay",className:"text-white/70 text-[10px] font-light cursor-pointer",children:"Mostrar Overlay (Tecla: S)"})]}),o.jsxs("div",{className:"space-y-2 pl-4",children:[o.jsx(Do,{label:"Influncia",value:pt.influence,min:0,max:1,step:.05,onChange:Le=>Et({influence:Le})}),o.jsx(Do,{label:"Depsito",value:pt.deposit,min:0,max:2,step:.1,onChange:Le=>Et({deposit:Le})}),o.jsx(Do,{label:"Difuso",value:pt.diffusion,min:0,max:.3,step:.01,onChange:Le=>Et({diffusion:Le})}),o.jsx(Do,{label:"Decaimento",value:pt.decay,min:0,max:2,step:.05,onChange:Le=>Et({decay:Le})})]}),Ct&&o.jsx("div",{className:"pl-4 space-y-1.5",children:o.jsx("button",{onClick:Ct,className:"w-full text-[10px] py-1.5 px-2 transition-all uppercase cursor-pointer",style:{border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.35)",fontFamily:d0,letterSpacing:"0.06em"},children:"Limpar Sigils"})}),o.jsxs("div",{className:"space-y-1.5 pl-4",children:[o.jsx("div",{className:"text-white/40 text-[9px] tracking-wide uppercase font-light",children:"Smbolos:"}),o.jsxs("div",{className:"grid grid-cols-2 gap-1 text-[10px]",children:[o.jsx("div",{className:"text-cyan-400/70",children:" Vnculo"}),o.jsx("div",{className:"text-red-400/70",children:" Ruptura"}),o.jsx("div",{className:"text-green-400/70",children:" Florescer"}),o.jsx("div",{className:"text-purple-400/70",children:" Juramento"})]})]}),o.jsxs("div",{className:"space-y-1.5 pl-4",children:[o.jsxs("div",{className:"text-white/40 text-[9px] tracking-wide uppercase font-light border-b border-white/[0.06] pb-1",children:["Arqutipos Detectados (",(_t==null?void 0:_t.length)||0,")"]}),_t&&_t.length>0?o.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:_t.slice(0,8).map(Le=>o.jsxs("div",{className:"text-[9px] text-white/50 flex items-center gap-1.5",children:[o.jsx("span",{className:"text-[11px]",children:Le.sigil}),o.jsx("span",{className:"font-mono",children:Le.name}),o.jsxs("span",{className:"text-white/30 text-[8px]",children:["(",Le.particleCount||"?","p)"]})]},Le.id))}):o.jsx("div",{className:"text-[9px] text-white/30 italic",children:"Nenhum arqutipo emergiu ainda  aumente entropia e aguarde"})]}),o.jsxs("div",{className:"pl-4 space-y-1.5 p-2 text-[9px] text-white/40 leading-relaxed",style:{background:"rgba(255,255,255,0.02)",border:"1px dashed rgba(255,255,255,0.04)"},children:[o.jsx("div",{className:"text-white/60 font-semibold uppercase tracking-wide text-[8px]",children:"COMO FUNCIONA:"}),o.jsxs("div",{children:[" ",o.jsx("strong",{children:"Mutao:"})," genes mudam com entropia (se metamorphosis on)"]}),o.jsxs("div",{children:[" ",o.jsx("strong",{children:"Especiao:"})," quando padres divergem, arqutipo emerge"]}),o.jsxs("div",{children:[" ",o.jsx("strong",{children:"Sigils:"})," smbolos depositados por interaes e decaem/difundem"]})]})]})]}),o.jsx("div",{className:"h-px bg-white/[0.04]"})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("h3",{className:"text-[10px] uppercase pb-1.5",style:{fontFamily:"'Doto', monospace",color:"rgba(255,255,255,0.50)",letterSpacing:"0.08em",borderBottom:"1px dashed rgba(255,255,255,0.05)"},children:"Reconfiguration"}),o.jsx("p",{className:"text-white/30 text-[9px] font-light italic leading-relaxed",children:"Detection interval controls when macro mutations can occur. Mutation rate/amount now controlled by Life Dial."}),o.jsx(Do,{label:"Interval (Reconfig Tick)",value:n.interval,min:.5,max:12,step:.5,onChange:Le=>s({interval:Le}),unit:"s"})]})]})},lM="'IBM Plex Mono', monospace",cM=({matrix:e,typesCount:t,onMatrixChange:n,onRandomize:r,onSoften:a,onSymmetrize:i,onInvert:s,onNormalize:c})=>{const[l,d]=S.useState("attract"),[u,h]=S.useState(!1),m=(b,w,M)=>{const k={...e};l==="attract"?k.attract[b][w]=Math.max(-1,Math.min(1,e.attract[b][w]+M)):l==="radius"?k.radius[b][w]=Math.max(0,Math.min(.3,e.radius[b][w]+M*.01)):l==="falloff"&&(k.falloff[b][w]=Math.max(.5,Math.min(3,e.falloff[b][w]+M*.1))),n(k)},f=(b,w)=>l==="attract"?e.attract[b][w]:l==="radius"?e.radius[b][w]:e.falloff[b][w],g=b=>{if(l==="attract")if(b>0){const M=Math.floor(b*255);return`rgb(${M}, 255, ${M})`}else{const M=Math.floor(-b*255);return`rgb(255, ${M}, ${M})`}const w=Math.floor(b/3*255);return`rgb(${w}, ${w}, 255)`},x=b=>({fontFamily:lM,fontSize:9,padding:"3px 10px",textTransform:"uppercase",letterSpacing:"0.06em",cursor:"pointer",transition:"all 0.15s",border:b?"1px dashed rgba(255,212,0,0.25)":"1px dashed rgba(255,255,255,0.06)",color:b?"#ffd400":"rgba(255,255,255,0.40)",background:b?"rgba(255,212,0,0.04)":"transparent"}),v={fontFamily:lM,fontSize:9,padding:"6px 10px",textTransform:"uppercase",letterSpacing:"0.06em",cursor:"pointer",transition:"all 0.15s",border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.40)",background:"transparent"};return o.jsxs("div",{className:"space-y-4",children:[o.jsx("div",{className:"flex gap-2",children:["attract","radius","falloff"].map(b=>o.jsx("button",{onClick:()=>d(b),style:x(l===b),children:b},b))}),o.jsx("div",{className:"overflow-auto max-h-96",children:o.jsx("div",{className:"grid gap-1",style:{gridTemplateColumns:`repeat(${t}, 1fr)`},onMouseLeave:()=>h(!1),children:Array.from({length:t}).map((b,w)=>Array.from({length:t}).map((M,k)=>{const R=f(w,k);return o.jsx("div",{className:"aspect-square cursor-pointer transition-all",style:{backgroundColor:g(R),border:"1px dashed rgba(255,255,255,0.08)"},onMouseDown:()=>h(!0),onMouseUp:()=>h(!1),onMouseEnter:j=>{u&&m(w,k,j.shiftKey?-.1:.1)},onClick:j=>m(w,k,j.shiftKey?-.1:.1),title:`${w}  ${k}: ${R.toFixed(2)}`},`${w}-${k}`)}))})}),o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsx("button",{onClick:r,style:v,children:"Randomize"}),o.jsx("button",{onClick:a,style:v,children:"Soften"}),o.jsx("button",{onClick:i,style:v,children:"Symmetrize"}),o.jsx("button",{onClick:s,style:v,children:"Invert"}),o.jsx("button",{onClick:c,style:{...v,gridColumn:"span 2"},children:"Normalize"})]})]})},i_="'Doto', monospace",Rp="'IBM Plex Mono', monospace",l2={fontFamily:i_,fontSize:10,color:"rgba(255,255,255,0.50)",letterSpacing:"0.08em",textTransform:"uppercase",paddingBottom:5,borderBottom:"1px dashed rgba(255,255,255,0.05)",marginBottom:6},np={fontFamily:Rp,fontSize:9,cursor:"pointer",transition:"all 0.15s",border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.45)",background:"transparent",textTransform:"uppercase",letterSpacing:"0.06em"},dM=({currentSeed:e,onLoadSeed:t})=>{const[n,r]=S.useState(""),[a,i]=S.useState(!1),[s,c]=S.useState(()=>{try{const f=localStorage.getItem("metalife-saved-seeds");return f?JSON.parse(f):[]}catch{return[]}}),l=async()=>{try{await navigator.clipboard.writeText(e.toString()),i(!0),gr.success("Seed copiado!"),setTimeout(()=>i(!1),2e3)}catch{const f=document.createElement("textarea");f.value=e.toString(),document.body.appendChild(f),f.select();try{document.execCommand("copy"),i(!0),gr.success("Seed copiado!"),setTimeout(()=>i(!1),2e3)}catch{gr.error("Erro ao copiar seed")}document.body.removeChild(f)}},d=()=>{if(s.includes(e)){gr.info("Seed j salvo");return}const f=[...s,e];c(f),localStorage.setItem("metalife-saved-seeds",JSON.stringify(f)),gr.success("Seed salvo!")},u=()=>{const f=parseInt(n);if(isNaN(f)){gr.error("Seed invlido");return}t(f),r(""),gr.success("Seed carregado!")},h=f=>{t(f),gr.success("Seed carregado!")},m=f=>{const g=s.filter(x=>x!==f);c(g),localStorage.setItem("metalife-saved-seeds",JSON.stringify(g)),gr.success("Seed removido")};return o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx("h3",{style:l2,children:"Seed Atual"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("div",{style:{fontFamily:Rp,fontSize:11,color:"rgba(255,255,255,0.55)",padding:"5px 10px",border:"1px dashed rgba(255,255,255,0.06)",flex:1},children:e}),o.jsx("button",{onClick:l,style:{...np,padding:"5px 10px"},children:a?o.jsx(zx,{size:12,style:{color:"#10d45b"}}):o.jsx(Kk,{size:12})}),o.jsx("button",{onClick:d,style:{...np,padding:"5px 10px"},children:"Salvar"})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("h3",{style:l2,children:"Carregar Seed"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("input",{type:"text",value:n,onChange:f=>r(f.target.value),onKeyDown:f=>f.key==="Enter"&&u(),placeholder:"Cole um seed...",className:"flex-1 focus:outline-none",style:{fontFamily:Rp,fontSize:10,color:"rgba(255,255,255,0.55)",padding:"5px 10px",border:"1px dashed rgba(255,255,255,0.06)",background:"transparent"}}),o.jsx("button",{onClick:u,disabled:!n,className:"disabled:opacity-30 disabled:cursor-not-allowed",style:{...np,padding:"5px 10px"},children:"Carregar"})]})]}),s.length>0&&o.jsxs("div",{className:"space-y-2",children:[o.jsx("h3",{style:l2,children:"Seeds Salvos"}),o.jsx("div",{className:"space-y-1 max-h-64 overflow-auto",children:s.map(f=>o.jsxs("div",{className:"flex items-center gap-2 p-2 transition-colors",style:{background:"rgba(255,255,255,0.02)",border:"1px dashed rgba(255,255,255,0.04)"},children:[o.jsx("span",{style:{flex:1,fontFamily:Rp,fontSize:10,color:"rgba(255,255,255,0.45)"},children:f}),o.jsx("button",{onClick:()=>h(f),style:{...np,padding:"3px 8px"},children:"Carregar"}),o.jsx("button",{onClick:()=>m(f),style:{...np,padding:"3px 8px",color:"rgba(255,80,80,0.55)"},children:""})]},f))})]}),o.jsx("div",{style:{paddingTop:8,borderTop:"1px dashed rgba(255,255,255,0.04)"},children:o.jsx("p",{style:{fontFamily:Rp,fontSize:9,color:"rgba(255,255,255,0.22)",lineHeight:1.5},children:"Seeds determinam o universo gerado. Compartilhe seeds para recriar mundos idnticos!"})})]})},l_=(e,t,n,r,a,i,s,c,l,d="Snapshot")=>({version:"1.0",timestamp:Date.now(),name:d,microState:{count:e.count,x:Array.from(e.x.slice(0,e.count)),y:Array.from(e.y.slice(0,e.count)),vx:Array.from(e.vx.slice(0,e.count)),vy:Array.from(e.vy.slice(0,e.count)),type:Array.from(e.type.slice(0,e.count))},microConfig:{...t},matrix:{size:n.size,data:n.data.map(u=>[...u])},baseMatrix:{size:r.size,data:r.data.map(u=>[...u])},fieldState:{width:a.width,height:a.height,tension:Array.from(a.tension),cohesion:Array.from(a.cohesion),scarcity:Array.from(a.scarcity),novelty:Array.from(a.novelty),mythic:Array.from(a.mythic)},fieldConfig:{...i},reconfigState:{artifacts:s.artifacts.map(u=>({...u}))},reconfigConfig:{...c},chronicle:{beats:l.beats.map(u=>({...u}))}}),c_=(e,t,n,r,a,i,s,c,l,d)=>{if(t.count=e.microState.count,t.x.set(e.microState.x),t.y.set(e.microState.y),t.vx.set(e.microState.vx),t.vy.set(e.microState.vy),t.type.set(e.microState.type),t.historyX&&t.historyY){for(let u=0;u<t.historyLength;u++)t.historyX[u].fill(0),t.historyY[u].fill(0);t.historyIndex=0}Object.assign(n,e.microConfig),r.size=e.matrix.size;for(let u=0;u<e.matrix.size;u++)for(let h=0;h<e.matrix.size;h++)r.data[u][h]=e.matrix.data[u][h];if(e.baseMatrix){a.size=e.baseMatrix.size;for(let u=0;u<e.baseMatrix.size;u++)for(let h=0;h<e.baseMatrix.size;h++)a.data[u][h]=e.baseMatrix.data[u][h]}else{a.size=e.matrix.size;for(let u=0;u<e.matrix.size;u++)for(let h=0;h<e.matrix.size;h++)a.data[u][h]=e.matrix.data[u][h]}i.width=e.fieldState.width,i.height=e.fieldState.height,i.tension.set(e.fieldState.tension),i.cohesion.set(e.fieldState.cohesion),i.scarcity.set(e.fieldState.scarcity),i.novelty.set(e.fieldState.novelty),i.mythic.set(e.fieldState.mythic),Object.assign(s,e.fieldConfig),c.artifacts=e.reconfigState.artifacts.map(u=>({...u})),Object.assign(l,e.reconfigConfig),d.beats=e.chronicle.beats.map(u=>({...u}))},d_=e=>{const t=JSON.stringify(e,null,2),n=new Blob([t],{type:"application/json"}),r=URL.createObjectURL(n),a=document.createElement("a");a.href=r,a.download=`particle-life-${e.name.replace(/\s+/g,"-")}-${Date.now()}.json`,a.click(),URL.revokeObjectURL(r)},u_=e=>new Promise((t,n)=>{const r=new FileReader;r.onload=a=>{var i;try{const s=(i=a.target)==null?void 0:i.result,c=JSON.parse(s);if(!c.version||c.version!=="1.0"){n(new Error("Incompatible snapshot version"));return}t(c)}catch(s){n(s)}},r.onerror=()=>n(new Error("Failed to read file")),r.readAsText(e)}),h_=(e,t)=>{try{localStorage.setItem(`particle-life-save-${t}`,JSON.stringify(e))}catch(n){throw console.error("Failed to save to localStorage:",n),new Error("Failed to save (storage full?)")}},f_=e=>{try{const t=localStorage.getItem(`particle-life-save-${e}`);if(!t)return null;const n=JSON.parse(t);return!n.version||n.version!=="1.0"?null:n}catch(t){return console.error("Failed to load from localStorage:",t),null}},uM=()=>{const e=[];for(let t=0;t<10;t++)try{const n=localStorage.getItem(`particle-life-save-${t}`);if(n){const r=JSON.parse(n);e.push({slot:t,name:r.name,timestamp:r.timestamp})}}catch{}return e},p_=e=>{localStorage.removeItem(`particle-life-save-${e}`)};function Fy(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]]);return n}function m_(e,t,n,r){function a(i){return i instanceof n?i:new n(function(s){s(i)})}return new(n||(n=Promise))(function(i,s){function c(u){try{d(r.next(u))}catch(h){s(h)}}function l(u){try{d(r.throw(u))}catch(h){s(h)}}function d(u){u.done?i(u.value):a(u.value).then(c,l)}d((r=r.apply(e,t||[])).next())})}const g_=e=>e?(...t)=>e(...t):(...t)=>fetch(...t);class cS extends Error{constructor(t,n="FunctionsError",r){super(t),this.name=n,this.context=r}}class y_ extends cS{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class hM extends cS{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class fM extends cS{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var qx;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(qx||(qx={}));class b_{constructor(t,{headers:n={},customFetch:r,region:a=qx.Any}={}){this.url=t,this.headers=n,this.region=a,this.fetch=g_(r)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return m_(this,arguments,void 0,function*(n,r={}){var a;let i,s;try{const{headers:c,method:l,body:d,signal:u,timeout:h}=r;let m={},{region:f}=r;f||(f=this.region);const g=new URL(`${this.url}/${n}`);f&&f!=="any"&&(m["x-region"]=f,g.searchParams.set("forceFunctionRegion",f));let x;d&&(c&&!Object.prototype.hasOwnProperty.call(c,"Content-Type")||!c)?typeof Blob<"u"&&d instanceof Blob||d instanceof ArrayBuffer?(m["Content-Type"]="application/octet-stream",x=d):typeof d=="string"?(m["Content-Type"]="text/plain",x=d):typeof FormData<"u"&&d instanceof FormData?x=d:(m["Content-Type"]="application/json",x=JSON.stringify(d)):d&&typeof d!="string"&&!(typeof Blob<"u"&&d instanceof Blob)&&!(d instanceof ArrayBuffer)&&!(typeof FormData<"u"&&d instanceof FormData)?x=JSON.stringify(d):x=d;let v=u;h&&(s=new AbortController,i=setTimeout(()=>s.abort(),h),u?(v=s.signal,u.addEventListener("abort",()=>s.abort())):v=s.signal);const b=yield this.fetch(g.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},m),this.headers),c),body:x,signal:v}).catch(R=>{throw new y_(R)}),w=b.headers.get("x-relay-error");if(w&&w==="true")throw new hM(b);if(!b.ok)throw new fM(b);let M=((a=b.headers.get("Content-Type"))!==null&&a!==void 0?a:"text/plain").split(";")[0].trim(),k;return M==="application/json"?k=yield b.json():M==="application/octet-stream"||M==="application/pdf"?k=yield b.blob():M==="text/event-stream"?k=b:M==="multipart/form-data"?k=yield b.formData():k=yield b.text(),{data:k,error:null,response:b}}catch(c){return{data:null,error:c,response:c instanceof fM||c instanceof hM?c.context:void 0}}finally{i&&clearTimeout(i)}})}}var x_=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}},v_=class{constructor(e){var t,n,r;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=(t=e.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=e.signal,this.isMaybeSingle=(n=e.isMaybeSingle)!==null&&n!==void 0?n:!1,this.urlLengthLimit=(r=e.urlLengthLimit)!==null&&r!==void 0?r:8e3,e.fetch?this.fetch=e.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){var n=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const r=this.fetch;let a=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{let s=null,c=null,l=null,d=i.status,u=i.statusText;if(i.ok){var h,m;if(n.method!=="HEAD"){var f;const b=await i.text();b===""||(n.headers.get("Accept")==="text/csv"||n.headers.get("Accept")&&(!((f=n.headers.get("Accept"))===null||f===void 0)&&f.includes("application/vnd.pgrst.plan+text"))?c=b:c=JSON.parse(b))}const x=(h=n.headers.get("Prefer"))===null||h===void 0?void 0:h.match(/count=(exact|planned|estimated)/),v=(m=i.headers.get("content-range"))===null||m===void 0?void 0:m.split("/");x&&v&&v.length>1&&(l=parseInt(v[1])),n.isMaybeSingle&&n.method==="GET"&&Array.isArray(c)&&(c.length>1?(s={code:"PGRST116",details:`Results contain ${c.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},c=null,l=null,d=406,u="Not Acceptable"):c.length===1?c=c[0]:c=null)}else{var g;const x=await i.text();try{s=JSON.parse(x),Array.isArray(s)&&i.status===404&&(c=[],s=null,d=200,u="OK")}catch{i.status===404&&x===""?(d=204,u="No Content"):s={message:x}}if(s&&n.isMaybeSingle&&(!(s==null||(g=s.details)===null||g===void 0)&&g.includes("0 rows"))&&(s=null,d=200,u="OK"),s&&n.shouldThrowOnError)throw new x_(s)}return{error:s,data:c,count:l,status:d,statusText:u}});return this.shouldThrowOnError||(a=a.catch(i=>{var s;let c="",l="",d="";const u=i==null?void 0:i.cause;if(u){var h,m,f,g;const b=(h=u==null?void 0:u.message)!==null&&h!==void 0?h:"",w=(m=u==null?void 0:u.code)!==null&&m!==void 0?m:"";c=`${(f=i==null?void 0:i.name)!==null&&f!==void 0?f:"FetchError"}: ${i==null?void 0:i.message}`,c+=`

Caused by: ${(g=u==null?void 0:u.name)!==null&&g!==void 0?g:"Error"}: ${b}`,w&&(c+=` (${w})`),u!=null&&u.stack&&(c+=`
${u.stack}`)}else{var x;c=(x=i==null?void 0:i.stack)!==null&&x!==void 0?x:""}const v=this.url.toString().length;return(i==null?void 0:i.name)==="AbortError"||(i==null?void 0:i.code)==="ABORT_ERR"?(d="",l="Request was aborted (timeout or manual cancellation)",v>this.urlLengthLimit&&(l+=`. Note: Your request URL is ${v} characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side.`)):((u==null?void 0:u.name)==="HeadersOverflowError"||(u==null?void 0:u.code)==="UND_ERR_HEADERS_OVERFLOW")&&(d="",l="HTTP headers exceeded server limits (typically 16KB)",v>this.urlLengthLimit&&(l+=`. Your request URL is ${v} characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead.`)),{error:{message:`${(s=i==null?void 0:i.name)!==null&&s!==void 0?s:"FetchError"}: ${i==null?void 0:i.message}`,details:c,hint:l,code:d},data:null,count:null,status:0,statusText:""}})),a.then(e,t)}returns(){return this}overrideTypes(){return this}},S_=class extends v_{select(e){let t=!1;const n=(e??"*").split("").map(r=>/\s/.test(r)&&!t?"":(r==='"'&&(t=!t),r)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:n,foreignTable:r,referencedTable:a=r}={}){const i=a?`${a}.order`:"order",s=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${s?`${s},`:""}${e}.${t?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:n=t}={}){const r=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:n,referencedTable:r=n}={}){const a=typeof r>"u"?"offset":`${r}.offset`,i=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(a,`${e}`),this.url.searchParams.set(i,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:n=!1,buffers:r=!1,wal:a=!1,format:i="text"}={}){var s;const c=[e?"analyze":null,t?"verbose":null,n?"settings":null,r?"buffers":null,a?"wal":null].filter(Boolean).join("|"),l=(s=this.headers.get("Accept"))!==null&&s!==void 0?s:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${l}"; options=${c};`),i==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};const pM=new RegExp("[,()]");var zh=class extends S_{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}regexMatch(e,t){return this.url.searchParams.append(e,`match.${t}`),this}regexIMatch(e,t){return this.url.searchParams.append(e,`imatch.${t}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}isDistinct(e,t){return this.url.searchParams.append(e,`isdistinct.${t}`),this}in(e,t){const n=Array.from(new Set(t)).map(r=>typeof r=="string"&&pM.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(e,`in.(${n})`),this}notIn(e,t){const n=Array.from(new Set(t)).map(r=>typeof r=="string"&&pM.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(e,`not.in.(${n})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:n,type:r}={}){let a="";r==="plain"?a="pl":r==="phrase"?a="ph":r==="websearch"&&(a="w");const i=n===void 0?"":`(${n})`;return this.url.searchParams.append(e,`${a}fts${i}.${t}`),this}match(e){return Object.entries(e).forEach(([t,n])=>{this.url.searchParams.append(t,`eq.${n}`)}),this}not(e,t,n){return this.url.searchParams.append(e,`not.${t}.${n}`),this}or(e,{foreignTable:t,referencedTable:n=t}={}){const r=n?`${n}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,n){return this.url.searchParams.append(e,`${t}.${n}`),this}},w_=class{constructor(e,{headers:t={},schema:n,fetch:r,urlLengthLimit:a=8e3}){this.url=e,this.headers=new Headers(t),this.schema=n,this.fetch=r,this.urlLengthLimit=a}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(e,t){const{head:n=!1,count:r}=t??{},a=n?"HEAD":"GET";let i=!1;const s=(e??"*").split("").map(d=>/\s/.test(d)&&!i?"":(d==='"'&&(i=!i),d)).join(""),{url:c,headers:l}=this.cloneRequestState();return c.searchParams.set("select",s),r&&l.append("Prefer",`count=${r}`),new zh({method:a,url:c,headers:l,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}insert(e,{count:t,defaultToNull:n=!0}={}){var r;const a="POST",{url:i,headers:s}=this.cloneRequestState();if(t&&s.append("Prefer",`count=${t}`),n||s.append("Prefer","missing=default"),Array.isArray(e)){const c=e.reduce((l,d)=>l.concat(Object.keys(d)),[]);if(c.length>0){const l=[...new Set(c)].map(d=>`"${d}"`);i.searchParams.set("columns",l.join(","))}}return new zh({method:a,url:i,headers:s,schema:this.schema,body:e,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch,urlLengthLimit:this.urlLengthLimit})}upsert(e,{onConflict:t,ignoreDuplicates:n=!1,count:r,defaultToNull:a=!0}={}){var i;const s="POST",{url:c,headers:l}=this.cloneRequestState();if(l.append("Prefer",`resolution=${n?"ignore":"merge"}-duplicates`),t!==void 0&&c.searchParams.set("on_conflict",t),r&&l.append("Prefer",`count=${r}`),a||l.append("Prefer","missing=default"),Array.isArray(e)){const d=e.reduce((u,h)=>u.concat(Object.keys(h)),[]);if(d.length>0){const u=[...new Set(d)].map(h=>`"${h}"`);c.searchParams.set("columns",u.join(","))}}return new zh({method:s,url:c,headers:l,schema:this.schema,body:e,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch,urlLengthLimit:this.urlLengthLimit})}update(e,{count:t}={}){var n;const r="PATCH",{url:a,headers:i}=this.cloneRequestState();return t&&i.append("Prefer",`count=${t}`),new zh({method:r,url:a,headers:i,schema:this.schema,body:e,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch,urlLengthLimit:this.urlLengthLimit})}delete({count:e}={}){var t;const n="DELETE",{url:r,headers:a}=this.cloneRequestState();return e&&a.append("Prefer",`count=${e}`),new zh({method:n,url:r,headers:a,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch,urlLengthLimit:this.urlLengthLimit})}};function Zp(e){"@babel/helpers - typeof";return Zp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zp(e)}function M_(e,t){if(Zp(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(Zp(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function C_(e){var t=M_(e,"string");return Zp(t)=="symbol"?t:t+""}function k_(e,t,n){return(t=C_(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function mM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function pg(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?mM(Object(n),!0).forEach(function(r){k_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mM(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var R_=class lR{constructor(t,{headers:n={},schema:r,fetch:a,timeout:i,urlLengthLimit:s=8e3}={}){this.url=t,this.headers=new Headers(n),this.schemaName=r,this.urlLengthLimit=s;const c=a??globalThis.fetch;i!==void 0&&i>0?this.fetch=(l,d)=>{const u=new AbortController,h=setTimeout(()=>u.abort(),i),m=d==null?void 0:d.signal;if(m){if(m.aborted)return clearTimeout(h),c(l,d);const f=()=>{clearTimeout(h),u.abort()};return m.addEventListener("abort",f,{once:!0}),c(l,pg(pg({},d),{},{signal:u.signal})).finally(()=>{clearTimeout(h),m.removeEventListener("abort",f)})}return c(l,pg(pg({},d),{},{signal:u.signal})).finally(()=>clearTimeout(h))}:this.fetch=c}from(t){if(!t||typeof t!="string"||t.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new w_(new URL(`${this.url}/${t}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}schema(t){return new lR(this.url,{headers:this.headers,schema:t,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}rpc(t,n={},{head:r=!1,get:a=!1,count:i}={}){var s;let c;const l=new URL(`${this.url}/rpc/${t}`);let d;const u=f=>f!==null&&typeof f=="object"&&(!Array.isArray(f)||f.some(u)),h=r&&Object.values(n).some(u);h?(c="POST",d=n):r||a?(c=r?"HEAD":"GET",Object.entries(n).filter(([f,g])=>g!==void 0).map(([f,g])=>[f,Array.isArray(g)?`{${g.join(",")}}`:`${g}`]).forEach(([f,g])=>{l.searchParams.append(f,g)})):(c="POST",d=n);const m=new Headers(this.headers);return h?m.set("Prefer",i?`count=${i},return=minimal`:"return=minimal"):i&&m.set("Prefer",`count=${i}`),new zh({method:c,url:l,headers:m,schema:this.schemaName,body:d,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch,urlLengthLimit:this.urlLengthLimit})}};class A_{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const n=globalThis.process;if(n){const r=n.versions;if(r&&r.node){const a=r.node,i=parseInt(a.replace(/^v/,"").split(".")[0]);return i>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${i} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${i} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let n=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(n+=`

Suggested solution: ${t.workaround}`),new Error(n)}static createWebSocket(t,n){const r=this.getWebSocketConstructor();return new r(t,n)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const j_="2.98.0",E_=`realtime-js/${j_}`,T_="1.0.0",cR="2.0.0",gM=cR,Hx=1e4,I_=1e3,P_=100;var u0;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(u0||(u0={}));var ds;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(ds||(ds={}));var Zl;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(Zl||(Zl={}));var Wx;(function(e){e.websocket="websocket"})(Wx||(Wx={}));var fu;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(fu||(fu={}));class F_{constructor(t){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=t??[]}encode(t,n){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return n(this._binaryEncodeUserBroadcastPush(t));let r=[t.join_ref,t.ref,t.topic,t.event,t.payload];return n(JSON.stringify(r))}_binaryEncodeUserBroadcastPush(t){var n;return this._isArrayBuffer((n=t.payload)===null||n===void 0?void 0:n.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var n,r;const a=(r=(n=t.payload)===null||n===void 0?void 0:n.payload)!==null&&r!==void 0?r:new ArrayBuffer(0);return this._encodeUserBroadcastPush(t,this.BINARY_ENCODING,a)}_encodeJsonUserBroadcastPush(t){var n,r;const a=(r=(n=t.payload)===null||n===void 0?void 0:n.payload)!==null&&r!==void 0?r:{},s=new TextEncoder().encode(JSON.stringify(a)).buffer;return this._encodeUserBroadcastPush(t,this.JSON_ENCODING,s)}_encodeUserBroadcastPush(t,n,r){var a,i;const s=t.topic,c=(a=t.ref)!==null&&a!==void 0?a:"",l=(i=t.join_ref)!==null&&i!==void 0?i:"",d=t.payload.event,u=this.allowedMetadataKeys?this._pick(t.payload,this.allowedMetadataKeys):{},h=Object.keys(u).length===0?"":JSON.stringify(u);if(l.length>255)throw new Error(`joinRef length ${l.length} exceeds maximum of 255`);if(c.length>255)throw new Error(`ref length ${c.length} exceeds maximum of 255`);if(s.length>255)throw new Error(`topic length ${s.length} exceeds maximum of 255`);if(d.length>255)throw new Error(`userEvent length ${d.length} exceeds maximum of 255`);if(h.length>255)throw new Error(`metadata length ${h.length} exceeds maximum of 255`);const m=this.USER_BROADCAST_PUSH_META_LENGTH+l.length+c.length+s.length+d.length+h.length,f=new ArrayBuffer(this.HEADER_LENGTH+m);let g=new DataView(f),x=0;g.setUint8(x++,this.KINDS.userBroadcastPush),g.setUint8(x++,l.length),g.setUint8(x++,c.length),g.setUint8(x++,s.length),g.setUint8(x++,d.length),g.setUint8(x++,h.length),g.setUint8(x++,n),Array.from(l,b=>g.setUint8(x++,b.charCodeAt(0))),Array.from(c,b=>g.setUint8(x++,b.charCodeAt(0))),Array.from(s,b=>g.setUint8(x++,b.charCodeAt(0))),Array.from(d,b=>g.setUint8(x++,b.charCodeAt(0))),Array.from(h,b=>g.setUint8(x++,b.charCodeAt(0)));var v=new Uint8Array(f.byteLength+r.byteLength);return v.set(new Uint8Array(f),0),v.set(new Uint8Array(r),f.byteLength),v.buffer}decode(t,n){if(this._isArrayBuffer(t)){let r=this._binaryDecode(t);return n(r)}if(typeof t=="string"){const r=JSON.parse(t),[a,i,s,c,l]=r;return n({join_ref:a,ref:i,topic:s,event:c,payload:l})}return n({})}_binaryDecode(t){const n=new DataView(t),r=n.getUint8(0),a=new TextDecoder;switch(r){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(t,n,a)}}_decodeUserBroadcast(t,n,r){const a=n.getUint8(1),i=n.getUint8(2),s=n.getUint8(3),c=n.getUint8(4);let l=this.HEADER_LENGTH+4;const d=r.decode(t.slice(l,l+a));l=l+a;const u=r.decode(t.slice(l,l+i));l=l+i;const h=r.decode(t.slice(l,l+s));l=l+s;const m=t.slice(l,t.byteLength),f=c===this.JSON_ENCODING?JSON.parse(r.decode(m)):m,g={type:this.BROADCAST_EVENT,event:u,payload:f};return s>0&&(g.meta=JSON.parse(h)),{join_ref:null,ref:null,topic:d,event:this.BROADCAST_EVENT,payload:g}}_isArrayBuffer(t){var n;return t instanceof ArrayBuffer||((n=t==null?void 0:t.constructor)===null||n===void 0?void 0:n.name)==="ArrayBuffer"}_pick(t,n){return!t||typeof t!="object"?{}:Object.fromEntries(Object.entries(t).filter(([r])=>n.includes(r)))}}class dR{constructor(t,n){this.callback=t,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var ta;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(ta||(ta={}));const yM=(e,t,n={})=>{var r;const a=(r=n.skipTypes)!==null&&r!==void 0?r:[];return t?Object.keys(t).reduce((i,s)=>(i[s]=__(s,e,t,a),i),{}):{}},__=(e,t,n,r)=>{const a=t.find(c=>c.name===e),i=a==null?void 0:a.type,s=n[e];return i&&!r.includes(i)?uR(i,s):Gx(s)},uR=(e,t)=>{if(e.charAt(0)==="_"){const n=e.slice(1,e.length);return L_(t,n)}switch(e){case ta.bool:return N_(t);case ta.float4:case ta.float8:case ta.int2:case ta.int4:case ta.int8:case ta.numeric:case ta.oid:return O_(t);case ta.json:case ta.jsonb:return D_(t);case ta.timestamp:return z_(t);case ta.abstime:case ta.date:case ta.daterange:case ta.int4range:case ta.int8range:case ta.money:case ta.reltime:case ta.text:case ta.time:case ta.timestamptz:case ta.timetz:case ta.tsrange:case ta.tstzrange:return Gx(t);default:return Gx(t)}},Gx=e=>e,N_=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},O_=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},D_=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e},L_=(e,t)=>{if(typeof e!="string")return e;const n=e.length-1,r=e[n];if(e[0]==="{"&&r==="}"){let i;const s=e.slice(1,n);try{i=JSON.parse("["+s+"]")}catch{i=s?s.split(","):[]}return i.map(c=>uR(t,c))}return e},z_=e=>typeof e=="string"?e.replace(" ","T"):e,hR=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class c2{constructor(t,n,r={},a=Hx){this.channel=t,this.event=n,this.payload=r,this.timeout=a,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,n){var r;return this._hasReceived(t)&&n((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:t,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:n}){this.recHooks.filter(r=>r.status===t).forEach(r=>r.callback(n))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var bM;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(bM||(bM={}));class Dp{constructor(t,n){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(n==null?void 0:n.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},a=>{const{onJoin:i,onLeave:s,onSync:c}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Dp.syncState(this.state,a,i,s),this.pendingDiffs.forEach(l=>{this.state=Dp.syncDiff(this.state,l,i,s)}),this.pendingDiffs=[],c()}),this.channel._on(r.diff,{},a=>{const{onJoin:i,onLeave:s,onSync:c}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(a):(this.state=Dp.syncDiff(this.state,a,i,s),c())}),this.onJoin((a,i,s)=>{this.channel._trigger("presence",{event:"join",key:a,currentPresences:i,newPresences:s})}),this.onLeave((a,i,s)=>{this.channel._trigger("presence",{event:"leave",key:a,currentPresences:i,leftPresences:s})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,n,r,a){const i=this.cloneDeep(t),s=this.transformState(n),c={},l={};return this.map(i,(d,u)=>{s[d]||(l[d]=u)}),this.map(s,(d,u)=>{const h=i[d];if(h){const m=u.map(v=>v.presence_ref),f=h.map(v=>v.presence_ref),g=u.filter(v=>f.indexOf(v.presence_ref)<0),x=h.filter(v=>m.indexOf(v.presence_ref)<0);g.length>0&&(c[d]=g),x.length>0&&(l[d]=x)}else c[d]=u}),this.syncDiff(i,{joins:c,leaves:l},r,a)}static syncDiff(t,n,r,a){const{joins:i,leaves:s}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return r||(r=()=>{}),a||(a=()=>{}),this.map(i,(c,l)=>{var d;const u=(d=t[c])!==null&&d!==void 0?d:[];if(t[c]=this.cloneDeep(l),u.length>0){const h=t[c].map(f=>f.presence_ref),m=u.filter(f=>h.indexOf(f.presence_ref)<0);t[c].unshift(...m)}r(c,u,l)}),this.map(s,(c,l)=>{let d=t[c];if(!d)return;const u=l.map(h=>h.presence_ref);d=d.filter(h=>u.indexOf(h.presence_ref)<0),t[c]=d,a(c,d,l),d.length===0&&delete t[c]}),t}static map(t,n){return Object.getOwnPropertyNames(t).map(r=>n(r,t[r]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((n,r)=>{const a=t[r];return"metas"in a?n[r]=a.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):n[r]=a,n},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var xM;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(xM||(xM={}));var Lp;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(Lp||(Lp={}));var sd;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(sd||(sd={}));class Kh{constructor(t,n={config:{}},r){var a,i;if(this.topic=t,this.params=n,this.socket=r,this.bindings={},this.state=ds.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new c2(this,Zl.join,this.params,this.timeout),this.rejoinTimer=new dR(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=ds.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=ds.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=ds.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=ds.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=ds.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Zl.reply,{},(s,c)=>{this._trigger(this._replyEventName(c),s)}),this.presence=new Dp(this),this.broadcastEndpointURL=hR(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(a=this.params.config)===null||a===void 0?void 0:a.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,n=this.timeout){var r,a,i;if(this.socket.isConnected()||this.socket.connect(),this.state==ds.closed){const{config:{broadcast:s,presence:c,private:l}}=this.params,d=(a=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(f=>f.filter))!==null&&a!==void 0?a:[],u=!!this.bindings[Lp.PRESENCE]&&this.bindings[Lp.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,h={},m={broadcast:s,presence:Object.assign(Object.assign({},c),{enabled:u}),postgres_changes:d,private:l};this.socket.accessTokenValue&&(h.access_token=this.socket.accessTokenValue),this._onError(f=>t==null?void 0:t(sd.CHANNEL_ERROR,f)),this._onClose(()=>t==null?void 0:t(sd.CLOSED)),this.updateJoinPayload(Object.assign({config:m},h)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:f})=>{var g;if(this.socket._isManualToken()||this.socket.setAuth(),f===void 0){t==null||t(sd.SUBSCRIBED);return}else{const x=this.bindings.postgres_changes,v=(g=x==null?void 0:x.length)!==null&&g!==void 0?g:0,b=[];for(let w=0;w<v;w++){const M=x[w],{filter:{event:k,schema:R,table:j,filter:I}}=M,E=f&&f[w];if(E&&E.event===k&&Kh.isFilterValueEqual(E.schema,R)&&Kh.isFilterValueEqual(E.table,j)&&Kh.isFilterValueEqual(E.filter,I))b.push(Object.assign(Object.assign({},M),{id:E.id}));else{this.unsubscribe(),this.state=ds.errored,t==null||t(sd.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=b,t&&t(sd.SUBSCRIBED);return}}).receive("error",f=>{this.state=ds.errored,t==null||t(sd.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(f).join(", ")||"error")))}).receive("timeout",()=>{t==null||t(sd.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,n={}){return await this.send({type:"presence",event:"track",payload:t},n.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,n,r){return this.state===ds.joined&&t===Lp.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(t,n,r)}async httpSend(t,n,r={}){var a;if(n==null)return Promise.reject("Payload is required for httpSend()");const i={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(i.Authorization=`Bearer ${this.socket.accessTokenValue}`);const s={method:"POST",headers:i,body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:n,private:this.private}]})},c=await this._fetchWithTimeout(this.broadcastEndpointURL,s,(a=r.timeout)!==null&&a!==void 0?a:this.timeout);if(c.status===202)return{success:!0};let l=c.statusText;try{const d=await c.json();l=d.error||d.message||l}catch{}return Promise.reject(new Error(l))}async send(t,n={}){var r,a;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:s}=t,c={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(c.Authorization=`Bearer ${this.socket.accessTokenValue}`);const l={method:"POST",headers:c,body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:s,private:this.private}]})};try{const d=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=n.timeout)!==null&&r!==void 0?r:this.timeout);return await((a=d.body)===null||a===void 0?void 0:a.cancel()),d.ok?"ok":"error"}catch(d){return d.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var s,c,l;const d=this._push(t.type,t,n.timeout||this.timeout);t.type==="broadcast"&&!(!((l=(c=(s=this.params)===null||s===void 0?void 0:s.config)===null||c===void 0?void 0:c.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),d.receive("ok",()=>i("ok")),d.receive("error",()=>i("error")),d.receive("timeout",()=>i("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=ds.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Zl.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(a=>{r=new c2(this,Zl.leave,{},t),r.receive("ok",()=>{n(),a("ok")}).receive("timeout",()=>{n(),a("timed out")}).receive("error",()=>{a("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=ds.closed,this.bindings={}}async _fetchWithTimeout(t,n,r){const a=new AbortController,i=setTimeout(()=>a.abort(),r),s=await this.socket.fetch(t,Object.assign(Object.assign({},n),{signal:a.signal}));return clearTimeout(i),s}_push(t,n,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let a=new c2(this,t,n,r);return this._canPush()?a.send():this._addToPushBuffer(a),a}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>P_){const n=this.pushBuffer.shift();n&&(n.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${n.event}`,n.payload))}}_onMessage(t,n,r){return n}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,n,r){var a,i;const s=t.toLocaleLowerCase(),{close:c,error:l,leave:d,join:u}=Zl;if(r&&[c,l,d,u].indexOf(s)>=0&&r!==this._joinRef())return;let m=this._onMessage(s,n,r);if(n&&!m)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(s)?(a=this.bindings.postgres_changes)===null||a===void 0||a.filter(f=>{var g,x,v;return((g=f.filter)===null||g===void 0?void 0:g.event)==="*"||((v=(x=f.filter)===null||x===void 0?void 0:x.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===s}).map(f=>f.callback(m,r)):(i=this.bindings[s])===null||i===void 0||i.filter(f=>{var g,x,v,b,w,M;if(["broadcast","presence","postgres_changes"].includes(s))if("id"in f){const k=f.id,R=(g=f.filter)===null||g===void 0?void 0:g.event;return k&&((x=n.ids)===null||x===void 0?void 0:x.includes(k))&&(R==="*"||(R==null?void 0:R.toLocaleLowerCase())===((v=n.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const k=(w=(b=f==null?void 0:f.filter)===null||b===void 0?void 0:b.event)===null||w===void 0?void 0:w.toLocaleLowerCase();return k==="*"||k===((M=n==null?void 0:n.event)===null||M===void 0?void 0:M.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===s}).map(f=>{if(typeof m=="object"&&"ids"in m){const g=m.data,{schema:x,table:v,commit_timestamp:b,type:w,errors:M}=g;m=Object.assign(Object.assign({},{schema:x,table:v,commit_timestamp:b,eventType:w,new:{},old:{},errors:M}),this._getPayloadRecords(g))}f.callback(m,r)})}_isClosed(){return this.state===ds.closed}_isJoined(){return this.state===ds.joined}_isJoining(){return this.state===ds.joining}_isLeaving(){return this.state===ds.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,n,r){const a=t.toLocaleLowerCase(),i={type:a,filter:n,callback:r};return this.bindings[a]?this.bindings[a].push(i):this.bindings[a]=[i],this}_off(t,n){const r=t.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(a=>{var i;return!(((i=a.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&Kh.isEqual(a.filter,n))})),this}static isEqual(t,n){if(Object.keys(t).length!==Object.keys(n).length)return!1;for(const r in t)if(t[r]!==n[r])return!1;return!0}static isFilterValueEqual(t,n){return(t??void 0)===(n??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(Zl.close,{},t)}_onError(t){this._on(Zl.error,{},n=>t(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=ds.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const n={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(n.new=yM(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(n.old=yM(t.columns,t.old_record)),n}}const d2=()=>{},mg={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},B_=[1e3,2e3,5e3,1e4],$_=1e4,q_=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class H_{constructor(t,n){var r;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Hx,this.transport=null,this.heartbeatIntervalMs=mg.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=d2,this.ref=0,this.reconnectTimer=null,this.vsn=gM,this.logger=d2,this.conn=null,this.sendBuffer=[],this.serializer=new F_,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=a=>a?(...i)=>a(...i):(...i)=>fetch(...i),!(!((r=n==null?void 0:n.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=n.params.apikey,this.endPoint=`${t}/${Wx.websocket}`,this.httpEndpoint=hR(t),this._initializeOptions(n),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(n==null?void 0:n.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=A_.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const n=t.message;throw n.includes("Node.js")?new Error(`${n}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${n}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,n){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,n??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const n=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const t=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,n,r){this.logger(t,n,r)}connectionState(){switch(this.conn&&this.conn.readyState){case u0.connecting:return fu.Connecting;case u0.open:return fu.Open;case u0.closing:return fu.Closing;default:return fu.Closed}}isConnected(){return this.connectionState()===fu.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,n={config:{}}){const r=`realtime:${t}`,a=this.getChannels().find(i=>i.topic===r);if(a)return a;{const i=new Kh(`realtime:${t}`,n,this);return this.channels.push(i),i}}push(t){const{topic:n,event:r,payload:a,ref:i}=t,s=()=>{this.encode(t,c=>{var l;(l=this.conn)===null||l===void 0||l.send(c)})};this.log("push",`${n} ${r} (${i})`,a),this.isConnected()?s():this.sendBuffer.push(s)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(n){this.log("error","error in heartbeat callback",n)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(n){this.log("error","error in heartbeat callback",n)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(I_,"heartbeat timeout"),setTimeout(()=>{var n;this.isConnected()||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout()},mg.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(n){this.log("error","error in heartbeat callback",n)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let n=this.channels.find(r=>r.topic===t&&(r._isJoined()||r._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${t}"`),n.unsubscribe())}_remove(t){this.channels=this.channels.filter(n=>n.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,n=>{if(n.topic==="phoenix"&&n.event==="phx_reply"&&n.ref&&n.ref===this.pendingHeartbeatRef){const d=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(n.payload.status==="ok"?"ok":"error",d)}catch(u){this.log("error","error in heartbeat callback",u)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:r,event:a,payload:i,ref:s}=n,c=s?`(${s})`:"",l=i.status||"";this.log("receive",`${l} ${r} ${a} ${c}`.trim(),i),this.channels.filter(d=>d._isMember(r)).forEach(d=>d._trigger(a,i,s)),this._triggerStateCallbacks("message",n)})}_clearTimer(t){var n;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((n=this.reconnectTimer)===null||n===void 0||n.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t),this.conn.readyState===u0.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===u0.open||this.conn.readyState===u0.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.accessTokenValue&&(this.channels.forEach(n=>{n.updateJoinPayload({access_token:this.accessTokenValue})}),this.sendBuffer=[],this.channels.forEach(n=>{n._isJoining()&&(n.joinPush.sent=!1,n.joinPush.send())})),this.flushSendBuffer()}).catch(n=>{this.log("error","error waiting for auth on connect",n),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this._terminateWorker()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(t){var n;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t);try{this.heartbeatCallback("error")}catch(n){this.log("error","error in heartbeat callback",n)}}_triggerChanError(){this.channels.forEach(t=>t._trigger(Zl.error))}_appendParams(t,n){if(Object.keys(n).length===0)return t;const r=t.match(/\?/)?"&":"?",a=new URLSearchParams(n);return`${t}${r}${a}`}_workerObjectUrl(t){let n;if(t)n=t;else{const r=new Blob([q_],{type:"application/javascript"});n=URL.createObjectURL(r)}return n}_setConnectionState(t,n=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=n)}async _performAuth(t=null){let n,r=!1;if(t)n=t,r=!0;else if(this.accessToken)try{n=await this.accessToken()}catch(a){this.log("error","Error fetching access token from callback",a),n=this.accessTokenValue}else n=this.accessTokenValue;r?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(a=>{const i={access_token:n,version:E_};n&&a.updateJoinPayload(i),a.joinedOnce&&a._isJoined()&&a._push(Zl.access_token,{access_token:n})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this._isManualToken()||this.setAuth().catch(n=>{this.log("error",`Error setting auth in ${t}`,n)})}_triggerStateCallbacks(t,n){try{this.stateChangeCallbacks[t].forEach(r=>{try{r(n)}catch(a){this.log("error",`error in ${t} callback`,a)}})}catch(r){this.log("error",`error triggering ${t} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new dR(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},mg.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var n,r,a,i,s,c,l,d,u,h,m,f;switch(this.transport=(n=t==null?void 0:t.transport)!==null&&n!==void 0?n:null,this.timeout=(r=t==null?void 0:t.timeout)!==null&&r!==void 0?r:Hx,this.heartbeatIntervalMs=(a=t==null?void 0:t.heartbeatIntervalMs)!==null&&a!==void 0?a:mg.HEARTBEAT_INTERVAL,this.worker=(i=t==null?void 0:t.worker)!==null&&i!==void 0?i:!1,this.accessToken=(s=t==null?void 0:t.accessToken)!==null&&s!==void 0?s:null,this.heartbeatCallback=(c=t==null?void 0:t.heartbeatCallback)!==null&&c!==void 0?c:d2,this.vsn=(l=t==null?void 0:t.vsn)!==null&&l!==void 0?l:gM,t!=null&&t.params&&(this.params=t.params),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(d=t==null?void 0:t.reconnectAfterMs)!==null&&d!==void 0?d:(g=>B_[g-1]||$_),this.vsn){case T_:this.encode=(u=t==null?void 0:t.encode)!==null&&u!==void 0?u:((g,x)=>x(JSON.stringify(g))),this.decode=(h=t==null?void 0:t.decode)!==null&&h!==void 0?h:((g,x)=>x(JSON.parse(g)));break;case cR:this.encode=(m=t==null?void 0:t.encode)!==null&&m!==void 0?m:this.serializer.encode.bind(this.serializer),this.decode=(f=t==null?void 0:t.decode)!==null&&f!==void 0?f:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t==null?void 0:t.workerUrl}}}var em=class extends Error{constructor(e,t){var n;super(e),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown=t.icebergType==="CommitStateUnknownException"||[500,502,504].includes(t.status)&&((n=t.icebergType)==null?void 0:n.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function W_(e,t,n){const r=new URL(t,e);if(n)for(const[a,i]of Object.entries(n))i!==void 0&&r.searchParams.set(a,i);return r.toString()}async function G_(e){return!e||e.type==="none"?{}:e.type==="bearer"?{Authorization:`Bearer ${e.token}`}:e.type==="header"?{[e.name]:e.value}:e.type==="custom"?await e.getHeaders():{}}function V_(e){const t=e.fetchImpl??globalThis.fetch;return{async request({method:n,path:r,query:a,body:i,headers:s}){const c=W_(e.baseUrl,r,a),l=await G_(e.auth),d=await t(c,{method:n,headers:{...i?{"Content-Type":"application/json"}:{},...l,...s},body:i?JSON.stringify(i):void 0}),u=await d.text(),h=(d.headers.get("content-type")||"").includes("application/json"),m=h&&u?JSON.parse(u):u;if(!d.ok){const f=h?m:void 0,g=f==null?void 0:f.error;throw new em((g==null?void 0:g.message)??`Request failed with status ${d.status}`,{status:d.status,icebergType:g==null?void 0:g.type,icebergCode:g==null?void 0:g.code,details:f})}return{status:d.status,headers:d.headers,data:m}}}}function gg(e){return e.join("")}var U_=class{constructor(e,t=""){this.client=e,this.prefix=t}async listNamespaces(e){const t=e?{parent:gg(e.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(r=>({namespace:r}))}async createNamespace(e,t){const n={namespace:e.namespace,properties:t==null?void 0:t.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:n})).data}async dropNamespace(e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${gg(e.namespace)}`})}async loadNamespaceMetadata(e){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${gg(e.namespace)}`})).data.properties}}async namespaceExists(e){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${gg(e.namespace)}`}),!0}catch(t){if(t instanceof em&&t.status===404)return!1;throw t}}async createNamespaceIfNotExists(e,t){try{return await this.createNamespace(e,t)}catch(n){if(n instanceof em&&n.status===409)return;throw n}}};function lh(e){return e.join("")}var Y_=class{constructor(e,t="",n){this.client=e,this.prefix=t,this.accessDelegation=n}async listTables(e){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${lh(e.namespace)}/tables`})).data.identifiers}async createTable(e,t){const n={};return this.accessDelegation&&(n["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${lh(e.namespace)}/tables`,body:t,headers:n})).data.metadata}async updateTable(e,t){const n=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${lh(e.namespace)}/tables/${e.name}`,body:t});return{"metadata-location":n.data["metadata-location"],metadata:n.data.metadata}}async dropTable(e,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${lh(e.namespace)}/tables/${e.name}`,query:{purgeRequested:String((t==null?void 0:t.purge)??!1)}})}async loadTable(e){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${lh(e.namespace)}/tables/${e.name}`,headers:t})).data.metadata}async tableExists(e){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${lh(e.namespace)}/tables/${e.name}`,headers:t}),!0}catch(n){if(n instanceof em&&n.status===404)return!1;throw n}}async createTableIfNotExists(e,t){try{return await this.createTable(e,t)}catch(n){if(n instanceof em&&n.status===409)return await this.loadTable({namespace:e.namespace,name:t.name});throw n}}},K_=class{constructor(e){var r;let t="v1";e.catalogName&&(t+=`/${e.catalogName}`);const n=e.baseUrl.endsWith("/")?e.baseUrl:`${e.baseUrl}/`;this.client=V_({baseUrl:n,auth:e.auth,fetchImpl:e.fetch}),this.accessDelegation=(r=e.accessDelegation)==null?void 0:r.join(","),this.namespaceOps=new U_(this.client,t),this.tableOps=new Y_(this.client,t,this.accessDelegation)}async listNamespaces(e){return this.namespaceOps.listNamespaces(e)}async createNamespace(e,t){return this.namespaceOps.createNamespace(e,t)}async dropNamespace(e){await this.namespaceOps.dropNamespace(e)}async loadNamespaceMetadata(e){return this.namespaceOps.loadNamespaceMetadata(e)}async listTables(e){return this.tableOps.listTables(e)}async createTable(e,t){return this.tableOps.createTable(e,t)}async updateTable(e,t){return this.tableOps.updateTable(e,t)}async dropTable(e,t){await this.tableOps.dropTable(e,t)}async loadTable(e){return this.tableOps.loadTable(e)}async namespaceExists(e){return this.namespaceOps.namespaceExists(e)}async tableExists(e){return this.tableOps.tableExists(e)}async createNamespaceIfNotExists(e,t){return this.namespaceOps.createNamespaceIfNotExists(e,t)}async createTableIfNotExists(e,t){return this.tableOps.createTableIfNotExists(e,t)}},_y=class extends Error{constructor(e,t="storage",n,r){super(e),this.__isStorageError=!0,this.namespace=t,this.name=t==="vectors"?"StorageVectorsError":"StorageError",this.status=n,this.statusCode=r}};function Ny(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}var yg=class extends _y{constructor(e,t,n,r="storage"){super(e,r,t,n),this.name=r==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=t,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},fR=class extends _y{constructor(e,t,n="storage"){super(e,n),this.name=n==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=t}};const X_=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),J_=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},Vx=e=>{if(Array.isArray(e))return e.map(n=>Vx(n));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([n,r])=>{const a=n.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));t[a]=Vx(r)}),t},Q_=e=>!e||typeof e!="string"||e.length===0||e.length>100||e.trim()!==e||e.includes("/")||e.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(e);function tm(e){"@babel/helpers - typeof";return tm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tm(e)}function Z_(e,t){if(tm(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(tm(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function eN(e){var t=Z_(e,"string");return tm(t)=="symbol"?t:t+""}function tN(e,t,n){return(t=eN(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function vM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function kr(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?vM(Object(n),!0).forEach(function(r){tN(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vM(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const SM=e=>{var t;return e.msg||e.message||e.error_description||(typeof e.error=="string"?e.error:(t=e.error)===null||t===void 0?void 0:t.message)||JSON.stringify(e)},nN=async(e,t,n,r)=>{if(e&&typeof e=="object"&&"status"in e&&"ok"in e&&typeof e.status=="number"&&!(n!=null&&n.noResolveJson)){const a=e,i=a.status||500;if(typeof a.json=="function")a.json().then(s=>{const c=(s==null?void 0:s.statusCode)||(s==null?void 0:s.code)||i+"";t(new yg(SM(s),i,c,r))}).catch(()=>{if(r==="vectors"){const s=i+"";t(new yg(a.statusText||`HTTP ${i} error`,i,s,r))}else{const s=i+"";t(new yg(a.statusText||`HTTP ${i} error`,i,s,r))}});else{const s=i+"";t(new yg(a.statusText||`HTTP ${i} error`,i,s,r))}}else t(new fR(SM(e),e,r))},rN=(e,t,n,r)=>{const a={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"||e==="HEAD"||!r?kr(kr({},a),n):(J_(r)?(a.headers=kr({"Content-Type":"application/json"},t==null?void 0:t.headers),a.body=JSON.stringify(r)):a.body=r,t!=null&&t.duplex&&(a.duplex=t.duplex),kr(kr({},a),n))};async function rp(e,t,n,r,a,i,s){return new Promise((c,l)=>{e(n,rN(t,r,a,i)).then(d=>{if(!d.ok)throw d;if(r!=null&&r.noResolveJson)return d;if(s==="vectors"){const u=d.headers.get("content-type");if(d.headers.get("content-length")==="0"||d.status===204)return{};if(!u||!u.includes("application/json"))return{}}return d.json()}).then(d=>c(d)).catch(d=>nN(d,l,r,s))})}function pR(e="storage"){return{get:async(t,n,r,a)=>rp(t,"GET",n,r,a,void 0,e),post:async(t,n,r,a,i)=>rp(t,"POST",n,a,i,r,e),put:async(t,n,r,a,i)=>rp(t,"PUT",n,a,i,r,e),head:async(t,n,r,a)=>rp(t,"HEAD",n,kr(kr({},r),{},{noResolveJson:!0}),a,void 0,e),remove:async(t,n,r,a,i)=>rp(t,"DELETE",n,a,i,r,e)}}const oN=pR("storage"),{get:nm,post:Ql,put:Ux,head:aN,remove:dS}=oN,sl=pR("vectors");var If=class{constructor(e,t={},n,r="storage"){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.fetch=X_(n),this.namespace=r}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=kr(kr({},this.headers),{},{[e]:t}),this}async handleOperation(e){var t=this;try{return{data:await e(),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(Ny(n))return{data:null,error:n};throw n}}},sN=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}async execute(){var e=this;try{return{data:(await e.downloadFn()).body,error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Ny(t))return{data:null,error:t};throw t}}};let mR;mR=Symbol.toStringTag;var iN=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[mR]="BlobDownloadBuilder",this.promise=null}asStream(){return new sN(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var e=this;try{return{data:await(await e.downloadFn()).blob(),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Ny(t))return{data:null,error:t};throw t}}};const lN={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},wM={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var cN=class extends If{constructor(e,t={},n,r){super(e,t,r,"storage"),this.bucketId=n}async uploadOrUpdate(e,t,n,r){var a=this;return a.handleOperation(async()=>{let i;const s=kr(kr({},wM),r);let c=kr(kr({},a.headers),e==="POST"&&{"x-upsert":String(s.upsert)});const l=s.metadata;typeof Blob<"u"&&n instanceof Blob?(i=new FormData,i.append("cacheControl",s.cacheControl),l&&i.append("metadata",a.encodeMetadata(l)),i.append("",n)):typeof FormData<"u"&&n instanceof FormData?(i=n,i.has("cacheControl")||i.append("cacheControl",s.cacheControl),l&&!i.has("metadata")&&i.append("metadata",a.encodeMetadata(l))):(i=n,c["cache-control"]=`max-age=${s.cacheControl}`,c["content-type"]=s.contentType,l&&(c["x-metadata"]=a.toBase64(a.encodeMetadata(l))),(typeof ReadableStream<"u"&&i instanceof ReadableStream||i&&typeof i=="object"&&"pipe"in i&&typeof i.pipe=="function")&&!s.duplex&&(s.duplex="half")),r!=null&&r.headers&&(c=kr(kr({},c),r.headers));const d=a._removeEmptyFolders(t),u=a._getFinalPath(d),h=await(e=="PUT"?Ux:Ql)(a.fetch,`${a.url}/object/${u}`,i,kr({headers:c},s!=null&&s.duplex?{duplex:s.duplex}:{}));return{path:d,id:h.Id,fullPath:h.Key}})}async upload(e,t,n){return this.uploadOrUpdate("POST",e,t,n)}async uploadToSignedUrl(e,t,n,r){var a=this;const i=a._removeEmptyFolders(e),s=a._getFinalPath(i),c=new URL(a.url+`/object/upload/sign/${s}`);return c.searchParams.set("token",t),a.handleOperation(async()=>{let l;const d=kr({upsert:wM.upsert},r),u=kr(kr({},a.headers),{"x-upsert":String(d.upsert)});return typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",d.cacheControl),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.append("cacheControl",d.cacheControl)):(l=n,u["cache-control"]=`max-age=${d.cacheControl}`,u["content-type"]=d.contentType),{path:i,fullPath:(await Ux(a.fetch,c.toString(),l,{headers:u})).Key}})}async createSignedUploadUrl(e,t){var n=this;return n.handleOperation(async()=>{let r=n._getFinalPath(e);const a=kr({},n.headers);t!=null&&t.upsert&&(a["x-upsert"]="true");const i=await Ql(n.fetch,`${n.url}/object/upload/sign/${r}`,{},{headers:a}),s=new URL(n.url+i.url),c=s.searchParams.get("token");if(!c)throw new _y("No token returned by API");return{signedUrl:s.toString(),path:e,token:c}})}async update(e,t,n){return this.uploadOrUpdate("PUT",e,t,n)}async move(e,t,n){var r=this;return r.handleOperation(async()=>await Ql(r.fetch,`${r.url}/object/move`,{bucketId:r.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n==null?void 0:n.destinationBucket},{headers:r.headers}))}async copy(e,t,n){var r=this;return r.handleOperation(async()=>({path:(await Ql(r.fetch,`${r.url}/object/copy`,{bucketId:r.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n==null?void 0:n.destinationBucket},{headers:r.headers})).Key}))}async createSignedUrl(e,t,n){var r=this;return r.handleOperation(async()=>{let a=r._getFinalPath(e),i=await Ql(r.fetch,`${r.url}/object/sign/${a}`,kr({expiresIn:t},n!=null&&n.transform?{transform:n.transform}:{}),{headers:r.headers});const s=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{signedUrl:encodeURI(`${r.url}${i.signedURL}${s}`)}})}async createSignedUrls(e,t,n){var r=this;return r.handleOperation(async()=>{const a=await Ql(r.fetch,`${r.url}/object/sign/${r.bucketId}`,{expiresIn:t,paths:e},{headers:r.headers}),i=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return a.map(s=>kr(kr({},s),{},{signedUrl:s.signedURL?encodeURI(`${r.url}${s.signedURL}${i}`):null}))})}download(e,t,n){const r=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",a=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),i=a?`?${a}`:"",s=this._getFinalPath(e),c=()=>nm(this.fetch,`${this.url}/${r}/${s}${i}`,{headers:this.headers,noResolveJson:!0},n);return new iN(c,this.shouldThrowOnError)}async info(e){var t=this;const n=t._getFinalPath(e);return t.handleOperation(async()=>Vx(await nm(t.fetch,`${t.url}/object/info/${n}`,{headers:t.headers})))}async exists(e){var t=this;const n=t._getFinalPath(e);try{return await aN(t.fetch,`${t.url}/object/${n}`,{headers:t.headers}),{data:!0,error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Ny(r)&&r instanceof fR){const a=r.originalError;if([400,404].includes(a==null?void 0:a.status))return{data:!1,error:r}}throw r}}getPublicUrl(e,t){const n=this._getFinalPath(e),r=[],a=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";a!==""&&r.push(a);const i=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",s=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});s!==""&&r.push(s);let c=r.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${n}${c}`)}}}async remove(e){var t=this;return t.handleOperation(async()=>await dS(t.fetch,`${t.url}/object/${t.bucketId}`,{prefixes:e},{headers:t.headers}))}async list(e,t,n){var r=this;return r.handleOperation(async()=>{const a=kr(kr(kr({},lN),t),{},{prefix:e||""});return await Ql(r.fetch,`${r.url}/object/list/${r.bucketId}`,a,{headers:r.headers},n)})}async listV2(e,t){var n=this;return n.handleOperation(async()=>{const r=kr({},e);return await Ql(n.fetch,`${n.url}/object/list-v2/${n.bucketId}`,r,{headers:n.headers},t)})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}};const dN="2.98.0",xm={"X-Client-Info":`storage-js/${dN}`};var uN=class extends If{constructor(e,t={},n,r){const a=new URL(e);r!=null&&r.useNewHostname&&/supabase\.(co|in|red)$/.test(a.hostname)&&!a.hostname.includes("storage.supabase.")&&(a.hostname=a.hostname.replace("supabase.","storage.supabase."));const i=a.href.replace(/\/$/,""),s=kr(kr({},xm),t);super(i,s,n,"storage")}async listBuckets(e){var t=this;return t.handleOperation(async()=>{const n=t.listBucketOptionsToQueryString(e);return await nm(t.fetch,`${t.url}/bucket${n}`,{headers:t.headers})})}async getBucket(e){var t=this;return t.handleOperation(async()=>await nm(t.fetch,`${t.url}/bucket/${e}`,{headers:t.headers}))}async createBucket(e,t={public:!1}){var n=this;return n.handleOperation(async()=>await Ql(n.fetch,`${n.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:n.headers}))}async updateBucket(e,t){var n=this;return n.handleOperation(async()=>await Ux(n.fetch,`${n.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:n.headers}))}async emptyBucket(e){var t=this;return t.handleOperation(async()=>await Ql(t.fetch,`${t.url}/bucket/${e}/empty`,{},{headers:t.headers}))}async deleteBucket(e){var t=this;return t.handleOperation(async()=>await dS(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}))}listBucketOptionsToQueryString(e){const t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},hN=class extends If{constructor(e,t={},n){const r=e.replace(/\/$/,""),a=kr(kr({},xm),t);super(r,a,n,"storage")}async createBucket(e){var t=this;return t.handleOperation(async()=>await Ql(t.fetch,`${t.url}/bucket`,{name:e},{headers:t.headers}))}async listBuckets(e){var t=this;return t.handleOperation(async()=>{const n=new URLSearchParams;(e==null?void 0:e.limit)!==void 0&&n.set("limit",e.limit.toString()),(e==null?void 0:e.offset)!==void 0&&n.set("offset",e.offset.toString()),e!=null&&e.sortColumn&&n.set("sortColumn",e.sortColumn),e!=null&&e.sortOrder&&n.set("sortOrder",e.sortOrder),e!=null&&e.search&&n.set("search",e.search);const r=n.toString(),a=r?`${t.url}/bucket?${r}`:`${t.url}/bucket`;return await nm(t.fetch,a,{headers:t.headers})})}async deleteBucket(e){var t=this;return t.handleOperation(async()=>await dS(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}))}from(e){var t=this;if(!Q_(e))throw new _y("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const n=new K_({baseUrl:this.url,catalogName:e,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),r=this.shouldThrowOnError;return new Proxy(n,{get(a,i){const s=a[i];return typeof s!="function"?s:async(...c)=>{try{return{data:await s.apply(a,c),error:null}}catch(l){if(r)throw l;return{data:null,error:l}}}}})}},fN=class extends If{constructor(e,t={},n){const r=e.replace(/\/$/,""),a=kr(kr({},xm),{},{"Content-Type":"application/json"},t);super(r,a,n,"vectors")}async createIndex(e){var t=this;return t.handleOperation(async()=>await sl.post(t.fetch,`${t.url}/CreateIndex`,e,{headers:t.headers})||{})}async getIndex(e,t){var n=this;return n.handleOperation(async()=>await sl.post(n.fetch,`${n.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:n.headers}))}async listIndexes(e){var t=this;return t.handleOperation(async()=>await sl.post(t.fetch,`${t.url}/ListIndexes`,e,{headers:t.headers}))}async deleteIndex(e,t){var n=this;return n.handleOperation(async()=>await sl.post(n.fetch,`${n.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:n.headers})||{})}},pN=class extends If{constructor(e,t={},n){const r=e.replace(/\/$/,""),a=kr(kr({},xm),{},{"Content-Type":"application/json"},t);super(r,a,n,"vectors")}async putVectors(e){var t=this;if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return t.handleOperation(async()=>await sl.post(t.fetch,`${t.url}/PutVectors`,e,{headers:t.headers})||{})}async getVectors(e){var t=this;return t.handleOperation(async()=>await sl.post(t.fetch,`${t.url}/GetVectors`,e,{headers:t.headers}))}async listVectors(e){var t=this;if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return t.handleOperation(async()=>await sl.post(t.fetch,`${t.url}/ListVectors`,e,{headers:t.headers}))}async queryVectors(e){var t=this;return t.handleOperation(async()=>await sl.post(t.fetch,`${t.url}/QueryVectors`,e,{headers:t.headers}))}async deleteVectors(e){var t=this;if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return t.handleOperation(async()=>await sl.post(t.fetch,`${t.url}/DeleteVectors`,e,{headers:t.headers})||{})}},mN=class extends If{constructor(e,t={},n){const r=e.replace(/\/$/,""),a=kr(kr({},xm),{},{"Content-Type":"application/json"},t);super(r,a,n,"vectors")}async createBucket(e){var t=this;return t.handleOperation(async()=>await sl.post(t.fetch,`${t.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{})}async getBucket(e){var t=this;return t.handleOperation(async()=>await sl.post(t.fetch,`${t.url}/GetVectorBucket`,{vectorBucketName:e},{headers:t.headers}))}async listBuckets(e={}){var t=this;return t.handleOperation(async()=>await sl.post(t.fetch,`${t.url}/ListVectorBuckets`,e,{headers:t.headers}))}async deleteBucket(e){var t=this;return t.handleOperation(async()=>await sl.post(t.fetch,`${t.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{})}},gN=class extends mN{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new yN(this.url,this.headers,e,this.fetch)}async createBucket(e){var t=()=>super.createBucket,n=this;return t().call(n,e)}async getBucket(e){var t=()=>super.getBucket,n=this;return t().call(n,e)}async listBuckets(e={}){var t=()=>super.listBuckets,n=this;return t().call(n,e)}async deleteBucket(e){var t=()=>super.deleteBucket,n=this;return t().call(n,e)}},yN=class extends fN{constructor(e,t,n,r){super(e,t,r),this.vectorBucketName=n}async createIndex(e){var t=()=>super.createIndex,n=this;return t().call(n,kr(kr({},e),{},{vectorBucketName:n.vectorBucketName}))}async listIndexes(e={}){var t=()=>super.listIndexes,n=this;return t().call(n,kr(kr({},e),{},{vectorBucketName:n.vectorBucketName}))}async getIndex(e){var t=()=>super.getIndex,n=this;return t().call(n,n.vectorBucketName,e)}async deleteIndex(e){var t=()=>super.deleteIndex,n=this;return t().call(n,n.vectorBucketName,e)}index(e){return new bN(this.url,this.headers,this.vectorBucketName,e,this.fetch)}},bN=class extends pN{constructor(e,t,n,r,a){super(e,t,a),this.vectorBucketName=n,this.indexName=r}async putVectors(e){var t=()=>super.putVectors,n=this;return t().call(n,kr(kr({},e),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async getVectors(e){var t=()=>super.getVectors,n=this;return t().call(n,kr(kr({},e),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async listVectors(e={}){var t=()=>super.listVectors,n=this;return t().call(n,kr(kr({},e),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async queryVectors(e){var t=()=>super.queryVectors,n=this;return t().call(n,kr(kr({},e),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async deleteVectors(e){var t=()=>super.deleteVectors,n=this;return t().call(n,kr(kr({},e),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}},xN=class extends uN{constructor(e,t={},n,r){super(e,t,n,r)}from(e){return new cN(this.url,this.headers,e,this.fetch)}get vectors(){return new gN(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new hN(this.url+"/iceberg",this.headers,this.fetch)}};const gR="2.98.0",Bh=30*1e3,Yx=3,u2=Yx*Bh,vN="http://localhost:9999",SN="supabase.auth.token",wN={"X-Client-Info":`gotrue-js/${gR}`},Kx="X-Supabase-Api-Version",yR={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},MN=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,CN=600*1e3;class rm extends Error{constructor(t,n,r){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=r}}function sr(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class kN extends rm{constructor(t,n,r){super(t,n,r),this.name="AuthApiError",this.status=n,this.code=r}}function RN(e){return sr(e)&&e.name==="AuthApiError"}class pu extends rm{constructor(t,n){super(t),this.name="AuthUnknownError",this.originalError=n}}class yd extends rm{constructor(t,n,r,a){super(t,r,a),this.name=n,this.status=r}}class Qi extends yd{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function h2(e){return sr(e)&&e.name==="AuthSessionMissingError"}class ch extends yd{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class bg extends yd{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class xg extends yd{constructor(t,n=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function AN(e){return sr(e)&&e.name==="AuthImplicitGrantRedirectError"}class MM extends yd{constructor(t,n=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class jN extends yd{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Xx extends yd{constructor(t,n){super(t,"AuthRetryableFetchError",n,void 0)}}function f2(e){return sr(e)&&e.name==="AuthRetryableFetchError"}class CM extends yd{constructor(t,n,r){super(t,"AuthWeakPasswordError",n,"weak_password"),this.reasons=r}}class Jx extends yd{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const U5="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),kM=` 	
\r=`.split(""),EN=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<kM.length;t+=1)e[kM[t].charCodeAt(0)]=-2;for(let t=0;t<U5.length;t+=1)e[U5[t].charCodeAt(0)]=t;return e})();function RM(e,t,n){if(e!==null)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const r=t.queue>>t.queuedBits-6&63;n(U5[r]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const r=t.queue>>t.queuedBits-6&63;n(U5[r]),t.queuedBits-=6}}function bR(e,t,n){const r=EN[e];if(r>-1)for(t.queue=t.queue<<6|r,t.queuedBits+=6;t.queuedBits>=8;)n(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function AM(e){const t=[],n=s=>{t.push(String.fromCodePoint(s))},r={utf8seq:0,codepoint:0},a={queue:0,queuedBits:0},i=s=>{PN(s,r,n)};for(let s=0;s<e.length;s+=1)bR(e.charCodeAt(s),a,i);return t.join("")}function TN(e,t){if(e<=127){t(e);return}else if(e<=2047){t(192|e>>6),t(128|e&63);return}else if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|e&63);return}else if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function IN(e,t){for(let n=0;n<e.length;n+=1){let r=e.charCodeAt(n);if(r>55295&&r<=56319){const a=(r-55296)*1024&65535;r=(e.charCodeAt(n+1)-56320&65535|a)+65536,n+=1}TN(r,t)}}function PN(e,t,n){if(t.utf8seq===0){if(e<=127){n(e);return}for(let r=1;r<6;r+=1)if((e>>7-r&1)===0){t.utf8seq=r;break}if(t.utf8seq===2)t.codepoint=e&31;else if(t.utf8seq===3)t.codepoint=e&15;else if(t.utf8seq===4)t.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|e&63,t.utf8seq-=1,t.utf8seq===0&&n(t.codepoint)}}function df(e){const t=[],n={queue:0,queuedBits:0},r=a=>{t.push(a)};for(let a=0;a<e.length;a+=1)bR(e.charCodeAt(a),n,r);return new Uint8Array(t)}function FN(e){const t=[];return IN(e,n=>t.push(n)),new Uint8Array(t)}function Mu(e){const t=[],n={queue:0,queuedBits:0},r=a=>{t.push(a)};return e.forEach(a=>RM(a,n,r)),RM(null,n,r),t.join("")}function _N(e){return Math.round(Date.now()/1e3)+e}function NN(){return Symbol("auth-callback")}const Ds=()=>typeof window<"u"&&typeof document<"u",q0={tested:!1,writable:!1},xR=()=>{if(!Ds())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(q0.tested)return q0.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),q0.tested=!0,q0.writable=!0}catch{q0.tested=!0,q0.writable=!1}return q0.writable};function ON(e){const t={},n=new URL(e);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((a,i)=>{t[i]=a})}catch{}return n.searchParams.forEach((r,a)=>{t[a]=r}),t}const vR=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),DN=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",$h=async(e,t,n)=>{await e.setItem(t,JSON.stringify(n))},H0=async(e,t)=>{const n=await e.getItem(t);if(!n)return null;try{return JSON.parse(n)}catch{return n}},Fs=async(e,t)=>{await e.removeItem(t)};class Oy{constructor(){this.promise=new Oy.promiseConstructor((t,n)=>{this.resolve=t,this.reject=n})}}Oy.promiseConstructor=Promise;function vg(e){const t=e.split(".");if(t.length!==3)throw new Jx("Invalid JWT structure");for(let r=0;r<t.length;r++)if(!MN.test(t[r]))throw new Jx("JWT not in base64url format");return{header:JSON.parse(AM(t[0])),payload:JSON.parse(AM(t[1])),signature:df(t[2]),raw:{header:t[0],payload:t[1]}}}async function LN(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function zN(e,t){return new Promise((r,a)=>{(async()=>{for(let i=0;i<1/0;i++)try{const s=await e(i);if(!t(i,null,s)){r(s);return}}catch(s){if(!t(i,s)){a(s);return}}})()})}function BN(e){return("0"+e.toString(16)).substr(-2)}function $N(){const t=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=n.length;let a="";for(let i=0;i<56;i++)a+=n.charAt(Math.floor(Math.random()*r));return a}return crypto.getRandomValues(t),Array.from(t,BN).join("")}async function qN(e){const n=new TextEncoder().encode(e),r=await crypto.subtle.digest("SHA-256",n),a=new Uint8Array(r);return Array.from(a).map(i=>String.fromCharCode(i)).join("")}async function HN(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const n=await qN(e);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function dh(e,t,n=!1){const r=$N();let a=r;n&&(a+="/PASSWORD_RECOVERY"),await $h(e,`${t}-code-verifier`,a);const i=await HN(r);return[i,r===i?"plain":"s256"]}const WN=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function GN(e){const t=e.headers.get(Kx);if(!t||!t.match(WN))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function VN(e){if(!e)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(e<=t)throw new Error("JWT has expired")}function UN(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const YN=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function uh(e){if(!YN.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function p2(){const e={};return new Proxy(e,{get:(t,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){const r=n.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function KN(e,t){return new Proxy(e,{get:(n,r,a)=>{if(r==="__isInsecureUserWarningProxy")return!0;if(typeof r=="symbol"){const i=r.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)"||i==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(n,r,a)}return!t.value&&typeof r=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(n,r,a)}})}function jM(e){return JSON.parse(JSON.stringify(e))}const du=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),XN=[502,503,504];async function EM(e){var t;if(!DN(e))throw new Xx(du(e),0);if(XN.includes(e.status))throw new Xx(du(e),e.status);let n;try{n=await e.json()}catch(i){throw new pu(du(i),i)}let r;const a=GN(e);if(a&&a.getTime()>=yR["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?r=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(r=n.error_code),r){if(r==="weak_password")throw new CM(du(n),e.status,((t=n.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(r==="session_not_found")throw new Qi}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((i,s)=>i&&typeof s=="string",!0))throw new CM(du(n),e.status,n.weak_password.reasons);throw new kN(du(n),e.status||500,r)}const JN=(e,t,n,r)=>{const a={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"?a:(a.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),a.body=JSON.stringify(r),Object.assign(Object.assign({},a),n))};async function Ar(e,t,n,r){var a;const i=Object.assign({},r==null?void 0:r.headers);i[Kx]||(i[Kx]=yR["2024-01-01"].name),r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const s=(a=r==null?void 0:r.query)!==null&&a!==void 0?a:{};r!=null&&r.redirectTo&&(s.redirect_to=r.redirectTo);const c=Object.keys(s).length?"?"+new URLSearchParams(s).toString():"",l=await QN(e,t,n+c,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(l):{data:Object.assign({},l),error:null}}async function QN(e,t,n,r,a,i){const s=JN(t,r,a,i);let c;try{c=await e(n,Object.assign({},s))}catch(l){throw console.error(l),new Xx(du(l),0)}if(c.ok||await EM(c),r!=null&&r.noResolveJson)return c;try{return await c.json()}catch(l){await EM(l)}}function Yl(e){var t;let n=null;tO(e)&&(n=Object.assign({},e),e.expires_at||(n.expires_at=_N(e.expires_in)));const r=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:n,user:r},error:null}}function TM(e){const t=Yl(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((n,r)=>n&&typeof r=="string",!0)&&(t.data.weak_password=e.weak_password),t}function p0(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function ZN(e){return{data:e,error:null}}function eO(e){const{action_link:t,email_otp:n,hashed_token:r,redirect_to:a,verification_type:i}=e,s=Fy(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),c={action_link:t,email_otp:n,hashed_token:r,redirect_to:a,verification_type:i},l=Object.assign({},s);return{data:{properties:c,user:l},error:null}}function IM(e){return e}function tO(e){return e.access_token&&e.refresh_token&&e.expires_in}const m2=["global","local","others"];class nO{constructor({url:t="",headers:n={},fetch:r}){this.url=t,this.headers=n,this.fetch=vR(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,n=m2[0]){if(m2.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${m2.join(", ")}`);try{return await Ar(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(r){if(sr(r))return{data:null,error:r};throw r}}async inviteUserByEmail(t,n={}){try{return await Ar(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:p0})}catch(r){if(sr(r))return{data:{user:null},error:r};throw r}}async generateLink(t){try{const{options:n}=t,r=Fy(t,["options"]),a=Object.assign(Object.assign({},r),n);return"newEmail"in r&&(a.new_email=r==null?void 0:r.newEmail,delete a.newEmail),await Ar(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:a,headers:this.headers,xform:eO,redirectTo:n==null?void 0:n.redirectTo})}catch(n){if(sr(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(t){try{return await Ar(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:p0})}catch(n){if(sr(n))return{data:{user:null},error:n};throw n}}async listUsers(t){var n,r,a,i,s,c,l;try{const d={nextPage:null,lastPage:0,total:0},u=await Ar(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=t==null?void 0:t.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(i=(a=t==null?void 0:t.perPage)===null||a===void 0?void 0:a.toString())!==null&&i!==void 0?i:""},xform:IM});if(u.error)throw u.error;const h=await u.json(),m=(s=u.headers.get("x-total-count"))!==null&&s!==void 0?s:0,f=(l=(c=u.headers.get("link"))===null||c===void 0?void 0:c.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(g=>{const x=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(g.split(";")[1].split("=")[1]);d[`${v}Page`]=x}),d.total=parseInt(m)),{data:Object.assign(Object.assign({},h),d),error:null}}catch(d){if(sr(d))return{data:{users:[]},error:d};throw d}}async getUserById(t){uh(t);try{return await Ar(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:p0})}catch(n){if(sr(n))return{data:{user:null},error:n};throw n}}async updateUserById(t,n){uh(t);try{return await Ar(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:n,headers:this.headers,xform:p0})}catch(r){if(sr(r))return{data:{user:null},error:r};throw r}}async deleteUser(t,n=!1){uh(t);try{return await Ar(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:n},xform:p0})}catch(r){if(sr(r))return{data:{user:null},error:r};throw r}}async _listFactors(t){uh(t.userId);try{const{data:n,error:r}=await Ar(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:a=>({data:{factors:a},error:null})});return{data:n,error:r}}catch(n){if(sr(n))return{data:null,error:n};throw n}}async _deleteFactor(t){uh(t.userId),uh(t.id);try{return{data:await Ar(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(n){if(sr(n))return{data:null,error:n};throw n}}async _listOAuthClients(t){var n,r,a,i,s,c,l;try{const d={nextPage:null,lastPage:0,total:0},u=await Ar(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=t==null?void 0:t.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(i=(a=t==null?void 0:t.perPage)===null||a===void 0?void 0:a.toString())!==null&&i!==void 0?i:""},xform:IM});if(u.error)throw u.error;const h=await u.json(),m=(s=u.headers.get("x-total-count"))!==null&&s!==void 0?s:0,f=(l=(c=u.headers.get("link"))===null||c===void 0?void 0:c.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(g=>{const x=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(g.split(";")[1].split("=")[1]);d[`${v}Page`]=x}),d.total=parseInt(m)),{data:Object.assign(Object.assign({},h),d),error:null}}catch(d){if(sr(d))return{data:{clients:[]},error:d};throw d}}async _createOAuthClient(t){try{return await Ar(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(sr(n))return{data:null,error:n};throw n}}async _getOAuthClient(t){try{return await Ar(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(sr(n))return{data:null,error:n};throw n}}async _updateOAuthClient(t,n){try{return await Ar(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:n,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(sr(r))return{data:null,error:r};throw r}}async _deleteOAuthClient(t){try{return await Ar(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(n){if(sr(n))return{data:null,error:n};throw n}}async _regenerateOAuthClientSecret(t){try{return await Ar(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(sr(n))return{data:null,error:n};throw n}}}function PM(e={}){return{getItem:t=>e[t]||null,setItem:(t,n)=>{e[t]=n},removeItem:t=>{delete e[t]}}}const Uc={debug:!!(globalThis&&xR()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class SR extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class rO extends SR{}async function oO(e,t,n){Uc.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const r=new globalThis.AbortController;t>0&&setTimeout(()=>{r.abort(),Uc.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve();try{return await globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async a=>{if(a){Uc.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,a.name);try{return await n()}finally{Uc.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,a.name)}}else{if(t===0)throw Uc.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new rO(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(Uc.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}})}catch(a){if((a==null?void 0:a.name)==="AbortError"&&t>0)return Uc.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire timeout, recovering by stealing lock",e),console.warn(`@supabase/gotrue-js: Lock "${e}" was not released within ${t}ms. This may indicate an orphaned lock from a component unmount (e.g., React Strict Mode). Forcefully acquiring the lock to recover.`),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,{mode:"exclusive",steal:!0},async i=>{if(i){Uc.debug&&console.log("@supabase/gotrue-js: navigatorLock: recovered (stolen)",e,i.name);try{return await n()}finally{Uc.debug&&console.log("@supabase/gotrue-js: navigatorLock: released (stolen)",e,i.name)}}else return console.warn("@supabase/gotrue-js: Navigator LockManager returned null lock even with steal: true"),await n()}));throw a}}function aO(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function wR(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function sO(e){return parseInt(e,16)}function iO(e){const t=new TextEncoder().encode(e);return"0x"+Array.from(t,r=>r.toString(16).padStart(2,"0")).join("")}function lO(e){var t;const{chainId:n,domain:r,expirationTime:a,issuedAt:i=new Date,nonce:s,notBefore:c,requestId:l,resources:d,scheme:u,uri:h,version:m}=e;{if(!Number.isInteger(n))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${n}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(s&&s.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${s}`);if(!h)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(m!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${m}`);if(!((t=e.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`)}const f=wR(e.address),g=u?`${u}://${r}`:r,x=e.statement?`${e.statement}
`:"",v=`${g} wants you to sign in with your Ethereum account:
${f}

${x}`;let b=`URI: ${h}
Version: ${m}
Chain ID: ${n}${s?`
Nonce: ${s}`:""}
Issued At: ${i.toISOString()}`;if(a&&(b+=`
Expiration Time: ${a.toISOString()}`),c&&(b+=`
Not Before: ${c.toISOString()}`),l&&(b+=`
Request ID: ${l}`),d){let w=`
Resources:`;for(const M of d){if(!M||typeof M!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${M}`);w+=`
- ${M}`}b+=w}return`${v}
${b}`}class ns extends Error{constructor({message:t,code:n,cause:r,name:a}){var i;super(t,{cause:r}),this.__isWebAuthnError=!0,this.name=(i=a??(r instanceof Error?r.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=n}}class Y5 extends ns{constructor(t,n){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n,message:t}),this.name="WebAuthnUnknownError",this.originalError=n}}function cO({error:e,options:t}){var n,r,a;const{publicKey:i}=t;if(!i)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new ns({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(((n=i.authenticatorSelection)===null||n===void 0?void 0:n.requireResidentKey)===!0)return new ns({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(t.mediation==="conditional"&&((r=i.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new ns({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if(((a=i.authenticatorSelection)===null||a===void 0?void 0:a.userVerification)==="required")return new ns({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new ns({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new ns({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return i.pubKeyCredParams.filter(c=>c.type==="public-key").length===0?new ns({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new ns({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const s=window.location.hostname;if(MR(s)){if(i.rp.id!==s)return new ns({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new ns({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new ns({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new ns({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new ns({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function dO({error:e,options:t}){const{publicKey:n}=t;if(!n)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new ns({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new ns({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const r=window.location.hostname;if(MR(r)){if(n.rpId!==r)return new ns({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new ns({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new ns({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new ns({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}class uO{createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const hO=new uO;function fO(e){if(!e)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:n,excludeCredentials:r}=e,a=Fy(e,["challenge","user","excludeCredentials"]),i=df(t).buffer,s=Object.assign(Object.assign({},n),{id:df(n.id).buffer}),c=Object.assign(Object.assign({},a),{challenge:i,user:s});if(r&&r.length>0){c.excludeCredentials=new Array(r.length);for(let l=0;l<r.length;l++){const d=r[l];c.excludeCredentials[l]=Object.assign(Object.assign({},d),{id:df(d.id).buffer,type:d.type||"public-key",transports:d.transports})}}return c}function pO(e){if(!e)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:n}=e,r=Fy(e,["challenge","allowCredentials"]),a=df(t).buffer,i=Object.assign(Object.assign({},r),{challenge:a});if(n&&n.length>0){i.allowCredentials=new Array(n.length);for(let s=0;s<n.length;s++){const c=n[s];i.allowCredentials[s]=Object.assign(Object.assign({},c),{id:df(c.id).buffer,type:c.type||"public-key",transports:c.transports})}}return i}function mO(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const n=e;return{id:e.id,rawId:e.id,response:{attestationObject:Mu(new Uint8Array(e.response.attestationObject)),clientDataJSON:Mu(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:(t=n.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function gO(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const n=e,r=e.getClientExtensionResults(),a=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:Mu(new Uint8Array(a.authenticatorData)),clientDataJSON:Mu(new Uint8Array(a.clientDataJSON)),signature:Mu(new Uint8Array(a.signature)),userHandle:a.userHandle?Mu(new Uint8Array(a.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:(t=n.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function MR(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function FM(){var e,t;return!!(Ds()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.create)=="function"&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.get)=="function")}async function yO(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Y5("Browser returned unexpected credential type",t)}:{data:null,error:new Y5("Empty credential response",t)}}catch(t){return{data:null,error:cO({error:t,options:e})}}}async function bO(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Y5("Browser returned unexpected credential type",t)}:{data:null,error:new Y5("Empty credential response",t)}}catch(t){return{data:null,error:dO({error:t,options:e})}}}const xO={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},vO={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function K5(...e){const t=a=>a!==null&&typeof a=="object"&&!Array.isArray(a),n=a=>a instanceof ArrayBuffer||ArrayBuffer.isView(a),r={};for(const a of e)if(a)for(const i in a){const s=a[i];if(s!==void 0)if(Array.isArray(s))r[i]=s;else if(n(s))r[i]=s;else if(t(s)){const c=r[i];t(c)?r[i]=K5(c,s):r[i]=K5(s)}else r[i]=s}return r}function SO(e,t){return K5(xO,e,t||{})}function wO(e,t){return K5(vO,e,t||{})}class MO{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:n,friendlyName:r,signal:a},i){var s;try{const{data:c,error:l}=await this.client.mfa.challenge({factorId:t,webauthn:n});if(!c)return{data:null,error:l};const d=a??hO.createNewAbortSignal();if(c.webauthn.type==="create"){const{user:u}=c.webauthn.credential_options.publicKey;if(!u.name){const h=r;if(h)u.name=`${u.id}:${h}`;else{const f=(await this.client.getUser()).data.user,g=((s=f==null?void 0:f.user_metadata)===null||s===void 0?void 0:s.name)||(f==null?void 0:f.email)||(f==null?void 0:f.id)||"User";u.name=`${u.id}:${g}`}}u.displayName||(u.displayName=u.name)}switch(c.webauthn.type){case"create":{const u=SO(c.webauthn.credential_options.publicKey,i==null?void 0:i.create),{data:h,error:m}=await yO({publicKey:u,signal:d});return h?{data:{factorId:t,challengeId:c.id,webauthn:{type:c.webauthn.type,credential_response:h}},error:null}:{data:null,error:m}}case"request":{const u=wO(c.webauthn.credential_options.publicKey,i==null?void 0:i.request),{data:h,error:m}=await bO(Object.assign(Object.assign({},c.webauthn.credential_options),{publicKey:u,signal:d}));return h?{data:{factorId:t,challengeId:c.id,webauthn:{type:c.webauthn.type,credential_response:h}},error:null}:{data:null,error:m}}}}catch(c){return sr(c)?{data:null,error:c}:{data:null,error:new pu("Unexpected error in challenge",c)}}}async _verify({challengeId:t,factorId:n,webauthn:r}){return this.client.mfa.verify({factorId:n,challengeId:t,webauthn:r})}async _authenticate({factorId:t,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:a}={}},i){if(!n)return{data:null,error:new rm("rpId is required for WebAuthn authentication")};try{if(!FM())return{data:null,error:new pu("Browser does not support WebAuthn",null)};const{data:s,error:c}=await this.challenge({factorId:t,webauthn:{rpId:n,rpOrigins:r},signal:a},{request:i});if(!s)return{data:null,error:c};const{webauthn:l}=s;return this._verify({factorId:t,challengeId:s.challengeId,webauthn:{type:l.type,rpId:n,rpOrigins:r,credential_response:l.credential_response}})}catch(s){return sr(s)?{data:null,error:s}:{data:null,error:new pu("Unexpected error in authenticate",s)}}}async _register({friendlyName:t,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:a}={}},i){if(!n)return{data:null,error:new rm("rpId is required for WebAuthn registration")};try{if(!FM())return{data:null,error:new pu("Browser does not support WebAuthn",null)};const{data:s,error:c}=await this._enroll({friendlyName:t});if(!s)return await this.client.mfa.listFactors().then(u=>{var h;return(h=u.data)===null||h===void 0?void 0:h.all.find(m=>m.factor_type==="webauthn"&&m.friendly_name===t&&m.status!=="unverified")}).then(u=>u?this.client.mfa.unenroll({factorId:u==null?void 0:u.id}):void 0),{data:null,error:c};const{data:l,error:d}=await this._challenge({factorId:s.id,friendlyName:s.friendly_name,webauthn:{rpId:n,rpOrigins:r},signal:a},{create:i});return l?this._verify({factorId:s.id,challengeId:l.challengeId,webauthn:{rpId:n,rpOrigins:r,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:d}}catch(s){return sr(s)?{data:null,error:s}:{data:null,error:new pu("Unexpected error in register",s)}}}}aO();const CO={url:vN,storageKey:SN,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:wN,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:5e3,skipAutoInitialize:!1};async function _M(e,t,n){return await n()}const hh={};class om{get jwks(){var t,n;return(n=(t=hh[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(t){hh[this.storageKey]=Object.assign(Object.assign({},hh[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,n;return(n=(t=hh[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){hh[this.storageKey]=Object.assign(Object.assign({},hh[this.storageKey]),{cachedAt:t})}constructor(t){var n,r,a;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const i=Object.assign(Object.assign({},CO),t);if(this.storageKey=i.storageKey,this.instanceID=(n=om.nextInstanceID[this.storageKey])!==null&&n!==void 0?n:0,om.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.instanceID>0&&Ds()){const s=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(s),this.logDebugMessages&&console.trace(s)}if(this.persistSession=i.persistSession,this.autoRefreshToken=i.autoRefreshToken,this.admin=new nO({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=vR(i.fetch),this.lock=i.lock||_M,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,this.throwOnError=i.throwOnError,this.lockAcquireTimeout=i.lockAcquireTimeout,i.lock?this.lock=i.lock:this.persistSession&&Ds()&&(!((r=globalThis==null?void 0:globalThis.navigator)===null||r===void 0)&&r.locks)?this.lock=oO:this.lock=_M,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new MO(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:xR()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=PM(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=PM(this.memoryStorage)),Ds()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(a=this.broadcastChannel)===null||a===void 0||a.addEventListener("message",async s=>{this._debug("received broadcast notification from other tab or client",s);try{await this._notifyAllSubscribers(s.data.event,s.data.session,!1)}catch(c){this._debug("#broadcastChannel","error",c)}})}i.skipAutoInitialize||this.initialize().catch(s=>{this._debug("#initialize()","error",s)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${gR}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let n={},r="none";if(Ds()&&(n=ON(window.location.href),this._isImplicitGrantCallback(n)?r="implicit":await this._isPKCECallback(n)&&(r="pkce")),Ds()&&this.detectSessionInUrl&&r!=="none"){const{data:a,error:i}=await this._getSessionFromURL(n,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),AN(i)){const l=(t=i.details)===null||t===void 0?void 0:t.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:i}}return{error:i}}const{session:s,redirectType:c}=a;return this._debug("#_initialize()","detected session in URL",s,"redirect type",c),await this._saveSession(s),setTimeout(async()=>{c==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",s):await this._notifyAllSubscribers("SIGNED_IN",s)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return sr(n)?this._returnResult({error:n}):this._returnResult({error:new pu("Unexpected error during initialization",n)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var n,r,a;try{const i=await Ar(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(n=t==null?void 0:t.options)===null||n===void 0?void 0:n.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(a=t==null?void 0:t.options)===null||a===void 0?void 0:a.captchaToken}},xform:Yl}),{data:s,error:c}=i;if(c||!s)return this._returnResult({data:{user:null,session:null},error:c});const l=s.session,d=s.user;return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:d,session:l},error:null})}catch(i){if(sr(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signUp(t){var n,r,a;try{let i;if("email"in t){const{email:u,password:h,options:m}=t;let f=null,g=null;this.flowType==="pkce"&&([f,g]=await dh(this.storage,this.storageKey)),i=await Ar(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:m==null?void 0:m.emailRedirectTo,body:{email:u,password:h,data:(n=m==null?void 0:m.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:m==null?void 0:m.captchaToken},code_challenge:f,code_challenge_method:g},xform:Yl})}else if("phone"in t){const{phone:u,password:h,options:m}=t;i=await Ar(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(r=m==null?void 0:m.data)!==null&&r!==void 0?r:{},channel:(a=m==null?void 0:m.channel)!==null&&a!==void 0?a:"sms",gotrue_meta_security:{captcha_token:m==null?void 0:m.captchaToken}},xform:Yl})}else throw new bg("You must provide either an email or phone number and a password");const{data:s,error:c}=i;if(c||!s)return await Fs(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:c});const l=s.session,d=s.user;return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:d,session:l},error:null})}catch(i){if(await Fs(this.storage,`${this.storageKey}-code-verifier`),sr(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithPassword(t){try{let n;if("email"in t){const{email:i,password:s,options:c}=t;n=await Ar(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:s,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken}},xform:TM})}else if("phone"in t){const{phone:i,password:s,options:c}=t;n=await Ar(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:s,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken}},xform:TM})}else throw new bg("You must provide either an email or phone number and a password");const{data:r,error:a}=n;if(a)return this._returnResult({data:{user:null,session:null},error:a});if(!r||!r.session||!r.user){const i=new ch;return this._returnResult({data:{user:null,session:null},error:i})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:a})}catch(n){if(sr(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOAuth(t){var n,r,a,i;return await this._handleProviderSignIn(t.provider,{redirectTo:(n=t.options)===null||n===void 0?void 0:n.redirectTo,scopes:(r=t.options)===null||r===void 0?void 0:r.scopes,queryParams:(a=t.options)===null||a===void 0?void 0:a.queryParams,skipBrowserRedirect:(i=t.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:n}=t;switch(n){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}}async signInWithEthereum(t){var n,r,a,i,s,c,l,d,u,h,m;let f,g;if("message"in t)f=t.message,g=t.signature;else{const{chain:x,wallet:v,statement:b,options:w}=t;let M;if(Ds())if(typeof v=="object")M=v;else{const O=window;if("ethereum"in O&&typeof O.ethereum=="object"&&"request"in O.ethereum&&typeof O.ethereum.request=="function")M=O.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof v!="object"||!(w!=null&&w.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");M=v}const k=new URL((n=w==null?void 0:w.url)!==null&&n!==void 0?n:window.location.href),R=await M.request({method:"eth_requestAccounts"}).then(O=>O).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!R||R.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const j=wR(R[0]);let I=(r=w==null?void 0:w.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!I){const O=await M.request({method:"eth_chainId"});I=sO(O)}const E={domain:k.host,address:j,statement:b,uri:k.href,version:"1",chainId:I,nonce:(a=w==null?void 0:w.signInWithEthereum)===null||a===void 0?void 0:a.nonce,issuedAt:(s=(i=w==null?void 0:w.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&s!==void 0?s:new Date,expirationTime:(c=w==null?void 0:w.signInWithEthereum)===null||c===void 0?void 0:c.expirationTime,notBefore:(l=w==null?void 0:w.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(d=w==null?void 0:w.signInWithEthereum)===null||d===void 0?void 0:d.requestId,resources:(u=w==null?void 0:w.signInWithEthereum)===null||u===void 0?void 0:u.resources};f=lO(E),g=await M.request({method:"personal_sign",params:[iO(f),j]})}try{const{data:x,error:v}=await Ar(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:f,signature:g},!((h=t.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(m=t.options)===null||m===void 0?void 0:m.captchaToken}}:null),xform:Yl});if(v)throw v;if(!x||!x.session||!x.user){const b=new ch;return this._returnResult({data:{user:null,session:null},error:b})}return x.session&&(await this._saveSession(x.session),await this._notifyAllSubscribers("SIGNED_IN",x.session)),this._returnResult({data:Object.assign({},x),error:v})}catch(x){if(sr(x))return this._returnResult({data:{user:null,session:null},error:x});throw x}}async signInWithSolana(t){var n,r,a,i,s,c,l,d,u,h,m,f;let g,x;if("message"in t)g=t.message,x=t.signature;else{const{chain:v,wallet:b,statement:w,options:M}=t;let k;if(Ds())if(typeof b=="object")k=b;else{const j=window;if("solana"in j&&typeof j.solana=="object"&&("signIn"in j.solana&&typeof j.solana.signIn=="function"||"signMessage"in j.solana&&typeof j.solana.signMessage=="function"))k=j.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof b!="object"||!(M!=null&&M.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");k=b}const R=new URL((n=M==null?void 0:M.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in k&&k.signIn){const j=await k.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},M==null?void 0:M.signInWithSolana),{version:"1",domain:R.host,uri:R.href}),w?{statement:w}:null));let I;if(Array.isArray(j)&&j[0]&&typeof j[0]=="object")I=j[0];else if(j&&typeof j=="object"&&"signedMessage"in j&&"signature"in j)I=j;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in I&&"signature"in I&&(typeof I.signedMessage=="string"||I.signedMessage instanceof Uint8Array)&&I.signature instanceof Uint8Array)g=typeof I.signedMessage=="string"?I.signedMessage:new TextDecoder().decode(I.signedMessage),x=I.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in k)||typeof k.signMessage!="function"||!("publicKey"in k)||typeof k!="object"||!k.publicKey||!("toBase58"in k.publicKey)||typeof k.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");g=[`${R.host} wants you to sign in with your Solana account:`,k.publicKey.toBase58(),...w?["",w,""]:[""],"Version: 1",`URI: ${R.href}`,`Issued At: ${(a=(r=M==null?void 0:M.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&a!==void 0?a:new Date().toISOString()}`,...!((i=M==null?void 0:M.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${M.signInWithSolana.notBefore}`]:[],...!((s=M==null?void 0:M.signInWithSolana)===null||s===void 0)&&s.expirationTime?[`Expiration Time: ${M.signInWithSolana.expirationTime}`]:[],...!((c=M==null?void 0:M.signInWithSolana)===null||c===void 0)&&c.chainId?[`Chain ID: ${M.signInWithSolana.chainId}`]:[],...!((l=M==null?void 0:M.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${M.signInWithSolana.nonce}`]:[],...!((d=M==null?void 0:M.signInWithSolana)===null||d===void 0)&&d.requestId?[`Request ID: ${M.signInWithSolana.requestId}`]:[],...!((h=(u=M==null?void 0:M.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||h===void 0)&&h.length?["Resources",...M.signInWithSolana.resources.map(I=>`- ${I}`)]:[]].join(`
`);const j=await k.signMessage(new TextEncoder().encode(g),"utf8");if(!j||!(j instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");x=j}}try{const{data:v,error:b}=await Ar(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:g,signature:Mu(x)},!((m=t.options)===null||m===void 0)&&m.captchaToken?{gotrue_meta_security:{captcha_token:(f=t.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:Yl});if(b)throw b;if(!v||!v.session||!v.user){const w=new ch;return this._returnResult({data:{user:null,session:null},error:w})}return v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),this._returnResult({data:Object.assign({},v),error:b})}catch(v){if(sr(v))return this._returnResult({data:{user:null,session:null},error:v});throw v}}async _exchangeCodeForSession(t){const n=await H0(this.storage,`${this.storageKey}-code-verifier`),[r,a]=(n??"").split("/");try{if(!r&&this.flowType==="pkce")throw new jN;const{data:i,error:s}=await Ar(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:r},xform:Yl});if(await Fs(this.storage,`${this.storageKey}-code-verifier`),s)throw s;if(!i||!i.session||!i.user){const c=new ch;return this._returnResult({data:{user:null,session:null,redirectType:null},error:c})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign(Object.assign({},i),{redirectType:a??null}),error:s})}catch(i){if(await Fs(this.storage,`${this.storageKey}-code-verifier`),sr(i))return this._returnResult({data:{user:null,session:null,redirectType:null},error:i});throw i}}async signInWithIdToken(t){try{const{options:n,provider:r,token:a,access_token:i,nonce:s}=t,c=await Ar(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:a,access_token:i,nonce:s,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},xform:Yl}),{data:l,error:d}=c;if(d)return this._returnResult({data:{user:null,session:null},error:d});if(!l||!l.session||!l.user){const u=new ch;return this._returnResult({data:{user:null,session:null},error:u})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:l,error:d})}catch(n){if(sr(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOtp(t){var n,r,a,i,s;try{if("email"in t){const{email:c,options:l}=t;let d=null,u=null;this.flowType==="pkce"&&([d,u]=await dh(this.storage,this.storageKey));const{error:h}=await Ar(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:c,data:(n=l==null?void 0:l.data)!==null&&n!==void 0?n:{},create_user:(r=l==null?void 0:l.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:d,code_challenge_method:u},redirectTo:l==null?void 0:l.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:h})}if("phone"in t){const{phone:c,options:l}=t,{data:d,error:u}=await Ar(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:c,data:(a=l==null?void 0:l.data)!==null&&a!==void 0?a:{},create_user:(i=l==null?void 0:l.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(s=l==null?void 0:l.channel)!==null&&s!==void 0?s:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:d==null?void 0:d.message_id},error:u})}throw new bg("You must provide either an email or phone number.")}catch(c){if(await Fs(this.storage,`${this.storageKey}-code-verifier`),sr(c))return this._returnResult({data:{user:null,session:null},error:c});throw c}}async verifyOtp(t){var n,r;try{let a,i;"options"in t&&(a=(n=t.options)===null||n===void 0?void 0:n.redirectTo,i=(r=t.options)===null||r===void 0?void 0:r.captchaToken);const{data:s,error:c}=await Ar(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:i}}),redirectTo:a,xform:Yl});if(c)throw c;if(!s)throw new Error("An error occurred on token verification.");const l=s.session,d=s.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:d,session:l},error:null})}catch(a){if(sr(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithSSO(t){var n,r,a,i,s;try{let c=null,l=null;this.flowType==="pkce"&&([c,l]=await dh(this.storage,this.storageKey));const d=await Ar(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(r=(n=t.options)===null||n===void 0?void 0:n.redirectTo)!==null&&r!==void 0?r:void 0}),!((a=t==null?void 0:t.options)===null||a===void 0)&&a.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:c,code_challenge_method:l}),headers:this.headers,xform:ZN});return!((i=d.data)===null||i===void 0)&&i.url&&Ds()&&!(!((s=t.options)===null||s===void 0)&&s.skipBrowserRedirect)&&window.location.assign(d.data.url),this._returnResult(d)}catch(c){if(await Fs(this.storage,`${this.storageKey}-code-verifier`),sr(c))return this._returnResult({data:null,error:c});throw c}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:n},error:r}=t;if(r)throw r;if(!n)throw new Qi;const{error:a}=await Ar(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return this._returnResult({data:{user:null,session:null},error:a})})}catch(t){if(sr(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const n=`${this.url}/resend`;if("email"in t){const{email:r,type:a,options:i}=t,{error:s}=await Ar(this.fetch,"POST",n,{headers:this.headers,body:{email:r,type:a,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:s})}else if("phone"in t){const{phone:r,type:a,options:i}=t,{data:s,error:c}=await Ar(this.fetch,"POST",n,{headers:this.headers,body:{phone:r,type:a,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:s==null?void 0:s.message_id},error:c})}throw new bg("You must provide either an email or phone number and a type")}catch(n){if(sr(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async n=>n))}async _acquireLock(t,n){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),a=(async()=>(await r,await n()))();return this.pendingInLock.push((async()=>{try{await a}catch{}})()),a}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=n();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const a=[...this.pendingInLock];await Promise.all(a),this.pendingInLock.splice(0,a.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await t(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const n=await H0(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?t=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const r=t.expires_at?t.expires_at*1e3-Date.now()<u2:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",t.expires_at),!r){if(this.userStorage){const s=await H0(this.userStorage,this.storageKey+"-user");s!=null&&s.user?t.user=s.user:t.user=p2()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const s={value:this.suppressGetSessionWarning};t.user=KN(t.user,s),s.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:a,error:i}=await this._callRefreshToken(t.refresh_token);return i?this._returnResult({data:{session:null},error:i}):this._returnResult({data:{session:a},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){if(t)return await this._getUser(t);await this.initializePromise;const n=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return n.data.user&&(this.suppressGetSessionWarning=!0),n}async _getUser(t){try{return t?await Ar(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:p0}):await this._useSession(async n=>{var r,a,i;const{data:s,error:c}=n;if(c)throw c;return!(!((r=s.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Qi}:await Ar(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(a=s.session)===null||a===void 0?void 0:a.access_token)!==null&&i!==void 0?i:void 0,xform:p0})})}catch(n){if(sr(n))return h2(n)&&(await this._removeSession(),await Fs(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:n});throw n}}async updateUser(t,n={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(t,n))}async _updateUser(t,n={}){try{return await this._useSession(async r=>{const{data:a,error:i}=r;if(i)throw i;if(!a.session)throw new Qi;const s=a.session;let c=null,l=null;this.flowType==="pkce"&&t.email!=null&&([c,l]=await dh(this.storage,this.storageKey));const{data:d,error:u}=await Ar(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n==null?void 0:n.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:c,code_challenge_method:l}),jwt:s.access_token,xform:p0});if(u)throw u;return s.user=d.user,await this._saveSession(s),await this._notifyAllSubscribers("USER_UPDATED",s),this._returnResult({data:{user:s.user},error:null})})}catch(r){if(await Fs(this.storage,`${this.storageKey}-code-verifier`),sr(r))return this._returnResult({data:{user:null},error:r});throw r}}async setSession(t){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new Qi;const n=Date.now()/1e3;let r=n,a=!0,i=null;const{payload:s}=vg(t.access_token);if(s.exp&&(r=s.exp,a=r<=n),a){const{data:c,error:l}=await this._callRefreshToken(t.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!c)return{data:{user:null,session:null},error:null};i=c}else{const{data:c,error:l}=await this._getUser(t.access_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});i={access_token:t.access_token,refresh_token:t.refresh_token,user:c.user,token_type:"bearer",expires_in:r-n,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return this._returnResult({data:{user:i.user,session:i},error:null})}catch(n){if(sr(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async n=>{var r;if(!t){const{data:s,error:c}=n;if(c)throw c;t=(r=s.session)!==null&&r!==void 0?r:void 0}if(!(t!=null&&t.refresh_token))throw new Qi;const{data:a,error:i}=await this._callRefreshToken(t.refresh_token);return i?this._returnResult({data:{user:null,session:null},error:i}):a?this._returnResult({data:{user:a.user,session:a},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(n){if(sr(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async _getSessionFromURL(t,n){try{if(!Ds())throw new xg("No browser detected.");if(t.error||t.error_description||t.error_code)throw new xg(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new MM("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new xg("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new MM("No code detected.");const{data:w,error:M}=await this._exchangeCodeForSession(t.code);if(M)throw M;const k=new URL(window.location.href);return k.searchParams.delete("code"),window.history.replaceState(window.history.state,"",k.toString()),{data:{session:w.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:a,access_token:i,refresh_token:s,expires_in:c,expires_at:l,token_type:d}=t;if(!i||!c||!s||!d)throw new xg("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(c);let m=u+h;l&&(m=parseInt(l));const f=m-u;f*1e3<=Bh&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${h}s`);const g=m-h;u-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,m,u):u-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,m,u);const{data:x,error:v}=await this._getUser(i);if(v)throw v;const b={provider_token:r,provider_refresh_token:a,access_token:i,expires_in:h,expires_at:m,refresh_token:s,token_type:d,user:x.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:b,redirectType:t.type},error:null})}catch(r){if(sr(r))return this._returnResult({data:{session:null,redirectType:null},error:r});throw r}}_isImplicitGrantCallback(t){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),t):!!(t.access_token||t.error_description)}async _isPKCECallback(t){const n=await H0(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&n)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async n=>{var r;const{data:a,error:i}=n;if(i&&!h2(i))return this._returnResult({error:i});const s=(r=a.session)===null||r===void 0?void 0:r.access_token;if(s){const{error:c}=await this.admin.signOut(s,t);if(c&&!(RN(c)&&(c.status===404||c.status===401||c.status===403)||h2(c)))return this._returnResult({error:c})}return t!=="others"&&(await this._removeSession(),await Fs(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const n=NN(),r={id:n,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,r),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:r}}}async _emitInitialSession(t){return await this._useSession(async n=>{var r,a;try{const{data:{session:i},error:s}=n;if(s)throw s;await((r=this.stateChangeEmitters.get(t))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",t,"session",i)}catch(i){await((a=this.stateChangeEmitters.get(t))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",i),console.error(i)}})}async resetPasswordForEmail(t,n={}){let r=null,a=null;this.flowType==="pkce"&&([r,a]=await dh(this.storage,this.storageKey,!0));try{return await Ar(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:r,code_challenge_method:a,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(i){if(await Fs(this.storage,`${this.storageKey}-code-verifier`),sr(i))return this._returnResult({data:null,error:i});throw i}}async getUserIdentities(){var t;try{const{data:n,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:(t=n.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(n){if(sr(n))return this._returnResult({data:null,error:n});throw n}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var n;try{const{data:r,error:a}=await this._useSession(async i=>{var s,c,l,d,u;const{data:h,error:m}=i;if(m)throw m;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(s=t.options)===null||s===void 0?void 0:s.redirectTo,scopes:(c=t.options)===null||c===void 0?void 0:c.scopes,queryParams:(l=t.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await Ar(this.fetch,"GET",f,{headers:this.headers,jwt:(u=(d=h.session)===null||d===void 0?void 0:d.access_token)!==null&&u!==void 0?u:void 0})});if(a)throw a;return Ds()&&!(!((n=t.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),this._returnResult({data:{provider:t.provider,url:r==null?void 0:r.url},error:null})}catch(r){if(sr(r))return this._returnResult({data:{provider:t.provider,url:null},error:r});throw r}}async linkIdentityIdToken(t){return await this._useSession(async n=>{var r;try{const{error:a,data:{session:i}}=n;if(a)throw a;const{options:s,provider:c,token:l,access_token:d,nonce:u}=t,h=await Ar(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(r=i==null?void 0:i.access_token)!==null&&r!==void 0?r:void 0,body:{provider:c,id_token:l,access_token:d,nonce:u,link_identity:!0,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},xform:Yl}),{data:m,error:f}=h;return f?this._returnResult({data:{user:null,session:null},error:f}):!m||!m.session||!m.user?this._returnResult({data:{user:null,session:null},error:new ch}):(m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("USER_UPDATED",m.session)),this._returnResult({data:m,error:f}))}catch(a){if(await Fs(this.storage,`${this.storageKey}-code-verifier`),sr(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}})}async unlinkIdentity(t){try{return await this._useSession(async n=>{var r,a;const{data:i,error:s}=n;if(s)throw s;return await Ar(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(a=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&a!==void 0?a:void 0})})}catch(n){if(sr(n))return this._returnResult({data:null,error:n});throw n}}async _refreshAccessToken(t){const n=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(n,"begin");try{const r=Date.now();return await zN(async a=>(a>0&&await LN(200*Math.pow(2,a-1)),this._debug(n,"refreshing attempt",a),await Ar(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:Yl})),(a,i)=>{const s=200*Math.pow(2,a);return i&&f2(i)&&Date.now()+s-r<Bh})}catch(r){if(this._debug(n,"error",r),sr(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}finally{this._debug(n,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,n){const r=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",n,"url",r),Ds()&&!n.skipBrowserRedirect&&window.location.assign(r),{data:{provider:t,url:r},error:null}}async _recoverAndRefresh(){var t,n;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const a=await H0(this.storage,this.storageKey);if(a&&this.userStorage){let s=await H0(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!s&&(s={user:a.user},await $h(this.userStorage,this.storageKey+"-user",s)),a.user=(t=s==null?void 0:s.user)!==null&&t!==void 0?t:p2()}else if(a&&!a.user&&!a.user){const s=await H0(this.storage,this.storageKey+"-user");s&&(s!=null&&s.user)?(a.user=s.user,await Fs(this.storage,this.storageKey+"-user"),await $h(this.storage,this.storageKey,a)):a.user=p2()}if(this._debug(r,"session from storage",a),!this._isValidSession(a)){this._debug(r,"session is not valid"),a!==null&&await this._removeSession();return}const i=((n=a.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<u2;if(this._debug(r,`session has${i?"":" not"} expired with margin of ${u2}s`),i){if(this.autoRefreshToken&&a.refresh_token){const{error:s}=await this._callRefreshToken(a.refresh_token);s&&(console.error(s),f2(s)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",s),await this._removeSession()))}}else if(a.user&&a.user.__isUserNotAvailableProxy===!0)try{const{data:s,error:c}=await this._getUser(a.access_token);!c&&(s!=null&&s.user)?(a.user=s.user,await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(s){console.error("Error getting user data:",s),this._debug(r,"error getting user data, skipping SIGNED_IN notification",s)}else await this._notifyAllSubscribers("SIGNED_IN",a)}catch(a){this._debug(r,"error",a),console.error(a);return}finally{this._debug(r,"end")}}async _callRefreshToken(t){var n,r;if(!t)throw new Qi;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const a=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(a,"begin");try{this.refreshingDeferred=new Oy;const{data:i,error:s}=await this._refreshAccessToken(t);if(s)throw s;if(!i.session)throw new Qi;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const c={data:i.session,error:null};return this.refreshingDeferred.resolve(c),c}catch(i){if(this._debug(a,"error",i),sr(i)){const s={data:null,error:i};return f2(i)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(s),s}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(a,"end")}}async _notifyAllSubscribers(t,n,r=!0){const a=`#_notifyAllSubscribers(${t})`;this._debug(a,"begin",n,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:t,session:n});const i=[],s=Array.from(this.stateChangeEmitters.values()).map(async c=>{try{await c.callback(t,n)}catch(l){i.push(l)}});if(await Promise.all(s),i.length>0){for(let c=0;c<i.length;c+=1)console.error(i[c]);throw i[0]}}finally{this._debug(a,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await Fs(this.storage,`${this.storageKey}-code-verifier`);const n=Object.assign({},t),r=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&n.user&&await $h(this.userStorage,this.storageKey+"-user",{user:n.user});const a=Object.assign({},n);delete a.user;const i=jM(a);await $h(this.storage,this.storageKey,i)}else{const a=jM(n);await $h(this.storage,this.storageKey,a)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Fs(this.storage,this.storageKey),await Fs(this.storage,this.storageKey+"-code-verifier"),await Fs(this.storage,this.storageKey+"-user"),this.userStorage&&await Fs(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&Ds()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),Bh);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t);const n=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=n,n&&typeof n=="object"&&typeof n.unref=="function"?n.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(n)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t);const n=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,n&&clearTimeout(n)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async n=>{const{data:{session:r}}=n;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const a=Math.floor((r.expires_at*1e3-t)/Bh);this._debug("#_autoRefreshTokenTick()",`access token expires in ${a} ticks, a tick lasts ${Bh}ms, refresh threshold is ${Yx} ticks`),a<=Yx&&await this._callRefreshToken(r.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof SR)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Ds()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(t){this._debug("#visibilityChangedCallback","error",t)}},window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const n=`#_onVisibilityChanged(${t})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,n,r){const a=[`provider=${encodeURIComponent(n)}`];if(r!=null&&r.redirectTo&&a.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&a.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,s]=await dh(this.storage,this.storageKey),c=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(s)}`});a.push(c.toString())}if(r!=null&&r.queryParams){const i=new URLSearchParams(r.queryParams);a.push(i.toString())}return r!=null&&r.skipBrowserRedirect&&a.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${t}?${a.join("&")}`}async _unenroll(t){try{return await this._useSession(async n=>{var r;const{data:a,error:i}=n;return i?this._returnResult({data:null,error:i}):await Ar(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(r=a==null?void 0:a.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(sr(n))return this._returnResult({data:null,error:n});throw n}}async _enroll(t){try{return await this._useSession(async n=>{var r,a;const{data:i,error:s}=n;if(s)return this._returnResult({data:null,error:s});const c=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:l,error:d}=await Ar(this.fetch,"POST",`${this.url}/factors`,{body:c,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return d?this._returnResult({data:null,error:d}):(t.factorType==="totp"&&l.type==="totp"&&(!((a=l==null?void 0:l.totp)===null||a===void 0)&&a.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(n){if(sr(n))return this._returnResult({data:null,error:n});throw n}}async _verify(t){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async n=>{var r;const{data:a,error:i}=n;if(i)return this._returnResult({data:null,error:i});const s=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?mO(t.webauthn.credential_response):gO(t.webauthn.credential_response)})}:{code:t.code}),{data:c,error:l}=await Ar(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:s,headers:this.headers,jwt:(r=a==null?void 0:a.session)===null||r===void 0?void 0:r.access_token});return l?this._returnResult({data:null,error:l}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+c.expires_in},c)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",c),this._returnResult({data:c,error:l}))})}catch(n){if(sr(n))return this._returnResult({data:null,error:n});throw n}})}async _challenge(t){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async n=>{var r;const{data:a,error:i}=n;if(i)return this._returnResult({data:null,error:i});const s=await Ar(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(r=a==null?void 0:a.session)===null||r===void 0?void 0:r.access_token});if(s.error)return s;const{data:c}=s;if(c.type!=="webauthn")return{data:c,error:null};switch(c.webauthn.type){case"create":return{data:Object.assign(Object.assign({},c),{webauthn:Object.assign(Object.assign({},c.webauthn),{credential_options:Object.assign(Object.assign({},c.webauthn.credential_options),{publicKey:fO(c.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},c),{webauthn:Object.assign(Object.assign({},c.webauthn),{credential_options:Object.assign(Object.assign({},c.webauthn.credential_options),{publicKey:pO(c.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(n){if(sr(n))return this._returnResult({data:null,error:n});throw n}})}async _challengeAndVerify(t){const{data:n,error:r}=await this._challenge({factorId:t.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:t.factorId,challengeId:n.id,code:t.code})}async _listFactors(){var t;const{data:{user:n},error:r}=await this.getUser();if(r)return{data:null,error:r};const a={all:[],phone:[],totp:[],webauthn:[]};for(const i of(t=n==null?void 0:n.factors)!==null&&t!==void 0?t:[])a.all.push(i),i.status==="verified"&&a[i.factor_type].push(i);return{data:a,error:null}}async _getAuthenticatorAssuranceLevel(t){var n,r,a,i;if(t)try{const{payload:f}=vg(t);let g=null;f.aal&&(g=f.aal);let x=g;const{data:{user:v},error:b}=await this.getUser(t);if(b)return this._returnResult({data:null,error:b});((r=(n=v==null?void 0:v.factors)===null||n===void 0?void 0:n.filter(k=>k.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(x="aal2");const M=f.amr||[];return{data:{currentLevel:g,nextLevel:x,currentAuthenticationMethods:M},error:null}}catch(f){if(sr(f))return this._returnResult({data:null,error:f});throw f}const{data:{session:s},error:c}=await this.getSession();if(c)return this._returnResult({data:null,error:c});if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:l}=vg(s.access_token);let d=null;l.aal&&(d=l.aal);let u=d;((i=(a=s.user.factors)===null||a===void 0?void 0:a.filter(f=>f.status==="verified"))!==null&&i!==void 0?i:[]).length>0&&(u="aal2");const m=l.amr||[];return{data:{currentLevel:d,nextLevel:u,currentAuthenticationMethods:m},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async n=>{const{data:{session:r},error:a}=n;return a?this._returnResult({data:null,error:a}):r?await Ar(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:r.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new Qi})})}catch(n){if(sr(n))return this._returnResult({data:null,error:n});throw n}}async _approveAuthorization(t,n){try{return await this._useSession(async r=>{const{data:{session:a},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!a)return this._returnResult({data:null,error:new Qi});const s=await Ar(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:a.access_token,body:{action:"approve"},xform:c=>({data:c,error:null})});return s.data&&s.data.redirect_url&&Ds()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(s.data.redirect_url),s})}catch(r){if(sr(r))return this._returnResult({data:null,error:r});throw r}}async _denyAuthorization(t,n){try{return await this._useSession(async r=>{const{data:{session:a},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!a)return this._returnResult({data:null,error:new Qi});const s=await Ar(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:a.access_token,body:{action:"deny"},xform:c=>({data:c,error:null})});return s.data&&s.data.redirect_url&&Ds()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(s.data.redirect_url),s})}catch(r){if(sr(r))return this._returnResult({data:null,error:r});throw r}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:n},error:r}=t;return r?this._returnResult({data:null,error:r}):n?await Ar(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,xform:a=>({data:a,error:null})}):this._returnResult({data:null,error:new Qi})})}catch(t){if(sr(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async n=>{const{data:{session:r},error:a}=n;return a?this._returnResult({data:null,error:a}):r?(await Ar(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,query:{client_id:t.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Qi})})}catch(n){if(sr(n))return this._returnResult({data:null,error:n});throw n}}async fetchJwk(t,n={keys:[]}){let r=n.keys.find(c=>c.kid===t);if(r)return r;const a=Date.now();if(r=this.jwks.keys.find(c=>c.kid===t),r&&this.jwks_cached_at+CN>a)return r;const{data:i,error:s}=await Ar(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(s)throw s;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=a,r=i.keys.find(c=>c.kid===t),!r)?null:r}async getClaims(t,n={}){try{let r=t;if(!r){const{data:f,error:g}=await this.getSession();if(g||!f.session)return this._returnResult({data:null,error:g});r=f.session.access_token}const{header:a,payload:i,signature:s,raw:{header:c,payload:l}}=vg(r);n!=null&&n.allowExpired||VN(i.exp);const d=!a.alg||a.alg.startsWith("HS")||!a.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(a.kid,n!=null&&n.keys?{keys:n.keys}:n==null?void 0:n.jwks);if(!d){const{error:f}=await this.getUser(r);if(f)throw f;return{data:{claims:i,header:a,signature:s},error:null}}const u=UN(a.alg),h=await crypto.subtle.importKey("jwk",d,u,!0,["verify"]);if(!await crypto.subtle.verify(u,h,s,FN(`${c}.${l}`)))throw new Jx("Invalid JWT signature");return{data:{claims:i,header:a,signature:s},error:null}}catch(r){if(sr(r))return this._returnResult({data:null,error:r});throw r}}}om.nextInstanceID={};const kO=om,RO="2.98.0";let Ap="";typeof Deno<"u"?Ap="deno":typeof document<"u"?Ap="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ap="react-native":Ap="node";const AO={"X-Client-Info":`supabase-js-${Ap}/${RO}`},jO={headers:AO},EO={schema:"public"},TO={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},IO={};function am(e){"@babel/helpers - typeof";return am=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},am(e)}function PO(e,t){if(am(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(am(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function FO(e){var t=PO(e,"string");return am(t)=="symbol"?t:t+""}function _O(e,t,n){return(t=FO(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function NM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function Oa(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?NM(Object(n),!0).forEach(function(r){_O(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):NM(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const NO=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),OO=()=>Headers,DO=(e,t,n)=>{const r=NO(n),a=OO();return async(i,s)=>{var c;const l=(c=await t())!==null&&c!==void 0?c:e;let d=new a(s==null?void 0:s.headers);return d.has("apikey")||d.set("apikey",e),d.has("Authorization")||d.set("Authorization",`Bearer ${l}`),r(i,Oa(Oa({},s),{},{headers:d}))}};function LO(e){return e.endsWith("/")?e:e+"/"}function zO(e,t){var n,r;const{db:a,auth:i,realtime:s,global:c}=e,{db:l,auth:d,realtime:u,global:h}=t,m={db:Oa(Oa({},l),a),auth:Oa(Oa({},d),i),realtime:Oa(Oa({},u),s),storage:{},global:Oa(Oa(Oa({},h),c),{},{headers:Oa(Oa({},(n=h==null?void 0:h.headers)!==null&&n!==void 0?n:{}),(r=c==null?void 0:c.headers)!==null&&r!==void 0?r:{})}),accessToken:async()=>""};return e.accessToken?m.accessToken=e.accessToken:delete m.accessToken,m}function BO(e){const t=e==null?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(LO(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var $O=class extends kO{constructor(e){super(e)}},qO=class{constructor(e,t,n){var r,a;this.supabaseUrl=e,this.supabaseKey=t;const i=BO(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const s=`sb-${i.hostname.split(".")[0]}-auth-token`,c={db:EO,realtime:IO,auth:Oa(Oa({},TO),{},{storageKey:s}),global:jO},l=zO(n??{},c);if(this.storageKey=(r=l.auth.storageKey)!==null&&r!==void 0?r:"",this.headers=(a=l.global.headers)!==null&&a!==void 0?a:{},l.accessToken)this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(u,h)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(h)} is not possible`)}});else{var d;this.auth=this._initSupabaseAuthClient((d=l.auth)!==null&&d!==void 0?d:{},this.headers,l.global.fetch)}this.fetch=DO(t,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(Oa({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(u=>this.realtime.setAuth(u)).catch(u=>console.warn("Failed to set initial Realtime auth token:",u)),this.rest=new R_(new URL("rest/v1",i).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch,timeout:l.db.timeout,urlLengthLimit:l.db.urlLengthLimit}),this.storage=new xN(this.storageUrl.href,this.headers,this.fetch,n==null?void 0:n.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new b_(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},n={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,n)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e=this,t,n;if(e.accessToken)return await e.accessToken();const{data:r}=await e.auth.getSession();return(t=(n=r.session)===null||n===void 0?void 0:n.access_token)!==null&&t!==void 0?t:e.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:r,userStorage:a,storageKey:i,flowType:s,lock:c,debug:l,throwOnError:d},u,h){const m={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new $O({url:this.authUrl.href,headers:Oa(Oa({},m),u),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:r,userStorage:a,flowType:s,lock:c,debug:l,throwOnError:d,fetch:h,hasCustomAuthorizationHeader:Object.keys(this.headers).some(f=>f.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new H_(this.realtimeUrl.href,Oa(Oa({},e),{},{params:Oa(Oa({},{apikey:this.supabaseKey}),e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",t==null?void 0:t.access_token)})}_handleTokenChanged(e,t,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?(this.changedAccessToken=n,this.realtime.setAuth(n)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const HO=(e,t,n)=>new qO(e,t,n);function WO(){if(typeof window<"u")return!1;const e=globalThis.process;if(!e)return!1;const t=e.version;if(t==null)return!1;const n=t.match(/^v(\d+)\./);return n?parseInt(n[1],10)<=18:!1}WO()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Dy="bszwzwfmrqmawgrblvhe",uS="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJzend6d2ZtcnFtYXdncmJsdmhlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4MTY0NTAsImV4cCI6MjA4NzM5MjQ1MH0.n18qb0rZARSiZXpnw6muaL9wTOLi5SZUWbUaTyVuMKo",Yi="'IBM Plex Mono', monospace",GO="'Doto', monospace",OM="rgba(255,255,255,0.06)",VO="rgba(255,255,255,0.05)",UO="rgba(0,0,0,0.94)",YO=`https://${Dy}.supabase.co/functions/v1/make-server-0834700c`,uf=HO(`https://${Dy}.supabase.co`,uS),X5=8;function KO(e){if(e.length<X5)return{ok:!1,message:`Senha deve ter pelo menos ${X5} caracteres.`};const t=/[a-zA-Z]/.test(e),n=/[0-9]/.test(e);return!t||!n?{ok:!1,message:"Use letras e nmeros na senha."}:{ok:!0}}function CR({onClose:e,onAuthChange:t}){const[n,r]=S.useState("login"),[a,i]=S.useState(""),[s,c]=S.useState(""),[l,d]=S.useState(""),[u,h]=S.useState(!1),[m,f]=S.useState(!1),[g,x]=S.useState(""),[v,b]=S.useState(""),[w,M]=S.useState(!1),k=async E=>{if(E.preventDefault(),!a.trim()){x("Digite seu email e clique em Esqueci a senha.");return}x(""),M(!1);try{const{error:O}=await uf.auth.resetPasswordForEmail(a.trim(),{redirectTo:typeof window<"u"?`${window.location.origin}/`:void 0});if(O)throw O;M(!0),b("Se esse email estiver cadastrado, voc receber um link para redefinir a senha.")}catch(O){x(O.message||"Erro ao enviar email.")}},R={width:"100%",padding:"9px 12px",borderRadius:10,background:VO,border:"1px dashed rgba(255,255,255,0.1)",color:"#fff",fontSize:11,outline:"none",fontFamily:Yi,letterSpacing:"0.02em",boxSizing:"border-box",transition:"border-color 0.15s"},j=async E=>{var O,L,$;if(E.preventDefault(),!a.trim()||!s.trim()){x("Preencha email e senha.");return}f(!0),x("");try{const{data:F,error:B}=await uf.auth.signInWithPassword({email:a.trim(),password:s});if(B)throw B;const W=(O=F.session)==null?void 0:O.user,re=(L=F.session)==null?void 0:L.access_token;if(!W||!re)throw new Error("Login falhou  sem sesso.");typeof t=="function"&&t({id:W.id,email:W.email,name:($=W.user_metadata)==null?void 0:$.name,accessToken:re}),b("Login realizado! Colees sincronizadas."),setTimeout(()=>e(),1e3)}catch(F){x(F.message||"Erro ao fazer login.")}finally{f(!1)}},I=async E=>{var L,$,F;if(E.preventDefault(),!a.trim()||!s.trim()){x("Preencha email e senha.");return}if(s.length<X5){x(`Senha deve ter pelo menos ${X5} caracteres.`);return}const O=KO(s);if(!O.ok){x(O.message||"Senha invlida.");return}f(!0),x("");try{const B=await fetch(`${YO}/auth/signup`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${uS}`},body:JSON.stringify({email:a.trim(),password:s,name:l.trim()||void 0})}),W=await B.json();if(!B.ok||!W.success)throw new Error(W.error||"Erro ao criar conta.");const{data:re,error:oe}=await uf.auth.signInWithPassword({email:a.trim(),password:s});if(oe)throw oe;const te=(L=re.session)==null?void 0:L.user,J=($=re.session)==null?void 0:$.access_token;if(!te||!J)throw new Error("Conta criada mas login falhou. Tente fazer login.");typeof t=="function"&&t({id:te.id,email:te.email,name:((F=te.user_metadata)==null?void 0:F.name)||l,accessToken:J}),b("Conta criada! Bem-vindo ao Rhizome."),setTimeout(()=>e(),1e3)}catch(B){x(B.message||"Erro ao criar conta.")}finally{f(!1)}};return o.jsxs("div",{style:{position:"fixed",inset:0,zIndex:1e3,background:"rgba(0,0,0,0.8)",backdropFilter:"blur(8px)",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:Yi},onClick:e,children:[o.jsxs("div",{style:{width:360,background:UO,border:`1px dashed ${OM}`,borderRadius:10,padding:"24px 24px 20px",boxShadow:"0 24px 64px rgba(0,0,0,0.6)",position:"relative"},onClick:E=>E.stopPropagation(),children:[o.jsx("button",{title:"Fechar",onClick:e,style:{position:"absolute",top:12,right:12,background:"none",border:"none",cursor:"pointer",color:"rgba(255,255,255,0.3)",padding:4},children:o.jsx(Cs,{size:14,strokeWidth:2})}),o.jsxs("div",{style:{marginBottom:20,textAlign:"center"},children:[o.jsx("div",{style:{fontSize:9,letterSpacing:"0.18em",color:"rgba(255,255,255,0.35)",textTransform:"uppercase",marginBottom:6,fontFamily:Yi},children:"Devices for Intuition"}),o.jsx("div",{style:{fontSize:15,color:"rgba(255,255,255,0.9)",fontWeight:500,marginBottom:4,fontFamily:GO,letterSpacing:"0.02em"},children:n==="login"?"Entrar":"Criar conta"}),o.jsx("div",{style:{fontSize:10,color:"rgba(255,255,255,0.4)",letterSpacing:"0.04em",fontFamily:Yi},children:n==="login"?"Colees sincronizadas entre dispositivos":"Pesquisa rizomtica persistente em todos os dispositivos"})]}),o.jsx("div",{style:{display:"flex",gap:4,marginBottom:18,background:"rgba(255,255,255,0.02)",borderRadius:10,padding:3,border:`1px dashed ${OM}`},children:["login","register"].map(E=>o.jsx("button",{title:E,onClick:()=>{r(E),x(""),b(""),M(!1)},style:{flex:1,padding:"6px 0",borderRadius:8,cursor:"pointer",background:n===E?"rgba(255,255,255,0.06)":"transparent",border:n===E?"1px dashed rgba(255,255,255,0.12)":"1px dashed transparent",color:n===E?"rgba(255,255,255,0.85)":"rgba(255,255,255,0.35)",fontSize:10,fontWeight:n===E?600:400,fontFamily:Yi,letterSpacing:"0.06em",textTransform:"uppercase",transition:"all 0.15s"},children:E==="login"?"Entrar":"Cadastrar"},E))}),o.jsxs("form",{onSubmit:n==="login"?j:I,children:[n==="register"&&o.jsxs("div",{style:{marginBottom:12},children:[o.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.4)",letterSpacing:"0.06em",marginBottom:4,textTransform:"uppercase",fontFamily:Yi},children:"Nome (opcional)"}),o.jsx("input",{type:"text",placeholder:"Seu nome",value:l,onChange:E=>d(E.target.value),style:R,onFocus:E=>E.currentTarget.style.borderColor="rgba(255,255,255,0.2)",onBlur:E=>E.currentTarget.style.borderColor="rgba(255,255,255,0.1)"})]}),o.jsxs("div",{style:{marginBottom:12},children:[o.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.4)",letterSpacing:"0.06em",marginBottom:4,textTransform:"uppercase",fontFamily:Yi},children:"Email"}),o.jsx("input",{type:"email",placeholder:"seu@email.com",value:a,onChange:E=>i(E.target.value),style:R,autoFocus:!0,onFocus:E=>E.currentTarget.style.borderColor="rgba(255,255,255,0.2)",onBlur:E=>E.currentTarget.style.borderColor="rgba(255,255,255,0.1)"})]}),o.jsxs("div",{style:{marginBottom:n==="login"?8:20},children:[o.jsxs("div",{style:{fontSize:9,color:"rgba(255,255,255,0.4)",letterSpacing:"0.06em",marginBottom:4,textTransform:"uppercase",fontFamily:Yi},children:["Senha ",n==="register"&&o.jsx("span",{style:{color:"rgba(255,255,255,0.25)"},children:"(mn. 8 caracteres, letras e nmeros)"})]}),o.jsxs("div",{style:{position:"relative"},children:[o.jsx("input",{type:u?"text":"password",placeholder:"",value:s,onChange:E=>c(E.target.value),style:{...R,paddingRight:36},onFocus:E=>E.currentTarget.style.borderColor="rgba(255,255,255,0.2)",onBlur:E=>E.currentTarget.style.borderColor="rgba(255,255,255,0.1)"}),o.jsx("button",{title:u?"Esconder senha":"Mostrar senha",type:"button",onClick:()=>h(E=>!E),style:{position:"absolute",right:10,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"rgba(255,255,255,0.3)"},children:u?o.jsx(Xp,{size:12}):o.jsx(jl,{size:12})})]}),n==="login"&&o.jsx("button",{type:"button",onClick:k,style:{marginTop:6,background:"none",border:"none",cursor:"pointer",fontSize:9,color:"rgba(255,255,255,0.4)",textDecoration:"underline",fontFamily:Yi,letterSpacing:"0.04em"},children:"Esqueci a senha"})]}),g&&o.jsx("div",{style:{marginBottom:14,padding:"8px 12px",borderRadius:10,background:"rgba(255,255,255,0.03)",border:"1px dashed rgba(255,255,255,0.12)",fontSize:10,color:"rgba(255,255,255,0.6)",lineHeight:1.4,fontFamily:Yi},children:g}),v&&o.jsx("div",{style:{marginBottom:14,padding:"8px 12px",borderRadius:10,background:"rgba(255,255,255,0.03)",border:"1px dashed rgba(255,255,255,0.12)",fontSize:10,color:"rgba(255,255,255,0.6)",fontFamily:Yi},children:v}),o.jsx("button",{title:m?"Carregando...":n==="login"?"Entrar":"Criar conta",type:"submit",disabled:m,style:{width:"100%",padding:"10px 0",borderRadius:10,cursor:m?"not-allowed":"pointer",background:m?"rgba(255,255,255,0.04)":"rgba(255,255,255,0.08)",border:`1px dashed ${m?"rgba(255,255,255,0.08)":"rgba(255,255,255,0.15)"}`,color:m?"rgba(255,255,255,0.35)":"rgba(255,255,255,0.85)",fontSize:11,fontWeight:600,letterSpacing:"0.08em",textTransform:"uppercase",fontFamily:Yi,display:"flex",alignItems:"center",justifyContent:"center",gap:7,transition:"all 0.15s"},children:m?o.jsxs(o.Fragment,{children:[o.jsx("span",{style:{fontSize:11,animation:"spin 1s linear infinite",display:"inline-block"},children:""}),n==="login"?"Entrando...":"Criando conta..."]}):n==="login"?o.jsxs(o.Fragment,{children:[o.jsx(kP,{size:11,strokeWidth:2})," Entrar"]}):o.jsxs(o.Fragment,{children:[o.jsx(jF,{size:11,strokeWidth:2})," Criar conta"]})})]}),o.jsx("div",{style:{marginTop:14,fontSize:8,color:"rgba(255,255,255,0.2)",textAlign:"center",lineHeight:1.5,fontFamily:Yi,letterSpacing:"0.03em"},children:"Colees sincronizadas entre dispositivos. Sem conta, dados ficam apenas neste browser."})]}),o.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})}function vm(){const[e,t]=on.useState(null),[n,r]=on.useState(!0);return on.useEffect(()=>{uf.auth.getSession().then(({data:{session:s}})=>{var c;s!=null&&s.user&&(s!=null&&s.access_token)&&t({id:s.user.id,email:s.user.email,name:(c=s.user.user_metadata)==null?void 0:c.name,accessToken:s.access_token}),r(!1)});const{data:{subscription:i}}=uf.auth.onAuthStateChange((s,c)=>{var l;c!=null&&c.user&&(c!=null&&c.access_token)?t({id:c.user.id,email:c.user.email,name:(l=c.user.user_metadata)==null?void 0:l.name,accessToken:c.access_token}):t(null)});return()=>i.unsubscribe()},[]),{user:e,loading:n,signOut:async()=>{await uf.auth.signOut(),t(null)},setUser:t}}const Ly=`https://${Dy}.supabase.co/functions/v1/make-server-0834700c`;function zy(){const e="rhizome_device_id";let t=localStorage.getItem(e);return t||(t=`device_${Date.now()}_${Math.random().toString(36).slice(2,11)}`,localStorage.setItem(e,t)),t}function hS(){return localStorage.getItem("rhizome_access_token")}function hf(e){e?localStorage.setItem("rhizome_access_token",e):localStorage.removeItem("rhizome_access_token")}function By(){return{Authorization:`Bearer ${hS()||uS}`,"Content-Type":"application/json"}}async function XO(){try{const e=zy(),t=await fetch(`${Ly}/rhizome/folders/${e}`,{method:"GET",headers:By()});return t.ok?(await t.json()).folders||[]:[]}catch(e){return console.error("Error loading folders from backend:",e),[]}}async function JO(e){try{const t=zy();return(await fetch(`${Ly}/rhizome/folders/${t}`,{method:"POST",headers:By(),body:JSON.stringify({folders:e})})).ok}catch(t){return console.error("Error saving folders to backend:",t),!1}}async function QO(){try{const e=zy(),t=await fetch(`${Ly}/rhizome/saved/${e}`,{method:"GET",headers:By()});return t.ok?(await t.json()).rhizomes||[]:[]}catch(e){return console.error("Error loading rhizomes from backend:",e),[]}}async function ZO(e){try{const t=zy();return(await fetch(`${Ly}/rhizome/saved/${t}`,{method:"POST",headers:By(),body:JSON.stringify({rhizomes:e})})).ok}catch(t){return console.error("Error saving rhizomes to backend:",t),!1}}const J5=Object.freeze(Object.defineProperty({__proto__:null,getStoredToken:hS,loadFoldersFromBackend:XO,loadRhizomesFromBackend:QO,saveFoldersToBackend:JO,saveRhizomesToBackend:ZO,setStoredToken:hf},Symbol.toStringTag,{value:"Module"})),eD="t4p_hub",tD="t4p_anon",kR=`https://${Dy}.supabase.co/functions/v1/make-server-0834700c`;function RR(e,t,n){return n?`${eD}_user_${n}_lab_${e}_${t}`:`${tD}_lab_${e}_${t}`}function AR(){const e=hS();return{"Content-Type":"application/json",...e?{Authorization:`Bearer ${e}`}:{}}}function Q5(e,t,n){try{const r=RR(e,t,n),a=localStorage.getItem(r);if(!a)return[];const i=JSON.parse(a);return Array.isArray(i)?i:[]}catch{return[]}}function jR(e,t,n,r){try{const a=RR(e,t,r);localStorage.setItem(a,JSON.stringify(n))}catch(a){console.warn("[userStorage] setHubDataLocal failed:",a)}}async function nD(e,t){try{const n=await fetch(`${kR}/user/hub?lab=${encodeURIComponent(e)}`,{method:"GET",headers:AR()});if(!n.ok)return null;const r=await n.json();return{presets:Array.isArray(r.presets)?r.presets:[],saves:Array.isArray(r.saves)?r.saves:[]}}catch(n){return console.warn("[userStorage] loadHubFromBackend failed:",n),null}}async function ER(e,t,n){try{return(await fetch(`${kR}/user/hub`,{method:"POST",headers:AR(),body:JSON.stringify({lab:e,...t})})).ok}catch(r){return console.warn("[userStorage] saveHubToBackend failed:",r),!1}}async function fS(e,t){var i,s;const n=Q5(e,"presets",t),r=Q5(e,"saves",t);if(!t)return{presets:n,saves:r};const a=await nD(e);if(a){const c=(((i=a.presets)==null?void 0:i.length)??0)>0?a.presets:n,l=(((s=a.saves)==null?void 0:s.length)??0)>0?a.saves:r;return{presets:c,saves:l}}return{presets:n,saves:r}}function rD(e,t,n,r){jR(e,t,n,r),r&&ER(e,t==="presets"?{presets:n}:{saves:n}).catch(()=>{})}function Z5(e,t,n,r){const a=Q5(e,t,r),i={...n,id:n.id??`${t}_${Date.now()}_${Math.random().toString(36).slice(2,9)}`},s=[...a,i];jR(e,t,s,r),r&&ER(e,t==="presets"?{presets:s}:{saves:s}).catch(()=>{})}function ey(e,t,n,r){const i=Q5(e,t,r).filter(s=>s.id!==n);rD(e,t,i,r)}const Qx="t4p_openai_api_key";function pS(){try{if(typeof window>"u")return"";const e=localStorage.getItem(Qx);return typeof e=="string"?e:""}catch{return""}}function oD(e){try{e?localStorage.setItem(Qx,e):localStorage.removeItem(Qx)}catch(t){console.warn("[userStorage] saveOpenAIApiKey failed:",t)}}const g2="complexityLife",DM=({onSave:e,onLoad:t})=>{const[n,r]=S.useState(""),[a,i]=S.useState(uM()),s=S.useRef(null),{user:c}=vm(),l=(c==null?void 0:c.id)??null,[d,u]=S.useState([]),[h,m]=S.useState(!1),f=async()=>{m(!0);try{const j=await fS(g2,l),I=Array.isArray(j.saves)?j.saves:[];u(I)}finally{m(!1)}};S.useEffect(()=>{f()},[l]);const g=()=>{i(uM())},x=j=>{const I=n.trim()||`Slot ${j+1}`,E=e(I);h_(E,j),g()},v=j=>{const I=f_(j);I&&t(I)},b=j=>{p_(j),g()},w=()=>{const j=n.trim()||"Export",I=e(j);d_(I)},M=()=>{var j;(j=s.current)==null||j.click()},k=async j=>{var E;const I=(E=j.target.files)==null?void 0:E[0];if(I){try{const O=await u_(I);t(O)}catch(O){console.error("Failed to load file:",O),alert("Failed to load file. Please check the file format.")}s.current&&(s.current.value="")}},R=j=>new Date(j).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx("label",{className:"text-white/70 text-xs font-mono",children:"Save Name"}),o.jsx("input",{type:"text",value:n,onChange:j=>r(j.target.value),placeholder:"Enter save name...",className:"w-full bg-white/5 border border-white/10 rounded px-3 py-2 text-white text-sm focus:outline-none focus:border-white/30"})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs("button",{onClick:w,className:"flex-1 flex items-center justify-center gap-2 bg-blue-600/20 hover:bg-blue-600/30 border border-blue-500/30 rounded px-3 py-2 text-blue-300 text-sm transition-colors",children:[o.jsx(aS,{size:16}),"Export"]}),o.jsxs("button",{onClick:M,className:"flex-1 flex items-center justify-center gap-2 bg-green-600/20 hover:bg-green-600/30 border border-green-500/30 rounded px-3 py-2 text-green-300 text-sm transition-colors",children:[o.jsx(Tu,{size:16}),"Import"]})]}),o.jsx("input",{ref:s,type:"file",accept:".json",onChange:k,className:"hidden"}),o.jsxs("div",{className:"border-t border-white/10 pt-4 space-y-2",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("label",{className:"text-white/70 text-xs font-mono",children:"Quick Save Slots"}),o.jsx("button",{onClick:g,className:"text-white/50 hover:text-white/80 text-xs",children:"Refresh"})]}),o.jsx("div",{className:"space-y-1 max-h-60 overflow-y-auto",children:[0,1,2,3,4].map(j=>{const I=a.find(E=>E.slot===j);return o.jsxs("div",{className:"flex items-center gap-2 bg-white/5 hover:bg-white/10 rounded p-2 transition-colors",children:[o.jsx("span",{className:"text-white/40 text-xs font-mono w-6",children:j+1}),I?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("div",{className:"text-white text-sm truncate",children:I.name}),o.jsxs("div",{className:"flex items-center gap-1 text-white/40 text-xs",children:[o.jsx(Bu,{size:10}),R(I.timestamp)]})]}),o.jsx("button",{onClick:()=>v(j),className:"p-1.5 hover:bg-white/10 rounded transition-colors",title:"Load",children:o.jsx(Tu,{size:14,className:"text-green-400"})}),o.jsx("button",{onClick:()=>b(j),className:"p-1.5 hover:bg-white/10 rounded transition-colors",title:"Delete",children:o.jsx(il,{size:14,className:"text-red-400"})})]}):o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"flex-1 text-white/30 text-sm italic",children:"Empty slot"}),o.jsx("button",{onClick:()=>x(j),className:"p-1.5 hover:bg-white/10 rounded transition-colors",title:"Save to slot",children:o.jsx(Jp,{size:14,className:"text-blue-400"})})]})]},j)})})]}),o.jsxs("div",{className:"border-t border-white/10 pt-4 space-y-2",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("label",{className:"text-white/70 text-xs font-mono flex items-center gap-1",children:[l?o.jsx(rS,{size:10,className:"text-blue-400"}):null,"Meus presets ",l?"(conta)":"(entre para sincronizar)"]}),l&&o.jsx("button",{onClick:f,disabled:h,className:"text-white/50 hover:text-white/80 text-xs disabled:opacity-50",children:h?"...":"Refresh"})]}),o.jsxs("div",{className:"space-y-1 max-h-48 overflow-y-auto",children:[d.length===0&&!h&&o.jsx("div",{className:"text-white/30 text-xs italic py-2",children:"Nenhum preset salvo na conta."}),d.map(j=>o.jsxs("div",{className:"flex items-center gap-2 bg-white/5 hover:bg-white/10 rounded p-2 transition-colors",children:[o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("div",{className:"text-white text-sm truncate",children:j.name}),o.jsxs("div",{className:"flex items-center gap-1 text-white/40 text-xs",children:[o.jsx(Bu,{size:10}),R(j.timestamp)]})]}),o.jsx("button",{onClick:()=>t(j.snapshot),className:"p-1.5 hover:bg-white/10 rounded transition-colors",title:"Carregar",children:o.jsx(Tu,{size:14,className:"text-green-400"})}),l&&o.jsx("button",{onClick:()=>{ey(g2,"saves",j.id,l),u(I=>I.filter(E=>E.id!==j.id))},className:"p-1.5 hover:bg-white/10 rounded transition-colors",title:"Excluir",children:o.jsx(il,{size:14,className:"text-red-400"})})]},j.id))]}),(l||!c)&&o.jsxs("div",{className:"flex gap-2 pt-1",children:[o.jsx("input",{type:"text",placeholder:"Nome do preset",value:n,onChange:j=>r(j.target.value),className:"flex-1 bg-white/5 border border-white/10 rounded px-2 py-1.5 text-white text-xs focus:outline-none focus:border-white/30"}),o.jsxs("button",{onClick:()=>{const j=n.trim()||`Preset ${Date.now()}`,I=e(j),E={id:`save_${Date.now()}_${Math.random().toString(36).slice(2,9)}`,name:j,timestamp:Date.now(),snapshot:I};Z5(g2,"saves",E,l),u(O=>[...O,E]),r("")},className:"flex items-center gap-1 bg-blue-600/20 hover:bg-blue-600/30 border border-blue-500/30 rounded px-2 py-1.5 text-blue-300 text-xs transition-colors",children:[o.jsx(Jp,{size:12}),"Salvar na conta"]})]})]}),o.jsx("div",{className:"bg-white/5 rounded p-3 border border-white/10",children:o.jsxs("div",{className:"flex items-start gap-2",children:[o.jsx(Bx,{size:14,className:"text-white/50 mt-0.5 flex-shrink-0"}),o.jsx("p",{className:"text-white/50 text-xs leading-relaxed",children:"Quick saves are stored locally in your browser. Use Export to download a file for backup or sharing."})]})})]})},LM=({organisms:e,onSpawnOrganism:t,onDeleteOrganism:n,onRenameOrganism:r,captureMode:a,onCaptureModeChange:i,brushRadius:s,onBrushRadiusChange:c})=>{const[l,d]=S.useState(null),[u,h]=S.useState(null),[m,f]=S.useState(""),g=x=>{m.trim()&&r(x,m.trim()),h(null),f("")};return o.jsxs("div",{className:"space-y-3 overflow-y-auto max-h-[calc(100vh-200px)]",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("h2",{className:"text-white/80 text-[11px] tracking-[0.15em] uppercase font-light",children:"Codex"}),o.jsxs("div",{className:"text-white/40 text-[9px] font-mono",children:[e.length," organisms"]})]}),o.jsxs("div",{className:"p-3 space-y-3",style:{border:"1px dashed rgba(255,255,255,0.04)",background:"rgba(0,0,0,0.05)"},children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-white/60 text-[10px] uppercase tracking-wide font-light",children:"Capture Mode"}),o.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[o.jsx("input",{type:"checkbox",checked:a,onChange:x=>i(x.target.checked),className:"sr-only peer"}),o.jsx("div",{className:"w-9 h-5 bg-white/10 peer-focus:outline-none peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white/40 after:border-white/20 after:border after:h-4 after:w-4 after:transition-all peer-checked:bg-yellow-500/30 peer-checked:after:bg-yellow-400"})]})]}),a&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"space-y-1.5",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("label",{className:"text-white/50 text-[9px] uppercase tracking-wide font-light",children:"Brush Radius"}),o.jsxs("span",{className:"text-white/40 text-[9px] font-mono",children:[s,"px"]})]}),o.jsx("input",{type:"range",min:20,max:200,step:5,value:s,onChange:x=>c(Number(x.target.value)),className:"w-full h-1.5 bg-white/10 appearance-none cursor-pointer accent-yellow-500"})]}),o.jsx("div",{className:"text-white/40 text-[9px] leading-relaxed p-2",style:{background:"rgba(255,212,0,0.03)",border:"1px dashed rgba(255,212,0,0.08)"},children:o.jsxs("div",{className:"flex items-start gap-1.5",children:[o.jsx("span",{className:"text-yellow-400/80",children:""}),o.jsxs("div",{children:[o.jsx("div",{className:"font-medium text-yellow-400/90 mb-0.5",children:"Capture Instructions:"}),o.jsx("div",{children:" Click on canvas to capture organism"}),o.jsx("div",{children:" Adjust brush radius to control area"}),o.jsx("div",{children:" Captured organisms appear below"})]})]})})]})]}),e.length===0?o.jsxs("div",{className:"text-white/30 text-[10px] text-center py-8 space-y-2",style:{border:"1px dashed rgba(255,255,255,0.04)"},children:[o.jsx("p",{children:"No organisms captured yet"}),o.jsx("p",{className:"text-white/20 text-[9px]",children:"Enable capture mode and click on canvas"})]}):o.jsx("div",{className:"grid grid-cols-2 gap-2",children:e.map(x=>o.jsxs("div",{className:`
                relative border p-2 cursor-pointer transition-all
                ${l===x.id?"border-white/30 bg-white/[0.04]":"border-white/10 hover:border-white/20"}
              `,onClick:()=>d(x.id),children:[o.jsx("div",{className:"flex justify-center mb-2 bg-black/10 overflow-hidden",children:x.thumbnail?o.jsx("img",{src:x.thumbnail,alt:x.name,className:"w-full h-auto",style:{imageRendering:"pixelated"}}):o.jsx("div",{className:"w-full aspect-square flex items-center justify-center text-white/20 text-[8px]",children:"No preview"})}),u===x.id?o.jsx("input",{type:"text",value:m,onChange:v=>f(v.target.value),onBlur:()=>g(x.id),onKeyDown:v=>{v.key==="Enter"&&g(x.id),v.key==="Escape"&&(h(null),f(""))},className:"w-full bg-white/5 px-1 py-0.5 text-white text-[9px] font-mono focus:outline-none",style:{border:"1px dashed rgba(255,255,255,0.10)"},autoFocus:!0}):o.jsx("div",{className:"text-white/70 text-[9px] font-mono text-center truncate mb-1",onDoubleClick:()=>{h(x.id),f(x.name)},children:x.name}),o.jsxs("div",{className:"text-white/40 text-[8px] text-center mb-2",children:[x.particles.length," particles"]}),o.jsxs("div",{className:"flex gap-1",children:[o.jsx("button",{onClick:v=>{v.stopPropagation(),t(x.id)},className:"flex-1 text-white/60 hover:text-white text-[8px] uppercase py-1 transition-all",style:{border:"1px dashed rgba(255,255,255,0.06)"},children:"Summon"}),o.jsx("button",{onClick:v=>{v.stopPropagation(),window.confirm(`Delete ${x.name}?`)&&(n(x.id),l===x.id&&d(null))},className:"text-red-400/60 hover:text-red-400 text-[8px] uppercase px-2 py-1 transition-all",style:{border:"1px dashed rgba(255,80,80,0.15)"},children:""})]})]},x.id))}),l&&e.find(x=>x.id===l)&&o.jsx("div",{className:"border-t border-white/[0.06] pt-3 mt-3",children:(()=>{const x=e.find(v=>v.id===l);return o.jsxs("div",{className:"space-y-2 text-[9px] text-white/50 font-mono",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Size:"}),o.jsxs("span",{children:[x.width.toFixed(2),"  ",x.height.toFixed(2)]})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Captured:"}),o.jsx("span",{children:new Date(x.timestamp).toLocaleTimeString()})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Types:"}),o.jsx("span",{children:x.captureContext.typesCount})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Seed:"}),o.jsxs("span",{children:["#",x.captureContext.seed.toString(16).slice(0,6)]})]})]})})()})]})},zM=({fps:e,particleCount:t,fieldCellCount:n,artifactCount:r,speciesCount:a,avgTension:i,avgCohesion:s,avgScarcity:c,diversity:l,stats:d})=>{const[u,h]=S.useState([]),[m,f]=S.useState(0);S.useEffect(()=>{if(h(k=>{const R=[...k,e];return R.length>60&&R.shift(),R}),performance&&performance.memory){const R=performance.memory.usedJSHeapSize/(1024*1024);f(R)}},[e]);const g=u.length>0?u.reduce((k,R)=>k+R,0)/u.length:e,x=u.length>0?Math.min(...u):e,v=u.length>0?Math.max(...u):e,b=({icon:k,label:R,value:j,color:I="text-white/60"})=>o.jsxs("div",{className:"flex items-center justify-between py-1",children:[o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx("div",{className:"text-white/40",children:k}),o.jsx("span",{className:"text-white/40 text-[10px] uppercase tracking-wide",children:R})]}),o.jsx("span",{className:`font-mono text-[10px] ${I}`,children:j})]}),w=({label:k,value:R,max:j=1,color:I})=>{const E=Math.min(100,R/j*100);return o.jsxs("div",{className:"space-y-1",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-white/40 text-[10px] uppercase tracking-wide",children:k}),o.jsx("span",{className:"text-white/60 text-[10px] font-mono",children:R.toFixed(2)})]}),o.jsx("div",{className:"w-full h-1 bg-white/5 overflow-hidden",children:o.jsx("div",{className:`h-full ${I} transition-all duration-300`,style:{width:`${E}%`}})})]})},M=k=>k>=55?"text-white/80":k>=30?"text-white/60":"text-white/40";return o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"bg-white/[0.02] p-2.5",style:{border:"1px dashed rgba(255,255,255,0.04)"},children:[o.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[o.jsx(o0,{size:12,className:"text-white/50",strokeWidth:1.5}),o.jsx("h3",{className:"text-white/70 text-[10px] uppercase tracking-wider",children:"Taxa de Quadros"})]}),o.jsxs("div",{className:"space-y-1.5",children:[o.jsx(b,{icon:o.jsx(zi,{size:11,strokeWidth:1.5}),label:"Atual",value:`${e}`,color:M(e)}),o.jsx(b,{icon:o.jsx(o0,{size:11,strokeWidth:1.5}),label:"Mdia",value:`${g.toFixed(1)}`,color:M(g)}),o.jsxs("div",{className:"flex items-center justify-between text-[9px] pt-0.5",children:[o.jsxs("span",{className:"text-white/30",children:["Mn: ",x.toFixed(0)]}),o.jsxs("span",{className:"text-white/30",children:["Mx: ",v.toFixed(0)]})]})]}),o.jsx("div",{className:"mt-2 h-10 flex items-end gap-[1px]",children:u.slice(-30).map((k,R)=>{const j=Math.max(2,k/60*100),I=k>=55?"bg-white/40":k>=30?"bg-white/25":"bg-white/15";return o.jsx("div",{className:`flex-1 ${I} transition-all`,style:{height:`${j}%`}},R)})})]}),o.jsxs("div",{className:"bg-white/[0.02] p-2.5",style:{border:"1px dashed rgba(255,255,255,0.04)"},children:[o.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[o.jsx(DI,{size:12,className:"text-white/50",strokeWidth:1.5}),o.jsx("h3",{className:"text-white/70 text-[10px] uppercase tracking-wider",children:"Carga do Sistema"})]}),o.jsxs("div",{className:"space-y-1.5",children:[o.jsx(b,{icon:o.jsx(r2,{size:11,strokeWidth:1.5}),label:"Partculas",value:t.toLocaleString(),color:"text-white/70"}),o.jsx(b,{icon:o.jsx(cf,{size:11,strokeWidth:1.5}),label:"Clulas Campo",value:n.toLocaleString(),color:"text-white/60"}),o.jsx(b,{icon:o.jsx(zi,{size:11,strokeWidth:1.5}),label:"Artefatos",value:r.toString(),color:"text-white/60"}),o.jsx(b,{icon:o.jsx(o0,{size:11,strokeWidth:1.5}),label:"Espcies",value:a.toString(),color:"text-white/70"}),m>0&&o.jsx(b,{icon:o.jsx(r2,{size:11,strokeWidth:1.5}),label:"Memria",value:`${m.toFixed(1)} MB`,color:"text-white/60"})]})]}),o.jsxs("div",{className:"bg-white/[0.02] p-2.5",style:{border:"1px dashed rgba(255,255,255,0.04)"},children:[o.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[o.jsx(cf,{size:12,className:"text-white/50",strokeWidth:1.5}),o.jsx("h3",{className:"text-white/70 text-[10px] uppercase tracking-wider",children:"Mtricas de Campo"})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(w,{label:"Tenso",value:i,color:"bg-white/60"}),o.jsx(w,{label:"Coeso",value:s,color:"bg-white/50"}),o.jsx(w,{label:"Escassez",value:c,color:"bg-white/40"}),o.jsx(w,{label:"Diversidade",value:l,color:"bg-white/30"})]})]}),d&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"bg-white/[0.02] p-2.5",style:{border:"1px dashed rgba(255,255,255,0.04)"},children:[o.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[o.jsx(o0,{size:12,className:"text-yellow-400/70",strokeWidth:1.5}),o.jsx("h3",{className:"text-white/70 text-[10px] uppercase tracking-wider",children:"Eventos Emergentes"})]}),o.jsxs("div",{className:"space-y-1.5",children:[o.jsx(b,{icon:o.jsx("span",{className:"text-[10px]",children:""}),label:"Total Beats",value:d.totalBeats.toString(),color:"text-yellow-400/80"}),o.jsx(b,{icon:o.jsx("span",{className:"text-[10px]",children:""}),label:"Especiaes",value:d.totalSpeciations.toString(),color:"text-green-400/80"}),o.jsx(b,{icon:o.jsx("span",{className:"text-[10px]",children:""}),label:"Instituies",value:d.totalInstitutions.toString(),color:"text-purple-400/80"}),o.jsx(b,{icon:o.jsx(zi,{size:11,strokeWidth:1.5}),label:"Mutaes",value:d.totalMutations.toString(),color:"text-blue-400/80"}),o.jsx(b,{icon:o.jsx("span",{className:"text-[10px]",children:""}),label:"Mitose",value:d.totalMitosis.toString(),color:"text-pink-400/80"})]})]}),o.jsxs("div",{className:"bg-white/[0.02] p-2.5",style:{border:"1px dashed rgba(255,255,255,0.04)"},children:[o.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[o.jsx(zi,{size:12,className:"text-orange-400/70",strokeWidth:1.5}),o.jsx("h3",{className:"text-white/70 text-[10px] uppercase tracking-wider",children:"Recordes da Sesso"})]}),o.jsxs("div",{className:"space-y-1.5",children:[o.jsx(b,{icon:o.jsx(r2,{size:11,strokeWidth:1.5}),label:"Pico de Partculas",value:d.peakParticleCount.toLocaleString(),color:"text-orange-400/80"}),o.jsx(b,{icon:o.jsx(cf,{size:11,strokeWidth:1.5}),label:"Pico de Diversidade",value:d.peakDiversity.toFixed(3),color:"text-cyan-400/80"}),o.jsx(b,{icon:o.jsx(zi,{size:11,strokeWidth:1.5}),label:"Pico de Tenso",value:d.peakTension.toFixed(3),color:"text-red-400/80"}),o.jsx(b,{icon:o.jsx(o0,{size:11,strokeWidth:1.5}),label:"Pico de Coeso",value:d.peakCohesion.toFixed(3),color:"text-green-400/80"})]})]}),o.jsxs("div",{className:"bg-white/[0.02] p-2.5",style:{border:"1px dashed rgba(255,255,255,0.04)"},children:[o.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[o.jsx(o0,{size:12,className:"text-white/50",strokeWidth:1.5}),o.jsx("h3",{className:"text-white/70 text-[10px] uppercase tracking-wider",children:"Tempo de Simulao"})]}),o.jsx("div",{className:"text-white/60 text-[11px] font-mono text-center",children:(()=>{const k=Math.floor((Date.now()-d.simulationStartTime)/1e3),R=Math.floor(k/60),j=k%60;return`${R}m ${j}s`})()})]})]}),e<30&&o.jsx("div",{className:"bg-white/[0.02] p-2.5",style:{border:"1px dashed rgba(255,255,255,0.06)"},children:o.jsxs("div",{className:"flex items-start gap-1.5",children:[o.jsx(o0,{size:11,className:"text-white/50 mt-0.5 flex-shrink-0",strokeWidth:1.5}),o.jsxs("div",{className:"space-y-0.5",children:[o.jsx("p",{className:"text-white/60 text-[10px] uppercase tracking-wide",children:"Aviso de Performance"}),o.jsx("p",{className:"text-white/40 text-[9px] leading-relaxed",children:"FPS baixo. Tente reduzir a contagem de partculas ou desativar rastros."})]})]})})]})},BM=({archetypesDetected:e,microState:t,microConfig:n,paletteIndex:r,sigilConfig:a,onSigilConfigChange:i,archetypeRegistry:s,lifeStats:c})=>{const l=S.useMemo(()=>{const d=new Array(n.typesCount).fill(0);for(let u=0;u<t.count;u++){const h=t.type[u];h>=0&&h<n.typesCount&&d[h]++}return d},[t.count,t.type,n.typesCount]);return o.jsxs("div",{className:"space-y-5",children:[o.jsxs("div",{className:"space-y-2 pb-3 border-b border-white/[0.06]",children:[o.jsxs("h2",{className:"text-white/90 text-[11px] tracking-[0.2em] uppercase font-light flex items-center gap-2",children:[o.jsx(EI,{size:12,strokeWidth:1.5}),"Tipos de Partculas"]}),o.jsx("p",{className:"text-white/50 text-[9px] font-light leading-relaxed",children:"Legenda das cores e populao de cada tipo de agente na simulao."})]}),c&&(c.births>0||c.deaths>0)&&o.jsxs("div",{className:"p-3 space-y-2",style:{background:"rgba(255,255,255,0.02)",border:"1px dashed rgba(255,255,255,0.04)"},children:[o.jsxs("div",{className:"flex items-center gap-2 text-white/90",children:[o.jsx(o0,{size:12,strokeWidth:2}),o.jsx("span",{className:"text-[9px] uppercase tracking-wider font-medium",children:"Dinmica Populacional (ltimos 15s)"})]}),o.jsxs("div",{className:"grid grid-cols-3 gap-3 text-center",children:[o.jsxs("div",{className:"space-y-1",children:[o.jsxs("div",{className:"text-green-400 text-[16px] font-mono font-bold",children:["+",c.births]}),o.jsx("div",{className:"text-white/50 text-[8px] uppercase tracking-wide",children:"Nascimentos"})]}),o.jsxs("div",{className:"space-y-1",children:[o.jsxs("div",{className:"text-red-400 text-[16px] font-mono font-bold",children:["-",c.deaths]}),o.jsx("div",{className:"text-white/50 text-[8px] uppercase tracking-wide",children:"Mortes"})]}),o.jsxs("div",{className:"space-y-1",children:[o.jsxs("div",{className:`text-[16px] font-mono font-bold ${c.births-c.deaths>=0?"text-cyan-400":"text-orange-400"}`,children:[c.births-c.deaths>=0?"+":"",c.births-c.deaths]}),o.jsx("div",{className:"text-white/50 text-[8px] uppercase tracking-wide",children:"Saldo"})]})]})]}),s.list.length>0&&o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-white/[0.06]",children:[o.jsx(oS,{size:12,strokeWidth:1.5}),o.jsx("h3",{className:"text-white/80 text-[9px] tracking-[0.15em] uppercase font-light",children:"Especiao Gentica"}),o.jsxs("span",{className:"text-white/40 text-[9px] font-mono ml-auto",children:[s.list.length," espcies"]})]}),o.jsx("div",{className:`space-y-2 max-h-[200px] overflow-y-auto pr-1
            [&::-webkit-scrollbar]:w-1 
            [&::-webkit-scrollbar-track]:bg-white/5 
            [&::-webkit-scrollbar-thumb]:bg-white/20 
            [&::-webkit-scrollbar-thumb]:bg-white/15
            [&::-webkit-scrollbar-thumb:hover]:bg-white/30`,children:s.list.slice(0,10).map(d=>o.jsxs("div",{className:"bg-white/[0.02] p-2.5 hover:bg-white/[0.04] transition-all",style:{border:"1px dashed rgba(255,255,255,0.04)"},children:[o.jsxs("div",{className:"flex items-start gap-2 mb-1.5",children:[o.jsx("div",{className:"text-xl leading-none",children:d.sigil}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("div",{className:"text-white/80 text-[10px] font-medium truncate",children:d.name}),o.jsx("div",{className:"text-white/55 text-[8px] mt-0.5 leading-snug",children:d.notes.length>0?d.notes.join("  "):" Condies balanceadas"}),d.signal&&o.jsxs("div",{className:"text-white/35 text-[7px] font-mono mt-1 tracking-wide",children:["V ",Math.round(d.signal.volatility*100),"  S ",Math.round(d.signal.scarcity*100),"  C ",Math.round(d.signal.cohesion*100)]})]})]}),o.jsxs("div",{className:"grid grid-cols-4 gap-1 text-[7px] text-white/40 font-mono",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-white/60",children:d.genes.a.toFixed(2)}),o.jsx("div",{children:"A"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-white/60",children:d.genes.b.toFixed(2)}),o.jsx("div",{children:"B"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-white/60",children:d.genes.c.toFixed(2)}),o.jsx("div",{children:"C"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-white/60",children:d.genes.d.toFixed(2)}),o.jsx("div",{children:"D"})]})]})]},d.id))})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"flex items-baseline justify-between",children:[o.jsx("h3",{className:"text-white/80 text-[9px] tracking-[0.15em] uppercase font-light border-b border-white/[0.06] pb-1.5",children:"Tipos Ativos"}),o.jsxs("span",{className:"text-white/40 text-[9px] font-mono",children:[n.typesCount," tipos"]})]}),o.jsx("div",{className:`space-y-2 max-h-[300px] overflow-y-auto pr-1
          [&::-webkit-scrollbar]:w-1 
          [&::-webkit-scrollbar-track]:bg-white/5 
          [&::-webkit-scrollbar-thumb]:bg-white/20 
          [&::-webkit-scrollbar-thumb]:bg-white/15
          [&::-webkit-scrollbar-thumb:hover]:bg-white/30`,children:Array.from({length:n.typesCount}).map((d,u)=>{const h=l[u],m=t.count>0?(h/t.count*100).toFixed(1):"0.0",f=Py(u,r,n.typesCount);return o.jsxs("div",{className:"bg-white/[0.02] p-3 hover:bg-white/[0.04] transition-all",style:{border:"1px dashed rgba(255,255,255,0.04)"},children:[o.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[o.jsx("div",{className:"w-4 h-4",style:{backgroundColor:f,border:"1px dashed rgba(255,255,255,0.15)"}}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"text-white/80 text-[11px] font-medium",children:["Tipo ",u]}),o.jsxs("div",{className:"text-white/40 text-[9px] font-mono",children:[h.toLocaleString()," partculas (",m,"%)"]})]})]}),o.jsx("div",{className:"h-1.5 bg-white/[0.06] overflow-hidden",children:o.jsx("div",{className:"h-full transition-all duration-300",style:{width:`${m}%`,backgroundColor:f}})})]},u)})})]}),o.jsxs("div",{className:"space-y-3 pt-4 border-t border-white/[0.06]",children:[o.jsxs("h3",{className:"text-white/80 text-[9px] tracking-[0.15em] uppercase font-light border-b border-white/[0.06] pb-1.5 flex items-center gap-2",children:[o.jsx(ic,{size:10,strokeWidth:1.5}),"Sistema de Sigils (Padres)"]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("input",{type:"checkbox",id:"sigilsEnabled",checked:a.enabled,onChange:d=>i({enabled:d.target.checked}),className:"w-3 h-3 border-white/15 bg-white/[0.05] checked:bg-cyan-500/50 cursor-pointer"}),o.jsx("label",{htmlFor:"sigilsEnabled",className:"text-white/70 text-[10px] font-light cursor-pointer",children:"Deteco de Padres Ativa"})]}),a.enabled&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex items-center gap-2 pl-4",children:[o.jsx("input",{type:"checkbox",id:"showSigilOverlay",checked:a.showOverlay,onChange:d=>i({showOverlay:d.target.checked}),className:"w-3 h-3 border-white/15 bg-white/[0.05] checked:bg-cyan-500/50 cursor-pointer"}),o.jsx("label",{htmlFor:"showSigilOverlay",className:"text-white/60 text-[10px] font-light cursor-pointer",children:"Mostrar Overlay (Tecla: S)"})]}),e.length>0&&o.jsxs("div",{className:"mt-3 space-y-2",children:[o.jsxs("div",{className:"text-white/60 text-[9px] font-light",children:["Padres detectados: ",e.length]}),o.jsxs("div",{className:"bg-white/[0.02] p-2 space-y-1",style:{border:"1px dashed rgba(255,255,255,0.04)"},children:[e.slice(0,5).map(d=>o.jsxs("div",{className:"flex items-center gap-2 text-[9px]",children:[o.jsx("span",{className:"text-lg",children:d.sigil}),o.jsx("span",{className:"text-white/60 flex-1",children:d.name}),o.jsx("span",{className:"text-white/40 font-mono",children:d.kind})]},d.id)),e.length>5&&o.jsxs("div",{className:"text-white/30 text-[8px] text-center pt-1",children:["+",e.length-5," mais..."]})]})]})]})]}),o.jsxs("div",{className:"p-3 space-y-2",style:{background:"rgba(34,211,238,0.03)",border:"1px dashed rgba(34,211,238,0.12)"},children:[o.jsxs("div",{className:"flex items-center gap-2 text-cyan-400/80",children:[o.jsx(Qp,{size:12,strokeWidth:2}),o.jsx("span",{className:"text-[9px] uppercase tracking-wider font-medium",children:"Sobre Tipos"})]}),o.jsxs("div",{className:"text-[8px] text-white/50 font-light leading-relaxed space-y-1",children:[o.jsxs("p",{children:[" ",o.jsx("strong",{className:"text-white/70",children:"Cada cor"})," representa um tipo diferente de partcula"]}),o.jsxs("p",{children:[" ",o.jsx("strong",{className:"text-white/70",children:"Tipos interagem"})," de acordo com a matriz de foras"]}),o.jsxs("p",{children:[" ",o.jsx("strong",{className:"text-white/70",children:"Populao"})," muda dinamicamente com spawn/decay"]})]})]})]})},aD="'Doto', monospace",h0="'IBM Plex Mono', monospace",zd=({label:e,value:t,min:n,max:r,step:a,onChange:i,unit:s,accent:c})=>{const l=t??n??0,d=a>=1?0:a>=.1?1:a>=.01?2:3,u=(l-n)/(r-n)*100;return o.jsxs("div",{className:"flex flex-col gap-1 group",children:[o.jsxs("div",{className:"flex items-baseline justify-between",children:[o.jsx("label",{style:{fontFamily:h0,fontSize:"9px",fontWeight:200,letterSpacing:"0.5px",color:"rgba(255,255,255,0.35)",textTransform:"uppercase"},children:e}),o.jsxs("span",{style:{fontFamily:h0,fontSize:"9px",fontWeight:300,color:c||"rgba(255,255,255,0.5)",fontVariantNumeric:"tabular-nums"},children:[l.toFixed(d),s]})]}),o.jsxs("div",{className:"relative h-3 flex items-center",children:[o.jsx("div",{className:"absolute left-0 right-0 h-px",style:{background:"rgba(255,255,255,0.08)"}}),o.jsx("div",{className:"absolute left-0 h-px",style:{width:`${u}%`,background:c||"rgba(255,255,255,0.25)"}}),o.jsx("input",{type:"range",min:n,max:r,step:a,value:l,onChange:h=>i(parseFloat(h.target.value)),className:`absolute w-full h-3 appearance-none cursor-pointer bg-transparent
            [&::-webkit-slider-thumb]:appearance-none
            [&::-webkit-slider-thumb]:w-1.5
            [&::-webkit-slider-thumb]:h-3
            [&::-webkit-slider-thumb]:bg-white/50
            [&::-webkit-slider-thumb]:transition-colors
            [&::-moz-range-thumb]:w-1.5
            [&::-moz-range-thumb]:h-3
            [&::-moz-range-thumb]:bg-white/50
            [&::-moz-range-thumb]:border-0
            [&::-moz-range-thumb]:transition-colors`,style:{zIndex:1}})]})]})},sD=e=>{var u,h;const t=lS(),[n,r]=S.useState(!1),[a,i]=S.useState("patchboard"),[s,c]=S.useState(!0);if(S.useEffect(()=>{const m=setTimeout(()=>c(!1),3e3);return()=>clearTimeout(m)},[]),t){const m=[{id:"patchboard",label:"ALGO"},{id:"archetypes",label:"ARCH"},{id:"powers",label:"PWR"},{id:"matrix",label:"MTX"},{id:"seed",label:"SEED"},{id:"stats",label:"STAT"},{id:"codex",label:"CDX"}];return n?o.jsx("div",{className:"fixed left-0 right-0 z-20 pointer-events-none flex justify-center",style:{bottom:"max(16px, env(safe-area-inset-bottom))",fontFamily:h0},children:o.jsxs("button",{onClick:()=>r(!1),"aria-label":"Abrir painel de controles",className:"pointer-events-auto flex items-center justify-center gap-2 transition-all rounded-2xl shadow-lg active:scale-95",style:{minWidth:56,minHeight:56,padding:"14px 20px",background:"rgba(0,0,0,0.94)",border:"2px dashed rgba(255,212,0,0.35)",color:"#ffd400",letterSpacing:"0.1em",textTransform:"uppercase",fontSize:12,fontWeight:500,boxShadow:"0 4px 20px rgba(0,0,0,0.4)"},children:[o.jsx(Uk,{size:20,strokeWidth:2}),"Painel"]})}):o.jsx("div",{className:"fixed left-0 right-0 bottom-0 z-20 pointer-events-none",style:{fontFamily:h0},children:o.jsxs("div",{className:"pointer-events-auto",style:{background:"rgba(0,0,0,0.94)",borderTop:"1px dashed rgba(255,255,255,0.10)",maxHeight:"min(72vh, 560px)",paddingBottom:"env(safe-area-inset-bottom, 0px)"},children:[o.jsxs("div",{className:"flex items-center gap-2 px-3 py-3",style:{borderBottom:"1px dashed rgba(255,255,255,0.08)"},children:[o.jsx("div",{className:"flex-1 overflow-x-auto",style:{scrollbarWidth:"none"},children:o.jsx("div",{className:"flex gap-2",children:m.map(f=>{const g=a===f.id;return o.jsxs("button",{onClick:()=>i(f.id),"aria-label":`Aba ${f.label}`,className:"transition-all shrink-0 rounded-xl active:opacity-80",style:{minHeight:44,minWidth:44,padding:"10px 14px",fontSize:11,letterSpacing:"0.10em",textTransform:"uppercase",color:g?"#ffd400":"rgba(255,255,255,0.35)",background:g?"rgba(255,212,0,0.08)":"rgba(255,255,255,0.04)",border:g?"1px dashed rgba(255,212,0,0.35)":"1px dashed rgba(255,255,255,0.08)"},children:[f.label,s&&f.id==="patchboard"&&o.jsx("span",{style:{marginLeft:6,color:"#ffd400"},children:""})]},f.id)})})}),o.jsx("button",{onClick:()=>r(!0),"aria-label":"Fechar painel",className:"flex items-center justify-center rounded-xl transition-all active:opacity-80",style:{minWidth:44,minHeight:44,background:"rgba(255,255,255,0.06)",border:"1px dashed rgba(255,255,255,0.12)",color:"rgba(255,255,255,0.5)"},children:o.jsx(Ms,{size:20,strokeWidth:1.8})})]}),o.jsxs("div",{className:"overflow-auto p-3",style:{maxHeight:"calc(min(72vh, 560px) - 48px)"},children:[a==="patchboard"&&o.jsx(iM,{microConfig:e.microConfig,fieldConfig:e.fieldConfig,reconfigConfig:e.reconfigConfig,targetParticleCount:e.targetParticleCount,onMicroChange:e.onMicroChange,onFieldChange:e.onFieldChange,onReconfigChange:e.onReconfigChange,onTargetParticleCountChange:e.onTargetParticleCountChange,onRandomizeAll:e.onRandomizeAll,life:e.life,onLifeChange:e.onLifeChange,lifeStats:e.lifeStats,pointSize:e.pointSize,fadeFactor:e.fadeFactor,glowIntensity:e.glowIntensity,paletteIndex:e.paletteIndex,onPointSizeChange:e.onPointSizeChange,onFadeFactorChange:e.onFadeFactorChange,onGlowIntensityChange:e.onGlowIntensityChange,onPaletteIndexChange:e.onPaletteIndexChange,onBackgroundClick:e.onBackgroundClick,trails:e.trails,fieldHeatmap:e.fieldHeatmap,onToggleTrails:e.onToggleTrails,onToggleFieldHeatmap:e.onToggleFieldHeatmap,onApplyRecipe:e.onApplyRecipe,onNewUniverse:e.onNewUniverse,onChaosSeed:e.onChaosSeed,onLoadPreset:e.onLoadCreativePreset,renderMode:e.renderMode,streakLength:e.streakLength,onRenderModeChange:e.onRenderModeChange,onStreakLengthChange:e.onStreakLengthChange,simQuality:e.simQuality,dotSize:e.dotSize,onSimQualityChange:e.onSimQualityChange,onDotSizeChange:e.onDotSizeChange,spawnPattern:e.spawnPattern,onSpawnPatternChange:e.onSpawnPatternChange,showBonds:e.showBonds,bondsDistance:e.bondsDistance,bondsOpacity:e.bondsOpacity,showTrails:e.showTrails,trailsLength:e.trailsLength,trailsOpacity:e.trailsOpacity,onShowBondsChange:e.onShowBondsChange,onBondsDistanceChange:e.onBondsDistanceChange,onBondsOpacityChange:e.onBondsOpacityChange,onShowTrailsChange:e.onShowTrailsChange,onTrailsLengthChange:e.onTrailsLengthChange,onTrailsOpacityChange:e.onTrailsOpacityChange,sigilConfig:e.sigilConfig,onSigilConfigChange:e.onSigilConfigChange,archetypesDetected:e.archetypesDetected,onClearSigils:e.onClearSigils,hideCoreControls:e.hideCoreControls}),a==="powers"&&o.jsx("div",{className:"space-y-5",children:o.jsxs("div",{className:"space-y-3",children:[o.jsx("div",{className:"space-y-2",children:(()=>{const f=[{id:"pulse",icon:"",label:"Pulso",desc:"Expansao radial",color:"#37b2da"},{id:"white-hole",icon:"O",label:"White Hole",desc:"Mega-repulsao quadratica",color:"#ffd400"},{id:"black-hole",icon:"",label:"Black Hole",desc:"Mega-atracao quadratica",color:"#8b5cf6"},{id:"wind",icon:"~",label:"Vento",desc:"Arrasta na direcao",color:"#37b2da"},{id:"vortex",icon:"",label:"Vortice",desc:"Rotacao tangencial",color:"#10d45b"},{id:"freeze",icon:"*",label:"Congelar",desc:"Drena energia cinetica",color:"#60a5fa"},{id:"chaos",icon:"!",label:"Caos",desc:"Injeta ruido aleatorio",color:"#d6552d"},{id:"quake",icon:"",label:"Quake",desc:"Ondas de pressao",color:"#ffaa44"},{id:"nova",icon:"+",label:"Nova",desc:"Implosao / explosao",color:"#ff4444"},{id:"magnetize",icon:"",label:"Magnetizar",desc:"Converte especie proxima",color:"#ff0084"}],g=f.find(x=>x.id===e.selectedPower);return o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"grid grid-cols-5 gap-1",children:f.map(x=>{const v=e.selectedPower===x.id;return o.jsxs("button",{onClick:()=>e.onSelectedPowerChange(x.id),title:x.label+"  "+x.desc,className:"flex flex-col items-center justify-center py-2 px-0.5 transition-all",style:{border:`1px dashed ${v?x.color+"50":"rgba(255,255,255,0.08)"}`,background:v?x.color+"10":"transparent",color:v?x.color:"rgba(255,255,255,0.35)"},children:[o.jsx("span",{style:{fontSize:"16px",lineHeight:1,marginBottom:"3px"},children:x.icon}),o.jsx("span",{style:{fontSize:"8px",textTransform:"uppercase",letterSpacing:"0.3px",fontWeight:200,lineHeight:1},children:x.label})]},x.id)})}),g&&o.jsxs("div",{className:"flex items-start gap-2 px-2 py-1.5",style:{border:`1px dashed ${g.color}25`,background:`${g.color}04`},children:[o.jsx("span",{style:{fontSize:"16px",lineHeight:1,color:g.color,marginTop:"2px"},children:g.icon}),o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:"10px",textTransform:"uppercase",letterSpacing:"0.8px",fontWeight:300,color:g.color,marginBottom:"2px"},children:g.label}),o.jsx("div",{style:{fontSize:"10px",fontWeight:200,color:"rgba(255,255,255,0.40)",lineHeight:1.3},children:g.desc})]})]})]})})()}),o.jsx("div",{className:"h-px",style:{borderBottom:"1px dashed rgba(255,255,255,0.08)"}}),o.jsxs("div",{className:"grid grid-cols-2 gap-x-3 gap-y-0.5",style:{fontSize:"9px",fontWeight:200,color:"rgba(255,255,255,0.25)"},children:[o.jsx("span",{children:"Tap  instantneo"}),o.jsx("span",{children:"Arrastar  contnuo"}),o.jsx("span",{children:"2 dedos  pan/zoom"}),o.jsx("span",{children:"Alt/Shift  desktop"})]}),o.jsx("div",{className:"h-px",style:{borderBottom:"1px dashed rgba(255,255,255,0.08)"}}),o.jsxs("div",{className:"space-y-2 pt-1",children:[o.jsxs("div",{className:"flex flex-col gap-1.5",children:[o.jsxs("div",{className:"flex items-baseline justify-between",children:[o.jsx("label",{style:{fontSize:"10px",fontWeight:200,letterSpacing:"0.5px",color:"rgba(255,255,255,0.35)",textTransform:"uppercase"},children:"Espcie"}),o.jsx("span",{style:{fontSize:"10px",fontWeight:300,color:"rgba(255,255,255,0.55)",fontVariantNumeric:"tabular-nums"},children:e.selectedType})]}),o.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:Array.from({length:e.microConfig.typesCount}).map((f,g)=>o.jsx("button",{onClick:()=>e.onSelectedTypeChange(g),className:"transition-all",style:{width:"26px",height:"26px",border:e.selectedType===g?"1px solid rgba(255,255,255,0.70)":"1px dashed rgba(255,255,255,0.14)",backgroundColor:`hsl(${g*360/e.microConfig.typesCount}, 70%, 60%)`,transform:e.selectedType===g?"scale(1.06)":"scale(1)"}},g))})]}),o.jsx("div",{className:"h-px",style:{borderBottom:"1px dashed rgba(255,255,255,0.08)"}}),o.jsx(zd,{label:"Raio",value:e.brushRadius,min:20,max:220,step:5,onChange:e.onBrushRadiusChange,unit:"px"}),o.jsx(zd,{label:"Fora",value:e.brushStrength,min:0,max:100,step:1,onChange:e.onBrushStrengthChange}),o.jsx(zd,{label:"Taxa Semeadura",value:e.seedRate,min:0,max:200,step:5,onChange:e.onSeedRateChange,unit:"/s"}),o.jsx(zd,{label:"Taxa Apagamento",value:e.eraseRate,min:0,max:1,step:.05,onChange:e.onEraseRateChange})]})]})}),a==="matrix"&&o.jsx(cM,{matrix:e.matrix,typesCount:e.microConfig.typesCount,onMatrixChange:e.onMatrixChange,onRandomize:e.onMatrixRandomize,onSoften:e.onMatrixSoften,onSymmetrize:e.onMatrixSymmetrize,onInvert:e.onMatrixInvert,onNormalize:e.onMatrixNormalize}),a==="seed"&&o.jsx(dM,{currentSeed:e.currentSeed||Date.now(),onLoadSeed:e.onLoadSeed||(()=>{})}),a==="save"&&o.jsx(DM,{onSave:e.onSaveSnapshot,onLoad:e.onLoadSnapshot}),a==="stats"&&o.jsx(zM,{fps:e.fps,particleCount:e.particleCount,speciesCount:e.speciesCount,fieldCellCount:e.fieldCellCount,artifactCount:e.artifactCount,diversity:e.diversity,clusterCount:e.clusterCount,borderStrength:e.borderStrength,avgTension:e.avgTension,avgCohesion:e.avgCohesion,avgScarcity:e.avgScarcity}),a==="codex"&&o.jsx(LM,{chronicle:e.chronicle,artifacts:e.artifacts}),a==="archetypes"&&e.archetypesDetected&&e.sigilConfig&&e.onSigilConfigChange&&o.jsx(BM,{archetypesDetected:e.archetypesDetected,sigilConfig:e.sigilConfig,onSigilConfigChange:e.onSigilConfigChange,archetypeRegistry:e.archetypeRegistry||{nextId:100,list:[]}})]})]})})}const l=72;if(n)return o.jsx("div",{className:"fixed right-0 bottom-0 z-10 pointer-events-none",style:{top:l},children:o.jsx("div",{className:"h-full flex items-center",children:o.jsx("button",{onClick:()=>r(!1),className:"pointer-events-auto p-2 transition-all",style:{background:"rgba(0,0,0,0.92)",borderLeft:"1px dashed rgba(255,255,255,0.06)",borderTop:"1px dashed rgba(255,255,255,0.06)",borderBottom:"1px dashed rgba(255,255,255,0.06)",borderRight:"none",color:"rgba(255,255,255,0.35)"},children:o.jsx(ym,{size:12,strokeWidth:1.5})})})});const d=[{id:"patchboard",label:"ALGO",num:"01"},{id:"archetypes",label:"ARCH",num:"02"},{id:"powers",label:"PWR",num:"03"},{id:"matrix",label:"MTX",num:"04"},{id:"seed",label:"SEED",num:"05"},{id:"save",label:"SAVE",num:"06"},{id:"stats",label:"STAT",num:"07"},{id:"codex",label:"CDX",num:"08"}];return o.jsx("div",{className:"fixed right-0 bottom-0 z-10 pointer-events-none",style:{width:"320px",top:l,fontFamily:h0},"data-right-dock":!0,children:o.jsxs("div",{className:"h-full flex pointer-events-auto",children:[o.jsx("div",{className:"flex items-center",children:o.jsx("button",{onClick:()=>r(!0),className:"p-1.5 transition-colors",title:"Minimizar painel",style:{color:"rgba(255,255,255,0.25)",background:"rgba(0,0,0,0.80)",border:"1px dashed rgba(255,255,255,0.06)",borderRight:"none"},children:o.jsx(hs,{size:10,strokeWidth:1.5})})}),o.jsx("div",{className:"flex flex-col gap-0 py-2",style:{background:"rgba(0,0,0,0.94)",borderLeft:"1px dashed rgba(255,255,255,0.06)"},children:d.map(m=>{const f=a===m.id;return o.jsxs("button",{onClick:()=>i(m.id),className:"relative px-1.5 py-3 transition-all whitespace-nowrap",style:{writingMode:"vertical-rl",fontFamily:h0,fontSize:"8px",fontWeight:f?400:200,letterSpacing:"1.5px",textTransform:"uppercase",color:f?"#ffd400":"rgba(255,255,255,0.20)",background:f?"rgba(255,212,0,0.04)":"transparent",borderRight:f?"1px dashed rgba(255,212,0,0.25)":"1px dashed transparent"},children:[m.label,s&&m.id==="patchboard"&&o.jsx("div",{className:"absolute top-1 right-0.5 w-1 h-1 animate-pulse",style:{background:"#ffd400"}})]},m.id)})}),o.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",style:{background:"rgba(0,0,0,0.94)",borderLeft:"1px dashed rgba(255,255,255,0.06)"},children:[o.jsxs("div",{className:"px-3 py-2 flex items-center justify-between",style:{borderBottom:"1px dashed rgba(255,255,255,0.06)"},children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("span",{style:{fontFamily:h0,fontSize:"8px",fontWeight:200,color:"rgba(255,255,255,0.18)"},children:[(u=d.find(m=>m.id===a))==null?void 0:u.num,"."]}),o.jsx("span",{style:{fontFamily:aD,fontSize:"10px",fontWeight:400,color:"rgba(255,255,255,0.55)",letterSpacing:"1px",textTransform:"uppercase"},children:(h=d.find(m=>m.id===a))==null?void 0:h.label})]}),o.jsx("span",{style:{fontFamily:h0,fontSize:"7px",fontWeight:200,color:"rgba(255,255,255,0.12)",letterSpacing:"0.08em",textTransform:"uppercase"},children:"COMPLEXITY LAB"})]}),o.jsxs("div",{className:"flex-1 overflow-auto p-3",style:{scrollbarWidth:"thin",scrollbarColor:"rgba(255,255,255,0.1) transparent"},children:[a==="patchboard"&&o.jsx(iM,{microConfig:e.microConfig,fieldConfig:e.fieldConfig,reconfigConfig:e.reconfigConfig,targetParticleCount:e.targetParticleCount,onMicroChange:e.onMicroChange,onFieldChange:e.onFieldChange,onReconfigChange:e.onReconfigChange,onTargetParticleCountChange:e.onTargetParticleCountChange,onRandomizeAll:e.onRandomizeAll,life:e.life,onLifeChange:e.onLifeChange,lifeStats:e.lifeStats,pointSize:e.pointSize,fadeFactor:e.fadeFactor,glowIntensity:e.glowIntensity,paletteIndex:e.paletteIndex,onPointSizeChange:e.onPointSizeChange,onFadeFactorChange:e.onFadeFactorChange,onGlowIntensityChange:e.onGlowIntensityChange,onPaletteIndexChange:e.onPaletteIndexChange,onBackgroundClick:e.onBackgroundClick,trails:e.trails,fieldHeatmap:e.fieldHeatmap,onToggleTrails:e.onToggleTrails,onToggleFieldHeatmap:e.onToggleFieldHeatmap,onApplyRecipe:e.onApplyRecipe,onNewUniverse:e.onNewUniverse,onChaosSeed:e.onChaosSeed,onLoadPreset:e.onLoadCreativePreset,renderMode:e.renderMode,streakLength:e.streakLength,onRenderModeChange:e.onRenderModeChange,onStreakLengthChange:e.onStreakLengthChange,simQuality:e.simQuality,dotSize:e.dotSize,onSimQualityChange:e.onSimQualityChange,onDotSizeChange:e.onDotSizeChange,spawnPattern:e.spawnPattern,onSpawnPatternChange:e.onSpawnPatternChange,showBonds:e.showBonds,bondsDistance:e.bondsDistance,bondsOpacity:e.bondsOpacity,showTrails:e.showTrails,trailsLength:e.trailsLength,trailsOpacity:e.trailsOpacity,onShowBondsChange:e.onShowBondsChange,onBondsDistanceChange:e.onBondsDistanceChange,onBondsOpacityChange:e.onBondsOpacityChange,onShowTrailsChange:e.onShowTrailsChange,onTrailsLengthChange:e.onTrailsLengthChange,onTrailsOpacityChange:e.onTrailsOpacityChange,sigilConfig:e.sigilConfig,onSigilConfigChange:e.onSigilConfigChange,archetypesDetected:e.archetypesDetected,onClearSigils:e.onClearSigils,hideCoreControls:e.hideCoreControls}),a==="powers"&&o.jsx("div",{className:"space-y-5",children:o.jsxs("div",{className:"space-y-3",children:[o.jsx("div",{className:"space-y-2",children:(()=>{const m=[{id:"pulse",icon:"",label:"Pulso",desc:"Expansao radial",color:"#37b2da"},{id:"white-hole",icon:"O",label:"White Hole",desc:"Mega-repulsao quadratica",color:"#ffd400"},{id:"black-hole",icon:"",label:"Black Hole",desc:"Mega-atracao quadratica",color:"#8b5cf6"},{id:"wind",icon:"~",label:"Vento",desc:"Arrasta na direcao",color:"#37b2da"},{id:"vortex",icon:"",label:"Vortice",desc:"Rotacao tangencial",color:"#10d45b"},{id:"freeze",icon:"*",label:"Congelar",desc:"Drena energia cinetica",color:"#60a5fa"},{id:"chaos",icon:"!",label:"Caos",desc:"Injeta ruido aleatorio",color:"#d6552d"},{id:"quake",icon:"",label:"Quake",desc:"Ondas de pressao",color:"#ffaa44"},{id:"nova",icon:"+",label:"Nova",desc:"Implosao / explosao",color:"#ff4444"},{id:"magnetize",icon:"",label:"Magnetizar",desc:"Converte especie proxima",color:"#ff0084"}],f=m.find(g=>g.id===e.selectedPower);return o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"grid grid-cols-5 gap-1",children:m.map(g=>{const x=e.selectedPower===g.id;return o.jsxs("button",{onClick:()=>e.onSelectedPowerChange(g.id),title:g.label+"  "+g.desc,className:"flex flex-col items-center justify-center py-2 px-0.5 transition-all",style:{border:`1px dashed ${x?g.color+"50":"rgba(255,255,255,0.05)"}`,background:x?g.color+"08":"transparent",color:x?g.color:"rgba(255,255,255,0.30)"},children:[o.jsx("span",{style:{fontSize:"14px",lineHeight:1,marginBottom:"3px"},children:g.icon}),o.jsx("span",{style:{fontSize:"7px",textTransform:"uppercase",letterSpacing:"0.3px",fontWeight:200,lineHeight:1},children:g.label})]},g.id)})}),f&&o.jsxs("div",{className:"flex items-start gap-2 px-2 py-1.5",style:{border:`1px dashed ${f.color}25`,background:`${f.color}04`},children:[o.jsx("span",{style:{fontSize:"16px",lineHeight:1,color:f.color,marginTop:"2px"},children:f.icon}),o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:"9px",textTransform:"uppercase",letterSpacing:"0.8px",fontWeight:300,color:f.color,marginBottom:"2px"},children:f.label}),o.jsx("div",{style:{fontSize:"9px",fontWeight:200,color:"rgba(255,255,255,0.35)",lineHeight:1.3},children:f.desc})]})]})]})})()}),o.jsx("div",{className:"h-px",style:{borderBottom:"1px dashed rgba(255,255,255,0.06)"}}),o.jsxs("div",{className:"grid grid-cols-2 gap-x-3 gap-y-0.5",style:{fontSize:"8px",fontWeight:200,color:"rgba(255,255,255,0.2)"},children:[o.jsx("span",{children:"Click  poder instantaneo"}),o.jsx("span",{children:"Arrastar  poder continuo"}),o.jsx("span",{children:"Shift+drag  semear"}),o.jsx("span",{children:"Alt+drag  apagar"})]}),o.jsx("div",{className:"h-px",style:{borderBottom:"1px dashed rgba(255,255,255,0.06)"}}),o.jsxs("div",{className:"space-y-2 pt-1",children:[o.jsxs("div",{className:"flex flex-col gap-1.5",children:[o.jsxs("div",{className:"flex items-baseline justify-between",children:[o.jsx("label",{style:{fontSize:"9px",fontWeight:200,letterSpacing:"0.5px",color:"rgba(255,255,255,0.35)",textTransform:"uppercase"},children:"Especie"}),o.jsx("span",{style:{fontSize:"9px",fontWeight:300,color:"rgba(255,255,255,0.5)",fontVariantNumeric:"tabular-nums"},children:e.selectedType})]}),o.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:Array.from({length:e.microConfig.typesCount}).map((m,f)=>o.jsx("button",{onClick:()=>e.onSelectedTypeChange(f),className:"transition-all",style:{width:"20px",height:"20px",border:e.selectedType===f?"1px solid rgba(255,255,255,0.65)":"1px dashed rgba(255,255,255,0.12)",backgroundColor:`hsl(${f*360/e.microConfig.typesCount}, 70%, 60%)`,transform:e.selectedType===f?"scale(1.10)":"scale(1)"}},f))})]}),o.jsx("div",{className:"h-px",style:{borderBottom:"1px dashed rgba(255,255,255,0.06)"}}),o.jsx(zd,{label:"Raio",value:e.brushRadius,min:20,max:220,step:5,onChange:e.onBrushRadiusChange,unit:"px"}),o.jsx(zd,{label:"Forca",value:e.brushStrength,min:0,max:100,step:1,onChange:e.onBrushStrengthChange}),o.jsx(zd,{label:"Taxa Semeadura",value:e.seedRate,min:0,max:200,step:5,onChange:e.onSeedRateChange,unit:"/s"}),o.jsx(zd,{label:"Taxa Apagamento",value:e.eraseRate,min:0,max:1,step:.05,onChange:e.onEraseRateChange})]})]})}),a==="matrix"&&o.jsx(cM,{matrix:e.matrix,typesCount:e.microConfig.typesCount,onMatrixChange:e.onMatrixChange,onRandomize:e.onMatrixRandomize,onSoften:e.onMatrixSoften,onSymmetrize:e.onMatrixSymmetrize,onInvert:e.onMatrixInvert,onNormalize:e.onMatrixNormalize}),a==="seed"&&o.jsx(dM,{currentSeed:e.currentSeed||Date.now(),onLoadSeed:e.onLoadSeed||(()=>{})}),a==="save"&&o.jsx(DM,{onSave:e.onSaveSnapshot,onLoad:e.onLoadSnapshot}),a==="stats"&&o.jsx(zM,{fps:e.fps,particleCount:e.particleCount,fieldCellCount:e.fieldCellCount,artifactCount:e.artifactCount,speciesCount:e.speciesCount,avgTension:e.avgTension,avgCohesion:e.avgCohesion,avgScarcity:e.avgScarcity,diversity:e.diversity,stats:e.stats}),a==="codex"&&e.organisms&&o.jsx(LM,{organisms:e.organisms,onSpawnOrganism:e.onSpawnOrganism||(()=>{}),onDeleteOrganism:e.onDeleteOrganism||(()=>{}),onRenameOrganism:e.onRenameOrganism||(()=>{}),captureMode:e.captureMode||!1,onCaptureModeChange:e.onCaptureModeChange||(()=>{}),brushRadius:e.brushRadius,onBrushRadiusChange:e.onBrushRadiusChange}),a==="archetypes"&&e.archetypesDetected&&e.sigilConfig&&e.onSigilConfigChange&&o.jsx(BM,{archetypesDetected:e.archetypesDetected,microState:e.microState,microConfig:e.microConfig,paletteIndex:e.paletteIndex||0,sigilConfig:e.sigilConfig,onSigilConfigChange:e.onSigilConfigChange,archetypeRegistry:e.archetypeRegistry||{nextId:100,list:[]},lifeStats:e.lifeStats})]})]})]})})};class mu{constructor(t){this.seed=t}next(){return this.seed=(this.seed*9301+49297)%233280,this.seed/233280}range(t,n){return t+this.next()*(n-t)}int(t,n){return Math.floor(this.range(t,n+1))}getSeed(){return this.seed}setSeed(t){this.seed=t}}const iD=()=>({running:!0,speed:1,accumulator:0,tick:0,elapsed:0,lastFrameTime:0,frameCount:0,fps:60,fieldAccumulator:0,reconfigAccumulator:0,maxStepsPerFrame:10}),ud=1/120,lD=.1,$M=1/20,cD=(e,t,n)=>{const r=e.lastFrameTime===0?ud:(t-e.lastFrameTime)/1e3,a=Math.min(r,lD);if(e.lastFrameTime=t,e.frameCount++,e.frameCount%30===0&&(e.fps=Math.round(1/a)),!e.running)return{stepCount:0,fieldTick:!1,reconfigTick:!1};e.accumulator+=a*e.speed;let i=0;for(;e.accumulator>=ud&&i<e.maxStepsPerFrame;)i++,e.accumulator-=ud,e.tick++,e.elapsed+=ud;i>=e.maxStepsPerFrame&&(e.accumulator=0),e.fieldAccumulator+=a*e.speed;const s=e.fieldAccumulator>=$M;s&&(e.fieldAccumulator-=$M),e.reconfigAccumulator+=a*e.speed;const c=e.reconfigAccumulator>=n;return c&&(e.reconfigAccumulator=0),{stepCount:i,fieldTick:s,reconfigTick:c}},dD=e=>{switch(e){case"FAST":return 10;case"HIGH":return 12;case"ULTRA":return 15}},uD=e=>{switch(e){case"FAST":return 2;case"HIGH":return 1;case"ULTRA":return 1}},hD=()=>({simQuality:"FAST",renderQuality:"FAST",maxStepsPerFrame:10,fieldSampleRate:2,resolutionScale:.75}),fD=(e,t)=>{switch(e.simQuality=t,e.maxStepsPerFrame=dD(t),e.fieldSampleRate=uD(t),e.renderQuality=t,t){case"FAST":e.resolutionScale=.75;break;case"HIGH":e.resolutionScale=1;break;case"ULTRA":e.resolutionScale=1;break}},pD=(e,t,n,r,a)=>{if(t-n<3e4)return n;if(e<10&&r>300){const i=Math.floor(r*.1),s=Math.max(300,r-i);return a(s,i),t}if(e<14&&r>1200){const i=Math.floor(r*.05),s=Math.max(600,r-i);return a(s,i),t}return n},fd=255,qM=8,mD=e=>{const t=[],n=[];for(let r=0;r<qM;r++)t.push(new Float32Array(e)),n.push(new Float32Array(e));return{count:0,maxCount:e,capacity:e,x:new Float32Array(e),y:new Float32Array(e),vx:new Float32Array(e),vy:new Float32Array(e),type:new Uint8Array(e),energy:new Float32Array(e),historyX:t,historyY:n,historyLength:qM,historyIndex:0,age:new Uint32Array(e),mutationPotential:new Float32Array(e),size:new Float32Array(e).fill(1),geneA:new Float32Array(e),geneB:new Float32Array(e),geneC:new Float32Array(e),geneD:new Float32Array(e),archetypeId:new Uint16Array(e)}},gD=()=>({wrap:!0,rmax:.24,friction:.9,drag:1,useDrag:!0,force:1.8,dt:1/60,speedClamp:.15,entropy:0,typesCount:4,foodEnabled:!1,foodRatio:.15,circularDependency:0,beta:.3,coreRepel:1,kernelMode:"classic",softening:1e-4,energyEnabled:!1,energyDecay:.002,energyFeedRate:.04,energyReproThreshold:2,metamorphosisEnabled:!0,mutationRate:8e-4,typeStability:.985,enableSigilForces:!0}),y2=(e,t,n,r,a=!1,i=.15)=>{e.count=Math.min(t,e.maxCount);const s=a?Math.floor(e.count*i):0;for(let c=0;c<e.count;c++)e.x[c]=n.next()*2-1,e.y[c]=n.next()*2-1,e.vx[c]=0,e.vy[c]=0,c<s?e.type[c]=fd:e.type[c]=n.int(0,r-1),e.energy[c]=1,e.age[c]=0,e.mutationPotential[c]=0,e.size[c]=1,e.geneA[c]=n.next(),e.geneB[c]=n.next(),e.geneC[c]=n.next(),e.geneD[c]=n.next(),e.archetypeId[c]=e.type[c]},HM=(e,t,n,r,a={next:()=>Math.random()})=>{if(e.count>=e.maxCount)return!1;const i=e.count++;return e.x[i]=t,e.y[i]=n,e.vx[i]=0,e.vy[i]=0,e.type[i]=r,e.energy[i]=1,e.age[i]=0,e.mutationPotential[i]=0,e.size[i]=1,e.geneA[i]=a.next(),e.geneB[i]=a.next(),e.geneC[i]=a.next(),e.geneD[i]=a.next(),e.archetypeId[i]=r,!0},b2=(e,t,n,r,a=1,i={next:()=>Math.random()})=>{let s=0;for(let c=e.count-1;c>=0;c--){const l=e.x[c]-t,d=e.y[c]-n;if(l*l+d*d<r*r&&i.next()<a){const h=e.count-1;c!==h&&(e.x[c]=e.x[h],e.y[c]=e.y[h],e.vx[c]=e.vx[h],e.vy[c]=e.vy[h],e.type[c]=e.type[h],e.energy[c]=e.energy[h],e.age[c]=e.age[h],e.mutationPotential[c]=e.mutationPotential[h],e.size[c]=e.size[h],e.geneA[c]=e.geneA[h],e.geneB[c]=e.geneB[h],e.geneC[c]=e.geneC[h],e.geneD[c]=e.geneD[h],e.archetypeId[c]=e.archetypeId[h]),e.count--,s++}}return s},WM=(e,t,n,r,a,i=!1,s=.15)=>{e.count=Math.min(t,e.maxCount);const c=i?Math.floor(e.count*s):0;for(let l=0;l<e.count;l++){let d=0,u=0,h=0,m=0,f;switch(l<c?f=fd:f=r.int(0,a-1),n){case"random":d=r.next()*2-1,u=r.next()*2-1;break;case"circle":const g=l/e.count*Math.PI*2,x=.7+(r.next()-.5)*.1;d=Math.cos(g)*x,u=Math.sin(g)*x;break;case"rings":const v=Math.min(5,Math.max(2,a)),w=(f%v+1)/v*.85,M=l/(e.count/v)*Math.PI*2+r.next()*.5;d=Math.cos(M)*w,u=Math.sin(M)*w;break;case"clusters":const k=f/a*Math.PI*2,R=.4+r.next()*.2,j=(r.next()-.5)*.25,I=r.next()*Math.PI*2;d=Math.cos(k)*R+Math.cos(I)*j,u=Math.sin(k)*R+Math.sin(I)*j;break;case"grid":const E=Math.ceil(Math.sqrt(e.count)),O=l%E/E,L=Math.floor(l/E)/E;d=O*1.8-.9+(r.next()-.5)*.1,u=L*1.8-.9+(r.next()-.5)*.1;break;case"center":const $=r.next()*r.next()*.3,F=r.next()*Math.PI*2;d=Math.cos(F)*$,u=Math.sin(F)*$,h=Math.cos(F)*.02,m=Math.sin(F)*.02;break;case"spray":d=(r.next()-.5)*1.5,u=-.9+r.next()*.3,h=(r.next()-.5)*.01,m=.01+r.next()*.02;break;case"islands":const B=Math.min(8,Math.max(3,a*2)),re=l%B/B*Math.PI*2,oe=.5+r.next()*.3,te=r.next()*.15,J=r.next()*Math.PI*2;d=Math.cos(re)*oe+Math.cos(J)*te,u=Math.sin(re)*oe+Math.sin(J)*te;break;case"columns":d=f/a*2-1+(r.next()-.5)*.25,u=r.next()*2-1;break;case"web":const P=Math.max(4,a),fe=f%P/P*Math.PI*2,ye=r.next()*.85,Se=.04+r.next()*.04;d=Math.cos(fe)*ye+(r.next()-.5)*Se,u=Math.sin(fe)*ye+(r.next()-.5)*Se;break;case"spiral":const we=3,ke=l/e.count,De=ke*Math.PI*2*we,_e=ke*.85;d=Math.cos(De)*_e+(r.next()-.5)*.1,u=Math.sin(De)*_e+(r.next()-.5)*.1;break;case"double-ring":const ae=l<e.count/2,Re=ae?l:l-Math.floor(e.count/2),Fe=ae?Math.floor(e.count/2):e.count-Math.floor(e.count/2),Oe=Re/Fe*Math.PI*2,ne=ae?.45:.75;d=Math.cos(Oe)*ne,u=Math.sin(Oe)*ne;const nt=.015;h=-Math.sin(Oe)*nt*(ae?1:-1),m=Math.cos(Oe)*nt*(ae?1:-1);break}e.x[l]=d,e.y[l]=u,e.vx[l]=h,e.vy[l]=m,e.type[l]=f,e.energy[l]=1,e.age[l]=0,e.mutationPotential[l]=0,e.size[l]=1,e.geneA[l]=r.next(),e.geneB[l]=r.next(),e.geneC[l]=r.next(),e.geneD[l]=r.next(),e.archetypeId[l]=f}},$l=e=>{const t=[],n=[],r=[];for(let a=0;a<e;a++)t[a]=new Array(e).fill(0),n[a]=new Array(e).fill(1),r[a]=new Array(e).fill(1);return{attract:t,radius:n,falloff:r}},x2=(e,t,n)=>{const r=e.attract.length;for(let a=0;a<r;a++)for(let i=0;i<r;i++)e.attract[a][i]=t.range(-1,1),e.radius[a][i]=t.range(.3,1)*n,e.falloff[a][i]=t.range(.8,2)},yD=e=>{const t=e.attract.length;for(let n=0;n<t;n++)for(let r=0;r<t;r++)e.attract[n][r]*=.7},v2=e=>{const t=e.attract.length;for(let n=0;n<t;n++)for(let r=n+1;r<t;r++){const a=(e.attract[n][r]+e.attract[r][n])/2;e.attract[n][r]=a,e.attract[r][n]=a;const i=(e.radius[n][r]+e.radius[r][n])/2;e.radius[n][r]=i,e.radius[r][n]=i}},bD=e=>{const t=e.attract.length;for(let n=0;n<t;n++)for(let r=0;r<t;r++)e.attract[n][r]*=-1},xD=e=>{const t=e.attract.length;let n=0;for(let r=0;r<t;r++)for(let a=0;a<t;a++)n=Math.max(n,Math.abs(e.attract[r][a]));if(n>0)for(let r=0;r<t;r++)for(let a=0;a<t;a++)e.attract[r][a]/=n},di=(e,t)=>{var r,a;const n=e.attract.length;(!t.attract||t.attract.length!==n)&&(t.attract=Array(n).fill(0).map(()=>Array(n).fill(0))),(!t.radius||t.radius.length!==n)&&(t.radius=Array(n).fill(0).map(()=>Array(n).fill(0))),(!t.falloff||t.falloff.length!==n)&&(t.falloff=Array(n).fill(0).map(()=>Array(n).fill(1.2)));for(let i=0;i<n;i++)if(t.attract[i]||(t.attract[i]=Array(n).fill(0)),t.radius[i]||(t.radius[i]=Array(n).fill(0)),t.falloff[i]||(t.falloff[i]=Array(n).fill(1.2)),!!e.attract[i]&&e.radius[i])for(let s=0;s<n;s++)t.attract[i][s]=e.attract[i][s]??0,t.radius[i][s]=e.radius[i][s]??0,t.falloff[i][s]=((a=(r=e.falloff)==null?void 0:r[i])==null?void 0:a[s])??1.2},Zx=(e,t,n,r)=>{const a=e.attract.length;if(!(t<=a)){for(let i=0;i<a;i++){e.attract[i]||(e.attract[i]=[]),e.radius[i]||(e.radius[i]=[]),e.falloff[i]||(e.falloff[i]=[]);for(let s=a;s<t;s++)e.attract[i][s]=n.range(-.5,.5),e.radius[i][s]=n.range(.3,1)*r,e.falloff[i][s]=1.2}for(let i=a;i<t;i++){e.attract[i]=new Array(t),e.radius[i]=new Array(t),e.falloff[i]=new Array(t);for(let s=0;s<t;s++)e.attract[i][s]=n.range(-.5,.5),e.radius[i][s]=n.range(.3,1)*r,e.falloff[i][s]=1.2}}},ql=(e,t)=>{const n=e.attract.length;if(!(n<2||t<=0))for(let r=0;r<n;r++){const a=(r+1)%n,i=(r-1+n)%n;e.attract[r][a]=e.attract[r][a]*(1-t)+.7*t,e.attract[r][i]=e.attract[r][i]*(1-t)+-.3*t}},TR=(e,t,n)=>{const r=Math.ceil(t/e),a=Math.ceil(t/e),i=r*a;return{cellSize:e,gridWidth:r,gridHeight:a,head:new Int32Array(i).fill(-1),next:new Int32Array(n).fill(-1),maxParticles:n}},IR=e=>{e.head.fill(-1)},PR=(e,t,n,r)=>{const a=Math.floor((n+1)/e.cellSize),i=Math.floor((r+1)/e.cellSize);if(a>=0&&a<e.gridWidth&&i>=0&&i<e.gridHeight){const s=i*e.gridWidth+a;e.next[t]=e.head[s],e.head[s]=t}},FR=(e,t,n,r)=>{const a=Math.floor((t+1)/e.cellSize),i=Math.floor((n+1)/e.cellSize);for(let s=-1;s<=1;s++)for(let c=-1;c<=1;c++){const l=a+c,d=i+s;if(l>=0&&l<e.gridWidth&&d>=0&&d<e.gridHeight){const u=d*e.gridWidth+l;let h=e.head[u];for(;h!==-1;)r(h),h=e.next[h]}}};let ev=null,tv=null,nv=null;function vD(e){ev=e}function SD(e){tv=e}function wD(e){nv=e}function Sg(e,t,n,r){nv&&nv(e,t,n,r)}function wg(e,t){const n=ev?ev(e,t):{nutrient:.5,tension:0,memory:0,entropy:0,scarcity:.5,cohesion:0,volatility:0},r=tv?tv(e,t):{bond:0,rift:0,bloom:0,oath:0};return{...n,sigilBond:r.bond,sigilRift:r.rift,sigilBloom:r.bloom,sigilOath:r.oath}}const MD=(e,t,n,r,a,i,s)=>{const c=t.mutationRate,l=t.typeStability;for(let d=0;d<e.count;d++){const u=e.type[d];if(u===fd||u<0||u>=t.typesCount)continue;e.age[d]++;const h=r(e.x[d],e.y[d]),m=h.entropy||0,f=h.volatility||0,g=h.nutrient||.5,x=.7+e.energy[d]*.6,v=.02;e.size[d]+=(x-e.size[d])*v,e.size[d]=Math.max(.5,Math.min(2,e.size[d]));const b=Math.max(0,(e.energy[d]-1.5)/1.5),w=(m*.5+f*.3)*.3,M=Math.min(1,e.age[d]/3600),k=b*.4+w*.3+M*.3;e.mutationPotential[d]+=k*.01,e.mutationPotential[d]*=l,e.mutationPotential[d]=Math.max(0,Math.min(1,e.mutationPotential[d]));const R=c*(1+e.mutationPotential[d]*10);if(a.next()<R){const j=u;let I=j;e.energy[d]>1.5?I=(j+1)%t.typesCount:e.energy[d]<.5?I=Math.max(0,j-1):m>.6||f>.6?I=a.int(0,t.typesCount-1):e.age[d]>1800&&(I=a.int(0,t.typesCount-1),e.energy[d]=1),I!==j&&(e.type[d]=I,e.mutationPotential[d]=0,e.age[d]=0,e.energy[d]*=.7,e.size[d]=Math.min(2,e.size[d]*1.3))}g>.6&&(e.energy[d]+=(g-.6)*.002),t.energyEnabled&&(e.energy[d]*=1-t.energyDecay),e.energy[d]=Math.max(.1,Math.min(3,e.energy[d]))}};let fh=null,GM=0,Bd=null,ph=null,rv=0,ov=0;const _R=()=>({neighborsChecked:rv,interactionsApplied:ov}),CD=(e,t,n)=>{let r=n+e*374761393+t*668265263;return r=(r^r>>>13)*1274126177,r=r^r>>>16,(r>>>0)/4294967296},zp=(e,t,n,r,a,i)=>{let s=t.rmax;if(n.radius&&n.radius.length>=t.typesCount){for(let l=0;l<t.typesCount;l++)if(n.radius[l]&&n.radius[l].length>=t.typesCount)for(let d=0;d<t.typesCount;d++)n.radius[l][d]!==void 0&&(s=Math.max(s,n.radius[l][d]))}s=Math.max(s,.08),(!fh||Math.abs(fh.cellSize-s)>.01||e.maxCount!==GM)&&(fh=TR(s,2,e.maxCount),GM=e.maxCount),(!Bd||Bd.length!==e.maxCount)&&(Bd=new Float32Array(e.maxCount),ph=new Float32Array(e.maxCount)),Bd.fill(0),ph.fill(0),rv=0,ov=0,IR(fh);for(let l=0;l<e.count;l++)PR(fh,l,e.x[l],e.y[l]);for(let l=0;l<e.count;l++){const d=e.x[l],u=e.y[l],h=e.type[l];if(h!==fd&&(h<0||h>=t.typesCount))continue;const m=wg(d,u),f=r(d,u),g=m.scarcity||f.scarcity||0,x=m.cohesion||f.cohesion||0,v=m.volatility||0,b=m.nutrient||.5,w=m.entropy||0,M=t.enableSigilForces!==!1,k=.05,R=Number(m.sigilBond??0),j=Number(m.sigilRift??0),I=M&&Number.isFinite(R)?Math.max(0,Math.min(1,R)):0,E=M&&Number.isFinite(j)?Math.max(0,Math.min(1,j)):0,O=m.sigilOath||0;let L=t.beta*(1+(g-.5)*.25);L=Math.max(.05,Math.min(.95,L)),t.drag*(1+v*.35-x*.2+E*.22-O*.14),FR(fh,d,u,F=>{var we,ke,De,_e;if(l===F)return;let B=e.x[F]-d,W=e.y[F]-u;t.wrap&&(B>1&&(B-=2),B<-1&&(B+=2),W>1&&(W-=2),W<-1&&(W+=2)),rv++;const re=B*B+W*W;if(re<1e-8)return;const oe=e.type[F];if(oe!==fd&&(oe<0||oe>=t.typesCount)||!((we=n.radius)!=null&&we[h])||n.radius[h][oe]===void 0||!((ke=n.attract)!=null&&ke[h])||n.attract[h][oe]===void 0)return;let te=n.radius[h][oe];te=te*(1+g*.2);const J=te*te;if(re>=J)return;const pe=Math.sqrt(re);if(pe<1e-4)return;const P=n.attract[h][oe];let V=0;if(t.kernelMode==="classic"){const ae=pe/te;ae<L?V=(ae/L-1)*t.coreRepel:V=P*(1-Math.abs(1+L-2*ae)/(1-L))}else{const ae=((_e=(De=n.falloff)==null?void 0:De[h])==null?void 0:_e[oe])??1.2,Re=pe/te;V=P*Math.pow(1-Re,ae)}const fe=1+(b-.5)*.35-v*.2+(I-E)*k;V*=fe;const ye=Math.abs(V);V>.08&&ye<.6&&Sg("bond",d,u,.01*ye),V<-.1&&Sg("rift",d,u,.01*ye);const Se=1/(pe+t.softening);Bd[l]+=B*Se*V,ph[l]+=W*Se*V,ov++});const $=(w+(E-I)*k)*.015;if(Bd[l]+=(a.next()-.5)*$,ph[l]+=(a.next()-.5)*$,g>.3){const F=i+l*12345,B=CD(Math.floor(d*100),Math.floor(u*100),F)*Math.PI*2;Bd[l]+=Math.cos(B)*g*.004,ph[l]+=Math.sin(B)*g*.004}}for(let l=0;l<e.count;l++){const d=e.type[l];if(d!==fd&&(d<0||d>=t.typesCount))continue;if(d===fd)e.energy[l]=Math.max(.1,e.energy[l]*.999);else{if(e.vx[l]+=Bd[l]*t.force*t.dt,e.vy[l]+=ph[l]*t.force*t.dt,t.entropy>0&&(e.vx[l]+=(a.next()-.5)*t.entropy,e.vy[l]+=(a.next()-.5)*t.entropy),t.useDrag){const g=wg(e.x[l],e.y[l]),x=g.cohesion||0,v=g.volatility||0,b=t.drag*(1+v*.35-x*.2),w=Math.exp(-b*t.dt);e.vx[l]*=w,e.vy[l]*=w}else e.vx[l]*=t.friction,e.vy[l]*=t.friction;const h=e.vx[l]*e.vx[l]+e.vy[l]*e.vy[l];if(h>t.speedClamp*t.speedClamp){const g=Math.sqrt(h);e.vx[l]=e.vx[l]/g*t.speedClamp,e.vy[l]=e.vy[l]/g*t.speedClamp}e.x[l]+=e.vx[l]*t.dt,e.y[l]+=e.vy[l]*t.dt;const m=wg(e.x[l],e.y[l]),f=Math.sqrt(e.vx[l]*e.vx[l]+e.vy[l]*e.vy[l]);m.nutrient&&m.nutrient>.62&&f<.06&&Sg("bloom",e.x[l],e.y[l],.006),(m.memory&&m.memory>.58||m.cohesion&&m.cohesion>.58)&&f<.045&&Sg("oath",e.x[l],e.y[l],.006)}t.wrap?(e.x[l]>1&&(e.x[l]-=2),e.x[l]<-1&&(e.x[l]+=2),e.y[l]>1&&(e.y[l]-=2),e.y[l]<-1&&(e.y[l]+=2)):(e.x[l]>1&&(e.x[l]=1,e.vx[l]*=-.5),e.x[l]<-1&&(e.x[l]=-1,e.vx[l]*=-.5),e.y[l]>1&&(e.y[l]=1,e.vy[l]*=-.5),e.y[l]<-1&&(e.y[l]=-1,e.vy[l]*=-.5))}const c=e.historyIndex;for(let l=0;l<e.count;l++)e.historyX[c][l]=e.x[l],e.historyY[c][l]=e.y[l];e.historyIndex=(e.historyIndex+1)%e.historyLength,t.metamorphosisEnabled&&MD(e,t,n,(l,d)=>{const u=wg(l,d);return{entropy:u.entropy||0,volatility:u.volatility||0,nutrient:u.nutrient||.5}},a)},Mg=(e,t,n,r,a)=>{for(let i=0;i<e.count;i++){const s=e.x[i]-t,c=e.y[i]-n,l=s*s+c*c;if(l<r*r&&l>1e-4){const d=Math.sqrt(l),u=a*(1-d/r);e.vx[i]+=s/d*u,e.vy[i]+=c/d*u}}},kD=(e,t,n,r,a,i)=>{for(let s=0;s<e.count;s++){const c=e.x[s]-t,l=e.y[s]-n,d=c*c+l*l;if(d<r*r){const h=1-Math.sqrt(d)/r;e.vx[s]+=a*h*.01,e.vy[s]+=i*h*.01}}},S2=(e,t,n,r,a)=>{for(let i=0;i<e.count;i++){const s=e.x[i]-t,c=e.y[i]-n,l=s*s+c*c;if(l<r*r&&l>1e-4){const d=Math.sqrt(l),u=a*(1-d/r)*(1-d/r);e.vx[i]+=s/d*u,e.vy[i]+=c/d*u}}},w2=(e,t,n,r,a)=>{for(let i=0;i<e.count;i++){const s=e.x[i]-t,c=e.y[i]-n,l=s*s+c*c;if(l<r*r&&l>1e-4){const d=Math.sqrt(l),u=a*(1-d/r)*(1-d/r);e.vx[i]-=s/d*u,e.vy[i]-=c/d*u}}},M2=(e,t,n,r,a)=>{for(let i=0;i<e.count;i++){const s=e.x[i]-t,c=e.y[i]-n,l=s*s+c*c;if(l<r*r&&l>1e-4){const d=Math.sqrt(l),u=1-d/r;e.vx[i]+=-c/d*a*u,e.vy[i]+=s/d*a*u}}},C2=(e,t,n,r,a)=>{for(let i=0;i<e.count;i++){const s=e.x[i]-t,c=e.y[i]-n,l=s*s+c*c;if(l<r*r){const d=Math.sqrt(l),u=a*(1-d/r);e.vx[i]*=1-u,e.vy[i]*=1-u}}},k2=(e,t,n,r,a)=>{for(let i=0;i<e.count;i++){const s=e.x[i]-t,c=e.y[i]-n,l=s*s+c*c;if(l<r*r){const u=1-Math.sqrt(l)/r,h=Math.random()*Math.PI*2;e.vx[i]+=Math.cos(h)*a*u,e.vy[i]+=Math.sin(h)*a*u}}},R2=(e,t,n,r,a,i)=>{for(let s=0;s<e.count;s++){const c=e.x[s]-t,l=e.y[s]-n,d=c*c+l*l;if(d<r*r&&d>1e-4){const u=Math.sqrt(d),h=Math.sin(u/r*Math.PI*6-i*10),m=a*h*(1-u/r);e.vx[s]+=c/u*m,e.vy[s]+=l/u*m}}},A2=(e,t,n,r,a,i)=>{const s=i===0?-1:1,c=i===1?2.5:1.5;for(let l=0;l<e.count;l++){const d=e.x[l]-t,u=e.y[l]-n,h=d*d+u*u;if(h<r*r&&h>1e-4){const m=Math.sqrt(h),f=Math.pow(1-m/r,c);e.vx[l]+=s*(d/m)*a*f,e.vy[l]+=s*(u/m)*a*f}}},j2=(e,t,n,r,a,i)=>{for(let s=0;s<e.count;s++){if(e.type[s]===255)continue;const c=e.x[s]-t,l=e.y[s]-n,d=c*c+l*l;if(d<r*r){const u=Math.sqrt(d),h=a*(1-u/r);Math.random()<h&&(e.type[s]=i)}}};function VM(){return{enabled:!0,gridW:96,gridH:96,writeGain:.08,decay:.04,diffusion:.18,influenceGain:.22,globalMix:.04,clampMax:1}}function RD(e){const t=e.gridW*e.gridH;return{C:new Float32Array(t),A:new Float32Array(t),S:new Float32Array(t),tmp:new Float32Array(t),w:e.gridW,h:e.gridH}}function gu(e,t,n,r){const a=(e%n+n)%n;return(t%r+r)%r*n+a}function AD(e,t,n,r){if(!t.enabled)return{c:0,a:0,s:0};const a=(n+1)/2*e.w,i=(r+1)/2*e.h,s=Math.floor(a),c=Math.floor(i),l=gu(s,c,e.w,e.h);return{c:e.C[l],a:e.A[l],s:e.S[l]}}function jD(e,t,n,r,a,i,s,c=1){if(!t.enabled)return;const l=Math.floor((n+1)/2*e.w),d=Math.floor((r+1)/2*e.h),u=c*c;for(let h=-c;h<=c;h++)for(let m=-c;m<=c;m++){const f=m*m+h*h;if(f>u)continue;const g=1-Math.sqrt(f/u),x=gu(l+m,d+h,e.w,e.h);e.C[x]=Math.min(t.clampMax,e.C[x]+a*g),e.A[x]=Math.min(t.clampMax,e.A[x]+i*g),e.S[x]=Math.min(t.clampMax,e.S[x]+s*g)}}function ED(e,t,n){if(!t.enabled)return;const r=e.w,a=e.h,i=r*a,s=Math.exp(-t.decay*n);for(let l=0;l<i;l++)e.C[l]*=s,e.A[l]*=s,e.S[l]*=s;const c=t.diffusion*n;if(E2(e.C,e.tmp,r,a,c),E2(e.A,e.tmp,r,a,c),E2(e.S,e.tmp,r,a,c),t.globalMix>0){const l=t.globalMix*n;let d=0,u=0,h=0;for(let m=0;m<i;m++)d+=e.C[m],u+=e.A[m],h+=e.S[m];d/=i,u/=i,h/=i;for(let m=0;m<i;m++)e.C[m]=k5(e.C[m],d,l),e.A[m]=k5(e.A[m],u,l),e.S[m]=k5(e.S[m],h,l)}}function E2(e,t,n,r,a){for(let i=0;i<e.length;i++)t[i]=e[i];for(let i=0;i<r;i++)for(let s=0;s<n;s++){const c=gu(s,i,n,r),l=t[gu(s,i-1,n,r)],d=t[gu(s,i+1,n,r)],u=t[gu(s+1,i,n,r)],h=t[gu(s-1,i,n,r)],m=(l+d+u+h)/4;e[c]=k5(t[c],m,a)}}function k5(e,t,n){return e+(t-e)*n}function UM(e,t,n,r,a,i,s){if(!s.cfg.enabled){zp(e,t,n,r,a,i);return}if(!n||!n.attract||!Array.isArray(n.attract)||n.attract.length===0){zp(e,t,n,r,a,i);return}const c=TD(e,s),l=n.attract.length,d=Array(l);for(let h=0;h<l;h++)if(Array.isArray(n.attract[h])){d[h]=Array(n.attract[h].length);for(let m=0;m<n.attract[h].length;m++)d[h][m]=n.attract[h][m],n.attract[h][m]*=c}zp(e,t,n,r,a,i),_R().interactionsApplied>0&&ID(e,t,n,s),ED(s.field,s.cfg,t.dt);for(let h=0;h<l;h++)if(d[h])for(let m=0;m<d[h].length;m++)n.attract[h][m]=d[h][m]}function TD(e,t){let r=0,a=0;for(let c=0;c<16;c++){const l=Math.floor(c/16*e.count);if(l>=e.count)continue;const{a:d,s:u}=AD(t.field,t.cfg,e.x[l],e.y[l]);r+=d,a+=u}const i=r/16,s=a/16;return Math.max(.7,Math.min(1.3,1+t.cfg.influenceGain*(i-s)))}function ID(e,t,n,r){var s;const i=Math.max(1,Math.floor(10));for(let c=0;c<e.count;c+=i){const l=e.x[c],d=e.y[c],u=e.type[c];for(let h=c+1;h<Math.min(c+10,e.count);h++){const m=e.x[h]-l,f=e.y[h]-d;if(m*m+f*f>.25*.25)continue;const x=e.type[h],v=((s=n.attract[u])==null?void 0:s[x])??0,b=(l+e.x[h])/2,w=(d+e.y[h])/2,M=Math.min(1,Math.abs(v)*.5),k=r.cfg.writeGain*M,R=u===x&&v>0?r.cfg.writeGain*M:0,j=u!==x&&v<0?r.cfg.writeGain*M*.8:0;jD(r.field,r.cfg,b,w,k,R,j,1)}}}const PD=[{name:"Orbit",typesCount:3,particleCount:1200,config:{rmax:.12,force:1.2,friction:.92,speedClamp:.1},matrixInit:e=>{e.attract[0][0]=-.3,e.attract[0][1]=.5,e.attract[0][2]=-.2,e.attract[1][0]=-.5,e.attract[1][1]=-.3,e.attract[1][2]=.6,e.attract[2][0]=.6,e.attract[2][1]=-.5,e.attract[2][2]=-.3;for(let t=0;t<3;t++)for(let n=0;n<3;n++)e.radius[t][n]=.1,e.falloff[t][n]=1.2}},{name:"Flocks",typesCount:4,particleCount:1500,config:{rmax:.15,force:.8,friction:.88,speedClamp:.12},matrixInit:e=>{for(let t=0;t<4;t++)for(let n=0;n<4;n++)t===n?e.attract[t][n]=.4:e.attract[t][n]=-.2,e.radius[t][n]=.12,e.falloff[t][n]=1.5}},{name:"Borders",typesCount:5,particleCount:2e3,config:{rmax:.1,force:1,friction:.9,speedClamp:.12},matrixInit:e=>{for(let t=0;t<5;t++)for(let n=0;n<5;n++)t===n?e.attract[t][n]=.6:e.attract[t][n]=-.7,e.radius[t][n]=.08,e.falloff[t][n]=1}},{name:"Mitosis",typesCount:2,particleCount:800,config:{rmax:.2,force:1.5,friction:.85,speedClamp:.16},matrixInit:e=>{e.attract[0][0]=.7,e.attract[0][1]=-.9,e.attract[1][0]=-.9,e.attract[1][1]=.7,e.radius[0][0]=.15,e.radius[0][1]=.18,e.radius[1][0]=.18,e.radius[1][1]=.15,e.falloff[0][0]=1,e.falloff[0][1]=.8,e.falloff[1][0]=.8,e.falloff[1][1]=1}},{name:"Ritual",typesCount:6,particleCount:2500,config:{rmax:.14,force:.9,friction:.93,speedClamp:.1},matrixInit:e=>{for(let t=0;t<6;t++)for(let n=0;n<6;n++){const r=(n-t+6)%6;r===0?e.attract[t][n]=.3:r===1?e.attract[t][n]=.5:r===5?e.attract[t][n]=-.6:e.attract[t][n]=-.2,e.radius[t][n]=.11,e.falloff[t][n]=1.3}}},{name:"Crisis",typesCount:3,particleCount:1e3,config:{rmax:.08,force:2,friction:.8,speedClamp:.1,entropy:.002},matrixInit:e=>{e.attract[0][0]=.8,e.attract[0][1]=-.9,e.attract[0][2]=.6,e.attract[1][0]=.6,e.attract[1][1]=-.5,e.attract[1][2]=-.8,e.attract[2][0]=-.9,e.attract[2][1]=.7,e.attract[2][2]=.5;for(let t=0;t<3;t++)for(let n=0;n<3;n++)e.radius[t][n]=.06,e.falloff[t][n]=.7}},{name:"Symbiosis",typesCount:4,particleCount:1800,config:{rmax:.16,force:1.1,friction:.91,speedClamp:.12},matrixInit:e=>{e.attract[0][0]=.2,e.attract[0][1]=.8,e.attract[0][2]=-.3,e.attract[0][3]=-.4,e.attract[1][0]=.8,e.attract[1][1]=.2,e.attract[1][2]=-.4,e.attract[1][3]=-.3,e.attract[2][0]=-.3,e.attract[2][1]=-.4,e.attract[2][2]=.2,e.attract[2][3]=.8,e.attract[3][0]=-.4,e.attract[3][1]=-.3,e.attract[3][2]=.8,e.attract[3][3]=.2;for(let t=0;t<4;t++)for(let n=0;n<4;n++)e.radius[t][n]=.13,e.falloff[t][n]=1.4}},{name:"Anomaly",typesCount:7,particleCount:2800,config:{rmax:.13,force:1.3,friction:.87,speedClamp:.14,entropy:.003},matrixInit:e=>{for(let t=0;t<7;t++)for(let n=0;n<7;n++){const r=Math.sin(t*1.7+n*2.3)*.9;e.attract[t][n]=r,e.radius[t][n]=.1+Math.abs(Math.cos(t+n))*.05,e.falloff[t][n]=.9+Math.abs(Math.sin(t*n))*.8}}},{name:"Nested",typesCount:6,particleCount:2200,config:{rmax:.14,force:1,friction:.92,speedClamp:.12,entropy:.001},matrixInit:e=>{for(let t=0;t<6;t++){const n=Math.floor(t/2);for(let r=0;r<6;r++){const a=Math.floor(r/2);t===r?e.attract[t][r]=.5:n===a?e.attract[t][r]=.7:(a-n+3)%3===1?e.attract[t][r]=.2:(a-n+3)%3===2?e.attract[t][r]=-.6:e.attract[t][r]=-.1,e.radius[t][r]=.11,e.falloff[t][r]=1.3}}}},{name:"Particle Life",typesCount:6,particleCount:2e3,config:{rmax:.25,force:1.5,drag:1.3,useDrag:!0,beta:.3,coreRepel:1,kernelMode:"classic",speedClamp:.15,entropy:0,softening:1e-4},matrixInit:e=>{for(let n=0;n<6;n++)for(let r=0;r<6;r++){const a=n*1.3+r*2.7;e.attract[n][r]=Math.sin(a)*.8,e.radius[n][r]=.18+Math.cos(n+r)*.08,e.falloff[n][r]=1.2}e.attract[0][1]=.7,e.attract[1][0]=-.6,e.attract[2][3]=.6,e.attract[3][2]=-.5,e.attract[1][1]=.5,e.attract[3][3]=.4}},{name:"Membranes",typesCount:5,particleCount:2e3,config:{rmax:.14,force:1.1,friction:.91,speedClamp:.12},matrixInit:e=>{for(let t=0;t<5;t++)for(let n=0;n<5;n++)t===n?e.attract[t][n]=.7:e.attract[t][n]=-.8,e.radius[t][n]=.12,e.falloff[t][n]=1.2}},{name:"Predators",typesCount:4,particleCount:1600,config:{rmax:.16,force:1.3,friction:.89,speedClamp:.14},matrixInit:e=>{for(let t=0;t<4;t++){const n=(t+1)%4,r=(t-1+4)%4;for(let a=0;a<4;a++)a===n?e.attract[t][a]=.7:a===r?e.attract[t][a]=-.6:t===a?e.attract[t][a]=.3:e.attract[t][a]=-.2,e.radius[t][a]=.14,e.falloff[t][a]=1.4}}},{name:"Parasites",typesCount:6,particleCount:2200,config:{rmax:.13,force:1,friction:.9,speedClamp:.12},matrixInit:e=>{for(let t=0;t<6;t++)for(let n=0;n<6;n++)t===n?e.attract[t][n]=.4:t%2===0&&n%2===1?e.attract[t][n]=-.5:t%2===1&&n%2===0?e.attract[t][n]=.6:e.attract[t][n]=-.2,e.radius[t][n]=.11,e.falloff[t][n]=1.3}},{name:"Orbits",typesCount:5,particleCount:1800,config:{rmax:.15,force:1.2,friction:.92,speedClamp:.12},matrixInit:e=>{for(let n=0;n<5;n++)for(let r=0;r<5;r++)n===0?r===0?e.attract[n][r]=.5:e.attract[n][r]=-.3:r===0?e.attract[n][r]=.6:n===r?e.attract[n][r]=.2:e.attract[n][r]=-.4,e.radius[n][r]=.13,e.falloff[n][r]=1.3}},{name:" Genesis Pool",typesCount:3,particleCount:600,showSigils:!0,config:{rmax:.18,force:1,friction:.88,speedClamp:.12,entropy:.004,beta:.15,drag:1.2,useDrag:!0},matrixInit:e=>{for(let t=0;t<3;t++)for(let n=0;n<3;n++)e.attract[t][n]=(t+n)%2===0?.3:-.3,e.radius[t][n]=.14,e.falloff[t][n]=1.2}},{name:" Bond Ritual",typesCount:4,particleCount:1e3,showSigils:!0,config:{rmax:.16,force:1.4,friction:.9,speedClamp:.1,entropy:.002,beta:.25},matrixInit:e=>{for(let t=0;t<4;t++)for(let n=0;n<4;n++)t===n?e.attract[t][n]=.8:e.attract[t][n]=.4,e.radius[t][n]=.12,e.falloff[t][n]=1}},{name:" Rift Storm",typesCount:5,particleCount:1400,showSigils:!0,config:{rmax:.14,force:1.6,friction:.85,speedClamp:.14,entropy:.005,beta:.1},matrixInit:e=>{for(let t=0;t<5;t++)for(let n=0;n<5;n++)t===n?e.attract[t][n]=.3:e.attract[t][n]=-.7,e.radius[t][n]=.1,e.falloff[t][n]=.9}},{name:" Bloom Garden",typesCount:4,particleCount:1200,showSigils:!0,config:{rmax:.2,force:.9,friction:.92,speedClamp:.12,entropy:.003,beta:.2,drag:1.4,useDrag:!0},matrixInit:e=>{e.attract[0][0]=.5,e.attract[0][1]=.6,e.attract[0][2]=-.3,e.attract[0][3]=-.2,e.attract[1][0]=-.4,e.attract[1][1]=.4,e.attract[1][2]=.7,e.attract[1][3]=-.3,e.attract[2][0]=.6,e.attract[2][1]=-.5,e.attract[2][2]=.3,e.attract[2][3]=.5,e.attract[3][0]=-.3,e.attract[3][1]=.6,e.attract[3][2]=-.4,e.attract[3][3]=.4;for(let t=0;t<4;t++)for(let n=0;n<4;n++)e.radius[t][n]=.16,e.falloff[t][n]=1.3}},{name:" Oath Paths",typesCount:3,particleCount:800,showSigils:!0,config:{rmax:.18,force:.8,friction:.95,speedClamp:.08,entropy:.001,beta:.3},matrixInit:e=>{const t=[1,2,0];for(let n=0;n<3;n++)for(let r=0;r<3;r++)r===t[n]?e.attract[n][r]=.7:n===r?e.attract[n][r]=.2:e.attract[n][r]=-.4,e.radius[n][r]=.15,e.falloff[n][r]=1.4}},{name:" Speciation Vortex",typesCount:6,particleCount:1800,showSigils:!0,config:{rmax:.15,force:1.2,friction:.88,speedClamp:.13,entropy:.006,beta:.18,drag:1.3,useDrag:!0},matrixInit:e=>{for(let t=0;t<6;t++)for(let n=0;n<6;n++){const r=t*2.1+n*1.7;e.attract[t][n]=Math.sin(r)*.7,e.radius[t][n]=.12+Math.abs(Math.cos(t-n))*.04,e.falloff[t][n]=1.1}}},{name:" Crystal Archive",typesCount:4,particleCount:1e3,showSigils:!0,config:{rmax:.12,force:1,friction:.94,speedClamp:.08,entropy:.001,beta:.25},matrixInit:e=>{for(let t=0;t<4;t++)for(let n=0;n<4;n++)t===n?e.attract[t][n]=.6:(t+n)%2===0?e.attract[t][n]=.3:e.attract[t][n]=-.5,e.radius[t][n]=.1,e.falloff[t][n]=1}},{name:" Mutation Forge",typesCount:7,particleCount:2e3,showSigils:!0,config:{rmax:.14,force:1.4,friction:.86,speedClamp:.14,entropy:.008,beta:.12,drag:1.1,useDrag:!0},matrixInit:e=>{for(let t=0;t<7;t++)for(let n=0;n<7;n++){const r=Math.sin(t*3.14+n*1.618)*.9;e.attract[t][n]=r,e.radius[t][n]=.11,e.falloff[t][n]=.95}}},{name:" Sigil Mandala",typesCount:5,particleCount:1500,showSigils:!0,config:{rmax:.17,force:1.1,friction:.91,speedClamp:.11,entropy:.003,beta:.22,drag:1.25,useDrag:!0},matrixInit:e=>{for(let t=0;t<5;t++)for(let n=0;n<5;n++){const r=(n-t+5)%5*(2*Math.PI/5);e.attract[t][n]=Math.cos(r)*.6,e.radius[t][n]=.14,e.falloff[t][n]=1.2}}},{name:" Primordial Soup",typesCount:8,particleCount:2400,showSigils:!0,config:{rmax:.16,force:1,friction:.89,speedClamp:.13,entropy:.004,beta:.16,drag:1.2,useDrag:!0},matrixInit:e=>{for(let t=0;t<8;t++)for(let n=0;n<8;n++)t===n?e.attract[t][n]=.4:Math.abs(t-n)===1||Math.abs(t-n)===7?e.attract[t][n]=.5:Math.abs(t-n)===4?e.attract[t][n]=-.6:e.attract[t][n]=Math.sin(t+n)*.3,e.radius[t][n]=.13,e.falloff[t][n]=1.15}}],FD=()=>({enabled:!1,baseDecay:.003,motionCost:.005,feedRadius:.03,feedRate:.04,reproductionThreshold:2,reproductionCost:.8,childEnergyRatio:.5,mutationChance:.05,deathThreshold:.2,startEnergy:1.2});let op=null,YM=0,KM=0;const _D=(e,t,n,r,a)=>{if(!n.enabled)return{births:0,deaths:0};let i=0,s=0;if(!e.energy||e.energy.length<a){e.energy=new Float32Array(a);for(let f=0;f<e.count;f++)e.energy[f]=n.startEnergy}for(let f=0;f<e.count;f++){e.energy[f]-=n.baseDecay;const g=Math.sqrt(e.vx[f]*e.vx[f]+e.vy[f]*e.vy[f]);e.energy[f]-=g*n.motionCost}(!op||Math.abs(YM-n.feedRadius)>.001||KM!==a)&&(op=TR(n.feedRadius,2,a),YM=n.feedRadius,KM=a),IR(op);for(let f=0;f<e.count;f++)PR(op,f,e.x[f],e.y[f]);const c=n.feedRadius*n.feedRadius,l=t.attract.length,d=[];for(let f=0;f<e.count;f++){const g=e.type[f];if(!(g>=l)){d.length=0,FR(op,e.x[f],e.y[f],x=>{d.push(x)});for(const x of d){if(x<=f)continue;const v=e.x[x]-e.x[f],b=e.y[x]-e.y[f],w=v*v+b*b;if(w<c&&w>1e-6){const M=e.type[x];if(M>=l)continue;t.attract[g]&&t.attract[g][M]!==void 0&&t.attract[g][M]>.3&&(e.energy[f]+=n.feedRate*t.attract[g][M]*.5),t.attract[M]&&t.attract[M][g]!==void 0&&t.attract[M][g]>.3&&(e.energy[x]+=n.feedRate*t.attract[M][g]*.5)}}}}const u=n.reproductionThreshold*3;for(let f=0;f<e.count;f++)e.energy[f]>u&&(e.energy[f]=u);const h=Math.max(1,Math.floor(e.count*.05)),m=[];for(let f=0;f<e.count&&m.length<h;f++)if(e.energy[f]>=n.reproductionThreshold&&e.count+m.length<a){e.energy[f]-=n.reproductionCost;const g=r.next()*Math.PI*2,x=.01+r.next()*.02;let v=e.type[f];if(r.next()<n.mutationChance){const b=t.attract.length;v=r.int(0,b-1)}m.push({x:e.x[f]+Math.cos(g)*x,y:e.y[f]+Math.sin(g)*x,vx:e.vx[f]*.5,vy:e.vy[f]*.5,type:v,energy:e.energy[f]*n.childEnergyRatio}),i++}for(const f of m){if(e.count>=a)break;const g=e.count;e.x[g]=f.x,e.y[g]=f.y,e.vx[g]=f.vx,e.vy[g]=f.vy,e.type[g]=f.type,e.energy[g]=f.energy,e.geneA&&(e.geneA[g]=e.geneA[Math.floor(r.next()*e.count)]||0),e.geneB&&(e.geneB[g]=e.geneB[Math.floor(r.next()*e.count)]||0),e.geneC&&(e.geneC[g]=e.geneC[Math.floor(r.next()*e.count)]||0),e.geneD&&(e.geneD[g]=e.geneD[Math.floor(r.next()*e.count)]||0),e.archetypeId&&(e.archetypeId[g]=e.archetypeId[Math.floor(r.next()*e.count)]||0),e.age&&(e.age[g]=0),e.size&&(e.size[g]=1),e.count++}for(let f=e.count-1;f>=0;f--)if(e.energy[f]<n.deathThreshold){const g=e.count-1;f!==g&&(e.x[f]=e.x[g],e.y[f]=e.y[g],e.vx[f]=e.vx[g],e.vy[f]=e.vy[g],e.type[f]=e.type[g],e.energy[f]=e.energy[g],e.geneA&&(e.geneA[f]=e.geneA[g]),e.geneB&&(e.geneB[f]=e.geneB[g]),e.geneC&&(e.geneC[f]=e.geneC[g]),e.geneD&&(e.geneD[f]=e.geneD[g]),e.archetypeId&&(e.archetypeId[f]=e.archetypeId[g]),e.age&&(e.age[f]=e.age[g]),e.size&&(e.size[f]=e.size[g])),e.count--,s++}return{births:i,deaths:s}},ap=(e,t)=>{const n=e*t;return{width:e,height:t,tension:new Float32Array(n),cohesion:new Float32Array(n),scarcity:new Float32Array(n),novelty:new Float32Array(n),mythic:new Float32Array(n)}},ND=()=>({diffusion:.15,decay:.02,depositStrength:1,influenceStrength:.5}),$y=(e,t,n,r)=>{const a=Math.floor((e+1)/2*n),i=Math.floor((t+1)/2*r),s=Math.max(0,Math.min(n-1,a));return Math.max(0,Math.min(r-1,i))*n+s},jp=(e,t,n)=>{const r=$y(t,n,e.width,e.height);return{tension:e.tension[r],cohesion:e.cohesion[r],scarcity:e.scarcity[r],novelty:e.novelty[r],mythic:e.mythic[r]}},Ep=(e,t,n,r,a)=>{const i=$y(t,n,e.width,e.height);i>=0&&i<e[r].length&&(e[r][i]=Math.min(1,e[r][i]+a))},mh=(e,t,n,r,a,i,s,c,l)=>{const d=Math.max(3,Math.floor(r*e.width*.5));for(let u=0;u<d;u++){const h=u/d*Math.PI*2,m=r*Math.random(),f=t+Math.cos(h)*m,g=n+Math.sin(h)*m,x=$y(f,g,e.width,e.height);if(x>=0&&x<e.tension.length){const v=1-m/r;a!==0&&(e.tension[x]=Math.min(1,e.tension[x]+a*v)),i!==0&&(e.cohesion[x]=Math.min(1,e.cohesion[x]+i*v))}}},sp=(e,t,n,r,a)=>{for(let i=0;i<r;i++)for(let s=0;s<n;s++){const c=i*n+s;let l=e[c]*(1-a);s>0&&(l+=e[c-1]*a*.25),s<n-1&&(l+=e[c+1]*a*.25),i>0&&(l+=e[c-n]*a*.25),i<r-1&&(l+=e[c+n]*a*.25),t[c]=l}},ip=(e,t)=>{for(let n=0;n<e.length;n++)e[n]=Math.max(0,e[n]-t)},T2=new Map,OD=(e,t)=>{const n=e.width*e.height;T2.has(n)||T2.set(n,new Float32Array(n));const r=T2.get(n);sp(e.tension,r,e.width,e.height,t.diffusion),e.tension.set(r),sp(e.cohesion,r,e.width,e.height,t.diffusion),e.cohesion.set(r),sp(e.scarcity,r,e.width,e.height,t.diffusion),e.scarcity.set(r),sp(e.novelty,r,e.width,e.height,t.diffusion),e.novelty.set(r),sp(e.mythic,r,e.width,e.height,t.diffusion),e.mythic.set(r),ip(e.tension,t.decay),ip(e.cohesion,t.decay),ip(e.scarcity,t.decay),ip(e.novelty,t.decay),ip(e.mythic,t.decay)},DD=(e,t,n)=>{const r=t.width*t.height,a=new Float32Array(r),i=new Map,s=new Float32Array(r),c=16,l=Math.max(1,Math.floor(e.count/800)),d=t.width,u=t.height,h=v=>{const b=v%d;return d<=1?0:b/(d-1)*2-1},m=v=>{const b=Math.floor(v/d);return u<=1?0:b/(u-1)*2-1};for(let v=0;v<e.count;v+=l){const b=e.type[v];(b===255||b>=0&&b<c)&&(i.has(b)||i.set(b,new Uint32Array(r)))}const f=l;for(let v=0;v<e.count;v+=l){const b=e.type[v];if(b!==255&&(b<0||b>=c))continue;const w=$y(e.x[v],e.y[v],t.width,t.height);a[w]+=f;const M=i.get(b);M&&(M[w]+=f);const k=Math.sqrt(e.vx[v]*e.vx[v]+e.vy[v]*e.vy[v]);s[w]+=k*f}const g=e.count/r,x=1e-6;for(let v=0;v<r;v++){const b=a[v],w=b/(g+x);if(w>1.6){const k=h(v),R=m(v),j=(w-1.6)*.02*n;Ep(t,k,R,"tension",j)}let M=0;if(i.forEach(k=>{M=Math.max(M,k[v])}),b>0){const k=M/(b+x);if(k>.65&&w>1.2){const R=h(v),j=m(v),I=(k-.65)*(w-1.2)*.03*n;Ep(t,R,j,"cohesion",I)}}if(w<.35){const k=h(v),R=m(v),j=(.35-w)*.015*n;Ep(t,k,R,"scarcity",j)}if(b>0){const k=s[v]/(b+x);if(k>.07&&w>.9){const R=h(v),j=m(v),I=(k-.07)*.35*(w-.9)*n;Ep(t,R,j,"novelty",I)}}}},LD=()=>({cooldown:0,lastOperatorTime:0,artifacts:[],field:void 0}),zD=()=>({interval:3,mutationStrength:.15,speciationRate:.6,institutionRate:.25,operatorCooldown:2,matrixAttractScale:1,matrixRepelScale:1}),BD=(e,t)=>{for(let n=e.artifacts.length-1;n>=0;n--)e.artifacts[n].elapsed+=t,e.artifacts[n].elapsed>=e.artifacts[n].duration&&e.artifacts.splice(n,1)};let $D=0;const NR=(e,t,n,r,a)=>({id:`artifact-${$D++}`,name:e,x:t,y:n,radius:.2,duration:15,elapsed:0,effect:r,sigil:a}),qD=(e,t)=>{let n=0,r=0,a=0,i=0,s=0;for(let w=0;w<t.tension.length;w++)n+=t.tension[w],r+=t.cohesion[w],a+=t.scarcity[w],i+=t.novelty[w],s+=t.mythic[w];const c=t.tension.length,l=n/c,d=r/c,u=a/c,h=i/c,m=s/c;let f=0;for(let w=0;w<c;w++)t.cohesion[w]>.12&&f++;const g=Math.max(0,Math.min(1,l*1.25)),x=Math.abs(l-d),v=u>.18,b=h>.14;return{stableClusters:f,borderStrength:g,oscillation:x,scarcityCrisis:v,noveltyBurst:b,avgTension:l,avgCohesion:d,avgScarcity:u,avgNovelty:h,avgMythic:m}},I2=(e,t)=>{const n=new Array(t).fill(0);for(let a=0;a<e.count;a++)n[e.type[a]]++;let r=0;for(let a=0;a<t;a++)if(n[a]>0){const i=n[a]/e.count;r-=i*Math.log2(i)}return r/Math.log2(t)},OR=e=>Math.max(0,Math.min(1,e)),R5=(e,t,n)=>Math.max(t,Math.min(n,e));function ty(e,t){return!Number.isFinite(e)||!Number.isFinite(t)||t<=1?0:e/(t-1)*2-1}function DR(e){var s,c,l,d;const t=e.width,n=e.height,r=t*n;let a=0,i=-1/0;for(let u=0;u<r;u++){const h=((s=e.mythic)==null?void 0:s[u])??((c=e.novelty)==null?void 0:c[u])??((l=e.cohesion)==null?void 0:l[u])??((d=e.tension)==null?void 0:d[u])??0,m=typeof h=="number"&&Number.isFinite(h)?h:0;m>i&&(i=m,a=u)}return a}const HD=(e,t,n,r,a,i,s,c,l,d)=>{if(d-r.lastOperatorTime<3)return null;const u=l.next();if(u<i&&(a.borderStrength>.05||a.avgTension>.06||a.noveltyBurst||a.oscillation>.08)){r.lastOperatorTime=d;const h=l.int(2,4),m=typeof r.mutationAmount=="number"&&Number.isFinite(r.mutationAmount)?r.mutationAmount:.06,f=R5(m*1.45,.03,.22);for(let g=0;g<h;g++){const x=l.int(0,t.typesCount-1),v=l.int(0,t.typesCount-1),b=l.range(-f,f);n.attract[x][v]=Math.max(-1,Math.min(1,n.attract[x][v]+b))}return{time:d,type:"mutation",message:"Contact patterns shift",sigil:""}}{const h=r.field,m=h?h.width*h.height:1296,f=Math.max(8,Math.floor(m*.01));if(a.stableClusters>f&&u<s&&t.typesCount<16){r.lastOperatorTime=d;const g=t.typesCount,x=g+1;t.typesCount=x,Zx(n,x,l,t.rmax);const v=l.int(0,g-1);let b=0;const w=Math.floor(e.count*(.1+l.next()*.1));for(let M=0;M<e.count&&b<w;M++)e.type[M]===v&&l.next()<.5&&(e.type[M]=g,b++);return{time:d,type:"speciation",message:` Speciation! ${g}  ${t.typesCount} (${b} converted)`,sigil:""}}}if((a.oscillation>.2||a.avgMythic>.2)&&u<c){r.lastOperatorTime=d;let h=0,m=0;const f=r.field;if(f&&f.width>0&&f.height>0){const x=DR(f),v=x%f.width,b=Math.floor(x/f.width);h=ty(v,f.width),m=ty(b,f.height)}const g=NR("Taboo",h,m,{type:"field",fieldMod:{layer:"mythic",delta:.1}},"");return r.artifacts.push(g),{time:d,type:"institution",message:"A taboo spreads",sigil:""}}return null};function WD(e){const t=e.reconfigConfig;t.matrixAttractScale=R5((t.matrixAttractScale??1)*1.05,.3,1.5),t.matrixRepelScale=R5((t.matrixRepelScale??1)*.98,.3,1.5);const n=e.matrix.attract;for(let r=0;r<n.length;r++){const a=n[r];if(a)for(let i=0;i<a.length;i++){const s=a[i];Number.isFinite(s)&&(a[i]=R5(s>=0?s*1.05:s*.98,-1,1))}}}function GD(e){const{field:t}=e,n=t.width,r=t.height;if(n<=0||r<=0)return;const a=.12;for(let i=0;i<t.tension.length;i++){const s=i%n,c=Math.floor(i/n);if(s===0||c===0||s===n-1||c===r-1){const l=(t.tension[i]??0)+a;t.tension[i]=OR(l)}}}function VD(e){const{field:t,rng:n}=e,r=t.width,a=t.height;if(r<=0||a<=0)return;const i=n.int(3,5),s=.08;for(let c=0;c<i;c++){const l=n.int(0,r-1),d=n.int(0,a-1);for(let u=-1;u<=1;u++)for(let h=-1;h<=1;h++){const m=l+h,f=d+u;if(m<0||f<0||m>=r||f>=a)continue;const g=f*r+m;t.novelty[g]=OR((t.novelty[g]??0)+s)}}}function UD(e){const t=DR(e.field),n=t%e.field.width,r=Math.floor(t/e.field.width),a=ty(n,e.field.width),i=ty(r,e.field.height);e.reconfig.artifacts.push(NR("Taboo",a,i,{type:"field",fieldMod:{layer:"mythic",delta:.1}},"")),e.reconfig.lastOperatorTime=e.time}const YD=10,ml={borderFormed:.6,borderDissolved:.3,ritualPeak:.7,turbulenceSpike:.75,cohesionCollapse:.25,segregationPeak:.8};let bl=null;function KD(e){bl={lastPhase:e.phase,lastObservables:e,history:[{time:0,obs:e}]}}function XD(e,t){if(!bl)return KD(e),[];const n=[],r=bl.lastObservables;if(e.phase!==bl.lastPhase&&n.push({type:"PHASE_SHIFT",timestamp:t,message:`Phase transition: ${bl.lastPhase}  ${e.phase}`,metrics:{phase:e.phase}}),r.borderStrength<ml.borderFormed&&e.borderStrength>=ml.borderFormed&&n.push({type:"BORDER_FORMED",timestamp:t,message:`Borders crystallizing (strength ${e.borderStrength.toFixed(2)})`,metrics:{borderStrength:e.borderStrength}}),r.borderStrength>=ml.borderDissolved&&e.borderStrength<ml.borderDissolved&&n.push({type:"BORDER_DISSOLVED",timestamp:t,message:"Borders dissolving - mixing resumed",metrics:{borderStrength:e.borderStrength}}),r.ritualSync<ml.ritualPeak&&e.ritualSync>=ml.ritualPeak&&n.push({type:"RITUAL_SYNC_PEAK",timestamp:t,message:`Ritual synchronization achieved (${(e.ritualSync*100).toFixed(0)}%)`,metrics:{ritualSync:e.ritualSync}}),r.volatility<ml.turbulenceSpike&&e.volatility>=ml.turbulenceSpike&&n.push({type:"TURBULENCE_SPIKE",timestamp:t,message:"System entering chaotic regime",metrics:{volatility:e.volatility}}),r.cohesion>=ml.cohesionCollapse&&e.cohesion<ml.cohesionCollapse&&n.push({type:"COHESION_COLLAPSE",timestamp:t,message:"Social fabric fraying - dispersion",metrics:{cohesion:e.cohesion}}),r.segregation<ml.segregationPeak&&e.segregation>=ml.segregationPeak&&n.push({type:"SEGREGATION_PEAK",timestamp:t,message:"Maximum segregation reached - types isolated",metrics:{segregation:e.segregation}}),bl.history.length>=3){const i=bl.history.slice(-3).map(c=>c.obs.cohesion);i.every((c,l)=>l===0||c>i[l-1])&&r.cohesion<.4&&e.cohesion>=.4&&n.push({type:"RECOVERY",timestamp:t,message:"System recovering - cohesion rebuilding",metrics:{cohesion:e.cohesion}})}return bl.lastPhase=e.phase,bl.lastObservables=e,bl.history.push({time:t,obs:e}),bl.history.length>YD&&bl.history.shift(),n}function JD(e){const{cohesion:t,segregation:n,borderStrength:r,volatility:a}=e;return a>.7?"turbulent":t>.6&&r<.3?"cluster":t>.5&&n<.5?"swarm":"dispersed"}const QD=e=>Math.max(0,Math.min(1,e));function ZD(e,t,n){const r=Number.isFinite(t.avgCohesion)?t.avgCohesion:0,a=Number.isFinite(t.borderStrength)?t.borderStrength:0,i=n?Math.abs(r-n.cohesion)+Math.abs(a-n.borderStrength):0,s=QD(i*2.5),c=0,l=0,d=JD({cohesion:r,segregation:c,borderStrength:a,volatility:s});return{cohesion:r,segregation:c,borderStrength:a,volatility:s,ritualSync:l,phase:d}}function XM(e){return(e==null?void 0:e.type)??(e==null?void 0:e.kind)??""}function eL(e,t){if(!(!e||e.length===0)){console.debug("[Emergence]",e.map(XM));for(const n of e){const r=XM(n);if(r==="PHASE_SHIFT"){WD(t);continue}if(r==="COHESION_COLLAPSE"){UD(t);continue}if(r==="BORDER_FORMED"||r.includes("BORDER")){GD(t);continue}if(r==="NOVELTY_SPIKE"||r==="TURBULENCE_SPIKE"||r.includes("NOVELTY")||r.includes("TURBULENCE")){VD(t);continue}}}}const tL=()=>({beats:[],maxBeats:50}),gh=(e,t)=>{e.beats.unshift(t),e.beats.length>e.maxBeats&&e.beats.pop()},nL=()=>({snapshots:[],maxSnapshots:20,currentIndex:-1}),Cg=(e,t,n,r,a,i)=>{var d,u;const s={attract:n.attract.map(h=>[...h]),radius:n.radius.map(h=>[...h]),falloff:((d=n.falloff)==null?void 0:d.map(h=>[...h]))??Array(n.attract.length).fill(0).map(()=>Array(n.attract.length).fill(1.2))},c={attract:r.attract.map(h=>[...h]),radius:r.radius.map(h=>[...h]),falloff:((u=r.falloff)==null?void 0:u.map(h=>[...h]))??Array(r.attract.length).fill(0).map(()=>Array(r.attract.length).fill(1.2))},l={timestamp:i,microConfig:{...t},matrix:s,baseMatrix:c,artifacts:a.artifacts.map(h=>({...h}))};e.snapshots.push(l),e.snapshots.length>e.maxSnapshots&&e.snapshots.shift(),e.currentIndex=e.snapshots.length-1},LR=e=>e.snapshots.length>1,rL=(e,t,n,r,a)=>{if(!LR(e))return!1;e.snapshots.pop(),e.currentIndex=e.snapshots.length-1;const i=e.snapshots[e.currentIndex];return Object.assign(t,i.microConfig),di(i.matrix,n),di(i.baseMatrix,r),a.artifacts=i.artifacts.map(s=>({...s})),!0},oL=`#version 300 es
precision highp float;

in vec2 a_position;
in float a_type;
in float a_size; // Per-particle size multiplier
in float a_mutationGlow; // Mutation potential glow (0-1)

uniform float u_pointSize;
uniform float u_typeCount;

out float v_type;
out float v_mutationGlow;

void main() {
  gl_Position = vec4(a_position, 0.0, 1.0);
  gl_PointSize = u_pointSize * a_size; // Scale by particle size
  v_type = a_type;
  v_mutationGlow = a_mutationGlow;
}
`,aL=`#version 300 es
precision highp float;

in float v_type;
in float v_mutationGlow;
uniform float u_typeCount;
uniform float u_glow; // G) Glow intensity
uniform vec3 u_palette[16]; // G) Color palette (max 16 types)

out vec4 fragColor;

void main() {
  // Circular point with smooth edge
  vec2 coord = gl_PointCoord - 0.5;
  float dist = length(coord) * 2.0; // normalize to 0-1
  
  if (dist > 1.0) discard;
  
  // Smooth antialiased edge
  float edge = 1.0 - smoothstep(0.9, 1.0, dist);
  
  // Radial gradient (soft center)
  float gradient = 1.0 - (dist * dist * 0.5);
  float alpha = edge * gradient * 0.85;
  
  // Get color from palette
  int typeIndex = int(v_type);
  if (typeIndex < 0 || typeIndex >= 16) typeIndex = 0;
  vec3 color = u_palette[typeIndex];
  
  // Optional glow: brighten center
  if (u_glow > 0.01) {
    float glowFactor = exp(-dist * dist * 3.0);
    color *= (1.0 + glowFactor * u_glow * 0.5);
    alpha += glowFactor * u_glow * 0.1;
  }
  
  // Mutation glow: pulsing white ring when mutating
  if (v_mutationGlow > 0.01) {
    float ringDist = abs(dist - 0.6); // Ring at 60% radius
    float ringIntensity = exp(-ringDist * 15.0) * v_mutationGlow;
    color = mix(color, vec3(1.0, 0.95, 0.8), ringIntensity * 0.7); // Golden glow
    alpha += ringIntensity * 0.3;
  }
  
  fragColor = vec4(color, clamp(alpha, 0.0, 1.0));
}
`,kg=(e,t,n)=>{const r=e.createShader(t);return r?(e.shaderSource(r,n),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)?r:(console.error("Shader compile error:",e.getShaderInfoLog(r)),e.deleteShader(r),null)):null},JM=(e,t,n)=>{const r=e.createProgram();return r?(e.attachShader(r,t),e.attachShader(r,n),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS)?r:(console.error("Program link error:",e.getProgramInfoLog(r)),e.deleteProgram(r),null)):null},sL=e=>{const t=e.getContext("webgl2",{alpha:!1,antialias:!1,preserveDrawingBuffer:!0});if(!t)return null;const n=kg(t,t.VERTEX_SHADER,oL),r=kg(t,t.FRAGMENT_SHADER,aL);if(!n||!r)return null;const a=JM(t,n,r);if(!a)return null;const i=t.createBuffer(),s=t.createBuffer(),c=t.createBuffer(),l=t.createBuffer(),d=t.createVertexArray();if(!i||!s||!c||!l||!d)return null;t.bindVertexArray(d),t.bindBuffer(t.ARRAY_BUFFER,i);const u=t.getAttribLocation(a,"a_position");t.enableVertexAttribArray(u),t.vertexAttribPointer(u,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,s);const h=t.getAttribLocation(a,"a_type");t.enableVertexAttribArray(h),t.vertexAttribPointer(h,1,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,c);const m=t.getAttribLocation(a,"a_size");t.enableVertexAttribArray(m),t.vertexAttribPointer(m,1,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,l);const f=t.getAttribLocation(a,"a_mutationGlow");t.enableVertexAttribArray(f),t.vertexAttribPointer(f,1,t.FLOAT,!1,0,0),t.bindVertexArray(null);const g={pointSize:t.getUniformLocation(a,"u_pointSize"),typeCount:t.getUniformLocation(a,"u_typeCount"),glow:t.getUniformLocation(a,"u_glow"),palette:t.getUniformLocation(a,"u_palette")},x={index:-1,typesCount:-1,array:new Float32Array(48)};let v=null,b=null,w=null;const M=`#version 300 es
in vec2 a_position;
out vec2 v_texCoord;
void main(){v_texCoord=a_position*0.5+0.5;gl_Position=vec4(a_position,0.0,1.0);}`,k=`#version 300 es
precision mediump float;
in vec2 v_texCoord;
out vec4 fragColor;
uniform float u_fade;
void main(){float alpha=1.0-u_fade;fragColor=vec4(0.02,0.02,0.05,alpha);}`,R=kg(t,t.VERTEX_SHADER,M),j=kg(t,t.FRAGMENT_SHADER,k);if(R&&j&&(w=JM(t,R,j),w&&(v=t.createVertexArray(),b=t.createBuffer(),v&&b))){t.bindVertexArray(v),t.bindBuffer(t.ARRAY_BUFFER,b),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),t.STATIC_DRAW);const I=t.getAttribLocation(w,"a_position");t.enableVertexAttribArray(I),t.vertexAttribPointer(I,2,t.FLOAT,!1,0,0),t.bindVertexArray(null)}return{gl:t,canvas:e,program:a,fadeProgram:w,positionBuffer:i,typeBuffer:s,sizeBuffer:c,mutationGlowBuffer:l,vao:d,fadeVao:v,quadBuffer:b,config:{pointSize:4,fade:.96,glow:.5,paletteIndex:0},positionsArray:null,typesArray:null,sizesArray:null,mutationGlowsArray:null,maxParticles:0,uniforms:g,paletteCache:x,lastCount:-1,cachedW:0,cachedH:0}},iL=e=>{const{canvas:t,gl:n}=e,r=window.devicePixelRatio||1,a=t.getBoundingClientRect(),i=Math.floor(a.width*r),s=Math.floor(a.height*r);(t.width!==i||t.height!==s)&&(t.width=i,t.height=s,e.cachedW=i,e.cachedH=s),n.viewport(0,0,t.width,t.height)},lL=(e,t)=>{Object.assign(e.config,t)},cL=(e,t)=>{const{paletteCache:n,config:r}=e;if(n.index===r.paletteIndex&&n.typesCount===t)return;n.index=r.paletteIndex,n.typesCount=t;const a=n.array;for(let i=0;i<Math.min(t,16);i++){const s=iR(r.paletteIndex,i,t);a[i*3]=s[0],a[i*3+1]=s[1],a[i*3+2]=s[2]}},dL=(e,t,n,r,a,i)=>{const{gl:s,program:c,positionBuffer:l,typeBuffer:d,sizeBuffer:u,mutationGlowBuffer:h,vao:m,uniforms:f}=e;iL(e),s.clearColor(0,0,0,1),s.clear(s.COLOR_BUFFER_BIT),(!e.positionsArray||e.maxParticles<t.maxCount)&&(e.positionsArray=new Float32Array(t.maxCount*2),e.typesArray=new Float32Array(t.maxCount),e.sizesArray=new Float32Array(t.maxCount),e.mutationGlowsArray=new Float32Array(t.maxCount),e.maxParticles=t.maxCount,e.lastCount=-1),s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA);const g=e.positionsArray,x=e.typesArray,v=e.sizesArray,b=e.mutationGlowsArray,w=t.count;for(let E=0;E<w;E++){g[E*2]=t.x[E],g[E*2+1]=t.y[E],x[E]=t.type[E],v[E]=t.size[E];const O=t.mutationPotential[E];b[E]=Math.sin(O*Math.PI)*O}const M=g.subarray(0,w*2),k=x.subarray(0,w),R=v.subarray(0,w),j=b.subarray(0,w);e.lastCount===w?(s.bindBuffer(s.ARRAY_BUFFER,l),s.bufferSubData(s.ARRAY_BUFFER,0,M),s.bindBuffer(s.ARRAY_BUFFER,d),s.bufferSubData(s.ARRAY_BUFFER,0,k),s.bindBuffer(s.ARRAY_BUFFER,u),s.bufferSubData(s.ARRAY_BUFFER,0,R),s.bindBuffer(s.ARRAY_BUFFER,h),s.bufferSubData(s.ARRAY_BUFFER,0,j)):(s.bindBuffer(s.ARRAY_BUFFER,l),s.bufferData(s.ARRAY_BUFFER,M,s.DYNAMIC_DRAW),s.bindBuffer(s.ARRAY_BUFFER,d),s.bufferData(s.ARRAY_BUFFER,k,s.DYNAMIC_DRAW),s.bindBuffer(s.ARRAY_BUFFER,u),s.bufferData(s.ARRAY_BUFFER,R,s.DYNAMIC_DRAW),s.bindBuffer(s.ARRAY_BUFFER,h),s.bufferData(s.ARRAY_BUFFER,j,s.DYNAMIC_DRAW),e.lastCount=w),s.useProgram(c),s.bindVertexArray(m);const I=window.devicePixelRatio||1;s.uniform1f(f.pointSize,e.config.pointSize*I),s.uniform1f(f.typeCount,n),s.uniform1f(f.glow,e.config.glow),cL(e,n),s.uniform3fv(f.palette,e.paletteCache.array),s.blendFunc(s.SRC_ALPHA,s.ONE),s.drawArrays(s.POINTS,0,w),s.bindVertexArray(null)};let yu=null,Fo=null,QM=0,ZM=0;const uu=new Map,P2=new Map,qh=e=>{if(!P2.has(e)){const t=Py(e);P2.set(e,{solid:t,transparent:t.replace("rgb","rgba").replace(")",", 0.05)"),glow:t.replace("rgb","rgba").replace(")",", 0.15)")})}return P2.get(e)},e8=(e,t,n,r,a,i)=>{const s=`${i}_${Math.round(r-t)}_${Math.round(a-n)}`;if(!uu.has(s)){const c=e.createLinearGradient(0,0,r-t,a-n),l=qh(i);if(c.addColorStop(0,l.transparent),c.addColorStop(.5,l.solid.replace("rgb","rgba").replace(")",", 0.4)")),c.addColorStop(1,l.solid),uu.set(s,c),uu.size>50){const d=uu.keys().next().value;uu.delete(d)}}return uu.get(s)},uL=(e,t)=>{(!yu||QM!==e||ZM!==t)&&(yu=document.createElement("canvas"),yu.width=e,yu.height=t,Fo=yu.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!1}),Fo&&(Fo.fillStyle="rgb(5, 5, 13)",Fo.fillRect(0,0,e,t)),QM=e,ZM=t,uu.clear())},hL=(e,t,n,r,a,i="dots",s=8,c="HIGH",l=2)=>{const d=n/2,u=r/2,h=n/2,m=r/2,f=t.count,g=f>600?"FAST":f>400?"HIGH":c;if(a){if(uL(n,r),Fo&&yu){if(Fo.globalCompositeOperation="source-over",Fo.fillStyle="rgba(5, 5, 13, 0.08)",Fo.fillRect(0,0,n,r),i==="streaks"&&g!=="FAST"){Fo.lineCap="round";const x=new Map;for(let v=0;v<t.count;v++){const b=t.type[v],w=t.vx[v],M=t.vy[v],k=Math.sqrt(w*w+M*M);x.has(b)||x.set(b,[]),x.get(b).push({x:t.x[v]*d+h,y:t.y[v]*u+m,vx:w,vy:M,speed:k})}x.forEach((v,b)=>{const w=qh(b);for(const M of v){const k=Math.max(2,Math.min(24,M.speed*s*1e3)),R=Math.max(.8,Math.min(3.5,M.speed*800)),j=M.x-M.vx*k*d,I=M.y-M.vy*k*u;Fo.save(),Fo.translate(j,I),Fo.strokeStyle=e8(Fo,j,I,M.x,M.y,b),Fo.lineWidth=R,Fo.beginPath(),Fo.moveTo(0,0),Fo.lineTo(M.x-j,M.y-I),Fo.stroke(),Fo.restore(),M.speed>.03&&g==="ULTRA"&&(Fo.globalCompositeOperation="lighter",Fo.strokeStyle=w.glow,Fo.lineWidth=R*1.8,Fo.beginPath(),Fo.moveTo(j,I),Fo.lineTo(M.x,M.y),Fo.stroke(),Fo.globalCompositeOperation="source-over")}})}else for(let x=0;x<t.count;x++){const v=t.x[x]*d+h,b=t.y[x]*u+m,w=t.type[x];Fo.fillStyle=qh(w).solid,Fo.fillRect(v-l/2,b-l/2,l,l)}e.drawImage(yu,0,0)}if(g!=="FAST"&&t.count<500)for(let x=0;x<t.count;x++){const v=t.x[x]*d+h,b=t.y[x]*u+m,w=t.type[x];e.fillStyle=qh(w).solid,e.beginPath(),e.arc(v,b,l*.75,0,Math.PI*2),e.fill()}}else if(e.fillStyle="rgb(5, 5, 13)",e.fillRect(0,0,n,r),i==="streaks"&&g!=="FAST"){e.lineCap="round";const x=new Map;for(let v=0;v<t.count;v++){const b=t.type[v],w=t.vx[v],M=t.vy[v],k=Math.sqrt(w*w+M*M);x.has(b)||x.set(b,[]),x.get(b).push({x:t.x[v]*d+h,y:t.y[v]*u+m,vx:w,vy:M,speed:k})}x.forEach((v,b)=>{const w=qh(b);for(const M of v){const k=Math.max(2,Math.min(24,M.speed*s*1e3)),R=Math.max(.8,Math.min(3.5,M.speed*800)),j=M.x-M.vx*k*d,I=M.y-M.vy*k*u;e.save(),e.translate(j,I),e.strokeStyle=e8(e,j,I,M.x,M.y,b),e.lineWidth=R,e.beginPath(),e.moveTo(0,0),e.lineTo(M.x-j,M.y-I),e.stroke(),e.restore(),M.speed>.03&&g==="ULTRA"&&(e.globalCompositeOperation="lighter",e.strokeStyle=w.glow,e.lineWidth=R*1.8,e.beginPath(),e.moveTo(j,I),e.lineTo(M.x,M.y),e.stroke(),e.globalCompositeOperation="source-over"),e.fillStyle=w.solid,e.beginPath(),e.arc(M.x,M.y,l,0,Math.PI*2),e.fill()}})}else for(let x=0;x<t.count;x++){const v=t.x[x]*d+h,b=t.y[x]*u+m,w=t.type[x];e.fillStyle=qh(w).solid,g==="FAST"?e.fillRect(v-l/2,b-l/2,l,l):(e.beginPath(),e.arc(v,b,l,0,Math.PI*2),e.fill())}},fL={nutrient:"#34d399",tension:"#f87171",memory:"#60a5fa",entropy:"#fbbf24",sigilBond:"#5ac8fa",sigilRift:"#ff6b6b",sigilBloom:"#78ff8c",sigilOath:"#c084fc"},pL=(e,t,n,r,a,i)=>{const s=t.size,c=t.layers[n];if(!c)return;const l=fL[n]??"#ffffff",d=parseInt(l.slice(1,3),16),u=parseInt(l.slice(3,5),16),h=parseInt(l.slice(5,7),16),m=Math.min(r,256),f=Math.min(a,256),g=e.createImageData(m,f),x=g.data;for(let w=0;w<f;w++)for(let M=0;M<m;M++){const k=M/m*s,R=w/f*s,j=Math.min(Math.floor(k),s-1),I=Math.min(Math.floor(R),s-1),E=Math.min(j+1,s-1),O=Math.min(I+1,s-1),L=k-j,$=R-I,F=(c[I*s+j]*(1-L)+c[I*s+E]*L)*(1-$)+(c[O*s+j]*(1-L)+c[O*s+E]*L)*$;if(F>.02){const B=Math.pow(Math.min(1,F*i),.7),W=(w*m+M)*4;x[W]=d*B,x[W+1]=u*B,x[W+2]=h*B,x[W+3]=B*255}}e.save(),e.globalAlpha=.75;const v=document.createElement("canvas");v.width=m,v.height=f,v.getContext("2d").putImageData(g,0,0),e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="low",e.drawImage(v,0,0,r,a),e.restore()},mL=(e,t,n,r)=>{const a=n/2,i=r/2,s=n/2,c=r/2;for(const l of t){const d=l.x*a+s,u=l.y*i+c,h=l.radius*a,m=1-l.elapsed/l.duration;e.strokeStyle=`rgba(255, 100, 255, ${m*.6})`,e.lineWidth=2,e.beginPath(),e.arc(d,u,h*(1+Math.sin(l.elapsed*3)*.1),0,Math.PI*2),e.stroke(),e.fillStyle=`rgba(255, 150, 255, ${m})`,e.font="24px monospace",e.textAlign="center",e.textBaseline="middle",e.fillText(l.sigil,d,u)}},gL=(e,t,n,r,a,i,s)=>{let c="rgba(255, 255, 255, 0.5)";a==="CAPTURE"?c="rgba(255, 200, 0, 0.8)":a==="ERASE"?c="rgba(255, 100, 100, 0.6)":a==="SEED"&&(c="rgba(100, 255, 100, 0.6)"),e.strokeStyle=c,e.lineWidth=a==="CAPTURE"?2.5:1.5,e.setLineDash(a==="CAPTURE"?[2,2]:[4,4]),e.beginPath(),e.arc(t,n,r,0,Math.PI*2),e.stroke(),e.setLineDash([]);let l="rgba(255, 255, 255, 0.8)";a==="CAPTURE"&&(l="rgba(255, 220, 0, 1)"),e.fillStyle=l,e.font="11px monospace",e.textAlign="center",e.textBaseline="bottom",e.fillText(a,t,n-r-8),a==="CAPTURE"&&(e.strokeStyle="rgba(255, 220, 0, 0.6)",e.lineWidth=1,e.beginPath(),e.moveTo(t-6,n),e.lineTo(t+6,n),e.moveTo(t,n-6),e.lineTo(t,n+6),e.stroke())},yL=(e,t,n,r,a,i)=>{e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(10,i-70,200,60),e.fillStyle="rgba(255, 255, 255, 0.9)",e.font="11px monospace",e.textAlign="left",e.textBaseline="top",e.fillText(`Particles: ${t}`,15,i-65),e.fillText(`Species: ${n}`,15,i-50),e.fillText(`Last: ${r}`,15,i-35)},bL=(e,t,n,r)=>{const a=n/2,i=r/2,s=n/2,c=r/2;e.save();for(const l of t){const d=l.x*a+s,u=l.y*i+c,h=parseInt(l.color.slice(1,3),16),m=parseInt(l.color.slice(3,5),16),f=parseInt(l.color.slice(5,7),16),g=l.intensity,v=Date.now()/1e3-l.spawnTime,b=1+Math.sin(v*2.8)*.1,w=2;for(let j=0;j<w;j++){const I=(v*1.6+j*.5)%2;if(I<1){const E=22+I*55,O=(1-I)*g*.35;e.globalAlpha=O,e.strokeStyle=`rgb(${h},${m},${f})`,e.lineWidth=1.5,e.beginPath(),e.arc(d,u,E,0,Math.PI*2),e.stroke()}}const M=36*b,k=e.createRadialGradient(d,u,0,d,u,M);k.addColorStop(0,`rgba(${h},${m},${f},${(g*.3).toFixed(3)})`),k.addColorStop(1,`rgba(${h},${m},${f},0)`),e.globalAlpha=1,e.fillStyle=k,e.beginPath(),e.arc(d,u,M,0,Math.PI*2),e.fill();const R=Math.round(28*b);if(e.globalAlpha=g,e.font=`${R}px serif, sans-serif`,e.textAlign="center",e.textBaseline="middle",e.shadowColor=`rgba(${h},${m},${f},${g*.9})`,e.shadowBlur=14,e.fillStyle=`rgb(${h},${m},${f})`,e.fillText(l.sigil,d,u),e.shadowBlur=0,g>.3){const j=Math.min(1,g*1.4),I=Math.max(9,Math.round(10*b));e.font=`${I}px monospace`,e.textAlign="center",e.textBaseline="middle";const E=u+R*.75+10,O=e.measureText(l.name).width,L=3,$=7;e.globalAlpha=j*.55,e.fillStyle="rgba(4,2,12,0.80)",e.beginPath(),e.roundRect(d-O/2-$,E-I/2-L,O+$*2,I+L*2,4),e.fill(),e.globalAlpha=j*.35,e.strokeStyle=`rgb(${h},${m},${f})`,e.lineWidth=.8,e.stroke(),e.globalAlpha=j,e.fillStyle=`rgba(${h},${m},${f},${j})`,e.fillText(l.name,d,E)}e.globalAlpha=1,e.shadowBlur=0}e.restore()},Bp=new Map;function xL(e,t){for(let n=0;n<e.count;n++){Bp.has(n)||Bp.set(n,{positions:[]});const r=Bp.get(n);r.positions.push({x:e.x[n],y:e.y[n]}),r.positions.length>t&&r.positions.shift()}}function t8(){Bp.clear()}function vL(e,t,n,r,a,i){const s=n.maxDistance*n.maxDistance,c=e.canvas.getBoundingClientRect(),l=a??c.width,d=i??c.height;if(l<=0||d<=0)return;const u=l/2,h=d/2,m=l/2,f=d/2;e.save(),e.globalAlpha=n.opacity,e.lineWidth=n.thickness;for(let g=0;g<t.count;g++){const x=t.x[g],v=t.y[g],b=t.type[g];for(let w=g+1;w<t.count;w++){const M=t.x[w],k=t.y[w],R=M-x,j=k-v,I=R*R+j*j;if(I<s&&I>0&&Math.abs(R)<1&&Math.abs(j)<1){e.strokeStyle=Py(b,r);const E=x*u+m,O=-v*h+f,L=M*u+m,$=-k*h+f;e.beginPath(),e.moveTo(E,O),e.lineTo(L,$),e.stroke()}}}e.restore()}function SL(e,t,n,r){const a=e.canvas.getBoundingClientRect(),i=a.width,s=a.height,c=i/2,l=s/2,d=i/2,u=s/2;e.save(),e.lineWidth=2,e.lineCap="round",e.lineJoin="round";for(let h=0;h<t.count;h++){const m=Bp.get(h);if(!m||m.positions.length<2)continue;const f=t.type[h],g=Py(f,r);e.strokeStyle=g;for(let x=1;x<m.positions.length;x++){const v=m.positions[x-1],b=m.positions[x],w=b.x-v.x,M=b.y-v.y;if(Math.abs(w)>1||Math.abs(M)>1)continue;{const E=x/m.positions.length*n.opacity;e.globalAlpha=E}const k=v.x*c+d,R=-v.y*l+u,j=b.x*c+d,I=-b.y*l+u;e.beginPath(),e.moveTo(k,R),e.lineTo(j,I),e.stroke()}}e.restore()}const Rg={bond:"",rift:"",bloom:"",oath:""},Ag={bond:"rgba(100, 200, 255, ",rift:"rgba(255, 100, 120, ",bloom:"rgba(120, 255, 140, ",oath:"rgba(200, 180, 255, "};function wL(e,t,n,r,a){if(!n.enabled||!n.showOverlay)return;const i=t.width,s=t.height,c=4;e.save(),e.font="12px serif, sans-serif",e.textAlign="center",e.textBaseline="middle";for(let l=0;l<s;l+=c)for(let d=0;d<i;d+=c){const u=l*i+d,h=t.bond[u],m=t.rift[u],f=t.bloom[u],g=t.oath[u],x=Math.max(h,m,f,g);if(x<.33)continue;let v="",b="";h===x?(v=Rg.bond,b=Ag.bond):m===x?(v=Rg.rift,b=Ag.rift):f===x?(v=Rg.bloom,b=Ag.bloom):g===x&&(v=Rg.oath,b=Ag.oath);const w=i<=1?.5:d/(i-1),M=s<=1?.5:l/(s-1),k=10,R=k+w*Math.max(1,r-k*2),j=k+M*Math.max(1,a-k*2),I=Math.min(.26,Math.pow(x,1.6)*.32);e.fillStyle=b+I+")",e.fillText(v,R,j)}e.restore()}function zR(e,t,n,r){const a=t.w,i=t.h,s=n/a,c=r/i,l=.08;for(let d=0;d<i;d++)for(let u=0;u<a;u++){const h=d*a+u,m=t.A[h],f=t.S[h],g=m-f;if(Math.abs(g)<l)continue;const x=u*s,v=d*c;g>0?e.fillStyle=`rgba(100, 200, 255, ${Math.min(.3,g*.4)})`:e.fillStyle=`rgba(255, 100, 120, ${Math.min(.3,-g*.4)})`,e.fillRect(x,v,s,c)}}typeof window<"u"&&(window.renderRecursiveFieldHeatmap=zR);function ML(e,t){switch(e.type){case"speciation":return{title:" Nova Espcie Emergiu",description:`${e.message} - Uma nova forma de vida surgiu da sopa primordial! As interaes complexas levaram  diferenciao espontnea.`,mood:"discovery",significance:.8};case"institution":return{title:" Instituio Estabelecida",description:`${e.message} - Padres de comportamento coletivo cristalizaram-se em estruturas duradouras. Uma nova ordem social emerge.`,mood:"harmony",significance:.9};case"mutation":return{title:" Mutao Detectada",description:`${e.message} - As foras caticas causaram uma mudana fundamental nas regras do universo. Nada ser como antes.`,mood:"tension",significance:.7};default:return{title:e.message,description:"Algo interessante aconteceu no universo.",mood:"wonder",significance:.5}}}function CL(e,t,n){const r=Math.min(1,e.avgCohesion),a=Math.min(1,e.stableClusters/5),i=Math.abs(e.avgTension-.5)*2,s=e.avgNovelty,c=Math.max(0,Math.min(1,r*.4+a*.3-i*.2-s*.1)),l=Math.max(0,Math.min(1,e.avgScarcity*.4+Math.abs(e.avgTension-.5)*.3+(e.noveltyBurst?.3:0))),d=Math.min(1,e.avgNovelty*.5+(e.stableClusters>0?.3:0)+(e.borderStrength>.5?.2:0)),u=Math.min(1,Math.sqrt(n/120));return{score:c,entropy:l,complexity:d,resilience:u}}function kL(e,t,n){return t>=4?{title:" Exploso Reprodutiva",description:`Um organismo massivo se fragmentou em ${t} descendentes! A vida encontra um caminho atravs da diviso explosiva.`,mood:"chaos",significance:.9}:t===2?{title:" Diviso Celular",description:"Um organismo atingiu massa crtica e se dividiu em dois. A reproduo atravs da mitose  a base da vida multicelular.",mood:"wonder",significance:.7}:{title:" Fragmentao",description:`Um cluster instvel se fragmentou em ${t} partes. s vezes o caos  necessrio para criar ordem.`,mood:"tension",significance:.6}}function RL(e){return e.score>.8&&e.entropy<.3?" Equilbrio Perfeito - O universo encontrou harmonia":e.entropy>.7&&e.score<.3?" Caos Primordial - Foras destrutivas dominam":e.complexity>.7?" Complexidade Emergente - Padres intrincados se formam":e.resilience>.8?" Sistema Resiliente - Ordem resistente s perturbaes":" Fluxo Dinmico - Criao e destruio em equilbrio"}let AL=0;const jL=(e=200)=>({events:[],max:e});function EL(e,t){const n={id:`ev_${AL++}`,ts:Date.now(),...t};return e.events.unshift(n),e.events.length>e.max&&e.events.pop(),n}function yh(e){if(e<60)return`${e.toFixed(1)}s`;const t=Math.floor(e/60),n=Math.floor(e%60);return`${t}m ${n}s`}const TL=()=>{const[e]=S.useState(()=>jL(250)),[,t]=S.useState(0),n=S.useCallback(a=>{const i=EL(e,a);return t(s=>s+1),i},[e]),r=S.useCallback(()=>{e.events=[],t(a=>a+1)},[e]);return{log:e,push:n,clear:r,events:e.events}},n8={beat:{label:"Beat",color:"#60a5fa"},achievement:{label:"Achievement",color:"#fbbf24"},challenge:{label:"Challenge",color:"#a78bfa"},organism_capture:{label:"Capture",color:"#34d399"},mitosis:{label:"Mitosis",color:"#f472b6"},metamorphosis:{label:"Evolution",color:"#22d3ee"},pattern:{label:"Pattern",color:"#fb923c"},system:{label:"System",color:"#94a3b8"}},IL=({events:e,visible:t,onClose:n})=>{const[r,a]=S.useState("all"),[i,s]=S.useState(null);if(!t)return null;const c=r==="all"?e:e.filter(u=>u.type===r),l=()=>{const u=c.slice(0,50).map(h=>`[${yh(h.t)}] ${h.sigil||""} ${h.title}${h.detail?` - ${h.detail}`:""}`).join(`
`);navigator.clipboard.writeText(u)},d={lastSpeciation:e.find(u=>{var h;return u.type==="beat"&&((h=u.meta)==null?void 0:h.beatType)==="speciation"}),lastInstitution:e.find(u=>{var h;return u.type==="beat"&&((h=u.meta)==null?void 0:h.beatType)==="institution"}),lastAchievement:e.find(u=>u.type==="achievement"),lastCapture:e.find(u=>u.type==="organism_capture")};return o.jsxs("div",{className:"fixed top-20 right-4 w-[480px] max-h-[calc(100vh-120px)] bg-black/90 backdrop-blur-md border border-white/10 rounded-lg shadow-2xl flex flex-col z-50",children:[o.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-xl",children:""}),o.jsx("h2",{className:"text-white font-light text-sm tracking-wider uppercase",children:"World Log"}),o.jsxs("span",{className:"text-white/40 text-xs",children:["(",c.length,")"]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("button",{onClick:l,className:"p-1.5 hover:bg-white/10 rounded transition-colors",title:"Copy log to clipboard",children:o.jsx(Kk,{size:14,className:"text-white/60"})}),n&&o.jsx("button",{onClick:n,className:"p-1.5 hover:bg-white/10 rounded transition-colors",children:o.jsx(Cs,{size:14,className:"text-white/60"})})]})]}),o.jsxs("div",{className:"p-3 border-b border-white/10 flex flex-wrap gap-1.5",children:[o.jsxs("button",{onClick:()=>a("all"),className:`px-2 py-1 text-[10px] uppercase tracking-wider rounded transition-all ${r==="all"?"bg-white/20 text-white border border-white/30":"bg-white/5 text-white/50 border border-white/10 hover:bg-white/10"}`,children:["All (",e.length,")"]}),Object.entries(n8).map(([u,h])=>{const m=e.filter(f=>f.type===u).length;return m===0?null:o.jsxs("button",{onClick:()=>a(u),className:`px-2 py-1 text-[10px] uppercase tracking-wider rounded transition-all ${r===u?"text-white border":"bg-white/5 text-white/50 border border-white/10 hover:bg-white/10"}`,style:{backgroundColor:r===u?h.color+"20":void 0,borderColor:r===u?h.color+"40":void 0,color:r===u?h.color:void 0},children:[h.label," (",m,")"]},u)})]}),r==="all"&&o.jsxs("div",{className:"p-3 border-b border-white/10 space-y-2",children:[o.jsxs("div",{className:"flex items-center gap-2 text-white/40 text-[9px] uppercase tracking-wider mb-2",children:[o.jsx(Xk,{size:10}),o.jsx("span",{children:"Highlights"})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[d.lastSpeciation&&o.jsxs("div",{className:"p-2 bg-blue-500/10 border border-blue-500/20 rounded",children:[o.jsx("div",{className:"text-blue-400 text-[9px] uppercase tracking-wider mb-0.5",children:"Last Speciation"}),o.jsxs("div",{className:"text-white/80 text-[11px]",children:[d.lastSpeciation.sigil," ",d.lastSpeciation.title]}),o.jsx("div",{className:"text-white/40 text-[9px] mt-0.5",children:yh(d.lastSpeciation.t)})]}),d.lastAchievement&&o.jsxs("div",{className:"p-2 bg-yellow-500/10 border border-yellow-500/20 rounded",children:[o.jsx("div",{className:"text-yellow-400 text-[9px] uppercase tracking-wider mb-0.5",children:"Last Achievement"}),o.jsx("div",{className:"text-white/80 text-[11px]",children:d.lastAchievement.title}),o.jsx("div",{className:"text-white/40 text-[9px] mt-0.5",children:yh(d.lastAchievement.t)})]}),d.lastCapture&&o.jsxs("div",{className:"p-2 bg-green-500/10 border border-green-500/20 rounded",children:[o.jsx("div",{className:"text-green-400 text-[9px] uppercase tracking-wider mb-0.5",children:"Last Capture"}),o.jsxs("div",{className:"text-white/80 text-[11px]",children:[d.lastCapture.sigil," ",d.lastCapture.title]}),o.jsx("div",{className:"text-white/40 text-[9px] mt-0.5",children:yh(d.lastCapture.t)})]}),d.lastInstitution&&o.jsxs("div",{className:"p-2 bg-purple-500/10 border border-purple-500/20 rounded",children:[o.jsx("div",{className:"text-purple-400 text-[9px] uppercase tracking-wider mb-0.5",children:"Last Institution"}),o.jsxs("div",{className:"text-white/80 text-[11px]",children:[d.lastInstitution.sigil," ",d.lastInstitution.title]}),o.jsx("div",{className:"text-white/40 text-[9px] mt-0.5",children:yh(d.lastInstitution.t)})]})]})]}),o.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-1.5",children:[c.length===0&&o.jsx("div",{className:"text-white/40 text-xs text-center py-8",children:"No events yet. Keep simulating!"}),c.map(u=>{const h=n8[u.type],m=i===u.id;return o.jsxs("div",{className:"p-2 bg-white/5 hover:bg-white/10 border border-white/10 rounded transition-all cursor-pointer",onClick:()=>s(m?null:u.id),children:[o.jsxs("div",{className:"flex items-start gap-2",children:[o.jsx("span",{className:"text-lg leading-none",children:u.sigil||""}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("div",{className:"flex items-baseline gap-2",children:[o.jsx("span",{className:"text-white/80 text-[11px] font-medium",children:u.title}),o.jsx("span",{className:"text-[9px] px-1.5 py-0.5 rounded uppercase tracking-wider",style:{backgroundColor:h.color+"15",color:h.color},children:h.label})]}),u.detail&&o.jsx("div",{className:"text-white/50 text-[10px] mt-0.5",children:u.detail}),o.jsx("div",{className:"text-white/30 text-[9px] mt-1",children:yh(u.t)})]})]}),m&&u.meta&&o.jsxs("div",{className:"mt-2 pt-2 border-t border-white/10",children:[o.jsx("div",{className:"text-white/40 text-[9px] uppercase tracking-wider mb-1",children:"Metadata"}),o.jsx("pre",{className:"text-white/60 text-[9px] font-mono overflow-x-auto",children:JSON.stringify(u.meta,null,2)})]})]},u.id)})]})]})},PL=({isOpen:e,onClose:t,paragraphs:n,currentArc:r,tone:a,setTone:i})=>{const[s,c]=S.useState("");if(!e)return null;const l=s?n.filter(u=>u.tags.includes(s)):n,d=Array.from(new Set(n.flatMap(u=>u.tags)));return o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:o.jsxs("div",{className:"bg-black/90 border border-white/10 rounded-lg shadow-2xl w-full max-w-3xl max-h-[80vh] flex flex-col",children:[o.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(Lx,{size:20,className:"text-cyan-400"}),o.jsx("h2",{className:"text-lg font-mono text-white",children:"CHRONICLE"}),o.jsxs("span",{className:"text-xs text-cyan-400/60 font-mono",children:["Arc: ",r]})]}),o.jsx("button",{onClick:t,className:"p-1 hover:bg-white/5 rounded transition-colors",children:o.jsx(Cs,{size:18,className:"text-white/60"})})]}),o.jsxs("div",{className:"p-3 border-b border-white/5 flex items-center gap-2",children:[o.jsx("span",{className:"text-xs text-white/40 font-mono",children:"TONE:"}),["poetic","clinical","mythic","brutalist"].map(u=>o.jsx("button",{onClick:()=>i(u),className:`px-2 py-1 rounded text-xs font-mono transition-colors ${a===u?"bg-cyan-400/20 text-cyan-400":"text-white/40 hover:bg-white/5"}`,children:u},u))]}),o.jsxs("div",{className:"p-3 border-b border-white/5 flex items-center gap-2 flex-wrap",children:[o.jsx(Xk,{size:12,className:"text-white/40"}),o.jsx("button",{onClick:()=>c(""),className:`px-2 py-0.5 rounded text-xs transition-colors ${s?"text-white/40 hover:bg-white/5":"bg-white/10 text-white"}`,children:"all"}),d.slice(0,8).map(u=>o.jsx("button",{onClick:()=>c(u===s?"":u),className:`px-2 py-0.5 rounded text-xs transition-colors ${s===u?"bg-cyan-400/20 text-cyan-400":"text-white/40 hover:bg-white/5"}`,children:u},u))]}),o.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[l.length===0&&o.jsx("div",{className:"text-center text-white/30 text-sm py-8",children:"Nenhum pargrafo ainda. A histria est comeando..."}),l.map((u,h)=>o.jsxs("div",{className:"border-l-2 border-cyan-400/30 pl-3 py-2 hover:border-cyan-400/60 transition-colors",children:[o.jsxs("div",{className:"flex items-baseline justify-between mb-1",children:[o.jsx("h3",{className:"text-sm font-mono text-white/90",children:u.title}),o.jsxs("span",{className:"text-xs text-white/30 font-mono",children:[u.t.toFixed(1),"s"]})]}),o.jsx("p",{className:"text-sm text-white/70 leading-relaxed",children:u.text}),o.jsx("div",{className:"flex gap-1 mt-2",children:u.tags.map((m,f)=>o.jsx("span",{className:"text-[10px] text-cyan-400/50 font-mono px-1.5 py-0.5 bg-cyan-400/5 rounded",children:m},f))})]},h))]}),o.jsxs("div",{className:"p-3 border-t border-white/5 text-xs text-white/30 font-mono text-center",children:[n.length," paragraphs recorded"]})]})})};function FL(e="poetic"){return{tone:e,motifs:{nutrient:"seiva",tension:"presso",memory:"trilha",entropy:"nvoa"},currentArc:"Gnese",arcSince:0,lastParagraphAt:-999,paragraphCooldown:6}}function jg(e,t){const n=Math.floor(Math.abs(Math.sin(t)*9999)%e.length);return e[n]}function _L(e,t){const n=["seiva","po","ouro","nctar","caldo","luz"],r=["presso","ferrugem","raiva","atrito","carga","cisma"],a=["trilha","arquivo","cicatriz","rito","mapa","hbito"],i=["nvoa","rudo","fogo","sal","tempestade","fasca"];e.motifs={nutrient:jg(n,t*1.3),tension:jg(r,t*2.1),memory:jg(a,t*3.7),entropy:jg(i,t*4.9)}}function NL(e,t){const{t:n,loops:r,events:a}=e;if(n-t.lastParagraphAt<t.paragraphCooldown)return null;const i=a[0],s=i&&(i.type==="beat"||i.type==="mitosis"||i.type==="achievement"),c=r.volatility<.2,l=r.volatility>.6,d=r.scarcity>.65,u=r.cohesion>.6;if(!(s||l&&r.avgTension>.55||d&&r.avgNutrient<.35||u&&r.avgMemory>.55||c&&n-t.lastParagraphAt>t.paragraphCooldown*2))return null;t.lastParagraphAt=n;const m=t.motifs,f=s?i.sigil?`${i.sigil} ${i.title}`:i.title:l?"Tempestade de Interaes":d?"Era da Escassez":u?"Pacto de Coeso":"Respirao do Sistema",g=OL(t.tone,r,m,i),x=DL(t.tone,r,m);return{t:n,title:f,text:x?`${g} ${x}`:g,tags:[t.currentArc,l?"storm":c?"calm":"living",d?"scarcity":"",u?"cohesion":"",s?i.type:""].filter(Boolean)}}function OL(e,t,n,r){const a=t.scarcity,i=t.volatility,s=t.cohesion;if(e==="clinical")return`Regime: volatilidade ${i*100|0}%, escassez ${a*100|0}%, coeso ${s*100|0}%.`;if(e==="brutalist")return`A ${n.tension} sobe. A ${n.entropy} morde. O campo responde sem pedir licena.`;const c=[];return a>.65?c.push(`A ${n.nutrient} rareia, e o mundo aprende a economizar o gesto.`):c.push(`A ${n.nutrient} circula como promessa: atrai, separa, reagrupa.`),i>.6?c.push(`A ${n.entropy} cresce; formas quebram para nascer de novo.`):i<.2?c.push("Tudo parece calmo  mas calma  s outro tipo de fora."):c.push("H vida no meio: pequenas alianas, pequenas frices."),(r==null?void 0:r.type)==="beat"&&c.push(`Um sinal: ${r.title.toLowerCase()}.`),c.join(" ")}function DL(e,t,n){if(e==="clinical")return"";const r=t.cohesion,a=t.avgTension;return r>.6&&a<.4?`As ${n.memory}s se alinham  territrio vira linguagem.`:a>.6?`Onde a ${n.tension} encosta, surgem fronteiras: instituies improvisadas.`:`A ${n.memory} deixa marcas e a ${n.entropy} tenta apag-las.`}function LL(e,t,n){const{scarcity:r,cohesion:a,volatility:i}=t;return r>.7&&n.name!=="Era da Escassez"?{name:"Era da Escassez",since:e,reason:"Scarcity > 0.70"}:i>.65&&n.name!=="Guerra de Vrtices"?{name:"Guerra de Vrtices",since:e,reason:"Volatility > 0.65"}:a>.65&&i<.45&&n.name!=="Consolidao"?{name:"Consolidao",since:e,reason:"High cohesion + moderate volatility"}:i<.18&&n.name!=="Dormncia"?{name:"Dormncia",since:e,reason:"Volatility < 0.18"}:n.name!=="Vida Corrente"&&r<=.7&&i<=.65&&i>=.18?{name:"Vida Corrente",since:e,reason:"Back to baseline"}:null}const zL=[{id:"random",name:"Random Chaos",description:"Uniform random distribution, no structure",pattern:"random"},{id:"center_cluster",name:"Center Cluster",description:"Dense core formation, explosive potential",pattern:"center",params:{radius:.15,density:2}},{id:"ring",name:"Ring",description:"Circular boundary, inward pressure",pattern:"ring",params:{radius:.4,thickness:.1}},{id:"spiral",name:"Spiral",description:"Galaxy-like arms, rotational momentum",pattern:"spiral",params:{arms:3,twist:2.5}},{id:"grid",name:"Grid",description:"Orthogonal lattice, crystalline order",pattern:"grid",params:{spacing:.05}},{id:"two_clusters",name:"Two Clusters",description:"Binary collision, merger dynamics",pattern:"two_clusters",params:{separation:.5,radius:.15}},{id:"perimeter",name:"Perimeter",description:"Edge boundary, centripetal flow",pattern:"perimeter",params:{margin:.05}},{id:"vertical_bands",name:"Vertical Bands",description:"Striped layers, mixing zones",pattern:"vertical_bands",params:{bands:5,width:.15}},{id:"horizontal_bands",name:"Horizontal Bands",description:"Horizontal layers, stratification",pattern:"horizontal_bands",params:{bands:5,width:.15}},{id:"checkerboard",name:"Checkerboard",description:"Alternating cells, territorial conflict",pattern:"checkerboard",params:{cells:6}},{id:"triangle",name:"Triangle",description:"Triangular formation, apex dynamics",pattern:"triangle",params:{size:.6}},{id:"corners",name:"Four Corners",description:"Corner clusters, diagonal flows",pattern:"corners",params:{radius:.12}},{id:"cross",name:"Cross",description:"Plus sign, axial symmetry",pattern:"cross",params:{width:.15,length:.7}},{id:"double_helix",name:"Double Helix",description:"DNA-like twist, intertwined strands",pattern:"double_helix",params:{radius:.2,turns:3}},{id:"sunburst",name:"Sunburst",description:"Radial rays, explosive symmetry",pattern:"sunburst",params:{rays:8,length:.4}},{id:"concentric_rings",name:"Concentric Rings",description:"Nested circles, wave interference",pattern:"concentric_rings",params:{rings:4,spacing:.12}},{id:"wave",name:"Wave",description:"Sinusoidal distribution, periodic structure",pattern:"wave",params:{frequency:3,amplitude:.3}},{id:"vortex",name:"Vortex",description:"Logarithmic spiral, rotational seed",pattern:"vortex",params:{tightness:.15,rotation:1.5}},{id:"fractal_dust",name:"Fractal Dust",description:"Clustered random, self-similar distribution",pattern:"fractal_dust",params:{iterations:3,clusterSize:.08}},{id:"yin_yang",name:"Yin Yang",description:"Dual swirl, complementary balance",pattern:"yin_yang",params:{radius:.35}}],BL=(e,t,n,r,a)=>{var u,h,m,f,g,x,v,b,w,M,k,R,j,I,E,O,L,$,F,B,W,re,oe,te,J,pe,P,V,fe;const i=new Float32Array(t*2),s=new Uint8Array(t),c=r/2,l=a/2,d=Math.min(r,a);switch(e.pattern){case"random":for(let ye=0;ye<t;ye++)i[ye*2]=Math.random()*r,i[ye*2+1]=Math.random()*a,s[ye]=Math.floor(Math.random()*n);break;case"center":{const ye=(((u=e.params)==null?void 0:u.radius)||.15)*d;for(let Se=0;Se<t;Se++){const we=Math.random()*Math.PI*2,ke=Math.sqrt(Math.random())*ye;i[Se*2]=c+Math.cos(we)*ke,i[Se*2+1]=l+Math.sin(we)*ke,s[Se]=Math.floor(Math.random()*n)}}break;case"ring":{const ye=(((h=e.params)==null?void 0:h.radius)||.4)*d,Se=(((m=e.params)==null?void 0:m.thickness)||.1)*d;for(let we=0;we<t;we++){const ke=Math.random()*Math.PI*2,De=ye+(Math.random()-.5)*Se;i[we*2]=c+Math.cos(ke)*De,i[we*2+1]=l+Math.sin(ke)*De,s[we]=Math.floor(Math.random()*n)}}break;case"spiral":{const ye=((f=e.params)==null?void 0:f.arms)||3,Se=((g=e.params)==null?void 0:g.twist)||2.5;for(let we=0;we<t;we++){const ke=we/t,De=Math.floor(Math.random()*ye),ae=De/ye*Math.PI*2+ke*Math.PI*Se,Re=ke*d*.4;i[we*2]=c+Math.cos(ae)*Re+(Math.random()-.5)*20,i[we*2+1]=l+Math.sin(ae)*Re+(Math.random()-.5)*20,s[we]=De%n}}break;case"grid":{const ye=(((x=e.params)==null?void 0:x.spacing)||.05)*d,Se=Math.ceil(Math.sqrt(t)),we=Se*ye,ke=c-we/2,De=l-we/2;for(let _e=0;_e<t;_e++){const ae=_e%Se,Re=Math.floor(_e/Se);i[_e*2]=ke+ae*ye+(Math.random()-.5)*5,i[_e*2+1]=De+Re*ye+(Math.random()-.5)*5,s[_e]=(ae+Re)%n}}break;case"two_clusters":{const ye=(((v=e.params)==null?void 0:v.separation)||.5)*d,Se=(((b=e.params)==null?void 0:b.radius)||.15)*d,we=Math.floor(t/2);for(let ke=0;ke<t;ke++){const De=ke<we,_e=c+(De?-ye/2:ye/2),ae=Math.random()*Math.PI*2,Re=Math.sqrt(Math.random())*Se;i[ke*2]=_e+Math.cos(ae)*Re,i[ke*2+1]=l+Math.sin(ae)*Re,s[ke]=De?0:n>1?1:0}}break;case"perimeter":{const ye=(((w=e.params)==null?void 0:w.margin)||.05)*d;for(let Se=0;Se<t;Se++){const we=Math.floor(Math.random()*4);we===0?(i[Se*2]=Math.random()*r,i[Se*2+1]=ye):we===1?(i[Se*2]=r-ye,i[Se*2+1]=Math.random()*a):we===2?(i[Se*2]=Math.random()*r,i[Se*2+1]=a-ye):(i[Se*2]=ye,i[Se*2+1]=Math.random()*a),s[Se]=we%n}}break;case"vertical_bands":{const ye=((M=e.params)==null?void 0:M.bands)||5,Se=r/ye;for(let we=0;we<t;we++){const ke=Math.floor(Math.random()*ye);i[we*2]=ke*Se+Math.random()*Se,i[we*2+1]=Math.random()*a,s[we]=ke%n}}break;case"horizontal_bands":{const ye=((k=e.params)==null?void 0:k.bands)||5,Se=a/ye;for(let we=0;we<t;we++){const ke=Math.floor(Math.random()*ye);i[we*2]=Math.random()*r,i[we*2+1]=ke*Se+Math.random()*Se,s[we]=ke%n}}break;case"checkerboard":{const ye=((R=e.params)==null?void 0:R.cells)||6,Se=r/ye,we=a/ye;for(let ke=0;ke<t;ke++){const De=Math.floor(Math.random()*ye),_e=Math.floor(Math.random()*ye);i[ke*2]=De*Se+Math.random()*Se,i[ke*2+1]=_e*we+Math.random()*we,s[ke]=(De+_e)%2%n}}break;case"triangle":{const ye=(((j=e.params)==null?void 0:j.size)||.6)*d;for(let Se=0;Se<t;Se++){let we=Math.random(),ke=Math.random();we+ke>1&&(we=1-we,ke=1-ke);const De=c-ye/2+we*ye,_e=l-ye/2+ke*ye;i[Se*2]=De,i[Se*2+1]=_e,s[Se]=Math.floor((we+ke)/2*n)%n}}break;case"corners":{const ye=(((I=e.params)==null?void 0:I.radius)||.12)*d,Se=ye*2,we=[{x:Se,y:Se},{x:r-Se,y:Se},{x:Se,y:a-Se},{x:r-Se,y:a-Se}];for(let ke=0;ke<t;ke++){const De=we[Math.floor(Math.random()*4)],_e=Math.random()*Math.PI*2,ae=Math.sqrt(Math.random())*ye;i[ke*2]=De.x+Math.cos(_e)*ae,i[ke*2+1]=De.y+Math.sin(_e)*ae,s[ke]=Math.floor(Math.random()*n)}}break;case"cross":{const ye=(((E=e.params)==null?void 0:E.width)||.15)*d,Se=(((O=e.params)==null?void 0:O.length)||.7)*d;for(let we=0;we<t;we++){const ke=Math.random()<.5;ke?(i[we*2]=c+(Math.random()-.5)*ye,i[we*2+1]=l+(Math.random()-.5)*Se):(i[we*2]=c+(Math.random()-.5)*Se,i[we*2+1]=l+(Math.random()-.5)*ye),s[we]=ke?0:n>1?1:0}}break;case"double_helix":{const ye=(((L=e.params)==null?void 0:L.radius)||.2)*d,Se=(($=e.params)==null?void 0:$.turns)||3,we=d*.6;for(let ke=0;ke<t;ke++){const De=ke/t,_e=De*Math.PI*2*Se,ae=ke%2===0,Re=ae?0:Math.PI;i[ke*2]=c+Math.cos(_e+Re)*ye,i[ke*2+1]=l-we/2+De*we,s[ke]=ae?0:n>1?1:0}}break;case"sunburst":{const ye=((F=e.params)==null?void 0:F.rays)||8,Se=(((B=e.params)==null?void 0:B.length)||.4)*d;for(let we=0;we<t;we++){const ke=Math.floor(Math.random()*ye),De=ke/ye*Math.PI*2,_e=Math.random()*Se;i[we*2]=c+Math.cos(De)*_e+(Math.random()-.5)*10,i[we*2+1]=l+Math.sin(De)*_e+(Math.random()-.5)*10,s[we]=ke%n}}break;case"concentric_rings":{const ye=((W=e.params)==null?void 0:W.rings)||4,Se=(((re=e.params)==null?void 0:re.spacing)||.12)*d;for(let we=0;we<t;we++){const ke=Math.floor(Math.random()*ye),De=(ke+1)*Se,_e=Math.random()*Math.PI*2;i[we*2]=c+Math.cos(_e)*De,i[we*2+1]=l+Math.sin(_e)*De,s[we]=ke%n}}break;case"wave":{const ye=((oe=e.params)==null?void 0:oe.frequency)||3,Se=(((te=e.params)==null?void 0:te.amplitude)||.3)*d;for(let we=0;we<t;we++){const ke=Math.random()*r,De=ke/r*Math.PI*2*ye,_e=l+Math.sin(De)*Se+(Math.random()-.5)*20;i[we*2]=ke,i[we*2+1]=_e,s[we]=Math.floor(ke/r*n)%n}}break;case"vortex":{const ye=((J=e.params)==null?void 0:J.tightness)||.15,Se=((pe=e.params)==null?void 0:pe.rotation)||1.5;for(let we=0;we<t;we++){const ke=Math.sqrt(we/t),De=ke*Math.PI*2*Se*5,_e=ke*d*.45;i[we*2]=c+Math.cos(De)*_e*(1+ke*ye),i[we*2+1]=l+Math.sin(De)*_e*(1+ke*ye),s[we]=Math.floor(ke*n)%n}}break;case"fractal_dust":{const ye=((P=e.params)==null?void 0:P.iterations)||3,Se=(((V=e.params)==null?void 0:V.clusterSize)||.08)*d;for(let we=0;we<t;we++){let ke=Math.random()*r,De=Math.random()*a;for(let _e=0;_e<ye;_e++)ke+=(Math.random()-.5)*Se/(_e+1),De+=(Math.random()-.5)*Se/(_e+1);i[we*2]=Math.max(0,Math.min(r,ke)),i[we*2+1]=Math.max(0,Math.min(a,De)),s[we]=Math.floor(Math.random()*n)}}break;case"yin_yang":{const ye=(((fe=e.params)==null?void 0:fe.radius)||.35)*d;for(let Se=0;Se<t;Se++){const we=Math.random()<.5,ke=Math.random()*Math.PI*2,De=Math.sqrt(Math.random())*ye;if(we){const _e=Math.PI/2+ke/2;i[Se*2]=c-ye/2+Math.cos(_e)*De,i[Se*2+1]=l+Math.sin(_e)*De,s[Se]=0}else{const _e=-Math.PI/2+ke/2;i[Se*2]=c+ye/2+Math.cos(_e)*De,i[Se*2+1]=l+Math.sin(_e)*De,s[Se]=n>1?1:0}}}break;default:for(let ye=0;ye<t;ye++)i[ye*2]=Math.random()*r,i[ye*2+1]=Math.random()*a,s[ye]=Math.floor(Math.random()*n)}return{positions:i,types:s}},$L=(e,t,n,r,a)=>{const i={attract:Array(e).fill(0).map(()=>Array(e).fill(0)),radius:Array(e).fill(0).map(()=>Array(e).fill(0)),falloff:Array(e).fill(0).map(()=>Array(e).fill(1.2))},s=.22;switch(t){case"sparse":qL(i,e,n,r,s,a);break;case"block":HL(i,e,r,s,a);break;case"ring":WL(i,e,r,s,a);break;case"predator-prey":GL(i,e,r,s,a);break;case"symbiosis":VL(i,e,r,s,a);break;case"random":default:UL(i,e,r,s,a);break}return YL(i,e),KL(i,e,.65),i},qL=(e,t,n,r,a,i)=>{for(let s=0;s<t;s++)for(let c=0;c<t;c++)i.next()>n?(e.attract[s][c]=i.range(-1,1),e.radius[s][c]=a*i.range(1-r,1+r)):(e.attract[s][c]=i.range(-.15,.15),e.radius[s][c]=a*i.range(.8,1.2))},HL=(e,t,n,r,a)=>{const i=Math.max(2,Math.min(4,Math.floor(t/3))),s=Array(i).fill(0).map(()=>[]);for(let c=0;c<t;c++)s[c%i].push(c);for(let c=0;c<t;c++){const l=s.findIndex(d=>d.includes(c));for(let d=0;d<t;d++){const u=s.findIndex(h=>h.includes(d));l===u?(e.attract[c][d]=a.range(.4,.9),e.radius[c][d]=r*a.range(1,1+n*.5)):(e.attract[c][d]=a.range(-.8,-.3),e.radius[c][d]=r*a.range(.8,1))}}},WL=(e,t,n,r,a)=>{for(let i=0;i<t;i++)for(let s=0;s<t;s++){const c=(i+1)%t,l=(i-1+t)%t;s===c?(e.attract[i][s]=a.range(.5,1),e.radius[i][s]=r*a.range(1,1+n)):s===l?(e.attract[i][s]=a.range(-.9,-.4),e.radius[i][s]=r*a.range(.8,1)):(e.attract[i][s]=a.range(-.25,.25),e.radius[i][s]=r*a.range(.9,1.1))}},GL=(e,t,n,r,a)=>{for(let i=0;i<t;i++){const s=Math.floor(i/2),c=i%2===0;for(let l=0;l<t;l++){const d=Math.floor(l/2);s===d&&i!==l?c?(e.attract[i][l]=a.range(.5,.8),e.radius[i][l]=r*a.range(1,1+n)):(e.attract[i][l]=a.range(-.6,-.3),e.radius[i][l]=r*a.range(1+n*.5,1+n)):i===l?(e.attract[i][l]=a.range(-.3,.3),e.radius[i][l]=r):(e.attract[i][l]=a.range(-.2,.2),e.radius[i][l]=r*a.range(.9,1.1))}}},VL=(e,t,n,r,a)=>{const i=Math.max(2,Math.min(4,Math.floor(t/4))),s=Array(i).fill(0).map(()=>[]);for(let l=0;l<t;l++)s[l%i].push(l);const c=new Set;for(let l=0;l<i;l++){const d=a.int(1,Math.min(2,i-1));for(let u=0;u<d;u++){const h=(l+1+u)%i;c.add(`${l}-${h}`),c.add(`${h}-${l}`)}}for(let l=0;l<t;l++){const d=s.findIndex(u=>u.includes(l));for(let u=0;u<t;u++){const h=s.findIndex(m=>m.includes(u));d===h?(e.attract[l][u]=a.range(.4,.7),e.radius[l][u]=r*a.range(1,1+n*.4)):c.has(`${d}-${h}`)?(e.attract[l][u]=a.range(.2,.5),e.radius[l][u]=r*a.range(1,1+n*.6)):(e.attract[l][u]=a.range(-.3,.1),e.radius[l][u]=r*a.range(.9,1.1))}}},UL=(e,t,n,r,a)=>{for(let i=0;i<t;i++)for(let s=0;s<t;s++)e.attract[i][s]=a.range(-.9,.9),e.radius[i][s]=r*a.range(1-n,1+n)},YL=(e,t)=>{for(let n=0;n<t;n++)for(let r=0;r<t;r++)e.attract[n][r]=Math.max(-.9,Math.min(.9,e.attract[n][r])),e.radius[n][r]=Math.max(.08,Math.min(.42,e.radius[n][r]))},KL=(e,t,n)=>{let r=0,a=0;for(let s=0;s<t;s++)for(let c=0;c<t;c++)r+=Math.abs(e.attract[s][c]),a++;const i=r/a;if(i>.01){const s=n/i;for(let c=0;c<t;c++)for(let l=0;l<t;l++)e.attract[c][l]*=s,e.attract[c][l]=Math.max(-.9,Math.min(.9,e.attract[c][l]))}},av=e=>{const t=new mu(e),n=t.range(Math.log(60),Math.log(200)),r=Math.round(Math.exp(n)),a=t.next()<.7?t.int(3,6):t.int(2,8),i=a*r;let s=a,c=r;if(i>1200){const l=Math.sqrt(1200/i);s=Math.max(2,Math.round(a*l)),c=Math.floor(1200/s)}return{speciesCount:s,particlesPerSpecies:c,beta:t.range(.22,.4),coreRepel:t.range(.8,1.3),rmax:t.range(.16,.36),forceGain:t.range(1.2,2.8),drag:t.range(.9,1.7),speedClamp:t.range(.09,.16),matrixMode:["sparse","block","ring","predator-prey","symbiosis","random"][t.int(0,5)],matrixSparsity:t.range(.2,.8),radiusSpread:t.range(.05,.5),spawnPattern:["random","circle","rings","clusters","grid","center","islands","columns","web","spiral","double-ring"][t.int(0,10)],renderMode:t.next()<.3?"streaks":"dots",trailsFade:t.range(.9,.985),paletteId:t.int(0,5),energyEnabled:t.next()<.2,mitosisRate:t.range(0,.12)}},XL=(e,t)=>{const n=new mu(t);switch(e){case"pollock":return{speciesCount:n.int(4,6),particlesPerSpecies:n.int(100,160),beta:n.range(.24,.36),coreRepel:n.range(.9,1.2),rmax:n.range(.2,.32),forceGain:n.range(1.4,2.4),drag:n.range(.9,1.3),speedClamp:n.range(.09,.14),matrixMode:n.next()<.5?"sparse":"symbiosis",matrixSparsity:n.range(.4,.7),radiusSpread:n.range(.2,.45),spawnPattern:"spray",renderMode:"streaks",trailsFade:n.range(.975,.985),paletteId:n.int(0,5),energyEnabled:!1,mitosisRate:0};case"mitosis":return{speciesCount:n.int(3,5),particlesPerSpecies:n.int(120,200),beta:n.range(.26,.36),coreRepel:n.range(.95,1.25),rmax:n.range(.17,.28),forceGain:n.range(1,1.8),drag:n.range(1.1,1.7),speedClamp:n.range(.07,.12),matrixMode:"block",matrixSparsity:n.range(.3,.6),radiusSpread:n.range(.1,.3),spawnPattern:n.next()<.5?"rings":"islands",renderMode:"dots",trailsFade:n.range(.93,.97),paletteId:n.int(0,5),energyEnabled:!1,mitosisRate:n.range(.04,.12)};case"alliances":return{speciesCount:n.int(3,5),particlesPerSpecies:n.int(80,150),beta:n.range(.2,.35),coreRepel:n.range(.8,1.2),rmax:n.range(.16,.3),forceGain:n.range(1,2),drag:n.range(.8,1.5),speedClamp:n.range(.08,.14),matrixMode:"symbiosis",matrixSparsity:n.range(.3,.6),radiusSpread:n.range(.15,.4),spawnPattern:"islands",renderMode:"dots",trailsFade:n.range(.94,.98),paletteId:n.int(0,5),energyEnabled:!1,mitosisRate:0};case"planets":return{speciesCount:n.int(2,4),particlesPerSpecies:n.int(120,220),beta:n.range(.24,.38),coreRepel:n.range(1,1.4),rmax:n.range(.2,.35),forceGain:n.range(.8,1.4),drag:n.range(1.2,2),speedClamp:n.range(.06,.1),matrixMode:"ring",matrixSparsity:n.range(.2,.5),radiusSpread:n.range(.2,.45),spawnPattern:"rings",renderMode:"dots",trailsFade:n.range(.92,.96),paletteId:n.int(0,5),energyEnabled:!1,mitosisRate:0};case"field":return{speciesCount:n.int(5,8),particlesPerSpecies:n.int(60,120),beta:n.range(.18,.3),coreRepel:n.range(.7,1.1),rmax:n.range(.14,.26),forceGain:n.range(1.4,2.4),drag:n.range(.6,1),speedClamp:n.range(.1,.16),matrixMode:"sparse",matrixSparsity:n.range(.5,.8),radiusSpread:n.range(.3,.55),spawnPattern:"spray",renderMode:"dots",trailsFade:n.range(.96,.98),paletteId:n.int(0,5),energyEnabled:!1,mitosisRate:0};case"gems":return{speciesCount:n.int(3,5),particlesPerSpecies:n.int(80,150),beta:n.range(.28,.4),coreRepel:n.range(1.1,1.4),rmax:n.range(.12,.22),forceGain:n.range(.8,1.6),drag:n.range(1.4,2.2),speedClamp:n.range(.06,.1),matrixMode:"block",matrixSparsity:n.range(.2,.4),radiusSpread:n.range(.05,.2),spawnPattern:"center",renderMode:"dots",trailsFade:n.range(.9,.94),paletteId:n.int(0,5),energyEnabled:!1,mitosisRate:0};case"drift":return{speciesCount:n.int(4,6),particlesPerSpecies:n.int(60,140),beta:n.range(.2,.32),coreRepel:n.range(.7,1),rmax:n.range(.18,.3),forceGain:n.range(1.6,2.6),drag:n.range(.6,1.2),speedClamp:n.range(.12,.18),matrixMode:"sparse",matrixSparsity:n.range(.6,.85),radiusSpread:n.range(.35,.55),spawnPattern:"web",renderMode:n.next()<.4?"streaks":"dots",trailsFade:n.range(.97,.985),paletteId:n.int(0,5),energyEnabled:!1,mitosisRate:0};case"simplify":return{speciesCount:n.int(2,4),particlesPerSpecies:n.int(120,220),beta:n.range(.25,.35),coreRepel:n.range(.9,1.2),rmax:n.range(.18,.28),forceGain:n.range(1,1.8),drag:n.range(1,1.6),speedClamp:n.range(.08,.12),matrixMode:"block",matrixSparsity:n.range(.2,.4),radiusSpread:n.range(.1,.25),spawnPattern:"rings",renderMode:"dots",trailsFade:n.range(.92,.96),paletteId:n.int(0,5),energyEnabled:!1,mitosisRate:0};case"darwin":return{speciesCount:5,particlesPerSpecies:n.int(80,140),beta:n.range(.3,.4),coreRepel:n.range(1,1.3),rmax:n.range(.2,.28),forceGain:n.range(1.4,2),drag:n.range(1,1.4),speedClamp:n.range(.1,.14),matrixMode:"predator-prey",matrixSparsity:n.range(.3,.5),radiusSpread:n.range(.15,.3),spawnPattern:n.next()<.5?"clusters":"islands",renderMode:"dots",trailsFade:n.range(.94,.97),paletteId:n.int(0,5),energyEnabled:!0,mitosisRate:0,metamorphosisEnabled:!0,mutationRate:n.range(.0015,.0025),typeStability:n.range(.975,.985)};default:return av(t)}},JL=(e,t)=>{const n={...e};if(t.next()<.7&&(n.speciesCount=t.int(4,24)),t.next()<.6){const r=["sparse","block","ring","predator-prey","symbiosis","random"];n.matrixMode=r[t.int(0,r.length-1)]}if(t.next()<.5&&(n.radiusSpread=t.range(.2,.55)),t.next()<.5){const r=["spray","rings","islands","columns","center","web"];n.spawnPattern=r[t.int(0,r.length-1)]}return t.next()<.4&&(n.renderMode=t.next()<.5?"streaks":"dots"),t.next()<.4&&(n.paletteId=t.int(0,5)),n.forceGain*=t.range(.7,1.4),n.drag*=t.range(.8,1.3),n},Eg=e=>{const t=[];return t.push(`species=${e.speciesCount}`),t.push(`p/s=${e.particlesPerSpecies}`),t.push(`mode=${e.matrixMode}`),e.renderMode==="streaks"&&t.push("streaks=on"),e.mitosisRate>.01&&t.push(`mitosis=${e.mitosisRate.toFixed(2)}`),t.push(`palette=${e.paletteId}`),t.join(", ")},QL=(e=.06)=>({enabled:e>.01,rate:e,impulse:1.2,splitFraction:.2,mutationSize:.08}),ZL=(e,t,n=50)=>{const r=[];for(let a=0;a<t;a++){const i=[];for(let m=0;m<e.count;m++)e.type[m]===a&&i.push(m);if(i.length<n)continue;let s=0,c=0;for(const m of i)s+=e.x[m],c+=e.y[m];const l=s/i.length,d=c/i.length;let u=0;for(const m of i){let f=e.x[m]-l,g=e.y[m]-d;f>1&&(f-=2),f<-1&&(f+=2),g>1&&(g-=2),g<-1&&(g+=2),u+=Math.sqrt(f*f+g*g)}const h=u/i.length;h<.15&&r.push({typeId:a,indices:i,centerX:l,centerY:d,radius:h})}return r.sort((a,i)=>i.indices.length-a.indices.length),r},ez=(e,t,n,r)=>{if(!n.enabled)return{success:!1};if(r.next()>n.rate)return{success:!1};const a=ZL(e,t.attract.length,50);if(a.length===0)return{success:!1};const i=a[0],s=Math.floor(i.indices.length*n.splitFraction);if(s<10)return{success:!1};if(e.count+s>e.maxCount)return{success:!1};const c=[],l=[...i.indices].sort(()=>r.next()-.5);for(let m=0;m<s&&m<l.length;m++)c.push(l[m]);const d=r.next()*Math.PI*2,u=Math.cos(d)*n.impulse*.01,h=Math.sin(d)*n.impulse*.01;for(const m of c){const f=e.count;e.x[f]=e.x[m]+u*.5,e.y[f]=e.y[m]+h*.5,e.type[f]=e.type[m],e.vx[f]=u,e.vy[f]=h,e.vx[m]-=u*.3,e.vy[m]-=h*.3,e.energy&&(e.energy[f]=e.energy[m]*.5,e.energy[m]*=.5),e.count++}return tz(t,i.typeId,n.mutationSize,r),{success:!0,message:`Cluster #${i.typeId} divided (${s} new particles)`}},tz=(e,t,n,r)=>{const a=e.attract.length;if(!(t<0||t>=a)){for(let i=0;i<a;i++){const s=r.range(-n,n);e.attract[t][i]+=s,e.attract[t][i]=Math.max(-.9,Math.min(.9,e.attract[t][i]))}for(let i=0;i<a;i++){const s=r.range(-n*.5,n*.5);e.radius[t][i]*=1+s,e.radius[t][i]=Math.max(.08,Math.min(.42,e.radius[t][i]))}}},nz=()=>({organisms:[],nextId:1}),rz=(e,t,n,r,a,i,s,c,l)=>{const d=[];for(let M=0;M<t.count;M++){const k=t.x[M]-n,R=t.y[M]-r;k*k+R*R<=a*a&&d.push({type:t.type[M],x:k,y:R,vx:t.vx[M],vy:t.vy[M],energy:t.energy[M]})}if(d.length===0)return null;let u=1/0,h=-1/0,m=1/0,f=-1/0;for(const M of d)u=Math.min(u,M.x),h=Math.max(h,M.x),m=Math.min(m,M.y),f=Math.max(f,M.y);const g=h-u,x=f-m,v=(u+h)/2,b=(m+f)/2;for(const M of d)M.x-=v,M.y-=b;const w={id:`org_${e.nextId}`,name:`Organism ${e.nextId}`,timestamp:Date.now(),particles:d,width:g,height:x,captureContext:{typesCount:i,paletteIndex:s,seed:c},thumbnail:l};return e.organisms.push(w),e.nextId++,w},oz=(e,t,n,r,a=1)=>{let i=0;for(const s of e.particles){if(t.count>=t.maxCount)break;const c=t.count;t.x[c]=n+s.x*a,t.y[c]=r+s.y*a,t.vx[c]=s.vx,t.vy[c]=s.vy,t.type[c]=s.type,t.energy[c]=s.energy,t.count++,i++}return i},az=(e,t)=>{const n=e.organisms.findIndex(r=>r.id===t);return n===-1?!1:(e.organisms.splice(n,1),!0)},sz=(e,t,n)=>{const r=e.organisms.find(a=>a.id===t);return r?(r.name=n,!0):!1},F2={observer:{id:"observer",name:"Observador",icon:"",description:"Voc v os agentes"},field_whisperer:{id:"field_whisperer",name:"Sussurrador de Campos",icon:"",description:"Voc revelou o invisvel"},pattern_hunter:{id:"pattern_hunter",name:"Caador de Padres",icon:"",description:"Voc entende a emergncia"},butterfly_hand:{id:"butterfly_hand",name:"Mo Borboleta",icon:"",description:"Seu gesto mudou o destino"},worldsmith:{id:"worldsmith",name:"Forjador de Mundos",icon:"",description:"Voc comanda universos"}};class _2{constructor(t){this.listeners=new Set,this.steps=t,this.progress={currentStep:0,completedSteps:new Set,xp:0,badges:[],startTime:Date.now()}}getSteps(){return this.steps}getCurrentStep(){return this.steps[this.progress.currentStep]||null}getProgress(){return{...this.progress,completedSteps:new Set(this.progress.completedSteps)}}nextStep(){const t=this.getCurrentStep();if(t&&(this.progress.completedSteps.add(t.id),this.progress.xp+=10,t.rewardBadge&&!this.progress.badges.includes(t.rewardBadge)&&this.progress.badges.push(t.rewardBadge),t.onExit&&t.onExit()),this.progress.currentStep<this.steps.length-1){this.progress.currentStep++;const n=this.getCurrentStep();return n!=null&&n.onEnter&&n.onEnter(),this.notifyListeners(),!0}return this.notifyListeners(),!1}previousStep(){if(this.progress.currentStep>0){const t=this.getCurrentStep();t!=null&&t.onExit&&t.onExit(),this.progress.currentStep--;const n=this.getCurrentStep();return n!=null&&n.onEnter&&n.onEnter(),this.notifyListeners(),!0}return!1}skipToEnd(){this.progress.currentStep=this.steps.length,this.notifyListeners()}reset(){this.progress={currentStep:0,completedSteps:new Set,xp:0,badges:[],startTime:Date.now()},this.notifyListeners()}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}notifyListeners(){const t=this.getProgress();this.listeners.forEach(n=>n(t))}}const BR="metalife_guide_completed_v1",A5=()=>{localStorage.setItem(BR,"true")},iz=()=>{localStorage.removeItem(BR)},lz=(e,t)=>{const n=[];return n.push({id:"emergence-1-observe",title:t("guide_emergence_1_title"),copy:t("guide_emergence_1_copy"),targetSelector:e.selectors.canvas,actionType:"observe",rewardBadge:"observer",waitDuration:6e3}),n.push({id:"emergence-2-adjust",title:t("guide_emergence_2_title"),copy:t("guide_emergence_2_copy"),targetSelector:e.selectors.speedControl??null,actionType:"observe"}),n.push({id:"emergence-3-what-you-saw",title:t("guide_emergence_3_title"),copy:t("guide_emergence_3_copy"),targetSelector:null,actionType:"finish",rewardBadge:"pattern_hunter"}),n},cz=(e,t)=>{const n=[];return n.push({id:"cl-1-canvas",title:t("guide_cl_1_title"),copy:t("guide_cl_1_copy"),targetSelector:e.selectors.canvas,actionType:"observe",rewardBadge:"observer",waitDuration:4e3}),n.push({id:"cl-2-speed",title:t("guide_cl_2_title"),copy:t("guide_cl_2_copy"),targetSelector:e.selectors.speedControl??null,actionType:"observe"}),n.push({id:"cl-3-field",title:t("guide_cl_3_title"),copy:t("guide_cl_3_copy"),targetSelector:e.selectors.overlayField??null,actionType:"observe"}),n.push({id:"cl-4-presets",title:t("guide_cl_4_title"),copy:t("guide_cl_4_copy"),targetSelector:e.selectors.presetsPanel??'[data-guide="presets-panel"]',actionType:"observe"}),n.push({id:"cl-5-params",title:t("guide_cl_5_title"),copy:t("guide_cl_5_copy"),targetSelector:'[data-guide="guide-params"]',actionType:"observe"}),n.push({id:"cl-6-bonds",title:t("guide_cl_6_title"),copy:t("guide_cl_6_copy"),targetSelector:'[data-guide="guide-bonds"]',actionType:"observe"}),n.push({id:"cl-7-drag",title:t("guide_cl_7_title"),copy:t("guide_cl_7_copy"),targetSelector:e.selectors.canvas,actionType:"drag",rewardBadge:"butterfly_hand"}),n.push({id:"cl-8-finish",title:t("guide_cl_8_title"),copy:t("guide_cl_8_copy"),targetSelector:null,actionType:"finish",rewardBadge:"worldsmith"}),n},r8=e=>{const t=[];return t.push({id:"welcome",title:"O Campo",copy:"Voc est olhando para um campo. Agentes se movem por regras de atrao e repulso  observe antes de agir.",targetSelector:null,actionType:"observe",rewardBadge:"observer"}),t.push({id:"agents",title:"Espcies",copy:"Cada cor  uma espcie. Cada espcie reage de forma diferente s outras  simbiose, predao, indiferena.",targetSelector:e.selectors.canvas,actionType:"observe"}),t.push({id:"patterns",title:"Emergncia",copy:"Quando as foras se equilibram, formas surgem: anis, membranas, organismos. Quando conflitam, caos. Nada foi programado para acontecer.",targetSelector:e.selectors.canvas,actionType:"observe",rewardBadge:"pattern_hunter"}),e.selectors.speedControl&&t.push({id:"speed",title:"Tempo",copy:"Velocidade muda percepo. Lento revela negociaes locais. Rpido revela estrutura macro.",targetSelector:e.selectors.speedControl,actionType:"observe"}),e.selectors.overlayField&&t.push({id:"field",title:"O Invisvel",copy:"O campo  o ambiente por trs dos agentes  tenso, nutrio, memria. Ative overlays para ver por que os padres se formam onde se formam.",targetSelector:e.selectors.overlayField,actionType:"observe",rewardBadge:"field_whisperer"}),t.push({id:"gesture",title:"Interferncia",copy:"Clique e arraste no canvas para aplicar uma fora. Observe como o sistema responde e se reorganiza.",targetSelector:e.selectors.canvas,actionType:"drag",rewardBadge:"butterfly_hand"}),e.selectors.presetsPanel&&t.push({id:"presets",title:"Presets",copy:"Cada preset reconfigura a matriz de foras e gera um mundo com personalidade prpria.",targetSelector:e.selectors.presetsPanel,actionType:"observe"}),(e.selectors.newUniverseButton||e.selectors.seedButton)&&t.push({id:"seed",title:"DNA",copy:"Seed  o cdigo gentico do universo. Novo universo = novas relaes, novas possibilidades.",targetSelector:e.selectors.newUniverseButton||e.selectors.seedButton,actionType:"observe"}),t.push({id:"complete",title:"Explore",copy:"Agora observe, intervenha pouco, deixe o sistema encontrar suas prprias instituies. Tudo que surge, surge de baixo.",targetSelector:null,actionType:"finish",rewardBadge:"worldsmith"}),t},dz=(e,t)=>{const[n,r]=S.useState("hidden"),a=S.useRef(null);S.useEffect(()=>{},[]);const i=()=>{try{const d=t?t(e):r8(e);!Array.isArray(d)||d.length===0?a.current=new _2([{id:"noop",title:"Guide",copy:"",targetSelector:null,actionType:"finish"}]):a.current=new _2(d),r("active")}catch(d){console.error("[Guide] startGuide failed",d);try{a.current=new _2(r8(e)),r("active")}catch(u){console.error("[Guide] fallback createGuideJourney failed",u)}}},s=()=>{A5(),r("hidden")},c=()=>{iz(),a.current&&a.current.reset(),i()},l=()=>{r("hidden")};return{mode:n,guideState:a.current,startGuide:i,skipGuide:s,restartGuide:c,hideGuide:l}};function N2(e){const t=()=>new Float32Array(e*e);return{size:e,layers:{nutrient:t(),tension:t(),memory:t(),entropy:t(),sigilBond:t(),sigilRift:t(),sigilBloom:t(),sigilOath:t()},next:{nutrient:t(),tension:t(),memory:t(),entropy:t(),sigilBond:t(),sigilRift:t(),sigilBloom:t(),sigilOath:t()},scratch:t()}}function uz(e,t,n){return t*n+e}function $R(e,t,n){const r=Math.max(0,Math.min(.9999,(e+1)*.5)),a=Math.max(0,Math.min(.9999,(t+1)*.5)),i=Math.min(n-1,r*n|0),s=Math.min(n-1,a*n|0);return{gx:i,gy:s,gi:uz(i,s,n)}}function Ai(e,t,n,r){const{gi:a}=$R(n,r,e.size);return e.layers[t][a]}function Tg(e,t,n,r,a){const{gi:i}=$R(n,r,e.size);e.layers[t][i]+=a}function hz(e,t,n){const r=e.size,a=r*r,i=["nutrient","tension","memory","entropy","sigilBond","sigilRift","sigilBloom","sigilOath"];for(const s of i){const c=e.layers[s],l=e.next[s],d=t.diffusion[s],u=t.decay[s];for(let g=0;g<r;g++){const x=g===0?0:g-1,v=g===r-1?r-1:g+1;for(let b=0;b<r;b++){const w=b===0?0:b-1,M=b===r-1?r-1:b+1,k=g*r+b,R=c[k],j=c[x*r+b],I=c[v*r+b],E=c[g*r+w],O=c[g*r+M],L=j+I+E+O-4*R,F=(R+d*L)*Math.exp(-u*n);l[k]=F}}const h=t.delays[s];if(h>1e-4){const g=1-Math.exp(-n/h);for(let x=0;x<a;x++)c[x]=c[x]+(l[x]-c[x])*g}else c.set(l);const{min:m,max:f}=t.clamps[s];for(let g=0;g<a;g++){const x=c[g];c[g]=x<m?m:x>f?f:x}}}function o8(e){const t=e.size*e.size;let n=0,r=0,a=0,i=0;const s=e.layers.nutrient,c=e.layers.tension,l=e.layers.memory,d=e.layers.entropy;for(let f=0;f<t;f++)n+=s[f],r+=c[f],a+=l[f],i+=d[f];n/=t,r/=t,a/=t,i/=t;const u=O2(1-n),h=O2(a*.9-i*.7),m=O2(r*.8+i*.8);return{avgNutrient:n,avgTension:r,avgMemory:a,avgEntropy:i,scarcity:u,cohesion:h,volatility:m}}function O2(e){return e<0?0:e>1?1:e}const fz=e=>({selectors:{playButton:'[data-guide="play-button"]',speedControl:'[data-guide="speed-control"]',seedButton:'[data-guide="seed-button"]',presetsPanel:'[data-guide="presets-panel"]',overlayField:'[data-guide="overlay-field"]',overlayTrails:'[data-guide="overlay-trails"]',overlayInstitutions:null,canvas:"canvas",newUniverseButton:'[data-guide="new-universe"]'},actions:{setSpeed:t=>e.onSpeedChange?(e.onSpeedChange(t),!0):!1,pause:()=>{var t;return e.onPauseToggle&&!((t=e.isPaused)!=null&&t.call(e))?(e.onPauseToggle(),!0):!1},resume:()=>{var t;return e.onPauseToggle&&((t=e.isPaused)!=null&&t.call(e))?(e.onPauseToggle(),!0):!1},toggleOverlay:(t,n)=>t==="field"&&e.setFieldHeatmap?(e.setFieldHeatmap(n),!0):t==="trails"&&e.setTrails?(e.setTrails(n),!0):!1,applyPreset:t=>e.onApplyRecipe?(e.onApplyRecipe(t),!0):!1,newUniverse:()=>e.onNewUniverse?(e.onNewUniverse(),!0):!1,isOverlayEnabled:t=>t==="field"?e.fieldHeatmap??!1:t==="trails"?e.trails??!1:!1,getSpeed:()=>e.timeSpeed??1,isPaused:()=>{var t;return((t=e.isPaused)==null?void 0:t.call(e))??!1}},canvasInteractionDetector:{startListening:t=>{var d;const n=(d=e.canvasRef)==null?void 0:d.current;if(!n)return()=>{};let r=0,a=0,i=!1;const s=u=>{r=u.clientX,a=u.clientY,i=!0},c=u=>{if(!i)return;const h=u.clientX-r,m=u.clientY-a,f=Math.sqrt(h*h+m*m);t(f)},l=()=>{i=!1};return n.addEventListener("pointerdown",s),n.addEventListener("pointermove",c),n.addEventListener("pointerup",l),()=>{n.removeEventListener("pointerdown",s),n.removeEventListener("pointermove",c),n.removeEventListener("pointerup",l)}}}}),mS=S.createContext({});function gS(e){const t=S.useRef(null);return t.current===null&&(t.current=e()),t.current}const qR=typeof window<"u",HR=qR?S.useLayoutEffect:S.useEffect,qy=S.createContext(null);function yS(e,t){e.indexOf(t)===-1&&e.push(t)}function ny(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}const Nc=(e,t,n)=>n>t?t:n<e?e:n;let bS=()=>{};const gd={},WR=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e);function GR(e){return typeof e=="object"&&e!==null}const VR=e=>/^0[^.\s]+$/u.test(e);function UR(e){let t;return()=>(t===void 0&&(t=e()),t)}const Tl=e=>e,pz=(e,t)=>n=>t(e(n)),Sm=(...e)=>e.reduce(pz),sm=(e,t,n)=>{const r=t-e;return r===0?1:(n-e)/r};class xS{constructor(){this.subscriptions=[]}add(t){return yS(this.subscriptions,t),()=>ny(this.subscriptions,t)}notify(t,n,r){const a=this.subscriptions.length;if(a)if(a===1)this.subscriptions[0](t,n,r);else for(let i=0;i<a;i++){const s=this.subscriptions[i];s&&s(t,n,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const oc=e=>e*1e3,Rl=e=>e/1e3;function YR(e,t){return t?e*(1e3/t):0}const KR=(e,t,n)=>(((1-3*n+3*t)*e+(3*n-6*t))*e+3*t)*e,mz=1e-7,gz=12;function yz(e,t,n,r,a){let i,s,c=0;do s=t+(n-t)/2,i=KR(s,r,a)-e,i>0?n=s:t=s;while(Math.abs(i)>mz&&++c<gz);return s}function wm(e,t,n,r){if(e===t&&n===r)return Tl;const a=i=>yz(i,0,1,e,n);return i=>i===0||i===1?i:KR(a(i),t,r)}const XR=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,JR=e=>t=>1-e(1-t),QR=wm(.33,1.53,.69,.99),vS=JR(QR),ZR=XR(vS),eA=e=>(e*=2)<1?.5*vS(e):.5*(2-Math.pow(2,-10*(e-1))),SS=e=>1-Math.sin(Math.acos(e)),tA=JR(SS),nA=XR(SS),bz=wm(.42,0,1,1),xz=wm(0,0,.58,1),rA=wm(.42,0,.58,1),vz=e=>Array.isArray(e)&&typeof e[0]!="number",oA=e=>Array.isArray(e)&&typeof e[0]=="number",Sz={linear:Tl,easeIn:bz,easeInOut:rA,easeOut:xz,circIn:SS,circInOut:nA,circOut:tA,backIn:vS,backInOut:ZR,backOut:QR,anticipate:eA},wz=e=>typeof e=="string",a8=e=>{if(oA(e)){bS(e.length===4);const[t,n,r,a]=e;return wm(t,n,r,a)}else if(wz(e))return Sz[e];return e},Ig=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function Mz(e,t){let n=new Set,r=new Set,a=!1,i=!1;const s=new WeakSet;let c={delta:0,timestamp:0,isProcessing:!1};function l(u){s.has(u)&&(d.schedule(u),e()),u(c)}const d={schedule:(u,h=!1,m=!1)=>{const g=m&&a?n:r;return h&&s.add(u),g.has(u)||g.add(u),u},cancel:u=>{r.delete(u),s.delete(u)},process:u=>{if(c=u,a){i=!0;return}a=!0,[n,r]=[r,n],n.forEach(l),n.clear(),a=!1,i&&(i=!1,d.process(u))}};return d}const Cz=40;function aA(e,t){let n=!1,r=!0;const a={delta:0,timestamp:0,isProcessing:!1},i=()=>n=!0,s=Ig.reduce((M,k)=>(M[k]=Mz(i),M),{}),{setup:c,read:l,resolveKeyframes:d,preUpdate:u,update:h,preRender:m,render:f,postRender:g}=s,x=()=>{const M=gd.useManualTiming?a.timestamp:performance.now();n=!1,gd.useManualTiming||(a.delta=r?1e3/60:Math.max(Math.min(M-a.timestamp,Cz),1)),a.timestamp=M,a.isProcessing=!0,c.process(a),l.process(a),d.process(a),u.process(a),h.process(a),m.process(a),f.process(a),g.process(a),a.isProcessing=!1,n&&t&&(r=!1,e(x))},v=()=>{n=!0,r=!0,a.isProcessing||e(x)};return{schedule:Ig.reduce((M,k)=>{const R=s[k];return M[k]=(j,I=!1,E=!1)=>(n||v(),R.schedule(j,I,E)),M},{}),cancel:M=>{for(let k=0;k<Ig.length;k++)s[Ig[k]].cancel(M)},state:a,steps:s}}const{schedule:ra,cancel:A0,state:Ls,steps:D2}=aA(typeof requestAnimationFrame<"u"?requestAnimationFrame:Tl,!0);let j5;function kz(){j5=void 0}const hi={now:()=>(j5===void 0&&hi.set(Ls.isProcessing||gd.useManualTiming?Ls.timestamp:performance.now()),j5),set:e=>{j5=e,queueMicrotask(kz)}},sA=e=>t=>typeof t=="string"&&t.startsWith(e),iA=sA("--"),Rz=sA("var(--"),wS=e=>Rz(e)?Az.test(e.split("/*")[0].trim()):!1,Az=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu;function s8(e){return typeof e!="string"?!1:e.split("/*")[0].includes("var(--")}const Pf={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},im={...Pf,transform:e=>Nc(0,1,e)},Pg={...Pf,default:1},$p=e=>Math.round(e*1e5)/1e5,MS=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function jz(e){return e==null}const Ez=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,CS=(e,t)=>n=>!!(typeof n=="string"&&Ez.test(n)&&n.startsWith(e)||t&&!jz(n)&&Object.prototype.hasOwnProperty.call(n,t)),lA=(e,t,n)=>r=>{if(typeof r!="string")return r;const[a,i,s,c]=r.match(MS);return{[e]:parseFloat(a),[t]:parseFloat(i),[n]:parseFloat(s),alpha:c!==void 0?parseFloat(c):1}},Tz=e=>Nc(0,255,e),L2={...Pf,transform:e=>Math.round(Tz(e))},Cu={test:CS("rgb","red"),parse:lA("red","green","blue"),transform:({red:e,green:t,blue:n,alpha:r=1})=>"rgba("+L2.transform(e)+", "+L2.transform(t)+", "+L2.transform(n)+", "+$p(im.transform(r))+")"};function Iz(e){let t="",n="",r="",a="";return e.length>5?(t=e.substring(1,3),n=e.substring(3,5),r=e.substring(5,7),a=e.substring(7,9)):(t=e.substring(1,2),n=e.substring(2,3),r=e.substring(3,4),a=e.substring(4,5),t+=t,n+=n,r+=r,a+=a),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(r,16),alpha:a?parseInt(a,16)/255:1}}const sv={test:CS("#"),parse:Iz,transform:Cu.transform},Mm=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),a0=Mm("deg"),_c=Mm("%"),Jn=Mm("px"),Pz=Mm("vh"),Fz=Mm("vw"),i8={..._c,parse:e=>_c.parse(e)/100,transform:e=>_c.transform(e*100)},Xh={test:CS("hsl","hue"),parse:lA("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:n,alpha:r=1})=>"hsla("+Math.round(e)+", "+_c.transform($p(t))+", "+_c.transform($p(n))+", "+$p(im.transform(r))+")"},rs={test:e=>Cu.test(e)||sv.test(e)||Xh.test(e),parse:e=>Cu.test(e)?Cu.parse(e):Xh.test(e)?Xh.parse(e):sv.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?Cu.transform(e):Xh.transform(e),getAnimatableNone:e=>{const t=rs.parse(e);return t.alpha=0,rs.transform(t)}},_z=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function Nz(e){var t,n;return isNaN(e)&&typeof e=="string"&&(((t=e.match(MS))==null?void 0:t.length)||0)+(((n=e.match(_z))==null?void 0:n.length)||0)>0}const cA="number",dA="color",Oz="var",Dz="var(",l8="${}",Lz=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function lm(e){const t=e.toString(),n=[],r={color:[],number:[],var:[]},a=[];let i=0;const c=t.replace(Lz,l=>(rs.test(l)?(r.color.push(i),a.push(dA),n.push(rs.parse(l))):l.startsWith(Dz)?(r.var.push(i),a.push(Oz),n.push(l)):(r.number.push(i),a.push(cA),n.push(parseFloat(l))),++i,l8)).split(l8);return{values:n,split:c,indexes:r,types:a}}function uA(e){return lm(e).values}function hA(e){const{split:t,types:n}=lm(e),r=t.length;return a=>{let i="";for(let s=0;s<r;s++)if(i+=t[s],a[s]!==void 0){const c=n[s];c===cA?i+=$p(a[s]):c===dA?i+=rs.transform(a[s]):i+=a[s]}return i}}const zz=e=>typeof e=="number"?0:rs.test(e)?rs.getAnimatableNone(e):e;function Bz(e){const t=uA(e);return hA(e)(t.map(zz))}const ac={test:Nz,parse:uA,createTransformer:hA,getAnimatableNone:Bz};function z2(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function $z({hue:e,saturation:t,lightness:n,alpha:r}){e/=360,t/=100,n/=100;let a=0,i=0,s=0;if(!t)a=i=s=n;else{const c=n<.5?n*(1+t):n+t-n*t,l=2*n-c;a=z2(l,c,e+1/3),i=z2(l,c,e),s=z2(l,c,e-1/3)}return{red:Math.round(a*255),green:Math.round(i*255),blue:Math.round(s*255),alpha:r}}function ry(e,t){return n=>n>0?t:e}const Aa=(e,t,n)=>e+(t-e)*n,B2=(e,t,n)=>{const r=e*e,a=n*(t*t-r)+r;return a<0?0:Math.sqrt(a)},qz=[sv,Cu,Xh],Hz=e=>qz.find(t=>t.test(e));function c8(e){const t=Hz(e);if(!t)return!1;let n=t.parse(e);return t===Xh&&(n=$z(n)),n}const d8=(e,t)=>{const n=c8(e),r=c8(t);if(!n||!r)return ry(e,t);const a={...n};return i=>(a.red=B2(n.red,r.red,i),a.green=B2(n.green,r.green,i),a.blue=B2(n.blue,r.blue,i),a.alpha=Aa(n.alpha,r.alpha,i),Cu.transform(a))},iv=new Set(["none","hidden"]);function Wz(e,t){return iv.has(e)?n=>n<=0?e:t:n=>n>=1?t:e}function Gz(e,t){return n=>Aa(e,t,n)}function kS(e){return typeof e=="number"?Gz:typeof e=="string"?wS(e)?ry:rs.test(e)?d8:Yz:Array.isArray(e)?fA:typeof e=="object"?rs.test(e)?d8:Vz:ry}function fA(e,t){const n=[...e],r=n.length,a=e.map((i,s)=>kS(i)(i,t[s]));return i=>{for(let s=0;s<r;s++)n[s]=a[s](i);return n}}function Vz(e,t){const n={...e,...t},r={};for(const a in n)e[a]!==void 0&&t[a]!==void 0&&(r[a]=kS(e[a])(e[a],t[a]));return a=>{for(const i in r)n[i]=r[i](a);return n}}function Uz(e,t){const n=[],r={color:0,var:0,number:0};for(let a=0;a<t.values.length;a++){const i=t.types[a],s=e.indexes[i][r[i]],c=e.values[s]??0;n[a]=c,r[i]++}return n}const Yz=(e,t)=>{const n=ac.createTransformer(t),r=lm(e),a=lm(t);return r.indexes.var.length===a.indexes.var.length&&r.indexes.color.length===a.indexes.color.length&&r.indexes.number.length>=a.indexes.number.length?iv.has(e)&&!a.values.length||iv.has(t)&&!r.values.length?Wz(e,t):Sm(fA(Uz(r,a),a.values),n):ry(e,t)};function pA(e,t,n){return typeof e=="number"&&typeof t=="number"&&typeof n=="number"?Aa(e,t,n):kS(e)(e,t)}const Kz=e=>{const t=({timestamp:n})=>e(n);return{start:(n=!0)=>ra.update(t,n),stop:()=>A0(t),now:()=>Ls.isProcessing?Ls.timestamp:hi.now()}},mA=(e,t,n=10)=>{let r="";const a=Math.max(Math.round(t/n),2);for(let i=0;i<a;i++)r+=Math.round(e(i/(a-1))*1e4)/1e4+", ";return`linear(${r.substring(0,r.length-2)})`},oy=2e4;function RS(e){let t=0;const n=50;let r=e.next(t);for(;!r.done&&t<oy;)t+=n,r=e.next(t);return t>=oy?1/0:t}function Xz(e,t=100,n){const r=n({...e,keyframes:[0,t]}),a=Math.min(RS(r),oy);return{type:"keyframes",ease:i=>r.next(a*i).value/t,duration:Rl(a)}}const Jz=5;function gA(e,t,n){const r=Math.max(t-Jz,0);return YR(n-e(r),t-r)}const Da={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},$2=.001;function Qz({duration:e=Da.duration,bounce:t=Da.bounce,velocity:n=Da.velocity,mass:r=Da.mass}){let a,i,s=1-t;s=Nc(Da.minDamping,Da.maxDamping,s),e=Nc(Da.minDuration,Da.maxDuration,Rl(e)),s<1?(a=d=>{const u=d*s,h=u*e,m=u-n,f=lv(d,s),g=Math.exp(-h);return $2-m/f*g},i=d=>{const h=d*s*e,m=h*n+n,f=Math.pow(s,2)*Math.pow(d,2)*e,g=Math.exp(-h),x=lv(Math.pow(d,2),s);return(-a(d)+$2>0?-1:1)*((m-f)*g)/x}):(a=d=>{const u=Math.exp(-d*e),h=(d-n)*e+1;return-$2+u*h},i=d=>{const u=Math.exp(-d*e),h=(n-d)*(e*e);return u*h});const c=5/e,l=e7(a,i,c);if(e=oc(e),isNaN(l))return{stiffness:Da.stiffness,damping:Da.damping,duration:e};{const d=Math.pow(l,2)*r;return{stiffness:d,damping:s*2*Math.sqrt(r*d),duration:e}}}const Zz=12;function e7(e,t,n){let r=n;for(let a=1;a<Zz;a++)r=r-e(r)/t(r);return r}function lv(e,t){return e*Math.sqrt(1-t*t)}const t7=["duration","bounce"],n7=["stiffness","damping","mass"];function u8(e,t){return t.some(n=>e[n]!==void 0)}function r7(e){let t={velocity:Da.velocity,stiffness:Da.stiffness,damping:Da.damping,mass:Da.mass,isResolvedFromDuration:!1,...e};if(!u8(e,n7)&&u8(e,t7))if(t.velocity=0,e.visualDuration){const n=e.visualDuration,r=2*Math.PI/(n*1.2),a=r*r,i=2*Nc(.05,1,1-(e.bounce||0))*Math.sqrt(a);t={...t,mass:Da.mass,stiffness:a,damping:i}}else{const n=Qz({...e,velocity:0});t={...t,...n,mass:Da.mass},t.isResolvedFromDuration=!0}return t}function ay(e=Da.visualDuration,t=Da.bounce){const n=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:r,restDelta:a}=n;const i=n.keyframes[0],s=n.keyframes[n.keyframes.length-1],c={done:!1,value:i},{stiffness:l,damping:d,mass:u,duration:h,velocity:m,isResolvedFromDuration:f}=r7({...n,velocity:-Rl(n.velocity||0)}),g=m||0,x=d/(2*Math.sqrt(l*u)),v=s-i,b=Rl(Math.sqrt(l/u)),w=Math.abs(v)<5;r||(r=w?Da.restSpeed.granular:Da.restSpeed.default),a||(a=w?Da.restDelta.granular:Da.restDelta.default);let M;if(x<1){const R=lv(b,x);M=j=>{const I=Math.exp(-x*b*j);return s-I*((g+x*b*v)/R*Math.sin(R*j)+v*Math.cos(R*j))}}else if(x===1)M=R=>s-Math.exp(-b*R)*(v+(g+b*v)*R);else{const R=b*Math.sqrt(x*x-1);M=j=>{const I=Math.exp(-x*b*j),E=Math.min(R*j,300);return s-I*((g+x*b*v)*Math.sinh(E)+R*v*Math.cosh(E))/R}}const k={calculatedDuration:f&&h||null,next:R=>{const j=M(R);if(f)c.done=R>=h;else{let I=R===0?g:0;x<1&&(I=R===0?oc(g):gA(M,R,j));const E=Math.abs(I)<=r,O=Math.abs(s-j)<=a;c.done=E&&O}return c.value=c.done?s:j,c},toString:()=>{const R=Math.min(RS(k),oy),j=mA(I=>k.next(R*I).value,R,30);return R+"ms "+j},toTransition:()=>{}};return k}ay.applyToOptions=e=>{const t=Xz(e,100,ay);return e.ease=t.ease,e.duration=oc(t.duration),e.type="keyframes",e};function cv({keyframes:e,velocity:t=0,power:n=.8,timeConstant:r=325,bounceDamping:a=10,bounceStiffness:i=500,modifyTarget:s,min:c,max:l,restDelta:d=.5,restSpeed:u}){const h=e[0],m={done:!1,value:h},f=E=>c!==void 0&&E<c||l!==void 0&&E>l,g=E=>c===void 0?l:l===void 0||Math.abs(c-E)<Math.abs(l-E)?c:l;let x=n*t;const v=h+x,b=s===void 0?v:s(v);b!==v&&(x=b-h);const w=E=>-x*Math.exp(-E/r),M=E=>b+w(E),k=E=>{const O=w(E),L=M(E);m.done=Math.abs(O)<=d,m.value=m.done?b:L};let R,j;const I=E=>{f(m.value)&&(R=E,j=ay({keyframes:[m.value,g(m.value)],velocity:gA(M,E,m.value),damping:a,stiffness:i,restDelta:d,restSpeed:u}))};return I(0),{calculatedDuration:null,next:E=>{let O=!1;return!j&&R===void 0&&(O=!0,k(E),I(E)),R!==void 0&&E>=R?j.next(E-R):(!O&&k(E),m)}}}function o7(e,t,n){const r=[],a=n||gd.mix||pA,i=e.length-1;for(let s=0;s<i;s++){let c=a(e[s],e[s+1]);if(t){const l=Array.isArray(t)?t[s]||Tl:t;c=Sm(l,c)}r.push(c)}return r}function a7(e,t,{clamp:n=!0,ease:r,mixer:a}={}){const i=e.length;if(bS(i===t.length),i===1)return()=>t[0];if(i===2&&t[0]===t[1])return()=>t[1];const s=e[0]===e[1];e[0]>e[i-1]&&(e=[...e].reverse(),t=[...t].reverse());const c=o7(t,r,a),l=c.length,d=u=>{if(s&&u<e[0])return t[0];let h=0;if(l>1)for(;h<e.length-2&&!(u<e[h+1]);h++);const m=sm(e[h],e[h+1],u);return c[h](m)};return n?u=>d(Nc(e[0],e[i-1],u)):d}function s7(e,t){const n=e[e.length-1];for(let r=1;r<=t;r++){const a=sm(0,t,r);e.push(Aa(n,1,a))}}function i7(e){const t=[0];return s7(t,e.length-1),t}function l7(e,t){return e.map(n=>n*t)}function c7(e,t){return e.map(()=>t||rA).splice(0,e.length-1)}function qp({duration:e=300,keyframes:t,times:n,ease:r="easeInOut"}){const a=vz(r)?r.map(a8):a8(r),i={done:!1,value:t[0]},s=l7(n&&n.length===t.length?n:i7(t),e),c=a7(s,t,{ease:Array.isArray(a)?a:c7(t,a)});return{calculatedDuration:e,next:l=>(i.value=c(l),i.done=l>=e,i)}}const d7=e=>e!==null;function AS(e,{repeat:t,repeatType:n="loop"},r,a=1){const i=e.filter(d7),c=a<0||t&&n!=="loop"&&t%2===1?0:i.length-1;return!c||r===void 0?i[c]:r}const u7={decay:cv,inertia:cv,tween:qp,keyframes:qp,spring:ay};function yA(e){typeof e.type=="string"&&(e.type=u7[e.type])}class jS{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(t=>{this.resolve=t})}notifyFinished(){this.resolve()}then(t,n){return this.finished.then(t,n)}}const h7=e=>e/100;class ES extends jS{constructor(t){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var r,a;const{motionValue:n}=this.options;n&&n.updatedAt!==hi.now()&&this.tick(hi.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(a=(r=this.options).onStop)==null||a.call(r))},this.options=t,this.initAnimation(),this.play(),t.autoplay===!1&&this.pause()}initAnimation(){const{options:t}=this;yA(t);const{type:n=qp,repeat:r=0,repeatDelay:a=0,repeatType:i,velocity:s=0}=t;let{keyframes:c}=t;const l=n||qp;l!==qp&&typeof c[0]!="number"&&(this.mixKeyframes=Sm(h7,pA(c[0],c[1])),c=[0,100]);const d=l({...t,keyframes:c});i==="mirror"&&(this.mirroredGenerator=l({...t,keyframes:[...c].reverse(),velocity:-s})),d.calculatedDuration===null&&(d.calculatedDuration=RS(d));const{calculatedDuration:u}=d;this.calculatedDuration=u,this.resolvedDuration=u+a,this.totalDuration=this.resolvedDuration*(r+1)-a,this.generator=d}updateTime(t){const n=Math.round(t-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=n}tick(t,n=!1){const{generator:r,totalDuration:a,mixKeyframes:i,mirroredGenerator:s,resolvedDuration:c,calculatedDuration:l}=this;if(this.startTime===null)return r.next(0);const{delay:d=0,keyframes:u,repeat:h,repeatType:m,repeatDelay:f,type:g,onUpdate:x,finalKeyframe:v}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-a/this.speed,this.startTime)),n?this.currentTime=t:this.updateTime(t);const b=this.currentTime-d*(this.playbackSpeed>=0?1:-1),w=this.playbackSpeed>=0?b<0:b>a;this.currentTime=Math.max(b,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=a);let M=this.currentTime,k=r;if(h){const E=Math.min(this.currentTime,a)/c;let O=Math.floor(E),L=E%1;!L&&E>=1&&(L=1),L===1&&O--,O=Math.min(O,h+1),!!(O%2)&&(m==="reverse"?(L=1-L,f&&(L-=f/c)):m==="mirror"&&(k=s)),M=Nc(0,1,L)*c}const R=w?{done:!1,value:u[0]}:k.next(M);i&&(R.value=i(R.value));let{done:j}=R;!w&&l!==null&&(j=this.playbackSpeed>=0?this.currentTime>=a:this.currentTime<=0);const I=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&j);return I&&g!==cv&&(R.value=AS(u,this.options,v,this.speed)),x&&x(R.value),I&&this.finish(),R}then(t,n){return this.finished.then(t,n)}get duration(){return Rl(this.calculatedDuration)}get iterationDuration(){const{delay:t=0}=this.options||{};return this.duration+Rl(t)}get time(){return Rl(this.currentTime)}set time(t){var n;t=oc(t),this.currentTime=t,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.playbackSpeed),(n=this.driver)==null||n.start(!1)}get speed(){return this.playbackSpeed}set speed(t){this.updateTime(hi.now());const n=this.playbackSpeed!==t;this.playbackSpeed=t,n&&(this.time=Rl(this.currentTime))}play(){var a,i;if(this.isStopped)return;const{driver:t=Kz,startTime:n}=this.options;this.driver||(this.driver=t(s=>this.tick(s))),(i=(a=this.options).onPlay)==null||i.call(a);const r=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=r):this.holdTime!==null?this.startTime=r-this.holdTime:this.startTime||(this.startTime=n??r),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(hi.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var t,n;this.notifyFinished(),this.teardown(),this.state="finished",(n=(t=this.options).onComplete)==null||n.call(t)}cancel(){var t,n;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(n=(t=this.options).onCancel)==null||n.call(t)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}attachTimeline(t){var n;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(n=this.driver)==null||n.stop(),t.observe(this)}}function f7(e){for(let t=1;t<e.length;t++)e[t]??(e[t]=e[t-1])}const ku=e=>e*180/Math.PI,dv=e=>{const t=ku(Math.atan2(e[1],e[0]));return uv(t)},p7={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:dv,rotateZ:dv,skewX:e=>ku(Math.atan(e[1])),skewY:e=>ku(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},uv=e=>(e=e%360,e<0&&(e+=360),e),h8=dv,f8=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),p8=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),m7={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:f8,scaleY:p8,scale:e=>(f8(e)+p8(e))/2,rotateX:e=>uv(ku(Math.atan2(e[6],e[5]))),rotateY:e=>uv(ku(Math.atan2(-e[2],e[0]))),rotateZ:h8,rotate:h8,skewX:e=>ku(Math.atan(e[4])),skewY:e=>ku(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function hv(e){return e.includes("scale")?1:0}function fv(e,t){if(!e||e==="none")return hv(t);const n=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let r,a;if(n)r=m7,a=n;else{const c=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);r=p7,a=c}if(!a)return hv(t);const i=r[t],s=a[1].split(",").map(y7);return typeof i=="function"?i(s):s[i]}const g7=(e,t)=>{const{transform:n="none"}=getComputedStyle(e);return fv(n,t)};function y7(e){return parseFloat(e.trim())}const Ff=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],_f=new Set(Ff),m8=e=>e===Pf||e===Jn,b7=new Set(["x","y","z"]),x7=Ff.filter(e=>!b7.has(e));function v7(e){const t=[];return x7.forEach(n=>{const r=e.getValue(n);r!==void 0&&(t.push([n,r.get()]),r.set(n.startsWith("scale")?1:0))}),t}const b0={width:({x:e},{paddingLeft:t="0",paddingRight:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),height:({y:e},{paddingTop:t="0",paddingBottom:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:(e,{transform:t})=>fv(t,"x"),y:(e,{transform:t})=>fv(t,"y")};b0.translateX=b0.x;b0.translateY=b0.y;const Iu=new Set;let pv=!1,mv=!1,gv=!1;function bA(){if(mv){const e=Array.from(Iu).filter(r=>r.needsMeasurement),t=new Set(e.map(r=>r.element)),n=new Map;t.forEach(r=>{const a=v7(r);a.length&&(n.set(r,a),r.render())}),e.forEach(r=>r.measureInitialState()),t.forEach(r=>{r.render();const a=n.get(r);a&&a.forEach(([i,s])=>{var c;(c=r.getValue(i))==null||c.set(s)})}),e.forEach(r=>r.measureEndState()),e.forEach(r=>{r.suspendedScrollY!==void 0&&window.scrollTo(0,r.suspendedScrollY)})}mv=!1,pv=!1,Iu.forEach(e=>e.complete(gv)),Iu.clear()}function xA(){Iu.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(mv=!0)})}function S7(){gv=!0,xA(),bA(),gv=!1}class TS{constructor(t,n,r,a,i,s=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...t],this.onComplete=n,this.name=r,this.motionValue=a,this.element=i,this.isAsync=s}scheduleResolve(){this.state="scheduled",this.isAsync?(Iu.add(this),pv||(pv=!0,ra.read(xA),ra.resolveKeyframes(bA))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:n,element:r,motionValue:a}=this;if(t[0]===null){const i=a==null?void 0:a.get(),s=t[t.length-1];if(i!==void 0)t[0]=i;else if(r&&n){const c=r.readValue(n,s);c!=null&&(t[0]=c)}t[0]===void 0&&(t[0]=s),a&&i===void 0&&a.set(t[0])}f7(t)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(t=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,t),Iu.delete(this)}cancel(){this.state==="scheduled"&&(Iu.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const w7=e=>e.startsWith("--");function M7(e,t,n){w7(t)?e.style.setProperty(t,n):e.style[t]=n}const C7={};function vA(e,t){const n=UR(e);return()=>C7[t]??n()}const k7=vA(()=>window.ScrollTimeline!==void 0,"scrollTimeline"),SA=vA(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Tp=([e,t,n,r])=>`cubic-bezier(${e}, ${t}, ${n}, ${r})`,g8={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Tp([0,.65,.55,1]),circOut:Tp([.55,0,1,.45]),backIn:Tp([.31,.01,.66,-.59]),backOut:Tp([.33,1.53,.69,.99])};function wA(e,t){if(e)return typeof e=="function"?SA()?mA(e,t):"ease-out":oA(e)?Tp(e):Array.isArray(e)?e.map(n=>wA(n,t)||g8.easeOut):g8[e]}function R7(e,t,n,{delay:r=0,duration:a=300,repeat:i=0,repeatType:s="loop",ease:c="easeOut",times:l}={},d=void 0){const u={[t]:n};l&&(u.offset=l);const h=wA(c,a);Array.isArray(h)&&(u.easing=h);const m={delay:r,duration:a,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:i+1,direction:s==="reverse"?"alternate":"normal"};return d&&(m.pseudoElement=d),e.animate(u,m)}function MA(e){return typeof e=="function"&&"applyToOptions"in e}function A7({type:e,...t}){return MA(e)&&SA()?e.applyToOptions(t):(t.duration??(t.duration=300),t.ease??(t.ease="easeOut"),t)}class CA extends jS{constructor(t){if(super(),this.finishedTime=null,this.isStopped=!1,this.manualStartTime=null,!t)return;const{element:n,name:r,keyframes:a,pseudoElement:i,allowFlatten:s=!1,finalKeyframe:c,onComplete:l}=t;this.isPseudoElement=!!i,this.allowFlatten=s,this.options=t,bS(typeof t.type!="string");const d=A7(t);this.animation=R7(n,r,a,d,i),d.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!i){const u=AS(a,this.options,c,this.speed);this.updateMotionValue?this.updateMotionValue(u):M7(n,r,u),this.animation.cancel()}l==null||l(),this.notifyFinished()}}play(){this.isStopped||(this.manualStartTime=null,this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var t,n;(n=(t=this.animation).finish)==null||n.call(t)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:t}=this;t==="idle"||t==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var n,r,a;const t=(n=this.options)==null?void 0:n.element;!this.isPseudoElement&&(t!=null&&t.isConnected)&&((a=(r=this.animation).commitStyles)==null||a.call(r))}get duration(){var n,r;const t=((r=(n=this.animation.effect)==null?void 0:n.getComputedTiming)==null?void 0:r.call(n).duration)||0;return Rl(Number(t))}get iterationDuration(){const{delay:t=0}=this.options||{};return this.duration+Rl(t)}get time(){return Rl(Number(this.animation.currentTime)||0)}set time(t){this.manualStartTime=null,this.finishedTime=null,this.animation.currentTime=oc(t)}get speed(){return this.animation.playbackRate}set speed(t){t<0&&(this.finishedTime=null),this.animation.playbackRate=t}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return this.manualStartTime??Number(this.animation.startTime)}set startTime(t){this.manualStartTime=this.animation.startTime=t}attachTimeline({timeline:t,observe:n}){var r;return this.allowFlatten&&((r=this.animation.effect)==null||r.updateTiming({easing:"linear"})),this.animation.onfinish=null,t&&k7()?(this.animation.timeline=t,Tl):n(this)}}const kA={anticipate:eA,backInOut:ZR,circInOut:nA};function j7(e){return e in kA}function E7(e){typeof e.ease=="string"&&j7(e.ease)&&(e.ease=kA[e.ease])}const q2=10;class T7 extends CA{constructor(t){E7(t),yA(t),super(t),t.startTime!==void 0&&(this.startTime=t.startTime),this.options=t}updateMotionValue(t){const{motionValue:n,onUpdate:r,onComplete:a,element:i,...s}=this.options;if(!n)return;if(t!==void 0){n.set(t);return}const c=new ES({...s,autoplay:!1}),l=Math.max(q2,hi.now()-this.startTime),d=Nc(0,q2,l-q2);n.setWithVelocity(c.sample(Math.max(0,l-d)).value,c.sample(l).value,d),c.stop()}}const y8=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(ac.test(e)||e==="0")&&!e.startsWith("url("));function I7(e){const t=e[0];if(e.length===1)return!0;for(let n=0;n<e.length;n++)if(e[n]!==t)return!0}function P7(e,t,n,r){const a=e[0];if(a===null)return!1;if(t==="display"||t==="visibility")return!0;const i=e[e.length-1],s=y8(a,t),c=y8(i,t);return!s||!c?!1:I7(e)||(n==="spring"||MA(n))&&r}function yv(e){e.duration=0,e.type="keyframes"}const F7=new Set(["opacity","clipPath","filter","transform"]),_7=UR(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function N7(e){var u;const{motionValue:t,name:n,repeatDelay:r,repeatType:a,damping:i,type:s}=e;if(!(((u=t==null?void 0:t.owner)==null?void 0:u.current)instanceof HTMLElement))return!1;const{onUpdate:l,transformTemplate:d}=t.owner.getProps();return _7()&&n&&F7.has(n)&&(n!=="transform"||!d)&&!l&&!r&&a!=="mirror"&&i!==0&&s!=="inertia"}const O7=40;class D7 extends jS{constructor({autoplay:t=!0,delay:n=0,type:r="keyframes",repeat:a=0,repeatDelay:i=0,repeatType:s="loop",keyframes:c,name:l,motionValue:d,element:u,...h}){var g;super(),this.stop=()=>{var x,v;this._animation&&(this._animation.stop(),(x=this.stopTimeline)==null||x.call(this)),(v=this.keyframeResolver)==null||v.cancel()},this.createdAt=hi.now();const m={autoplay:t,delay:n,type:r,repeat:a,repeatDelay:i,repeatType:s,name:l,motionValue:d,element:u,...h},f=(u==null?void 0:u.KeyframeResolver)||TS;this.keyframeResolver=new f(c,(x,v,b)=>this.onKeyframesResolved(x,v,m,!b),l,d,u),(g=this.keyframeResolver)==null||g.scheduleResolve()}onKeyframesResolved(t,n,r,a){var v,b;this.keyframeResolver=void 0;const{name:i,type:s,velocity:c,delay:l,isHandoff:d,onUpdate:u}=r;this.resolvedAt=hi.now(),P7(t,i,s,c)||((gd.instantAnimations||!l)&&(u==null||u(AS(t,r,n))),t[0]=t[t.length-1],yv(r),r.repeat=0);const m={startTime:a?this.resolvedAt?this.resolvedAt-this.createdAt>O7?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:n,...r,keyframes:t},f=!d&&N7(m),g=(b=(v=m.motionValue)==null?void 0:v.owner)==null?void 0:b.current,x=f?new T7({...m,element:g}):new ES(m);x.finished.then(()=>{this.notifyFinished()}).catch(Tl),this.pendingTimeline&&(this.stopTimeline=x.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=x}get finished(){return this._animation?this.animation.finished:this._finished}then(t,n){return this.finished.finally(t).then(()=>{})}get animation(){var t;return this._animation||((t=this.keyframeResolver)==null||t.resume(),S7()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(t){this.animation.time=t}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(t){this.animation.speed=t}get startTime(){return this.animation.startTime}attachTimeline(t){return this._animation?this.stopTimeline=this.animation.attachTimeline(t):this.pendingTimeline=t,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var t;this._animation&&this.animation.cancel(),(t=this.keyframeResolver)==null||t.cancel()}}function RA(e,t,n,r=0,a=1){const i=Array.from(e).sort((d,u)=>d.sortNodePosition(u)).indexOf(t),s=e.size,c=(s-1)*r;return typeof n=="function"?n(i,s):a===1?i*r:c-i*r}const L7=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function z7(e){const t=L7.exec(e);if(!t)return[,];const[,n,r,a]=t;return[`--${n??r}`,a]}function AA(e,t,n=1){const[r,a]=z7(e);if(!r)return;const i=window.getComputedStyle(t).getPropertyValue(r);if(i){const s=i.trim();return WR(s)?parseFloat(s):s}return wS(a)?AA(a,t,n+1):a}const B7={type:"spring",stiffness:500,damping:25,restSpeed:10},$7=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),q7={type:"keyframes",duration:.8},H7={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},W7=(e,{keyframes:t})=>t.length>2?q7:_f.has(e)?e.startsWith("scale")?$7(t[1]):B7:H7,G7=e=>e!==null;function V7(e,{repeat:t,repeatType:n="loop"},r){const a=e.filter(G7),i=t&&n!=="loop"&&t%2===1?0:a.length-1;return a[i]}function jA(e,t){if(e!=null&&e.inherit&&t){const{inherit:n,...r}=e;return{...t,...r}}return e}function IS(e,t){const n=(e==null?void 0:e[t])??(e==null?void 0:e.default)??e;return n!==e?jA(n,e):n}function U7({when:e,delay:t,delayChildren:n,staggerChildren:r,staggerDirection:a,repeat:i,repeatType:s,repeatDelay:c,from:l,elapsed:d,...u}){return!!Object.keys(u).length}const PS=(e,t,n,r={},a,i)=>s=>{const c=IS(r,e)||{},l=c.delay||r.delay||0;let{elapsed:d=0}=r;d=d-oc(l);const u={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:t.getVelocity(),...c,delay:-d,onUpdate:m=>{t.set(m),c.onUpdate&&c.onUpdate(m)},onComplete:()=>{s(),c.onComplete&&c.onComplete()},name:e,motionValue:t,element:i?void 0:a};U7(c)||Object.assign(u,W7(e,u)),u.duration&&(u.duration=oc(u.duration)),u.repeatDelay&&(u.repeatDelay=oc(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let h=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(yv(u),u.delay===0&&(h=!0)),(gd.instantAnimations||gd.skipAnimations||a!=null&&a.shouldSkipAnimations)&&(h=!0,yv(u),u.delay=0),u.allowFlatten=!c.type&&!c.ease,h&&!i&&t.get()!==void 0){const m=V7(u.keyframes,c);if(m!==void 0){ra.update(()=>{u.onUpdate(m),u.onComplete()});return}}return c.isSync?new ES(u):new D7(u)};function b8(e){const t=[{},{}];return e==null||e.values.forEach((n,r)=>{t[0][r]=n.get(),t[1][r]=n.getVelocity()}),t}function FS(e,t,n,r){if(typeof t=="function"){const[a,i]=b8(r);t=t(n!==void 0?n:e.custom,a,i)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[a,i]=b8(r);t=t(n!==void 0?n:e.custom,a,i)}return t}function ff(e,t,n){const r=e.getProps();return FS(r,t,n!==void 0?n:r.custom,e)}const EA=new Set(["width","height","top","left","right","bottom",...Ff]),x8=30,Y7=e=>!isNaN(parseFloat(e));class K7{constructor(t,n={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=r=>{var i;const a=hi.now();if(this.updatedAt!==a&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(r),this.current!==this.prev&&((i=this.events.change)==null||i.notify(this.current),this.dependents))for(const s of this.dependents)s.dirty()},this.hasAnimated=!1,this.setCurrent(t),this.owner=n.owner}setCurrent(t){this.current=t,this.updatedAt=hi.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=Y7(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,n){this.events[t]||(this.events[t]=new xS);const r=this.events[t].add(n);return t==="change"?()=>{r(),ra.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,n){this.passiveEffect=t,this.stopPassiveEffect=n}set(t){this.passiveEffect?this.passiveEffect(t,this.updateAndNotify):this.updateAndNotify(t)}setWithVelocity(t,n,r){this.set(n),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-r}jump(t,n=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var t;(t=this.events.change)==null||t.notify(this.current)}addDependent(t){this.dependents||(this.dependents=new Set),this.dependents.add(t)}removeDependent(t){this.dependents&&this.dependents.delete(t)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=hi.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>x8)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,x8);return YR(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(t){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=t(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var t,n;(t=this.dependents)==null||t.clear(),(n=this.events.destroy)==null||n.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Mf(e,t){return new K7(e,t)}const bv=e=>Array.isArray(e);function X7(e,t,n){e.hasValue(t)?e.getValue(t).set(n):e.addValue(t,Mf(n))}function J7(e){return bv(e)?e[e.length-1]||0:e}function Q7(e,t){const n=ff(e,t);let{transitionEnd:r={},transition:a={},...i}=n||{};i={...i,...r};for(const s in i){const c=J7(i[s]);X7(e,s,c)}}const Xs=e=>!!(e&&e.getVelocity);function Z7(e){return!!(Xs(e)&&e.add)}function xv(e,t){const n=e.getValue("willChange");if(Z7(n))return n.add(t);if(!n&&gd.WillChange){const r=new gd.WillChange("auto");e.addValue("willChange",r),r.add(t)}}function _S(e){return e.replace(/([A-Z])/g,t=>`-${t.toLowerCase()}`)}const e9="framerAppearId",TA="data-"+_S(e9);function IA(e){return e.props[TA]}function t9({protectedKeys:e,needsAnimating:t},n){const r=e.hasOwnProperty(n)&&t[n]!==!0;return t[n]=!1,r}function PA(e,t,{delay:n=0,transitionOverride:r,type:a}={}){let{transition:i,transitionEnd:s,...c}=t;const l=e.getDefaultTransition();i=i?jA(i,l):l;const d=i==null?void 0:i.reduceMotion;r&&(i=r);const u=[],h=a&&e.animationState&&e.animationState.getState()[a];for(const m in c){const f=e.getValue(m,e.latestValues[m]??null),g=c[m];if(g===void 0||h&&t9(h,m))continue;const x={delay:n,...IS(i||{},m)},v=f.get();if(v!==void 0&&!f.isAnimating&&!Array.isArray(g)&&g===v&&!x.velocity)continue;let b=!1;if(window.MotionHandoffAnimation){const k=IA(e);if(k){const R=window.MotionHandoffAnimation(k,m,ra);R!==null&&(x.startTime=R,b=!0)}}xv(e,m);const w=d??e.shouldReduceMotion;f.start(PS(m,f,g,w&&EA.has(m)?{type:!1}:x,e,b));const M=f.animation;M&&u.push(M)}if(s){const m=()=>ra.update(()=>{s&&Q7(e,s)});u.length?Promise.all(u).then(m):m()}return u}function vv(e,t,n={}){var l;const r=ff(e,t,n.type==="exit"?(l=e.presenceContext)==null?void 0:l.custom:void 0);let{transition:a=e.getDefaultTransition()||{}}=r||{};n.transitionOverride&&(a=n.transitionOverride);const i=r?()=>Promise.all(PA(e,r,n)):()=>Promise.resolve(),s=e.variantChildren&&e.variantChildren.size?(d=0)=>{const{delayChildren:u=0,staggerChildren:h,staggerDirection:m}=a;return n9(e,t,d,u,h,m,n)}:()=>Promise.resolve(),{when:c}=a;if(c){const[d,u]=c==="beforeChildren"?[i,s]:[s,i];return d().then(()=>u())}else return Promise.all([i(),s(n.delay)])}function n9(e,t,n=0,r=0,a=0,i=1,s){const c=[];for(const l of e.variantChildren)l.notify("AnimationStart",t),c.push(vv(l,t,{...s,delay:n+(typeof r=="function"?0:r)+RA(e.variantChildren,l,r,a,i)}).then(()=>l.notify("AnimationComplete",t)));return Promise.all(c)}function r9(e,t,n={}){e.notify("AnimationStart",t);let r;if(Array.isArray(t)){const a=t.map(i=>vv(e,i,n));r=Promise.all(a)}else if(typeof t=="string")r=vv(e,t,n);else{const a=typeof t=="function"?ff(e,t,n.custom):t;r=Promise.all(PA(e,a,n))}return r.then(()=>{e.notify("AnimationComplete",t)})}const o9={test:e=>e==="auto",parse:e=>e},FA=e=>t=>t.test(e),_A=[Pf,Jn,_c,a0,Fz,Pz,o9],v8=e=>_A.find(FA(e));function a9(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||VR(e):!0}const s9=new Set(["brightness","contrast","saturate","opacity"]);function i9(e){const[t,n]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[r]=n.match(MS)||[];if(!r)return e;const a=n.replace(r,"");let i=s9.has(t)?1:0;return r!==n&&(i*=100),t+"("+i+a+")"}const l9=/\b([a-z-]*)\(.*?\)/gu,Sv={...ac,getAnimatableNone:e=>{const t=e.match(l9);return t?t.map(i9).join(" "):e}},wv={...ac,getAnimatableNone:e=>{const t=ac.parse(e);return ac.createTransformer(e)(t.map(r=>typeof r=="number"?0:typeof r=="object"?{...r,alpha:1}:r))}},S8={...Pf,transform:Math.round},c9={rotate:a0,rotateX:a0,rotateY:a0,rotateZ:a0,scale:Pg,scaleX:Pg,scaleY:Pg,scaleZ:Pg,skew:a0,skewX:a0,skewY:a0,distance:Jn,translateX:Jn,translateY:Jn,translateZ:Jn,x:Jn,y:Jn,z:Jn,perspective:Jn,transformPerspective:Jn,opacity:im,originX:i8,originY:i8,originZ:Jn},NS={borderWidth:Jn,borderTopWidth:Jn,borderRightWidth:Jn,borderBottomWidth:Jn,borderLeftWidth:Jn,borderRadius:Jn,borderTopLeftRadius:Jn,borderTopRightRadius:Jn,borderBottomRightRadius:Jn,borderBottomLeftRadius:Jn,width:Jn,maxWidth:Jn,height:Jn,maxHeight:Jn,top:Jn,right:Jn,bottom:Jn,left:Jn,inset:Jn,insetBlock:Jn,insetBlockStart:Jn,insetBlockEnd:Jn,insetInline:Jn,insetInlineStart:Jn,insetInlineEnd:Jn,padding:Jn,paddingTop:Jn,paddingRight:Jn,paddingBottom:Jn,paddingLeft:Jn,paddingBlock:Jn,paddingBlockStart:Jn,paddingBlockEnd:Jn,paddingInline:Jn,paddingInlineStart:Jn,paddingInlineEnd:Jn,margin:Jn,marginTop:Jn,marginRight:Jn,marginBottom:Jn,marginLeft:Jn,marginBlock:Jn,marginBlockStart:Jn,marginBlockEnd:Jn,marginInline:Jn,marginInlineStart:Jn,marginInlineEnd:Jn,fontSize:Jn,backgroundPositionX:Jn,backgroundPositionY:Jn,...c9,zIndex:S8,fillOpacity:im,strokeOpacity:im,numOctaves:S8},d9={...NS,color:rs,backgroundColor:rs,outlineColor:rs,fill:rs,stroke:rs,borderColor:rs,borderTopColor:rs,borderRightColor:rs,borderBottomColor:rs,borderLeftColor:rs,filter:Sv,WebkitFilter:Sv,mask:wv,WebkitMask:wv},NA=e=>d9[e],u9=new Set([Sv,wv]);function OA(e,t){let n=NA(e);return u9.has(n)||(n=ac),n.getAnimatableNone?n.getAnimatableNone(t):void 0}const h9=new Set(["auto","none","0"]);function f9(e,t,n){let r=0,a;for(;r<e.length&&!a;){const i=e[r];typeof i=="string"&&!h9.has(i)&&lm(i).values.length&&(a=e[r]),r++}if(a&&n)for(const i of t)e[i]=OA(n,a)}class p9 extends TS{constructor(t,n,r,a,i){super(t,n,r,a,i,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:n,name:r}=this;if(!n||!n.current)return;super.readKeyframes();for(let u=0;u<t.length;u++){let h=t[u];if(typeof h=="string"&&(h=h.trim(),wS(h))){const m=AA(h,n.current);m!==void 0&&(t[u]=m),u===t.length-1&&(this.finalKeyframe=h)}}if(this.resolveNoneKeyframes(),!EA.has(r)||t.length!==2)return;const[a,i]=t,s=v8(a),c=v8(i),l=s8(a),d=s8(i);if(l!==d&&b0[r]){this.needsMeasurement=!0;return}if(s!==c)if(m8(s)&&m8(c))for(let u=0;u<t.length;u++){const h=t[u];typeof h=="string"&&(t[u]=parseFloat(h))}else b0[r]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:n}=this,r=[];for(let a=0;a<t.length;a++)(t[a]===null||a9(t[a]))&&r.push(a);r.length&&f9(t,r,n)}measureInitialState(){const{element:t,unresolvedKeyframes:n,name:r}=this;if(!t||!t.current)return;r==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=b0[r](t.measureViewportBox(),window.getComputedStyle(t.current)),n[0]=this.measuredOrigin;const a=n[n.length-1];a!==void 0&&t.getValue(r,a).jump(a,!1)}measureEndState(){var c;const{element:t,name:n,unresolvedKeyframes:r}=this;if(!t||!t.current)return;const a=t.getValue(n);a&&a.jump(this.measuredOrigin,!1);const i=r.length-1,s=r[i];r[i]=b0[n](t.measureViewportBox(),window.getComputedStyle(t.current)),s!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=s),(c=this.removedTransforms)!=null&&c.length&&this.removedTransforms.forEach(([l,d])=>{t.getValue(l).set(d)}),this.resolveNoneKeyframes()}}const m9=new Set(["opacity","clipPath","filter","transform"]);function DA(e,t,n){if(e==null)return[];if(e instanceof EventTarget)return[e];if(typeof e=="string"){let r=document;const a=(n==null?void 0:n[e])??r.querySelectorAll(e);return a?Array.from(a):[]}return Array.from(e).filter(r=>r!=null)}const LA=(e,t)=>t&&typeof e=="number"?t.transform(e):e;function Mv(e){return GR(e)&&"offsetHeight"in e}const{schedule:OS}=aA(queueMicrotask,!1),Jl={x:!1,y:!1};function zA(){return Jl.x||Jl.y}function g9(e){return e==="x"||e==="y"?Jl[e]?null:(Jl[e]=!0,()=>{Jl[e]=!1}):Jl.x||Jl.y?null:(Jl.x=Jl.y=!0,()=>{Jl.x=Jl.y=!1})}function BA(e,t){const n=DA(e),r=new AbortController,a={passive:!0,...t,signal:r.signal};return[n,a,()=>r.abort()]}function y9(e){return!(e.pointerType==="touch"||zA())}function b9(e,t,n={}){const[r,a,i]=BA(e,n);return r.forEach(s=>{let c=!1,l=!1,d;const u=()=>{s.removeEventListener("pointerleave",g)},h=v=>{d&&(d(v),d=void 0),u()},m=v=>{c=!1,window.removeEventListener("pointerup",m),window.removeEventListener("pointercancel",m),l&&(l=!1,h(v))},f=()=>{c=!0,window.addEventListener("pointerup",m,a),window.addEventListener("pointercancel",m,a)},g=v=>{if(v.pointerType!=="touch"){if(c){l=!0;return}h(v)}},x=v=>{if(!y9(v))return;l=!1;const b=t(s,v);typeof b=="function"&&(d=b,s.addEventListener("pointerleave",g,a))};s.addEventListener("pointerenter",x,a),s.addEventListener("pointerdown",f,a)}),i}const $A=(e,t)=>t?e===t?!0:$A(e,t.parentElement):!1,DS=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,x9=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function v9(e){return x9.has(e.tagName)||e.isContentEditable===!0}const S9=new Set(["INPUT","SELECT","TEXTAREA"]);function w9(e){return S9.has(e.tagName)||e.isContentEditable===!0}const E5=new WeakSet;function w8(e){return t=>{t.key==="Enter"&&e(t)}}function H2(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const M9=(e,t)=>{const n=e.currentTarget;if(!n)return;const r=w8(()=>{if(E5.has(n))return;H2(n,"down");const a=w8(()=>{H2(n,"up")}),i=()=>H2(n,"cancel");n.addEventListener("keyup",a,t),n.addEventListener("blur",i,t)});n.addEventListener("keydown",r,t),n.addEventListener("blur",()=>n.removeEventListener("keydown",r),t)};function M8(e){return DS(e)&&!zA()}const C8=new WeakSet;function C9(e,t,n={}){const[r,a,i]=BA(e,n),s=c=>{const l=c.currentTarget;if(!M8(c)||C8.has(c))return;E5.add(l),n.stopPropagation&&C8.add(c);const d=t(l,c),u=(f,g)=>{window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",m),E5.has(l)&&E5.delete(l),M8(f)&&typeof d=="function"&&d(f,{success:g})},h=f=>{u(f,l===window||l===document||n.useGlobalTarget||$A(l,f.target))},m=f=>{u(f,!1)};window.addEventListener("pointerup",h,a),window.addEventListener("pointercancel",m,a)};return r.forEach(c=>{(n.useGlobalTarget?window:c).addEventListener("pointerdown",s,a),Mv(c)&&(c.addEventListener("focus",d=>M9(d,a)),!v9(c)&&!c.hasAttribute("tabindex")&&(c.tabIndex=0))}),i}function LS(e){return GR(e)&&"ownerSVGElement"in e}const T5=new WeakMap;let s0;const qA=(e,t,n)=>(r,a)=>a&&a[0]?a[0][e+"Size"]:LS(r)&&"getBBox"in r?r.getBBox()[t]:r[n],k9=qA("inline","width","offsetWidth"),R9=qA("block","height","offsetHeight");function A9({target:e,borderBoxSize:t}){var n;(n=T5.get(e))==null||n.forEach(r=>{r(e,{get width(){return k9(e,t)},get height(){return R9(e,t)}})})}function j9(e){e.forEach(A9)}function E9(){typeof ResizeObserver>"u"||(s0=new ResizeObserver(j9))}function T9(e,t){s0||E9();const n=DA(e);return n.forEach(r=>{let a=T5.get(r);a||(a=new Set,T5.set(r,a)),a.add(t),s0==null||s0.observe(r)}),()=>{n.forEach(r=>{const a=T5.get(r);a==null||a.delete(t),a!=null&&a.size||s0==null||s0.unobserve(r)})}}const I5=new Set;let Jh;function I9(){Jh=()=>{const e={get width(){return window.innerWidth},get height(){return window.innerHeight}};I5.forEach(t=>t(e))},window.addEventListener("resize",Jh)}function P9(e){return I5.add(e),Jh||I9(),()=>{I5.delete(e),!I5.size&&typeof Jh=="function"&&(window.removeEventListener("resize",Jh),Jh=void 0)}}function k8(e,t){return typeof e=="function"?P9(e):T9(e,t)}function F9(e){return LS(e)&&e.tagName==="svg"}const _9=[..._A,rs,ac],N9=e=>_9.find(FA(e)),R8=()=>({translate:0,scale:1,origin:0,originPoint:0}),Qh=()=>({x:R8(),y:R8()}),A8=()=>({min:0,max:0}),us=()=>({x:A8(),y:A8()}),O9=new WeakMap;function Hy(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}function cm(e){return typeof e=="string"||Array.isArray(e)}const zS=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],BS=["initial",...zS];function Wy(e){return Hy(e.animate)||BS.some(t=>cm(e[t]))}function HA(e){return!!(Wy(e)||e.variants)}function D9(e,t,n){for(const r in t){const a=t[r],i=n[r];if(Xs(a))e.addValue(r,a);else if(Xs(i))e.addValue(r,Mf(a,{owner:e}));else if(i!==a)if(e.hasValue(r)){const s=e.getValue(r);s.liveStyle===!0?s.jump(a):s.hasAnimated||s.set(a)}else{const s=e.getStaticValue(r);e.addValue(r,Mf(s!==void 0?s:a,{owner:e}))}}for(const r in n)t[r]===void 0&&e.removeValue(r);return t}const Cv={current:null},WA={current:!1},L9=typeof window<"u";function z9(){if(WA.current=!0,!!L9)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>Cv.current=e.matches;e.addEventListener("change",t),t()}else Cv.current=!1}const j8=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];let sy={};function GA(e){sy=e}function B9(){return sy}class $9{scrapeMotionValuesFromProps(t,n,r){return{}}constructor({parent:t,props:n,presenceContext:r,reducedMotionConfig:a,skipAnimations:i,blockInitialAnimation:s,visualState:c},l={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.shouldSkipAnimations=!1,this.values=new Map,this.KeyframeResolver=TS,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.hasBeenMounted=!1,this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const f=hi.now();this.renderScheduledAt<f&&(this.renderScheduledAt=f,ra.render(this.render,!1,!0))};const{latestValues:d,renderState:u}=c;this.latestValues=d,this.baseTarget={...d},this.initialValues=n.initial?{...d}:{},this.renderState=u,this.parent=t,this.props=n,this.presenceContext=r,this.depth=t?t.depth+1:0,this.reducedMotionConfig=a,this.skipAnimationsConfig=i,this.options=l,this.blockInitialAnimation=!!s,this.isControllingVariants=Wy(n),this.isVariantNode=HA(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:h,...m}=this.scrapeMotionValuesFromProps(n,{},this);for(const f in m){const g=m[f];d[f]!==void 0&&Xs(g)&&g.set(d[f])}}mount(t){var n,r;if(this.hasBeenMounted)for(const a in this.initialValues)(n=this.values.get(a))==null||n.jump(this.initialValues[a]),this.latestValues[a]=this.initialValues[a];this.current=t,O9.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((a,i)=>this.bindToMotionValue(i,a)),this.reducedMotionConfig==="never"?this.shouldReduceMotion=!1:this.reducedMotionConfig==="always"?this.shouldReduceMotion=!0:(WA.current||z9(),this.shouldReduceMotion=Cv.current),this.shouldSkipAnimations=this.skipAnimationsConfig??!1,(r=this.parent)==null||r.addChild(this),this.update(this.props,this.presenceContext),this.hasBeenMounted=!0}unmount(){var t;this.projection&&this.projection.unmount(),A0(this.notifyUpdate),A0(this.render),this.valueSubscriptions.forEach(n=>n()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(t=this.parent)==null||t.removeChild(this);for(const n in this.events)this.events[n].clear();for(const n in this.features){const r=this.features[n];r&&(r.unmount(),r.isMounted=!1)}this.current=null}addChild(t){this.children.add(t),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(t)}removeChild(t){this.children.delete(t),this.enteringChildren&&this.enteringChildren.delete(t)}bindToMotionValue(t,n){if(this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)(),n.accelerate&&m9.has(t)&&this.current instanceof HTMLElement){const{factory:s,keyframes:c,times:l,ease:d,duration:u}=n.accelerate,h=new CA({element:this.current,name:t,keyframes:c,times:l,ease:d,duration:oc(u)}),m=s(h);this.valueSubscriptions.set(t,()=>{m(),h.cancel()});return}const r=_f.has(t);r&&this.onBindTransform&&this.onBindTransform();const a=n.on("change",s=>{this.latestValues[t]=s,this.props.onUpdate&&ra.preRender(this.notifyUpdate),r&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let i;typeof window<"u"&&window.MotionCheckAppearSync&&(i=window.MotionCheckAppearSync(this,t,n)),this.valueSubscriptions.set(t,()=>{a(),i&&i(),n.owner&&n.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in sy){const n=sy[t];if(!n)continue;const{isEnabled:r,Feature:a}=n;if(!this.features[t]&&a&&r(this.props)&&(this.features[t]=new a(this)),this.features[t]){const i=this.features[t];i.isMounted?i.update():(i.mount(),i.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):us()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,n){this.latestValues[t]=n}update(t,n){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let r=0;r<j8.length;r++){const a=j8[r];this.propEventSubscriptions[a]&&(this.propEventSubscriptions[a](),delete this.propEventSubscriptions[a]);const i="on"+a,s=t[i];s&&(this.propEventSubscriptions[a]=this.on(a,s))}this.prevMotionValues=D9(this,this.scrapeMotionValuesFromProps(t,this.prevProps||{},this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(t),()=>n.variantChildren.delete(t)}addValue(t,n){const r=this.values.get(t);n!==r&&(r&&this.removeValue(t),this.bindToMotionValue(t,n),this.values.set(t,n),this.latestValues[t]=n.get())}removeValue(t){this.values.delete(t);const n=this.valueSubscriptions.get(t);n&&(n(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,n){if(this.props.values&&this.props.values[t])return this.props.values[t];let r=this.values.get(t);return r===void 0&&n!==void 0&&(r=Mf(n===null?void 0:n,{owner:this}),this.addValue(t,r)),r}readValue(t,n){let r=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:this.getBaseTargetFromProps(this.props,t)??this.readValueFromInstance(this.current,t,this.options);return r!=null&&(typeof r=="string"&&(WR(r)||VR(r))?r=parseFloat(r):!N9(r)&&ac.test(n)&&(r=OA(t,n)),this.setBaseTarget(t,Xs(r)?r.get():r)),Xs(r)?r.get():r}setBaseTarget(t,n){this.baseTarget[t]=n}getBaseTarget(t){var i;const{initial:n}=this.props;let r;if(typeof n=="string"||typeof n=="object"){const s=FS(this.props,n,(i=this.presenceContext)==null?void 0:i.custom);s&&(r=s[t])}if(n&&r!==void 0)return r;const a=this.getBaseTargetFromProps(this.props,t);return a!==void 0&&!Xs(a)?a:this.initialValues[t]!==void 0&&r===void 0?void 0:this.baseTarget[t]}on(t,n){return this.events[t]||(this.events[t]=new xS),this.events[t].add(n)}notify(t,...n){this.events[t]&&this.events[t].notify(...n)}scheduleRenderMicrotask(){OS.render(this.render)}}class VA extends $9{constructor(){super(...arguments),this.KeyframeResolver=p9}sortInstanceNodePosition(t,n){return t.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(t,n){const r=t.style;return r?r[n]:void 0}removeValueFromRenderState(t,{vars:n,style:r}){delete n[t],delete r[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;Xs(t)&&(this.childSubscription=t.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}class j0{constructor(t){this.isMounted=!1,this.node=t}update(){}}function UA({top:e,left:t,right:n,bottom:r}){return{x:{min:t,max:n},y:{min:e,max:r}}}function q9({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function H9(e,t){if(!t)return e;const n=t({x:e.left,y:e.top}),r=t({x:e.right,y:e.bottom});return{top:n.y,left:n.x,bottom:r.y,right:r.x}}function W2(e){return e===void 0||e===1}function kv({scale:e,scaleX:t,scaleY:n}){return!W2(e)||!W2(t)||!W2(n)}function hu(e){return kv(e)||YA(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function YA(e){return E8(e.x)||E8(e.y)}function E8(e){return e&&e!=="0%"}function iy(e,t,n){const r=e-n,a=t*r;return n+a}function T8(e,t,n,r,a){return a!==void 0&&(e=iy(e,a,r)),iy(e,n,r)+t}function Rv(e,t=0,n=1,r,a){e.min=T8(e.min,t,n,r,a),e.max=T8(e.max,t,n,r,a)}function KA(e,{x:t,y:n}){Rv(e.x,t.translate,t.scale,t.originPoint),Rv(e.y,n.translate,n.scale,n.originPoint)}const I8=.999999999999,P8=1.0000000000001;function W9(e,t,n,r=!1){const a=n.length;if(!a)return;t.x=t.y=1;let i,s;for(let c=0;c<a;c++){i=n[c],s=i.projectionDelta;const{visualElement:l}=i.options;l&&l.props.style&&l.props.style.display==="contents"||(r&&i.options.layoutScroll&&i.scroll&&i!==i.root&&ef(e,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),s&&(t.x*=s.x.scale,t.y*=s.y.scale,KA(e,s)),r&&hu(i.latestValues)&&ef(e,i.latestValues))}t.x<P8&&t.x>I8&&(t.x=1),t.y<P8&&t.y>I8&&(t.y=1)}function Zh(e,t){e.min=e.min+t,e.max=e.max+t}function F8(e,t,n,r,a=.5){const i=Aa(e.min,e.max,a);Rv(e,t,n,i,r)}function ef(e,t){F8(e.x,t.x,t.scaleX,t.scale,t.originX),F8(e.y,t.y,t.scaleY,t.scale,t.originY)}function XA(e,t){return UA(H9(e.getBoundingClientRect(),t))}function G9(e,t,n){const r=XA(e,n),{scroll:a}=t;return a&&(Zh(r.x,a.offset.x),Zh(r.y,a.offset.y)),r}const V9={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},U9=Ff.length;function Y9(e,t,n){let r="",a=!0;for(let i=0;i<U9;i++){const s=Ff[i],c=e[s];if(c===void 0)continue;let l=!0;if(typeof c=="number")l=c===(s.startsWith("scale")?1:0);else{const d=parseFloat(c);l=s.startsWith("scale")?d===1:d===0}if(!l||n){const d=LA(c,NS[s]);if(!l){a=!1;const u=V9[s]||s;r+=`${u}(${d}) `}n&&(t[s]=d)}}return r=r.trim(),n?r=n(t,a?"":r):a&&(r="none"),r}function $S(e,t,n){const{style:r,vars:a,transformOrigin:i}=e;let s=!1,c=!1;for(const l in t){const d=t[l];if(_f.has(l)){s=!0;continue}else if(iA(l)){a[l]=d;continue}else{const u=LA(d,NS[l]);l.startsWith("origin")?(c=!0,i[l]=u):r[l]=u}}if(t.transform||(s||n?r.transform=Y9(t,e.transform,n):r.transform&&(r.transform="none")),c){const{originX:l="50%",originY:d="50%",originZ:u=0}=i;r.transformOrigin=`${l} ${d} ${u}`}}function JA(e,{style:t,vars:n},r,a){const i=e.style;let s;for(s in t)i[s]=t[s];a==null||a.applyProjectionStyles(i,r);for(s in n)i.setProperty(s,n[s])}function _8(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const lp={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(Jn.test(e))e=parseFloat(e);else return e;const n=_8(e,t.target.x),r=_8(e,t.target.y);return`${n}% ${r}%`}},K9={correct:(e,{treeScale:t,projectionDelta:n})=>{const r=e,a=ac.parse(e);if(a.length>5)return r;const i=ac.createTransformer(e),s=typeof a[0]!="number"?1:0,c=n.x.scale*t.x,l=n.y.scale*t.y;a[0+s]/=c,a[1+s]/=l;const d=Aa(c,l,.5);return typeof a[2+s]=="number"&&(a[2+s]/=d),typeof a[3+s]=="number"&&(a[3+s]/=d),i(a)}},Av={borderRadius:{...lp,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:lp,borderTopRightRadius:lp,borderBottomLeftRadius:lp,borderBottomRightRadius:lp,boxShadow:K9};function QA(e,{layout:t,layoutId:n}){return _f.has(e)||e.startsWith("origin")||(t||n!==void 0)&&(!!Av[e]||e==="opacity")}function qS(e,t,n){var s;const r=e.style,a=t==null?void 0:t.style,i={};if(!r)return i;for(const c in r)(Xs(r[c])||a&&Xs(a[c])||QA(c,e)||((s=n==null?void 0:n.getValue(c))==null?void 0:s.liveStyle)!==void 0)&&(i[c]=r[c]);return i}function X9(e){return window.getComputedStyle(e)}class J9 extends VA{constructor(){super(...arguments),this.type="html",this.renderInstance=JA}readValueFromInstance(t,n){var r;if(_f.has(n))return(r=this.projection)!=null&&r.isProjecting?hv(n):g7(t,n);{const a=X9(t),i=(iA(n)?a.getPropertyValue(n):a[n])||0;return typeof i=="string"?i.trim():i}}measureInstanceViewportBox(t,{transformPagePoint:n}){return XA(t,n)}build(t,n,r){$S(t,n,r.transformTemplate)}scrapeMotionValuesFromProps(t,n,r){return qS(t,n,r)}}const Q9={offset:"stroke-dashoffset",array:"stroke-dasharray"},Z9={offset:"strokeDashoffset",array:"strokeDasharray"};function eB(e,t,n=1,r=0,a=!0){e.pathLength=1;const i=a?Q9:Z9;e[i.offset]=`${-r}`,e[i.array]=`${t} ${n}`}const tB=["offsetDistance","offsetPath","offsetRotate","offsetAnchor"];function ZA(e,{attrX:t,attrY:n,attrScale:r,pathLength:a,pathSpacing:i=1,pathOffset:s=0,...c},l,d,u){if($S(e,c,d),l){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:h,style:m}=e;h.transform&&(m.transform=h.transform,delete h.transform),(m.transform||h.transformOrigin)&&(m.transformOrigin=h.transformOrigin??"50% 50%",delete h.transformOrigin),m.transform&&(m.transformBox=(u==null?void 0:u.transformBox)??"fill-box",delete h.transformBox);for(const f of tB)h[f]!==void 0&&(m[f]=h[f],delete h[f]);t!==void 0&&(h.x=t),n!==void 0&&(h.y=n),r!==void 0&&(h.scale=r),a!==void 0&&eB(h,a,i,s,!1)}const ej=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]),tj=e=>typeof e=="string"&&e.toLowerCase()==="svg";function nB(e,t,n,r){JA(e,t,void 0,r);for(const a in t.attrs)e.setAttribute(ej.has(a)?a:_S(a),t.attrs[a])}function nj(e,t,n){const r=qS(e,t,n);for(const a in e)if(Xs(e[a])||Xs(t[a])){const i=Ff.indexOf(a)!==-1?"attr"+a.charAt(0).toUpperCase()+a.substring(1):a;r[i]=e[a]}return r}class rB extends VA{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=us}getBaseTargetFromProps(t,n){return t[n]}readValueFromInstance(t,n){if(_f.has(n)){const r=NA(n);return r&&r.default||0}return n=ej.has(n)?n:_S(n),t.getAttribute(n)}scrapeMotionValuesFromProps(t,n,r){return nj(t,n,r)}build(t,n,r){ZA(t,n,this.isSVGTag,r.transformTemplate,r.style)}renderInstance(t,n,r,a){nB(t,n,r,a)}mount(t){this.isSVGTag=tj(t.tagName),super.mount(t)}}const oB=BS.length;function rj(e){if(!e)return;if(!e.isControllingVariants){const n=e.parent?rj(e.parent)||{}:{};return e.props.initial!==void 0&&(n.initial=e.props.initial),n}const t={};for(let n=0;n<oB;n++){const r=BS[n],a=e.props[r];(cm(a)||a===!1)&&(t[r]=a)}return t}function oj(e,t){if(!Array.isArray(t))return!1;const n=t.length;if(n!==e.length)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}const aB=[...zS].reverse(),sB=zS.length;function iB(e){return t=>Promise.all(t.map(({animation:n,options:r})=>r9(e,n,r)))}function lB(e){let t=iB(e),n=N8(),r=!0;const a=l=>(d,u)=>{var m;const h=ff(e,u,l==="exit"?(m=e.presenceContext)==null?void 0:m.custom:void 0);if(h){const{transition:f,transitionEnd:g,...x}=h;d={...d,...x,...g}}return d};function i(l){t=l(e)}function s(l){const{props:d}=e,u=rj(e.parent)||{},h=[],m=new Set;let f={},g=1/0;for(let v=0;v<sB;v++){const b=aB[v],w=n[b],M=d[b]!==void 0?d[b]:u[b],k=cm(M),R=b===l?w.isActive:null;R===!1&&(g=v);let j=M===u[b]&&M!==d[b]&&k;if(j&&r&&e.manuallyAnimateOnMount&&(j=!1),w.protectedKeys={...f},!w.isActive&&R===null||!M&&!w.prevProp||Hy(M)||typeof M=="boolean")continue;if(b==="exit"&&w.isActive&&R!==!0){w.prevResolvedValues&&(f={...f,...w.prevResolvedValues});continue}const I=cB(w.prevProp,M);let E=I||b===l&&w.isActive&&!j&&k||v>g&&k,O=!1;const L=Array.isArray(M)?M:[M];let $=L.reduce(a(b),{});R===!1&&($={});const{prevResolvedValues:F={}}=w,B={...F,...$},W=te=>{E=!0,m.has(te)&&(O=!0,m.delete(te)),w.needsAnimating[te]=!0;const J=e.getValue(te);J&&(J.liveStyle=!1)};for(const te in B){const J=$[te],pe=F[te];if(f.hasOwnProperty(te))continue;let P=!1;bv(J)&&bv(pe)?P=!oj(J,pe):P=J!==pe,P?J!=null?W(te):m.add(te):J!==void 0&&m.has(te)?W(te):w.protectedKeys[te]=!0}w.prevProp=M,w.prevResolvedValues=$,w.isActive&&(f={...f,...$}),r&&e.blockInitialAnimation&&(E=!1);const re=j&&I;E&&(!re||O)&&h.push(...L.map(te=>{const J={type:b};if(typeof te=="string"&&r&&!re&&e.manuallyAnimateOnMount&&e.parent){const{parent:pe}=e,P=ff(pe,te);if(pe.enteringChildren&&P){const{delayChildren:V}=P.transition||{};J.delay=RA(pe.enteringChildren,e,V)}}return{animation:te,options:J}}))}if(m.size){const v={};if(typeof d.initial!="boolean"){const b=ff(e,Array.isArray(d.initial)?d.initial[0]:d.initial);b&&b.transition&&(v.transition=b.transition)}m.forEach(b=>{const w=e.getBaseTarget(b),M=e.getValue(b);M&&(M.liveStyle=!0),v[b]=w??null}),h.push({animation:v})}let x=!!h.length;return r&&(d.initial===!1||d.initial===d.animate)&&!e.manuallyAnimateOnMount&&(x=!1),r=!1,x?t(h):Promise.resolve()}function c(l,d){var h;if(n[l].isActive===d)return Promise.resolve();(h=e.variantChildren)==null||h.forEach(m=>{var f;return(f=m.animationState)==null?void 0:f.setActive(l,d)}),n[l].isActive=d;const u=s(l);for(const m in n)n[m].protectedKeys={};return u}return{animateChanges:s,setActive:c,setAnimateFunction:i,getState:()=>n,reset:()=>{n=N8()}}}function cB(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!oj(t,e):!1}function W0(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function N8(){return{animate:W0(!0),whileInView:W0(),whileHover:W0(),whileTap:W0(),whileDrag:W0(),whileFocus:W0(),exit:W0()}}function O8(e,t){e.min=t.min,e.max=t.max}function Hl(e,t){O8(e.x,t.x),O8(e.y,t.y)}function D8(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}const aj=1e-4,dB=1-aj,uB=1+aj,sj=.01,hB=0-sj,fB=0+sj;function fi(e){return e.max-e.min}function pB(e,t,n){return Math.abs(e-t)<=n}function L8(e,t,n,r=.5){e.origin=r,e.originPoint=Aa(t.min,t.max,e.origin),e.scale=fi(n)/fi(t),e.translate=Aa(n.min,n.max,e.origin)-e.originPoint,(e.scale>=dB&&e.scale<=uB||isNaN(e.scale))&&(e.scale=1),(e.translate>=hB&&e.translate<=fB||isNaN(e.translate))&&(e.translate=0)}function Hp(e,t,n,r){L8(e.x,t.x,n.x,r?r.originX:void 0),L8(e.y,t.y,n.y,r?r.originY:void 0)}function z8(e,t,n){e.min=n.min+t.min,e.max=e.min+fi(t)}function mB(e,t,n){z8(e.x,t.x,n.x),z8(e.y,t.y,n.y)}function B8(e,t,n){e.min=t.min-n.min,e.max=e.min+fi(t)}function ly(e,t,n){B8(e.x,t.x,n.x),B8(e.y,t.y,n.y)}function $8(e,t,n,r,a){return e-=t,e=iy(e,1/n,r),a!==void 0&&(e=iy(e,1/a,r)),e}function gB(e,t=0,n=1,r=.5,a,i=e,s=e){if(_c.test(t)&&(t=parseFloat(t),t=Aa(s.min,s.max,t/100)-s.min),typeof t!="number")return;let c=Aa(i.min,i.max,r);e===i&&(c-=t),e.min=$8(e.min,t,n,c,a),e.max=$8(e.max,t,n,c,a)}function q8(e,t,[n,r,a],i,s){gB(e,t[n],t[r],t[a],t.scale,i,s)}const yB=["x","scaleX","originX"],bB=["y","scaleY","originY"];function H8(e,t,n,r){q8(e.x,t,yB,n?n.x:void 0,r?r.x:void 0),q8(e.y,t,bB,n?n.y:void 0,r?r.y:void 0)}function W8(e){return e.translate===0&&e.scale===1}function ij(e){return W8(e.x)&&W8(e.y)}function G8(e,t){return e.min===t.min&&e.max===t.max}function xB(e,t){return G8(e.x,t.x)&&G8(e.y,t.y)}function V8(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function lj(e,t){return V8(e.x,t.x)&&V8(e.y,t.y)}function U8(e){return fi(e.x)/fi(e.y)}function Y8(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}function Ac(e){return[e("x"),e("y")]}function vB(e,t,n){let r="";const a=e.x.translate/t.x,i=e.y.translate/t.y,s=(n==null?void 0:n.z)||0;if((a||i||s)&&(r=`translate3d(${a}px, ${i}px, ${s}px) `),(t.x!==1||t.y!==1)&&(r+=`scale(${1/t.x}, ${1/t.y}) `),n){const{transformPerspective:d,rotate:u,rotateX:h,rotateY:m,skewX:f,skewY:g}=n;d&&(r=`perspective(${d}px) ${r}`),u&&(r+=`rotate(${u}deg) `),h&&(r+=`rotateX(${h}deg) `),m&&(r+=`rotateY(${m}deg) `),f&&(r+=`skewX(${f}deg) `),g&&(r+=`skewY(${g}deg) `)}const c=e.x.scale*t.x,l=e.y.scale*t.y;return(c!==1||l!==1)&&(r+=`scale(${c}, ${l})`),r||"none"}const cj=["TopLeft","TopRight","BottomLeft","BottomRight"],SB=cj.length,K8=e=>typeof e=="string"?parseFloat(e):e,X8=e=>typeof e=="number"||Jn.test(e);function wB(e,t,n,r,a,i){a?(e.opacity=Aa(0,n.opacity??1,MB(r)),e.opacityExit=Aa(t.opacity??1,0,CB(r))):i&&(e.opacity=Aa(t.opacity??1,n.opacity??1,r));for(let s=0;s<SB;s++){const c=`border${cj[s]}Radius`;let l=J8(t,c),d=J8(n,c);if(l===void 0&&d===void 0)continue;l||(l=0),d||(d=0),l===0||d===0||X8(l)===X8(d)?(e[c]=Math.max(Aa(K8(l),K8(d),r),0),(_c.test(d)||_c.test(l))&&(e[c]+="%")):e[c]=d}(t.rotate||n.rotate)&&(e.rotate=Aa(t.rotate||0,n.rotate||0,r))}function J8(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const MB=dj(0,.5,tA),CB=dj(.5,.95,Tl);function dj(e,t,n){return r=>r<e?0:r>t?1:n(sm(e,t,r))}function kB(e,t,n){const r=Xs(e)?e:Mf(e);return r.start(PS("",r,t,n)),r.animation}function dm(e,t,n,r={passive:!0}){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n)}const RB=(e,t)=>e.depth-t.depth;class AB{constructor(){this.children=[],this.isDirty=!1}add(t){yS(this.children,t),this.isDirty=!0}remove(t){ny(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(RB),this.isDirty=!1,this.children.forEach(t)}}function jB(e,t){const n=hi.now(),r=({timestamp:a})=>{const i=a-n;i>=t&&(A0(r),e(i-t))};return ra.setup(r,!0),()=>A0(r)}function P5(e){return Xs(e)?e.get():e}class EB{constructor(){this.members=[]}add(t){yS(this.members,t);for(let n=this.members.length-1;n>=0;n--){const r=this.members[n];if(r===t||r===this.lead||r===this.prevLead)continue;const a=r.instance;a&&a.isConnected===!1&&r.isPresent!==!1&&!r.snapshot&&ny(this.members,r)}t.scheduleRender()}remove(t){if(ny(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(t){const n=this.members.findIndex(a=>t===a);if(n===0)return!1;let r;for(let a=n;a>=0;a--){const i=this.members[a],s=i.instance;if(i.isPresent!==!1&&(!s||s.isConnected!==!1)){r=i;break}}return r?(this.promote(r),!0):!1}promote(t,n){const r=this.lead;if(t!==r&&(this.prevLead=r,this.lead=t,t.show(),r)){r.instance&&r.scheduleRender(),t.scheduleRender();const a=r.options.layoutDependency,i=t.options.layoutDependency;if(!(a!==void 0&&i!==void 0&&a===i)){const l=r.instance;l&&l.isConnected===!1&&!r.snapshot||(t.resumeFrom=r,n&&(t.resumeFrom.preserveOpacity=!0),r.snapshot&&(t.snapshot=r.snapshot,t.snapshot.latestValues=r.animationValues||r.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0))}const{crossfade:c}=t.options;c===!1&&r.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:n,resumingFrom:r}=t;n.onExitComplete&&n.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const F5={hasAnimatedSinceResize:!0,hasEverUpdated:!1},G2=["","X","Y","Z"],TB=1e3;let IB=0;function V2(e,t,n,r){const{latestValues:a}=t;a[e]&&(n[e]=a[e],t.setStaticValue(e,0),r&&(r[e]=0))}function uj(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const n=IA(t);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:a,layoutId:i}=e.options;window.MotionCancelOptimisedAnimation(n,"transform",ra,!(a||i))}const{parent:r}=e;r&&!r.hasCheckedOptimisedAppear&&uj(r)}function hj({attachResizeListener:e,defaultParent:t,measureScroll:n,checkIsScrollRoot:r,resetTransform:a}){return class{constructor(s={},c=t==null?void 0:t()){this.id=IB++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(_B),this.nodes.forEach(LB),this.nodes.forEach(zB),this.nodes.forEach(NB)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=s,this.root=c?c.root||c:this,this.path=c?[...c.path,c]:[],this.parent=c,this.depth=c?c.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new AB)}addEventListener(s,c){return this.eventHandlers.has(s)||this.eventHandlers.set(s,new xS),this.eventHandlers.get(s).add(c)}notifyListeners(s,...c){const l=this.eventHandlers.get(s);l&&l.notify(...c)}hasListeners(s){return this.eventHandlers.has(s)}mount(s){if(this.instance)return;this.isSVG=LS(s)&&!F9(s),this.instance=s;const{layoutId:c,layout:l,visualElement:d}=this.options;if(d&&!d.current&&d.mount(s),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(l||c)&&(this.isLayoutDirty=!0),e){let u,h=0;const m=()=>this.root.updateBlockedByResize=!1;ra.read(()=>{h=window.innerWidth}),e(s,()=>{const f=window.innerWidth;f!==h&&(h=f,this.root.updateBlockedByResize=!0,u&&u(),u=jB(m,250),F5.hasAnimatedSinceResize&&(F5.hasAnimatedSinceResize=!1,this.nodes.forEach(e4)))})}c&&this.root.registerSharedNode(c,this),this.options.animate!==!1&&d&&(c||l)&&this.addEventListener("didUpdate",({delta:u,hasLayoutChanged:h,hasRelativeLayoutChanged:m,layout:f})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const g=this.options.transition||d.getDefaultTransition()||WB,{onLayoutAnimationStart:x,onLayoutAnimationComplete:v}=d.getProps(),b=!this.targetLayout||!lj(this.targetLayout,f),w=!h&&m;if(this.options.layoutRoot||this.resumeFrom||w||h&&(b||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const M={...IS(g,"layout"),onPlay:x,onComplete:v};(d.shouldReduceMotion||this.options.layoutRoot)&&(M.delay=0,M.type=!1),this.startAnimation(M),this.setAnimationOrigin(u,w)}else h||e4(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=f})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const s=this.getStack();s&&s.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),A0(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(BB),this.animationId++)}getTransformTemplate(){const{visualElement:s}=this.options;return s&&s.getProps().transformTemplate}willUpdate(s=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&uj(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const h=this.path[u];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:c,layout:l}=this.options;if(c===void 0&&!l)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),s&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(Q8);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(Z8);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(DB),this.nodes.forEach(PB),this.nodes.forEach(FB)):this.nodes.forEach(Z8),this.clearAllSnapshots();const c=hi.now();Ls.delta=Nc(0,1e3/60,c-Ls.timestamp),Ls.timestamp=c,Ls.isProcessing=!0,D2.update.process(Ls),D2.preRender.process(Ls),D2.render.process(Ls),Ls.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,OS.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(OB),this.sharedNodes.forEach($B)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,ra.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){ra.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!fi(this.snapshot.measuredBox.x)&&!fi(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const s=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=us(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:c}=this.options;c&&c.notify("LayoutMeasure",this.layout.layoutBox,s?s.layoutBox:void 0)}updateScroll(s="measure"){let c=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===s&&(c=!1),c&&this.instance){const l=r(this.instance);this.scroll={animationId:this.root.animationId,phase:s,isRoot:l,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:l}}}resetTransform(){if(!a)return;const s=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,c=this.projectionDelta&&!ij(this.projectionDelta),l=this.getTransformTemplate(),d=l?l(this.latestValues,""):void 0,u=d!==this.prevTransformTemplateValue;s&&this.instance&&(c||hu(this.latestValues)||u)&&(a(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(s=!0){const c=this.measurePageBox();let l=this.removeElementScroll(c);return s&&(l=this.removeTransform(l)),GB(l),{animationId:this.root.animationId,measuredBox:c,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){var d;const{visualElement:s}=this.options;if(!s)return us();const c=s.measureViewportBox();if(!(((d=this.scroll)==null?void 0:d.wasRoot)||this.path.some(VB))){const{scroll:u}=this.root;u&&(Zh(c.x,u.offset.x),Zh(c.y,u.offset.y))}return c}removeElementScroll(s){var l;const c=us();if(Hl(c,s),(l=this.scroll)!=null&&l.wasRoot)return c;for(let d=0;d<this.path.length;d++){const u=this.path[d],{scroll:h,options:m}=u;u!==this.root&&h&&m.layoutScroll&&(h.wasRoot&&Hl(c,s),Zh(c.x,h.offset.x),Zh(c.y,h.offset.y))}return c}applyTransform(s,c=!1){const l=us();Hl(l,s);for(let d=0;d<this.path.length;d++){const u=this.path[d];!c&&u.options.layoutScroll&&u.scroll&&u!==u.root&&ef(l,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),hu(u.latestValues)&&ef(l,u.latestValues)}return hu(this.latestValues)&&ef(l,this.latestValues),l}removeTransform(s){const c=us();Hl(c,s);for(let l=0;l<this.path.length;l++){const d=this.path[l];if(!d.instance||!hu(d.latestValues))continue;kv(d.latestValues)&&d.updateSnapshot();const u=us(),h=d.measurePageBox();Hl(u,h),H8(c,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,u)}return hu(this.latestValues)&&H8(c,this.latestValues),c}setTargetDelta(s){this.targetDelta=s,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(s){this.options={...this.options,...s,crossfade:s.crossfade!==void 0?s.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ls.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(s=!1){var f;const c=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=c.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=c.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=c.isSharedProjectionDirty);const l=!!this.resumingFrom||this!==c;if(!(s||l&&this.isSharedProjectionDirty||this.isProjectionDirty||(f=this.parent)!=null&&f.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:u,layoutId:h}=this.options;if(!this.layout||!(u||h))return;this.resolvedRelativeTargetAt=Ls.timestamp;const m=this.getClosestProjectingParent();m&&this.linkedParentVersion!==m.layoutVersion&&!m.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(m&&m.layout?this.createRelativeTarget(m,this.layout.layoutBox,m.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=us(),this.targetWithTransforms=us()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),mB(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Hl(this.target,this.layout.layoutBox),KA(this.target,this.targetDelta)):Hl(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,m&&!!m.resumingFrom==!!this.resumingFrom&&!m.options.layoutScroll&&m.target&&this.animationProgress!==1?this.createRelativeTarget(m,this.target,m.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||kv(this.parent.latestValues)||YA(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(s,c,l){this.relativeParent=s,this.linkedParentVersion=s.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=us(),this.relativeTargetOrigin=us(),ly(this.relativeTargetOrigin,c,l),Hl(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){var g;const s=this.getLead(),c=!!this.resumingFrom||this!==s;let l=!0;if((this.isProjectionDirty||(g=this.parent)!=null&&g.isProjectionDirty)&&(l=!1),c&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(l=!1),this.resolvedRelativeTargetAt===Ls.timestamp&&(l=!1),l)return;const{layout:d,layoutId:u}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(d||u))return;Hl(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,m=this.treeScale.y;W9(this.layoutCorrected,this.treeScale,this.path,c),s.layout&&!s.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(s.target=s.layout.layoutBox,s.targetWithTransforms=us());const{target:f}=s;if(!f){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(D8(this.prevProjectionDelta.x,this.projectionDelta.x),D8(this.prevProjectionDelta.y,this.projectionDelta.y)),Hp(this.projectionDelta,this.layoutCorrected,f,this.latestValues),(this.treeScale.x!==h||this.treeScale.y!==m||!Y8(this.projectionDelta.x,this.prevProjectionDelta.x)||!Y8(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",f))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(s=!0){var c;if((c=this.options.visualElement)==null||c.scheduleRender(),s){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Qh(),this.projectionDelta=Qh(),this.projectionDeltaWithTransform=Qh()}setAnimationOrigin(s,c=!1){const l=this.snapshot,d=l?l.latestValues:{},u={...this.latestValues},h=Qh();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!c;const m=us(),f=l?l.source:void 0,g=this.layout?this.layout.source:void 0,x=f!==g,v=this.getStack(),b=!v||v.members.length<=1,w=!!(x&&!b&&this.options.crossfade===!0&&!this.path.some(HB));this.animationProgress=0;let M;this.mixTargetDelta=k=>{const R=k/1e3;t4(h.x,s.x,R),t4(h.y,s.y,R),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(ly(m,this.layout.layoutBox,this.relativeParent.layout.layoutBox),qB(this.relativeTarget,this.relativeTargetOrigin,m,R),M&&xB(this.relativeTarget,M)&&(this.isProjectionDirty=!1),M||(M=us()),Hl(M,this.relativeTarget)),x&&(this.animationValues=u,wB(u,d,this.latestValues,R,w,b)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=R},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(s){var c,l,d;this.notifyListeners("animationStart"),(c=this.currentAnimation)==null||c.stop(),(d=(l=this.resumingFrom)==null?void 0:l.currentAnimation)==null||d.stop(),this.pendingAnimation&&(A0(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=ra.update(()=>{F5.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=Mf(0)),this.motionValue.jump(0,!1),this.currentAnimation=kB(this.motionValue,[0,1e3],{...s,velocity:0,isSync:!0,onUpdate:u=>{this.mixTargetDelta(u),s.onUpdate&&s.onUpdate(u)},onStop:()=>{},onComplete:()=>{s.onComplete&&s.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const s=this.getStack();s&&s.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(TB),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const s=this.getLead();let{targetWithTransforms:c,target:l,layout:d,latestValues:u}=s;if(!(!c||!l||!d)){if(this!==s&&this.layout&&d&&fj(this.options.animationType,this.layout.layoutBox,d.layoutBox)){l=this.target||us();const h=fi(this.layout.layoutBox.x);l.x.min=s.target.x.min,l.x.max=l.x.min+h;const m=fi(this.layout.layoutBox.y);l.y.min=s.target.y.min,l.y.max=l.y.min+m}Hl(c,l),ef(c,u),Hp(this.projectionDeltaWithTransform,this.layoutCorrected,c,u)}}registerSharedNode(s,c){this.sharedNodes.has(s)||this.sharedNodes.set(s,new EB),this.sharedNodes.get(s).add(c);const d=c.options.initialPromotionConfig;c.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(c):void 0})}isLead(){const s=this.getStack();return s?s.lead===this:!0}getLead(){var c;const{layoutId:s}=this.options;return s?((c=this.getStack())==null?void 0:c.lead)||this:this}getPrevLead(){var c;const{layoutId:s}=this.options;return s?(c=this.getStack())==null?void 0:c.prevLead:void 0}getStack(){const{layoutId:s}=this.options;if(s)return this.root.sharedNodes.get(s)}promote({needsReset:s,transition:c,preserveFollowOpacity:l}={}){const d=this.getStack();d&&d.promote(this,l),s&&(this.projectionDelta=void 0,this.needsReset=!0),c&&this.setOptions({transition:c})}relegate(){const s=this.getStack();return s?s.relegate(this):!1}resetSkewAndRotation(){const{visualElement:s}=this.options;if(!s)return;let c=!1;const{latestValues:l}=s;if((l.z||l.rotate||l.rotateX||l.rotateY||l.rotateZ||l.skewX||l.skewY)&&(c=!0),!c)return;const d={};l.z&&V2("z",s,d,this.animationValues);for(let u=0;u<G2.length;u++)V2(`rotate${G2[u]}`,s,d,this.animationValues),V2(`skew${G2[u]}`,s,d,this.animationValues);s.render();for(const u in d)s.setStaticValue(u,d[u]),this.animationValues&&(this.animationValues[u]=d[u]);s.scheduleRender()}applyProjectionStyles(s,c){if(!this.instance||this.isSVG)return;if(!this.isVisible){s.visibility="hidden";return}const l=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,s.visibility="",s.opacity="",s.pointerEvents=P5(c==null?void 0:c.pointerEvents)||"",s.transform=l?l(this.latestValues,""):"none";return}const d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){this.options.layoutId&&(s.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,s.pointerEvents=P5(c==null?void 0:c.pointerEvents)||""),this.hasProjected&&!hu(this.latestValues)&&(s.transform=l?l({},""):"none",this.hasProjected=!1);return}s.visibility="";const u=d.animationValues||d.latestValues;this.applyTransformsToTarget();let h=vB(this.projectionDeltaWithTransform,this.treeScale,u);l&&(h=l(u,h)),s.transform=h;const{x:m,y:f}=this.projectionDelta;s.transformOrigin=`${m.origin*100}% ${f.origin*100}% 0`,d.animationValues?s.opacity=d===this?u.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:u.opacityExit:s.opacity=d===this?u.opacity!==void 0?u.opacity:"":u.opacityExit!==void 0?u.opacityExit:0;for(const g in Av){if(u[g]===void 0)continue;const{correct:x,applyTo:v,isCSSVariable:b}=Av[g],w=h==="none"?u[g]:x(u[g],d);if(v){const M=v.length;for(let k=0;k<M;k++)s[v[k]]=w}else b?this.options.visualElement.renderState.vars[g]=w:s[g]=w}this.options.layoutId&&(s.pointerEvents=d===this?P5(c==null?void 0:c.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(s=>{var c;return(c=s.currentAnimation)==null?void 0:c.stop()}),this.root.nodes.forEach(Q8),this.root.sharedNodes.clear()}}}function PB(e){e.updateLayout()}function FB(e){var n;const t=((n=e.resumeFrom)==null?void 0:n.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){const{layoutBox:r,measuredBox:a}=e.layout,{animationType:i}=e.options,s=t.source!==e.layout.source;i==="size"?Ac(h=>{const m=s?t.measuredBox[h]:t.layoutBox[h],f=fi(m);m.min=r[h].min,m.max=m.min+f}):fj(i,t.layoutBox,r)&&Ac(h=>{const m=s?t.measuredBox[h]:t.layoutBox[h],f=fi(r[h]);m.max=m.min+f,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[h].max=e.relativeTarget[h].min+f)});const c=Qh();Hp(c,r,t.layoutBox);const l=Qh();s?Hp(l,e.applyTransform(a,!0),t.measuredBox):Hp(l,r,t.layoutBox);const d=!ij(c);let u=!1;if(!e.resumeFrom){const h=e.getClosestProjectingParent();if(h&&!h.resumeFrom){const{snapshot:m,layout:f}=h;if(m&&f){const g=us();ly(g,t.layoutBox,m.layoutBox);const x=us();ly(x,r,f.layoutBox),lj(g,x)||(u=!0),h.options.layoutRoot&&(e.relativeTarget=x,e.relativeTargetOrigin=g,e.relativeParent=h)}}}e.notifyListeners("didUpdate",{layout:r,snapshot:t,delta:l,layoutDelta:c,hasLayoutChanged:d,hasRelativeLayoutChanged:u})}else if(e.isLead()){const{onExitComplete:r}=e.options;r&&r()}e.options.transition=void 0}function _B(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function NB(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function OB(e){e.clearSnapshot()}function Q8(e){e.clearMeasurements()}function Z8(e){e.isLayoutDirty=!1}function DB(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function e4(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function LB(e){e.resolveTargetDelta()}function zB(e){e.calcProjection()}function BB(e){e.resetSkewAndRotation()}function $B(e){e.removeLeadSnapshot()}function t4(e,t,n){e.translate=Aa(t.translate,0,n),e.scale=Aa(t.scale,1,n),e.origin=t.origin,e.originPoint=t.originPoint}function n4(e,t,n,r){e.min=Aa(t.min,n.min,r),e.max=Aa(t.max,n.max,r)}function qB(e,t,n,r){n4(e.x,t.x,n.x,r),n4(e.y,t.y,n.y,r)}function HB(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const WB={duration:.45,ease:[.4,0,.1,1]},r4=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),o4=r4("applewebkit/")&&!r4("chrome/")?Math.round:Tl;function a4(e){e.min=o4(e.min),e.max=o4(e.max)}function GB(e){a4(e.x),a4(e.y)}function fj(e,t,n){return e==="position"||e==="preserve-aspect"&&!pB(U8(t),U8(n),.2)}function VB(e){var t;return e!==e.root&&((t=e.scroll)==null?void 0:t.wasRoot)}const UB=hj({attachResizeListener:(e,t)=>dm(e,"resize",t),measureScroll:()=>{var e,t;return{x:document.documentElement.scrollLeft||((e=document.body)==null?void 0:e.scrollLeft)||0,y:document.documentElement.scrollTop||((t=document.body)==null?void 0:t.scrollTop)||0}},checkIsScrollRoot:()=>!0}),U2={current:void 0},pj=hj({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!U2.current){const e=new UB({});e.mount(window),e.setOptions({layoutScroll:!0}),U2.current=e}return U2.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),HS=S.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});function s4(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function YB(...e){return t=>{let n=!1;const r=e.map(a=>{const i=s4(a,t);return!n&&typeof i=="function"&&(n=!0),i});if(n)return()=>{for(let a=0;a<r.length;a++){const i=r[a];typeof i=="function"?i():s4(e[a],null)}}}}function KB(...e){return S.useCallback(YB(...e),e)}class XB extends S.Component{getSnapshotBeforeUpdate(t){const n=this.props.childRef.current;if(n&&t.isPresent&&!this.props.isPresent&&this.props.pop!==!1){const r=n.offsetParent,a=Mv(r)&&r.offsetWidth||0,i=Mv(r)&&r.offsetHeight||0,s=this.props.sizeRef.current;s.height=n.offsetHeight||0,s.width=n.offsetWidth||0,s.top=n.offsetTop,s.left=n.offsetLeft,s.right=a-s.width-s.left,s.bottom=i-s.height-s.top}return null}componentDidUpdate(){}render(){return this.props.children}}function JB({children:e,isPresent:t,anchorX:n,anchorY:r,root:a,pop:i}){var m;const s=S.useId(),c=S.useRef(null),l=S.useRef({width:0,height:0,top:0,left:0,right:0,bottom:0}),{nonce:d}=S.useContext(HS),u=((m=e.props)==null?void 0:m.ref)??(e==null?void 0:e.ref),h=KB(c,u);return S.useInsertionEffect(()=>{const{width:f,height:g,top:x,left:v,right:b,bottom:w}=l.current;if(t||i===!1||!c.current||!f||!g)return;const M=n==="left"?`left: ${v}`:`right: ${b}`,k=r==="bottom"?`bottom: ${w}`:`top: ${x}`;c.current.dataset.motionPopId=s;const R=document.createElement("style");d&&(R.nonce=d);const j=a??document.head;return j.appendChild(R),R.sheet&&R.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${f}px !important;
            height: ${g}px !important;
            ${M}px !important;
            ${k}px !important;
          }
        `),()=>{j.contains(R)&&j.removeChild(R)}},[t]),o.jsx(XB,{isPresent:t,childRef:c,sizeRef:l,pop:i,children:i===!1?e:S.cloneElement(e,{ref:h})})}const QB=({children:e,initial:t,isPresent:n,onExitComplete:r,custom:a,presenceAffectsLayout:i,mode:s,anchorX:c,anchorY:l,root:d})=>{const u=gS(ZB),h=S.useId();let m=!0,f=S.useMemo(()=>(m=!1,{id:h,initial:t,isPresent:n,custom:a,onExitComplete:g=>{u.set(g,!0);for(const x of u.values())if(!x)return;r&&r()},register:g=>(u.set(g,!1),()=>u.delete(g))}),[n,u,r]);return i&&m&&(f={...f}),S.useMemo(()=>{u.forEach((g,x)=>u.set(x,!1))},[n]),S.useEffect(()=>{!n&&!u.size&&r&&r()},[n]),e=o.jsx(JB,{pop:s==="popLayout",isPresent:n,anchorX:c,anchorY:l,root:d,children:e}),o.jsx(qy.Provider,{value:f,children:e})};function ZB(){return new Map}function mj(e=!0){const t=S.useContext(qy);if(t===null)return[!0,null];const{isPresent:n,onExitComplete:r,register:a}=t,i=S.useId();S.useEffect(()=>{if(e)return a(i)},[e]);const s=S.useCallback(()=>e&&r&&r(i),[i,r,e]);return!n&&r?[!1,s]:[!0]}const Fg=e=>e.key||"";function i4(e){const t=[];return S.Children.forEach(e,n=>{S.isValidElement(n)&&t.push(n)}),t}const x0=({children:e,custom:t,initial:n=!0,onExitComplete:r,presenceAffectsLayout:a=!0,mode:i="sync",propagate:s=!1,anchorX:c="left",anchorY:l="top",root:d})=>{const[u,h]=mj(s),m=S.useMemo(()=>i4(e),[e]),f=s&&!u?[]:m.map(Fg),g=S.useRef(!0),x=S.useRef(m),v=gS(()=>new Map),b=S.useRef(new Set),[w,M]=S.useState(m),[k,R]=S.useState(m);HR(()=>{g.current=!1,x.current=m;for(let E=0;E<k.length;E++){const O=Fg(k[E]);f.includes(O)?(v.delete(O),b.current.delete(O)):v.get(O)!==!0&&v.set(O,!1)}},[k,f.length,f.join("-")]);const j=[];if(m!==w){let E=[...m];for(let O=0;O<k.length;O++){const L=k[O],$=Fg(L);f.includes($)||(E.splice(O,0,L),j.push(L))}return i==="wait"&&j.length&&(E=j),R(i4(E)),M(m),null}const{forceRender:I}=S.useContext(mS);return o.jsx(o.Fragment,{children:k.map(E=>{const O=Fg(E),L=s&&!u?!1:m===k||f.includes(O),$=()=>{if(b.current.has(O))return;if(b.current.add(O),v.has(O))v.set(O,!0);else return;let F=!0;v.forEach(B=>{B||(F=!1)}),F&&(I==null||I(),R(x.current),s&&(h==null||h()),r&&r())};return o.jsx(QB,{isPresent:L,initial:!g.current||n?void 0:!1,custom:t,presenceAffectsLayout:a,mode:i,root:d,onExitComplete:L?void 0:$,anchorX:c,anchorY:l,children:E},O)})})},gj=S.createContext({strict:!1}),l4={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]};let c4=!1;function e$(){if(c4)return;const e={};for(const t in l4)e[t]={isEnabled:n=>l4[t].some(r=>!!n[r])};GA(e),c4=!0}function yj(){return e$(),B9()}function t$(e){const t=yj();for(const n in e)t[n]={...t[n],...e[n]};GA(t)}const n$=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","propagate","ignoreStrict","viewport"]);function cy(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||n$.has(e)}let bj=e=>!cy(e);function r$(e){typeof e=="function"&&(bj=t=>t.startsWith("on")?!cy(t):e(t))}try{r$(require("@emotion/is-prop-valid").default)}catch{}function o$(e,t,n){const r={};for(const a in e)a==="values"&&typeof e.values=="object"||(bj(a)||n===!0&&cy(a)||!t&&!cy(a)||e.draggable&&a.startsWith("onDrag"))&&(r[a]=e[a]);return r}const Gy=S.createContext({});function a$(e,t){if(Wy(e)){const{initial:n,animate:r}=e;return{initial:n===!1||cm(n)?n:void 0,animate:cm(r)?r:void 0}}return e.inherit!==!1?t:{}}function s$(e){const{initial:t,animate:n}=a$(e,S.useContext(Gy));return S.useMemo(()=>({initial:t,animate:n}),[d4(t),d4(n)])}function d4(e){return Array.isArray(e)?e.join(" "):e}const WS=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function xj(e,t,n){for(const r in t)!Xs(t[r])&&!QA(r,n)&&(e[r]=t[r])}function i$({transformTemplate:e},t){return S.useMemo(()=>{const n=WS();return $S(n,t,e),Object.assign({},n.vars,n.style)},[t])}function l$(e,t){const n=e.style||{},r={};return xj(r,n,e),Object.assign(r,i$(e,t)),r}function c$(e,t){const n={},r=l$(e,t);return e.drag&&e.dragListener!==!1&&(n.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(n.tabIndex=0),n.style=r,n}const vj=()=>({...WS(),attrs:{}});function d$(e,t,n,r){const a=S.useMemo(()=>{const i=vj();return ZA(i,t,tj(r),e.transformTemplate,e.style),{...i.attrs,style:{...i.style}}},[t]);if(e.style){const i={};xj(i,e.style,e),a.style={...i,...a.style}}return a}const u$=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function GS(e){return typeof e!="string"||e.includes("-")?!1:!!(u$.indexOf(e)>-1||/[A-Z]/u.test(e))}function h$(e,t,n,{latestValues:r},a,i=!1,s){const l=(s??GS(e)?d$:c$)(t,r,a,e),d=o$(t,typeof e=="string",i),u=e!==S.Fragment?{...d,...l,ref:n}:{},{children:h}=t,m=S.useMemo(()=>Xs(h)?h.get():h,[h]);return S.createElement(e,{...u,children:m})}function f$({scrapeMotionValuesFromProps:e,createRenderState:t},n,r,a){return{latestValues:p$(n,r,a,e),renderState:t()}}function p$(e,t,n,r){const a={},i=r(e,{});for(const m in i)a[m]=P5(i[m]);let{initial:s,animate:c}=e;const l=Wy(e),d=HA(e);t&&d&&!l&&e.inherit!==!1&&(s===void 0&&(s=t.initial),c===void 0&&(c=t.animate));let u=n?n.initial===!1:!1;u=u||s===!1;const h=u?c:s;if(h&&typeof h!="boolean"&&!Hy(h)){const m=Array.isArray(h)?h:[h];for(let f=0;f<m.length;f++){const g=FS(e,m[f]);if(g){const{transitionEnd:x,transition:v,...b}=g;for(const w in b){let M=b[w];if(Array.isArray(M)){const k=u?M.length-1:0;M=M[k]}M!==null&&(a[w]=M)}for(const w in x)a[w]=x[w]}}}return a}const Sj=e=>(t,n)=>{const r=S.useContext(Gy),a=S.useContext(qy),i=()=>f$(e,t,r,a);return n?i():gS(i)},m$=Sj({scrapeMotionValuesFromProps:qS,createRenderState:WS}),g$=Sj({scrapeMotionValuesFromProps:nj,createRenderState:vj}),y$=Symbol.for("motionComponentSymbol");function b$(e,t,n){const r=S.useRef(n);S.useInsertionEffect(()=>{r.current=n});const a=S.useRef(null);return S.useCallback(i=>{var c;i&&((c=e.onMount)==null||c.call(e,i)),t&&(i?t.mount(i):t.unmount());const s=r.current;if(typeof s=="function")if(i){const l=s(i);typeof l=="function"&&(a.current=l)}else a.current?(a.current(),a.current=null):s(i);else s&&(s.current=i)},[t])}const wj=S.createContext({});function Hh(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function x$(e,t,n,r,a,i){var M,k;const{visualElement:s}=S.useContext(Gy),c=S.useContext(gj),l=S.useContext(qy),d=S.useContext(HS),u=d.reducedMotion,h=d.skipAnimations,m=S.useRef(null),f=S.useRef(!1);r=r||c.renderer,!m.current&&r&&(m.current=r(e,{visualState:t,parent:s,props:n,presenceContext:l,blockInitialAnimation:l?l.initial===!1:!1,reducedMotionConfig:u,skipAnimations:h,isSVG:i}),f.current&&m.current&&(m.current.manuallyAnimateOnMount=!0));const g=m.current,x=S.useContext(wj);g&&!g.projection&&a&&(g.type==="html"||g.type==="svg")&&v$(m.current,n,a,x);const v=S.useRef(!1);S.useInsertionEffect(()=>{g&&v.current&&g.update(n,l)});const b=n[TA],w=S.useRef(!!b&&!((M=window.MotionHandoffIsComplete)!=null&&M.call(window,b))&&((k=window.MotionHasOptimisedAnimation)==null?void 0:k.call(window,b)));return HR(()=>{f.current=!0,g&&(v.current=!0,window.MotionIsMounted=!0,g.updateFeatures(),g.scheduleRenderMicrotask(),w.current&&g.animationState&&g.animationState.animateChanges())}),S.useEffect(()=>{g&&(!w.current&&g.animationState&&g.animationState.animateChanges(),w.current&&(queueMicrotask(()=>{var R;(R=window.MotionHandoffMarkAsComplete)==null||R.call(window,b)}),w.current=!1),g.enteringChildren=void 0)}),g}function v$(e,t,n,r){const{layoutId:a,layout:i,drag:s,dragConstraints:c,layoutScroll:l,layoutRoot:d,layoutCrossfade:u}=t;e.projection=new n(e.latestValues,t["data-framer-portal-id"]?void 0:Mj(e.parent)),e.projection.setOptions({layoutId:a,layout:i,alwaysMeasureLayout:!!s||c&&Hh(c),visualElement:e,animationType:typeof i=="string"?i:"both",initialPromotionConfig:r,crossfade:u,layoutScroll:l,layoutRoot:d})}function Mj(e){if(e)return e.options.allowProjection!==!1?e.projection:Mj(e.parent)}function Y2(e,{forwardMotionProps:t=!1,type:n}={},r,a){r&&t$(r);const i=n?n==="svg":GS(e),s=i?g$:m$;function c(d,u){let h;const m={...S.useContext(HS),...d,layoutId:S$(d)},{isStatic:f}=m,g=s$(d),x=s(d,f);if(!f&&qR){w$();const v=M$(m);h=v.MeasureLayout,g.visualElement=x$(e,x,m,a,v.ProjectionNode,i)}return o.jsxs(Gy.Provider,{value:g,children:[h&&g.visualElement?o.jsx(h,{visualElement:g.visualElement,...m}):null,h$(e,d,b$(x,g.visualElement,u),x,f,t,i)]})}c.displayName=`motion.${typeof e=="string"?e:`create(${e.displayName??e.name??""})`}`;const l=S.forwardRef(c);return l[y$]=e,l}function S$({layoutId:e}){const t=S.useContext(mS).id;return t&&e!==void 0?t+"-"+e:e}function w$(e,t){S.useContext(gj).strict}function M$(e){const t=yj(),{drag:n,layout:r}=t;if(!n&&!r)return{};const a={...n,...r};return{MeasureLayout:n!=null&&n.isEnabled(e)||r!=null&&r.isEnabled(e)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}function C$(e,t){if(typeof Proxy>"u")return Y2;const n=new Map,r=(i,s)=>Y2(i,s,e,t),a=(i,s)=>r(i,s);return new Proxy(a,{get:(i,s)=>s==="create"?r:(n.has(s)||n.set(s,Y2(s,void 0,e,t)),n.get(s))})}const k$=(e,t)=>t.isSVG??GS(e)?new rB(t):new J9(t,{allowProjection:e!==S.Fragment});class R$ extends j0{constructor(t){super(t),t.animationState||(t.animationState=lB(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();Hy(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:n}=this.node.prevProps||{};t!==n&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)==null||t.call(this)}}let A$=0;class j$ extends j0{constructor(){super(...arguments),this.id=A$++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:n}=this.node.presenceContext,{isPresent:r}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===r)return;const a=this.node.animationState.setActive("exit",!t);n&&!t&&a.then(()=>{n(this.id)})}mount(){const{register:t,onExitComplete:n}=this.node.presenceContext||{};n&&n(this.id),t&&(this.unmount=t(this.id))}unmount(){}}const E$={animation:{Feature:R$},exit:{Feature:j$}};function Cm(e){return{point:{x:e.pageX,y:e.pageY}}}const T$=e=>t=>DS(t)&&e(t,Cm(t));function Wp(e,t,n,r){return dm(e,t,T$(n),r)}const Cj=({current:e})=>e?e.ownerDocument.defaultView:null,u4=(e,t)=>Math.abs(e-t);function I$(e,t){const n=u4(e.x,t.x),r=u4(e.y,t.y);return Math.sqrt(n**2+r**2)}const h4=new Set(["auto","scroll"]);class kj{constructor(t,n,{transformPagePoint:r,contextWindow:a=window,dragSnapToOrigin:i=!1,distanceThreshold:s=3,element:c}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.scrollPositions=new Map,this.removeScrollListeners=null,this.onElementScroll=f=>{this.handleScroll(f.target)},this.onWindowScroll=()=>{this.handleScroll(window)},this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const f=X2(this.lastMoveEventInfo,this.history),g=this.startEvent!==null,x=I$(f.offset,{x:0,y:0})>=this.distanceThreshold;if(!g&&!x)return;const{point:v}=f,{timestamp:b}=Ls;this.history.push({...v,timestamp:b});const{onStart:w,onMove:M}=this.handlers;g||(w&&w(this.lastMoveEvent,f),this.startEvent=this.lastMoveEvent),M&&M(this.lastMoveEvent,f)},this.handlePointerMove=(f,g)=>{this.lastMoveEvent=f,this.lastMoveEventInfo=K2(g,this.transformPagePoint),ra.update(this.updatePoint,!0)},this.handlePointerUp=(f,g)=>{this.end();const{onEnd:x,onSessionEnd:v,resumeAnimation:b}=this.handlers;if((this.dragSnapToOrigin||!this.startEvent)&&b&&b(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const w=X2(f.type==="pointercancel"?this.lastMoveEventInfo:K2(g,this.transformPagePoint),this.history);this.startEvent&&x&&x(f,w),v&&v(f,w)},!DS(t))return;this.dragSnapToOrigin=i,this.handlers=n,this.transformPagePoint=r,this.distanceThreshold=s,this.contextWindow=a||window;const l=Cm(t),d=K2(l,this.transformPagePoint),{point:u}=d,{timestamp:h}=Ls;this.history=[{...u,timestamp:h}];const{onSessionStart:m}=n;m&&m(t,X2(d,this.history)),this.removeListeners=Sm(Wp(this.contextWindow,"pointermove",this.handlePointerMove),Wp(this.contextWindow,"pointerup",this.handlePointerUp),Wp(this.contextWindow,"pointercancel",this.handlePointerUp)),c&&this.startScrollTracking(c)}startScrollTracking(t){let n=t.parentElement;for(;n;){const r=getComputedStyle(n);(h4.has(r.overflowX)||h4.has(r.overflowY))&&this.scrollPositions.set(n,{x:n.scrollLeft,y:n.scrollTop}),n=n.parentElement}this.scrollPositions.set(window,{x:window.scrollX,y:window.scrollY}),window.addEventListener("scroll",this.onElementScroll,{capture:!0}),window.addEventListener("scroll",this.onWindowScroll),this.removeScrollListeners=()=>{window.removeEventListener("scroll",this.onElementScroll,{capture:!0}),window.removeEventListener("scroll",this.onWindowScroll)}}handleScroll(t){const n=this.scrollPositions.get(t);if(!n)return;const r=t===window,a=r?{x:window.scrollX,y:window.scrollY}:{x:t.scrollLeft,y:t.scrollTop},i={x:a.x-n.x,y:a.y-n.y};i.x===0&&i.y===0||(r?this.lastMoveEventInfo&&(this.lastMoveEventInfo.point.x+=i.x,this.lastMoveEventInfo.point.y+=i.y):this.history.length>0&&(this.history[0].x-=i.x,this.history[0].y-=i.y),this.scrollPositions.set(t,a),ra.update(this.updatePoint,!0))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),this.removeScrollListeners&&this.removeScrollListeners(),this.scrollPositions.clear(),A0(this.updatePoint)}}function K2(e,t){return t?{point:t(e.point)}:e}function f4(e,t){return{x:e.x-t.x,y:e.y-t.y}}function X2({point:e},t){return{point:e,delta:f4(e,Rj(t)),offset:f4(e,P$(t)),velocity:F$(t,.1)}}function P$(e){return e[0]}function Rj(e){return e[e.length-1]}function F$(e,t){if(e.length<2)return{x:0,y:0};let n=e.length-1,r=null;const a=Rj(e);for(;n>=0&&(r=e[n],!(a.timestamp-r.timestamp>oc(t)));)n--;if(!r)return{x:0,y:0};r===e[0]&&e.length>2&&a.timestamp-r.timestamp>oc(t)*2&&(r=e[1]);const i=Rl(a.timestamp-r.timestamp);if(i===0)return{x:0,y:0};const s={x:(a.x-r.x)/i,y:(a.y-r.y)/i};return s.x===1/0&&(s.x=0),s.y===1/0&&(s.y=0),s}function _$(e,{min:t,max:n},r){return t!==void 0&&e<t?e=r?Aa(t,e,r.min):Math.max(e,t):n!==void 0&&e>n&&(e=r?Aa(n,e,r.max):Math.min(e,n)),e}function p4(e,t,n){return{min:t!==void 0?e.min+t:void 0,max:n!==void 0?e.max+n-(e.max-e.min):void 0}}function N$(e,{top:t,left:n,bottom:r,right:a}){return{x:p4(e.x,n,a),y:p4(e.y,t,r)}}function m4(e,t){let n=t.min-e.min,r=t.max-e.max;return t.max-t.min<e.max-e.min&&([n,r]=[r,n]),{min:n,max:r}}function O$(e,t){return{x:m4(e.x,t.x),y:m4(e.y,t.y)}}function D$(e,t){let n=.5;const r=fi(e),a=fi(t);return a>r?n=sm(t.min,t.max-r,e.min):r>a&&(n=sm(e.min,e.max-a,t.min)),Nc(0,1,n)}function L$(e,t){const n={};return t.min!==void 0&&(n.min=t.min-e.min),t.max!==void 0&&(n.max=t.max-e.min),n}const jv=.35;function z$(e=jv){return e===!1?e=0:e===!0&&(e=jv),{x:g4(e,"left","right"),y:g4(e,"top","bottom")}}function g4(e,t,n){return{min:y4(e,t),max:y4(e,n)}}function y4(e,t){return typeof e=="number"?e:e[t]||0}const B$=new WeakMap;class $${constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=us(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=t}start(t,{snapToCursor:n=!1,distanceThreshold:r}={}){const{presenceContext:a}=this.visualElement;if(a&&a.isPresent===!1)return;const i=h=>{n&&this.snapToCursor(Cm(h).point),this.stopAnimation()},s=(h,m)=>{const{drag:f,dragPropagation:g,onDragStart:x}=this.getProps();if(f&&!g&&(this.openDragLock&&this.openDragLock(),this.openDragLock=g9(f),!this.openDragLock))return;this.latestPointerEvent=h,this.latestPanInfo=m,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Ac(b=>{let w=this.getAxisMotionValue(b).get()||0;if(_c.test(w)){const{projection:M}=this.visualElement;if(M&&M.layout){const k=M.layout.layoutBox[b];k&&(w=fi(k)*(parseFloat(w)/100))}}this.originPoint[b]=w}),x&&ra.update(()=>x(h,m),!1,!0),xv(this.visualElement,"transform");const{animationState:v}=this.visualElement;v&&v.setActive("whileDrag",!0)},c=(h,m)=>{this.latestPointerEvent=h,this.latestPanInfo=m;const{dragPropagation:f,dragDirectionLock:g,onDirectionLock:x,onDrag:v}=this.getProps();if(!f&&!this.openDragLock)return;const{offset:b}=m;if(g&&this.currentDirection===null){this.currentDirection=H$(b),this.currentDirection!==null&&x&&x(this.currentDirection);return}this.updateAxis("x",m.point,b),this.updateAxis("y",m.point,b),this.visualElement.render(),v&&ra.update(()=>v(h,m),!1,!0)},l=(h,m)=>{this.latestPointerEvent=h,this.latestPanInfo=m,this.stop(h,m),this.latestPointerEvent=null,this.latestPanInfo=null},d=()=>{const{dragSnapToOrigin:h}=this.getProps();(h||this.constraints)&&this.startAnimation({x:0,y:0})},{dragSnapToOrigin:u}=this.getProps();this.panSession=new kj(t,{onSessionStart:i,onStart:s,onMove:c,onSessionEnd:l,resumeAnimation:d},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:u,distanceThreshold:r,contextWindow:Cj(this.visualElement),element:this.visualElement.current})}stop(t,n){const r=t||this.latestPointerEvent,a=n||this.latestPanInfo,i=this.isDragging;if(this.cancel(),!i||!a||!r)return;const{velocity:s}=a;this.startAnimation(s);const{onDragEnd:c}=this.getProps();c&&ra.postRender(()=>c(r,a))}cancel(){this.isDragging=!1;const{projection:t,animationState:n}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.endPanSession();const{dragPropagation:r}=this.getProps();!r&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}endPanSession(){this.panSession&&this.panSession.end(),this.panSession=void 0}updateAxis(t,n,r){const{drag:a}=this.getProps();if(!r||!_g(t,a,this.currentDirection))return;const i=this.getAxisMotionValue(t);let s=this.originPoint[t]+r[t];this.constraints&&this.constraints[t]&&(s=_$(s,this.constraints[t],this.elastic[t])),i.set(s)}resolveConstraints(){var i;const{dragConstraints:t,dragElastic:n}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(i=this.visualElement.projection)==null?void 0:i.layout,a=this.constraints;t&&Hh(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&r?this.constraints=N$(r.layoutBox,t):this.constraints=!1,this.elastic=z$(n),a!==this.constraints&&!Hh(t)&&r&&this.constraints&&!this.hasMutatedConstraints&&Ac(s=>{this.constraints!==!1&&this.getAxisMotionValue(s)&&(this.constraints[s]=L$(r.layoutBox[s],this.constraints[s]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:n}=this.getProps();if(!t||!Hh(t))return!1;const r=t.current,{projection:a}=this.visualElement;if(!a||!a.layout)return!1;const i=G9(r,a.root,this.visualElement.getTransformPagePoint());let s=O$(a.layout.layoutBox,i);if(n){const c=n(q9(s));this.hasMutatedConstraints=!!c,c&&(s=UA(c))}return s}startAnimation(t){const{drag:n,dragMomentum:r,dragElastic:a,dragTransition:i,dragSnapToOrigin:s,onDragTransitionEnd:c}=this.getProps(),l=this.constraints||{},d=Ac(u=>{if(!_g(u,n,this.currentDirection))return;let h=l&&l[u]||{};s&&(h={min:0,max:0});const m=a?200:1e6,f=a?40:1e7,g={type:"inertia",velocity:r?t[u]:0,bounceStiffness:m,bounceDamping:f,timeConstant:750,restDelta:1,restSpeed:10,...i,...h};return this.startAxisValueAnimation(u,g)});return Promise.all(d).then(c)}startAxisValueAnimation(t,n){const r=this.getAxisMotionValue(t);return xv(this.visualElement,t),r.start(PS(t,r,0,n,this.visualElement,!1))}stopAnimation(){Ac(t=>this.getAxisMotionValue(t).stop())}getAxisMotionValue(t){const n=`_drag${t.toUpperCase()}`,r=this.visualElement.getProps(),a=r[n];return a||this.visualElement.getValue(t,(r.initial?r.initial[t]:void 0)||0)}snapToCursor(t){Ac(n=>{const{drag:r}=this.getProps();if(!_g(n,r,this.currentDirection))return;const{projection:a}=this.visualElement,i=this.getAxisMotionValue(n);if(a&&a.layout){const{min:s,max:c}=a.layout.layoutBox[n],l=i.get()||0;i.set(t[n]-Aa(s,c,.5)+l)}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:n}=this.getProps(),{projection:r}=this.visualElement;if(!Hh(n)||!r||!this.constraints)return;this.stopAnimation();const a={x:0,y:0};Ac(s=>{const c=this.getAxisMotionValue(s);if(c&&this.constraints!==!1){const l=c.get();a[s]=D$({min:l,max:l},this.constraints[s])}});const{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.constraints=!1,this.resolveConstraints(),Ac(s=>{if(!_g(s,t,null))return;const c=this.getAxisMotionValue(s),{min:l,max:d}=this.constraints[s];c.set(Aa(l,d,a[s]))}),this.visualElement.render()}addListeners(){if(!this.visualElement.current)return;B$.set(this.visualElement,this);const t=this.visualElement.current,n=Wp(t,"pointerdown",d=>{const{drag:u,dragListener:h=!0}=this.getProps(),m=d.target,f=m!==t&&w9(m);u&&h&&!f&&this.start(d)});let r;const a=()=>{const{dragConstraints:d}=this.getProps();Hh(d)&&d.current&&(this.constraints=this.resolveRefConstraints(),r||(r=q$(t,d.current,()=>this.scalePositionWithinConstraints())))},{projection:i}=this.visualElement,s=i.addEventListener("measure",a);i&&!i.layout&&(i.root&&i.root.updateScroll(),i.updateLayout()),ra.read(a);const c=dm(window,"resize",()=>this.scalePositionWithinConstraints()),l=i.addEventListener("didUpdate",(({delta:d,hasLayoutChanged:u})=>{this.isDragging&&u&&(Ac(h=>{const m=this.getAxisMotionValue(h);m&&(this.originPoint[h]+=d[h].translate,m.set(m.get()+d[h].translate))}),this.visualElement.render())}));return()=>{c(),n(),s(),l&&l(),r&&r()}}getProps(){const t=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:r=!1,dragPropagation:a=!1,dragConstraints:i=!1,dragElastic:s=jv,dragMomentum:c=!0}=t;return{...t,drag:n,dragDirectionLock:r,dragPropagation:a,dragConstraints:i,dragElastic:s,dragMomentum:c}}}function b4(e){let t=!0;return()=>{if(t){t=!1;return}e()}}function q$(e,t,n){const r=k8(e,b4(n)),a=k8(t,b4(n));return()=>{r(),a()}}function _g(e,t,n){return(t===!0||t===e)&&(n===null||n===e)}function H$(e,t=10){let n=null;return Math.abs(e.y)>t?n="y":Math.abs(e.x)>t&&(n="x"),n}class W$ extends j0{constructor(t){super(t),this.removeGroupControls=Tl,this.removeListeners=Tl,this.controls=new $$(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Tl}update(){const{dragControls:t}=this.node.getProps(),{dragControls:n}=this.node.prevProps||{};t!==n&&(this.removeGroupControls(),t&&(this.removeGroupControls=t.subscribe(this.controls)))}unmount(){this.removeGroupControls(),this.removeListeners(),this.controls.isDragging||this.controls.endPanSession()}}const J2=e=>(t,n)=>{e&&ra.update(()=>e(t,n),!1,!0)};class G$ extends j0{constructor(){super(...arguments),this.removePointerDownListener=Tl}onPointerDown(t){this.session=new kj(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Cj(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:n,onPan:r,onPanEnd:a}=this.node.getProps();return{onSessionStart:J2(t),onStart:J2(n),onMove:J2(r),onEnd:(i,s)=>{delete this.session,a&&ra.postRender(()=>a(i,s))}}}mount(){this.removePointerDownListener=Wp(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}let Q2=!1;class V$ extends S.Component{componentDidMount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:r,layoutId:a}=this.props,{projection:i}=t;i&&(n.group&&n.group.add(i),r&&r.register&&a&&r.register(i),Q2&&i.root.didUpdate(),i.addEventListener("animationComplete",()=>{this.safeToRemove()}),i.setOptions({...i.options,layoutDependency:this.props.layoutDependency,onExitComplete:()=>this.safeToRemove()})),F5.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:n,visualElement:r,drag:a,isPresent:i}=this.props,{projection:s}=r;return s&&(s.isPresent=i,t.layoutDependency!==n&&s.setOptions({...s.options,layoutDependency:n}),Q2=!0,a||t.layoutDependency!==n||n===void 0||t.isPresent!==i?s.willUpdate():this.safeToRemove(),t.isPresent!==i&&(i?s.promote():s.relegate()||ra.postRender(()=>{const c=s.getStack();(!c||!c.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),OS.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:r}=this.props,{projection:a}=t;Q2=!0,a&&(a.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(a),r&&r.deregister&&r.deregister(a))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function Aj(e){const[t,n]=mj(),r=S.useContext(mS);return o.jsx(V$,{...e,layoutGroup:r,switchLayoutGroup:S.useContext(wj),isPresent:t,safeToRemove:n})}const U$={pan:{Feature:G$},drag:{Feature:W$,ProjectionNode:pj,MeasureLayout:Aj}};function x4(e,t,n){const{props:r}=e;e.animationState&&r.whileHover&&e.animationState.setActive("whileHover",n==="Start");const a="onHover"+n,i=r[a];i&&ra.postRender(()=>i(t,Cm(t)))}class Y$ extends j0{mount(){const{current:t}=this.node;t&&(this.unmount=b9(t,(n,r)=>(x4(this.node,r,"Start"),a=>x4(this.node,a,"End"))))}unmount(){}}class K$ extends j0{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Sm(dm(this.node.current,"focus",()=>this.onFocus()),dm(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function v4(e,t,n){const{props:r}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&r.whileTap&&e.animationState.setActive("whileTap",n==="Start");const a="onTap"+(n==="End"?"":n),i=r[a];i&&ra.postRender(()=>i(t,Cm(t)))}class X$ extends j0{mount(){const{current:t}=this.node;if(!t)return;const{globalTapTarget:n,propagate:r}=this.node.props;this.unmount=C9(t,(a,i)=>(v4(this.node,i,"Start"),(s,{success:c})=>v4(this.node,s,c?"End":"Cancel")),{useGlobalTarget:n,stopPropagation:(r==null?void 0:r.tap)===!1})}unmount(){}}const Ev=new WeakMap,Z2=new WeakMap,J$=e=>{const t=Ev.get(e.target);t&&t(e)},Q$=e=>{e.forEach(J$)};function Z$({root:e,...t}){const n=e||document;Z2.has(n)||Z2.set(n,{});const r=Z2.get(n),a=JSON.stringify(t);return r[a]||(r[a]=new IntersectionObserver(Q$,{root:e,...t})),r[a]}function eq(e,t,n){const r=Z$(t);return Ev.set(e,n),r.observe(e),()=>{Ev.delete(e),r.unobserve(e)}}const tq={some:0,all:1};class nq extends j0{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:n,margin:r,amount:a="some",once:i}=t,s={root:n?n.current:void 0,rootMargin:r,threshold:typeof a=="number"?a:tq[a]},c=l=>{const{isIntersecting:d}=l;if(this.isInView===d||(this.isInView=d,i&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:u,onViewportLeave:h}=this.node.getProps(),m=d?u:h;m&&m(l)};return eq(this.node.current,s,c)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:n}=this.node;["amount","margin","root"].some(rq(t,n))&&this.startObserver()}unmount(){}}function rq({viewport:e={}},{viewport:t={}}={}){return n=>e[n]!==t[n]}const oq={inView:{Feature:nq},tap:{Feature:X$},focus:{Feature:K$},hover:{Feature:Y$}},aq={layout:{ProjectionNode:pj,MeasureLayout:Aj}},sq={...E$,...oq,...U$,...aq},$o=C$(sq,k$),S4="'Doto', monospace",Yc="'IBM Plex Mono', monospace",_s="#ffd400";function w4(e,t){const n=e.right+6,r=e.top+e.height/2,a=t.left+t.width/2,i=t.top+t.height/2,s=a-n,c=i-r,l=Math.sqrt(s*s+c*c)||1,d=s/l,u=c/l,h=14,m=6,f=a-d*h,g=i-u*h,x=-u,v=d,b=f+x*m,w=g+v*m,M=f-x*m,k=g-v*m;return{line:`M ${n} ${r} L ${a} ${i}`,head:`M ${a} ${i} L ${b} ${w} L ${M} ${k} Z`}}const iq=({guideState:e,onComplete:t,onSkip:n})=>{const[r,a]=S.useState(e.getProgress()),[i,s]=S.useState(null),[c,l]=S.useState(null),[d,u]=S.useState(null),[h,m]=S.useState(!1),f=S.useRef(null),g=e.getCurrentStep(),x=e.getSteps().length;S.useEffect(()=>e.subscribe(j=>{if(a(j),j.badges.length>r.badges.length){const I=j.badges[j.badges.length-1];s(I),setTimeout(()=>s(null),2400)}}),[e,r.badges.length]),S.useEffect(()=>{if(!(g!=null&&g.targetSelector)){l(null);return}try{const R=document.querySelector(g.targetSelector);l(R?R.getBoundingClientRect():null)}catch(R){console.error("[GuideOverlay] target rect failed",R),l(null)}},[g]),S.useEffect(()=>{if(h||!c){u(null);return}const R=()=>{f.current&&u(f.current.getBoundingClientRect())},j=requestAnimationFrame(()=>{requestAnimationFrame(R)});return()=>cancelAnimationFrame(j)},[c,h,g]);const v=()=>{e.nextStep()||t()},b=()=>{e.previousStep()},w=()=>{e.skipToEnd(),n()};if(!g)return null;const M=(r.currentStep+1)/x*100,k=g.actionType==="finish";return o.jsxs(o.Fragment,{children:[c&&d&&o.jsxs("svg",{style:{position:"fixed",inset:0,width:"100vw",height:"100vh",pointerEvents:"none",zIndex:98,transition:"opacity 0.3s ease"},"aria-hidden":!0,children:[o.jsx("defs",{children:o.jsxs("filter",{id:"guide-arrow-glow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[o.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"2",result:"blur"}),o.jsxs("feMerge",{children:[o.jsx("feMergeNode",{in:"blur"}),o.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),o.jsxs("g",{filter:"url(#guide-arrow-glow)",children:[o.jsx("path",{d:w4(d,c).line,fill:"none",stroke:_s,strokeWidth:"2.5",strokeLinecap:"round"}),o.jsx("path",{d:w4(d,c).head,fill:_s,stroke:"rgba(0,0,0,0.4)",strokeWidth:"1"})]})]}),c&&o.jsx("div",{style:{position:"fixed",zIndex:99,pointerEvents:"none",left:c.left-6,top:c.top-6,width:c.width+12,height:c.height+12,border:`2px dashed ${_s}`,borderRadius:6,boxShadow:`0 0 20px ${_s}40`,transition:"all 0.4s ease"}}),o.jsx(x0,{children:!h&&o.jsxs($o.div,{ref:f,initial:{opacity:0,y:12,x:0},animate:{opacity:1,y:0,x:0},exit:{opacity:0,y:12},transition:{duration:.35,ease:"easeOut"},style:{position:"fixed",bottom:20,left:20,zIndex:100,width:320,maxWidth:"calc(100vw - 40px)",background:"rgba(0,0,0,0.96)",border:"1px dashed rgba(255,255,255,0.08)",pointerEvents:"auto",backdropFilter:"blur(12px)"},children:[o.jsx("div",{style:{height:1,background:"rgba(255,255,255,0.04)"},children:o.jsx("div",{style:{height:"100%",width:`${M}%`,background:`linear-gradient(90deg, ${_s}60, ${_s})`,transition:"width 0.5s ease"}})}),o.jsxs("div",{style:{padding:"16px 18px 14px"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",marginBottom:10},children:[o.jsxs("div",{style:{flex:1},children:[o.jsx("h3",{style:{fontFamily:S4,fontSize:14,fontWeight:400,color:"rgba(255,255,255,0.85)",textTransform:"uppercase",letterSpacing:"0.06em",margin:0,lineHeight:1.2},children:g.title}),o.jsxs("div",{style:{fontFamily:Yc,fontSize:8,color:`${_s}70`,letterSpacing:"0.3em",textTransform:"uppercase",marginTop:4},children:[r.currentStep+1," / ",x]})]}),o.jsx("div",{style:{display:"flex",gap:3,marginTop:4,flexShrink:0},children:Array.from({length:Math.min(x,10)}).map((R,j)=>o.jsx("div",{style:{width:4,height:4,background:j<=r.currentStep?j===r.currentStep?_s:`${_s}60`:"rgba(255,255,255,0.08)",transition:"all 0.3s"}},j))})]}),o.jsx("p",{style:{fontFamily:Yc,fontSize:10,color:"rgba(255,255,255,0.5)",lineHeight:1.7,margin:"0 0 14px 0",textTransform:"uppercase",letterSpacing:"0.02em"},children:g.copy}),!k&&g.actionType!=="observe"&&o.jsx("div",{style:{fontFamily:Yc,fontSize:8,color:`${_s}60`,letterSpacing:"0.1em",textTransform:"uppercase",marginBottom:12,paddingTop:8,borderTop:"1px dashed rgba(255,255,255,0.04)"},children:g.actionType==="drag"&&" Experimente arrastar no canvas"}),o.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",paddingTop:10,borderTop:"1px dashed rgba(255,255,255,0.06)"},children:[r.currentStep>0&&o.jsx("button",{onClick:b,style:{padding:"6px 12px",background:"none",border:"1px dashed rgba(255,255,255,0.08)",color:"rgba(255,255,255,0.3)",fontFamily:Yc,fontSize:8,letterSpacing:"0.1em",textTransform:"uppercase",cursor:"pointer",transition:"all 0.15s"},children:""}),o.jsx("button",{onClick:v,style:{flex:1,padding:"7px 0",background:k?`${_s}12`:"rgba(255,255,255,0.03)",border:`1px dashed ${k?`${_s}35`:"rgba(255,255,255,0.08)"}`,color:k?`${_s}e0`:"rgba(255,255,255,0.55)",fontFamily:Yc,fontSize:9,letterSpacing:"0.12em",textTransform:"uppercase",cursor:"pointer",transition:"all 0.15s"},children:k?"Comear":"Prximo "}),!k&&o.jsx("button",{onClick:w,style:{padding:"6px 10px",background:"none",border:"none",color:"rgba(255,255,255,0.15)",fontFamily:Yc,fontSize:8,letterSpacing:"0.08em",textTransform:"uppercase",cursor:"pointer",transition:"all 0.15s"},children:"Pular"})]})]})]})}),h&&o.jsxs($o.button,{initial:{opacity:0},animate:{opacity:1},onClick:()=>m(!1),style:{position:"fixed",bottom:20,left:20,zIndex:100,padding:"6px 14px",background:"rgba(0,0,0,0.92)",border:`1px dashed ${_s}30`,cursor:"pointer",fontFamily:Yc,fontSize:8,color:`${_s}80`,letterSpacing:"0.15em",textTransform:"uppercase",display:"flex",alignItems:"center",gap:6},children:[o.jsx("span",{style:{fontSize:10},children:""}),"Guia ",r.currentStep+1,"/",x]}),!h&&o.jsx("button",{onClick:()=>m(!0),style:{position:"fixed",bottom:21,left:318,zIndex:101,width:18,height:18,background:"rgba(0,0,0,0.96)",border:"1px dashed rgba(255,255,255,0.08)",color:"rgba(255,255,255,0.2)",fontSize:8,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:Yc},title:"Minimizar guia",children:""}),o.jsx(x0,{children:i&&F2[i]&&o.jsxs($o.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},style:{position:"fixed",bottom:80,left:20,zIndex:102,background:"rgba(0,0,0,0.96)",border:`1px dashed ${_s}25`,padding:"10px 16px",display:"flex",alignItems:"center",gap:10},children:[o.jsx("span",{style:{fontSize:18},children:F2[i].icon}),o.jsxs("div",{children:[o.jsx("div",{style:{fontFamily:Yc,fontSize:7,color:`${_s}70`,letterSpacing:"0.2em",textTransform:"uppercase",marginBottom:2},children:"Emblema"}),o.jsx("div",{style:{fontFamily:S4,fontSize:12,color:"rgba(255,255,255,0.7)",textTransform:"uppercase",letterSpacing:"0.04em"},children:F2[i].name})]})]})})]})},M4="'Doto', monospace",G0="'IBM Plex Mono', monospace",gl="#ffd400",lq=({onStart:e,onSkip:t})=>{const[n,r]=S.useState(!1),[a,i]=S.useState(!1);return o.jsx("div",{style:{position:"fixed",inset:0,zIndex:100,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.75)",backdropFilter:"blur(6px)"},children:o.jsxs($o.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},transition:{duration:.6,ease:"easeOut"},style:{width:520,maxWidth:"92vw",background:"#000",border:"1px dashed rgba(255,255,255,0.08)",overflow:"hidden"},children:[o.jsx("div",{style:{height:1,background:`linear-gradient(90deg, transparent, ${gl}40, transparent)`}}),o.jsxs("div",{style:{padding:"40px 36px 32px"},children:[o.jsx("div",{style:{textAlign:"center",marginBottom:24},children:o.jsx("span",{style:{fontSize:28,opacity:.3},children:""})}),o.jsx("h2",{style:{fontFamily:M4,fontSize:28,fontWeight:300,textAlign:"center",color:"white",letterSpacing:"0.04em",textTransform:"uppercase",marginBottom:4},children:"Complexity Lab"}),o.jsx("p",{style:{fontFamily:G0,fontSize:9,color:`${gl}90`,textAlign:"center",letterSpacing:"0.4em",textTransform:"uppercase",marginBottom:32},children:"VIDA ARTIFICIAL"}),o.jsx("div",{style:{borderTop:"1px dashed rgba(255,255,255,0.06)",borderBottom:"1px dashed rgba(255,255,255,0.06)",padding:"20px 0",marginBottom:24},children:o.jsx("p",{style:{fontFamily:G0,fontSize:11,color:"rgba(255,255,255,0.55)",lineHeight:1.8,textTransform:"uppercase",textAlign:"center",maxWidth:420,margin:"0 auto"},children:"Agentes com regras simples de atrao e repulso geram padres complexos emergentes  membranas, colnias, organismos, caos."})}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:12,marginBottom:28},children:[{symbol:"",label:"Campo",desc:"Ambiente invisvel",color:gl},{symbol:"",label:"Agentes",desc:"Partculas com tipo",color:"#ff0084"},{symbol:"",label:"Interao",desc:"Matriz de foras",color:"#37b2da"}].map(s=>o.jsxs("div",{style:{textAlign:"center",padding:"12px 0"},children:[o.jsx("div",{style:{fontSize:16,color:s.color,opacity:.5,marginBottom:6},children:s.symbol}),o.jsx("div",{style:{fontFamily:M4,fontSize:11,color:"rgba(255,255,255,0.6)",textTransform:"uppercase",letterSpacing:"0.08em",marginBottom:3},children:s.label}),o.jsx("div",{style:{fontFamily:G0,fontSize:8,color:"rgba(255,255,255,0.25)",textTransform:"uppercase",letterSpacing:"0.06em"},children:s.desc})]},s.label))}),o.jsxs("div",{style:{background:`${gl}06`,border:`1px dashed ${gl}18`,padding:"14px 16px",marginBottom:24},children:[o.jsx("p",{style:{fontFamily:G0,fontSize:9,color:`${gl}90`,textAlign:"center",letterSpacing:"0.12em",textTransform:"uppercase",marginBottom:4},children:"Primeiro acesso?"}),o.jsx("p",{style:{fontFamily:G0,fontSize:10,color:"rgba(255,255,255,0.4)",textAlign:"center",lineHeight:1.6,textTransform:"uppercase"},children:"Um guia rpido e discreto vai apontar os controles essenciais."})]}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[o.jsx("button",{onClick:e,onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),style:{width:"100%",padding:"12px 0",background:n?`${gl}15`:`${gl}08`,border:`1px dashed ${n?`${gl}50`:`${gl}25`}`,color:n?gl:`${gl}c0`,fontFamily:G0,fontSize:10,letterSpacing:"0.2em",textTransform:"uppercase",cursor:"pointer",transition:"all 0.2s"},children:"Iniciar Guia"}),o.jsx("button",{onClick:t,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),style:{width:"100%",padding:"10px 0",background:"none",border:"none",color:a?"rgba(255,255,255,0.5)":"rgba(255,255,255,0.2)",fontFamily:G0,fontSize:9,letterSpacing:"0.15em",textTransform:"uppercase",cursor:"pointer",transition:"all 0.2s"},children:"Explorar sozinho"})]})]})]})})};class cq{constructor(){this.storageKey="metalife_achievements_v2",this.achievements=new Map,this.load()}load(){try{const t=localStorage.getItem(this.storageKey);t&&(this.achievements=new Map(Object.entries(JSON.parse(t))))}catch{}}save(){try{localStorage.setItem(this.storageKey,JSON.stringify(Object.fromEntries(this.achievements)))}catch{}}unlock(t){return this.achievements.has(t.id)?!1:(t.unlockedAt=Date.now(),this.achievements.set(t.id,t),this.save(),!0)}getAll(){return Array.from(this.achievements.values()).sort((t,n)=>(n.unlockedAt||0)-(t.unlockedAt||0))}getUnlockedCount(){return this.achievements.size}isUnlocked(t){return this.achievements.has(t)}clear(){this.achievements.clear(),this.save()}}const Tv=[{id:"first_30_seconds",name:"Observador",description:"Assistiu 30 segundos de evoluo",category:"milestone",icon:""},{id:"first_minute",name:"Testemunha",description:"Um minuto de observao",category:"milestone",icon:""},{id:"five_minutes",name:"Cronista",description:"5 minutos contemplando o universo",category:"milestone",icon:""},{id:"ten_minutes",name:"Historiador",description:"10 minutos de vida artificial",category:"milestone",icon:""},{id:"thirty_minutes",name:"Arquivista Temporal",description:"Meia hora de existncia",category:"milestone",icon:""},{id:"one_hour",name:"Guardio das Eras",description:"Uma hora de ciclos universais",category:"milestone",icon:""},{id:"pop_500",name:"Gnesis",description:"Universo com 500+ partculas",category:"milestone",icon:""},{id:"pop_1000",name:"Ecossistema",description:"Universo com 1000+ partculas",category:"milestone",icon:""},{id:"pop_2000",name:"Metrpole",description:"2000+ partculas simultneas",category:"milestone",icon:""},{id:"pop_5000",name:"Megacidade",description:"5000+ partculas! Densidade crtica",category:"milestone",icon:""},{id:"border_formed",name:"Fronteira",description:"Bordas territoriais claras emergiram",category:"pattern",icon:""},{id:"stable_attractor",name:"Atrator Estvel",description:"3+ clusters estveis simultneos",category:"pattern",icon:""},{id:"oscillation",name:"Oscilador",description:"Padro oscilatrio peridico detectado",category:"pattern",icon:""},{id:"crystal_form",name:"Cristal",description:"Alta coeso + baixa entropia = cristal",category:"pattern",icon:""},{id:"vortex_form",name:"Vrtice",description:"Rotao coletiva estvel",category:"pattern",icon:""},{id:"segregation",name:"Segregao",description:"Tipos separados em territrios distintos",category:"pattern",icon:""},{id:"spiral_arms",name:"Galxia Espiral",description:"Braos espirais rotativos",category:"pattern",icon:""},{id:"fractal_structure",name:"Mandelbrot",description:"Estrutura auto-similar recursiva",category:"pattern",icon:""},{id:"binary_orbit",name:"Sistema Binrio",description:"Dois grupos orbitando mutuamente",category:"pattern",icon:""},{id:"perfect_symmetry",name:"Simetria",description:"Simetria radial emergiu",category:"pattern",icon:""},{id:"first_beat",name:"Primeira Batida",description:"Primeiro evento evolutivo",category:"emergence",icon:""},{id:"ten_beats",name:"Declogo",description:"10 eventos evolutivos",category:"emergence",icon:""},{id:"fifty_beats",name:"Sinfonia",description:"50 eventos evolutivos",category:"emergence",icon:""},{id:"first_speciation",name:"Gnese de Espcie",description:"Primeira especiao emergiu",category:"emergence",icon:""},{id:"five_speciations",name:"Exploso Cambriana",description:"5+ especiaes ocorreram",category:"emergence",icon:""},{id:"first_mitosis",name:"Diviso Celular",description:"Primeiro evento de mitose",category:"emergence",icon:""},{id:"ten_mitosis",name:"Reproduo Ativa",description:"10 divises celulares",category:"emergence",icon:""},{id:"first_mutation",name:"Primeira Mutao",description:"Primeiro drift gentico",category:"emergence",icon:""},{id:"phase_shift",name:"Transio de Fase",description:"Mudana abrupta de regime detectada",category:"emergence",icon:""},{id:"cascade_event",name:"Cascata",description:"Eventos encadeados em sequncia",category:"emergence",icon:""},{id:"stability_30s",name:"Equilbrio",description:"Sistema estvel por 30 segundos",category:"stability",icon:""},{id:"stability_2min",name:"Homeostase",description:"Estvel por 2+ minutos",category:"stability",icon:""},{id:"stability_5min",name:"Ordem Eterna",description:"Estvel por 5+ minutos",category:"stability",icon:""},{id:"high_diversity",name:"Biodiversidade",description:"Alta diversidade de tipos simultnea",category:"stability",icon:""},{id:"field_coherence",name:"Campo Coerente",description:"Alta coeso no campo de memria",category:"stability",icon:""},{id:"high_entropy",name:"Big Bang",description:"Entropia mxima alcanada",category:"chaos",icon:""},{id:"mass_extinction",name:"Extino em Massa",description:"Queda de 80%+ da populao",category:"chaos",icon:""},{id:"chaos_recovery",name:"Fnix",description:"Ordem emergiu do caos mximo",category:"chaos",icon:""},{id:"tension_spike",name:"Crise",description:"Tenso crtica no campo",category:"chaos",icon:""},{id:"matrix_randomized",name:"Alquimista",description:"Matriz de interao randomizada",category:"discovery",icon:""},{id:"preset_explorer",name:"Explorador",description:"3+ presets diferentes testados",category:"discovery",icon:""},{id:"field_heatmap",name:"Cartgrafo",description:"Heatmap de campo ativado",category:"discovery",icon:""},{id:"trails_on",name:"Rastro de Luz",description:"Trilhas de partculas ativadas",category:"discovery",icon:""},{id:"high_speed",name:"Acelerao",description:"Simulao em velocidade 5x",category:"discovery",icon:""},{id:"codex_capture",name:"Taxonomista",description:"Primeiro organismo capturado no Codex",category:"discovery",icon:""}],dq=new Map(Tv.map(e=>[e.id,e])),fo=e=>({...dq.get(e)});let $d=0,Ng=0,jj=0,cp=-1,bh=0;const uq=e=>{jj++},hq=(e,t)=>{const n=new Set(t.map(R=>R.id)),r=e.currentTime,a=e.particleCount,i=e.borderStrength??0,s=e.stableClusters??0,c=e.oscillation??0,l=e.diversityIndex??0,d=e.avgTension??0,u=e.avgCohesion??0,h=e.entropyLevel,m=e.stabilityScore,f=e.totalBeats??0,g=e.totalSpeciations??0,x=e.totalMitosis??0;if(!n.has("first_30_seconds")&&r>=30)return{...fo("first_30_seconds"),metadata:{duration:r}};if(!n.has("first_minute")&&r>=60)return{...fo("first_minute"),metadata:{duration:r}};if(!n.has("five_minutes")&&r>=300)return{...fo("five_minutes"),metadata:{duration:r}};if(!n.has("ten_minutes")&&r>=600)return{...fo("ten_minutes"),metadata:{duration:r}};if(!n.has("thirty_minutes")&&r>=1800)return{...fo("thirty_minutes"),metadata:{duration:r}};if(!n.has("one_hour")&&r>=3600)return{...fo("one_hour"),metadata:{duration:r}};if(bh=Math.max(bh,a),!n.has("pop_500")&&bh>=500)return{...fo("pop_500"),metadata:{particleCount:a}};if(!n.has("pop_1000")&&bh>=1e3)return{...fo("pop_1000"),metadata:{particleCount:a}};if(!n.has("pop_2000")&&bh>=2e3)return{...fo("pop_2000"),metadata:{particleCount:a}};if(!n.has("pop_5000")&&bh>=5e3)return{...fo("pop_5000"),metadata:{particleCount:a}};if(cp>0&&a<cp*.2&&cp>100&&(cp=a,!n.has("mass_extinction")))return{...fo("mass_extinction"),metadata:{particleCount:a}};if(a>50&&(cp=a),!n.has("border_formed")&&i>.55)return{...fo("border_formed"),metadata:{confidence:i}};if(!n.has("stable_attractor")&&s>=3)return{...fo("stable_attractor"),metadata:{confidence:s/10}};if(!n.has("oscillation")&&c>.5)return{...fo("oscillation"),metadata:{confidence:c}};if(!n.has("segregation")&&i>.7&&s>=2)return{...fo("segregation"),metadata:{confidence:i}};if(!n.has("crystal_form")&&u>.7&&h<.2)return{...fo("crystal_form"),metadata:{confidence:u}};if(!n.has("field_coherence")&&u>.65&&r>30)return{...fo("field_coherence"),metadata:{confidence:u}};if(!n.has("high_entropy")&&h>.85)return{...fo("high_entropy"),metadata:{confidence:h}};if(!n.has("tension_spike")&&d>.75)return{...fo("tension_spike"),metadata:{confidence:d}};if(!n.has("high_diversity")&&l>.7&&e.typesCount>=4)return{...fo("high_diversity"),metadata:{typesCount:e.typesCount}};const v=Date.now()/1e3;if(m>.65?(Ng===0&&(Ng=v),$d=v-Ng):(Ng=0,$d=0),!n.has("stability_30s")&&$d>=30)return{...fo("stability_30s"),metadata:{duration:$d}};if(!n.has("stability_2min")&&$d>=120)return{...fo("stability_2min"),metadata:{duration:$d}};if(!n.has("stability_5min")&&$d>=300)return{...fo("stability_5min"),metadata:{duration:$d}};const b=e.recentEvents.some(R=>R.toLowerCase().includes("espcie")||R.toLowerCase().includes("archetype")||R.toLowerCase().includes("speciao")),w=e.recentEvents.some(R=>R.toLowerCase().includes("diviso")||R.toLowerCase().includes("mitose")),M=e.recentEvents.some(R=>R.toLowerCase().includes("mutao")||R.toLowerCase().includes("mutation")),k=e.recentEvents.some(R=>R.includes("")||R.includes("")||R.includes(""));return!n.has("first_beat")&&(k||b||f>=1)?{...fo("first_beat"),metadata:{confidence:1}}:!n.has("ten_beats")&&f>=10?{...fo("ten_beats"),metadata:{confidence:1}}:!n.has("fifty_beats")&&f>=50?{...fo("fifty_beats"),metadata:{confidence:1}}:!n.has("first_speciation")&&(b||g>=1)?{...fo("first_speciation"),metadata:{confidence:1}}:!n.has("five_speciations")&&g>=5?{...fo("five_speciations"),metadata:{confidence:1}}:!n.has("first_mitosis")&&(w||x>=1)?{...fo("first_mitosis"),metadata:{confidence:1}}:!n.has("ten_mitosis")&&x>=10?{...fo("ten_mitosis"),metadata:{confidence:1}}:!n.has("first_mutation")&&M?{...fo("first_mutation"),metadata:{confidence:1}}:!n.has("phase_shift")&&h>.6&&m<.3&&r>60?{...fo("phase_shift"),metadata:{confidence:h}}:!n.has("chaos_recovery")&&h<.4&&m>.6&&f>=5?{...fo("chaos_recovery"),metadata:{confidence:m}}:!n.has("cascade_event")&&f>=3&&e.recentEvents.length>=5?{...fo("cascade_event"),metadata:{confidence:.9}}:!n.has("preset_explorer")&&jj>=3?{...fo("preset_explorer"),metadata:{confidence:1}}:null},fq=async(e,t)=>null,pq=()=>{const[e]=S.useState(()=>new cq),[t,n]=S.useState([]),[r,a]=S.useState(null),[i,s]=S.useState(!1),c=S.useRef(0),l=2e3;S.useEffect(()=>{n(e.getAll())},[e]);const d=S.useCallback(async g=>{const x=Date.now();if(x-c.current<l)return;c.current=x;const v=e.getAll(),b=hq(g,v);if(b&&e.unlock(b)){n(e.getAll()),a(b);return}try{const w=await fq(g,v);w&&e.unlock(w)&&(n(e.getAll()),a(w))}catch(w){console.warn("LLM achievement detection failed:",w)}},[e]),u=S.useCallback(()=>{a(null)},[]),h=S.useCallback(()=>{s(!0)},[]),m=S.useCallback(()=>{s(!1)},[]),f=S.useCallback(()=>{e.clear(),n([]),a(null)},[e]);return{achievements:t,latestAchievement:r,showPanel:i,checkAchievements:d,dismissLatest:u,openPanel:h,closePanel:m,clearAll:f,unlockedCount:t.length}},eb={pattern:{label:"Padro",color:"text-purple-400",bg:"bg-purple-500/10",border:"border-purple-500/20",icon:Qp},emergence:{label:"Emergncia",color:"text-cyan-400",bg:"bg-cyan-500/10",border:"border-cyan-500/20",icon:ic},stability:{label:"Estabilidade",color:"text-green-400",bg:"bg-green-500/10",border:"border-green-500/20",icon:mF},chaos:{label:"Caos",color:"text-red-400",bg:"bg-red-500/10",border:"border-red-500/20",icon:tP},discovery:{label:"Descoberta",color:"text-yellow-400",bg:"bg-yellow-500/10",border:"border-yellow-500/20",icon:zi},milestone:{label:"Marco",color:"text-orange-400",bg:"bg-orange-500/10",border:"border-orange-500/20",icon:cI}},mq=({achievements:e,onClose:t,onClearAll:n})=>{const[r,a]=S.useState(null),[i,s]=S.useState(!0),c=S.useMemo(()=>new Set(e.map(g=>g.id)),[e]),l=S.useMemo(()=>Tv.map(g=>{var x;return{...g,unlocked:c.has(g.id),unlockedAt:(x=e.find(v=>v.id===g.id))==null?void 0:x.unlockedAt}}),[c,e]),d=S.useMemo(()=>{let g=l;return r&&(g=g.filter(x=>x.category===r)),i||(g=g.filter(x=>x.unlocked)),g.sort((x,v)=>x.unlocked&&!v.unlocked?-1:!x.unlocked&&v.unlocked?1:(v.unlockedAt??0)-(x.unlockedAt??0))},[l,r,i]),u=S.useMemo(()=>e.reduce((g,x)=>(g[x.category]=(g[x.category]||0)+1,g),{}),[e]),h=e.length,m=Tv.length,f=Math.round(h/m*100);return o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4",children:o.jsxs("div",{className:"w-full max-w-4xl h-[88vh] bg-black/95 backdrop-blur-xl border border-white/10 rounded-xl flex flex-col overflow-hidden shadow-2xl",children:[o.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-white/[0.06]",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-9 h-9 rounded-full bg-gradient-to-br from-cyan-500/20 to-purple-500/20 border border-cyan-500/30 flex items-center justify-center",children:o.jsx(ic,{className:"w-4 h-4 text-cyan-400",strokeWidth:1.5})}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-base font-light text-white tracking-tight",children:"Conquistas"}),o.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[o.jsx("div",{className:"h-1 w-32 bg-white/10 rounded-full overflow-hidden",children:o.jsx("div",{className:"h-full bg-gradient-to-r from-cyan-500 to-purple-500 rounded-full transition-all",style:{width:`${f}%`}})}),o.jsxs("span",{className:"text-[10px] text-white/40 font-mono",children:[h,"/",m]})]})]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("button",{onClick:()=>s(g=>!g),className:`flex items-center gap-1.5 px-3 py-1.5 text-[10px] rounded border transition-all
                ${i?"border-white/15 text-white/50 hover:text-white/70":"border-white/5 text-white/25 hover:text-white/40"}`,children:[o.jsx($x,{size:10}),i?"Mostrando bloqueadas":"Apenas desbloqueadas"]}),n&&o.jsx("button",{onClick:n,className:"px-3 py-1.5 text-[10px] text-red-400/50 hover:text-red-400/80 border border-red-500/10 hover:border-red-500/30 rounded transition-all",children:"Resetar"}),o.jsx("button",{onClick:t,className:"p-2 rounded-full border border-white/10 hover:border-white/30 text-white/40 hover:text-white/80 transition-all",children:o.jsx(Cs,{size:16,strokeWidth:1.5})})]})]}),o.jsxs("div",{className:"flex gap-1.5 px-5 py-3 border-b border-white/[0.04] overflow-x-auto",children:[o.jsxs("button",{onClick:()=>a(null),className:`px-3 py-1.5 text-[10px] tracking-wider uppercase font-light transition-all rounded-lg border shrink-0
              ${r===null?"text-white bg-white/10 border-white/20":"text-white/35 border-white/5 hover:text-white/60 hover:border-white/10"}`,children:["Todas  ",h]}),Object.entries(eb).map(([g,x])=>{const v=u[g]||0,b=x.icon;return o.jsxs("button",{onClick:()=>a(g),className:`flex items-center gap-1.5 px-3 py-1.5 text-[10px] tracking-wider uppercase font-light transition-all rounded-lg border shrink-0
                  ${r===g?`${x.color} ${x.bg} ${x.border}`:"text-white/35 border-white/5 hover:text-white/60 hover:border-white/10"}`,children:[o.jsx(b,{size:10,strokeWidth:1.5}),x.label,v>0&&o.jsxs("span",{className:"ml-0.5 opacity-70",children:[" ",v]})]},g)})]}),o.jsx("div",{className:"flex-1 overflow-y-auto p-5 [&::-webkit-scrollbar]:w-1 [&::-webkit-scrollbar-track]:bg-white/5 [&::-webkit-scrollbar-thumb]:bg-white/20 [&::-webkit-scrollbar-thumb]:rounded-full",children:d.length===0?o.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-white/25",children:[o.jsx(ic,{size:40,strokeWidth:1,className:"mb-3 opacity-30"}),o.jsx("p",{className:"text-sm font-light",children:"Nenhuma conquista ainda"}),o.jsx("p",{className:"text-xs mt-1.5 opacity-60",children:"Continue explorando o universo"})]}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:d.map(g=>{const x=eb[g.category],v=x.icon,b=g.unlocked;return o.jsxs("div",{className:`relative p-4 rounded-lg border transition-all
                      ${b?`${x.bg} ${x.border} hover:scale-[1.01]`:"bg-white/[0.02] border-white/[0.05] opacity-40"}`,children:[!b&&o.jsx("div",{className:"absolute top-3 right-3",children:o.jsx($x,{size:10,className:"text-white/30"})}),o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("div",{className:`text-3xl leading-none shrink-0 ${b?"":"grayscale opacity-50"}`,children:g.icon}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("div",{className:"flex items-center gap-1.5 mb-1 flex-wrap",children:[o.jsx("span",{className:`text-sm font-medium ${b?"text-white":"text-white/50"}`,children:g.name}),o.jsxs("div",{className:`flex items-center gap-0.5 px-1.5 py-px rounded-full ${x.bg} border ${x.border} shrink-0`,children:[o.jsx(v,{size:8,strokeWidth:2,className:x.color}),o.jsx("span",{className:`text-[8px] uppercase tracking-wider ${x.color}`,children:x.label})]})]}),o.jsx("p",{className:"text-[10px] text-white/40 leading-snug",children:g.description}),b&&g.unlockedAt&&o.jsx("p",{className:"text-[9px] text-white/25 mt-1.5 font-mono",children:new Date(g.unlockedAt).toLocaleDateString("pt-BR",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"})})]})]})]},g.id)})})}),o.jsxs("div",{className:"p-4 border-t border-white/[0.04] bg-black/20 flex items-center justify-between",children:[o.jsx("div",{className:"flex items-center gap-4 text-[10px] font-light flex-wrap",children:Object.entries(eb).map(([g,x])=>o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${x.color.replace("text-","bg-")}`}),o.jsxs("span",{className:"text-white/30",children:[x.label,":"]}),o.jsx("span",{className:"text-white/60 font-mono",children:u[g]||0})]},g))}),o.jsxs("div",{className:"text-[10px] text-white/30 font-mono",children:[f,"% completo"]})]})]})})},gq=({achievement:e,onDismiss:t})=>{const[n,r]=S.useState(!1);return S.useEffect(()=>{if(e){r(!0);const a=setTimeout(()=>{r(!1),setTimeout(t,300)},5e3);return()=>clearTimeout(a)}},[e]),e?o.jsx("div",{className:`
        fixed top-6 right-6 z-50 transition-all duration-300 transform
        ${n?"translate-x-0 opacity-100":"translate-x-full opacity-0"}
      `,onClick:()=>{r(!1),setTimeout(t,300)},children:o.jsxs("div",{className:"relative w-96 bg-gradient-to-br from-black/95 to-black/90 backdrop-blur-xl border border-cyan-500/20 rounded-lg overflow-hidden shadow-2xl shadow-cyan-500/10 cursor-pointer hover:border-cyan-500/40 transition-all",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-cyan-500/5 via-purple-500/5 to-transparent opacity-50"}),o.jsxs("div",{className:"relative p-4 flex items-start gap-3",children:[o.jsx("div",{className:"flex-shrink-0 text-4xl leading-none mt-1 drop-shadow-glow",children:e.icon}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[o.jsx(ic,{className:"w-3 h-3 text-cyan-400",strokeWidth:2}),o.jsx("span",{className:"text-[10px] uppercase tracking-[0.2em] text-cyan-400/80 font-light",children:"Conquista"})]}),o.jsx("h3",{className:"text-white text-base font-medium mb-1 leading-tight",children:e.name}),o.jsx("p",{className:"text-white/50 text-xs font-light leading-relaxed",children:e.description})]})]}),o.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-white/5",children:o.jsx("div",{className:"h-full bg-gradient-to-r from-cyan-500 to-purple-500 transition-all duration-[5000ms] ease-linear",style:{width:n?"0%":"100%"}})})]})}):null},yq=[{name:"Black",value:"radial-gradient(circle, #000000 0%, #000000 100%)"},{name:"Dark Gray",value:"radial-gradient(circle, #1a1a1a 0%, #000000 100%)"},{name:"Deep Blue",value:"radial-gradient(circle, #0f172a 0%, #000000 100%)"},{name:"Purple Void",value:"radial-gradient(circle, #1e1b4b 0%, #000000 100%)"},{name:"Crimson",value:"radial-gradient(circle, #450a0a 0%, #000000 100%)"},{name:"Forest",value:"radial-gradient(circle, #14532d 0%, #000000 100%)"},{name:"Ocean Deep",value:"radial-gradient(circle, #082f49 0%, #000000 100%)"},{name:"Midnight",value:"radial-gradient(circle, #1e3a8a 0%, #000000 100%)"},{name:"Rose",value:"radial-gradient(circle, #4c0519 0%, #000000 100%)"},{name:"Emerald",value:"radial-gradient(circle, #064e3b 0%, #000000 100%)"},{name:"Amber",value:"radial-gradient(circle, #451a03 0%, #000000 100%)"},{name:"Slate",value:"radial-gradient(circle, #1e293b 0%, #000000 100%)"},{name:"Neon Blue",value:"radial-gradient(circle, #0c4a6e 30%, #000000 100%)"},{name:"Neon Purple",value:"radial-gradient(circle, #581c87 30%, #000000 100%)"},{name:"Neon Pink",value:"radial-gradient(circle, #831843 30%, #000000 100%)"},{name:"Cosmic",value:"radial-gradient(circle, #312e81 0%, #1e1b4b 50%, #000000 100%)"},{name:"Sunset",value:"radial-gradient(circle, #7c2d12 0%, #450a0a 50%, #000000 100%)"},{name:"Aurora",value:"radial-gradient(circle, #164e63 0%, #1e3a8a 50%, #000000 100%)"},{name:"Galaxy",value:"radial-gradient(circle, #4c1d95 20%, #1e1b4b 60%, #000000 100%)"},{name:"Fire",value:"radial-gradient(circle, #7f1d1d 0%, #450a0a 40%, #000000 100%)"}],C4=[{name:"Black",value:"#000000"},{name:"Deep Blue",value:"#0f172a"},{name:"Purple",value:"#1e1b4b"},{name:"Crimson",value:"#450a0a"},{name:"Forest",value:"#14532d"},{name:"Ocean",value:"#082f49"},{name:"Midnight",value:"#1e3a8a"},{name:"Rose",value:"#4c0519"},{name:"Emerald",value:"#064e3b"},{name:"Amber",value:"#451a03"},{name:"Slate",value:"#1e293b"},{name:"Neon Blue",value:"#0c4a6e"},{name:"Neon Purple",value:"#581c87"},{name:"Neon Pink",value:"#831843"}],bq=({currentBg:e,onBgChange:t,onClose:n})=>{const[r,a]=S.useState("#1e1b4b"),[i,s]=S.useState("#000000"),[c,l]=S.useState(30),d=()=>{const u=`radial-gradient(circle, ${r} ${c}%, ${i} 100%)`;t(u)};return o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/20 backdrop-blur-sm",children:o.jsxs("div",{className:"w-full max-w-3xl bg-black/5 backdrop-blur-sm border border-white/[0.02] rounded-lg overflow-hidden",children:[o.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/[0.02]",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-500/10 flex items-center justify-center",children:o.jsx(GP,{className:"w-4 h-4 text-purple-500",strokeWidth:1.5})}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-base font-light text-white tracking-tight",children:"Background Gradient"}),o.jsx("p",{className:"text-[10px] text-white/40 font-light",children:"Customize canvas background"})]})]}),o.jsx("button",{onClick:n,className:"p-2 rounded-full border border-white/10 hover:border-white/30 text-white/40 hover:text-white/80 transition-all",children:o.jsx(Cs,{size:16,strokeWidth:1})})]}),o.jsxs("div",{className:"p-6 max-h-[70vh] overflow-y-auto",children:[o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-xs uppercase tracking-wider text-white/40 mb-3 font-light",children:"Presets"}),o.jsx("div",{className:"grid grid-cols-4 gap-2",children:yq.map(u=>o.jsxs("button",{onClick:()=>t(u.value),className:"group relative h-20 rounded-lg border border-white/10 hover:border-white/30 transition-all overflow-hidden",style:{background:u.value},children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"}),o.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-2 text-[9px] text-white/70 font-light text-center",children:u.name}),e===u.value&&o.jsx("div",{className:"absolute top-1 right-1 w-3 h-3 rounded-full bg-purple-500 border border-white"})]},u.name))})]}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-xs uppercase tracking-wider text-white/40 mb-3 font-light",children:"Custom Gradient"}),o.jsxs("div",{className:"bg-white/[0.02] border border-white/5 rounded-lg p-4 space-y-4",children:[o.jsx("div",{className:"h-32 rounded-lg border border-white/10",style:{background:`radial-gradient(circle, ${r} ${c}%, ${i} 100%)`}}),o.jsxs("div",{children:[o.jsx("label",{className:"text-[10px] text-white/40 uppercase tracking-wider font-light mb-2 block",children:"Center Color"}),o.jsx("div",{className:"grid grid-cols-7 gap-2",children:C4.map(u=>o.jsx("button",{onClick:()=>a(u.value),className:`h-10 rounded border-2 transition-all ${r===u.value?"border-white scale-110":"border-white/20 hover:border-white/40"}`,style:{backgroundColor:u.value},title:u.name},u.name))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-[10px] text-white/40 uppercase tracking-wider font-light mb-2 block",children:"Edge Color"}),o.jsx("div",{className:"grid grid-cols-7 gap-2",children:C4.map(u=>o.jsx("button",{onClick:()=>s(u.value),className:`h-10 rounded border-2 transition-all ${i===u.value?"border-white scale-110":"border-white/20 hover:border-white/40"}`,style:{backgroundColor:u.value},title:u.name},u.name))})]}),o.jsxs("div",{children:[o.jsxs("label",{className:"text-[10px] text-white/40 uppercase tracking-wider font-light mb-2 block",children:["Center Spread: ",c,"%"]}),o.jsx("input",{type:"range",min:"0",max:"80",value:c,onChange:u=>l(Number(u.target.value)),className:`w-full h-1 bg-white/10 rounded-lg appearance-none cursor-pointer 
                    [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 
                    [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-purple-500 
                    [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:border-2 
                    [&::-webkit-slider-thumb]:border-white`})]}),o.jsx("button",{onClick:d,className:"w-full bg-purple-600 hover:bg-purple-500 text-white text-xs py-2.5 rounded transition-colors font-light tracking-wide uppercase",children:"Apply Custom Gradient"})]})]})]})]})})},xq="'IBM Plex Mono', monospace",tb="#ffd400",vq=({targetSelector:e,show:t})=>{const[n,r]=S.useState(null);return S.useEffect(()=>{if(!t){r(null);return}const a=()=>{const i=document.querySelector(e);if(i){const s=i.getBoundingClientRect();r({x:s.left+s.width/2,y:s.top-32})}};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[t,e]),!t||!n?null:o.jsx("div",{style:{position:"fixed",zIndex:90,pointerEvents:"none",left:n.x,top:n.y,transform:"translateX(-50%)"},children:o.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",animation:"pulse 2s ease-in-out infinite"},children:[o.jsx("div",{style:{fontFamily:xq,fontSize:8,color:`${tb}90`,letterSpacing:"0.12em",textTransform:"uppercase",background:"rgba(0,0,0,0.88)",border:`1px dashed ${tb}30`,padding:"4px 10px",marginBottom:4,whiteSpace:"nowrap"},children:"Guia disponvel"}),o.jsx("div",{style:{color:`${tb}60`,fontSize:10},children:""})]})})};function Sq(){return{nextId:100,list:[]}}function wq(e,t,n,r){if(r.volatility<.05)return null;for(const d of e.list)if(Mq(d.genes,n)<.18)return null;const a=e.nextId++,i=Cq(a),s=kq(a),c=[];r.scarcity>.6&&c.push(" Nascido da Escassez"),r.cohesion>.6&&c.push(" Altamente Coesivo"),r.volatility>.6&&c.push(" Filho da Tempestade");const l={id:a,name:s,sigil:i,genes:n,bornAt:t,notes:c};return e.list.unshift(l),e.list.length>60&&e.list.pop(),l}function Mq(e,t){const n=e.a-t.a,r=e.b-t.b,a=e.c-t.c,i=e.d-t.d;return Math.sqrt(n*n+r*r+a*a+i*i)}function Cq(e){const t=["","","","","","","","","","","","","","","","","","",""];return t[Math.abs(e)%t.length]}function kq(e,t,n){const r=["Aster","Kera","Mori","Nexa","Vira","Soma","Luma","Rho","Ech","Tess"],a=["espiral","ruptura","florescer","escriba","deriva","forja","vu","pulso","vnculo","sussurro"];return`${r[Math.abs(e)%r.length]} ${a[Math.abs(e*7|0)%a.length]}`}function Rq(e,t=200){if(e.count<10)return null;const n=Math.min(t,e.count);let r=0,a=0,i=0,s=0;for(let u=0;u<n;u++){const h=Math.random()*e.count|0;e.geneA&&e.geneB&&e.geneC&&e.geneD&&(r+=e.geneA[h],a+=e.geneB[h],i+=e.geneC[h],s+=e.geneD[h])}const c={a:r/n,b:a/n,c:i/n,d:s/n};let l=0;for(let u=0;u<n;u++){const h=Math.random()*e.count|0;if(e.geneA&&e.geneB&&e.geneC&&e.geneD){const m=e.geneA[h]-c.a,f=e.geneB[h]-c.b,g=e.geneC[h]-c.c,x=e.geneD[h]-c.d;l+=m*m+f*f+g*g+x*x}}const d=Math.sqrt(l/n);return{centroid:c,spread:d}}function Aq(e,t,n,r,a={next:()=>Math.random()}){if(!(!e.geneA||!e.geneB||!e.geneC||!e.geneD))for(let i=0;i<e.count;i+=2){const s=e.x[i],c=e.y[i],l=t(s,c),d=r.baseRate+r.entropyGain*(l.entropy??0);if(a.next()<d*n){const u=a.next()*4|0,h=(a.next()-.5)*r.step*(.5+(l.entropy??0));u===0&&(e.geneA[i]=Og(e.geneA[i]+h)),u===1&&(e.geneB[i]=Og(e.geneB[i]+h)),u===2&&(e.geneC[i]=Og(e.geneC[i]+h)),u===3&&(e.geneD[i]=Og(e.geneD[i]+h))}}}function Og(e){return e<0?0:e>1?1:e}const jq={mode:"METABOLIC",foodEnabled:!1,foodRatio:.15,foodType:255,energyEnabled:!1,energyDecay:.002,energyFeedRate:.04,energyReproThreshold:2,mutationDial:.05,mutationAmount:.08,mutationRate:8e-4,typeStability:.985,reconfigEnabled:!1,reconfigRate:.08,reconfigAmount:.06};function nb(e){const t=Eq(e.mutationDial),n=dp(5e-5,.0035,t),r=dp(.999,.955,t),a=dp(.02,.18,t),i=dp(.02,.2,t),s=dp(.01,.14,t);return{...e,mutationRate:n,typeStability:r,mutationAmount:a,reconfigRate:i,reconfigAmount:s}}function Eq(e){return e<0?0:e>1?1:e}function dp(e,t,n){return e+(t-e)*n}const Tq=()=>({births:0,deaths:0,mutations:0,speciation:0,lastEvent:""});function Iq(){return{pings:[],nextId:0}}function k4(e,t,n,r,a,i,s=5){e.pings.push({id:e.nextId++,x:t,y:n,sigil:r,color:a,name:i,spawnTime:Date.now()/1e3,lifetime:s,intensity:1})}function Pq(e,t){const n=Date.now()/1e3;for(let r=e.pings.length-1;r>=0;r--){const a=e.pings[r],i=n-a.spawnTime;if(i>=a.lifetime)e.pings.splice(r,1);else{const s=a.lifetime*.7;if(i>s){const c=(i-s)/(a.lifetime-s);a.intensity=1-c}}}e.pings.length>50&&e.pings.shift()}const Dg={bond:"#ffaa00",bloom:"#00ffaa",storm:"#ff4444",default:"#88ccff"};function Fq(e){return e.includes("coesivo")?Dg.bond:e.includes("filho-da-tempestade")?Dg.storm:e.includes("nascido-da-escassez")?Dg.bloom:Dg.default}const _q=(e,t)=>{const n=e*t;return{width:e,height:t,bond:new Float32Array(n),rift:new Float32Array(n),bloom:new Float32Array(n),oath:new Float32Array(n)}},Nq=()=>({enabled:!1,showOverlay:!1,influence:.15,deposit:.3,diffusion:.08,decay:.95}),hd=e=>e<0?0:e>1?1:e,Ej=(e,t,n,r)=>{const a=Math.floor((e+1)/2*n),i=Math.floor((t+1)/2*r),s=Math.max(0,Math.min(n-1,a));return Math.max(0,Math.min(r-1,i))*n+s};function Oq(e,t,n,r,a){const i=Ej(t,n,e.width,e.height),s=hd(a);r==="bond"&&(e.bond[i]=hd(e.bond[i]+s)),r==="rift"&&(e.rift[i]=hd(e.rift[i]+s)),r==="bloom"&&(e.bloom[i]=hd(e.bloom[i]+s)),r==="oath"&&(e.oath[i]=hd(e.oath[i]+s))}function Tj(e,t,n){const r=Ej(t,n,e.width,e.height);return{bond:e.bond[r],rift:e.rift[r],bloom:e.bloom[r],oath:e.oath[r]}}function Dq(e,t,n){if(!t.enabled)return;const r=e.width,a=e.height,i=e.bond.slice(),s=e.rift.slice(),c=e.bloom.slice(),l=e.oath.slice(),d=t.diffusion*n,u=Math.exp(-t.decay*n);for(let h=0;h<a;h++)for(let m=0;m<r;m++){const f=h*r+m,g=h>0?f-r:f,x=h<a-1?f+r:f,v=m>0?f-1:f,b=m<r-1?f+1:f,w=(i[g]+i[x]+i[v]+i[b]-4*i[f])*d,M=(s[g]+s[x]+s[v]+s[b]-4*s[f])*d,k=(c[g]+c[x]+c[v]+c[b]-4*c[f])*d,R=(l[g]+l[x]+l[v]+l[b]-4*l[f])*d;e.bond[f]=hd((i[f]+w)*u),e.rift[f]=hd((s[f]+M)*u),e.bloom[f]=hd((c[f]+k)*u),e.oath[f]=hd((l[f]+R)*u)}}const R4={VINCULO:{name:"Vnculo",sigil:"",description:"Coeso local: atrao e pacto temporrio."},RUPTURA:{name:"Ruptura",sigil:"",description:"Fronteira viva: repulso, conflito, cisma."},FLORESCER:{name:"Florescer",sigil:"",description:"Zona frtil: alimento, abundncia, replicao."},JURAMENTO:{name:"Juramento",sigil:"",description:"Ritual: caminho estvel, memria, hbito."},MIXED:{name:"Hbrido",sigil:"",description:"Smbolos competem: regime instvel e criativo."}};function Lq(e,t=.22){const n=new Map;for(let a=0;a<e.count;a++){const i=Math.floor((e.x[a]+1)/t),s=Math.floor((e.y[a]+1)/t),c=i+","+s;n.has(c)||n.set(c,[]),n.get(c).push(a)}const r=[];for(const[a,i]of n){if(i.length<8)continue;let s=0,c=0;for(const h of i)s+=e.x[h],c+=e.y[h];const l=s/i.length,d=c/i.length;let u=0;for(const h of i){const m=e.x[h]-l,f=e.y[h]-d;u=Math.max(u,Math.sqrt(m*m+f*f))}r.push({centroid:{x:l,y:d},count:i.length,radius:u})}return r}function zq(e,t,n,r){const a=Lq(t),i=[],s=new Set;for(const c of e){let l=-1,d=1e9;for(let u=0;u<a.length;u++){if(s.has(u))continue;const h=a[u].centroid.x-c.centroid.x,m=a[u].centroid.y-c.centroid.y,f=Math.sqrt(h*h+m*m);f<.25&&f<d&&(d=f,l=u)}if(l>=0){s.add(l);const u=a[l],h=u.centroid.x-c.lastCentroid.x,m=u.centroid.y-c.lastCentroid.y,f=Math.sqrt(h*h+m*m),g=Math.abs(u.count-c.particleCount)/Math.max(1,c.particleCount),x=f<.03&&g<.35?1:0,v=Bq(c.stability*.85+x*.15);i.push({...c,centroid:u.centroid,lastCentroid:c.centroid,particleCount:u.count,stability:v,lifetime:c.lifetime+n})}}for(let c=0;c<a.length;c++){if(s.has(c))continue;const l=a[c];i.push({id:"cl_"+Math.floor(r*1e3)+"_"+c,centroid:l.centroid,lastCentroid:l.centroid,particleCount:l.count,lifetime:0,stability:.45})}return i.filter(c=>c.lifetime<90)}function Bq(e){return e<0?0:e>1?1:e}function $q(e,t,n){if(e.lifetime<6||e.stability<.62||e.particleCount<10)return null;const r=jp(t,e.centroid.x,e.centroid.y),a=Tj(n,e.centroid.x,e.centroid.y),i=Math.max(a.bond,a.rift,a.bloom,a.oath),s=[a.bond,a.rift,a.bloom,a.oath].sort((c,l)=>l-c)[1];if(i>.55&&i-s>.15){if(a.bond===i)return"VINCULO";if(a.rift===i)return"RUPTURA";if(a.bloom===i)return"FLORESCER";if(a.oath===i)return"JURAMENTO"}return r.cohesion>.62?"VINCULO":r.tension>.62?"RUPTURA":r.scarcity<.35?"FLORESCER":r.mythic>.55?"JURAMENTO":null}function qq(e,t,n){const r=R4[t]||R4.MIXED;return{id:e.id,name:r.name,sigil:r.sigil,description:r.description,bornAt:n,locus:{...e.centroid},radius:Math.max(.06,Math.min(.35,.12+e.particleCount/300)),kind:t||"MIXED"}}const Ni=["#ff6b9d","#ffd166","#06d6a0","#118ab2","#ef476f","#8ac926","#ff9f1c","#2ec4b6"];function Hq(e){const t=new Uint8Array(e),n=new Float32Array(e),r=new Float32Array(e),a=new Float32Array(e);return n.fill(.5),r.fill(.05),{memeId:t,memeStrength:n,prestige:r,lastConvertAt:a}}function Wq(){return{enabled:!0,memeCount:6,convertCooldownSec:6,convertRadius:.17,convertRate:.25}}function A4(){return{totems:[],taboos:[],rituals:[],tribes:[],cases:[],config:{enabled:!0,cadenceSec:5,influenceGain:.35,justiceMode:"AUTO",maxTotems:8,maxRituals:8,autoEmergence:!0,simSpeed:.5,showImpactMetrics:!0,enableRoles:!0},tool:"SELECT",selected:null,overlay:{show:!0,showTribes:!0,showNorms:!0,showChronicle:!0},lastTickTime:0,chronicle:[],nextId:1,roleState:{roles:[],enforcerTargets:[]},culture:Hq(1e3),cultureConfig:Wq()}}function pd(e,t){const n=`${t}-${String(e.nextId).padStart(3,"0")}`;return e.nextId++,n}function Ij(e,t,n){const r=new Array(n).fill(0),a=e.count;if(a===0)return{dominantMeme:0,dominantPct:0,secondMeme:1,secondPct:0,memeCounts:r,schism:!1};for(let u=0;u<a;u++)r[t.memeId[u]%n]++;let i=0,s=-1;for(let u=1;u<n;u++)r[u]>r[i]?(s=i,i=u):(s<0||r[u]>r[s])&&(s=u);s<0&&(s=(i+1)%n);const c=r[i]/a,l=r[s]/a,d=c>=.35&&l>=.28&&c<=.68;return{dominantMeme:i,dominantPct:c,secondMeme:s,secondPct:l,memeCounts:r,schism:d}}function Gq(e,t,n){for(let r=0;r<e.count;r++)t.memeId[r]=e.type[r]%n,t.memeStrength[r]=.5,t.prestige[r]=.05,t.lastConvertAt[r]=0}function Vq(e,t,n,r,a,i){const s=[],c=t.count;if(c===0||!r.enabled)return s;for(let g=0;g<c;g++)n.memeStrength[g]<.01&&(n.memeId[g]=t.type[g]%r.memeCount,n.memeStrength[g]=.5,n.prestige[g]=.05);const l=Math.max(10,Math.min(800,Math.floor(c*.2))),d=Math.max(1,Math.floor(c/l)),u=r.convertRadius*r.convertRadius;let h=0,m=0,f=0;for(let g=0;g<c;g+=d){if(e-n.lastConvertAt[g]<r.convertCooldownSec)continue;const x=t.x[g],v=t.y[g],b=n.memeId[g];let w=-1,M=-1;for(let E=0;E<c;E++){if(E===g||n.memeId[E]===b)continue;const O=t.x[E]-x,L=t.y[E]-v;if(O*O+L*L>u)continue;const $=n.prestige[E]*n.memeStrength[E];$>w&&(w=$,M=E)}if(M<0)continue;const k=n.prestige[g]*.65,R=w-k;let I=r.convertRate*(1/(1+Math.exp(-R*5)));if(i){const E=i(x,v),O=E.a??.5,L=E.s??0;I=Math.max(0,Math.min(1,I*(1+O*.5-L*.5)))}a.next()<I&&(n.lastConvertAt[g]=e,n.memeId[g]=n.memeId[M],n.memeStrength[g]=n.memeStrength[g]*.65+1*.35,n.prestige[M]=Math.min(1,n.prestige[M]+.01),h++,m+=x,f+=v)}if(h>=4){const g=m/h,x=f/h,v=Ij(t,n,r.memeCount);s.push({type:"CONVERSION_WAVE",memeId:v.dominantMeme,count:h,wx:g,wy:x,evidence:`${h} converts, meme #${v.dominantMeme}  ${(v.dominantPct*100).toFixed(0)}%`}),v.dominantPct>=.6&&s.push({type:"CULT_DOMINANCE",memeId:v.dominantMeme,count:Math.round(v.dominantPct*c),wx:g,wy:x,evidence:`meme #${v.dominantMeme} dominates at ${(v.dominantPct*100).toFixed(0)}%`}),v.schism&&s.push({type:"SCHISM_WARNING",memeId:v.dominantMeme,count:0,wx:0,wy:0,evidence:`factions #${v.dominantMeme} ${(v.dominantPct*100).toFixed(0)}% vs #${v.secondMeme} ${(v.secondPct*100).toFixed(0)}%`})}return s}const Uq=.025,Yq=.04,Kq=.65;function Xq(e,t,n,r,a){const i=t.count,s=[],c=Math.exp(-.06*e);for(let u=0;u<i;u++)n.prestige[u]=Math.max(0,n.prestige[u]*c);for(const u of r.rituals){const h=r.totems.find(g=>g.id===u.totemId);if(!h||(a-u.bornAt)%u.periodSec/u.periodSec>=u.dutyCycle)continue;const f=(h.radius*1.3)**2;for(let g=0;g<i;g++){const x=t.x[g]-h.pos.x,v=t.y[g]-h.pos.y;x*x+v*v<f&&(n.prestige[g]=Math.min(1,n.prestige[g]+Uq*e))}}for(const u of r.taboos){if(u.kind!=="NO_ENTER")continue;const h=u.radius*u.radius;for(let m=0;m<i;m++){const f=t.x[m]-u.pos.x,g=t.y[m]-u.pos.y;f*f+g*g<h&&(n.prestige[m]=Math.max(0,n.prestige[m]-Yq*e))}}let l=-1,d=Kq-.01;for(let u=0;u<i;u++)n.prestige[u]>d&&(d=n.prestige[u],l=u);return l>=0&&s.push({type:"LEADER_EMERGES",particleIdx:l,prestige:d,memeId:n.memeId[l],wx:t.x[l],wy:t.y[l],evidence:`#${l} prestige ${d.toFixed(2)}, meme #${n.memeId[l]}`}),s}function Jq(e,t,n=5){const r=[];for(let a=0;a<e.count;a++)t.prestige[a]>.2&&r.push({idx:a,prestige:t.prestige[a],memeId:t.memeId[a],wx:e.x[a],wy:e.y[a]});return r.sort((a,i)=>i.prestige-a.prestige),r.slice(0,n)}const Qq={TOTEM_FOUNDED:{icon:"",template:'TOTEM FOUNDED: {kind} "{name}"',cause:"Placed by the observer",consequence:"Local field bias active"},TOTEM_EMERGED:{icon:"",template:' TOTEM EMERGED: {kind} "{name}"',cause:"Spontaneous crystallization from particle behavior",consequence:"Self-organized field bias now active"},TOTEM_REMOVED:{icon:"",template:'TOTEM REMOVED: "{name}"',cause:"Banished by the observer",consequence:"Field influence dissolved"},TABOO_DECLARED:{icon:"",template:"TABOO DECLARED: {kind} zone",cause:"Zone marked forbidden",consequence:"Boundary enforced"},TABOO_EMERGED:{icon:"",template:" TABOO EMERGED: {kind} boundary",cause:"Collective avoidance pattern detected",consequence:"Self-organized restriction now enforced"},TABOO_REMOVED:{icon:"",template:"TABOO LIFTED: zone dissolved",cause:"Restriction removed",consequence:"Area now open"},RITUAL_STARTED:{icon:"",template:'RITUAL STARTED: {kind} at "{totemName}"',cause:"Ritual bound to totem",consequence:"Periodic gathering active"},RITUAL_EMERGED:{icon:"",template:' RITUAL EMERGED: {kind} at "{totemName}"',cause:"Recurring motion pattern detected",consequence:"Self-organized ceremony now active"},RITUAL_ENDED:{icon:"",template:"RITUAL ENDED at totem",cause:"Ritual dissolved",consequence:"Periodic effect ceased"},TRANSGRESSION:{icon:"",template:"TRANSGRESSION: {tabooKind} taboo violated",cause:"Particles crossed forbidden boundary",consequence:"Case opened for judgment"},JUDGMENT:{icon:"",template:"JUDGMENT: {resolution}",cause:"Case {caseId} resolved",consequence:"{resolution} applied to violators"},SCHISM:{icon:"",template:"SCHISM: tribe split detected",cause:"Divergent ethos",consequence:"New faction emerged"}};function Fc(e,t={},n){const r=Qq[e],a=i=>i.replace(/\{(\w+)\}/g,(s,c)=>t[c]||"?");return{time:n??Date.now()/1e3,icon:r.icon,message:a(r.template),cause:a(r.cause),consequence:a(r.consequence)}}const j4={BOND:["Hearth","Nexus","Anchor","Haven","Beacon","Cradle","Font","Root"],RIFT:["Rift","Schism","Void","Breach","Divide","Fracture","Scar","Edge"],ORACLE:["Oracle","Whisper","Flux","Tremor","Pulse","Spark","Echo","Haze"],ARCHIVE:["Archive","Memory","Codex","Record","Ledger","Stone","Tablet","Trace"]};let rb=0;function Pj(e){const t=j4[e]||j4.BOND,n=t[rb%t.length];return rb++,`${n}-${String(rb).padStart(2,"0")}`}const Zq=.003,eH=30,tH=1.3,nH=1.2,Lg=[];function rH(e,t,n){for(;e.roleState.roles.length<t.count;)e.roleState.roles.push("NEUTRAL"),e.roleState.enforcerTargets.push(-1);for(let r=Lg.length-1;r>=0;r--){const a=Lg[r];n>=a.expiresAt&&(a.particleId<t.count&&(e.roleState.roles[a.particleId]="NEUTRAL",e.roleState.enforcerTargets[a.particleId]=-1),Lg.splice(r,1))}for(let r=0;r<t.count;r++){if(e.roleState.roles[r]!=="NEUTRAL"||Math.random()>Zq)continue;const a=t.x[r],i=t.y[r],s=t.vx[r],c=t.vy[r],l=Math.sqrt(s*s+c*c);let d=!1,u="";for(const m of e.taboos){const f=(a-m.pos.x)**2+(i-m.pos.y)**2,g=(m.radius*2)**2;if(f<g){d=!0,u=m.id;break}}let h="NEUTRAL";if(d&&e.cases.length>0){if(l<.03)h="VIGILANTE";else if(l>.06){h="ENFORCER";const m=e.cases.find(f=>f.status==="OPEN"&&f.tabooId===u);m&&m.offenderParticleId!==void 0&&(e.roleState.enforcerTargets[r]=m.offenderParticleId)}}else l>.08&&(h="RESISTER");h!=="NEUTRAL"&&(e.roleState.roles[r]=h,Lg.push({particleId:r,role:h,expiresAt:n+eH}))}}function oH(e,t,n){if(e.config.enableRoles)for(let r=0;r<t.count;r++){const a=e.roleState.roles[r];if(!a||a==="NEUTRAL")continue;const i=t.x[r],s=t.y[r];if(a==="ENFORCER"){const c=e.roleState.enforcerTargets[r];if(c>=0&&c<t.count){const l=t.x[c],d=t.y[c],u=l-i,h=d-s,m=Math.sqrt(u*u+h*h);if(m>.01){const f=.03*n*tH;t.vx[r]+=u/m*f,t.vy[r]+=h/m*f}}}else if(a==="VIGILANTE"){let c=null,l=1/0;for(const d of e.taboos){const u=(i-d.pos.x)**2+(s-d.pos.y)**2;u<l&&(l=u,c=d)}if(c){const d=i-c.pos.x,u=s-c.pos.y,h=Math.sqrt(d*d+u*u);if(h>.01){const m=-u/h,f=d/h,g=.015*n;t.vx[r]+=m*g,t.vy[r]+=f*g;const x=c.radius*1.5,v=(h-x)*.02*n;t.vx[r]-=d/h*v,t.vy[r]-=u/h*v}}}else if(a==="RESISTER"){let c=null,l=1/0;for(const d of e.taboos){const u=(i-d.pos.x)**2+(s-d.pos.y)**2;u<l&&u>(d.radius*.5)**2&&(l=u,c=d)}if(c){const d=c.pos.x-i,u=c.pos.y-s,h=Math.sqrt(d*d+u*u);if(h>.01){const m=.02*n*nH;t.vx[r]+=d/h*m,t.vy[r]+=u/h*m}}}}}const ob=new Map;function aH(e,t){if(!ob.has(e)){const r=e.split("").reduce((a,i)=>a+i.charCodeAt(0),0);ob.set(e,{angle:r%360*Math.PI/180,phase:0})}const n=ob.get(e);return n.phase+=.03,n.angle+=Math.sin(n.phase)*.1,{x:Math.cos(n.angle),y:Math.sin(n.angle)}}const sH=.3,iH=12,lH=80;function xh(e,t,n,r,a){e.vx[t]+=Math.max(-.025,Math.min(.025,n*a)),e.vy[t]+=Math.max(-.025,Math.min(.025,r*a))}function cd(e,t,n,r){const a=e-n,i=t-r;return a*a+i*i}function cH(e,t,n){if(!e.config.enabled)return[];const r=[],a=e.config.influenceGain*e.config.simSpeed,i=t.count;e.totems.forEach(c=>c.affectedCount=0),e.taboos.forEach(c=>c.affectedCount=0),e.rituals.forEach(c=>c.affectedCount=0),e.config.enableRoles&&rH(e,t,n);for(const c of e.totems){const l=c.radius*c.radius,d=c.strength*a;for(let u=0;u<i;u++){const h=t.x[u],m=t.y[u],f=cd(h,m,c.pos.x,c.pos.y);if(f>l||f<1e-8)continue;c.affectedCount++;const x=1-Math.sqrt(f)/c.radius;if(c.kind==="BOND"){const v=(c.pos.x-h)*x*d*1.2,b=(c.pos.y-m)*x*d*1.2;xh(t,u,v,b,1)}else if(c.kind==="RIFT"){const v=(h-c.pos.x)*x*d*.9,b=(m-c.pos.y)*x*d*.9;xh(t,u,v,b,1)}else if(c.kind==="ORACLE"){const v=aH(c.id),b=v.x*x*d*.4,w=v.y*x*d*.4;xh(t,u,b,w,1)}}}for(const c of e.taboos){const l=c.radius*c.radius;let d=0;for(let u=0;u<i;u++){const h=t.x[u],m=t.y[u],f=cd(h,m,c.pos.x,c.pos.y);if(c.kind==="NO_ENTER"){if(f<l){c.affectedCount++;const g=Math.sqrt(f),x=1-g/c.radius,v=(h-c.pos.x)/(g+1e-6),b=(m-c.pos.y)/(g+1e-6),w=x*c.intensity*a*2;xh(t,u,v*w,b*w,1),d+=x}}else c.kind==="NO_MIX"&&f<l&&c.targetType!==void 0&&t.type[u]===c.targetType&&(c.affectedCount++,t.vx[u]*=1-c.intensity*a*.35,t.vy[u]*=1-c.intensity*a*.35,d+=.3)}if(d>sH){const u=e.cases.find(f=>f.tabooId===c.id&&f.status==="OPEN"),h=e.cases.filter(f=>f.tabooId===c.id&&f.status==="RESOLVED").sort((f,g)=>(g.resolvedAt||0)-(f.resolvedAt||0))[0];if(!u&&(!h||n-(h.resolvedAt||0)>iH)){const f={id:pd(e,"case"),tabooId:c.id,status:"OPEN",resolution:null,createdAt:n};e.cases.push(f);const g=Fc("TRANSGRESSION",{tabooKind:c.kind,tabooId:c.id,violationStrength:d.toFixed(2)},n);r.push(g),dH(e,f,t,n,r)}}}for(const c of e.rituals){const l=e.totems.find(f=>f.id===c.totemId);if(!l||!((n-c.bornAt)%c.periodSec/c.periodSec<c.dutyCycle))continue;const h=l.radius*l.radius,m=c.intensity*a;for(let f=0;f<t.count;f++){const g=t.x[f],x=t.y[f],v=cd(g,x,l.pos.x,l.pos.y);if(v>h*2.25||v<1e-8)continue;c.affectedCount++;const b=Math.sqrt(v);if(c.kind==="GATHER"){const w=(l.pos.x-g)/b,M=(l.pos.y-x)/b,k=m*1.5*Math.min(1,b/l.radius);xh(t,f,w*k,M*k,1)}else if(c.kind==="PROCESSION"){const w=(l.pos.x-g)/b,M=(l.pos.y-x)/b,k=-M,R=w,j=m*1.2,I=m*.4*(1-b/(l.radius*1.2));xh(t,f,k*j+w*I,R*j+M*I,1)}else if(c.kind==="OFFERING"){const w=1-b/(l.radius*1.5);w>0&&(t.vx[f]*=1-w*m*.45,t.vy[f]*=1-w*m*.45)}}}for(e.config.enableRoles&&oH(e,t,a);e.chronicle.length>lH;)e.chronicle.pop();const s=e.cases.filter(c=>c.status==="RESOLVED");if(s.length>20){const c=s.slice(0,s.length-20);e.cases=e.cases.filter(l=>!c.includes(l))}return r}function dH(e,t,n,r,a){const i=e.taboos.find(l=>l.id===t.tabooId);if(!i)return;let s=e.config.justiceMode;if(s==="AUTO"){let l=0;const d=i.radius*i.radius;for(let u=0;u<n.count;u++)cd(n.x[u],n.y[u],i.pos.x,i.pos.y)<d&&l++;s=l>15?"RETRIBUTIVE":"RESTORATIVE"}if(s==="RETRIBUTIVE"){t.resolution="PUNISH";const l=i.radius*i.radius;for(let d=0;d<n.count;d++)if(cd(n.x[d],n.y[d],i.pos.x,i.pos.y)<l){const u=Math.sqrt(cd(n.x[d],n.y[d],i.pos.x,i.pos.y));if(u>1e-6){const h=(n.x[d]-i.pos.x)/u,m=(n.y[d]-i.pos.y)/u;n.vx[d]+=h*.08,n.vy[d]+=m*.08}n.vx[d]*=.5,n.vy[d]*=.5}}else{t.resolution="RESTORE";const l=e.totems.reduce((d,u)=>{if(!d)return u;const h=cd(u.pos.x,u.pos.y,i.pos.x,i.pos.y),m=cd(d.pos.x,d.pos.y,i.pos.x,i.pos.y);return h<m?u:d},null);if(l){const d=i.radius*i.radius*2;for(let u=0;u<n.count;u++)if(cd(n.x[u],n.y[u],i.pos.x,i.pos.y)<d){const h=l.pos.x-n.x[u],m=l.pos.y-n.y[u],f=Math.sqrt(h*h+m*m);f>1e-6&&(n.vx[u]+=h/f*.025,n.vy[u]+=m/f*.025)}}}t.status="RESOLVED",t.resolvedAt=r;const c=Fc("JUDGMENT",{resolution:t.resolution,tabooId:t.tabooId,caseId:t.id},r);a.push(c)}function uH(e,t){const n=e.config.cadenceSec/e.config.simSpeed;return e.config.enabled&&t-e.lastTickTime>=n}const VS={BOND:"#5ac8fa",RIFT:"#ff6b6b",ORACLE:"#c084fc",ARCHIVE:"#94a3b8"},Fj={NO_ENTER:"#ef4444",NO_MIX:"#f97316"},hH=12,m0=[];function qd(e,t,n,r,a,i=4){m0.push({x:e,y:t,bornAt:a,color:r,label:n,duration:i}),m0.length>hH&&m0.shift()}const _j=6,pf=[];function Wl(e,t,n="#ffffff"){pf.unshift({time:e,text:t,color:n}),pf.length>_j&&pf.pop()}function Vy(e,t,n,r){return[(e+1)*.5*n,(-t+1)*.5*r]}function US(e,t,n){return e*.5*Math.min(t,n)}function fH(e,t,n,r,a,i,s="off"){if(!t.overlay.show)return;if(e.save(),s==="culture"&&i&&pH(e,t,i,n,r),t.overlay.showNorms)for(const l of t.taboos)gH(e,l,t,n,r,s==="law");const c=s==="ritual"||s==="culture"||s==="law"||s==="off";for(const l of t.totems)mH(e,l,t,n,r,a,c);for(const l of t.rituals)yH(e,l,t,n,r,a);(s==="events"||s==="culture"||s==="off")&&bH(e,n,r,a),xH(e,n,r,a),e.restore()}function pH(e,t,n,r,a,i){const s=t.culture,c=t.cultureConfig,l=n.count;if(l===0)return;e.save();for(let b=0;b<c.memeCount;b++){const w=Ni[b%Ni.length];e.fillStyle=w,e.globalAlpha=.6,e.beginPath();for(let M=0;M<l;M++){if(s.memeId[M]%c.memeCount!==b)continue;const k=(n.x[M]+1)*.5*r,R=(-n.y[M]+1)*.5*a;e.moveTo(k+2,R),e.arc(k,R,2,0,Math.PI*2)}e.fill()}const d=[];for(let b=0;b<l;b++)s.prestige[b]>.3&&d.push({i:b,p:s.prestige[b]});d.sort((b,w)=>w.p-b.p);for(const{i:b,p:w}of d.slice(0,10)){const M=(n.x[b]+1)*.5*r,k=(-n.y[b]+1)*.5*a,R=Ni[s.memeId[b]%Ni.length],j=6+w*14,I=e.createRadialGradient(M,k,0,M,k,j);I.addColorStop(0,R),I.addColorStop(1,"transparent"),e.fillStyle=I,e.globalAlpha=.12+w*.28,e.beginPath(),e.arc(M,k,j,0,Math.PI*2),e.fill(),w>.55&&(e.beginPath(),e.arc(M,k,4+w*4,0,Math.PI*2),e.strokeStyle=R,e.lineWidth=1.2,e.globalAlpha=.7,e.stroke())}const u=.22*.5*Math.min(r,a),h=u*u;e.lineWidth=.6,e.setLineDash([2,5]);for(const{i:b,p:w}of d.slice(0,3)){if(w<.5)break;const M=(n.x[b]+1)*.5*r,k=(-n.y[b]+1)*.5*a,R=s.memeId[b],j=Ni[R%Ni.length];e.strokeStyle=j,e.globalAlpha=.1+w*.08;const I=Math.max(1,Math.floor(l/80));let E=0;for(let O=0;O<l&&E<5;O+=I){if(O===b||s.memeId[O]!==R)continue;const L=(n.x[O]+1)*.5*r,$=(-n.y[O]+1)*.5*a,F=L-M,B=$-k;F*F+B*B>h||(e.beginPath(),e.moveTo(M,k),e.lineTo(L,$),e.stroke(),E++)}}e.setLineDash([]);const m=new Array(c.memeCount).fill(0);for(let b=0;b<l;b++)m[s.memeId[b]%c.memeCount]++;let f=0;for(let b=1;b<c.memeCount;b++)m[b]>m[f]&&(f=b);const g=l>0?m[f]/l:0,x=Ni[f%Ni.length],v=d.filter(b=>b.p>.5).length;e.globalAlpha=.85,e.font="10px system-ui, sans-serif",e.textAlign="left",e.textBaseline="top",e.fillStyle="#000000",e.globalAlpha=.35,e.fillRect(12,12,180,38),e.globalAlpha=.9,e.fillStyle=x,e.fillText(`Meme #${f} dominant: ${(g*100).toFixed(0)}%`,18,18),e.fillStyle="#ffffff",e.globalAlpha=.55,e.fillText(`Leaders: ${v}  |  ${c.memeCount} memes active`,18,32),e.restore()}function mH(e,t,n,r,a,i,s=!0){var f;const[c,l]=Vy(t.pos.x,t.pos.y,r,a),d=US(t.radius,r,a),u=VS[t.kind]||"#ffffff",h=((f=n.selected)==null?void 0:f.type)==="totem"&&n.selected.id===t.id;if(s){const g=1+.04*Math.sin(i*1.5+t.bornAt);e.beginPath(),e.arc(c,l,d*g,0,Math.PI*2),e.strokeStyle=u,e.lineWidth=h?1.5:.8,e.globalAlpha=h?.35:.12,e.stroke(),e.globalAlpha=.025,e.fillStyle=u,e.fill()}const m=e.createRadialGradient(c,l,0,c,l,10);if(m.addColorStop(0,u),m.addColorStop(1,"transparent"),e.beginPath(),e.arc(c,l,10,0,Math.PI*2),e.fillStyle=m,e.globalAlpha=.5,e.fill(),e.beginPath(),e.arc(c,l,h?4.5:3.5,0,Math.PI*2),e.fillStyle=u,e.globalAlpha=.9,e.fill(),t.emergent){const g=(i*.8+t.bornAt)%(Math.PI*2);e.globalAlpha=.4,e.fillStyle=u;for(let x=0;x<3;x++){const v=g+x/3*Math.PI*2,b=c+Math.cos(v)*(d*.4),w=l+Math.sin(v)*(d*.4);e.beginPath(),e.arc(b,w,1.5,0,Math.PI*2),e.fill()}}h&&(e.globalAlpha=.6,e.fillStyle=u,e.font="9px system-ui, sans-serif",e.textAlign="center",e.textBaseline="top",e.fillText(t.name,c,l+8))}function gH(e,t,n,r,a,i=!1){var m;const[s,c]=Vy(t.pos.x,t.pos.y,r,a),l=US(t.radius,r,a),d=Fj[t.kind]||"#ef4444",u=((m=n.selected)==null?void 0:m.type)==="taboo"&&n.selected.id===t.id;e.beginPath(),e.arc(s,c,l,0,Math.PI*2),e.setLineDash([4,4]),e.strokeStyle=d,e.lineWidth=u?1.5:.8,e.globalAlpha=u?.5:.2,e.stroke(),e.setLineDash([]),(i||u)&&(e.beginPath(),e.arc(s,c,l,0,Math.PI*2),e.fillStyle=d,e.globalAlpha=.04+t.intensity*.03,e.fill()),e.globalAlpha=u?.6:.25,e.strokeStyle=d,e.lineWidth=1.2;const h=4;e.beginPath(),e.moveTo(s-h,c-h),e.lineTo(s+h,c+h),e.moveTo(s+h,c-h),e.lineTo(s-h,c+h),e.stroke()}function yH(e,t,n,r,a,i){const s=n.totems.find(v=>v.id===t.totemId);if(!s)return;const[c,l]=Vy(s.pos.x,s.pos.y,r,a),d=US(s.radius,r,a),u=VS[s.kind]||"#ffffff",h=(i-t.bornAt)%t.periodSec/t.periodSec;if(!(h<t.dutyCycle)){e.beginPath(),e.arc(c,l,d*1.3,0,Math.PI*2),e.setLineDash([2,6]),e.strokeStyle=u,e.lineWidth=.5,e.globalAlpha=.06,e.stroke(),e.setLineDash([]);return}const f=h/t.dutyCycle,g=d*(1.1+.25*Math.sin(f*Math.PI*2));e.beginPath(),e.arc(c,l,g,0,Math.PI*2),e.strokeStyle=u,e.lineWidth=1.5,e.globalAlpha=.18+.12*Math.sin(f*Math.PI),e.stroke();const x=d*(1+.2*Math.cos(f*Math.PI*2));if(e.beginPath(),e.arc(c,l,x,0,Math.PI*2),e.lineWidth=.7,e.globalAlpha=.08,e.stroke(),t.kind==="PROCESSION"){const v=f*Math.PI*4,b=c+Math.cos(v)*g*.7,w=l+Math.sin(v)*g*.7;e.beginPath(),e.arc(b,w,2.5,0,Math.PI*2),e.fillStyle=u,e.globalAlpha=.5,e.fill()}else if(t.kind==="GATHER"){e.globalAlpha=.15,e.strokeStyle=u,e.lineWidth=1;for(let v=0;v<4;v++){const b=v/4*Math.PI*2+i*.3,w=g*.95,M=d*.4;e.beginPath(),e.moveTo(c+Math.cos(b)*w,l+Math.sin(b)*w),e.lineTo(c+Math.cos(b)*M,l+Math.sin(b)*M),e.stroke()}}}function bH(e,t,n,r){for(let a=m0.length-1;a>=0;a--)r-m0[a].bornAt>m0[a].duration&&m0.splice(a,1);for(const a of m0){const s=(r-a.bornAt)/a.duration,[c,l]=Vy(a.x,a.y,t,n),d=35+s*25,u=(1-s)*.5;if(e.beginPath(),e.arc(c,l,d*s,0,Math.PI*2),e.strokeStyle=a.color,e.lineWidth=1.5*(1-s)+.3,e.globalAlpha=u,e.stroke(),s>.15){const h=Math.max(0,s-.15);e.beginPath(),e.arc(c,l,d*h,0,Math.PI*2),e.lineWidth=.8*(1-h),e.globalAlpha=u*.5,e.stroke()}if(s<.6){const h=(1-s/.6)*.7;e.globalAlpha=h,e.fillStyle=a.color,e.font="9px system-ui, sans-serif",e.textAlign="center",e.textBaseline="bottom";const m=-20-s*12;e.fillText(a.label,c,l+m)}}}function xH(e,t,n,r){if(pf.length===0)return;const a=16,i=n-20,s=16;e.font="10px system-ui, sans-serif",e.textAlign="left",e.textBaseline="bottom";for(let c=0;c<Math.min(pf.length,_j);c++){const l=pf[c],d=r-l.time,u=8,h=28;let m;if(d<u)m=.75;else if(d<h)m=.75*(1-(d-u)/(h-u));else{m=0;continue}d<1&&(m=.75+.25*(1-d));const f=i-c*s;e.globalAlpha=m*.3,e.fillStyle="#000000",e.fillText(l.text,a+1,f+1),e.globalAlpha=m,e.fillStyle=l.color,e.fillText(l.text,a,f)}}function vH(e,t,n,r,a,i,s){if(t==="SELECT"||n<0||r<0)return;e.save();const c=35;if(t==="TOTEM"){const l=VS[s||"BOND"]||"#5ac8fa";e.beginPath(),e.arc(n,r,c,0,Math.PI*2),e.strokeStyle=l,e.lineWidth=1,e.globalAlpha=.3,e.stroke(),e.beginPath(),e.arc(n,r,4,0,Math.PI*2),e.fillStyle=l,e.globalAlpha=.7,e.fill(),e.globalAlpha=.4,e.font="9px system-ui, sans-serif",e.textAlign="center",e.textBaseline="top",e.fillText(s||"BOND",n,r+10)}else if(t==="TABOO"){const l=Fj[s||"NO_ENTER"]||"#ef4444";e.beginPath(),e.arc(n,r,c,0,Math.PI*2),e.setLineDash([4,4]),e.strokeStyle=l,e.lineWidth=1,e.globalAlpha=.3,e.stroke(),e.setLineDash([]),e.globalAlpha=.4,e.strokeStyle=l,e.lineWidth=1.2;const d=5;e.beginPath(),e.moveTo(n-d,r-d),e.lineTo(n+d,r+d),e.moveTo(n+d,r-d),e.lineTo(n-d,r+d),e.stroke(),e.globalAlpha=.4,e.fillStyle=l,e.font="9px system-ui, sans-serif",e.textAlign="center",e.textBaseline="top",e.fillText((s||"NO_ENTER").replace("_"," "),n,r+10)}else if(t==="RITUAL"){const l=s==="PROCESSION"?"#c084fc":s==="OFFERING"?"#fbbf24":"#34d399";e.beginPath(),e.arc(n,r,c*1.1,0,Math.PI*2),e.setLineDash([3,5]),e.strokeStyle=l,e.lineWidth=1,e.globalAlpha=.25,e.stroke(),e.setLineDash([]),e.globalAlpha=.4,e.fillStyle=l,e.font="9px system-ui, sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillText(s||"GATHER",n,r),e.globalAlpha=.25,e.font="8px system-ui, sans-serif",e.textBaseline="top",e.fillText("click a totem",n,r+12)}e.restore()}function SH(e,t,n){if(e.totems.length===0){e.tribes=[];return}const r=new Map;for(const s of e.totems){const c=new Map,l=s.radius*s.radius;for(let d=0;d<t.count;d++){const u=t.x[d]-s.pos.x,h=t.y[d]-s.pos.y;if(u*u+h*h<l){const m=t.type[d];c.set(m,(c.get(m)||0)+1)}}r.set(s.id,c)}const a=new Map;for(const s of e.totems){const c=r.get(s.id);if(!c||c.size===0)continue;let l=0,d=-1;for(const[u,h]of c)h>l&&(l=h,d=u);d>=0&&l>=3&&(a.has(d)||a.set(d,[]),a.get(d).push(s.id))}const i=[];for(const[s,c]of a){const l=e.tribes.find(d=>d.typeId===s);if(l)l.totems=c,i.push(l);else if(c.length>=1){const d=s*1e3+Math.floor(n*.1);i.push({id:pd(e,"tribe"),typeId:s,totems:c,ethos:{cohesionBias:Math.sin(d*.0073)*.2,tensionBias:Math.cos(d*.0057)*.2},bornAt:n})}}e.tribes=i}function wH(e,t,n,r,a){const{R:i,gridW:s,gridH:c}=t,l=r/s,d=a/c;e.save(),e.globalCompositeOperation="source-over";for(let u=0;u<c;u++)for(let h=0;h<s;h++){const m=i[u*s+h];if(m<.05)continue;let f=0,g=0,x=0;if(m<.5){const b=m/.5;f=Math.round(20*(1-b)+80*b),g=Math.round(60*(1-b)+200*b),x=Math.round(20*(1-b)+40*b)}else{const b=(m-.5)/.5;f=Math.round(80*(1-b)+255*b),g=Math.round(200*(1-b)+255*b),x=Math.round(40*(1-b)+100*b)}const v=m*.45;e.fillStyle=`rgba(${f},${g},${x},${v})`,e.fillRect(Math.floor(h*l),Math.floor(u*d),Math.ceil(l)+1,Math.ceil(d)+1)}e.globalAlpha=.55,e.fillStyle="#ffffff",e.font="9px system-ui, sans-serif",e.textAlign="right",e.textBaseline="top",e.fillText(" Resource Field",r-10,10),e.restore()}function MH(e,t,n,r){const{claimOwner:a,claimStrength:i,gridW:s,gridH:c}=t,l=n/s,d=r/c;e.save();for(let u=0;u<c;u++)for(let h=0;h<s;h++){const m=u*s+h,f=a[m];if(f<0)continue;const g=i[m];if(g<.04)continue;const x=Ni[f%Ni.length];e.fillStyle=x,e.globalAlpha=g*.35,e.fillRect(Math.floor(h*l),Math.floor(u*d),Math.ceil(l)+1,Math.ceil(d)+1)}for(let u=0;u<c;u++)for(let h=0;h<s;h++){const m=u*s+h;if(i[m]<.6)continue;const f=h<s-1?a[u*s+h+1]:-1,g=u<c-1?a[(u+1)*s+h]:-1,x=a[m];x<0||(f>=0&&f!==x||g>=0&&g!==x)&&(e.fillStyle=Ni[x%Ni.length],e.globalAlpha=.6,e.fillRect(Math.floor(h*l),Math.floor(u*d),Math.ceil(l),Math.ceil(d)))}e.globalAlpha=.55,e.fillStyle="#ffffff",e.font="9px system-ui, sans-serif",e.textAlign="right",e.textBaseline="top",e.fillText(" Territory Claims",n-10,10),e.restore()}const CH=20,bu=8,dy=10,kH=.07,RH=.02;function AH(e,t,n){if(!e.config.enabled)return;const r=jH(t);EH(e,t,r,n),TH(e,t,r,n),IH(e,t,n)}function jH(e){const t=new Map;for(let n=0;n<e.count;n++){const r=e.x[n],a=e.y[n],i=e.vx[n],s=e.vy[n],c=e.type[n],l=Math.floor(r*dy),d=Math.floor(a*dy),u=`${l},${d}`;let h=t.get(u);h||(h={count:0,typeCount:new Map,avgVx:0,avgVy:0,sumVel:0,centroidX:0,centroidY:0},t.set(u,h)),h.count++,h.typeCount.set(c,(h.typeCount.get(c)||0)+1),h.avgVx+=i,h.avgVy+=s,h.sumVel+=Math.sqrt(i*i+s*s),h.centroidX+=r,h.centroidY+=a}for(const n of t.values())n.count>0&&(n.avgVx/=n.count,n.avgVy/=n.count,n.sumVel/=n.count,n.centroidX/=n.count,n.centroidY/=n.count);return t}function EH(e,t,n,r){if(!(e.totems.length>=e.config.maxTotems))for(const[a,i]of n.entries()){if(i.count<bu)continue;const s=i.centroidX,c=i.centroidY;if(e.totems.some(u=>(u.pos.x-s)**2+(u.pos.y-c)**2<.08))continue;let d=null;if(i.sumVel>kH&&i.count>bu*.5)d="ORACLE";else if(i.sumVel<RH&&i.count>bu*.7)d="ARCHIVE";else{const u=PH(i.typeCount);(u?(i.typeCount.get(u)||0)/i.count:0)>.6&&i.sumVel<.05&&i.count>bu&&(d="BOND")}if(d||i.typeCount.size/Math.min(t.count/8,5)>.5&&i.sumVel>.025&&i.sumVel<.08&&i.count>bu*.6&&(d="RIFT"),d&&e.totems.length<e.config.maxTotems){if(e.totems.filter(g=>g.emergent&&r-g.bornAt<30).length>=3)continue;const h=Pj(d),m={id:pd(e,"totem"),kind:d,pos:{x:s,y:c},radius:.15,strength:.8,pinned:!1,bornAt:r,name:h,emergent:!0,affectedCount:0};e.totems.push(m);const f=Fc("TOTEM_EMERGED",{kind:d,name:h},r);e.chronicle.unshift(f),console.log(` TOTEM EMERGED: ${d} "${h}" at (${s.toFixed(2)}, ${c.toFixed(2)})`)}}}function TH(e,t,n,r){if(!(e.taboos.length>=6))for(const[a,i]of n.entries()){const s=i.centroidX,c=i.centroidY;if(!e.taboos.some(d=>(d.pos.x-s)**2+(d.pos.y-c)**2<.06)){if(i.count===0){const d=E4(a,n);if(d.reduce((h,m)=>h+m.count,0)/(d.length||1)>bu*.6){const[h,m]=a.split(",").map(Number),f={id:pd(e,"taboo"),kind:"NO_ENTER",pos:{x:(h+.5)/dy,y:(m+.5)/dy},radius:.1,intensity:.7,bornAt:r,emergent:!0,affectedCount:0};e.taboos.push(f);const g=Fc("TABOO_EMERGED",{kind:"NO_ENTER"},r);e.chronicle.unshift(g),console.log(` TABOO EMERGED: NO_ENTER at (${f.pos.x.toFixed(2)}, ${f.pos.y.toFixed(2)})`);return}}if(i.count>bu*.4&&i.typeCount.size===1){const d=Array.from(i.typeCount.keys())[0];if(E4(a,n).some(m=>{const f=Array.from(m.typeCount.keys()).filter(g=>g!==d);return f.length>0&&m.typeCount.get(f[0])>2})&&e.taboos.length<6){const m={id:pd(e,"taboo"),kind:"NO_MIX",pos:{x:s,y:c},radius:.12,intensity:.6,targetType:d,bornAt:r,emergent:!0,affectedCount:0};e.taboos.push(m);const f=Fc("TABOO_EMERGED",{kind:"NO_MIX"},r);e.chronicle.unshift(f),console.log(` TABOO EMERGED: NO_MIX at (${s.toFixed(2)}, ${c.toFixed(2)}) for type ${d}`);return}}}}}function IH(e,t,n){if(!(e.rituals.length>=e.config.maxRituals)&&e.totems.length!==0)for(const r of e.totems){if(e.rituals.some(u=>u.totemId===r.id))continue;if(e.rituals.length>=e.config.maxRituals)return;let a=0,i=0,s=0,c=0;const l=(r.radius*2.5)**2;for(let u=0;u<t.count;u++){const h=t.x[u]-r.pos.x,m=t.y[u]-r.pos.y,f=h*h+m*m;if(f<l&&f>1e-6){a++;const g=Math.sqrt(f),x=h/g,v=m/g,b=t.vx[u]*x+t.vy[u]*v;i+=b;const w=-v,M=x,k=Math.abs(t.vx[u]*w+t.vy[u]*M);s+=k,c+=Math.sqrt(t.vx[u]**2+t.vy[u]**2)}}if(a<4)continue;i/=a,s/=a,c/=a;let d=null;if(s>.02&&Math.abs(i)<.02?d="PROCESSION":i<-.008&&s<.025?d="GATHER":c<.03&&a>5&&(d="OFFERING"),d){const u={id:pd(e,"ritual"),kind:d,totemId:r.id,periodSec:8,dutyCycle:.4,intensity:.7,bornAt:n,emergent:!0,affectedCount:0};e.rituals.push(u);const h=Fc("RITUAL_EMERGED",{kind:d,totemName:r.name},n);e.chronicle.unshift(h),console.log(` RITUAL EMERGED: ${d} at totem "${r.name}"`)}}}function PH(e){let t=0,n=null;for(const[r,a]of e.entries())a>t&&(t=a,n=r);return n}function E4(e,t){const[n,r]=e.split(",").map(Number),a=[];for(let i=-1;i<=1;i++)for(let s=-1;s<=1;s++){if(i===0&&s===0)continue;const c=`${n+i},${r+s}`,l=t.get(c);l&&a.push(l)}return a}function FH(e,t){return t-e>=CH}function _H(e,t,n){if(t==="off")return;const r=e.attract.length,a=.002;switch(t){case"culture":{for(let i=0;i<r;i++)e.attract[i][i]=Math.min(1.5,e.attract[i][i]+a*3);break}case"field":{for(let i=0;i<r;i++)for(let s=0;s<r;s++){const c=Math.sign(e.attract[i][s]);e.attract[i][s]=Math.max(-1.5,Math.min(1.5,e.attract[i][s]+c*a*2))}break}case"ritual":{for(let i=0;i<r;i++)e.attract[i][i]=Math.min(1.5,e.attract[i][i]+a*4);break}case"law":{for(let i=0;i<r;i++)for(let s=0;s<r;s++)e.attract[i][s]*=1-a*3;break}case"events":{for(let i=0;i<r;i++)for(let s=0;s<r;s++)if(Math.abs(e.attract[i][s])>.3){const c=Math.sign(e.attract[i][s]);e.attract[i][s]=Math.max(-1.5,Math.min(1.5,e.attract[i][s]+c*a*4))}break}}}function NH(e,t){if(t.tribes.length===0)return;const n=.001;for(const r of t.tribes){const a=r.typeId;if(a>=e.attract.length)continue;const i=n*(1+r.ethos.cohesionBias);e.attract[a][a]+=i,e.attract[a][a]=Math.min(1.5,e.attract[a][a]);const s=n*(.5+r.ethos.tensionBias);for(let c=0;c<e.attract.length;c++)c!==a&&e.attract[a][c]>-1&&(e.attract[a][c]-=s,e.attract[a][c]=Math.max(-1.5,e.attract[a][c]))}}const vh=12,ab=.2,T4=4;function OH(e,t,n){if(e.count<20)return[];const r=new Map;for(let u=0;u<e.count;u++){const h=Math.floor((e.x[u]+1)*vh/2),m=Math.floor((e.y[u]+1)*vh/2),f=`${h},${m}`;r.has(f)||r.set(f,[]),r.get(f).push(u)}const a=new Float32Array(e.count),i=ab*ab,s=Math.max(1,Math.floor(e.count/300));for(let u=0;u<e.count;u+=s){const h=e.x[u],m=e.y[u],f=e.type[u],g=Math.floor((h+1)*vh/2),x=Math.floor((m+1)*vh/2);let v=0,b=0,w=0,M=0;for(let k=-1;k<=1;k++)for(let R=-1;R<=1;R++){const j=`${g+k},${x+R}`,I=r.get(j);if(I)for(const E of I){if(u===E)continue;const O=e.x[E]-h,L=e.y[E]-m;O*O+L*L<i&&(v++,e.type[E]===f&&(b++,w+=O,M+=L))}}if(b>=T4){w/=b,M/=b;const k=Math.sqrt(w*w+M*M),R=Math.max(0,1-k/.08);a[u]=b*.5+R*30+v*.2}}const c=Math.min(6,Math.ceil(e.count*.02)),l=[];for(let u=0;u<e.count;u+=s)a[u]>0&&l.push({idx:u,score:a[u]});l.sort((u,h)=>h.score-u.score);const d=[];for(const u of l){if(d.length>=c)break;const h=u.idx,m=e.type[h];if(d.filter(M=>M.type===m).length>=2)continue;const f=[],g=e.x[h],x=e.y[h],v=Math.floor((g+1)*vh/2),b=Math.floor((x+1)*vh/2),w=(ab*1.5)**2;for(let M=-1;M<=1;M++)for(let k=-1;k<=1;k++){const R=`${v+M},${b+k}`,j=r.get(R);if(j)for(const I of j){if(I===h||e.type[I]!==m)continue;const E=e.x[I]-g,O=e.y[I]-x;E*E+O*O<w&&f.push(I)}}f.length<T4||d.push({particleIndex:h,type:m,influence:Math.min(1,u.score/60),followers:f,bornAt:n,x:e.x[h],y:e.y[h]})}return d}function DH(e,t,n){for(const r of t){if(r.particleIndex>=e.count)continue;const a=e.x[r.particleIndex],i=e.y[r.particleIndex],s=r.influence*n*.008;for(const l of r.followers){if(l>=e.count)continue;const d=a-e.x[l],u=i-e.y[l],h=Math.sqrt(d*d+u*u);if(h>.005&&h<.4){const m=s*Math.min(1,h*5);e.vx[l]+=d/h*m,e.vy[l]+=u/h*m}}if(Math.sqrt(e.vx[r.particleIndex]**2+e.vy[r.particleIndex]**2)>.001){const l=1+r.influence*.02;e.vx[r.particleIndex]*=l,e.vy[r.particleIndex]*=l}}}function LH(e,t,n,r,a){if(t.length!==0){e.save();for(const i of t){const s=(i.x+1)*.5*n,c=(-i.y+1)*.5*r,l=a[i.type%a.length]||"#ffffff",d=3+i.influence*3,u=e.createRadialGradient(s,c,0,s,c,d*4);u.addColorStop(0,l),u.addColorStop(1,"transparent"),e.fillStyle=u,e.globalAlpha=.2,e.beginPath(),e.arc(s,c,d*4,0,Math.PI*2),e.fill(),e.fillStyle="#ffffff",e.globalAlpha=.6,e.beginPath(),e.arc(s,c,d*.6,0,Math.PI*2),e.fill()}e.restore()}}const zH={draft:"Draft (3 Mbps)",standard:"Standard (8 Mbps)",high:"High (20 Mbps)",ultra:"Ultra (40 Mbps)"},uy={auto:"Auto",webm:"WebM",mp4:"MP4",mov:"MOV (QT)"},BH={draft:3e6,standard:8e6,high:2e7,ultra:4e7};function YS(e){const t=Math.floor(e/60).toString().padStart(2,"0"),n=Math.floor(e%60).toString().padStart(2,"0");return`${t}:${n}`}function $H(e){if(e==="mp4"||e==="mov"||e==="auto"){const n=["video/mp4;codecs=avc1","video/mp4;codecs=h264","video/mp4"];for(const r of n)try{if(MediaRecorder.isTypeSupported(r))return{mime:r,ext:e==="mov"?"mov":"mp4"}}catch{}}const t=["video/webm;codecs=vp9,opus","video/webm;codecs=vp9","video/webm;codecs=vp8,opus","video/webm;codecs=vp8","video/webm"];for(const n of t)try{if(MediaRecorder.isTypeSupported(n))return{mime:n,ext:"webm"}}catch{}return{mime:"video/webm",ext:"webm"}}function Nj(e){const t=["video/mp4;codecs=avc1","video/mp4;codecs=h264","video/mp4"];for(const n of t)try{if(MediaRecorder.isTypeSupported(n))return!0}catch{}return!1}class Nf{constructor(t){this.recorder=null,this.chunks=[],this.rafId=0,this.startTime=0,this._state="idle",this._ext="webm",this._actualFmt="WebM",this.compositor=document.createElement("canvas"),this.ctx=this.compositor.getContext("2d",{alpha:!1}),this.onState=t}get state(){return this._state}get elapsed(){return this.startTime>0?(performance.now()-this.startTime)/1e3:0}get actualFmt(){return this._actualFmt}set(t){this._state=t,this.onState(t)}start(t,n,r=30,a,i={}){if(this._state!=="idle")return;const c=t().find(M=>M!=null);if(!c){console.warn("[CanvasRecorder] No source canvas");return}const l=Math.min(1920,c.clientWidth||window.innerWidth),d=Math.min(1080,c.clientHeight||window.innerHeight);this.compositor.width=l,this.compositor.height=d,this.chunks=[],this.startTime=performance.now();const u=i.format??"auto",h=i.quality??"standard",m=i.fps??r,{mime:f,ext:g}=$H(u),x=BH[h];this._ext=g,this._actualFmt=g==="mp4"?"MP4":g==="mov"?"MOV":"WebM";const v=this.compositor.captureStream(m);let b;a&&a.getAudioTracks().length>0?b=new MediaStream([...v.getVideoTracks(),...a.getAudioTracks()]):b=v;try{this.recorder=new MediaRecorder(b,{mimeType:f,videoBitsPerSecond:x})}catch{this.recorder=new MediaRecorder(b)}this.recorder.ondataavailable=M=>{M.data.size>0&&this.chunks.push(M.data)},this.recorder.onstop=()=>this.finalize(f),this.recorder.start(100),this.set("recording");const w=()=>{!this.recorder||this.recorder.state==="inactive"||(this.rafId=requestAnimationFrame(w),this.composite(t(),n()))};w()}stop(){var t;this._state==="recording"&&(cancelAnimationFrame(this.rafId),this.set("saving"),((t=this.recorder)==null?void 0:t.state)==="recording"&&this.recorder.stop())}composite(t,n){const{ctx:r,compositor:a}=this,i=a.width,s=a.height;r.fillStyle="#07050e",r.fillRect(0,0,i,s);for(const c of t)if(c)try{r.drawImage(c,0,0,i,s)}catch{}this.drawOverlay(n,i,s)}drawOverlay(t,n,r){const a=this.ctx,i=this.elapsed,s=14,c=15;a.save(),a.font="11px monospace";const l=`${t.labName}    ${YS(i)}`,d=a.measureText(l).width+20;if(a.globalAlpha=.7,a.fillStyle="rgba(7,5,14,0.85)",a.beginPath(),a.roundRect(s-5,s-13,d,21,4),a.fill(),a.globalAlpha=1,a.fillStyle="#c4b5fd",a.fillText(l,s,s),a.restore(),Math.floor(i*1.5)%2===0){a.save(),a.font="bold 10px monospace";const f=` REC  ${this._actualFmt}`,g=a.measureText(f).width+18;a.globalAlpha=.8,a.fillStyle="rgba(7,5,14,0.85)",a.beginPath(),a.roundRect(n-g-s,s-13,g,21,4),a.fill(),a.fillStyle="#f87171",a.fillText(f,n-a.measureText(f).width-s,s),a.restore()}if(t.lines.length===0)return;a.save(),a.font="10px monospace";const u=Math.max(...t.lines.map(f=>a.measureText(f).width)),h=t.lines.length*c+10,m=r-h-s+2;a.globalAlpha=.6,a.fillStyle="rgba(7,5,14,0.88)",a.beginPath(),a.roundRect(s-6,m-4,u+18,h,5),a.fill(),a.globalAlpha=.88;for(let f=0;f<t.lines.length;f++){const g=r-s-(t.lines.length-1-f)*c;a.fillStyle=f===0?"rgba(196,181,253,0.92)":"rgba(210,200,255,0.80)",a.fillText(t.lines[f],s,g)}a.restore()}finalize(t){const n=new Blob(this.chunks,{type:t}),r=URL.createObjectURL(n),a=document.createElement("a");a.href=r,a.download=`metalife-${new Date().toISOString().slice(0,19).replace(/[T:]/g,"-")}.${this._ext}`,document.body.appendChild(a),a.click(),document.body.removeChild(a),setTimeout(()=>URL.revokeObjectURL(r),6e4),this.chunks=[],this.set("idle")}dispose(){this.stop()}}const km=({state:e,elapsed:t,onStart:n,onStop:r,className:a="",showOptions:i=!1})=>{const[s,c]=S.useState("auto"),[l,d]=S.useState("standard"),[u,h]=S.useState(!1),[,m]=S.useState(0);S.useEffect(()=>{if(e!=="recording")return;const x=setInterval(()=>m(v=>v+1),1e3);return()=>clearInterval(x)},[e]);const f=Nj(),g={display:"flex",alignItems:"center",gap:4};return e==="saving"?o.jsxs("div",{className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg
        bg-black/60 border border-yellow-400/20 backdrop-blur-sm ${a}`,children:[o.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-yellow-400/70 animate-pulse"}),o.jsx("span",{className:"text-[8px] font-mono text-yellow-300/60 uppercase tracking-widest",children:"salvando"})]}):e==="recording"?o.jsxs("button",{onClick:r,title:"Parar gravao",className:`group flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg
          bg-red-950/70 border border-red-500/50 text-red-400
          hover:bg-red-900/80 hover:border-red-400/70 transition-all
          backdrop-blur-sm ${a}`,children:[o.jsx("span",{className:"w-2 h-2 rounded-sm bg-red-500 group-hover:bg-red-400 animate-pulse flex-shrink-0"}),o.jsx("span",{className:"text-[9px] font-mono tabular-nums",children:YS(t)}),o.jsx("span",{className:"text-[7px] font-mono text-red-400/50 tracking-widest uppercase ml-0.5",children:"parar"})]}):o.jsxs("div",{className:`relative flex flex-col gap-1 ${a}`,children:[i&&u&&o.jsxs("div",{className:`absolute bottom-full mb-1 right-0 z-50
          bg-black/90 border border-white/10 rounded-lg p-2 min-w-[160px]
          backdrop-blur-sm shadow-xl`,children:[o.jsxs("div",{className:"mb-2",children:[o.jsx("div",{className:"text-[7px] font-mono text-white/30 uppercase tracking-widest mb-1",children:"Formato"}),["auto","webm","mp4","mov"].map(x=>o.jsxs("button",{title:x,onClick:()=>c(x),className:`w-full text-left px-2 py-0.5 rounded text-[9px] font-mono transition-colors mb-0.5 flex items-center justify-between ${s===x?"bg-white/10 text-white/80":"text-white/35 hover:text-white/60 hover:bg-white/5"}`,children:[o.jsx("span",{children:uy[x]}),(x==="mp4"||x==="mov")&&!f&&o.jsx("span",{className:"text-[7px] text-yellow-500/60",children:"WebM"})]},x))]}),o.jsxs("div",{children:[o.jsx("div",{className:"text-[7px] font-mono text-white/30 uppercase tracking-widest mb-1",children:"Qualidade"}),["draft","standard","high","ultra"].map(x=>o.jsx("button",{title:x,onClick:()=>d(x),className:`w-full text-left px-2 py-0.5 rounded text-[9px] font-mono transition-colors mb-0.5 ${l===x?"bg-white/10 text-white/80":"text-white/35 hover:text-white/60 hover:bg-white/5"}`,children:zH[x]},x))]})]}),o.jsxs("div",{style:g,children:[i&&o.jsx("button",{onClick:()=>h(x=>!x),title:"Opes de gravao",className:`flex items-center gap-1 px-1.5 py-1.5 rounded-lg text-[7px] font-mono uppercase tracking-widest
              transition-all backdrop-blur-sm ${u?"bg-white/10 border border-white/20 text-white/70":"bg-black/50 border border-white/8 text-white/25 hover:text-white/50 hover:bg-black/70"}`,children:""}),o.jsxs("button",{onClick:()=>n({format:s,quality:l}),title:"Iniciar gravao do canvas",className:`group flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg
            bg-black/50 border border-white/10 text-white/35
            hover:bg-black/70 hover:border-purple-400/30 hover:text-white/65
            transition-all backdrop-blur-sm`,children:[o.jsx("span",{className:`w-2 h-2 rounded-full border border-current
            group-hover:border-red-400/70 group-hover:bg-red-500/20
            transition-colors flex-shrink-0`}),o.jsx("span",{className:"text-[8px] font-mono uppercase tracking-widest",children:"gravar"}),i&&o.jsxs("span",{className:"text-[7px] font-mono text-white/20 ml-0.5",children:[uy[s],"  ",l]})]})]})]})},rc=["#ff6b6b","#4ecdc4","#ffd93d","#6bcb77","#a78bfa"];function Wh(e){const t=[{name:"Poltico",sphere:"political",fieldSensitivity:{n:1.4,l:1.6,r:.6},ideologyBias:-.3,trustBias:.5,aggressionBias:.3,cohesionBias:.6,desireBias:.3},{name:"Mercador",sphere:"economic",fieldSensitivity:{n:.6,l:.8,r:1.8},ideologyBias:.2,trustBias:.4,aggressionBias:.2,cohesionBias:.4,desireBias:.6},{name:"Devoto",sphere:"religious",fieldSensitivity:{n:1.8,l:1.2,r:.4},ideologyBias:-.5,trustBias:.7,aggressionBias:.2,cohesionBias:.8,desireBias:.2},{name:"Artista",sphere:"artistic",fieldSensitivity:{n:.5,l:1,r:1},ideologyBias:.5,trustBias:.5,aggressionBias:.1,cohesionBias:.3,desireBias:.8},{name:"Cientfico",sphere:"scientific",fieldSensitivity:{n:1,l:1.4,r:1},ideologyBias:.3,trustBias:.6,aggressionBias:.1,cohesionBias:.5,desireBias:.5}];return Array.from({length:e},(n,r)=>({...t[r%t.length]}))}function I4(){return{agentCount:280,groupCount:3,speed:.52,friction:.87,rMax:.32,autonomy:.6,cohesion:.45,pressure:.4,aggressionBase:.28,trustBase:.52,needBase:.58,macroTickSec:1,kBelief:.45,kFear:.4,kDesire:.35,harvestRate:.09,decayWealth:.018,ideologyPressure:.2,conformity:.38,empathy:.32,mobility:.12,contagion:.4,hierarchyStrength:.45,innovationRate:.08,cooperationBias:.28,culturalInertia:.42,resourceScarcity:.55,boidsAlignment:.35,boidsCohesion:.28,wander:.28,impulseRate:.3,impulseStrength:.65,goalOvershoot:.18,zigzag:.2,panopticism:.5,violationThreshold:3,exceptionDuration:25,autoSymbols:!0,groupProfiles:Wh(3),worldHalf:2,startWithFamilies:!0,spawnRelationMode:"families",bondFormationRate:.04,birthMemoryStrength:.55,archetypeHoldSec:1.8,perceptionBias:.25,hybrisThreshold:.65,fervorThreshold:1.3,ethicsGrowth:.18,understandingGrowth:.15,ecoDegradation:.04,consensusDecay:.02}}function zg(){return{totems:[],tabus:[],rituals:[]}}function Bg(){return{exceptionActive:!1,exceptionStartTime:0,violationCount:0,violationsWindowStart:0,violationsWindow:0,meanWealth:.25,gini:0,rngState:1,nextFamilyId:1}}function $g(){return{cohesion:.2,polarization:.1,conflict:.05,consensus:.5,phase:"SWARM",leaderCount:0,rebelCount:0,meanFear:.1,meanBelief:.2,entropy:.5,meanPerception:.5,meanEthics:.05,meanHybris:.05,meanFervor:.05,meanUnderstanding:.05,meanEntanglement:.1,ecoHealth:1}}function sb(e){return e>=.72?2:e>=.42?1:0}function qH(e){const t=e.belief,n=e.fear,r=e.desire,a=e.resistance;return a>=t&&a>=n&&a>=r?3:t>=n&&t>=r?0:n>=r?1:2}function HH(e){return e<-.25?0:e>.25?2:1}function v0(e){const t=qH(e),n=t===0?e.belief:t===1?e.fear:t===2?e.desire:e.resistance,r=sb(n),a=sb(Math.max(e.status*.92+e.centrality*.55,e.status)),i=sb(e.aggression),s=HH(e.ideology),c=(e.memeId|0)&15;return(t&3|(r&3)<<2|(a&3)<<4|(i&3)<<6|(s&3)<<8|(c&15)<<10)>>>0}function WH(e){let t=(e^2654435769)>>>0;return t=Math.imul(t,2654435761)>>>0,t^=t>>>16,t=Math.imul(t,2246822507)>>>0,t^=t>>>13,t>>>0}function Bi(e){const t=WH(e),n=t%360,r=(72+(t>>>9)%10)/100,a=(52+(t>>>17)%10)/100,i=r*Math.min(a,1-a),s=c=>{const l=(c+n/30)%12,d=a-i*Math.max(-1,Math.min(l-3,9-l,1));return Math.round(d*255).toString(16).padStart(2,"0")};return`#${s(0)}${s(8)}${s(4)}`}function ib(e=32){const t=new Float32Array(e*e);t.fill(.22);const n={n:new Float32Array(e*e),l:new Float32Array(e*e),r:t,size:e,dirty:!0};return Kr(n,-.6,-.5,.45,.28),Kr(n,.55,.4,.4,.25),Kr(n,0,-.7,.35,.22),Kr(n,-.3,.65,.3,.2),n}function P4(){return{decayN:.018,decayL:.007,decayR:.004,diffuseN:.1,diffuseL:.05,diffuseR:.02,regenR:.02}}function F4(e,t){return Math.max(0,Math.min(t-1,(e+1)*.5*t|0))}function KS(e,t,n,r){const a=(n+1)*.5*(t-1),i=(r+1)*.5*(t-1),s=Math.max(0,Math.min(t-2,a|0)),c=Math.max(0,Math.min(t-2,i|0)),l=a-s,d=i-c,u=e[c*t+s],h=e[c*t+s+1],m=e[(c+1)*t+s],f=e[(c+1)*t+s+1];return u*(1-l)*(1-d)+h*l*(1-d)+m*(1-l)*d+f*l*d}function GH(e,t,n){return KS(e.n,e.size,t,n)}function VH(e,t,n){return KS(e.l,e.size,t,n)}function yc(e,t,n){return KS(e.r,e.size,t,n)}function XS(e,t,n,r,a,i){const s=F4(n,t),c=F4(r,t),l=Math.max(1,Math.ceil(i*t*.5));for(let d=-l;d<=l;d++)for(let u=-l;u<=l;u++){const h=s+u,m=c+d;if(h<0||h>=t||m<0||m>=t)continue;const f=Math.sqrt(u*u+d*d)/l;if(f>1)continue;const g=Math.exp(-f*f*3),x=m*t+h;e[x]=Math.max(0,Math.min(1,e[x]+a*g))}}function Na(e,t,n,r,a){XS(e.n,e.size,t,n,r,a)}function _o(e,t,n,r,a){XS(e.l,e.size,t,n,r,a)}function Kr(e,t,n,r,a){XS(e.r,e.size,t,n,r,a)}const _4=new Float32Array(1024*4);function lb(e,t,n,r,a,i){const s=t*t,c=_4.length>=s?_4:new Float32Array(s),l=r*i;for(let u=0;u<t;u++)for(let h=0;h<t;h++){const m=e[u*t+h];let f=-4*m;f+=u>0?e[(u-1)*t+h]:m,f+=u<t-1?e[(u+1)*t+h]:m,f+=h>0?e[u*t+h-1]:m,f+=h<t-1?e[u*t+h+1]:m,c[u*t+h]=m+l*f}const d=1-n*i;for(let u=0;u<s;u++)e[u]=Math.max(0,Math.min(1,c[u]*d+a*i))}function UH(e,t,n){lb(e.n,e.size,t.decayN,t.diffuseN,0,n),lb(e.l,e.size,t.decayL,t.diffuseL,0,n),lb(e.r,e.size,t.decayR,t.diffuseR,t.regenR,n),e.dirty=!0}function YH(e){e.n.fill(0),e.l.fill(0),e.r.fill(.28),e.dirty=!0}const Ga=10;function Oj(e,t,n){const r=new Map;for(let a=0;a<e.length;a++){const i=(e[a].x+n)/t|0,s=(e[a].y+n)/t|0,c=i*1024+s;let l=r.get(c);l||(l=[],r.set(c,l)),l.push(a)}return r}function cb(e,t,n,r,a,i,s){const c=t[e],l=(c.x+s)/a|0,d=(c.y+s)/a|0,u=r*r,h=[];e:for(let m=-2;m<=2;m++)for(let f=-2;f<=2;f++){const g=n.get((l+m)*1024+(d+f));if(g)for(const x of g){if(x===e)continue;const v=t[x].x-c.x,b=t[x].y-c.y;if(v*v+b*b<u&&(h.push(x),h.length>=i))break e}}return h}function N4(e,t,n){const{agentCount:r,groupCount:a}=e,i=[],s=u=>Math.max(-e.worldHalf*.95,Math.min(e.worldHalf*.95,u)),c=[],l=e.worldHalf;if(n==="unified_center")for(let u=0;u<a;u++)c.push([0,0]);else if(n==="corners"){const u=[[-.68*l,-.68*l],[.68*l,-.68*l],[.68*l,.68*l],[-.68*l,.68*l],[0,-.78*l],[.78*l,0],[0,.78*l],[-.78*l,0]];for(let h=0;h<a;h++)c.push(u[h%u.length])}else for(let u=0;u<a;u++){const h=u/a*Math.PI*2-Math.PI/2;c.push([Math.cos(h)*.52*l,Math.sin(h)*.52*l])}for(let u=0;u<r;u++){const h=u%a,[m,f]=c[h]??[0,0],g=t()*Math.PI*2,x=t()*.17*l+.02*l,v=e.groupProfiles[h%e.groupProfiles.length],b=v?v.ideologyBias+(t()-.5)*.6:h/Math.max(a-1,1)*2-1,w=Math.max(-1,Math.min(1,b));let M=m+Math.cos(g)*x,k=f+Math.sin(g)*x;if(n==="ring"){const pe=h/Math.max(a,1)*Math.PI*2-Math.PI/2,P=Math.PI*2/Math.max(a,1)*.8,V=pe+(t()-.5)*P,fe=(.55+(t()-.5)*.22)*l;M=Math.cos(V)*fe,k=Math.sin(V)*fe}else if(n==="line"){const pe=h/Math.max(a-1,1),P=t(),V=(t()-.5)*.28*l;M=(P-.5)*1.6*l+V,k=(pe-.5)*1.6*l+(P-.5)*.4*l+(t()-.5)*.12*l}else n==="random"&&(M=(t()-.5)*1.8*l*2,k=(t()-.5)*1.8*l*2);const R=t(),j=R<.1,I=!j&&R<.2,E=!I&&R<.3,O=!E&&R<.38,L=E?.65+t()*.28:O?.15+t()*.2:.18+t()*.55,$=I?.05+t()*.12:O?.08+t()*.2:j?.05+t()*.14:.05+t()*.55,F=I?.55+t()*.4:j?.3+t()*.35:.1+t()*.65,B=j?.25+t()*.35:E?.18+t()*.22:.02+t()*.12,W=O?.55+t()*.35:I?.22+t()*.3:j?.08+t()*.2:.05+t()*.4,re=j?.45+t()*.45:E?.35+t()*.35:t()*.3+.04,oe=I?.45+t()*.5:O?.2+t()*.3:.05+t()*.3,te={x:s(M),y:s(k),vx:(t()-.5)*.07,vy:(t()-.5)*.07,groupId:h,familyId:0,opinion:w,trust:Math.max(0,Math.min(1,e.trustBase*(v?.5+v.trustBias:1)+(t()-.5)*.35)),aggression:Math.max(0,Math.min(1,W*(v?.5+v.aggressionBias:1))),need:Math.max(0,Math.min(1,e.needBase+(t()-.5)*.3)),goalX:m,goalY:f,memory:[],centrality:0,hostileCount:0,birthX:s(M),birthY:s(k),originGroupId:h,originFamilyId:0,birthMemory:.45+t()*.5,entanglement:.05+t()*.12,auditThreat:0,auditResource:0,auditSocial:0,auditTransgression:0,auditMemoryPull:0,auditReason:"",belief:Math.max(0,Math.min(1,L)),fear:Math.max(0,Math.min(1,$)),desire:Math.max(0,Math.min(1,F*(v?.5+v.desireBias:1))),status:Math.max(0,Math.min(1,B)),wealth:.12+t()*.3,ideology:w,fatigue:.03+t()*.07,conformity:Math.max(0,Math.min(1,(E?.6:I?.08:e.conformity)+(t()-.5)*.3)),empathy:Math.max(0,Math.min(1,e.empathy+(t()-.5)*.3)),charisma:Math.max(0,Math.min(1,re)),groupLoyalty:I?.12+t()*.22:(v?v.cohesionBias*.4+.25:.35)+t()*.45,memeId:h,visibility:0,resistance:Math.max(0,Math.min(1,oe)),trailX:new Float32Array(15).fill(s(M)),trailY:new Float32Array(15).fill(s(k)),trailIdx:0,lastGroupChange:0,archKeyMoment:0,archKeyStable:0,archKeyCandidate:0,archCandidateAt:0,archStableAt:0,perception:.35+t()*.4,hybris:j?.15+t()*.2:.02+t()*.08,fervor:E?.12+t()*.15:.01+t()*.05,ethics:.05+t()*.15,understanding:.05+t()*.15,ecoFootprint:0,currentActivity:""},J=v0(te);te.archKeyMoment=J,te.archKeyStable=J,te.archKeyCandidate=J,i.push(te)}const d=e.spawnRelationMode??(e.startWithFamilies?"families":"none");if(d==="families"){const u=new Map;for(let x=0;x<i.length;x++)u.set(i[x].groupId,(u.get(i[x].groupId)??[]).concat(x));let h=1;const m=3,f=6,g=.35;u.forEach(x=>{for(let b=x.length-1;b>0;b--){const w=t()*(b+1)|0;[x[b],x[w]]=[x[w],x[b]]}let v=0;for(;v<x.length;){const b=Math.min(f,m+t()*(f-m+1)|0),w=x.slice(v,v+b);if(v+=b,w.length<2)continue;const M=h++;let k=0,R=0;for(const j of w)i[j].familyId=M,k+=i[j].x,R+=i[j].y;k/=w.length,R/=w.length;for(const j of w){const I=i[j];I.x=s(I.x+(k-I.x)*g),I.y=s(I.y+(R-I.y)*g),I.trailX.fill(I.x),I.trailY.fill(I.y)}}})}else if(d==="sparse"){const u=new Map;for(let m=0;m<i.length;m++)u.set(i[m].groupId,(u.get(i[m].groupId)??[]).concat(m));let h=1;u.forEach(m=>{for(let g=m.length-1;g>0;g--){const x=t()*(g+1)|0;[m[g],m[x]]=[m[x],m[g]]}const f=Math.min(2,Math.floor(m.length/2));for(let g=0;g<f;g++){const x=m[g*2],v=m[g*2+1];if(x===void 0||v===void 0)continue;const b=h++;i[x].familyId=b,i[v].familyId=b}})}for(const u of i)u.originFamilyId=u.familyId;return i}const KH=.014,XH=.012,JH=1.2,QH=.2,Dj=.08;function qg(e){return KH+e.status*XH}function ZH(e,t){return Oj(e,Dj,t)}function eW(e,t,n,r,a){const{friction:i,speed:s,autonomy:c}=n,l=Dj;for(let d=0;d<e.length;d++){const u=e[d],h=qg(u);let m=0,f=0,g=0,x=0,v=0,b=0,w=0,M=0;const k=(u.x+n.worldHalf)/l|0,R=(u.y+n.worldHalf)/l|0;for(let P=-1;P<=1;P++)for(let V=-1;V<=1;V++){const fe=t.get((k+P)*1024+(R+V));if(fe)for(const ye of fe){if(ye===d)continue;const Se=e[ye],we=qg(Se),ke=h+we,De=u.x-Se.x,_e=u.y-Se.y,ae=De*De+_e*_e;if(ae<ke*ke&&ae>1e-9){const Fe=Math.sqrt(ae),ne=(ke-Fe)/ke,nt=ne*ne*JH;m+=De/Fe*nt,f+=_e/Fe*nt}const Re=ke*ke*4;Se.groupId===u.groupId&&ae<Re&&(g+=Se.vx,x+=Se.vy,v++,b+=Se.x,w+=Se.y,M++)}}if(v>0&&(g/=v,x/=v,m+=(g-u.vx)*n.boidsAlignment*(.55*Ga),f+=(x-u.vy)*n.boidsAlignment*(.55*Ga)),M>0){b/=M,w/=M;const P=b-u.x,V=w-u.y,fe=Math.sqrt(P*P+V*V)+.001;m+=P/fe*n.boidsCohesion*(.42*Ga),f+=V/fe*n.boidsCohesion*(.42*Ga)}const j=u.goalX-u.x,I=u.goalY-u.y,E=Math.sqrt(j*j+I*I)+.001,O=Math.min(.9,Math.max(0,(n.goalOvershoot||0)*Ga)),L=j*(1+O),$=I*(1+O),F=Math.sqrt(L*L+$*$)+.001,B=Math.min(F/.5,1),W=1+u.fear*.6;m+=L/F*c*s*2.2*B*W,f+=$/F*c*s*2.2*B*W;const re=Math.max(0,n.zigzag||0);if(re>.001){const P=-$/F,V=L/F,fe=Ru(r)*re*s*(1.35*Ga)*(.6+B*.8);m+=P*fe,f+=V*fe}const oe=Math.max(0,n.wander||0);oe>.001&&(m+=Ru(r)*oe*s*(1.55*Ga),f+=Ru(r)*oe*s*(1.55*Ga));const te=Math.max(0,n.impulseRate||0),J=Math.max(0,n.impulseStrength||0);if(te>.001&&J>.001&&zs(r)<te*a){const P=(.35+.65*zs(r))*J*s*(2.2*Ga),V=-I/E,fe=j/E,ye=zs(r)<.5?-1:1;u.vx+=V*P*ye-u.vx*(.15+.25*J),u.vy+=fe*P*ye-u.vy*(.15+.25*J)}u.vx=(u.vx+m*a)*i,u.vy=(u.vy+f*a)*i;const pe=Math.sqrt(u.vx*u.vx+u.vy*u.vy);if(pe>s*1.4){const P=s*1.4/pe;u.vx*=P,u.vy*=P}u.x+=u.vx*a,u.y+=u.vy*a,u.x<-n.worldHalf*.95&&(u.x=-n.worldHalf*.95,u.vx=Math.abs(u.vx)*.4),u.x>n.worldHalf*.95&&(u.x=n.worldHalf*.95,u.vx=-Math.abs(u.vx)*.4),u.y<-n.worldHalf*.95&&(u.y=-n.worldHalf*.95,u.vy=Math.abs(u.vy)*.4),u.y>n.worldHalf*.95&&(u.y=n.worldHalf*.95,u.vy=-Math.abs(u.vy)*.4),u.trailX[u.trailIdx]=u.x,u.trailY[u.trailIdx]=u.y,u.trailIdx=(u.trailIdx+1)%15}for(let d=0;d<e.length;d++){const u=e[d],h=qg(u),m=(u.x+n.worldHalf)/l|0,f=(u.y+n.worldHalf)/l|0;for(let g=-1;g<=1;g++)for(let x=-1;x<=1;x++){const v=t.get((m+g)*1024+(f+x));if(v)for(const b of v){if(b<=d)continue;const w=e[b],M=qg(w),k=h+M,R=u.x-w.x,j=u.y-w.y,I=R*R+j*j;if(I<k*k&&I>1e-12){const E=Math.sqrt(I),O=(k-E)*QH,L=1/E,$=O*.5;u.x+=R*L*$,u.y+=j*L*$,w.x-=R*L*$,w.y-=j*L*$}}}}}const Hg=12,tW=6;function zs(e){return e.rngState=Math.imul(e.rngState>>>0,1664525)+1013904223>>>0,e.rngState/4294967296}function Ru(e){return zs(e)-.5}function nW(e,t,n,r,a,i,s,c,l){const d=[];UH(r,a,c),rW(n,r,i,s,c,l,d);const u=Oj(e,t.rMax*1.1,t.worldHalf),h=cW(e,t.groupCount),m=e.reduce((v,b)=>v+b.x,0)/(e.length||1),f=e.reduce((v,b)=>v+b.y,0)/(e.length||1),g=hy(e,t);for(let v=0;v<e.length;v++){const b=e[v],w=cb(v,e,u,t.rMax,t.rMax*1.1,Hg,t.worldHalf),M=t.groupProfiles[b.groupId%t.groupProfiles.length],k=M?M.fieldSensitivity.n:1,R=M?M.fieldSensitivity.l:1,j=M?M.fieldSensitivity.r:1,I=Bn(GH(r,b.x/t.worldHalf,b.y/t.worldHalf)*k,0,1),E=Bn(VH(r,b.x/t.worldHalf,b.y/t.worldHalf)*R,0,1),O=Bn(yc(r,b.x/t.worldHalf,b.y/t.worldHalf)*j,0,1);b.visibility=0;for(const Ee of n.totems)if(Ee.kind==="PANOPTICON"){const me=Ee.x-b.x,je=Ee.y-b.y,Te=me*me+je*je;if(Te<Ee.radius*Ee.radius){const Ae=Math.sqrt(Te);b.visibility=Math.max(b.visibility,1-Ae/Ee.radius)}}const L=b.visibility*t.panopticism;L>0?(b.fear=Bn(b.fear+L*.1*c,0,1),b.conformity=Bn(b.conformity+L*.05*c,0,1),b.ideology>0&&b.desire>.5&&(b.resistance=Bn(b.resistance+L*.15*c,0,1))):b.resistance=Bn(b.resistance-.02*c,0,1),b.resistance>.8&&(b.conformity=Bn(b.conformity-.1*c,0,1),b.aggression=Bn(b.aggression+.05*c,0,1),b.belief=Bn(b.belief-.1*c,0,1));const $=t.perceptionBias,F=Math.abs(b.ideology)*.3+b.fear*.25+b.hybris*.45,B=.003+b.ethics*.004,W=F*$*.08,re=(.55-b.perception)*.02;b.perception=Bn(b.perception+(B-W+re)*c,.2,1);const oe=(1-b.perception)*.6,te=I*(1-oe)+oe*(b.belief*.4+.3),J=E*(1-oe)+oe*(b.status*.3+.2);O*(1-oe)+oe*(b.wealth*.3+.3);const pe=(t.kBelief*te*(1-b.desire*.7)-.05*b.desire)*c;b.belief=Bn(b.belief+pe,0,1);const P=t.kFear*te*(1-b.belief*.8),V=.12*(b.hostileCount/3),fe=-.15*J*b.belief;b.fear=Bn(b.fear+(P+V+fe)*c-.08*c,0,1);const ye=(t.kDesire*(1-te)*.7+.1*(1-b.wealth))*c-.06*c;b.desire=Bn(b.desire+ye,0,1);const Se=t.harvestRate*O*c;b.wealth=Bn(b.wealth+Se-t.decayWealth*c,0,1),Se>.001&&(Kr(r,b.x,b.y,-Se*.6,.08),b.ecoFootprint=Bn(b.ecoFootprint+Se*t.ecoDegradation*.3,0,1),b.ecoFootprint>.5&&Kr(r,b.x,b.y,-b.ecoFootprint*.003*c,.12));const we=E,ke=(.08*b.centrality+.05*b.wealth*we+.03*E)*c;if(b.status=Bn(b.status*(1-.015*c)+ke,0,1),b.status>t.hybrisThreshold){const Ee=(b.status-t.hybrisThreshold)*.08*(1-b.ethics*.6)*c;b.hybris=Bn(b.hybris+Ee,0,1)}else b.hybris=Bn(b.hybris-.03*c,0,1);b.hybris>.4&&(b.aggression=Bn(b.aggression+b.hybris*.04*c,0,1),b.trust=Bn(b.trust-b.hybris*.03*c,0,1),b.perception=Bn(b.perception-b.hybris*.025*c,.2,1));const De=b.belief+b.fear;if(De>t.fervorThreshold){const Ee=(De-t.fervorThreshold)*.12*c;b.fervor=Bn(b.fervor+Ee,0,1)}else b.fervor=Bn(b.fervor-.06*c,0,1);b.fervor>.5&&(b.conformity=Bn(b.conformity+b.fervor*.03*c,0,1),b.perception=Bn(b.perception-b.fervor*.03*c,.2,1),zs(i)<b.fervor*.02&&(b.aggression=Bn(b.aggression+.08,0,1)));let _e=0,ae=0;for(const Ee of w){const me=e[Ee],je=me.status+.1;_e+=me.ideology*je,ae+=je}if(ae>0){const Ee=_e/ae-b.ideology;b.ideology=Bn(b.ideology+Ee*t.ideologyPressure*Ga*c,-1,1)}b.opinion=b.ideology;const Re=n.rituals.some(Ee=>(b.x-Ee.x)**2+(b.y-Ee.y)**2<Ee.radius**2)?1:0,Fe=(.08*(b.hostileCount/3)+.04*Re-.06*O)*c;b.fatigue=Bn(b.fatigue+Fe,0,1);const Oe=t.conformity*b.conformity*(I-b.belief)*(.15*Ga);b.belief=Bn(b.belief+Oe*c,0,1);const ne=Math.max(0,1-t.culturalInertia*(.7*Ga));b.hostileCount=0;let nt=0,pt=b.opinion,Et=1,_t=b.x,Ct=b.y,Xe=0,Ut=0,Le=0,Ke=0,mt=0,an=0,gn=0,Be=0;for(const Ee of w){const me=e[Ee];Xe++;const je=(.35+me.centrality*.65)*me.status*(.55+me.charisma),Te=me.status>.72&&me.centrality>.28&&me.aggression>.62&&me.belief>.55&&me.ideology<-.15,Ae=me.belief>.7&&me.status>.45&&me.charisma>.4&&me.aggression<.55;if(Te?an+=je*(.9+me.aggression*.6):an+=je*me.aggression*(me.ideology<-.15?.85:.45),Ae?gn+=je*1.05:gn+=je*me.belief*(me.ideology<-.15?.85:.55),me.groupId===b.groupId){nt++;const xt=1+t.hierarchyStrength*me.status*me.charisma*Ga;pt+=me.opinion*me.trust*xt,Et+=xt,_t+=me.x,Ct+=me.y,db(b,Ee,!0,s),Be+=.015+(b.familyId!==0&&b.familyId===me.familyId?.03:0)}else if(me.aggression>.5||b.aggression>.5)b.hostileCount++,db(b,Ee,!1,s),Be+=.004;else{const en=.1+t.hierarchyStrength*me.status*(.3*Ga);pt+=me.opinion*en,Et+=en,db(b,Ee,!0,s),Be+=.01+b.empathy*.01}const Tt=b.empathy*t.empathy;Ut+=me.fear*Tt,Le+=me.desire*Tt,Ke+=me.belief*Tt,mt++}b.centrality=Math.min(1,Xe/Hg);const ft=Xe>0?Be/Xe:0,Qt=(.028+(1-Math.min(1,Xe/6))*.018)*c;if(b.entanglement=Bn(b.entanglement*(1-Qt)+ft*(.2+b.birthMemory*.18)*c,0,1),Xe>0){const Ee=1/Xe,me=Math.max(0,Math.min(1,an*Ee)),je=Math.max(0,Math.min(1,gn*Ee)),Te=1-b.resistance*.65;b.fear=Bn(b.fear+me*.1*c*Te,0,1),b.conformity=Bn(b.conformity+me*.06*c*Te,0,1);const Ae=1-b.desire*.55;b.belief=Bn(b.belief+je*.08*c*Ae,0,1),b.fear=Bn(b.fear-je*b.belief*.05*c,0,1)}if(mt>0){const Ee=.025*Ga*c;b.fear=Bn(b.fear+(Ut/mt-b.fear)*Ee,0,1),b.desire=Bn(b.desire+(Le/mt-b.desire)*Ee,0,1),b.belief=Bn(b.belief+(Ke/mt-b.belief)*Ee*.4,0,1)}const nr=b.memory.filter(Ee=>Ee.agentIdx<e.length&&e[Ee.agentIdx].groupId!==b.groupId&&Ee.friendly).length;if(nr>=1||b.entanglement>.42&&Xe>=3){const Ee=t.understandingGrowth*(.03+nr*.02+(b.entanglement>.5?.015:0))*(1-b.understanding);b.understanding=Bn(b.understanding+Ee*c,0,1)}else b.understanding=Bn(b.understanding-(.003+(nr===0?.001:0))*c,0,1);if(b.understanding>.15&&(b.aggression=Bn(b.aggression-b.understanding*.05*c,0,1),b.empathy=Bn(b.empathy+b.understanding*.03*c,0,1)),b.understanding>.08&&nr>=1||b.understanding>.2){const Ee=t.ethicsGrowth*(.02+b.understanding*.05+nr*.01)*(1-b.ethics)*c;b.ethics=Bn(b.ethics+Ee,0,1)}if(b.ethics=Bn(b.ethics-.0015*c,0,1),b.ethics>.15&&(b.hybris=Bn(b.hybris-b.ethics*.06*c,0,1),b.aggression=Bn(b.aggression-b.ethics*.04*c,0,1)),t.contagion>0&&w.length>0){const Ee=[];for(const Te of w){const Ae=e[Te].memeId;Ee[Ae]=(Ee[Ae]||0)+1+e[Te].charisma*t.hierarchyStrength*Ga}let me=b.memeId,je=0;for(let Te=0;Te<Ee.length;Te++)Ee[Te]>je&&(je=Ee[Te],me=Te);me!==b.memeId&&zs(i)<Math.min(1,t.contagion*(.12*Ga)*(1-t.culturalInertia*.6))&&(b.memeId=me)}if(t.innovationRate>0&&zs(i)<Math.min(1,t.innovationRate*(.03*Ga))&&(b.ideology=Bn(b.ideology+Ru(i)*.4,-1,1),b.desire=Bn(b.desire+.05,0,1)),t.cooperationBias>0&&b.wealth>.3)for(const Ee of w){const me=e[Ee];if(me.groupId===b.groupId&&me.wealth<b.wealth-.1){const je=t.cooperationBias*(.02*Ga)*c;b.wealth=Bn(b.wealth-je,0,1),me.wealth=Bn(me.wealth+je,0,1)}}if(Et>1){const Ee=(pt/Et-b.opinion)*t.pressure*(.3*Ga)*ne*c/t.macroTickSec;b.opinion=Bn(b.opinion+Ee,-1,1)}const _n=h[b.groupId]??h[0]??[0,0,1],[Rn,sn]=_n,Cn=nt>0?_t/(nt+1):Rn,wt=nt>0?Ct/(nt+1):sn,st=Bn(b.fear*.7+Math.min(1,b.hostileCount/3)*.6+(i.exceptionActive?.2:0),0,1),Zt=Bn(Math.max(0,.6-b.wealth)*1.2,0,1),Pe=Bn(b.need*.7+t.cohesion*.4+b.entanglement*.25,0,1),ct=Bn(b.desire*(1-b.fear*.7),0,1);b.auditThreat=st,b.auditResource=Zt,b.auditSocial=Pe,b.auditTransgression=ct,b.auditMemoryPull=0,b.auditReason="";let vt=0,xe=0;if(Math.abs(b.ideology)>.5)for(const Ee of w){const me=e[Ee];Math.sign(me.ideology)!==Math.sign(b.ideology)&&Math.abs(me.ideology-b.ideology)>.7&&(vt+=b.x-me.x,xe+=b.y-me.y)}if(i.exceptionActive)b.belief>.5?(b.goalX=Cn,b.goalY=wt,b.currentActivity="Exceo: proteo do grupo",b.auditReason=`ameaa institucional ${st.toFixed(2)}`):(b.goalX=Rn*.3+m*.7,b.goalY=sn*.3+f*.7,b.currentActivity="Exceo: evaso territorial",b.auditReason=`evaso por exceo ${st.toFixed(2)}`);else if(b.fear>.55){let Ee=0,me=0,je=0;for(const Te of w){const Ae=e[Te];Ae.groupId!==b.groupId&&Ae.aggression>.4&&(Ee+=b.x-Ae.x,me+=b.y-Ae.y,je++)}if(je>0){const Te=Math.sqrt(Ee*Ee+me*me)+.001;b.goalX=b.x+Ee/Te*.3+Rn*.7,b.goalY=b.y+me/Te*.3+sn*.7,b.currentActivity="Fuga ttica (ameaa externa)",b.auditReason=`hostilidade local ${st.toFixed(2)}`}else b.goalX=Rn,b.goalY=sn,b.currentActivity="Reagrupamento preventivo",b.auditReason=`medo alto, sem alvo hostil claro (${st.toFixed(2)})`}else if(b.wealth<.25){let Ee=O,me=m,je=f;for(const Te of w){const Ae=yc(r,e[Te].x/t.worldHalf,e[Te].y/t.worldHalf);Ae>Ee&&(Ee=Ae,me=e[Te].x,je=e[Te].y)}b.goalX=me*.6+Cn*.4,b.goalY=je*.6+wt*.4,b.currentActivity="Forrageando (escassez crtica)",b.auditReason=`escassez crtica ${Zt.toFixed(2)}`}else if(b.wealth<.42){const me=t.worldHalf,je=yc(r,(b.x+.22)/me,b.y/me),Te=yc(r,(b.x-.22)/me,b.y/me),Ae=yc(r,b.x/me,(b.y+.22)/me),Tt=yc(r,b.x/me,(b.y-.22)/me);let xt=0,en=0;if(je>O&&je>=Te&&je>=Ae&&je>=Tt?xt=1:Te>O&&Te>=Ae&&Te>=Tt&&(xt=-1),Ae>O&&Ae>=Tt&&(en===0||Ae>Math.max(je,Te))?en=1:Tt>O&&(en===0||Tt>Math.max(je,Te))&&(en=-1),xt!==0||en!==0){const At=Math.sqrt(xt*xt+en*en)||1,Ze=.5*me;b.goalX=b.x+xt/At*Ze,b.goalY=b.y+en/At*Ze,b.currentActivity="Forrageando (gradiente R)",b.auditReason=`busca por gradiente R (${Zt.toFixed(2)})`}else b.goalX=Cn*.5+m*.5,b.goalY=wt*.5+f*.5,b.currentActivity="Coordenao local (sem hotspot)",b.auditReason=`sem hotspot; social ${Pe.toFixed(2)}`}else if(b.wealth<.55&&(b.groupId%2===0||b.need<.4)){const me=t.worldHalf,je=yc(r,(b.x+.18)/me,b.y/me),Te=yc(r,(b.x-.18)/me,b.y/me),Ae=yc(r,b.x/me,(b.y+.18)/me),Tt=yc(r,b.x/me,(b.y-.18)/me),xt=Math.max(O,je,Te,Ae,Tt);if(xt>O+.05){let en=0,At=0;if(je===xt?en=1:Te===xt&&(en=-1),Ae===xt?At=1:Tt===xt&&(At=-1),en!==0||At!==0){const Ze=Math.sqrt(en*en+At*At)||1;b.goalX=b.x+en/Ze*.35*me,b.goalY=b.y+At/Ze*.35*me,b.currentActivity="Busca oportunista de recurso",b.auditReason=`escassez moderada ${Zt.toFixed(2)}`}else b.goalX=Cn,b.goalY=wt,b.currentActivity="Coeso intra-grupo",b.auditReason=`coeso ${Pe.toFixed(2)}`}else b.goalX=Cn,b.goalY=wt,b.currentActivity="Coeso intra-grupo",b.auditReason=`coeso ${Pe.toFixed(2)}`}else if(b.desire>.65&&b.fear<.3){const Ee=n.tabus[0];Ee?(b.goalX=Ee.x+(b.x-Ee.x)*.4,b.goalY=Ee.y+(b.y-Ee.y)*.4,b.currentActivity="Transgresso: borda do tabu",b.auditReason=`impulso transgressivo ${ct.toFixed(2)}`):(b.goalX=Ru(i)*t.worldHalf*.7,b.goalY=Ru(i)*t.worldHalf*.7,b.currentActivity="Explorao livre",b.auditReason=`novidade/desejo ${ct.toFixed(2)}`)}else if(b.need>.62||t.cohesion>.68)b.goalX=Cn,b.goalY=wt,b.currentActivity=b.need>.65?"Busca de pertencimento":"Coeso intra-grupo",b.auditReason=`fora social ${Pe.toFixed(2)}`;else{const Ee=Rn*.5+m*.5,me=sn*.5+f*.5;b.goalX=b.goalX*.7+Ee*.3,b.goalY=b.goalY*.7+me*.3,b.currentActivity="Deriva social",b.auditReason="equilbrio baixo de drivers"}if(t.birthMemoryStrength>0){const Ee=Math.max(b.fear,b.fatigue),me=Math.max(0,.18-b.wealth)/.18,je=Math.max(0,Ee-.62)/.38,Te=Math.max(je,me),Ae=b.birthX-b.x,Tt=b.birthY-b.y,xt=Math.sqrt(Ae*Ae+Tt*Tt),en=b.currentActivity==="Deriva social"||b.currentActivity==="Coeso intra-grupo"||b.currentActivity==="Busca de pertencimento"||b.currentActivity==="Reagrupamento preventivo";if(Te>.28&&xt>t.worldHalf*.24&&en&&zs(i)<(.18+.62*Te)*b.birthMemory){const At=t.birthMemoryStrength*b.birthMemory*Te*.7;b.goalX=b.goalX*(1-At)+b.birthX*At,b.goalY=b.goalY*(1-At)+b.birthY*At,b.auditMemoryPull=At,At>.1&&(b.currentActivity="Retorno  origem (memria profunda)",b.auditReason=`memria de origem ${At.toFixed(2)} (estresse/escassez)`)}}for(const Ee of n.tabus){const me=b.x-Ee.x,je=b.y-Ee.y,Te=me*me+je*je;if(Te<Ee.radius*Ee.radius){if(Ee.kind==="NO_ENTER"){const Ae=Math.sqrt(Te)+.001;b.goalX=Ee.x+me/Ae*(Ee.radius+.1),b.goalY=Ee.y+je/Ae*(Ee.radius+.1)}else if(Ee.kind==="NO_MIX")for(const Ae of w){const Tt=e[Ae];if(Tt.groupId!==b.groupId){const xt=b.x-Tt.x,en=b.y-Tt.y,At=Math.sqrt(xt*xt+en*en)+.001;b.goalX+=xt/At*.2,b.goalY+=en/At*.2}}}}for(const Ee of n.totems){const me=Ee.x-b.x,je=Ee.y-b.y;me*me+je*je<Ee.radius*Ee.radius&&(Ee.kind==="BOND"&&b.belief>.35?(b.goalX=b.goalX*.5+Ee.x*.5,b.goalY=b.goalY*.5+Ee.y*.5):Ee.kind==="RIFT"&&b.groupId===Ee.groupId?(b.goalX=b.goalX*.4+Ee.x*.6,b.goalY=b.goalY*.4+Ee.y*.6):Ee.kind==="ORACLE"&&b.status>.2?(b.goalX=b.goalX*.6+Ee.x*.4,b.goalY=b.goalY*.6+Ee.y*.4,b.belief=Bn(b.belief+.02*c,0,1)):Ee.kind==="ARCHIVE"&&(b.groupLoyalty=Bn(b.groupLoyalty+.01*c,0,1),b.conformity=Bn(b.conformity+.008*c,0,1)))}const ge=v0(b);if(b.archKeyMoment=ge,ge!==b.archKeyCandidate)b.archKeyCandidate=ge,b.archCandidateAt=s;else if(ge!==b.archKeyStable){const Ee=Math.max(.2,t.archetypeHoldSec||0);s-b.archCandidateAt>=Ee&&(b.archKeyStable=ge,b.archStableAt=s)}if(vt!==0||xe!==0){const Ee=Math.sqrt(vt*vt+xe*xe)+.001,me=Math.min(1,Math.abs(b.ideology)*.5);b.goalX=b.goalX*.65+(b.x+vt/Ee*.45)*.35*me+b.goalX*(1-me)*.35,b.goalY=b.goalY*.65+(b.y+xe/Ee*.45)*.35*me+b.goalY*(1-me)*.35}b.goalX=Bn(b.goalX,-t.worldHalf*.95,t.worldHalf*.95),b.goalY=Bn(b.goalY,-t.worldHalf*.95,t.worldHalf*.95)}const x=t.bondFormationRate??0;if(x>0){const v=[];for(let M=0;M<e.length;M++){const k=e[M],R=cb(M,e,u,t.rMax,t.rMax*1.1,Hg,t.worldHalf);for(const j of R){if(j<=M)continue;const I=e[j];if(k.familyId!==0&&I.familyId!==0&&k.familyId===I.familyId)continue;const E=k.memory.some(J=>J.agentIdx===j&&J.friendly)||I.memory.some(J=>J.agentIdx===M&&J.friendly);if(k.memory.some(J=>J.agentIdx===j&&!J.friendly)||I.memory.some(J=>J.agentIdx===M&&!J.friendly))continue;const L=1-Math.min(1,Math.abs(k.ideology-I.ideology)/2),$=k.birthX-I.birthX,F=k.birthY-I.birthY,B=Math.sqrt($*$+F*F),W=1-Math.min(1,B/(t.worldHalf*1.2)),re=(k.originGroupId===I.originGroupId?.14:0)+(k.originFamilyId!==0&&k.originFamilyId===I.originFamilyId?.16:0),oe=(k.entanglement+I.entanglement)*.5,te=L*.34+W*.24+oe*.22+(E?.2:0)+re;te>.34&&v.push({i:M,j,coh:Math.min(1,te)})}}for(let M=v.length-1;M>0;M--){const k=zs(i)*(M+1)|0;[v[M],v[k]]=[v[k],v[M]]}v.sort((M,k)=>k.coh-M.coh);const b=Math.max(1,Math.min(6,Math.floor(e.length/120)));let w=0;for(const M of v){if(w>=b)break;const k=e[M.i],R=e[M.j];if(k.familyId!==0&&R.familyId!==0&&k.familyId===R.familyId)continue;const j=Math.min(.95,x*(.75+M.coh*1.25));if(!(zs(i)>=j)){if(k.familyId===0&&R.familyId===0){const I=i.nextFamilyId??1;i.nextFamilyId=I+1,k.familyId=I,R.familyId=I}else if(k.familyId!==0&&R.familyId===0)R.familyId=k.familyId;else if(k.familyId===0&&R.familyId!==0)k.familyId=R.familyId;else continue;k.entanglement=Bn(k.entanglement+.015,0,1),R.entanglement=Bn(R.entanglement+.015,0,1),w++}}w>0&&d.push({time:s,icon:"",message:w>1?`Laos formados ${w}`:"Lao formado",color:"#34d399",cause:"Entanglement orgnico por proximidade, memria social e coerncia de origem."})}if(oW(e,n,i,s,l,d),aW(e,i),sW(i,t,r,s,d),t.mobility>0)for(let v=0;v<e.length;v++){const b=e[v];if(zs(i)>t.mobility*(.02*Ga)*(1-b.groupLoyalty))continue;const w=cb(v,e,u,t.rMax,t.rMax*1.1,Hg,t.worldHalf),M=new Array(t.groupCount).fill(0);for(const j of w)M[e[j].groupId]++;let k=b.groupId,R=M[b.groupId]||0;for(let j=0;j<t.groupCount;j++)j!==b.groupId&&M[j]>R&&(k=j,R=M[j]);if(k!==b.groupId&&R>=3){const j=b.groupId;b.groupId=k,b.groupLoyalty*=.7,b.memeId=k,d.push({time:s,icon:"",message:`Agent migrated G${j}G${k}`,color:rc[k]||"#fff"})}}if(t.resourceScarcity<.5){const v=(.5-t.resourceScarcity)*.008*c;for(let b=0;b<r.r.length;b++)r.r[b]=Math.max(0,r.r[b]-v);r.dirty=!0}if(hy(e,t).consensus>.9&&t.consensusDecay>0)for(let b=0;b<e.length;b++){const w=e[b];zs(i)<t.consensusDecay*.03&&(w.desire=Bn(w.desire+.05,0,1),w.ideology=Bn(w.ideology+Ru(i)*.15,-1,1))}return iW(e,i),lW(e,t,g,i,s,l,d,n),t.autoSymbols&&hW(e,t,n,i,s,l,d),d}function rW(e,t,n,r,a,i,s){const c=n.exceptionActive?1.6:1;for(const l of e.totems){const d=l.pulseStrength*a*c;if(l.kind==="BOND")Na(t,l.x,l.y,d*1.2,l.radius),_o(t,l.x,l.y,d*.8,l.radius);else if(l.kind==="RIFT")Na(t,l.x,l.y,-d*.9,l.radius*.7),_o(t,l.x,l.y,d*1.1,l.radius);else if(l.kind==="ORACLE")_o(t,l.x,l.y,d*1.4,l.radius),Na(t,l.x,l.y,d*.3,l.radius*.5);else if(l.kind==="PANOPTICON")Na(t,l.x,l.y,d*1.5,l.radius*1.2);else if(l.kind==="ARCHIVE"){const u=Math.floor((l.x+1)*t.size/2),h=Math.floor((l.y+1)*t.size/2),m=Math.ceil(l.radius*t.size/2);for(let f=-m;f<=m;f++)for(let g=-m;g<=m;g++){const x=(h+g)*t.size+(u+f);x>=0&&x<t.n.length&&(t.n[x]=Math.min(1,t.n[x]+.003*a),t.l[x]=Math.min(1,t.l[x]+.002*a))}}}for(const l of e.tabus){const d=l.radius*.9;for(let u=0;u<Math.PI*2;u+=Math.PI/8){const h=l.x+Math.cos(u)*d,m=l.y+Math.sin(u)*d;Na(t,h,m,.015*a*c,.1)}}for(const l of e.rituals){const d=l.periodSec,u=(r-l.bornAt)%d,h=u<d*.3;l.active=h,h&&(l.kind==="GATHER"?(Na(t,l.x,l.y,.04*a*c,l.radius),_o(t,l.x,l.y,.03*a,l.radius),Math.abs(u)<.1&&u<.15&&(s.push({time:r,icon:"",message:"Gathering ritual begins",color:"#a78bfa"}),i.push({x:l.x,y:l.y,message:"Gather",color:"#a78bfa",bornAt:r,ttl:3,age:0}))):l.kind==="OFFERING"?(Kr(t,l.x,l.y,.06*a*c,l.radius),_o(t,l.x,l.y,.02*a,l.radius*.7),Math.abs(u)<.1&&u<.15&&(s.push({time:r,icon:"",message:"Offering ritual  resources redistributed",color:"#fbbf24"}),i.push({x:l.x,y:l.y,message:"Offering",color:"#fbbf24",bornAt:r,ttl:3,age:0}))):l.kind==="REVOLT"?(Na(t,l.x,l.y,-.08*a*c,l.radius*1.5),Math.abs(u)<.1&&u<.15&&(s.push({time:r,icon:"",message:"Revolt ritual  norms shattered",color:"#ef4444"}),i.push({x:l.x,y:l.y,message:"Revolt",color:"#ef4444",bornAt:r,ttl:3,age:0}))):(Na(t,l.x,l.y,.05*a*c,l.radius*1.2),Math.abs(u)<.1&&u<.15&&(s.push({time:r,icon:"",message:"Procession ritual in march",color:"#fbd38d"}),i.push({x:l.x,y:l.y,message:"Procession",color:"#fbd38d",bornAt:r,ttl:3,age:0}))))}}function oW(e,t,n,r,a,i){for(const s of t.tabus){let c=0;for(const l of e){const d=l.x-s.x,u=l.y-s.y;if(d*d+u*u<s.radius*s.radius)if(s.kind==="NO_ENTER"){const h=l.desire>.5;l.fear=Bn(l.fear+s.severity*.12,0,1),h&&(l.status=Bn(l.status+.04,0,1),c++,n.violationCount++,n.violationsWindow++)}else s.kind==="NO_MIX"&&s.violationCount++}c>0&&(s.violationCount+=c,i.push({time:r,icon:"",message:`Taboo violation ${c}`,color:"#ef4444"}),a.push({x:s.x,y:s.y,message:`${c} violations`,color:"#ef4444",bornAt:r,ttl:2,age:0}))}r-n.violationsWindowStart>60&&(n.violationsWindowStart=r,n.violationsWindow=0)}function aW(e,t,n){for(let r=0;r<e.length;r++){const a=e[r];if(!(a.belief<.6||a.status<.35))for(let i=0;i<e.length;i++){if(i===r)continue;const s=e[i],c=s.x-a.x,l=s.y-a.y;c*c+l*l>.06*.06||s.desire>.6&&(s.fear=Bn(s.fear+.08,0,1),s.status=Bn(s.status-.03,0,1),t.exceptionActive&&(s.fear=Bn(s.fear+.04,0,1)))}}}function sW(e,t,n,r,a){if(!e.exceptionActive&&e.violationsWindow>=t.violationThreshold){e.exceptionActive=!0,e.exceptionStartTime=r,a.push({time:r,icon:"",message:"STATE OF EXCEPTION declared",color:"#ef4444"});for(let i=0;i<n.n.length;i++)n.n[i]=Math.min(1,n.n[i]+.15);n.dirty=!0}e.exceptionActive&&r-e.exceptionStartTime>t.exceptionDuration&&(e.exceptionActive=!1,a.push({time:r,icon:"",message:"State of Exception lifted",color:"#34d399"}))}function iW(e,t){if(e.length===0)return;const n=e.reduce((i,s)=>i+s.wealth,0);t.meanWealth=n/e.length;const r=e.map(i=>i.wealth).sort((i,s)=>i-s);let a=0;for(let i=0;i<r.length;i++)a+=(2*(i+1)-r.length-1)*r[i];t.gini=n>0?Math.abs(a)/(r.length*n):0}function lW(e,t,n,r,a,i,s,c){const l=hy(e,t),d=e.length?e.reduce((g,x)=>g+x.aggression,0)/e.length:0,u=e.length?e.reduce((g,x)=>g+x.ideology,0)/e.length:0,h=c.totems.filter(g=>g.kind==="RIFT").length;if(l.phase!==n.phase){const g={SWARM:"#94a3b8",CLUSTERS:"#34d399",POLARIZED:"#fbd38d",CONFLICT:"#ef4444",CONSENSUS:"#a78bfa",EXCEPTION:"#ff6b6b",FERVOR:"#ff4500",ECO_CRISIS:"#8b4513",TRANSCENDENCE:"#00d4aa"};let x;if(l.phase==="CONFLICT"){const v=[];l.polarization>.4&&v.push(`polarizao ${(l.polarization*100).toFixed(0)}%`),v.push(`hostilidade ${(l.conflict*100).toFixed(0)}%`),h>0&&v.push(`${h} totem(ns) RIFT`),v.push(`agresso mdia ${d.toFixed(2)}`);const b=u<-.15?`Ordem (${u.toFixed(2)})`:u>.15?`Liberdade (${u.toFixed(2)})`:`Centro (${u.toFixed(2)})`;x=`Causas da GUERRA: ${v.join(", ")}. Filosofia em jogo: ${b}.`}else l.phase==="POLARIZED"&&(x=`Filosofia emergente: ${u<-.15?`Ordem (${u.toFixed(2)})`:u>.15?`Liberdade (${u.toFixed(2)})`:`Centro (${u.toFixed(2)})`}.`);s.push({time:a,icon:"",message:`Phase: ${n.phase}  ${l.phase}`,color:g[l.phase]||"#fff",cause:x})}if(l.consensus<.35&&l.meanBelief<.3&&l.phase!=="CONFLICT"&&zs(r)<.25){const g=[];l.consensus<.25&&g.push("consenso em colapso"),l.meanBelief<.25&&g.push("crena muito baixa"),g.push(`entropia de opinio ${(l.entropy*100).toFixed(0)}%`),s.push({time:a,icon:"",message:"Anomia  normas em colapso",color:"#f97316",cause:`Causas da anomia: ${g.join(", ")}.`})}n.meanUnderstanding<=.22&&l.meanUnderstanding>.22&&s.push({time:a,icon:"",message:"Compreenso coletiva emergente",color:"#34d399",cause:`Cruzamento de limiar: compreenso mdia ${l.meanUnderstanding.toFixed(2)}.`}),n.meanEthics<=.18&&l.meanEthics>.18&&s.push({time:a,icon:"",message:"tica emergente consolidada",color:"#00d4aa",cause:`tica mdia ${l.meanEthics.toFixed(2)} com conflito ${(l.conflict*100).toFixed(0)}%.`}),n.meanEntanglement<=.32&&l.meanEntanglement>.32&&s.push({time:a,icon:"",message:"Entanglement social em expanso",color:"#67e8f9",cause:`Coerncia relacional mdia ${l.meanEntanglement.toFixed(2)}.`}),r.gini>.55&&zs(r)<.2&&s.push({time:a,icon:"",message:`Wealth gap  Gini ${r.gini.toFixed(2)}`,color:"#fbbf24"});const m=new Array(t.groupCount).fill(0);for(const g of e)g.groupId<m.length&&m[g.groupId]++;const f=Math.max(...m);if(f>e.length*.55&&zs(r)<.15){const g=m.indexOf(f),x=rc[g%rc.length];s.push({time:a,icon:"",message:`Coalition  Group ${g} (${Math.round(f/e.length*100)}%)`,color:x}),i.push({x:0,y:0,message:"Coalition",color:x,bornAt:a,ttl:3,age:0})}}function cW(e,t){const n=[];for(let r=0;r<t;r++)n.push([0,0,0]);for(const r of e)r.groupId<t&&(n[r.groupId][0]+=r.x,n[r.groupId][1]+=r.y,n[r.groupId][2]++);for(const r of n)r[2]>0&&(r[0]/=r[2],r[1]/=r[2]);return n}function db(e,t,n,r){e.memory.unshift({agentIdx:t,friendly:n,time:r}),e.memory.length>tW&&e.memory.pop()}function Bn(e,t,n){return e<t?t:e>n?n:e}function hy(e,t){var F;if(!e.length)return{cohesion:0,polarization:0,conflict:0,consensus:.5,phase:"SWARM",leaderCount:0,rebelCount:0,meanFear:0,meanBelief:0,entropy:.5,meanPerception:.5,meanEthics:0,meanHybris:0,meanFervor:0,meanUnderstanding:0,meanEntanglement:0,ecoHealth:1};const n=Array.from({length:t.groupCount},()=>[]);for(const B of e)(F=n[B.groupId])==null||F.push(B);let r=0,a=0;for(let B=0;B<t.groupCount;B++){const W=n[B];if(W.length<2)continue;const re=W.reduce((J,pe)=>J+pe.x,0)/W.length,oe=W.reduce((J,pe)=>J+pe.y,0)/W.length,te=W.reduce((J,pe)=>J+Math.sqrt((pe.x-re)**2+(pe.y-oe)**2),0)/W.length;r+=1-Math.min(1,te/.7),a++}const i=a>0?r/a:0,s=n.map(B=>B.length>0?B.reduce((W,re)=>W+re.ideology,0)/B.length:0),c=s.reduce((B,W)=>B+W,0)/s.length,l=s.reduce((B,W)=>B+(W-c)**2,0)/s.length,d=Math.min(1,Math.sqrt(l)),u=Math.min(1,e.reduce((B,W)=>B+W.hostileCount,0)/(e.length*3)),h=e.reduce((B,W)=>B+W.ideology,0)/e.length,m=e.reduce((B,W)=>B+(W.ideology-h)**2,0)/e.length,f=Math.max(0,1-Math.sqrt(m)/1.1),g=e.reduce((B,W)=>B+W.fear,0)/e.length,x=e.reduce((B,W)=>B+W.belief,0)/e.length,v=e.filter(B=>B.centrality>.3&&B.status>.4).length,b=e.filter(B=>B.resistance>.7||B.ideology>.5&&B.fear<.3&&B.desire>.65).length,w=new Float32Array(5);for(const B of e)w[Math.min(4,Math.floor((B.ideology+1)/2*5))]++;let M=0;for(let B=0;B<5;B++){const W=w[B]/e.length;W>0&&(M-=W*Math.log2(W))}M=Math.min(1,M/Math.log2(5));const k=e.reduce((B,W)=>B+W.perception,0)/e.length,R=e.reduce((B,W)=>B+W.ethics,0)/e.length,j=e.reduce((B,W)=>B+W.hybris,0)/e.length,I=e.reduce((B,W)=>B+W.fervor,0)/e.length,E=e.reduce((B,W)=>B+W.understanding,0)/e.length,O=e.reduce((B,W)=>B+W.entanglement,0)/e.length,L=1-e.reduce((B,W)=>B+W.ecoFootprint,0)/e.length;let $;return I>.4?$="FERVOR":L<.35?$="ECO_CRISIS":R>.3&&E>.25&&u<.2?$="TRANSCENDENCE":f>.78&&u<.2?$="CONSENSUS":u>.5?$="CONFLICT":d>.58?$="POLARIZED":i>.55&&d<.35?$="CLUSTERS":$="SWARM",{cohesion:i,polarization:d,conflict:u,consensus:f,phase:$,leaderCount:v,rebelCount:b,meanFear:g,meanBelief:x,entropy:M,meanPerception:k,meanEthics:R,meanHybris:j,meanFervor:I,meanUnderstanding:E,meanEntanglement:O,ecoHealth:L}}function dW(e,t){const n=new Array(e.length).fill("normal");if(!e.length)return n;const a=[...e.map((d,u)=>({i:u,c:d.centrality*.6+d.status*.4}))].sort((d,u)=>u.c-d.c),i=.52,s=.36,c=5;let l=0;for(let d=0;d<a.length&&l<c;d++){const{i:u,c:h}=a[d],f=(t==null?void 0:t[u])==="leader"?s:i;h>f&&(n[u]="leader",l++)}for(let d=0;d<e.length;d++){const u=e[d],h=t==null?void 0:t[d],m=u.status>.72&&u.centrality>.28&&u.aggression>.62&&u.belief>.55&&u.ideology<-.15,f=h==="dictator";if(m){n[d]="dictator";continue}if(f&&u.status>.55&&u.centrality>.2){n[d]="dictator";continue}const g=u.belief>.7&&u.status>.45&&u.charisma>.4&&u.aggression<.55,x=h==="priest";if(g){n[d]="priest";continue}if(x&&u.belief>.55&&u.status>.35){n[d]="priest";continue}const v=u.resistance>.7||u.ideology>.5&&u.desire>.65&&u.fear<.35,b=h==="rebel";if(v){n[d]="rebel";continue}if(b&&(u.resistance>.5||u.ideology>.35)){n[d]="rebel";continue}const w=u.status>.58&&(u.belief>.62||u.conformity>.7)&&u.charisma>.18,M=h==="authority";if(w){n[d]="authority";continue}if(M&&u.status>.42&&(u.belief>.5||u.conformity>.55)){n[d]="authority";continue}if(u.aggression>.65&&u.hostileCount>=2){n[d]="aggressor";continue}if(h==="aggressor"&&u.aggression>.5&&u.hostileCount>=1){n[d]="aggressor";continue}if(u.belief>.65&&u.status>.4){n[d]="guardian";continue}if(h==="guardian"&&u.belief>.52&&u.status>.3){n[d]="guardian";continue}const k=u.memory.filter(R=>R.agentIdx<e.length&&e[R.agentIdx].groupId!==u.groupId&&R.friendly).length;if(u.trust>.7&&k>=2){n[d]="mediator";continue}if(u.desire>.58&&u.aggression<.38&&(u.ideology>.2||u.resistance>.4)){n[d]="artist";continue}if(u.desire>.52&&u.status>.35&&u.ideology>.22){n[d]="innovator";continue}if(u.aggression>.58&&u.empathy<.28&&u.status>.28){n[d]="predator";continue}}return n}let uW=2e3;const Hd=()=>`auto-${uW++}`;function Wd(e,t,n,r){return n.some(a=>(a.x-e)**2+(a.y-t)**2<r*r)}function hW(e,t,n,r,a,i,s){if(n.totems.length+n.tabus.length+n.rituals.length>=12||zs(r)>.08)return;const l=()=>zs(r),d=(u,h,m)=>({x:u+(l()-.5)*m,y:h+(l()-.5)*m});if(n.totems.length<4){const u=[];for(let h=0;h<t.groupCount;h++)u.push({g:h,cx:0,cy:0,mb:0,ms:0,n:0});for(const h of e){const m=u[h.groupId];m&&(m.cx+=h.x,m.cy+=h.y,m.mb+=h.belief,m.ms+=h.status,m.n++)}for(const h of u){if(h.n<8)continue;h.cx/=h.n,h.cy/=h.n,h.mb/=h.n,h.ms/=h.n;const m=.54+l()*.14;if(h.mb>m&&h.ms>.22+l()*.08&&!Wd(h.cx,h.cy,n.totems,.4)){const{x:f,y:g}=d(h.cx,h.cy,.06),x={id:Hd(),kind:"BOND",x:f,y:g,radius:.2+l()*.06,groupId:h.g,pulseStrength:.55+l()*.2,bornAt:a,emergent:!0};n.totems.push(x),s.push({time:a,icon:"",message:`Foundation  Group ${h.g} crystallised belief`,color:"#34d399"}),i.push({x:f,y:g,message:"Foundation",color:"#34d399",bornAt:a,ttl:5,age:0});return}}}if(n.tabus.length<3&&r.violationsWindow>=2){const u=e.filter(h=>h.desire>.55+l()*.15);if(u.length>=3){const h=u.slice(0,6).reduce((x,v)=>x+v.x,0)/Math.min(6,u.length),m=u.slice(0,6).reduce((x,v)=>x+v.y,0)/Math.min(6,u.length),{x:f,y:g}=d(h,m,.05);if(!Wd(f,g,n.tabus,.25)){const x={id:Hd(),kind:"NO_ENTER",x:f,y:g,radius:.15+l()*.04,severity:.5+l()*.1,bornAt:a,violationCount:0};n.tabus.push(x),s.push({time:a,icon:"",message:"Taboo sealed  community declares limit",color:"#ef4444"}),i.push({x:f,y:g,message:"Sealed",color:"#ef4444",bornAt:a,ttl:4,age:0});return}}}if(n.rituals.length<3){const u=e.reduce((f,g)=>f+g.belief,0)/e.length,h=e.reduce((f,g)=>f+g.ideology**2,0)/e.length,m=.58+l()*.12;if(u>m&&h<.2+l()*.06){const f=e.reduce((b,w)=>b+w.x,0)/e.length,g=e.reduce((b,w)=>b+w.y,0)/e.length,{x,y:v}=d(f,g,.08);if(!Wd(x,v,n.rituals,.35)){const b={id:Hd(),kind:"GATHER",x,y:v,radius:.24+l()*.08,periodSec:7+l()*5|0,lastFired:a,active:!1,bornAt:a};n.rituals.push(b),s.push({time:a,icon:"",message:"Ritual emerged  collective belief crystallised",color:"#a78bfa"}),i.push({x,y:v,message:"Ritual",color:"#a78bfa",bornAt:a,ttl:5,age:0});return}}}if(n.totems.filter(u=>u.kind==="RIFT").length<2){const u=e.reduce((m,f)=>m+f.ideology,0)/e.length,h=e.filter(m=>m.ideology<u-(.45+l()*.15));if(h.length>=10){const m=h.reduce((b,w)=>b+w.x,0)/h.length,f=h.reduce((b,w)=>b+w.y,0)/h.length,{x:g,y:x}=d(m,f,.06),v=h[0].groupId;if(!Wd(g,x,n.totems,.35)){const b={id:Hd(),kind:"RIFT",x:g,y:x,radius:.2+l()*.06,groupId:v,pulseStrength:.7+l()*.2,bornAt:a,emergent:!0};n.totems.push(b),s.push({time:a,icon:"",message:`Schism  faction ${v} breaks from consensus`,color:"#ff6b6b"}),i.push({x:g,y:x,message:"Schism",color:"#ff6b6b",bornAt:a,ttl:5,age:0});return}}}if(n.totems.filter(u=>u.kind==="ORACLE").length<2){const u=e.filter(h=>h.charisma>.25&&h.status>.35);if(u.length>=3){const h=u.reduce((f,g)=>f+g.x,0)/u.length,m=u.reduce((f,g)=>f+g.y,0)/u.length;if(!Wd(h,m,n.totems,.35)){const f={id:Hd(),kind:"ORACLE",x:h,y:m,radius:.24,groupId:u[0].groupId,pulseStrength:.9,bornAt:a,emergent:!0};n.totems.push(f),s.push({time:a,icon:"",message:"Oracle emerged  charismatic authority crystallised",color:"#c084fc"}),i.push({x:h,y:m,message:"Oracle",color:"#c084fc",bornAt:a,ttl:5,age:0});return}}}if(n.totems.filter(u=>u.kind==="ARCHIVE").length<2){const u=e.filter(h=>h.fatigue<.15&&h.belief>.5&&h.fear<.2);if(u.length>=e.length*.25){const h=u.reduce((f,g)=>f+g.x,0)/u.length,m=u.reduce((f,g)=>f+g.y,0)/u.length;if(!Wd(h,m,n.totems,.4)){const f={id:Hd(),kind:"ARCHIVE",x:h,y:m,radius:.2,groupId:0,pulseStrength:.5,bornAt:a,emergent:!0};n.totems.push(f),s.push({time:a,icon:"",message:"Archive emerged  collective memory preserved",color:"#94a3b8"}),i.push({x:h,y:m,message:"Archive",color:"#94a3b8",bornAt:a,ttl:5,age:0});return}}}if(n.rituals.filter(u=>u.kind==="OFFERING").length<2&&r.gini>.45){const u=e.filter(h=>h.wealth<.15);if(u.length>=8){const h=u.reduce((f,g)=>f+g.x,0)/u.length,m=u.reduce((f,g)=>f+g.y,0)/u.length;if(!Wd(h,m,n.rituals,.3)){const f={id:Hd(),kind:"OFFERING",x:h,y:m,radius:.25,periodSec:8,lastFired:a,active:!1,bornAt:a};n.rituals.push(f),s.push({time:a,icon:"",message:"Offering emerged  community responds to poverty",color:"#fbbf24"}),i.push({x:h,y:m,message:"Offering",color:"#fbbf24",bornAt:a,ttl:5,age:0});return}}}if(n.rituals.filter(u=>u.kind==="REVOLT").length<2){const u=e.filter(h=>h.resistance>.85);if(u.length>=6){const h=u.reduce((f,g)=>f+g.x,0)/u.length,m=u.reduce((f,g)=>f+g.y,0)/u.length;if(!Wd(h,m,n.rituals,.3)){const f={id:Hd(),kind:"REVOLT",x:h,y:m,radius:.35,periodSec:6,lastFired:a,active:!1,bornAt:a,emergent:!0};n.rituals.push(f),s.push({time:a,icon:"",message:"Revolt erupted against surveillance",color:"#ef4444"}),i.push({x:h,y:m,message:"Revolt",color:"#ef4444",bornAt:a,ttl:5,age:0});return}}}}let JS=1;function da(e,t,n){const r=JS;return(e+r)/(2*r)*t}function ua(e,t,n){const r=JS;return(e+r)/(2*r)*t}const fy={agentScale:.3,showTrails:!0,showDirection:!1,trailOpacity:.7,showFamilyConnections:!0};let Cf=fy;function fW(e,t){return .022*.5*Math.min(e,t)*Cf.agentScale}let xu=null,Iv=null,O4=0,i0=null,Gh=null,l0=null;function pW(e){return(!xu||O4!==e)&&(xu=document.createElement("canvas"),xu.width=e,xu.height=e,Iv=xu.getContext("2d"),O4=e,i0=null,Gh=null,l0=null),Iv}function ub(e,t,n,r,a){const i=new ImageData(t,t),s=i.data;for(let c=0;c<t*t;c++){const l=e[c],d=Math.sqrt(l);s[c*4]=n,s[c*4+1]=r,s[c*4+2]=a,s[c*4+3]=Math.min(255,d*255)}return i}function Gd(e,t,n,r){const a=Iv;!a||!xu||(a.putImageData(t,0,0),e.save(),e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high",e.drawImage(xu,0,0,n,r),e.restore())}function Oc(e){return e.archKeyStable>>>0||v0(e)}function D4(e){return e.archKeyMoment>>>0||v0(e)}function mW(e,t,n,r,a,i,s,c,l,d,u,h,m,f,g){Cf=f??fy,JS=i.worldHalf??1,e.clearRect(0,0,t,n),e.fillStyle="#000000",e.fillRect(0,0,t,n),e.strokeStyle="rgba(255,255,255,0.03)",e.lineWidth=1,e.strokeRect(3,3,t-6,n-6);const x=d.size;pW(x),d.dirty&&(i0=ub(d.n,x,52,211,153),Gh=ub(d.l,x,167,139,250),l0=ub(d.r,x,251,191,36),d.dirty=!1),c==="field"&&i0&&Gh&&l0?(e.save(),e.globalCompositeOperation="screen",e.globalAlpha=.65,Gd(e,i0,t,n),e.globalAlpha=.55,Gd(e,Gh,t,n),e.globalAlpha=.5,Gd(e,l0,t,n),e.restore()):c==="power"&&i0&&Gh?(e.save(),e.globalCompositeOperation="screen",e.globalAlpha=.55,Gd(e,i0,t,n),e.globalAlpha=.6,Gd(e,Gh,t,n),e.restore()):c==="economy"&&l0?(e.save(),e.globalCompositeOperation="screen",e.globalAlpha=.6,Gd(e,l0,t,n),e.restore()):c==="morin"&&i0&&l0&&(e.save(),e.globalCompositeOperation="screen",e.globalAlpha=.3,Gd(e,i0,t,n),e.globalAlpha=.25,Gd(e,l0,t,n),e.restore()),c!=="off"&&RW(e,t,n,l,u.exceptionActive,r),Cf.showTrails&&(e.save(),yW(e,t,n,r),e.restore()),gW(e,t,n,r);const v=fW(t,n),b=new Set;let w=-1;if(r.length){let M=-1,k=-1,R=-1,j=-1,I=-1,E=-1;for(let O=0;O<r.length;O++){const L=r[O],$=a[O]??"normal",F=$==="leader"?.2:$==="dictator"?.18:$==="authority"?.14:$==="priest"?.1:0,B=L.centrality*.55+L.status*.35+L.charisma*.25-L.fear*.08+F;B>j?(R=k,E=I,k=M,I=j,M=O,j=B):B>I?(R=k,E=I,k=O,I=B):B>E&&(R=O,E=B)}M>=0&&b.add(M),k>=0&&b.add(k),R>=0&&b.add(R),w=M}if(c==="off"?MW(e,t,n,r,a,v,b,w):c==="economy"?SW(e,t,n,r,a,v,b,w):c==="power"?vW(e,t,n,r,a,v,b,w):c==="events"?wW(e,t,n,r,a,v):c==="archetype"?CW(e,t,n,r,a,v,b,w):c==="morin"?kW(e,t,n,r,a,v,b,w):xW(e,t,n,r,a,v,b,w),g!=null&&g>=0&&g<r.length){const M=r[g],k=da(M.x,t),R=ua(M.y,n),j=v*(.72+M.status*.72);bW(e,k,R,j,g)}AW(e,t,n,h)}function gW(e,t,n,r){if(!Cf.showFamilyConnections)return;const a=new Map;for(let i=0;i<r.length;i++){const s=r[i].familyId;if(s==null||s<=0)continue;const c=a.get(s)??[];c.push(i),a.set(s,c)}e.save(),e.lineCap="round",e.lineJoin="round",e.lineWidth=.5,a.forEach(i=>{if(i.length<2)return;const s=r[i[0]].groupId,c=rc[s%rc.length]??"#ffffff",[l,d,u]=[parseInt(c.slice(1,3),16),parseInt(c.slice(3,5),16),parseInt(c.slice(5,7),16)];e.strokeStyle=`rgba(${l},${d},${u},0.26)`;for(let h=0;h<i.length;h++){const m=i[h],f=da(r[m].x,t),g=ua(r[m].y,n);for(let x=h+1;x<i.length;x++){const v=i[x],b=da(r[v].x,t),w=ua(r[v].y,n);e.beginPath(),e.moveTo(f,g),e.lineTo(b,w),e.stroke()}}}),e.restore()}function yW(e,t,n,r,a){const i=r.length>400?4:r.length>200?2:1,s=15;e.lineCap="round",e.lineJoin="round",e.globalAlpha=1;for(let c=0;c<r.length;c+=i){const l=r[c];if(!l.trailX||!l.trailY||l.trailX.length!==s||l.trailY.length!==s)continue;const d=Bi(Oc(l)),[u,h,m]=um(d),f=[];for(let v=0;v<s;v++){const b=(l.trailIdx+1+v)%s,w=l.trailX[b],M=l.trailY[b];Number.isFinite(w)&&Number.isFinite(M)&&f.push([da(w,t),ua(M,n)])}if(f.length<2)continue;const g=.6*Cf.trailOpacity,x=1.2;for(let v=1;v<f.length;v++){const b=v/f.length,w=g*b*b,M=x*(.3+.7*b);w<.02||(e.beginPath(),e.moveTo(f[v-1][0],f[v-1][1]),e.lineTo(f[v][0],f[v][1]),e.strokeStyle=`rgba(${u},${h},${m},${w})`,e.lineWidth=M,e.stroke())}}e.globalAlpha=1}function um(e){if(e.startsWith("#")){const t=parseInt(e.slice(1,3),16),n=parseInt(e.slice(3,5),16),r=parseInt(e.slice(5,7),16);return[isNaN(t)?128:t,isNaN(n)?128:n,isNaN(r)?128:r]}return[128,128,128]}function Wu(e,t,n,r,a,i,s,c){const l=Math.sqrt(r*r+a*a),d=l>1e-4?r/l:1,u=l>1e-4?a/l:0,h=Math.min(1,l*80),[m,f,g]=um(s);if(e.save(),e.globalAlpha=c,e.beginPath(),e.arc(t,n,i,0,Math.PI*2),e.fillStyle=`rgba(${m},${f},${g},0.92)`,e.fill(),e.strokeStyle="rgba(255,255,255,0.08)",e.lineWidth=.5,e.stroke(),Cf.showDirection&&h>.05){const x=i*(.6+h*1.8),v=t+d*(i+x),b=n+u*(i+x);e.beginPath(),e.moveTo(t+d*i*.85,n+u*i*.85),e.lineTo(v,b),e.strokeStyle=`rgba(${m},${f},${g},0.7)`,e.lineWidth=Math.max(.5,i*.12*(1-h*.3)),e.lineCap="round",e.stroke()}e.restore()}function bW(e,t,n,r,a){const i=r+6,s=e.createRadialGradient(t,n,r,t,n,i*1.8);s.addColorStop(0,"rgba(0,212,170,0.15)"),s.addColorStop(.6,"rgba(0,212,170,0.06)"),s.addColorStop(1,"rgba(0,0,0,0)"),e.save(),e.fillStyle=s,e.beginPath(),e.arc(t,n,i*1.8,0,Math.PI*2),e.fill(),e.restore(),e.save(),e.strokeStyle="#00d4aa",e.lineWidth=2.2,e.globalAlpha=.95,e.beginPath(),e.arc(t,n,r+4,0,Math.PI*2),e.stroke(),e.globalAlpha=1,e.restore();const c=`#${a}`;e.save(),e.font='600 10px "IBM Plex Mono", monospace',e.textAlign="center",e.textBaseline="bottom",e.fillStyle="rgba(0,0,0,0.75)",e.strokeStyle="#00d4aa",e.lineWidth=2.5,e.strokeText(c,t,n-r-6),e.fillText(c,t,n-r-6),e.restore()}function Of(e,t,n,r,a){const i=r*(a?5.5:4),s=e.createRadialGradient(t,n,r*.5,t,n,i);s.addColorStop(0,a?"rgba(251,191,36,0.14)":"rgba(251,191,36,0.08)"),s.addColorStop(.5,a?"rgba(251,191,36,0.06)":"rgba(251,191,36,0.03)"),s.addColorStop(1,"rgba(0,0,0,0)"),e.save(),e.globalCompositeOperation="lighter",e.fillStyle=s,e.beginPath(),e.arc(t,n,i,0,Math.PI*2),e.fill(),e.restore(),e.save(),e.beginPath(),e.arc(t,n,r+1.5,0,Math.PI*2),e.strokeStyle=a?"rgba(251,191,36,0.65)":"rgba(251,191,36,0.40)",e.lineWidth=a?1.2:.8,e.stroke(),e.restore()}function xW(e,t,n,r,a,i,s,c){for(const l of s){if(l<0||l>=r.length)continue;const d=r[l],u=da(d.x,t),h=ua(d.y,n),m=i*(.72+d.status*.72);Of(e,u,h,m,l===c)}for(let l=0;l<r.length;l++){const d=r[l],u=da(d.x,t),h=ua(d.y,n),m=a[l]??"normal",f=Bi(Oc(d)),g=rc[d.groupId%rc.length],x=i*(.72+d.status*.72),v=Math.max(d.belief,d.fear,d.desire);if(v>.5){let b="";d.belief>=d.fear&&d.belief>=d.desire?b="#34d399":d.fear>=d.desire?b="#ef4444":b="#fbd38d",e.beginPath(),e.arc(u,h,x+2,Math.PI*.2,Math.PI*.8),e.strokeStyle=b,e.lineWidth=1.5,e.globalAlpha=(v-.45)*.9,e.stroke(),e.globalAlpha=1}Wu(e,u,h,d.vx,d.vy,x,f,.65),e.beginPath(),e.arc(u,h+x+3,1.8,0,Math.PI*2),e.fillStyle=g,e.globalAlpha=.65,e.fill(),e.globalAlpha=1,Rm(e,u,h,x,f,m)}}function vW(e,t,n,r,a,i,s,c){for(let l=0;l<r.length;l++){const d=r[l];if(d.status<.25)continue;const u=da(d.x,t),h=ua(d.y,n),m=i*(.72+d.status*.72),f=Bi(Oc(d)),[g,x,v]=um(f),b=m+d.status*i*3,w=e.createRadialGradient(u,h,m*.5,u,h,b);w.addColorStop(0,`rgba(${g},${x},${v},${d.status*.12})`),w.addColorStop(1,`rgba(${g},${x},${v},0)`),e.fillStyle=w,e.beginPath(),e.arc(u,h,b,0,Math.PI*2),e.fill()}for(const l of s){if(l<0||l>=r.length)continue;const d=r[l],u=da(d.x,t),h=ua(d.y,n),m=i*(.72+d.status*.72);Of(e,u,h,m,l===c)}for(let l=0;l<r.length;l++){const d=r[l],u=da(d.x,t),h=ua(d.y,n),m=a[l]??"normal",f=Bi(Oc(d)),g=i*(.72+d.status*.72),[x,v,b]=um(f),w=d.fear*.6,M=Math.round(x+(220-x)*w),k=Math.round(v+(50-v)*w),R=Math.round(b+(50-b)*w),j=`#${M.toString(16).padStart(2,"0")}${k.toString(16).padStart(2,"0")}${R.toString(16).padStart(2,"0")}`;Wu(e,u,h,d.vx,d.vy,g,j,.62),Rm(e,u,h,g,f,m)}}function SW(e,t,n,r,a,i,s,c){const l=r.map((u,h)=>({i:h,w:u.wealth})).sort((u,h)=>h.w-u.w),d=new Set(l.slice(0,10).map(u=>u.i));for(const u of s){if(u<0||u>=r.length)continue;const h=r[u],m=da(h.x,t),f=ua(h.y,n),g=i*(.72+h.status*.72);Of(e,m,f,g,u===c)}for(let u=0;u<r.length;u++){const h=r[u],m=da(h.x,t),f=ua(h.y,n),g=a[u]??"normal",x=Bi(Oc(h)),v=i*(.72+h.status*.72);if(d.has(u)){const b=v+3+h.wealth*5,w=e.createRadialGradient(m,f,v,m,f,b);w.addColorStop(0,`rgba(251,191,36,${h.wealth*.15})`),w.addColorStop(1,"rgba(251,191,36,0)"),e.fillStyle=w,e.beginPath(),e.arc(m,f,b,0,Math.PI*2),e.fill()}Wu(e,m,f,h.vx,h.vy,v,x,.35+h.wealth*.55),Rm(e,m,f,v,x,g)}}function wW(e,t,n,r,a,i,s,c){for(let l=0;l<r.length;l++){const d=r[l],u=da(d.x,t),h=ua(d.y,n),m=Bi(Oc(d)),f=i*(.58+d.status*.55);Wu(e,u,h,d.vx,d.vy,f,m,.18)}}function MW(e,t,n,r,a,i,s,c){for(const l of s){if(l<0||l>=r.length)continue;const d=r[l],u=da(d.x,t),h=ua(d.y,n),m=i*(.72+d.status*.72);Of(e,u,h,m,l===c)}for(let l=0;l<r.length;l++){const d=r[l],u=da(d.x,t),h=ua(d.y,n),m=Bi(Oc(d)),f=i*(.72+d.status*.72);Wu(e,u,h,d.vx,d.vy,f,m,.62)}}function CW(e,t,n,r,a,i,s,c){for(const l of s){if(l<0||l>=r.length)continue;const d=r[l],u=da(d.x,t),h=ua(d.y,n),m=i*(.72+d.status*.55);Of(e,u,h,m,l===c)}for(let l=0;l<r.length;l++){const d=r[l],u=da(d.x,t),h=ua(d.y,n),m=a[l]??"normal",g=Bi(Oc(d)),x=i*(.72+d.status*.55);if(D4(d)!==Oc(d)){const v=Bi(D4(d));e.beginPath(),e.arc(u,h,x+2,-Math.PI*.8,-Math.PI*.2),e.strokeStyle=v,e.lineWidth=1.2,e.globalAlpha=.4,e.stroke(),e.globalAlpha=1}Wu(e,u,h,d.vx,d.vy,x,g,.65),Rm(e,u,h,x,g,m)}}function Rm(e,t,n,r,a,i){if(i==="normal")return;const s=n-r-5;switch(e.save(),i){case"leader":{e.beginPath(),e.arc(t,s,2.2,0,Math.PI*2),e.fillStyle="#fbbf24",e.globalAlpha=.8,e.fill();break}case"authority":{e.beginPath(),e.moveTo(t,s-2.5),e.lineTo(t+2,s),e.lineTo(t,s+2.5),e.lineTo(t-2,s),e.closePath(),e.fillStyle="#60a5fa",e.globalAlpha=.75,e.fill();break}case"dictator":{e.beginPath(),e.moveTo(t,s-3),e.lineTo(t+2.5,s+1.5),e.lineTo(t-2.5,s+1.5),e.closePath(),e.fillStyle="#ef4444",e.globalAlpha=.85,e.fill(),e.beginPath(),e.arc(t,n,r+2,0,Math.PI*2),e.strokeStyle="#ef4444",e.lineWidth=1.2,e.globalAlpha=.4,e.stroke();break}case"aggressor":{e.strokeStyle="#ef4444",e.lineWidth=1.2,e.globalAlpha=.7,e.beginPath(),e.moveTo(t-2,s-2),e.lineTo(t+2,s+2),e.moveTo(t+2,s-2),e.lineTo(t-2,s+2),e.stroke();break}case"guardian":{e.fillStyle="#fbd38d",e.globalAlpha=.65,e.fillRect(t-1.8,s-1.8,3.6,3.6);break}case"mediator":{e.beginPath(),e.arc(t,n,r*.25,0,Math.PI*2),e.fillStyle="#ffffff",e.globalAlpha=.55,e.fill();break}case"rebel":{e.beginPath(),e.moveTo(t-1.5,s-2),e.lineTo(t+1.5,s+2),e.strokeStyle="#f87171",e.lineWidth=1.5,e.globalAlpha=.8,e.stroke();break}case"priest":{e.beginPath(),e.arc(t,s,2,0,Math.PI*2),e.strokeStyle="#c084fc",e.lineWidth=.8,e.globalAlpha=.7,e.stroke();break}}e.restore()}function kW(e,t,n,r,a,i,s,c){for(let d=0;d<r.length;d++){const u=r[d];if(u.understanding<.3||r.length>200)continue;const h=da(u.x,t),m=ua(u.y,n);for(const f of u.memory)if(f.friendly&&f.agentIdx<r.length){const g=r[f.agentIdx];g.groupId!==u.groupId&&(e.beginPath(),e.moveTo(h,m),e.lineTo(da(g.x,t),ua(g.y,n)),e.strokeStyle="#00d4aa",e.lineWidth=.4,e.globalAlpha=u.understanding*.18,e.stroke())}}e.globalAlpha=1;for(let d=0;d<r.length;d++){const u=r[d],h=da(u.x,t),m=ua(u.y,n),f=i*(.72+u.status*.72);if(u.ethics>.25){const g=f+3+u.ethics*8,x=e.createRadialGradient(h,m,f*.5,h,m,g);x.addColorStop(0,`rgba(0,212,170,${u.ethics*.14})`),x.addColorStop(1,"rgba(0,212,170,0)"),e.fillStyle=x,e.beginPath(),e.arc(h,m,g,0,Math.PI*2),e.fill()}if(u.hybris>.25){const g=f+3+u.hybris*8,x=e.createRadialGradient(h,m,f*.5,h,m,g);x.addColorStop(0,`rgba(255,160,0,${u.hybris*.12})`),x.addColorStop(1,"rgba(255,100,0,0)"),e.fillStyle=x,e.beginPath(),e.arc(h,m,g,0,Math.PI*2),e.fill()}}for(const d of s){if(d<0||d>=r.length)continue;const u=r[d],h=da(u.x,t),m=ua(u.y,n),f=i*(.72+u.status*.72);Of(e,h,m,f,d===c)}for(let d=0;d<r.length;d++){const u=r[d],h=da(u.x,t),m=ua(u.y,n),f=a[d]??"normal",g=Bi(Oc(u)),x=i*(.72+u.status*.72),v=.4+u.perception*.5;u.fervor>.3&&(e.beginPath(),e.arc(h,m,x+2,Math.PI*.1,Math.PI*.9),e.strokeStyle="#ff4500",e.lineWidth=1.2,e.globalAlpha=u.fervor*.5,e.stroke(),e.globalAlpha=1),u.ecoFootprint>.3&&(e.beginPath(),e.arc(h,m+x+3,1.5,0,Math.PI*2),e.fillStyle="#8b4513",e.globalAlpha=u.ecoFootprint*.55,e.fill(),e.globalAlpha=1),Wu(e,h,m,u.vx,u.vy,x,g,v),Rm(e,h,m,x,g,f)}e.save(),e.globalAlpha=.55,e.font="8px system-ui, sans-serif",e.textAlign="left",e.textBaseline="top";const l=[{color:"#00d4aa",label:"tica"},{color:"#ff4500",label:"Fervor"},{color:"#ffa000",label:"Hybris"},{color:"#8b4513",label:"Eco"}];for(let d=0;d<l.length;d++){const u=n-50+d*11;e.fillStyle=l[d].color,e.globalAlpha=.6,e.fillRect(10,u+1,5,5),e.fillStyle="rgba(255,255,255,0.45)",e.globalAlpha=.5,e.fillText(l[d].label,18,u)}e.restore()}function hb(e,t,n,r,a=1){let i=0;for(let s=0;s<e.length;s+=a){const c=e[s];(c.x-t)**2+(c.y-n)**2<r*r&&i++}return a>1?Math.round(i*a):i}function RW(e,t,n,r,a,i){const s=i.length>260?4:i.length>180?3:i.length>120?2:1;for(const c of r.rituals){const l=da(c.x,t),d=ua(c.y,n),u=c.radius*.5*Math.min(t,n),h=c.kind==="GATHER"?"#a78bfa":c.kind==="OFFERING"?"#fbbf24":c.kind==="REVOLT"?"#ef4444":"#fbd38d";e.beginPath(),e.arc(l,d,u,0,Math.PI*2),e.strokeStyle=h,e.lineWidth=c.active?1.5:.8,e.globalAlpha=c.active?.45:.15,e.setLineDash(c.active?[6,3]:[3,5]),e.stroke(),e.setLineDash([]),e.globalAlpha=1;const m=hb(i,c.x,c.y,c.radius,s),f=c.kind==="GATHER"?"":c.kind==="OFFERING"?"":c.kind==="REVOLT"?"":"";fb(e,l,d-u-6,`${f} ${m}`,h)}for(const c of r.tabus){const l=da(c.x,t),d=ua(c.y,n),u=c.radius*.5*Math.min(t,n),h="#ef4444";e.beginPath(),e.arc(l,d,u,0,Math.PI*2),e.fillStyle=h,e.globalAlpha=.04*(a?1.8:1),e.fill(),e.beginPath(),e.arc(l,d,u,0,Math.PI*2),e.strokeStyle=h,e.lineWidth=a?1.5:.8,e.globalAlpha=.35,e.stroke(),e.globalAlpha=1;const m=hb(i,c.x,c.y,c.radius,s),f=c.kind==="NO_ENTER"?"":"";fb(e,l,d-u-6,`${f} ${m}`,h)}for(const c of r.totems){const l=da(c.x,t),d=ua(c.y,n),u=c.radius*.5*Math.min(t,n),m={BOND:"#34d399",RIFT:"#ff6b6b",ORACLE:"#c084fc",ARCHIVE:"#94a3b8",PANOPTICON:"#fbbf24"}[c.kind]||"#34d399",[f,g,x]=um(m),v=e.createRadialGradient(l,d,0,l,d,u);v.addColorStop(0,`rgba(${f},${g},${x},0.08)`),v.addColorStop(.7,`rgba(${f},${g},${x},0.03)`),v.addColorStop(1,`rgba(${f},${g},${x},0)`),e.fillStyle=v,e.beginPath(),e.arc(l,d,u,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(l,d,u,0,Math.PI*2),e.strokeStyle=m,e.lineWidth=.8,e.globalAlpha=.3,e.stroke(),e.globalAlpha=1,e.beginPath(),e.arc(l,d,3,0,Math.PI*2),e.fillStyle=m,e.globalAlpha=.6,e.fill(),e.globalAlpha=1;const b={BOND:"",RIFT:"",ORACLE:"",ARCHIVE:"",PANOPTICON:""},w=hb(i,c.x,c.y,c.radius,s);fb(e,l,d-u-6,`${b[c.kind]||""} ${w}`,m)}}function fb(e,t,n,r,a){r&&(e.save(),e.font="8px system-ui, sans-serif",e.textAlign="center",e.textBaseline="middle",e.globalAlpha=.25,e.fillStyle="#000",e.fillText(r,t+.5,n+.5),e.globalAlpha=.55,e.fillStyle=a,e.fillText(r,t,n),e.restore())}function AW(e,t,n,r){for(const a of r){const i=1-a.age/a.ttl;if(i<=0)continue;const s=da(a.x,t),c=ua(a.y,n),l=(1-i)*55+8;e.beginPath(),e.arc(s,c,l,0,Math.PI*2),e.strokeStyle=a.color,e.lineWidth=1.5,e.globalAlpha=i*.55,e.stroke(),i>.4&&(e.font="8px system-ui, sans-serif",e.fillStyle=a.color,e.globalAlpha=i*.75,e.textAlign="center",e.textBaseline="bottom",e.fillText(a.message,s,c-l-4)),e.globalAlpha=1}}let jW=500;const QS=()=>`sc-${jW++}`,Nr=(e,t,n,r=.26,a=0,i=.85)=>({id:QS(),kind:e,x:t,y:n,radius:r,groupId:a,pulseStrength:i,bornAt:0}),Us=(e,t,n,r=.18,a=.55)=>({id:QS(),kind:e,x:t,y:n,radius:r,severity:a,bornAt:0,violationCount:0}),vs=(e,t,n,r=.28,a=8)=>({id:QS(),kind:e,x:t,y:n,radius:r,periodSec:a,lastFired:0,active:!1,bornAt:0}),V0=[{id:"open_market",name:"Open Market Tension",icon:"",category:"economy",description:"Resources abundant  no norms  accumulation  inequality & conflict",apply(e,t){e.agentCount=160,e.groupCount=4,e.speed=.5,e.aggressionBase=.35,e.trustBase=.45,e.kBelief=.2,e.harvestRate=.1,e.decayWealth=.008,e.ideologyPressure=.15,e.violationThreshold=6,e.autoSymbols=!0,t.decayN=.035,t.regenR=.04,e.groupProfiles=[{name:"Oligarca",sphere:"economic",fieldSensitivity:{n:.4,l:1,r:2},ideologyBias:.3,trustBias:.3,aggressionBias:.2,cohesionBias:.6,desireBias:.7},{name:"Comerciante",sphere:"economic",fieldSensitivity:{n:.6,l:.8,r:1.8},ideologyBias:.2,trustBias:.4,aggressionBias:.2,cohesionBias:.4,desireBias:.6},{name:"Trabalhador",sphere:"popular",fieldSensitivity:{n:1.3,l:.6,r:1.4},ideologyBias:-.1,trustBias:.5,aggressionBias:.3,cohesionBias:.5,desireBias:.5},{name:"Arteso",sphere:"artistic",fieldSensitivity:{n:.5,l:.8,r:1.2},ideologyBias:.1,trustBias:.5,aggressionBias:.1,cohesionBias:.4,desireBias:.5}]},setupWorld(e,t){Kr(e,.55,0,.6,.28),Kr(e,-.45,.5,.5,.22),Kr(e,-.2,-.55,.4,.18),Kr(e,.1,.55,.35,.15)}},{id:"discipline_state",name:"Discipline State",icon:"",category:"power",description:"Central BOND totem + Procession  high norms  conformity enforced",apply(e,t){e.agentCount=140,e.groupCount=3,e.speed=.38,e.aggressionBase=.18,e.trustBase=.65,e.kBelief=.65,e.kFear=.5,e.ideologyPressure=.4,e.violationThreshold=2,e.autoSymbols=!0,t.decayN=.008,t.diffuseN=.14,t.regenR=.016,e.groupProfiles=[{name:"Governante",sphere:"political",fieldSensitivity:{n:1,l:2,r:1},ideologyBias:-.6,trustBias:.6,aggressionBias:.15,cohesionBias:.8,desireBias:.2},{name:"Funcionrio",sphere:"political",fieldSensitivity:{n:1.2,l:1.5,r:.8},ideologyBias:-.4,trustBias:.7,aggressionBias:.1,cohesionBias:.6,desireBias:.3},{name:"Sdito",sphere:"popular",fieldSensitivity:{n:1.5,l:.6,r:1.2},ideologyBias:-.2,trustBias:.5,aggressionBias:.2,cohesionBias:.5,desireBias:.4}]},setupWorld(e,t){for(let n=0;n<e.n.length;n++)e.n[n]=Math.min(1,e.n[n]+.38);_o(e,0,0,.55,.38),t.totems.push(Nr("BOND",0,0,.34,0,1)),t.rituals.push(vs("PROCESSION",0,0,.5,9)),e.dirty=!0}},{id:"sociedades_do_zero",name:"Sociedades do zero",icon:"",category:"genesis",description:"Agentes comeam sem laos; famlias e laos formam com o tempo (proximidade + memria amigvel)",apply(e,t){e.agentCount=200,e.groupCount=4,e.speed=.48,e.startWithFamilies=!1,e.spawnRelationMode="none",e.bondFormationRate=.06,e.trustBase=.5,e.empathy=.38,e.cohesion=.35}},{id:"polarization_spiral",name:"Polarization Spiral",icon:"",category:"conflict",description:"2 RIFT totems  low trust  ideology  extreme polarization",apply(e,t){e.agentCount=120,e.groupCount=2,e.speed=.52,e.aggressionBase=.5,e.trustBase=.28,e.ideologyPressure=.65,e.violationThreshold=3,e.autoSymbols=!0,t.diffuseN=.05,t.diffuseL=.03},setupWorld(e,t){t.totems.push(Nr("RIFT",-.58,0,.3,0,1)),t.totems.push(Nr("RIFT",.58,0,.3,1,1)),_o(e,-.58,0,.45,.28),_o(e,.58,0,.45,.28),e.dirty=!0}},{id:"sacred_founder",name:"Sacred Founder",icon:"",category:"genesis",description:"Single massive BOND totem draws all groups  pilgrimage dynamics",apply(e,t){e.agentCount=160,e.groupCount=4,e.speed=.42,e.cohesion=.45,e.kBelief=.55,e.kFear=.25,e.ideologyPressure=.3,e.autoSymbols=!0,t.decayL=.004,t.diffuseL=.08},setupWorld(e,t){t.totems.push(Nr("BOND",0,0,.55,0,1.2)),_o(e,0,0,.9,.55),Na(e,0,0,.6,.4),e.dirty=!0}},{id:"tribal_council",name:"Tribal Council",icon:"",category:"genesis",description:"5 independent tribes  each with a BOND totem  federation dynamics",apply(e,t){e.agentCount=150,e.groupCount=5,e.speed=.45,e.cohesion=.65,e.aggressionBase=.28,e.ideologyPressure=.2,e.autoSymbols=!0,e.spawnRelationMode="none",e.startWithFamilies=!1,e.bondFormationRate=.1,e.birthMemoryStrength=.75,t.diffuseN=.08,e.groupProfiles=[{name:"Tribo do Fogo",sphere:"military",fieldSensitivity:{n:1,l:1,r:1.2},ideologyBias:-.3,trustBias:.5,aggressionBias:.35,cohesionBias:.8,desireBias:.4},{name:"Tribo da gua",sphere:"religious",fieldSensitivity:{n:1.6,l:1,r:.6},ideologyBias:-.4,trustBias:.6,aggressionBias:.1,cohesionBias:.7,desireBias:.3},{name:"Tribo do Vento",sphere:"artistic",fieldSensitivity:{n:.6,l:.8,r:1},ideologyBias:.4,trustBias:.4,aggressionBias:.1,cohesionBias:.5,desireBias:.7},{name:"Tribo da Terra",sphere:"economic",fieldSensitivity:{n:.8,l:.6,r:1.8},ideologyBias:.1,trustBias:.5,aggressionBias:.2,cohesionBias:.6,desireBias:.5},{name:"Tribo do Raio",sphere:"political",fieldSensitivity:{n:.8,l:1.6,r:.8},ideologyBias:-.5,trustBias:.4,aggressionBias:.3,cohesionBias:.7,desireBias:.3}]},setupWorld(e,t){[[0,-.62],[.59,-.19],[.36,.5],[-.36,.5],[-.59,-.19]].forEach(([r,a],i)=>{t.totems.push(Nr("BOND",r,a,.22,i,.75)),_o(e,r,a,.35,.2)}),e.dirty=!0}},{id:"scarcity_war",name:"Scarcity War",icon:"",category:"conflict",description:"Resources near depletion  groups clash over remaining hotspots",apply(e,t){e.agentCount=160,e.groupCount=4,e.speed=.55,e.aggressionBase=.6,e.trustBase=.3,e.harvestRate=.14,e.decayWealth=.025,e.violationThreshold=4,e.autoSymbols=!0,t.regenR=.006,t.decayR=.015},setupWorld(e,t){for(let n=0;n<e.r.length;n++)e.r[n]=.05;Kr(e,.5,-.5,.7,.22),Kr(e,-.5,.5,.65,.2),e.dirty=!0}},{id:"factional_war",name:"Factional Holy War",icon:"",category:"conflict",description:"2 groups  opposing RIFT totems  max aggression  legitimacy conflict",apply(e,t){e.agentCount=140,e.groupCount=2,e.speed=.58,e.aggressionBase=.72,e.trustBase=.15,e.ideologyPressure=.7,e.kFear=.55,e.violationThreshold=2,e.exceptionDuration=40,e.autoSymbols=!0,t.diffuseN=.04,e.groupProfiles=[{name:"Cruzado",sphere:"religious",fieldSensitivity:{n:2,l:1.5,r:.4},ideologyBias:-.7,trustBias:.6,aggressionBias:.5,cohesionBias:.9,desireBias:.2},{name:"Herege",sphere:"religious",fieldSensitivity:{n:1.8,l:.8,r:.6},ideologyBias:.5,trustBias:.3,aggressionBias:.5,cohesionBias:.7,desireBias:.6}]},setupWorld(e,t){t.totems.push(Nr("RIFT",-.55,.1,.32,0,1.1)),t.totems.push(Nr("RIFT",.55,-.1,.32,1,1.1)),_o(e,-.55,0,.55,.3),_o(e,.55,0,.55,.3),t.tabus.push(Us("NO_MIX",0,0,.2,.8)),e.dirty=!0}},{id:"the_schism",name:"The Schism",icon:"",category:"conflict",description:"4 groups unified then split  watch polarization break cohesion",apply(e,t){e.agentCount=160,e.groupCount=4,e.speed=.46,e.cohesion=.7,e.aggressionBase=.22,e.ideologyPressure=.55,e.autoSymbols=!0,t.diffuseN=.07,t.diffuseL=.04},setupWorld(e,t){t.totems.push(Nr("BOND",0,0,.4,0,.8)),t.totems.push(Nr("RIFT",.7,.7,.22,0,.9)),t.totems.push(Nr("RIFT",-.7,-.7,.22,2,.9)),Na(e,0,0,.5,.4),e.dirty=!0}},{id:"border_tensions",name:"Border Tensions",icon:"",category:"conflict",description:"3 groups  3 Taboo boundaries  mixing forbidden  endogamy",apply(e,t){e.agentCount=150,e.groupCount=3,e.speed=.44,e.aggressionBase=.4,e.trustBase=.35,e.autoSymbols=!0,t.diffuseN=.1},setupWorld(e,t){t.tabus.push(Us("NO_MIX",.55,0,.22,.7)),t.tabus.push(Us("NO_MIX",-.28,.48,.22,.7)),t.tabus.push(Us("NO_MIX",-.28,-.48,.22,.7)),e.dirty=!0}},{id:"gold_rush",name:"Gold Rush",icon:"",category:"economy",description:"5 resource hotspots  fast harvest  visible inequality race",apply(e,t){e.agentCount=160,e.groupCount=4,e.harvestRate=.13,e.decayWealth=.006,e.aggressionBase=.3,e.trustBase=.5,e.autoSymbols=!0,t.regenR=.03,t.decayR=.003},setupWorld(e,t){[[.6,0],[-.6,0],[0,.6],[0,-.6],[0,0]].forEach(([r,a])=>Kr(e,r,a,.8,.18)),e.dirty=!0}},{id:"plutocracy",name:"Plutocracy",icon:"",category:"economy",description:"Extreme wealthstatus advantage  elites dominate access to L",apply(e,t){e.agentCount=160,e.groupCount=4,e.harvestRate=.15,e.decayWealth=.004,e.aggressionBase=.2,e.trustBase=.45,e.ideologyPressure=.2,e.autoSymbols=!0,t.regenR=.025,t.decayL=.004},setupWorld(e,t){Kr(e,0,0,.9,.5),t.totems.push(Nr("BOND",0,0,.45,0,1.2)),e.dirty=!0}},{id:"redistribution",name:"Redistribution Crisis",icon:"",category:"economy",description:"Equal starting R + fast depletion  GATHER rituals redistribute",apply(e,t){e.agentCount=140,e.groupCount=3,e.harvestRate=.08,e.decayWealth=.018,e.cohesion=.6,e.kBelief=.45,e.autoSymbols=!0,t.regenR=.012,t.decayR=.01},setupWorld(e,t){for(let n=0;n<e.r.length;n++)e.r[n]=.8;t.rituals.push(vs("GATHER",-.45,-.45,.3,7)),t.rituals.push(vs("GATHER",.45,.45,.3,7)),e.dirty=!0}},{id:"mind_merge",name:"Mind Merge",icon:"",category:"culture",description:"Extreme ideology pressure  5 groups converging to single worldview",apply(e,t){e.agentCount=150,e.groupCount=5,e.speed=.4,e.ideologyPressure=.8,e.pressure=.6,e.trustBase=.7,e.aggressionBase=.1,e.autoSymbols=!0,t.diffuseN=.15}},{id:"reform_wave",name:"Reform Wave",icon:"",category:"culture",description:"Declining norms  high desire  transgression becomes new norm",apply(e,t){e.agentCount=160,e.groupCount=4,e.kDesire=.65,e.kBelief=.15,e.aggressionBase=.22,e.trustBase=.55,e.ideologyPressure=.35,e.violationThreshold=8,e.autoSymbols=!0,t.decayN=.045,t.diffuseN=.08},setupWorld(e,t){for(let n=0;n<e.n.length;n++)e.n[n]=Math.min(1,e.n[n]+.45);e.dirty=!0}},{id:"assembly_democracy",name:"Assembly Democracy",icon:"",category:"culture",description:"3 GATHER rituals  consensus building  polarization falls over time",apply(e,t){e.agentCount=140,e.groupCount=3,e.speed=.38,e.cohesion=.55,e.pressure=.5,e.trustBase=.65,e.aggressionBase=.12,e.autoSymbols=!0,t.diffuseN=.12},setupWorld(e,t){t.rituals.push(vs("GATHER",0,0,.35,7)),t.rituals.push(vs("GATHER",-.55,.55,.28,11)),t.rituals.push(vs("GATHER",.55,.55,.28,11)),e.dirty=!0}},{id:"carnival_collapse",name:"Carnival & Collapse",icon:"",category:"culture",description:"High desire  ritual overload  fatigue cascade  norms dissolve",apply(e,t){e.agentCount=160,e.groupCount=4,e.speed=.58,e.kDesire=.75,e.kBelief=.1,e.aggressionBase=.18,e.trustBase=.6,e.violationThreshold=10,e.autoSymbols=!0,t.decayN=.055,t.regenR=.035},setupWorld(e,t){t.rituals.push(vs("GATHER",0,0,.45,4)),t.rituals.push(vs("GATHER",.6,.6,.25,3)),t.rituals.push(vs("GATHER",-.6,.6,.25,3)),t.rituals.push(vs("GATHER",0,-.65,.25,5));for(let n=0;n<e.r.length;n++)e.r[n]=.6;e.dirty=!0}},{id:"iron_order",name:"Iron Order",icon:"",category:"power",description:"N field maxed  fear economy  exception threshold = 1 violation",apply(e,t){e.agentCount=140,e.groupCount=3,e.speed=.35,e.kBelief=.8,e.kFear=.75,e.aggressionBase=.1,e.trustBase=.55,e.violationThreshold=1,e.exceptionDuration=40,e.autoSymbols=!0,t.decayN=.005,t.diffuseN=.18},setupWorld(e,t){for(let n=0;n<e.n.length;n++)e.n[n]=.85;t.totems.push(Nr("BOND",0,0,.55,0,1.4)),t.rituals.push(vs("PROCESSION",0,0,.65,6)),e.dirty=!0}},{id:"panopticon",name:"Panopticon",icon:"",category:"power",description:"4 Taboo NO_ENTER zones  surveillance grid  fear drives compliance",apply(e,t){e.agentCount=150,e.groupCount=3,e.speed=.4,e.kFear=.65,e.kBelief=.5,e.violationThreshold=2,e.autoSymbols=!0,t.diffuseN=.12},setupWorld(e,t){t.tabus.push(Us("NO_ENTER",.55,.55,.2,.8)),t.tabus.push(Us("NO_ENTER",-.55,.55,.2,.8)),t.tabus.push(Us("NO_ENTER",.55,-.55,.2,.8)),t.tabus.push(Us("NO_ENTER",-.55,-.55,.2,.8)),e.dirty=!0}},{id:"peace_brokers",name:"Peace Brokers",icon:"",category:"power",description:"High trust  mediators dominant  cross-group bonds prevent escalation",apply(e,t){e.agentCount=160,e.groupCount=4,e.speed=.42,e.trustBase=.82,e.aggressionBase=.05,e.pressure=.55,e.cohesion=.4,e.ideologyPressure=.35,e.autoSymbols=!0,t.diffuseL=.1,t.regenR=.025}},{id:"phoenix",name:"Phoenix",icon:"",category:"power",description:"Starts in STATE OF EXCEPTION  watch how order rebuilds from collapse",apply(e,t){e.agentCount=140,e.groupCount=4,e.speed=.5,e.kFear=.6,e.kBelief=.4,e.aggressionBase=.45,e.trustBase=.3,e.violationThreshold=1,e.exceptionDuration=35,e.autoSymbols=!0,t.decayN=.025},setupWorld(e,t){for(let n=0;n<e.n.length;n++)e.n[n]=.05;for(let n=0;n<e.r.length;n++)e.r[n]=.7;e.dirty=!0}},{id:"nomadic_encounter",name:"Nomadic Encounter",icon:"",category:"genesis",description:"High mobility  low loyalty  groups intermix freely  emergent tribes",apply(e){e.agentCount=180,e.groupCount=5,e.speed=.55,e.mobility=.6,e.cohesion=.2,e.culturalInertia=.15,e.contagion=.55,e.empathy=.5,e.conformity=.15,e.cooperationBias=.35,e.autoSymbols=!0}},{id:"silent_consensus",name:"Silent Consensus",icon:"",category:"genesis",description:"Extreme conformity  no aggression  ideology converges without conflict",apply(e){e.agentCount=160,e.groupCount=3,e.conformity=.9,e.empathy=.65,e.aggressionBase=.02,e.ideologyPressure=.5,e.culturalInertia=.7,e.innovationRate=.01,e.autoSymbols=!0},setupWorld(e){for(let t=0;t<e.n.length;t++)e.n[t]=.35;e.dirty=!0}},{id:"first_contact",name:"First Contact",icon:"",category:"genesis",description:"2 isolated groups meet  empathy vs aggression determines outcome",apply(e){e.agentCount=120,e.groupCount=2,e.speed=.42,e.empathy=.55,e.aggressionBase=.35,e.contagion=.4,e.mobility=.15,e.culturalInertia=.6,e.cooperationBias=.25,e.autoSymbols=!0},setupWorld(e,t){t.totems.push(Nr("BOND",-.6,0,.22,0,.7)),t.totems.push(Nr("BOND",.6,0,.22,1,.7)),e.dirty=!0}},{id:"oral_tradition",name:"Oral Tradition",icon:"",category:"genesis",description:"High contagion + archives emerge  memes spread and crystallize",apply(e){e.agentCount=150,e.groupCount=4,e.contagion=.75,e.culturalInertia=.55,e.hierarchyStrength=.5,e.empathy=.4,e.conformity=.45,e.autoSymbols=!0}},{id:"culture_war",name:"Culture War",icon:"",category:"conflict",description:"High contagion + low empathy + innovation  memetic conflict",apply(e){e.agentCount=180,e.groupCount=4,e.contagion=.7,e.empathy=.1,e.innovationRate=.15,e.ideologyPressure=.65,e.aggressionBase=.4,e.culturalInertia=.25,e.hierarchyStrength=.55,e.autoSymbols=!0},setupWorld(e,t){t.totems.push(Nr("RIFT",-.5,-.5,.24,0,.9)),t.totems.push(Nr("RIFT",.5,.5,.24,2,.9)),e.dirty=!0}},{id:"class_revolt",name:"Class Revolt",icon:"",category:"conflict",description:"Extreme inequality + high desire + low conformity  uprising",apply(e){e.agentCount=200,e.groupCount=3,e.speed=.52,e.aggressionBase=.45,e.conformity=.1,e.kDesire=.7,e.cooperationBias=.55,e.resourceScarcity=.2,e.harvestRate=.12,e.decayWealth=.02,e.violationThreshold=2,e.autoSymbols=!0,e.groupProfiles=[{name:"Aristocrata",sphere:"political",fieldSensitivity:{n:.5,l:2,r:1.8},ideologyBias:-.7,trustBias:.3,aggressionBias:.15,cohesionBias:.8,desireBias:.2},{name:"Operrio",sphere:"popular",fieldSensitivity:{n:1.4,l:.5,r:1.4},ideologyBias:.4,trustBias:.4,aggressionBias:.4,cohesionBias:.6,desireBias:.7},{name:"Intelectual",sphere:"scientific",fieldSensitivity:{n:1,l:1.3,r:.8},ideologyBias:.5,trustBias:.5,aggressionBias:.1,cohesionBias:.3,desireBias:.6}]},setupWorld(e){for(let t=0;t<e.r.length;t++)e.r[t]=.08;Kr(e,0,0,.9,.18),e.dirty=!0}},{id:"proxy_war",name:"Proxy War",icon:"",category:"conflict",description:"4 groups  2 Oracles manipulate  hierarchy drives factional violence",apply(e){e.agentCount=160,e.groupCount=4,e.hierarchyStrength=.8,e.aggressionBase=.38,e.empathy=.12,e.contagion=.5,e.ideologyPressure=.55,e.autoSymbols=!0},setupWorld(e,t){t.totems.push(Nr("ORACLE",-.55,.2,.26,0,1)),t.totems.push(Nr("ORACLE",.55,-.2,.26,2,1)),_o(e,-.55,.2,.5,.25),_o(e,.55,-.2,.5,.25),e.dirty=!0}},{id:"genocide_risk",name:"Genocide Risk",icon:"",category:"conflict",description:"Exception + max aggression + NO_MIX + zero empathy  worst case",apply(e){e.agentCount=140,e.groupCount=2,e.speed=.5,e.aggressionBase=.8,e.empathy=0,e.conformity=.7,e.kFear=.7,e.trustBase=.1,e.violationThreshold=1,e.exceptionDuration=50,e.autoSymbols=!0},setupWorld(e,t){for(let n=0;n<e.n.length;n++)e.n[n]=.7;t.tabus.push(Us("NO_MIX",0,0,.3,.9)),t.totems.push(Nr("RIFT",-.55,0,.28,0,1.2)),t.totems.push(Nr("RIFT",.55,0,.28,1,1.2)),e.dirty=!0}},{id:"commons_tragedy",name:"Tragedy of the Commons",icon:"",category:"economy",description:"Shared resources + zero cooperation  depletion  conflict",apply(e){e.agentCount=180,e.groupCount=4,e.cooperationBias=0,e.harvestRate=.14,e.decayWealth=.015,e.resourceScarcity=.3,e.aggressionBase=.35,e.conformity=.2,e.autoSymbols=!0},setupWorld(e){for(let t=0;t<e.r.length;t++)e.r[t]=.5;e.dirty=!0}},{id:"gift_economy",name:"Gift Economy",icon:"",category:"economy",description:"Max cooperation + offering rituals + empathy  wealth equality",apply(e){e.agentCount=140,e.groupCount=3,e.cooperationBias=.85,e.empathy=.65,e.harvestRate=.07,e.decayWealth=.01,e.aggressionBase=.05,e.conformity=.45,e.autoSymbols=!0},setupWorld(e,t){t.rituals.push(vs("OFFERING",0,0,.35,6)),t.rituals.push(vs("OFFERING",-.55,-.55,.25,8));for(let n=0;n<e.r.length;n++)e.r[n]=.55;e.dirty=!0}},{id:"colonial_extraction",name:"Colonial Extraction",icon:"",category:"economy",description:"Central group hoards R  peripheral groups depleted  hierarchy exploits",apply(e){e.agentCount=180,e.groupCount=4,e.hierarchyStrength=.75,e.cooperationBias=.1,e.harvestRate=.15,e.decayWealth=.005,e.resourceScarcity=.35,e.conformity=.55,e.autoSymbols=!0,e.spawnRelationMode="sparse",e.startWithFamilies=!1,e.bondFormationRate=.05,e.birthMemoryStrength=.85,e.groupProfiles=[{name:"Colono",sphere:"political",fieldSensitivity:{n:.5,l:2,r:1.8},ideologyBias:-.6,trustBias:.3,aggressionBias:.3,cohesionBias:.8,desireBias:.4},{name:"Missionrio",sphere:"religious",fieldSensitivity:{n:2,l:1.2,r:.4},ideologyBias:-.7,trustBias:.6,aggressionBias:.1,cohesionBias:.7,desireBias:.15},{name:"Nativo",sphere:"popular",fieldSensitivity:{n:1.2,l:.4,r:1.2},ideologyBias:.1,trustBias:.5,aggressionBias:.3,cohesionBias:.6,desireBias:.5},{name:"Escravo",sphere:"popular",fieldSensitivity:{n:1.5,l:.3,r:1.5},ideologyBias:.3,trustBias:.2,aggressionBias:.4,cohesionBias:.5,desireBias:.7}]},setupWorld(e,t){for(let n=0;n<e.r.length;n++)e.r[n]=.1;Kr(e,0,0,.95,.3),t.totems.push(Nr("BOND",0,0,.35,0,1.1)),t.tabus.push(Us("NO_ENTER",0,0,.2,.8)),e.dirty=!0}},{id:"renaissance",name:"Renaissance",icon:"",category:"culture",description:"High innovation + high empathy + oracles  cultural explosion",apply(e){e.agentCount=160,e.groupCount=5,e.innovationRate=.2,e.empathy=.6,e.contagion=.55,e.culturalInertia=.1,e.cooperationBias=.45,e.hierarchyStrength=.4,e.aggressionBase=.08,e.autoSymbols=!0,e.groupProfiles=[{name:"Mecenas",sphere:"economic",fieldSensitivity:{n:.6,l:1.2,r:1.8},ideologyBias:.2,trustBias:.5,aggressionBias:.08,cohesionBias:.5,desireBias:.5},{name:"Artista",sphere:"artistic",fieldSensitivity:{n:.4,l:.8,r:1},ideologyBias:.6,trustBias:.5,aggressionBias:.05,cohesionBias:.3,desireBias:.9},{name:"Humanista",sphere:"scientific",fieldSensitivity:{n:1,l:1.5,r:.8},ideologyBias:.4,trustBias:.7,aggressionBias:.05,cohesionBias:.4,desireBias:.6},{name:"Clero",sphere:"religious",fieldSensitivity:{n:1.8,l:1.3,r:.4},ideologyBias:-.5,trustBias:.6,aggressionBias:.1,cohesionBias:.7,desireBias:.15},{name:"Povo",sphere:"popular",fieldSensitivity:{n:1.2,l:.5,r:1.3},ideologyBias:-.1,trustBias:.4,aggressionBias:.2,cohesionBias:.5,desireBias:.5}]},setupWorld(e,t){t.totems.push(Nr("ORACLE",0,0,.3,0,1)),Kr(e,0,0,.6,.4),e.dirty=!0}},{id:"mass_hysteria",name:"Mass Hysteria",icon:"",category:"culture",description:"Max empathy + fear contagion + low conformity  panic cascades",apply(e){e.agentCount=180,e.groupCount=3,e.empathy=.9,e.kFear=.65,e.conformity=.15,e.contagion=.65,e.aggressionBase=.3,e.innovationRate=.08,e.speed=.55,e.autoSymbols=!0},setupWorld(e,t){t.tabus.push(Us("NO_ENTER",0,0,.25,.9)),e.dirty=!0}},{id:"cultural_assimilation",name:"Cultural Assimilation",icon:"",category:"culture",description:"High mobility + high conformity + 1 dominant BOND  groups merge",apply(e){e.agentCount=160,e.groupCount=5,e.mobility=.5,e.conformity=.7,e.contagion=.6,e.culturalInertia=.2,e.empathy=.4,e.cohesion=.3,e.autoSymbols=!0},setupWorld(e,t){t.totems.push(Nr("BOND",0,0,.45,0,1.2)),Na(e,0,0,.6,.4),e.dirty=!0}},{id:"counter_culture",name:"Counter-Culture",icon:"",category:"culture",description:"High innovation + low conformity + high desire  new movements emerge",apply(e){e.agentCount=160,e.groupCount=4,e.innovationRate=.18,e.conformity=.08,e.kDesire=.65,e.empathy=.45,e.contagion=.5,e.culturalInertia=.15,e.mobility=.3,e.aggressionBase=.15,e.autoSymbols=!0},setupWorld(e){for(let t=0;t<e.n.length;t++)e.n[t]=.55;e.dirty=!0}},{id:"theocracy",name:"Theocracy",icon:"",category:"power",description:"Oracle + BOND + max hierarchy + high conformity  total control",apply(e){e.agentCount=150,e.groupCount=3,e.hierarchyStrength=.9,e.conformity=.8,e.kBelief=.75,e.empathy=.3,e.culturalInertia=.8,e.innovationRate=.01,e.violationThreshold=1,e.autoSymbols=!0,e.groupProfiles=[{name:"Sacerdote",sphere:"religious",fieldSensitivity:{n:2,l:1.8,r:.3},ideologyBias:-.8,trustBias:.7,aggressionBias:.1,cohesionBias:.9,desireBias:.1},{name:"Fiel",sphere:"religious",fieldSensitivity:{n:1.8,l:1,r:.6},ideologyBias:-.5,trustBias:.6,aggressionBias:.15,cohesionBias:.7,desireBias:.2},{name:"Hertico",sphere:"artistic",fieldSensitivity:{n:.5,l:.6,r:1},ideologyBias:.6,trustBias:.2,aggressionBias:.2,cohesionBias:.2,desireBias:.8}]},setupWorld(e,t){for(let n=0;n<e.n.length;n++)e.n[n]=.75;t.totems.push(Nr("ORACLE",0,0,.4,0,1.3)),t.totems.push(Nr("BOND",0,.35,.28,0,.9)),t.rituals.push(vs("PROCESSION",0,0,.55,7)),_o(e,0,0,.8,.45),e.dirty=!0}},{id:"anarchist_commune",name:"Anarchist Commune",icon:"",category:"power",description:"Zero hierarchy + max cooperation + high empathy + no norms  self-org",apply(e){e.agentCount=120,e.groupCount=4,e.hierarchyStrength=0,e.cooperationBias=.8,e.empathy=.7,e.conformity=0,e.groupProfiles=[{name:"Assembleia",sphere:"political",fieldSensitivity:{n:1,l:1,r:1},ideologyBias:.5,trustBias:.7,aggressionBias:.05,cohesionBias:.3,desireBias:.5},{name:"Arteso",sphere:"artistic",fieldSensitivity:{n:.5,l:.8,r:1.2},ideologyBias:.6,trustBias:.6,aggressionBias:.05,cohesionBias:.3,desireBias:.7},{name:"Agricultor",sphere:"economic",fieldSensitivity:{n:.6,l:.6,r:1.6},ideologyBias:.2,trustBias:.6,aggressionBias:.1,cohesionBias:.4,desireBias:.4},{name:"Nmade",sphere:"popular",fieldSensitivity:{n:.8,l:.5,r:1},ideologyBias:.7,trustBias:.4,aggressionBias:.1,cohesionBias:.15,desireBias:.8}],e.kBelief=.05,e.kFear=.1,e.aggressionBase=.08,e.innovationRate=.12,e.mobility=.4,e.autoSymbols=!0,e.violationThreshold=99},setupWorld(e){for(let t=0;t<e.r.length;t++)e.r[t]=.65;e.dirty=!0}},{id:"populist_surge",name:"Populist Surge",icon:"",category:"power",description:"Charismatic Oracle + high contagion + empathy  rapid mass movement",apply(e){e.agentCount=200,e.groupCount=4,e.contagion=.8,e.empathy=.55,e.hierarchyStrength=.65,e.conformity=.45,e.ideologyPressure=.6,e.speed=.5,e.autoSymbols=!0},setupWorld(e,t){t.totems.push(Nr("ORACLE",-.3,-.3,.3,0,1.2)),_o(e,-.3,-.3,.65,.3),e.dirty=!0}},{id:"panopticon_regime",name:"Panopticon Regime",icon:"",category:"power",description:"PANOPTICON + PROCESSION + strict tabus  fear rises  dictators emerge",apply(e,t){e.agentCount=170,e.groupCount=4,e.speed=.44,e.trustBase=.38,e.aggressionBase=.32,e.kBelief=.62,e.kFear=.7,e.conformity=.7,e.hierarchyStrength=.85,e.panopticism=.95,e.ideologyPressure=.45,e.violationThreshold=2,e.exceptionDuration=45,e.autoSymbols=!0,t.decayN=.01,t.diffuseN=.1,t.decayL=.006,t.regenR=.014},setupWorld(e,t){for(let n=0;n<e.n.length;n++)e.n[n]=Math.min(1,e.n[n]+.3);t.totems.push(Nr("PANOPTICON",0,0,.62,0,1)),t.rituals.push(vs("PROCESSION",0,0,.62,8)),t.tabus.push(Us("NO_ENTER",.18,.08,.16,.7)),t.tabus.push(Us("NO_ENTER",-.22,-.12,.16,.7));for(let n=0;n<e.r.length;n++)e.r[n]=.12;Kr(e,.65,0,.7,.18),Kr(e,-.65,0,.55,.16),_o(e,0,0,.55,.35),e.dirty=!0}},{id:"state_church",name:"State Church",icon:"",category:"power",description:"BOND + ARCHIVE + GATHER  high belief  priests legitimize authority",apply(e,t){e.agentCount=160,e.groupCount=4,e.speed=.4,e.kBelief=.75,e.kFear=.35,e.kDesire=.22,e.hierarchyStrength=.7,e.conformity=.6,e.empathy=.35,e.cooperationBias=.25,e.culturalInertia=.7,e.panopticism=.25,e.autoSymbols=!0,t.decayN=.006,t.diffuseN=.12,t.decayL=.003,t.regenR=.018},setupWorld(e,t){t.totems.push(Nr("BOND",0,0,.48,0,1.15)),t.totems.push(Nr("ARCHIVE",0,.38,.28,0,.7)),t.rituals.push(vs("GATHER",0,0,.5,9)),Na(e,0,0,.65,.45),_o(e,0,0,.7,.4),e.dirty=!0}},{id:"empire_collapse",name:"Empire Collapse",icon:"",category:"power",description:"Archive crumbles  high innovation + mobility  fragmentation",apply(e){e.agentCount=180,e.groupCount=5,e.mobility=.55,e.innovationRate=.15,e.culturalInertia=.1,e.conformity=.15,e.kBelief=.15,e.aggressionBase=.4,e.cooperationBias=.15,e.hierarchyStrength=.25,e.autoSymbols=!0},setupWorld(e,t){t.totems.push(Nr("ARCHIVE",0,0,.35,0,.6));for(let n=0;n<e.n.length;n++)e.n[n]=.5;for(let n=0;n<e.l.length;n++)e.l[n]=.4;e.dirty=!0}},{id:"bourdieu_fields",name:"Campos Sociais",icon:"",category:"multi-field",description:"5 grupos com lgicas de campo distintas (Bourdieu)  poltico, econmico, religioso, artstico, cientfico",apply(e){e.agentCount=200,e.groupCount=5,e.speed=.48,e.cohesion=.55,e.empathy=.35,e.mobility=.1,e.ideologyPressure=.3,e.autoSymbols=!0,e.groupProfiles=[{name:"Poltico",sphere:"political",fieldSensitivity:{n:1.4,l:1.8,r:.5},ideologyBias:-.4,trustBias:.5,aggressionBias:.35,cohesionBias:.7,desireBias:.4},{name:"Mercador",sphere:"economic",fieldSensitivity:{n:.5,l:.7,r:2},ideologyBias:.3,trustBias:.4,aggressionBias:.2,cohesionBias:.4,desireBias:.7},{name:"Devoto",sphere:"religious",fieldSensitivity:{n:2,l:1.2,r:.3},ideologyBias:-.6,trustBias:.8,aggressionBias:.15,cohesionBias:.9,desireBias:.15},{name:"Artista",sphere:"artistic",fieldSensitivity:{n:.4,l:.9,r:1.1},ideologyBias:.6,trustBias:.5,aggressionBias:.1,cohesionBias:.25,desireBias:.9},{name:"Cientfico",sphere:"scientific",fieldSensitivity:{n:1,l:1.5,r:1},ideologyBias:.4,trustBias:.7,aggressionBias:.08,cohesionBias:.5,desireBias:.55}]},setupWorld(e,t){_o(e,-.55,-.3,.4,.3),Kr(e,.55,-.3,.45,.3),Na(e,0,.55,.4,.35),_o(e,-.3,.3,.3,.2),Kr(e,.3,.3,.3,.2),t.totems.push(Nr("BOND",0,.55,.3,2,.8)),t.totems.push(Nr("ARCHIVE",-.3,.3,.25,4,.6)),e.dirty=!0}},{id:"stratified_society",name:"Sociedade Estratificada",icon:"",category:"multi-field",description:"Classes sociais com capitais diferentes  elite poltica, burguesia, clero, proletariado, marginais",apply(e){e.agentCount=200,e.groupCount=5,e.speed=.42,e.hierarchyStrength=.7,e.cooperationBias=.2,e.mobility=.06,e.conformity=.5,e.autoSymbols=!0,e.groupProfiles=[{name:"Elite",sphere:"political",fieldSensitivity:{n:.8,l:2,r:1.5},ideologyBias:-.6,trustBias:.3,aggressionBias:.2,cohesionBias:.8,desireBias:.3},{name:"Burguesia",sphere:"economic",fieldSensitivity:{n:.5,l:1,r:2},ideologyBias:.1,trustBias:.5,aggressionBias:.15,cohesionBias:.5,desireBias:.65},{name:"Clero",sphere:"religious",fieldSensitivity:{n:2,l:1.5,r:.3},ideologyBias:-.7,trustBias:.8,aggressionBias:.1,cohesionBias:.9,desireBias:.1},{name:"Trabalhador",sphere:"popular",fieldSensitivity:{n:1.2,l:.6,r:1.5},ideologyBias:-.1,trustBias:.5,aggressionBias:.3,cohesionBias:.6,desireBias:.5},{name:"Marginal",sphere:"artistic",fieldSensitivity:{n:.3,l:.4,r:.8},ideologyBias:.7,trustBias:.2,aggressionBias:.5,cohesionBias:.2,desireBias:.9}]},setupWorld(e,t){_o(e,0,-.5,.5,.45),Kr(e,.5,0,.45,.35),Na(e,-.5,0,.4,.4),t.totems.push(Nr("BOND",0,-.5,.3,0,.9)),t.tabus.push(Us("NO_MIX",0,0,.15,.7)),e.dirty=!0}},{id:"cultural_melting_pot",name:"Caldeiro Cultural",icon:"",category:"multi-field",description:"Alta mobilidade, diversidade radical  subculturas se misturam e colidem",apply(e){e.agentCount=180,e.groupCount=5,e.speed=.55,e.mobility=.35,e.empathy=.5,e.innovationRate=.12,e.culturalInertia=.15,e.conformity=.2,e.autoSymbols=!0,e.groupProfiles=[{name:"Imigrante",sphere:"popular",fieldSensitivity:{n:1.3,l:.7,r:1.5},ideologyBias:-.2,trustBias:.4,aggressionBias:.2,cohesionBias:.7,desireBias:.6},{name:"Nativo",sphere:"political",fieldSensitivity:{n:1,l:1.5,r:1},ideologyBias:-.3,trustBias:.5,aggressionBias:.3,cohesionBias:.6,desireBias:.35},{name:"Artista",sphere:"artistic",fieldSensitivity:{n:.4,l:.8,r:1},ideologyBias:.6,trustBias:.5,aggressionBias:.08,cohesionBias:.3,desireBias:.85},{name:"Comerciante",sphere:"economic",fieldSensitivity:{n:.5,l:.7,r:2},ideologyBias:.2,trustBias:.4,aggressionBias:.15,cohesionBias:.4,desireBias:.6},{name:"Religioso",sphere:"religious",fieldSensitivity:{n:1.8,l:1.2,r:.4},ideologyBias:-.5,trustBias:.7,aggressionBias:.12,cohesionBias:.8,desireBias:.2}]},setupWorld(e){Na(e,0,0,.8,.25),_o(e,0,0,.6,.2),Kr(e,-.3,-.3,.5,.3),Kr(e,.3,.3,.5,.3),e.dirty=!0}},{id:"revolution_1789",name:"Revoluo",icon:"",category:"multi-field",description:"Nobreza  Clero  Burguesia  Povo  Sans-culottes  tenso pr-revolucionria",apply(e){e.agentCount=200,e.groupCount=5,e.speed=.5,e.aggressionBase=.4,e.ideologyPressure=.5,e.hierarchyStrength=.65,e.cooperationBias=.1,e.mobility=.08,e.autoSymbols=!0,e.groupProfiles=[{name:"Nobreza",sphere:"political",fieldSensitivity:{n:.6,l:2,r:1.8},ideologyBias:-.8,trustBias:.3,aggressionBias:.2,cohesionBias:.85,desireBias:.2},{name:"Clero",sphere:"religious",fieldSensitivity:{n:2,l:1.5,r:.5},ideologyBias:-.7,trustBias:.7,aggressionBias:.1,cohesionBias:.8,desireBias:.1},{name:"Burguesia",sphere:"economic",fieldSensitivity:{n:.7,l:1.2,r:2},ideologyBias:.3,trustBias:.5,aggressionBias:.2,cohesionBias:.5,desireBias:.7},{name:"Povo",sphere:"popular",fieldSensitivity:{n:1.4,l:.5,r:1.2},ideologyBias:-.1,trustBias:.4,aggressionBias:.35,cohesionBias:.5,desireBias:.6},{name:"Sans-culotte",sphere:"military",fieldSensitivity:{n:1,l:.3,r:.8},ideologyBias:.8,trustBias:.2,aggressionBias:.65,cohesionBias:.6,desireBias:.9}]},setupWorld(e,t){_o(e,0,-.55,.55,.5),Kr(e,.5,-.2,.4,.35),Na(e,-.5,0,.4,.4),t.totems.push(Nr("BOND",0,-.55,.3,0,1)),t.totems.push(Nr("RIFT",0,.3,.25,4,.9)),e.dirty=!0}},{id:"neoliberal_city",name:"Metrpole Neoliberal",icon:"",category:"multi-field",description:"Financistas, tecnocratas, precrios, artistas underground, migrantes  desigualdade extrema",apply(e){e.agentCount=200,e.groupCount=5,e.speed=.52,e.resourceScarcity=.35,e.hierarchyStrength=.6,e.cooperationBias=.12,e.mobility=.15,e.innovationRate=.1,e.autoSymbols=!0,e.groupProfiles=[{name:"Financista",sphere:"economic",fieldSensitivity:{n:.3,l:1,r:2},ideologyBias:.5,trustBias:.3,aggressionBias:.15,cohesionBias:.7,desireBias:.5},{name:"Tecnocrata",sphere:"scientific",fieldSensitivity:{n:.8,l:1.6,r:1.2},ideologyBias:.2,trustBias:.6,aggressionBias:.1,cohesionBias:.5,desireBias:.4},{name:"Precrio",sphere:"popular",fieldSensitivity:{n:1.5,l:.5,r:1.5},ideologyBias:-.1,trustBias:.3,aggressionBias:.4,cohesionBias:.5,desireBias:.7},{name:"Underground",sphere:"artistic",fieldSensitivity:{n:.3,l:.6,r:.7},ideologyBias:.7,trustBias:.4,aggressionBias:.12,cohesionBias:.2,desireBias:.95},{name:"Migrante",sphere:"popular",fieldSensitivity:{n:1.4,l:.4,r:1.6},ideologyBias:-.2,trustBias:.35,aggressionBias:.25,cohesionBias:.8,desireBias:.55}]},setupWorld(e){Kr(e,.5,-.5,.5,.45),Kr(e,-.4,.4,.3,.15),_o(e,0,-.3,.4,.3),Na(e,-.5,-.2,.35,.25),e.dirty=!0}},{id:"exodo_urbano",name:"xodo Urbano",icon:"",category:"multi-field",description:"Centro colapsa em recursos; agentes migram para periferias e refazem laos",apply(e,t){e.agentCount=200,e.groupCount=5,e.speed=.56,e.spawnRelationMode="none",e.startWithFamilies=!1,e.bondFormationRate=.11,e.birthMemoryStrength=.9,e.mobility=.42,e.resourceScarcity=.22,e.cooperationBias=.22,e.empathy=.46,e.contagion=.48,e.autoSymbols=!0,t.regenR=.016,t.decayR=.01},setupWorld(e,t){for(let n=0;n<e.r.length;n++)e.r[n]=.08;Kr(e,-.75,-.65,.62,.26),Kr(e,.78,-.6,.58,.24),Kr(e,.74,.66,.6,.24),Kr(e,-.72,.7,.56,.23),Na(e,0,0,-.2,.5),t.tabus.push(Us("NO_ENTER",0,0,.22,.65)),e.dirty=!0}},{id:"colonialismo",name:"Colonialismo",icon:"",category:"economy",description:"Extrao desigual + fronteiras simblicas + memrias de origem em disputa",apply(e,t){e.agentCount=190,e.groupCount=4,e.speed=.5,e.spawnRelationMode="sparse",e.startWithFamilies=!1,e.bondFormationRate=.06,e.birthMemoryStrength=.92,e.hierarchyStrength=.8,e.cooperationBias=.08,e.resourceScarcity=.3,e.panopticism=.62,e.autoSymbols=!0,t.diffuseN=.08,t.regenR=.015},setupWorld(e,t){for(let n=0;n<e.r.length;n++)e.r[n]=.11;Kr(e,.15,-.1,.92,.28),t.totems.push(Nr("PANOPTICON",.08,-.02,.44,0,.9)),t.tabus.push(Us("NO_ENTER",.12,-.04,.18,.82)),e.dirty=!0}},{id:"formacao_tribal",name:"Formao Tribal",icon:"",category:"genesis",description:"Sociedade nasce sem famlias; cls emergem por vizinhana, memria e cooperao",apply(e,t){e.agentCount=170,e.groupCount=5,e.speed=.46,e.spawnRelationMode="none",e.startWithFamilies=!1,e.bondFormationRate=.14,e.birthMemoryStrength=.74,e.cohesion=.56,e.empathy=.52,e.cooperationBias=.42,e.contagion=.34,e.autoSymbols=!0,t.diffuseN=.1,t.regenR=.022},setupWorld(e,t){Kr(e,0,-.55,.45,.25),Kr(e,.58,.32,.35,.2),Kr(e,-.58,.32,.35,.2),t.totems.push(Nr("BOND",0,-.5,.24,0,.75)),e.dirty=!0}},{id:"novas_ferramentas",name:"Novas Ferramentas",icon:"",category:"culture",description:"Salto tcnico aumenta mobilidade e contato; reconfigura laos e territrios sociais",apply(e,t){e.agentCount=180,e.groupCount=4,e.speed=.58,e.spawnRelationMode="sparse",e.startWithFamilies=!1,e.bondFormationRate=.09,e.birthMemoryStrength=.58,e.mobility=.5,e.innovationRate=.16,e.contagion=.62,e.empathy=.38,e.culturalInertia=.2,e.autoSymbols=!0,t.diffuseR=.08,t.regenR=.024},setupWorld(e,t){t.totems.push(Nr("ARCHIVE",-.45,-.25,.24,0,.6)),t.totems.push(Nr("ORACLE",.48,.22,.24,1,.75)),Kr(e,.45,.2,.5,.25),e.dirty=!0}},{id:"descoberta_cientifica",name:"Descoberta Cientfica",icon:"",category:"culture",description:"Alta compreenso e tica reduzem conflito e criam entanglement cooperativo estvel",apply(e,t){e.agentCount=160,e.groupCount=4,e.speed=.44,e.spawnRelationMode="none",e.startWithFamilies=!1,e.bondFormationRate=.12,e.birthMemoryStrength=.5,e.empathy=.64,e.understandingGrowth=.28,e.ethicsGrowth=.26,e.aggressionBase=.08,e.innovationRate=.14,e.autoSymbols=!0,t.diffuseL=.11,t.diffuseN=.1,t.regenR=.02},setupWorld(e,t){t.totems.push(Nr("ARCHIVE",0,.35,.28,0,.7)),t.rituals.push(vs("GATHER",0,0,.38,8)),_o(e,0,.35,.65,.35),Na(e,0,0,.42,.42),e.dirty=!0}},{id:"medieval_guilds",name:"Guildas Medievais",icon:"",category:"multi-field",description:"Nobres, clero, mercadores, artesos, camponeses  capitais simblicos distintos",apply(e){e.agentCount=180,e.groupCount=5,e.speed=.38,e.hierarchyStrength=.55,e.conformity=.6,e.culturalInertia=.65,e.mobility=.04,e.cooperationBias=.3,e.autoSymbols=!0,e.groupProfiles=[{name:"Nobre",sphere:"political",fieldSensitivity:{n:.7,l:2,r:1.5},ideologyBias:-.7,trustBias:.4,aggressionBias:.25,cohesionBias:.8,desireBias:.2},{name:"Clrigo",sphere:"religious",fieldSensitivity:{n:2,l:1.3,r:.3},ideologyBias:-.6,trustBias:.7,aggressionBias:.08,cohesionBias:.85,desireBias:.15},{name:"Mercador",sphere:"economic",fieldSensitivity:{n:.5,l:.8,r:2},ideologyBias:.2,trustBias:.5,aggressionBias:.15,cohesionBias:.5,desireBias:.6},{name:"Arteso",sphere:"artistic",fieldSensitivity:{n:.6,l:.7,r:1.3},ideologyBias:.1,trustBias:.6,aggressionBias:.12,cohesionBias:.6,desireBias:.5},{name:"Campons",sphere:"popular",fieldSensitivity:{n:1.5,l:.4,r:1.2},ideologyBias:-.2,trustBias:.4,aggressionBias:.3,cohesionBias:.6,desireBias:.4}]},setupWorld(e,t){_o(e,0,-.5,.5,.4),Kr(e,0,.2,.6,.25),Na(e,-.5,0,.35,.35),t.totems.push(Nr("BOND",0,-.5,.3,0,.8)),t.totems.push(Nr("BOND",-.5,0,.25,1,.7)),t.rituals.push(vs("FEAST",0,.2,.35,12)),e.dirty=!0}},{id:"cold_war_blocs",name:"Blocos Ideolgicos",icon:"",category:"multi-field",description:"3 blocos (Ocidente, Leste, No-alinhados) + militares + intelectuais dissidentes",apply(e){e.agentCount=200,e.groupCount=5,e.speed=.44,e.aggressionBase=.35,e.ideologyPressure=.55,e.panopticism=.65,e.conformity=.55,e.mobility=.05,e.autoSymbols=!0,e.groupProfiles=[{name:"Ocidente",sphere:"political",fieldSensitivity:{n:.6,l:1.8,r:1.8},ideologyBias:.5,trustBias:.5,aggressionBias:.25,cohesionBias:.7,desireBias:.5},{name:"Leste",sphere:"political",fieldSensitivity:{n:1.6,l:1.8,r:.4},ideologyBias:-.7,trustBias:.5,aggressionBias:.3,cohesionBias:.8,desireBias:.2},{name:"No-alinhado",sphere:"popular",fieldSensitivity:{n:1.2,l:.8,r:1.2},ideologyBias:0,trustBias:.4,aggressionBias:.2,cohesionBias:.4,desireBias:.5},{name:"Militar",sphere:"military",fieldSensitivity:{n:.8,l:1.5,r:.8},ideologyBias:-.5,trustBias:.3,aggressionBias:.6,cohesionBias:.9,desireBias:.3},{name:"Dissidente",sphere:"artistic",fieldSensitivity:{n:.5,l:.5,r:.6},ideologyBias:.8,trustBias:.3,aggressionBias:.1,cohesionBias:.2,desireBias:.9}]},setupWorld(e,t){_o(e,-.55,0,.5,.4),_o(e,.55,0,.5,.4),Na(e,.55,0,.4,.3),Kr(e,-.55,0,.4,.3),t.totems.push(Nr("RIFT",-.55,0,.3,0,.9)),t.totems.push(Nr("RIFT",.55,0,.3,1,.9)),t.totems.push(Nr("PANOPTICON",.55,0,.4,1,.8)),e.dirty=!0}},{id:"digital_platform",name:"Plataforma Digital",icon:"",category:"multi-field",description:"Influencers, trolls, moderadores, consumidores, ativistas  economia da ateno",apply(e){e.agentCount=200,e.groupCount=5,e.speed=.6,e.contagion=.55,e.empathy=.25,e.mobility=.25,e.innovationRate=.15,e.conformity=.35,e.autoSymbols=!0,e.groupProfiles=[{name:"Influencer",sphere:"artistic",fieldSensitivity:{n:.6,l:1.5,r:1.5},ideologyBias:.3,trustBias:.3,aggressionBias:.1,cohesionBias:.3,desireBias:.8},{name:"Troll",sphere:"military",fieldSensitivity:{n:.8,l:.5,r:.5},ideologyBias:.6,trustBias:.1,aggressionBias:.7,cohesionBias:.2,desireBias:.7},{name:"Moderador",sphere:"political",fieldSensitivity:{n:1.2,l:1.8,r:.8},ideologyBias:-.3,trustBias:.6,aggressionBias:.1,cohesionBias:.5,desireBias:.3},{name:"Consumidor",sphere:"economic",fieldSensitivity:{n:.7,l:.6,r:1.8},ideologyBias:0,trustBias:.5,aggressionBias:.15,cohesionBias:.4,desireBias:.6},{name:"Ativista",sphere:"popular",fieldSensitivity:{n:1.5,l:1,r:.5},ideologyBias:.5,trustBias:.4,aggressionBias:.35,cohesionBias:.6,desireBias:.7}]},setupWorld(e){Na(e,0,0,.9,.2),_o(e,0,0,.7,.15),Kr(e,0,0,.6,.15),e.dirty=!0}}],L4={genesis:"Genesis",conflict:"Conflict",economy:"Economy",culture:"Culture",power:"Power","multi-field":"Campos Sociais"},EW={SWARM:{short:"Anomia",long:"Anomia / disperso  laos fracos, sem ncleo"},CLUSTERS:{short:"Tribos",long:"Tribos / clusters  coeso identitria"},POLARIZED:{short:"Polarizao",long:"Polarizao  ns vs. eles, ideologias em choque"},CONFLICT:{short:"Guerra",long:"Guerra / conflito aberto  hostilidade generalizada"},CONSENSUS:{short:"Consenso",long:"Consenso  ordem estvel, normas compartilhadas"},EXCEPTION:{short:"Exceo",long:"Estado de exceo  soberania suspende a norma"},FERVOR:{short:"Religio poltica",long:"Movimento de massa / religio poltica  sapiens-demens"},ECO_CRISIS:{short:"Crise ecolgica",long:"Crise ecolgica  auto-eco-organizao colapsando"},TRANSCENDENCE:{short:"Nova filosofia",long:"tica emergente / nova filosofia  transcendncia"}};function z4(e,t=!1){const n=EW[e];return n?t?n.long:n.short:e}const TW={SWARM:{title:"Anomia",what:"Estado de disperso em que os laos sociais so fracos e no h ncleo de normas ou identidade compartilhada.",why:"Os agentes ainda no formaram clusters estveis; coeso baixa e alta mobilidade mantm o sistema fluido.",conditions:"Coeso baixa  poucos encontros repetidos  ausncia de smbolos (totens) que cristalizem crena."},CLUSTERS:{title:"Tribos / Clusters",what:"Grupos identitrios comeam a se formar; os agentes se agrupam por proximidade e afinidade (crena, grupo).",why:"A atrao por similares e a coeso de boids fazem emergir aglomerados estveis.",conditions:"Coeso mdia-alta  grupos espacialmente separados  legitimidade (L) ou norma (N) em zonas definidas."},POLARIZED:{title:"Polarizao",what:"Ns vs. eles: as ideologias se separam em polos (ordem vs. liberdade) e a confiana entre grupos cai.",why:"Totens de cisma (RIFT), presso ideolgica alta ou conflito de legitimidade amplificam a divergncia.",conditions:"Alta varincia de ideologia  baixa confiana intergrupo  presena de smbolos divisivos."},CONFLICT:{title:"Guerra / Conflito aberto",what:"Hostilidade generalizada entre grupos; violncia e medo altos; normas so contestadas pela fora.",why:"Conflito de recursos, legitimidade ou identidade sem mediao; agresso e medo se realimentam.",conditions:"Conflito medido alto  muitos encontros hostis  baixa compreenso e tica emergente."},CONSENSUS:{title:"Consenso",what:"Ordem estvel: normas compartilhadas, ideologia convergente e conflito baixo. A sociedade opera por acordo tcito ou explcito.",why:"Alta coeso, presso de conformidade e/ou totens de fundao (BOND) cristalizam crena; conflito foi resolvido ou evitado.",conditions:"Consenso medido alto  coeso alta  polarizao e conflito baixos  legitimidade (L) e norma (N) distribudas."},EXCEPTION:{title:"Estado de exceo",what:"A soberania suspende a norma: as regras habituais no valem; o poder age alm do consenso.",why:"Muitas violaes de tabu ou crise levam o sistema a estado de exceo (Schmitt / Agamben).",conditions:"Violaes de tabu acima do limiar  durao configurada de exceo."},FERVOR:{title:"Religio poltica / Movimento de massa",what:"Movimento de massa: crena e fervor altos, conformidade forte; risco de sapiens-demens (Morin)  razo e desrazo juntas.",why:"Fervor (crena + medo) acima do limiar; totens ou orculos concentram carisma e adeso.",conditions:"Fervor mdio alto  crena e medo elevados  possvel presena de orculo ou BOND forte."},ECO_CRISIS:{title:"Crise ecolgica",what:"Auto-eco-organizao em colapso: o ambiente (campo R) degrada; recursos insuficientes para a populao.",why:"Extrao (harvest) maior que regenerao; ecoFootprint dos agentes danifica o campo R.",conditions:"Sade ecolgica baixa  regenerao de R insuficiente  ecoDegradation alto."},TRANSCENDENCE:{title:"Nova filosofia / Transcendncia",what:"tica e compreenso emergentes permitem ir alm do conflito tribal: antropo-tica (Morin)  cuidado de si e do outro.",why:"Encontros pacficos entre grupos e entendimento mtuo elevam compreenso e tica; estas reduzem hybris e agresso.",conditions:"tica e compreenso mdias altas  conflito baixo  memrias amigveis cross-group."}};function IW(e){return TW[e]??{title:e,what:"",why:"",conditions:""}}const Vd={cohesion:{short:"Coeso",long:"Coeso  fora dos laos entre agentes do mesmo grupo; atrao e alinhamento."},polarization:{short:"Polarizao",long:"Polarizao  divergncia ideolgica (ordem vs. liberdade); ns vs. eles."},conflict:{short:"Conflito",long:"Conflito  nvel de hostilidade entre grupos; encontros hostis e agresso."},consensus:{short:"Consenso",long:"Consenso  grau de acordo nas normas e na ideologia; ordem estvel."}},PW={normal:{short:"Cidado",long:"Cidado  agente de base"},leader:{short:"Lder nato",long:"Lder nato  centralidade e status"},authority:{short:"Autoridade",long:"Autoridade institucional  poder legtimo"},dictator:{short:"Ditador",long:"Ditador / tirano  poder coercivo"},priest:{short:"Sacerdote",long:"Sacerdote / legitimador  religio e carisma"},guardian:{short:"Guardio",long:"Guardio das normas  crena + status"},mediator:{short:"Mediador",long:"Mediador / ponte  laos cross-group"},aggressor:{short:"Agressor",long:"Agressor  hostilidade ativa"},rebel:{short:"Revolucionrio",long:"Revolucionrio / dissidente"},artist:{short:"Artista",long:"Artista  desejo alto, transgresso simblica"},innovator:{short:"Inovador",long:"Inovador  desejo + status + liberdade"},predator:{short:"Predador",long:"Predador / psicopata social  agresso + baixa empatia"}};function Ki(e,t=!1){const n=PW[e];return n?t?n.long:n.short:e}const Wg={totem_bond:{short:"Fundao",long:"Colocar totem de fundao (religio / instituio)"},totem_rift:{short:"Cisma",long:"Colocar totem de cisma (polarizao)"},totem_oracle:{short:"Orculo",long:"Colocar orculo (autoridade carismtica)"},totem_archive:{short:"Arquivo",long:"Colocar arquivo (memria coletiva)"},totem_panopticon:{short:"Panptico",long:"Colocar panptico (vigilncia)"},tabu_enter:{short:"Tabu entrada",long:"Tabu de entrada (moral panic)"},tabu_mix:{short:"Tabu mistura",long:"Tabu de mistura (fronteira)"},ritual_gather:{short:"Assembleia",long:"Ritual de assembleia"},ritual_procession:{short:"Procisso",long:"Ritual de procisso"},ritual_offering:{short:"Oferta",long:"Ritual de oferta (redistribuio)"},ritual_revolt:{short:"Revoluo",long:"Ritual de revoluo"}};function FW(e){const t=e.toLowerCase();return t.includes("phase")||t.includes("")?"Mudana de fase":t.includes("taboo")||t.includes("violation")||t.includes("violao")?"Violao de tabu":t.includes("state of exception")||t.includes("excepo")?"Estado de exceo":t.includes("coalition")||t.includes("coalizo")?"Coalizo":t.includes("wealth gap")||t.includes("gini")?"Desigualdade":t.includes("foundation")||t.includes("crystallised")||t.includes("cristaliz")?"Fundao emergente":t.includes("schism")||t.includes("breaks from")?"Cisma":t.includes("oracle")||t.includes("charismatic")?"Orculo emergente":t.includes("archive")||t.includes("memory")?"Arquivo emergente":t.includes("revolt")||t.includes("revoluo")||t.includes("erupted")?"Revoluo":t.includes("offering")||t.includes("redistribut")||t.includes("poverty")?"Oferta / redistribuio":t.includes("gather")||t.includes("ritual begins")?"Assembleia":t.includes("procession")?"Procisso":t.includes("migrated")||t.includes("migrao")?"Migrao de grupo":t.includes("sealed")||t.includes("limit")?"Tabu selado":e}function pb(e){return e<1}function _W(e,t,n,r,a){const i=n>=1,s=n===2,c=a===0,l=a===2;return e===0?s&&pb(r)&&c?"Sacerdote":s&&r>=1&&c?"Ditador":i&&c?"Crente ortodoxo":i&&l?"Reformista":t>=1&&c?"Conformista":t===0&&l?"Ctico":"Crente":e===1?i&&r>=1?"Paranoico":i?"Refugiado":r>=1?"Pnico":"Medroso":e===2?i&&l&&pb(r)?"Inovador":i&&r>=1?"Revolucionrio":!i&&pb(r)&&l?"Artista":l&&r>=1?"Transgressor":i?"Ambicioso":"Desejante":e===3?i&&r>=1?"Revolucionrio":i&&l?"Dissidente":r>=1?"Rebelde":l?"Libertrio":"Resistente":"Cidado"}function Gg(e){const t=e&3,n=Math.min(2,e>>>2&3),r=Math.min(2,e>>>4&3),a=Math.min(2,e>>>6&3),i=Math.min(2,e>>>8&3);return _W(t,n,r,a,i)}const ur="'IBM Plex Mono', monospace",NW="'Doto', monospace";function B4(e){let t=e;return()=>(t=(t*9301+49297)%233280,t/233280)}let OW=1;const mb=()=>`u-${OW++}`,DW={SWARM:"#94a3b8",CLUSTERS:"#34d399",POLARIZED:"#fbd38d",CONFLICT:"#ef4444",CONSENSUS:"#a78bfa",EXCEPTION:"#ff6b6b",FERVOR:"#ff4500",ECO_CRISIS:"#8b4513",TRANSCENDENCE:"#00d4aa"},LW={SWARM:"",CLUSTERS:"",POLARIZED:"",CONFLICT:"!",CONSENSUS:"",EXCEPTION:"!",FERVOR:"",ECO_CRISIS:"",TRANSCENDENCE:""},Vg=[{id:"select",icon:"",label:"Select",color:"#94a3b8",desc:"Click agent to inspect"},{id:"spawn_agent",icon:"+",label:"Spawn",color:"#60a5fa",desc:"Place agents 1-by-1 (template or custom archetype)"},{id:"totem_bond",icon:"",label:"Bond Totem",color:"#34d399",desc:"N+L deposit  grows leaders  draws believers"},{id:"totem_rift",icon:"",label:"Rift Totem",color:"#ff6b6b",desc:"Anti-N  factional L  drives polarization"},{id:"totem_oracle",icon:"",label:"Oracle",color:"#c084fc",desc:"High L deposit  amplifies charismatic authority"},{id:"totem_archive",icon:"",label:"Archive",color:"#94a3b8",desc:"Preserves N/L against decay  collective memory"},{id:"totem_panopticon",icon:"",label:"Panopticon",color:"#fbbf24",desc:"Max N visibility  forces conformity but sparks resistance"},{id:"tabu_enter",icon:"X",label:"No-Enter",color:"#ef4444",desc:"Fear pulse on entry  moral panic risk"},{id:"tabu_mix",icon:"",label:"No-Mix",color:"#f97316",desc:"Cross-group repulsion  promotes endogamy"},{id:"ritual_gather",icon:"",label:"Gather",color:"#a78bfa",desc:"Periodic consensus  N+L deposit  costs fatigue"},{id:"ritual_procession",icon:"|",label:"Procession",color:"#fbd38d",desc:"Discipline march  N boost  raises leader power"},{id:"ritual_offering",icon:"",label:"Offering",color:"#fbbf24",desc:"Redistributes R in radius  reduces inequality"},{id:"ritual_revolt",icon:"",label:"Revolt",color:"#ef4444",desc:"Destroys N  driven by high resistance & desire"}],$4=[{id:"off",label:"Off",desc:"Plain canvas"},{id:"groups",label:"Groups",desc:"Group color + psychology rings + roles"},{id:"archetype",label:"Archetype",desc:"Unique color per archetype-combination (not start groups)"},{id:"power",label:"Power",desc:"L/N fields + status auras + fear tint"},{id:"economy",label:"Economy",desc:"R field + wealth halos (top 10)"},{id:"events",label:"Events",desc:"Event pings only"},{id:"field",label:"Fields",desc:"All 3 fields: N=green L=violet R=gold"},{id:"morin",label:"Morin",desc:"Complexity: perception/hybris/fervor/ethics/eco"}];function gb({label:e,icon:t,children:n,align:r="left"}){const[a,i]=S.useState(!1),s=S.useRef(null);return S.useEffect(()=>{const c=l=>{var d;(d=s.current)!=null&&d.contains(l.target)||i(!1)};return document.addEventListener("mousedown",c),()=>document.removeEventListener("mousedown",c)},[]),o.jsxs("div",{ref:s,className:"relative",children:[o.jsxs("button",{onClick:()=>i(c=>!c),style:{fontFamily:ur},className:"flex items-center gap-1.5 px-2.5 py-1 border border-white/[0.08] bg-white/[0.03] text-white/60 hover:text-white/90 hover:border-white/20 transition-all text-[10px] tracking-wide",children:[t," ",e," ",o.jsx(Ms,{size:9,className:`transition-transform ${a?"rotate-180":""}`})]}),a&&o.jsx("div",{className:`absolute top-full mt-1 z-50 min-w-[200px] overflow-hidden ${r==="right"?"right-0":"left-0"}`,style:{background:"rgba(4,6,10,0.98)",border:"1px solid rgba(255,255,255,0.08)"},onClick:()=>i(!1),children:n})]})}function Ug({icon:e,label:t,sub:n,active:r,onClick:a,color:i}){return o.jsxs("button",{onClick:a,className:"w-full flex items-center gap-2.5 px-3 py-1.5 text-left transition-colors",style:{fontFamily:ur,background:r?"rgba(255,255,255,0.05)":""},onMouseEnter:s=>{r||(s.currentTarget.style.background="rgba(255,255,255,0.03)")},onMouseLeave:s=>{r||(s.currentTarget.style.background="")},children:[e&&o.jsx("span",{className:"text-[11px] shrink-0",children:e}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("div",{className:"text-[10px]",style:{color:r?i||"rgba(255,255,255,0.90)":"rgba(255,255,255,0.55)"},children:t}),n&&o.jsx("div",{className:"text-[9px] truncate",style:{color:"rgba(255,255,255,0.25)"},children:n})]}),r&&o.jsx("div",{className:"w-1 h-1 rounded-full shrink-0",style:{background:i||"#a78bfa"}})]})}function zW({label:e}){return o.jsx("div",{className:"px-3 py-1 text-[8px] uppercase tracking-[0.15em] mt-1 pt-2",style:{color:"rgba(255,255,255,0.20)",borderTop:"1px solid rgba(255,255,255,0.05)",fontFamily:ur},children:e})}function po({label:e,v:t,c:n}){return o.jsxs("div",{className:"flex items-center gap-2",style:{fontFamily:ur},children:[o.jsx("span",{className:"text-[9px] w-14 shrink-0",style:{color:"rgba(255,255,255,0.35)"},children:e}),o.jsx("div",{className:"flex-1 h-px rounded-full overflow-hidden",style:{background:"rgba(255,255,255,0.08)"},children:o.jsx("div",{className:"h-full transition-all duration-300",style:{width:`${(t*100).toFixed(0)}%`,background:n}})}),o.jsx("span",{className:"text-[9px] w-7 text-right shrink-0",style:{color:"rgba(255,255,255,0.45)"},children:(t*100).toFixed(0)})]})}function Ud({title:e,badge:t,open:n,onToggle:r,children:a}){return o.jsxs("div",{style:{borderBottom:"1px solid rgba(255,255,255,0.05)"},children:[o.jsxs("button",{onClick:r,className:"w-full flex items-center justify-between gap-2 px-3 py-2 transition-colors min-w-0",style:{fontFamily:ur},onMouseEnter:i=>{i.currentTarget.style.background="rgba(255,255,255,0.02)"},onMouseLeave:i=>{i.currentTarget.style.background=""},children:[o.jsxs("span",{className:"flex items-center gap-2 text-[9px] uppercase tracking-[0.12em] min-w-0 truncate",style:{color:"rgba(255,255,255,0.45)"},children:[e,t!==void 0&&o.jsx("span",{className:"text-[8px] px-1 py-px shrink-0",style:{color:"rgba(255,255,255,0.30)",background:"rgba(255,255,255,0.06)"},children:t})]}),o.jsx(Ms,{size:10,className:`shrink-0 transition-transform ${n?"rotate-180":""}`,style:{color:"rgba(255,255,255,0.20)"}})]}),n&&o.jsx("div",{className:"px-3 pb-3 space-y-2",children:a})]})}const BW=({onLeave:e})=>{var Ho,fs,To,Xo,ks,D,ee,Ie,Qe,X,Z,ce,ue,be;const t=S.useRef(null),n=S.useRef([]),r=S.useRef([]),a=S.useRef(I4()),i=S.useRef(zg()),s=S.useRef(ib()),c=S.useRef(P4()),l=S.useRef(Bg()),d=S.useRef($g()),u=S.useRef([]),h=S.useRef([]),m=S.useRef({elapsed:0,lastMacro:-99,lastRole:-99}),f=S.useRef(0),g=S.useRef(0),[x,v]=S.useState(!1),b=S.useRef(!1),[w,M]=S.useState("archetype"),k=S.useRef("archetype"),[R,j]=S.useState("select"),I=S.useRef("select"),[E,O]=S.useState("discipline_state"),[L,$]=S.useState(()=>(Date.now()>>>0)%1e9),F=S.useRef(L),[B,W]=S.useState("separated_clusters"),re=S.useRef("separated_clusters"),[oe,te]=S.useState("families"),[J,pe]=S.useState("neutral"),[P,V]=S.useState(!1),[fe,ye]=S.useState({belief:.45,fear:.18,desire:.35,resistance:.18,status:.18,wealth:.25,aggression:.3,trust:.55,need:.6,conformity:.45,empathy:.3,charisma:.22,ideology:0}),[Se,we]=S.useState(0),[ke,De]=S.useState(0),[_e,ae]=S.useState($g()),[Re,Fe]=S.useState(Bg()),[Oe,ne]=S.useState([]),[nt,pt]=S.useState([]),[Et,_t]=S.useState({w:window.innerWidth,h:window.innerHeight}),[Ct,Xe]=S.useState(0),[Ut,Le]=S.useState(-1),[Ke,mt]=S.useState(null),[an,gn]=S.useState("normal"),Be=S.useRef(-1),[ft,Qt]=S.useState(!0),[nr,_n]=S.useState(!1),[Rn,sn]=S.useState(!1),[Cn,wt]=S.useState(!0),[st,Zt]=S.useState(!0),[Pe,ct]=S.useState(!0),[vt,xe]=S.useState(!0),ge=S.useRef({...fy}),[,Ee]=S.useState(0),[me,je]=S.useState(!1),[Te,Ae]=S.useState(!1),[Tt,xt]=S.useState(!1),[en,At]=S.useState([]),[Ze,yt]=S.useState([]),[Mt,bn]=S.useState([]),[Pt,An]=S.useState([]),cr=S.useRef(""),Tn=H=>{Object.assign(ge.current,H),Ee(le=>le+1)};S.useEffect(()=>{const H=()=>_t({w:window.innerWidth,h:window.innerHeight});return window.addEventListener("resize",H),()=>window.removeEventListener("resize",H)},[]),S.useEffect(()=>{F.current=L},[L]),S.useEffect(()=>{re.current=B},[B]);const Sr=S.useRef(J),de=S.useRef(P),$e=S.useRef(fe),et=S.useRef(Se),zt=S.useRef(ke);S.useEffect(()=>{Sr.current=J},[J]),S.useEffect(()=>{de.current=P},[P]),S.useEffect(()=>{$e.current=fe},[fe]),S.useEffect(()=>{et.current=Se},[Se]),S.useEffect(()=>{zt.current=ke},[ke]);const Nt=S.useCallback((H,le,Je)=>{const tt=V0.find(jn=>jn.id===H)??V0[0];if(Je){const jn=Math.random()*4294967295>>>0;F.current=jn,$(jn)}const St=I4(),$t=P4();tt.apply(St,$t),le!==void 0&&(St.autoSymbols=le),St.groupProfiles.length!==St.groupCount&&(St.groupProfiles=Wh(St.groupCount));const rt=St.spawnRelationMode??(St.startWithFamilies?"families":"none");St.spawnRelationMode=rt,St.startWithFamilies=rt==="families",te(rt),a.current=St,c.current=$t;const Ft=B4(F.current>>>0);n.current=N4(St,Ft,re.current),r.current=new Array(n.current.length).fill("normal");const Xt=ib(),dn=zg();tt.setupWorld&&tt.setupWorld(Xt,dn),s.current=Xt,i.current=dn,l.current=Bg(),l.current.rngState=F.current>>>0,l.current.nextFamilyId=n.current.length?Math.max(1,...n.current.map(jn=>jn.familyId))+1:1,u.current=[],h.current=[],m.current={elapsed:0,lastMacro:-99,lastRole:-99},ae($g()),Fe({...l.current}),ne([]),O(H),xe(St.autoSymbols),Xe(jn=>jn+1),Le(-1),mt(null),Be.current=-1;const kn=new Map;for(const jn of n.current){const yr=jn.archKeyStable>>>0||v0(jn);kn.set(yr,(kn.get(yr)??0)+1)}const ar=Array.from(kn.entries()).map(([jn,yr])=>({key:jn,count:yr,color:Bi(jn),label:Gg(jn)})).sort((jn,yr)=>yr.count-jn.count).slice(0,10);At(ar)},[]),ln=S.useCallback(()=>{const H=a.current;H.spawnRelationMode=oe,H.startWithFamilies=oe==="families",H.groupProfiles.length!==H.groupCount&&(H.groupProfiles=Wh(H.groupCount));const le=B4(F.current>>>0);n.current=N4(H,le,re.current),r.current=new Array(n.current.length).fill("normal");const Je=ib(),tt=zg(),St=V0.find(Ft=>Ft.id===E)??V0[0];St.setupWorld&&St.setupWorld(Je,tt),s.current=Je,i.current=tt,l.current=Bg(),l.current.rngState=F.current>>>0,l.current.nextFamilyId=n.current.length?Math.max(1,...n.current.map(Ft=>Ft.familyId))+1:1,u.current=[],h.current=[],m.current={elapsed:0,lastMacro:-99,lastRole:-99},ae($g()),Fe({...l.current}),ne([]),Le(-1),mt(null),Be.current=-1,Xe(Ft=>Ft+1);const $t=new Map;for(const Ft of n.current){const Xt=Ft.archKeyStable>>>0||v0(Ft);$t.set(Xt,($t.get(Xt)??0)+1)}const rt=Array.from($t.entries()).map(([Ft,Xt])=>({key:Ft,count:Xt,color:Bi(Ft),label:Gg(Ft)})).sort((Ft,Xt)=>Xt.count-Ft.count).slice(0,10);At(rt)},[E,oe]);S.useEffect(()=>{Nt("discipline_state")},[]);const Rt=S.useRef({zoom:1,panX:0,panY:0}),Nn=S.useRef({active:!1,lastX:0,lastY:0,btn:0}),It=S.useRef(new Set),[xn,Ln]=S.useState(1),[zn,Or]=S.useState(!1);S.useEffect(()=>{const H=t.current;if(!H)return;const le=Je=>{Je.preventDefault();const tt=H.getBoundingClientRect(),St=Je.clientX-tt.left-tt.width/2,$t=Je.clientY-tt.top-tt.height/2,rt=Rt.current,Ft=Je.deltaY>0?1/1.12:1.12,Xt=Math.max(.15,Math.min(10,rt.zoom*Ft)),dn=Xt/rt.zoom;Rt.current={zoom:Xt,panX:St+(rt.panX-St)*dn,panY:$t+(rt.panY-$t)*dn},Ln(Xt),Or(Math.abs(Rt.current.panX)>2||Math.abs(Rt.current.panY)>2)};return H.addEventListener("wheel",le,{passive:!1}),()=>H.removeEventListener("wheel",le)},[]),S.useEffect(()=>{const H=t.current;if(!H)return;const le=$t=>{Nn.current={active:!0,lastX:$t.clientX,lastY:$t.clientY,btn:$t.button},$t.button===1&&$t.preventDefault()},Je=$t=>{if(!Nn.current.active||Nn.current.btn!==1&&Nn.current.btn!==2)return;const rt=$t.clientX-Nn.current.lastX,Ft=$t.clientY-Nn.current.lastY;Nn.current.lastX=$t.clientX,Nn.current.lastY=$t.clientY;const Xt=Rt.current;Rt.current={...Xt,panX:Xt.panX+rt,panY:Xt.panY+Ft},Or(!0)},tt=()=>{Nn.current.active=!1;const{panX:$t,panY:rt}=Rt.current;Or(Math.abs($t)>2||Math.abs(rt)>2)},St=$t=>{$t.preventDefault()};return H.addEventListener("mousedown",le),window.addEventListener("mousemove",Je),window.addEventListener("mouseup",tt),H.addEventListener("contextmenu",St),()=>{H.removeEventListener("mousedown",le),window.removeEventListener("mousemove",Je),window.removeEventListener("mouseup",tt),H.removeEventListener("contextmenu",St)}},[]),S.useEffect(()=>{const H=Je=>{var $t;const tt=($t=document.activeElement)==null?void 0:$t.tagName;if(tt==="INPUT"||tt==="TEXTAREA"||tt==="SELECT")return;const St=Je.key.toLowerCase();["w","a","s","d"].includes(St)&&(It.current.add(St),Je.preventDefault()),St==="r"&&(Rt.current={zoom:1,panX:0,panY:0},Ln(1),Or(!1))},le=Je=>{It.current.delete(Je.key.toLowerCase())};return window.addEventListener("keydown",H),window.addEventListener("keyup",le),()=>{window.removeEventListener("keydown",H),window.removeEventListener("keyup",le)}},[]),S.useEffect(()=>{const H=t.current;if(!H)return;const le=Je=>{f.current=requestAnimationFrame(le);const tt=H.getContext("2d");if(!tt)return;if(It.current.size>0){const dn=5/Rt.current.zoom,kn=Rt.current;let{panX:ar,panY:jn}=kn;It.current.has("a")&&(ar+=dn),It.current.has("d")&&(ar-=dn),It.current.has("w")&&(jn+=dn),It.current.has("s")&&(jn-=dn),Rt.current={...kn,panX:ar,panY:jn}}if(b.current)g.current=Je;else{const dn=Math.min((Je-g.current)/1e3,.05);g.current=Je,m.current.elapsed+=dn;const kn=m.current.elapsed,ar=ZH(n.current,a.current.worldHalf);eW(n.current,ar,a.current,l.current,dn);for(const jn of u.current)jn.age+=dn;if(u.current=u.current.filter(jn=>jn.age<jn.ttl),kn-m.current.lastMacro>=a.current.macroTickSec){const jn=Math.max(a.current.macroTickSec,kn-m.current.lastMacro);a.current.autoSymbols=wr.current;const yr=nW(n.current,a.current,i.current,s.current,c.current,l.current,kn,jn,u.current);yr.length>0&&(h.current=[...yr,...h.current].slice(0,30),ne([...h.current]),i.current.totems.length+i.current.tabus.length+i.current.rituals.length>0&&Xe(go=>go+1));const Bt=hy(n.current,a.current);d.current=Bt,ae({...Bt}),Fe({...l.current}),Xe(no=>no+1),m.current.lastMacro=kn;const qt=Be.current;qt>=0&&qt<n.current.length&&(mt({...n.current[qt]}),gn(r.current[qt]??"normal"));const mn=new Map;for(const no of n.current){const go=no.currentActivity||" deriva";mn.set(go,(mn.get(go)??0)+1)}yt(Array.from(mn.entries()).sort((no,go)=>go[1]-no[1]).slice(0,6).map(([no,go])=>({label:no,count:go})));const dr=new Map;let rr=0,Dr=0,ho=0,Vr=0,ko=0;for(const no of n.current){const qs=[{k:"ameaa",v:no.auditThreat},{k:"recurso",v:no.auditResource},{k:"social",v:no.auditSocial},{k:"transgresso",v:no.auditTransgression},{k:"memria",v:no.auditMemoryPull}].sort((Ka,Jo)=>Jo.v-Ka.v)[0];dr.set(qs.k,(dr.get(qs.k)??0)+1),rr+=no.auditThreat,Dr+=no.auditResource,ho+=no.auditSocial,Vr+=no.auditTransgression,ko+=no.auditMemoryPull}const Ea=Math.max(1,n.current.length);bn(Array.from(dr.entries()).sort((no,go)=>go[1]-no[1]).slice(0,5).map(([no,go])=>({label:no,count:go}))),An([{label:"Ameaa",value:rr/Ea},{label:"Recurso",value:Dr/Ea},{label:"Social",value:ho/Ea},{label:"Transgresso",value:Vr/Ea},{label:"Memria",value:ko/Ea}])}if(kn-m.current.lastRole>=3.5){r.current=dW(n.current,r.current),m.current.lastRole=kn;const jn=n.current.map((qt,mn)=>{const dr=r.current[mn]??"normal",rr=dr==="leader"?.2:dr==="dictator"?.18:dr==="authority"?.14:dr==="priest"?.1:dr==="rebel"?.08:dr==="artist"||dr==="innovator"?.06:dr==="predator"?.04:0,Dr=qt.centrality*.55+qt.status*.35+qt.charisma*.25-qt.fear*.08+rr,ho=qt.archKeyStable>>>0||v0(qt);return{idx:mn,score:Dr,role:dr,color:Bi(ho),label:Gg(ho)}}).sort((qt,mn)=>mn.score-qt.score).slice(0,6);pt(jn);const yr=new Map;for(const qt of n.current){const mn=qt.archKeyStable>>>0||v0(qt);yr.set(mn,(yr.get(mn)??0)+1)}const Bt=Array.from(yr.entries()).map(([qt,mn])=>({key:qt,count:mn,color:Bi(qt),label:Gg(qt)})).sort((qt,mn)=>mn.count-qt.count).slice(0,10);At(Bt)}}const St=H.width,$t=H.height,{zoom:rt,panX:Ft,panY:Xt}=Rt.current;tt.setTransform(1,0,0,1,0,0),tt.fillStyle="#070714",tt.fillRect(0,0,St,$t),tt.save(),tt.translate(St/2+Ft,$t/2+Xt),tt.scale(rt,rt),tt.translate(-St/2,-$t/2),mW(tt,H.width,H.height,n.current,r.current,a.current,d.current,k.current,i.current,s.current,l.current,u.current,m.current.elapsed,{...fy,...ge.current},Be.current),tt.restore()};return g.current=performance.now(),f.current=requestAnimationFrame(le),()=>cancelAnimationFrame(f.current)},[Et]);const wr=S.useRef(!0);S.useEffect(()=>{wr.current=vt,a.current.autoSymbols=vt},[vt]);const vn=S.useCallback(H=>{const le=H.currentTarget,Je=le.getBoundingClientRect(),tt=le.width,St=le.height,$t=(H.clientX-Je.left)/Je.width*tt,rt=(H.clientY-Je.top)/Je.height*St,{zoom:Ft,panX:Xt,panY:dn}=Rt.current,kn=a.current.worldHalf??2,ar=($t-tt/2-Xt)/Ft+tt/2,jn=(rt-St/2-dn)/Ft+St/2,yr=ar/tt*(2*kn)-kn,Bt=jn/St*(2*kn)-kn,qt=I.current,mn=i.current;if(qt==="select"){let Dr=-1,ho=.38*.38;n.current.forEach((Vr,ko)=>{const Ea=(Vr.x-yr)**2+(Vr.y-Bt)**2;Ea<ho&&(ho=Ea,Dr=ko)}),Le(Dr),Be.current=Dr,Dr>=0&&(mt({...n.current[Dr]}),gn(r.current[Dr]??"normal"),Zt(!0));return}const dr=m.current.elapsed;if(qt==="totem_bond"||qt==="totem_rift"||qt==="totem_oracle"||qt==="totem_archive"||qt==="totem_panopticon"){const rr={totem_bond:"BOND",totem_rift:"RIFT",totem_oracle:"ORACLE",totem_archive:"ARCHIVE",totem_panopticon:"PANOPTICON"},Dr={BOND:"#34d399",RIFT:"#ff6b6b",ORACLE:"#c084fc",ARCHIVE:"#94a3b8",PANOPTICON:"#fbbf24"},ho={BOND:"",RIFT:"",ORACLE:"",ARCHIVE:"",PANOPTICON:""},Vr=rr[qt],ko={id:mb(),kind:Vr,x:yr,y:Bt,radius:.26,groupId:0,pulseStrength:.85,bornAt:dr};mn.totems=[...mn.totems,ko],h.current=[{time:dr,icon:ho[Vr],message:`${Vr} Totem placed`,color:Dr[Vr]},...h.current].slice(0,30),ne([...h.current])}else if(qt==="tabu_enter"||qt==="tabu_mix"){const rr={id:mb(),kind:qt==="tabu_enter"?"NO_ENTER":"NO_MIX",x:yr,y:Bt,radius:.2,severity:.6,bornAt:dr,violationCount:0};mn.tabus=[...mn.tabus,rr],h.current=[{time:dr,icon:"X",message:`Taboo ${rr.kind} declared`,color:"#ef4444"},...h.current].slice(0,30),ne([...h.current])}else if(qt==="ritual_gather"||qt==="ritual_procession"||qt==="ritual_offering"||qt==="ritual_revolt"){const rr={ritual_gather:"GATHER",ritual_procession:"PROCESSION",ritual_offering:"OFFERING",ritual_revolt:"REVOLT"},Dr={GATHER:"#a78bfa",PROCESSION:"#fbd38d",OFFERING:"#fbbf24",REVOLT:"#ef4444"},ho={GATHER:"",PROCESSION:"|",OFFERING:"",REVOLT:""},Vr=rr[qt],ko={id:mb(),kind:Vr,x:yr,y:Bt,radius:.3,periodSec:7,lastFired:dr,active:!1,bornAt:dr};mn.rituals=[...mn.rituals,ko],h.current=[{time:dr,icon:ho[Vr],message:`${Vr} Ritual founded`,color:Dr[Vr]},...h.current].slice(0,30),ne([...h.current])}Xe(rr=>rr+1)},[]),[,Gr]=S.useState(0),hn=S.useCallback(H=>{Object.assign(a.current,H),Gr(le=>le+1)},[]),{phase:jr}=_e,_r=DW[jr]??"#fff";S.useEffect(()=>{jr!==cr.current&&(cr.current=jr,xt(!0))},[jr]);const Zn=Math.max(400,Et.w-256),lo=Math.max(300,Et.h-40),ir=i.current,to=ir.totems.length+ir.tabus.length+ir.rituals.length,Er=V0.find(H=>H.id===E)??V0[0],Eo=S.useRef(null),[oa,ja]=S.useState("idle"),[Co,Ya]=S.useState(0);S.useEffect(()=>(Eo.current=new Nf(ja),()=>{var H;return(H=Eo.current)==null?void 0:H.dispose()}),[]),S.useEffect(()=>{if(oa!=="recording"){Ya(0);return}const H=setInterval(()=>{var le;return Ya(((le=Eo.current)==null?void 0:le.elapsed)??0)},500);return()=>clearInterval(H)},[oa]);const qo=S.useCallback(()=>{var H;(H=Eo.current)==null||H.start(()=>[t.current],()=>{var le;return{labName:"Sociogenesis Tool",lines:[`fase: ${((le=d.current)==null?void 0:le.phase)??""}    agentes: ${n.current.length}`,`coeso: ${(d.current.cohesion*100).toFixed(0)}%  polariz.: ${(d.current.polarization*100).toFixed(0)}%  conflito: ${(d.current.conflict*100).toFixed(0)}%`,`lens: ${k.current}    cenrio: ${E}`,`totens: ${i.current.totems.length}  tabus: ${i.current.tabus.length}  rituais: ${i.current.rituals.length}`]}})},[E]),os=S.useCallback(()=>{var H;return(H=Eo.current)==null?void 0:H.stop()},[]);return o.jsxs("div",{className:"fixed inset-0 z-[950] flex flex-col overflow-hidden select-none",style:{background:"#000",fontFamily:ur},children:[Re.exceptionActive&&o.jsxs("div",{className:"h-7 flex items-center justify-center gap-3 shrink-0 animate-pulse",style:{background:"rgba(239,68,68,0.15)",borderBottom:"1px solid rgba(239,68,68,0.30)"},children:[o.jsx("span",{className:"text-xs text-red-400 font-semibold tracking-widest uppercase",children:"STATE OF EXCEPTION"}),o.jsx("span",{className:"text-[10px] text-red-400/50",children:"N field surging  policing active"})]}),o.jsxs("div",{className:"flex items-center gap-2 px-3 h-10 shrink-0",style:{borderBottom:"1px solid rgba(255,255,255,0.06)",background:"rgba(0,0,0,0.95)"},children:[e&&o.jsxs("button",{onClick:e,className:"flex items-center gap-1.5 px-2.5 py-1 border transition-all text-[10px]",style:{borderColor:"rgba(255,255,255,0.08)",color:"rgba(255,255,255,0.45)",fontFamily:ur},onMouseEnter:H=>{H.currentTarget.style.color="rgba(255,255,255,0.80)",H.currentTarget.style.borderColor="rgba(255,255,255,0.20)"},onMouseLeave:H=>{H.currentTarget.style.color="rgba(255,255,255,0.45)",H.currentTarget.style.borderColor="rgba(255,255,255,0.08)"},children:[o.jsx(rI,{size:10})," Exit"]}),o.jsx("span",{className:"text-[10px] hidden md:block",style:{color:"rgba(255,255,255,0.20)",fontFamily:NW,letterSpacing:"0.08em"},children:"SOCIOGENESIS"}),o.jsx("div",{className:"w-px h-4",style:{background:"rgba(255,255,255,0.06)"}}),o.jsx(gb,{label:x?"Paused":"Running",icon:x?o.jsx(md,{size:11}):o.jsx(sc,{size:11}),children:o.jsxs("div",{className:"py-1",children:[o.jsx(Ug,{icon:x?"":"",label:x?"Run":"Pause",onClick:()=>{const H=!x;v(H),b.current=H}}),o.jsx(Ug,{icon:"",label:"Reset Scenario",onClick:()=>Nt(E,vt)}),o.jsxs("div",{className:"px-3 py-2 mt-1",style:{borderTop:"1px solid rgba(255,255,255,0.05)",fontFamily:ur},children:[o.jsx("div",{className:"text-[9px] mb-1.5",style:{color:"rgba(255,255,255,0.30)"},children:"macroTick interval"}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("input",{type:"range",min:.5,max:2.5,step:.1,defaultValue:1,onChange:H=>hn({macroTickSec:parseFloat(H.target.value)}),className:"flex-1 h-px appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-2.5 [&::-webkit-slider-thumb]:h-2.5 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-white/60",style:{background:"rgba(255,255,255,0.10)"}}),o.jsx("span",{className:"text-[9px]",style:{color:"rgba(255,255,255,0.40)"},children:"1.0s"})]})]})]})}),o.jsx(gb,{label:Er?`${Er.icon} ${Er.name}`:"Cenrio",children:o.jsx("div",{className:"py-1 max-h-80 overflow-y-auto",children:["multi-field","genesis","conflict","economy","culture","power"].map(H=>{const le=V0.filter(Je=>Je.category===H);return le.length===0?null:o.jsxs("div",{children:[o.jsx(zW,{label:H==="multi-field"?"Campos Sociais (Guildas, Metrpoles, Sociedades)":L4[H]}),le.map(Je=>o.jsx(Ug,{icon:Je.icon,label:Je.name,sub:Je.description,active:E===Je.id,onClick:()=>{O(Je.id),Nt(Je.id,vt,!0)}},Je.id))]},H)})})}),o.jsx(gb,{label:((Ho=$4.find(H=>H.id===w))==null?void 0:Ho.label)??"Lens",children:o.jsx("div",{className:"py-1",children:$4.map(H=>o.jsx(Ug,{label:H.label,sub:H.desc,active:w===H.id,onClick:()=>{M(H.id),k.current=H.id}},H.id))})}),o.jsxs("button",{title:`Seed atual: ${L}  clique para novo seed aleatrio`,onClick:()=>{const H=Math.random()*4294967295>>>0;F.current=H,$(H),Nt(E,vt)},className:"flex items-center gap-1.5 px-2.5 py-1 border transition-all text-[10px]",style:{borderColor:"rgba(255,255,255,0.08)",color:"rgba(255,255,255,0.45)",fontFamily:ur},onMouseEnter:H=>{H.currentTarget.style.color="rgba(255,255,255,0.9)",H.currentTarget.style.borderColor="rgba(167,139,250,0.45)"},onMouseLeave:H=>{H.currentTarget.style.color="rgba(255,255,255,0.45)",H.currentTarget.style.borderColor="rgba(255,255,255,0.08)"},children:[" ",o.jsx("span",{style:{color:"rgba(167,139,250,0.65)",fontSize:8},children:L%1e6})]}),o.jsx("div",{className:"flex-1"}),o.jsxs("div",{className:"flex flex-col gap-0.5",children:[o.jsxs("div",{className:"flex items-center gap-2 px-2.5 py-0.5 border",style:{borderColor:_r+"35",background:_r+"0e",fontFamily:ur},children:[o.jsx("span",{className:"text-[10px]",children:LW[jr]}),o.jsx("span",{className:"text-[9px] uppercase tracking-[0.12em]",style:{color:_r},title:jr,children:z4(jr)})]}),Er&&o.jsxs("div",{className:"text-[8px] uppercase tracking-wider px-2 py-0.5",style:{fontFamily:ur,color:"rgba(255,255,255,0.35)"},title:Er.description,children:[Er.icon," ",Er.name,Er.category==="multi-field"?"  Campos Sociais":`  ${L4[Er.category]??""}`]})]}),o.jsx(km,{state:oa,elapsed:Co,onStart:qo,onStop:os})]}),o.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[o.jsxs("div",{className:"flex-1 relative",children:[o.jsx("canvas",{ref:t,width:Zn,height:lo,style:{display:"block",width:"100%",height:"100%",cursor:R==="select"?"pointer":"crosshair"},onClick:vn}),o.jsxs("div",{className:"absolute bottom-5 left-5 pointer-events-auto",children:[o.jsxs("button",{type:"button",onClick:()=>{xt(H=>!H),cr.current=jr},className:"text-left block w-full mb-2 rounded-lg border transition-all px-3 py-2",style:{borderColor:_r+"40",background:_r+"0c",color:_r},children:[o.jsx("div",{className:"text-2xl font-light tracking-widest uppercase",style:{letterSpacing:"0.2em",textShadow:`0 0 20px ${_r}44`},children:z4(jr)}),o.jsx("div",{className:"text-[9px] uppercase tracking-wider mt-0.5",style:{color:"rgba(255,255,255,0.35)"},children:"Clique para ver o codex"})]}),Ze.length>0&&o.jsxs("div",{className:"mb-1.5 px-1.5 py-0.5 rounded max-w-[240px]",style:{background:"rgba(0,0,0,0.35)",border:"1px solid rgba(255,255,255,0.06)",fontFamily:ur,fontSize:8,color:"rgba(255,255,255,0.5)",lineHeight:1.3},children:[o.jsx("span",{className:"uppercase tracking-wider mr-1",style:{color:"rgba(255,255,255,0.3)"},children:"Agora"}),Ze.slice(0,4).map(({label:H,count:le},Je)=>o.jsxs("span",{children:[Je>0&&"  ",o.jsx("span",{style:{color:"rgba(255,255,255,0.65)"},children:H}),o.jsx("span",{style:{color:"rgba(255,255,255,0.35)",marginLeft:1},children:le})]},H))]}),o.jsxs("div",{className:"space-y-2.5 w-60",children:[o.jsx(Yg,{label:(fs=Vd.cohesion)==null?void 0:fs.short,v:_e.cohesion,c:"#34d399",title:(To=Vd.cohesion)==null?void 0:To.long}),o.jsx(Yg,{label:(Xo=Vd.polarization)==null?void 0:Xo.short,v:_e.polarization,c:"#fbd38d",title:(ks=Vd.polarization)==null?void 0:ks.long}),o.jsx(Yg,{label:(D=Vd.conflict)==null?void 0:D.short,v:_e.conflict,c:"#ef4444",title:(ee=Vd.conflict)==null?void 0:ee.long}),o.jsx(Yg,{label:(Ie=Vd.consensus)==null?void 0:Ie.short,v:_e.consensus,c:"#a78bfa",title:(Qe=Vd.consensus)==null?void 0:Qe.long})]}),Tt&&o.jsx($W,{phase:jr,phaseColor:_r,onClose:()=>xt(!1)})]}),o.jsxs("div",{className:"absolute bottom-5 right-5 flex flex-col items-end gap-3 pointer-events-none max-w-[200px]",children:[o.jsxs("div",{className:"flex flex-col items-end gap-0.5",children:[o.jsx("div",{className:"text-[8px] uppercase tracking-widest mb-1",style:{color:"rgba(255,255,255,0.25)",fontFamily:ur},title:"cones que aparecem em cima de alguns agentes",children:"Smbolos sobre agentes"}),[{role:"leader",sym:"",color:"#fbbf24"},{role:"authority",sym:"",color:"#60a5fa"},{role:"dictator",sym:"",color:"#ef4444"},{role:"aggressor",sym:"",color:"#ef4444"},{role:"guardian",sym:"",color:"#fbd38d"},{role:"mediator",sym:"",color:"#fff"},{role:"rebel",sym:"",color:"#f87171"},{role:"priest",sym:"",color:"#c084fc"}].map(({role:H,sym:le,color:Je})=>o.jsxs("div",{className:"flex items-center gap-2",style:{fontFamily:ur},children:[o.jsx("span",{className:"text-[9px] text-right",style:{color:"rgba(255,255,255,0.5)"},children:Ki(H)}),o.jsx("span",{className:"text-[10px] shrink-0",style:{color:Je},title:Ki(H,!0),children:le})]},H))]}),o.jsxs("div",{className:"flex flex-col items-end gap-1",children:[o.jsx("div",{className:"text-[8px] uppercase tracking-widest mb-1",style:{color:"rgba(255,255,255,0.25)",fontFamily:ur},children:"Grupos"}),Array.from({length:a.current.groupCount}).map((H,le)=>{const tt=(a.current.groupProfiles??Wh(a.current.groupCount))[le];return o.jsxs("div",{className:"flex items-center gap-2",style:{fontFamily:ur},children:[o.jsx("span",{className:"text-[9px]",style:{color:"rgba(255,255,255,0.45)"},children:tt?tt.name:`G${le}`}),o.jsx("span",{className:"text-[7px] uppercase",style:{color:"rgba(255,255,255,0.2)"},children:(tt==null?void 0:tt.sphere)??""}),o.jsx("div",{className:"w-2.5 h-2.5 rounded-full flex-shrink-0",style:{background:rc[le]}})]},le)})]}),en.length>0&&o.jsxs("div",{className:"flex flex-col items-end gap-0.5",children:[o.jsx("div",{className:"text-[8px] uppercase tracking-widest mb-1",style:{color:"rgba(255,255,255,0.25)",fontFamily:ur},children:"Arqutipos presentes"}),en.slice(0,8).map((H,le)=>o.jsxs("div",{className:"flex items-center gap-2",style:{fontFamily:ur},children:[o.jsx("span",{className:"text-[9px] text-right truncate max-w-[120px]",style:{color:"rgba(255,255,255,0.5)"},title:H.label,children:H.label}),o.jsx("span",{className:"text-[8px] shrink-0",style:{color:"rgba(255,255,255,0.3)"},children:H.count}),o.jsx("div",{className:"w-2 h-2 rounded-full flex-shrink-0",style:{background:H.color}})]},le))]})]}),R!=="select"&&o.jsx("div",{className:"absolute top-3 left-1/2 -translate-x-1/2 pointer-events-none",children:o.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 border text-[10px]",style:{borderColor:"rgba(56,189,248,0.25)",background:"rgba(56,189,248,0.08)",color:"rgba(186,230,253,0.85)",fontFamily:ur},children:[o.jsx("span",{children:(X=Vg.find(H=>H.id===R))==null?void 0:X.icon}),o.jsx("span",{children:((Z=Wg[R])==null?void 0:Z.short)??((ce=Vg.find(H=>H.id===R))==null?void 0:ce.label)}),o.jsx("span",{style:{color:"rgba(56,189,248,0.45)"},children:" click to place  Esc to cancel"})]})}),(w==="field"||w==="power"||w==="economy")&&o.jsxs("div",{className:"absolute top-3 left-3 pointer-events-none space-y-1",children:[w!=="economy"&&o.jsx(xb,{c:"#34d399",label:"N Norma"}),w!=="economy"&&o.jsx(xb,{c:"#a78bfa",label:"L Legitimidade"}),w!=="power"&&o.jsx(xb,{c:"#fbbf24",label:"R Recurso"})]}),(xn<.99||xn>1.01||zn)&&o.jsxs("div",{className:"absolute bottom-5 right-5 flex flex-col items-end gap-1 pointer-events-auto select-none",style:{bottom:"5rem"},children:[o.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-md bg-black/60 border border-white/10",children:[o.jsx("span",{className:"text-[8px] font-mono text-white/30 uppercase tracking-widest",children:"zoom"}),o.jsxs("span",{className:"text-[9px] font-mono text-emerald-300/70",children:[xn.toFixed(2),""]})]}),o.jsx("button",{onClick:()=>{Rt.current={zoom:1,panX:0,panY:0},Ln(1),Or(!1)},className:"px-2 py-0.5 rounded text-[8px] font-mono bg-black/50 border border-white/10 text-white/35 hover:text-white/70 transition-colors",children:"[R] reset"})]})]}),o.jsxs("div",{className:"w-64 shrink-0 flex flex-col min-w-0 overflow-y-auto overflow-x-hidden",style:{borderLeft:"1px solid rgba(255,255,255,0.06)",background:"rgba(0,0,0,0.92)"},children:[o.jsxs(Ud,{title:"Tools",open:ft,onToggle:()=>Qt(H=>!H),children:[o.jsx("div",{className:"grid grid-cols-2 gap-1",children:Vg.map(H=>{var le,Je;return o.jsxs("button",{onClick:()=>{j(H.id),I.current=H.id},title:((le=Wg[H.id])==null?void 0:le.long)??H.desc,className:"flex items-center gap-1.5 px-2 py-1.5 border text-[10px] transition-all",style:R===H.id?{borderColor:H.color+"55",background:H.color+"12",color:H.color,fontFamily:ur}:{borderColor:"rgba(255,255,255,0.07)",background:"transparent",color:"rgba(255,255,255,0.40)",fontFamily:ur},children:[o.jsx("span",{className:"text-[11px]",children:H.icon}),o.jsx("span",{className:"truncate",children:((Je=Wg[H.id])==null?void 0:Je.short)??H.label})]},H.id)})}),o.jsx("div",{className:"text-[9px] leading-relaxed mt-1 px-0.5",style:{color:"rgba(255,255,255,0.25)",fontFamily:ur},children:((ue=Wg[R])==null?void 0:ue.long)??((be=Vg.find(H=>H.id===R))==null?void 0:be.desc)??""}),o.jsxs("div",{className:"flex items-center justify-between pt-2 mt-1",style:{borderTop:"1px solid rgba(255,255,255,0.05)"},children:[o.jsxs("div",{children:[o.jsx("div",{className:"text-[10px]",style:{color:"rgba(255,255,255,0.60)",fontFamily:ur},children:"Auto-Emergence"}),o.jsx("div",{className:"text-[9px]",style:{color:"rgba(255,255,255,0.22)",fontFamily:ur},children:"Engine places symbols autonomously"})]}),o.jsx("button",{onClick:()=>xe(H=>!H),className:"w-8 h-4 rounded-full transition-all relative shrink-0",style:{background:vt?"#a78bfa":"#3f3f46"},children:o.jsx("div",{className:"absolute top-0.5 w-3 h-3 rounded-full bg-white transition-all",style:{left:vt?"17px":"2px"}})})]})]}),o.jsxs(Ud,{title:"Agents",badge:n.current.length,open:nr,onToggle:()=>_n(H=>!H),children:[o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex items-center gap-2",style:{fontFamily:ur},children:[o.jsx("span",{className:"text-[9px] w-12 shrink-0",style:{color:"rgba(255,255,255,0.35)"},children:"Seed"}),o.jsx("input",{type:"number",value:L,onChange:H=>$(Math.max(0,Math.min(2147483647,parseInt(H.target.value||"0",10)||0))),className:"flex-1 px-2 py-1 text-[10px] rounded border border-white/[0.08] bg-white/[0.03] text-white/70"}),o.jsx("button",{onClick:()=>$((Date.now()>>>0)%1e9),className:"px-2 py-1 rounded text-[9px] border border-white/[0.08] text-white/50 hover:text-white/80 hover:border-white/20 transition-all",style:{fontFamily:ur,background:"rgba(255,255,255,0.02)"},children:"Rand"}),o.jsx("button",{onClick:()=>{var H;try{(H=navigator.clipboard)==null||H.writeText(String(F.current))}catch{}},className:"px-2 py-1 rounded text-[9px] border border-white/[0.08] text-white/50 hover:text-white/80 hover:border-white/20 transition-all",style:{fontFamily:ur,background:"rgba(255,255,255,0.02)"},children:"Copy"})]}),o.jsxs("div",{className:"flex items-center gap-2",style:{fontFamily:ur},children:[o.jsx("span",{className:"text-[9px] w-12 shrink-0",style:{color:"rgba(255,255,255,0.35)"},children:"Start"}),o.jsxs("select",{value:B,onChange:H=>W(H.target.value),className:"flex-1 px-2 py-1 text-[10px] rounded border border-white/[0.08]",children:[o.jsx("option",{value:"unified_center",children:"Unified"}),o.jsx("option",{value:"separated_clusters",children:"Clusters"}),o.jsx("option",{value:"corners",children:"Corners"}),o.jsx("option",{value:"ring",children:"Ring"}),o.jsx("option",{value:"line",children:"Line"}),o.jsx("option",{value:"random",children:"Random"})]}),o.jsx("button",{onClick:()=>ln(),title:"Respawn com os parmetros atuais (ex.: Count 600)  novos agentes, mundo igual",className:"px-2 py-1 rounded text-[9px] border border-white/[0.08] text-white/50 hover:text-white/80 hover:border-white/20 transition-all",style:{fontFamily:ur,background:"rgba(255,255,255,0.02)"},children:"Respawn"})]}),o.jsxs("div",{className:"flex items-center gap-2",style:{fontFamily:ur},children:[o.jsx("span",{className:"text-[9px] w-12 shrink-0",style:{color:"rgba(255,255,255,0.35)"},children:"Laos"}),o.jsxs("select",{value:oe,onChange:H=>{const le=H.target.value;te(le)},title:"Somente estado inicial: aplica no prximo Respawn/Reset",className:"flex-1 px-2 py-1 text-[10px] rounded border border-white/[0.08]",children:[o.jsx("option",{value:"none",children:"Sem conexes"}),o.jsx("option",{value:"sparse",children:"Poucas (1-2)"}),o.jsx("option",{value:"families",children:"Com famlias"})]})]}),o.jsx("div",{className:"text-[8px] pl-14 -mt-1",style:{color:"rgba(255,255,255,0.3)",fontFamily:ur},children:"aplica no nascimento (Respawn/Reset)"})]}),o.jsx(Hr,{label:"Count",v:a.current.agentCount,min:20,max:600,step:10,onChange:H=>hn({agentCount:H})}),o.jsx(Hr,{label:"Groups",v:a.current.groupCount,min:2,max:5,step:1,onChange:H=>{hn({groupCount:H}),a.current.groupProfiles=Wh(H)}}),o.jsx(Hr,{label:"Speed",v:a.current.speed,min:.1,max:1,step:.05,onChange:H=>hn({speed:H})}),o.jsx(Hr,{label:"Autonomy",v:a.current.autonomy,min:0,max:1,step:.05,onChange:H=>hn({autonomy:H})}),o.jsx(Hr,{label:"Cohesion",v:a.current.cohesion,min:0,max:1,step:.05,onChange:H=>hn({cohesion:H})}),o.jsx(Hr,{label:"Aggress.",v:a.current.aggressionBase,min:0,max:1,step:.05,onChange:H=>hn({aggressionBase:H})})]}),o.jsxs(Ud,{title:"Visual",open:me,onToggle:()=>je(H=>!H),children:[o.jsx(Hr,{label:"Agent Size",v:ge.current.agentScale,min:.3,max:2.5,step:.1,onChange:H=>Tn({agentScale:H})}),o.jsx(Hr,{label:"Trail Opacity",v:ge.current.trailOpacity,min:0,max:1,step:.05,onChange:H=>Tn({trailOpacity:H})}),o.jsxs("div",{className:"flex items-center justify-between py-1",children:[o.jsx("span",{className:"text-[9px] uppercase tracking-wider",style:{fontFamily:ur,color:"rgba(255,255,255,0.35)"},children:"Trails"}),o.jsx("button",{onClick:()=>Tn({showTrails:!ge.current.showTrails}),className:"text-[9px] px-2 py-0.5",style:{fontFamily:ur,letterSpacing:"0.08em",color:ge.current.showTrails?"#00d4aa":"rgba(255,255,255,0.25)",border:`1px dashed ${ge.current.showTrails?"#00d4aa33":"rgba(255,255,255,0.08)"}`,background:ge.current.showTrails?"#00d4aa08":"transparent"},children:ge.current.showTrails?"ON":"OFF"})]}),o.jsxs("div",{className:"flex items-center justify-between py-1",children:[o.jsx("span",{className:"text-[9px] uppercase tracking-wider",style:{fontFamily:ur,color:"rgba(255,255,255,0.35)"},children:"Direction"}),o.jsx("button",{onClick:()=>Tn({showDirection:!ge.current.showDirection}),className:"text-[9px] px-2 py-0.5",style:{fontFamily:ur,letterSpacing:"0.08em",color:ge.current.showDirection?"#00d4aa":"rgba(255,255,255,0.25)",border:`1px dashed ${ge.current.showDirection?"#00d4aa33":"rgba(255,255,255,0.08)"}`,background:ge.current.showDirection?"#00d4aa08":"transparent"},children:ge.current.showDirection?"ON":"OFF"})]}),o.jsxs("div",{className:"flex items-center justify-between py-1",children:[o.jsx("span",{className:"text-[9px] uppercase tracking-wider",style:{fontFamily:ur,color:"rgba(255,255,255,0.35)"},title:"Linhas entre agentes da mesma famlia (rizoma)",children:"Conexes famlia"}),o.jsx("button",{onClick:()=>Tn({showFamilyConnections:!(ge.current.showFamilyConnections??!0)}),className:"text-[9px] px-2 py-0.5",style:{fontFamily:ur,letterSpacing:"0.08em",color:ge.current.showFamilyConnections??!0?"#00d4aa":"rgba(255,255,255,0.25)",border:`1px dashed ${ge.current.showFamilyConnections??!0?"#00d4aa33":"rgba(255,255,255,0.08)"}`,background:ge.current.showFamilyConnections??!0?"#00d4aa08":"transparent"},children:ge.current.showFamilyConnections??!0?"ON":"OFF"})]})]}),o.jsx(Ud,{title:"Campos Sociais",open:Te,onToggle:()=>Ae(H=>!H),children:(()=>{const H=a.current.groupProfiles??Wh(a.current.groupCount);return a.current.groupProfiles||(a.current.groupProfiles=H),H.map((le,Je)=>o.jsxs("div",{className:"mb-2 pb-2",style:{borderBottom:"1px solid rgba(255,255,255,0.06)"},children:[o.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[o.jsx("div",{className:"w-2 h-2 rounded-full flex-shrink-0",style:{background:rc[Je]}}),o.jsx("input",{className:"bg-transparent text-[9px] font-medium tracking-wide w-full outline-none",style:{fontFamily:ur,color:"rgba(255,255,255,0.65)"},value:le.name,onChange:tt=>{a.current.groupProfiles[Je]={...le,name:tt.target.value},Ae(St=>St)}}),o.jsx("span",{className:"text-[7px] uppercase tracking-widest flex-shrink-0",style:{color:"rgba(255,255,255,0.20)",fontFamily:ur},children:le.sphere})]}),o.jsx(Hr,{label:"N sens.",v:le.fieldSensitivity.n,min:0,max:2,step:.1,onChange:tt=>{a.current.groupProfiles[Je]={...le,fieldSensitivity:{...le.fieldSensitivity,n:tt}}}}),o.jsx(Hr,{label:"L sens.",v:le.fieldSensitivity.l,min:0,max:2,step:.1,onChange:tt=>{a.current.groupProfiles[Je]={...le,fieldSensitivity:{...le.fieldSensitivity,l:tt}}}}),o.jsx(Hr,{label:"R sens.",v:le.fieldSensitivity.r,min:0,max:2,step:.1,onChange:tt=>{a.current.groupProfiles[Je]={...le,fieldSensitivity:{...le.fieldSensitivity,r:tt}}}}),o.jsx(Hr,{label:"Ideology",v:le.ideologyBias,min:-1,max:1,step:.1,onChange:tt=>{a.current.groupProfiles[Je]={...le,ideologyBias:tt}}}),o.jsx(Hr,{label:"Cohesion",v:le.cohesionBias,min:0,max:1,step:.05,onChange:tt=>{a.current.groupProfiles[Je]={...le,cohesionBias:tt}}}),o.jsx(Hr,{label:"Desire",v:le.desireBias,min:0,max:1,step:.05,onChange:tt=>{a.current.groupProfiles[Je]={...le,desireBias:tt}}})]},Je))})()}),o.jsxs(Ud,{title:"Dynamics",open:Rn,onToggle:()=>sn(H=>!H),children:[o.jsx(Hr,{label:"Conform.",v:a.current.conformity,min:0,max:1,step:.05,onChange:H=>hn({conformity:H})}),o.jsx(Hr,{label:"Empathy",v:a.current.empathy,min:0,max:1,step:.05,onChange:H=>hn({empathy:H})}),o.jsx(Hr,{label:"Mobility",v:a.current.mobility,min:0,max:1,step:.05,onChange:H=>hn({mobility:H})}),o.jsx(Hr,{label:"Contagion",v:a.current.contagion,min:0,max:1,step:.05,onChange:H=>hn({contagion:H})}),o.jsx(Hr,{label:"Hierarchy",v:a.current.hierarchyStrength,min:0,max:1,step:.05,onChange:H=>hn({hierarchyStrength:H})}),o.jsx(Hr,{label:"Innovate",v:a.current.innovationRate,min:0,max:.3,step:.01,onChange:H=>hn({innovationRate:H})}),o.jsx(Hr,{label:"Cooperat.",v:a.current.cooperationBias,min:0,max:1,step:.05,onChange:H=>hn({cooperationBias:H})}),o.jsx(Hr,{label:"Inertia",v:a.current.culturalInertia,min:0,max:1,step:.05,onChange:H=>hn({culturalInertia:H})}),o.jsx(Hr,{label:"ArchHold",v:a.current.archetypeHoldSec,min:.4,max:5,step:.1,onChange:H=>hn({archetypeHoldSec:H})}),o.jsx(Hr,{label:"Scarcity",v:a.current.resourceScarcity,min:0,max:1,step:.05,onChange:H=>hn({resourceScarcity:H})}),o.jsx(Hr,{label:"Panoptic.",v:a.current.panopticism,min:0,max:1,step:.05,onChange:H=>hn({panopticism:H})}),o.jsx("div",{className:"pt-2",style:{borderTop:"1px solid rgba(255,255,255,0.05)"},children:o.jsx("div",{className:"text-[8px] uppercase tracking-[0.14em] mb-2",style:{color:"#00d4aa55",fontFamily:ur},children:"Morin  Complexidade"})}),o.jsx(Hr,{label:"Perc.Bias",v:a.current.perceptionBias,min:0,max:1,step:.05,onChange:H=>hn({perceptionBias:H})}),o.jsx(Hr,{label:"Hybris.Th",v:a.current.hybrisThreshold,min:.3,max:.95,step:.05,onChange:H=>hn({hybrisThreshold:H})}),o.jsx(Hr,{label:"Fervor.Th",v:a.current.fervorThreshold,min:.6,max:1.8,step:.05,onChange:H=>hn({fervorThreshold:H})}),o.jsx(Hr,{label:"Ethics",v:a.current.ethicsGrowth,min:0,max:.5,step:.02,onChange:H=>hn({ethicsGrowth:H})}),o.jsx(Hr,{label:"Underst.",v:a.current.understandingGrowth,min:0,max:.5,step:.02,onChange:H=>hn({understandingGrowth:H})}),o.jsx(Hr,{label:"Eco.Degr",v:a.current.ecoDegradation,min:0,max:.3,step:.01,onChange:H=>hn({ecoDegradation:H})}),o.jsx(Hr,{label:"Cons.Dec",v:a.current.consensusDecay,min:0,max:.2,step:.01,onChange:H=>hn({consensusDecay:H})}),o.jsx(Hr,{label:"Boids.Al",v:a.current.boidsAlignment,min:0,max:1,step:.05,onChange:H=>hn({boidsAlignment:H})}),o.jsx(Hr,{label:"Boids.Co",v:a.current.boidsCohesion,min:0,max:1,step:.05,onChange:H=>hn({boidsCohesion:H})}),o.jsx(Hr,{label:"BirthMem",v:a.current.birthMemoryStrength,min:0,max:1,step:.05,onChange:H=>hn({birthMemoryStrength:H})}),o.jsx(Hr,{label:"BondRate",v:a.current.bondFormationRate,min:0,max:.2,step:.01,onChange:H=>hn({bondFormationRate:H})}),o.jsx("div",{className:"pt-2",style:{borderTop:"1px solid rgba(255,255,255,0.05)"}}),o.jsx(Hr,{label:"Wander",v:a.current.wander,min:0,max:1,step:.05,onChange:H=>hn({wander:H})}),o.jsx(Hr,{label:"ImpulseRt",v:a.current.impulseRate,min:0,max:2,step:.05,onChange:H=>hn({impulseRate:H})}),o.jsx(Hr,{label:"ImpulseSt",v:a.current.impulseStrength,min:0,max:1,step:.05,onChange:H=>hn({impulseStrength:H})}),o.jsx(Hr,{label:"Overshoot",v:a.current.goalOvershoot,min:0,max:.8,step:.05,onChange:H=>hn({goalOvershoot:H})}),o.jsx(Hr,{label:"Zigzag",v:a.current.zigzag,min:0,max:1,step:.05,onChange:H=>hn({zigzag:H})})]}),Ut>=0&&Ke&&o.jsxs(Ud,{title:`Agent #${Ut}`,badge:Ki(an),open:st,onToggle:()=>Zt(H=>!H),children:[Ke.currentActivity&&o.jsxs("div",{className:"mb-2 px-1.5 py-1 rounded",style:{background:"rgba(0,212,170,0.08)",border:"1px solid rgba(0,212,170,0.2)"},children:[o.jsx("span",{className:"text-[8px] uppercase tracking-wider",style:{color:"rgba(255,255,255,0.4)",fontFamily:ur},children:"Fazendo"}),o.jsx("div",{className:"text-[11px] mt-0.5",style:{color:"#00d4aa",fontFamily:ur},children:Ke.currentActivity})]}),o.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.jsx("div",{className:"w-3.5 h-3.5 rounded-full shrink-0",style:{background:rc[Ke.groupId%rc.length]}}),o.jsxs("span",{className:"text-[10px]",style:{color:"rgba(255,255,255,0.65)",fontFamily:ur},children:["Group ",Ke.groupId]}),o.jsx("span",{className:"text-[9px] ml-auto",style:{color:"rgba(255,255,255,0.30)",fontFamily:ur},children:Ki(an,!0)}),o.jsx("button",{onClick:()=>{Le(-1),mt(null),Be.current=-1},className:"ml-1 transition-colors",style:{color:"rgba(255,255,255,0.20)"},onMouseEnter:H=>{H.currentTarget.style.color="rgba(255,255,255,0.55)"},onMouseLeave:H=>{H.currentTarget.style.color="rgba(255,255,255,0.20)"},children:o.jsx(Cs,{size:9})})]}),o.jsxs("div",{className:"space-y-1.5",children:[o.jsx(po,{label:"Belief",v:Ke.belief,c:"#34d399"}),o.jsx(po,{label:"Fear",v:Ke.fear,c:"#ef4444"}),o.jsx(po,{label:"Desire",v:Ke.desire,c:"#fbd38d"}),o.jsx(po,{label:"Status",v:Ke.status,c:"#a78bfa"}),o.jsx(po,{label:"Wealth",v:Ke.wealth,c:"#fbbf24"}),o.jsx(po,{label:"Fatigue",v:Ke.fatigue,c:"#94a3b8"}),o.jsx(po,{label:"Conform.",v:Ke.conformity,c:"#60d0ff"}),o.jsx(po,{label:"Empathy",v:Ke.empathy,c:"#ff6b9d"}),o.jsx(po,{label:"Charisma",v:Ke.charisma,c:"#ffd060"}),o.jsx(po,{label:"Loyalty",v:Ke.groupLoyalty,c:"#6bcb77"}),o.jsx(po,{label:"Entangle.",v:Ke.entanglement,c:"#67e8f9"}),o.jsx(po,{label:"BirthMem",v:Ke.birthMemory,c:"#93c5fd"})]}),o.jsxs("div",{className:"mt-1 text-[9px]",style:{color:"rgba(255,255,255,0.35)",fontFamily:ur},children:["Origem: (",Ke.birthX.toFixed(2),", ",Ke.birthY.toFixed(2),")"]}),o.jsxs("div",{className:"mt-2 pt-2",style:{borderTop:"1px solid rgba(255,255,255,0.05)",fontFamily:ur},children:[o.jsx("div",{className:"text-[8px] uppercase tracking-[0.10em] mb-1",style:{color:"rgba(255,255,255,0.32)"},children:"Auditoria de deciso"}),o.jsx(po,{label:"Ameaa",v:Ke.auditThreat,c:"#ef4444"}),o.jsx(po,{label:"Recurso",v:Ke.auditResource,c:"#fbbf24"}),o.jsx(po,{label:"Social",v:Ke.auditSocial,c:"#34d399"}),o.jsx(po,{label:"Transgresso",v:Ke.auditTransgression,c:"#f472b6"}),o.jsx(po,{label:"Memria",v:Ke.auditMemoryPull,c:"#93c5fd"}),o.jsxs("div",{className:"text-[9px] mt-1",style:{color:"rgba(255,255,255,0.5)"},children:["Motivo dominante: ",Ke.auditReason||"n/d"]})]}),o.jsxs("div",{className:"space-y-1.5 mt-2 pt-2",style:{borderTop:"1px solid rgba(255,255,255,0.05)"},children:[o.jsx("div",{className:"text-[8px] uppercase tracking-[0.10em] mb-1",style:{color:"#00d4aa55",fontFamily:ur},children:"Morin"}),o.jsx(po,{label:"Percepo",v:Ke.perception,c:"#60d0ff"}),o.jsx(po,{label:"tica",v:Ke.ethics,c:"#00d4aa"}),o.jsx(po,{label:"Compreenso",v:Ke.understanding,c:"#34d399"}),o.jsx(po,{label:"Hybris",v:Ke.hybris,c:"#ffa000"}),o.jsx(po,{label:"Fervor",v:Ke.fervor,c:"#ff4500"}),o.jsx(po,{label:"Eco.Peg.",v:Ke.ecoFootprint,c:"#8b4513"})]}),o.jsxs("div",{className:"mt-2 pt-2",style:{borderTop:"1px solid rgba(255,255,255,0.05)",fontFamily:ur},children:[o.jsx("div",{className:"text-[9px] mb-1",style:{color:"rgba(255,255,255,0.30)"},children:"Ideology (order  freedom)"}),o.jsxs("div",{className:"relative h-1",style:{background:"rgba(255,255,255,0.08)"},children:[o.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 w-2 h-2 rounded-full bg-white/70 transition-all",style:{left:`calc(${((Ke.ideology+1)/2*100).toFixed(0)}% - 4px)`}}),o.jsx("div",{className:"absolute inset-y-0 left-0 w-1/2",style:{background:"rgba(37,99,235,0.25)"}}),o.jsx("div",{className:"absolute inset-y-0 right-0 w-1/2",style:{background:"rgba(220,38,38,0.25)"}})]}),o.jsxs("div",{className:"flex justify-between text-[8px] mt-0.5",style:{color:"rgba(255,255,255,0.22)"},children:[o.jsx("span",{children:"Order"}),o.jsx("span",{children:Ke.ideology.toFixed(2)}),o.jsx("span",{children:"Freedom"})]})]})]}),o.jsxs(Ud,{title:"Symbols",badge:to,open:Cn,onToggle:()=>wt(H=>!H),children:[to===0&&o.jsxs("div",{className:"text-[9px] text-center py-2",style:{color:"rgba(255,255,255,0.20)",fontFamily:ur},children:["No symbols placed.",o.jsx("br",{}),"Select a tool and click the canvas."]}),ir.totems.map(H=>{const le={BOND:"",RIFT:"",ORACLE:"",ARCHIVE:"",PANOPTICON:""},Je={BOND:"#34d399",RIFT:"#ff6b6b",ORACLE:"#c084fc",ARCHIVE:"#94a3b8",PANOPTICON:"#fbbf24"};return o.jsx(yb,{icon:le[H.kind]||"",label:`${H.kind} Totem`,sub:H.emergent||H.id.startsWith("auto-")?"auto-emerged":"manual",color:Je[H.kind]||"#34d399",onRemove:()=>{ir.totems=ir.totems.filter(tt=>tt.id!==H.id),Xe(tt=>tt+1)}},H.id)}),ir.tabus.map(H=>o.jsx(yb,{icon:H.kind==="NO_ENTER"?"X":"",label:`Tabu ${H.kind}`,sub:H.id.startsWith("auto-")?"auto-emerged":"manual",color:"#ef4444",onRemove:()=>{ir.tabus=ir.tabus.filter(le=>le.id!==H.id),Xe(le=>le+1)}},H.id)),ir.rituals.map(H=>{const le={GATHER:"",PROCESSION:"|",OFFERING:"",REVOLT:""},Je={GATHER:"#a78bfa",PROCESSION:"#fbd38d",OFFERING:"#fbbf24",REVOLT:"#ef4444"};return o.jsx(yb,{icon:le[H.kind]||"",label:`${H.kind} Ritual`,sub:H.emergent||H.id.startsWith("auto-")?"auto-emerged":"manual",color:Je[H.kind]||"#a78bfa",onRemove:()=>{ir.rituals=ir.rituals.filter(tt=>tt.id!==H.id),Xe(tt=>tt+1)}},H.id)}),to>0&&o.jsx("button",{onClick:()=>{i.current=zg(),YH(s.current),Xe(H=>H+1)},className:"w-full text-[9px] py-1 mt-1 transition-all",style:{color:"rgba(239,68,68,0.50)",border:"1px solid rgba(239,68,68,0.15)",fontFamily:ur},onMouseEnter:H=>{H.currentTarget.style.color="rgba(239,68,68,0.80)",H.currentTarget.style.borderColor="rgba(239,68,68,0.30)"},onMouseLeave:H=>{H.currentTarget.style.color="rgba(239,68,68,0.50)",H.currentTarget.style.borderColor="rgba(239,68,68,0.15)"},children:"Clear all symbols"})]}),o.jsxs(Ud,{title:"Readout",open:Pe,onToggle:()=>ct(H=>!H),children:[o.jsxs("div",{className:"space-y-1.5 mb-3",children:[o.jsx(po,{label:"Cohesion",v:_e.cohesion,c:"#34d399"}),o.jsx(po,{label:"Polariz.",v:_e.polarization,c:"#fbd38d"}),o.jsx(po,{label:"Conflict",v:_e.conflict,c:"#ef4444"}),o.jsx(po,{label:"Consensus",v:_e.consensus,c:"#a78bfa"})]}),o.jsxs("div",{className:"pt-2 mb-3",style:{borderTop:"1px solid rgba(255,255,255,0.05)",fontFamily:ur},children:[o.jsx("div",{className:"text-[8px] uppercase tracking-[0.14em] mb-1.5",style:{color:"#00d4aa66"},children:"Morin  Complexidade"}),o.jsxs("div",{className:"space-y-1.5",children:[o.jsx(po,{label:"Percepo",v:_e.meanPerception,c:"#60d0ff"}),o.jsx(po,{label:"tica",v:_e.meanEthics,c:"#00d4aa"}),o.jsx(po,{label:"Compreenso",v:_e.meanUnderstanding,c:"#34d399"}),o.jsx(po,{label:"Entanglement",v:_e.meanEntanglement,c:"#67e8f9"}),o.jsx(po,{label:"Hybris",v:_e.meanHybris,c:"#ffa000"}),o.jsx(po,{label:"Fervor",v:_e.meanFervor,c:"#ff4500"}),o.jsx(po,{label:"Eco Sade",v:_e.ecoHealth,c:"#8b6914"})]})]}),Mt.length>0&&o.jsxs("div",{className:"pt-2 mb-3",style:{borderTop:"1px solid rgba(255,255,255,0.05)",fontFamily:ur},children:[o.jsx("div",{className:"text-[8px] uppercase tracking-[0.14em] mb-1.5",style:{color:"rgba(255,255,255,0.22)"},children:"Drivers dominantes"}),o.jsx("div",{className:"space-y-0.5",children:Mt.map((H,le)=>o.jsxs("div",{className:"flex items-center justify-between text-[9px]",children:[o.jsx("span",{style:{color:"rgba(255,255,255,0.55)"},children:H.label}),o.jsx("span",{style:{color:"rgba(255,255,255,0.35)"},children:H.count})]},H.label+le))})]}),Pt.length>0&&o.jsxs("div",{className:"pt-2 mb-3",style:{borderTop:"1px solid rgba(255,255,255,0.05)",fontFamily:ur},children:[o.jsx("div",{className:"text-[8px] uppercase tracking-[0.14em] mb-1.5",style:{color:"rgba(255,255,255,0.22)"},children:"Intensidade mdia (auditoria)"}),o.jsx("div",{className:"space-y-1.5",children:Pt.map(H=>o.jsx(po,{label:H.label,v:H.value,c:H.label==="Ameaa"?"#ef4444":H.label==="Recurso"?"#fbbf24":H.label==="Social"?"#34d399":H.label==="Transgresso"?"#f472b6":"#93c5fd"},H.label))})]}),o.jsxs("div",{className:"pt-2 mb-3",style:{borderTop:"1px solid rgba(255,255,255,0.05)",fontFamily:ur},children:[o.jsx("div",{className:"text-[8px] uppercase tracking-[0.14em] mb-1.5",style:{color:"rgba(255,255,255,0.22)"},children:"Economy"}),o.jsxs("div",{className:"space-y-1",children:[o.jsxs("div",{className:"flex justify-between text-[10px]",children:[o.jsx("span",{style:{color:"rgba(255,255,255,0.35)"},children:"Mean Wealth"}),o.jsxs("span",{style:{color:"#fbbf24"},children:[(Re.meanWealth*100).toFixed(0),"%"]})]}),o.jsxs("div",{className:"flex justify-between text-[10px]",children:[o.jsx("span",{style:{color:"rgba(255,255,255,0.35)"},children:"Gini Index"}),o.jsx("span",{style:{color:Re.gini>.55?"#f87171":Re.gini>.35?"#fbbf24":"#4ade80"},children:Re.gini.toFixed(2)})]}),o.jsxs("div",{className:"flex justify-between text-[10px]",children:[o.jsx("span",{style:{color:"rgba(255,255,255,0.35)"},children:"Violations/min"}),o.jsx("span",{style:{color:Re.violationsWindow>2?"#f87171":"rgba(255,255,255,0.45)"},children:Re.violationsWindow})]})]})]}),nt.length>0&&o.jsxs("div",{className:"pt-2 mb-3",style:{borderTop:"1px solid rgba(255,255,255,0.05)",fontFamily:ur},children:[o.jsx("div",{className:"text-[8px] uppercase tracking-[0.14em] mb-1.5",style:{color:"rgba(255,255,255,0.22)"},children:"Leaders"}),o.jsx("div",{className:"space-y-1",children:nt.map((H,le)=>o.jsxs("div",{className:"flex items-center justify-between gap-2",children:[o.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[o.jsx("div",{className:"shrink-0",style:{width:8,height:8,borderRadius:2,background:H.color,opacity:.9}}),o.jsxs("div",{className:"min-w-0",children:[o.jsxs("div",{className:"text-[9px] truncate",style:{color:"rgba(255,255,255,0.65)"},children:[le+1,". ",Ki(H.role)]}),o.jsx("div",{className:"text-[8px] truncate",style:{color:"rgba(255,255,255,0.28)"},children:H.label})]})]}),o.jsx("div",{className:"text-[9px] shrink-0",style:{color:le===0?"#fbbf24":"rgba(255,255,255,0.35)"},children:H.score.toFixed(2)})]},H.idx))})]}),Oe.length>0&&o.jsxs("div",{className:"pt-2",style:{borderTop:"1px solid rgba(255,255,255,0.05)",fontFamily:ur},children:[o.jsx("div",{className:"text-[8px] uppercase tracking-[0.14em] mb-1.5",style:{color:"rgba(255,255,255,0.22)"},children:"Chronicle"}),o.jsx("div",{className:"space-y-1.5",children:Oe.slice(0,12).map((H,le)=>o.jsxs("div",{className:"flex flex-col gap-0.5",title:H.cause??H.message,children:[o.jsxs("div",{className:"flex gap-1.5 items-baseline",children:[o.jsx("span",{className:"text-[10px] shrink-0",children:H.icon}),o.jsx("span",{className:"text-[9px] leading-tight",style:{color:H.color},children:FW(H.message)})]}),H.cause&&o.jsx("div",{className:"text-[8px] pl-[1.1rem] leading-tight opacity-80",style:{color:"rgba(255,255,255,0.65)"},children:H.cause})]},le))})]})]}),o.jsxs("div",{className:"px-3 py-3 mt-auto",style:{borderTop:"1px solid rgba(255,255,255,0.05)"},children:[o.jsx("div",{className:"text-[8px] uppercase tracking-[0.12em] mb-1.5",style:{color:"rgba(255,255,255,0.22)"},children:"Papis (lente sociolgica)"}),o.jsxs("div",{className:"grid grid-cols-2 gap-x-3 gap-y-0.5",children:[o.jsx(Yd,{sym:"",label:Ki("leader"),c:"#fbbf24"}),o.jsx(Yd,{sym:"",label:Ki("aggressor"),c:"#ef4444"}),o.jsx(Yd,{sym:"",label:Ki("guardian"),c:"#fbd38d"}),o.jsx(Yd,{sym:"",label:Ki("mediator"),c:"#94a3b8"}),o.jsx(Yd,{sym:"",label:Ki("rebel"),c:"#ff6b6b"}),o.jsx(Yd,{sym:"",label:Ki("priest"),c:"#a78bfa"}),o.jsx(Yd,{sym:"",label:Ki("dictator"),c:"#ef4444"}),o.jsx(Yd,{sym:"",label:Ki("artist"),c:"#34d399"})]}),o.jsxs("div",{className:"mt-2 pt-2 grid grid-cols-3 gap-1",style:{borderTop:"1px solid rgba(255,255,255,0.05)"},children:[o.jsx(bb,{c:"#34d399",label:"N",title:"Norma"}),o.jsx(bb,{c:"#a78bfa",label:"L",title:"Legit."}),o.jsx(bb,{c:"#fbbf24",label:"R",title:"Recurso"})]})]})]})]})]})};function $W({phase:e,phaseColor:t,onClose:n}){const r=IW(e);return o.jsxs("div",{className:"mt-2 py-2.5 px-3 rounded-lg border pointer-events-auto",style:{background:"rgba(0,0,0,0.4)",borderColor:t+"25",maxWidth:280},children:[o.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[o.jsx("span",{className:"text-[10px] font-medium uppercase tracking-wider",style:{color:t},children:r.title}),o.jsx("button",{type:"button",onClick:n,className:"text-white/30 hover:text-white/60 text-sm leading-none","aria-label":"Fechar",children:""})]}),o.jsx("p",{className:"text-[9px] leading-snug m-0",style:{color:"rgba(255,255,255,0.6)"},children:r.what}),o.jsx("p",{className:"text-[8px] leading-snug mt-1 m-0",style:{color:"rgba(255,255,255,0.4)"},title:r.conditions,children:r.why})]})}function Yg({label:e,v:t,c:n,title:r}){return o.jsxs("div",{className:"flex items-center gap-2",style:{fontFamily:"'IBM Plex Mono', monospace"},title:r,children:[o.jsx("span",{className:"text-[10px] w-20 shrink-0",style:{color:"rgba(255,255,255,0.40)"},children:e}),o.jsx("div",{className:"flex-1 h-px overflow-hidden",style:{background:"rgba(255,255,255,0.10)"},children:o.jsx("div",{className:"h-full transition-all duration-500",style:{width:`${(t*100).toFixed(0)}%`,background:n}})}),o.jsx("span",{className:"text-[10px] w-5 text-right",style:{color:n},children:(t*100).toFixed(0)})]})}function Hr({label:e,v:t,min:n,max:r,step:a,onChange:i}){const[s,c]=S.useState(t);return S.useEffect(()=>{c(t)},[t]),o.jsxs("div",{className:"flex items-center gap-2",style:{fontFamily:"'IBM Plex Mono', monospace"},children:[o.jsx("span",{className:"text-[9px] w-14 shrink-0",style:{color:"rgba(255,255,255,0.35)"},children:e}),o.jsx("input",{type:"range",min:n,max:r,step:a,value:s,onChange:l=>{const d=parseFloat(l.target.value);c(d),i(d)},className:"flex-1 h-px appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-2.5 [&::-webkit-slider-thumb]:h-2.5 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-white/60",style:{background:"rgba(255,255,255,0.10)"}}),o.jsx("span",{className:"text-[9px] w-6 text-right shrink-0",style:{color:"rgba(255,255,255,0.45)"},children:a>=1?Math.round(s):s.toFixed(2)})]})}function yb({icon:e,label:t,sub:n,color:r,onRemove:a}){return o.jsxs("div",{className:"flex items-center gap-2 py-0.5",style:{fontFamily:"'IBM Plex Mono', monospace"},children:[o.jsx("span",{style:{color:r},className:"text-[11px] shrink-0",children:e}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("div",{className:"text-[10px]",style:{color:"rgba(255,255,255,0.60)"},children:t}),o.jsx("div",{className:"text-[8px]",style:{color:"rgba(255,255,255,0.22)"},children:n})]}),o.jsx("button",{onClick:a,className:"transition-colors",style:{color:"rgba(255,255,255,0.20)"},onMouseEnter:i=>{i.currentTarget.style.color="rgba(239,68,68,0.70)"},onMouseLeave:i=>{i.currentTarget.style.color="rgba(255,255,255,0.20)"},children:o.jsx(Cs,{size:9})})]})}function Yd({sym:e,label:t,c:n}){return o.jsxs("div",{className:"flex items-center gap-1.5",style:{fontFamily:"'IBM Plex Mono', monospace"},children:[o.jsx("span",{className:"text-[10px] w-4 text-center shrink-0",style:{color:n},children:e}),o.jsx("span",{className:"text-[9px]",style:{color:"rgba(255,255,255,0.35)"},children:t})]})}function bb({c:e,label:t,title:n}){return o.jsxs("div",{className:"flex items-center gap-1",style:{fontFamily:"'IBM Plex Mono', monospace"},children:[o.jsx("div",{className:"w-1.5 h-1.5 shrink-0",style:{background:e,opacity:.75}}),o.jsxs("div",{children:[o.jsx("div",{className:"text-[9px]",style:{color:e},children:t}),o.jsx("div",{className:"text-[8px]",style:{color:"rgba(255,255,255,0.22)"},children:n})]})]})}function xb({c:e,label:t}){return o.jsxs("div",{className:"flex items-center gap-1.5",style:{fontFamily:"'IBM Plex Mono', monospace"},children:[o.jsx("div",{className:"w-2 h-2 shrink-0",style:{background:e,opacity:.65}}),o.jsx("span",{className:"text-[9px]",style:{color:e,opacity:.75},children:t})]})}const Pu=["SELF","PERSONA","SHADOW","ANIMA","TRICKSTER","HERO","MOTHER","FATHER","WISE_ONE","CHILD","LOVER","DESTROYER"],mf=0,Lj={SELF_REGION:[0,0],EGO:[.4,-.3],PERSONA_REGION:[-.4,-.3],SHADOW_REGION:[-.4,.35],COLLECTIVE:[.4,.35],ID:[0,.58],SUPEREGO:[0,-.66]},Ml=64,Fu=64,ci=1300,gf=500;function vb(){return{quantaTarget:600,danceIntensity:.2,flowGain:.3,damping:2,maxSpeed:.18,breathPeriod:24,springK:.55,springRestLen:.045,linkRadius:.07,linkValDiff:.35,linkProbability:.004,linkMaxTtl:2.5,archetypesOn:!0,selfPull:.18,spawnRate:4,deathAge:70,lens:"TOPOLOGY",trailFade:.06,trailOpacity:.65,trailWidth:3,bondsOn:!0,frozenFlow:!1,stateRelaxRate:1,soulVis:0}}function ji(){return Math.random()}function py(e,t,n){let r,a,i;n==="id"?(r=0,a=.55,i=.2):(r=.38,a=.32,i=.26);const s=Math.max(1e-6,ji()),c=ji(),l=Math.sqrt(-2*Math.log(s))*Math.cos(2*Math.PI*c),d=Math.sqrt(-2*Math.log(s))*Math.sin(2*Math.PI*c);let u=r+l*i,h=a+d*i;const m=Math.sqrt(u*u+h*h),f=.88;m>f&&(u=u*(f/m),h=h*(f/m)),e.x[t]=u,e.y[t]=h,e.vx[t]=(ji()-.5)*.06,e.vy[t]=(ji()-.5)*.06,e.charge[t]=n==="id"?.55+ji()*.35:.3+ji()*.4,e.valence[t]=(ji()-.5)*(n==="id"?.8:.6),e.coherence[t]=n==="collective"?.3+ji()*.3:.1+ji()*.2,e.arousal[t]=n==="id"?.5+ji()*.4:.2+ji()*.4,e.inhibition[t]=.1+ji()*.2,e.tag[t]=mf,e.tagAge[t]=0,e.age[t]=ji()*10,e.soulHue[t]===0&&(e.soulHue[t]=ji()*360)}function Sb(e){const t=Math.min(e,ci),n={count:t,x:new Float32Array(ci),y:new Float32Array(ci),vx:new Float32Array(ci),vy:new Float32Array(ci),charge:new Float32Array(ci),valence:new Float32Array(ci),coherence:new Float32Array(ci),arousal:new Float32Array(ci),inhibition:new Float32Array(ci),tag:new Uint8Array(ci),tagAge:new Float32Array(ci),age:new Float32Array(ci),soulHue:new Float32Array(ci),flowU:new Float32Array(Ml*Fu),flowV:new Float32Array(Ml*Fu),linkA:new Int32Array(gf).fill(-1),linkB:new Int32Array(gf).fill(-1),linkTtl:new Float32Array(gf),linkCount:0,archetypeActive:Pu.map(()=>!0),archetypeStrength:Pu.map(()=>.5),breathT:0,breathPhase:0,tick:0,elapsed:0,integrationIndex:.5,tensionIndex:.3,fragmentationIndex:.4,phase:"CALM",events:[],journeyActive:!1,journeyAct:0,journeyActT:0,journeyDone:!1},r=Math.floor(t*.6);for(let a=0;a<r;a++)py(n,a,"id");for(let a=r;a<t;a++)py(n,a,"collective");return n}function wb(e,t){py(e,t,Math.random()<.6?"id":"collective")}function qW(e,t,n){const r=Math.min(t,ci);if(r>e.count)for(let a=e.count;a<r;a++)py(e,a,a<e.count+(r-e.count)*.6?"id":"collective");e.count=r,n.quantaTarget=r}const Dc=[{id:"SELF",sigil:"",color:"#f5c842",preferredRegion:"SELF_REGION",fieldMode:"sink",fieldRadius:.28,description:"Integrao  centro unificador da psique"},{id:"PERSONA",sigil:"",color:"#b0c4de",preferredRegion:"PERSONA_REGION",fieldMode:"shear",fieldRadius:.28,description:"Mscara social  interface com o mundo"},{id:"SHADOW",sigil:"",color:"#7c3aed",preferredRegion:"SHADOW_REGION",fieldMode:"vortex",fieldRadius:.32,description:"Contedo reprimido e negado"},{id:"ANIMA",sigil:"",color:"#f43f5e",preferredRegion:"COLLECTIVE",fieldMode:"oscillate",fieldRadius:.35,description:"Ponte entre Ego e Inconsciente"},{id:"TRICKSTER",sigil:"",color:"#84cc16",preferredRegion:"SHADOW_REGION",fieldMode:"spiral",fieldRadius:.3,description:"Ruptura criativa  recombinao"},{id:"HERO",sigil:"",color:"#3b82f6",preferredRegion:"EGO",fieldMode:"source",fieldRadius:.28,description:"Direo e conquista  ego dirigido"},{id:"MOTHER",sigil:"",color:"#f59e0b",preferredRegion:"COLLECTIVE",fieldMode:"sink",fieldRadius:.34,description:"Nutrio e acolhimento  campo matrizal"},{id:"FATHER",sigil:"",color:"#6b7280",preferredRegion:"SUPEREGO",fieldMode:"shear",fieldRadius:.3,description:"Lei e ordem  estrutura normativa"},{id:"WISE_ONE",sigil:"",color:"#6366f1",preferredRegion:"SELF_REGION",fieldMode:"sink",fieldRadius:.38,description:"Sntese e sentido  sabedoria profunda"},{id:"CHILD",sigil:"",color:"#06b6d4",preferredRegion:"EGO",fieldMode:"oscillate",fieldRadius:.26,description:"Potencial e renascimento  abertura"},{id:"LOVER",sigil:"",color:"#ec4899",preferredRegion:"COLLECTIVE",fieldMode:"spiral",fieldRadius:.32,description:"Vnculo e Eros  campo de ressonncia"},{id:"DESTROYER",sigil:"",color:"#ef4444",preferredRegion:"ID",fieldMode:"source",fieldRadius:.28,description:"Morte e transformao  ruptura necessria"}],Uy={SELF:[0,0],PERSONA:[-.42,-.3],SHADOW:[-.42,.35],ANIMA:[.1,.2],TRICKSTER:[-.22,.45],HERO:[.42,-.3],MOTHER:[.2,.48],FATHER:[0,-.64],WISE_ONE:[0,-.1],CHILD:[.3,-.52],LOVER:[.45,.2],DESTROYER:[0,.68]};function HW(e,t,n,r,a,i){const[s,c]=t,l=n-s,d=r-c,u=Math.sqrt(l*l+d*d);if(u<.001||u>e.fieldRadius)return[0,0];const h=(1-u/e.fieldRadius)**2;let m=0,f=0;switch(e.fieldMode){case"sink":m=-l/u*h,f=-d/u*h;break;case"source":m=l/u*h,f=d/u*h;break;case"vortex":m=-d/u*h,f=l/u*h;break;case"shear":m=d/u*h,f=-l/u*h*.3;break;case"oscillate":{const g=a*1.5;m=Math.cos(g)*(-l/u)*h+Math.sin(g)*(-d/u)*h*.5,f=Math.cos(g)*(-d/u)*h+Math.sin(g)*(l/u)*h*.5;break}case"spiral":m=(-l/u-d/u*.7)*h,f=(-d/u+l/u*.7)*h;break}return[m*i,f*i]}function WW(e,t,n,r,a,i,s,c,l,d,u){const h=t[0]-n[0],m=t[1]-n[1],f=Math.sqrt(h*h+m*m);if(f>l)return{charge:r,valence:a,coherence:i,arousal:s,inhibition:c};const g=(1-f/l)*d*u;switch(e){case"SELF":return{charge:r+(.5-r)*g*.4,valence:a+(0-a)*g*.3,coherence:i+(1-i)*g*.8,arousal:s+(.3-s)*g*.5,inhibition:c+(.2-c)*g*.6};case"SHADOW":return{charge:r+(r>.5?.02:0)*g,valence:a-.05*g,coherence:i-.06*g,arousal:s+.04*g,inhibition:c+.03*g};case"HERO":return{charge:Math.min(1,r+.04*g),valence:Math.min(1,a+.05*g),coherence:i+.03*g,arousal:Math.min(1,s+.04*g),inhibition:c};case"MOTHER":return{charge:r+(.5-r)*g*.3,valence:Math.min(1,a+.06*g),coherence:Math.min(1,i+.05*g),arousal:s+(.35-s)*g*.4,inhibition:Math.max(0,c-.04*g)};case"FATHER":return{charge:r,valence:a,coherence:i+.02*g,arousal:Math.max(0,s-.04*g),inhibition:Math.min(1,c+.06*g)};case"TRICKSTER":return{charge:r+(Math.random()-.5)*.15*g,valence:a+(Math.random()-.5)*.12*g,coherence:Math.max(0,i-.05*g),arousal:Math.min(1,s+.06*g),inhibition:Math.max(0,c-.05*g)};case"DESTROYER":return{charge:Math.min(1,r+.08*g),valence:a-.07*g,coherence:Math.max(0,i-.08*g),arousal:Math.min(1,s+.07*g),inhibition:Math.max(0,c-.03*g)};case"ANIMA":return{charge:r+Math.sin(r*Math.PI)*.03*g,valence:a+(Math.random()>.5?.04:-.02)*g,coherence:i+.04*g,arousal:s+.02*g,inhibition:Math.max(0,c-.03*g)};case"WISE_ONE":return{charge:r+(.5-r)*g*.2,valence:Math.min(1,a+.04*g),coherence:Math.min(1,i+.07*g),arousal:s+(.4-s)*g*.3,inhibition:c+(.3-c)*g*.3};case"CHILD":return{charge:Math.min(1,r+.03*g),valence:Math.min(1,a+.05*g),coherence:Math.max(0,i-.02*g),arousal:Math.min(1,s+.05*g),inhibition:Math.max(0,c-.05*g)};case"LOVER":return{charge:r+.03*g,valence:Math.min(1,a+.07*g),coherence:Math.min(1,i+.04*g),arousal:Math.min(1,s+.04*g),inhibition:c};case"PERSONA":return{charge:r,valence:a+(.1-a)*g*.3,coherence:i+.02*g,arousal:Math.max(0,s-.03*g),inhibition:Math.min(1,c+.04*g)};default:return{charge:r,valence:a,coherence:i,arousal:s,inhibition:c}}}function GW(e,t){const{flowU:n,flowV:r,breathPhase:a,elapsed:i}=e,s=t.frozenFlow?0:i,l=Math.sin(a),d=t.danceIntensity;for(let u=0;u<Fu;u++)for(let h=0;h<Ml;h++){const m=(h+.5)/Ml*2-1,f=(u+.5)/Fu*2-1,g=Math.sqrt(m*m+f*f),x=g>.001?g:.001;let v=0,b=0;v+=-f*.35*l*d,b+=m*.35*l*d,v+=Math.sin(f*3.14+s*.38)*.2*d,b+=Math.cos(m*2.71+s*.29)*.2*d,v+=Math.sin(m*5.1-f*3.7+s*.72)*.13*d,b+=Math.cos(f*4.9+m*2.3-s*.61)*.13*d,v+=Math.cos(m*1.4+f*2.8+s*.18)*.09*d,b+=Math.sin(m*2.2-f*1.6+s*.22)*.09*d;const w=t.selfPull;v-=m/x*Math.max(0,w-g*.9)*.5,b-=f/x*Math.max(0,w-g*.9)*.5;const M=f-.58,k=Math.sqrt(m*m+M*M);if(k<.2){const E=t.archetypesOn&&e.archetypeActive[11],O=(.2-k)*.6*d*(E?1:.5);v+=m/(k+.01)*O,b+=M/(k+.01)*O}const R=f+.66;if(Math.sqrt(m*m+R*R)<.18&&t.archetypesOn&&(b+=R*.5*d*.4),t.archetypesOn)for(let E=0;E<Dc.length;E++){if(!e.archetypeActive[E])continue;const O=Dc[E],L=Uy[O.id],[$,F]=HW(O,L,m,f,s,e.archetypeStrength[E]*d*.55);v+=$,b+=F}const I=u*Ml+h;n[I]=n[I]*.72+v*.28,r[I]=r[I]*.72+b*.28}}function zj(e,t,n){if(!isFinite(t)||!isFinite(n))return[0,0];const r=Math.max(-1,Math.min(1,t)),a=Math.max(-1,Math.min(1,n)),i=(r+1)*.5*(Ml-1),s=(a+1)*.5*(Fu-1),c=Math.max(0,Math.min(Ml-1,Math.floor(i))),l=Math.max(0,Math.min(Fu-1,Math.floor(s))),d=Math.min(c+1,Ml-1),u=Math.min(l+1,Fu-1),h=i-c,m=s-l,f=l*Ml+c,g=l*Ml+d,x=u*Ml+c,v=u*Ml+d,b=e.flowU[f]*(1-h)*(1-m)+e.flowU[g]*h*(1-m)+e.flowU[x]*(1-h)*m+e.flowU[v]*h*m,w=e.flowV[f]*(1-h)*(1-m)+e.flowV[g]*h*(1-m)+e.flowV[x]*(1-h)*m+e.flowV[v]*h*m;return[b,w]}const rl=20,my=2/rl,Mb=Array.from({length:rl*rl},()=>[]);function VW(e,t){if(!isFinite(e)||!isFinite(t))return 0;const n=Math.max(0,Math.min(rl-1,Math.floor((e+1)/my)));return Math.max(0,Math.min(rl-1,Math.floor((t+1)/my)))*rl+n}function Sh(e,t,n,r,a){const i=(e-n)**2+(t-r)**2;return Math.exp(-i/(2*a*a))}function UW(e,t,n){const{count:r}=e;if(r===0)return;e.breathT+=n,e.breathPhase=e.breathT%t.breathPeriod/t.breathPeriod*Math.PI*2;const i=(Math.sin(e.breathPhase)+1)*.5;e.tick++,e.tick%3===0&&GW(e,t);let s=0;for(let g=0;g<e.linkCount;g++)e.linkTtl[g]-=n,!(e.linkTtl[g]<=0)&&(e.linkA[s]=e.linkA[g],e.linkB[s]=e.linkB[g],e.linkTtl[s]=e.linkTtl[g],s++);e.linkCount=s;const c=t.springK*n*60,l=t.springRestLen;for(let g=0;g<e.linkCount;g++){const x=e.linkA[g],v=e.linkB[g];if(x<0||v<0||x>=r||v>=r)continue;const b=e.x[v]-e.x[x],w=e.y[v]-e.y[x];if(!isFinite(b)||!isFinite(w))continue;const M=Math.sqrt(b*b+w*w);if(M<.001||!isFinite(M))continue;const k=(M-l)*c,R=b/M*k,j=w/M*k;!isFinite(R)||!isFinite(j)||(e.vx[x]+=R,e.vy[x]+=j,e.vx[v]-=R,e.vy[v]-=j)}for(let g=0;g<rl*rl;g++)Mb[g].length=0;for(let g=0;g<r;g++){if(!isFinite(e.x[g])||!isFinite(e.y[g])){wb(e,g);continue}Mb[VW(e.x[g],e.y[g])].push(g)}const d=1-t.damping*n,u=t.maxSpeed,h=t.flowGain*t.danceIntensity,m=t.archetypesOn,f=n*(t.stateRelaxRate??1);for(let g=0;g<r;g++){let x=e.x[g],v=e.y[g],b=e.vx[g],w=e.vy[g];if(!isFinite(x)||!isFinite(v)||!isFinite(b)||!isFinite(w)){wb(e,g);continue}const[M,k]=zj(e,x,v);isFinite(M)&&(b+=M*h),isFinite(k)&&(w+=k*h);const R=(1-i)*.012*t.danceIntensity,j=Math.sqrt(x*x+v*v);j>.05&&(b+=x/j*R,w+=v/j*R);let I=e.charge[g],E=e.valence[g],O=e.coherence[g],L=e.arousal[g],$=e.inhibition[g];const F=Sh(x,v,0,0,.12);O=Math.min(1,O+F*.45*f),$=$+(.2-$)*F*.35*f,I=I+(.5-I)*F*.2*f,L=L+(.3-L)*F*.25*f,E=E+(0-E)*F*.1*f;const B=Sh(x,v,0,.58,.18);I=Math.min(1,I+B*.3*f),L=Math.min(1,L+B*.25*f),O=Math.max(0,O-B*.2*f),E=E-B*.08*f;const W=Sh(x,v,-.42,.35,.22);O=Math.max(0,O-W*.18*f),$=Math.min(1,$+W*.15*f),I=Math.min(1,I+W*.1*f);const re=Sh(x,v,.4,.32,.24);O=Math.min(1,O+re*.15*f);const oe=Sh(x,v,.4,-.3,.22);E=Math.min(1,E+oe*.12*f),L=Math.min(1,L+oe*.1*f);const te=Sh(x,v,0,-.66,.2);if($=Math.min(1,$+te*.2*f),L=Math.max(0,L-te*.15*f),E=E+te*.05*f,b*=1-$*.35*n,w*=1-$*.35*n,m)for(let P=0;P<Dc.length;P++){if(!e.archetypeActive[P])continue;const V=Dc[P],fe=Uy[V.id],ye=e.archetypeStrength[P],Se=WW(V.id,[x,v],fe,I,E,O,L,$,V.fieldRadius,ye,n);I=Math.max(0,Math.min(1,Se.charge)),E=Math.max(-1,Math.min(1,Se.valence)),O=Math.max(0,Math.min(1,Se.coherence)),L=Math.max(0,Math.min(1,Se.arousal)),$=Math.max(0,Math.min(1,Se.inhibition))}e.charge[g]=I,e.valence[g]=E,e.coherence[g]=O,e.arousal[g]=L,e.inhibition[g]=$,b*=d,w*=d;const J=Math.sqrt(b*b+w*w);!isFinite(J)||J===0?(b=0,w=0):J>u&&(b=b/J*u,w=w/J*u),x+=b*n*55,v+=w*n*55;const pe=Math.sqrt(x*x+v*v);if(pe>.9&&pe>0){const P=.9/pe;x=x*P,v=v*P;const V=b*(x/.9)+w*(v/.9);V>0&&(b-=x/.9*V*.8,w-=v/.9*V*.8)}e.x[g]=x,e.y[g]=v,e.vx[g]=b,e.vy[g]=w,m&&YW(e,g,n),e.age[g]+=n,e.age[g]>t.deathAge&&wb(e,g)}if(e.linkCount<gf-10){const g=Math.floor(r*.04),x=t.linkRadius,v=x*x;for(let b=0;b<g;b++){const w=Math.floor(Math.random()*r);if(e.coherence[w]<.35||!isFinite(e.x[w])||!isFinite(e.y[w]))continue;const M=Math.max(0,Math.min(rl-1,Math.floor((e.x[w]+1)/my))),k=Math.max(0,Math.min(rl-1,Math.floor((e.y[w]+1)/my)));for(let R=-1;R<=1;R++)for(let j=-1;j<=1;j++){const I=M+j,E=k+R;if(I<0||E<0||I>=rl||E>=rl)continue;const O=Mb[E*rl+I];if(O)for(const L of O){if(L===w)continue;const $=e.x[L]-e.x[w],F=e.y[L]-e.y[w];if($*$+F*F>v||Math.abs(e.valence[w]-e.valence[L])>t.linkValDiff||Math.random()>t.linkProbability*40)continue;let B=!1;for(let W=0;W<e.linkCount;W++)if(e.linkA[W]===w&&e.linkB[W]===L||e.linkA[W]===L&&e.linkB[W]===w){B=!0;break}!B&&e.linkCount<gf&&(e.linkA[e.linkCount]=w,e.linkB[e.linkCount]=L,e.linkTtl[e.linkCount]=t.linkMaxTtl*(.5+Math.random()*.5),e.linkCount++)}}}}e.elapsed+=n}function YW(e,t,n){const r=e.x[t],a=e.y[t],i=e.coherence[t],s=e.valence[t],c=e.inhibition[t],l=e.arousal[t];let d=e.tag[t];if(e.tagAge[t]+=n,d!==mf&&e.tagAge[t]>8+Math.random()*6&&(d=mf,e.tagAge[t]=0),d!==mf)return;if(Math.sqrt(r*r+a*a)<.14&&i>.65&&l>.25){e.tag[t]=1,e.tagAge[t]=0;return}const h=r+.42,m=a-.35;if(Math.sqrt(h*h+m*m)<.22&&i<.4&&c>.45){e.tag[t]=3,e.tagAge[t]=0;return}const f=r-.4,g=a+.3;if(Math.sqrt(f*f+g*g)<.22&&s>.5&&l>.55){e.tag[t]=6,e.tagAge[t]=0;return}if(l>.75&&i<.3&&Math.random()<.003){e.tag[t]=5,e.tagAge[t]=0;return}const x=r,v=a-.58;if(Math.sqrt(x*x+v*v)<.18&&e.charge[t]>.75&&s<-.4){e.tag[t]=12,e.tagAge[t]=0;return}const b=r-.4,w=a-.32;if(Math.sqrt(b*b+w*w)<.22&&s>.45&&i>.55){e.tag[t]=11,e.tagAge[t]=0;return}}const KW=1.2;let q4=0,Cb=0,kb=.5;function XW(e){if(e.elapsed-q4<KW)return;q4=e.elapsed;const{count:t}=e;if(t===0)return;let n=0,r=0,a=0,i=0,s=0;for(let j=0;j<t;j++){n+=e.coherence[j],r+=e.arousal[j],a+=e.inhibition[j];const I=e.x[j]+.42,E=e.y[j]-.35;Math.sqrt(I*I+E*E)<.25&&i++,Math.sqrt(e.x[j]*e.x[j]+e.y[j]*e.y[j])<.15&&s++}const c=n/t,l=r/t,d=a/t,u=i/t,h=s/t;let m=0;for(let j=0;j<t;j++)m+=(e.coherence[j]-c)**2;m/=t;const f=l*.5+d*.25+u*.15;e.tensionIndex=Math.max(0,Math.min(1,(f-.22)/.52)),e.integrationIndex=Math.min(1,c*.7+h*.3),e.fragmentationIndex=Math.min(1,m*7);const g=e.tensionIndex,x=e.integrationIndex,v=e.fragmentationIndex;let b;x>.55&&g<.18?b="FLOW":x>.42&&g<.28?b="INTEGRATING":g>.65&&v>.12?b="PANIC":g>.4?b="ALERT":v>.18&&x<.3?b="FRAGMENTED":b="CALM",e.phase=b;const w=(j,I,E,O)=>{e.events.push({text:j,x:I,y:E,ttl:3.5,color:O}),e.events.length>24&&e.events.shift()};u>.2&&u-Cb>.05&&w("SHADOW SURGE",-.42,.35,"#7c3aed"),d>.6&&kb>c+.04&&w("REPRESSION",0,-.66,"#6b7280"),Cb<.08&&u>.15&&d>.55&&w("RETURN OF THE REPRESSED",-.42,.35,"#ef4444"),c>kb+.06&&v>.08&&w("INSIGHT ",0,0,"#f5c842"),x>.68&&h>.06&&b==="INTEGRATING"&&w("INTEGRATION",0,0,"#f5c842");const M=new Int32Array(13);for(let j=0;j<t;j++)M[e.tag[j]]++;let k=0,R=0;for(let j=1;j<=12;j++)M[j]>R&&(R=M[j],k=j);if(k>0&&R>t*.12&&Math.random()<.08){const j=Pu[k-1],I=Object.values(Uy)[k-1];w(`ARCHETYPE: ${j}`,I[0],I[1],"#f5c842")}Cb=u,kb=c}const JW=[38,42,40,45],Bj=["Descent","Encounters","Confrontation","Integration"];function QW(e,t,n,r){if(!e.journeyActive||e.journeyDone)return;e.journeyActT+=t;const a=JW[e.journeyAct];if(ZW(e,r,t),e.journeyActT>=a){if(e.journeyAct++,e.journeyActT=0,e.journeyAct>=4){e.journeyDone=!0,e.journeyActive=!1,r(" The Red Book Journey is complete.");return}$j(e),n({name:Bj[e.journeyAct],act:e.journeyAct})}}let Pv=-99;function ZW(e,t,n){const r=e.journeyActT,a=e.journeyAct,i=a===0?[[3," Nigredo  the first descent into darkness begins."],[15,"The Ego loosens its grip. Shadows stir below."],[28,"Raw drives emerge from the Id core."]]:a===1?[[4,"Figures emerge from the Collective Unconscious."],[16,"The Anima speaks  a bridge is forming."],[30,"Trickster disrupts. The familiar dissolves."]]:a===2?[[5,"Hero confronts Shadow at the threshold."],[18,"The Father's law presses down  repression peaks."],[30,"Tension at its highest. Something must break."]]:[[5,"The Self draws all inward. Coherence returns."],[20,"Mandala stabilizes. Integration begins."],[36,"Albedo  the Wise One speaks from the center."]];for(const[s,c]of i)r>=s&&r<s+n+.5&&Pv<e.journeyActT-1&&(t(`[Act ${a+1}: ${Bj[a]}] ${c}`),Pv=r)}function $j(e){const t=e.journeyAct;for(let n=0;n<12;n++)e.archetypeStrength[n]=.2;if(t===0)e.archetypeActive[2]=!0,e.archetypeStrength[2]=.9,e.archetypeActive[11]=!0,e.archetypeStrength[11]=.7,e.archetypeActive[5]=!0,e.archetypeStrength[5]=.15;else if(t===1){for(let n=0;n<12;n++)e.archetypeActive[n]=!0,e.archetypeStrength[n]=.45+Math.random()*.35;e.archetypeStrength[3]=.8,e.archetypeStrength[4]=.75}else t===2?(e.archetypeStrength[5]=.85,e.archetypeStrength[2]=.85,e.archetypeStrength[7]=.8,e.archetypeStrength[0]=.25):t===3&&(e.archetypeStrength[0]=.95,e.archetypeStrength[8]=.85,e.archetypeStrength[6]=.7,e.archetypeStrength[2]=.3,e.archetypeStrength[5]=.4)}function eG(e){e.journeyActive=!0,e.journeyAct=0,e.journeyActT=0,e.journeyDone=!1,Pv=-99,$j(e)}function H4(e){e.journeyActive=!1,e.journeyDone=!0}const tG=.43,nG="#000000";function rG(e){const t=e.replace("#","");return[parseInt(t.slice(0,2),16),parseInt(t.slice(2,4),16),parseInt(t.slice(4,6),16)]}function tf(e,t,n){const r=(1-Math.abs(2*n-1))*t,a=r*(1-Math.abs(e/60%2-1)),i=n-r/2;let s=0,c=0,l=0;return e<60?(s=r,c=a,l=0):e<120?(s=a,c=r,l=0):e<180?(s=0,c=r,l=a):e<240?(s=0,c=a,l=r):e<300?(s=a,c=0,l=r):(s=r,c=0,l=a),[Math.round((s+i)*255),Math.round((c+i)*255),Math.round((l+i)*255)]}function U0(e,t,n,r,a,i){if(i<=.005)return`rgba(${e},${t},${n},${r})`;const[s,c,l]=tf(a,.7,.6),d=Math.min(1,i),u=Math.round(e*(1-d)+s*d),h=Math.round(t*(1-d)+c*d),m=Math.round(n*(1-d)+l*d);return`rgba(${u},${h},${m},${r})`}const _5={zoom:1,panX:0,panY:0};function lc(e,t,n){return[e.cx+t*e.R,e.cy+n*e.R]}function oG(e,t,n){const r=200-e*160,a=50+t*50,i=35+e*30;return`hsla(${r},${a}%,${i}%,${n})`}function aG(e,t){return e>=0?`hsla(120,${e*80}%,${30+e*25}%,${t})`:`hsla(0,${-e*80}%,${30+-e*25}%,${t})`}function sG(e,t){return`hsla(240,${30+e*40}%,${22+e*50}%,${t})`}function iG(e,t){const n=Math.sqrt(e*e+t*t);return t>.4||n>.75?"R":t<-.35||Math.abs(e)>.3&&t<-.1?"S":"I"}const qj={EROS:[255,70,155],THANATOS:[80,30,200],REPRESSAO:[230,140,20],SUBLIMACAO:[40,215,165]};function ZS(e,t){return e.inhibition[t]>.5?"REPRESSAO":e.coherence[t]>.6?"SUBLIMACAO":e.valence[t]>=0?"EROS":"THANATOS"}const hm={SELF_REGION:"#f5c842",EGO:"#3b82f6",PERSONA_REGION:"#b0c4de",SHADOW_REGION:"#7c3aed",COLLECTIVE:"#06b6d4",ID:"#ef4444",SUPEREGO:"#9ca3af"},W4=[{key:"SELF_REGION",rgb:[245,200,66],r:.18,baseA:.15},{key:"EGO",rgb:[59,130,246],r:.3,baseA:.09},{key:"PERSONA_REGION",rgb:[176,196,222],r:.3,baseA:.07},{key:"SHADOW_REGION",rgb:[124,58,237],r:.3,baseA:.09},{key:"COLLECTIVE",rgb:[6,182,212],r:.3,baseA:.09},{key:"ID",rgb:[239,68,68],r:.26,baseA:.1},{key:"SUPEREGO",rgb:[156,163,175],r:.27,baseA:.06}];function fm(e,t){if(Math.sqrt(e*e+t*t)<.14)return"SELF_REGION";const r=e-.4,a=t+.3,i=e+.4,s=t+.3,c=e+.42,l=t-.35,d=e-.4,u=t-.32,h=e,m=t-.58,f=e,g=t+.66,x=[["EGO",r*r+a*a],["PERSONA_REGION",i*i+s*s],["SHADOW_REGION",c*c+l*l],["COLLECTIVE",d*d+u*u],["ID",h*h+m*m],["SUPEREGO",f*f+g*g]];return x.sort((v,b)=>v[1]-b[1]),x[0][0]}function lG(e){const t={};for(let n=0;n<e.count;n++){const r=fm(e.x[n],e.y[n]);t[r]=(t[r]||0)+1}return t}function cG(e,t,n,r){const a=lG(n),i=n.count/W4.length;e.save();for(const s of W4){const[c,l]=Lj[s.key],[d,u]=lc(t,c,l),h=t.R*s.r,m=(a[s.key]||0)/Math.max(1,i),f=s.baseA*Math.min(1.8,.5+.8*m),g=s.key==="SELF_REGION"?1+.15*Math.sin(r*.9):1+.05*Math.sin(r*.7+c*2),x=f*g,[v,b,w]=s.rgb,M=e.createRadialGradient(d,u,0,d,u,h);M.addColorStop(0,`rgba(${v},${b},${w},${x.toFixed(3)})`),M.addColorStop(.3,`rgba(${v},${b},${w},${(x*.55).toFixed(3)})`),M.addColorStop(.65,`rgba(${v},${b},${w},${(x*.18).toFixed(3)})`),M.addColorStop(1,`rgba(${v},${b},${w},0)`),e.beginPath(),e.arc(d,u,h,0,Math.PI*2),e.fillStyle=M,e.fill()}e.restore()}function dG(e,t,n){const{cx:r,cy:a,R:i}=t;e.save(),e.beginPath(),e.arc(r,a,i*.95,0,Math.PI*2),e.strokeStyle="rgba(180,160,240,0.13)",e.lineWidth=1.5,e.stroke();const s=1+.08*Math.sin(n*.9);e.beginPath(),e.arc(r,a,i*.13*s,0,Math.PI*2),e.strokeStyle="rgba(245,200,66,0.28)",e.lineWidth=1,e.stroke(),e.beginPath(),e.arc(r,a,i*.5,0,Math.PI*2),e.strokeStyle="rgba(150,130,200,0.08)",e.lineWidth=1,e.stroke(),e.strokeStyle="rgba(150,130,200,0.07)",e.lineWidth=.8;for(const[m,f,g,x]of[[-i*.95,0,i*.95,0],[0,-i*.95,0,i*.95]])e.beginPath(),e.moveTo(r+m,a+f),e.lineTo(r+g,a+x),e.stroke();const c=i*.95*.707;e.strokeStyle="rgba(150,130,200,0.045)";for(const[m,f,g,x]of[[-c,-c,c,c],[-c,c,c,-c]])e.beginPath(),e.moveTo(r+m,a+f),e.lineTo(r+g,a+x),e.stroke();const l=[["EGO","","EGO"],["PERSONA","","PERSONA_REGION"],["SOMBRA","","SHADOW_REGION"],["COLETIVO","","COLLECTIVE"],["ID","","ID"],["SUPEREGO","","SUPEREGO"]],d=Math.max(9,i*.034);e.textAlign="center",e.textBaseline="middle";for(const[m,f,g]of l){const[x,v]=Lj[g],[b,w]=lc(t,x,v),M=hm[g]??"#b0a0f0";e.font=`${d+3}px sans-serif`,e.fillStyle=M+"55",e.fillText(f,b,w-d*.9),e.font=`${d}px monospace`,e.fillStyle=M+"44",e.fillText(m,b,w+d*.5)}const[u,h]=lc(t,0,0);e.font=`${d+4}px sans-serif`,e.fillStyle="rgba(245,200,66,0.65)",e.fillText("",u,h-d*.85),e.font=`${d+1}px monospace`,e.fillStyle="rgba(245,200,66,0.55)",e.fillText("SELF",u,h+d*.55),e.restore()}function uG(e,t,n){const{cx:r,cy:a,R:i}=t,s=i*.52,c=i*.24,l=[[r,a-c*.8,"rgba(50,100,230,0.14)","S"],[r-c*.7,a+c*.4,"rgba(240,190,30,0.13)","I"],[r+c*.7,a+c*.4,"rgba(220,40,50,0.12)","R"]];e.save();const d=Math.max(9,i*.03),u={S:"SYMBOLIQUE",I:"IMAGINAIRE",R:"REL"},h={S:"#6080e0",I:"#d4a800",R:"#cc3030"};for(const[g,x,v,b]of l){const w=1+.04*Math.sin(n*.6+l.indexOf(l.find(k=>k[3]===b))*2.1);e.globalAlpha=.6,e.strokeStyle=h[b]+"44",e.lineWidth=1.2*w,e.beginPath(),e.arc(g,x,s*w,0,Math.PI*2),e.stroke();const M=e.createRadialGradient(g,x,0,g,x,s);M.addColorStop(0,v),M.addColorStop(1,v.replace(/[\d.]+\)$/,"0)")),e.globalAlpha=.4,e.fillStyle=M,e.beginPath(),e.arc(g,x,s,0,Math.PI*2),e.fill(),e.globalAlpha=.72,e.font=`${d}px monospace`,e.textAlign="center",e.textBaseline="middle",e.fillStyle=h[b],e.fillText(u[b],g,x+s*.3),e.font=`bold ${d+2}px monospace`,e.fillStyle=h[b]+"cc",e.fillText(b,g,x-s*.1)}const[m,f]=[r,a+c*.08];e.globalAlpha=.85,e.font=`${d+1}px serif`,e.textAlign="center",e.textBaseline="middle",e.fillStyle="rgba(255,230,120,0.90)",e.fillText("",m,f),e.globalAlpha=1,e.restore()}function hG(e,t,n,r){const{cx:a,cy:i,R:s}=t;e.save();const c=i-s*.26,l=i+s*.22,d=s*1.6;e.globalAlpha=.2;const u=e.createLinearGradient(a,c,a,l);u.addColorStop(0,"rgba(50,120,200,0.10)"),u.addColorStop(1,"rgba(50,120,200,0.00)"),e.fillStyle=u,e.fillRect(a-d/2,c,d,l-c),e.globalAlpha=.35,e.strokeStyle="rgba(80,140,220,0.60)",e.lineWidth=1,e.setLineDash([8,6]),e.beginPath(),e.moveTo(a-d/2,c),e.lineTo(a+d/2,c),e.stroke(),e.strokeStyle="rgba(220,80,50,0.50)",e.beginPath(),e.moveTo(a-d/2,l),e.lineTo(a+d/2,l),e.stroke(),e.setLineDash([]);const h=Math.max(8,s*.028);e.textAlign="left",e.textBaseline="middle";const m=a-s*.88,f=[[c-s*.25,"CONSCIENT","rgba(140,180,255,0.60)"],[c+(l-c)/2,"PRCONSCIENT","rgba(100,140,220,0.55)"],[l+s*.22,"INCONSCIENT","rgba(220,80,50,0.55)"]];e.font=`${h}px monospace`,e.globalAlpha=.8;for(const[v,b,w]of f)e.fillStyle=w,e.fillText(b,m,v);const g=[[c-s*.46,"SUR-MOI","rgba(180,180,200,0.65)"],[i,"MOI","rgba(60,150,220,0.70)"],[l+s*.4,"A","rgba(240,80,60,0.75)"]];e.font=`bold ${h+1}px monospace`,e.textAlign="right";const x=a+s*.88;for(const[v,b,w]of g)e.fillStyle=w,e.fillText(b,x,v+.04*s*Math.sin(r*.5));e.globalAlpha=1,e.restore()}function fG(e,t,n){const a=.10705882352941176;e.save(),e.lineCap="round";for(let i=0;i<17;i++)for(let s=0;s<17;s++){const c=-.91+(s+.5)*a,l=-.91+(i+.5)*a;if(c*c+l*l>.8)continue;const[d,u]=zj(n,c,l),h=Math.sqrt(d*d+u*u);if(h<.004)continue;const m=Math.min(1,h*3.5),[f,g]=lc(t,c,l),x=t.R*.024*m,v=d/h,b=u/h,w=f-v*x*.45,M=g-b*x*.45,k=f+v*x*.55,R=g+b*x*.55,j=fm(c,l),I=hm[j]??"#b0a0f0",E=.1+m*.18;e.globalAlpha=E,e.strokeStyle=I,e.lineWidth=.7+m*.5,e.beginPath(),e.moveTo(w,M),e.lineTo(k,R),e.stroke();const O=-b*x*.12,L=v*x*.12,$=k-v*x*.2,F=R-b*x*.2;e.globalAlpha=E*1.3,e.fillStyle=I,e.beginPath(),e.moveTo(k,R),e.lineTo($+O,F+L),e.lineTo($-O,F-L),e.closePath(),e.fill()}e.globalAlpha=1,e.restore()}function pG(e,t,n){const r=new Int32Array(13);for(let c=0;c<n.count;c++)r[n.tag[c]]++;const a=[];for(let c=1;c<=12;c++)r[c]>0&&n.archetypeActive[c-1]&&a.push([c,r[c]]);a.sort((c,l)=>l[1]-c[1]);const i=a.slice(0,3);e.save(),e.textAlign="center",e.textBaseline="middle";const s=t.R;e.font=`${Math.max(14,s*.05)}px serif`;for(const[c,l]of i){const d=Dc[c-1],u=Uy[d.id],[h,m]=lc(t,u[0],u[1]),f=Math.min(1,.3+l/n.count*8),g=e.createRadialGradient(h,m,0,h,m,s*.12);g.addColorStop(0,d.color+"55"),g.addColorStop(1,d.color+"00"),e.beginPath(),e.arc(h,m,s*.12,0,Math.PI*2),e.fillStyle=g,e.fill(),e.fillStyle=d.color+Math.round(f*255).toString(16).padStart(2,"0"),e.fillText(d.sigil,h,m),e.font=`${Math.max(7,s*.022)}px monospace`,e.fillStyle=d.color+"99",e.fillText(d.id,h,m+s*.07),e.font=`${Math.max(14,s*.05)}px serif`}e.restore()}function mG(e,t,n,r){e.save(),e.textAlign="center",e.textBaseline="middle";const a=t.R;e.font=`${Math.max(9,a*.03)}px monospace`;for(let i=n.events.length-1;i>=0;i--){const s=n.events[i];if(s.ttl-=r,s.ttl<=0){n.events.splice(i,1);continue}const c=Math.min(1,s.ttl/1.2),[l,d]=lc(t,s.x,s.y-(3.5-s.ttl)*.08);e.font=`${Math.max(9,a*.03)}px monospace`;const u=e.measureText(s.text).width;e.globalAlpha=c*.5,e.fillStyle="rgba(7,5,14,0.7)",e.beginPath(),e.roundRect(l-u/2-4,d-8,u+8,16,4),e.fill(),e.globalAlpha=c,e.fillStyle=s.color+Math.round(c*230).toString(16).padStart(2,"0"),e.fillText(s.text,l,d)}e.globalAlpha=1,e.restore()}function gG(e,t,n,r,a=1,i=.8){if(n.linkCount!==0){e.save(),e.lineCap="round",e.lineJoin="round";for(let s=0;s<n.linkCount;s++){const c=n.linkA[s],l=n.linkB[s];if(c<0||l<0||c>=n.count||l>=n.count)continue;const d=Math.min(1,n.linkTtl[s]/2.5),u=(.12+d*.6)*i,h=(1.2+d*1.6)*a,[m,f]=lc(t,n.x[c],n.y[c]),[g,x]=lc(t,n.x[l],n.y[l]),v=Math.round(Math.min(1,u)*255).toString(16).padStart(2,"0"),b=hm[fm(n.x[c],n.y[c])]+v,w=hm[fm(n.x[l],n.y[l])]+v,M=e.createLinearGradient(m,f,g,x);M.addColorStop(0,b),M.addColorStop(1,w),e.lineWidth=h,e.strokeStyle=M,e.beginPath(),e.moveTo(m,f),e.lineTo(g,x),e.stroke()}e.restore()}}function ew(e,t,n,r=.85,a=0){const i=e.soulHue[t];switch(n){case"TOPOLOGY":{const s=hm[fm(e.x[t],e.y[t])];if(!a)return s+"cc";const c=parseInt(s.slice(1,3),16),l=parseInt(s.slice(3,5),16),d=parseInt(s.slice(5,7),16);return U0(c,l,d,.8,i,a)}case"ENERGY":{const s=200-e.charge[t]*160,c=50+e.arousal[t]*50,l=35+e.charge[t]*30;if(!a)return`hsla(${s},${c}%,${l}%,${r})`;const[d,u,h]=tf(s,c/100,l/100);return U0(d,u,h,r,i,a)}case"VALENCE":{const s=e.valence[t];if(!a)return aG(s,r);const[c,l,d]=s>=0?tf(120,s*.8,.3+s*.25):tf(0,-s*.8,.3+-s*.25);return U0(c,l,d,r,i,a)}case"COHERENCE":{if(!a)return sG(e.coherence[t],r);const[s,c,l]=tf(240,(30+e.coherence[t]*40)/100,(22+e.coherence[t]*50)/100);return U0(s,c,l,r,i,a)}case"LACAN":{const s=iG(e.x[t],e.y[t]),[c,l,d]=s==="R"?[220,40,50]:s==="S"?[50,100,230]:[240,190,30];return U0(c,l,d,r,i,a)}case"FREUD":{const s=ZS(e,t),[c,l,d]=qj[s],u=.75+e.charge[t]*.5;return U0(Math.min(255,Math.round(c*u)),Math.min(255,Math.round(l*u)),Math.min(255,Math.round(d*u)),r,i,a)}case"ARCHETYPES":{const s=e.tag[t];if(s===mf)return`rgba(120,110,160,${r*.3})`;const c=Dc[s-1].color;if(!a)return c+"dd";const l=parseInt(c.slice(1,3),16),d=parseInt(c.slice(3,5),16),u=parseInt(c.slice(5,7),16);return U0(l,d,u,r,i,a)}case"EVENTS":return oG(e.charge[t],e.arousal[t],r*.82);default:return`rgba(180,170,220,${r*.82})`}}function yG(e,t,n,r,a=0){const i=t.R,s=Math.max(2,i*.0055);for(let c=0;c<n.count;c++){const[l,d]=lc(t,n.x[c],n.y[c]),u=ew(n,c,r,.85,a);let h=s;if(r==="ENERGY"&&(h=s*(.7+n.arousal[c]*.9)),r==="COHERENCE"&&(h=s*(.6+n.coherence[c]*.8)),(r==="ARCHETYPES"||r==="LACAN"||r==="FREUD")&&n.tag[c]!==mf&&(h=s*1.5),r==="FREUD"){const m=ZS(n,c),[f,g,x]=qj[m],v=2.2+n.charge[c]*1.8+n.arousal[c]*1,b=h*v,w=e.createRadialGradient(l,d,h*.4,l,d,b);w.addColorStop(0,`rgba(${f},${g},${x},0.28)`),w.addColorStop(1,`rgba(${f},${g},${x},0)`),e.fillStyle=w,e.beginPath(),e.arc(l,d,b,0,Math.PI*2),e.fill()}if(e.fillStyle=u,e.beginPath(),e.arc(l,d,h,0,Math.PI*2),e.fill(),a>.15){const[m,f,g]=tf(n.soulHue[c],.8,.65),x=Math.min(.9,a*.85),v=h+Math.max(.5,h*.4);e.strokeStyle=`rgba(${m},${f},${g},${x})`,e.lineWidth=Math.max(.5,h*.35),e.beginPath(),e.arc(l,d,v,0,Math.PI*2),e.stroke()}}}let Ks=null;function Rb(){if(Ks){const e=Ks.getContext("2d");e&&e.clearRect(0,0,Ks.width,Ks.height)}}function bG(e,t,n){Ks||(Ks=document.createElement("canvas"));const r=Math.round(e*n),a=Math.round(t*n);return(Ks.width!==r||Ks.height!==a)&&(Ks.width=r,Ks.height=a),Ks.getContext("2d")}function xG(e,t,n,r,a,i,s,c,l=[0,0,0]){const d=e.canvas.width,u=e.canvas.height;e.setTransform(1,0,0,1,0,0),e.globalAlpha=Math.min(.99,Math.max(.01,a)),e.fillStyle=`rgb(${l[0]},${l[1]},${l[2]})`,e.fillRect(0,0,d,u),e.setTransform(s,0,0,s,0,0);const h=Math.max(1.5,t.R*.0052);e.lineCap="round";for(let m=0;m<n.count;m++){const[f,g]=lc(t,n.x[m],n.y[m]),x=ew(n,m,r,1,c),v=n.vx[m],b=n.vy[m],w=Math.hypot(v,b);if(w>2e-4){const M=v/w,k=b/w,R=h*Math.min(12,1.5+w*i*22),j=f-M*R,I=g-k*R;e.globalAlpha=.55,e.strokeStyle=x,e.lineWidth=Math.max(.4,h*.5),e.beginPath(),e.moveTo(f,g),e.lineTo(j,I),e.stroke()}e.globalAlpha=w>2e-4?.85:.45,e.fillStyle=x,e.beginPath(),e.arc(f,g,h,0,Math.PI*2),e.fill()}e.globalAlpha=1}let Di=null,G4=!0;function V4(e,t,n){Di||(Di=document.createElement("canvas"));const r=Math.round(e*n),a=Math.round(t*n);return(Di.width!==r||Di.height!==a)&&(Di.width=r,Di.height=a),Di.getContext("2d")}function vG(e,t,n,r){const a=t.R,i=Math.max(10,a*.03),s=Math.max(3,a*.008);for(let c=0;c<n.count;c++){const[l,d]=lc(t,n.x[c],n.y[c]),u=ew(n,c,r,1);e.globalAlpha=.1,e.fillStyle=u,e.beginPath(),e.arc(l,d,i,0,Math.PI*2),e.fill(),e.globalAlpha=.3,e.fillStyle=u,e.beginPath(),e.arc(l,d,s,0,Math.PI*2),e.fill()}e.globalAlpha=1}let U4=0,Ab=null;function SG(e,t,n,r,a,i={},s=_5){const{rastrosOn:c=!1,campoOn:l=!1,fieldOn:d=!1,bondsOn:u=!0,overlayOn:h=!0,overlayJung:m=!0,overlayLacan:f=!1,overlayFreud:g=!1,trailFade:x=.06,trailOpacity:v=.65,trailWidth:b=3,soulVis:w=0,bondWidth:M=1,bondOpacity:k=.8,bgColor:R=nG}=i,[j,I,E]=rG(R),O=performance.now(),L=Math.min(.05,(O-U4)/1e3);if(U4=O,Ab!==null&&Ab!==n){if(Ks){const te=Ks.getContext("2d");te&&te.clearRect(0,0,Ks.width,Ks.height)}if(Di){const te=Di.getContext("2d");te&&te.clearRect(0,0,Di.width,Di.height)}}Ab=n;const $=Math.min(window.devicePixelRatio||1,1.5),F=e.clientWidth,B=e.clientHeight;(e.width!==Math.round(F*$)||e.height!==Math.round(B*$))&&(e.width=Math.round(F*$),e.height=Math.round(B*$));const W=e.getContext("2d");W.setTransform($,0,0,$,0,0);const re=Math.min(F,B)*tG,oe={cx:F/2+s.panX,cy:B/2+s.panY,R:re*s.zoom};if(W.clearRect(0,0,F,B),W.fillStyle=R,W.fillRect(0,0,F,B),l){const te=V4(F,B,$);te.setTransform($,0,0,$,0,0),te.fillStyle=`rgba(${j},${I},${E},0.055)`,te.fillRect(0,0,F,B),vG(te,oe,t,n),W.save(),W.globalAlpha=.85,W.drawImage(Di,0,0,F,B),W.restore()}else G4&&!l&&V4(F,B,$).clearRect(0,0,Di.width,Di.height);if(G4=l,c){const te=bG(F,B,$);te&&(xG(te,oe,t,n,x,b,$,w,[j,I,E]),W.save(),W.globalAlpha=v,W.drawImage(Ks,0,0,F,B),W.restore())}d&&fG(W,oe,t),h&&m&&cG(W,oe,t,t.elapsed),h&&dG(W,oe,t.elapsed),h&&f&&uG(W,oe,t.elapsed),h&&g&&hG(W,oe,t,t.elapsed),u&&gG(W,oe,t,!1,M,k),yG(W,oe,t,n,w),n==="ARCHETYPES"&&pG(W,oe,t),(n==="EVENTS"||n==="TOPOLOGY")&&mG(W,oe,t,L),r&&(W.save(),W.textAlign="center",W.textBaseline="bottom",W.font=`${Math.max(10,oe.R*.03)}px monospace`,W.fillStyle="rgba(200,180,255,0.28)",W.fillText(a,F/2,B-12),W.font=`${Math.max(8,oe.R*.022)}px monospace`,W.fillStyle="rgba(180,160,230,0.20)",W.fillText(t.phase,F/2,B-28),W.restore())}const gy=[{id:"mandala-calm",name:"Mandala Calm",description:"Estado basal  fluxo harmnico, respirao suave, arqutipos em baixa.",observe:"Fluxo circular lento, integrao gradual ao centro, vnculos elsticos aparecem e somem com calma.",tags:["equilbrio","meditao","base"],config:{danceIntensity:.11,maxSpeed:.1,breathPeriod:32,selfPull:.28,damping:4.5,linkMaxTtl:3.5},archetypeStrengths:{SELF:.6,WISE_ONE:.5},archetypeActive:["SELF","WISE_ONE","MOTHER","ANIMA"],quantaCount:600},{id:"ego-inflation",name:"Ego Inflation",description:"Hero e Persona dominam. Superego alto. O Self  ignorado.",observe:"Ordem superficial na regio Ego/Persona, Sombra acumulando silenciosamente  o retorno  inevitvel.",tags:["inflao","persona","heri","tenso"],config:{danceIntensity:.19,maxSpeed:.16,breathPeriod:14,selfPull:.06,damping:3},archetypeStrengths:{HERO:.95,PERSONA:.9,FATHER:.8,SELF:.1,SHADOW:.3},archetypeActive:["HERO","PERSONA","FATHER","SELF","SHADOW"],quantaCount:700},{id:"return-of-shadow",name:"Return of the Shadow",description:"Represso ativa: Superego alto, Sombra acumulando.",observe:"Quanta se aglomeram lentamente no quadrante inferior esquerdo (Sombra). Observe o retorno gradual do reprimido.",tags:["represso","sombra","retorno","complexo"],config:{danceIntensity:.22,maxSpeed:.18,breathPeriod:12,selfPull:.12,damping:3.5,linkValDiff:.2},archetypeStrengths:{SHADOW:.95,FATHER:.85,DESTROYER:.6,SELF:.2,HERO:.25},archetypeActive:["SHADOW","FATHER","DESTROYER","SELF","HERO","PERSONA"],quantaCount:750},{id:"anima-bridge",name:"Anima Bridge",description:"Anima/Animus ativo: portais SelfColetivo abertos. Circulao integrada.",observe:"Circulao suave entre Coletivo e Self central. Vnculos elsticos densos e duradouros.",tags:["anima","animus","ponte","circulao"],config:{danceIntensity:.14,maxSpeed:.12,breathPeriod:22,selfPull:.32,damping:4.5,linkRadius:.09,linkProbability:.006,linkMaxTtl:4},archetypeStrengths:{ANIMA:.95,SELF:.8,LOVER:.75,CHILD:.6,WISE_ONE:.65},archetypeActive:["ANIMA","SELF","LOVER","CHILD","WISE_ONE","MOTHER"],quantaCount:600},{id:"trickster-breakthrough",name:"Trickster Breakthrough",description:"Trickster + Destroyer em alta. Limiares baixos. Recombinao criativa.",observe:"Padres se desfazem e recombinamos. Insights visveis. Novos clusters emergem do aparente caos.",tags:["trickster","caos criativo","insight","ruptura"],config:{danceIntensity:.32,maxSpeed:.26,breathPeriod:9,selfPull:.14,damping:2,linkMaxTtl:1.2,linkRadius:.055},archetypeStrengths:{TRICKSTER:.95,DESTROYER:.75,CHILD:.8,SHADOW:.65,ANIMA:.6},archetypeActive:["TRICKSTER","DESTROYER","CHILD","SHADOW","ANIMA"],quantaCount:800},{id:"red-book-journey",name:"Red Book Journey",description:"Jornada guiada do Livro Vermelho em 4 atos (~2.5 min).",observe:"Ato I: Descida. Ato II: Encontros. Ato III: Confronto. Ato IV: Integrao.",tags:["guiado","Jung","Livro Vermelho","4 atos"],config:{danceIntensity:.17,maxSpeed:.13,breathPeriod:20,selfPull:.22,damping:3.5,linkMaxTtl:3},archetypeStrengths:{},archetypeActive:["SELF","SHADOW","ANIMA","TRICKSTER","HERO","MOTHER","FATHER","WISE_ONE","CHILD","LOVER","DESTROYER","PERSONA"],quantaCount:700,journeyMode:!0},{id:"nigredo",name:"Nigredo",description:"A fase negra: dissoluo, decomposio, putrefao. Tudo precisa morrer para renascer.",observe:"Clusters se desfazem gradualmente, Sombra domina, alta fragmentao. A matria prima emerge do colapso.",tags:["alquimia","nigredo","dissoluo","shadow"],config:{danceIntensity:.27,maxSpeed:.22,breathPeriod:7,selfPull:.08,damping:2.5,linkMaxTtl:.8,linkRadius:.05},archetypeStrengths:{SHADOW:1,DESTROYER:.9,TRICKSTER:.7,SELF:.05},archetypeActive:["SHADOW","DESTROYER","TRICKSTER"],quantaCount:900},{id:"albedo",name:"Albedo",description:"A fase branca: purificao, clareza lunar, Anima emerge como guia interior.",observe:"Fluxo luminoso e pausado. Quanta se distribuem em padres simtricos. Vnculos longos e delicados.",tags:["alquimia","albedo","purificao","anima"],config:{danceIntensity:.09,maxSpeed:.07,breathPeriod:45,selfPull:.42,damping:5.5,linkMaxTtl:5.5,linkProbability:.008},archetypeStrengths:{ANIMA:.95,SELF:.85,WISE_ONE:.8,MOTHER:.7},archetypeActive:["ANIMA","SELF","WISE_ONE","MOTHER","CHILD"],quantaCount:550},{id:"rubedo",name:"Rubedo",description:"A fase vermelha: integrao final, o Rei e a Rainha se unem. Opus Magnum.",observe:"Todos os arqutipos danam juntos com calma majestosa. Auto-organizao mxima. O SELF brilha no centro.",tags:["alquimia","rubedo","integrao","opus"],config:{danceIntensity:.16,maxSpeed:.12,breathPeriod:26,selfPull:.5,damping:4.5,linkRadius:.1,linkProbability:.01,linkMaxTtl:4.5},archetypeStrengths:{SELF:1,ANIMA:.8,HERO:.75,WISE_ONE:.85,LOVER:.75},archetypeActive:["SELF","ANIMA","HERO","WISE_ONE","LOVER","MOTHER","CHILD"],quantaCount:700},{id:"dark-night",name:"Noite Escura da Alma",description:"So Joo da Cruz: abandono espiritual total. Deus sumiu. O ego se despedaa.",observe:"Alta fragmentao, SELF quase ausente, movimento pesado. Eventualmente  depois de muito tempo  surge uma centelha de ordem.",tags:["mstica","crise","abandono","escurido"],config:{danceIntensity:.34,maxSpeed:.28,breathPeriod:6,selfPull:.04,damping:2,linkMaxTtl:.5},archetypeStrengths:{DESTROYER:.95,SHADOW:.85,CHILD:.6,SELF:.02},archetypeActive:["DESTROYER","SHADOW","CHILD"],quantaCount:1e3},{id:"oceanic-feeling",name:"Sentimento Ocenico",description:"Freud/Rolland: dissoluo dos limites do ego, fuso com o cosmos.",observe:"Fronteiras entre regies dissolvem muito lentamente. Fluxo ocenico. Auto-organizao difusa e abrangente.",tags:["Freud","Rolland","ocenico","mstica"],config:{danceIntensity:.07,maxSpeed:.06,breathPeriod:55,selfPull:.18,damping:5.5,linkRadius:.14,linkProbability:.012,linkMaxTtl:7},archetypeStrengths:{SELF:.5,MOTHER:.85,CHILD:.8,LOVER:.7,WISE_ONE:.6},archetypeActive:["SELF","MOTHER","CHILD","LOVER","WISE_ONE"],quantaCount:800},{id:"ego-dissolution",name:"Ego Dissolution",description:"Dissoluo progressiva do ego (ex.: experincia psicodlica profunda).",observe:"O EGO se fragmenta gradualmente. Quanta vagam alm das fronteiras regionais. O coletivo expande.",tags:["dissoluo","psicodlico","self","limiar"],config:{danceIntensity:.24,maxSpeed:.19,breathPeriod:13,selfPull:.06,damping:2.5,linkRadius:.12,linkMaxTtl:1.5},archetypeStrengths:{TRICKSTER:.8,CHILD:.9,ANIMA:.7,SHADOW:.6,SELF:.3},archetypeActive:["TRICKSTER","CHILD","ANIMA","SHADOW","SELF"],quantaCount:800},{id:"narcissus-mirror",name:"Narciso  O Espelho",description:"Ferida narcsica: ego frgil, Persona rgida, Anima projetada no outro.",observe:"Cluster rgido na Persona. Sombra e Anima completamente separadas. Ressonncia com EGO.",tags:["narcisismo","espelho","persona","clnica"],config:{danceIntensity:.15,maxSpeed:.11,breathPeriod:17,selfPull:.08,damping:3.5,linkValDiff:.1},archetypeStrengths:{PERSONA:1,HERO:.9,SHADOW:.05,ANIMA:.2,SELF:.1},archetypeActive:["PERSONA","HERO","FATHER"],quantaCount:600},{id:"trauma-freeze",name:"Trauma  Congelamento",description:"Resposta de congelamento: toda a energia psquica paralisada.",observe:"Movimento mnimo, alta inibio. Quanta ficam presos em clusters rgidos. O tempo parece parar.",tags:["trauma","freeze","inibio","clnica"],config:{danceIntensity:.04,maxSpeed:.04,breathPeriod:80,selfPull:.35,damping:7,linkMaxTtl:9},archetypeStrengths:{SHADOW:.7,FATHER:.8,CHILD:.9,SELF:.3},archetypeActive:["SHADOW","FATHER","CHILD"],quantaCount:500},{id:"grief-processing",name:"Elaborao do Luto",description:"As 5 fases de Kbler-Ross como dinmica de partculas.",observe:"Oscilao lenta entre fases: negao (clusters rgidos), raiva (leve turbulncia), aceitao (fluxo suave).",tags:["luto","Kbler-Ross","elaborao","clnica"],config:{danceIntensity:.19,maxSpeed:.15,breathPeriod:16,selfPull:.22,damping:3.5,linkMaxTtl:2.5},archetypeStrengths:{CHILD:.85,SHADOW:.7,MOTHER:.75,DESTROYER:.65,SELF:.4},archetypeActive:["CHILD","SHADOW","MOTHER","DESTROYER","SELF","LOVER"],quantaCount:650},{id:"collective-dreaming",name:"Sonho Coletivo",description:"Inconsciente coletivo ativo: imagens primordiais emergindo do fundo.",observe:"Padres mandaliformes espontneos. Vnculos densos na regio Coletivo. Smbolos emergem devagar.",tags:["inconsciente coletivo","sonho","imago","Jung"],config:{danceIntensity:.12,maxSpeed:.09,breathPeriod:28,selfPull:.26,damping:4.5,linkRadius:.1,linkProbability:.007},archetypeStrengths:{WISE_ONE:.9,MOTHER:.85,CHILD:.8,TRICKSTER:.6,SELF:.7},archetypeActive:["WISE_ONE","MOTHER","CHILD","TRICKSTER","SELF","ANIMA"],quantaCount:750},{id:"kundalini",name:"Kundalini Rising",description:"Energia de base ascende pelo eixo central  da ID ao SUPEREGO.",observe:"Movimento ascendente lento e concentrado no eixo vertical. Pulsaes rtmicas profundas.",tags:["kundalini","energia","eixo","vertical"],config:{danceIntensity:.21,maxSpeed:.16,breathPeriod:10,selfPull:.55,damping:3.5,linkRadius:.06},archetypeStrengths:{HERO:.85,SELF:.9,DESTROYER:.6,WISE_ONE:.7,MOTHER:.65},archetypeActive:["HERO","SELF","DESTROYER","WISE_ONE","MOTHER"],quantaCount:700},{id:"synchronicity",name:"Sincronicidade",description:"Coincidncias significativas: padres que conectam interno e externo.",observe:"Vnculos se formam entre partculas distantes de forma improvvel. Clusters inesperados. Espelhos.",tags:["sincronicidade","Jung","padro","coincidncia"],config:{danceIntensity:.14,maxSpeed:.1,breathPeriod:20,selfPull:.28,damping:3.5,linkRadius:.16,linkProbability:.003,linkMaxTtl:5.5,linkValDiff:.6},archetypeStrengths:{TRICKSTER:.85,WISE_ONE:.8,SELF:.75,CHILD:.7},archetypeActive:["TRICKSTER","WISE_ONE","SELF","CHILD","ANIMA"],quantaCount:600},{id:"flow-state",name:"Estado de Fluxo",description:"Csikszentmihalyi: desafio = habilidade. Ateno total, sem esforo.",observe:"Movimento fluido sem turbulncia. Alta coerncia, baixa fragmentao. O tempo se dilata.",tags:["fluxo","Csikszentmihalyi","ateno","peak"],config:{danceIntensity:.17,maxSpeed:.14,breathPeriod:24,selfPull:.42,damping:2.5,linkRadius:.08,linkMaxTtl:4},archetypeStrengths:{HERO:.8,SELF:.9,TRICKSTER:.5,CHILD:.7,WISE_ONE:.75},archetypeActive:["HERO","SELF","TRICKSTER","CHILD","WISE_ONE"],quantaCount:600},{id:"mystical-union",name:"Unio Mstica",description:"Unio Mystica: a separao sujeito-objeto desaparece. Experincia de no-dualidade.",observe:"Todas as regies convergem lentamente ao SELF. Vnculos mximos. Pulsao profunda e quieta.",tags:["mstica","no-dualidade","unio","integrao"],config:{danceIntensity:.08,maxSpeed:.06,breathPeriod:50,selfPull:.62,damping:5.5,linkRadius:.12,linkProbability:.01,linkMaxTtl:7},archetypeStrengths:{SELF:1,WISE_ONE:.9,LOVER:.85,MOTHER:.8,CHILD:.8},archetypeActive:["SELF","WISE_ONE","LOVER","MOTHER","CHILD","ANIMA"],quantaCount:650},{id:"hero-complete",name:"Jornada do Heri  Retorno",description:"Campbell: o heri completa o ciclo e traz o elixir. Integrao e dom ao mundo.",observe:"HERO retorna ao SELF com sabedoria. WISE_ONE aguarda. O CHILD recebe o dom. Harmonia pausada.",tags:["Campbell","heri","retorno","jornada"],config:{danceIntensity:.13,maxSpeed:.1,breathPeriod:28,selfPull:.4,damping:4,linkMaxTtl:4.5,linkRadius:.09},archetypeStrengths:{HERO:.85,SELF:.9,WISE_ONE:.85,CHILD:.75,LOVER:.7,TRICKSTER:.55},archetypeActive:["HERO","SELF","WISE_ONE","CHILD","LOVER","TRICKSTER","MOTHER"],quantaCount:650},{id:"creative-fire",name:"Fogo Criativo",description:"A musa desceu: energia criativa expansiva, conexes improvveis.",observe:"Movimento vivaz, vnculos efmeros. Caos com inteno. Insights emergem como flashes breves.",tags:["criatividade","musa","inspirao","fogo"],config:{danceIntensity:.28,maxSpeed:.23,breathPeriod:9,selfPull:.22,damping:2,linkRadius:.07,linkMaxTtl:1.3,linkProbability:.009},archetypeStrengths:{TRICKSTER:.9,ANIMA:.85,CHILD:.85,DESTROYER:.65,SELF:.5},archetypeActive:["TRICKSTER","ANIMA","CHILD","DESTROYER","SELF","LOVER"],quantaCount:850},{id:"mente-calma",name:" Mente Calma",description:"Estado basal de equilbrio profundo. Campo congelado, atratores estticos, quanta em rbita suave ao redor do Self.",observe:"Anis concntricos ao redor do Self central. Vnculos longos e persistentes. Alta coerncia. A mente encontrou seu centro de gravidade.",tags:["estvel","equilbrio","self","meditao","atrator"],config:{danceIntensity:.04,flowGain:.2,damping:9,maxSpeed:.06,breathPeriod:55,selfPull:.8,linkRadius:.11,linkProbability:.013,linkMaxTtl:12,linkValDiff:.5,spawnRate:.4,deathAge:400,springK:.4,frozenFlow:!0,stateRelaxRate:.25,archetypesOn:!0},archetypeStrengths:{SELF:1,WISE_ONE:.85,MOTHER:.7,CHILD:.5},archetypeActive:["SELF","WISE_ONE","MOTHER"],quantaCount:500},{id:"mente-ansiosa",name:" Mente Ansiosa",description:"Ansiedade crnica: oscilao entre Superego (deveria) e Id (quero), sem resoluo. Sistema sub-amortecido  nunca assenta.",observe:"Quanta oscilam entre Superego e Id sem jamais assentar. Vnculos se formam e quebram. Alta inibio, baixa coerncia. SELF inacessvel.",tags:["estvel","ansiedade","oscilao","superego","id","clnica"],config:{danceIntensity:.08,flowGain:.3,damping:.7,maxSpeed:.28,breathPeriod:3.5,selfPull:.03,linkRadius:.05,linkProbability:.005,linkMaxTtl:.45,linkValDiff:.15,spawnRate:5,deathAge:28,springK:.8,frozenFlow:!0,stateRelaxRate:2,archetypesOn:!0},archetypeStrengths:{FATHER:.95,SHADOW:.75,DESTROYER:.55,SELF:.05,HERO:.3},archetypeActive:["FATHER","SHADOW","DESTROYER"],quantaCount:700},{id:"mente-hedonista",name:" Mente Hedonista",description:"Princpio do prazer (Freud): Id domina, Superego silenciado, toda energia flui para Eros.",observe:"Quanta gravitam entre Id e Ego/Coletivo. Alta valncia positiva, baixa inibio. LOVER e MOTHER tecem uma teia de prazer.",tags:["estvel","hedonismo","eros","prazer","id","Freud"],config:{danceIntensity:.07,flowGain:.25,damping:4.5,maxSpeed:.12,breathPeriod:9,selfPull:.06,linkRadius:.1,linkProbability:.011,linkMaxTtl:4.5,linkValDiff:.55,spawnRate:1.5,deathAge:150,springK:.35,frozenFlow:!0,stateRelaxRate:.5,archetypesOn:!0},archetypeStrengths:{LOVER:1,CHILD:.85,TRICKSTER:.6,MOTHER:.75,SHADOW:.1,FATHER:.05},archetypeActive:["LOVER","CHILD","TRICKSTER","MOTHER"],quantaCount:600},{id:"melancolia",name:" Melancolia",description:"A melancolia de Freud: o objeto perdido foi internalizado. O Ego se identifica com o que perdeu e se volta contra si mesmo.",observe:"Quanta pesados gravitam para a Sombra. Velocidade muito baixa. Valncia negativa generalizada. O SELF est l  mas inacessvel, encoberto.",tags:["clnica","depresso","Freud","objeto","perda"],config:{danceIntensity:.06,maxSpeed:.05,breathPeriod:45,selfPull:.1,damping:6.5,linkMaxTtl:1.2,linkRadius:.06},archetypeStrengths:{SHADOW:.9,DESTROYER:.7,CHILD:.8,SELF:.15,MOTHER:.3},archetypeActive:["SHADOW","DESTROYER","CHILD"],quantaCount:500},{id:"hipomania",name:" Hipomania",description:"O polo elevado do espectro bipolar: energia alta, julgamento intacto, prazer em tudo, o mundo parece possvel.",observe:"Movimento contnuo e vivaz sem colapso. Alta valncia, arousal elevado. Muitos vnculos se formando. HERO e LOVER danam sem parar.",tags:["clnica","bipolar","energia","expanso"],config:{danceIntensity:.26,maxSpeed:.22,breathPeriod:8,selfPull:.18,damping:2.5,linkRadius:.09,linkProbability:.01,linkMaxTtl:2.5},archetypeStrengths:{HERO:.9,LOVER:.85,TRICKSTER:.8,CHILD:.75,SELF:.5,DESTROYER:.3},archetypeActive:["HERO","LOVER","TRICKSTER","CHILD","SELF"],quantaCount:800},{id:"toc-compulsao",name:" TOC  Compulso",description:"Transtorno Obsessivo-Compulsivo: loops repetitivos. O FATHER demanda, o HERO obedece, a SHADOW acumula o que foi evitado.",observe:"Clusters circulam em padres repetitivos estreitos. Vnculos se formam e se desfazem nos mesmos pontos. Observe os loops.",tags:["clnica","TOC","compulso","loop","repetio"],config:{danceIntensity:.14,maxSpeed:.11,breathPeriod:6,selfPull:.05,damping:3,linkRadius:.06,linkValDiff:.08,linkMaxTtl:1.8,springK:.85},archetypeStrengths:{FATHER:1,PERSONA:.9,SHADOW:.6,HERO:.7,SELF:.1},archetypeActive:["FATHER","PERSONA","HERO","SHADOW"],quantaCount:650},{id:"dissociacao",name:" Dissociao",description:"O eu se fragmenta em partes que no se comunicam. Partes do self seguem trajetrias paralelas sem encontro.",observe:'Dois ou trs clusters isolados que quase no trocam quanta. Poucos vnculos entre regies. Cada cluster tem sua prpria "vida".',tags:["clnica","dissociao","fragmentao","trauma"],config:{danceIntensity:.1,maxSpeed:.08,breathPeriod:30,selfPull:.04,damping:5,linkRadius:.04,linkProbability:.002,linkValDiff:.08,linkMaxTtl:.8},archetypeStrengths:{SHADOW:.8,CHILD:.9,PERSONA:.75,DESTROYER:.5,SELF:.1},archetypeActive:["SHADOW","CHILD","PERSONA"],quantaCount:600},{id:"apego-ansioso",name:" Apego Ansioso",description:"Teoria do apego (Bowlby): hipervigilncia ao abandono. O CHILD orbita o MOTHER em busca de sinal, nunca satisfeito.",observe:"CHILD oscila em torno da MOTHER sem pousar. Alerta constante. Valncia instvel. Quando a MOTHER some, emerge o pnico da Sombra.",tags:["clnica","apego","ansiedade","Bowlby","CHILD"],config:{danceIntensity:.16,maxSpeed:.14,breathPeriod:5,selfPull:.08,damping:1.8,linkRadius:.07,linkMaxTtl:1,linkValDiff:.25},archetypeStrengths:{CHILD:1,MOTHER:.8,SHADOW:.65,DESTROYER:.4,FATHER:.55},archetypeActive:["CHILD","MOTHER","SHADOW","FATHER"],quantaCount:600},{id:"individuacao-final",name:" Individuao  Telos",description:"O fim do processo de individuao jungiano: todos os arqutipos integrados, SELF como centro estvel da personalidade total.",observe:"Cada arqutipo ocupa seu lugar natural. Quanta fluem sem tenso entre regies. O SELF pulsa suavemente no centro. Harmonia genuna.",tags:["Jung","individuao","integrao","telos","SELF"],config:{danceIntensity:.1,maxSpeed:.08,breathPeriod:40,selfPull:.6,damping:5,linkRadius:.1,linkProbability:.009,linkMaxTtl:6,frozenFlow:!0,stateRelaxRate:.3},archetypeStrengths:{SELF:1,WISE_ONE:.8,ANIMA:.8,HERO:.7,MOTHER:.75,SHADOW:.65,CHILD:.7,LOVER:.75,TRICKSTER:.6,FATHER:.65,DESTROYER:.55,PERSONA:.6},archetypeActive:["SELF","WISE_ONE","ANIMA","HERO","MOTHER","SHADOW","CHILD","LOVER","TRICKSTER","FATHER","DESTROYER","PERSONA"],quantaCount:700},{id:"inflacao-self",name:" Inflao do Self",description:'Identificao com o Self (messianismo, grandiosidade): o ego confunde-se com o arqutipo central. O "eu sou especial" como defesa.',observe:"Todos os quanta tentam orbitar o SELF mas sem damping suficiente  sobrepem-se, colidem, formam super-clusters instveis.",tags:["Jung","inflao","SELF","grandiosidade","messianismo"],config:{danceIntensity:.2,maxSpeed:.18,breathPeriod:12,selfPull:.9,damping:1.5,linkRadius:.05,linkMaxTtl:.6},archetypeStrengths:{SELF:1,HERO:.9,WISE_ONE:.85,FATHER:.8,PERSONA:.75},archetypeActive:["SELF","HERO","WISE_ONE","FATHER","PERSONA"],quantaCount:800},{id:"sonho-lucido",name:" Sonho Lcido",description:"Conscincia dentro do sonho: o ego sabe que sonha, pode interagir com imagens onricas sem ser arrastado.",observe:"ANIMA guia o movimento, TRICKSTER testa as bordas, CHILD explora. HERO observa com conscincia. Padres onricos estveis mas vivos.",tags:["sonho","lcido","Jung","ANIMA","onirismo"],config:{danceIntensity:.15,maxSpeed:.12,breathPeriod:18,selfPull:.3,damping:3.5,linkRadius:.09,linkMaxTtl:3.5,linkProbability:.008},archetypeStrengths:{ANIMA:.9,TRICKSTER:.8,CHILD:.85,HERO:.7,WISE_ONE:.75,SELF:.65},archetypeActive:["ANIMA","TRICKSTER","CHILD","HERO","WISE_ONE"],quantaCount:650},{id:"mindfulness",name:" Mindfulness",description:"Ateno plena ao momento presente: observar sem julgar, sem reter nem empurrar.",observe:"Movimento muito lento e uniforme. Todos os arqutipos ativos mas em baixa intensidade. Quanta distribudos. Sem aglomerao em nenhuma regio.",tags:["mindfulness","ateno","presente","meditao","equanimidade"],config:{danceIntensity:.06,maxSpeed:.05,breathPeriod:35,selfPull:.35,damping:6.5,linkRadius:.08,linkProbability:.005,linkMaxTtl:5,frozenFlow:!0,stateRelaxRate:.2},archetypeStrengths:{SELF:.6,WISE_ONE:.55,MOTHER:.5,HERO:.4,SHADOW:.4,CHILD:.45,ANIMA:.5},archetypeActive:["SELF","WISE_ONE","MOTHER","CHILD"],quantaCount:550},{id:"estado-hipnotico",name:" Estado Hipntico",description:"Transe hipntico: ateno estreitada, sugestionabilidade alta, WISE_ONE como voz interna amplificada.",observe:"Quanta convergem para um foco estreito. Movimentos quase que paralelos. Vnculos se formam rapidamente numa direo nica.",tags:["hipnose","transe","foco","ateno","sugestionabilidade"],config:{danceIntensity:.07,maxSpeed:.06,breathPeriod:20,selfPull:.55,damping:5.5,linkRadius:.07,linkProbability:.012,linkMaxTtl:8,linkValDiff:.12,frozenFlow:!0,stateRelaxRate:.35},archetypeStrengths:{WISE_ONE:1,SELF:.8,ANIMA:.7,PERSONA:.6,SHADOW:.2},archetypeActive:["WISE_ONE","SELF","ANIMA"],quantaCount:500},{id:"meditacao-theta",name:" Meditao Theta",description:"Ondas theta (48 Hz): limiar entre viglia e sono. Vises hipnaggicas. O mais profundo repouso consciente possvel.",observe:"Movimento quase imperceptvel. Vnculos duradouros e luminosos. Quanta em rbitas quase circulares. O mandala se autocompleta.",tags:["meditao","theta","repouso","viso","silncio"],config:{danceIntensity:.03,maxSpeed:.03,breathPeriod:70,selfPull:.85,damping:11,linkRadius:.12,linkProbability:.015,linkMaxTtl:15,spawnRate:.2,deathAge:500,frozenFlow:!0,stateRelaxRate:.15,archetypesOn:!0},archetypeStrengths:{SELF:1,WISE_ONE:.9,MOTHER:.8,ANIMA:.75},archetypeActive:["SELF","WISE_ONE","MOTHER"],quantaCount:450},{id:"infancia-primordial",name:" Infncia",description:"A psique infantil: CHILD domina, sem represso, sem Persona formada. Cada coisa  descoberta pela primeira vez.",observe:"Quanta exploram todas as regies sem medo. Alta renovao (vida curta, renascimento rpido). Vnculos simples e efmeros. Valncia positiva dominante.",tags:["ciclo de vida","infncia","CHILD","descoberta","inocncia"],config:{danceIntensity:.18,maxSpeed:.16,breathPeriod:10,selfPull:.12,damping:2.5,linkRadius:.08,linkMaxTtl:1.5,spawnRate:8,deathAge:20},archetypeStrengths:{CHILD:1,MOTHER:.85,LOVER:.6,TRICKSTER:.7,SELF:.3},archetypeActive:["CHILD","MOTHER","TRICKSTER","LOVER"],quantaCount:700},{id:"velhice-integrada",name:" Velhice Integrada",description:"A senectude jungiana: WISE_ONE acumula, CHILD persiste, HERO descansa. A morte como integrao, no derrota.",observe:"Movimento muito lento. Quanta com longa vida, profundamente enraizados em suas regies. Poucos novos quanta. Coerncia acumulada visvel.",tags:["ciclo de vida","velhice","WISE_ONE","integrao","sabedoria"],config:{danceIntensity:.05,maxSpeed:.04,breathPeriod:60,selfPull:.5,damping:7.5,linkRadius:.09,linkProbability:.006,linkMaxTtl:10,spawnRate:.3,deathAge:450,frozenFlow:!0,stateRelaxRate:.2},archetypeStrengths:{WISE_ONE:1,SELF:.85,MOTHER:.8,CHILD:.65,HERO:.5,ANIMA:.7},archetypeActive:["WISE_ONE","SELF","MOTHER","CHILD"],quantaCount:500},{id:"amor-eros",name:" Amor  Eros",description:"O amor ertico em seu auge: LOVER e ANIMA/ANIMUS em plena circulao. Eros como fora de ligao do mundo.",observe:"Quanta circulam entre EGO e Coletivo em correntes suaves. Vnculos densos e luminosos. Valncia muito positiva. SELF como fundo de sustentao.",tags:["amor","Eros","LOVER","ANIMA","vnculo"],config:{danceIntensity:.13,maxSpeed:.11,breathPeriod:14,selfPull:.28,damping:4,linkRadius:.11,linkProbability:.012,linkMaxTtl:5},archetypeStrengths:{LOVER:1,ANIMA:.9,CHILD:.75,MOTHER:.8,SELF:.65,HERO:.6},archetypeActive:["LOVER","ANIMA","CHILD","MOTHER","SELF"],quantaCount:650},{id:"desamor",name:" Desamor",description:"O fim do amor: ANIMA retirada, projees desfeitas. O vazio entre quem voc era e quem ficou.",observe:"LOVER e ANIMA enfraquecem, SHADOW cresce. Quanta que antes circulavam juntos divergem. Vnculos longos se rompem gradualmente.",tags:["desamor","perda","ANIMA","SHADOW","separao"],config:{danceIntensity:.14,maxSpeed:.11,breathPeriod:22,selfPull:.14,damping:3.5,linkRadius:.07,linkMaxTtl:1.8,linkValDiff:.3},archetypeStrengths:{SHADOW:.85,DESTROYER:.7,CHILD:.8,ANIMA:.3,SELF:.35,LOVER:.2},archetypeActive:["SHADOW","DESTROYER","CHILD","ANIMA","SELF"],quantaCount:600},{id:"amor-materno",name:" Amor Materno",description:"MOTHER como arqutipo central: proteo, nutrio, incondicionalidade. O Self nutrindo o mundo.",observe:"Quanta orbitam a MOTHER em espirais protetoras. CHILD permanece prximo. Alta densidade de vnculos na regio Coletivo. Calor e sustentao.",tags:["MOTHER","amor","nutrio","proteo","arqutipo"],config:{danceIntensity:.09,maxSpeed:.07,breathPeriod:28,selfPull:.42,damping:5,linkRadius:.12,linkProbability:.013,linkMaxTtl:7,frozenFlow:!0,stateRelaxRate:.4},archetypeStrengths:{MOTHER:1,CHILD:.9,SELF:.75,LOVER:.7,ANIMA:.65,WISE_ONE:.6},archetypeActive:["MOTHER","CHILD","SELF","LOVER"],quantaCount:600},{id:"insight-subito",name:" Insight Sbito",description:'O momento "Eureka": ordem brota do caos em flash. TRICKSTER encontra WISE_ONE no mesmo instante.',observe:"Quanta em movimento variado se reorganizam subitamente em torno do SELF. Vnculos improvveis se formam. O campo parece respirar fundo.",tags:["insight","criatividade","eureka","TRICKSTER","WISE_ONE"],config:{danceIntensity:.22,maxSpeed:.18,breathPeriod:12,selfPull:.35,damping:2.8,linkRadius:.14,linkProbability:.008,linkMaxTtl:3.5,linkValDiff:.55},archetypeStrengths:{TRICKSTER:.95,WISE_ONE:.9,SELF:.8,CHILD:.75,ANIMA:.7},archetypeActive:["TRICKSTER","WISE_ONE","SELF","CHILD","ANIMA"],quantaCount:650},{id:"incubacao-criativa",name:" Incubao Criativa",description:"A fase silenciosa da criatividade: a ideia ainda no nasceu, mas est se formando no escuro.",observe:"Aparentemente quieto. Quanta se movem muito devagar, tecendo vnculos sub-visveis. TRICKSTER e ANIMA trabalham em silncio. Espere.",tags:["criatividade","incubao","silncio","processo","gestation"],config:{danceIntensity:.06,maxSpeed:.05,breathPeriod:42,selfPull:.22,damping:6,linkRadius:.1,linkProbability:.006,linkMaxTtl:6.5,frozenFlow:!0,stateRelaxRate:.3},archetypeStrengths:{TRICKSTER:.7,ANIMA:.8,CHILD:.75,WISE_ONE:.65,SHADOW:.5,SELF:.55},archetypeActive:["TRICKSTER","ANIMA","CHILD","WISE_ONE","SHADOW"],quantaCount:550},{id:"psicose-limiar",name:" Limiar da Psicose",description:"O limite antes do colapso total: o ego ainda existe mas est sendo arrastado. DESTROYER e SHADOW dominam sem oposio.",observe:"Movimento turbulento com ilhas momentneas de ordem que se desfazem. Quanta cruzam fronteiras regionais aleatoriamente. Tenso extrema.",tags:["clnica","psicose","limiar","DESTROYER","colapso"],config:{danceIntensity:.35,maxSpeed:.3,breathPeriod:4,selfPull:.02,damping:1.5,linkMaxTtl:.3,linkRadius:.06,spawnRate:7,deathAge:15},archetypeStrengths:{DESTROYER:1,SHADOW:.9,TRICKSTER:.75,CHILD:.7,SELF:.05,HERO:.2},archetypeActive:["DESTROYER","SHADOW","TRICKSTER","CHILD"],quantaCount:950},{id:"sabedoria-trickster",name:" Sabedoria do Trickster",description:"O Trickster maduro: no mais puro caos, mas o caos que serve  transformao. A sabedoria que s vem pela disrupo.",observe:"Padres se formam e se desfazem ciclicamente. TRICKSTER e WISE_ONE alternando influncia. Caos com ritmo reconhecvel.",tags:["Trickster","sabedoria","transformao","ciclo","paradoxo"],config:{danceIntensity:.2,maxSpeed:.16,breathPeriod:11,selfPull:.25,damping:2.5,linkRadius:.08,linkMaxTtl:2.5,linkProbability:.007},archetypeStrengths:{TRICKSTER:.95,WISE_ONE:.85,SHADOW:.7,SELF:.75,CHILD:.65,DESTROYER:.55},archetypeActive:["TRICKSTER","WISE_ONE","SHADOW","SELF","CHILD"],quantaCount:700},{id:"complexo-paterno",name:" Complexo Paterno",description:"A sombra do FATHER: lei, limite, julgamento. Pode ser libertador ou aprisionante. Hero tenta escapar, Persona obedece.",observe:"FATHER domina o Superego com fora. HERO e PERSONA orbitam tensamente. CHILD recuado. SHADOW cresce nos limites.",tags:["complexo","FATHER","lei","autoridade","clnica"],config:{danceIntensity:.17,maxSpeed:.14,breathPeriod:14,selfPull:.1,damping:3.5,linkRadius:.07,linkValDiff:.18,linkMaxTtl:2.5},archetypeStrengths:{FATHER:1,PERSONA:.85,HERO:.75,SHADOW:.7,CHILD:.4,SELF:.25},archetypeActive:["FATHER","PERSONA","HERO","SHADOW","CHILD"],quantaCount:650}];function wG(e){return gy.find(t=>t.id===e)}const Hj="t4p_r1_flags",jb={R1_MORIN_ENGINE:!1,R1_OBSERVER:!1,R1_ARCHETYPES_AS_OPERATORS:!1,R1_ALCHEMICAL_PHASES:!1,R1_LENS_SYSTEM:!1,R1_ANTI_ILLUSION:!1};function MG(){try{const e=typeof window<"u"?localStorage.getItem(Hj):null;if(!e)return{...jb};const t=JSON.parse(e);return{...jb,...t}}catch{return{...jb}}}function CG(e){try{typeof window<"u"&&localStorage.setItem(Hj,JSON.stringify(e))}catch{}}let N5=MG();function Fv(){return{...N5}}function kG(e,t){N5={...N5,[e]:t},CG(N5)}const Zi=(e,t,n)=>{},el=e=>({...e}),Wj={SELF:{id:"SELF",name:"Self",attraction_bias:.2,repulsion_bias:-.1,description:"Central integration; attracts coherence.",transformation_rule:Zi,perception_filter:el},PERSONA:{id:"PERSONA",name:"Persona",attraction_bias:.3,repulsion_bias:0,description:"Social mask; amplifies outward signal.",transformation_rule:Zi,perception_filter:el},SHADOW:{id:"SHADOW",name:"Shadow",attraction_bias:-.2,repulsion_bias:.3,description:"Repressed; repels and scatters.",transformation_rule:Zi,perception_filter:el},ANIMA:{id:"ANIMA",name:"Anima",attraction_bias:.15,repulsion_bias:-.05,description:"Inner other; soft attraction.",transformation_rule:Zi,perception_filter:el},TRICKSTER:{id:"TRICKSTER",name:"Trickster",attraction_bias:0,repulsion_bias:.1,description:"Chaos agent; inverts norms.",transformation_rule:Zi,perception_filter:el},HERO:{id:"HERO",name:"Hero",attraction_bias:.25,repulsion_bias:-.15,description:"Goal-directed; strong attraction to goal.",transformation_rule:Zi,perception_filter:el},MOTHER:{id:"MOTHER",name:"Mother",attraction_bias:.4,repulsion_bias:-.2,description:"Nurturance; high attraction.",transformation_rule:Zi,perception_filter:el},FATHER:{id:"FATHER",name:"Father",attraction_bias:.2,repulsion_bias:.05,description:"Order; moderate structure.",transformation_rule:Zi,perception_filter:el},WISE_ONE:{id:"WISE_ONE",name:"Wise One",attraction_bias:.1,repulsion_bias:0,description:"Stability; neutral bias.",transformation_rule:Zi,perception_filter:el},CHILD:{id:"CHILD",name:"Child",attraction_bias:.35,repulsion_bias:-.1,description:"Novelty; curious pull.",transformation_rule:Zi,perception_filter:el},LOVER:{id:"LOVER",name:"Lover",attraction_bias:.5,repulsion_bias:-.25,description:"Union; strong attraction.",transformation_rule:Zi,perception_filter:el},DESTROYER:{id:"DESTROYER",name:"Destroyer",attraction_bias:-.3,repulsion_bias:.4,description:"Dissolution; repulsion dominant.",transformation_rule:Zi,perception_filter:el}};function RG(e){const t=Wj[e];return t?{...t,transformation_rule:t.transformation_rule??Zi,perception_filter:t.perception_filter??el}:null}function AG(){return Object.keys(Wj)}const _v="'Doto', monospace",vr="'IBM Plex Mono', monospace",ma="#8b5cf6",jG={CALM:{label:"CALMO",desc:"Equilbrio dinmico",color:"#93c5fd"},ALERT:{label:"ALERTA",desc:"Tenso crescente",color:"#fde047"},PANIC:{label:"COLAPSO",desc:"Ruptura catica",color:"#f87171"},FLOW:{label:"FLUXO",desc:"Coerncia elevada  Self ativo",color:"#86efac"},FRAGMENTED:{label:"FRAGMENTADO",desc:"Dissociao ativa",color:"#fdba74"},INTEGRATING:{label:"INTEGRANDO",desc:"Sntese emergente",color:"#c4b5fd"}},EG={CALM:"Princpio de Prazer estvel  Eros domina",ALERT:"Conflito pulsional  Id vs Superego",PANIC:"Retorno do Reprimido  defesas rompidas",FLOW:"Sublimao ativa  Eros liberto",FRAGMENTED:"Angstia de fragmentao  Ego frgil",INTEGRATING:"Elaborao psquica  Trabalho de luto"},TG={CALM:"Ordem simblica estvel  Lei do Pai operativa",ALERT:"Tenso RSI  borda entre registros",PANIC:"Irrupo do Real  inassimilvel",FLOW:"Gozo modulado  circulao entre registros",FRAGMENTED:"Sujeito dividido ($) em crise",INTEGRATING:"Travessia da fantasia  reorganizao do $"},Kg=[{id:"TOPOLOGY",label:"Topologia",color:"#c4b5fd"},{id:"ENERGY",label:"Energia",color:"#fca5a5"},{id:"VALENCE",label:"Valncia",color:"#86efac"},{id:"COHERENCE",label:"Coerncia",color:"#93c5fd"},{id:"ARCHETYPES",label:"Arqutipos",color:"#fde047"},{id:"EVENTS",label:"Eventos",color:"#67e8f9"},{id:"LACAN",label:" Lacan  RSI",color:"#e0a0ff",group:"teoria"},{id:"FREUD",label:" Freud  Id/Ego",color:"#f4a460",group:"teoria"}],IG=[{sigil:"",name:"SELF",color:"#f5c842",desc:"Centro integrador"},{sigil:"",name:"EGO",color:"#3b82f6",desc:"Conscincia diurna"},{sigil:"",name:"PERSONA",color:"#b0c4de",desc:"Mscara social"},{sigil:"",name:"SOMBRA",color:"#7c3aed",desc:"Contedo reprimido"},{sigil:"",name:"ID",color:"#ef4444",desc:"Pulses primais"},{sigil:"",name:"SUPEREGO",color:"#9ca3af",desc:"Lei interna"},{sigil:"",name:"COLETIVO",color:"#06b6d4",desc:"Inconsciente coletivo"}],PG=[{sigil:"",name:"Id",color:"#ef4444",desc:"Reservatrio pulsional"},{sigil:"",name:"Ego",color:"#3b82f6",desc:"Realidade  mediador"},{sigil:"",name:"Superego",color:"#9ca3af",desc:"Lei e ideal  censura"},{sigil:"",name:"Eros",color:"#f472b6",desc:"Pulso de Vida"},{sigil:"",name:"Thanatos",color:"#64748b",desc:"Pulso de Morte"}],FG=[{sigil:"",name:"Real",color:"#dc2626",desc:"O inassimilvel"},{sigil:"",name:"Simblico",color:"#3b82f6",desc:"Rede de significantes"},{sigil:"",name:"Imaginrio",color:"#f5c842",desc:"Identificaes do Ego"},{sigil:"S",name:"Sujeito $",color:"#a78bfa",desc:"Sujeito dividido"},{sigil:"a",name:"Objeto a",color:"#fb923c",desc:"Causa do desejo"}],_G=[300,600,900,1200],NG=[{hex:"#000000",label:"Preto"},{hex:"#0a0a0a",label:"Quase preto"},{hex:"#0d0d1a",label:"ndigo escuro"},{hex:"#0a0f0a",label:"Verde escuro"},{hex:"#1a1a1a",label:"Cinza escuro"},{hex:"#f5f5f0",label:"Quase branco"},{hex:"#ffffff",label:"Branco"}],Ii={background:"rgba(0,0,0,0.94)",border:"1px dashed rgba(255,255,255,0.06)",overflow:"hidden"},OG=(e="rgba(255,255,255,0.22)")=>({background:"none",border:"none",cursor:"pointer",width:"100%",padding:"8px 12px",display:"flex",alignItems:"center",justifyContent:"space-between",fontFamily:_v,fontSize:10,color:e,letterSpacing:"0.08em",textTransform:"uppercase",transition:"background 0.15s"}),Fi={fontFamily:vr,fontSize:8,color:"rgba(255,255,255,0.35)",letterSpacing:"0.06em",textTransform:"uppercase"},Eb={fontFamily:vr,fontSize:8,color:"rgba(255,255,255,0.22)"},DG=e=>{var E,O,L,$;const[t,n]=S.useState(!1),[r,a]=S.useState(!1),[i,s]=S.useState(!1),[c,l]=S.useState(!1),[d,u]=S.useState(!1),[h,m]=S.useState(!1),f=Fv().R1_ARCHETYPES_AS_OPERATORS,g=gy.find(F=>F.id===e.presetId),x=e.presetId==="red-book-journey",v=!!((E=g==null?void 0:g.config)!=null&&E.frozenFlow),b=jG[e.phase],w=e.lens==="FREUD",M=e.lens==="LACAN",k=w||M,R=w?EG[e.phase]:M?TG[e.phase]:b.desc,j=w?"estado libidinal":M?"posio subjetiva":"estado psquico",I=w?"#f4a460":M?"#e0a0ff":b.color;return o.jsxs("div",{style:{position:"fixed",inset:0,pointerEvents:"none",zIndex:20,userSelect:"none"},children:[v&&o.jsxs("div",{style:{position:"absolute",top:10,left:"50%",transform:"translateX(-50%)",zIndex:30,...Ii,padding:"4px 14px",display:"flex",alignItems:"center",gap:6,borderColor:"rgba(120,240,160,0.20)"},children:[o.jsx("span",{style:{color:"rgba(100,230,140,0.70)",fontSize:8},children:""}),o.jsx("span",{style:{...Fi,color:"rgba(100,230,140,0.60)"},children:"campo estvel"}),o.jsx("span",{style:{...Eb,color:"rgba(100,230,140,0.30)"},children:"frozenFlow"})]}),o.jsx("div",{style:{position:"absolute",left:10,top:50,bottom:10,width:172,pointerEvents:"auto",overflowY:"auto",overflowX:"hidden",scrollbarWidth:"thin",scrollbarColor:`${ma}40 transparent`},children:o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6,paddingBottom:8},children:[o.jsxs("div",{style:{...Ii,padding:"6px 8px",display:"flex",alignItems:"center",gap:5},children:[o.jsx("button",{onClick:e.onToggleRun,style:{flex:1,padding:"4px 0",fontFamily:vr,fontSize:9,background:"none",cursor:"pointer",border:`1px dashed ${e.running?"rgba(255,255,255,0.10)":`${ma}40`}`,color:e.running?"rgba(255,255,255,0.40)":`${ma}cc`,letterSpacing:"0.06em",textTransform:"uppercase"},children:e.running?" Pausar":" Iniciar"}),o.jsx("button",{onClick:e.onReset,title:"Reiniciar",style:{background:"none",border:"none",cursor:"pointer",color:"rgba(255,255,255,0.25)",fontSize:13,padding:"0 4px"},children:""}),o.jsx("button",{onClick:e.onCinematicToggle,style:{background:"none",border:"none",cursor:"pointer",color:e.cinematicMode?ma:"rgba(255,255,255,0.20)",fontSize:10,padding:"0 2px"},children:e.cinematicMode?"":""})]}),o.jsxs("div",{style:{...Ii,borderColor:(k?I:b.color)+"18",padding:"10px 12px"},children:[o.jsx("div",{style:{...Fi,color:(k?I:b.color)+"80",marginBottom:4},children:j}),o.jsx("div",{style:{fontFamily:_v,fontSize:13,letterSpacing:"0.1em",color:k?I:b.color,marginBottom:3},children:b.label}),o.jsx("div",{style:{fontFamily:vr,fontSize:7,lineHeight:1.5,color:(k?I:b.color)+"70"},children:R})]}),w&&e.freudMetrics?o.jsxs("div",{style:{...Ii,borderColor:"#f4a46018",padding:"10px 12px"},children:[o.jsx("div",{style:{...Fi,color:"#f4a46050",marginBottom:8},children:"ndices Freudianos"}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[o.jsx(bc,{label:"Eros",sublabel:"pulso de vida",value:e.freudMetrics.eros,color:"#f472b6"}),o.jsx(bc,{label:"Thanatos",sublabel:"pulso de morte",value:e.freudMetrics.thanatos,color:"#64748b"}),o.jsx(bc,{label:"Represso",sublabel:"bloqueio do Ego",value:e.freudMetrics.repressao,color:"#f4a460"}),o.jsx(bc,{label:"Sublimao",sublabel:"energia transformada",value:e.freudMetrics.sublimacao,color:"#86efac"})]})]}):M&&e.lacanMetrics?o.jsxs("div",{style:{...Ii,borderColor:"#e0a0ff18",padding:"10px 12px"},children:[o.jsx("div",{style:{...Fi,color:"#e0a0ff50",marginBottom:8},children:"Registros RSI"}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[o.jsx(bc,{label:"Real",sublabel:"o inassimilvel",value:e.lacanMetrics.real,color:"#dc2626"}),o.jsx(bc,{label:"Simblico",sublabel:"rede de significantes",value:e.lacanMetrics.simbolico,color:"#3b82f6"}),o.jsx(bc,{label:"Imaginrio",sublabel:"identificao especular",value:e.lacanMetrics.imaginario,color:"#f5c842"})]})]}):o.jsxs("div",{style:{...Ii,padding:"10px 12px"},children:[o.jsx("div",{style:{...Fi,marginBottom:8},children:"ndices"}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[o.jsx(bc,{label:"Integrao",sublabel:"coeso psquica",value:e.integrationIndex,color:"#f5c842"}),o.jsx(bc,{label:"Tenso",sublabel:"conflito de foras",value:e.tensionIndex,color:"#f87171"}),o.jsx(bc,{label:"Fragmentao",sublabel:"dissociao",value:Math.min(1,e.fragmentIndex),color:"#fb923c"})]})]}),o.jsxs("div",{style:{...Ii,padding:"10px 12px"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:6},children:[o.jsx("span",{style:Fi,children:"Velocidade"}),o.jsxs("span",{style:Eb,children:[Math.round(e.danceIntensity*100),"%"]})]}),o.jsx("input",{type:"range",min:.04,max:.8,step:.01,value:e.danceIntensity,onChange:F=>e.onDanceChange(parseFloat(F.target.value)),style:{width:"100%",height:2,accentColor:ma,cursor:"pointer"}}),o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:3},children:[o.jsx("span",{style:{fontFamily:vr,fontSize:7,color:"rgba(255,255,255,0.15)"},children:"Contemplativo"}),o.jsx("span",{style:{fontFamily:vr,fontSize:7,color:"rgba(255,255,255,0.15)"},children:"Intenso"})]})]}),o.jsx(Pc,{title:"Parmetros",open:c,onToggle:()=>l(F=>!F),children:o.jsxs("div",{style:{padding:"8px 12px",display:"flex",flexDirection:"column",gap:8},children:[o.jsx(Gl,{label:"Dana",hint:"intensidade do flow field",value:e.flowGain,min:.05,max:.8,step:.05,display:F=>`${Math.round(F*100)}%`,color:"#c4b5fd",onChange:e.onFlowGainChange}),o.jsx(Gl,{label:"Molas",hint:"rigidez dos vnculos",value:e.springK,min:.1,max:2,step:.05,display:F=>F.toFixed(2),color:"#86efac",onChange:e.onSpringKChange}),o.jsx(Gl,{label:"Alcance",hint:"raio de conexo",value:e.linkRadius,min:.04,max:.18,step:.005,display:F=>F.toFixed(3),color:"#67e8f9",onChange:e.onLinkRadiusChange}),o.jsx(Gl,{label:"Respirao",hint:"ciclo em segundos",value:e.breathPeriod,min:6,max:60,step:1,display:F=>`${Math.round(F)}s`,color:"#fca5a5",onChange:e.onBreathPeriodChange})]})}),o.jsxs("div",{style:Ii,children:[o.jsxs("div",{style:{padding:"8px 12px",borderBottom:"1px dashed rgba(255,255,255,0.04)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[o.jsx("span",{style:{fontFamily:_v,fontSize:10,color:"rgba(255,255,255,0.22)",letterSpacing:"0.08em",textTransform:"uppercase"},children:"Fsica Psquica"}),o.jsx("button",{onClick:e.onFrozenFlowToggle,style:{padding:"2px 8px",fontFamily:vr,fontSize:7,background:e.frozenFlow?"rgba(100,230,140,0.08)":"none",border:`1px dashed ${e.frozenFlow?"rgba(100,230,140,0.30)":"rgba(255,255,255,0.08)"}`,color:e.frozenFlow?"rgba(100,230,140,0.75)":"rgba(255,255,255,0.25)",cursor:"pointer",letterSpacing:"0.08em",textTransform:"uppercase"},children:e.frozenFlow?" fixo":" livre"})]}),o.jsxs("div",{style:{padding:"8px 12px",display:"flex",flexDirection:"column",gap:10},children:[o.jsx(Gl,{label:"Inrcia",hint:"resistncia  mudana",value:e.damping,min:.3,max:20,step:.1,display:F=>F.toFixed(1),color:"#fbbf24",onChange:e.onDampingChange}),o.jsx(Gl,{label:"Memria",hint:"velocidade de mudana interna",value:e.stateRelaxRate,min:.05,max:3,step:.05,display:F=>`${F.toFixed(2)}`,color:"#67e8f9",onChange:e.onStateRelaxChange})]})]}),o.jsxs("div",{style:{...Ii,padding:"10px 12px"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[o.jsx("span",{style:Fi,children:"Alma"}),o.jsxs("span",{style:Eb,children:[Math.round(e.soulVis*100),"%"]})]}),o.jsx("div",{style:{fontFamily:vr,fontSize:7,color:"rgba(255,255,255,0.15)",marginBottom:5,lineHeight:1.5},children:"identidade individual de cada quantum"}),o.jsx("input",{type:"range",min:0,max:1,step:.02,value:e.soulVis,onChange:F=>e.onSoulVisChange(parseFloat(F.target.value)),style:{width:"100%",height:2,accentColor:ma,cursor:"pointer"}})]}),o.jsx(Pc,{title:"Lente",open:i,onToggle:()=>s(F=>!F),accent:((O=Kg.find(F=>F.id===e.lens))==null?void 0:O.color)??ma,extra:o.jsx("span",{style:{fontFamily:vr,fontSize:8,color:((L=Kg.find(F=>F.id===e.lens))==null?void 0:L.color)??"#aaa"},children:($=Kg.find(F=>F.id===e.lens))==null?void 0:$.label}),children:o.jsx("div",{style:{padding:"4px 8px"},children:Kg.map(F=>o.jsxs("button",{onClick:()=>{e.onLensChange(F.id),s(!1)},style:{display:"block",width:"100%",textAlign:"left",padding:"5px 6px",background:e.lens===F.id?"rgba(255,255,255,0.04)":"none",border:"none",cursor:"pointer",borderLeft:`2px solid ${e.lens===F.id?F.color+"60":"transparent"}`,fontFamily:vr,fontSize:9,color:e.lens===F.id?F.color:"rgba(255,255,255,0.30)",transition:"all 0.1s"},children:[F.group==="teoria"&&o.jsx("div",{style:{fontSize:6,color:"rgba(255,255,255,0.15)",letterSpacing:"0.1em",textTransform:"uppercase",marginBottom:2},children:F.group}),F.label]},F.id))})}),o.jsxs("div",{style:{...Ii,padding:"8px 12px",display:"flex",flexDirection:"column",gap:6},children:[o.jsx(xc,{label:"Mapa",on:e.overlayOn,onToggle:e.onOverlayToggle,color:"#c4b5fd"}),e.overlayOn&&e.onOverlayJungToggle&&e.onOverlayLacanToggle&&e.onOverlayFreudToggle&&o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4,paddingLeft:8,borderLeft:"1px dashed rgba(255,255,255,0.08)"},children:[o.jsx("span",{style:{fontFamily:vr,fontSize:7,color:"rgba(255,255,255,0.35)",letterSpacing:"0.08em",textTransform:"uppercase"},children:"Teorias (topologia)"}),o.jsx(xc,{label:"Jung (regies)",on:e.overlayJung??!0,onToggle:e.onOverlayJungToggle,color:"#f5c842"}),o.jsx(xc,{label:"Lacan (RSI)",on:e.overlayLacan??!1,onToggle:e.onOverlayLacanToggle,color:"#e0a0ff"}),o.jsx(xc,{label:"Freud (Id/Ego)",on:e.overlayFreud??!1,onToggle:e.onOverlayFreudToggle,color:"#f4a460"})]}),o.jsx(xc,{label:"Campo",on:e.campoOn,onToggle:e.onCampoToggle,color:"#06b6d4"}),o.jsx(xc,{label:"Vetores",on:e.fieldOn,onToggle:e.onFieldToggle,color:"#a3e635"}),o.jsx(xc,{label:"Rastros",on:e.trailOn,onToggle:e.onTrailToggle,color:"#a78bfa"}),o.jsx(xc,{label:"Bonds",on:e.bondsOn,onToggle:e.onBondsToggle,color:"#67e8f9"}),o.jsx(xc,{label:"Arqutipos",on:e.archetypesOn,onToggle:e.onArchetypesToggle,color:"#fde047"}),x&&o.jsx(xc,{label:"Jornada",on:e.journeyOn,onToggle:e.onJourneyToggle,color:"#c4b5fd"}),e.bondsOn&&o.jsxs("div",{style:{paddingTop:6,borderTop:"1px dashed rgba(255,255,255,0.04)",display:"flex",flexDirection:"column",gap:6},children:[o.jsx(Gl,{label:"Espessura",hint:"bonds",value:e.bondWidth,min:.3,max:4,step:.1,display:F=>F.toFixed(1),color:"#67e8f9",onChange:e.onBondWidthChange}),o.jsx(Gl,{label:"Opac. bonds",hint:"",value:e.bondOpacity,min:.05,max:1,step:.05,display:F=>`${Math.round(F*100)}%`,color:"#67e8f9",onChange:e.onBondOpacityChange})]}),e.trailOn&&o.jsxs("div",{style:{paddingTop:6,borderTop:"1px dashed rgba(255,255,255,0.04)",display:"flex",flexDirection:"column",gap:6},children:[o.jsx(Gl,{label:"Memria",hint:"rastros",value:e.trailFade,min:.01,max:.2,step:.005,display:F=>F.toFixed(3),color:"#a78bfa",onChange:e.onTrailFadeChange}),o.jsx(Gl,{label:"Opac. rastro",hint:"",value:e.trailOpacity,min:.1,max:1,step:.05,display:F=>`${Math.round(F*100)}%`,color:"#a78bfa",onChange:e.onTrailOpacityChange}),o.jsx(Gl,{label:"Cauda",hint:"",value:e.trailWidth,min:1,max:8,step:.5,display:F=>F.toFixed(1),color:"#a78bfa",onChange:e.onTrailWidthChange})]})]}),o.jsxs("div",{style:{...Ii,padding:"8px 12px"},children:[o.jsx("div",{style:{...Fi,marginBottom:6},children:"Partculas"}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:4},children:_G.map(F=>o.jsx("button",{onClick:()=>e.onQuantaChange(F),style:{padding:"3px 0",fontFamily:vr,fontSize:8,background:e.quantaCount===F?`${ma}10`:"none",border:`1px dashed ${e.quantaCount===F?`${ma}40`:"rgba(255,255,255,0.06)"}`,color:e.quantaCount===F?`${ma}cc`:"rgba(255,255,255,0.22)",cursor:"pointer",transition:"all 0.15s"},children:F>=1e3?`${F/1e3}k`:F},F))})]}),o.jsxs("div",{style:{...Ii,padding:"8px 12px"},children:[o.jsx("div",{style:{...Fi,marginBottom:6},children:"Fundo"}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[o.jsxs("div",{style:{position:"relative",flexShrink:0},children:[o.jsx("div",{style:{width:20,height:20,border:"1px dashed rgba(255,255,255,0.12)",background:e.bgColor,cursor:"pointer"}}),o.jsx("input",{type:"color",value:e.bgColor,onChange:F=>e.onBgColorChange(F.target.value),style:{position:"absolute",inset:0,opacity:0,cursor:"pointer",width:"100%",height:"100%"}})]}),o.jsx("span",{style:{fontFamily:vr,fontSize:8,color:"rgba(255,255,255,0.30)"},children:e.bgColor})]}),o.jsx("div",{style:{display:"flex",gap:4,marginTop:6,flexWrap:"wrap"},children:NG.map(F=>o.jsx("button",{onClick:()=>e.onBgColorChange(F.hex),title:F.label,style:{width:18,height:18,cursor:"pointer",background:F.hex,border:`1px dashed ${e.bgColor===F.hex?`${ma}55`:"rgba(255,255,255,0.08)"}`,transition:"border-color 0.15s"}},F.hex))})]})]})}),o.jsx("div",{style:{position:"absolute",right:10,top:50,bottom:10,width:208,pointerEvents:"auto",overflowY:"auto",overflowX:"hidden",scrollbarWidth:"thin",scrollbarColor:`${ma}40 transparent`},children:o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6,paddingBottom:8},children:[o.jsx("button",{onClick:e.onOpenConsciousness,style:{width:"100%",padding:"10px 0",background:`${ma}06`,border:`1px dashed ${ma}25`,color:`${ma}90`,fontFamily:vr,fontSize:9,letterSpacing:"0.12em",textTransform:"uppercase",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:6,transition:"all 0.15s"},children:" Nova Conscincia"}),o.jsx(Pc,{title:"Preset",open:r,onToggle:()=>a(F=>!F),accent:`${ma}80`,extra:o.jsx("span",{style:{fontFamily:vr,fontSize:8,color:`${ma}60`},children:(g==null?void 0:g.name)??""}),children:o.jsx("div",{style:{maxHeight:240,overflowY:"auto"},children:gy.map(F=>o.jsxs("button",{onClick:()=>{e.onPresetChange(F.id),a(!1)},style:{display:"block",width:"100%",textAlign:"left",padding:"8px 12px",background:"none",cursor:"pointer",borderLeft:`2px solid ${e.presetId===F.id?`${ma}60`:"transparent"}`,borderTop:"none",borderRight:"none",borderBottom:"1px dashed rgba(255,255,255,0.03)",transition:"all 0.1s"},children:[o.jsx("div",{style:{fontFamily:vr,fontSize:9,color:e.presetId===F.id?`${ma}cc`:"rgba(255,255,255,0.45)",marginBottom:2},children:F.name}),o.jsx("div",{style:{fontFamily:vr,fontSize:7,color:"rgba(255,255,255,0.18)",lineHeight:1.4},children:F.observe})]},F.id))})}),o.jsx(Pc,{title:"Crnica",open:d,onToggle:()=>u(F=>!F),extra:e.narrativeLog.length>0?o.jsx("span",{style:{fontFamily:vr,fontSize:7,color:`${ma}50`},children:e.narrativeLog.length}):void 0,children:o.jsx("div",{style:{maxHeight:200,overflowY:"auto"},children:e.narrativeLog.length===0?o.jsx("p",{style:{padding:"10px 12px",fontFamily:vr,fontSize:8,color:"rgba(255,255,255,0.15)",fontStyle:"italic"},children:"Nenhum evento ainda."}):[...e.narrativeLog].reverse().map((F,B)=>o.jsxs("div",{style:{display:"flex",gap:8,padding:"5px 12px",borderBottom:"1px dashed rgba(255,255,255,0.03)"},children:[o.jsx("span",{style:{fontFamily:vr,fontSize:7,color:"rgba(255,255,255,0.18)",flexShrink:0,marginTop:1},children:LG(F.time)}),o.jsx("span",{style:{fontFamily:vr,fontSize:8,lineHeight:1.4,color:F.color+"bb"},children:F.text})]},B))})}),w?o.jsx($G,{metrics:e.freudMetrics,phase:e.phase}):M?o.jsx(qG,{metrics:e.lacanMetrics,phase:e.phase,integration:e.integrationIndex}):o.jsx(zG,{integration:e.integrationIndex,tension:e.tensionIndex,fragment:e.fragmentIndex,phase:e.phase}),w?o.jsx(Tb,{title:"Aparelho Psquico",camadas:PG,intro:"Cada quantum habita zonas do aparelho freudiano.",legenda:[["#ef4444","Id","pulso crua"],["#3b82f6","Ego","realidade"],["#9ca3af","Superego","lei"]]}):M?o.jsx(Tb,{title:"Topologia RSI",camadas:FG,intro:"Real, Simblico, Imaginrio  borromeanamente ligados.",legenda:[["#dc2626","Real","inassimilvel"],["#3b82f6","Simblico","lei/linguagem"],["#f5c842","Imaginrio","espelho"]]}):o.jsx(Tb,{title:"Mapa Psquico",camadas:IG,intro:"Cada quantum navega por regies que modulam seu estado.",legenda:[["#ef4444","Vermelho","alta energia"],["#3b82f6","Azul","coerncia"],["#86efac","Verde","valncia +"],["#7c3aed","Roxo","sombra"],["#f5c842","Dourado","Self"]]}),e.archetypesOn&&o.jsx(Pc,{title:"Arqutipos",open:t,onToggle:()=>n(F=>!F),children:o.jsx("div",{style:{padding:"4px 8px",maxHeight:280,overflowY:"auto"},children:Dc.map((F,B)=>o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"3px 0"},children:[o.jsx("button",{onClick:()=>e.onArchActiveToggle(B),style:{background:"none",border:"none",cursor:"pointer",fontSize:12,flexShrink:0,opacity:e.archetypeActive[B]?1:.2,transition:"opacity 0.2s"},children:F.sigil}),o.jsx("span",{style:{fontFamily:vr,fontSize:8,width:56,flexShrink:0,color:e.archetypeActive[B]?F.color:"rgba(255,255,255,0.15)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:F.id}),o.jsx("input",{type:"range",min:0,max:1,step:.05,value:e.archetypeStrengths[B],disabled:!e.archetypeActive[B],onChange:W=>e.onArchStrengthChange(B,parseFloat(W.target.value)),style:{flex:1,height:2,accentColor:F.color,cursor:"pointer",opacity:e.archetypeActive[B]?1:.15}})]},F.id))})}),f&&o.jsx(Pc,{title:"Operadores (R1)",open:h,onToggle:()=>m(F=>!F),accent:`${ma}88`,children:o.jsx("div",{style:{padding:"8px 12px",display:"flex",flexDirection:"column",gap:6},children:AG().map(F=>{const B=RG(F);return B?o.jsxs("div",{style:{fontFamily:vr,fontSize:8,color:"rgba(255,255,255,0.5)"},children:[o.jsx("span",{style:{color:ma},children:B.name}),o.jsxs("span",{style:{marginLeft:6,color:"rgba(255,255,255,0.25)"},children:["A:",B.attraction_bias.toFixed(2)," R:",B.repulsion_bias.toFixed(2)]})]},B.id):null})})}),e.journeyOn&&e.journeyChapter&&o.jsxs("div",{style:{...Ii,borderColor:`${ma}15`,padding:"10px 12px"},children:[o.jsxs("div",{style:{...Fi,color:`${ma}40`,marginBottom:5},children:["Ato ",e.journeyAct+1]}),o.jsx("p",{style:{fontFamily:vr,fontSize:9,color:"rgba(255,255,255,0.35)",fontStyle:"italic",lineHeight:1.6},children:e.journeyChapter})]})]})})]})};function Pc({title:e,open:t,onToggle:n,children:r,accent:a="rgba(255,255,255,0.22)",extra:i}){return o.jsxs("div",{style:Ii,children:[o.jsxs("button",{onClick:n,style:{...OG(a)},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5},children:[t?o.jsx(Ms,{size:9,style:{opacity:.35}}):o.jsx(hs,{size:9,style:{opacity:.35}}),e]}),i]}),t&&o.jsx("div",{style:{borderTop:"1px dashed rgba(255,255,255,0.04)"},children:r})]})}function bc({label:e,sublabel:t,value:n,color:r}){const a=Math.round(Math.max(0,Math.min(1,n))*100);return o.jsxs("div",{children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:3},children:[o.jsx("span",{style:{fontFamily:vr,fontSize:9,color:"rgba(255,255,255,0.50)"},children:e}),o.jsxs("span",{style:{fontFamily:vr,fontSize:8,color:r+"bb"},children:[a,"%"]})]}),o.jsx("div",{style:{height:3,background:"rgba(255,255,255,0.04)",overflow:"hidden"},children:o.jsx("div",{style:{height:"100%",width:`${Math.max(2,a)}%`,background:`linear-gradient(90deg, ${r}55, ${r}aa)`,transition:"width 0.7s"}})}),o.jsx("div",{style:{fontFamily:vr,fontSize:7,color:"rgba(255,255,255,0.15)",marginTop:2},children:t})]})}function Gl({label:e,hint:t,value:n,min:r,max:a,step:i,display:s,color:c,onChange:l}){return o.jsxs("div",{children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[o.jsx("span",{style:{fontFamily:vr,fontSize:9,color:c+"aa",letterSpacing:"0.04em",textTransform:"uppercase"},children:e}),o.jsx("span",{style:{fontFamily:vr,fontSize:8,color:"rgba(255,255,255,0.22)"},children:s(n)})]}),o.jsx("input",{type:"range",min:r,max:a,step:i,value:n,onChange:d=>l(parseFloat(d.target.value)),style:{width:"100%",height:2,accentColor:c,cursor:"pointer"}}),t&&o.jsx("div",{style:{fontFamily:vr,fontSize:7,color:"rgba(255,255,255,0.12)",marginTop:2},children:t})]})}function xc({label:e,on:t,onToggle:n,color:r}){return o.jsxs("button",{onClick:n,style:{display:"flex",alignItems:"center",gap:8,background:"none",border:"none",cursor:"pointer",width:"100%",padding:0,transition:"all 0.15s"},children:[o.jsx("span",{style:{fontFamily:vr,fontSize:10,color:t?r:"rgba(255,255,255,0.15)",transition:"color 0.2s"},children:t?"":""}),o.jsx("span",{style:{fontFamily:vr,fontSize:9,color:t?r+"cc":"rgba(255,255,255,0.22)",letterSpacing:"0.04em",textTransform:"uppercase",transition:"color 0.2s"},children:e})]})}function Li({label:e,value:t,color:n,desc:r}){const a=Math.round(Math.max(0,Math.min(1,t))*100);return o.jsxs("div",{children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:3},children:[o.jsx("span",{style:{fontFamily:vr,fontSize:9,color:"rgba(255,255,255,0.45)"},children:e}),o.jsxs("span",{style:{fontFamily:vr,fontSize:8,color:n+"aa"},children:[a,"%"]})]}),o.jsx("div",{style:{height:3,background:"rgba(255,255,255,0.04)",overflow:"hidden"},children:o.jsx("div",{style:{height:"100%",width:`${Math.max(2,a)}%`,background:`linear-gradient(90deg, ${n}44, ${n}99)`,transition:"width 0.7s"}})}),o.jsx("div",{style:{fontFamily:vr,fontSize:7,color:"rgba(255,255,255,0.12)",marginTop:2},children:r})]})}function LG(e){const t=Math.floor(e/60),n=Math.floor(e%60);return`${t}:${n.toString().padStart(2,"0")}`}const zG=({integration:e,tension:t,fragment:n,phase:r})=>{const[a,i]=S.useState(!0),s=Math.min(1,t*(1-e)*1.4),c=Math.min(1,e*(1-t)*(1-n)*1.6),l=Math.min(1,t*n*1.8),d=Math.max(-1,Math.min(1,e-n-t*.5)),u=Math.min(1,t>.65?(t-.65)*2.5:0),h=d>.1?"#86efac":d<-.1?"#f87171":"#94a3b8",m=d>.3?"Progresso ativa":d<-.2?"Regresso ativa":"Neutro";return o.jsx(Pc,{title:"Processo Psquico",open:a,onToggle:()=>i(f=>!f),children:o.jsxs("div",{style:{padding:"10px 12px",display:"flex",flexDirection:"column",gap:8},children:[o.jsx(Li,{label:"Compensao",value:s,color:"#fb923c",desc:"inconsciente compensando o consciente"}),o.jsx(Li,{label:"Numinosidade",value:c,color:"#f5c842",desc:"qualidade sagrada  Self ativo"}),o.jsx(Li,{label:"Complexo Ativo",value:l,color:"#c084fc",desc:"dissociao parcial em curso"}),u>.05&&o.jsx(Li,{label:"Enantiodromia",value:u,color:"#f43f5e",desc:"reverso iminente"}),o.jsxs("div",{children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:3},children:[o.jsx("span",{style:{fontFamily:vr,fontSize:8,color:h+"aa"},children:d>=0?"Progresso":"Regresso"}),o.jsx("span",{style:{fontFamily:vr,fontSize:7,color:h+"77"},children:m})]}),o.jsxs("div",{style:{height:3,background:"rgba(255,255,255,0.04)",position:"relative",overflow:"hidden"},children:[o.jsx("div",{style:{position:"absolute",left:"50%",top:0,width:1,height:"100%",background:"rgba(255,255,255,0.12)"}}),o.jsx("div",{style:{position:"absolute",top:0,height:"100%",transition:"all 0.7s",...d>=0?{left:"50%",width:`${Math.abs(d)*50}%`,background:`${h}88`}:{right:"50%",width:`${Math.abs(d)*50}%`,background:`${h}88`}}})]})]}),o.jsx("div",{style:{paddingTop:6,borderTop:"1px dashed rgba(255,255,255,0.04)"},children:o.jsx("p",{style:{fontFamily:vr,fontSize:7,color:"rgba(255,255,255,0.20)",fontStyle:"italic",lineHeight:1.6},children:BG(s,c,l,d,r)})})]})})};function BG(e,t,n,r,a){return t>.55?"Self ativo  individuao emergente. Raro e precioso.":n>.6?"Complexo autnomo dominante. Ego perdeu o centro.":e>.7?"Compensao intensa. O oposto do estado consciente pressiona.":r>.5?"Libido progressiva  energia fluindo para formas superiores.":r<-.4?"Regresso ativa  libido voltando ao modo primitivo.":a==="FLOW"?"Funo Transcendente ativa  sntese consciente/inconsciente.":a==="PANIC"?"Enantiodromia em curso  ruptura antes da renovao.":"Processo em andamento  padres emergentes aguardando leitura."}const $G=({metrics:e,phase:t})=>{const[n,r]=S.useState(!0);if(!e)return null;const a=e.idPower+e.egoStrength+e.superegoForce+.001,i=e.idPower/a,s=e.egoStrength/a,c=e.superegoForce/a,l=()=>e.eros>.65?"Eros dominante  libido expansiva, tendncia  ligao.":e.thanatos>.55?"Thanatos emergente  compulso de repetio ativa.":e.repressao>.6?"Alta represso  material inconsciente sob presso.":e.sublimacao>.55?"Sublimao ativa  energia pulsional transformada.":t==="PANIC"?"Retorno do reprimido  defesas rompidas pelo acmulo.":t==="FLOW"?"Princpio da realidade em equilbrio com o prazer.":"Economia libidinal em negociao  Id, Ego e Superego em tenso.";return o.jsx(Pc,{title:" Aparelho Psquico",open:n,onToggle:()=>r(d=>!d),accent:"#f4a46080",children:o.jsxs("div",{style:{padding:"10px 12px",display:"flex",flexDirection:"column",gap:8},children:[o.jsxs("div",{children:[o.jsx("div",{style:{...Fi,color:"#f4a46040",marginBottom:5},children:"Distribuio topogrfica"}),o.jsxs("div",{style:{display:"flex",height:4,gap:1,overflow:"hidden"},children:[o.jsx("div",{style:{width:`${i*100}%`,background:"rgba(239,68,68,0.65)",transition:"width 0.7s"}}),o.jsx("div",{style:{width:`${s*100}%`,background:"rgba(59,130,246,0.65)",transition:"width 0.7s"}}),o.jsx("div",{style:{width:`${c*100}%`,background:"rgba(156,163,175,0.55)",transition:"width 0.7s"}})]}),o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:3},children:[o.jsxs("span",{style:{fontFamily:vr,fontSize:7,color:"#ef444477"},children:["Id ",Math.round(i*100),"%"]}),o.jsxs("span",{style:{fontFamily:vr,fontSize:7,color:"#3b82f677"},children:["Ego ",Math.round(s*100),"%"]}),o.jsxs("span",{style:{fontFamily:vr,fontSize:7,color:"#9ca3af77"},children:["SG ",Math.round(c*100),"%"]})]})]}),o.jsx(Li,{label:"Eros",value:e.eros,color:"#f472b6",desc:"pulso de vida"}),o.jsx(Li,{label:"Thanatos",value:e.thanatos,color:"#64748b",desc:"pulso de morte"}),o.jsx(Li,{label:"Represso",value:e.repressao,color:"#f4a460",desc:"material bloqueado"}),o.jsx(Li,{label:"Sublimao",value:e.sublimacao,color:"#86efac",desc:"energia transformada"}),o.jsx("div",{style:{paddingTop:6,borderTop:"1px dashed rgba(255,255,255,0.04)"},children:o.jsx("p",{style:{fontFamily:vr,fontSize:7,color:"#f4a46060",fontStyle:"italic",lineHeight:1.6},children:l()})})]})})},qG=({metrics:e,phase:t})=>{const[n,r]=S.useState(!0);if(!e)return null;const a=e.real+e.simbolico+e.imaginario+.001,i=e.real/a,s=e.simbolico/a,c=e.imaginario/a,l=()=>e.real>.45?"Irrupo do Real  o inassimilvel invade o campo.":e.gozo>.65?"Gozo intenso  alm do princpio do prazer.":e.falta>.75?"Falta estrutural dominante  desejo como motor.":e.sujeito>.6?"Sujeito dividido em crise  falha na cadeia significante.":e.simbolico>.55?"Ordem Simblica forte  Lei do Pai operativa.":e.imaginario>.55?"Registro Imaginrio dominante  identificao especular.":t==="FLOW"?"Circulao borromiana equilibrada  RSI em tenso criativa.":t==="PANIC"?"N borromiano solto  passagem ao ato iminente.":"Registros RSI em reorganizao  sujeito em travessia.";return o.jsx(Pc,{title:" Topologia RSI",open:n,onToggle:()=>r(d=>!d),accent:"#e0a0ff80",children:o.jsxs("div",{style:{padding:"10px 12px",display:"flex",flexDirection:"column",gap:8},children:[o.jsxs("div",{children:[o.jsx("div",{style:{...Fi,color:"#e0a0ff40",marginBottom:5},children:"Proporo dos registros"}),o.jsxs("div",{style:{display:"flex",height:4,gap:1,overflow:"hidden"},children:[o.jsx("div",{style:{width:`${i*100}%`,background:"rgba(220,38,38,0.70)",transition:"width 0.7s"}}),o.jsx("div",{style:{width:`${s*100}%`,background:"rgba(59,130,246,0.70)",transition:"width 0.7s"}}),o.jsx("div",{style:{width:`${c*100}%`,background:"rgba(245,200,66,0.65)",transition:"width 0.7s"}})]}),o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:3},children:[o.jsxs("span",{style:{fontFamily:vr,fontSize:7,color:"#dc262677"},children:["R ",Math.round(i*100),"%"]}),o.jsxs("span",{style:{fontFamily:vr,fontSize:7,color:"#3b82f677"},children:["S ",Math.round(s*100),"%"]}),o.jsxs("span",{style:{fontFamily:vr,fontSize:7,color:"#f5c84277"},children:["I ",Math.round(c*100),"%"]})]})]}),o.jsx(Li,{label:"Real",value:e.real,color:"#dc2626",desc:"inassimilvel  trauma"}),o.jsx(Li,{label:"Simblico",value:e.simbolico,color:"#3b82f6",desc:"lei, linguagem, Outro"}),o.jsx(Li,{label:"Imaginrio",value:e.imaginario,color:"#f5c842",desc:"espelho, Ego, imagem"}),o.jsxs("div",{style:{paddingTop:6,borderTop:"1px dashed rgba(255,255,255,0.04)"},children:[o.jsx("div",{style:{...Fi,color:"#e0a0ff40",marginBottom:5},children:"Conceitos"}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[o.jsx(Li,{label:"Gozo (J)",value:e.gozo,color:"#f43f5e",desc:"jouissance  alm do prazer"}),o.jsx(Li,{label:"Falta ()",value:e.falta,color:"#e0a0ff",desc:"manque  buraco do desejo"}),o.jsx(Li,{label:"Sujeito $",value:e.sujeito,color:"#a78bfa",desc:"diviso  efeito do significante"})]})]}),o.jsx("div",{style:{display:"flex",justifyContent:"center",gap:12,padding:"8px 0"},children:[{label:"R",color:"#dc2626",v:e.real},{label:"S",color:"#3b82f6",v:e.simbolico},{label:"I",color:"#f5c842",v:e.imaginario}].map(({label:d,color:u,v:h})=>o.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:3},children:o.jsx("div",{style:{width:26+h*14,height:26+h*14,border:`1px dashed ${u}55`,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.7s"},children:o.jsx("span",{style:{fontFamily:vr,fontSize:10,color:u},children:d})})},d))}),o.jsx("div",{style:{paddingTop:6,borderTop:"1px dashed rgba(255,255,255,0.04)"},children:o.jsx("p",{style:{fontFamily:vr,fontSize:7,color:"#e0a0ff55",fontStyle:"italic",lineHeight:1.6},children:l()})})]})})},Tb=({title:e,camadas:t,intro:n,legenda:r})=>{const[a,i]=S.useState(!1);return o.jsx(Pc,{title:e,open:a,onToggle:()=>i(s=>!s),children:o.jsxs("div",{style:{padding:"8px 12px"},children:[o.jsx("p",{style:{fontFamily:vr,fontSize:7,color:"rgba(255,255,255,0.18)",fontStyle:"italic",marginBottom:8,lineHeight:1.5},children:n}),t.map(s=>o.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",padding:"3px 0"},children:[o.jsx("span",{style:{fontSize:12,flexShrink:0,color:s.color},children:s.sigil}),o.jsx("span",{style:{fontFamily:vr,fontSize:9,color:s.color},children:s.name}),o.jsx("span",{style:{fontFamily:vr,fontSize:7,color:"rgba(255,255,255,0.20)"},children:s.desc})]},s.name)),o.jsxs("div",{style:{marginTop:8,paddingTop:6,borderTop:"1px dashed rgba(255,255,255,0.04)"},children:[o.jsx("div",{style:{...Fi,marginBottom:4},children:"Lentes de cor"}),r.map(([s,c,l])=>o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:3},children:[o.jsx("div",{style:{width:6,height:6,background:s+"bb",flexShrink:0}}),o.jsx("span",{style:{fontFamily:vr,fontSize:7,color:s+"99"},children:c}),o.jsxs("span",{style:{fontFamily:vr,fontSize:7,color:"rgba(255,255,255,0.15)"},children:[" ",l]})]},c))]})]})})},tw=[{id:"hero-inflation",name:"Heri Inflado",sigil:"",color:"#3b82f6",keywords:["fora","direo","sombra negada"],description:"Ego identificado com o Heri. Persona brilhante. Sombra cresce s escuras.",poeticLine:"A espada erguida que no v sua prpria sombra.",archetypes:{HERO:.95,PERSONA:.85,FATHER:.75,SHADOW:.25,SELF:.1},configMods:{danceIntensity:.38,maxSpeed:.3,breathPeriod:10,selfPull:.08}},{id:"shadow-surge",name:"Sombra Emergente",sigil:"",color:"#7c3aed",keywords:["reprimido","retorno","complexo"],description:"Contedo reprimido pressiona por emergncia. Vrtices no quadrante da Sombra.",poeticLine:"O que foi enterrado comea a mover a terra.",archetypes:{SHADOW:.95,DESTROYER:.8,TRICKSTER:.65,SELF:.2,HERO:.2},configMods:{danceIntensity:.5,maxSpeed:.4,breathPeriod:8,selfPull:.12}},{id:"grande-mae",name:"Grande Me",sigil:"",color:"#f59e0b",keywords:["nutrio","eros","vnculo"],description:"Campo matrizal dominante. Anima e Amante tecem o espao.",poeticLine:"A mo que sustenta sem prender.",archetypes:{MOTHER:.95,ANIMA:.8,LOVER:.75,CHILD:.6,SELF:.55},configMods:{danceIntensity:.26,maxSpeed:.2,breathPeriod:22,selfPull:.22}},{id:"lei-pai",name:"Lei do Pai",sigil:"",color:"#6b7280",keywords:["estrutura","represso","lei"],description:"Estrutura normativa alta. Inibio cresce. Movimento restrito mas coeso.",poeticLine:"A lei que ordena tambm aprisiona.",archetypes:{FATHER:.95,PERSONA:.75,HERO:.55,SHADOW:.35,SELF:.15},configMods:{danceIntensity:.28,maxSpeed:.2,breathPeriod:18,selfPull:.1}},{id:"crianca-divina",name:"Criana Divina",sigil:"",color:"#06b6d4",keywords:["potencial","abertura","renascimento"],description:"Abertura radical ao novo. Inibio baixa. Movimento livre e exploratrio.",poeticLine:"O olho que v tudo pela primeira vez.",archetypes:{CHILD:.95,LOVER:.75,ANIMA:.7,TRICKSTER:.55,SELF:.4},configMods:{danceIntensity:.42,maxSpeed:.34,breathPeriod:12,selfPull:.16}},{id:"velho-sabio",name:"Velho Sbio",sigil:"",color:"#6366f1",keywords:["sntese","sentido","profundidade"],description:"Self e Sbio em confluncia. Integrao ativa. Campo centralizado.",poeticLine:"O silncio que contm todas as respostas.",archetypes:{WISE_ONE:.95,SELF:.9,ANIMA:.65,MOTHER:.55,SHADOW:.3},configMods:{danceIntensity:.22,maxSpeed:.16,breathPeriod:28,selfPull:.3}},{id:"possessao",name:"Possesso",sigil:"",color:"#84cc16",keywords:["caos","ruptura","transfigurao"],description:"Trickster e Destruidor dominam. Estrutura colapsa. Reconfigurao emerge.",poeticLine:"O relmpago que ilumina ao destruir.",archetypes:{TRICKSTER:.95,DESTROYER:.88,SHADOW:.75,SELF:.1,HERO:.15},configMods:{danceIntensity:.68,maxSpeed:.58,breathPeriod:6,selfPull:.08}},{id:"individuation",name:"Individuao",sigil:"",color:"#f5c842",keywords:["integrao","totalidade","mandala"],description:"Todos em equilbrio dinmico. Self como centro gravitacional.",poeticLine:"O crculo que contm todos os opostos.",archetypes:{SELF:.9,WISE_ONE:.75,HERO:.65,SHADOW:.55,ANIMA:.6,MOTHER:.5},configMods:{danceIntensity:.3,maxSpeed:.22,breathPeriod:22,selfPull:.28}}],HG={SHADOW:["O Retorno","A Sombra que Fala","O Abismo","A Escurido Frtil"],HERO:["A Espada","O Ego Diretivo","O Conquistador","A Fora Cega"],SELF:["O Centro","O Mandala Vivo","A Totalidade","O Eixo"],TRICKSTER:["O Caos","O Shapeshifter","A Ordem Quebrada","O Limiar"],MOTHER:["O Campo","A Nutrio","O Acolhimento","A Origem"],DESTROYER:["A Ruptura","O Fim Necessrio","A Transfigurao","O Vazio"],ANIMA:["A Ponte","O Mensageiro","O Feminino","A Mediao"],WISE_ONE:["O Sbio","A Sntese","O Sentido","A Profundidade"],FATHER:["A Lei","A Estrutura","O Pai","A Norma"],CHILD:["O Novo","O Potencial","A Abertura","A Inocncia"],LOVER:["O Eros","O Vnculo","A Ressonncia","O Encontro"],PERSONA:["A Mscara","O Papel","A Interface","O Rosto Pblico"]},Gj={SELF:"#f5c842",PERSONA:"#b0c4de",SHADOW:"#7c3aed",ANIMA:"#f43f5e",TRICKSTER:"#84cc16",HERO:"#3b82f6",MOTHER:"#f59e0b",FATHER:"#6b7280",WISE_ONE:"#6366f1",CHILD:"#06b6d4",LOVER:"#ec4899",DESTROYER:"#ef4444"};function Ib(e){return e[Math.floor(Math.random()*e.length)]}function Y4(){const e=Ib(tw),t={};for(const[l,d]of Object.entries(e.archetypes))t[l]=Math.max(.05,Math.min(1,d+(Math.random()-.5)*.28));const n=Pu.filter(l=>!(l in t)),r=1+Math.floor(Math.random()*2);for(let l=0;l<r;l++){const d=Ib(n.slice(l));d&&(t[d]=.12+Math.random()*.42)}const a=Vj(t),i=Ib(HG[a]??["Uma Nova Conscincia"]),s=Gj[a]??"#c4b5fd",c={...e.configMods};return c.danceIntensity&&(c.danceIntensity=Pb(c.danceIntensity+(Math.random()-.5)*.14,.12,.75)),c.maxSpeed&&(c.maxSpeed=Pb(c.maxSpeed+(Math.random()-.5)*.1,.1,.65)),c.breathPeriod&&(c.breathPeriod=Pb(c.breathPeriod+(Math.random()-.5)*8,6,55)),{name:i,description:e.description,poeticLine:e.poeticLine,archetypeWeights:t,activeArchetypes:Object.keys(t),configMods:c,dominantArchetype:a,predictedPhase:Uj(t),color:s}}function WG(e){if(e.length===0)return null;const t=tw.filter(m=>e.includes(m.id));if(t.length===0)return null;const n={};for(const m of t)for(const[f,g]of Object.entries(m.archetypes))n[f]=Math.min(1,Math.max(n[f]??0,g)*.8+g*.2);const r=Xg(t,m=>m.configMods.danceIntensity??.32),a=Xg(t,m=>m.configMods.maxSpeed??.24),i=Xg(t,m=>m.configMods.breathPeriod??20),s=Xg(t,m=>m.configMods.selfPull??.18),c=Vj(n),l=Gj[c]??"#c4b5fd",d=t.map(m=>m.name).join("  "),u=t.map(m=>m.description).join(" "),h=t[0].poeticLine;return{name:d,description:u,poeticLine:h,archetypeWeights:n,activeArchetypes:Object.keys(n),configMods:{danceIntensity:r,maxSpeed:a,breathPeriod:i,selfPull:s},dominantArchetype:c,predictedPhase:Uj(n),color:l}}function Vj(e){let t="SELF",n=0;for(const[r,a]of Object.entries(e))a>n&&(n=a,t=r);return t}function Uj(e){const t=(e.SHADOW??0)*.3+(e.DESTROYER??0)*.3+(e.TRICKSTER??0)*.2,n=(e.SELF??0)*.4+(e.WISE_ONE??0)*.3+(e.ANIMA??0)*.15;return t>.6?t>.75?"COLAPSO":"ALERTA":n>.55?n>.7?"FLUXO":"INTEGRANDO":"CALMO"}function Xg(e,t){return e.reduce((n,r)=>n+t(r),0)/e.length}function Pb(e,t,n){return Math.max(t,Math.min(n,e))}const Yj="'Doto', monospace",Va="'IBM Plex Mono', monospace",Kc="#8b5cf6",GG=({onClose:e,onInvoke:t})=>{const[n,r]=S.useState("random"),[a,i]=S.useState(null),[s,c]=S.useState([]),[l,d]=S.useState(!1);S.useEffect(()=>{i(Y4())},[]);const u=s.length>0?WG(s):null,h=n==="random"?a:u,m=g=>c(x=>x.includes(g)?x.filter(v=>v!==g):x.length<3?[...x,g]:x),f=()=>{h&&(d(!0),setTimeout(()=>{t(h),e()},320))};return o.jsx("div",{onClick:g=>g.target===g.currentTarget&&e(),style:{position:"fixed",inset:0,zIndex:50,display:"flex",alignItems:"center",justifyContent:"center",padding:16,background:"rgba(0,0,0,0.92)"},children:o.jsxs("div",{style:{position:"relative",width:"100%",maxWidth:640,maxHeight:"90vh",display:"flex",flexDirection:"column",overflow:"hidden",background:"rgba(0,0,0,0.98)",border:"1px dashed rgba(255,255,255,0.08)"},children:[o.jsxs("div",{style:{flexShrink:0,padding:"18px 24px 14px",borderBottom:"1px dashed rgba(255,255,255,0.06)",display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[o.jsxs("div",{children:[o.jsx("div",{style:{fontFamily:Va,fontSize:8,color:"rgba(255,255,255,0.18)",letterSpacing:"0.1em",textTransform:"uppercase",marginBottom:5},children:"PSYCHE LAB  CONSCINCIA"}),o.jsx("h2",{style:{fontFamily:Yj,fontSize:17,color:"rgba(255,255,255,0.75)",letterSpacing:"0.04em",margin:0},children:"Gerar Nova Conscincia"}),o.jsx("p",{style:{fontFamily:Va,fontSize:9,color:"rgba(255,255,255,0.22)",marginTop:4,fontStyle:"italic"},children:"Cada invocao reinicia a psique com novos padres iniciais."})]}),o.jsx("button",{onClick:e,style:{background:"none",border:"none",cursor:"pointer",color:"rgba(255,255,255,0.15)",fontSize:16,padding:"0 2px"},children:""})]}),o.jsx("div",{style:{flexShrink:0,display:"flex",borderBottom:"1px dashed rgba(255,255,255,0.05)"},children:["random","compose"].map(g=>o.jsx("button",{onClick:()=>r(g),style:{flex:1,padding:"10px 0",background:"none",border:"none",cursor:"pointer",fontFamily:Va,fontSize:9,letterSpacing:"0.1em",textTransform:"uppercase",color:n===g?`${Kc}cc`:"rgba(255,255,255,0.18)",borderBottom:n===g?`1px solid ${Kc}55`:"1px solid transparent",transition:"all 0.15s"},children:g==="random"?" Aleatrio":" Compor"},g))}),o.jsxs("div",{style:{flex:1,overflowY:"auto",minHeight:0},children:[n==="random"&&o.jsxs("div",{style:{padding:20,display:"flex",flexDirection:"column",gap:16},children:[o.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[o.jsx("button",{onClick:()=>i(Y4()),style:{display:"flex",alignItems:"center",gap:6,padding:"6px 12px",background:"none",border:"1px dashed rgba(255,255,255,0.10)",color:"rgba(255,255,255,0.35)",cursor:"pointer",fontFamily:Va,fontSize:9,letterSpacing:"0.08em",textTransform:"uppercase",transition:"all 0.15s"},children:" Gerar Outro"}),o.jsx("span",{style:{fontFamily:Va,fontSize:8,color:"rgba(255,255,255,0.15)",fontStyle:"italic"},children:"Seed aleatrio baseado em complexos junguianos"})]}),a&&o.jsx(K4,{profile:a})]}),n==="compose"&&o.jsxs("div",{style:{padding:20,display:"flex",flexDirection:"column",gap:16},children:[o.jsxs("p",{style:{fontFamily:Va,fontSize:8,color:"rgba(255,255,255,0.20)",fontStyle:"italic",margin:0},children:["Selecione at 3 complexos. Os campos se fundiro num perfil nico.",s.length>0&&o.jsxs("span",{style:{marginLeft:4,color:`${Kc}55`},children:[s.length,"/3 selecionados."]})]}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:tw.map(g=>o.jsx(VG,{c:g,selected:s.includes(g.id),onToggle:()=>m(g.id)},g.id))}),u&&o.jsxs("div",{style:{paddingTop:8,borderTop:"1px dashed rgba(255,255,255,0.04)",display:"flex",flexDirection:"column",gap:10},children:[o.jsx("div",{style:{fontFamily:Va,fontSize:8,color:"rgba(255,255,255,0.22)",letterSpacing:"0.1em",textTransform:"uppercase"},children:" Fuso resultante"}),o.jsx(K4,{profile:u})]}),s.length===0&&o.jsx("div",{style:{padding:"24px 0",textAlign:"center",fontFamily:Va,fontSize:9,color:"rgba(255,255,255,0.15)",fontStyle:"italic"},children:"Nenhum complexo selecionado ainda."})]})]}),o.jsx("div",{style:{flexShrink:0,padding:"14px 20px",borderTop:"1px dashed rgba(255,255,255,0.05)"},children:o.jsxs("button",{onClick:f,disabled:!h||l,style:{width:"100%",padding:"12px 0",display:"flex",alignItems:"center",justifyContent:"center",gap:8,background:l?`${Kc}0c`:`${Kc}06`,border:`1px dashed ${l?`${Kc}50`:`${Kc}25`}`,color:l?`${Kc}cc`:`${Kc}90`,fontFamily:Va,fontSize:10,letterSpacing:"0.12em",textTransform:"uppercase",cursor:!h||l?"not-allowed":"pointer",opacity:h?1:.3,transition:"all 0.2s"},children:[" ",l?"Invocando...":"Invocar Conscincia"]})})]})})},K4=({profile:e})=>{const t=Dc.find(a=>a.id===e.dominantArchetype),n=e.color,r=Object.entries(e.archetypeWeights).sort(([,a],[,i])=>i-a).slice(0,6);return o.jsxs("div",{style:{padding:16,background:n+"06",border:`1px dashed ${n}22`,transition:"all 0.2s"},children:[o.jsxs("div",{style:{display:"flex",gap:12,alignItems:"flex-start",marginBottom:12},children:[o.jsx("span",{style:{fontSize:28,lineHeight:1,flexShrink:0,color:n},children:(t==null?void 0:t.sigil)??""}),o.jsxs("div",{style:{flex:1,minWidth:0},children:[o.jsx("div",{style:{fontFamily:Yj,fontSize:15,color:"rgba(255,255,255,0.80)",letterSpacing:"0.04em",marginBottom:3},children:e.name}),o.jsxs("div",{style:{fontFamily:Va,fontSize:8,fontStyle:"italic",lineHeight:1.5,color:n+"99"},children:['"',e.poeticLine,'"']}),o.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:5,marginTop:8},children:[o.jsxs("span",{style:{fontFamily:Va,fontSize:7,padding:"2px 6px",background:n+"12",color:n+"bb"},children:[" ",e.dominantArchetype]}),o.jsx("span",{style:{fontFamily:Va,fontSize:7,padding:"2px 6px",background:"rgba(255,255,255,0.03)",color:"rgba(255,255,255,0.30)"},children:e.predictedPhase}),o.jsxs("span",{style:{fontFamily:Va,fontSize:7,padding:"2px 6px",background:"rgba(255,255,255,0.03)",color:"rgba(255,255,255,0.30)"},children:[e.activeArchetypes.length," arqutipos"]})]})]})]}),o.jsx("p",{style:{fontFamily:Va,fontSize:8,color:"rgba(255,255,255,0.28)",marginBottom:12,lineHeight:1.6},children:e.description}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:5},children:r.map(([a,i])=>{const s=Dc.find(c=>c.id===a);return s?o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[o.jsx("span",{style:{fontSize:11,width:16,flexShrink:0,textAlign:"center",color:s.color},children:s.sigil}),o.jsx("span",{style:{fontFamily:Va,fontSize:7,width:70,flexShrink:0,color:"rgba(255,255,255,0.35)"},children:s.id}),o.jsx("div",{style:{flex:1,height:3,background:"rgba(255,255,255,0.04)",overflow:"hidden"},children:o.jsx("div",{style:{height:"100%",width:`${Math.round(i*100)}%`,background:`linear-gradient(90deg, ${s.color}55, ${s.color}aa)`,transition:"width 0.7s"}})}),o.jsxs("span",{style:{fontFamily:Va,fontSize:7,color:"rgba(255,255,255,0.20)",width:26,textAlign:"right"},children:[Math.round(i*100),"%"]})]},a):null})}),o.jsxs("div",{style:{marginTop:12,paddingTop:10,borderTop:"1px dashed rgba(255,255,255,0.04)",display:"flex",flexWrap:"wrap",gap:12},children:[e.configMods.danceIntensity!=null&&o.jsx(Fb,{label:"Velocidade",value:`${Math.round(e.configMods.danceIntensity*100)}%`}),e.configMods.breathPeriod!=null&&o.jsx(Fb,{label:"Respirao",value:`${Math.round(e.configMods.breathPeriod)}s`}),e.configMods.maxSpeed!=null&&o.jsx(Fb,{label:"Max Speed",value:e.configMods.maxSpeed.toFixed(2)})]})]})},Fb=({label:e,value:t})=>o.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[o.jsx("span",{style:{fontFamily:Va,fontSize:7,color:"rgba(255,255,255,0.15)",letterSpacing:"0.1em",textTransform:"uppercase"},children:e}),o.jsx("span",{style:{fontFamily:Va,fontSize:9,color:"rgba(255,255,255,0.35)"},children:t})]}),VG=({c:e,selected:t,onToggle:n})=>{const r=Object.entries(e.archetypes).sort(([,a],[,i])=>i-a).slice(0,3);return o.jsxs("button",{onClick:n,style:{textAlign:"left",padding:12,cursor:"pointer",background:t?e.color+"08":"rgba(255,255,255,0.01)",border:`1px dashed ${t?e.color+"40":"rgba(255,255,255,0.05)"}`,transition:"all 0.15s"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8},children:[o.jsx("span",{style:{fontSize:18,lineHeight:1,flexShrink:0,color:e.color},children:e.sigil}),o.jsxs("div",{style:{flex:1,minWidth:0},children:[o.jsx("div",{style:{fontFamily:Va,fontSize:9,lineHeight:1.3,color:t?e.color:"rgba(255,255,255,0.50)"},children:e.name}),o.jsx("div",{style:{display:"flex",gap:4,flexWrap:"wrap",marginTop:3},children:e.keywords.map(a=>o.jsx("span",{style:{fontFamily:Va,fontSize:7,color:"rgba(255,255,255,0.15)"},children:a},a))})]}),t&&o.jsx("span",{style:{fontSize:9,flexShrink:0,color:e.color},children:""})]}),o.jsx("div",{style:{display:"flex",gap:4,flexWrap:"wrap"},children:r.map(([a,i])=>{const s=Dc.find(c=>c.id===a);return s?o.jsxs("span",{style:{fontFamily:Va,fontSize:7,padding:"2px 6px",background:s.color+"12",color:s.color+"99"},children:[s.sigil," ",Math.round(i*100),"%"]},a):null})})]})};const _u={zVar:"speed",zScale:.55,mode:"particles",camera:{yaw:.55,pitch:.48,dist:3,panX:0,panY:0},showTrails:!1,trailLen:14,showBonds:!1,ptSize:5.5,colorScheme3D:"default"};function UG(e,t,n,r){const a=1/Math.tan(e/2),i=1/(n-r),s=new Float32Array(16);return s[0]=a/t,s[5]=a,s[10]=(r+n)*i,s[11]=-1,s[14]=2*r*n*i,s}function YG(e,t,n,r,a,i){let s=r-e,c=a-t,l=i-n,d=Math.sqrt(s*s+c*c+l*l)||1;s/=d,c/=d,l/=d;let u=c*0-l*-1,h=l*0-s*0,m=s*-1-c*0;u=c*0-l*1,h=l*0-s*0,m=s*1-c*0,u=-l,h=0,m=s;let f=Math.sqrt(u*u+h*h+m*m)||1;u/=f,h/=f,m/=f;const g=h*l-m*c,x=m*s-u*l,v=u*c-h*s;return new Float32Array([u,g,-s,0,h,x,-c,0,m,v,-l,0,-(u*e+h*t+m*n),-(g*e+x*t+v*n),s*e+c*t+l*n,1])}function KG(e,t){const n=new Float32Array(16);for(let r=0;r<4;r++)for(let a=0;a<4;a++)n[a*4+r]=e[0+r]*t[a*4+0]+e[4+r]*t[a*4+1]+e[8+r]*t[a*4+2]+e[12+r]*t[a*4+3];return n}const XG=`
attribute vec3 a_pos;
attribute vec3 a_col;
attribute float a_alpha;
uniform mat4 u_mvp;
uniform float u_ptSize;
varying vec3 v_col;
varying float v_alpha;
void main(){
  gl_Position = u_mvp * vec4(a_pos,1.0);
  gl_PointSize = u_ptSize;
  v_col = a_col; v_alpha = a_alpha;
}`,JG=`
precision mediump float;
varying vec3 v_col;
varying float v_alpha;
void main(){ gl_FragColor = vec4(v_col, v_alpha); }`,vc=7;class nw{constructor(t){this.gl=null,this.prg=null,this.buf=null,this.verts=new Float32Array(0),this.trailBuf=new Map,this.frameIdx=0,this.canvas=t;const n=t.getContext("webgl",{alpha:!0,antialias:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0});if(!n){console.warn("[Renderer3D] WebGL unavailable");return}this.gl=n,this.prg=this.buildProg(XG,JG),this.prg&&(this.buf=n.createBuffer())}get isReady(){return this.gl!==null&&this.prg!==null}buildProg(t,n){const r=this.gl,a=(l,d)=>{const u=r.createShader(l);return r.shaderSource(u,d),r.compileShader(u),r.getShaderParameter(u,r.COMPILE_STATUS)?u:(console.error("[Renderer3D]",r.getShaderInfoLog(u)),null)},i=a(r.VERTEX_SHADER,t),s=a(r.FRAGMENT_SHADER,n);if(!i||!s)return null;const c=r.createProgram();return r.attachShader(c,i),r.attachShader(c,s),r.linkProgram(c),r.getProgramParameter(c,r.LINK_STATUS)?c:(console.error("[Renderer3D]",r.getProgramInfoLog(c)),null)}resize(t,n){if(!this.gl)return;const r=Math.min(window.devicePixelRatio||1,1.5);this.canvas.width=Math.round(t*r),this.canvas.height=Math.round(n*r),this.gl.viewport(0,0,this.canvas.width,this.canvas.height)}render(t,n,r,a){const i=this.gl;if(!i||!this.prg||!this.buf)return;const s=this.canvas.width,c=this.canvas.height;if(s===0||c===0)return;const l=n.camera,d=QG(l),u=YG(d[0],d[1],d[2],l.panX,0,l.panY),h=UG(Math.PI*.4,s/c,.01,50),m=KG(h,u);i.useProgram(this.prg),i.uniformMatrix4fv(i.getUniformLocation(this.prg,"u_mvp"),!1,m),i.clearColor(.027,.02,.055,1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.enable(i.BLEND),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL);const f=n.zScale;if(this.drawGrid(i,m,f),(n.mode==="terrain"||n.mode==="hybrid")&&r&&this.drawTerrain(i,r,f),n.mode==="terrain")return;const g=t.length;if(g===0)return;if(n.showTrails){this.frameIdx++;for(let w=0;w<g;w++){const M=t[w];this.trailBuf.has(w)||this.trailBuf.set(w,[]);const k=this.trailBuf.get(w);k.push([M.nx,M.ny,M.z*f]),k.length>(n.trailLen??14)&&k.shift()}const b=[];for(let w=0;w<g;w++){const M=this.trailBuf.get(w);if(!M||M.length<2)continue;const k=t[w];for(let R=1;R<M.length;R++){const j=R/M.length*.45,I=M[R-1],E=M[R];b.push(I[0],I[2]>.001?I[2]:.001,-I[1]),b.push(k.r*.6,k.g*.6,k.b*.8,j*.6),b.push(E[0],E[2]>.001?E[2]:.001,-E[1]),b.push(k.r*.8,k.g*.8,k.b*.9,j)}}if(b.length>0){const w=new Float32Array(b),M=w.length/vc;this.upload(i,w,M),this.setAttribs(i),i.uniform1f(i.getUniformLocation(this.prg,"u_ptSize"),1),i.drawArrays(i.LINES,0,M)}}else this.trailBuf.size>0&&this.trailBuf.clear();if(n.showBonds&&a&&a.length>0){const b=[];for(const w of a){const M=w.a,k=w.b;if(M<0||k<0||M>=g||k>=g)continue;const R=t[M],j=t[k],I=R.z*f,E=j.z*f;b.push(R.nx,I,-R.ny,.55,.4,.8,.35),b.push(j.nx,E,-j.ny,.55,.4,.8,.35)}if(b.length>0){const w=new Float32Array(b),M=w.length/vc;this.upload(i,w,M),this.setAttribs(i),i.uniform1f(i.getUniformLocation(this.prg,"u_ptSize"),1),i.drawArrays(i.LINES,0,M)}}const x=g*2;this.verts.length<x*vc&&(this.verts=new Float32Array((x+200)*vc));let v=0;for(let b=0;b<g;b++){const w=t[b],M=w.z*f;this.verts[v++]=w.nx,this.verts[v++]=0,this.verts[v++]=-w.ny,this.verts[v++]=w.r,this.verts[v++]=w.g,this.verts[v++]=w.b,this.verts[v++]=.22,this.verts[v++]=w.nx,this.verts[v++]=M,this.verts[v++]=-w.ny,this.verts[v++]=w.r,this.verts[v++]=w.g,this.verts[v++]=w.b,this.verts[v++]=.7}this.upload(i,this.verts,x),this.setAttribs(i),i.uniform1f(i.getUniformLocation(this.prg,"u_ptSize"),1),i.drawArrays(i.LINES,0,x),this.verts.length<g*vc&&(this.verts=new Float32Array((g+200)*vc)),v=0;for(let b=0;b<g;b++){const w=t[b],M=w.z*f;this.verts[v++]=w.nx,this.verts[v++]=M,this.verts[v++]=-w.ny,this.verts[v++]=w.r,this.verts[v++]=w.g,this.verts[v++]=w.b,this.verts[v++]=.92}this.upload(i,this.verts,g),this.setAttribs(i),i.uniform1f(i.getUniformLocation(this.prg,"u_ptSize"),n.ptSize??5.5),i.drawArrays(i.POINTS,0,g)}drawGrid(t,n,r){const i=new Float32Array(44*vc);let s=0;const c=(l,d,u,h)=>{for(const[m,f]of[[l,d],[u,h]])i[s++]=m,i[s++]=0,i[s++]=f,i[s++]=.18,i[s++]=.16,i[s++]=.28,i[s++]=.3};for(let l=0;l<=10;l++){const d=l/10*2-1;c(d,-1,d,1),c(-1,d,1,d)}this.upload(t,i,44),this.setAttribs(t),t.uniform1f(t.getUniformLocation(this.prg,"u_ptSize"),1),t.drawArrays(t.LINES,0,44)}drawTerrain(t,n,r){const{w:a,h:i,heights:s}=n,c=(a-1)*i+a*(i-1),l=new Float32Array(c*2*vc);let d=0;const u=(h,m)=>{const f=h/(a-1)*2-1,g=m/(i-1)*2-1,x=s[m*a+h]*r,v=s[m*a+h];l[d++]=f,l[d++]=x,l[d++]=-g,l[d++]=.15+v*.25,l[d++]=.2+v*.5,l[d++]=.45+v*.3,l[d++]=.28+v*.22};for(let h=0;h<i;h++)for(let m=0;m<a-1;m++)u(m,h),u(m+1,h);for(let h=0;h<a;h++)for(let m=0;m<i-1;m++)u(h,m),u(h,m+1);this.upload(t,l,c*2),this.setAttribs(t),t.uniform1f(t.getUniformLocation(this.prg,"u_ptSize"),1),t.drawArrays(t.LINES,0,c*2)}upload(t,n,r){t.bindBuffer(t.ARRAY_BUFFER,this.buf),t.bufferData(t.ARRAY_BUFFER,n.subarray(0,r*vc),t.DYNAMIC_DRAW)}setAttribs(t){const n=this.prg,r=vc*4,a=t.getAttribLocation(n,"a_pos"),i=t.getAttribLocation(n,"a_col"),s=t.getAttribLocation(n,"a_alpha");t.enableVertexAttribArray(a),t.vertexAttribPointer(a,3,t.FLOAT,!1,r,0),t.enableVertexAttribArray(i),t.vertexAttribPointer(i,3,t.FLOAT,!1,r,12),t.enableVertexAttribArray(s),t.vertexAttribPointer(s,1,t.FLOAT,!1,r,24)}dispose(){const t=this.gl;t&&(this.prg&&t.deleteProgram(this.prg),this.buf&&t.deleteBuffer(this.buf),this.prg=null,this.buf=null)}}function QG(e){const t=Math.sin(e.yaw)*Math.cos(e.pitch)*e.dist+e.panX,n=Math.sin(e.pitch)*e.dist,r=Math.cos(e.yaw)*Math.cos(e.pitch)*e.dist+e.panY;return[t,n,r]}function Kj(e,t,n){const r=t*Math.min(n,1-n),a=i=>{const s=(i+e*12)%12;return n-r*Math.max(-1,Math.min(Math.min(s-3,9-s),1))};return[a(0),a(8),a(4)]}function ZG(e,t){if(e===255)return[.85,.85,.3];const n=e/Math.max(1,t)*.83+.04;return Kj(n,.75,.6)}function k0(e,t,n){return e<t?t:e>n?n:e}function eV(e,t,n,r,a,i){switch(i){case"speed":return k0(Math.sqrt(e*e+t*t)*2.5,0,1);case"energy":return k0(n,0,1);case"geneA":return r;case"geneB":return r;case"age":return k0(a/8e3,0,1);default:return .4}}function tV(e,t,n,r,a,i){switch(i){case"coherence":return e;case"arousal":return t;case"charge":return n;case"inhibition":return r;case"valence":return(a+1)*.5;default:return .4}}const X4={complexityLife:[{id:"speed",label:"Velocidade"},{id:"energy",label:"Energia"},{id:"geneA",label:"Gene A"},{id:"age",label:"Idade"}],sociogenesis:[{id:"speed",label:"Velocidade"},{id:"prestige",label:"Prestgio"},{id:"meme",label:"Meme"}],psycheLab:[{id:"coherence",label:"Coerncia"},{id:"arousal",label:"Excitao"},{id:"charge",label:"Carga"},{id:"inhibition",label:"Inibio"},{id:"valence",label:"Valncia"}]},nV=[{id:"default",label:"Default"},{id:"topology",label:"Topologia"},{id:"energy",label:"Energia"},{id:"valence",label:"Valncia"},{id:"coherence",label:"Coerncia"}],J4=({on:e,label:t,color:n,onClick:r})=>o.jsx("button",{onClick:r,className:`text-[8px] font-mono px-1.5 py-0.5 transition-all ${e?"":"text-white/30 hover:text-white/50"}`,style:e?{color:n,border:`1px dashed ${n}44`,background:n+"0c"}:{border:"1px dashed transparent"},children:t}),Xj=({activeLab:e,config:t,onChange:n,onReset:r})=>{const a=X4[e]??X4.complexityLife,i=e==="psycheLab";return o.jsxs("div",{className:`fixed bottom-4 left-1/2 -translate-x-1/2 z-30 pointer-events-auto
        flex items-center gap-2.5 px-3 py-2`,style:{background:"rgba(0,0,0,0.94)",border:"1px dashed rgba(255,255,255,0.06)",flexWrap:"wrap",maxWidth:"90vw"},children:[o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx("span",{className:"text-[8px] uppercase tracking-widest text-white/25",children:"Altura"}),o.jsx("select",{value:t.zVar,onChange:s=>n({zVar:s.target.value}),className:"text-white/70 text-[9px] font-mono px-1.5 py-1 focus:outline-none cursor-pointer",style:{background:"rgba(255,255,255,0.03)",border:"1px dashed rgba(255,255,255,0.06)"},children:a.map(s=>o.jsx("option",{value:s.id,className:"bg-[#07050e]",children:s.label},s.id))})]}),o.jsx("div",{className:"w-px h-4 bg-white/10"}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-[8px] uppercase tracking-widest text-white/25",children:"Z"}),o.jsx("input",{type:"range",min:.1,max:1.4,step:.05,value:t.zScale,onChange:s=>n({zScale:parseFloat(s.target.value)}),className:`w-16 h-px bg-white/15 appearance-none cursor-pointer
            [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3
            [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:bg-white/60
            [&::-webkit-slider-thumb]:bg-purple-300/80`}),o.jsx("span",{className:"text-[9px] font-mono text-white/35 w-6",children:t.zScale.toFixed(2)})]}),o.jsx("div",{className:"w-px h-4 bg-white/10"}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-[8px] uppercase tracking-widest text-white/25",children:"Pt"}),o.jsx("input",{type:"range",min:2,max:12,step:.5,value:t.ptSize??5.5,onChange:s=>n({ptSize:parseFloat(s.target.value)}),className:`w-12 h-px bg-white/15 appearance-none cursor-pointer
            [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3
            [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:bg-white/60
            [&::-webkit-slider-thumb]:bg-cyan-300/80`}),o.jsx("span",{className:"text-[9px] font-mono text-white/35 w-5",children:(t.ptSize??5.5).toFixed(1)})]}),o.jsx("div",{className:"w-px h-4 bg-white/10"}),o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx("span",{className:"text-[8px] uppercase tracking-widest text-white/25",children:"Modo"}),["particles","terrain","hybrid"].map(s=>o.jsx("button",{onClick:()=>n({mode:s}),className:"text-[8px] px-2 py-0.5 font-mono transition-all",style:t.mode===s?{background:"rgba(139,92,246,0.10)",color:"#a78bfa",border:"1px dashed rgba(139,92,246,0.30)"}:{color:"rgba(255,255,255,0.25)",border:"1px dashed transparent"},children:s==="particles"?"Pts":s==="terrain"?"Terreno":"Hbrido"},s))]}),o.jsx("div",{className:"w-px h-4 bg-white/10"}),o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx("span",{className:"text-[8px] uppercase tracking-widest text-white/25 mr-0.5",children:"Vis"}),o.jsx(J4,{on:!!t.showTrails,label:"Rastros",color:"#a78bfa",onClick:()=>n({showTrails:!t.showTrails})}),o.jsx(J4,{on:!!t.showBonds,label:"Bonds",color:"#67e8f9",onClick:()=>n({showBonds:!t.showBonds})})]}),t.showTrails&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-px h-4 bg-white/10"}),o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx("span",{className:"text-[8px] text-white/25",children:"Len"}),o.jsx("input",{type:"range",min:4,max:32,step:2,value:t.trailLen??14,onChange:s=>n({trailLen:parseInt(s.target.value)}),className:`w-12 h-px bg-white/15 appearance-none cursor-pointer
                [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3
                [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:bg-white/60
                [&::-webkit-slider-thumb]:bg-purple-300/70`}),o.jsx("span",{className:"text-[9px] font-mono text-white/35 w-4",children:t.trailLen??14})]})]}),i&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-px h-4 bg-white/10"}),o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx("span",{className:"text-[8px] uppercase tracking-widest text-white/25",children:"Cor"}),o.jsx("select",{value:t.colorScheme3D??"default",onChange:s=>n({colorScheme3D:s.target.value}),className:"text-white/70 text-[9px] font-mono px-1.5 py-1 focus:outline-none cursor-pointer",style:{background:"rgba(255,255,255,0.03)",border:"1px dashed rgba(255,255,255,0.06)"},children:nV.map(s=>o.jsx("option",{value:s.id,className:"bg-[#07050e]",children:s.label},s.id))})]})]}),o.jsx("div",{className:"w-px h-4 bg-white/10"}),o.jsxs("button",{onClick:r,className:`flex items-center gap-1 text-[8px] text-white/30 hover:text-white/60
          transition-colors px-1 py-0.5`,title:"Resetar cmera",children:[o.jsx(El,{size:10}),o.jsx("span",{children:"Cmera"})]})]})},Q4={CALM:"#93c5fd",ALERT:"#fde047",PANIC:"#f87171",FLOW:"#86efac",FRAGMENTED:"#fdba74",INTEGRATING:"#c4b5fd"},rV=[[.96,.78,.26],[.69,.77,.87],[.49,.23,.93],[.96,.25,.37],[.52,.8,.09],[.23,.51,.96],[.96,.62,.07],[.42,.44,.63],[.39,.4,.95],[.02,.71,.83],[.93,.28,.6],[.94,.27,.27]],oV=({active:e,viewMode:t="2D",view3DConfig:n,onView3DConfigChange:r})=>{const a=S.useRef(null),i=S.useRef(Sb(600)),s=S.useRef(vb()),c=S.useRef(0),l=S.useRef(0),d=S.useRef(!0),u=S.useRef({..._5}),h=S.useRef({active:!1,lastX:0,lastY:0}),m=S.useRef(new Set),[f,g]=S.useState(1),[x,v]=S.useState(!1),b=S.useRef(null),[w,M]=S.useState("idle"),[k,R]=S.useState(0);S.useEffect(()=>(b.current=new Nf(M),()=>{var X;return(X=b.current)==null?void 0:X.dispose()}),[]),S.useEffect(()=>{if(w!=="recording"){R(0);return}const X=setInterval(()=>{var Z;R(((Z=b.current)==null?void 0:Z.elapsed)??0)},500);return()=>clearInterval(X)},[w]);const j=S.useCallback(X=>{var ue;const Z=i.current,ce=Z4(W);(ue=b.current)==null||ue.start(()=>[t==="3D"?E.current:a.current],()=>({labName:"Psyche Lab",lines:[`fase: ${Z.phase}    quanta: ${Z.count}`,`integrao: ${(Z.integrationIndex*100).toFixed(0)}%  tenso: ${(Z.tensionIndex*100).toFixed(0)}%  frag: ${(Z.fragmentationIndex*100).toFixed(0)}%`,`lens: ${s.current.lens}    preset: ${ce}`,`dana: ${s.current.danceIntensity.toFixed(2)}    arq.: ${Z.archetypeActive.filter(Boolean).length} ativos`]}),30,void 0,{format:(X==null?void 0:X.format)??"auto",quality:(X==null?void 0:X.quality)??"standard"})},[t]),I=S.useCallback(()=>{var X;(X=b.current)==null||X.stop()},[]),E=S.useRef(null),O=S.useRef(null),L=S.useRef({active:!1,lastX:0,lastY:0,shift:!1}),$=S.useRef(n??_u);S.useEffect(()=>{n&&($.current=n)},[n]);const[F,B]=S.useState("TOPOLOGY"),[W,re]=S.useState("mandala-calm"),[oe,te]=S.useState(!0),[J,pe]=S.useState(!1),[P,V]=S.useState(.22),[fe,ye]=S.useState(600),[Se,we]=S.useState(!1),[ke,De]=S.useState(!0),[_e,ae]=S.useState(!1),[Re,Fe]=S.useState(!1),[Oe,ne]=S.useState(!1),[nt,pt]=S.useState(!0),[Et,_t]=S.useState(!0),[Ct,Xe]=S.useState(!0),[Ut,Le]=S.useState(!1),[Ke,mt]=S.useState(!1),[an,gn]=S.useState("#000000"),[Be,ft]=S.useState(.06),[Qt,nr]=S.useState(.65),[_n,Rn]=S.useState(3),[sn,Cn]=S.useState(1),[wt,st]=S.useState(.8),[Zt,Pe]=S.useState(s.current.flowGain),[ct,vt]=S.useState(s.current.springK),[xe,ge]=S.useState(s.current.linkRadius),[Ee,me]=S.useState(s.current.breathPeriod),[je,Te]=S.useState(s.current.damping),[Ae,Tt]=S.useState(s.current.stateRelaxRate??1),[xt,en]=S.useState(s.current.frozenFlow??!1),[At,Ze]=S.useState(s.current.soulVis??0),[yt,Mt]=S.useState(i.current.phase),[bn,Pt]=S.useState(0),[An,cr]=S.useState(0),[Tn,Sr]=S.useState(0),[de,$e]=S.useState({eros:0,thanatos:0,repressao:0,idPower:.2,superegoForce:.15,egoStrength:.5,sublimacao:0}),[et,zt]=S.useState({real:.25,simbolico:.35,imaginario:.4,gozo:0,falta:.5,sujeito:0}),[Nt,ln]=S.useState([...i.current.archetypeStrength]),[Rt,Nn]=S.useState([...i.current.archetypeActive]),[It,xn]=S.useState(0),[Ln,zn]=S.useState(""),[Or,wr]=S.useState([]),vn=S.useRef("CALM"),[Gr,hn]=S.useState(!1),jr=S.useRef(0);S.useEffect(()=>(i.current,()=>{}),[]),S.useEffect(()=>{const X=E.current;if(!X)return;O.current=new nw(X);const Z=window.innerWidth,ce=window.innerHeight;return O.current.resize(Z,ce),()=>{var ue;(ue=O.current)==null||ue.dispose(),O.current=null}},[]),S.useEffect(()=>{const X=()=>{var Z;(Z=O.current)==null||Z.resize(window.innerWidth,window.innerHeight)};return window.addEventListener("resize",X),()=>window.removeEventListener("resize",X)},[]),S.useEffect(()=>{const X=E.current;if(!X)return;const Z=H=>{L.current={active:!0,lastX:H.clientX,lastY:H.clientY,shift:H.shiftKey}},ce=H=>{if(!L.current.active)return;const le=H.clientX-L.current.lastX,Je=H.clientY-L.current.lastY;L.current.lastX=H.clientX,L.current.lastY=H.clientY;const tt=$.current;let St;L.current.shift||H.shiftKey?St={...tt,camera:{...tt.camera,panX:tt.camera.panX+le*.002,panY:tt.camera.panY+Je*.002}}:St={...tt,camera:{...tt.camera,yaw:tt.camera.yaw+le*.008,pitch:k0(tt.camera.pitch+Je*.008,.04,Math.PI/2-.04)}},$.current=St,r==null||r(St)},ue=()=>{L.current.active=!1},be=H=>{H.preventDefault();const le=$.current,Je={...le,camera:{...le.camera,dist:k0(le.camera.dist*(1+H.deltaY*.001),.5,8)}};$.current=Je,r==null||r(Je)};return X.addEventListener("mousedown",Z),X.addEventListener("mousemove",ce),X.addEventListener("mouseup",ue),X.addEventListener("mouseleave",ue),X.addEventListener("wheel",be,{passive:!1}),()=>{X.removeEventListener("mousedown",Z),X.removeEventListener("mousemove",ce),X.removeEventListener("mouseup",ue),X.removeEventListener("mouseleave",ue),X.removeEventListener("wheel",be)}},[r]),S.useEffect(()=>{const X=a.current;if(!X)return;const Z=ce=>{if(t==="3D")return;ce.preventDefault();const ue=X.getBoundingClientRect(),be=ce.clientX-ue.left-ue.width/2,H=ce.clientY-ue.top-ue.height/2,le=u.current,Je=ce.deltaY>0?1/1.12:1.12,tt=Math.max(.12,Math.min(14,le.zoom*Je)),St=tt/le.zoom,$t=be+(le.panX-be)*St,rt=H+(le.panY-H)*St;u.current={zoom:tt,panX:$t,panY:rt},g(tt),v(Math.abs($t)>2||Math.abs(rt)>2)};return X.addEventListener("wheel",Z,{passive:!1}),()=>X.removeEventListener("wheel",Z)},[t]),S.useEffect(()=>{const X=a.current;if(!X)return;const Z=be=>{t!=="3D"&&(h.current={active:!0,lastX:be.clientX,lastY:be.clientY},X.style.cursor="grabbing")},ce=be=>{if(!h.current.active)return;const H=be.clientX-h.current.lastX,le=be.clientY-h.current.lastY;h.current.lastX=be.clientX,h.current.lastY=be.clientY,u.current={...u.current,panX:u.current.panX+H,panY:u.current.panY+le},v(!0)},ue=()=>{h.current.active=!1,X.style.cursor="grab";const{panX:be,panY:H}=u.current;v(Math.abs(be)>2||Math.abs(H)>2)};return X.addEventListener("mousedown",Z),window.addEventListener("mousemove",ce),window.addEventListener("mouseup",ue),X.addEventListener("mouseleave",ue),()=>{X.removeEventListener("mousedown",Z),window.removeEventListener("mousemove",ce),window.removeEventListener("mouseup",ue),X.removeEventListener("mouseleave",ue)}},[t]),S.useEffect(()=>{const X=ce=>{var H;const ue=(H=document.activeElement)==null?void 0:H.tagName;if(ue==="INPUT"||ue==="TEXTAREA"||ue==="SELECT"||t==="3D")return;const be=ce.key.toLowerCase();["w","a","s","d"].includes(be)&&(m.current.add(be),ce.preventDefault()),be==="r"&&(u.current={..._5},g(1),v(!1))},Z=ce=>{m.current.delete(ce.key.toLowerCase())};return window.addEventListener("keydown",X),window.addEventListener("keyup",Z),()=>{window.removeEventListener("keydown",X),window.removeEventListener("keyup",Z)}},[t]);const _r=S.useCallback(()=>{u.current={..._5},g(1),v(!1)},[]),Zn=S.useCallback((X,Z)=>{wr(ce=>{const ue={text:X,color:Z,time:i.current.elapsed};return[...ce.slice(-19),ue]})},[]),lo=S.useCallback(()=>{const X=O.current;if(!(X!=null&&X.isReady))return;const Z=i.current,ce=$.current,ue=[],be=ce.colorScheme3D??"default";for(let le=0;le<Z.count;le++){const Je=tV(Z.coherence[le],Z.arousal[le],Z.charge[le],Z.inhibition[le],Z.valence[le],ce.zVar),tt=Z.tag[le];let St=.5,$t=.4,rt=.8;if(be==="default")if(tt>0&&tt<=12)[St,$t,rt]=rV[tt-1];else{const Ft=Z.coherence[le];St=Ft*.9,$t=Ft*.6+.1,rt=.4+Ft*.4}else if(be==="energy"){const Ft=(200-Z.charge[le]*160)/360,Xt=.5+Z.arousal[le]*.5,dn=.35+Z.charge[le]*.3;[St,$t,rt]=Kj(Ft,Xt,dn)}else if(be==="valence")Z.valence[le]>=0?(St=.1,$t=.3+Z.valence[le]*.5,rt=.15):(St=.3+-Z.valence[le]*.5,$t=.1,rt=.1);else if(be==="coherence")St=.1+Z.coherence[le]*.2,$t=.1+Z.coherence[le]*.3,rt=.25+Z.coherence[le]*.5;else if(be==="topology"){const Ft=Z.x[le],Xt=Z.y[le];Math.sqrt(Ft*Ft+Xt*Xt)<.14?(St=.96,$t=.78,rt=.26):Xt<-.3?(St=.61,$t=.72,rt=.97):Xt>.45?(St=.94,$t=.27,rt=.27):(St=.49,$t=.23,rt=.93,rt=.6)}ue.push({nx:Z.x[le],ny:Z.y[le],z:Je,r:St,g:$t,b:rt})}const H=[];if(ce.showBonds)for(let le=0;le<Z.linkCount;le++)H.push({a:Z.linkA[le],b:Z.linkB[le]});X.render(ue,ce,void 0,ce.showBonds?H:[])},[]);S.useEffect(()=>{if(!e){cancelAnimationFrame(c.current);return}const X=Z=>{if(c.current=requestAnimationFrame(X),!a.current)return;const ce=Math.min(.05,(Z-l.current)/1e3);l.current=Z;const ue=i.current,be=s.current;if(d.current&&(UW(ue,be,ce),ue.journeyActive&&QW(ue,ce,H=>{xn(H.act),zn(`Ato ${H.act+1}: ${H.name}`)},H=>zn(H)),Z-jr.current>450)){XW(ue),jr.current=Z,Mt(ue.phase),Pt(ue.integrationIndex),cr(ue.tensionIndex),Sr(ue.fragmentationIndex);let H=0,le=0,Je=0,tt=0,St=0,$t=0,rt=0,Ft=0;for(let Bt=0;Bt<ue.count;Bt++){const qt=ZS(ue,Bt);qt==="EROS"?H++:qt==="THANATOS"?le++:qt==="REPRESSAO"?Je++:tt++;const mn=ue.y[Bt];mn>.28?St++:mn<-.3?$t++:(rt++,Ft+=ue.coherence[Bt])}const Xt=ue.count||1;$e({eros:H/Xt,thanatos:le/Xt,repressao:Je/Xt,sublimacao:tt/Xt,idPower:St/Xt,superegoForce:$t/Xt,egoStrength:rt>0?Ft/rt:0});let dn=0,kn=0,ar=0,jn=0;for(let Bt=0;Bt<ue.count;Bt++){const qt=ue.x[Bt],mn=ue.y[Bt],dr=Math.sqrt(qt*qt+mn*mn),rr=mn>.4||dr>.75?"R":mn<-.35||Math.abs(qt)>.3&&mn<-.1?"S":"I";rr==="R"?(dn++,jn+=ue.charge[Bt]*ue.arousal[Bt]):rr==="S"?kn++:ar++}const yr=Math.min(1,ue.linkCount/Math.max(1,gf*.3));zt({real:dn/Xt,simbolico:Math.min(1,kn/Xt*.7+yr*.3),imaginario:ar/Xt,gozo:dn>0?Math.min(1,jn/dn):0,falta:1-ue.integrationIndex,sujeito:ue.fragmentationIndex}),ue.phase!==vn.current&&(Zn(`Fase  ${ue.phase}`,Q4[ue.phase]),vn.current=ue.phase)}if(t!=="3D"&&m.current.size>0){const H=4.5/u.current.zoom,le=u.current;let{panX:Je,panY:tt}=le;m.current.has("a")&&(Je+=H),m.current.has("d")&&(Je-=H),m.current.has("w")&&(tt+=H),m.current.has("s")&&(tt-=H),u.current={...le,panX:Je,panY:tt}}t!=="3D"&&SG(a.current,ue,be.lens,Se,Z4(W),{rastrosOn:_e,campoOn:Re,fieldOn:Oe,bondsOn:nt,overlayOn:Et,overlayJung:Ct,overlayLacan:Ut,overlayFreud:Ke,trailFade:Be,trailOpacity:Qt,trailWidth:_n,soulVis:At,bondWidth:sn,bondOpacity:wt,bgColor:an},u.current),t==="3D"&&lo()};return l.current=performance.now(),c.current=requestAnimationFrame(X),()=>cancelAnimationFrame(c.current)},[e,Se,W,_e,Re,Oe,nt,Et,Ct,Ut,Ke,Be,Qt,_n,t,lo,an]),S.useEffect(()=>{s.current.lens=F},[F]);const ir=S.useCallback(X=>{const Z=wG(X);if(!Z)return;const ce=s.current;Object.assign(ce,vb(),Z.config),ce.lens=F,ce.archetypesOn=oe;const ue=Z.quantaCount??600;ce.quantaTarget=ue;const be=Sb(ue);if(Z.archetypeActive)for(let H=0;H<12;H++)be.archetypeActive[H]=Z.archetypeActive.includes(Pu[H]);if(Z.archetypeStrengths)for(let H=0;H<12;H++){const le=Z.archetypeStrengths[Pu[H]];le!==void 0&&(be.archetypeStrength[H]=le)}i.current=be,Rb(),wr([]),ye(ue),ln([...be.archetypeStrength]),Nn([...be.archetypeActive]),V(ce.danceIntensity),Pe(ce.flowGain),vt(ce.springK),ge(ce.linkRadius),me(ce.breathPeriod),Te(ce.damping),Tt(ce.stateRelaxRate??1),en(ce.frozenFlow??!1),Ze(ce.soulVis??0),Z.journeyMode||(H4(be),pe(!1)),re(X),Zn(`Preset: ${Z.name}`,"#c4b5fd")},[F,oe,Zn]);S.useEffect(()=>{ir("mandala-calm")},[]);const to=S.useCallback(X=>{const Z=i.current,ce=s.current;for(let be=0;be<12;be++){const H=Pu[be];Z.archetypeActive[be]=H in X.archetypeWeights,Z.archetypeStrength[be]=X.archetypeWeights[H]??.15}const ue=vb();Object.assign(ce,ue,X.configMods),ce.lens=F,ce.archetypesOn=oe,ln([...Z.archetypeStrength]),Nn([...Z.archetypeActive]),X.configMods.danceIntensity!=null&&V(X.configMods.danceIntensity),Pe(ce.flowGain),vt(ce.springK),ge(ce.linkRadius),me(ce.breathPeriod),Rb(),wr([]),Zn(` "${X.name}"  ${X.description.slice(0,60)}`,X.color),re("")},[F,oe,Zn]),Er=()=>{d.current=!d.current,De(d.current)},Eo=()=>{Object.assign(i.current,Sb(fe)),Rb(),wr([]),vn.current="CALM",ir(W||"mandala-calm")},oa=()=>{const X=!oe;te(X),s.current.archetypesOn=X},ja=()=>{const X=i.current;J?(H4(X),pe(!1),zn("")):(eG(X),pe(!0),xn(0),zn("Ato 1: Descent  a jornada comea."),Zn(" Red Book Journey iniciado.","#c4b5fd"))},Co=X=>{qW(i.current,X,s.current),ye(X)},Ya=X=>{s.current.danceIntensity=X,s.current.maxSpeed=.18*(X/.2),V(X)},qo=X=>{s.current.lens=X,B(X)},os=(X,Z)=>{i.current.archetypeStrength[X]=Z,ln(ce=>{const ue=[...ce];return ue[X]=Z,ue})},Ho=X=>{i.current.archetypeActive[X]=!i.current.archetypeActive[X],Nn(Z=>{const ce=[...Z];return ce[X]=i.current.archetypeActive[X],ce})},fs=X=>{s.current.flowGain=X,Pe(X)},To=X=>{s.current.springK=X,vt(X)},Xo=X=>{s.current.linkRadius=X,ge(X)},ks=X=>{s.current.breathPeriod=X,me(X)},D=X=>{s.current.damping=X,Te(X)},ee=X=>{s.current.stateRelaxRate=X,Tt(X)},Ie=()=>{const X=!s.current.frozenFlow;s.current.frozenFlow=X,en(X)},Qe=X=>{s.current.soulVis=X,Ze(X)};return o.jsxs("div",{style:{display:e?"block":"none"},className:"fixed inset-0 z-0",children:[o.jsx("canvas",{ref:a,className:"w-full h-full block",style:{background:an,display:t==="3D"?"none":"block",cursor:h.current.active?"grabbing":"grab"}}),o.jsx("canvas",{ref:E,className:"absolute inset-0 w-full h-full",style:{display:t==="3D"?"block":"none",pointerEvents:t==="3D"?"auto":"none",cursor:"grab",background:"#000"}}),t==="3D"&&o.jsx(Xj,{activeLab:"psycheLab",config:n??$.current,onChange:X=>{const Z={...$.current,...X};$.current=Z,r==null||r(Z)},onReset:()=>{$.current={..._u},r==null||r({..._u})}}),t!=="3D"&&o.jsxs("div",{style:{position:"fixed",bottom:14,right:14,zIndex:30,display:"flex",flexDirection:"column",alignItems:"flex-end",gap:5,pointerEvents:"none",userSelect:"none"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"3px 10px",background:"rgba(0,0,0,0.92)",border:"1px dashed rgba(255,255,255,0.06)"},children:[o.jsx("span",{style:{fontFamily:"'Doto', monospace",fontSize:8,color:"rgba(255,255,255,0.22)",letterSpacing:"0.1em",textTransform:"uppercase"},children:"zoom"}),o.jsxs("span",{style:{fontFamily:"'IBM Plex Mono', monospace",fontSize:9,color:"#8b5cf690"},children:[f.toFixed(2),""]}),x&&o.jsx("span",{style:{fontFamily:"'IBM Plex Mono', monospace",fontSize:8,color:"rgba(255,255,255,0.22)"},children:"pan"})]}),(Math.abs(f-1)>.02||x)&&o.jsx("button",{onClick:_r,style:{pointerEvents:"auto",padding:"3px 10px",fontFamily:"'IBM Plex Mono', monospace",fontSize:8,letterSpacing:"0.08em",textTransform:"uppercase",background:"rgba(139,92,246,0.06)",border:"1px dashed rgba(139,92,246,0.22)",color:"rgba(139,92,246,0.65)",cursor:"pointer",transition:"all 0.15s"},children:"[R] reset view"}),o.jsx("div",{style:{padding:"2px 8px",background:"rgba(0,0,0,0.80)",border:"1px dashed rgba(255,255,255,0.04)"},children:o.jsx("span",{style:{fontFamily:"'IBM Plex Mono', monospace",fontSize:7,color:"rgba(255,255,255,0.14)"},children:"scroll=zoom  drag=pan  wasd=navegar"})})]}),!Se&&t!=="3D"&&o.jsx(DG,{presetId:W,lens:F,archetypesOn:oe,journeyOn:J,journeyAct:It,journeyChapter:Ln,quantaCount:fe,danceIntensity:P,phase:yt,integrationIndex:bn,tensionIndex:An,fragmentIndex:Tn,archetypeStrengths:Nt,archetypeActive:Rt,flowGain:Zt,springK:ct,linkRadius:xe,breathPeriod:Ee,trailOn:_e,campoOn:Re,fieldOn:Oe,narrativeLog:Or,onPresetChange:ir,onLensChange:qo,onArchetypesToggle:oa,onJourneyToggle:ja,onQuantaChange:Co,onDanceChange:Ya,onFlowGainChange:fs,onSpringKChange:To,onLinkRadiusChange:Xo,onBreathPeriodChange:ks,onArchStrengthChange:os,onArchActiveToggle:Ho,onCinematicToggle:()=>we(X=>!X),cinematicMode:Se,onTrailToggle:()=>ae(X=>!X),onCampoToggle:()=>Fe(X=>!X),onFieldToggle:()=>ne(X=>!X),bondsOn:nt,onBondsToggle:()=>pt(X=>!X),overlayOn:Et,onOverlayToggle:()=>_t(X=>!X),overlayJung:Ct,overlayLacan:Ut,overlayFreud:Ke,onOverlayJungToggle:()=>Xe(X=>!X),onOverlayLacanToggle:()=>Le(X=>!X),onOverlayFreudToggle:()=>mt(X=>!X),bgColor:an,onBgColorChange:gn,trailFade:Be,trailOpacity:Qt,trailWidth:_n,onTrailFadeChange:ft,onTrailOpacityChange:nr,onTrailWidthChange:Rn,bondWidth:sn,bondOpacity:wt,onBondWidthChange:Cn,onBondOpacityChange:st,running:ke,onToggleRun:Er,onReset:Eo,onOpenConsciousness:()=>hn(!0),freudMetrics:de,lacanMetrics:et,damping:je,stateRelaxRate:Ae,frozenFlow:xt,soulVis:At,onDampingChange:D,onStateRelaxChange:ee,onFrozenFlowToggle:Ie,onSoulVisChange:Qe}),t==="3D"&&o.jsxs("div",{style:{position:"fixed",top:50,left:"50%",transform:"translateX(-50%)",zIndex:20,pointerEvents:"none",display:"flex",alignItems:"center",gap:12,padding:"5px 16px",background:"rgba(0,0,0,0.92)",border:"1px dashed rgba(255,255,255,0.06)"},children:[o.jsx("span",{style:{fontFamily:"'Doto', monospace",fontSize:8,color:"rgba(255,255,255,0.25)",letterSpacing:"0.1em",textTransform:"uppercase"},children:"Psyche 3D"}),o.jsxs("span",{style:{fontFamily:"'IBM Plex Mono', monospace",fontSize:8,color:Q4[yt]+"aa"},children:[yt,"  ",i.current.count," quanta"]}),o.jsxs("span",{style:{fontFamily:"'IBM Plex Mono', monospace",fontSize:8,color:"rgba(255,255,255,0.18)"},children:["Z: ",(n==null?void 0:n.zVar)??"coherence"]}),o.jsx("span",{style:{fontFamily:"'IBM Plex Mono', monospace",fontSize:8,color:"rgba(255,255,255,0.14)",fontStyle:"italic"},children:"drag=rbita  shift+drag=pan  roda=zoom"})]}),Se&&t!=="3D"&&o.jsx("button",{onClick:()=>we(!1),style:{position:"fixed",top:50,right:10,zIndex:30,fontFamily:"'IBM Plex Mono', monospace",fontSize:9,color:"rgba(255,255,255,0.18)",background:"none",border:"none",cursor:"pointer",letterSpacing:"0.08em",textTransform:"uppercase",transition:"color 0.15s"},children:"[H] show HUD"}),Gr&&o.jsx(GG,{onClose:()=>hn(!1),onInvoke:to}),o.jsx(km,{state:w,elapsed:k,onStart:j,onStop:I,className:"fixed bottom-4 left-4 z-40"})]})};function Z4(e){var t;return((t=gy.find(n=>n.id===e))==null?void 0:t.name)??"Psyche Lab"}const aV="modulepreload",sV=function(e){return"/"+e},eC={},Ec=function(t,n,r){let a=Promise.resolve();if(n&&n.length>0){let s=function(d){return Promise.all(d.map(u=>Promise.resolve(u).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),l=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));a=s(n.map(d=>{if(d=sV(d),d in eC)return;eC[d]=!0;const u=d.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${h}`))return;const m=document.createElement("link");if(m.rel=u?"stylesheet":aV,u||(m.as="script"),m.crossOrigin="",m.href=d,l&&m.setAttribute("nonce",l),document.head.appendChild(m),u)return new Promise((f,g)=>{m.addEventListener("load",f),m.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${d}`)))})}))}function i(s){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=s,window.dispatchEvent(c),!c.defaultPrevented)throw s}return a.then(s=>{for(const c of s||[])c.status==="rejected"&&i(c.reason);return t().catch(i)})},_b=.12,Kd=.72;function Jg(e){return Math.abs(e)<_b?0:(e-Math.sign(e)*_b)/(1-_b)}function yf(){return{a:!1,b:!1,x:!1,y:!1,lb:!1,rb:!1,start:!1,select:!1,dpadUp:!1,dpadDown:!1,dpadLeft:!1,dpadRight:!1,l3:!1,r3:!1}}function tC(){return{connected:!1,name:"",axes:{lx:0,ly:0,rx:0,ry:0},triggers:{lt:0,rt:0},buttons:yf(),justPressed:yf(),justReleased:yf()}}const nC=[[0,"a"],[1,"b"],[2,"x"],[3,"y"],[4,"lb"],[5,"rb"],[8,"select"],[9,"start"],[10,"l3"],[11,"r3"],[12,"dpadUp"],[13,"dpadDown"],[14,"dpadLeft"],[15,"dpadRight"]];class iV{constructor(){this.padIndex=-1,this.prevButtons={},this._state=tC(),this.smoothLx=0,this.smoothLy=0,this.smoothRx=0,this.smoothRy=0,this.repeatTimers={},this.REPEAT_INITIAL=400,this.REPEAT_RATE=160,this.hapticCount=0,this.hapticResetTime=0,this.HAPTIC_BUDGET=10}poll(t=performance.now()){const n=navigator.getGamepads?navigator.getGamepads():[];let r=null;if(this.padIndex>=0&&(r=n[this.padIndex]??null),!r||!r.connected){this.padIndex=-1;for(const x of n)if(x&&x.connected){r=x,this.padIndex=x.index;break}}if(!r||!r.connected)return this._state=tC(),this._state;const a=Jg(r.axes[0]??0),i=Jg(r.axes[1]??0),s=Jg(r.axes[2]??0),c=Jg(r.axes[3]??0);this.smoothLx=this.smoothLx*Kd+a*(1-Kd),this.smoothLy=this.smoothLy*Kd+i*(1-Kd),this.smoothRx=this.smoothRx*Kd+s*(1-Kd),this.smoothRy=this.smoothRy*Kd+c*(1-Kd);const l=x=>{var v;return!!((v=r.buttons[x])!=null&&v.pressed)},d=x=>{var v;return((v=r.buttons[x])==null?void 0:v.value)??0},u=yf();for(const[x,v]of nC)u[v]=l(x);const h=Math.max(d(6),r.axes[4]!==void 0?(r.axes[4]+1)/2:0),m=Math.max(d(7),r.axes[5]!==void 0?(r.axes[5]+1)/2:0),f=yf(),g=yf();for(const[,x]of nC){const v=u[x],b=this.prevButtons[x]??!1;f[x]=v&&!b,g[x]=!v&&b,this.prevButtons[x]=v}return this._state={connected:!0,name:r.id,axes:{lx:this.smoothLx,ly:this.smoothLy,rx:this.smoothRx,ry:this.smoothRy},triggers:{lt:h,rt:m},buttons:u,justPressed:f,justReleased:g},this._state}get current(){return this._state}rumble(t,n,r=.5,a=.5){const i=performance.now();if(i-this.hapticResetTime>1e3&&(this.hapticCount=0,this.hapticResetTime=i),this.hapticCount>=this.HAPTIC_BUDGET)return;this.hapticCount++;const s=navigator.getGamepads?navigator.getGamepads():[],c=this.padIndex>=0?s[this.padIndex]:null;if(!c)return;const l=c.vibrationActuator;if(l)try{l.playEffect("dual-rumble",{startDelay:0,duration:n,weakMagnitude:a*t,strongMagnitude:r*t})}catch{}}}let Nb=null;function rw(){return Nb||(Nb=new iV),Nb}function Ob({value:e,color:t="rgba(80,230,140,0.8)",label:n}){return o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginBottom:3},children:[o.jsx("span",{style:{width:60,fontSize:9,color:"rgba(255,255,255,0.38)",textTransform:"uppercase",letterSpacing:"0.08em",textAlign:"right"},children:n}),o.jsx("div",{style:{width:60,height:4,background:"rgba(255,255,255,0.1)",borderRadius:2},children:o.jsx("div",{style:{width:`${Math.min(1,Math.max(0,e))*100}%`,height:"100%",background:t,borderRadius:2}})})]})}const Jj=({ctrl:e,toolName:t,presetName:n,radius:r,intensity:a,quantaCount:i,showHUD:s})=>!e.connected||!s?null:o.jsxs("div",{style:{position:"absolute",bottom:48,left:10,background:"rgba(4,6,12,0.82)",border:"1px solid rgba(80,230,140,0.18)",borderRadius:6,padding:"8px 12px",pointerEvents:"none",zIndex:40,backdropFilter:"blur(4px)"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginBottom:7,borderBottom:"1px solid rgba(255,255,255,0.07)",paddingBottom:5},children:[o.jsx("div",{style:{width:6,height:6,borderRadius:"50%",background:"rgba(80,230,140,0.8)",flexShrink:0}}),o.jsx("span",{style:{fontSize:8,color:"rgba(80,230,140,0.7)",letterSpacing:"0.1em"},children:e.name.slice(0,20)})]}),o.jsx("div",{style:{fontSize:10,color:"rgba(255,255,255,0.8)",letterSpacing:"0.06em",marginBottom:6},children:t.toUpperCase()}),o.jsx(Ob,{value:a,color:"rgba(80,230,140,0.8)",label:"RT"}),o.jsx(Ob,{value:e.triggers.lt,color:"rgba(200,100,80,0.8)",label:"LT"}),o.jsx(Ob,{value:r,color:"rgba(140,160,255,0.8)",label:"RAIO"}),o.jsx("div",{style:{marginTop:6,fontSize:8,color:"rgba(255,255,255,0.3)",letterSpacing:"0.06em"},children:n.slice(0,22)}),i!==void 0&&o.jsxs("div",{style:{fontSize:8,color:"rgba(255,255,255,0.2)",fontFamily:"monospace",marginTop:2},children:["Q ",i]}),o.jsx("div",{style:{marginTop:8,display:"flex",flexDirection:"column",gap:2},children:[["LB / RB","ferramenta"],["D  ","preset"],["Y","snapshot"],["A","HUD on/off"],["SEL","cinem."]].map(([c,l])=>o.jsxs("div",{style:{display:"flex",gap:5,alignItems:"center"},children:[o.jsx("span",{style:{fontSize:7,color:"rgba(200,180,100,0.7)",minWidth:36,textAlign:"right",fontFamily:"monospace"},children:c}),o.jsx("span",{style:{fontSize:7,color:"rgba(255,255,255,0.25)"},children:l})]},c))})]});function Qj({open:e,onClose:t,ctrl:n,presetsSection:r,toolsSection:a}){const i=[r,a],[s,c]=S.useState(0),[l,d]=S.useState(0),u=S.useRef({dpadUp:!1,dpadDown:!1,dpadLeft:!1,dpadRight:!1,a:!1,b:!1,start:!1});return S.useEffect(()=>{e&&(d(0),c(0))},[e]),S.useEffect(()=>{if(!e)return;const h=u.current,m=n.buttons;if(m.dpadUp&&!h.dpadUp&&d(f=>Math.max(0,f-1)),m.dpadDown&&!h.dpadDown&&d(f=>{var g;return Math.min((((g=i[s])==null?void 0:g.items.length)??1)-1,f+1)}),m.dpadLeft&&!h.dpadLeft&&(c(f=>Math.max(0,f-1)),d(0)),m.dpadRight&&!h.dpadRight&&(c(f=>Math.min(i.length-1,f+1)),d(0)),m.a&&!h.a){const f=i[s];f&&(f.onSelect(f.items[l]),t())}(m.b&&!h.b||m.start&&!h.start)&&t(),u.current={dpadUp:m.dpadUp,dpadDown:m.dpadDown,dpadLeft:m.dpadLeft,dpadRight:m.dpadRight,a:m.a,b:m.b,start:m.start}},[n,e]),e?o.jsxs("div",{style:{position:"fixed",inset:0,zIndex:200,background:"rgba(4,6,12,0.88)",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(6px)"},children:[o.jsx("div",{style:{display:"flex",gap:32,maxHeight:"80vh"},children:i.map((h,m)=>o.jsxs("div",{style:{minWidth:180,background:s===m?"rgba(255,255,255,0.04)":"transparent",borderRadius:8,padding:"14px 8px",border:s===m?"1px solid rgba(80,230,140,0.25)":"1px solid rgba(255,255,255,0.06)"},children:[o.jsx("div",{style:{fontSize:9,color:s===m?"rgba(80,230,140,0.8)":"rgba(255,255,255,0.3)",letterSpacing:"0.16em",textTransform:"uppercase",marginBottom:10,paddingLeft:8},children:h.label}),o.jsx("div",{style:{overflowY:"auto",maxHeight:"65vh"},children:h.items.map((f,g)=>{const x=m===s&&g===l;return o.jsx("div",{onClick:()=>{h.onSelect(f),t()},style:{padding:"7px 10px",cursor:"pointer",borderRadius:5,background:x?"rgba(80,230,140,0.15)":"transparent",color:x?"rgba(255,255,255,0.95)":"rgba(255,255,255,0.45)",fontSize:11,letterSpacing:"0.04em",borderLeft:x?"2px solid rgba(80,230,140,0.6)":"2px solid transparent",transition:"all 0.1s"},children:h.getLabel(f)},g)})})]},m))}),o.jsx("div",{style:{position:"absolute",bottom:24,left:"50%",transform:"translateX(-50%)",display:"flex",gap:20},children:[["D  ","coluna"],["D  ","item"],["A","selecionar"],["B / START","fechar"]].map(([h,m])=>o.jsxs("div",{style:{display:"flex",gap:4,alignItems:"center"},children:[o.jsx("span",{style:{fontSize:10,color:"rgba(200,180,100,0.8)",fontFamily:"monospace"},children:h}),o.jsx("span",{style:{fontSize:9,color:"rgba(255,255,255,0.3)"},children:m})]},h))})]}):null}const dd={major:[0,2,4,5,7,9,11],minor:[0,2,3,5,7,8,10],pentatonic:[0,2,4,7,9],blues:[0,3,5,6,7,10],dorian:[0,2,3,5,7,9,10],phrygian:[0,1,3,5,7,8,10],lydian:[0,2,4,6,7,9,11],mixolydian:[0,2,4,5,7,9,10],whole_tone:[0,2,4,6,8,10],harmonic_minor:[0,2,3,5,7,8,11],chromatic:[0,1,2,3,4,5,6,7,8,9,10,11]},ga={KICK:"#ff3b5c",BASS:"#ff8c00",PERC:"#00e5ff",PAD:"#9b59ff",LEAD:"#39ff70",ARP:"#00d4c8",STRINGS:"#ffd700",CHOIR:"#ff69b4"},yy={KICK:0,BASS:28,PERC:190,PAD:270,LEAD:135,ARP:175,STRINGS:48,CHOIR:330};function lV(e){return 440*Math.pow(2,(e-69)/12)}function g0(e,t,n){const r=dd[n],a=Math.floor((e-t)/12),i=((e-t)%12+12)%12;let s=r[0],c=12;for(const l of r){const d=Math.abs(l-i);d<c&&(c=d,s=l)}return t+a*12+s}function Zj(e,t){const n=((t-e)%12+12)%12;return{0:1,7:.9,5:.8,4:.7,3:.65,9:.65,2:.35,10:.35,8:.3,6:.15,1:.1,11:.1}[n]??.2}const ai={damping:.962,cohesion:1.3,separation:1.1,maxSpeed:.38,gravityX:0,gravityY:0,turbulence:.28,mutationRate:.1,energyTransfer:.38,entainment:.45,predatorPrey:!1,motionStyle:"swarm",alignment:.8,zoneRadius:.18,vortexForce:0,burstRate:.3,migrationX:0,migrationY:1,clusterTarget:6,polarize:.5},rC={KICK:{BASS:-.04,PERC:-.03},BASS:{KICK:.06,LEAD:.018},PERC:{KICK:-.025},LEAD:{BASS:.045,ARP:-.02},PAD:{CHOIR:.018},ARP:{LEAD:.032,STRINGS:.015},STRINGS:{PAD:.025,CHOIR:.018},CHOIR:{STRINGS:.02}};function O5(){const e=["KICK","BASS","PERC","PAD","LEAD","ARP","STRINGS","CHOIR"],t={};for(const n of e){t[n]={};for(const r of e)t[n][r]=0}return t}const Nv={mode:"role",bgColor:"#050810",accent:"#00d4ff",roleColorOverrides:{}},f0=()=>Math.random(),jo=()=>(Math.random()-.5)*2;function cV(e){let t=1/0,n=-1/0,r=1/0,a=-1/0;for(const[s,c]of e.pts)s<t&&(t=s),s>n&&(n=s),c<r&&(r=c),c>a&&(a=c);const i=[t,n,r,a];return e._bb=i,i}function dV(e){let t=2166136261;for(let n=0;n<e.length;n++)t^=e.charCodeAt(n),t=Math.imul(t,16777619);return t>>>0}function uV(e){let t=e>>>0;return()=>{t|=0,t=t+1831565813|0;let n=Math.imul(t^t>>>15,1|t);return n=n+Math.imul(n^n>>>7,61|n)^n,((n^n>>>14)>>>0)/4294967296}}const Kl=(e,t,n)=>Math.max(t,Math.min(n,e)),bo=e=>(e()-.5)*2;function oC(e,t,n,r,a,i,s,c){const l=n-e,d=r-t,u=s-a,h=c-i,m=l*h-d*u;if(Math.abs(m)<1e-10)return!1;const f=((a-e)*h-(i-t)*u)/m,g=((a-e)*d-(i-t)*l)/m;return f>=0&&f<=1&&g>=0&&g<=1}function aC(e,t,n){return[Math.cos(t*2.4+n*.4)*.5+Math.cos(e*2.4*.7+n*.7)*.5,Math.sin(e*2.4+n*.4)*.5+Math.sin(t*2.4*.7+n*.7)*.5]}function hV(e){const t=[],n=Object.values(e.roles).reduce((r,a)=>r+a.proportion,0);for(const[r,a]of Object.entries(e.roles)){const i=Math.max(1,Math.round(a.proportion/n*64));for(let s=0;s<i;s++)t.push(r)}return t}function by(e,t,n,r,a,i=f0){const s=t.roles[n],c=(s==null?void 0:s.pitchRange)??[48,84],l=g0(Math.round(c[0]+i()*(c[1]-c[0])),t.root,t.scale),d=r??bo(i)*.82,u=a??bo(i)*.82;return{id:e,role:n,x:d,y:u,vx:bo(i)*.028,vy:bo(i)*.028,prevX:d,prevY:u,phase:i(),pitch:l,brightness:.3+i()*.5,charge:.2+i()*.5,hue:yy[n],cooldown:i()*1.2,trailX:[],trailY:[],age:0,dischargeTimer:0,recentlyFired:0,selected:!1,mutations:0,phaseLocked:-1,roleLockTimer:0,timbreIdx:-1}}function fV(e,t){const n=[],r=e.gateCount??0;if(r<=0)return n;const a=new Set((e.tags??[]).map(String)),s=a.has("Experimental")||a.has("Dark")||e.intensity>=4?["gate","gate","mirror","mirror","absorber","membrane","membrane"]:["gate","gate","gate","mirror"],c={gate:[e.primary,e.secondary,e.accent,"#fff"],mirror:["#c8e8ff","#d8f0ff","#a8d8ef"],absorber:["#dd3333","#cc1111","#ff4444"],membrane:["#dd66ff","#cc44ff","#aa22ee"]};for(let l=0;l<r;l++){const d=s[Math.floor(t()*s.length)],u=bo(t)*.62,h=bo(t)*.62,m=t()*Math.PI,f=.1+t()*.55;n.push({x1:u-Math.cos(m)*f,y1:h-Math.sin(m)*f,x2:u+Math.cos(m)*f,y2:h+Math.sin(m)*f,cooldown:0,color:c[d][l%c[d].length],type:d})}return n}function pV(e,t){const n=[],r=e.attractorCount??0;if(r<=0)return n;const a=new Set((e.tags??[]).map(String)),s=a.has("Techno")||a.has("Club")||a.has("Groove")||a.has("Breakbeat")||e.bpm>=118?["metro","attractor","attractor","vortex","repulsor"]:["attractor","attractor","vortex","repulsor"];n.push({x:0,y:0,strength:.06+t()*.1,vortexStr:0,radius:.65+t()*.35,type:"attractor"});for(let c=1;c<r;c++){const l=s[Math.floor(t()*s.length)],d=bo(t)*.78,u=bo(t)*.78,h=.04+t()*.2,m=.18+t()*.65;l==="vortex"?n.push({x:d,y:u,strength:0,vortexStr:h*(.55+t()*.45),radius:m,type:"vortex"}):l==="repulsor"?n.push({x:d,y:u,strength:-h,vortexStr:0,radius:m,type:"repulsor"}):l==="metro"?n.push({x:d,y:u,strength:h*(.8+t()*.6),vortexStr:0,radius:m,type:"metro"}):n.push({x:d,y:u,strength:h,vortexStr:0,radius:m,type:"attractor"})}return n}function mV(e,t,n,r){const a=e.motionStyle;if(n<=0)return null;switch(a){case"orbit":{const i=t/n*Math.PI*2+bo(r)*.35,s=.35+r()*.18;return[Math.cos(i)*s,Math.sin(i)*s]}case"lattice":{const i=Math.max(3,Math.round(Math.sqrt(n))),s=t%i/(i-1)*2-1,c=Math.floor(t/i)/(i-1)*2-1;return[s*.72+bo(r)*.03,c*.72+bo(r)*.03]}case"meditation":case"drift":return[bo(r)*.22,bo(r)*.22];case"migration":case"exodus":{const i=Math.floor(r()*4),s=bo(r)*.78;return i===0?[-.92,s]:i===1?[.92,s]:i===2?[s,-.92]:[s,.92]}case"ballistic":return[bo(r)*.85,.85+r()*.25];default:return null}}function gV(e,t,n){if(t.id==="blank-canvas"||t.quantaCount<=0)return;const r=new Set((t.tags??[]).map(String)),a=r.has("Techno")||r.has("Club")||r.has("Groove")||r.has("Breakbeat")||r.has("Rave")||t.bpm>=118,i=r.has("Experimental")||r.has("Space")||t.name.toLowerCase().includes("quantum"),s=r.has("Strings")||r.has("Orchestral")||r.has("Choral"),c=r.has("Minimalist")||t.id==="solo-particle"||t.quantaCount<=2;if(!c&&(t.motionStyle==="flow"||t.motionStyle==="drift"||t.motionStyle==="migration"||t.motionStyle==="exodus")&&n()<.85){const m=[],f=bo(n)*.55,g=bo(n)*.55,x=n()*Math.PI*2,v=Math.cos(x),b=Math.sin(x),w=6+Math.floor(n()*10);for(let M=0;M<w;M++){const k=M/Math.max(1,w-1),R=f+v*(k-.5)*1.1+bo(n)*.06,j=g+b*(k-.5)*1.1+bo(n)*.06;m.push([Kl(R,-.95,.95),Kl(j,-.95,.95),v,b])}e.channels.push({id:Math.floor(n()*1e5),pts:m,strength:.45+n()*.45,radius:.1+n()*.1,color:t.secondary})}const l=c?0:a?2:1;for(let m=0;m<l;m++){const f=bo(n)*.55,g=bo(n)*.55,x=n()*Math.PI,v=.18+n()*.55;e.rails.push({x1:f-Math.cos(x)*v,y1:g-Math.sin(x)*v,x2:f+Math.cos(x)*v,y2:g+Math.sin(x)*v,strength:.25+n()*.55,color:t.accent})}if(i&&n()<.85){const m=1+(a?1:0)+(n()<.35?1:0);for(let f=0;f<m;f++){const g=bo(n)*.85,x=bo(n)*.85,v=bo(n)*.85,b=bo(n)*.85;e.tunnels.push({id:Math.floor(n()*1e5),ax:g,ay:x,bx:v,by:b,radius:.05+n()*.06,color:f%2===0?t.primary:t.accent,cd:0})}}if((s||a)&&n()<.55){const m=n()<.35,f=bo(n)*.35,g=bo(n)*.35,x=.55+n()*.55,v=.45+n()*.55,b=.28+n()*.3,w=m?{id:Math.floor(n()*1e5),shape:"circle",x:f,y:g,w:x,h:v,r:b,elasticity:.75+n()*.2,color:"#00ffcc"}:{id:Math.floor(n()*1e5),shape:"rect",x:f,y:g,w:x,h:v,r:Math.max(x,v)/2,elasticity:.75+n()*.2,color:"#00ffcc"};e.cages.push(w)}const d=s?2+Math.floor(n()*2):!c&&n()<.25?1:0;for(let m=0;m<d;m++){const f=bo(n)*.65,g=bo(n)*.65,x=n()*Math.PI,v=.18+n()*.7;e.strings.push({id:Math.floor(n()*1e5),x1:f-Math.cos(x)*v,y1:g-Math.sin(x)*v,x2:f+Math.cos(x)*v,y2:g+Math.sin(x)*v,tension:n(),vibAmp:0,vibPhase:0,decay:.55+n()*.55,color:"#ffd700",lastHit:99})}const u=t.intensity>=4?3:t.intensity>=2?2:1,h=a?["pulse_beat","compress_zone","excite_zone","glitch","scatter_zone","harmonize_zone"]:r.has("Ambient")||r.has("Meditative")?["slow","tremolo","warp","harmonize_zone","freeze_zone"]:["vortex_zone","density_wave","phase_lock","harmonize_zone","transpose","scatter_zone"];for(let m=0;m<u;m++){const f=h[Math.floor(n()*h.length)],g=bo(n)*.65,x=bo(n)*.65,v=.2+n()*.4,b=.18+n()*.35,w=[[Kl(g-v,-.95,.95),Kl(x-b,-.95,.95)],[Kl(g+v,-.95,.95),Kl(x-b,-.95,.95)],[Kl(g+v,-.95,.95),Kl(x+b,-.95,.95)],[Kl(g-v,-.95,.95),Kl(x+b,-.95,.95)]],M={id:Math.floor(n()*1e5),pts:w,effect:f,strength:.35+n()*.6,param:n(),color:t.accent};e.fxZones.push(M)}if(a&&n()<.85){const m=n()<.55?16:8,f=n()<.5?1:2;e.sequencer={...e.sequencer,active:!0,x:bo(n)*.75,y:bo(n)*.75,ringR:.18+n()*.34,tempoMult:f,steps:Array.from({length:m},(g,x)=>({armed:n()<.25+t.intensity*.08||x%4===0,pitchOff:Math.floor((n()-.5)*10),vel:.35+n()*.65,role:null})),stepCd:new Array(m).fill(0)}}}function up(e,t){const n=(t==null?void 0:t.variation)??Math.random(),r=(dV(e.id)^Math.floor(Kl(n,0,1)*4294967295))>>>0,a=uV(r),i=hV(e),s=[];for(let l=0;l<e.quantaCount;l++){const d=mV(e,l,e.quantaCount,a),u=d?by(l,e,i[l%i.length],d[0],d[1],a):by(l,e,i[l%i.length],void 0,void 0,a),h=e.motionStyle,m=h==="meditation"?.18:h==="drift"?.35:h==="orbit"?.65:h==="lattice"?.55:h==="ballistic"?.85:e.intensity<=1?.45:e.intensity>=4?1.1:.75;u.vx*=m,u.vy*=m,s.push(u)}const c={quanta:s,count:e.quantaCount,gates:fV(e,a),attractors:pV(e,a),ripples:[],emergent:[],channels:[],rails:[],tunnels:[],cages:[],strings:[],fxZones:[],userMatrix:O5(),sequencer:{active:!1,x:0,y:0,ringR:.42,steps:Array.from({length:8},(l,d)=>({armed:d%2===0,pitchOff:0,vel:.65,role:null})),cursor:0,tempoMult:1,triggerR:.15,stepCd:new Array(8).fill(0)},elapsed:0,tick:0,bpm:e.bpm,beatPhase:0,barPhase:0,lastBeatTime:0,syncIntensity:0,roleEnergy:{}};return gV(c,e,a),c}function id(e,t,n){e.ripples.length>28||e.ripples.push({x:t.x,y:t.y,r:0,maxR:.08+f0()*.08,alpha:.7,color:n,thick:1.2+t.velocity*2})}function Ip(e){return Math.max(.05,e.attack+e.decay+e.sustain*1.5)}function yV(e,t,n,r,a){if(r<=0||r>.1)return;e.elapsed+=r,e.tick++;const i=60/e.bpm;e.beatPhase=e.elapsed/i%1,e.barPhase=e.elapsed/(i*4)%1;const s=e.count;for(let l=0;l<s;l++){const d=e.quanta[l];d.prevX=d.x,d.prevY=d.y,d.age+=r,d.cooldown>0&&(d.cooldown-=r),d.recentlyFired>0&&(d.recentlyFired-=r),d.roleLockTimer>0&&(d.roleLockTimer-=r),d.phase=(d.phase+(.5+d.brightness*2)*r)%1,d.charge+=(.5-d.charge)*r*.12;let u=0,h=0;if(n.motionStyle==="ballistic"||n.bounceWalls?(u+=n.gravityX,h+=n.gravityY):(u+=n.gravityX*.15*r,h+=n.gravityY*.15*r),n.turbulence>0){const[f,g]=aC(d.x,d.y,e.elapsed);u+=f*n.turbulence*.06,h+=g*n.turbulence*.06}if(e.channels.length>0)for(const f of e.channels){let g=f.radius,x=0,v=0;for(const[b,w,M,k]of f.pts){const R=d.x-b,j=d.y-w,I=Math.sqrt(R*R+j*j);I<g&&(g=I,x=M,v=k)}if(g<f.radius){const b=(1-g/f.radius)*f.strength;u+=x*b*.055,h+=v*b*.055}}for(const f of e.rails){const g=f.x2-f.x1,x=f.y2-f.y1,v=g*g+x*x;if(v<1e-4)continue;const b=Math.max(0,Math.min(1,((d.x-f.x1)*g+(d.y-f.y1)*x)/v)),w=f.x1+b*g,M=f.y1+b*x,k=w-d.x,R=M-d.y,j=Math.sqrt(k*k+R*R)+.001;if(j>.5)continue;const I=f.strength*.06/(j*j*2+.008);u+=k/j*I,h+=R/j*I}switch(n.motionStyle??t.motionStyle){case"orbit":{const f=Math.sqrt(d.x*d.x+d.y*d.y)+.001,g=.38+l%5*.08,x=.08+n.vortexForce;u+=-d.y/f*x,h+=d.x/f*x,u+=d.x/f*(g-f)*.22,h+=d.y/f*(g-f)*.22;break}case"swarm":{const f=n.zoneRadius,g=f*f;let x=0,v=0,b=0,w=0,M=0;for(let k=0;k<s;k++){if(k===l)continue;const R=e.quanta[k].x-d.x,j=e.quanta[k].y-d.y,I=R*R+j*j;I<g&&(x+=e.quanta[k].x,v+=e.quanta[k].y,b+=e.quanta[k].vx,w+=e.quanta[k].vy,M++,I<g*.22&&(u-=R*n.separation*2,h-=j*n.separation*2))}M>0&&(u+=(x/M-d.x)*n.cohesion*.38,h+=(v/M-d.y)*n.cohesion*.38,u+=(b/M-d.vx)*n.alignment*.2,h+=(w/M-d.vy)*n.alignment*.2),u+=jo()*.035,h+=jo()*.035;break}case"flow":{const f=d.x*2.1+d.y*1.7+e.elapsed*.4;u+=Math.cos(f)*(.055+n.turbulence*.03),h+=Math.sin(f)*(.055+n.turbulence*.03);break}case"drift":{u+=jo()*(.018+n.turbulence*.04),h+=jo()*(.018+n.turbulence*.04);break}case"spiral":{const f=Math.sqrt(d.x*d.x+d.y*d.y)+.001,g=.1+n.vortexForce;u+=-d.y/f*g+-d.x/f*.025,h+=d.x/f*g+-d.y/f*.025;break}case"lattice":{const f=Math.max(.04,n.zoneRadius*.9),g=Math.round(d.x/f)*f,x=Math.round(d.y/f)*f;u+=(g-d.x)*1.1,h+=(x-d.y)*1.1;break}case"murmuration":{const f=n.zoneRadius,g=f*f,x=f*.3;let v=0,b=0,w=0,M=0,k=0,R=0,j=0,I=0;for(let E=0;E<s;E++){if(E===l)continue;const O=e.quanta[E].x-d.x,L=e.quanta[E].y-d.y,$=O*O+L*L;if($>g)continue;const F=Math.sqrt($)+.001;F<x?(R-=O/F*(x-F)/x,j-=L/F*(x-F)/x,I++):(v+=e.quanta[E].vx,b+=e.quanta[E].vy,w+=e.quanta[E].x,M+=e.quanta[E].y,k++)}I>0&&(u+=R/I*n.separation*3,h+=j/I*n.separation*3),k>0&&(u+=(v/k-d.vx)*n.alignment*.5,h+=(b/k-d.vy)*n.alignment*.5,u+=(w/k-d.x)*n.cohesion*.28,h+=(M/k-d.y)*n.cohesion*.28),u+=jo()*.012*n.turbulence,h+=jo()*.012*n.turbulence;break}case"school":{const f=n.zoneRadius,g=f*f;let x=0,v=0,b=0,w=0,M=0,k=0,R=0,j=0,I=0;for(let O=0;O<s;O++){if(O===l)continue;const L=e.quanta[O].x-d.x,$=e.quanta[O].y-d.y,F=L*L+$*$;if(F>g)continue;const B=Math.sqrt(F)+.001;B<f*.25?(x-=L/B,v-=$/B,R++):B<f*.6?(b+=e.quanta[O].vx,w+=e.quanta[O].vy,j++):(M+=e.quanta[O].x,k+=e.quanta[O].y,I++)}R>0&&(u+=x/R*n.separation*3,h+=v/R*n.separation*3),j>0&&(u+=(b/j-d.vx)*n.alignment*.6,h+=(w/j-d.vy)*n.alignment*.6),I>0&&(u+=(M/I-d.x)*n.cohesion*.35,h+=(k/I-d.y)*n.cohesion*.35);const E=Math.sqrt(d.vx*d.vx+d.vy*d.vy)+.001;u+=d.vx/E*(n.maxSpeed*.55-E)*.35,h+=d.vy/E*(n.maxSpeed*.55-E)*.35;break}case"war":{const f=l%2===0;for(let g=0;g<s;g++){if(g===l)continue;const x=e.quanta[g].x-d.x,v=e.quanta[g].y-d.y,b=x*x+v*v;if(b>n.zoneRadius*n.zoneRadius||b<1e-4)continue;const w=Math.sqrt(b),M=g%2===0;f&&!M&&(u+=x/w*n.cohesion*.45,h+=v/w*n.cohesion*.45),!f&&M&&(u-=x/w*n.separation*.55,h-=v/w*n.separation*.55),f===M&&b<.04&&(u-=x/w*n.separation*1.5,h-=v/w*n.separation*1.5)}u+=jo()*.022*n.turbulence,h+=jo()*.022*n.turbulence;break}case"polarization":{for(let f=0;f<s;f++){if(f===l)continue;const g=e.quanta[f],x=g.x-d.x,v=g.y-d.y,b=x*x+v*v;if(b>n.zoneRadius*n.zoneRadius||b<1e-4)continue;const w=Math.sqrt(b),M=Math.abs((d.phase-g.phase+1.5)%1-.5)*2;M<.4?(u+=x/w*n.cohesion*n.polarize*.42,h+=v/w*n.cohesion*n.polarize*.42):M>.6&&(u-=x/w*n.separation*n.polarize*.42,h-=v/w*n.separation*n.polarize*.42)}u+=jo()*.014,h+=jo()*.014;break}case"revolution":{const f=Math.sqrt(d.x*d.x+d.y*d.y)+.001;u+=-d.y/f*n.vortexForce,h+=d.x/f*n.vortexForce,u+=-d.x/f*(.035+n.cohesion*.018),h+=-d.y/f*(.035+n.cohesion*.018),d.charge>.75&&(u+=d.x/f*n.burstRate*.28,h+=d.y/f*n.burstRate*.28),u+=jo()*n.turbulence*.02,h+=jo()*n.turbulence*.02;break}case"explosion":{const f=Math.sqrt(d.x*d.x+d.y*d.y)+.001;(e.elapsed*n.burstRate+d.phase*.5)%1<.15?(u+=d.x/f*.38,h+=d.y/f*.38):(u+=-d.x*n.cohesion*.28,h+=-d.y*n.cohesion*.28);for(let x=l+1;x<Math.min(s,l+20);x++){const v=e.quanta[x].x-d.x,b=e.quanta[x].y-d.y,w=v*v+b*b;if(w<.04&&w>1e-4){const M=Math.sqrt(w);u-=v/M*n.separation*.5,h-=b/M*n.separation*.5}}break}case"carnival":{for(let g=0;g<3;g++){const x=e.elapsed*.45+g/3*Math.PI*2,v=Math.cos(x)*.38,b=Math.sin(x)*.38,w=v-d.x,M=b-d.y,k=Math.sqrt(w*w+M*M)+.01;k<.5&&(u+=w/k*n.cohesion*.32,h+=M/k*n.cohesion*.32,u+=-M/k*n.vortexForce,h+=w/k*n.vortexForce)}u+=jo()*n.turbulence*.04,h+=jo()*n.turbulence*.04;break}case"jazz":{const f=Math.max(1,Math.ceil(s/Math.max(2,n.clusterTarget))),g=l%f;let x=0,v=0,b=0;for(let w=0;w<s;w++)w%f===g&&(x+=e.quanta[w].x,v+=e.quanta[w].y,b++);b>1&&(u+=(x/b-d.x)*n.cohesion*.55,h+=(v/b-d.y)*n.cohesion*.55);for(let w=0;w<s;w++){if(w===l||w%f===g)continue;const M=e.quanta[w].x-d.x,k=e.quanta[w].y-d.y,R=M*M+k*k;if(R<.07&&R>.001){const j=Math.sqrt(R);u-=M/j*n.separation*.35,h-=k/j*n.separation*.35}}u+=jo()*n.turbulence*.058,h+=jo()*n.turbulence*.058;break}case"organism":{const f=Math.sqrt(d.x*d.x+d.y*d.y)+.001,g=.28*(1+Math.sin(e.elapsed*n.burstRate*3+l*.08)*.35);u+=d.x/f*(g-f)*n.cohesion*1.6,h+=d.y/f*(g-f)*n.cohesion*1.6;const x=n.zoneRadius*.5,v=x*x;for(let b=0;b<s;b++){if(b===l)continue;const w=e.quanta[b].x-d.x,M=e.quanta[b].y-d.y,k=w*w+M*M;if(k<v&&k>1e-4){const R=Math.sqrt(k);u-=w/R*n.separation*.75,h-=M/R*n.separation*.75}}break}case"exodus":{const f=Math.sqrt(n.migrationX*n.migrationX+n.migrationY*n.migrationY)+.001;u+=n.migrationX/f*n.maxSpeed*.14,h+=n.migrationY/f*n.maxSpeed*.14;const g=n.zoneRadius,x=g*g;let v=0,b=0,w=0;for(let M=0;M<s;M++){if(M===l)continue;const k=e.quanta[M].x-d.x,R=e.quanta[M].y-d.y;k*k+R*R<x&&(v+=e.quanta[M].vx,b+=e.quanta[M].vy,w++)}w>0&&(u+=(v/w-d.vx)*n.alignment*.4,h+=(b/w-d.vy)*n.alignment*.4),u+=jo()*.01*n.turbulence,h+=jo()*.01*n.turbulence;break}case"dance":{let f=n.zoneRadius*3,g=0,x=0;for(let M=0;M<s;M++){if(M===l)continue;const k=e.quanta[M].x-d.x,R=e.quanta[M].y-d.y,j=Math.sqrt(k*k+R*R);j<f&&(f=j,g=e.quanta[M].x,x=e.quanta[M].y)}const v=g-d.x,b=x-d.y,w=Math.sqrt(v*v+b*b)+.001;w>.07&&w<n.zoneRadius*3&&(u+=v/w*n.cohesion*.5,h+=b/w*n.cohesion*.5),u+=-b/w*n.vortexForce*(l%2===0?1:-1),h+=v/w*n.vortexForce*(l%2===0?1:-1),w<.06&&(u-=v/w*n.separation,h-=b/w*n.separation);break}case"chaos":{u+=jo()*n.turbulence*.14,h+=jo()*n.turbulence*.14,Math.random()<n.burstRate*.009&&(u+=jo()*n.burstRate*.12,h+=jo()*n.burstRate*.12),n.cohesion>0&&(u+=-d.x*n.cohesion*.018,h+=-d.y*n.cohesion*.018);break}case"ballistic":break;case"meditation":{const[f,g]=aC(d.x,d.y,e.elapsed*.12);u+=f*.014,h+=g*.014;const x=Math.sqrt(d.x*d.x+d.y*d.y)+.001,v=.38+l%7*.055;u+=-d.y/x*n.vortexForce*.35,h+=d.x/x*n.vortexForce*.35,u+=d.x/x*(v-x)*n.cohesion*.12,h+=d.y/x*(v-x)*n.cohesion*.12;break}case"migration":{const f=Math.sqrt(n.migrationX*n.migrationX+n.migrationY*n.migrationY)+.001;u+=n.migrationX/f*.11,h+=n.migrationY/f*.11;const g=n.zoneRadius,x=g*g;let v=0,b=0,w=0;for(let M=0;M<s;M++){if(M===l)continue;const k=e.quanta[M].x-d.x,R=e.quanta[M].y-d.y;k*k+R*R<x&&(v+=e.quanta[M].vx,b+=e.quanta[M].vy,w++)}w>0&&(u+=(v/w-d.vx)*n.alignment*.55,h+=(b/w-d.vy)*n.alignment*.55);for(let M=0;M<s;M++){if(M===l)continue;const k=e.quanta[M].x-d.x,R=e.quanta[M].y-d.y,j=k*k+R*R;if(j<.04&&j>1e-4){const I=Math.sqrt(j);u-=k/I*n.separation*.45,h-=R/I*n.separation*.45}}break}case"predation":{const f=rC[d.role];for(let b=0;b<s;b++){if(b===l)continue;const w=e.quanta[b],M=f?f[w.role]:void 0;if(!M)continue;const k=w.x-d.x,R=w.y-d.y,j=k*k+R*R;if(j<n.zoneRadius*n.zoneRadius&&j>1e-4){const I=Math.sqrt(j);u+=k/I*M*n.polarize*2.2,h+=R/I*M*n.polarize*2.2}}let g=0,x=0,v=0;for(let b=0;b<s;b++){if(b===l||e.quanta[b].role!==d.role)continue;const w=e.quanta[b].x-d.x,M=e.quanta[b].y-d.y;w*w+M*M<n.zoneRadius*n.zoneRadius&&(g+=e.quanta[b].vx,x+=e.quanta[b].vy,v++)}v>0&&(u+=(g/v-d.vx)*n.alignment*.32,h+=(x/v-d.vy)*n.alignment*.32),u+=jo()*n.turbulence*.022,h+=jo()*n.turbulence*.022;break}case"cells":{const f=Math.max(1,Math.ceil(s/Math.max(2,n.clusterTarget))),g=l%f,x=Math.sin(e.elapsed*n.burstRate*2+g*1.4),v=.055+Math.abs(x)*.09;let b=0,w=0,M=0;for(let k=0;k<s;k++)k%f===g&&(b+=e.quanta[k].x,w+=e.quanta[k].y,M++);if(M>0){const k=d.x-b/M,R=d.y-w/M,j=Math.sqrt(k*k+R*R)+.001;u+=k/j*(v-j)*n.cohesion*2.6,h+=R/j*(v-j)*n.cohesion*2.6}for(let k=0;k<s;k++){if(k===l||k%f===g)continue;const R=e.quanta[k].x-d.x,j=e.quanta[k].y-d.y,I=R*R+j*j;if(I<.06&&I>1e-4){const E=Math.sqrt(I);u-=R/E*n.separation*1.25,h-=j/E*n.separation*1.25}}break}}for(const f of e.attractors){const g=f.x-d.x,x=f.y-d.y,v=g*g+x*x;if(v<f.radius*f.radius&&v>1e-4){const b=Math.sqrt(v);if(f.type==="metro"){const w=Math.max(0,Math.cos(e.elapsed*(e.bpm/60)*Math.PI*2)),M=f.strength*w*w*2;u+=g/b*M,h+=x/b*M}else u+=g/b*f.strength,h+=x/b*f.strength,u+=-x/b*f.vortexStr,h+=g/b*f.vortexStr}}if(e.userMatrix&&e.tick%2===0){const g=e.userMatrix[d.role];if(g)for(let x=0;x<s;x++){if(x===l)continue;const v=e.quanta[x],b=g[v.role]??0;if(Math.abs(b)<.008)continue;const w=v.x-d.x,M=v.y-d.y,k=w*w+M*M;if(k>.09||k<4e-4)continue;const R=Math.sqrt(k),j=b*.08/(R+.025);u+=w/R*j,h+=M/R*j}}if(n.predatorPrey&&e.tick%2===0){const f=rC[d.role];if(f)for(let g=0;g<s;g++){if(g===l)continue;const x=e.quanta[g],v=f[x.role];if(!v)continue;const b=x.x-d.x,w=x.y-d.y,M=b*b+w*w;if(M>.001&&M<.22){const k=Math.sqrt(M);u+=b/k*v,h+=w/k*v}}}d.vx=(d.vx+u*r)*Math.pow(n.damping,r*60),d.vy=(d.vy+h*r)*Math.pow(n.damping,r*60);const m=Math.sqrt(d.vx*d.vx+d.vy*d.vy);m>n.maxSpeed&&(d.vx=d.vx/m*n.maxSpeed,d.vy=d.vy/m*n.maxSpeed),d.x+=d.vx*r*30,d.y+=d.vy*r*30;for(const f of e.tunnels){if(f.cd>0){f.cd-=r;continue}const g=d.x-f.ax,x=d.y-f.ay;if(g*g+x*x<f.radius*f.radius){const v=Math.sqrt(d.vx*d.vx+d.vy*d.vy),b=Math.atan2(f.by-f.ay,f.bx-f.ax);d.x=f.bx+(Math.random()-.5)*.01,d.y=f.by+(Math.random()-.5)*.01,d.vx=Math.cos(b)*v,d.vy=Math.sin(b)*v,f.cd=.25,d.recentlyFired=.6,id(e,{pitch:d.pitch,velocity:.7,role:d.role,x:f.bx,y:f.by},f.color);break}}if(n.bounceWalls||n.motionStyle==="ballistic"){const g=n.restitution??.82;d.x>.97&&(d.x=.97,d.vx=-Math.abs(d.vx)*g),d.x<-.97&&(d.x=-.97,d.vx=Math.abs(d.vx)*g),d.y>.97&&(d.y=.97,d.vy=-Math.abs(d.vy)*g),d.y<-.97&&(d.y=-.97,d.vy=Math.abs(d.vy)*g)}else d.x>1&&(d.x-=2),d.x<-1&&(d.x+=2),d.y>1&&(d.y-=2),d.y<-1&&(d.y+=2);for(const f of e.cages??[])if(f.shape==="rect"){const g=f.w/2,x=f.h/2;if(!(d.prevX>f.x-g&&d.prevX<f.x+g&&d.prevY>f.y-x&&d.prevY<f.y+x))continue;d.x<f.x-g&&(d.x=f.x-g+.001,d.vx=Math.abs(d.vx)*f.elasticity),d.x>f.x+g&&(d.x=f.x+g-.001,d.vx=-Math.abs(d.vx)*f.elasticity),d.y<f.y-x&&(d.y=f.y-x+.001,d.vy=Math.abs(d.vy)*f.elasticity),d.y>f.y+x&&(d.y=f.y+x-.001,d.vy=-Math.abs(d.vy)*f.elasticity)}else{const g=d.x-f.x,x=d.y-f.y,v=Math.sqrt(g*g+x*x);if(Math.sqrt((d.prevX-f.x)**2+(d.prevY-f.y)**2)>f.r||v<=f.r)continue;const w=g/(v+1e-4),M=x/(v+1e-4),k=d.vx*w+d.vy*M;k>0&&(d.vx-=2*k*w,d.vy-=2*k*M),d.vx*=f.elasticity,d.vy*=f.elasticity,d.x=f.x+w*(f.r-.002),d.y=f.y+M*(f.r-.002)}for(const f of e.fxZones??[]){if(f.pts.length<3)continue;const g=f._bb??cV(f);if(d.x<g[0]||d.x>g[1]||d.y<g[2]||d.y>g[3])continue;let x=!1;for(let w=0,M=f.pts.length-1;w<f.pts.length;M=w++){const k=f.pts[w][0],R=f.pts[w][1],j=f.pts[M][0],I=f.pts[M][1];R>d.y!=I>d.y&&d.x<(j-k)*(d.y-R)/(I-R)+k&&(x=!x)}if(!x)continue;const v=f.strength,b=f.param??.5;switch(f.effect){case"slow":d.vx*=1-v*.04*r*60,d.vy*=1-v*.04*r*60;break;case"fast":d.vx*=1+v*.025*r*60,d.vy*=1+v*.025*r*60;break;case"mute":d.cooldown=Math.max(d.cooldown,.25);break;case"excite_zone":d.charge=Math.min(1,d.charge+v*.015*r*60);break;case"freeze_zone":d.vx*=.95,d.vy*=.95,d.charge*=.998;break;case"pitch_up":e.tick%Math.max(1,Math.round(90*(1-v*.8)))===0&&(d.pitch=Math.min(108,d.pitch+1));break;case"pitch_down":e.tick%Math.max(1,Math.round(90*(1-v*.8)))===0&&(d.pitch=Math.max(24,d.pitch-1));break;case"reverse":e.tick%120===Math.round(l*7)%120&&(d.vx*=-1,d.vy*=-1);break;case"vortex_zone":{const w=f.pts.reduce((I,E)=>I+E[0],0)/f.pts.length,M=f.pts.reduce((I,E)=>I+E[1],0)/f.pts.length,k=d.x-w,R=d.y-M,j=Math.sqrt(k*k+R*R)+.001;u+=-R/j*v*(.3+b*.4),h+=k/j*v*(.3+b*.4);break}case"gravity_down":h+=v*(.5+b*1.5);break;case"gravity_up":h-=v*(.5+b*1.5);break;case"transpose":{if(e.tick%45===l*5%45){const w=Math.round((b-.5)*24);d.pitch=Math.max(24,Math.min(108,d.pitch+w))}break}case"harmonize_zone":e.tick%60===l*7%60&&(d.pitch=g0(d.pitch,t.root,t.scale));break;case"bounce":{if(f0()<v*.04*r*60){const w=f0()*Math.PI*2;d.vx+=Math.cos(w)*(.05+b*.2),d.vy+=Math.sin(w)*(.05+b*.2)}break}case"compress_zone":{const w=f.pts.reduce((k,R)=>k+R[0],0)/f.pts.length,M=f.pts.reduce((k,R)=>k+R[1],0)/f.pts.length;u+=(w-d.x)*v*(.25+b*.5),h+=(M-d.y)*v*(.25+b*.5);break}case"scatter_zone":{f0()<v*.02*r*60&&(d.x+=jo()*.04,d.y+=jo()*.04);break}case"glitch":{f0()<v*.025*r*60&&(d.x+=jo()*(.06+b*.2),d.y+=jo()*(.06+b*.2),d.vx+=jo()*v*.08,d.vy+=jo()*v*.08);break}case"tremolo":{const w=v*(.3+b*.7);d.charge=Math.max(0,Math.min(1,d.charge+Math.sin(e.elapsed*(8+b*24)+d.phase*4)*w*.04*r*60));break}case"pulse_beat":{const w=Math.max(0,Math.sin(e.elapsed*(e.bpm/60)*Math.PI*2)),M=v*(.3+b*.7)*w*w,k=f.pts.reduce((j,I)=>j+I[0],0)/f.pts.length,R=f.pts.reduce((j,I)=>j+I[1],0)/f.pts.length;u+=(k-d.x)*M,h+=(R-d.y)*M,w>.85&&(d.charge=Math.min(1,d.charge+v*.01));break}case"warp":{const w=Math.sin(d.y*(6+b*10)+e.elapsed*1.5)*v*(.15+b*.35),M=Math.cos(d.x*(6+b*10)+e.elapsed*1.5)*v*(.15+b*.35);u+=w,h+=M;break}case"phase_lock":{const w=b*Math.PI*2,M=Math.sin(d.phase*Math.PI*2-w);d.phase=(d.phase-M*v*.04*r*60+1)%1;break}case"role_shift":{if(d.roleLockTimer<=0&&f0()<v*.004*r*60){const w=["KICK","BASS","PERC","PAD","LEAD","ARP","STRINGS","CHOIR"];d.role=w[Math.min(Math.floor(b*w.length),w.length-1)],d.hue=yy[d.role],d.roleLockTimer=2}break}case"density_wave":{const w=Math.sqrt(d.x*d.x+d.y*d.y)+.001,M=Math.sin(w*(8+b*16)-e.elapsed*2)*v*.12;u+=d.x/w*M,h+=d.y/w*M;break}}}if(t.trailLen>0){d.trailX.push(d.x),d.trailY.push(d.y);const f=d.trailX.length-t.trailLen;f>16&&(d.trailX.splice(0,f),d.trailY.splice(0,f))}}for(const l of e.strings??[])if(l.lastHit=Math.max(0,l.lastHit-r),l.vibPhase=(l.vibPhase+(2+l.tension*4)*r)%(Math.PI*2),l.vibAmp*=Math.pow(1-l.decay*.8,r*60),l.vibAmp<.001&&(l.vibAmp=0),!(l.lastHit>0))for(let d=0;d<e.count;d++){const u=e.quanta[d];if(!oC(u.prevX,u.prevY,u.x,u.y,l.x1,l.y1,l.x2,l.y2))continue;const h=l.x2-l.x1,m=l.y2-l.y1,f=Math.sqrt(h*h+m*m)+.001,g=-m/f,x=h/f,v=u.vx*g+u.vy*x;if(u.vx-=2*v*g*.75,u.vy-=2*v*x*.75,u.x=u.prevX,u.y=u.prevY,l.vibAmp=Math.min(1,l.vibAmp+u.charge*.45),l.lastHit=.08,u.cooldown<=0){const b=Math.sqrt((l.x2-l.x1)**2+(l.y2-l.y1)**2),w=g0(Math.round(52+(1-Math.min(1,b/1.5))*26),0,"chromatic"),M=[0,12,19,24][Math.floor(Math.random()*4)],k=Math.min(108,w+M),R=t.roles.STRINGS;R&&(a({pitch:k,velocity:.5+u.charge*.4,role:"STRINGS",x:(l.x1+l.x2)/2,y:(l.y1+l.y2)/2,duration:.6+l.tension*1.2,timbre:.65},R),u.cooldown=.12,id(e,{velocity:.6,x:(l.x1+l.x2)/2,y:(l.y1+l.y2)/2},l.color))}break}if(e.sequencer.active&&bV(e,t,r,a),e.tick%3===0){const l=n.entainment*r;for(let d=0;d<s;d++){const u=e.quanta[d];for(let h=d+1;h<Math.min(d+8,s);h++){const m=e.quanta[h],f=u.x-m.x,g=u.y-m.y;if(f*f+g*g<.09){const x=(m.phase-u.phase+1.5)%1-.5;u.phase=(u.phase+x*l*.5+1)%1,m.phase=(m.phase-x*l*.5+1)%1}}}}if(e.tick%8===0){let l=0,d=0;for(let u=0;u<s;u++)l+=Math.sin(e.quanta[u].phase*Math.PI*2),d+=Math.cos(e.quanta[u].phase*Math.PI*2);e.syncIntensity=Math.sqrt(l*l+d*d)/s}if(e.tick%4===0&&(n.energyTransfer>0||n.mutationRate>0)){const l=t.encounterR*1.6*(t.encounterR*1.6);for(let d=0;d<s;d++){const u=e.quanta[d];for(let h=d+1;h<Math.min(d+10,s);h++){const m=e.quanta[h],f=u.x-m.x,g=u.y-m.y;if(!(f*f+g*g>l)){if(n.energyTransfer>0){const x=(u.charge-m.charge)*n.energyTransfer*r*4;u.charge=Math.max(0,Math.min(1,u.charge-x)),m.charge=Math.max(0,Math.min(1,m.charge+x))}if(n.mutationRate>0&&u.roleLockTimer<=0&&m.roleLockTimer<=0){const x=u.vx-m.vx,v=u.vy-m.vy;if(Math.sqrt(x*x+v*v)>.18&&f0()<n.mutationRate*r*8){const w=u.charge<m.charge?u:m,M=u.charge<m.charge?m:u;w.role=M.role,w.hue=yy[M.role],w.mutations++,w.roleLockTimer=2,e.emergent.push({type:"mutation",x:w.x,y:w.y,r:.08,alpha:1,color:"#ffffff"})}}}}}}for(let l=0;l<s;l++){const d=e.quanta[l];if(d.charge>.9){if(d.dischargeTimer+=r,d.dischargeTimer>.45){d.dischargeTimer=0;const u=d.charge;d.charge=.15;for(let m=0;m<s;m++){if(m===l)continue;const f=e.quanta[m],g=d.x-f.x,x=d.y-f.y,v=g*g+x*x;if(v<.18&&v>1e-4){const b=Math.sqrt(v);f.vx+=(f.x-d.x)/b*.12*u,f.vy+=(f.y-d.y)/b*.12*u,f.charge=Math.min(1,f.charge+u*.15)}}const h=t.roles[d.role];h&&!n.physicsOnly&&(a({pitch:d.pitch,velocity:.85,role:d.role,x:d.x,y:d.y,duration:Ip(h.envelope),timbre:1,timbreIdx:d.timbreIdx},h),d.recentlyFired=1,d.cooldown=Math.max(h.cooldownMin*1.5,.3)),e.emergent.push({type:"discharge",x:d.x,y:d.y,r:.05,alpha:1,color:"#ffff80"}),id(e,{pitch:d.pitch,velocity:.85,role:d.role,x:d.x,y:d.y},"#ffff80")}}else d.dischargeTimer=Math.max(0,d.dischargeTimer-r*2)}for(let l=e.emergent.length-1;l>=0;l--){const d=e.emergent[l];d.r+=r*.4,d.alpha-=r*2.5,d.alpha<=0&&e.emergent.splice(l,1)}const c=60/(e.bpm*t.eventRate*4+.001);for(const l of e.gates){if(l.cooldown>0){l.cooldown-=r;continue}const d=l.type??"gate";for(let u=0;u<s;u++){const h=e.quanta[u];if(h.cooldown>0&&d==="gate"||!oC(h.prevX,h.prevY,h.x,h.y,l.x1,l.y1,l.x2,l.y2))continue;const m=t.roles[h.role];if(m)if(d==="mirror"){const f=l.x2-l.x1,g=l.y2-l.y1,x=Math.sqrt(f*f+g*g)+1e-4,v=-g/x,b=f/x,w=h.vx*v+h.vy*b;h.vx-=2*w*v,h.vy-=2*w*b,h.x=h.prevX,h.y=h.prevY,id(e,{pitch:h.pitch,velocity:.25,role:h.role,x:h.x,y:h.y},l.color);break}else if(d==="absorber"){h.charge=Math.max(0,h.charge*.07),h.vx*=.12,h.vy*=.12,h.recentlyFired=.45,l.cooldown=c*.08,id(e,{pitch:h.pitch,velocity:.28,role:h.role,x:h.x,y:h.y},l.color);break}else if(d==="membrane"){const f=l.x2-l.x1,g=l.y2-l.y1,x=Math.sqrt(f*f+g*g)+1e-4,v=-g/x,b=f/x;if((h.prevX-l.x1)*v+(h.prevY-l.y1)*b>0){const M=h.vx*v+h.vy*b;h.vx-=2*M*v*.84,h.vy-=2*M*b*.84,h.x=h.prevX,h.y=h.prevY,id(e,{pitch:h.pitch,velocity:.2,role:h.role,x:h.x,y:h.y},l.color)}break}else{if(h.cooldown>0)break;const f=.55+h.charge*.45,g=Ip(m.envelope);a({pitch:h.pitch,velocity:f,role:h.role,x:h.x,y:h.y,duration:g,timbre:h.brightness,timbreIdx:h.timbreIdx},m),h.cooldown=Math.max(m.cooldownMin,c),h.recentlyFired=.8,l.cooldown=c*.3,id(e,{pitch:h.pitch,velocity:f,role:h.role,x:h.x,y:h.y,timbre:h.brightness},l.color);break}}}if(!n.physicsOnly&&e.syncIntensity>t.syncThreshold&&e.tick%12===0)for(let l=0;l<s;l++){const d=e.quanta[l];if(d.cooldown>0||d.phase>.08)continue;const u=t.roles[d.role];if(!u)continue;const h=.45+e.syncIntensity*.4;a({pitch:d.pitch,velocity:h,role:d.role,x:d.x,y:d.y,duration:Ip(u.envelope),timbre:d.brightness,timbreIdx:d.timbreIdx},u),d.cooldown=Math.max(u.cooldownMin*1.5,c*2),d.recentlyFired=.6;break}if(!n.physicsOnly&&e.tick%4===0){const l=t.encounterR*t.encounterR;let d=0;for(let u=0;u<s&&d<3;u++){const h=e.quanta[u];if(!(h.cooldown>0))for(let m=u+1;m<s&&d<3;m++){const f=e.quanta[m];if(f.cooldown>0)continue;const g=h.x-f.x,x=h.y-f.y;if(g*g+x*x>=l)continue;const v=Zj(h.pitch,f.pitch);if(t.harmonyMode==="consonant"&&v<.5||t.harmonyMode==="dissonant"&&v>.5)continue;const b=t.roles[h.role];if(!b)continue;const w=.35+h.charge*.4,M=Ip(b.envelope);a({pitch:h.pitch,velocity:w,role:h.role,x:h.x,y:h.y,duration:M,timbre:h.brightness,timbreIdx:h.timbreIdx},b),h.cooldown=Math.max(b.cooldownMin*2,c*3),h.recentlyFired=.5,d++;break}}}for(let l=e.ripples.length-1;l>=0;l--){const d=e.ripples[l];d.r+=.55*r,d.alpha-=r*1.8,(d.alpha<=0||d.r>d.maxR)&&e.ripples.splice(l,1)}}function bV(e,t,n,r){const a=e.sequencer,i=a.cursor,s=e.quanta.length;if(s===0)return;const c=e.bpm/240,l=a.tempoMult*c*n;a.cursor=(a.cursor+l)%1;for(let u=0;u<a.stepCd.length;u++)a.stepCd[u]>0&&(a.stepCd[u]-=n);const d=a.steps.length;for(let u=0;u<d;u++){const h=a.steps[u];if(!h.armed||(a.stepCd.length<=u&&a.stepCd.push(0),a.stepCd[u]>0))continue;const m=u/d;let f;if(a.cursor>=i?f=m>=i&&m<a.cursor:f=m>=i||m<a.cursor,!f)continue;const g=m*Math.PI*2-Math.PI*.5,x=a.x+a.ringR*Math.cos(g),v=a.y+a.ringR*Math.sin(g);let b=null,w=1/0;for(let I=0;I<s;I++){const E=e.quanta[I],O=E.x-x,L=E.y-v,$=O*O+L*L;$<w&&(w=$,b=E)}if(!b)continue;const M=t.roles[b.role];if(!M)continue;const k=Math.max(0,Math.min(127,b.pitch+h.pitchOff)),R=h.vel>0?h.vel:Math.min(1,.45+b.charge*.55),j=Ip(M.envelope);r({pitch:k,velocity:R,role:b.role,x:b.x,y:b.y,duration:j,timbre:b.brightness,timbreIdx:b.timbreIdx},M),b.recentlyFired=.5,a.stepCd[u]=Math.max(.04,60/e.bpm/d*.8),id(e,{velocity:R,role:b.role,x,y:v},"#aaddff88")}}const se=(e,t,n,r)=>({attack:e,decay:t,sustain:n,release:r}),ie=(e,t,n,r,a,i,s,c,l,d,u,h)=>({proportion:e,pitchRange:t,envelope:n,waveform:r,filterType:a,filterFreq:i,filterQ:s,gainScale:c,detune:l,panSpread:d,maxVoices:u,cooldownMin:h}),Nu=[{id:"eno-drift",name:"Eno Drift Garden",intensity:1,description:"Pads infinitos, root drift lento. Reverb expansivo como um jardim.",vibe:"Infinite, Still, Breathing",tags:["Ambient","Eno","Meditative","Soft"],bpm:48,scale:"major",root:53,quantaCount:64,motionStyle:"drift",roles:{PAD:ie(.55,[48,72],se(1.2,.5,.8,2.5),"sine","lowpass",900,1.2,.5,0,.9,4,1.8),STRINGS:ie(.3,[53,69],se(.8,.4,.7,1.8),"triangle","lowpass",1200,1,.4,3,.8,3,1.5),CHOIR:ie(.15,[60,72],se(1.5,.6,.75,3),"sine","lowpass",700,1,.35,0,1,2,2.5)},syncThreshold:.3,encounterR:.18,entainment:.25,eventRate:.25,reverbAmt:.85,delayAmt:.5,delayTime:.55,masterGain:.7,harmonyMode:"consonant",particleGlow:2.2,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#88ffcc",secondary:"#001122",accent:"#ffeebb",gateCount:2,attractorCount:1},{id:"deep-choir",name:"Deep Space Choir",intensity:2,description:"Vozes csmicas orbitando. Cada encontro  um harmnico vocal.",vibe:"Vast, Choral, Cosmic",tags:["Ambient","Choral","Space","Meditative"],bpm:40,scale:"lydian",root:48,quantaCount:72,motionStyle:"orbit",roles:{CHOIR:ie(.5,[48,72],se(1.8,.7,.82,3.5),"sine","lowpass",800,1.1,.45,0,.95,4,2),PAD:ie(.3,[42,60],se(2,.8,.85,4),"triangle","lowpass",600,1,.35,7,.9,3,2.5),STRINGS:ie(.2,[55,72],se(.9,.5,.7,2),"sine","lowpass",1400,1.2,.4,-5,.7,2,1.8)},syncThreshold:.28,encounterR:.2,entainment:.3,eventRate:.2,reverbAmt:.92,delayAmt:.6,delayTime:.7,masterGain:.65,harmonyMode:"consonant",particleGlow:2.8,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#aabbff",secondary:"#020510",accent:"#ffd5a0",gateCount:1,attractorCount:1},{id:"meditation-pool",name:"Meditation Pool",intensity:1,description:"Meditao ultralenta. Cada nota emerge como uma gota na superfcie.",vibe:"Stillness, Breath, Zen",tags:["Ambient","Meditative","Soft","Drone"],bpm:36,scale:"pentatonic",root:48,quantaCount:40,motionStyle:"meditation",roles:{PAD:ie(.45,[48,72],se(2.5,1,.85,4),"sine","lowpass",600,.8,.38,0,.9,3,3),STRINGS:ie(.35,[53,72],se(1.5,.8,.75,3),"triangle","lowpass",800,1,.35,5,.8,2,2.5),CHOIR:ie(.2,[60,72],se(2,.8,.8,3.5),"sine","lowpass",550,.9,.3,0,1,2,3.5)},syncThreshold:.2,encounterR:.25,entainment:.15,eventRate:.12,reverbAmt:.95,delayAmt:.7,delayTime:.8,masterGain:.55,harmonyMode:"consonant",particleGlow:3,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#aaccff",secondary:"#020208",accent:"#ffeedd",gateCount:1,attractorCount:0},{id:"underwater",name:"Underwater Harmonics",intensity:2,description:"Cardume submerso. Frequncias graves e harmnicos molhados.",vibe:"Deep, Pressure, Liquid",tags:["Ambient","Aquatic","Drone","Experimental"],bpm:52,scale:"dorian",root:40,quantaCount:80,motionStyle:"school",roles:{BASS:ie(.3,[28,48],se(.3,.3,.75,1.5),"sine","lowpass",200,1.5,.55,-3,.4,3,.8),PAD:ie(.35,[40,64],se(1.5,.5,.8,2.5),"triangle","lowpass",700,1.2,.45,8,.9,3,1.8),STRINGS:ie(.2,[48,72],se(.8,.4,.65,1.5),"sine","lowpass",1100,1,.35,0,.7,2,1.2),LEAD:ie(.15,[55,76],se(.15,.2,.5,1),"triangle","bandpass",900,2,.3,12,.6,2,1)},syncThreshold:.32,encounterR:.15,entainment:.35,eventRate:.35,reverbAmt:.88,delayAmt:.55,delayTime:.45,masterGain:.7,harmonyMode:"consonant",particleGlow:1.8,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#00aacc",secondary:"#001520",accent:"#88ffee",gateCount:3,attractorCount:1},{id:"glass-arps",name:"Glass Arpeggios",intensity:3,description:"Arpejos cristalinos em padro de grade. Philip Glass emergente.",vibe:"Crystal, Pattern, Minimalist",tags:["Classical","Minimalist","Arpeggios","Generative"],bpm:88,scale:"major",root:60,quantaCount:96,motionStyle:"lattice",roles:{ARP:ie(.35,[60,96],se(.003,.12,.15,.22),"triangle","lowpass",3200,2,.55,0,.6,4,.14),LEAD:ie(.25,[60,84],se(.008,.1,.45,.18),"triangle","lowpass",2400,1.5,.5,5,.5,3,.22),PAD:ie(.2,[48,72],se(.6,.3,.7,1.2),"sine","lowpass",1e3,1,.4,0,.8,2,.9),BASS:ie(.2,[36,52],se(.01,.2,.55,.2),"triangle","lowpass",400,1.5,.5,0,.3,3,.35)},syncThreshold:.42,encounterR:.1,entainment:.55,eventRate:.65,reverbAmt:.45,delayAmt:.4,delayTime:.22,masterGain:.78,harmonyMode:"consonant",particleGlow:1.2,trailLen:0,lens:"Notes",bgPulse:!1,cinematic:!1,primary:"#aaeeff",secondary:"#0a1020",accent:"#ffd700",gateCount:4,attractorCount:1},{id:"drone-mandala",name:"Drone Mandala",intensity:1,description:"Espiral lenta formando mandala sonora. Drones e overtones emergentes.",vibe:"Ritual, Trance, Ancient",tags:["Drone","Meditative","Space","Experimental"],bpm:44,scale:"phrygian",root:36,quantaCount:56,motionStyle:"spiral",roles:{PAD:ie(.4,[36,60],se(2,.8,.85,3.5),"sawtooth","lowpass",350,2,.5,0,.9,3,2),CHOIR:ie(.3,[48,72],se(1.8,.7,.8,3),"sine","lowpass",700,1,.4,0,1,2,2.5),STRINGS:ie(.2,[42,66],se(1,.5,.7,2),"triangle","lowpass",1e3,1.2,.35,5,.8,2,1.5),BASS:ie(.1,[24,42],se(.5,.4,.8,2),"sine","lowpass",180,.8,.55,0,.3,2,1.5)},syncThreshold:.25,encounterR:.18,entainment:.2,eventRate:.18,reverbAmt:.9,delayAmt:.65,delayTime:.7,masterGain:.6,harmonyMode:"modal",particleGlow:2.5,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#cc88ff",secondary:"#0a0515",accent:"#ffcc88",gateCount:2,attractorCount:1},{id:"aurora",name:"Aurora Borealis",intensity:2,description:"Partculas migrando como cortinas de aurora. Melodias etreas.",vibe:"Northern Lights, Ethereal, Slow",tags:["Ambient","Space","Experimental","Soft"],bpm:46,scale:"whole_tone",root:50,quantaCount:88,motionStyle:"migration",roles:{STRINGS:ie(.35,[48,76],se(1,.5,.72,2),"triangle","lowpass",1400,1,.4,7,.9,3,1.5),PAD:ie(.3,[42,66],se(1.8,.7,.8,3),"sine","lowpass",650,.9,.38,0,.8,3,2),CHOIR:ie(.2,[55,72],se(1.5,.6,.75,2.5),"sine","lowpass",600,1,.32,0,1,2,2.2),ARP:ie(.15,[60,88],se(.05,.15,.2,.5),"triangle","highpass",2e3,1.5,.25,12,.7,2,.8)},syncThreshold:.3,encounterR:.16,entainment:.28,eventRate:.3,reverbAmt:.88,delayAmt:.55,delayTime:.55,masterGain:.65,harmonyMode:"free",particleGlow:2.4,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#44ffcc",secondary:"#020812",accent:"#ff88cc",gateCount:3,attractorCount:0},{id:"berlin-techno",name:"Berlin Techno Engine",intensity:5,description:"Kick 4/4 emergente por sync peaks. Bass pulse profundo. Swarm bunker.",vibe:"Bunker, Sub-bass, Sidechain",tags:["Techno","Club","Electronic","Dark"],bpm:132,scale:"minor",root:36,quantaCount:128,motionStyle:"swarm",roles:{KICK:ie(.25,[24,36],se(.001,.08,0,.05),"kick","lowpass",200,.5,.9,0,.3,6,.4),BASS:ie(.2,[36,48],se(.005,.18,.6,.12),"sawtooth","lowpass",280,3,.7,-5,.4,4,.25),PERC:ie(.2,[60,72],se(.001,.06,0,.04),"hihat","highpass",5e3,.5,.55,0,.8,4,.18),LEAD:ie(.2,[60,80],se(.01,.1,.4,.18),"sawtooth","lowpass",1400,4,.6,7,.5,3,.3),PAD:ie(.15,[48,60],se(.4,.3,.7,.8),"sawtooth","lowpass",600,2,.35,0,.6,2,.8)},syncThreshold:.55,encounterR:.12,entainment:.65,eventRate:.9,reverbAmt:.18,delayAmt:.15,delayTime:.17,masterGain:.88,harmonyMode:"modal",particleGlow:1.4,trailLen:0,lens:"Rhythm",bgPulse:!0,cinematic:!0,primary:"#00d4ff",secondary:"#7700ff",accent:"#ff2255",gateCount:4,attractorCount:1},{id:"minimal-micro",name:"Minimal Microhouse",intensity:3,description:"Groove swing com clicks percussivos. Menos  mais.",vibe:"Clicks, Swing, Hypnotic",tags:["Techno","Minimal","Groove"],bpm:124,scale:"minor",root:36,quantaCount:64,motionStyle:"drift",roles:{KICK:ie(.18,[24,36],se(.001,.06,0,.04),"kick","lowpass",180,.4,.8,0,.2,4,.45),PERC:ie(.35,[60,84],se(.001,.04,0,.02),"snare","bandpass",3500,.8,.5,0,.7,5,.2),BASS:ie(.22,[36,48],se(.01,.12,.3,.1),"triangle","lowpass",350,2,.55,0,.35,3,.35),LEAD:ie(.25,[60,72],se(.008,.08,.4,.12),"square","lowpass",800,3,.45,12,.6,2,.4)},syncThreshold:.4,encounterR:.09,entainment:.4,eventRate:.6,reverbAmt:.12,delayAmt:.25,delayTime:.12,masterGain:.8,harmonyMode:"modal",particleGlow:1,trailLen:0,lens:"Rhythm",bgPulse:!1,cinematic:!1,primary:"#33ff88",secondary:"#1a1a2e",accent:"#ff8833",gateCount:3,attractorCount:1},{id:"acid-swarm",name:"Acid Swarm",intensity:5,description:"303-style acid com flock murmuration. Slides por velocidade do bando.",vibe:"Resonance, Squelch, Rave",tags:["Techno","Acid","Rave","Electronic"],bpm:138,scale:"minor",root:36,quantaCount:96,motionStyle:"murmuration",roles:{KICK:ie(.18,[24,36],se(.001,.07,0,.05),"kick","lowpass",220,.5,.85,0,.2,5,.35),BASS:ie(.3,[36,52],se(.002,.12,.45,.08),"sawtooth","lowpass",360,18,.75,-7,.4,4,.14),PERC:ie(.22,[60,84],se(.001,.05,0,.03),"hihat","highpass",6e3,.5,.5,0,.7,4,.16),LEAD:ie(.3,[52,76],se(.003,.1,.35,.1),"sawtooth","lowpass",450,14,.65,0,.5,3,.18)},syncThreshold:.5,encounterR:.11,entainment:.7,eventRate:.85,reverbAmt:.15,delayAmt:.2,delayTime:.14,masterGain:.82,harmonyMode:"modal",particleGlow:1.6,trailLen:0,lens:"Rhythm",bgPulse:!0,cinematic:!0,primary:"#ff5500",secondary:"#220000",accent:"#00ff88",gateCount:4,attractorCount:2},{id:"detroit-chords",name:"Detroit Chords",intensity:4,description:"Pares orbitantes gerando chord stabs. Dana de Detroit soul.",vibe:"Soulful, Chords, Garage",tags:["Techno","Club","Groove","Ambient"],bpm:122,scale:"minor",root:48,quantaCount:88,motionStyle:"dance",roles:{KICK:ie(.18,[24,36],se(.001,.1,0,.06),"kick","lowpass",200,.5,.82,0,.2,4,.42),BASS:ie(.18,[36,52],se(.008,.22,.55,.15),"sawtooth","lowpass",300,2.5,.65,-3,.35,3,.3),PAD:ie(.25,[48,72],se(.08,.15,.65,.45),"sawtooth","lowpass",1200,3,.55,7,.8,4,.5),LEAD:ie(.2,[60,84],se(.01,.08,.5,.15),"square","lowpass",1800,2.5,.5,5,.6,3,.25),STRINGS:ie(.19,[48,72],se(.3,.2,.7,1),"triangle","lowpass",1400,1,.4,0,.7,3,.8)},syncThreshold:.48,encounterR:.12,entainment:.55,eventRate:.7,reverbAmt:.3,delayAmt:.35,delayTime:.22,masterGain:.82,harmonyMode:"modal",particleGlow:1.3,trailLen:0,lens:"Harmony",bgPulse:!0,cinematic:!1,primary:"#ff9944",secondary:"#1a0a1e",accent:"#44aaff",gateCount:4,attractorCount:1},{id:"breakbeat",name:"Breakbeat Reactor",intensity:5,description:"Caos browniano gerando breaks imprevisveis. Cada coliso  um hit.",vibe:"Breaks, Chaos, Rave",tags:["Breakbeat","Electronic","Experimental","Rave"],bpm:140,scale:"minor",root:36,quantaCount:112,motionStyle:"chaos",roles:{KICK:ie(.2,[24,36],se(.001,.06,0,.04),"kick","lowpass",220,.5,.9,0,.3,6,.3),PERC:ie(.3,[48,84],se(.001,.05,0,.03),"snare","bandpass",3500,1,.55,0,.8,5,.15),BASS:ie(.2,[36,52],se(.003,.15,.5,.08),"sawtooth","lowpass",280,4,.7,-5,.3,4,.2),LEAD:ie(.15,[60,84],se(.005,.08,.35,.12),"square","bandpass",1600,3,.5,7,.5,3,.18),ARP:ie(.15,[60,96],se(.002,.06,.1,.08),"square","lowpass",2800,2,.45,0,.7,3,.12)},syncThreshold:.6,encounterR:.1,entainment:.75,eventRate:1,reverbAmt:.12,delayAmt:.18,delayTime:.11,masterGain:.85,harmonyMode:"free",particleGlow:1.5,trailLen:0,lens:"Rhythm",bgPulse:!0,cinematic:!0,primary:"#ff2200",secondary:"#0a0008",accent:"#ffcc00",gateCount:6,attractorCount:2},{id:"dub-techno",name:"Dub Techno Fog",intensity:3,description:"Massa orgnica respirando em delay infinito. Cordas dubby.",vibe:"Dub, Fog, Hypnotic",tags:["Techno","Ambient","Drone","Club"],bpm:120,scale:"dorian",root:36,quantaCount:80,motionStyle:"organism",roles:{KICK:ie(.15,[24,36],se(.001,.12,0,.08),"kick","lowpass",160,.4,.75,0,.2,3,.5),BASS:ie(.22,[36,52],se(.01,.25,.6,.2),"sine","lowpass",250,1.5,.6,0,.3,3,.4),PAD:ie(.28,[48,72],se(.5,.3,.75,1.5),"sawtooth","lowpass",600,2.5,.45,5,.8,3,1),PERC:ie(.15,[60,84],se(.001,.04,0,.03),"hihat","highpass",4500,.5,.4,0,.6,4,.22),STRINGS:ie(.2,[48,72],se(.4,.3,.65,1.2),"triangle","lowpass",1100,1,.38,0,.7,2,.9)},syncThreshold:.38,encounterR:.13,entainment:.45,eventRate:.5,reverbAmt:.75,delayAmt:.65,delayTime:.35,masterGain:.75,harmonyMode:"modal",particleGlow:1.6,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#5588cc",secondary:"#050810",accent:"#aaddff",gateCount:3,attractorCount:1},{id:"carnival-samba",name:"Carnival Samba",intensity:5,description:"Trs vrtices em festa. Percusso sincopada com swing brasileiro.",vibe:"Carnaval, Ritmo, Energia",tags:["Groove","Dynamic","Electronic","Experimental"],bpm:126,scale:"dorian",root:48,quantaCount:120,motionStyle:"carnival",roles:{KICK:ie(.18,[24,36],se(.001,.07,0,.05),"kick","lowpass",200,.5,.85,0,.2,5,.35),PERC:ie(.3,[48,84],se(.001,.05,0,.02),"snare","bandpass",3e3,.8,.55,0,.8,5,.14),BASS:ie(.18,[36,52],se(.008,.15,.5,.1),"sawtooth","lowpass",320,3,.65,-3,.35,4,.22),ARP:ie(.2,[60,96],se(.003,.08,.15,.12),"square","lowpass",2400,2,.5,0,.7,4,.1),LEAD:ie(.14,[60,84],se(.01,.1,.4,.15),"sawtooth","lowpass",1600,3,.55,7,.5,3,.2)},syncThreshold:.55,encounterR:.11,entainment:.7,eventRate:.9,reverbAmt:.2,delayAmt:.25,delayTime:.13,masterGain:.85,harmonyMode:"modal",particleGlow:1.5,trailLen:0,lens:"Rhythm",bgPulse:!0,cinematic:!0,primary:"#ffcc00",secondary:"#1a0a00",accent:"#ff3366",gateCount:5,attractorCount:3},{id:"reich-phase",name:"Reich Phase Machine",intensity:3,description:"Phasing emergente por espiral. Padres se desalinham e realinham.",vibe:"Phasing, Pattern, Process",tags:["Classical","Minimalist","Generative","Experimental"],bpm:96,scale:"major",root:60,quantaCount:80,motionStyle:"revolution",roles:{ARP:ie(.35,[60,84],se(.003,.1,.18,.15),"triangle","lowpass",2800,1.5,.5,0,.6,4,.16),LEAD:ie(.25,[60,80],se(.005,.08,.45,.12),"triangle","lowpass",2200,1,.48,3,.5,3,.18),PAD:ie(.2,[48,72],se(.5,.3,.7,1),"sine","lowpass",900,1,.38,0,.7,2,.8),PERC:ie(.2,[60,84],se(.001,.04,0,.03),"noise","highpass",4e3,.4,.42,0,.6,4,.2)},syncThreshold:.45,encounterR:.1,entainment:.6,eventRate:.7,reverbAmt:.35,delayAmt:.45,delayTime:.28,masterGain:.78,harmonyMode:"consonant",particleGlow:1.2,trailLen:0,lens:"Notes",bgPulse:!1,cinematic:!1,primary:"#ccffaa",secondary:"#080c08",accent:"#ffaa44",gateCount:4,attractorCount:1},{id:"satie-gymno",name:"Satie Gymnopdie",intensity:2,description:"Deriva suave com notas esparsas de piano. Simplicidade perfeita.",vibe:"Sparse, Gentle, Elegant",tags:["Classical","Minimalist","Soft","Ambient"],bpm:62,scale:"lydian",root:53,quantaCount:48,motionStyle:"drift",roles:{LEAD:ie(.4,[60,84],se(.01,.15,.4,.3),"triangle","lowpass",2e3,1,.45,0,.5,2,.5),PAD:ie(.3,[48,72],se(1,.5,.75,2),"sine","lowpass",800,1,.35,0,.8,2,1.5),BASS:ie(.15,[36,52],se(.05,.3,.55,.4),"sine","lowpass",350,1,.5,0,.3,2,.6),STRINGS:ie(.15,[48,72],se(.5,.3,.65,1.5),"triangle","lowpass",1200,1,.35,5,.7,2,1.2)},syncThreshold:.3,encounterR:.15,entainment:.3,eventRate:.3,reverbAmt:.65,delayAmt:.4,delayTime:.35,masterGain:.7,harmonyMode:"consonant",particleGlow:1.5,trailLen:0,lens:"Notes",bgPulse:!1,cinematic:!0,primary:"#ffeedd",secondary:"#0a0808",accent:"#aaccff",gateCount:2,attractorCount:0},{id:"bartok-pizz",name:"Bartk Pizzicato",intensity:3,description:"Microclusters formam, improvisam e dissolvem. Pizzicato folclrico.",vibe:"Folk, Plucked, Angular",tags:["Classical","Experimental","Strings","Dynamic"],bpm:104,scale:"harmonic_minor",root:45,quantaCount:72,motionStyle:"jazz",roles:{STRINGS:ie(.3,[48,76],se(.003,.08,.12,.15),"triangle","bandpass",1800,2,.5,0,.7,3,.18),LEAD:ie(.25,[52,84],se(.005,.1,.35,.12),"triangle","lowpass",2200,2,.48,5,.5,3,.2),PERC:ie(.2,[60,84],se(.001,.04,0,.03),"noise","bandpass",2500,.6,.42,0,.6,4,.16),PAD:ie(.15,[42,60],se(.4,.3,.6,1),"sine","lowpass",600,1,.35,0,.7,2,.9),BASS:ie(.1,[28,48],se(.01,.15,.45,.15),"triangle","lowpass",300,1.5,.55,0,.3,2,.4)},syncThreshold:.4,encounterR:.1,entainment:.5,eventRate:.55,reverbAmt:.35,delayAmt:.3,delayTime:.18,masterGain:.78,harmonyMode:"modal",particleGlow:1,trailLen:0,lens:"Notes",bgPulse:!1,cinematic:!1,primary:"#ffd700",secondary:"#0c0800",accent:"#88aaff",gateCount:4,attractorCount:1},{id:"cool-jazz",name:"Cool Jazz Midnight",intensity:3,description:"Clusters improvisando em modal. Brushes, piano, contrabaixo.",vibe:"Smoky, Modal, Late Night",tags:["Jazz","Improvisation","Modal","Soft"],bpm:72,scale:"dorian",root:45,quantaCount:64,motionStyle:"jazz",roles:{BASS:ie(.2,[28,48],se(.02,.25,.65,.3),"triangle","lowpass",280,1.5,.55,0,.3,2,.4),LEAD:ie(.25,[55,84],se(.01,.12,.45,.2),"triangle","lowpass",1800,1.5,.48,0,.5,3,.25),PAD:ie(.18,[48,72],se(.5,.3,.7,1.2),"sine","lowpass",800,1,.38,5,.7,2,.9),PERC:ie(.22,[48,72],se(.001,.06,0,.04),"noise","bandpass",2e3,.5,.4,0,.6,4,.2),ARP:ie(.15,[60,88],se(.005,.1,.2,.15),"triangle","lowpass",2400,1,.4,0,.5,2,.3)},syncThreshold:.35,encounterR:.12,entainment:.4,eventRate:.45,reverbAmt:.55,delayAmt:.4,delayTime:.28,masterGain:.72,harmonyMode:"modal",particleGlow:1.3,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#ff9944",secondary:"#0a0608",accent:"#88ccff",gateCount:3,attractorCount:1},{id:"free-jazz",name:"Free Jazz Storm",intensity:5,description:"Dois exrcitos tmbricos colidindo. Cromatismo livre. Ornette Coleman.",vibe:"Free, Collision, Energy",tags:["Jazz","Experimental","Dynamic","Improvisation"],bpm:108,scale:"chromatic",root:48,quantaCount:96,motionStyle:"war",roles:{LEAD:ie(.25,[48,96],se(.003,.08,.35,.1),"sawtooth","lowpass",2500,3,.55,7,.6,3,.15),PERC:ie(.25,[48,84],se(.001,.05,0,.04),"noise","bandpass",3e3,.6,.48,0,.8,5,.12),BASS:ie(.2,[28,52],se(.005,.18,.55,.12),"sawtooth","lowpass",350,3,.65,-5,.3,3,.2),ARP:ie(.15,[60,96],se(.002,.06,.15,.08),"square","bandpass",2e3,4,.45,12,.7,3,.1),PAD:ie(.15,[42,66],se(.2,.2,.5,.5),"sawtooth","lowpass",700,2,.35,0,.6,2,.5)},syncThreshold:.55,encounterR:.09,entainment:.65,eventRate:1,reverbAmt:.25,delayAmt:.2,delayTime:.12,masterGain:.8,harmonyMode:"free",particleGlow:1.5,trailLen:0,lens:"Tension",bgPulse:!0,cinematic:!0,primary:"#ff3333",secondary:"#0a0004",accent:"#ffcc00",gateCount:6,attractorCount:2},{id:"bebop-cells",name:"Bebop Cells",intensity:4,description:"Grupos celulares respirando. Linhas harmnicas rpidas. Walking bass.",vibe:"Swing, Virtuosity, Energy",tags:["Jazz","Groove","Dynamic","Improvisation"],bpm:160,scale:"mixolydian",root:48,quantaCount:80,motionStyle:"cells",roles:{BASS:ie(.2,[28,52],se(.01,.12,.55,.1),"triangle","lowpass",350,1.5,.6,0,.3,3,.18),LEAD:ie(.3,[55,96],se(.003,.06,.35,.08),"triangle","lowpass",2800,1.5,.5,0,.5,3,.12),PERC:ie(.25,[48,84],se(.001,.04,0,.02),"hihat","highpass",5e3,.4,.45,0,.7,5,.1),ARP:ie(.15,[60,90],se(.003,.08,.2,.1),"triangle","lowpass",2400,1,.42,5,.6,3,.14),PAD:ie(.1,[48,66],se(.2,.2,.5,.5),"sine","lowpass",700,1,.3,0,.6,2,.8)},syncThreshold:.5,encounterR:.09,entainment:.6,eventRate:.85,reverbAmt:.25,delayAmt:.2,delayTime:.1,masterGain:.78,harmonyMode:"modal",particleGlow:1,trailLen:0,lens:"Notes",bgPulse:!1,cinematic:!1,primary:"#ff9944",secondary:"#0c0608",accent:"#44ff88",gateCount:5,attractorCount:1},{id:"ballistic-cathedral",name:"Ballistic Cathedral",intensity:4,description:"Gravidade real. Partculas caem e ricocheteiam em gates  cada quique  uma nota.",vibe:"Gravity, Bounce, Percussion",tags:["Experimental","Dynamic","Generative"],bpm:100,scale:"pentatonic",root:48,quantaCount:60,motionStyle:"ballistic",roles:{PERC:ie(.3,[48,84],se(.001,.05,0,.04),"noise","bandpass",2500,.6,.55,0,.7,5,.15),LEAD:ie(.25,[55,84],se(.005,.1,.35,.15),"triangle","lowpass",2200,1.5,.48,0,.5,3,.2),BASS:ie(.2,[28,48],se(.01,.2,.55,.15),"sine","lowpass",250,1,.55,0,.3,3,.3),ARP:ie(.15,[60,96],se(.003,.08,.12,.1),"triangle","lowpass",3e3,1.5,.42,5,.6,3,.14),STRINGS:ie(.1,[48,72],se(.3,.2,.6,.8),"triangle","lowpass",1200,1,.35,0,.7,2,.8)},syncThreshold:.45,encounterR:.1,entainment:.55,eventRate:.7,reverbAmt:.55,delayAmt:.4,delayTime:.25,masterGain:.78,harmonyMode:"consonant",particleGlow:1.3,trailLen:0,lens:"Notes",bgPulse:!1,cinematic:!1,primary:"#ffd700",secondary:"#080808",accent:"#88aaff",gateCount:5,attractorCount:0},{id:"murmuration-song",name:"Murmuration Song",intensity:4,description:"O bando  a orquestra. 8 roles em formao de estorninho cantante.",vibe:"Flock, Orchestra, Emergence",tags:["Generative","Experimental","Orchestral","Dynamic"],bpm:88,scale:"major",root:48,quantaCount:128,motionStyle:"murmuration",roles:{KICK:ie(.1,[24,36],se(.001,.08,0,.05),"kick","lowpass",180,.4,.75,0,.2,3,.45),BASS:ie(.12,[36,52],se(.01,.2,.55,.15),"sine","lowpass",280,1.5,.55,0,.3,3,.35),PERC:ie(.12,[48,84],se(.001,.04,0,.03),"hihat","highpass",5e3,.5,.4,0,.7,4,.18),PAD:ie(.15,[48,72],se(.6,.3,.75,1.2),"sine","lowpass",900,1,.38,0,.8,3,1),LEAD:ie(.15,[55,84],se(.008,.1,.45,.15),"triangle","lowpass",2e3,1.5,.48,5,.5,3,.22),ARP:ie(.12,[60,96],se(.003,.08,.15,.1),"triangle","lowpass",2800,1,.42,0,.6,3,.14),STRINGS:ie(.12,[48,76],se(.35,.2,.65,1),"triangle","lowpass",1400,1,.38,3,.8,3,.7),CHOIR:ie(.12,[48,72],se(1,.5,.75,2),"sine","lowpass",700,1,.32,0,.9,2,1.5)},syncThreshold:.42,encounterR:.11,entainment:.55,eventRate:.6,reverbAmt:.45,delayAmt:.35,delayTime:.22,masterGain:.8,harmonyMode:"consonant",particleGlow:1.5,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#88aaff",secondary:"#060810",accent:"#ffcc88",gateCount:4,attractorCount:1},{id:"organism-pulse",name:"Organism Pulse",intensity:3,description:"Organismo vivo respirando. Contrao = ritmo, expanso = melodia.",vibe:"Alive, Breath, Organic",tags:["Generative","Experimental","Organic Instruments","Ambient"],bpm:76,scale:"dorian",root:40,quantaCount:96,motionStyle:"organism",roles:{KICK:ie(.12,[24,36],se(.001,.1,0,.06),"kick","lowpass",180,.4,.72,0,.2,3,.5),BASS:ie(.18,[28,48],se(.02,.25,.65,.2),"sine","lowpass",220,1,.55,0,.3,3,.4),PAD:ie(.25,[42,66],se(1,.5,.8,2),"triangle","lowpass",700,1.2,.42,5,.8,3,1.2),LEAD:ie(.18,[55,80],se(.01,.12,.42,.18),"triangle","lowpass",1800,1.5,.45,0,.5,3,.25),STRINGS:ie(.15,[48,72],se(.4,.3,.65,1),"triangle","lowpass",1200,1,.38,3,.7,2,.8),CHOIR:ie(.12,[48,72],se(1.2,.5,.75,2.5),"sine","lowpass",650,1,.32,0,.9,2,1.5)},syncThreshold:.38,encounterR:.13,entainment:.45,eventRate:.5,reverbAmt:.55,delayAmt:.4,delayTime:.3,masterGain:.75,harmonyMode:"modal",particleGlow:1.8,trailLen:0,lens:"Events",bgPulse:!1,cinematic:!0,primary:"#44ff88",secondary:"#040a06",accent:"#ff88cc",gateCount:3,attractorCount:1},{id:"predator-prey",name:"Predator Prey",intensity:4,description:"Roles perseguem e fogem. A tenso da caa vira tenso harmnica.",vibe:"Hunt, Flight, Tension",tags:["Experimental","Dynamic","Generative"],bpm:112,scale:"harmonic_minor",root:40,quantaCount:88,motionStyle:"predation",roles:{KICK:ie(.12,[24,36],se(.001,.07,0,.05),"kick","lowpass",200,.5,.82,0,.2,4,.4),BASS:ie(.18,[28,52],se(.008,.2,.55,.12),"sawtooth","lowpass",300,2.5,.65,-3,.3,3,.25),PERC:ie(.18,[48,84],se(.001,.05,0,.03),"snare","bandpass",3e3,.6,.48,0,.7,5,.15),LEAD:ie(.22,[52,88],se(.005,.08,.4,.12),"sawtooth","lowpass",2e3,3,.55,7,.5,3,.18),PAD:ie(.15,[42,66],se(.3,.2,.6,.8),"triangle","lowpass",700,1.5,.38,0,.7,2,.7),ARP:ie(.15,[60,90],se(.003,.08,.15,.1),"square","lowpass",2500,2,.42,0,.6,3,.12)},syncThreshold:.48,encounterR:.1,entainment:.6,eventRate:.75,reverbAmt:.3,delayAmt:.25,delayTime:.15,masterGain:.8,harmonyMode:"dissonant",particleGlow:1.4,trailLen:0,lens:"Tension",bgPulse:!0,cinematic:!0,primary:"#ff4422",secondary:"#0a0204",accent:"#44ffcc",gateCount:5,attractorCount:2},{id:"exodus-song",name:"Exodus Migration",intensity:4,description:"Migrao em massa cruzando portais sonoros. pico e linear.",vibe:"Epic, Linear, Journey",tags:["Generative","Dynamic","Orchestral","Experimental"],bpm:94,scale:"mixolydian",root:45,quantaCount:112,motionStyle:"exodus",roles:{KICK:ie(.1,[24,36],se(.001,.08,0,.05),"kick","lowpass",180,.4,.78,0,.2,3,.45),BASS:ie(.15,[28,48],se(.01,.2,.55,.15),"triangle","lowpass",300,1.5,.55,0,.3,3,.3),STRINGS:ie(.25,[42,72],se(.3,.2,.65,1),"triangle","lowpass",1400,1,.42,5,.8,3,.7),LEAD:ie(.2,[55,84],se(.01,.1,.45,.15),"sawtooth","lowpass",2e3,2,.5,0,.5,3,.22),PAD:ie(.15,[42,66],se(.6,.3,.75,1.5),"sine","lowpass",800,1,.38,0,.8,2,1),CHOIR:ie(.15,[48,72],se(1,.5,.75,2),"sine","lowpass",700,1,.35,0,.9,2,1.5)},syncThreshold:.42,encounterR:.12,entainment:.5,eventRate:.6,reverbAmt:.5,delayAmt:.4,delayTime:.25,masterGain:.78,harmonyMode:"modal",particleGlow:1.6,trailLen:0,lens:"Events",bgPulse:!1,cinematic:!0,primary:"#88ff44",secondary:"#060a04",accent:"#ffaa44",gateCount:5,attractorCount:0},{id:"polarization-duet",name:"Polarization Duet",intensity:3,description:"Duas polaridades harmnicas emergem. Consonncia vs dissonncia viva.",vibe:"Duality, Contrast, Tension",tags:["Experimental","Generative","Dynamic"],bpm:84,scale:"harmonic_minor",root:48,quantaCount:80,motionStyle:"polarization",roles:{PAD:ie(.25,[42,66],se(.6,.3,.75,1.5),"sawtooth","lowpass",700,2,.42,5,.8,3,1),LEAD:ie(.22,[52,84],se(.01,.1,.42,.15),"triangle","lowpass",2e3,1.5,.48,0,.5,3,.22),STRINGS:ie(.2,[48,76],se(.35,.2,.65,1),"triangle","lowpass",1400,1,.38,3,.8,2,.7),BASS:ie(.18,[28,52],se(.02,.25,.6,.2),"sine","lowpass",250,1,.55,0,.3,3,.4),CHOIR:ie(.15,[48,72],se(1,.5,.75,2),"sine","lowpass",650,1,.32,0,.9,2,1.5)},syncThreshold:.38,encounterR:.14,entainment:.45,eventRate:.5,reverbAmt:.55,delayAmt:.45,delayTime:.35,masterGain:.72,harmonyMode:"modal",particleGlow:1.8,trailLen:0,lens:"Tension",bgPulse:!1,cinematic:!0,primary:"#ff8800",secondary:"#080404",accent:"#4488ff",gateCount:4,attractorCount:1},{id:"revolution-spiral",name:"Revolution Spiral",intensity:4,description:"Espiral que aperta at explodir. Cada colapso  um clmax musical.",vibe:"Tightening, Release, Cycle",tags:["Experimental","Dynamic","Generative"],bpm:108,scale:"phrygian",root:40,quantaCount:96,motionStyle:"revolution",roles:{KICK:ie(.12,[24,36],se(.001,.08,0,.05),"kick","lowpass",200,.5,.82,0,.2,4,.4),BASS:ie(.18,[28,52],se(.005,.18,.55,.12),"sawtooth","lowpass",320,3,.65,-5,.3,3,.22),LEAD:ie(.25,[52,84],se(.005,.08,.4,.1),"sawtooth","lowpass",1800,3,.55,7,.5,3,.16),PERC:ie(.18,[48,84],se(.001,.05,0,.03),"snare","bandpass",3e3,.6,.48,0,.7,5,.14),PAD:ie(.15,[42,66],se(.3,.2,.55,.6),"triangle","lowpass",600,1.5,.38,0,.6,2,.6),ARP:ie(.12,[60,96],se(.003,.06,.12,.08),"square","lowpass",2600,2,.42,0,.6,3,.1)},syncThreshold:.5,encounterR:.1,entainment:.65,eventRate:.8,reverbAmt:.3,delayAmt:.25,delayTime:.15,masterGain:.82,harmonyMode:"dissonant",particleGlow:1.5,trailLen:0,lens:"Tension",bgPulse:!0,cinematic:!0,primary:"#cc44ff",secondary:"#0a0210",accent:"#44ffcc",gateCount:5,attractorCount:2},{id:"explosion-nebula",name:"Explosion Nebula",intensity:5,description:"Exploses cclicas. Cada expanso espalha fragmentos meldicos.",vibe:"Burst, Debris, Cosmic",tags:["Experimental","Space","Dynamic","Generative"],bpm:96,scale:"whole_tone",root:42,quantaCount:104,motionStyle:"explosion",roles:{KICK:ie(.12,[24,36],se(.001,.06,0,.04),"kick","lowpass",200,.5,.85,0,.2,5,.35),PERC:ie(.22,[48,84],se(.001,.04,0,.03),"snare","bandpass",3500,.8,.5,0,.8,5,.12),LEAD:ie(.25,[52,88],se(.003,.08,.3,.1),"triangle","lowpass",2500,2,.5,5,.5,3,.14),ARP:ie(.18,[60,96],se(.002,.06,.12,.08),"triangle","highpass",2e3,1.5,.42,12,.7,3,.1),PAD:ie(.12,[42,66],se(.3,.2,.5,.5),"sine","lowpass",650,1,.35,0,.6,2,.6),STRINGS:ie(.11,[48,72],se(.2,.2,.55,.8),"triangle","lowpass",1200,1,.35,0,.7,2,.7)},syncThreshold:.5,encounterR:.1,entainment:.6,eventRate:.8,reverbAmt:.4,delayAmt:.35,delayTime:.2,masterGain:.8,harmonyMode:"free",particleGlow:1.8,trailLen:0,lens:"Events",bgPulse:!0,cinematic:!0,primary:"#ff6600",secondary:"#0a0400",accent:"#88ccff",gateCount:5,attractorCount:1},{id:"sitar-raga",name:"Sitar Raga Meditation",intensity:2,description:"Raga emergente com drone tanpura. Espiral meditativa.",vibe:"Raga, Drone, Tanpura",tags:["Modal","Meditative","Strings","Ambient"],bpm:68,scale:"phrygian",root:45,quantaCount:72,motionStyle:"spiral",roles:{STRINGS:ie(.35,[48,84],se(.01,.12,.45,.3),"triangle","bandpass",1600,3,.5,7,.7,3,.25),PAD:ie(.25,[36,60],se(2,.8,.85,3.5),"sine","lowpass",350,1,.45,0,.8,3,2),LEAD:ie(.2,[55,84],se(.008,.1,.4,.2),"triangle","lowpass",2200,2,.48,0,.5,3,.22),BASS:ie(.1,[28,42],se(.5,.4,.8,2),"sine","lowpass",180,.8,.5,0,.2,2,1.5),CHOIR:ie(.1,[48,72],se(1.5,.6,.75,2.5),"sine","lowpass",600,1,.3,0,.9,2,2)},syncThreshold:.32,encounterR:.15,entainment:.3,eventRate:.35,reverbAmt:.75,delayAmt:.5,delayTime:.45,masterGain:.7,harmonyMode:"modal",particleGlow:2,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#ffd700",secondary:"#0a0800",accent:"#ff6644",gateCount:3,attractorCount:1},{id:"gamelan-bells",name:"Gamelan Bells",intensity:3,description:"Metalofone em grade. Bells e gongs sobrepostos em camadas.",vibe:"Bells, Layers, Ceremony",tags:["Modal","Experimental","Minimalist"],bpm:78,scale:"pentatonic",root:55,quantaCount:72,motionStyle:"lattice",roles:{LEAD:ie(.3,[55,84],se(.003,.2,.1,.5),"triangle","bandpass",2800,3,.5,0,.6,3,.25),ARP:ie(.25,[60,96],se(.002,.15,.08,.4),"triangle","bandpass",3500,2,.45,5,.7,3,.18),PAD:ie(.2,[42,66],se(.8,.4,.7,1.5),"sine","lowpass",600,1,.38,0,.8,2,1),BASS:ie(.15,[28,48],se(.05,.3,.65,.5),"sine","lowpass",250,1,.5,0,.3,2,.5),PERC:ie(.1,[60,84],se(.001,.08,0,.06),"noise","bandpass",4e3,.4,.38,0,.6,3,.2)},syncThreshold:.38,encounterR:.12,entainment:.45,eventRate:.55,reverbAmt:.65,delayAmt:.5,delayTime:.32,masterGain:.72,harmonyMode:"consonant",particleGlow:1.4,trailLen:0,lens:"Notes",bgPulse:!1,cinematic:!1,primary:"#ffd700",secondary:"#0c0a04",accent:"#ff4400",gateCount:4,attractorCount:1},{id:"flamenco",name:"Flamenco Duende",intensity:4,description:"Espiral flamenca. Cada volta aperta a intensidade at o grito.",vibe:"Fire, Passion, Spiral",tags:["Modal","Dynamic","Strings","Groove"],bpm:118,scale:"phrygian",root:40,quantaCount:80,motionStyle:"revolution",roles:{STRINGS:ie(.3,[48,80],se(.005,.08,.35,.12),"triangle","bandpass",1800,3,.55,0,.7,3,.16),PERC:ie(.25,[48,72],se(.001,.05,0,.03),"snare","bandpass",2500,.6,.5,0,.7,5,.12),BASS:ie(.18,[28,48],se(.01,.15,.5,.1),"triangle","lowpass",300,2,.55,0,.3,3,.22),LEAD:ie(.15,[55,88],se(.003,.06,.38,.1),"sawtooth","lowpass",2200,3,.5,5,.5,3,.14),PAD:ie(.12,[40,60],se(.2,.2,.5,.5),"sine","lowpass",500,1.5,.35,0,.6,2,.6)},syncThreshold:.5,encounterR:.1,entainment:.65,eventRate:.8,reverbAmt:.25,delayAmt:.2,delayTime:.12,masterGain:.82,harmonyMode:"modal",particleGlow:1.3,trailLen:0,lens:"Rhythm",bgPulse:!0,cinematic:!0,primary:"#ff2200",secondary:"#0a0200",accent:"#ffd700",gateCount:5,attractorCount:2},{id:"saharan-blues",name:"Saharan Blues",intensity:3,description:"Caravana no deserto. Blues do Sahara com groove hipntico.",vibe:"Desert, Trance, Groove",tags:["Modal","Groove","Experimental"],bpm:108,scale:"blues",root:40,quantaCount:72,motionStyle:"migration",roles:{LEAD:ie(.3,[55,84],se(.005,.1,.4,.15),"triangle","lowpass",2e3,2,.48,5,.5,3,.2),BASS:ie(.2,[28,48],se(.01,.2,.55,.15),"triangle","lowpass",300,1.5,.55,0,.3,3,.3),PERC:ie(.22,[48,84],se(.001,.05,0,.03),"noise","bandpass",3e3,.5,.45,0,.7,4,.16),PAD:ie(.15,[36,60],se(.5,.3,.65,1),"sine","lowpass",500,1,.38,0,.7,2,.8),STRINGS:ie(.13,[48,72],se(.2,.2,.55,.8),"triangle","lowpass",1200,1,.35,3,.7,2,.7)},syncThreshold:.4,encounterR:.11,entainment:.5,eventRate:.6,reverbAmt:.4,delayAmt:.35,delayTime:.22,masterGain:.78,harmonyMode:"modal",particleGlow:1.2,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#cc8844",secondary:"#0a0604",accent:"#44aaff",gateCount:4,attractorCount:0},{id:"cello-solo",name:"Cello Solo",intensity:2,description:"Partcula solitria vagando. Timbre de cello em sawtooth filtrado.",vibe:"Solo, Intimate, Melancholy",tags:["Strings","Soft","Ambient","Classical"],bpm:56,scale:"minor",root:36,quantaCount:32,motionStyle:"drift",roles:{STRINGS:ie(.5,[36,72],se(.15,.15,.65,1.5),"sawtooth","lowpass",1200,2,.5,3,.6,2,.4),PAD:ie(.3,[36,60],se(1.2,.5,.78,2.5),"sine","lowpass",600,1,.35,0,.8,2,1.5),CHOIR:ie(.2,[48,66],se(1,.4,.7,2),"sine","lowpass",550,.9,.28,0,.9,2,2)},syncThreshold:.25,encounterR:.18,entainment:.2,eventRate:.22,reverbAmt:.72,delayAmt:.45,delayTime:.4,masterGain:.65,harmonyMode:"consonant",particleGlow:2,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#cc8844",secondary:"#0a0604",accent:"#ffeedd",gateCount:2,attractorCount:0},{id:"upright-bass",name:"Jazz Upright Bass",intensity:2,description:"Walking bass line emergente. Tom de madeira com harmnicos naturais.",vibe:"Walking, Woody, Groove",tags:["Jazz","Strings","Groove"],bpm:92,scale:"dorian",root:28,quantaCount:48,motionStyle:"flow",roles:{BASS:ie(.45,[28,52],se(.015,.18,.55,.2),"triangle","lowpass",400,1.5,.6,0,.3,3,.22),LEAD:ie(.25,[48,76],se(.01,.1,.4,.15),"triangle","lowpass",1800,1,.45,0,.5,2,.3),PERC:ie(.15,[48,72],se(.001,.05,0,.04),"noise","bandpass",2e3,.4,.38,0,.6,3,.22),PAD:ie(.15,[42,60],se(.4,.3,.65,1),"sine","lowpass",700,1,.32,0,.7,2,.9)},syncThreshold:.35,encounterR:.12,entainment:.4,eventRate:.45,reverbAmt:.45,delayAmt:.3,delayTime:.22,masterGain:.72,harmonyMode:"modal",particleGlow:1,trailLen:0,lens:"Notes",bgPulse:!1,cinematic:!1,primary:"#cc7744",secondary:"#0a0604",accent:"#88ccff",gateCount:3,attractorCount:1},{id:"guitar-pick",name:"Guitar Fingerpick",intensity:3,description:"Grade como trastes. Dedilhado emergente em padres repetitivos.",vibe:"Acoustic, Pattern, Folk",tags:["Strings","Minimalist","Soft","Generative"],bpm:98,scale:"major",root:52,quantaCount:56,motionStyle:"lattice",roles:{LEAD:ie(.35,[52,80],se(.003,.1,.18,.2),"triangle","lowpass",2400,1.5,.48,0,.5,3,.18),ARP:ie(.25,[52,84],se(.002,.08,.12,.15),"triangle","lowpass",3e3,1,.42,0,.6,3,.14),BASS:ie(.2,[36,52],se(.01,.15,.5,.15),"triangle","lowpass",350,1,.52,0,.3,2,.35),PAD:ie(.2,[48,66],se(.5,.3,.6,.8),"sine","lowpass",800,1,.35,0,.7,2,.8)},syncThreshold:.4,encounterR:.1,entainment:.5,eventRate:.55,reverbAmt:.4,delayAmt:.35,delayTime:.2,masterGain:.75,harmonyMode:"consonant",particleGlow:1,trailLen:0,lens:"Notes",bgPulse:!1,cinematic:!1,primary:"#ccaa66",secondary:"#0a0804",accent:"#88aaff",gateCount:4,attractorCount:1},{id:"saxophone",name:"Saxophone Breath",intensity:3,description:"Sopro fluido. Sawtooth+bandpass como timbre de sax tenor.",vibe:"Breath, Fluid, Soul",tags:["Jazz","Improvisation","Modal"],bpm:82,scale:"mixolydian",root:48,quantaCount:56,motionStyle:"flow",roles:{LEAD:ie(.4,[48,80],se(.02,.12,.5,.25),"sawtooth","bandpass",1600,3,.55,5,.5,3,.22),BASS:ie(.2,[28,48],se(.02,.22,.6,.2),"triangle","lowpass",300,1.5,.52,0,.3,2,.35),PAD:ie(.18,[42,66],se(.5,.3,.65,1),"sine","lowpass",700,1,.35,0,.7,2,.8),PERC:ie(.12,[48,72],se(.001,.06,0,.04),"noise","bandpass",2200,.4,.38,0,.6,3,.22),STRINGS:ie(.1,[48,72],se(.3,.2,.55,.8),"triangle","lowpass",1200,1,.32,0,.7,2,.8)},syncThreshold:.35,encounterR:.13,entainment:.4,eventRate:.42,reverbAmt:.5,delayAmt:.35,delayTime:.25,masterGain:.72,harmonyMode:"modal",particleGlow:1.2,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#ffaa44",secondary:"#0a0604",accent:"#88ccff",gateCount:3,attractorCount:1},{id:"darwin-garden",name:"Darwin's Garden",intensity:3,description:"Alta mutao. Roles evoluem. O jardim sonoro se auto-seleciona.",vibe:"Evolution, Mutation, Emergent",tags:["Experimental","Generative","Organic Instruments"],bpm:84,scale:"major",root:48,quantaCount:96,motionStyle:"predation",roles:{KICK:ie(.08,[24,36],se(.001,.08,0,.05),"kick","lowpass",180,.4,.72,0,.2,3,.5),BASS:ie(.12,[28,52],se(.01,.2,.55,.15),"sine","lowpass",250,1,.52,0,.3,3,.35),PERC:ie(.12,[48,84],se(.001,.04,0,.03),"hihat","highpass",5e3,.5,.38,0,.7,4,.18),PAD:ie(.18,[42,66],se(.5,.3,.7,1.2),"sine","lowpass",800,1,.38,0,.8,3,1),LEAD:ie(.15,[55,84],se(.008,.1,.42,.15),"triangle","lowpass",2e3,1.5,.45,0,.5,3,.22),ARP:ie(.12,[60,96],se(.003,.08,.15,.1),"triangle","lowpass",2800,1,.4,0,.6,3,.14),STRINGS:ie(.12,[48,76],se(.3,.2,.6,.8),"triangle","lowpass",1200,1,.35,3,.7,2,.7),CHOIR:ie(.11,[48,72],se(1,.5,.72,2),"sine","lowpass",650,1,.3,0,.9,2,1.5)},syncThreshold:.4,encounterR:.12,entainment:.5,eventRate:.55,reverbAmt:.45,delayAmt:.35,delayTime:.25,masterGain:.75,harmonyMode:"modal",particleGlow:1.5,trailLen:0,lens:"Events",bgPulse:!1,cinematic:!0,primary:"#44cc44",secondary:"#040a04",accent:"#ffaa88",gateCount:4,attractorCount:1},{id:"ant-colony",name:"Ant Colony",intensity:3,description:"Colnia densa com alinhamento apertado. Ritmo emergente do coletivo.",vibe:"Collective, Dense, Pattern",tags:["Generative","Experimental","Groove"],bpm:116,scale:"minor",root:40,quantaCount:128,motionStyle:"school",roles:{KICK:ie(.15,[24,36],se(.001,.06,0,.04),"kick","lowpass",180,.4,.78,0,.2,4,.4),PERC:ie(.28,[48,84],se(.001,.04,0,.02),"noise","bandpass",3500,.6,.45,0,.7,5,.12),BASS:ie(.18,[28,48],se(.008,.15,.5,.1),"triangle","lowpass",280,1.5,.55,0,.3,3,.25),LEAD:ie(.15,[55,80],se(.005,.08,.35,.1),"square","lowpass",1600,2,.45,0,.5,3,.18),ARP:ie(.14,[60,90],se(.002,.06,.12,.08),"triangle","lowpass",2500,1.5,.4,0,.6,3,.1),PAD:ie(.1,[42,60],se(.3,.2,.55,.6),"sine","lowpass",600,1,.32,0,.6,2,.7)},syncThreshold:.45,encounterR:.09,entainment:.6,eventRate:.7,reverbAmt:.2,delayAmt:.2,delayTime:.12,masterGain:.8,harmonyMode:"modal",particleGlow:1,trailLen:0,lens:"Rhythm",bgPulse:!1,cinematic:!1,primary:"#ff8844",secondary:"#0a0604",accent:"#44ff88",gateCount:5,attractorCount:1},{id:"neural-net",name:"Neural Network",intensity:3,description:"Pares formam sinapses. Cada conexo dispara uma nota. Crebro vivo.",vibe:"Synapses, Connections, Intelligence",tags:["Generative","Experimental","Electronic"],bpm:92,scale:"whole_tone",root:48,quantaCount:80,motionStyle:"dance",roles:{LEAD:ie(.25,[55,88],se(.003,.08,.3,.1),"triangle","lowpass",2500,2,.48,5,.5,3,.16),ARP:ie(.22,[60,96],se(.002,.06,.12,.08),"square","lowpass",3e3,1.5,.42,0,.7,3,.1),PAD:ie(.2,[42,66],se(.4,.3,.6,.8),"sine","lowpass",700,1,.35,0,.7,2,.7),PERC:ie(.15,[48,72],se(.001,.04,0,.02),"noise","highpass",4500,.4,.38,0,.6,4,.14),BASS:ie(.1,[28,48],se(.01,.2,.5,.12),"triangle","lowpass",280,1.5,.48,0,.3,2,.3),STRINGS:ie(.08,[48,72],se(.3,.2,.55,.8),"triangle","lowpass",1200,1,.32,3,.7,2,.8)},syncThreshold:.42,encounterR:.1,entainment:.55,eventRate:.6,reverbAmt:.4,delayAmt:.35,delayTime:.2,masterGain:.75,harmonyMode:"free",particleGlow:1.5,trailLen:0,lens:"Events",bgPulse:!1,cinematic:!0,primary:"#00e5ff",secondary:"#040810",accent:"#ff88cc",gateCount:4,attractorCount:1},{id:"idm-lattice",name:"IDM Lattice",intensity:4,description:"Grade quebrando patterns em ritmos impossveis. Autechre digital.",vibe:"Glitch, Grid, Broken",tags:["Experimental","Electronic","Glitch"],bpm:136,scale:"chromatic",root:48,quantaCount:72,motionStyle:"lattice",roles:{PERC:ie(.28,[48,96],se(.001,.03,0,.02),"noise","bandpass",4e3,4,.5,0,.8,5,.08),BASS:ie(.22,[28,52],se(.002,.1,.4,.05),"square","lowpass",350,6,.6,-7,.3,3,.15),LEAD:ie(.22,[52,96],se(.002,.06,.25,.06),"square","bandpass",2e3,5,.48,12,.6,3,.1),ARP:ie(.15,[60,96],se(.001,.04,.08,.04),"square","highpass",2500,3,.4,0,.7,3,.06),PAD:ie(.13,[42,60],se(.1,.15,.35,.3),"sawtooth","lowpass",600,2,.32,0,.5,2,.5)},syncThreshold:.55,encounterR:.08,entainment:.7,eventRate:.9,reverbAmt:.15,delayAmt:.2,delayTime:.09,masterGain:.78,harmonyMode:"free",particleGlow:1,trailLen:0,lens:"Rhythm",bgPulse:!1,cinematic:!1,primary:"#00e5ff",secondary:"#000a0c",accent:"#ff00ff",gateCount:6,attractorCount:2},{id:"ambient-house",name:"Ambient House",intensity:3,description:"4/4 suave em neblina. Warmth de pads com groove gentil.",vibe:"Warm, Hazy, Sunday",tags:["Ambient","Club","Electronic","Soft"],bpm:118,scale:"major",root:48,quantaCount:80,motionStyle:"drift",roles:{KICK:ie(.15,[24,36],se(.001,.12,0,.08),"kick","lowpass",160,.4,.72,0,.2,3,.5),BASS:ie(.18,[36,52],se(.01,.2,.55,.15),"sine","lowpass",250,1,.52,0,.3,3,.35),PAD:ie(.28,[48,72],se(.6,.3,.78,1.5),"sawtooth","lowpass",800,2,.45,5,.8,3,.9),LEAD:ie(.18,[60,84],se(.01,.1,.4,.18),"triangle","lowpass",2e3,1.5,.42,0,.5,2,.3),ARP:ie(.12,[60,88],se(.003,.08,.15,.12),"triangle","lowpass",2800,1,.38,0,.6,2,.2),PERC:ie(.09,[60,72],se(.001,.04,0,.03),"hihat","highpass",5e3,.4,.35,0,.6,3,.22)},syncThreshold:.4,encounterR:.11,entainment:.45,eventRate:.55,reverbAmt:.55,delayAmt:.45,delayTime:.28,masterGain:.78,harmonyMode:"consonant",particleGlow:1.5,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#88ccff",secondary:"#060810",accent:"#ffcc88",gateCount:4,attractorCount:1},{id:"trance-gates",name:"Trance Gates",intensity:5,description:"Flock murmuration cruzando portais. Arpejos hipnticos em cascata.",vibe:"Euphoria, Cascade, Energy",tags:["Electronic","Club","Rave"],bpm:140,scale:"minor",root:45,quantaCount:120,motionStyle:"murmuration",roles:{KICK:ie(.18,[24,36],se(.001,.07,0,.05),"kick","lowpass",200,.5,.88,0,.2,5,.35),BASS:ie(.16,[36,52],se(.005,.15,.55,.08),"sawtooth","lowpass",300,2,.68,-5,.3,3,.25),ARP:ie(.28,[60,96],se(.003,.08,.12,.1),"sawtooth","lowpass",2800,3,.55,7,.7,4,.08),LEAD:ie(.18,[55,84],se(.01,.1,.45,.15),"sawtooth","lowpass",2200,3,.52,5,.5,3,.18),PAD:ie(.12,[48,66],se(.3,.2,.65,.8),"sawtooth","lowpass",600,2,.38,0,.7,2,.8),PERC:ie(.08,[60,84],se(.001,.04,0,.02),"hihat","highpass",6e3,.4,.4,0,.7,4,.14)},syncThreshold:.55,encounterR:.1,entainment:.7,eventRate:.9,reverbAmt:.3,delayAmt:.35,delayTime:.15,masterGain:.85,harmonyMode:"modal",particleGlow:1.6,trailLen:0,lens:"Rhythm",bgPulse:!0,cinematic:!0,primary:"#cc44ff",secondary:"#0a0210",accent:"#44ffcc",gateCount:6,attractorCount:2},{id:"lofi-rain",name:"Lo-fi Rain",intensity:2,description:"Tudo filtrado como vinil. Chuva orgnica. Warmth nostlgica.",vibe:"Warm, Vintage, Rain",tags:["Ambient","Soft","Electronic","Groove"],bpm:75,scale:"pentatonic",root:48,quantaCount:56,motionStyle:"organism",roles:{KICK:ie(.12,[24,36],se(.001,.12,0,.08),"kick","lowpass",120,.3,.65,0,.2,2,.55),BASS:ie(.18,[36,52],se(.015,.25,.55,.2),"sine","lowpass",200,1,.48,0,.3,2,.4),PAD:ie(.28,[48,66],se(.8,.4,.75,1.5),"sine","lowpass",550,1,.38,0,.8,2,1.2),LEAD:ie(.2,[55,76],se(.01,.12,.38,.2),"triangle","lowpass",1200,1,.42,0,.4,2,.35),PERC:ie(.12,[48,72],se(.001,.06,0,.04),"noise","lowpass",2e3,.3,.32,0,.5,3,.25),ARP:ie(.1,[60,84],se(.005,.1,.15,.12),"triangle","lowpass",1800,1,.35,0,.5,2,.3)},syncThreshold:.32,encounterR:.14,entainment:.35,eventRate:.4,reverbAmt:.6,delayAmt:.45,delayTime:.3,masterGain:.7,harmonyMode:"consonant",particleGlow:1.2,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#ccaa88",secondary:"#0a0804",accent:"#88aacc",gateCount:3,attractorCount:1},{id:"film-noir",name:"Film Noir",intensity:2,description:"Suspense lento em flow. Sombras harmnicas, tenso cromtica.",vibe:"Suspense, Shadow, Mystery",tags:["Ambient","Dark","Experimental"],bpm:58,scale:"harmonic_minor",root:36,quantaCount:56,motionStyle:"flow",roles:{PAD:ie(.3,[36,60],se(1,.5,.75,2),"sawtooth","lowpass",500,2,.42,5,.8,3,1.2),STRINGS:ie(.25,[42,72],se(.5,.3,.65,1.2),"triangle","lowpass",1100,1,.38,3,.7,2,.8),BASS:ie(.18,[24,42],se(.1,.3,.65,1),"sine","lowpass",180,1,.5,0,.3,2,.6),LEAD:ie(.15,[52,80],se(.02,.12,.4,.2),"triangle","lowpass",1600,1.5,.42,0,.5,2,.35),CHOIR:ie(.12,[48,66],se(1.2,.5,.72,2.5),"sine","lowpass",550,.9,.3,0,.9,2,2)},syncThreshold:.28,encounterR:.15,entainment:.25,eventRate:.25,reverbAmt:.72,delayAmt:.5,delayTime:.45,masterGain:.65,harmonyMode:"dissonant",particleGlow:1.8,trailLen:0,lens:"Tension",bgPulse:!1,cinematic:!0,primary:"#8888aa",secondary:"#040408",accent:"#ff6644",gateCount:2,attractorCount:1},{id:"epic-crescendo",name:"Epic Crescendo",intensity:5,description:"Migrao pica para o clmax. Orquestra completa em movimento.",vibe:"Epic, Climax, Power",tags:["Orchestral","Dynamic","Cinematic"],bpm:96,scale:"major",root:48,quantaCount:128,motionStyle:"exodus",roles:{KICK:ie(.1,[24,36],se(.001,.08,0,.05),"kick","lowpass",200,.5,.82,0,.2,4,.4),BASS:ie(.12,[28,48],se(.01,.2,.55,.15),"triangle","lowpass",300,1.5,.55,0,.3,3,.3),PERC:ie(.1,[48,72],se(.001,.06,0,.04),"snare","bandpass",3e3,.5,.45,0,.7,4,.2),STRINGS:ie(.22,[42,76],se(.15,.15,.65,1.2),"sawtooth","lowpass",1400,1.5,.48,5,.8,3,.5),LEAD:ie(.15,[55,88],se(.01,.1,.48,.15),"sawtooth","lowpass",2200,2,.5,3,.5,3,.2),PAD:ie(.12,[42,66],se(.5,.3,.72,1.5),"sine","lowpass",800,1,.38,0,.8,2,.9),CHOIR:ie(.12,[48,72],se(.8,.4,.75,2),"sine","lowpass",700,1,.35,0,.9,2,1.2),ARP:ie(.07,[60,90],se(.003,.08,.15,.1),"triangle","lowpass",2800,1,.38,0,.6,2,.14)},syncThreshold:.48,encounterR:.11,entainment:.55,eventRate:.7,reverbAmt:.55,delayAmt:.4,delayTime:.25,masterGain:.82,harmonyMode:"consonant",particleGlow:1.8,trailLen:0,lens:"Events",bgPulse:!0,cinematic:!0,primary:"#ffd700",secondary:"#0a0800",accent:"#ff4400",gateCount:6,attractorCount:1},{id:"horror-cells",name:"Horror Cells",intensity:4,description:"Clusters orgnicos pulsando. Dissonncia cromtica. Tenso visceral.",vibe:"Terror, Visceral, Organism",tags:["Experimental","Dark","Cinematic"],bpm:66,scale:"chromatic",root:36,quantaCount:72,motionStyle:"cells",roles:{PAD:ie(.3,[30,60],se(.8,.4,.7,2),"sawtooth","lowpass",400,3,.45,7,.8,3,1),STRINGS:ie(.25,[36,72],se(.1,.2,.5,.8),"sawtooth","bandpass",1200,4,.42,12,.7,3,.5),BASS:ie(.18,[24,42],se(.1,.3,.65,1.5),"sine","lowpass",150,1,.55,0,.3,2,.6),PERC:ie(.15,[36,72],se(.001,.08,0,.05),"noise","bandpass",2e3,.5,.38,0,.6,4,.2),CHOIR:ie(.12,[42,60],se(1.5,.6,.7,3),"sine","lowpass",450,1,.3,0,.9,2,2.5)},syncThreshold:.35,encounterR:.14,entainment:.35,eventRate:.4,reverbAmt:.7,delayAmt:.55,delayTime:.5,masterGain:.68,harmonyMode:"dissonant",particleGlow:2.2,trailLen:0,lens:"Tension",bgPulse:!1,cinematic:!0,primary:"#ff3333",secondary:"#080004",accent:"#880066",gateCount:3,attractorCount:1},{id:"quantum-tunneling",name:"Quantum Tunneling",intensity:4,description:"Partculas rpidas atravessando portais de gate. Cascatas qunticas.",vibe:"Portal, Speed, Quantum",tags:["Experimental","Electronic","Generative"],bpm:128,scale:"whole_tone",root:48,quantaCount:96,motionStyle:"swarm",roles:{LEAD:ie(.25,[52,96],se(.002,.06,.25,.06),"triangle","lowpass",3e3,2,.48,5,.6,3,.1),ARP:ie(.25,[60,96],se(.001,.04,.1,.05),"triangle","highpass",2500,1.5,.42,12,.7,4,.06),PERC:ie(.2,[48,84],se(.001,.03,0,.02),"noise","bandpass",4e3,.5,.4,0,.7,5,.08),BASS:ie(.15,[36,52],se(.003,.12,.45,.08),"square","lowpass",350,3,.55,-5,.3,3,.18),PAD:ie(.15,[42,66],se(.2,.15,.45,.3),"sine","lowpass",700,1,.32,0,.6,2,.5)},syncThreshold:.55,encounterR:.08,entainment:.7,eventRate:.95,reverbAmt:.25,delayAmt:.3,delayTime:.12,masterGain:.8,harmonyMode:"free",particleGlow:1.2,trailLen:0,lens:"Notes",bgPulse:!0,cinematic:!1,primary:"#00e5ff",secondary:"#000a0c",accent:"#ff88cc",gateCount:8,attractorCount:2},{id:"ambient-cosmos",name:"Ambient Cosmos",intensity:1,description:"38bpm mega-ambient  9 camadas harmnicas, whole_tone, reverb infinito.",vibe:"Infinite, Vast, Breathing",tags:["Ambient","Space","Drone","Meditative"],bpm:38,scale:"whole_tone",root:48,quantaCount:64,motionStyle:"meditation",roles:{PAD:ie(.25,[36,60],se(3,1,.88,5),"sine","lowpass",500,.7,.38,0,.9,3,3.5),CHOIR:ie(.2,[48,72],se(2.5,.8,.82,4),"sine","lowpass",600,.9,.32,0,1,2,3),STRINGS:ie(.2,[42,72],se(1.5,.6,.72,3),"triangle","lowpass",900,1,.35,5,.8,2,2.5),LEAD:ie(.15,[55,84],se(.3,.2,.5,.8),"triangle","lowpass",1400,1,.28,0,.5,2,.8),BASS:ie(.1,[24,42],se(.8,.5,.8,3),"sine","lowpass",150,.6,.45,0,.2,2,2),ARP:ie(.1,[60,96],se(.1,.15,.2,.5),"triangle","highpass",2200,1.2,.22,12,.7,2,1)},syncThreshold:.2,encounterR:.22,entainment:.15,eventRate:.1,reverbAmt:.98,delayAmt:.75,delayTime:.85,masterGain:.55,harmonyMode:"consonant",particleGlow:3,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#8888ff",secondary:"#020208",accent:"#ffddaa",gateCount:1,attractorCount:0},{id:"polyrhythm",name:"Polyrhythm Engine",intensity:4,description:"3 vrtices em velocidades diferentes. Polirritmia emergente 3:4:5.",vibe:"Complex, Layered, Polyrhythm",tags:["Groove","Experimental","Dynamic","Generative"],bpm:110,scale:"dorian",root:45,quantaCount:96,motionStyle:"carnival",roles:{KICK:ie(.15,[24,36],se(.001,.07,0,.05),"kick","lowpass",200,.5,.82,0,.2,4,.38),PERC:ie(.25,[48,84],se(.001,.04,0,.02),"snare","bandpass",3e3,.6,.48,0,.8,5,.12),BASS:ie(.18,[28,52],se(.008,.15,.52,.1),"triangle","lowpass",300,2,.58,0,.3,3,.2),LEAD:ie(.18,[55,84],se(.005,.08,.38,.12),"triangle","lowpass",2e3,1.5,.45,0,.5,3,.16),ARP:ie(.14,[60,96],se(.002,.06,.12,.08),"square","lowpass",2600,2,.4,0,.6,3,.1),PAD:ie(.1,[42,60],se(.3,.2,.55,.6),"sine","lowpass",600,1,.32,0,.6,2,.7)},syncThreshold:.48,encounterR:.1,entainment:.65,eventRate:.75,reverbAmt:.25,delayAmt:.3,delayTime:.18,masterGain:.8,harmonyMode:"modal",particleGlow:1.3,trailLen:0,lens:"Rhythm",bgPulse:!0,cinematic:!1,primary:"#ffcc00",secondary:"#0a0800",accent:"#ff3366",gateCount:5,attractorCount:3},{id:"all-voices",name:"All 8 Voices",intensity:3,description:"Todas as 8 roles em equilbrio. A paleta completa do Music Lab.",vibe:"Complete, Balanced, Showcase",tags:["Generative","Orchestral","Groove"],bpm:96,scale:"major",root:48,quantaCount:112,motionStyle:"murmuration",roles:{KICK:ie(.12,[24,36],se(.001,.08,0,.05),"kick","lowpass",180,.4,.78,0,.2,3,.45),BASS:ie(.12,[28,52],se(.01,.2,.55,.15),"sine","lowpass",260,1,.52,0,.3,3,.32),PERC:ie(.12,[48,84],se(.001,.05,0,.03),"hihat","highpass",5e3,.5,.42,0,.7,4,.16),PAD:ie(.14,[48,72],se(.5,.3,.72,1.2),"sine","lowpass",800,1,.38,0,.8,3,.9),LEAD:ie(.14,[55,84],se(.008,.1,.42,.15),"triangle","lowpass",2e3,1.5,.45,0,.5,3,.22),ARP:ie(.12,[60,96],se(.003,.08,.15,.1),"triangle","lowpass",2800,1,.4,0,.6,3,.14),STRINGS:ie(.12,[48,76],se(.35,.2,.62,1),"triangle","lowpass",1400,1,.36,3,.8,2,.7),CHOIR:ie(.12,[48,72],se(1,.5,.72,2),"sine","lowpass",650,1,.3,0,.9,2,1.5)},syncThreshold:.4,encounterR:.11,entainment:.5,eventRate:.55,reverbAmt:.45,delayAmt:.35,delayTime:.22,masterGain:.78,harmonyMode:"consonant",particleGlow:1.3,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#88aaff",secondary:"#060810",accent:"#ffcc88",gateCount:4,attractorCount:1},{id:"solo-particle",name:"Solo Particle",intensity:1,description:"Uma nica partcula. Cada gate crossing  uma performance solo.",vibe:"Solitude, Focus, Pure",tags:["Minimalist","Experimental","Soft"],bpm:64,scale:"pentatonic",root:60,quantaCount:1,motionStyle:"drift",roles:{LEAD:ie(1,[48,84],se(.01,.12,.45,.3),"triangle","lowpass",2e3,1.5,.55,0,.5,2,.3)},syncThreshold:.2,encounterR:.2,entainment:.1,eventRate:.3,reverbAmt:.8,delayAmt:.6,delayTime:.5,masterGain:.7,harmonyMode:"consonant",particleGlow:3,trailLen:0,lens:"Notes",bgPulse:!1,cinematic:!0,primary:"#ffffff",secondary:"#020204",accent:"#88aaff",gateCount:3,attractorCount:0},{id:"max-density",name:"Maximum Density",intensity:5,description:"256 partculas em swarm. Textura pura. Som como fenmeno coletivo.",vibe:"Mass, Texture, Swarm",tags:["Experimental","Drone","Electronic"],bpm:120,scale:"chromatic",root:36,quantaCount:256,motionStyle:"swarm",roles:{PERC:ie(.25,[36,96],se(.001,.03,0,.02),"noise","bandpass",3e3,2,.4,0,.8,6,.06),LEAD:ie(.25,[48,96],se(.001,.04,.1,.04),"square","lowpass",2500,4,.35,0,.6,4,.08),ARP:ie(.2,[60,96],se(.001,.03,.05,.03),"triangle","highpass",3500,2,.3,0,.7,4,.05),BASS:ie(.15,[24,48],se(.002,.1,.35,.05),"sawtooth","lowpass",250,3,.5,-7,.3,3,.12),PAD:ie(.15,[36,60],se(.1,.1,.3,.2),"sawtooth","lowpass",500,2,.28,5,.5,2,.3)},syncThreshold:.65,encounterR:.06,entainment:.8,eventRate:1.2,reverbAmt:.15,delayAmt:.1,delayTime:.08,masterGain:.7,harmonyMode:"free",particleGlow:.8,trailLen:0,lens:"Events",bgPulse:!0,cinematic:!0,primary:"#ff0055",secondary:"#0a0004",accent:"#00ff88",gateCount:8,attractorCount:3},{id:"gravity-falls",name:"Gravity Falls",intensity:3,description:"Gravidade forte. Partculas ricocheteiam em gates como xilofone.",vibe:"Bounce, Playful, Percussive",tags:["Experimental","Generative","Dynamic"],bpm:90,scale:"major",root:60,quantaCount:48,motionStyle:"ballistic",roles:{LEAD:ie(.35,[60,96],se(.002,.12,.15,.2),"triangle","bandpass",3e3,2,.5,0,.6,3,.16),PERC:ie(.25,[48,84],se(.001,.05,0,.03),"noise","bandpass",2500,.5,.45,0,.7,4,.14),BASS:ie(.2,[36,52],se(.01,.2,.5,.15),"triangle","lowpass",350,1.5,.52,0,.3,3,.3),ARP:ie(.2,[60,88],se(.002,.08,.12,.1),"triangle","lowpass",2800,1,.42,0,.5,3,.12)},syncThreshold:.42,encounterR:.1,entainment:.5,eventRate:.6,reverbAmt:.45,delayAmt:.35,delayTime:.22,masterGain:.75,harmonyMode:"consonant",particleGlow:1.2,trailLen:0,lens:"Notes",bgPulse:!1,cinematic:!1,primary:"#44aaff",secondary:"#040810",accent:"#ffcc44",gateCount:6,attractorCount:0},{id:"noise-meditation",name:"Noise Meditation",intensity:2,description:"Texturas de rudo como meditao. Anti-msica zen. Escuta profunda.",vibe:"Noise, Zen, Deep Listening",tags:["Experimental","Drone","Meditative"],bpm:40,scale:"chromatic",root:36,quantaCount:48,motionStyle:"meditation",roles:{PAD:ie(.4,[24,60],se(2,.8,.82,4),"sawtooth","lowpass",300,2,.4,5,.8,3,2.5),PERC:ie(.3,[36,84],se(.5,.3,.1,1),"noise","bandpass",1500,1,.35,0,.6,3,1),BASS:ie(.15,[24,36],se(1,.5,.8,3),"sine","lowpass",120,.6,.48,0,.2,2,2),STRINGS:ie(.15,[42,72],se(.8,.4,.55,1.5),"sawtooth","bandpass",800,3,.3,12,.7,2,1.5)},syncThreshold:.22,encounterR:.2,entainment:.15,eventRate:.15,reverbAmt:.92,delayAmt:.7,delayTime:.8,masterGain:.55,harmonyMode:"free",particleGlow:2.5,trailLen:0,lens:"Tension",bgPulse:!1,cinematic:!0,primary:"#aaaaaa",secondary:"#040404",accent:"#ff4400",gateCount:1,attractorCount:0},{id:"dance-atoms",name:"Dance of Atoms",intensity:3,description:"Cada par de partculas  um dueto. Valsa atmica em minor harmnica.",vibe:"Waltz, Pairs, Intimate",tags:["Generative","Classical","Experimental"],bpm:88,scale:"harmonic_minor",root:48,quantaCount:64,motionStyle:"dance",roles:{STRINGS:ie(.3,[48,76],se(.1,.12,.55,1),"triangle","lowpass",1400,1.5,.45,3,.7,3,.25),LEAD:ie(.22,[55,84],se(.008,.1,.42,.15),"triangle","lowpass",2e3,1.5,.45,0,.5,3,.2),PAD:ie(.2,[42,66],se(.5,.3,.7,1.2),"sine","lowpass",700,1,.38,0,.8,2,.9),BASS:ie(.15,[28,48],se(.015,.2,.55,.15),"sine","lowpass",250,1,.5,0,.3,2,.35),CHOIR:ie(.13,[48,72],se(.8,.4,.7,1.5),"sine","lowpass",600,1,.3,0,.9,2,1.2)},syncThreshold:.38,encounterR:.13,entainment:.42,eventRate:.5,reverbAmt:.55,delayAmt:.4,delayTime:.3,masterGain:.72,harmonyMode:"consonant",particleGlow:1.6,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#ff88cc",secondary:"#080408",accent:"#88ccff",gateCount:3,attractorCount:1},{id:"storm-chaser",name:"Storm Chaser",intensity:5,description:"Tempestade musical. Caos browniano + exploses cclicas. Trovo.",vibe:"Storm, Thunder, Power",tags:["Experimental","Dynamic","Electronic","Dark"],bpm:144,scale:"minor",root:36,quantaCount:128,motionStyle:"explosion",roles:{KICK:ie(.18,[24,36],se(.001,.06,0,.03),"kick","lowpass",240,.5,.92,0,.2,6,.28),PERC:ie(.25,[36,84],se(.001,.04,0,.02),"snare","bandpass",3500,.8,.55,0,.8,6,.1),BASS:ie(.18,[28,48],se(.003,.12,.5,.06),"sawtooth","lowpass",320,4,.7,-5,.3,4,.15),LEAD:ie(.18,[48,88],se(.002,.06,.3,.06),"sawtooth","lowpass",2200,3,.52,7,.5,3,.12),ARP:ie(.12,[60,96],se(.001,.04,.08,.04),"square","highpass",2800,2,.4,0,.7,4,.06),PAD:ie(.09,[36,60],se(.15,.15,.4,.3),"sawtooth","lowpass",500,2,.3,0,.5,2,.4)},syncThreshold:.6,encounterR:.08,entainment:.8,eventRate:1.1,reverbAmt:.2,delayAmt:.15,delayTime:.1,masterGain:.85,harmonyMode:"dissonant",particleGlow:1.5,trailLen:0,lens:"Events",bgPulse:!0,cinematic:!0,primary:"#ff4400",secondary:"#0a0200",accent:"#00ccff",gateCount:7,attractorCount:2},{id:"silk-road",name:"Silk Road",intensity:3,description:"Viagem pela Rota da Seda. 8 vozes migrando em harmonic minor.",vibe:"Journey, Caravan, Horizon",tags:["Modal","Orchestral","Dynamic","Ambient"],bpm:86,scale:"harmonic_minor",root:40,quantaCount:96,motionStyle:"migration",roles:{KICK:ie(.08,[24,36],se(.001,.1,0,.06),"kick","lowpass",160,.3,.68,0,.2,2,.5),BASS:ie(.12,[28,48],se(.02,.25,.6,.2),"sine","lowpass",220,1,.5,0,.3,2,.4),PERC:ie(.12,[48,72],se(.001,.06,0,.04),"noise","bandpass",2500,.4,.38,0,.6,4,.2),PAD:ie(.18,[36,60],se(.8,.4,.72,1.5),"sine","lowpass",600,1,.38,0,.8,3,1),STRINGS:ie(.18,[42,72],se(.2,.15,.58,1),"triangle","lowpass",1400,1.5,.42,5,.8,3,.5),LEAD:ie(.14,[52,84],se(.01,.1,.42,.15),"triangle","bandpass",1800,2,.45,0,.5,3,.22),CHOIR:ie(.1,[48,72],se(1,.5,.72,2),"sine","lowpass",600,1,.3,0,.9,2,1.5),ARP:ie(.08,[60,88],se(.005,.08,.15,.12),"triangle","lowpass",2400,1,.35,0,.6,2,.18)},syncThreshold:.38,encounterR:.12,entainment:.42,eventRate:.5,reverbAmt:.55,delayAmt:.45,delayTime:.32,masterGain:.72,harmonyMode:"modal",particleGlow:1.5,trailLen:0,lens:"Harmony",bgPulse:!1,cinematic:!0,primary:"#cc8844",secondary:"#0a0604",accent:"#88ccff",gateCount:4,attractorCount:0},{id:"cells-life",name:"Cells of Life",intensity:3,description:"Simulao de vida como msica. Clulas respiram, dividem, cantam.",vibe:"Life, Breath, Organic",tags:["Generative","Experimental","Organic Instruments"],bpm:80,scale:"lydian",root:48,quantaCount:104,motionStyle:"cells",roles:{KICK:ie(.08,[24,36],se(.001,.1,0,.06),"kick","lowpass",160,.3,.65,0,.2,2,.55),BASS:ie(.12,[28,48],se(.02,.25,.58,.18),"sine","lowpass",220,1,.48,0,.3,2,.38),PAD:ie(.22,[42,66],se(.8,.4,.75,1.5),"sine","lowpass",700,1,.38,0,.8,3,1),LEAD:ie(.18,[55,84],se(.008,.1,.4,.15),"triangle","lowpass",2e3,1.5,.42,0,.5,3,.22),STRINGS:ie(.15,[48,76],se(.3,.2,.58,.8),"triangle","lowpass",1200,1,.35,3,.7,2,.7),CHOIR:ie(.13,[48,72],se(1,.5,.72,2),"sine","lowpass",600,1,.3,0,.9,2,1.5),ARP:ie(.07,[60,88],se(.003,.08,.15,.1),"triangle","lowpass",2600,1,.35,0,.6,2,.14),PERC:ie(.05,[48,72],se(.001,.05,0,.03),"noise","highpass",4500,.4,.32,0,.5,3,.2)},syncThreshold:.38,encounterR:.13,entainment:.42,eventRate:.48,reverbAmt:.5,delayAmt:.38,delayTime:.28,masterGain:.75,harmonyMode:"consonant",particleGlow:1.6,trailLen:0,lens:"Events",bgPulse:!1,cinematic:!0,primary:"#44ffcc",secondary:"#040a08",accent:"#ff88aa",gateCount:3,attractorCount:1},{id:"revolution-waltz",name:"Revolution Waltz",intensity:4,description:"Espiral valsa. Tenso cresce at colapsar em resoluo harmnica.",vibe:"Waltz, Spiral, Climax",tags:["Classical","Dynamic","Experimental"],bpm:102,scale:"minor",root:45,quantaCount:80,motionStyle:"revolution",roles:{STRINGS:ie(.28,[42,76],se(.1,.12,.58,1),"sawtooth","lowpass",1400,1.5,.48,5,.8,3,.4),LEAD:ie(.22,[55,88],se(.008,.08,.42,.12),"triangle","lowpass",2200,2,.48,0,.5,3,.18),PAD:ie(.18,[42,60],se(.5,.3,.68,1.2),"sine","lowpass",700,1,.38,0,.7,2,.8),BASS:ie(.15,[28,48],se(.01,.2,.55,.15),"sine","lowpass",280,1,.52,0,.3,2,.3),PERC:ie(.1,[48,72],se(.001,.05,0,.03),"snare","bandpass",2800,.5,.42,0,.6,4,.18),CHOIR:ie(.07,[48,66],se(.8,.4,.68,1.5),"sine","lowpass",550,.9,.28,0,.8,2,1.2)},syncThreshold:.48,encounterR:.11,entainment:.58,eventRate:.68,reverbAmt:.42,delayAmt:.35,delayTime:.22,masterGain:.78,harmonyMode:"modal",particleGlow:1.5,trailLen:0,lens:"Tension",bgPulse:!1,cinematic:!0,primary:"#cc44ff",secondary:"#0a0210",accent:"#ffd700",gateCount:4,attractorCount:1},{id:"blank-canvas",name:"The Blank Canvas",intensity:0,description:"Tela em branco. 0 partculas, 0 gates. Construa tudo do zero.",vibe:"Empty, Your Creation, Freedom",tags:["Experimental","Minimalist","Generative"],bpm:90,scale:"major",root:48,quantaCount:0,motionStyle:"drift",roles:{PAD:ie(.25,[48,72],se(.5,.3,.7,1.2),"sine","lowpass",800,1,.38,0,.8,2,.9),LEAD:ie(.25,[55,84],se(.008,.1,.42,.15),"triangle","lowpass",2e3,1.5,.45,0,.5,3,.22),BASS:ie(.25,[28,52],se(.01,.2,.55,.15),"sine","lowpass",250,1,.5,0,.3,2,.35),ARP:ie(.25,[60,96],se(.003,.08,.15,.1),"triangle","lowpass",2800,1,.4,0,.6,3,.14)},syncThreshold:.35,encounterR:.12,entainment:.4,eventRate:.5,reverbAmt:.5,delayAmt:.4,delayTime:.25,masterGain:.75,harmonyMode:"consonant",particleGlow:1.5,trailLen:0,lens:"Notes",bgPulse:!1,cinematic:!1,primary:"#ffffff",secondary:"#080808",accent:"#37b2da",gateCount:0,attractorCount:0}],xV=new Map(Nu.map(e=>[e.id,e]));function Ov(e){return xV.get(e)}const vV=48;function SV(e,t=2){const n=Math.floor(e.sampleRate*t),r=e.createBuffer(1,n,e.sampleRate),a=r.getChannelData(0);for(let i=0;i<n;i++)a[i]=Math.random()*2-1;return r}function wV(e,t=2.8,n=3.2){const r=Math.floor(e.sampleRate*t),a=e.createBuffer(2,r,e.sampleRate);for(let i=0;i<2;i++){const s=a.getChannelData(i);for(let c=0;c<r;c++)s[c]=(Math.random()*2-1)*Math.pow(1-c/r,n)}return a}class MV{constructor(){this.voices=[],this._ready=!1,this.roleEnergy={},this._audioDestNode=null}get ready(){return this._ready}async init(){if(!this._ready){this.ctx=new(window.AudioContext||window.webkitAudioContext),this.ctx.state==="suspended"&&await this.ctx.resume(),this.noiseBuffer=SV(this.ctx),this.masterBus=this.ctx.createGain(),this.masterBus.gain.value=.88,this.compressor=this.ctx.createDynamicsCompressor(),this.compressor.threshold.value=-16,this.compressor.knee.value=6,this.compressor.ratio.value=5,this.compressor.attack.value=.004,this.compressor.release.value=.22,this.convolver=this.ctx.createConvolver(),this.convolver.buffer=wV(this.ctx,2.8,3.2),this.reverbSend=this.ctx.createGain(),this.reverbSend.gain.value=0,this.reverbRet=this.ctx.createGain(),this.reverbRet.gain.value=.85,this.delayNode=this.ctx.createDelay(2),this.delayNode.delayTime.value=.35,this.delayFb=this.ctx.createGain(),this.delayFb.gain.value=.28,this.delaySend=this.ctx.createGain(),this.delaySend.gain.value=0,this.delayRet=this.ctx.createGain(),this.delayRet.gain.value=.65,this.masterBus.connect(this.compressor),this.compressor.connect(this.ctx.destination),this.masterBus.connect(this.reverbSend),this.reverbSend.connect(this.convolver),this.convolver.connect(this.reverbRet),this.reverbRet.connect(this.compressor),this.masterBus.connect(this.delaySend),this.delaySend.connect(this.delayNode),this.delayNode.connect(this.delayFb),this.delayFb.connect(this.delayNode),this.delayNode.connect(this.delayRet),this.delayRet.connect(this.compressor);for(let t=0;t<vV;t++){const n=this.ctx.createGain();n.gain.value=0;const r=this.ctx.createBiquadFilter();r.type="lowpass",r.frequency.value=18e3,r.Q.value=.7;const a=this.ctx.createStereoPanner();r.connect(n),n.connect(a),a.connect(this.masterBus),this.voices.push({id:t,role:"PAD",active:!1,startTime:0,endTime:0,gainNode:n,filter:r,panner:a,oscs:[],noise:null,mixNodes:[]})}this._ready=!0}}createAudioStream(){if(!this._ready)throw new Error("AudioEngine not initialised");return this._audioDestNode||(this._audioDestNode=this.ctx.createMediaStreamDestination(),this.compressor.connect(this._audioDestNode)),this._audioDestNode.stream}acquireVoice(){const t=this.ctx.currentTime;let n=this.voices.find(r=>!r.active||r.endTime<=t);if(n||(n=this.voices.reduce((r,a)=>r.endTime<a.endTime?r:a)),n.oscs.forEach(r=>{try{r.stop(),r.disconnect()}catch{}}),n.oscs=[],n.noise){try{n.noise.stop(),n.noise.disconnect()}catch{}n.noise=null}return n.mixNodes.forEach(r=>{try{r.disconnect()}catch{}}),n.mixNodes=[],n.gainNode.gain.cancelScheduledValues(t),n.gainNode.gain.setValueAtTime(0,t),n.active=!0,n}_applyEnv(t,n,r,a,i){const s=Math.max(.002,a.attack),c=a.sustain<.05?a.decay*.1+.001:a.decay*.28+.001;if(t.cancelScheduledValues(n),s>.06){const l=Math.min(r*.12,.08);t.setValueAtTime(l,n),t.linearRampToValueAtTime(l*.6,n+.025),t.linearRampToValueAtTime(r,n+s)}else t.setValueAtTime(1e-4,n),t.linearRampToValueAtTime(r,n+s);t.setTargetAtTime(r*a.sustain,n+s,c),t.setTargetAtTime(1e-4,n+i,Math.max(.01,a.release)*.38+.001)}fire(t,n){if(!this._ready)return;const r=this.ctx.currentTime,a=this.acquireVoice();a.role=t.role,a.startTime=r,a.panner.pan.setValueAtTime(t.x*.65*n.panSpread,r);const i=.22+t.timbre*.78,s=.5+t.velocity*.5,c=Math.min(18e3,n.filterFreq*i*s),l=t.velocity*n.gainScale,d=lV(t.pitch),u=n.envelope;switch(a.filter.type=n.filterType,a.filter.frequency.setValueAtTime(c,r),a.filter.Q.setValueAtTime(n.filterQ,r),t.role){case"KICK":this._kick(a,r,l);break;case"BASS":this._bassVoice(a,r,d,l,u,n.detune);break;case"PERC":n.waveform==="snare"?this._snare(a,r,l):n.waveform==="hihat"?this._hihat(a,r,l,t.timbre):this._percVoice(a,r,d,l,u,t.timbre);break;case"PAD":this._padVoice(a,r,d,l,u,n.detune);break;case"LEAD":this._leadVoice(a,r,d,l,u,n.detune);break;case"ARP":this._arpVoice(a,r,d,l,u,t.timbre);break;case"STRINGS":this._stringsVoice(a,r,d,l,u,n.detune);break;case"CHOIR":this._choirVoice(a,r,d,l,u);break;default:this._oscVoice(a,r,d,n.waveform||"sine",n.detune,l,u,t.duration);break}this.roleEnergy[t.role]=Math.min(1,(this.roleEnergy[t.role]??0)+l*.5)}_kick(t,n,r){const a=this.ctx.createOscillator();a.type="sine",a.frequency.setValueAtTime(145,n),a.frequency.exponentialRampToValueAtTime(48,n+.09),a.frequency.exponentialRampToValueAtTime(36,n+.38),a.connect(t.filter),a.start(n),a.stop(n+.42);const i=this.ctx.createOscillator();i.type="sine",i.frequency.setValueAtTime(1400,n),i.frequency.exponentialRampToValueAtTime(220,n+.016),i.connect(t.filter),i.start(n),i.stop(n+.028),t.oscs=[a,i],t.filter.type="lowpass",t.filter.frequency.value=260,t.filter.Q.value=.5;const s=t.gainNode.gain;s.cancelScheduledValues(n),s.setValueAtTime(r*1.15,n),s.exponentialRampToValueAtTime(r*.55,n+.022),s.exponentialRampToValueAtTime(r*.1,n+.13),s.exponentialRampToValueAtTime(1e-4,n+.38),t.endTime=n+.42}_snare(t,n,r){const a=this.ctx.createOscillator();a.type="triangle",a.frequency.setValueAtTime(250,n),a.frequency.exponentialRampToValueAtTime(155,n+.055),a.connect(t.filter),a.start(n),a.stop(n+.16),t.oscs.push(a);const i=this.ctx.createBufferSource();i.buffer=this.noiseBuffer,i.loop=!1,i.connect(t.filter),i.start(n),i.stop(n+.2),t.noise=i,t.filter.type="bandpass",t.filter.frequency.value=3800,t.filter.Q.value=.65;const s=t.gainNode.gain;s.cancelScheduledValues(n),s.setValueAtTime(r*.92,n),s.exponentialRampToValueAtTime(r*.38,n+.024),s.exponentialRampToValueAtTime(1e-4,n+.18),t.endTime=n+.2}_hihat(t,n,r,a=0){const i=this.ctx.createBufferSource();i.buffer=this.noiseBuffer,i.loop=!1,i.connect(t.filter),t.filter.type="highpass",t.filter.frequency.value=7800+a*2e3,t.filter.Q.value=.5;const s=.032+a*.28;i.start(n),i.stop(n+s+.05),t.noise=i;const c=t.gainNode.gain;c.cancelScheduledValues(n),c.setValueAtTime(r*.58,n),c.exponentialRampToValueAtTime(1e-4,n+s),t.endTime=n+s+.05}_bassVoice(t,n,r,a,i,s){const c=Math.max(.05,i.attack+i.decay+i.sustain*1.8),l=this.ctx.createOscillator();l.type="sine",l.frequency.value=r*.5,l.detune.value=0;const d=this.ctx.createOscillator();d.type="sawtooth",d.frequency.value=r,d.detune.value=s-7;const u=this.ctx.createOscillator();u.type="sawtooth",u.frequency.value=r,u.detune.value=s+7;const h=this.ctx.createGain();h.gain.value=.7;const m=this.ctx.createGain();m.gain.value=.5;const f=this.ctx.createGain();f.gain.value=.5,t.mixNodes.push(h,m,f),l.connect(h),h.connect(t.filter),d.connect(m),m.connect(t.filter),u.connect(f),f.connect(t.filter),[l,d,u].forEach(g=>{g.start(n),g.stop(n+c+i.release+.08)}),t.oscs=[l,d,u],this._applyEnv(t.gainNode.gain,n,a*.6,i,c),t.endTime=n+c+i.release+.08}_percVoice(t,n,r,a,i,s){const c=Math.max(.04,i.attack+i.decay*1.2),l=this.ctx.createOscillator();l.type=s>.55?"square":"triangle",l.frequency.setValueAtTime(r*1.45,n),l.frequency.exponentialRampToValueAtTime(r,n+.018),l.connect(t.filter),l.start(n),l.stop(n+c+.06),t.oscs.push(l);const d=this.ctx.createBufferSource();d.buffer=this.noiseBuffer,d.loop=!1,d.connect(t.filter),d.start(n),d.stop(n+Math.min(.025,c*.3)),t.noise=d;const u=t.gainNode.gain;u.cancelScheduledValues(n),u.setValueAtTime(a,n),u.exponentialRampToValueAtTime(1e-4,n+c),t.endTime=n+c+.06}_padVoice(t,n,r,a,i,s){const c=Math.max(.1,i.attack+i.decay+i.sustain*2.5),l=[s-14,s,s+14];for(const d of l){const u=this.ctx.createOscillator();u.type="sawtooth",u.frequency.value=r,u.detune.value=d,u.connect(t.filter),u.start(n),u.stop(n+c+i.release+.12),t.oscs.push(u)}this._applyEnv(t.gainNode.gain,n,a*.4,i,c),t.endTime=n+c+i.release+.12}_leadVoice(t,n,r,a,i,s){const c=Math.max(.05,i.attack+i.decay+i.sustain*2),l=n+c+i.release+.08,d=this.ctx.createOscillator(),u=this.ctx.createGain();d.type="sine",d.frequency.value=5.2,u.gain.setValueAtTime(0,n),u.gain.linearRampToValueAtTime(5.5,n+i.attack+.12),d.connect(u),d.start(n),d.stop(l+.05),t.oscs.push(d),t.mixNodes.push(u);const h=this.ctx.createOscillator();h.type="sawtooth",h.frequency.value=r,h.detune.value=s,u.connect(h.detune);const m=this.ctx.createOscillator();m.type="triangle",m.frequency.value=r,m.detune.value=s+4,u.connect(m.detune);const f=this.ctx.createGain();f.gain.value=.7;const g=this.ctx.createGain();g.gain.value=.35,t.mixNodes.push(f,g),h.connect(f),f.connect(t.filter),m.connect(g),g.connect(t.filter),h.start(n),m.start(n),h.stop(l),m.stop(l),t.oscs.push(h,m),this._applyEnv(t.gainNode.gain,n,a*.62,i,c),t.endTime=l}_arpVoice(t,n,r,a,i,s){const c=Math.max(.04,i.attack+i.decay+i.sustain*1.2),l=n+c+i.release+.06,d=[1,2.003,3.009,4.02],u=[1,.45,.22,.1],h=m=>u[m]*(s>.5?1:Math.pow(.5,m*.6));for(let m=0;m<d.length;m++){const f=this.ctx.createOscillator(),g=this.ctx.createGain();f.type=m===0?"triangle":"sine",f.frequency.value=r*d[m],g.gain.value=h(m),t.mixNodes.push(g),f.connect(g),g.connect(t.filter),f.start(n),f.stop(l),t.oscs.push(f)}this._applyEnv(t.gainNode.gain,n,a*.65,i,c),t.endTime=l}_stringsVoice(t,n,r,a,i,s){const c=Math.max(.1,i.attack+i.decay+i.sustain*2.8),l=n+c+i.release+.12,d=this.ctx.createOscillator(),u=this.ctx.createGain();d.type="sine",d.frequency.value=4.5,u.gain.setValueAtTime(0,n),u.gain.linearRampToValueAtTime(3.2,n+i.attack*.6+.08),d.connect(u),d.start(n),d.stop(l+.05),t.oscs.push(d),t.mixNodes.push(u);const h=[s-9,s+9];for(const m of h){const f=this.ctx.createOscillator();f.type="sawtooth",f.frequency.value=r,f.detune.value=m,u.connect(f.detune),f.connect(t.filter),f.start(n),f.stop(l),t.oscs.push(f)}this._applyEnv(t.gainNode.gain,n,a*.52,i,c),t.endTime=l}_choirVoice(t,n,r,a,i){const s=Math.max(.1,i.attack+i.decay+i.sustain*3),c=n+s+i.release+.15,l=700,d=1100,u=[1,2,3,4,5];for(let h=0;h<u.length;h++){const m=u[h],f=r*m,g=Math.abs(f-l),x=Math.abs(f-d),v=Math.exp(-g*g/(l*l*.6))+Math.exp(-x*x/(d*d*.5)),w=(m===1?1:.18)+v*.55,M=this.ctx.createOscillator(),k=this.ctx.createGain();M.type=m<=2?"triangle":"sine",M.frequency.value=f,M.detune.value=(Math.random()-.5)*7,k.gain.value=w,t.mixNodes.push(k),M.connect(k),k.connect(t.filter),M.start(n),M.stop(c),t.oscs.push(M)}this._applyEnv(t.gainNode.gain,n,a*.38,i,s),t.endTime=c}_oscVoice(t,n,r,a,i,s,c,l){const d=this.ctx.createOscillator();d.type=a,d.frequency.setValueAtTime(r,n),d.detune.setValueAtTime(i,n),d.connect(t.filter),d.start(n),d.stop(n+l+c.release+.05),t.oscs.push(d),this._applyEnv(t.gainNode.gain,n,s,c,l),t.endTime=n+l+c.release+.05}getActiveCount(t){var r;const n=((r=this.ctx)==null?void 0:r.currentTime)??0;return t?this.voices.filter(a=>a.active&&a.role===t&&a.endTime>n).length:this.voices.filter(a=>a.active&&a.endTime>n).length}setReverb(t){if(!this._ready)return;const n=this.ctx.currentTime;this.reverbSend.gain.setTargetAtTime(t,n,.1)}setDelay(t,n){if(!this._ready)return;const r=this.ctx.currentTime;this.delaySend.gain.setTargetAtTime(t*.32,r,.1),this.delayNode.delayTime.setTargetAtTime(n,r,.05),this.delayFb.gain.setTargetAtTime(t*.38,r,.1)}setMasterGain(t){this._ready&&this.masterBus.gain.setTargetAtTime(t,this.ctx.currentTime,.05)}cutAll(){if(!this._ready)return;const t=this.ctx.currentTime;for(const n of this.voices){if(n.oscs.forEach(r=>{try{r.stop(t),r.disconnect()}catch{}}),n.oscs=[],n.noise){try{n.noise.stop(t),n.noise.disconnect()}catch{}n.noise=null}n.mixNodes.forEach(r=>{try{r.disconnect()}catch{}}),n.mixNodes=[],n.gainNode.gain.cancelScheduledValues(t),n.gainNode.gain.setValueAtTime(0,t),n.active=!1,n.endTime=0}this.delayFb.gain.cancelScheduledValues(t),this.delayFb.gain.setValueAtTime(0,t),this.delaySend.gain.cancelScheduledValues(t),this.delaySend.gain.setValueAtTime(0,t),this.delayRet.gain.cancelScheduledValues(t),this.delayRet.gain.setValueAtTime(0,t),this.reverbSend.gain.cancelScheduledValues(t),this.reverbSend.gain.setValueAtTime(0,t),this.reverbRet.gain.cancelScheduledValues(t),this.reverbRet.gain.setValueAtTime(0,t),this.masterBus.gain.cancelScheduledValues(t),this.masterBus.gain.setValueAtTime(0,t)}restoreGains(t,n,r,a){if(!this._ready)return;const i=this.ctx.currentTime,s=.04;this.masterBus.gain.setTargetAtTime(a,i,s),this.reverbSend.gain.setTargetAtTime(t,i,s),this.reverbRet.gain.setTargetAtTime(.85,i,s),this.delaySend.gain.setTargetAtTime(n*.32,i,s),this.delayFb.gain.setTargetAtTime(n*.38,i,s),this.delayRet.gain.setTargetAtTime(.65,i,s),this.delayNode.delayTime.setTargetAtTime(r,i,.02)}tickEnergy(t){for(const n in this.roleEnergy){const r=n;this.roleEnergy[r]=Math.max(0,(this.roleEnergy[r]??0)-t*3.5)}}dispose(){this._ready&&(this.voices.forEach(t=>{if(t.oscs.forEach(n=>{try{n.stop()}catch{}}),t.mixNodes.forEach(n=>{try{n.disconnect()}catch{}}),t.noise)try{t.noise.stop()}catch{}}),this.ctx.close().catch(()=>{}),this._ready=!1)}}const Cr=new MV,Pp=[{id:"murmuration",name:"Murmurao",icon:"",color:"#88aaff",description:"Estorninhos em ballet coletivo. Ondas de forma pura.",ref:"Reynolds 1987  Boids: sep + align + coeso",motionStyle:"murmuration",physics:{cohesion:.9,separation:.7,alignment:1.45,zoneRadius:.22,maxSpeed:.42,turbulence:.1,damping:.972,predatorPrey:!1}},{id:"school",name:"Cardume",icon:"",color:"#00ccff",description:"Peixes em zonas: repulso  alinhamento  atrao.",ref:"Couzin et al. 2002  Zone model + preferred speed",motionStyle:"school",physics:{cohesion:1.4,separation:1.85,alignment:1.6,zoneRadius:.2,maxSpeed:.36,turbulence:.04,damping:.975,predatorPrey:!1}},{id:"war",name:"Guerra",icon:"",color:"#ff3333",description:"Dois exrcitos. Pares impares perseguem; pares fogem.",ref:"Schelling 1969  Agent-based conflict models",motionStyle:"war",physics:{cohesion:1.8,separation:2,polarize:.9,alignment:.35,zoneRadius:.26,maxSpeed:.56,turbulence:.28,predatorPrey:!1}},{id:"polarization",name:"Polarizao",icon:"",color:"#ff8800",description:"Similares atraem, diferentes repelem. Dois plos emergem.",ref:"Deffuant-Weisbuch 2000  Opinion dynamics",motionStyle:"polarization",physics:{cohesion:.85,separation:1.2,polarize:.95,zoneRadius:.28,maxSpeed:.26,turbulence:.08,alignment:.4,predatorPrey:!1}},{id:"revolution",name:"Revoluo",icon:"",color:"#cc44ff",description:"Espiral que aperta. Alta carga ejeta para fora periodicamente.",ref:"Lorenz attractor  Centripetal collapse + bifurcao",motionStyle:"revolution",physics:{vortexForce:.18,cohesion:.65,separation:.8,burstRate:.45,maxSpeed:.5,turbulence:.15,alignment:.5,damping:.966}},{id:"explosion",name:"Exploso",icon:"",color:"#ff6600",description:"Burst radial cclico. Expande e reagrupa em ondas.",ref:"Radial particle systems  Firework physics",motionStyle:"explosion",physics:{burstRate:.7,cohesion:1.2,separation:1.05,maxSpeed:.62,turbulence:.22,vortexForce:.05,alignment:.2}},{id:"carnival",name:"Carnaval",icon:"",color:"#ffcc00",description:"Trs vrtices girantes em festa. Alta energia + ritmo.",ref:"Multi-vortex flocking  Rotational attractors",motionStyle:"carnival",physics:{vortexForce:.26,cohesion:1.55,separation:.82,maxSpeed:.68,turbulence:.38,alignment:.55,clusterTarget:8,burstRate:.4}},{id:"jazz",name:"Jazz",icon:"",color:"#ff8844",description:"Pequenos grupos formam, improvisam e dissolvem. Microclusters.",ref:"Pressing 1988  Improvisation: Methods and Models",motionStyle:"jazz",physics:{cohesion:2.1,separation:1.55,clusterTarget:4,maxSpeed:.32,turbulence:.48,mutationRate:.28,alignment:.65,zoneRadius:.16}},{id:"organism",name:"Organismo",icon:"",color:"#44ff88",description:"Massa celular respirando. Presso interna + pulso de vida.",ref:"Gray-Scott reaction-diffusion  Cellular automata pulse",motionStyle:"organism",physics:{cohesion:2.55,separation:2.25,clusterTarget:7,burstRate:.5,maxSpeed:.2,turbulence:.1,zoneRadius:.16,alignment:.8}},{id:"exodus",name:"xodo",icon:"",color:"#88ff44",description:"Migrao em massa. Todos fugindo em formao coordenada.",ref:"Evacuation models  Helbing 2000  Panic dynamics",motionStyle:"exodus",physics:{migrationX:0,migrationY:-1,alignment:1.25,cohesion:.55,separation:.82,maxSpeed:.52,turbulence:.12,zoneRadius:.2}},{id:"dance",name:"Dana",icon:"",color:"#ff88cc",description:"Cada quanta orbita o seu par mais prximo. Waltz quntico.",ref:"Two-body problem  Paired orbital mechanics",motionStyle:"dance",physics:{cohesion:2.2,separation:1.45,clusterTarget:2,vortexForce:.14,maxSpeed:.36,turbulence:.08,zoneRadius:.15,alignment:.35}},{id:"chaos",name:"Caos",icon:"",color:"#ff0055",description:"Entropia mxima. Movimento browniano com jolts aleatrios.",ref:"Langevin dynamics  Boltzmann chaos  Maximum entropy",motionStyle:"chaos",physics:{turbulence:.95,damping:.94,burstRate:.82,cohesion:.08,separation:.15,maxSpeed:.68,alignment:0,polarize:0}},{id:"meditation",name:"Meditao",icon:"",color:"#aaccff",description:"Deriva ultralenta. Arcos harmnicos. Tempo quase parado.",ref:"Hamiltonian slow manifold  Drift-diffusion at 0",motionStyle:"meditation",physics:{cohesion:.4,separation:.52,maxSpeed:.07,turbulence:.04,damping:.988,alignment:.32,zoneRadius:.38,vortexForce:.025}},{id:"migration",name:"Migrao",icon:"",color:"#ffee88",description:"Formao migratria. Todos em direo, alinhados por vento.",ref:"Aves migration theory  Aerodynamic drafting models",motionStyle:"migration",physics:{migrationX:0,migrationY:1,alignment:1.8,cohesion:.62,separation:.92,maxSpeed:.44,turbulence:.08,zoneRadius:.2}},{id:"predation",name:"Predao",icon:"",color:"#ff4422",description:"Predadores e presas por role. Perseguio emergente.",ref:"Lotka-Volterra  Role Matrix agent pursuit/flight",motionStyle:"predation",physics:{predatorPrey:!0,polarize:.72,cohesion:1.05,separation:1.42,maxSpeed:.52,turbulence:.18,alignment:.55,zoneRadius:.24}},{id:"cells",name:"Clulas",icon:"",color:"#44ffcc",description:"Grupos celulares respirando. Presso  expanso  contrao.",ref:"CPM Cellular Potts Model  Glazier-Graner 1993",motionStyle:"cells",physics:{cohesion:3,separation:2.82,clusterTarget:5,burstRate:.42,maxSpeed:.16,turbulence:.12,zoneRadius:.12,alignment:.98}}],Db=Object.fromEntries(Pp.map(e=>[e.id,e]));function Lb(e,t){return{...t,...e.physics,motionStyle:e.motionStyle}}const Dv={canvas:{bgStyle:"radial",grain:.55,vignette:.45},quanta:{shape:"circle",baseSize:1,glow:.65,outline:.15},trails:{enabled:!1,style:"line",persistence:.55,width:1,blur:.15,blend:"screen"},connections:{enabled:!0,width:.8,alpha:.35,blend:"screen"},tools:{intensity:.85,labels:!0},post:{bloom:.25,chroma:0},overlays:{showAnnotations:!0,showHitFlashes:!0},threeD:{fog:.55,exposure:1.3,emissive:.65,overlays:!0}},Qg=e=>e,Zg=e=>e,e6=[{id:"meta-lite",name:"Meta-Lite",description:"Camadas suaves, glow controlado, vibe Meta-Arte sem pesar.",palette:Qg({mode:"plasma",bgColor:"#04060a",accent:"#ff0084"}),aesthetic:Zg({canvas:{bgStyle:"radial",grain:.75,vignette:.55},trails:{enabled:!1,persistence:.72,blur:.25,blend:"screen"},post:{bloom:.35},connections:{alpha:.42,width:.85,blend:"screen"},quanta:{glow:.75,outline:.1}})},{id:"neon-noir",name:"Neon Noir",description:"Alto contraste, neon limpo, barras e campos com presena.",palette:Qg({mode:"neon",bgColor:"#020208",accent:"#00d4ff"}),aesthetic:Zg({canvas:{bgStyle:"solid",grain:.35,vignette:.65},trails:{enabled:!1,persistence:.52,width:1.1,blur:.08,blend:"lighter"},post:{bloom:.18},connections:{alpha:.3,blend:"lighter"},quanta:{glow:.9,outline:.22},tools:{intensity:1.05},threeD:{fog:.6,exposure:1.45,emissive:.8,overlays:!0}})},{id:"ink-paper",name:"Ink / Paper",description:"Trao orgnico, fundo claro, esttica editorial.",palette:Qg({mode:"mono",bgColor:"#f6f3ea",accent:"#111111"}),aesthetic:Zg({canvas:{bgStyle:"solid",grain:.22,vignette:.12},trails:{enabled:!1,persistence:.82,width:.9,blur:0,blend:"multiply"},connections:{alpha:.18,blend:"multiply",width:.7},quanta:{shape:"diamond",glow:.05,outline:.55},tools:{intensity:.55,labels:!1},post:{bloom:0},overlays:{showAnnotations:!1,showHitFlashes:!1},threeD:{fog:.15,exposure:1,emissive:.1,overlays:!1}})},{id:"ritual-aurora",name:"Ritual Aurora",description:"Neblina + rastros longos; campos viram pintura.",palette:Qg({mode:"earth",bgColor:"#02050a",accent:"#ffd700"}),aesthetic:Zg({canvas:{bgStyle:"radial",grain:.62,vignette:.58},trails:{enabled:!1,persistence:.88,width:1.2,blur:.35,blend:"screen"},connections:{alpha:.55,width:1,blend:"screen"},quanta:{shape:"spark",glow:.85,outline:.05},post:{bloom:.45,chroma:.12},tools:{intensity:.95},threeD:{fog:.7,exposure:1.25,emissive:.7,overlays:!0}})}],CV=new Map(e6.map(e=>[e.id,e]));function kV(e){return CV.get(e)}const D5=["KICK","BASS","PERC","PAD","LEAD","ARP","STRINGS","CHOIR"];let Y0=null;function RV(){if(Y0)return Y0;const e=256;Y0=document.createElement("canvas"),Y0.width=Y0.height=e;const t=Y0.getContext("2d"),n=t.createImageData(e,e);for(let r=0;r<n.data.length;r+=4){const a=Math.random()*26;n.data[r]=n.data[r+1]=n.data[r+2]=a,n.data[r+3]=255}return t.putImageData(n,0,0),Y0}let e5=null;const Xd={key:"",cvs:null},xy={};function sC(e,t,n){let r=xy[e];if(r||(r=document.createElement("canvas"),xy[e]=r),r.width!==t||r.height!==n){r.width=t,r.height=n;const a=r.getContext("2d");if(a&&a.setTransform(1,0,0,1,0,0),e==="trail"){const i=r.getContext("2d");i&&i.clearRect(0,0,t,n)}}return r}function AV(e){switch(e){case"screen":return"screen";case"lighter":return"lighter";case"multiply":return"multiply";case"overlay":return"overlay";default:return"source-over"}}const Br=(e,t)=>(e+1)*t*.5,$r=(e,t)=>(e+1)*t*.5,L5=[];for(let e=0;e<256;e++)L5[e]=e.toString(16).padStart(2,"0");function zb(e,t,n=1,r="role",a){if(r==="role"&&(a!=null&&a[e.role]))return a[e.role]+L5[Math.round(n*255)];if(r==="mono")return`rgba(255,255,255,${n*(.4+e.charge*.6)})`;if(r==="neon")return`hsla(${e.pitch*3.5%360|0},100%,68%,${n})`;if(r==="heat")return`hsla(${(1-e.charge)*60|0},95%,${45+e.charge*25|0}%,${n})`;if(r==="earth")return`hsla(${[32,20,50,38,44,28,38,35][D5.indexOf(e.role)]??35},55%,${38+e.charge*22|0}%,${n})`;if(r==="plasma")return`hsla(${(e.phase*360+e.charge*120)%360|0},90%,65%,${n})`;const i=(a==null?void 0:a[e.role])??ga[e.role];switch(t){case"Off":case"Events":return i+L5[Math.round(n*255)];case"Notes":return`hsla(${250-(e.pitch-33)/72*190|0},80%,${55+e.charge*25|0}%,${n})`;case"Harmony":return i+L5[Math.round(n*200)];case"Rhythm":return`hsla(${e.phase*360|0},90%,62%,${n})`;case"Tension":return`hsla(${40-e.charge*40|0},90%,${45+e.brightness*25|0}%,${n})`}}function Yy(e){return[parseInt(e.slice(1,3),16),parseInt(e.slice(3,5),16),parseInt(e.slice(5,7),16)]}function jV(e,t,n,r){var a;if((a=t.channels)!=null&&a.length){e.save(),e.lineCap="round";for(const i of t.channels)if(i.pts.length){e.strokeStyle=i.color,e.lineWidth=1.5,e.globalAlpha=.2,e.beginPath(),e.moveTo(Br(i.pts[0][0],n),$r(i.pts[0][1],r));for(let s=1;s<i.pts.length;s++)e.lineTo(Br(i.pts[s][0],n),$r(i.pts[s][1],r));e.stroke(),e.globalAlpha=.55;for(let s=6;s<i.pts.length;s+=10){const[c,l,d,u]=i.pts[s],h=Br(c,n),m=$r(l,r),f=12,g=4;e.fillStyle=i.color,e.beginPath(),e.moveTo(h+d*f,m+u*f),e.lineTo(h-u*g,m+d*g),e.lineTo(h+u*g,m-d*g),e.closePath(),e.fill()}}e.restore()}}function EV(e,t,n,r,a){var i;if((i=t.rails)!=null&&i.length){e.save(),e.lineCap="round";for(const s of t.rails){const c=Br(s.x1,n),l=$r(s.y1,r),d=Br(s.x2,n),u=$r(s.y2,r),h=s.color;e.strokeStyle=h,e.lineWidth=8*s.strength,e.globalAlpha=.07,e.beginPath(),e.moveTo(c,l),e.lineTo(d,u),e.stroke(),e.lineWidth=1.8,e.globalAlpha=.7,e.beginPath(),e.moveTo(c,l),e.lineTo(d,u),e.stroke();const m=d-c,f=u-l,g=Math.sqrt(m*m+f*f),x=-f/g,v=m/g,b=Math.floor(g/14);e.lineWidth=.8,e.globalAlpha=.4;for(let M=1;M<b;M++){const k=c+m*(M/b),R=l+f*(M/b);e.beginPath(),e.moveTo(k+x*4,R+v*4),e.lineTo(k-x*4,R-v*4),e.stroke()}const w=4;for(let M=0;M<w;M++){const k=(M/w+a*.3)%1,R=c+m*k,j=l+f*k;e.globalAlpha=.5*(.5+.5*Math.sin(a*4+M*1.5)),e.fillStyle=h,e.beginPath(),e.arc(R,j,1.5,0,Math.PI*2),e.fill()}}e.restore()}}function TV(e,t,n,r,a){var i;if((i=t.tunnels)!=null&&i.length){e.save(),e.lineCap="round";for(const s of t.tunnels){const c=Br(s.ax,n),l=$r(s.ay,r),d=Br(s.bx,n),u=$r(s.by,r),h=s.radius*n*.5,m=s.color;e.strokeStyle=m,e.lineWidth=.8,e.globalAlpha=.12+.06*Math.sin(a*2),e.setLineDash([3,6]),e.beginPath(),e.moveTo(c,l),e.lineTo(d,u),e.stroke(),e.setLineDash([]);const f=.5+.5*Math.sin(a*5);for(let x=0;x<3;x++)e.globalAlpha=(.5-x*.12)*(.6+f*.4),e.strokeStyle=m,e.lineWidth=1.5-x*.4,e.beginPath(),e.arc(c,l,h*(1+x*.6),0,Math.PI*2),e.stroke();e.globalAlpha=.8,e.fillStyle="rgba(0,0,0,.5)",e.beginPath(),e.arc(c,l,h*.4,0,Math.PI*2),e.fill(),e.globalAlpha=.7,e.fillStyle=m,e.font="8px monospace",e.textAlign="center",e.textBaseline="middle",e.fillText("A",c,l);const g=.5+.5*Math.sin(a*5+Math.PI);for(let x=0;x<3;x++)e.globalAlpha=(.5-x*.12)*(.6+g*.4),e.strokeStyle=m,e.lineWidth=1.5-x*.4,e.beginPath(),e.arc(d,u,h*(1+x*.6),0,Math.PI*2),e.stroke();e.globalAlpha=.7,e.fillStyle="rgba(0,0,0,.5)",e.beginPath(),e.arc(d,u,h*.4,0,Math.PI*2),e.fill(),e.globalAlpha=.7,e.fillStyle=m,e.fillText("B",d,u)}e.restore()}}function IV(e,t,n,r,a){const i=t.sequencer;if(!(i!=null&&i.active))return;e.save();const s=Br(i.x,n),c=$r(i.y,r),l=i.ringR*n*.5,d=i.steps.length;e.strokeStyle="rgba(255,255,255,0.08)",e.lineWidth=1,e.beginPath(),e.arc(s,c,l,0,Math.PI*2),e.stroke();for(let x=0;x<d;x++){const v=i.steps[x],b=x/d*Math.PI*2-Math.PI/2,w=s+Math.cos(b)*l,M=c+Math.sin(b)*l,k=v.armed;if(e.strokeStyle=k?"rgba(255,255,255,0.55)":"rgba(255,255,255,0.12)",e.lineWidth=k?1.5:.8,e.beginPath(),e.moveTo(s+Math.cos(b)*(l-4),c+Math.sin(b)*(l-4)),e.lineTo(s+Math.cos(b)*(l+4),c+Math.sin(b)*(l+4)),e.stroke(),k){const R=.7+.3*Math.sin(a*3+x);e.globalAlpha=R,e.fillStyle="#ffffff",e.beginPath(),e.arc(w,M,3,0,Math.PI*2),e.fill(),v.role&&(e.globalAlpha=.5,e.fillStyle=ga[v.role]??"#fff",e.beginPath(),e.arc(w,M,2.2,0,Math.PI*2),e.fill())}else e.globalAlpha=.2,e.fillStyle="rgba(255,255,255,0.3)",e.beginPath(),e.arc(w,M,1.5,0,Math.PI*2),e.fill();e.globalAlpha=1}const u=i.cursor*Math.PI*2-Math.PI/2,h=e.createLinearGradient(s,c,s+Math.cos(u)*l*1.1,c+Math.sin(u)*l*1.1);h.addColorStop(0,"rgba(255,255,255,0)"),h.addColorStop(.6,"rgba(255,255,255,0.08)"),h.addColorStop(1,"rgba(255,255,255,0.45)"),e.strokeStyle=h,e.lineWidth=1.5,e.beginPath(),e.moveTo(s,c),e.lineTo(s+Math.cos(u)*l*1.1,c+Math.sin(u)*l*1.1),e.stroke();const m=s+Math.cos(u)*(l+4),f=c+Math.sin(u)*(l+4),g=.5+.5*Math.sin(a*8);e.globalAlpha=g*.9,e.fillStyle="#ffffff",e.beginPath(),e.arc(m,f,2.5,0,Math.PI*2),e.fill(),e.globalAlpha=.4,e.strokeStyle="rgba(255,255,255,0.2)",e.lineWidth=.8,e.beginPath(),e.arc(s,c,6,0,Math.PI*2),e.stroke(),e.globalAlpha=.25,e.fillStyle="rgba(255,255,255,0.15)",e.beginPath(),e.arc(s,c,5,0,Math.PI*2),e.fill(),e.globalAlpha=.05,e.strokeStyle="#fff",e.lineWidth=1,e.setLineDash([3,8]),e.beginPath(),e.arc(s,c,i.triggerR*n*.5,0,Math.PI*2),e.stroke(),e.setLineDash([]),e.restore()}function PV(e,t,n,r,a){var i;if((i=t.cages)!=null&&i.length){e.save();for(const s of t.cages){const c=.5+.5*Math.sin(a*2),[l,d,u]=Yy(s.color);if(s.shape==="rect"){const h=Br(s.x-s.w/2,n),m=$r(s.y-s.h/2,r),f=Br(s.x+s.w/2,n),g=$r(s.y+s.h/2,r),x=f-h,v=g-m;e.globalAlpha=.12*c,e.strokeStyle=s.color,e.lineWidth=6,e.beginPath(),e.rect(h,m,x,v),e.stroke(),e.strokeStyle=s.color,e.lineWidth=1.5,e.globalAlpha=.7,e.beginPath(),e.rect(h,m,x,v),e.stroke();const b=8;e.strokeStyle=s.color,e.lineWidth=2.5,e.globalAlpha=.9;for(const[M,k,R,j]of[[h,m,1,1],[f,m,-1,1],[f,g,-1,-1],[h,g,1,-1]])e.beginPath(),e.moveTo(M,k+j*b),e.lineTo(M,k),e.lineTo(M+R*b,k),e.stroke();const w=e.createLinearGradient(h,m,f,g);w.addColorStop(0,`rgba(${l},${d},${u},0.03)`),w.addColorStop(1,`rgba(${l},${d},${u},0.01)`),e.fillStyle=w,e.globalAlpha=1,e.beginPath(),e.rect(h+1,m+1,x-2,v-2),e.fill()}else{const h=Br(s.x,n),m=$r(s.y,r),f=s.r*n*.5;for(let x=0;x<3;x++)e.globalAlpha=(.5-x*.15)*(.5+c*.4),e.strokeStyle=s.color,e.lineWidth=1.5-x*.4,e.beginPath(),e.arc(h,m,f*(1+x*.06),0,Math.PI*2),e.stroke();const g=e.createRadialGradient(h,m,0,h,m,f);g.addColorStop(0,`rgba(${l},${d},${u},0.04)`),g.addColorStop(1,`rgba(${l},${d},${u},0)`),e.fillStyle=g,e.globalAlpha=1,e.beginPath(),e.arc(h,m,f,0,Math.PI*2),e.fill()}}e.restore()}}function FV(e,t,n,r,a){var i;if((i=t.strings)!=null&&i.length){e.save(),e.lineCap="round";for(const s of t.strings){const c=Br(s.x1,n),l=$r(s.y1,r),d=Br(s.x2,n),u=$r(s.y2,r),h=d-c,m=u-l,f=Math.sqrt(h*h+m*m),g=-m/f,x=h/f,v=20,b=s.vibAmp*12*(.8+.2*Math.sin(a*8));e.globalAlpha=.06+s.vibAmp*.18,e.strokeStyle=s.color,e.lineWidth=10+s.vibAmp*12,e.beginPath(),e.moveTo(c,l),e.lineTo(d,u),e.stroke(),e.globalAlpha=.03+s.vibAmp*.08,e.lineWidth=18+s.vibAmp*16,e.beginPath(),e.moveTo(c,l),e.lineTo(d,u),e.stroke(),e.globalAlpha=.8+s.vibAmp*.2,e.strokeStyle=s.color,e.lineWidth=1.5+s.vibAmp,e.beginPath();for(let w=0;w<=v;w++){const M=w/v,k=c+h*M,R=l+m*M,j=Math.sin(M*Math.PI)*Math.sin(s.vibPhase*2)*b;w===0?e.moveTo(k+g*j,R+x*j):e.lineTo(k+g*j,R+x*j)}if(e.stroke(),e.globalAlpha=.9,e.fillStyle=s.color,e.beginPath(),e.arc(c,l,4,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(d,u,4,0,Math.PI*2),e.fill(),s.vibAmp>.05){const w=(c+d)/2,M=(l+u)/2,[k,R,j]=Yy(s.color);e.globalAlpha=s.vibAmp*.4;const I=30+s.vibAmp*40,E=e.createRadialGradient(w,M,0,w,M,I);E.addColorStop(0,`rgba(${k},${R},${j},0.6)`),E.addColorStop(.4,`rgba(${k},${R},${j},0.2)`),E.addColorStop(1,`rgba(${k},${R},${j},0)`),e.fillStyle=E,e.beginPath(),e.arc(w,M,I,0,Math.PI*2),e.fill()}}e.restore()}}function _V(e,t,n,r,a){var c;if(!((c=t.fxZones)!=null&&c.length))return;const i={slow:"#0066ff",fast:"#ff4400",mute:"#444488",excite_zone:"#ff8800",pitch_up:"#00ff88",pitch_down:"#ff0088",reverse:"#ff00ff",freeze_zone:"#88ccff",vortex_zone:"#cc44ff",gravity_down:"#ff8844",gravity_up:"#44ccff",transpose:"#ffdd00",harmonize_zone:"#88ff44",bounce:"#ff4444",compress_zone:"#4488ff",scatter_zone:"#ff88cc"},s={slow:"SLOW",fast:"FAST",mute:"MUTE",excite_zone:"EXCITE",pitch_up:"PITCH",pitch_down:"PITCH",reverse:"REVERSE",freeze_zone:"FREEZE",vortex_zone:"VORTEX",gravity_down:"GRAV",gravity_up:"GRAV",transpose:"TRANS",harmonize_zone:"HARM",bounce:"BOUNCE",compress_zone:"COMPRESS",scatter_zone:"SCATTER"};e.save();for(const l of t.fxZones){if(l.pts.length<3)continue;const d=i[l.effect]??"#ffffff",[u,h,m]=Yy(d),f=.5+.5*Math.sin(a*3+l.id*.7);e.beginPath();for(let v=0;v<l.pts.length;v++){const b=Br(l.pts[v][0],n),w=$r(l.pts[v][1],r);v===0?e.moveTo(b,w):e.lineTo(b,w)}e.closePath(),e.globalAlpha=.06+l.strength*.08+f*.03,e.fillStyle=`rgb(${u},${h},${m})`,e.fill(),e.globalAlpha=.5+f*.3,e.strokeStyle=d,e.lineWidth=1.2,e.setLineDash([6,4]),e.lineDashOffset=-a*10,e.stroke(),e.setLineDash([]);const g=l.pts.reduce((v,b)=>v+b[0],0)/l.pts.length,x=l.pts.reduce((v,b)=>v+b[1],0)/l.pts.length;e.globalAlpha=.7,e.fillStyle=d,e.font="8px monospace",e.textAlign="center",e.textBaseline="middle",e.fillText(s[l.effect]??l.effect,Br(g,n),$r(x,r))}e.restore()}function NV(e,t,n,r,a,i,s,c,l,d,u,h,m,f=1,g=0,x=0,v=-1,b=null,w=!0,M=Nv,k,R,j=Dv){const I=Math.min(window.devicePixelRatio||1,1.5),E=e.clientWidth,O=e.clientHeight,L=Math.round(E*I),$=Math.round(O*I);(e.width!==L||e.height!==$)&&(e.width=L,e.height=$);const F=e.getContext("2d");F.setTransform(I,0,0,I,0,0),F.fillStyle=M.bgColor,F.fillRect(0,0,E,O);const[B,W,re]=Yy(n.primary);if(j.canvas.bgStyle==="radial"){const ae=F.createRadialGradient(E/2,O/2,0,E/2,O/2,Math.max(E,O)*.62);ae.addColorStop(0,`rgba(${B},${W},${re},${s?.05:.026})`),ae.addColorStop(.5,`rgba(${B},${W},${re},.012)`),ae.addColorStop(1,"rgba(0,0,0,0)"),F.fillStyle=ae,F.fillRect(0,0,E,O)}const oe=.01+(j.canvas.grain??.5)*.09;if(oe>.02){if(!e5){const ae=F.createPattern(RV(),"repeat");ae&&(e5=ae)}e5&&(F.save(),F.globalAlpha=oe,F.fillStyle=e5,F.fillRect(0,0,E,O),F.restore())}const te=sC("trail",L,$),J=te.getContext("2d");if(J.setTransform(I,0,0,I,0,0),j.trails.enabled){const ae=Math.max(0,Math.min(1,j.trails.persistence??.55)),Re=.35+Math.pow(ae,.55)*.645;J.save(),J.globalCompositeOperation="destination-in",J.globalAlpha=Re,J.fillStyle="rgba(0,0,0,1)",J.fillRect(0,0,E,O),J.restore(),J.save(),J.translate(E/2+g,O/2+x),J.scale(f,f),J.translate(-E/2,-O/2),J.globalCompositeOperation=AV(j.trails.blend),J.lineCap="round";const Fe=j.trails.width??1;for(const Oe of t.quanta){const ne=Oe.x-Oe.prevX,nt=Oe.y-Oe.prevY;if(ne*ne+nt*nt<1e-8)continue;const pt=Br(Oe.prevX,E),Et=$r(Oe.prevY,O),_t=Br(Oe.x,E),Ct=$r(Oe.y,O),Xe=zb(Oe,r,1,M.mode,M.roleColorOverrides);J.strokeStyle=Xe,J.globalAlpha=.05+Oe.charge*.16,J.lineWidth=(.25+Oe.charge*1.15)*Fe,J.beginPath(),J.moveTo(pt,Et),J.lineTo(_t,Ct),J.stroke()}J.restore()}const pe=sC("scene",L,$),P=pe.getContext("2d");if(P.setTransform(I,0,0,I,0,0),P.clearRect(0,0,E,O),P.save(),P.translate(E/2+g,O/2+x),P.scale(f,f),P.translate(-E/2,-O/2),w){P.save();for(const ae of t.attractors){const Re=Br(ae.x,E),Fe=$r(ae.y,O),Oe=ae.radius*E*.5;let ne=ae.type==="metro"?"255,200,0":ae.type==="repulsor"?"255,80,0":ae.type==="vortex"?"180,0,255":"0,180,255";const nt=P.createRadialGradient(Re,Fe,0,Re,Fe,Oe);if(nt.addColorStop(0,`rgba(${ne},.1)`),nt.addColorStop(.5,`rgba(${ne},.03)`),nt.addColorStop(1,`rgba(${ne},0)`),P.fillStyle=nt,P.globalAlpha=1,P.beginPath(),P.arc(Re,Fe,Oe,0,Math.PI*2),P.fill(),ae.type==="metro"){const pt=.5+.5*Math.cos(t.elapsed*(t.bpm/60)*Math.PI*2);P.strokeStyle=`rgba(255,200,0,${.4+pt*.5})`,P.lineWidth=2,P.beginPath(),P.moveTo(Re,Fe-12*(.7+pt*.5)),P.lineTo(Re,Fe+8),P.moveTo(Re-6,Fe+8),P.lineTo(Re+6,Fe+8),P.stroke()}}P.restore(),_V(P,t,E,O,t.elapsed),PV(P,t,E,O,t.elapsed),FV(P,t,E,O,t.elapsed)}else{P.save();for(const ae of t.attractors){const Re=Br(ae.x,E),Fe=$r(ae.y,O),Oe=ae.radius*E*.5;P.globalAlpha=.015,P.fillStyle=ae.type==="repulsor"?"#ff5000":ae.type==="vortex"?"#8800ff":"#00aaff",P.beginPath(),P.arc(Re,Fe,Oe,0,Math.PI*2),P.fill()}P.restore()}if(r!=="Off"&&r!=="Rhythm"){P.save(),P.lineCap="round";const ae=.12*.12,Re=120;let Fe=0;const Oe=t.count>80?2:1;for(let ne=0;ne<t.count&&Fe<Re;ne+=Oe){const nt=t.quanta[ne];for(let pt=ne+1;pt<t.count&&Fe<Re;pt+=Oe){const Et=t.quanta[pt],_t=nt.x-Et.x,Ct=nt.y-Et.y;if(_t*_t+Ct*Ct>ae)continue;const Xe=Math.sqrt(_t*_t+Ct*Ct),Ut=Zj(nt.pitch,Et.pitch),Le=(1-Xe/.12)*.28;P.globalAlpha=r==="Harmony"?Le*(.4+Ut*.6):Le*.22,P.strokeStyle=r==="Harmony"?`hsl(${Ut*140},70%,55%)`:"rgba(255,255,255,0.7)",P.lineWidth=.5+Ut*.7,P.beginPath(),P.moveTo(Br(nt.x,E),$r(nt.y,O)),P.lineTo(Br(Et.x,E),$r(Et.y,O)),P.stroke(),Fe++}}P.restore()}P.save(),P.lineCap="round";for(const ae of t.gates){const Re=Br(ae.x1,E),Fe=$r(ae.y1,O),Oe=Br(ae.x2,E),ne=$r(ae.y2,O),nt=ae.type??"gate";if(nt==="mirror"){P.globalAlpha=.22,P.strokeStyle="#d0eeff",P.lineWidth=8,P.beginPath(),P.moveTo(Re,Fe),P.lineTo(Oe,ne),P.stroke(),P.globalAlpha=.92,P.strokeStyle="#e8f6ff",P.lineWidth=1.8,P.beginPath(),P.moveTo(Re,Fe),P.lineTo(Oe,ne),P.stroke();const pt=Oe-Re,Et=ne-Fe,_t=Math.sqrt(pt*pt+Et*Et)+.001,Ct=-Et/_t,Xe=pt/_t,Ut=Math.max(2,Math.floor(_t/10));P.lineWidth=.9,P.globalAlpha=.55,P.strokeStyle="#c0e8ff";for(let Le=1;Le<Ut;Le++){const Ke=Re+pt*(Le/Ut),mt=Fe+Et*(Le/Ut);P.beginPath(),P.moveTo(Ke+Ct*6,mt+Xe*6),P.lineTo(Ke+Ct*1,mt+Xe*1),P.stroke()}P.globalAlpha=.85,P.fillStyle="#e8f6ff",P.beginPath(),P.arc(Re,Fe,4,0,Math.PI*2),P.fill(),P.beginPath(),P.arc(Oe,ne,4,0,Math.PI*2),P.fill(),P.globalAlpha=.55,P.fillStyle="#c0e8ff",P.font="7px monospace",P.textAlign="center",P.textBaseline="middle",P.fillText("",(Re+Oe)/2,(Fe+ne)/2-10)}else if(nt==="absorber"){P.globalAlpha=.18,P.strokeStyle="#cc1111",P.lineWidth=12,P.beginPath(),P.moveTo(Re,Fe),P.lineTo(Oe,ne),P.stroke(),P.globalAlpha=.8,P.strokeStyle="#dd3333",P.lineWidth=1.5,P.setLineDash([5,3]),P.beginPath(),P.moveTo(Re,Fe),P.lineTo(Oe,ne),P.stroke(),P.setLineDash([]),P.globalAlpha=.45,P.strokeStyle="#880000",P.lineWidth=.8,P.beginPath(),P.moveTo(Re,Fe),P.lineTo(Oe,ne),P.stroke(),P.globalAlpha=.75,P.fillStyle="#dd3333",P.beginPath(),P.arc(Re,Fe,4,0,Math.PI*2),P.fill(),P.beginPath(),P.arc(Oe,ne,4,0,Math.PI*2),P.fill();const pt=Oe-Re,Et=ne-Fe,_t=Math.sqrt(pt*pt+Et*Et)+.001,Ct=Math.max(2,Math.floor(_t/20));P.globalAlpha=.4,P.fillStyle="#ff2222";for(let Xe=1;Xe<Ct;Xe++){const Ut=Re+pt*(Xe/Ct),Le=Fe+Et*(Xe/Ct);P.beginPath(),P.arc(Ut,Le,2,0,Math.PI*2),P.fill()}P.globalAlpha=.45,P.fillStyle="#cc1111",P.font="7px monospace",P.textAlign="center",P.textBaseline="middle",P.fillText("",(Re+Oe)/2,(Fe+ne)/2-10)}else if(nt==="membrane"){P.globalAlpha=.22,P.strokeStyle="#cc44ff",P.lineWidth=9,P.beginPath(),P.moveTo(Re,Fe),P.lineTo(Oe,ne),P.stroke(),P.globalAlpha=.82,P.strokeStyle="#dd66ff",P.lineWidth=1.5,P.beginPath(),P.moveTo(Re,Fe),P.lineTo(Oe,ne),P.stroke();const pt=Oe-Re,Et=ne-Fe,_t=Math.sqrt(pt*pt+Et*Et)+.001,Ct=-Et/_t,Xe=pt/_t,Ut=Math.max(2,Math.floor(_t/22));P.fillStyle="#cc44ff",P.globalAlpha=.65;for(let Le=1;Le<Ut;Le++){const Ke=Re+pt*(Le/Ut),mt=Fe+Et*(Le/Ut),an=9;P.beginPath(),P.moveTo(Ke-Ct*an,mt-Xe*an),P.lineTo(Ke+Ct*3-Et/_t*4,mt+Xe*3+pt/_t*4),P.lineTo(Ke+Ct*3+Et/_t*4,mt+Xe*3-pt/_t*4),P.closePath(),P.fill()}P.globalAlpha=.75,P.fillStyle="#dd66ff",P.beginPath(),P.arc(Re,Fe,4,0,Math.PI*2),P.fill(),P.beginPath(),P.arc(Oe,ne,4,0,Math.PI*2),P.fill(),P.globalAlpha=.5,P.fillStyle="#cc44ff",P.font="7px monospace",P.textAlign="center",P.textBaseline="middle",P.fillText("",(Re+Oe)/2,(Fe+ne)/2-10)}else P.globalAlpha=.18,P.strokeStyle=ae.color,P.lineWidth=6,P.beginPath(),P.moveTo(Re,Fe),P.lineTo(Oe,ne),P.stroke(),P.globalAlpha=.75,P.lineWidth=1.2,P.beginPath(),P.moveTo(Re,Fe),P.lineTo(Oe,ne),P.stroke(),P.globalAlpha=.55,P.fillStyle=ae.color,P.beginPath(),P.arc(Re,Fe,3.5,0,Math.PI*2),P.fill(),P.beginPath(),P.arc(Oe,ne,3.5,0,Math.PI*2),P.fill()}if(c){const{x1:ae,y1:Re,x2:Fe,y2:Oe}=c,ne=l==null?void 0:l.tool,nt=ne==="mirror"?"#e8f6ff":ne==="absorber"?"#dd3333":ne==="membrane"?"#dd66ff":"#ffffff";P.globalAlpha=.65,P.strokeStyle=nt,P.lineWidth=1,P.setLineDash([4,4]),P.beginPath(),P.moveTo(Br(ae,E),$r(Re,O)),P.lineTo(Br(Fe,E),$r(Oe,O)),P.stroke(),P.setLineDash([])}if(P.restore(),EV(P,t,E,O,t.elapsed),jV(P,t,E,O),TV(P,t,E,O,t.elapsed),IV(P,t,E,O,t.elapsed),u!=null&&u.length&&u.length>1){P.save(),P.lineCap="round",P.strokeStyle="rgba(255,255,255,0.35)",P.lineWidth=1.2,P.setLineDash([3,4]),P.beginPath(),P.moveTo(Br(u[0][0],E),$r(u[0][1],O));for(let ae=1;ae<u.length;ae++)P.lineTo(Br(u[ae][0],E),$r(u[ae][1],O));P.stroke(),P.setLineDash([]),P.restore()}if(h){P.save();const ae=Br(h.x,E),Re=$r(h.y,O),Fe=.5+.5*Math.sin(t.elapsed*6);P.strokeStyle="#cc66ff",P.lineWidth=1.5;for(let Oe=0;Oe<3;Oe++)P.globalAlpha=(.6-Oe*.15)*(.6+Fe*.4),P.beginPath(),P.arc(ae,Re,10*(1+Oe*.6),0,Math.PI*2),P.stroke();P.globalAlpha=.7,P.fillStyle="#cc66ff",P.font="8px monospace",P.textAlign="center",P.textBaseline="middle",P.fillText("A",ae,Re),P.restore()}if(m){const{x1:ae,y1:Re,x2:Fe,y2:Oe}=m;P.save(),P.lineCap="round",P.globalAlpha=.55,P.strokeStyle="#c8960a",P.lineWidth=2,P.setLineDash([5,4]),P.beginPath(),P.moveTo(Br(ae,E),$r(Re,O)),P.lineTo(Br(Fe,E),$r(Oe,O)),P.stroke(),P.setLineDash([]),P.restore()}if(k){const{x1:ae,y1:Re,x2:Fe,y2:Oe}=k;P.save(),P.globalAlpha=.65,P.strokeStyle="#00ffcc",P.lineWidth=1.5,P.setLineDash([5,4]);const ne=Br(ae,E),nt=$r(Re,O),pt=Br(Fe,E),Et=$r(Oe,O);P.beginPath(),P.rect(Math.min(ne,pt),Math.min(nt,Et),Math.abs(pt-ne),Math.abs(Et-nt)),P.stroke(),P.setLineDash([]),P.restore()}if(R&&R.length>1){P.save(),P.globalAlpha=.5,P.strokeStyle="#ff44cc",P.lineWidth=1.2,P.setLineDash([4,4]),P.beginPath(),P.moveTo(Br(R[0][0],E),$r(R[0][1],O));for(let ae=1;ae<R.length;ae++)P.lineTo(Br(R[ae][0],E),$r(R[ae][1],O));P.stroke(),P.setLineDash([]),P.restore()}P.save(),P.lineCap="round";for(const ae of t.ripples)P.globalAlpha=Math.max(0,ae.alpha),P.strokeStyle=ae.color,P.lineWidth=ae.thick,P.beginPath(),P.arc(Br(ae.x,E),$r(ae.y,O),ae.r*E*.5,0,Math.PI*2),P.stroke();P.restore(),P.save();for(const ae of t.emergent){const Re=Br(ae.x,E),Fe=$r(ae.y,O);if(P.globalAlpha=Math.max(0,ae.alpha),ae.type==="discharge"){const Oe=P.createRadialGradient(Re,Fe,0,Re,Fe,ae.r*E*.5);Oe.addColorStop(0,"rgba(255,255,150,.9)"),Oe.addColorStop(.5,"rgba(255,200,0,.4)"),Oe.addColorStop(1,"rgba(255,150,0,0)"),P.fillStyle=Oe,P.beginPath(),P.arc(Re,Fe,ae.r*E*.5,0,Math.PI*2),P.fill()}else if(ae.type==="mutation"){P.strokeStyle="#fff",P.lineWidth=1.5;for(let Oe=0;Oe<3;Oe++)P.globalAlpha=Math.max(0,ae.alpha*(1-Oe*.28)),P.beginPath(),P.arc(Re,Fe,(ae.r+Oe*.04)*E*.5,0,Math.PI*2),P.stroke()}}if(P.restore(),d){P.save(),P.lineCap="round";for(const ae of t.quanta){if(Math.sqrt(ae.vx*ae.vx+ae.vy*ae.vy)<.002)continue;const Fe=Br(ae.x,E),Oe=$r(ae.y,O),ne=Br(ae.x+ae.vx*4,E),nt=$r(ae.y+ae.vy*4,O);P.globalAlpha=.4,P.strokeStyle=zb(ae,r,1,M.mode,M.roleColorOverrides),P.lineWidth=.7,P.beginPath(),P.moveTo(Fe,Oe),P.lineTo(ne,nt),P.stroke()}P.restore()}P.save();const V=n.particleGlow,fe=M.mode,ye=M.roleColorOverrides;for(let ae=0;ae<t.quanta.length;ae++){const Re=t.quanta[ae],Fe=Br(Re.x,E),Oe=$r(Re.y,O),ne=3+Re.charge*2.8,nt=zb(Re,r,1,fe,ye);if(P.globalAlpha=.22+Re.charge*.1,P.fillStyle=nt,P.beginPath(),P.arc(Fe,Oe,ne*V*1.6,0,Math.PI*2),P.fill(),P.globalAlpha=.9,P.beginPath(),P.arc(Fe,Oe,ne*.52,0,Math.PI*2),P.fill(),Re.recentlyFired>0&&(P.globalAlpha=Re.recentlyFired*.7,P.fillStyle="#ffffff",P.beginPath(),P.arc(Fe,Oe,ne*2.8,0,Math.PI*2),P.fill()),ae===v){const pt=.55+.45*Math.sin(t.elapsed*8);P.globalAlpha=pt*.7,P.strokeStyle="#ffffff",P.lineWidth=1.5,P.beginPath(),P.arc(Fe,Oe,ne*V*3.2,0,Math.PI*2),P.stroke()}Re.selected&&(P.globalAlpha=.55,P.strokeStyle="#ffffff",P.lineWidth=1.5,P.beginPath(),P.arc(Fe,Oe,ne*V*2.8,0,Math.PI*2),P.stroke())}if(P.restore(),b){const ae=Br(b.x1,E),Re=$r(b.y1,O),Fe=Br(b.x2,E),Oe=$r(b.y2,O),ne=Fe-ae,nt=Oe-Re;P.save(),P.globalAlpha=.18,P.fillStyle="#88ccff",P.fillRect(ae,Re,ne,nt),P.globalAlpha=.75,P.strokeStyle="#88ccff",P.lineWidth=1.2,P.setLineDash([4,3]),P.strokeRect(ae,Re,ne,nt),P.setLineDash([]),P.restore()}if(l){const ae=Br(l.wx,E),Re=$r(l.wy,O);switch(P.save(),P.lineCap="round",l.tool){case"excite":{const Fe=l.radius*E*.5,Oe=P.createRadialGradient(ae,Re,0,ae,Re,Fe);Oe.addColorStop(0,"rgba(255,160,0,.18)"),Oe.addColorStop(1,"rgba(255,160,0,0)"),P.fillStyle=Oe,P.beginPath(),P.arc(ae,Re,Fe,0,Math.PI*2),P.fill(),P.globalAlpha=.5+l.active?.2:0,P.strokeStyle="#ff8800",P.lineWidth=1,P.beginPath(),P.arc(ae,Re,Fe,0,Math.PI*2),P.stroke();break}case"freeze":{const Fe=l.radius*E*.5,Oe=P.createRadialGradient(ae,Re,0,ae,Re,Fe);Oe.addColorStop(0,"rgba(100,200,255,.18)"),Oe.addColorStop(1,"rgba(100,200,255,0)"),P.fillStyle=Oe,P.beginPath(),P.arc(ae,Re,Fe,0,Math.PI*2),P.fill(),P.globalAlpha=.5,P.strokeStyle="#88ddff",P.lineWidth=1,P.beginPath(),P.arc(ae,Re,Fe,0,Math.PI*2),P.stroke();break}case"attractor":{P.globalAlpha=.6,P.strokeStyle="#00aaff",P.lineWidth=1,P.beginPath(),P.arc(ae,Re,14,0,Math.PI*2),P.stroke(),P.beginPath(),P.arc(ae,Re,5,0,Math.PI*2),P.stroke();for(let Fe=0;Fe<8;Fe++){const Oe=Fe/8*Math.PI*2;P.beginPath(),P.moveTo(ae+Math.cos(Oe)*22,Re+Math.sin(Oe)*22),P.lineTo(ae+Math.cos(Oe)*16,Re+Math.sin(Oe)*16),P.stroke()}break}case"repulsor":{P.globalAlpha=.6,P.strokeStyle="#ff4400",P.lineWidth=1,P.beginPath(),P.arc(ae,Re,14,0,Math.PI*2),P.stroke();for(let Fe=0;Fe<8;Fe++){const Oe=Fe/8*Math.PI*2;P.beginPath(),P.moveTo(ae+Math.cos(Oe)*8,Re+Math.sin(Oe)*8),P.lineTo(ae+Math.cos(Oe)*20,Re+Math.sin(Oe)*20),P.stroke()}break}case"vortex":{P.globalAlpha=.65,P.strokeStyle="#cc44ff",P.lineWidth=1;const Fe=performance.now()/1e3;for(let Oe=8;Oe<=22;Oe+=7)P.beginPath(),P.arc(ae,Re,Oe,Fe*.5,Fe*.5+Math.PI*1.6),P.stroke();break}case"spawn":{P.globalAlpha=.7,P.strokeStyle="#aaffaa",P.lineWidth=1,P.beginPath(),P.arc(ae,Re,10,0,Math.PI*2),P.stroke(),P.beginPath(),P.moveTo(ae-10,Re),P.lineTo(ae+10,Re),P.moveTo(ae,Re-10),P.lineTo(ae,Re+10),P.stroke();break}case"mutate":{P.globalAlpha=.7,P.strokeStyle="#ff88ff",P.lineWidth=1,P.beginPath(),P.arc(ae,Re,12,0,Math.PI*2),P.stroke();const Fe=performance.now()/800;P.setLineDash([4,4]),P.beginPath(),P.arc(ae,Re,18,Fe,Fe+Math.PI*1.5),P.stroke(),P.setLineDash([]);break}case"erase":{P.globalAlpha=.5,P.strokeStyle="#ff4466",P.lineWidth=1,P.beginPath(),P.arc(ae,Re,12,0,Math.PI*2),P.stroke(),P.beginPath(),P.moveTo(ae-7,Re-7),P.lineTo(ae+7,Re+7),P.moveTo(ae+7,Re-7),P.lineTo(ae-7,Re+7),P.stroke();break}case"channel":{P.globalAlpha=.65,P.strokeStyle="rgba(200,210,220,0.7)",P.lineWidth=1,P.beginPath(),P.arc(ae,Re,10,0,Math.PI*2),P.stroke();const Fe=performance.now()/1e3;P.fillStyle="rgba(200,210,220,0.7)",P.beginPath(),P.moveTo(ae+Math.cos(Fe)*14,Re+Math.sin(Fe)*14),P.lineTo(ae+Math.cos(Fe+2.4)*6,Re+Math.sin(Fe+2.4)*6),P.lineTo(ae+Math.cos(Fe-2.4)*6,Re+Math.sin(Fe-2.4)*6),P.closePath(),P.fill();break}case"tunnel":{P.globalAlpha=.65,P.strokeStyle="#cc66ff",P.lineWidth=1;const Fe=.5+.5*Math.sin(performance.now()/200);P.beginPath(),P.arc(ae,Re,10*(1+Fe*.2),0,Math.PI*2),P.stroke(),P.globalAlpha=.3,P.beginPath(),P.arc(ae,Re,18,0,Math.PI*2),P.stroke();break}case"rail":{P.globalAlpha=.65,P.strokeStyle="#c8960a",P.lineWidth=1,P.beginPath(),P.arc(ae,Re,10,0,Math.PI*2),P.stroke();for(let Fe=0;Fe<4;Fe++)P.beginPath(),P.moveTo(ae,Re-16-Fe*3),P.lineTo(ae,Re-10-Fe*3),P.moveTo(ae,Re+10+Fe*3),P.lineTo(ae,Re+16+Fe*3),P.moveTo(ae-16-Fe*3,Re),P.lineTo(ae-10-Fe*3,Re),P.moveTo(ae+10+Fe*3,Re),P.lineTo(ae+16+Fe*3,Re);P.stroke();break}default:{P.globalAlpha=.35,P.strokeStyle="rgba(255,255,255,.5)",P.lineWidth=1,P.beginPath(),P.arc(ae,Re,4,0,Math.PI*2),P.stroke();break}}P.restore()}P.restore(),F.setTransform(1,0,0,1,0,0),j.trails.enabled&&F.drawImage(te,0,0),F.drawImage(pe,0,0);const Se=Math.max(0,Math.min(1,j.post.bloom??0));if(Se>.01&&j.trails.enabled){const Re=Math.max(1,Math.round(L*.125)),Fe=Math.max(1,Math.round($*.125));let Oe=xy.bloom;Oe||(Oe=document.createElement("canvas"),xy.bloom=Oe),(Oe.width!==Re||Oe.height!==Fe)&&(Oe.width=Re,Oe.height=Fe);const ne=Oe.getContext("2d");ne.imageSmoothingEnabled=!0,ne.imageSmoothingQuality="low",ne.drawImage(te,0,0,Re,Fe),F.save(),F.globalCompositeOperation="screen",F.globalAlpha=.1+Se*.45,F.imageSmoothingEnabled=!0,F.imageSmoothingQuality="low",F.drawImage(Oe,0,0,L,$),F.restore()}const we=Math.max(0,Math.min(1,j.canvas.vignette??0));if(we>.01){const ae=`${E}|${O}|${we*100|0}`;if(Xd.key!==ae){Xd.cvs||(Xd.cvs=document.createElement("canvas")),Xd.cvs.width=E,Xd.cvs.height=O;const Re=Xd.cvs.getContext("2d"),Fe=Re.createRadialGradient(E/2,O/2,Math.min(E,O)*.12,E/2,O/2,Math.max(E,O)*.78);Fe.addColorStop(0,"rgba(0,0,0,0)"),Fe.addColorStop(.6,`rgba(0,0,0,${.05+we*.22})`),Fe.addColorStop(1,`rgba(0,0,0,${.18+we*.6})`),Re.fillStyle=Fe,Re.fillRect(0,0,E,O),Xd.key=ae}F.save(),F.setTransform(I,0,0,I,0,0),F.drawImage(Xd.cvs,0,0),F.restore()}F.setTransform(I,0,0,I,0,0);const ke=40,De=O-ke,_e=E/D5.length;F.save(),F.globalAlpha=.6,F.fillStyle="#080c14",F.fillRect(0,De,E,ke),F.globalAlpha=.25,F.strokeStyle="rgba(255,255,255,.1)",F.lineWidth=1,F.beginPath(),F.moveTo(0,De),F.lineTo(E,De),F.stroke();for(let ae=0;ae<D5.length;ae++){const Re=D5[ae],Fe=t.roleEnergy[Re]??0,Oe=ae*_e,ne=Math.max(2,Fe*(ke-10)),nt=ga[Re];F.globalAlpha=Fe*.38,F.fillStyle=nt,F.fillRect(Oe+_e*.12,De+(ke-ne)-4,_e*.76,ne+4),F.globalAlpha=.6+Fe*.38,F.fillStyle=nt,F.fillRect(Oe+_e*.3,De+(ke-ne),_e*.4,ne),F.globalAlpha=.3+Fe*.35,F.fillStyle=nt,F.font="7px monospace",F.textAlign="center",F.textBaseline="bottom",F.fillText(Re,Oe+_e*.5,O-2)}F.restore(),a&&(F.save(),F.textAlign="center",F.textBaseline="top",F.fillStyle=n.primary+"44",F.font=`${Math.max(11,E*.016)}px monospace`,F.fillText(n.name.toUpperCase(),E/2,22),F.font=`${Math.max(8,E*.01)}px monospace`,F.fillStyle=n.accent+"aa",F.fillText(n.vibe,E/2,42),F.restore())}const t6="t4p_musiclab_metaart_snapshot_v1";function OV(e){var d,u,h,m,f,g,x,v,b;const{state:t,preset:n,palette:r,aesthetic:a,phys:i,roleOverrides:s}=e,c={};for(const w of t.quanta)c[w.role]=(c[w.role]??0)+1;const l={};for(const w of t.fxZones??[])l[w.effect]=(l[w.effect]??0)+1;return{v:1,ts:Date.now(),preset:{id:n.id,name:n.name,tags:n.tags,intensity:n.intensity,bpm:n.bpm,scale:n.scale,root:n.root,reverbAmt:n.reverbAmt,delayAmt:n.delayAmt,delayTime:n.delayTime,primary:n.primary,secondary:n.secondary,accent:n.accent,lens:n.lens,harmonyMode:n.harmonyMode,eventRate:n.eventRate},palette:r,aesthetic:a,phys:i,roleOverrides:s,scene:{quantaCount:t.count,roles:c,roleEnergy:t.roleEnergy??{},gates:((d=t.gates)==null?void 0:d.length)??0,attractors:((u=t.attractors)==null?void 0:u.length)??0,channels:((h=t.channels)==null?void 0:h.length)??0,rails:((m=t.rails)==null?void 0:m.length)??0,tunnels:((f=t.tunnels)==null?void 0:f.length)??0,cages:((g=t.cages)==null?void 0:g.length)??0,strings:((x=t.strings)==null?void 0:x.length)??0,fxZones:((v=t.fxZones)==null?void 0:v.length)??0,sequencerOn:!!((b=t.sequencer)!=null&&b.active),fxKinds:l}}}function DV(e){try{localStorage.setItem(t6,JSON.stringify(e))}catch{}}function LV(){try{const e=localStorage.getItem(t6);if(!e)return null;const t=JSON.parse(e);return!t||t.v!==1?null:t}catch{return null}}const Yr=e=>Math.max(0,Math.min(1,e)),hp=(e,t,n)=>e+(t-e)*n;function zV(e){var a,i,s;const t=((a=e.palette)==null?void 0:a.bgColor)??e.preset.secondary??"#000000",n=[],r=c=>{c&&/^#[0-9a-fA-F]{6}$/.test(c)&&!n.includes(c)&&n.push(c)};if(r(e.preset.primary),r(e.preset.accent),r(e.preset.secondary),r((i=e.palette)==null?void 0:i.accent),(s=e.palette)!=null&&s.roleColorOverrides)for(const c of Object.values(e.palette.roleColorOverrides))r(c);return n.length<3&&n.push("#ffffff","#00d4ff","#ff0084"),{palette:n.slice(0,6),background:t}}function BV(e){const t=new Set((e??[]).map(String));return t.has("Techno")||t.has("Club")||t.has("Rave")||t.has("Breakbeat")?"ecstasy":t.has("Ambient")||t.has("Meditative")||t.has("Drone")?"silence":t.has("Glitch")?"glitch":t.has("Minimalist")||t.has("Minimalist")?"minimal":t.has("Orchestral")||t.has("Choral")||t.has("Strings")?"harmony":"none"}function $V(e){var x,v,b,w,M,k,R,j,I,E,O,L,$;const{palette:t,background:n}=zV(e),r=Yr((e.scene.quantaCount??0)/160),a=Yr((e.scene.gates+e.scene.rails+e.scene.cages)/16*.9),i=Yr(hp(e.preset.reverbAmt??.3,1,.25)*.9),s=Yr((e.phys.alignment??.8)/2*.65+(e.scene.channels>0?.25:0)),c=Yr((e.preset.intensity??2)/5*.65+(((x=e.palette)==null?void 0:x.mode)==="mono"?.15:.35)),l=Yr(((e.preset.bpm??90)-40)/140*.55+Yr((e.preset.eventRate??.6)/2.5)*.45),d=Yr((e.phys.turbulence??.2)*.75+(Object.keys(e.scene.fxKinds??{}).includes("glitch")?.25:0)),u=Yr(((b=(v=e.aesthetic)==null?void 0:v.trails)==null?void 0:b.persistence)??.55),h=(e.ts^e.scene.quantaCount<<5^(e.preset.bpm??0)<<1)>>>0,m={id:`musiclab_${e.preset.id}_${e.ts}`,createdAt:Date.now(),name:`Capa  ${e.preset.name}`,intention:BV(e.preset.tags),background:n,palette:t,quantaCount:Math.round(380+r*900),genes:{structure:a,flow:s,entropy:d,memory:u,contrast:c,symmetry:Yr((e.scene.sequencerOn?.4:.2)+(e.preset.scale==="whole_tone"?.1:0)),glyphness:Yr(.15+(e.scene.tunnels>0?.2:0)+(e.scene.fxKinds.harmonize_zone?.15:0)),erosion:Yr(.15+(e.scene.fxKinds.mute?.2:0)),layering:Yr(.25+(e.scene.fxZones>1?.25:0)+i*.2),rhythm:l,fragmentation:Yr(.1+(e.scene.tunnels>0?.2:0)+(e.scene.fxKinds.scatter_zone?.2:0)),coherence:Yr(.35+(e.preset.harmonyMode==="consonant"?.25:e.preset.harmonyMode==="dissonant"?-.1:0)),linear:Yr(.15+(e.scene.channels>0?.2:0)+(e.phys.migrationX||e.phys.migrationY?.15:0))}},f={mode:"hybrid",macroStructure:a,macroGesture:s,macroContrast:c,macroSilence:Yr(1-(l*.8+r*.2)),macroAtmosphere:Yr(i*.85+u*.15),macroCollage:Yr(.12+(e.scene.fxZones>0?.25:0)+d*.15),snapAxes:.12,gridStrength:Yr(a*.65),gridSize:.35,lineMastery:Yr(.18+a*.55),planeCasting:Yr(.15+i*.55),cutWindows:Yr(.05+d*.35),mixPoint:Yr(.55-a*.15),mixLine:Yr(.25+a*.35),mixRect:Yr(.08+a*.25),mixArc:Yr(.06+s*.3),mixPlane:Yr(.06+i*.25),shapeOpacity:Yr(.25+i*.35),fillSolidity:Yr(.25+c*.45),strokeWeight:hp(.35,1.6,a),shapeScale:hp(.7,1.6,s),rotationDrift:Yr(d*.65),vignetteStr:Yr(.15+c*.55),grainStr:Yr(.15+(((M=(w=e.aesthetic)==null?void 0:w.canvas)==null?void 0:M.grain)??.5)*.65),bloomShape:Yr(.12+(((R=(k=e.aesthetic)==null?void 0:k.post)==null?void 0:R.bloom)??.25)*.65),zDepth:Yr(.35+a*.55),orbitSpeed:Yr(.25+l*.55),camFOV:55,depthFog:Yr(.15+i*.65),light3D:Yr(.35+c*.45),particleSize3D:hp(.7,1.5,r),glowIntensity3D:Yr(.25+(((I=(j=e.aesthetic)==null?void 0:j.quanta)==null?void 0:I.glow)??.65)*.65),waveZ:Yr(.2+l*.6),showGeoShapes:!0,solidShapes3D:!1,trails3D:!0,trailLength3D:hp(1,4.5,u),boundaryMode:"wrap",showBorder:!1},g={connections:(((O=(E=e.aesthetic)==null?void 0:E.connections)==null?void 0:O.enabled)??!0)&&(e.scene.quantaCount??0)<=220,glow:((($=(L=e.aesthetic)==null?void 0:L.post)==null?void 0:$.bloom)??0)>.15,pulse:e.scene.sequencerOn||l>.55};return{dna:m,geo:f,overlays:g,seed:h}}const qV={dialogica:0,recursivo:0,hologramatico:0,sapiensDemens:.5,tetralogia:0};function HV(e,t){const n=e.length;if(n<3)return qV;const r=new Map;for(let te=0;te<n;te++){const J=e[te].role;r.set(J,(r.get(J)??0)+1)}let a=0;for(const te of r.values()){const J=te/n;J>0&&(a-=J*Math.log2(J))}a/=Math.log2(8);let i=0,s=0,c=0,l=0,d=0;for(let te=0;te<n;te++){const J=e[te],pe=Math.sqrt(J.vx*J.vx+J.vy*J.vy);i+=pe,s+=pe*pe,c+=J.charge,l+=J.pitch,J.phaseLocked>=0&&d++}const u=i/n,h=Math.sqrt(Math.max(0,s/n-u*u)),m=c/n,f=l/n,g=d/n;let x=0;for(let te=0;te<n;te++)x+=(e[te].pitch-f)**2;x=Math.sqrt(x/n);const v=Math.min(1,x/12),b=t.cohesion*.25+t.damping*.25+g*.25+t.entainment*.25,w=t.turbulence*.25+t.mutationRate*.25+Math.min(1,h*5)*.25+v*.25,M=Math.min(1,Math.min(b,w)*2.5),k=Math.min(1,m*.4+t.energyTransfer*.3+a*.3)*Math.min(1,1+h*2),R=Math.min(1,a*.35+g*.25+v*.2+Math.min(1,m*2)*.2),j=t.cohesion*.25+t.entainment*.25+g*.25+(1-t.mutationRate)*.25,I=t.turbulence*.25+t.mutationRate*.25+(1-t.damping)*.25+Math.min(1,h*4)*.25,E=j+I||1,O=j/E,L=t.damping*.5+g*.5,$=t.turbulence*.5+Math.min(1,h*5)*.5,F=a*.5+Math.min(1,m*2)*.5,B=t.cohesion*.4+t.entainment*.3+(1-t.mutationRate)*.3,W=Math.min(L,$,F,B),re=Math.max(L,$,F,B)||1,oe=Math.min(1,W/re*2+W*.5);return{dialogica:M,recursivo:k,hologramatico:R,sapiensDemens:O,tetralogia:oe}}const WV="'Doto', monospace",GV="'IBM Plex Mono', monospace",K0="#37b2da",wh=(e=16)=>Array.from({length:e},()=>({on:!1,vel:.8})),iC=()=>[{role:"KICK",muted:!1,solo:!1,steps:wh()},{role:"BASS",muted:!1,solo:!1,steps:wh()},{role:"PERC",muted:!1,solo:!1,steps:wh()},{role:"LEAD",muted:!1,solo:!1,steps:wh()},{role:"ARP",muted:!1,solo:!1,steps:wh()},{role:"PAD",muted:!1,solo:!1,steps:wh()}],VV=[{name:"4 on 4",desc:"Kick em cada beat  techno clssico",steps:{KICK:[0,4,8,12],BASS:[0,4,8,12],PERC:[2,6,10,14],LEAD:[2,10],ARP:[0,2,4,6,8,10,12,14]}},{name:"Boom Bap",desc:"Hip-hop: kick 1+3, snare 2+4",steps:{KICK:[0,6,10],BASS:[0,8],PERC:[4,12],ARP:[2,6,14]}},{name:"Techno",desc:"Groove de 2 barras, bassline acido",steps:{KICK:[0,4,8,12],PERC:[2,6,10,14],BASS:[0,3,8,11],LEAD:[6,14],ARP:[1,5,9,13]}},{name:"Arpejo",desc:"ARP livre, PAD e BASS no 1+3",steps:{ARP:[0,2,4,6,8,10,12,14],PAD:[0,8],BASS:[0,8],KICK:[0,8]}},{name:"Minimal",desc:"Espao e respiro",steps:{KICK:[0,8],BASS:[0,6],PERC:[4],PAD:[0]}},{name:"D&B",desc:"Drum and Bass: kick sincopado",steps:{KICK:[0,10],BASS:[0,3,8,11],PERC:[4,6,12,14],ARP:[0,4,8,12]}},{name:"Afro",desc:"Poliritmo afrobeat",steps:{KICK:[0,3,6,9,12],PERC:[2,5,8,11,14],BASS:[0,6,12],ARP:[2,8,14],LEAD:[4,10]}},{name:"Ambient",desc:"Texturas lentas, sem percusso",steps:{PAD:[0],ARP:[0,4,8,12],LEAD:[4],BASS:[0,8]}}],UV=({rows:e,active:t,stepCount:n,cursor:r,bpm:a,onToggleActive:i,onToggleStep:s,onSetStepCount:c,onToggleMute:l,onToggleSolo:d,onClearRow:u,onLoadPattern:h,onClearAll:m})=>{const[f,g]=S.useState(!1),x=e.some(v=>v.solo);return o.jsxs("div",{className:"flex flex-col select-none",style:{background:"rgba(0,0,0,0.94)",fontFamily:GV},children:[o.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5",style:{borderBottom:"1px dashed rgba(255,255,255,0.04)"},children:[o.jsx("button",{title:t?"Desativar sequencer":"Ativar sequencer",onClick:i,className:"flex items-center gap-1 px-2.5 py-1 transition-all",style:{fontSize:7,letterSpacing:"0.08em",textTransform:"uppercase",color:t?K0:"rgba(255,255,255,0.25)",background:t?`${K0}08`:"transparent",border:t?`1px dashed ${K0}30`:"1px dashed rgba(255,255,255,0.06)"},children:t?o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"w-1.5 h-1.5 animate-pulse inline-block mr-0.5",style:{background:K0}}),"ON"]}):o.jsx(o.Fragment,{children:" OFF"})}),o.jsx("span",{style:{fontFamily:WV,fontSize:8,letterSpacing:"0.12em",textTransform:"uppercase",color:"rgba(255,255,255,0.28)"},children:"Studio Seq"}),o.jsxs("span",{style:{fontSize:6,color:"rgba(255,255,255,0.14)"},children:[a," BPM  ",n," steps  4/4"]}),o.jsx("div",{className:"flex-1"}),o.jsxs("div",{className:"flex items-center gap-0.5",children:[o.jsx("span",{style:{fontSize:6,color:"rgba(255,255,255,0.14)",textTransform:"uppercase",marginRight:4},children:"Steps"}),[8,16].map(v=>o.jsx("button",{title:`${v} steps`,onClick:()=>c(v),className:"transition-all",style:{fontSize:7,padding:"2px 8px",color:n===v?K0:"rgba(255,255,255,0.18)",background:n===v?`${K0}08`:"transparent",border:n===v?`1px dashed ${K0}30`:"1px dashed rgba(255,255,255,0.04)"},children:v},v))]}),o.jsxs("div",{className:"relative",children:[o.jsx("button",{title:"Padres",onClick:()=>g(v=>!v),className:"transition-all",style:{fontSize:7,padding:"2px 8px",color:"rgba(255,255,255,0.22)",border:"1px dashed rgba(255,255,255,0.06)"},children:"Padres "}),f&&o.jsx("div",{className:"absolute bottom-full right-0 mb-1 z-50 w-52 py-1",style:{background:"rgba(0,0,0,0.96)",border:"1px dashed rgba(255,255,255,0.06)"},children:VV.map(v=>o.jsxs("button",{title:v.name,onClick:()=>{h(v),g(!1)},className:"w-full text-left px-3 py-1.5 transition-all",style:{background:"transparent"},onMouseEnter:b=>b.currentTarget.style.background="rgba(255,255,255,0.03)",onMouseLeave:b=>b.currentTarget.style.background="transparent",children:[o.jsx("div",{style:{fontSize:7,color:"rgba(255,255,255,0.55)"},children:v.name}),o.jsx("div",{style:{fontSize:6,color:"rgba(255,255,255,0.20)"},children:v.desc})]},v.name))})]}),o.jsx("button",{title:"Limpar tudo",onClick:m,className:"transition-all",style:{fontSize:7,padding:"2px 8px",color:"rgba(255,60,60,0.35)",border:"1px dashed rgba(255,60,60,0.12)"},children:"Limpar"})]}),o.jsxs("div",{className:"px-3 py-2 flex flex-col gap-[3px]",children:[e.map((v,b)=>{const w=ga[v.role],M=v.muted||x&&!v.solo;return o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",style:{width:80},children:[o.jsx("button",{onClick:()=>l(b),title:"Mute",className:"w-[18px] h-[18px] flex items-center justify-center transition-all",style:{fontSize:6,border:`1px dashed ${v.muted?"rgba(255,255,255,0.06)":w+"40"}`,color:v.muted?"rgba(255,255,255,0.15)":w+"bb",background:v.muted?"transparent":w+"08"},children:"M"}),o.jsx("button",{onClick:()=>d(b),title:"Solo",className:"w-[18px] h-[18px] flex items-center justify-center transition-all",style:{fontSize:6,border:`1px dashed ${v.solo?"rgba(255,215,0,0.50)":"rgba(255,255,255,0.04)"}`,color:v.solo?"#ffd700":"rgba(255,255,255,0.15)",background:v.solo?"rgba(255,215,0,0.06)":"transparent"},children:"S"}),o.jsx("span",{className:"flex-1 text-center transition-colors",style:{fontSize:7,letterSpacing:"0.10em",textTransform:"uppercase",color:M?"rgba(255,255,255,0.12)":w},children:v.role.slice(0,3)}),o.jsx("button",{onClick:()=>u(b),style:{fontSize:7,color:"rgba(255,255,255,0.10)"},className:"transition-colors",title:"Limpar linha",children:""})]}),o.jsx("div",{className:"flex gap-px flex-1",children:Array.from({length:n}).map((k,R)=>{const I=(v.steps[R]??{on:!1}).on,E=t&&R===r,O=R%4===0,L=R===0||R===8;return o.jsx("button",{title:`Beat ${R+1}`,onClick:()=>s(b,R),className:`relative flex-1 transition-all ${E?"ring-1 ring-white/70":""}`,style:{height:22,background:I?E?w:M?w+"28":w+"60":O?"rgba(255,255,255,0.04)":"rgba(255,255,255,0.02)",borderBottom:I?`2px solid ${M?w+"35":w}`:L?"1px solid rgba(255,255,255,0.08)":O?"1px solid rgba(255,255,255,0.04)":"1px solid rgba(255,255,255,0.02)",opacity:M&&!E?.4:1}},R)})})]},v.role)}),o.jsx("div",{className:"flex gap-px",style:{marginLeft:88},children:Array.from({length:n}).map((v,b)=>o.jsx("div",{className:"flex-1 flex justify-start pl-0.5",children:b%4===0&&o.jsx("span",{style:{fontSize:5,color:"rgba(255,255,255,0.14)"},children:b/4+1})},b))})]})]})},ow="'Doto', monospace",ol="'IBM Plex Mono', monospace",Mh="#37b2da",Ra={fontFamily:ol,fontSize:7,color:"rgba(255,255,255,0.32)",lineHeight:1.8},z5={fontFamily:ol,fontSize:7,color:"rgba(255,255,255,0.58)",background:"rgba(255,255,255,0.06)",padding:"1px 5px",border:"1px dashed rgba(255,255,255,0.08)",whiteSpace:"nowrap"},Ss={padding:"8px 10px",border:"1px dashed rgba(255,255,255,0.05)",marginTop:4},ad={fontFamily:ol,fontSize:6,color:"rgba(255,255,255,0.18)",lineHeight:1.8},Wa={fontFamily:ow,fontSize:8,letterSpacing:"0.10em",textTransform:"uppercase",marginBottom:6},si=({c:e,children:t})=>o.jsx("em",{style:{color:`${e}cc`,fontStyle:"normal",fontWeight:500},children:t}),fp=({children:e})=>o.jsx("span",{style:z5,children:e}),Jd=({items:e})=>o.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:4},children:e.map(([t,n])=>o.jsxs("div",{style:{...Ss,padding:"5px 8px"},children:[o.jsx("div",{style:{fontFamily:ol,fontSize:7,color:"rgba(255,255,255,0.55)"},children:t}),o.jsx("div",{style:ad,children:n})]},t))}),Ch=({items:e,color:t})=>o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:5},children:e.map((n,r)=>o.jsxs("div",{style:{display:"flex",gap:8,alignItems:"flex-start"},children:[o.jsxs("span",{style:{fontFamily:ol,fontSize:8,color:`${t}55`,width:14,textAlign:"right",flexShrink:0},children:[r+1,"."]}),o.jsx("p",{style:Ra,children:n})]},r))}),Vh=[{title:"O que  o Music Lab?",chapter:"Conceito",icon:"",color:Mh,content:o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[o.jsxs("p",{style:{...Ra,fontSize:8,color:"rgba(255,255,255,0.45)"},children:["O Music Lab  um ",o.jsx(si,{c:Mh,children:"instrumento generativo sinestsico"}),". Partculas com propriedades musicais (pitch, role, charge) circulam num espao fsico e ",o.jsx("em",{style:{fontStyle:"normal",color:"rgba(255,255,255,0.50)"},children:"produzem som ao interagir com o ambiente"}),"."]}),o.jsxs("div",{style:Ss,children:[o.jsx("div",{style:{...Wa,color:`${Mh}44`},children:"Princpios"}),o.jsx(Ch,{color:Mh,items:["Cada partcula tem um ROLE (KICK, BASS, LEAD, PAD, ARP, etc.) que define seu timbre.",'Gate Lines so "linhas de disparo"  quando uma partcula cruza uma, ela emite uma nota.',"A posio, velocidade e energia da partcula influenciam o pitch, o volume e o timbre.","Nada  pr-programado. A msica emerge da fsica e da topologia do espao."]})]}),o.jsx("p",{style:ad,children:"Resultado: composies que nunca se repetem, mas mantm coerncia harmnica."})]})},{title:"Primeiro Som",chapter:"Passo a passo",icon:"",color:"#4ade80",content:o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[o.jsxs("p",{style:{...Ra,fontSize:8,color:"rgba(255,255,255,0.45)"},children:["Em ",o.jsx(si,{c:"#4ade80",children:"3 aes"})," voc ter som. Siga a ordem:"]}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[["1",fp({children:" Start"}),"no topo da toolbar ativa o udio e inicia a simulao."],["2",fp({children:"E + arraste"}),"desenha Gate Lines no canvas  as linhas que disparam notas quando cruzadas."],["3",fp({children:"W + clique"}),"spawna partculas. Elas vo se mover e colidir com os gates, produzindo som."]].map(([e,t,n])=>o.jsxs("div",{style:{display:"flex",gap:10,alignItems:"flex-start"},children:[o.jsx("span",{style:{fontFamily:ow,fontSize:14,color:"#4ade8044",width:22,textAlign:"right",flexShrink:0,lineHeight:"1.1"},children:e}),o.jsx("div",{children:o.jsxs("div",{style:{...Ra,fontSize:7.5,color:"rgba(255,255,255,0.40)"},children:[t," ",n]})})]},String(e)))}),o.jsxs("div",{style:{...Ss,borderColor:"rgba(74,222,128,0.12)"},children:[o.jsx("div",{style:{...Wa,color:"rgba(74,222,128,0.35)"},children:"Dica"}),o.jsxs("p",{style:Ra,children:["Desenhe ",o.jsx("span",{style:{color:"rgba(255,255,255,0.50)"},children:"2-3 gate lines cruzadas"})," pelo centro  quanto mais caminhos, mais variao sonora. Partculas com ",o.jsx("span",{style:{color:"rgba(255,255,255,0.50)"},children:"roles diferentes"})," produzem sons diferentes ao cruzar os mesmos gates."]})]})]})},{title:"Ferramentas",chapter:"Canvas Tools",icon:"",color:"#00d4ff",content:o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[o.jsxs("p",{style:{...Ra,fontSize:8,color:"rgba(255,255,255,0.40)"},children:["A barra lateral esquerda tem ",o.jsx(si,{c:"#00d4ff",children:"20 ferramentas"}),". Cada uma modifica o espao de forma diferente."]}),o.jsx("div",{style:{...Wa,color:"rgba(0,212,255,0.35)",marginTop:4},children:"Essenciais"}),o.jsx(Jd,{items:[["Q  Select","Clique/arraste para selecionar partculas."],["W  Spawn","Cria novas partculas no clique."],["E  Gate Line","Desenha linhas que disparam notas."],["P  Erase","Remove partculas e objetos."]]}),o.jsx("div",{style:{...Wa,color:"rgba(0,212,255,0.35)",marginTop:6},children:"Foras"}),o.jsx(Jd,{items:[["A  Attractor","Campo gravitacional que puxa partculas."],["T  Repulsor","Empurra partculas para longe."],["Y  Vortex","Redemoinho que gira partculas."],["U  Excite","Aumenta energia/carga das partculas."],["I  Freeze","Diminui velocidade e carga."],["O  Mutate","Muda o role (timbre) de uma partcula."]]})]})},{title:"Quantum Powers",chapter:"Advanced Tools",icon:"",color:"#cc44ff",content:o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[o.jsxs("p",{style:{...Ra,fontSize:8,color:"rgba(255,255,255,0.40)"},children:["Ferramentas avanadas que criam ",o.jsx(si,{c:"#cc44ff",children:"topologias complexas"})," no espao."]}),o.jsx("div",{style:{...Wa,color:"rgba(204,68,255,0.35)",marginTop:4},children:"Quntico"}),o.jsx(Jd,{items:[["1  Q.Channel",'Pinte "vento" direcional  guia partculas.'],["2  G.Rail","Trilho magntico que atrai partculas."],["3  Q.Tunnel","Portal: entrada A  sada B."]]}),o.jsx("div",{style:{...Wa,color:"rgba(204,68,255,0.35)",marginTop:6},children:"Barreiras"}),o.jsx(Jd,{items:[["4  Mirror","Reflete partculas como um espelho."],["5  Absorber","Absorve e destri partculas."],["6  Membrane","Semi-permevel: passa s vezes."]]}),o.jsx("div",{style:{...Wa,color:"rgba(204,68,255,0.35)",marginTop:6},children:"Instrumentos"}),o.jsx(Jd,{items:[["7  Cage","Cerca que prende partculas dentro."],["8  H.String","Corda harmnica que vibra."],["9  FX Zone","Zona pintada com efeito especial."],["0  Metro","Metrnomo espacial pulsante."]]})]})},{title:"Roles & Timbres",chapter:"Som",icon:"",color:"#ff8c00",content:o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[o.jsxs("p",{style:{...Ra,fontSize:8,color:"rgba(255,255,255,0.40)"},children:["Cada partcula tem um ",o.jsx(si,{c:"#ff8c00",children:"Voice Role"})," que define seu timbre base. O painel direito (aba Timbre) permite trocar o template de cada role."]}),o.jsx(Jd,{items:[["KICK ","Graves percussivos  ritmo base."],["BASS ","Linhas de baixo  fundao harmnica."],["PERC ","Hi-hats, snares  texturas rtmicas."],["PAD ~","Pads longos  atmosfera e fundo."],["LEAD ","Melodias  linhas principais."],["ARP ","Arpejos rpidos  movimento."],["STRINGS ","Cordas  camadas sustain."],["CHOIR ","Vozes  profundidade coral."]]}),o.jsxs("div",{style:Ss,children:[o.jsx("div",{style:{...Wa,color:"rgba(255,140,0,0.35)"},children:"Timbre Templates"}),o.jsxs("p",{style:Ra,children:["No painel direito, clique no template de timbre para mudar: ",o.jsx("span",{style:{color:"rgba(255,255,255,0.45)"},children:"Sub Bass, Acid 303, Hard Kick, FM Bell, Saw Lead, Warm Pad, Shimmer, Glitch"}),", etc. Cada template modifica waveform, filtro, envelope e gain."]})]})]})},{title:"Escalas & Harmonia",chapter:"Teoria Musical",icon:"",color:"#9b59ff",content:o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[o.jsxs("p",{style:{...Ra,fontSize:8,color:"rgba(255,255,255,0.40)"},children:["Todas as notas so ",o.jsx(si,{c:"#9b59ff",children:"quantizadas automaticamente"}),' para a escala ativa. Isso garante que tudo soe "certo" mesmo com o caos das partculas.']}),o.jsxs("div",{style:Ss,children:[o.jsx("div",{style:{...Wa,color:"rgba(155,89,255,0.35)"},children:"Escalas disponveis"}),o.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:3},children:["Major","Minor","Pentatonic","Blues","Dorian","Phrygian","Lydian","Mixolydian","Whole Tone","Harmonic Minor","Chromatic"].map(e=>o.jsx("span",{style:{...z5,fontSize:6},children:e},e))})]}),o.jsxs("div",{style:Ss,children:[o.jsx("div",{style:{...Wa,color:"rgba(155,89,255,0.35)"},children:"Pitch por Role"}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:3},children:[["KICK / PERC","Pitch fixo  apenas ritmo e textura."],["BASS","Nota raiz da escala  fundamento."],["LEAD","Cicla pelos graus da escala ativa."],["ARP","Arpejo rpido na escala."],["PAD / STRINGS / CHOIR","Harmonias e cores tonais."]].map(([e,t])=>o.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[o.jsx("span",{style:{...z5,width:100,textAlign:"center",flexShrink:0,fontSize:6},children:e}),o.jsx("span",{style:Ra,children:t})]},e))})]}),o.jsxs("p",{style:ad,children:["Use o painel superior para alterar Root e Scale em tempo real. Modo ",o.jsx("span",{style:{color:"rgba(255,255,255,0.35)"},children:"Canvas"})," mapeia pitch pela posio X/Y."]})]})},{title:"Fsica & Comportamento",chapter:"Dinmica",icon:"",color:"#39ff70",content:o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[o.jsxs("p",{style:{...Ra,fontSize:8,color:"rgba(255,255,255,0.40)"},children:["O painel direito (aba Physics) controla a ",o.jsx(si,{c:"#39ff70",children:"dinmica do movimento"}),". Cada parmetro muda como as partculas se comportam."]}),o.jsx(Jd,{items:[["Damping","Atrito  valores altos = partculas lentas."],["Cohesion","Fora que une partculas prximas."],["Separation","Fora que repele partculas muito perto."],["Max Speed","Velocidade mxima das partculas."],["Turbulence","Caos aleatrio no movimento."],["Alignment","Partculas se alinham na mesma direo."]]}),o.jsxs("div",{style:Ss,children:[o.jsx("div",{style:{...Wa,color:"rgba(57,255,112,0.35)"},children:"Motion Styles"}),o.jsxs("p",{style:Ra,children:["Mude o ",o.jsx("span",{style:{color:"rgba(255,255,255,0.45)"},children:"Motion Style"})," (aba Behavior) para padres pr-definidos:",o.jsx("span",{style:{color:"rgba(255,255,255,0.35)"},children:" Swarm, Orbit, Flow, Drift, Spiral, Lattice, Murmuration, Jazz, Meditation, Chaos"}),", etc."]})]})]})},{title:"Studio Sequencer",chapter:"Composio",icon:"",color:"#00e5ff",content:o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[o.jsxs("p",{style:{...Ra,fontSize:8,color:"rgba(255,255,255,0.40)"},children:["O ",o.jsx(si,{c:"#00e5ff",children:"Studio Sequencer"})," (painel inferior )  um step sequencer determinstico  diferente das partculas, ele toca ",o.jsx("span",{style:{color:"rgba(255,255,255,0.45)"},children:"exatamente nos beats que voc armar"}),"."]}),o.jsxs("div",{style:Ss,children:[o.jsx("div",{style:{...Wa,color:"rgba(0,229,255,0.35)"},children:"Workflow"}),o.jsx(Ch,{color:"#00e5ff",items:["Clique em STUDIO SEQ na barra inferior para expandir.",'Use Padres  para carregar um pattern pronto (ex: "4 on 4").',"Clique nas clulas do grid para ativar/desativar beats.","Use M (mute) e S (solo) para controlar quais roles tocam.","Ajuste o BPM no painel superior para o tempo global."]})]}),o.jsxs("div",{style:Ss,children:[o.jsx("div",{style:{...Wa,color:"rgba(0,229,255,0.35)"},children:"Receita: Beat Techno bsico"}),o.jsxs("p",{style:Ra,children:[o.jsx("span",{style:{color:"rgba(255,255,255,0.45)"},children:"KICK no beat 1, 5, 9, 13"}),"  ",o.jsx("span",{style:{color:"rgba(255,255,255,0.45)"},children:"PERC (hi-hat) em todos os beats"}),"  ",o.jsx("span",{style:{color:"rgba(255,255,255,0.45)"},children:"BASS no 1 e 9"}),"  ",o.jsx("span",{style:{color:"rgba(255,255,255,0.45)"},children:"ARP nos off-beats (2, 4, 6...)"}),"."]})]})]})},{title:"Quantum Sequencer",chapter:"Indeterminao",icon:"",color:"#cc44ff",content:o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[o.jsxs("p",{style:{...Ra,fontSize:8,color:"rgba(255,255,255,0.40)"},children:["O ",o.jsx(si,{c:"#cc44ff",children:"Quantum Sequencer"}),"  um anel giratrio no canvas. Diferente do Studio Seq,  ",o.jsx("span",{style:{color:"rgba(255,255,255,0.45)"},children:"probabilstico"}),"  dispara notas das partculas mais prximas."]}),o.jsxs("div",{style:Ss,children:[o.jsx("div",{style:{...Wa,color:"rgba(204,68,255,0.35)"},children:"Como funciona"}),o.jsx(Ch,{color:"#cc44ff",items:["Ative o Quantum Sequencer no painel (aba Q.Seq).","Um anel aparece no canvas com steps armveis.","O cursor gira na velocidade do BPM.","Quando passa num step armado, dispara a nota da partcula mais prxima.","Se no h partcula perto, aquele step fica em silncio."]})]}),o.jsx("p",{style:ad,children:"Dica: Use o Studio Seq para KICK/BASS/PERC (ritmo fixo) e o Q.Seq para LEAD/ARP (melodias emergentes)."})]})},{title:"Presets & Vibes",chapter:"Explorao",icon:"",color:"#ffd700",content:o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[o.jsxs("p",{style:{...Ra,fontSize:8,color:"rgba(255,255,255,0.40)"},children:["Presets so ",o.jsx(si,{c:"#ffd700",children:"pontos de partida"}),"  combinaes prontas de escala, timbres, quantidade de partculas, physics e visual. Cada um tem uma vibe diferente."]}),o.jsxs("div",{style:Ss,children:[o.jsx("div",{style:{...Wa,color:"rgba(255,215,0,0.35)"},children:"Como usar presets"}),o.jsx(Ch,{color:"#ffd700",items:["Abra o painel lateral direito e escolha um preset da lista.","O preset troca escala, BPM, timbres, physics, visual  tudo de uma vez.","Modifique os parmetros livremente: o preset  apenas um starting point.","Use o boto  na toolbar para carregar um preset aleatrio."]})]}),o.jsx("p",{style:ad,children:"Presets vo de Ambient/Drone at Techno/Rave. Cada um tem tags que indicam o gnero e a energia."})]})},{title:"FX Zones",chapter:"Espao Interativo",icon:"",color:"#ff44cc",content:o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[o.jsxs("p",{style:{...Ra,fontSize:8,color:"rgba(255,255,255,0.40)"},children:[o.jsx(si,{c:"#ff44cc",children:"FX Zones"})," so polgonos pintados no canvas com efeitos especiais. Partculas que entram na zona so afetadas."]}),o.jsx("div",{style:{...Wa,color:"rgba(255,68,204,0.35)",marginTop:4},children:"Efeitos disponveis"}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:3},children:[["Slow","Reduz velocidade"],["Fast","Acelera"],["Mute","Silencia notas"],["Excite","Aumenta carga"],["Pitch ","Sobe o pitch"],["Pitch ","Desce o pitch"],["Reverse","Inverte direo"],["Freeze","Congela"],["Vortex","Redemoinho"],["Glitch","Glitch aleatrio"],["Tremolo","Pulso de volume"],["Phase Lock","Sincroniza fase"]].map(([e,t])=>o.jsxs("div",{style:{...Ss,padding:"4px 6px"},children:[o.jsx("div",{style:{fontFamily:ol,fontSize:6,color:"rgba(255,255,255,0.50)"},children:e}),o.jsx("div",{style:{...ad,fontSize:5},children:t})]},e))}),o.jsxs("p",{style:ad,children:["Tecla ",o.jsx(fp,{children:"9"})," + clique para desenhar o polgono. Feche com duplo-clique."]})]})},{title:"Capa da Composio",chapter:"Meta-Gen-Art",icon:"",color:"#ff6b6b",content:o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[o.jsxs("p",{style:{...Ra,fontSize:8,color:"rgba(255,255,255,0.40)"},children:["Toda composio merece uma ",o.jsx(si,{c:"#ff6b6b",children:"capa visual"}),". O Music Lab pode exportar seus parmetros para o ",o.jsx(si,{c:"#ff6b6b",children:"Meta-Gen-Art"}),", que gera uma arte generativa baseada na essncia da sua msica."]}),o.jsxs("div",{style:Ss,children:[o.jsx("div",{style:{...Wa,color:"rgba(255,107,107,0.35)"},children:"Como funciona"}),o.jsx(Ch,{color:"#ff6b6b",items:["Monte sua composio no Music Lab (preset, partculas, physics, etc.).",'Clique no boto "Capa" () na toolbar superior.',"Abra o Meta-Gen-Art e clique no boto de importar do MusicLab.","A arte ser gerada com paleta, estrutura e energia da sua msica."]})]}),o.jsxs("div",{style:Ss,children:[o.jsx("div",{style:{...Wa,color:"rgba(255,107,107,0.35)"},children:"O que  transferido"}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:3},children:[["Paleta de cores","Primary, accent, role colors"],["Estrutura","Gates, rails, cages  geometria"],["Energia","BPM, turbulence  ritmo visual"],["Atmosfera","Reverb, delay  profundidade"],["Densidade","N de partculas  qtd. shapes"],["Inteno","Tags do preset  mood da arte"]].map(([e,t])=>o.jsxs("div",{style:{...Ss,padding:"4px 6px"},children:[o.jsx("div",{style:{fontFamily:ol,fontSize:6,color:"rgba(255,255,255,0.50)"},children:e}),o.jsx("div",{style:{...ad,fontSize:5},children:t})]},e))})]})]})},{title:"Modo 3D",chapter:"Visualizao",icon:"",color:"#00aaff",content:o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[o.jsxs("p",{style:{...Ra,fontSize:8,color:"rgba(255,255,255,0.40)"},children:["O boto ",o.jsx(fp,{children:"3D"})," na toolbar ativa a ",o.jsx(si,{c:"#00aaff",children:"visualizao tridimensional"}),". O som ",o.jsx("span",{style:{color:"rgba(255,255,255,0.50)"},children:"no muda"}),"   puramente visual."]}),o.jsxs("div",{style:Ss,children:[o.jsx("div",{style:{...Wa,color:"rgba(0,170,255,0.35)"},children:"Modos de cmera"}),o.jsx(Jd,{items:[["Orbital","Gira em volta do centro automaticamente."],["Top","Vista de cima  como o 2D, mas com profundidade."],["Side","Vista lateral  pitch como altura."],["FPP","Primeira pessoa  dentro do enxame."]]})]}),o.jsx("p",{style:ad,children:"Arraste para orbitar. Scroll para zoom. Charge da partcula controla a altura Y."})]})},{title:"Compose Mode",chapter:"Performance",icon:"",color:"#fbbf24",content:o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[o.jsxs("p",{style:{...Ra,fontSize:8,color:"rgba(255,255,255,0.40)"},children:["O ",o.jsx(si,{c:"#fbbf24",children:"Compose Mode"})," pausa as partculas para voc posicionar tudo com preciso, e depois ",o.jsx("span",{style:{color:"rgba(255,255,255,0.50)"},children:"solta (Release)"})," para ouvir o resultado."]}),o.jsxs("div",{style:Ss,children:[o.jsx("div",{style:{...Wa,color:"rgba(251,191,36,0.35)"},children:"Workflow"}),o.jsx(Ch,{color:"#fbbf24",items:["Ative Compose na toolbar  simulao pausa.","Posicione partculas, gates, attractors, zones com calma.","Ajuste velocity arrastando partculas (direo do arraste = velocidade inicial).","Clique Release   tudo comea a se mover e produzir som.","Use Restore para voltar ao estado anterior ao Release."]})]})]})},{title:"Atalhos de Teclado",chapter:"Referncia",icon:"",color:Mh,content:o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[o.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"4px 16px"},children:[["Q","Select"],["W","Spawn"],["E","Gate Line"],["A","Attractor"],["T","Repulsor"],["Y","Vortex"],["U","Excite"],["I","Freeze"],["O","Mutate"],["P","Erase"],["1","Q.Channel"],["2","Gravity Rail"],["3","Q.Tunnel"],["4","Mirror"],["5","Absorber"],["6","Membrane"],["7","Cage"],["8","H.String"],["9","FX Zone"],["0","Metro"],["Space","Play / Pause"],["Del","Deletar selecionado"],["V","Overlays on/off"],["C","Cinematic mode"]].map(([e,t])=>o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[o.jsx("span",{style:{...z5,minWidth:24,textAlign:"center",flexShrink:0},children:e}),o.jsx("span",{style:Ra,children:t})]},e))}),o.jsxs("div",{style:{...Ss,marginTop:6},children:[o.jsx("div",{style:{...Wa,color:`${Mh}44`},children:"Gamepad"}),o.jsx("p",{style:Ra,children:"Conecte um controle para joystick spawn, trigger gates e haptics sincronizados ao BPM."})]})]})}],YV=[...new Set(Vh.map(e=>e.chapter))],KV=({onClose:e})=>{const[t,n]=S.useState(0),r=Vh[t];return YV.indexOf(r.chapter),o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center",style:{background:"rgba(0,0,0,0.88)"},onClick:e,children:o.jsxs("div",{style:{width:600,maxWidth:"96vw",maxHeight:"92vh",background:"rgba(0,0,0,0.97)",border:"1px dashed rgba(255,255,255,0.06)",overflow:"hidden",display:"flex",flexDirection:"column"},onClick:a=>a.stopPropagation(),children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"14px 20px",borderBottom:"1px dashed rgba(255,255,255,0.05)",flexShrink:0},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:14},children:[o.jsx("span",{style:{fontSize:16,color:r.color+"66",filter:`drop-shadow(0 0 8px ${r.color}22)`},children:r.icon}),o.jsxs("div",{children:[o.jsxs("div",{style:{fontFamily:ol,fontSize:6,letterSpacing:"0.12em",textTransform:"uppercase",color:"rgba(255,255,255,0.15)",marginBottom:2},children:["Jornada  ",r.chapter,"  ",t+1,"/",Vh.length]}),o.jsx("div",{style:{fontFamily:ow,fontSize:12,color:r.color+"cc",letterSpacing:"0.04em"},children:r.title})]})]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx("button",{title:"Fechar guia",onClick:e,className:"transition-opacity hover:opacity-70",style:{fontFamily:ol,fontSize:7,letterSpacing:"0.12em",textTransform:"uppercase",color:"rgba(255,255,255,0.20)",padding:"4px 8px",border:"1px dashed rgba(255,255,255,0.06)"},children:"Pular"}),o.jsx("button",{title:"Fechar",onClick:e,style:{color:"rgba(255,255,255,0.15)"},className:"hover:opacity-70 transition-opacity",children:o.jsx(Cs,{size:13})})]})]}),o.jsx("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"10px 20px 0",flexShrink:0},children:Vh.map((a,i)=>{const s=i===0||Vh[i-1].chapter!==a.chapter;return o.jsxs(on.Fragment,{children:[s&&i>0&&o.jsx("div",{style:{width:1,height:10,background:"rgba(255,255,255,0.04)",margin:"0 2px"}}),o.jsx("button",{onClick:()=>n(i),className:"transition-all",title:a.title,style:{width:i===t?20:5,height:3,background:i===t?r.color+"88":i<t?r.color+"25":"rgba(255,255,255,0.05)",flexShrink:0}})]},i)})}),o.jsx("div",{style:{padding:"16px 20px 12px",overflowY:"auto",flex:1,minHeight:0},children:r.content}),o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"12px 20px",borderTop:"1px dashed rgba(255,255,255,0.04)",flexShrink:0},children:[o.jsxs("button",{title:"Pgina anterior",onClick:()=>n(a=>Math.max(0,a-1)),disabled:t===0,className:"flex items-center gap-1 transition-all disabled:opacity-0",style:{fontFamily:ol,fontSize:8,letterSpacing:"0.10em",textTransform:"uppercase",color:r.color+"66"},children:[o.jsx(ym,{size:10})," Anterior"]}),o.jsx("div",{style:{fontFamily:ol,fontSize:6,color:"rgba(255,255,255,0.12)",letterSpacing:"0.06em"},children:r.chapter}),t<Vh.length-1?o.jsxs("button",{title:"Prxima pgina",onClick:()=>n(a=>a+1),className:"flex items-center gap-1 transition-all",style:{fontFamily:ol,fontSize:8,letterSpacing:"0.10em",textTransform:"uppercase",padding:"4px 14px",color:r.color,background:r.color+"08",border:`1px dashed ${r.color}25`},children:["Prximo ",o.jsx(hs,{size:10})]}):o.jsx("button",{title:"Concluir guia",onClick:e,className:"flex items-center gap-1 transition-all",style:{fontFamily:ol,fontSize:8,letterSpacing:"0.10em",textTransform:"uppercase",padding:"4px 14px",color:r.color,background:r.color+"08",border:`1px dashed ${r.color}25`},children:"Comear "})]})]})})},Bb="'IBM Plex Mono', monospace",XV="#37b2da",Xc=110,kh=18,X0=28,lC=({open:e,items:t,position:n,activeId:r,onSelect:a,onClose:i})=>{var x,v,b,w;const[s,c]=S.useState(null),l=S.useRef(null),d=S.useCallback(M=>{var L;const k=M.clientX-n.x,R=M.clientY-n.y;if(Math.sqrt(k*k+R*R)<X0){c(null);return}let I=Math.atan2(R,k);I<0&&(I+=Math.PI*2);const E=Math.PI*2/t.length,O=Math.round(I/E)%t.length;c(((L=t[O])==null?void 0:L.id)??null)},[t,n]),u=S.useCallback(()=>{s?a(s):i()},[s,a,i]);if(S.useEffect(()=>{if(!e)return;const M=k=>{k.key==="Escape"&&(i(),k.preventDefault())};return window.addEventListener("keydown",M),()=>window.removeEventListener("keydown",M)},[e,i]),S.useEffect(()=>{e||c(null)},[e]),!e||t.length===0)return null;const h=Math.max(Xc+20,Math.min(window.innerWidth-Xc-20,n.x)),m=Math.max(Xc+20,Math.min(window.innerHeight-Xc-20,n.y)),f=Math.PI*2/t.length;let g;return o.jsxs("div",{ref:l,className:"fixed inset-0 z-[200]",style:{cursor:"default"},onMouseMove:d,onMouseUp:u,onClick:i,children:[o.jsx("div",{className:"absolute inset-0",style:{background:"rgba(2,3,8,0.72)"}}),o.jsxs("svg",{style:{position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none"},children:[t.map((M,k)=>{const R=M.group!==void 0&&M.group!==g;if(g=M.group,!R)return null;const j=k*f-f/2,I=h+Math.cos(j)*(X0+6),E=m+Math.sin(j)*(X0+6),O=h+Math.cos(j)*(Xc+kh+4),L=m+Math.sin(j)*(Xc+kh+4);return o.jsx("line",{x1:I,y1:E,x2:O,y2:L,stroke:"rgba(255,255,255,0.06)",strokeWidth:1,strokeDasharray:"3 3"},`div-${k}`)}),o.jsx("circle",{cx:h,cy:m,r:Xc,fill:"none",stroke:"rgba(255,255,255,0.04)",strokeWidth:1})]}),o.jsx("div",{style:{position:"absolute",left:h-X0,top:m-X0,width:X0*2,height:X0*2,background:"rgba(0,0,0,0.92)",border:"1px dashed rgba(255,255,255,0.08)",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",pointerEvents:"none"},children:s?o.jsxs(o.Fragment,{children:[o.jsx("div",{style:{fontFamily:Bb,fontSize:7,letterSpacing:"0.10em",textTransform:"uppercase",color:((x=t.find(M=>M.id===s))==null?void 0:x.color)??XV,textAlign:"center",lineHeight:1.3},children:(v=t.find(M=>M.id===s))==null?void 0:v.label}),((b=t.find(M=>M.id===s))==null?void 0:b.key)&&o.jsxs("div",{style:{fontFamily:Bb,fontSize:6,color:"rgba(255,255,255,0.25)",marginTop:2},children:["[",(w=t.find(M=>M.id===s))==null?void 0:w.key,"]"]})]}):o.jsx("div",{style:{fontFamily:Bb,fontSize:6,color:"rgba(255,255,255,0.18)",textTransform:"uppercase",letterSpacing:"0.12em"},children:"Select"})}),t.map((M,k)=>{const R=k*f-Math.PI/2,j=h+Math.cos(R)*Xc-kh,I=m+Math.sin(R)*Xc-kh,E=s===M.id,O=r===M.id,L=E?1.25:1;return o.jsx("div",{style:{position:"absolute",left:j,top:I,width:kh*2,height:kh*2,display:"flex",alignItems:"center",justifyContent:"center",background:E?`${M.color}18`:O?`${M.color}0c`:"rgba(0,0,0,0.85)",border:E?`1px solid ${M.color}55`:O?`1px dashed ${M.color}35`:"1px dashed rgba(255,255,255,0.06)",color:E?M.color:O?`${M.color}cc`:"rgba(255,255,255,0.35)",transform:`scale(${L})`,transition:"all 0.1s ease-out",pointerEvents:"none",boxShadow:E?`0 0 16px ${M.color}25`:"none"},children:o.jsx("div",{style:{fontSize:13,lineHeight:1},children:M.icon})},M.id)})]})},JV="'IBM Plex Mono', monospace";function QV(e){try{const t=localStorage.getItem(`dp_${e}`);if(!t)return null;const n=JSON.parse(t);if(typeof n.x=="number"&&typeof n.y=="number")return n}catch{}return null}function ZV(e,t,n){try{localStorage.setItem(`dp_${e}`,JSON.stringify({x:t,y:n}))}catch{}}const nf=({id:e,title:t,titleColor:n,defaultX:r,defaultY:a,zIndex:i=30,defaultMinimized:s=!1,headerExtra:c,width:l,maxHeight:d,children:u,onClose:h,anchorRight:m,anchorBottom:f,persist:g=!0,className:x})=>{const v=g?QV(e):null,[b,w]=S.useState({x:(v==null?void 0:v.x)??r,y:(v==null?void 0:v.y)??a}),[M,k]=S.useState(s),R=S.useRef(!1),j=S.useRef({dx:0,dy:0}),I=S.useRef(null),E=S.useCallback(F=>{F.target.closest("button, input, select")||(F.preventDefault(),F.stopPropagation(),R.current=!0,j.current={dx:F.clientX-b.x,dy:F.clientY-b.y},F.target.setPointerCapture(F.pointerId))},[b]),O=S.useCallback(F=>{if(!R.current)return;const B=F.clientX-j.current.dx,W=F.clientY-j.current.dy;w({x:B,y:W})},[]),L=S.useCallback(F=>{if(!R.current)return;R.current=!1,F.target.releasePointerCapture(F.pointerId);const B=F.clientX-j.current.dx,W=F.clientY-j.current.dy;w({x:B,y:W}),g&&ZV(e,B,W)},[e,g]);S.useEffect(()=>{const F=()=>{w(B=>({x:Math.min(B.x,window.innerWidth-40),y:Math.min(B.y,window.innerHeight-24)}))};return window.addEventListener("resize",F),()=>window.removeEventListener("resize",F)},[]);const $={position:"fixed",zIndex:i,fontFamily:JV,background:"rgba(0,0,0,0.94)",border:"1px dashed rgba(255,255,255,0.06)",pointerEvents:"auto",...l!=null?{width:l}:{},...m?{right:b.x,top:b.y}:f?{left:b.x,bottom:b.y}:{left:b.x,top:b.y}};return o.jsxs("div",{ref:I,style:$,className:x,children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,padding:"3px 6px",borderBottom:M?"none":"1px dashed rgba(255,255,255,0.04)",cursor:"grab",userSelect:"none",minHeight:20},onPointerDown:E,onPointerMove:O,onPointerUp:L,children:[o.jsx("span",{style:{fontSize:7,color:"rgba(255,255,255,0.12)",letterSpacing:1,marginRight:2},children:""}),o.jsx("span",{style:{fontSize:7,letterSpacing:"0.12em",textTransform:"uppercase",color:n??"rgba(55,178,218,0.55)",flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t}),c,o.jsx("button",{onClick:()=>k(F=>!F),style:{background:"none",border:"none",padding:"0 2px",color:"rgba(255,255,255,0.20)",fontSize:9,cursor:"pointer",lineHeight:1},title:M?"Expand":"Minimize",children:M?"":""}),h&&o.jsx("button",{onClick:h,style:{background:"none",border:"none",padding:"0 2px",color:"rgba(255,255,255,0.15)",fontSize:9,cursor:"pointer",lineHeight:1},title:"Close",children:""})]}),!M&&o.jsx("div",{style:{overflowY:d?"auto":void 0,maxHeight:d??void 0,scrollbarWidth:"thin",scrollbarColor:"rgba(55,178,218,.08) transparent"},children:u})]})},eU="'Doto', monospace",t5="'IBM Plex Mono', monospace",Rh="#37b2da",tU=()=>{const[e,t]=S.useState(!1),[n,r]=S.useState(!1);S.useEffect(()=>{if(!localStorage.getItem("musiclab_patch_01.3_seen")){const s=setTimeout(()=>t(!0),2e3);return()=>clearTimeout(s)}},[]);const a=()=>{t(!1),r(!0),localStorage.setItem("musiclab_patch_01.3_seen","true")};return!e||n?null:o.jsxs("div",{className:"fixed top-20 right-4 z-40 max-w-sm",style:{background:"rgba(0,0,0,0.96)",border:"1px dashed rgba(255,255,255,0.06)",padding:16,animation:"slideIn 0.5s ease-out"},children:[o.jsx("button",{title:"Dispensar",onClick:a,className:"absolute top-2 right-2 transition-colors",style:{color:"rgba(255,255,255,0.20)"},children:o.jsx(Cs,{size:13})}),o.jsxs("div",{className:"inline-flex items-center gap-1.5 px-2 py-0.5 mb-3",style:{background:`${Rh}08`,border:`1px dashed ${Rh}25`},children:[o.jsx("div",{className:"w-1.5 h-1.5 animate-pulse",style:{background:Rh}}),o.jsx("span",{style:{fontFamily:t5,fontSize:8,letterSpacing:"0.14em",textTransform:"uppercase",color:`${Rh}cc`},children:"Patch 01.3"})]}),o.jsx("h3",{style:{fontFamily:eU,fontSize:12,letterSpacing:"0.06em",textTransform:"uppercase",color:"rgba(255,255,255,0.65)",marginBottom:8},children:"Evolution & 3D Vision"}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8,marginBottom:12},children:[["","3D Visualization","Toggle  3D to explore particles in three dimensions"],["","20 New Presets","Organic instruments, experimental FX, physics showcase"],["","Pro Templates","Guitar, sax, cello, sitar, quantum tunneling & more"]].map(([i,s,c])=>o.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:[o.jsx("span",{style:{color:`${Rh}88`,fontSize:10,flexShrink:0},children:i}),o.jsxs("p",{style:{fontFamily:t5,fontSize:8,color:"rgba(255,255,255,0.45)",lineHeight:1.6},children:[o.jsx("strong",{style:{color:"rgba(255,255,255,0.65)"},children:s}),"  ",c]})]},s))}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,fontFamily:t5,fontSize:8},children:[["Total Presets","60"],["Camera Modes","4"]].map(([i,s])=>o.jsxs("div",{style:{background:"rgba(255,255,255,0.02)",border:"1px dashed rgba(255,255,255,0.04)",padding:"6px 8px"},children:[o.jsx("div",{style:{color:"rgba(255,255,255,0.25)",marginBottom:2},children:i}),o.jsx("div",{style:{color:Rh},children:s})]},i))}),o.jsx("div",{style:{marginTop:12,paddingTop:10,borderTop:"1px dashed rgba(255,255,255,0.04)",fontFamily:t5,fontSize:7,color:"rgba(255,255,255,0.18)",textAlign:"center",letterSpacing:"0.08em"},children:"Explore new sonic territories"})]})},$b="musicLab";function nU({preset:e,physics:t,onLoadComposition:n}){const{user:r}=vm(),a=(r==null?void 0:r.id)??null,[i,s]=S.useState([]),[c,l]=S.useState(!1),[d,u]=S.useState(""),h=async()=>{l(!0);try{const g=await fS($b,a);s(Array.isArray(g.saves)?g.saves:[])}finally{l(!1)}};S.useEffect(()=>{h()},[a]);const m=g=>new Date(g).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),f={section:{marginBottom:12,padding:8,background:"rgba(255,255,255,0.03)",borderRadius:6,border:"1px solid rgba(255,255,255,0.06)"},label:{fontSize:9,color:"rgba(255,255,255,0.5)",letterSpacing:"0.08em",textTransform:"uppercase",marginBottom:6},row:{display:"flex",alignItems:"center",gap:6,padding:"4px 0",borderBottom:"1px solid rgba(255,255,255,0.04)"},input:{flex:1,background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:4,padding:"4px 8px",color:"#fff",fontSize:10},btn:{background:"none",border:"none",cursor:"pointer",padding:4,color:"rgba(255,255,255,0.5)"},btnPrimary:{background:"rgba(0,212,255,0.15)",border:"1px solid rgba(0,212,255,0.35)",borderRadius:4,padding:"4px 8px",color:"#7dd3fc",fontSize:9,cursor:"pointer",display:"flex",alignItems:"center",gap:4}};return o.jsxs("div",{style:{padding:8,fontFamily:"'IBM Plex Mono', monospace"},children:[o.jsxs("div",{style:{...f.section,marginBottom:10},children:[o.jsxs("div",{style:{...f.label,display:"flex",alignItems:"center",gap:4},children:[a?o.jsx(rS,{size:9,color:"#60a5fa"}):null,"Minhas composies ",a?"(conta)":"(local)"]}),o.jsx("div",{style:f.row,children:o.jsx("input",{type:"text",placeholder:"Nome da composio",value:d,onChange:g=>u(g.target.value),style:f.input})}),o.jsxs("button",{type:"button",onClick:()=>{const g=d.trim()||e.name||"Composio",x={id:`comp_${Date.now()}_${Math.random().toString(36).slice(2,7)}`,name:g,timestamp:Date.now(),preset:{...e},physics:{...t}};Z5($b,"saves",x,a),s(v=>[...v,x]),u("")},style:f.btnPrimary,children:[o.jsx(Jp,{size:10})," Salvar composio"]})]}),o.jsxs("div",{style:f.section,children:[o.jsx("div",{style:f.label,children:"Composies salvas"}),c&&o.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.4)"},children:"Carregando..."}),o.jsxs("div",{style:{maxHeight:180,overflowY:"auto"},children:[i.length===0&&!c&&o.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.3)"},children:"Nenhuma."}),i.map(g=>o.jsxs("div",{style:f.row,children:[o.jsxs("div",{style:{flex:1,minWidth:0},children:[o.jsx("div",{style:{fontSize:10,color:"rgba(255,255,255,0.9)",overflow:"hidden",textOverflow:"ellipsis"},children:g.name}),o.jsxs("div",{style:{fontSize:8,color:"rgba(255,255,255,0.35)"},children:[o.jsx(Bu,{size:8})," ",m(g.timestamp)]})]}),o.jsx("button",{title:"Carregar",onClick:()=>n(g.preset,g.physics),style:f.btn,children:o.jsx(Tu,{size:12,className:"text-green-400"})}),o.jsx("button",{title:"Excluir",onClick:()=>{ey($b,"saves",g.id,a),s(x=>x.filter(v=>v.id!==g.id))},style:f.btn,children:o.jsx(il,{size:12,className:"text-red-400"})})]},g.id))]})]})]})}const n6=({zoom:e,onZoomIn:t,onZoomOut:n,onReset:r,className:a="",accentColor:i="rgba(255,255,255,0.45)"})=>{const s=Math.round(e*100);return o.jsxs("div",{className:`flex items-center gap-0.5 rounded-lg border px-1.5 py-0.5 backdrop-blur-sm select-none ${a}`,style:{background:"rgba(4,6,14,0.75)",borderColor:"rgba(255,255,255,0.07)"},title:"Scroll para zoom  Boto do meio para mover",children:[o.jsx("button",{onClick:n,className:"w-5 h-5 flex items-center justify-center rounded hover:bg-white/8 transition-colors",style:{color:"rgba(255,255,255,0.38)",fontSize:14,fontFamily:"monospace",lineHeight:1},title:"Zoom out  []",children:""}),o.jsxs("button",{onClick:r,className:"px-1 text-center rounded hover:bg-white/5 transition-colors",style:{color:e===1?"rgba(255,255,255,0.22)":i,fontSize:6.5,fontFamily:"monospace",minWidth:34,letterSpacing:"0.04em"},title:"Resetar zoom [clique]",children:[s,"%"]}),o.jsx("button",{onClick:t,className:"w-5 h-5 flex items-center justify-center rounded hover:bg-white/8 transition-colors",style:{color:"rgba(255,255,255,0.38)",fontSize:14,fontFamily:"monospace",lineHeight:1},title:"Zoom in  [+]",children:"+"}),o.jsx("span",{className:"ml-0.5 hidden sm:block",style:{color:"rgba(255,255,255,0.10)",fontSize:5.5,fontFamily:"monospace"},children:"scroll"})]})};function r6(e){const[r,a]=S.useState(1),[i,s]=S.useState(0),[c,l]=S.useState(0),d=S.useRef(1),u=S.useRef(0),h=S.useRef(0),m=S.useRef(!1),f=S.useRef({cx:0,cy:0,px:0,py:0}),g=S.useCallback((j,I,E)=>{d.current=j,u.current=I,h.current=E,a(j),s(I),l(E)},[]),x=S.useCallback((j,I)=>{j.preventDefault();const E=I.getBoundingClientRect(),O=j.clientX-E.left,L=j.clientY-E.top,$=E.width,F=E.height,B=j.deltaY<0?1.12:1/1.12,W=Math.max(.15,Math.min(10,d.current*B)),re=O-$/2-(O-$/2-u.current)*W/d.current,oe=L-F/2-(L-F/2-h.current)*W/d.current;g(W,re,oe)},[.15,10,g]),v=S.useCallback(j=>{const I=j.button===1,E=j.button===0&&j.altKey;return!I&&!E?!1:(j.preventDefault(),m.current=!0,f.current={cx:j.clientX,cy:j.clientY,px:u.current,py:h.current},!0)},[]),b=S.useCallback(j=>{if(!m.current)return!1;const I=f.current.px+(j.clientX-f.current.cx),E=f.current.py+(j.clientY-f.current.cy);return u.current=I,h.current=E,s(I),l(E),!0},[]),w=S.useCallback(j=>{j&&j.button===1?m.current=!1:j?j.button===0&&(m.current=!1):m.current=!1},[]),M=S.useCallback(()=>g(1,0,0),[g]),k=S.useCallback(()=>{const j=Math.min(10,d.current*1.25);g(j,u.current,h.current)},[10,g]),R=S.useCallback(()=>{const j=Math.max(.15,d.current/1.25);g(j,u.current,h.current)},[.15,g]);return{zoom:r,panX:i,panY:c,zoomRef:d,panXRef:u,panYRef:h,isPanning:m,handleWheel:x,handlePanStart:v,handlePanMove:b,handlePanEnd:w,resetView:M,zoomIn:k,zoomOut:R}}function rU(e,t,n,r,a,i){const s=e-n.left,c=t-n.top,l=n.width,d=n.height;return[(s-l/2-a)/(r*l/2),(c-d/2-i)/(r*d/2)]}function oU(e,t,n,r,a,i){const s=e-n.left,c=t-n.top,l=n.width,d=n.height;return[(s-l/2-a)/(r*l)+.5,(c-d/2-i)/(r*d)+.5]}const aU=S.lazy(()=>Ec(()=>import("./music3DRenderer-CCQwiosw.js"),__vite__mapDeps([0,1]))),pp={Techno:"#ff3b5c",Club:"#cc2255",Ambient:"#44ffcc",Eno:"#88ffdd",Classical:"#ffd700",Baroque:"#cc9900",Minimalist:"#aaffaa",Jazz:"#ff9944",Swing:"#ffaa33",Experimental:"#cc44ff",Electronic:"#00d4ff",Generative:"#66ffaa",Meditative:"#aaccff",Drone:"#9966ff",Space:"#88aaff",Romantic:"#ff8899",Reich:"#ccffaa",Glitch:"#ff00ff",Cage:"#aaaaaa","Free Jazz":"#ff6633",Groove:"#ffcc44",Dark:"#cc3366",Soft:"#88ffcc",Rave:"#ff4400",Improvisation:"#ff9966",Breakbeat:"#ff2200",Strings:"#ffdd66",Modal:"#aaffbb",Aquatic:"#00ccff",Arpeggios:"#ccffff",Minimalism:"#ccffcc",Dynamic:"#ff8866",Phasing:"#aaffcc",Choral:"#ffaabb",Orchestral:"#ffcc77"},J0=[{id:"select",icon:o.jsx(_P,{size:13}),label:"Select",key:"Q",color:"#aaaaff"},{id:"spawn",icon:o.jsx(Iy,{size:13}),label:"Spawn",key:"W",color:"#aaffaa"},{id:"gate",icon:o.jsx(PP,{size:13}),label:"Gate Line",key:"E",color:"#ffffff"},{id:"attractor",icon:o.jsx(Qp,{size:13}),label:"Attractor",key:"A",color:"#00aaff"},{id:"repulsor",icon:o.jsx(NF,{size:13}),label:"Repulsor",key:"T",color:"#ff4400"},{id:"vortex",icon:o.jsx(wf,{size:13}),label:"Vortex",key:"Y",color:"#cc44ff"},{id:"excite",icon:o.jsx(zi,{size:13}),label:"Excite",key:"U",color:"#ff8800"},{id:"freeze",icon:o.jsx(cF,{size:13}),label:"Freeze",key:"I",color:"#88ddff"},{id:"mutate",icon:o.jsx(aF,{size:13}),label:"Mutate",key:"O",color:"#ff88ff"},{id:"erase",icon:o.jsx(M5,{size:13}),label:"Erase",key:"P",color:"#ff4466"},{id:"channel",icon:o.jsx("span",{style:{fontSize:11},children:""}),label:"Q.Channel",key:"1",color:"#c0c8d0"},{id:"rail",icon:o.jsx("span",{style:{fontSize:11},children:""}),label:"G.Rail",key:"2",color:"#c8960a"},{id:"tunnel",icon:o.jsx("span",{style:{fontSize:11},children:""}),label:"Q.Tunnel",key:"3",color:"#cc66ff"},{id:"mirror",icon:o.jsx("span",{style:{fontSize:11},children:""}),label:"Mirror",key:"4",color:"#c0e8ff"},{id:"absorber",icon:o.jsx("span",{style:{fontSize:11},children:""}),label:"Absorber",key:"5",color:"#dd3333"},{id:"membrane",icon:o.jsx("span",{style:{fontSize:11},children:""}),label:"Membrane",key:"6",color:"#cc44ff"},{id:"cage",icon:o.jsx("span",{style:{fontSize:11},children:""}),label:"Cage",key:"7",color:"#00ffcc"},{id:"string",icon:o.jsx("span",{style:{fontSize:11},children:""}),label:"H.String",key:"8",color:"#ffd700"},{id:"zone",icon:o.jsx("span",{style:{fontSize:11},children:""}),label:"FX Zone",key:"9",color:"#ff44cc"},{id:"metro",icon:o.jsx("span",{style:{fontSize:11},children:""}),label:"Metro",key:"0",color:"#ffcc00"}],Ah=["KICK","BASS","PERC","PAD","LEAD","ARP","STRINGS","CHOIR"],sU=[{id:"select",icon:"",label:"Select",color:"#aaaaff",group:"essential",key:"Q"},{id:"spawn",icon:"+",label:"Spawn",color:"#aaffaa",group:"essential",key:"W"},{id:"gate",icon:"",label:"Gate",color:"#ffffff",group:"essential",key:"E"},{id:"erase",icon:"",label:"Erase",color:"#ff4466",group:"essential",key:"P"},{id:"attractor",icon:"",label:"Attractor",color:"#00aaff",group:"forces",key:"A"},{id:"repulsor",icon:"",label:"Repulsor",color:"#ff4400",group:"forces",key:"T"},{id:"vortex",icon:"",label:"Vortex",color:"#cc44ff",group:"forces",key:"Y"},{id:"excite",icon:"",label:"Excite",color:"#ff8800",group:"forces",key:"U"},{id:"freeze",icon:"",label:"Freeze",color:"#88ddff",group:"forces",key:"I"},{id:"mutate",icon:"",label:"Mutate",color:"#ff88ff",group:"forces",key:"O"},{id:"channel",icon:"",label:"Channel",color:"#c0c8d0",group:"quantum",key:"1"},{id:"rail",icon:"",label:"Rail",color:"#c8960a",group:"quantum",key:"2"},{id:"tunnel",icon:"",label:"Tunnel",color:"#cc66ff",group:"quantum",key:"3"},{id:"cage",icon:"",label:"Cage",color:"#00ffcc",group:"instruments",key:"7"},{id:"string",icon:"",label:"String",color:"#ffd700",group:"instruments",key:"8"},{id:"zone",icon:"",label:"FX Zone",color:"#ff44cc",group:"instruments",key:"9"},{id:"metro",icon:"",label:"Metro",color:"#ffcc00",group:"instruments",key:"0"}],iU=[{id:"exciteAll",icon:"",label:"Excite All",color:"#ff8800",group:"power"},{id:"freezeAll",icon:"",label:"Freeze All",color:"#88ddff",group:"power"},{id:"explode",icon:"",label:"Explode",color:"#ff4444",group:"power"},{id:"compress",icon:"",label:"Compress",color:"#aa88ff",group:"power"},{id:"scatter",icon:"",label:"Scatter",color:"#aaffaa",group:"power"},{id:"harmonize",icon:"",label:"Harmonize",color:"#ffd700",group:"power"},{id:"reseed",icon:"",label:"Reseed",color:"#88ffaa",group:"clear"},{id:"addTen",icon:"+10",label:"+10 Quanta",color:"#88aaff",group:"clear"},{id:"removeTen",icon:"10",label:"-10 Quanta",color:"#ff8866",group:"clear"},{id:"clearAll",icon:"",label:"Clear All",color:"#ff4466",group:"clear"}],jh={KICK:{proportion:1,pitchRange:[36,48],waveform:"kick",filterType:"lowpass",filterFreq:200,filterQ:1,envelope:{attack:.001,decay:.1,sustain:0,release:.08},gainScale:1,detune:0,panSpread:.1,maxVoices:2,cooldownMin:.15},BASS:{proportion:1,pitchRange:[28,52],waveform:"sawtooth",filterType:"lowpass",filterFreq:280,filterQ:3,envelope:{attack:.01,decay:.2,sustain:.65,release:.25},gainScale:.75,detune:0,panSpread:.25,maxVoices:3,cooldownMin:.35},PERC:{proportion:1,pitchRange:[48,84],waveform:"noise",filterType:"highpass",filterFreq:5e3,filterQ:.4,envelope:{attack:.001,decay:.06,sustain:0,release:.04},gainScale:.55,detune:0,panSpread:.6,maxVoices:4,cooldownMin:.18},PAD:{proportion:1,pitchRange:[48,72],waveform:"sine",filterType:"lowpass",filterFreq:900,filterQ:1.2,envelope:{attack:.8,decay:.3,sustain:.8,release:1.5},gainScale:.5,detune:0,panSpread:.8,maxVoices:4,cooldownMin:.9},LEAD:{proportion:1,pitchRange:[52,88],waveform:"sawtooth",filterType:"lowpass",filterFreq:2200,filterQ:2,envelope:{attack:.01,decay:.12,sustain:.5,release:.2},gainScale:.7,detune:0,panSpread:.4,maxVoices:3,cooldownMin:.22},ARP:{proportion:1,pitchRange:[60,96],waveform:"square",filterType:"lowpass",filterFreq:3e3,filterQ:1.5,envelope:{attack:.003,decay:.12,sustain:.15,release:.22},gainScale:.6,detune:0,panSpread:.6,maxVoices:3,cooldownMin:.14},STRINGS:{proportion:1,pitchRange:[48,76],waveform:"triangle",filterType:"lowpass",filterFreq:1800,filterQ:1.5,envelope:{attack:.35,decay:.2,sustain:.7,release:1.2},gainScale:.5,detune:0,panSpread:.9,maxVoices:4,cooldownMin:.7},CHOIR:{proportion:1,pitchRange:[48,72],waveform:"sine",filterType:"lowpass",filterFreq:800,filterQ:1,envelope:{attack:1.2,decay:.5,sustain:.75,release:2.5},gainScale:.45,detune:0,panSpread:1,maxVoices:3,cooldownMin:1.5}},Sc=[{name:"Sub Bass",icon:"",color:"#ff8c00",wave:"sine",fType:"lowpass",fFreq:90,fQ:1,env:{attack:.01,decay:.3,sustain:.82,release:.6},gain:.82,det:0,cd:.35},{name:"Acid 303",icon:"",color:"#ff5500",wave:"sawtooth",fType:"lowpass",fFreq:360,fQ:18,env:{attack:.002,decay:.14,sustain:.35,release:.1},gain:.75,det:-7,cd:.14},{name:"Hard Kick",icon:"",color:"#ff3b5c",wave:"kick",fType:"lowpass",fFreq:180,fQ:.5,env:{attack:.001,decay:.08,sustain:0,release:.06},gain:.9,det:0,cd:.4},{name:"FM Bell",icon:"",color:"#00d4c8",wave:"triangle",fType:"bandpass",fFreq:3200,fQ:3,env:{attack:.003,decay:.25,sustain:.1,release:.85},gain:.55,det:0,cd:.22},{name:"Saw Lead",icon:"",color:"#39ff70",wave:"sawtooth",fType:"lowpass",fFreq:2e3,fQ:4,env:{attack:.008,decay:.1,sustain:.5,release:.2},gain:.6,det:7,cd:.18},{name:"Square",icon:"",color:"#00aaff",wave:"square",fType:"lowpass",fFreq:1200,fQ:2.5,env:{attack:.005,decay:.12,sustain:.42,release:.15},gain:.5,det:0,cd:.2},{name:"Warm Pad",icon:"~",color:"#9b59ff",wave:"sawtooth",fType:"lowpass",fFreq:550,fQ:2,env:{attack:.55,decay:.3,sustain:.75,release:1.2},gain:.45,det:0,cd:.85},{name:"Choir",icon:"",color:"#ff69b4",wave:"sine",fType:"lowpass",fFreq:750,fQ:1.2,env:{attack:1.1,decay:.5,sustain:.8,release:2},gain:.45,det:0,cd:2},{name:"Shimmer",icon:"",color:"#ffd700",wave:"triangle",fType:"highpass",fFreq:2400,fQ:1.5,env:{attack:.2,decay:.3,sustain:.6,release:1},gain:.4,det:12,cd:.6},{name:"Snare",icon:"",color:"#00e5ff",wave:"snare",fType:"bandpass",fFreq:2600,fQ:.8,env:{attack:.001,decay:.07,sustain:0,release:.05},gain:.65,det:0,cd:.18},{name:"Hi-Hat",icon:"",color:"#aaccff",wave:"hihat",fType:"highpass",fFreq:5500,fQ:.5,env:{attack:.001,decay:.03,sustain:0,release:.02},gain:.5,det:0,cd:.12},{name:"Glitch",icon:"",color:"#ff00ff",wave:"square",fType:"bandpass",fFreq:2800,fQ:8,env:{attack:.001,decay:.04,sustain:.1,release:.04},gain:.6,det:0,cd:.1}],Fa="'Doto', monospace",Yo="'IBM Plex Mono', monospace",Wr="#37b2da",ao=({label:e,value:t,min:n,max:r,step:a,display:i,color:s=Wr,onChange:c})=>{const l=((t-n)/(r-n)*100).toFixed(1)+"%";return o.jsxs("div",{className:"flex flex-col gap-0.5",children:[o.jsxs("div",{className:"flex justify-between items-baseline",children:[o.jsx("span",{style:{fontFamily:Yo,fontSize:7,color:s+"66",letterSpacing:"0.08em",textTransform:"uppercase"},children:e}),o.jsx("span",{style:{fontFamily:Yo,fontSize:7,color:s+"99"},children:i?i(t):t})]}),o.jsx("input",{type:"range",min:n,max:r,step:a,value:t,onChange:d=>c(parseFloat(d.target.value)),className:"h-px w-full appearance-none cursor-pointer",style:{background:`linear-gradient(90deg,${s}55 ${l},rgba(255,255,255,.06) ${l})`}})]})},lU=({label:e,on:t,color:n="#88aaff",onToggle:r})=>o.jsxs("button",{onClick:r,title:`${e}: ${t?"ON":"OFF"}`,className:"flex items-center gap-1.5 text-[8px] font-mono uppercase tracking-widest transition-colors",style:{color:t?n:"rgba(255,255,255,.25)"},children:[o.jsx("span",{children:t?"":""}),e]}),cU=({currentId:e,onSelect:t,onClose:n})=>{const[r,a]=S.useState(null),i=S.useMemo(()=>Array.from(new Set(Nu.flatMap(c=>c.tags))).sort(),[]),s=r?Nu.filter(c=>c.tags.includes(r)):Nu;return o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center",style:{background:"rgba(0,0,0,0.88)"},onClick:n,children:o.jsxs("div",{className:"w-[820px] max-w-[96vw] max-h-[88vh] flex flex-col border border-dashed border-white/[0.06] bg-black",style:{fontFamily:Yo},onClick:c=>c.stopPropagation(),children:[o.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-b border-dashed border-white/[0.06]",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{style:{fontSize:12,color:`${Wr}40`},children:""}),o.jsx("span",{style:{fontFamily:Fa,fontSize:10,letterSpacing:"0.14em",textTransform:"uppercase",color:"rgba(255,255,255,0.30)"},children:"60 PRESETS"})]}),o.jsx("button",{onClick:n,title:"Fechar",className:"text-white/25 hover:text-white/60",children:o.jsx(Cs,{size:13})})]}),o.jsxs("div",{className:"flex items-center gap-1.5 px-4 py-2 border-b border-dashed border-white/[0.06] overflow-x-auto flex-shrink-0",style:{scrollbarWidth:"none"},children:[o.jsx("button",{onClick:()=>a(null),title:"Mostrar todos os presets",className:`text-[6px] uppercase tracking-[0.14em] px-2 py-0.5 border whitespace-nowrap transition-all
              ${r?"border-white/[0.06] text-white/28 hover:text-white/55":"border-[#37b2da]/50 text-[#37b2da] bg-[#37b2da]/8"}`,style:{fontFamily:Yo,borderRadius:0},children:"All"}),i.map(c=>o.jsx("button",{onClick:()=>a(r===c?null:c),title:`Filtrar: ${c}`,className:`text-[6px] uppercase tracking-[0.14em] px-2 py-0.5 border whitespace-nowrap transition-all
                ${r===c?"border-current bg-current/10":"border-white/[0.06] text-white/28 hover:text-white/55"}`,style:{fontFamily:Yo,borderRadius:0,...r===c?{color:pp[c]??"#aaa",borderColor:pp[c]??"#aaa"}:{}},children:c},c))]}),o.jsx("div",{className:"grid grid-cols-4 gap-2 p-4 overflow-y-auto",style:{scrollbarWidth:"thin",scrollbarColor:"rgba(55,178,218,.15) transparent"},children:s.map(c=>o.jsxs("button",{onClick:()=>{t(c.id),n()},title:c.name,className:`text-left p-3 border transition-all
                ${c.id===e?"border-[#37b2da]/40 bg-[#37b2da]/[0.04]":"border-white/[0.06] hover:border-white/15 hover:bg-white/[0.02]"}`,style:{borderRadius:0,borderStyle:c.id===e?"solid":"dashed"},children:[o.jsxs("div",{className:"flex items-center gap-0.5 mb-1.5",children:[Array.from({length:5}).map((l,d)=>o.jsx("div",{className:"w-1.5 h-1.5",style:{background:d<c.intensity?c.primary:"rgba(255,255,255,.08)",borderRadius:0}},d)),o.jsxs("span",{className:"ml-1 text-[6px] text-white/18",style:{fontFamily:Yo},children:[c.bpm,"bpm"]})]}),o.jsx("div",{className:"text-[9px] mb-0.5 leading-tight",style:{color:c.id===e?c.primary:"rgba(255,255,255,.7)",fontFamily:Yo,fontWeight:300},children:c.name}),o.jsx("div",{className:"text-[7px] text-white/25 mb-2 leading-snug line-clamp-1",style:{fontFamily:Yo},children:c.vibe}),o.jsx("div",{className:"flex flex-wrap gap-0.5",children:c.tags.slice(0,3).map(l=>o.jsx("span",{className:"text-[5px] uppercase tracking-[0.14em] px-1.5 py-0.5",style:{color:pp[l]??"#aaa",background:(pp[l]??"#aaa")+"10",border:`1px solid ${pp[l]??"#aaa"}28`,fontFamily:Yo,borderRadius:0},children:l},l))})]},c.id))})]})})};function dU(e,t,n,r){const a=dd[r]??dd.minor;switch(e){case"KICK":return n;case"BASS":return n+12;case"PERC":return n+24;case"PAD":return n+24+(a[2]??4);case"STRINGS":return n+19+(a[0]??0);case"CHOIR":return n+24+(a[3]??5);case"LEAD":{const i=Math.floor(t/2)%a.length;return n+24+a[i]}case"ARP":{const i=t%a.length;return n+24+a[i]}default:return n+24}}const ii=Ov("eno-drift")??Nu[0],uU=({active:e})=>{var Ed,So,$c,qc,hc;const t=S.useRef(null),n=S.useRef(null),r=S.useRef(ii),a=S.useRef(0),i=S.useRef(0),s=S.useRef(!1),c=S.useRef({...ai,motionStyle:ii.motionStyle??"drift"}),l=S.useRef({}),d=S.useRef({wx:0,wy:0,active:!1}),u=S.useRef(-1),h=S.useRef(!1),m=S.useRef(null),f=S.useRef(null),[g,x]=S.useState(null),v=r6(),[b,w]=S.useState(ii.id),[M,k]=S.useState(!1),[R,j]=S.useState(!1),[I,E]=S.useState(!1),[O,L]=S.useState(!1),[$,F]=S.useState(!1),[B,W]=S.useState(ii.lens),[re,oe]=S.useState(ii.bpm),[te,J]=S.useState(.5),[pe,P]=S.useState(.65),[V,fe]=S.useState("gate"),[ye,Se]=S.useState("PAD"),[we,ke]=S.useState(1),[De,_e]=S.useState(.14),[ae,Re]=S.useState(.14),[Fe,Oe]=S.useState(!1),[ne,nt]=S.useState(!1),pt=S.useRef(null),Et=S.useRef(null),[_t,Ct]=S.useState(!1),[Xe,Ut]=S.useState(!1),[Le,Ke]=S.useState("harmony"),[mt,an]=S.useState("PAD"),[gn,Be]=S.useState(!1),[ft,Qt]=S.useState({...ai,motionStyle:ii.motionStyle??"drift"}),[nr,_n]=S.useState(""),[Rn,sn]=S.useState(ii.quantaCount),[Cn,wt]=S.useState("preset"),[st,Zt]=S.useState(!1),Pe=S.useRef(!1);S.useEffect(()=>{Pe.current=st},[st]);const[ct,vt]=S.useState("3d-orbital"),[xe,ge]=S.useState(!0),[Ee,me]=S.useState(!1),[je,Te]=S.useState(!0),[Ae,Tt]=S.useState("role"),[xt,en]=S.useState(ii.root),[At,Ze]=S.useState(ii.scale),[yt,Mt]=S.useState(ii.harmonyMode??"consonant"),[bn,Pt]=S.useState(ii.eventRate??.25),[,An]=S.useState(0),cr=S.useRef([]),Tn=S.useRef(null),Sr=S.useRef(!1),[de,$e]=S.useState(null),[et,zt]=S.useState(null),Nt=S.useRef(null),[,ln]=S.useState(null),[Rt,Nn]=S.useState(!1),[It,xn]=S.useState(1),[Ln,zn]=S.useState(8),[Or,wr]=S.useState(iC),[vn,Gr]=S.useState(!1),[hn,jr]=S.useState(16),[_r,Zn]=S.useState(0),[lo,ir]=S.useState(!0),[to,Er]=S.useState(!1),[Eo,oa]=S.useState(!1),[ja,Co]=S.useState(!1),[Ya,qo]=S.useState(!1),[os,Ho]=S.useState({x:0,y:0}),[fs,To]=S.useState(!0),[Xo,ks]=S.useState(!0),D=S.useRef(!0);S.useEffect(()=>{D.current=Xo},[Xo]);const[ee,Ie]=S.useState({...Nv}),Qe=S.useRef({...Nv});S.useEffect(()=>{Qe.current=ee},[ee]);const[X,Z]=S.useState("meta-lite"),[ce,ue]=S.useState({...Dv}),be=S.useRef({...Dv});S.useEffect(()=>{be.current=ce},[ce]);const[H,le]=S.useState(0),Je=S.useRef(null),tt=S.useRef(!1),St=S.useRef(null),$t=S.useRef(!1),rt=S.useRef([]),Ft=S.useRef(!1),[Xt,dn]=S.useState(null),[kn,ar]=S.useState("slow"),[jn,yr]=S.useState(.7),[Bt,qt]=S.useState(.5),[mn,dr]=S.useState(.1),rr=S.useRef({dialogica:0,recursivo:0,hologramatico:0,sapiensDemens:.5,tetralogia:0}),[Dr,ho]=S.useState(rr.current),[Vr,ko]=S.useState(!1),Ea=S.useRef(!1);S.useEffect(()=>{Ea.current=Vr},[Vr]);const no=S.useRef(iC()),go=S.useRef(!1),qs=S.useRef(16),Ka=S.useRef(-1),Jo=S.useRef(0);S.useEffect(()=>{no.current=Or},[Or]),S.useEffect(()=>{go.current=vn},[vn]),S.useEffect(()=>{qs.current=hn},[hn]);const La=S.useRef(null),za=S.useRef(!1),Rs=S.useRef(null),Qo=S.useRef(!1),vo=S.useRef(null),[va,Js]=S.useState("idle"),[$i,pi]=S.useState(0);S.useEffect(()=>(vo.current=new Nf(Js),()=>{var T;(T=vo.current)==null||T.dispose()}),[]),S.useEffect(()=>{if(va!=="recording"){pi(0);return}const T=setInterval(()=>{var q;return pi(((q=vo.current)==null?void 0:q.elapsed)??0)},500);return()=>clearInterval(T)},[va]),S.useEffect(()=>{const T=t.current;if(!T||!e)return;const q=U=>v.handleWheel(U,T);return T.addEventListener("wheel",q,{passive:!1}),()=>T.removeEventListener("wheel",q)},[e,v.handleWheel]),S.useEffect(()=>{c.current=ft},[ft]);const ps=S.useMemo(()=>["C","C#","D","Eb","E","F","F#","G","Ab","A","Bb","B"],[]),No=S.useMemo(()=>({major:"Major",minor:"Minor",pentatonic:"Penta",blues:"Blues",dorian:"Dorian",phrygian:"Phryg",lydian:"Lydian",mixolydian:"Mixo",whole_tone:"Whole",harmonic_minor:"H.Min",chromatic:"Chrom"}),[]),mi=S.useCallback(T=>{en(T),r.current.root=T;const q=n.current;if(q)for(const U of q.quanta)U.pitch=g0(U.pitch,T,r.current.scale)},[]),Tr=S.useCallback(T=>{Ze(T),r.current.scale=T;const q=n.current;if(q)for(const U of q.quanta)U.pitch=g0(U.pitch,r.current.root,T)},[]),bd=S.useCallback(T=>{Mt(T),r.current.harmonyMode=T},[]),Lc=S.useCallback(T=>{Pt(T),r.current.eventRate=T},[]),ll=S.useCallback(T=>{let q=2166136261;for(let U=0;U<T.length;U++)q^=T.charCodeAt(U),q=Math.imul(q,16777619);return q>>>0},[]),gi=S.useCallback(T=>{let q=T>>>0;return()=>{q|=0,q=q+1831565813|0;let U=Math.imul(q^q>>>15,1|q);return U=U+Math.imul(U^U>>>7,61|U)^U,((U^U>>>14)>>>0)/4294967296}},[]),Wo=S.useCallback((T,q,U)=>Math.max(q,Math.min(U,T)),[]),qi=S.useCallback(T=>Db[T.motionStyle]?T.motionStyle:{swarm:"murmuration",orbit:"revolution",flow:"migration",drift:"meditation",spiral:"revolution",lattice:"school",ballistic:"chaos"}[T.motionStyle]??"murmuration",[]),cc=S.useCallback((T,q)=>{const U=(ll(T.id)^Math.floor(Wo(q,0,1)*4294967295))>>>0,Me=gi(U),Ve=qi(T),ht=Db[Ve]??Pp[0];let kt=Lb(ht,{...ai});kt.entainment=T.entainment;const Ht=Wo((T.intensity??2)/5,0,1),$n=()=>(Me()-.5)*2;if(kt.damping=Wo((kt.damping??ai.damping)-Ht*.012+$n()*.004,.9,.999),kt.maxSpeed=Wo((kt.maxSpeed??ai.maxSpeed)*(.78+Ht*.65)+$n()*.06,.02,.9),kt.turbulence=Wo((kt.turbulence??ai.turbulence)+Ht*.14+$n()*.12,0,1),kt.cohesion=Wo((kt.cohesion??ai.cohesion)*(.75+Ht*.55)+$n()*.35,0,3),kt.separation=Wo((kt.separation??ai.separation)*(.75+Ht*.6)+$n()*.35,0,3),kt.alignment=Wo((kt.alignment??ai.alignment)*(.7+Ht*.9)+$n()*.25,0,2),kt.zoneRadius=Wo((kt.zoneRadius??ai.zoneRadius)+$n()*.08,.03,.5),kt.vortexForce=Wo((kt.vortexForce??ai.vortexForce)+(T.motionStyle==="orbit"?.1:0)+$n()*.06,0,.4),kt.burstRate=Wo((kt.burstRate??ai.burstRate)+Ht*.22+$n()*.18,0,1),T.motionStyle==="migration"||T.motionStyle==="exodus"||ht.motionStyle==="migration"||ht.motionStyle==="exodus"){const In=Me()*Math.PI*2;kt.migrationX=Math.cos(In),kt.migrationY=Math.sin(In)}return kt.bounceWalls=!1,kt.physicsOnly=!1,kt.restitution=kt.restitution??.82,kt.motionStyle=ht.motionStyle,{phys:kt,behaviorId:ht.id}},[Lb,Wo,ll,gi,qi]),Xa=S.useCallback((T,q)=>{const U=n.current;if(!U||U.count<=0)return;const Me=(ll(T.id+"_tmb")^Math.floor(Wo(q,0,1)*4294967295))>>>0,Ve=gi(Me),ht=new Set((T.tags??[]).map(String)),kt=ht.has("Ambient")||ht.has("Meditative")||ht.has("Drone"),Ht=ht.has("Techno")||ht.has("Club")||ht.has("Rave")||ht.has("Breakbeat")||ht.has("Groove"),$n=ht.has("Classical")||ht.has("Orchestral")||ht.has("Strings")||ht.has("Choral"),In={KICK:Ht?[2,2,2]:[2,2],BASS:Ht?[0,0,1,0]:kt?[0,0,0]:[0,0,1],PERC:Ht?[9,10,11,9,10]:[9,10,11],PAD:kt?[6,6,7,8,6]:$n?[6,8,7,6]:[6,6,8,7],LEAD:kt?[3,8,5,3]:Ht?[4,4,5,1]:$n?[3,5,8]:[4,5,3,8],ARP:Ht?[3,11,5,3]:[3,8,5],STRINGS:$n?[6,8,7,6]:[6,7,8],CHOIR:kt||$n?[7,7,6,8]:[7,6,8]},er=kt?.22:Ht?.42:.3;for(const pr of U.quanta){if(Ve()>er){pr.timbreIdx=-1;continue}const Mr=In[pr.role]??[6,8,5];pr.timbreIdx=Mr[Math.floor(Ve()*Mr.length)]??-1}},[Wo,ll,gi]),Hi=S.useCallback(T=>{const q=Math.floor(Math.random()*Sc.length),U=Sc[q];wi(T,{waveform:U.wave,filterType:U.fType,filterFreq:U.fFreq,filterQ:U.fQ,envelope:{...U.env},gainScale:U.gain,detune:U.det,cooldownMin:U.cd})},[]),xd=S.useCallback(T=>{var U;const q=(U=n.current)==null?void 0:U.quanta[T];q&&(q.timbreIdx=Math.floor(Math.random()*Sc.length),An(Me=>Me+1))},[]),Ro=S.useCallback(T=>{const q=n.current;if(!q)return;const U=r.current,Me=q.quanta.filter(Ht=>Ht.selected),Ve=Me.length?Me:(()=>{const Ht=d.current.wx,$n=d.current.wy;let In=null,er=.14;for(const pr of q.quanta){const Mr=Math.hypot(pr.x-Ht,pr.y-$n);Mr<er&&(er=Mr,In=pr)}return In?[In]:[]})();if(!Ve.length)return;const ht=(U.root+T)%12,kt=(Ht,$n,In,er)=>{let pr=Wo(Ht,In,er),Mr=1e9;for(let Fr=Math.floor(In);Fr<=Math.floor(er);Fr++){if((Fr%12+12)%12!==$n)continue;const uo=Math.abs(Fr-Ht);uo<Mr&&(Mr=uo,pr=Fr)}return pr};for(const Ht of Ve){const $n=U.roles[Ht.role]??jh[Ht.role],In=l.current[Ht.role],er=In?{...$n,...In}:$n,[pr,Mr]=er.pitchRange??[48,84];Ht.pitch=kt(Ht.pitch,ht,pr,Mr)}if(Cr.ready){const Ht=U.roles[mt]??jh[mt],$n=l.current[mt],In=$n?{...Ht,...$n}:Ht,[er,pr]=In.pitchRange??[48,84],Mr=kt((er+pr)/2,ht,er,pr);Cr.fire({pitch:Mr,velocity:.55,role:mt,x:0,y:0,duration:Math.max(.05,In.envelope.attack+In.envelope.decay+In.envelope.sustain*1.5),timbre:.6},In)}An(Ht=>Ht+1)},[Wo,mt]),dc=S.useCallback(T=>{if(!Cr.ready)return;const U=r.current.roles[mt]??jh[mt],Me=l.current[mt],Ve=Me?{...U,...Me}:U,[ht,kt]=Ve.pitchRange??[48,84];let Ht=60+T;for(;Ht<ht;)Ht+=12;for(;Ht>kt;)Ht-=12;Ht=Wo(Ht,ht,kt),Cr.fire({pitch:Ht,velocity:.65,role:mt,x:0,y:0,duration:Math.max(.08,Ve.envelope.attack+Ve.envelope.decay+Ve.envelope.sustain*1.6),timbre:.75},Ve)},[Wo,mt]);S.useEffect(()=>{const T=Math.random();n.current=up(ii,{variation:T}),n.current.bpm=ii.bpm,Xa(ii,T);const{phys:q,behaviorId:U}=cc(ii,T);c.current=q,Qt(q),_n(U),Nn(n.current.sequencer.active),zn(n.current.sequencer.steps.length),xn(n.current.sequencer.tempoMult)},[cc,Xa]);const On=S.useCallback((T,q)=>{const U=Ov(T);if(!U)return;const Me=Math.random();r.current=U,n.current=up(U,{variation:Me}),n.current.bpm=U.bpm,l.current={},w(T),oe(U.bpm),W(U.lens),sn(U.quantaCount),Xa(U,Me);const{phys:Ve,behaviorId:ht}=cc(U,Me);c.current=Ve,Qt(Ve),_n(ht),Nn(n.current.sequencer.active),zn(n.current.sequencer.steps.length),xn(n.current.sequencer.tempoMult),en(U.root),Ze(U.scale),Mt(U.harmonyMode??"any"),Pt(U.eventRate??1),Cr.ready&&(Cr.setReverb(U.reverbAmt*te),Cr.setDelay(U.delayAmt*te,U.delayTime),Cr.setMasterGain(U.masterGain*pe))},[te,cc,pe,Xa]),zc=S.useCallback((T,q)=>{const U=Math.random();r.current=T,n.current=up(T,{variation:U}),n.current.bpm=T.bpm,l.current={},w(T.id),oe(T.bpm),W(T.lens),sn(T.quantaCount),Xa(T,U),c.current=q,Qt(q),_n(q.motionStyle??"drift"),Nn(n.current.sequencer.active),zn(n.current.sequencer.steps.length),xn(n.current.sequencer.tempoMult),en(T.root),Ze(T.scale),Mt(T.harmonyMode??"any"),Pt(T.eventRate??1),Cr.ready&&(Cr.setReverb(T.reverbAmt*te),Cr.setDelay(T.delayAmt*te,T.delayTime),Cr.setMasterGain(T.masterGain*pe))},[te,pe,Xa]);S.useEffect(()=>{n.current&&(n.current.bpm=re)},[re]),S.useEffect(()=>{if(!Cr.ready)return;const T=r.current;Cr.setReverb(T.reverbAmt*te),Cr.setDelay(T.delayAmt*te,T.delayTime)},[te]),S.useEffect(()=>{Cr.ready&&Cr.setMasterGain(r.current.masterGain*pe)},[pe]);const yi=S.useCallback(async()=>{if(Cr.ready)if(M){const T=!s.current;if(s.current=T,j(T),!T)Cr.cutAll();else{const q=r.current;Cr.restoreGains(q.reverbAmt*Go.current,q.delayAmt*Go.current,q.delayTime,q.masterGain*bi.current)}}else{const T=r.current;Cr.restoreGains(T.reverbAmt*Go.current,T.delayAmt*Go.current,T.delayTime,T.masterGain*bi.current),k(!0),s.current=!0,j(!0)}else{await Cr.init();const T=r.current;Cr.setReverb(T.reverbAmt*te),Cr.setDelay(T.delayAmt*te,T.delayTime),Cr.setMasterGain(T.masterGain*pe),k(!0),s.current=!0,j(!0)}},[te,pe,M]),Bc=S.useRef("Harmony"),vd=S.useRef(!1),Go=S.useRef(.5),bi=S.useRef(1),Sd=S.useRef(!1),xi=S.useRef("preset");S.useEffect(()=>{Bc.current=B},[B]),S.useEffect(()=>{vd.current=I},[I]),S.useEffect(()=>{Go.current=te},[te]),S.useEffect(()=>{bi.current=pe},[pe]),S.useEffect(()=>{Sd.current=gn},[gn]),S.useEffect(()=>{xi.current=Cn},[Cn]);const yn=S.useCallback(T=>{const q=kV(T);q&&(Z(T),q.palette&&Ie(U=>({...U,...q.palette,roleColorOverrides:{...U.roleColorOverrides,...q.palette.roleColorOverrides??{}}})),q.aesthetic&&ue(U=>({...U,...q.aesthetic,canvas:{...U.canvas,...q.aesthetic.canvas??{}},quanta:{...U.quanta,...q.aesthetic.quanta??{}},trails:{...U.trails,...q.aesthetic.trails??{}},connections:{...U.connections,...q.aesthetic.connections??{}},tools:{...U.tools,...q.aesthetic.tools??{}},post:{...U.post,...q.aesthetic.post??{}},overlays:{...U.overlays,...q.aesthetic.overlays??{}},threeD:{...U.threeD,...q.aesthetic.threeD??{}}})))},[]),wd=S.useCallback(()=>{const T=n.current;if(!T)return;const q=OV({state:T,preset:r.current,palette:Qe.current,aesthetic:be.current,phys:c.current,roleOverrides:l.current});DV(q),le(Date.now())},[]);S.useEffect(()=>{if(!e){cancelAnimationFrame(a.current);return}const T=q=>{if(a.current=requestAnimationFrame(T),!t.current||!n.current)return;const U=Math.min(.05,(q-i.current)/1e3);i.current=q;const Me=n.current,Ve=r.current;if(s.current){Cr.ready&&Cr.tickEnergy(U),Me.roleEnergy={...Cr.roleEnergy};const $n={};for(const er of Ah){const pr=Ve.roles[er]??jh[er],Mr=l.current[er];$n[er]=Mr?{...pr,...Mr}:pr}const In={...Ve,roles:$n};if(xi.current==="canvas"&&Me.tick%3===0){const er=dd[In.scale],pr=Math.max(1,er.length);for(const Mr of Me.quanta){const Fr=$n[Mr.role]??Ve.roles[Mr.role]??jh[Mr.role],[uo,ha]=Fr.pitchRange??[48,84],Ta=Wo((Mr.x+1)/2,0,1),Qa=Wo(1-(Mr.y+1)/2,0,1),is=Math.floor(Ta*pr)%pr,fa=(In.root+er[is])%12,Ia=Math.floor((uo-fa)/12),Lr=Math.floor((ha-fa)/12),Za=Math.round(Ia+(Lr-Ia)*Qa),Y=Wo(fa+Za*12,uo,ha);Mr.pitch=g0(Y,In.root,In.scale)}}if(yV(Me,In,c.current,U,(er,pr)=>{let Mr=pr;if(er.timbreIdx!==void 0&&er.timbreIdx>=0){const Fr=Sc[er.timbreIdx];Fr&&(Mr={...pr,waveform:Fr.wave,filterType:Fr.fType,filterFreq:Fr.fFreq,filterQ:Fr.fQ,envelope:{...Fr.env},gainScale:pr.gainScale*Fr.gain,detune:Fr.det,cooldownMin:Fr.cd})}Cr.ready&&Cr.fire(er,Mr)}),go.current&&Cr.ready){const er=15/Me.bpm;Jo.current+=U;let pr=!1;for(;Jo.current>=er;){Jo.current-=er,Ka.current=(Ka.current+1)%qs.current,pr=!0;const Mr=Ka.current,Fr=no.current.some(uo=>uo.solo);for(const uo of no.current){if(uo.muted||Fr&&!uo.solo)continue;const ha=uo.steps[Mr];if(!(ha!=null&&ha.on))continue;const Ta=Ve.roles[uo.role];if(!Ta)continue;const Qa=l.current[uo.role],is=Qa?{...Ta,...Qa}:Ta,fa=dU(uo.role,Mr,Ve.root,Ve.scale);Cr.fire({pitch:fa,velocity:ha.vel*.92,role:uo.role,x:(Math.random()-.5)*1.6,y:(Math.random()-.5)*1.6,duration:Math.max(.05,is.envelope.attack+is.envelope.decay+is.envelope.sustain*1.5),timbre:.5},is)}}pr&&Zn(Ka.current)}}Me.tick%60===0&&Ea.current&&(rr.current=HV(Me.quanta,c.current),ho(rr.current));const ht=Me.beatPhase<.08||Me.beatPhase>.92,kt={tool:V,wx:d.current.wx,wy:d.current.wy,radius:De,active:d.current.active};Pe.current||NV(t.current,Me,Ve,Bc.current,vd.current,Go.current,ht,La.current,kt,Sd.current,cr.current.length>1?cr.current:null,et,Nt.current,v.zoomRef.current,v.panXRef.current,v.panYRef.current,u.current,f.current,D.current,Qe.current,Je.current,rt.current.length>2?rt.current:null,be.current);const Ht=pt.current;if(Ht&&t.current){const $n=t.current,In=$n.getContext("2d");if(In){const er=Math.min($n.width,$n.height)/2,pr=$n.width/2+v.panXRef.current*er*v.zoomRef.current,Mr=$n.height/2+v.panYRef.current*er*v.zoomRef.current,Fr=v.zoomRef.current,uo=pr+Ht.x1*er*Fr,ha=Mr+Ht.y1*er*Fr,Ta=pr+Ht.x2*er*Fr,Qa=Mr+Ht.y2*er*Fr,is=Ta-uo,fa=Qa-ha,Ia=Math.sqrt(is*is+fa*fa),Lr=ga[ye]||"#fff";if(In.save(),In.strokeStyle=Lr,In.lineWidth=1.5,In.globalAlpha=.85,In.setLineDash([4,3]),In.beginPath(),In.moveTo(uo,ha),In.lineTo(Ta,Qa),In.stroke(),In.setLineDash([]),Ia>4){const Za=is/Ia,Y=fa/Ia,ze=7;In.beginPath(),In.moveTo(Ta,Qa),In.lineTo(Ta-Za*ze-Y*ze*.5,Qa-Y*ze+Za*ze*.5),In.lineTo(Ta-Za*ze+Y*ze*.5,Qa-Y*ze-Za*ze*.5),In.closePath(),In.fillStyle=Lr,In.fill()}In.beginPath(),In.arc(uo,ha,4,0,Math.PI*2),In.fillStyle=Lr,In.globalAlpha=.6,In.fill(),In.restore()}}};return i.current=performance.now(),a.current=requestAnimationFrame(T),()=>cancelAnimationFrame(a.current)},[e,V,De,et]);const Qs=S.useRef(null),[As,G]=S.useState({connected:!1,name:"",axes:{lx:0,ly:0,rx:0,ry:0},triggers:{lt:0,rt:0},buttons:{},justPressed:{},justReleased:{}}),[he,ve]=S.useState(!0),[He,ut]=S.useState(!1),pn=S.useRef(yi),cn=S.useRef(On);S.useEffect(()=>{pn.current=yi},[yi]),S.useEffect(()=>{cn.current=On},[On]),S.useEffect(()=>{if(!e)return;const T=rw(),q={x:.5,y:.5},U=.014,Me=Nu;let Ve=0,ht=!1,kt=!1,Ht=!1,$n=!1,In=!1,er=!1,pr=!1,Mr=!1,Fr=!1,uo=!1,ha=0;const Ta={current:120},Qa=fa=>{var Ue,Dt,wn;const Ia=requestAnimationFrame(Qa);window.__ctrl_music_raf=Ia;const Lr=T.poll(fa);if(!Lr.connected)return;const Za=t.current;if(!Za)return;const Y=Za.getBoundingClientRect(),ze=Y.width,Ye=Y.height;q.x=Math.max(0,Math.min(1,q.x+Lr.axes.lx*U)),q.y=Math.max(0,Math.min(1,q.y+Lr.axes.ly*U));const We=Qs.current;We&&(We.style.display="block",We.style.left=`${q.x*100}%`,We.style.top=`${q.y*100}%`);const jt=((Ue=v.zoomRef)==null?void 0:Ue.current)??1,Ge=((Dt=v.panXRef)==null?void 0:Dt.current)??0,at=((wn=v.panYRef)==null?void 0:wn.current)??0,dt=q.x*ze/jt-Ge/jt,it=q.y*Ye/jt-at/jt;d.current.wx=dt,d.current.wy=it,d.current.active=Lr.triggers.rt>.06,Lr.triggers.lt>.3&&(d.current.active=!1),Math.abs(Lr.axes.ry)>.15&&Qt(Wt=>({...Wt,entainment:Math.max(0,Math.min(1,(Wt.entainment??.5)-Lr.axes.ry*.018))})),Lr.buttons.a&&!ht&&(pn.current(),T.rumble(.2,60)),Lr.buttons.b&&!kt&&(s.current=!1,j(!1),Cr.cutAll(),T.rumble(.35,80));const Yt=["BASS","PAD","LEAD","PERC","ARP","STRINGS"];if(Lr.buttons.lb&&!pr){const Wt=Yt.indexOf(ye);Se(Yt[(Wt-1+Yt.length)%Yt.length]),T.rumble(.12,35)}if(Lr.buttons.rb&&!Mr){const Wt=Yt.indexOf(ye);Se(Yt[(Wt+1)%Yt.length]),T.rumble(.12,35)}if(Lr.buttons.dpadLeft&&!Ht&&(Ve=(Ve-1+Me.length)%Me.length,cn.current(Me[Ve].id),T.rumble(.12,35)),Lr.buttons.dpadRight&&!$n&&(Ve=(Ve+1)%Me.length,cn.current(Me[Ve].id),T.rumble(.12,35)),Lr.buttons.dpadUp&&!In&&oe(Wt=>Math.min(200,Wt+5)),Lr.buttons.dpadDown&&!er&&oe(Wt=>Math.max(40,Wt-5)),Lr.buttons.start&&!Fr&&ut(Wt=>!Wt),Lr.buttons.y&&!uo&&T.rumble(.35,80,.4,.6),s.current&&M){Ta.current=re;const Wt=60/Math.max(40,Ta.current)*1e3;fa-ha>Wt*.9&&(T.rumble(Lr.triggers.rt>.1?.45:.18,30,.8,.2),ha=fa)}fa%60<16&&G({...Lr}),ht=Lr.buttons.a,kt=Lr.buttons.b,Ht=Lr.buttons.dpadLeft,$n=Lr.buttons.dpadRight,In=Lr.buttons.dpadUp,er=Lr.buttons.dpadDown,pr=Lr.buttons.lb,Mr=Lr.buttons.rb,Fr=Lr.buttons.start,uo=Lr.buttons.y},is=requestAnimationFrame(Qa);return()=>{cancelAnimationFrame(is),cancelAnimationFrame(window.__ctrl_music_raf??0)}},[e]);const Jt=S.useCallback(T=>{const q=t.current;return q?rU(T.clientX,T.clientY,q.getBoundingClientRect(),v.zoomRef.current,v.panXRef.current,v.panYRef.current):[0,0]},[v.zoomRef,v.panXRef,v.panYRef]),Pn=S.useCallback((T,q,U)=>{const Me=n.current;if(!Me)return;const Ve=De*De;for(const ht of Me.quanta){const kt=ht.x-T,Ht=ht.y-q;kt*kt+Ht*Ht>Ve||(U==="excite"?(ht.charge=Math.min(1,ht.charge+.06),Math.sqrt(ht.vx*ht.vx+ht.vy*ht.vy)>.001&&(ht.vx*=1.1,ht.vy*=1.1)):(ht.vx*=.82,ht.vy*=.82,ht.charge=Math.max(0,ht.charge-.04)))}},[De]),Hn=S.useCallback((T,q,U,Me=0,Ve=0)=>{const ht=n.current,kt=r.current;if(!ht)return;const Ht=U??ye,$n=Date.now()%1e5+ht.quanta.length,In=Me!==0||Ve!==0;for(let er=0;er<we;er++){const pr=(Math.random()-.5)*.06*er,Mr=(Math.random()-.5)*.06*er,Fr=by($n+er,kt,Ht,T+pr,q+Mr);if(Fr.vx=In?Me+(Math.random()-.5)*.005:(Math.random()-.5)*.025,Fr.vy=In?Ve+(Math.random()-.5)*.005:(Math.random()-.5)*.025,Fr.charge=.5+Math.random()*.3,ht.quanta.push(Fr),ht.count++,id(ht,{pitch:Fr.pitch,velocity:.65,x:T+pr,y:q+Mr},ga[Ht]),Cr.ready){const uo=kt.roles[Ht]??jh[Ht];uo&&Cr.fire({pitch:Fr.pitch,velocity:.65,role:Ht,x:T+pr,y:q+Mr,duration:uo.envelope.attack+uo.envelope.decay+uo.envelope.release,timbre:.6},uo)}}sn(ht.count)},[ye,we]),Ir=S.useCallback((T,q)=>{const U=n.current;if(!U)return null;let Me=-1,Ve=.08;for(let ht=0;ht<U.count;ht++){const kt=U.quanta[ht],Ht=Math.sqrt((kt.x-T)**2+(kt.y-q)**2);Ht<Ve&&(Ve=Ht,Me=ht)}for(const ht of U.quanta)ht.selected=!1;return Me>=0&&(U.quanta[Me].selected=!0),Rs.current=Me>=0?U.quanta[Me].id:null,An(ht=>ht+1),Me>=0?Me:null},[]),Ur=S.useCallback((T,q)=>{const U=n.current;if(!U)return;let Me=-1,Ve=.08;for(let Ht=0;Ht<U.count;Ht++){const $n=U.quanta[Ht],In=Math.sqrt(($n.x-T)**2+($n.y-q)**2);In<Ve&&(Ve=In,Me=Ht)}if(Me<0)return;const ht=U.quanta[Me],kt=Ah.indexOf(ht.role);ht.role=Ah[(kt+1)%Ah.length],ht.mutations++,ht.roleLockTimer=1.5,U.emergent.push({type:"mutation",x:ht.x,y:ht.y,r:.04,alpha:1,color:"#ffffff"}),An(Ht=>Ht+1)},[]),qr=S.useCallback((T,q)=>{const U=n.current;if(!U)return;for(let ht=U.gates.length-1;ht>=0;ht--){const kt=U.gates[ht],Ht=kt.x2-kt.x1,$n=kt.y2-kt.y1,In=Ht*Ht+$n*$n;if(In<1e-4)continue;const er=Math.max(0,Math.min(1,((T-kt.x1)*Ht+(q-kt.y1)*$n)/In)),pr=kt.x1+er*Ht,Mr=kt.y1+er*$n;if((T-pr)**2+(q-Mr)**2<.03){U.gates.splice(ht,1);return}}for(let ht=U.attractors.length-1;ht>=0;ht--){const kt=U.attractors[ht];if((kt.x-T)**2+(kt.y-q)**2<.025){U.attractors.splice(ht,1);return}}let Me=-1,Ve=.07;for(let ht=0;ht<U.count;ht++){const kt=U.quanta[ht],Ht=Math.sqrt((kt.x-T)**2+(kt.y-q)**2);Ht<Ve&&(Ve=Ht,Me=ht)}Me>=0&&(U.quanta.splice(Me,1),U.count--),sn(U.count),An(ht=>ht+1)},[]),tn=S.useCallback(T=>{if(T.button===1){v.handlePanStart(T);return}if(T.button!==0)return;const[q,U]=Jt(T);d.current.active=!0;const Me=n.current;switch(r.current,V){case"gate":case"mirror":case"absorber":case"membrane":za.current=!0,La.current={x1:q,y1:U,x2:q,y2:U};break;case"spawn":ne?pt.current={x1:q,y1:U,x2:q,y2:U}:Hn(q,U);break;case"attractor":Me==null||Me.attractors.push({x:q,y:U,strength:ae,vortexStr:0,radius:.55,type:"attractor"});break;case"repulsor":Me==null||Me.attractors.push({x:q,y:U,strength:-ae,vortexStr:0,radius:.45,type:"repulsor"});break;case"vortex":Me==null||Me.attractors.push({x:q,y:U,strength:0,vortexStr:ae*.8,radius:.6,type:"vortex"});break;case"metro":Me==null||Me.attractors.push({x:q,y:U,strength:mn,vortexStr:0,radius:.5,type:"metro"});break;case"excite":case"freeze":za.current=!0,Pn(q,U,V);break;case"select":{if(Ir(q,U)!==null)Qo.current=!0;else if(h.current=!0,m.current={x:q,y:U},f.current={x1:q,y1:U,x2:q,y2:U},Me)for(const ht of Me.quanta)ht.selected=!1;break}case"mutate":Ur(q,U);break;case"erase":qr(q,U);break;case"channel":Sr.current=!0,cr.current=[],Tn.current=[q,U];break;case"rail":za.current=!0,Nt.current={x1:q,y1:U,x2:q,y2:U},ln({x1:q,y1:U,x2:q,y2:U});break;case"cage":tt.current=!0,Je.current={x1:q,y1:U,x2:q,y2:U};break;case"string":$t.current=!0,St.current={x1:q,y1:U,x2:q,y2:U};break;case"zone":Ft.current=!0,rt.current=[[q,U]],dn([[q,U]]);break;case"tunnel":if(!et)zt({x:q,y:U});else{if(Me){const Ve=["#cc66ff","#aa44ee","#ee88ff"];Me.tunnels.push({id:Date.now()%1e5,ax:et.x,ay:et.y,bx:q,by:U,radius:.06,color:Ve[Me.tunnels.length%Ve.length],cd:0})}zt(null),An(Ve=>Ve+1)}break}An(Ve=>Ve+1)},[V,ne,ae,mn,Pn,Hn,Ir,Ur,qr,Jt,et]),Fn=S.useCallback(T=>{if(v.handlePanMove(T))return;const[q,U]=Jt(T);if(d.current={...d.current,wx:q,wy:U},pt.current&&(pt.current={...pt.current,x2:q,y2:U}),(V==="gate"||V==="mirror"||V==="absorber"||V==="membrane")&&za.current&&La.current&&(La.current={...La.current,x2:q,y2:U}),(V==="excite"||V==="freeze")&&za.current&&Pn(q,U,V),V==="select"&&Qo.current&&n.current){for(const Me of n.current.quanta)if(Me.selected){Me.x=q,Me.y=U,Me.vx=0,Me.vy=0;break}}if(V==="select"&&n.current&&!Qo.current){const Me=n.current;let Ve=-1,ht=.08;for(let kt=0;kt<Me.count;kt++){const Ht=Me.quanta[kt],$n=Math.sqrt((Ht.x-q)**2+(Ht.y-U)**2);$n<ht&&(ht=$n,Ve=kt)}u.current=Ve}else V!=="select"&&(u.current=-1);if(h.current&&m.current){const Me=m.current;f.current={x1:Math.min(Me.x,q),y1:Math.min(Me.y,U),x2:Math.max(Me.x,q),y2:Math.max(Me.y,U)}}if(V==="channel"&&Sr.current&&Tn.current){const[Me,Ve]=Tn.current,ht=q-Me,kt=U-Ve,Ht=Math.sqrt(ht*ht+kt*kt);Ht>.008&&(cr.current.push([q,U,ht/Ht,kt/Ht]),Tn.current=[q,U],$e([...cr.current]))}if(V==="rail"&&za.current&&Nt.current){const Me={...Nt.current,x2:q,y2:U};Nt.current=Me,ln(Me)}if(V==="cage"&&tt.current&&Je.current&&(Je.current={...Je.current,x2:q,y2:U}),V==="string"&&$t.current&&St.current&&(St.current={...St.current,x2:q,y2:U}),V==="zone"&&Ft.current){const Me=rt.current[rt.current.length-1];(!Me||Math.sqrt((q-Me[0])**2+(U-Me[1])**2)>.018)&&(rt.current.push([q,U]),dn([...rt.current]))}},[V,Pn,Jt]),Wn=S.useCallback(T=>{if(v.handlePanEnd(T),d.current.active=!1,Qo.current=!1,pt.current&&V==="spawn"){const q=pt.current,U=.28,Me=(q.x2-q.x1)*U,Ve=(q.y2-q.y1)*U;Hn(q.x1,q.y1,void 0,Me,Ve),pt.current=null,An(ht=>ht+1)}if((V==="gate"||V==="mirror"||V==="absorber"||V==="membrane")&&za.current&&La.current&&n.current){const q=La.current;if((q.x2-q.x1)**2+(q.y2-q.y1)**2>.004){const U=r.current,Ve={gate:[U.primary,U.secondary,U.accent,"#ffffff"],mirror:["#c8e8ff","#d8f0ff","#a8d8ef"],absorber:["#dd3333","#cc1111","#ff4444"],membrane:["#dd66ff","#cc44ff","#aa22ee"]}[V]??[U.primary];n.current.gates.push({x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,cooldown:0,color:Ve[n.current.gates.length%Ve.length],type:V})}}if(V==="channel"&&Sr.current){if(Sr.current=!1,cr.current.length>3&&n.current){const q=r.current,U=[q.primary,q.secondary,q.accent,"#c0c8d0","#88ffcc"];n.current.channels.push({id:Date.now()%1e5,pts:[...cr.current],strength:.6,radius:.12,color:U[n.current.channels.length%U.length]})}cr.current=[],$e(null)}if(V==="rail"&&za.current&&Nt.current&&n.current){const q=Nt.current;if((q.x2-q.x1)**2+(q.y2-q.y1)**2>.004){const U=r.current;n.current.rails.push({x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,strength:.5,color:U.accent||"#c8960a"})}Nt.current=null,ln(null)}if(za.current=!1,La.current=null,h.current&&f.current&&n.current){const q=f.current;for(const U of n.current.quanta)U.selected=U.x>=q.x1&&U.x<=q.x2&&U.y>=q.y1&&U.y<=q.y2}if(h.current=!1,m.current=null,f.current=null,V==="cage"&&tt.current&&Je.current&&n.current){const q=Je.current,U=Math.abs(q.x2-q.x1),Me=Math.abs(q.y2-q.y1);if(U>.04||Me>.04){const Ve=["#00ffcc","#00ccff","#88ffaa","#ffcc44"];n.current.cages.push({id:Date.now()%1e5,shape:"rect",x:(q.x1+q.x2)/2,y:(q.y1+q.y2)/2,w:U,h:Me,r:Math.max(U,Me)/2,elasticity:.85,color:Ve[n.current.cages.length%Ve.length]})}tt.current=!1,Je.current=null}if(V==="string"&&$t.current&&St.current&&n.current){const q=St.current;if((q.x2-q.x1)**2+(q.y2-q.y1)**2>.003){const U=["#ffd700","#ffaa44","#ffcc88"];n.current.strings.push({id:Date.now()%1e5,x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,tension:.5,vibAmp:0,vibPhase:0,decay:.8,color:U[n.current.strings.length%U.length],lastHit:0})}$t.current=!1,St.current=null}if(V==="zone"&&Ft.current&&n.current){const q=rt.current;if(q.length>=3){const U={slow:"#0066ff",fast:"#ff4400",mute:"#444488",excite_zone:"#ff8800",pitch_up:"#00ff88",pitch_down:"#ff0088",reverse:"#ff00ff",freeze_zone:"#88ccff",vortex_zone:"#cc44ff",gravity_down:"#ff8844",gravity_up:"#44ccff",transpose:"#ffdd00",harmonize_zone:"#88ff44",bounce:"#ff4444",compress_zone:"#4488ff",scatter_zone:"#ff88cc"};n.current.fxZones.push({id:Date.now()%1e5,pts:[...q],effect:kn,strength:jn,param:Bt,color:U[kn]??"#ffffff"})}Ft.current=!1,rt.current=[],dn(null)}An(q=>q+1)},[V,Hn,ne,kn]),Yn=S.useCallback(()=>{d.current.active=!1,za.current=!1,Qo.current=!1,h.current=!1,f.current=null,pt.current=null,La.current=null,u.current=-1,tt.current=!1,Je.current=null,$t.current=!1,St.current=null,Ft.current=!1,rt.current=[],dn(null),v.handlePanEnd()},[v.handlePanEnd]),co=S.useCallback(T=>{T.preventDefault();const[q,U]=Jt(T),Me=n.current;if(!Me)return;let Ve=-1,ht=.1;for(let kt=0;kt<Me.count;kt++){const Ht=Me.quanta[kt],$n=Math.sqrt((Ht.x-q)**2+(Ht.y-U)**2);$n<ht&&(ht=$n,Ve=kt)}if(Ve>=0){for(const kt of Me.quanta)kt.selected=!1;Me.quanta[Ve].selected=!0,x({sx:T.clientX,sy:T.clientY,qIdx:Ve})}else x(null),Ho({x:T.clientX,y:T.clientY}),Co(!0);An(kt=>kt+1)},[Jt]);S.useEffect(()=>{if(!e)return;const T=q=>{if(q.target!==document.body&&q.target.tagName!=="CANVAS")return;const U={q:"select",w:"spawn",e:"gate",a:"attractor",t:"repulsor",y:"vortex",u:"excite",i:"freeze",o:"mutate",p:"erase",1:"channel",2:"rail",3:"tunnel",4:"mirror",5:"absorber",6:"membrane",7:"cage",8:"string",9:"zone",0:"metro"};(q.key==="h"||q.key==="H")&&(q.preventDefault(),E(Ve=>!Ve)),(q.key==="v"||q.key==="V")&&(q.preventDefault(),ks(Ve=>!Ve)),(q.key==="r"||q.key==="R")&&(q.preventDefault(),Gi.current());const Me=U[q.key.toLowerCase()];if(Me&&fe(Me),q.key===" "&&q.shiftKey)q.preventDefault(),Ho({x:window.innerWidth/2,y:window.innerHeight/2}),qo(!0);else if(q.key===" "){q.preventDefault();const Ve=!s.current;if(s.current=Ve,j(Ve),!Ve)Cr.cutAll();else{const ht=r.current;Cr.restoreGains(ht.reverbAmt*Go.current,ht.delayAmt*Go.current,ht.delayTime,ht.masterGain*bi.current)}}if(q.key==="Tab"&&!q.shiftKey&&(q.preventDefault(),Ho({x:window.innerWidth/2,y:window.innerHeight/2}),Co(!0)),(q.ctrlKey||q.metaKey)&&((q.key==="="||q.key==="+")&&(q.preventDefault(),v.zoomIn()),q.key==="-"&&(q.preventDefault(),v.zoomOut()),q.key==="0"&&(q.preventDefault(),v.resetView())),q.key==="Delete"||q.key==="Backspace"){const Ve=n.current;if(Ve){for(let ht=Ve.quanta.length-1;ht>=0;ht--)if(Ve.quanta[ht].selected){Ve.quanta.splice(ht,1),Ve.count--;break}}sn((Ve==null?void 0:Ve.count)??0)}};return window.addEventListener("keydown",T),()=>window.removeEventListener("keydown",T)},[e]);const Ao=()=>{var T;(T=n.current)==null||T.quanta.forEach(q=>{q.charge=Math.min(1,q.charge+.3)})},as=()=>{var T;(T=n.current)==null||T.quanta.forEach(q=>{q.vx*=.1,q.vy*=.1,q.charge=Math.max(.05,q.charge-.25)})},Zo=()=>{var T;(T=n.current)==null||T.quanta.forEach(q=>{q.x=(Math.random()-.5)*1.6,q.y=(Math.random()-.5)*1.6,q.vx=(Math.random()-.5)*.02,q.vy=(Math.random()-.5)*.02,q.phase=Math.random()})},Io=()=>{Cr.cutAll();const T=r.current;Cr.restoreGains(T.reverbAmt*Go.current,T.delayAmt*Go.current,T.delayTime,T.masterGain*bi.current),n.current&&(n.current.quanta=[],n.current.count=0),sn(0)},Zs=()=>{const T=n.current,q=r.current;if(T){for(let U=0;U<10;U++){const Me=Object.keys(q.roles),Ve=Me[U%Me.length],ht=by(Date.now()%1e5+U,q,Ve);T.quanta.push(ht),T.count++}sn(T.count)}},ms=()=>{const T=n.current;T&&(T.quanta.splice(Math.max(0,T.count-10)),T.count=T.quanta.length,sn(T.count))},Ja=()=>{n.current&&(n.current.gates=[]),An(T=>T+1)},Ba=()=>{n.current&&(n.current.attractors=[]),An(T=>T+1)},Pl=()=>{n.current&&(n.current.channels=[],n.current.rails=[],n.current.tunnels=[]),An(T=>T+1)},hr=()=>{n.current&&(n.current.cages=[],n.current.strings=[],n.current.fxZones=[]),An(T=>T+1)},Vo=()=>{var T;(T=n.current)==null||T.quanta.forEach(q=>{q.x=(Math.random()-.5)*1.7,q.y=(Math.random()-.5)*1.7,q.vx=(Math.random()-.5)*.04,q.vy=(Math.random()-.5)*.04})},$a=()=>{var T;(T=n.current)==null||T.quanta.forEach(q=>{q.vx+=-q.x*.12,q.vy+=-q.y*.12})},aa=()=>{var T;(T=n.current)==null||T.quanta.forEach(q=>{const U=Math.sqrt(q.x*q.x+q.y*q.y)+.01;q.vx+=q.x/U*.25,q.vy+=q.y/U*.25})},fr=()=>{const T=n.current,q=r.current;T&&T.quanta.forEach(U=>{U.pitch=g0(U.pitch,q.root,q.scale)})},Oo=()=>{n.current&&(n.current.userMatrix=O5()),An(T=>T+1)},qa=()=>{const T=["KICK","BASS","PERC","PAD","LEAD","ARP","STRINGS","CHOIR"],q=O5();for(const U of T)for(const Me of T)Math.random()<.38&&(q[U][Me]=parseFloat(((Math.random()*2-1)*.6).toFixed(1)));n.current&&(n.current.userMatrix=q),An(U=>U+1)},Po=S.useCallback(()=>{Cr.cutAll();const T=r.current;Cr.restoreGains(T.reverbAmt*Go.current,T.delayAmt*Go.current,T.delayTime,T.masterGain*bi.current);const q=n.current;q&&(q.quanta=[],q.count=0,q.gates=[],q.attractors=[],q.channels=[],q.rails=[],q.tunnels=[],q.cages=[],q.strings=[],q.fxZones=[],q.ripples=[],q.emergent=[],q.userMatrix=O5(),q.sequencer.active=!1,Nn(!1),sn(0),An(U=>U+1))},[]),uc=S.useCallback(T=>{fe(T),Co(!1)},[]),Wi=S.useCallback(T=>{var U;const q={exciteAll:Ao,freezeAll:as,explode:aa,compress:$a,scatter:Vo,harmonize:fr,reseed:Zo,addTen:Zs,removeTen:ms,clearAll:Io};(U=q[T])==null||U.call(q),qo(!1)},[]),cl=S.useCallback(()=>{const T=Et.current,q=n.current;if(T&&q)Cr.cutAll(),q.quanta=T.quanta.map(U=>({...U,trailX:[],trailY:[]})),q.count=q.quanta.length,q.gates=T.gates.map(U=>({...U})),q.attractors=T.attractors.map(U=>({...U})),q.channels=T.channels.map(U=>({...U,pts:[...U.pts]})),q.rails=T.rails.map(U=>({...U})),q.tunnels=T.tunnels.map(U=>({...U})),q.cages=T.cages.map(U=>({...U})),q.strings=T.strings.map(U=>({...U})),q.fxZones=T.fxZones.map(U=>({...U,pts:[...U.pts]})),s.current=!1,j(!1),pt.current=null,nt(!0),fe("spawn"),sn(q.count),An(U=>U+1);else{const U=Ov(b);U&&(r.current=U,n.current=up(U),n.current.bpm=U.bpm,l.current={},oe(U.bpm),W(U.lens),sn(U.quantaCount),en(U.root),Ze(U.scale),Mt(U.harmonyMode??"any"),Pt(U.eventRate??1),Cr.cutAll(),s.current=!1,j(!1),nt(!1),Ct(!1),An(Me=>Me+1))}},[b]),Gi=S.useRef(()=>{});S.useEffect(()=>{Gi.current=cl},[cl]);const Em=S.useCallback(()=>{Oe(T=>{const q=!T;if(q){Ut(!0),Ke("physics");const U={...ai,motionStyle:"ballistic",bounceWalls:!0,physicsOnly:!0,gravityX:0,gravityY:.327,damping:.9992,turbulence:0,cohesion:0,separation:0,alignment:0,predatorPrey:!1,mutationRate:0,energyTransfer:0,entainment:0,maxSpeed:2.5,restitution:.72};if(c.current=U,Qt({...U}),n.current)for(const Me of n.current.quanta)Me.vx=0,Me.vy=0,Me.charge=.5}else{const U=r.current,Me={...ai,motionStyle:U.motionStyle??"swarm",bounceWalls:!1,physicsOnly:!1};c.current=Me,Qt({...Me})}return q})},[]),Fl=S.useCallback(()=>{nt(T=>{const q=!T;if(q){const U=n.current;U&&(Et.current={quanta:U.quanta.map(Me=>({...Me,trailX:[],trailY:[]})),gates:U.gates.map(Me=>({...Me})),attractors:U.attractors.map(Me=>({...Me})),channels:U.channels.map(Me=>({...Me,pts:[...Me.pts]})),rails:U.rails.map(Me=>({...Me})),tunnels:U.tunnels.map(Me=>({...Me})),cages:U.cages.map(Me=>({...Me})),strings:U.strings.map(Me=>({...Me})),fxZones:U.fxZones.map(Me=>({...Me,pts:[...Me.pts]}))},Ct(!0)),s.current=!1,j(!1),Cr.cutAll(),fe("spawn")}return pt.current=null,q})},[]),Md=S.useCallback(()=>{Cr.cutAll();const T=Math.random,q=(Gn,Jr,zr)=>{Gn=(Gn%360+360)%360,Jr/=100,zr/=100;const oo=Jr*Math.min(zr,1-zr),Uo=ni=>{const Hs=(ni+Gn/30)%12;return Math.round(255*(zr-oo*Math.max(Math.min(Hs-3,9-Hs,1),-1))).toString(16).padStart(2,"0")};return"#"+Uo(0)+Uo(8)+Uo(4)},U=Math.floor(T()*360),Me=50+T()*32,Ve=q(U,Me,62),ht=q((U+125)%360,Me*.9,55),kt=q((U+245)%360,Me*1.1,68),Ht=[60,70,72,75,80,84,85,88,90,95,100,104,108,110,114,120,124,128,130,135,140,144,150,160,170],$n=Ht[Math.floor(T()*Ht.length)],In=["major","minor","pentatonic","blues","dorian","phrygian","lydian","mixolydian","whole_tone","harmonic_minor"],er=Math.floor(T()*12),pr=In[Math.floor(T()*In.length)],Mr=["free","free","free","consonant","dissonant"],Fr=Mr[Math.floor(T()*Mr.length)],uo=Fr==="consonant"?"consonant":Fr==="dissonant"?"dissonant":"any",ha=.3+T()*2.8,Ta=.1+T()*.72,Qa=[.125,.25,.333,.375,.5,.666,.75],is=Qa[Math.floor(T()*Qa.length)],fa=T()*.55,Ia=.7+T()*.25,Lr=15+Math.floor(T()*58),Za=Math.floor(T()*14),Y=1+T()*2,ze=Pp[Math.floor(T()*Pp.length)],Ye={...ai,damping:.918+T()*.068,cohesion:.15+T()*2.5,separation:.25+T()*2,maxSpeed:.05+T()*.5,gravityX:(T()-.5)*.34,gravityY:(T()-.5)*.34,turbulence:T()*.92,mutationRate:T()*.45,energyTransfer:.08+T()*.74,entainment:.06+T()*.84,predatorPrey:T()<.22,motionStyle:ze.motionStyle,alignment:T()*2.4,zoneRadius:.04+T()*.5,vortexForce:T()*.44,burstRate:T()*.94,migrationX:(T()-.5)*2,migrationY:(T()-.5)*2,clusterTarget:2+Math.floor(T()*22),polarize:T()},We={KICK:[2,2,2],BASS:[0,0,1,0],PERC:[9,10,11,9,10],PAD:[6,6,7,8,6],LEAD:[4,4,5,3,4],ARP:[3,8,5,3,3],STRINGS:[6,6,7,0],CHOIR:[7,7,6,7]},jt={KICK:{A:[.001,.003],D:[.055,.12],S:[0,.02],R:[.04,.1]},BASS:{A:[.005,.085],D:[.08,.35],S:[.55,.9],R:[.15,.7]},PERC:{A:[.001,.006],D:[.04,.14],S:[0,.18],R:[.03,.12]},PAD:{A:[.3,1.7],D:[.18,.62],S:[.62,.94],R:[.8,3.2]},LEAD:{A:[.004,.028],D:[.07,.24],S:[.32,.72],R:[.1,.45]},ARP:{A:[.001,.01],D:[.07,.3],S:[.04,.32],R:[.12,.75]},STRINGS:{A:[.22,1.3],D:[.14,.48],S:[.58,.92],R:[.48,2.2]},CHOIR:{A:[.75,2.4],D:[.22,.75],S:[.68,.96],R:[1,3.8]}},Ge={KICK:[33,48],BASS:[28,52],PERC:[42,82],PAD:[48,84],LEAD:[52,88],ARP:[60,96],STRINGS:[45,76],CHOIR:[48,80]},at=(Gn,Jr,zr)=>Gn+(Jr-Gn)*zr,dt={};for(const Gn of["KICK","BASS","PERC","PAD","LEAD","ARP","STRINGS","CHOIR"]){const Jr=We[Gn],zr=Sc[Jr[Math.floor(T()*Jr.length)]],oo=jt[Gn];dt[Gn]={proportion:Gn==="KICK"?T()<.45?1:2:1+Math.floor(T()*3),pitchRange:Ge[Gn],waveform:zr.wave,filterType:zr.fType,filterFreq:Math.max(40,zr.fFreq*at(.6,1.55,T())),filterQ:Math.max(.3,zr.fQ*at(.5,1.9,T())),envelope:{attack:at(oo.A[0],oo.A[1],T()),decay:at(oo.D[0],oo.D[1],T()),sustain:at(oo.S[0],oo.S[1],T()),release:at(oo.R[0],oo.R[1],T())},gainScale:Math.max(.1,zr.gain*at(.6,1.4,T())),detune:zr.det+(T()-.5)*26,panSpread:.28+T()*.72,maxVoices:2+Math.floor(T()*5),cooldownMin:Math.max(.05,zr.cd*at(.45,1.65,T()))}}const it={id:`rnd_${Date.now()}`,name:"Random",description:"Generative",vibe:"",tags:["random"],intensity:T(),bpm:$n,root:er,scale:pr,harmonyMode:Fr,eventRate:ha,quantaCount:Lr,trailLen:Za,particleGlow:Y,roles:dt,syncThreshold:.24+T()*.58,encounterR:.05+T()*.15,entainment:Ye.entainment,reverbAmt:Ta,delayAmt:fa,delayTime:is,masterGain:Ia,lens:"Off",bgPulse:!1,cinematic:!1,primary:Ve,secondary:ht,accent:kt,gateCount:0,attractorCount:0,motionStyle:ze.motionStyle};r.current=it,n.current=up(it),n.current.bpm=$n,l.current={},oe($n),sn(Lr),en(er),Ze(pr),Mt(uo),Pt(ha),Qt(Ye),c.current=Ye,_n(ze.id),Cr.ready&&Cr.restoreGains(Ta*te,fa*te,is,Ia*pe);const Yt=n.current;for(const Gn of Yt.quanta)Gn.x=(T()-.5)*1.55,Gn.y=(T()-.5)*1.55,Gn.vx=(T()-.5)*.06,Gn.vy=(T()-.5)*.06,Gn.phase=T(),Gn.charge=.12+T()*.6,Gn.cooldown=T()*.5,Gn.trailX=[],Gn.trailY=[],Gn.timbreIdx=T()<.38?-1:We[Gn.role][Math.floor(T()*We[Gn.role].length)],Gn.pitch=g0(Gn.pitch,er,pr);const Ue=[8,12,16][Math.floor(T()*3)],Dt=[.5,1,2,4][Math.floor(T()*4)],wn=.22+T()*.55,Wt=["KICK","BASS","PERC","PAD","LEAD","ARP","STRINGS","CHOIR"];Yt.sequencer={...Yt.sequencer,steps:Array.from({length:Ue},()=>({armed:T()<wn,pitchOff:Math.floor((T()-.5)*14),vel:.35+T()*.65,role:T()<.55?null:Wt[Math.floor(T()*8)]})),stepCd:new Array(Ue).fill(0),tempoMult:Dt,x:(T()-.5)*.8,y:(T()-.5)*.8,ringR:.18+T()*.34,active:T()<.6},zn(Ue),xn(Dt),Nn(Yt.sequencer.active),Yt.attractors=[];for(let Gn=0,Jr=Math.floor(T()*5);Gn<Jr;Gn++){const zr=["attractor","repulsor","vortex"][Math.floor(T()*3)],oo=.04+T()*.2;Yt.attractors.push({x:(T()-.5)*1.3,y:(T()-.5)*1.3,strength:zr==="repulsor"?-oo:zr==="vortex"?0:oo,vortexStr:zr==="vortex"?oo*.8:0,radius:.22+T()*.52,type:zr})}Yt.gates=[];const Kn=["gate","gate","mirror","mirror","absorber","membrane","membrane"],ro={gate:[Ve,ht,kt,"#fff"],mirror:["#c8e8ff","#a8d8ef","#d8f0ff"],absorber:["#dd3333","#cc1111","#ff4444"],membrane:["#dd66ff","#cc44ff","#aa22ee"]};for(let Gn=0,Jr=1+Math.floor(T()*7);Gn<Jr;Gn++){const zr=Kn[Math.floor(T()*Kn.length)],oo=(T()-.5)*1.3,Uo=(T()-.5)*1.3,ni=T()*Math.PI,Hs=.1+T()*.52;Yt.gates.push({x1:oo-Math.cos(ni)*Hs,y1:Uo-Math.sin(ni)*Hs,x2:oo+Math.cos(ni)*Hs,y2:Uo+Math.sin(ni)*Hs,cooldown:0,color:ro[zr][Gn%ro[zr].length],type:zr})}sn(Yt.count),An(Gn=>Gn+1)},[te,pe]),vi=S.useCallback(()=>{const T=!go.current;go.current=T,T||(Jo.current=0,Ka.current=-1,Zn(-1)),Gr(T)},[]),Cd=S.useCallback((T,q)=>{wr(U=>U.map((Me,Ve)=>Ve!==T?Me:{...Me,steps:Me.steps.map((ht,kt)=>kt!==q?ht:{...ht,on:!ht.on})}))},[]),E0=S.useCallback(T=>{wr(q=>q.map(U=>{const Me=[...U.steps];for(;Me.length<T;)Me.push({on:!1,vel:.8});for(;Me.length>T;)Me.pop();return{...U,steps:Me}})),jr(T),Ka.current=-1,Jo.current=0},[]),kd=S.useCallback(T=>{wr(q=>q.map((U,Me)=>Me!==T?U:{...U,muted:!U.muted}))},[]),_l=S.useCallback(T=>{wr(q=>q.map((U,Me)=>Me!==T?U:{...U,solo:!U.solo}))},[]),T0=S.useCallback((T,q)=>{wr(U=>U.map((Me,Ve)=>Ve!==T?Me:{...Me,steps:Me.steps.map(ht=>({...ht,vel:q}))}))},[]),I0=S.useCallback(T=>{wr(q=>q.map((U,Me)=>Me!==T?U:{...U,steps:U.steps.map(Ve=>({...Ve,on:!1}))}))},[]),Rd=S.useCallback(T=>{wr(q=>q.map(U=>{const Me=T.steps[U.role],Ve=U.steps.map((ht,kt)=>({...ht,on:Me?Me.includes(kt):!1}));return{...U,steps:Ve}}))},[]),Vu=S.useCallback(()=>{wr(T=>T.map(q=>({...q,steps:q.steps.map(U=>({...U,on:!1}))})))},[]),Ad=S.useCallback(()=>{const T=vo.current;if(!T)return;let q;try{Cr.ready&&(q=Cr.createAudioStream())}catch{}T.start(()=>[t.current],()=>{const U=r.current;return{labName:`Music Lab  ${U.name}`,lines:[`Preset: ${U.name}    ${U.bpm} BPM`,`Scale: ${U.root} ${U.scale}    ${U.motionStyle}`,q?" udio + vdeo":" apenas vdeo"]}},30,q)},[]),Uu=S.useCallback(()=>{var T;(T=vo.current)==null||T.stop()},[]),Yu=S.useCallback(()=>{const T=n.current;if(!T)return;const q=!T.sequencer.active;T.sequencer.active=q,Nn(q)},[]),Ku=S.useCallback(T=>{const q=n.current;!q||!q.sequencer.steps[T]||(q.sequencer.steps[T].armed=!q.sequencer.steps[T].armed,An(U=>U+1))},[]),ei=S.useCallback(T=>{const q=n.current;q&&(q.sequencer.tempoMult=T,xn(T))},[]),ss=S.useCallback(T=>{const q=n.current;if(q){for(;q.sequencer.steps.length<T;)q.sequencer.steps.push({armed:!1,pitchOff:0,vel:.65,role:null});for(;q.sequencer.steps.length>T;)q.sequencer.steps.pop();q.sequencer.stepCd=new Array(T).fill(0),zn(T),An(U=>U+1)}},[]),Si=(T,q,U)=>{l.current={...l.current,[T]:{...l.current[T]??{},[q]:U}},An(Me=>Me+1)},wi=(T,q)=>{l.current={...l.current,[T]:{...l.current[T]??{},...q}},An(U=>U+1)},ti=(T,q)=>{var Me,Ve;const U=(Me=l.current[T])==null?void 0:Me[q];return U!==void 0?U:(Ve=r.current.roles[T])==null?void 0:Ve[q]},js=(Ed=n.current)==null?void 0:Ed.quanta.find(T=>T.selected),Ot=r.current,jd=["excite","freeze","spawn","attractor","repulsor","vortex","mutate","erase","channel"].includes(V)?"none":V==="gate"||V==="rail"?"crosshair":V==="tunnel"?"cell":"default",Xu=[{id:"sine",label:""},{id:"triangle",label:""},{id:"sawtooth",label:""},{id:"square",label:""},{id:"noise",label:""},{id:"kick",label:"K"},{id:"snare",label:"S"},{id:"hihat",label:"H"}];return o.jsxs("div",{style:{display:e?"block":"none"},className:"fixed inset-0 z-0",children:[o.jsx("canvas",{ref:t,className:"w-full h-full block",style:{background:"#000",cursor:jd,display:st?"none":"block"},onMouseDown:T=>{g&&x(null),tn(T)},onMouseMove:Fn,onMouseUp:Wn,onMouseLeave:Yn,onContextMenu:co}),st&&n.current&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-full h-full absolute top-0 left-0",children:o.jsx(S.Suspense,{fallback:o.jsx("div",{className:"w-full h-full flex items-center justify-center bg-black",children:o.jsx("div",{className:"text-[#37b2da] text-[9px] uppercase tracking-[0.2em] animate-pulse",style:{fontFamily:Yo},children:"LOADING 3D ENGINE..."})}),children:o.jsx(aU,{state:n.current,width:window.innerWidth,height:window.innerHeight,cameraMode:ct,paused:!R,showGrid:xe,showAxes:Ee,showTrails:je,colorMode:Ae})})}),o.jsxs("div",{className:"fixed bottom-4 right-4 z-30 flex flex-col gap-1.5 pointer-events-auto",style:{fontFamily:Yo},children:[o.jsxs("div",{className:"px-2.5 py-1.5",style:{background:"rgba(0,0,0,0.94)",border:"1px dashed rgba(255,255,255,0.06)"},children:[o.jsx("div",{style:{fontSize:6,letterSpacing:"0.12em",textTransform:"uppercase",color:"rgba(55,178,218,0.40)",marginBottom:3},children:"COLOR"}),o.jsx("div",{className:"flex gap-1",children:["role","charge","velocity"].map(T=>o.jsx("button",{onClick:()=>Tt(T),title:`Colorir por ${T}`,className:"transition-all",style:{fontSize:6,letterSpacing:"0.08em",textTransform:"uppercase",padding:"2px 6px",color:Ae===T?Wr:"rgba(255,255,255,0.22)",background:Ae===T?"rgba(55,178,218,0.06)":"transparent",border:Ae===T?`1px dashed ${Wr}30`:"1px dashed rgba(255,255,255,0.05)"},children:T},T))})]}),o.jsxs("div",{className:"px-2.5 py-1.5",style:{background:"rgba(0,0,0,0.94)",border:"1px dashed rgba(255,255,255,0.06)"},children:[o.jsx("div",{style:{fontSize:6,letterSpacing:"0.12em",textTransform:"uppercase",color:"rgba(55,178,218,0.40)",marginBottom:3},children:"OVERLAYS"}),o.jsx("div",{className:"flex gap-1 flex-wrap",children:[{label:"Grid",v:xe,fn:()=>ge(T=>!T)},{label:"Axes",v:Ee,fn:()=>me(T=>!T)},{label:"Trails",v:je,fn:()=>Te(T=>!T)}].map(({label:T,v:q,fn:U})=>o.jsx("button",{onClick:U,title:`${T}: ${q?"ON":"OFF"}`,className:"transition-all",style:{fontSize:6,letterSpacing:"0.08em",textTransform:"uppercase",padding:"2px 6px",color:q?Wr:"rgba(255,255,255,0.22)",background:q?"rgba(55,178,218,0.06)":"transparent",border:q?`1px dashed ${Wr}30`:"1px dashed rgba(255,255,255,0.05)"},children:T},T))})]}),o.jsxs("div",{className:"px-2.5 py-1.5",style:{background:"rgba(0,0,0,0.94)",border:`1px dashed ${Wr}18`},children:[o.jsxs("div",{className:"flex items-center gap-1.5 mb-0.5",children:[o.jsx("div",{className:"w-1.5 h-1.5 animate-pulse",style:{background:Wr}}),o.jsx("span",{style:{fontSize:7,letterSpacing:"0.12em",textTransform:"uppercase",color:Wr},children:"3D ACTIVE"})]}),o.jsxs("div",{style:{fontSize:6,color:"rgba(255,255,255,0.25)"},children:[o.jsxs("div",{children:[n.current.count," parts  ",ct.replace("3d-","").toUpperCase()]}),o.jsx("div",{style:{fontSize:5,color:"rgba(255,255,255,0.15)",marginTop:2},children:"Drag orbit  Scroll zoom"})]})]})]})]}),As.connected&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{ref:Qs,style:{position:"fixed",pointerEvents:"none",display:"none",transform:"translate(-50%,-50%)",zIndex:50},children:[o.jsx("div",{style:{position:"absolute",width:28,height:28,left:-14,top:-14,borderRadius:"50%",border:"1px solid rgba(0,200,255,0.7)",opacity:.6}}),o.jsx("div",{style:{position:"absolute",left:-10,top:-.5,width:20,height:1,background:"rgba(0,200,255,0.85)"}}),o.jsx("div",{style:{position:"absolute",top:-10,left:-.5,height:20,width:1,background:"rgba(0,200,255,0.85)"}}),o.jsx("div",{style:{position:"absolute",width:4,height:4,left:-2,top:-2,borderRadius:"50%",background:"rgba(0,200,255,0.9)"}})]}),o.jsx(Jj,{ctrl:As,toolName:ye,presetName:b,radius:De,intensity:As.triggers.rt,showHUD:he&&As.connected}),o.jsxs("div",{style:{position:"fixed",top:50,left:8,pointerEvents:"none",display:"flex",alignItems:"center",gap:4,zIndex:30},children:[o.jsx("div",{style:{width:5,height:5,borderRadius:"50%",background:"rgba(0,200,255,0.7)"}}),o.jsx("span",{style:{fontSize:7,color:"rgba(0,200,255,0.5)",letterSpacing:"0.08em"},children:"CTRL"})]})]}),o.jsx(Qj,{open:He,onClose:()=>ut(!1),ctrl:As,presetsSection:{label:"Presets",items:Nu,getLabel:T=>T.name,onSelect:T=>On(T.id)},toolsSection:{label:"Spawn Role",items:["KICK","BASS","PERC","PAD","LEAD","ARP","STRINGS","CHOIR"],getLabel:T=>T,onSelect:T=>Se(T)}}),!I&&o.jsx("div",{className:"fixed top-9 left-0 right-0 z-20 pointer-events-none",style:{fontFamily:Yo},children:o.jsxs("div",{className:"flex items-center pointer-events-auto",style:{background:"rgba(0,0,0,0.94)",borderBottom:"1px dashed rgba(255,255,255,0.06)",height:28},children:[o.jsx("button",{onClick:yi,title:M&&R?"Pause":"Play",className:"flex items-center justify-center transition-all",style:{width:32,height:28,color:M&&R?Wr:"rgba(55,178,218,0.55)",background:M&&R?"rgba(55,178,218,0.06)":"transparent",borderRight:"1px dashed rgba(255,255,255,0.06)"},children:M&&R?o.jsx(md,{size:11}):o.jsx(sc,{size:11})}),o.jsxs("div",{className:"flex items-center gap-1 px-2",style:{borderRight:"1px dashed rgba(255,255,255,0.06)",height:28},children:[o.jsx("input",{type:"range",min:30,max:180,step:1,value:re,onChange:T=>oe(parseInt(T.target.value)),title:`BPM: ${re}`,className:"w-12 h-px appearance-none cursor-pointer",style:{background:"rgba(255,255,255,.08)",accentColor:Wr}}),o.jsx("span",{style:{fontSize:8,color:"rgba(255,255,255,0.40)",width:20,textAlign:"right",fontVariantNumeric:"tabular-nums"},children:re})]}),o.jsxs("div",{className:"flex items-center gap-1 px-2",style:{borderRight:"1px dashed rgba(255,255,255,0.06)",height:28},children:[o.jsx(PF,{size:8,style:{color:"rgba(255,255,255,0.22)",flexShrink:0}}),o.jsx("input",{type:"range",min:0,max:1,step:.01,value:pe,onChange:T=>P(parseFloat(T.target.value)),title:`Volume: ${Math.round(pe*100)}%`,className:"w-10 h-px appearance-none cursor-pointer",style:{background:"rgba(255,255,255,.08)",accentColor:Wr}})]}),o.jsxs("div",{className:"flex items-center gap-1 px-2",style:{borderRight:"1px dashed rgba(255,255,255,0.06)",height:28},children:[o.jsx("span",{style:{fontSize:6,color:"rgba(255,255,255,0.22)",letterSpacing:"0.08em"},children:"FX"}),o.jsx("input",{type:"range",min:0,max:1,step:.01,value:te,onChange:T=>J(parseFloat(T.target.value)),title:`FX: ${Math.round(te*100)}%`,className:"w-10 h-px appearance-none cursor-pointer",style:{background:"rgba(255,255,255,.08)",accentColor:Wr}})]}),o.jsx("div",{style:{width:1,height:16,background:"rgba(255,255,255,0.04)"}}),o.jsxs("button",{onClick:()=>L(!0),title:"Escolher preset",className:"flex items-center gap-1.5 px-3 transition-all",style:{height:28,borderRight:"1px dashed rgba(255,255,255,0.06)"},children:[o.jsx(a2,{size:8,style:{color:Ot.primary+"88",flexShrink:0}}),o.jsx("span",{style:{fontSize:8,color:Ot.primary+"bb",letterSpacing:"0.04em",maxWidth:120,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:Ot.name})]}),o.jsx("button",{onClick:()=>mi((xt+1)%12),title:`Root: ${ps[xt%12]} (click to cycle)`,className:"flex items-center justify-center transition-all",style:{height:28,width:28,fontSize:9,color:"#88ffcc",background:"rgba(136,255,204,0.04)",borderRight:"1px dashed rgba(255,255,255,0.06)"},children:ps[xt%12]}),o.jsx("button",{onClick:()=>{const T=Object.keys(No),q=T.indexOf(At);Tr(T[(q+1)%T.length])},title:`Scale: ${No[At]} (click to cycle)`,className:"flex items-center justify-center transition-all",style:{height:28,fontSize:7,color:"rgba(155,89,255,0.75)",padding:"0 8px",borderRight:"1px dashed rgba(255,255,255,0.06)",letterSpacing:"0.06em",textTransform:"uppercase"},children:No[At]}),o.jsx("div",{className:"flex items-center",style:{borderRight:"1px dashed rgba(255,255,255,0.06)"},children:["Off","Notes","Harmony","Rhythm","Tension","Events"].map(T=>o.jsx("button",{onClick:()=>W(T),title:`Lens: ${T}`,className:"transition-all",style:{height:28,padding:"0 6px",fontSize:6,letterSpacing:"0.06em",textTransform:"uppercase",color:B===T?Wr:"rgba(255,255,255,0.18)",background:B===T?"rgba(55,178,218,0.05)":"transparent",borderBottom:B===T?`1px solid ${Wr}`:"1px solid transparent"},children:T},T))}),o.jsx("div",{style:{width:1,height:16,background:"rgba(255,255,255,0.04)"}}),o.jsx("button",{onClick:()=>E(T=>!T),title:"Cinematic [C]",className:"flex items-center justify-center transition-all",style:{width:26,height:28,color:I?Wr:"rgba(255,255,255,0.18)"},children:o.jsx(ZI,{size:10})}),o.jsx("button",{onClick:()=>Zt(T=>!T),title:"3D Mode",className:"flex items-center justify-center transition-all",style:{width:26,height:28,fontSize:8,color:st?Wr:"rgba(255,255,255,0.18)",fontWeight:st?600:400},children:"3D"}),st&&["3d-orbital","3d-top","3d-side","3d-fpp"].map(T=>o.jsx("button",{onClick:()=>vt(T),title:T.replace("3d-","").toUpperCase(),className:"transition-all",style:{height:28,padding:"0 4px",fontSize:6,letterSpacing:"0.06em",textTransform:"uppercase",color:ct===T?Wr:"rgba(255,255,255,0.18)",borderBottom:ct===T?`1px solid ${Wr}`:"1px solid transparent"},children:T==="3d-orbital"?"ORB":T==="3d-top"?"TOP":T==="3d-side"?"SIDE":"FPP"},T)),o.jsx("button",{onClick:()=>Be(T=>!T),title:"Velocity Vectors",className:"flex items-center justify-center transition-all",style:{width:20,height:28,fontSize:7,fontWeight:gn?700:400,color:gn?Wr:"rgba(255,255,255,0.15)"},children:"V"}),o.jsx("button",{onClick:()=>ks(T=>!T),title:"Overlays [V]",className:"flex items-center justify-center transition-all",style:{width:24,height:28,color:Xo?"rgba(255,255,255,0.22)":"#fbbf24"},children:Xo?o.jsx(jl,{size:9}):o.jsx(Xp,{size:9})}),o.jsx("div",{style:{flex:1}}),o.jsx("button",{onClick:Em,title:"Physics Sandbox",className:"flex items-center justify-center transition-all",style:{width:26,height:28,fontSize:9,color:Fe?"#ff9944":"rgba(255,255,255,0.18)"},children:""}),o.jsx("button",{onClick:Fl,title:"Compose Mode",className:"flex items-center justify-center transition-all",style:{width:26,height:28,color:ne?"#fbbf24":"rgba(255,255,255,0.18)"},children:o.jsx(YP,{size:10})}),ne&&!R&&o.jsx("button",{title:"Exportar capa para Meta-Gen-Art",onClick:()=>{const T=n.current;T&&(Et.current={quanta:T.quanta.map(U=>({...U,trailX:[],trailY:[]})),gates:T.gates.map(U=>({...U})),attractors:T.attractors.map(U=>({...U})),channels:T.channels.map(U=>({...U,pts:[...U.pts]})),rails:T.rails.map(U=>({...U})),tunnels:T.tunnels.map(U=>({...U})),cages:T.cages.map(U=>({...U})),strings:T.strings.map(U=>({...U})),fxZones:T.fxZones.map(U=>({...U,pts:[...U.pts]}))},Ct(!0)),nt(!1),pt.current=null,s.current=!0,j(!0);const q=r.current;Cr.ready&&Cr.restoreGains(q.reverbAmt*Go.current,q.delayAmt*Go.current,q.delayTime,q.masterGain*bi.current)},title:"Release composition",className:"flex items-center justify-center animate-pulse transition-all",style:{width:26,height:28,color:"#4ade80"},children:o.jsx(sc,{size:11})}),o.jsx("button",{onClick:cl,title:_t?"Restore":"Reset",className:"flex items-center justify-center transition-all",style:{width:26,height:28,color:_t?"rgba(251,191,36,0.65)":"rgba(255,255,255,0.18)"},children:o.jsx(El,{size:9})}),o.jsx("button",{onClick:Md,title:"Preset aleatrio",className:"flex items-center justify-center transition-all",style:{width:26,height:28,color:"rgba(255,255,255,0.18)"},children:o.jsx($I,{size:9})}),o.jsx("button",{onClick:()=>{wd()},title:"Exportar capa  Meta-Gen-Art",className:"flex items-center justify-center transition-all",style:{width:26,height:28,color:H>0&&Date.now()-H<3e3?"#4ade80":"rgba(255,255,255,0.18)"},children:o.jsx(tM,{size:9})}),o.jsx("button",{onClick:()=>Er(!0),title:"Guia",className:"flex items-center justify-center transition-all",style:{width:26,height:28,color:"rgba(55,178,218,0.45)"},children:o.jsx(Yk,{size:9})}),o.jsx("button",{onClick:Po,title:"Limpar tudo",className:"flex items-center justify-center transition-all",style:{width:26,height:28,color:"rgba(255,255,255,0.15)"},children:o.jsx(il,{size:9})}),o.jsx("div",{style:{width:1,height:16,background:"rgba(255,255,255,0.04)",margin:"0 2px"}}),o.jsx("div",{className:"flex items-center gap-1 px-2",style:{height:28},children:o.jsx("span",{style:{fontSize:7,color:"rgba(255,255,255,0.22)",fontVariantNumeric:"tabular-nums"},children:Rn})}),o.jsx(n6,{zoom:v.zoom,onZoomIn:v.zoomIn,onZoomOut:v.zoomOut,onReset:v.resetView,accentColor:Ot.primary})]})}),!I&&o.jsxs("div",{className:"fixed left-0 z-20 flex flex-col items-start",style:{top:68,bottom:lo?258:32,fontFamily:Yo},children:[o.jsx("div",{className:"flex flex-col overflow-y-auto",style:{width:36,background:"rgba(0,0,0,0.94)",borderRight:"1px dashed rgba(255,255,255,0.06)",scrollbarWidth:"none"},children:[{label:"",tools:J0.filter(q=>["select","spawn","gate","erase"].includes(q.id))},{label:"",tools:J0.filter(q=>["attractor","repulsor","vortex","excite","freeze","mutate"].includes(q.id))},{label:"",tools:J0.filter(q=>["channel","rail","tunnel"].includes(q.id))},{label:"",tools:J0.filter(q=>["mirror","absorber","membrane"].includes(q.id))},{label:"",tools:J0.filter(q=>["cage","string","zone","metro"].includes(q.id))}].map((q,U)=>o.jsxs(on.Fragment,{children:[U>0&&o.jsx("div",{style:{height:1,background:"rgba(255,255,255,0.04)",margin:"2px 6px"}}),q.tools.map(Me=>o.jsxs("button",{onClick:()=>fe(Me.id),title:`${Me.label} [${Me.key}]`,className:"flex items-center justify-center transition-all relative",style:{width:36,height:28,color:V===Me.id?Me.color:"rgba(255,255,255,.28)",background:V===Me.id?`${Me.color}0c`:"transparent"},children:[V===Me.id&&o.jsx("div",{style:{position:"absolute",left:0,top:4,bottom:4,width:2,background:Me.color}}),o.jsx("span",{style:{fontSize:13,lineHeight:1},children:Me.icon})]},Me.id))]},U))}),(()=>{var U,Me;if(!(V==="spawn"||V==="excite"||V==="freeze"||V==="attractor"||V==="repulsor"||V==="vortex"||V==="zone"||V==="metro"||V==="select"&&js))return null;const q=((U=J0.find(Ve=>Ve.id===V))==null?void 0:U.color)??Wr;return o.jsxs("div",{style:{position:"absolute",left:38,top:0,width:140,background:"rgba(0,0,0,0.94)",border:"1px dashed rgba(255,255,255,0.06)",borderLeft:"none",padding:8,maxHeight:"60vh",overflowY:"auto",scrollbarWidth:"none"},children:[o.jsx("div",{style:{fontFamily:Yo,fontSize:7,color:`${q}88`,letterSpacing:"0.10em",textTransform:"uppercase",marginBottom:6},children:(Me=J0.find(Ve=>Ve.id===V))==null?void 0:Me.label}),(V==="excite"||V==="freeze")&&o.jsx(ao,{label:"Brush R",value:De,min:.04,max:.4,step:.01,display:Ve=>`${(Ve*100).toFixed(0)}%`,color:V==="excite"?"#ff8800":"#88ddff",onChange:_e}),(V==="attractor"||V==="repulsor"||V==="vortex")&&o.jsx(ao,{label:"Strength",value:ae,min:.02,max:.5,step:.01,display:Ve=>Ve.toFixed(2),color:V==="repulsor"?"#ff4400":V==="vortex"?"#cc44ff":"#00aaff",onChange:Re}),V==="metro"&&o.jsx(ao,{label:"Beat Str",value:mn,min:.02,max:.5,step:.01,display:Ve=>Ve.toFixed(2),color:"#ffcc00",onChange:dr}),V==="zone"&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"grid grid-cols-3 gap-0.5 mb-2",style:{maxHeight:100,overflowY:"auto"},children:[{id:"slow",icon:"",label:"Slow"},{id:"fast",icon:"",label:"Fast"},{id:"mute",icon:"",label:"Mute"},{id:"excite_zone",icon:"",label:"Excite"},{id:"freeze_zone",icon:"",label:"Freeze"},{id:"reverse",icon:"",label:"Rev"},{id:"bounce",icon:"",label:"Bounce"},{id:"scatter_zone",icon:"",label:"Scatter"},{id:"vortex_zone",icon:"",label:"Vortex"},{id:"glitch",icon:"",label:"Glitch"},{id:"pitch_up",icon:"",label:"P"},{id:"pitch_down",icon:"",label:"P"},{id:"transpose",icon:"",label:"Trans"},{id:"harmonize_zone",icon:"",label:"Harm"},{id:"tremolo",icon:"",label:"Trem"},{id:"warp",icon:"",label:"Warp"},{id:"phase_lock",icon:"",label:"Phase"},{id:"role_shift",icon:"",label:"Role"}].map(Ve=>o.jsxs("button",{onClick:()=>ar(Ve.id),title:Ve.label,className:"text-[5px] py-0.5 transition-all text-center",style:{color:kn===Ve.id?"#ff88cc":"rgba(255,255,255,0.30)",background:kn===Ve.id?"rgba(255,136,204,0.08)":"transparent",border:kn===Ve.id?"1px dashed rgba(255,136,204,0.35)":"1px dashed rgba(255,255,255,0.04)"},children:[o.jsx("span",{style:{fontSize:8},children:Ve.icon}),o.jsx("br",{}),Ve.label]},Ve.id))}),o.jsx(ao,{label:"Strength",value:jn,min:0,max:1,step:.01,display:Ve=>`${(Ve*100).toFixed(0)}%`,color:"#ff44cc",onChange:yr}),o.jsx(ao,{label:"Param",value:Bt,min:0,max:1,step:.01,display:Ve=>`${(Ve*100).toFixed(0)}%`,color:"#cc88ff",onChange:qt})]}),V==="spawn"&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"flex gap-0.5 mb-2 flex-wrap",children:Ah.map(Ve=>o.jsx("button",{onClick:()=>Se(Ve),title:Ve,className:"transition-all",style:{width:14,height:14,background:ye===Ve?ga[Ve]:`${ga[Ve]}22`,border:ye===Ve?`1px solid ${ga[Ve]}`:"1px dashed rgba(255,255,255,0.08)"}},Ve))}),o.jsx(ao,{label:"Count",value:we,min:1,max:10,step:1,display:Ve=>String(Ve),color:"#aaffaa",onChange:ke})]}),V==="select"&&js&&o.jsxs("div",{className:"flex flex-col gap-1",children:[o.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap",style:{fontSize:7},children:[o.jsx("span",{style:{color:ga[js.role]},children:js.role}),o.jsxs("span",{style:{color:"rgba(255,255,255,0.30)"},children:["p:",js.pitch," c:",js.charge.toFixed(2)]})]}),o.jsxs("div",{className:"grid grid-cols-4 gap-0.5 mt-1",children:[o.jsx("button",{onClick:()=>{js.timbreIdx=-1,An(Ve=>Ve+1)},title:"Usar timbre padro da role",className:"text-[5px] py-0.5 text-center transition-all",style:{color:js.timbreIdx===-1?"#fff":"rgba(255,255,255,0.25)",background:js.timbreIdx===-1?"rgba(255,255,255,0.08)":"transparent",border:"1px dashed rgba(255,255,255,0.06)"},children:"Role"}),Sc.map((Ve,ht)=>o.jsx("button",{onClick:()=>{js.timbreIdx=ht,An(kt=>kt+1)},title:Ve.name,className:"text-[8px] py-0.5 text-center transition-all",style:{color:js.timbreIdx===ht?Ve.color:"rgba(255,255,255,0.25)",background:js.timbreIdx===ht?`${Ve.color}18`:"transparent",border:js.timbreIdx===ht?`1px dashed ${Ve.color}55`:"1px dashed rgba(255,255,255,0.04)"},children:Ve.icon},ht))]})]})]})})()]}),!I&&o.jsx(nf,{id:"ml_powers",title:"POWERS",defaultX:40,defaultY:98,zIndex:22,children:o.jsxs("div",{className:"flex items-center gap-0.5 px-1 py-1 flex-wrap",style:{maxWidth:220},children:[[{icon:"",fn:Ao,color:"#ff8800",title:"Excite All"},{icon:"",fn:as,color:"#88ddff",title:"Freeze All"},{icon:"",fn:aa,color:"#ff4444",title:"Explode"},{icon:"",fn:$a,color:"#aa88ff",title:"Compress"},{icon:"",fn:Vo,color:"#aaffaa",title:"Scatter"},{icon:"+",fn:Zs,color:"#88aaff",title:"+10 Quanta"},{icon:"",fn:ms,color:"#ff8866",title:"-10 Quanta"}].map(T=>o.jsx("button",{onClick:T.fn,title:T.title,className:"flex items-center justify-center transition-all hover:scale-110",style:{width:24,height:24,fontSize:11,color:`${T.color}aa`,background:"rgba(0,0,0,0.85)",border:"1px dashed rgba(255,255,255,0.06)"},children:T.icon},T.title)),o.jsxs("div",{className:"relative",children:[o.jsx("button",{onClick:()=>oa(T=>!T),title:"Clear...",className:"flex items-center justify-center transition-all",style:{width:24,height:24,color:"rgba(255,255,255,0.22)",background:"rgba(0,0,0,0.85)",border:"1px dashed rgba(255,255,255,0.06)"},children:o.jsx(il,{size:10})}),Eo&&o.jsx("div",{className:"absolute left-0 top-[26px] flex flex-col z-50",style:{background:"rgba(0,0,0,0.96)",border:"1px dashed rgba(255,255,255,0.06)",minWidth:100},children:[{label:"Clear All",fn:Io,color:"#ff4466"},{label:"Gates",fn:Ja,color:"#ffaaff"},{label:"Attractors",fn:Ba,color:"#ffccaa"},{label:"Fields",fn:Pl,color:"#c0c8d0"},{label:"Cage/Str/Zone",fn:hr,color:"#00ffcc"},{label:"Reset Matrix",fn:Oo,color:"#88ccff"}].map(T=>o.jsx("button",{onClick:()=>{T.fn(),oa(!1)},title:T.label,className:"text-left px-2.5 py-1.5 hover:bg-white/5 transition-all",style:{fontSize:7,color:`${T.color}aa`},children:T.label},T.label))})]})]})}),!I&&o.jsx(nf,{id:"ml_qseq",title:"QSEQ",defaultX:Xe?window.innerWidth-344:window.innerWidth-148,defaultY:98,zIndex:22,width:148,headerExtra:o.jsx("button",{onClick:Yu,title:Rt?"Desativar sequencer":"Ativar sequencer",className:"transition-all",style:{fontSize:6,padding:"1px 6px",color:Rt?Wr:"rgba(255,255,255,0.25)",background:Rt?`${Wr}10`:"transparent",border:Rt?`1px dashed ${Wr}50`:"1px dashed rgba(255,255,255,0.06)"},children:Rt?"ON":"OFF"}),children:o.jsxs("div",{style:{padding:"4px 8px 6px"},children:[o.jsxs("div",{className:"flex items-center gap-0.5 mb-1",children:[[8,12,16].map(T=>o.jsx("button",{onClick:()=>ss(T),title:`${T} steps`,style:{fontSize:5,padding:"1px 4px",color:Ln===T?Wr:"rgba(255,255,255,0.18)",border:Ln===T?`1px dashed ${Wr}40`:"1px dashed rgba(255,255,255,0.04)"},children:T},T)),o.jsx("div",{style:{width:1,height:8,background:"rgba(255,255,255,0.04)",margin:"0 2px"}}),[.5,1,2,4].map(T=>o.jsxs("button",{onClick:()=>ei(T),title:`Velocidade ${T}`,style:{fontSize:5,padding:"1px 3px",color:It===T?Wr:"rgba(255,255,255,0.18)",border:It===T?`1px dashed ${Wr}40`:"1px dashed rgba(255,255,255,0.04)"},children:[T,""]},T))]}),o.jsx("div",{className:"grid gap-0.5",style:{gridTemplateColumns:`repeat(${Math.min(Ln,8)},1fr)`},children:Array.from({length:Ln}).map((T,q)=>{var Ve,ht,kt;const U=((ht=(Ve=n.current)==null?void 0:Ve.sequencer.steps[q])==null?void 0:ht.armed)??!1,Me=Rt&&Math.floor((((kt=n.current)==null?void 0:kt.sequencer.cursor)??0)*Ln)===q;return o.jsx("button",{onClick:()=>Ku(q),title:`Beat ${q+1}: ${U?"armado":"desarmado"}`,style:{height:14,fontSize:5,position:"relative",color:U?Wr:"rgba(255,255,255,0.18)",background:U?`${Wr}20`:"rgba(255,255,255,0.02)",border:Me?"1px solid rgba(255,255,255,0.6)":U?`1px dashed ${Wr}50`:"1px dashed rgba(255,255,255,0.04)"},children:q+1},q)})})]})}),!I&&o.jsxs("div",{className:"fixed top-[68px] right-0 z-20 flex flex-row-reverse",style:{bottom:lo?258:32},children:[o.jsx("button",{onClick:()=>Ut(T=>!T),title:Xe?"Fechar painel":"Abrir painel de controles",className:"absolute -left-4 top-4 z-30 w-4 h-8 flex items-center justify-center transition-all",style:{background:"rgba(0,0,0,0.94)",border:"1px dashed rgba(255,255,255,0.06)",borderRight:"none",color:"rgba(255,255,255,0.22)"},children:Xe?o.jsx(hs,{size:9}):o.jsx(ym,{size:9})}),Xe&&o.jsxs("div",{className:"w-[200px] flex flex-col overflow-y-auto",style:{scrollbarWidth:"thin",scrollbarColor:"rgba(55,178,218,.08) transparent",fontFamily:Yo,background:"rgba(0,0,0,0.94)",borderLeft:"1px dashed rgba(255,255,255,0.06)"},children:[o.jsxs("button",{onClick:()=>L(!0),title:"Escolher preset",className:"flex items-center gap-1.5 px-3 py-2 transition-all hover:bg-white/[0.03]",style:{borderBottom:"1px dashed rgba(255,255,255,0.05)"},children:[o.jsx(a2,{size:8,style:{color:Ot.primary+"88"}}),o.jsx("span",{style:{fontSize:8,color:Ot.primary+"bb",letterSpacing:"0.04em"},children:Ot.name}),o.jsx("span",{style:{fontSize:6,color:"rgba(255,255,255,0.15)",marginLeft:"auto"},children:"change"})]}),o.jsxs("button",{onClick:()=>F(!0),title:"Salvar / carregar composies",className:"flex items-center gap-1.5 px-3 py-2 transition-all hover:bg-white/[0.03]",style:{borderBottom:"1px dashed rgba(255,255,255,0.05)"},children:[o.jsx(tM,{size:8,style:{color:"rgba(125,211,252,0.88)"}}),o.jsx("span",{style:{fontSize:8,color:"rgba(125,211,252,0.9)",letterSpacing:"0.04em"},children:"Minhas composies"})]}),o.jsx("div",{className:"flex",style:{flexWrap:"wrap",borderBottom:"1px dashed rgba(255,255,255,0.05)"},children:[{id:"timbre",label:"Timbre",icon:o.jsx(iF,{size:7,className:"inline mr-0.5"})},{id:"harmony",label:"Harmony",icon:o.jsx(a2,{size:7,className:"inline mr-0.5"})},{id:"physics",label:"Physics",icon:o.jsx($u,{size:7,className:"inline mr-0.5"})},{id:"matrix",label:"Matrix",icon:o.jsx("span",{style:{fontSize:7,marginRight:2},children:""})},{id:"palette",label:"Palette",icon:o.jsx("span",{style:{fontSize:7,marginRight:2},children:""})},{id:"aesthetic",label:"Look",icon:o.jsx("span",{style:{fontSize:7,marginRight:2},children:""})},{id:"morin",label:"Morin",icon:o.jsx("span",{style:{fontSize:7,marginRight:2},children:""})}].map(T=>o.jsxs("button",{onClick:()=>Ke(T.id),title:T.label,className:"flex-1 py-1.5 transition-all min-w-[38px]",style:{fontSize:6,letterSpacing:"0.12em",textTransform:"uppercase",color:Le===T.id?Wr:"rgba(255,255,255,0.22)",background:Le===T.id?"rgba(55,178,218,0.04)":"transparent",borderBottom:Le===T.id?`1px solid ${Wr}`:"1px solid transparent"},children:[T.icon,T.label]},T.id))}),Le==="timbre"&&o.jsxs("div",{className:"flex flex-col gap-3 p-3",children:[o.jsxs("div",{children:[o.jsx("div",{className:"uppercase",style:{fontFamily:Fa,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)",marginBottom:5},children:"TIMBRE TEMPLATES"}),o.jsx("div",{className:"grid grid-cols-3 gap-0.5",children:Sc.map(T=>o.jsxs("button",{title:T.name,onClick:()=>wi(mt,{waveform:T.wave,filterType:T.fType,filterFreq:T.fFreq,filterQ:T.fQ,envelope:T.env,gainScale:T.gain,detune:T.det,cooldownMin:T.cd}),className:"flex flex-col items-center gap-0.5 p-1 transition-all",style:{color:T.color,border:"1px dashed rgba(255,255,255,0.05)",background:"transparent"},title:T.name,children:[o.jsx("span",{className:"text-[10px] leading-none",children:T.icon}),o.jsx("span",{className:"text-[5px] font-mono uppercase tracking-wider text-white/45 leading-none text-center",children:T.name})]},T.name))}),o.jsx("div",{className:"mt-1 text-[5.5px] font-mono text-white/18 text-center",children:"aplica timbre  role selecionada "})]}),o.jsxs("div",{children:[o.jsx("div",{className:"uppercase",style:{fontFamily:Fa,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)",marginBottom:5},children:"EDIT ROLE"}),o.jsx("div",{className:"grid grid-cols-4 gap-0.5",children:Ah.map(T=>o.jsx("button",{onClick:()=>an(T),title:`Editar role: ${T}`,className:`text-[6px] uppercase py-1 transition-all
                            ${mt===T?"bg-white/10":"hover:bg-white/5"}`,style:{color:mt===T?ga[T]:"rgba(255,255,255,.3)",borderBottom:`1px solid ${mt===T?ga[T]:"transparent"}`,borderRadius:0},children:T.slice(0,3)},T))}),o.jsxs("div",{className:"mt-1 flex items-center justify-between px-0.5",children:[o.jsxs("span",{className:"text-[6px] font-mono text-white/20",children:[((So=n.current)==null?void 0:So.quanta.filter(T=>T.role===mt).length)??0," quanta"]}),o.jsxs("div",{className:"flex gap-1",children:[o.jsxs("button",{onClick:()=>Hi(mt),title:"Random timbre para este role",className:"text-[5.5px] uppercase px-1.5 py-0.5 border border-white/[0.06] text-white/30 hover:text-[#37b2da] hover:border-[#37b2da]/30 bg-black transition-all flex items-center gap-0.5",style:{borderRadius:0},children:[o.jsx(El,{size:6})," Rand"]}),o.jsx("button",{onClick:()=>{l.current[mt]={},An(T=>T+1)},title:"Reset role ao padro do preset",className:"text-[5.5px] uppercase px-1.5 py-0.5 border border-white/[0.06] text-white/20 hover:text-white/55 hover:border-white/15 bg-black transition-all",style:{borderRadius:0},children:"Reset"})]})]}),o.jsx("div",{className:"mt-0.5 text-[5px] font-mono text-white/18 px-0.5",children:(()=>{const T=ti(mt,"waveform"),q=ti(mt,"filterFreq")??800,U=Sc.find(Me=>Me.wave===T&&Math.abs(Me.fFreq-q)<200);return U?o.jsxs("span",{style:{color:U.color},children:[U.icon," ",U.name]}):o.jsxs("span",{className:"text-white/18",children:["Custom / ",T]})})()})]}),o.jsxs("div",{children:[o.jsx("div",{className:"uppercase",style:{fontFamily:Fa,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)",marginBottom:4},children:"WAVEFORM"}),o.jsx("div",{className:"grid grid-cols-4 gap-0.5",children:Xu.map(T=>o.jsx("button",{onClick:()=>Si(mt,"waveform",T.id),className:`text-[10px] py-1 transition-all
                            ${ti(mt,"waveform")===T.id?"bg-white/12 text-white/90":"text-white/30 hover:text-white/60 hover:bg-white/5"}`,style:{borderRadius:0},title:String(T.id),children:T.label},T.id))})]}),o.jsxs("div",{className:"flex flex-col gap-1.5",children:[o.jsx(ao,{label:"Filter Freq",value:ti(mt,"filterFreq")??800,min:40,max:8e3,step:10,display:T=>`${T}Hz`,color:ga[mt],onChange:T=>Si(mt,"filterFreq",T)}),o.jsx(ao,{label:"Filter Q",value:ti(mt,"filterQ")??1,min:.1,max:20,step:.1,display:T=>T.toFixed(1),color:ga[mt],onChange:T=>Si(mt,"filterQ",T)})]}),o.jsxs("div",{className:"flex flex-col gap-1.5",children:[o.jsx("div",{className:"uppercase",style:{fontFamily:Fa,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)"},children:"ENVELOPE"}),["attack","decay","sustain","release"].map(T=>{var Me;const q=T==="sustain",U=(Me=ti(mt,"envelope"))==null?void 0:Me[T];return o.jsx(ao,{label:T[0].toUpperCase()+T.slice(1),value:U??q?.6:.3,min:0,max:q?1:3,step:.01,display:Ve=>q?Ve.toFixed(2):`${Ve.toFixed(2)}s`,color:ga[mt],onChange:Ve=>Si(mt,"envelope",{...ti(mt,"envelope")??{attack:.01,decay:.2,sustain:.6,release:.3},[T]:Ve})},T)})]}),o.jsxs("div",{className:"flex flex-col gap-1.5",children:[o.jsx(ao,{label:"Gain",value:ti(mt,"gainScale")??.6,min:0,max:1,step:.01,display:T=>T.toFixed(2),color:ga[mt],onChange:T=>Si(mt,"gainScale",T)}),o.jsx(ao,{label:"Detune",value:ti(mt,"detune")??0,min:-100,max:100,step:1,display:T=>`${T}`,color:ga[mt],onChange:T=>Si(mt,"detune",T)}),o.jsx(ao,{label:"Cooldown",value:ti(mt,"cooldownMin")??.25,min:.05,max:3,step:.05,display:T=>`${T.toFixed(2)}s`,color:ga[mt],onChange:T=>Si(mt,"cooldownMin",T)})]})]}),Le==="harmony"&&o.jsxs("div",{className:"flex flex-col gap-3 p-3",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"uppercase",style:{fontFamily:Fa,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)",marginBottom:5},children:["NOTA RAIZ  ",o.jsx("span",{style:{color:"#88ffcc"},children:ps[xt%12]})]}),o.jsx("div",{className:"grid grid-cols-6 gap-0.5",children:ps.map((T,q)=>o.jsx("button",{onClick:()=>mi(q),title:`Root: ${T}`,className:`text-[6px] py-1.5 transition-all text-center
                            ${xt===q?"bg-[#37b2da]/15 border border-[#37b2da]/50 text-[#37b2da]":T.includes("#")||T.includes("b")?"bg-white/[0.02] border border-white/[0.06] text-white/30 hover:bg-white/6 hover:text-white/55":"bg-white/[0.04] border border-white/[0.08] text-white/45 hover:bg-white/10 hover:text-white/70"}`,style:{borderRadius:0},children:T},T))})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"uppercase",style:{fontFamily:Fa,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)",marginBottom:5},children:["ESCALA  ",o.jsx("span",{style:{color:"#88ffcc"},children:No[At]})]}),o.jsx("div",{className:"grid grid-cols-3 gap-0.5",children:Object.keys(No).map(T=>o.jsx("button",{onClick:()=>Tr(T),title:`Escala: ${No[T]}`,className:`text-[5.5px] uppercase py-1.5 text-center transition-all
                            ${At===T?"bg-[#37b2da]/15 border border-[#37b2da]/50 text-[#37b2da]":"border border-dashed border-white/[0.04] text-white/30 hover:border-white/12 hover:text-white/55"}`,style:{background:"transparent"},children:No[T]},T))})]}),o.jsxs("div",{children:[o.jsx("div",{className:"uppercase",style:{fontFamily:Fa,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)",marginBottom:5},children:"MODO HARMNICO"}),o.jsx("div",{className:"flex gap-1",children:["consonant","any","dissonant"].map(T=>o.jsx("button",{onClick:()=>bd(T),title:T==="consonant"?"S notas consonantes":T==="dissonant"?"Prioriza dissonncias":"Qualquer intervalo",className:`flex-1 text-[5.5px] uppercase py-1.5 transition-all
                            ${yt===T?"bg-[#37b2da]/15 border border-[#37b2da]/50 text-[#37b2da]":"border border-dashed border-white/[0.04] text-white/25 hover:border-white/12 hover:text-white/50"}`,style:{background:"transparent"},children:T==="consonant"?"Tonal":T==="dissonant"?"Clash":"Free"},T))}),o.jsx("div",{className:"mt-0.5 text-[5px] font-mono text-white/18 text-center leading-snug",children:yt==="consonant"?"S acorda notas consonantes":yt==="dissonant"?"Prioriza dissonncias":"Toca qualquer intervalo"})]}),o.jsxs("div",{className:"border-t border-dashed border-white/[0.06] pt-2",children:[o.jsx("div",{className:"uppercase",style:{fontFamily:Fa,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)",marginBottom:5},children:"MAPEAMENTO"}),o.jsxs("div",{className:"flex gap-1",children:[o.jsx("button",{onClick:()=>wt("preset"),title:"Notas mapeadas pelo preset",className:`flex-1 text-[5.5px] uppercase py-1.5 transition-all
                          ${Cn==="preset"?"bg-[#37b2da]/15 border border-[#37b2da]/50 text-[#37b2da]":"border border-dashed border-white/[0.04] text-white/25 hover:border-white/12 hover:text-white/50"}`,style:{background:"transparent"},children:"Preset"}),o.jsx("button",{onClick:()=>wt("canvas"),title:"Notas mapeadas pela posio no canvas",className:`flex-1 text-[5.5px] uppercase py-1.5 transition-all
                          ${Cn==="canvas"?"bg-[#37b2da]/15 border border-[#37b2da]/50 text-[#37b2da]":"border border-dashed border-white/[0.04] text-white/25 hover:border-white/12 hover:text-white/50"}`,style:{background:"transparent"},children:"Canvas"})]}),o.jsx("div",{className:"mt-0.5 text-[5px] font-mono text-white/18 text-center leading-snug",children:Cn==="preset"?"Pitch vive nos quanta (tool zones ainda modulam)":"X  grau da escala  Y  oitava (respeita pitchRange da role)"})]}),o.jsxs("div",{className:"border-t border-dashed border-white/[0.06] pt-2",children:[o.jsx("div",{className:"uppercase",style:{fontFamily:Fa,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)",marginBottom:5},children:"LIVE PAD  QUANTIZE"}),o.jsx("div",{className:"grid grid-cols-6 gap-0.5",children:dd[At].map((T,q)=>{const U=ps[(xt+T)%12];return o.jsx("button",{onClick:()=>Ro(T),title:`Quantizar para ${U}`,className:"text-[6px] py-1.5 transition-all text-center bg-white/[0.04] border border-white/[0.08] text-white/55 hover:bg-white/10 hover:text-white/75",style:{borderRadius:0},children:U},`${T}_${q}`)})}),o.jsx("div",{className:"mt-1 text-[5px] font-mono text-white/18 text-center leading-snug",children:"Aplica na seleo (ou no quanta mais perto do cursor) sem mudar a raiz global."})]}),o.jsxs("div",{className:"border-t border-dashed border-white/[0.06] pt-2",children:[o.jsx(ao,{label:"Event Rate",value:bn,min:.1,max:4,step:.05,display:T=>`${T.toFixed(2)}`,color:"#88ffcc",onChange:Lc}),o.jsx("div",{className:"mt-0.5 text-[5px] font-mono text-white/18",children:"Frequncia de disparo de notas"})]}),o.jsxs("div",{className:"border-t border-dashed border-white/[0.06] pt-2",children:[o.jsx("div",{className:"uppercase",style:{fontFamily:Fa,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)",marginBottom:5},children:"NOTAS ATIVAS"}),o.jsx("div",{className:"flex flex-wrap gap-0.5",children:dd[At].map(T=>{const q=ps[(xt+T)%12];return o.jsx("button",{onClick:()=>mi((xt+T)%12),title:`Raiz  ${q}`,className:"text-[6px] px-1.5 py-0.5 bg-[#37b2da]/8 border border-[#37b2da]/20 text-[#37b2da]/70 hover:bg-[#37b2da]/15 hover:text-[#37b2da] transition-all",style:{borderRadius:0},children:q},T)})}),o.jsx("div",{className:"mt-1 text-[5px] font-mono text-white/18",children:"Clique numa nota para definir como raiz"})]}),o.jsx("div",{className:"border-t border-dashed border-white/[0.06] pt-2",children:o.jsxs("button",{title:"Sortear root, escala e modo aleatoriamente",onClick:()=>{const T=["major","minor","pentatonic","blues","dorian","phrygian","lydian","mixolydian","whole_tone","harmonic_minor"],q=["consonant","any","any","dissonant"];mi(Math.floor(Math.random()*12)),Tr(T[Math.floor(Math.random()*T.length)]),bd(q[Math.floor(Math.random()*q.length)]),Lc(.4+Math.random()*2.5)},className:"w-full py-1.5 transition-all flex items-center justify-center gap-1",style:{fontSize:7,letterSpacing:"0.10em",textTransform:"uppercase",color:"rgba(255,255,255,0.25)",border:"1px dashed rgba(255,255,255,0.05)",background:"transparent"},children:[o.jsx(El,{size:8})," Campo Harmnico Aleatrio"]})})]}),Le==="physics"&&o.jsxs("div",{className:"flex flex-col gap-2.5 p-3",children:[Fe&&o.jsxs("div",{className:"border border-dashed border-orange-400/15 bg-orange-500/[0.02] p-2 flex flex-col gap-2",style:{borderRadius:0},children:[o.jsxs("div",{className:"flex items-center gap-1.5 mb-0.5",children:[o.jsx("span",{className:"text-[6px] uppercase tracking-[0.16em] text-orange-300/70",children:" BALLISTIC PHYSICS"}),o.jsx("span",{className:"text-[5px] font-mono text-white/20 ml-auto",children:"gravity only"})]}),o.jsxs("div",{className:"flex flex-col gap-0.5",children:[o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx("span",{className:"text-[6px] font-mono text-white/35 w-14",children:" Gravity Y"}),o.jsx("input",{type:"range",min:-2,max:2,step:.005,value:ft.gravityY,onChange:T=>{const q=parseFloat(T.target.value);c.current={...c.current,gravityY:q},Qt(U=>({...U,gravityY:q}))},className:"flex-1 h-px appearance-none cursor-pointer",style:{background:"rgba(255,200,100,.25)"}}),o.jsx("span",{className:"text-[6px] font-mono text-orange-300/60 w-8 text-right",children:ft.gravityY.toFixed(3)})]}),Fe&&o.jsxs("div",{className:"flex items-center gap-0.5 flex-wrap mt-0.5",children:[o.jsx("div",{className:"text-[5px] font-mono text-white/18 w-full mb-0.5",children:"a = g30 wu/s  Earth0.327 cai 2wu em ~0.7s"}),[{label:" Earth",g:.327},{label:" Moon",g:.054},{label:" Mars",g:.126},{label:" Jupiter",g:.822},{label:" Zero",g:0},{label:" Anti",g:-.327}].map(T=>o.jsx("button",{title:`Gravidade: ${T.label} (${T.g.toFixed(3)})`,onClick:()=>{c.current={...c.current,gravityY:T.g},Qt(q=>({...q,gravityY:T.g}))},className:`text-[5px] px-1 py-0.5 border transition-all
                                  ${Math.abs(ft.gravityY-T.g)<.004?"text-yellow-300 border-yellow-400/40 bg-yellow-400/10":"text-white/40 border-white/[0.06] hover:text-orange-300 hover:border-orange-400/30"}`,style:{borderRadius:0},children:T.label},T.label))]})]}),o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx("span",{className:"text-[6px] font-mono text-white/35 w-14",children:" Gravity X"}),o.jsx("input",{type:"range",min:-2,max:2,step:.005,value:ft.gravityX,onChange:T=>{const q=parseFloat(T.target.value);c.current={...c.current,gravityX:q},Qt(U=>({...U,gravityX:q}))},className:"flex-1 h-px appearance-none cursor-pointer",style:{background:"rgba(255,200,100,.25)"}}),o.jsx("span",{className:"text-[6px] font-mono text-orange-300/60 w-8 text-right",children:ft.gravityX.toFixed(Fe?1:2)})]}),o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx("span",{className:"text-[6px] font-mono text-white/35 w-14",children:" Bounce"}),o.jsx("input",{type:"range",min:0,max:1,step:.01,value:ft.restitution??.75,onChange:T=>{const q=parseFloat(T.target.value);c.current={...c.current,restitution:q},Qt(U=>({...U,restitution:q}))},className:"flex-1 h-px appearance-none cursor-pointer",style:{background:"rgba(255,200,100,.25)"}}),o.jsxs("span",{className:"text-[6px] font-mono text-orange-300/60 w-8 text-right",children:[((ft.restitution??.75)*100).toFixed(0),"%"]})]}),o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx("span",{className:"text-[6px] font-mono text-white/35 w-14",children:"~ Air Drag"}),o.jsx("input",{type:"range",min:.96,max:1,step:.001,value:ft.damping,onChange:T=>{const q=parseFloat(T.target.value);c.current={...c.current,damping:q},Qt(U=>({...U,damping:q}))},className:"flex-1 h-px appearance-none cursor-pointer",style:{background:"rgba(255,200,100,.25)"}}),o.jsx("span",{className:"text-[6px] font-mono text-orange-300/60 w-8 text-right",children:(1-ft.damping).toFixed(3)})]}),o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx("span",{className:"text-[6px] font-mono text-white/35 w-14",children:" Max Spd"}),o.jsx("input",{type:"range",min:.1,max:2,step:.05,value:ft.maxSpeed,onChange:T=>{const q=parseFloat(T.target.value);c.current={...c.current,maxSpeed:q},Qt(U=>({...U,maxSpeed:q}))},className:"flex-1 h-px appearance-none cursor-pointer",style:{background:"rgba(255,200,100,.25)"}}),o.jsx("span",{className:"text-[6px] font-mono text-orange-300/60 w-8 text-right",children:ft.maxSpeed.toFixed(2)})]}),o.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5",children:[o.jsx("button",{title:`Bounce Walls: ${c.current.bounceWalls?"ON":"OFF"}`,onClick:()=>{const T=!c.current.bounceWalls;c.current={...c.current,bounceWalls:T},Qt(q=>({...q,bounceWalls:T}))},className:`flex-1 text-[6px] uppercase py-1 border transition-all
                            ${ft.bounceWalls?"border-orange-400/40 text-orange-300/80 bg-orange-500/10":"border-white/[0.06] text-white/30 hover:border-white/15"}`,style:{borderRadius:0},children:ft.bounceWalls?" Wall Bounce ON":" Wall Bounce OFF"}),o.jsx("button",{title:`Physics Only: ${c.current.physicsOnly?"ON":"OFF"}`,onClick:()=>{const T=!c.current.physicsOnly;c.current={...c.current,physicsOnly:T},Qt(q=>({...q,physicsOnly:T}))},className:`flex-1 text-[6px] uppercase py-1 border transition-all
                            ${ft.physicsOnly?"border-orange-400/40 text-orange-300/80 bg-orange-500/10":"border-[#37b2da]/25 text-[#37b2da]/60 hover:border-[#37b2da]/40"}`,style:{borderRadius:0},children:ft.physicsOnly?" Gate Only":" All Notes"})]}),o.jsx("div",{className:"text-[5.5px] font-mono text-white/18 mt-1 leading-relaxed",children:"Spawn bolas com  Compose (drag = velocity) ento  Release"})]}),o.jsxs("div",{children:[o.jsx("div",{className:"uppercase",style:{fontFamily:Fa,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)",marginBottom:5},children:"BEHAVIOR PRESETS"}),o.jsx("div",{className:"grid grid-cols-4 gap-0.5",children:Pp.map(T=>o.jsxs("button",{title:`${T.name}  ${T.description}`,onClick:()=>{_n(T.id);const q=Lb(T,ft);Qt(q),c.current=q},title:`${T.name}  ${T.description}`,className:"flex flex-col items-center gap-0.5 py-1 px-0.5 transition-all",style:{color:nr===T.id?T.color:"rgba(255,255,255,0.30)",background:nr===T.id?T.color+"08":"transparent",border:nr===T.id?`1px dashed ${T.color}40`:"1px dashed rgba(255,255,255,0.04)"},children:[o.jsx("span",{className:"text-[10px] leading-none",children:T.icon}),o.jsx("span",{className:"text-[4.5px] font-mono uppercase tracking-wide leading-none text-center opacity-80",children:T.name})]},T.id))}),nr&&(()=>{const T=Db[nr];return T?o.jsxs("div",{className:"mt-1.5 text-[5.5px] font-mono text-white/28 leading-snug px-0.5",children:[o.jsx("span",{style:{color:T.color+"bb"},children:T.name}),"  ",T.description]}):null})()]}),o.jsxs("div",{className:"border-t border-dashed border-white/[0.06] pt-2",children:[o.jsx("div",{className:"uppercase",style:{fontFamily:Fa,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)",marginBottom:6},children:"MOTION + FORCES"}),o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsx(ao,{label:"Damping",value:ft.damping,min:.9,max:.999,step:.001,display:T=>T.toFixed(3),color:"#88aaff",onChange:T=>Qt(q=>({...q,damping:T}))}),o.jsx(ao,{label:"Cohesion",value:ft.cohesion,min:0,max:3,step:.05,display:T=>T.toFixed(2),color:"#aaffbb",onChange:T=>Qt(q=>({...q,cohesion:T}))}),o.jsx(ao,{label:"Separation",value:ft.separation,min:0,max:3,step:.05,display:T=>T.toFixed(2),color:"#ffbbaa",onChange:T=>Qt(q=>({...q,separation:T}))}),o.jsx(ao,{label:"Max Speed",value:ft.maxSpeed,min:.02,max:.7,step:.01,display:T=>T.toFixed(2),color:"#ffddaa",onChange:T=>Qt(q=>({...q,maxSpeed:T}))}),o.jsx(ao,{label:"Turbulence",value:ft.turbulence,min:0,max:1,step:.01,display:T=>T.toFixed(2),color:"#aaff88",onChange:T=>Qt(q=>({...q,turbulence:T}))}),o.jsx(ao,{label:"Gravity X",value:ft.gravityX,min:ft.motionStyle==="ballistic"?-2:-.4,max:ft.motionStyle==="ballistic"?2:.4,step:.005,display:T=>T.toFixed(3),color:"#ccaaff",onChange:T=>Qt(q=>({...q,gravityX:T}))}),o.jsx(ao,{label:"Gravity Y",value:ft.gravityY,min:ft.motionStyle==="ballistic"?-2:-.4,max:ft.motionStyle==="ballistic"?2:.4,step:.005,display:T=>T.toFixed(3),color:"#ccaaff",onChange:T=>Qt(q=>({...q,gravityY:T}))}),ft.motionStyle==="ballistic"&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"text-[5px] font-mono text-white/20 mt-0.5 mb-1",children:"Preset: efetivo a = g30 wu/s  Earth=0.327 cai ~2wu/0.7s"}),o.jsx("div",{className:"flex gap-0.5 flex-wrap",children:[{label:" Moon",g:.054},{label:" Mars",g:.126},{label:" Earth",g:.327},{label:" Jupiter",g:.822},{label:"Zero",g:0}].map(({label:T,g:q})=>o.jsx("button",{title:`Gravidade: ${T}`,onClick:()=>Qt(U=>({...U,gravityY:q})),className:`text-[5px] px-1 py-0.5 border transition-all
                                  ${Math.abs(ft.gravityY-q)<.004?"text-yellow-300 border-yellow-400/40 bg-yellow-400/10":"text-white/35 border-white/[0.06] hover:text-white/65 hover:border-white/20"}`,style:{borderRadius:0},children:T},T))})]})]})]}),o.jsxs("div",{className:"border-t border-dashed border-white/[0.06] pt-2",children:[o.jsx("div",{className:"uppercase",style:{fontFamily:Fa,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)",marginBottom:6},children:"BEHAVIOR PHYSICS"}),o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsx(ao,{label:"Alignment",value:ft.alignment,min:0,max:2,step:.05,display:T=>T.toFixed(2),color:"#aaeeff",onChange:T=>Qt(q=>({...q,alignment:T}))}),o.jsx(ao,{label:"Zone Radius",value:ft.zoneRadius,min:.03,max:.5,step:.01,display:T=>T.toFixed(2),color:"#88ffdd",onChange:T=>Qt(q=>({...q,zoneRadius:T}))}),o.jsx(ao,{label:"Vortex Force",value:ft.vortexForce,min:0,max:.4,step:.005,display:T=>T.toFixed(3),color:"#cc88ff",onChange:T=>Qt(q=>({...q,vortexForce:T}))}),o.jsx(ao,{label:"Burst Rate",value:ft.burstRate,min:0,max:1,step:.01,display:T=>T.toFixed(2),color:"#ff9944",onChange:T=>Qt(q=>({...q,burstRate:T}))}),o.jsx(ao,{label:"Migration X",value:ft.migrationX,min:-1,max:1,step:.05,display:T=>T.toFixed(2),color:"#ffee88",onChange:T=>Qt(q=>({...q,migrationX:T}))}),o.jsx(ao,{label:"Migration Y",value:ft.migrationY,min:-1,max:1,step:.05,display:T=>T.toFixed(2),color:"#ffee88",onChange:T=>Qt(q=>({...q,migrationY:T}))}),o.jsx(ao,{label:"Cluster Target",value:ft.clusterTarget,min:2,max:20,step:1,display:T=>`${Math.round(T)}`,color:"#88ffaa",onChange:T=>Qt(q=>({...q,clusterTarget:Math.round(T)}))}),o.jsx(ao,{label:"Polarize",value:ft.polarize,min:0,max:1,step:.01,display:T=>T.toFixed(2),color:"#ff6688",onChange:T=>Qt(q=>({...q,polarize:T}))})]})]}),o.jsxs("div",{className:"border-t border-dashed border-white/[0.06] pt-2",children:[o.jsx("div",{className:"uppercase",style:{fontFamily:Fa,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)",marginBottom:6},children:"EMERGENT"}),o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsx(ao,{label:"Mutation Rate",value:ft.mutationRate,min:0,max:1,step:.01,display:T=>T.toFixed(2),color:"#ff88ff",onChange:T=>Qt(q=>({...q,mutationRate:T}))}),o.jsx(ao,{label:"Energy Transfer",value:ft.energyTransfer,min:0,max:1,step:.01,display:T=>T.toFixed(2),color:"#ffcc88",onChange:T=>Qt(q=>({...q,energyTransfer:T}))}),o.jsx(ao,{label:"Entrainment",value:ft.entainment,min:0,max:1,step:.01,display:T=>T.toFixed(2),color:"#88ffcc",onChange:T=>Qt(q=>({...q,entainment:T}))}),o.jsx(lU,{label:"Predator/Prey",on:ft.predatorPrey,color:"#ff8888",onToggle:()=>Qt(T=>({...T,predatorPrey:!T.predatorPrey}))})]})]}),o.jsxs("div",{className:"border-t border-dashed border-white/[0.06] pt-2",children:[o.jsx("div",{className:"uppercase",style:{fontFamily:Fa,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)",marginBottom:5},children:"SYNC"}),o.jsxs("div",{className:"flex flex-col gap-0.5 text-[7px] font-mono text-white/35",children:[o.jsxs("div",{children:["Alignment: ",(((($c=n.current)==null?void 0:$c.syncIntensity)??0)*100).toFixed(0),"%"]}),o.jsxs("div",{children:["Beat: ",((((qc=n.current)==null?void 0:qc.beatPhase)??0)*100).toFixed(0),"%"]}),o.jsxs("div",{children:["Quanta: ",Rn]}),o.jsx("div",{className:"text-[5.5px] text-white/20 mt-0.5 uppercase tracking-wider",children:ft.motionStyle})]})]})]}),Le==="matrix"&&n.current&&(()=>{const T=["KICK","BASS","PERC","PAD","LEAD","ARP","STRINGS","CHOIR"],q=["KCK","BAS","PRC","PAD","LED","ARP","STR","CHO"],U=n.current.userMatrix;return o.jsxs("div",{className:"p-2 flex flex-col gap-2",children:[o.jsx("div",{className:"uppercase",style:{fontFamily:Fa,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)"},children:"INTERACTION MATRIX"}),o.jsxs("div",{className:"text-[5.5px] text-white/18 leading-snug bg-white/[0.02] px-1.5 py-1 border border-dashed border-white/[0.06] mb-1",style:{borderRadius:0},children:["Click +0.1  Shift -0.1  Ctrl reset",o.jsx("br",{}),"Azul=atrao  Vermelho=repulso"]}),o.jsxs("div",{style:{overflowX:"auto"},children:[o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"18px repeat(8,1fr)",gap:1.5,marginBottom:2},children:[o.jsx("div",{}),q.map((Me,Ve)=>o.jsx("div",{style:{fontSize:4.5,textAlign:"center",color:ga[T[Ve]],fontFamily:"monospace",overflow:"hidden"},children:Me},Ve))]}),T.map((Me,Ve)=>o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"18px repeat(8,1fr)",gap:1.5,marginBottom:1.5},children:[o.jsx("div",{style:{fontSize:4.5,color:ga[Me],fontFamily:"monospace",display:"flex",alignItems:"center"},children:q[Ve]}),T.map(ht=>{var er;const kt=((er=U[Me])==null?void 0:er[ht])??0,Ht=kt<0?Math.round(Math.abs(kt)*220):0,$n=kt>0?Math.round(kt*220):0,In=Me===ht;return o.jsx("button",{title:`${Me}${ht}: ${kt.toFixed(1)}`,onClick:pr=>{const Mr=pr.shiftKey?-.1:pr.ctrlKey||pr.metaKey?-(U[Me][ht]??0):.1;n.current.userMatrix[Me][ht]=parseFloat(Math.max(-1,Math.min(1,(U[Me][ht]??0)+Mr)).toFixed(1)),An(Fr=>Fr+1)},style:{background:In?`rgba(255,255,255,${.04+Math.abs(kt)*.1})`:`rgba(${Ht},0,${$n},${.12+Math.abs(kt)*.65})`,border:`1px solid rgba(255,255,255,${.04+Math.abs(kt)*.08})`,borderRadius:2,height:13,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:Math.abs(kt)>.05&&o.jsx("span",{style:{fontSize:4,color:kt<0?"#ff9999":"#99aaff",fontFamily:"monospace"},children:kt.toFixed(1)})},ht)})]},Me))]}),o.jsxs("div",{className:"flex gap-1 mt-1",children:[o.jsx("button",{onClick:Oo,title:"Resetar matriz de interaes",className:"flex-1 text-[6px] text-white/25 hover:text-white/50 transition-all py-1 border border-dashed border-white/[0.06]",style:{borderRadius:0},children:" Reset"}),o.jsx("button",{onClick:qa,title:"Gerar matriz aleatria",className:"flex-1 text-[6px] text-[#37b2da]/45 hover:text-[#37b2da] transition-all py-1 border border-dashed border-[#37b2da]/20 hover:border-[#37b2da]/40",style:{borderRadius:0},children:" Random"})]})]})})(),Le==="palette"&&o.jsxs("div",{className:"p-2 flex flex-col gap-3",children:[o.jsx("div",{className:"uppercase",style:{fontFamily:Fa,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)"},children:"CANVAS PALETTE"}),o.jsxs("div",{children:[o.jsx("div",{className:"text-[5.5px] uppercase text-white/18 tracking-[0.14em] mb-1.5",children:"MODO DE COR"}),o.jsx("div",{className:"grid grid-cols-3 gap-1",children:[{id:"role",label:"Role",c:"#00d4ff"},{id:"mono",label:"Mono",c:"#ffffff"},{id:"neon",label:"Neon",c:"#ff00ff"},{id:"heat",label:"Heat",c:"#ff4400"},{id:"earth",label:"Earth",c:"#c8960a"},{id:"plasma",label:"Plasma",c:"#cc44ff"}].map(T=>o.jsx("button",{title:`Paleta: ${T.label}`,onClick:()=>Ie(q=>({...q,mode:T.id})),className:"py-1.5 px-1 border transition-all text-[6.5px]",style:{borderColor:ee.mode===T.id?T.c+"88":"rgba(255,255,255,0.06)",background:ee.mode===T.id?T.c+"12":"transparent",color:ee.mode===T.id?T.c:"rgba(255,255,255,0.4)",borderRadius:0},children:T.label},T.id))})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[o.jsx("div",{className:"text-[5.5px] uppercase text-white/18 tracking-[0.14em]",children:"CORES POR ROLE"}),Object.keys(ee.roleColorOverrides??{}).length>0&&o.jsx("button",{onClick:()=>Ie(T=>({...T,roleColorOverrides:{}})),title:"Resetar cores personalizadas",className:"text-[5px] font-mono text-white/20 hover:text-white/55 transition-all",children:" reset"})]}),o.jsx("div",{className:"flex flex-col gap-1",children:["KICK","BASS","PERC","PAD","LEAD","ARP","STRINGS","CHOIR"].map(T=>{var Ve,ht;const q=ga[T],U=((Ve=ee.roleColorOverrides)==null?void 0:Ve[T])??q,Me=!!((ht=ee.roleColorOverrides)!=null&&ht[T]);return o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx("div",{className:"w-2 h-2 flex-shrink-0 border border-white/[0.06]",style:{background:U,borderRadius:0}}),o.jsx("span",{className:"text-[5.5px] font-mono w-11 flex-shrink-0",style:{color:U},children:T}),o.jsx("input",{type:"color",value:U,onChange:kt=>Ie(Ht=>({...Ht,roleColorOverrides:{...Ht.roleColorOverrides,[T]:kt.target.value}})),className:"w-6 h-4 cursor-pointer flex-shrink-0 border-0 p-0",style:{background:"transparent",borderRadius:0}}),o.jsx("input",{type:"text",value:U,onChange:kt=>{const Ht=kt.target.value.trim();/^#[0-9a-fA-F]{6}$/.test(Ht)&&Ie($n=>({...$n,roleColorOverrides:{...$n.roleColorOverrides,[T]:Ht}}))},className:"flex-1 min-w-0 bg-white/[0.03] border border-dashed border-white/[0.06] text-[5px] px-1 py-0.5",style:{color:U,borderRadius:0}}),Me&&o.jsx("button",{title:"Resetar cor deste role",onClick:()=>{const kt={...ee.roleColorOverrides};delete kt[T],Ie(Ht=>({...Ht,roleColorOverrides:kt}))},className:"text-[7px] text-white/20 hover:text-white/55 flex-shrink-0 transition-all",children:""})]},T)})})]}),o.jsxs("div",{children:[o.jsx("div",{className:"text-[5.5px] uppercase text-white/18 tracking-[0.14em] mb-1.5",children:"BACKGROUND"}),o.jsx("div",{className:"grid grid-cols-4 gap-1 mb-1.5",children:[{label:"Void",color:"#050810"},{label:"Night",color:"#05050a"},{label:"Pitch",color:"#020202"},{label:"Navy",color:"#050818"},{label:"Forest",color:"#030804"},{label:"Ember",color:"#0a0402"},{label:"Cosmic",color:"#08050f"},{label:"Slate",color:"#060809"}].map(T=>o.jsx("button",{title:`Fundo: ${T.label}`,onClick:()=>Ie(q=>({...q,bgColor:T.color})),className:"flex flex-col items-center py-1.5 border transition-all",style:{borderColor:ee.bgColor===T.color?"rgba(255,255,255,0.45)":"rgba(255,255,255,0.06)",background:T.color,borderRadius:0},children:o.jsx("span",{className:"text-[5px] font-mono text-white/50",children:T.label})},T.label))}),o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx("span",{className:"text-[5px] font-mono text-white/20",children:"Custom"}),o.jsx("input",{type:"color",value:ee.bgColor,onChange:T=>Ie(q=>({...q,bgColor:T.target.value})),className:"w-6 h-4 cursor-pointer border-0 p-0 flex-shrink-0",style:{borderRadius:0}}),o.jsx("input",{type:"text",value:ee.bgColor,onChange:T=>{const q=T.target.value.trim();/^#[0-9a-fA-F]{6}$/.test(q)&&Ie(U=>({...U,bgColor:q}))},className:"flex-1 bg-white/[0.03] border border-dashed border-white/[0.06] text-[5px] px-1 py-0.5 text-white/50",style:{borderRadius:0}})]})]})]}),Le==="aesthetic"&&o.jsxs("div",{className:"p-2 flex flex-col gap-3",children:[o.jsx("div",{className:"uppercase",style:{fontFamily:Fa,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)"},children:"AESTHETIC"}),o.jsxs("div",{children:[o.jsx("div",{className:"text-[5.5px] uppercase text-white/18 tracking-[0.14em] mb-1.5",children:"VISUAL PRESETS"}),o.jsx("div",{className:"grid grid-cols-2 gap-1",children:e6.map(T=>{const q=X===T.id;return o.jsxs("button",{title:`${T.name}: ${T.description}`,onClick:()=>yn(T.id),className:"p-2 border transition-all text-left",style:{borderRadius:0,borderColor:q?`${Wr}66`:"rgba(255,255,255,0.06)",background:q?`${Wr}10`:"rgba(255,255,255,0.02)"},children:[o.jsx("div",{className:"text-[7px] uppercase tracking-widest",style:{color:q?Wr:"rgba(255,255,255,0.45)"},children:T.name}),o.jsx("div",{className:"text-[5.5px] font-mono leading-snug mt-0.5",style:{color:"rgba(255,255,255,0.22)"},children:T.description})]},T.id)})})]}),o.jsxs("div",{className:"border-t border-dashed border-white/[0.06] pt-2 flex flex-col gap-2.5",children:[o.jsx(ao,{label:"Grain",value:ce.canvas.grain,min:0,max:1,step:.01,display:T=>`${Math.round(T*100)}%`,color:"#88ccff",onChange:T=>ue(q=>({...q,canvas:{...q.canvas,grain:T}}))}),o.jsx(ao,{label:"Vignette",value:ce.canvas.vignette,min:0,max:1,step:.01,display:T=>`${Math.round(T*100)}%`,color:"#88aaff",onChange:T=>ue(q=>({...q,canvas:{...q.canvas,vignette:T}}))}),o.jsx(ao,{label:"Glow",value:ce.quanta.glow,min:0,max:1,step:.01,display:T=>`${Math.round(T*100)}%`,color:"#ff88cc",onChange:T=>ue(q=>({...q,quanta:{...q.quanta,glow:T}}))}),o.jsx(ao,{label:"Trail Memory",value:ce.trails.persistence,min:0,max:1,step:.01,display:T=>`${Math.round(T*100)}%`,color:"#cc88ff",onChange:T=>ue(q=>({...q,trails:{...q.trails,persistence:T}}))}),o.jsx(ao,{label:"Connections",value:ce.connections.alpha,min:0,max:1,step:.01,display:T=>`${Math.round(T*100)}%`,color:"#00d4ff",onChange:T=>ue(q=>({...q,connections:{...q.connections,alpha:T}}))}),o.jsx(ao,{label:"Tools Intensity",value:ce.tools.intensity,min:0,max:1.5,step:.01,display:T=>T.toFixed(2),color:"#ffcc44",onChange:T=>ue(q=>({...q,tools:{...q.tools,intensity:T}}))}),o.jsxs("div",{className:"flex items-center justify-between gap-2",children:[o.jsx("span",{className:"text-[5.5px] uppercase tracking-[0.14em] text-white/18",children:"3D overlays"}),o.jsx("button",{title:`Overlays 3D: ${ce.threeD.overlays?"ON":"OFF"}`,onClick:()=>ue(T=>({...T,threeD:{...T.threeD,overlays:!T.threeD.overlays}})),className:"text-[6px] uppercase px-2 py-1 border transition-all",style:{borderRadius:0,borderColor:ce.threeD.overlays?`${Wr}55`:"rgba(255,255,255,0.06)",background:ce.threeD.overlays?`${Wr}12`:"transparent",color:ce.threeD.overlays?Wr:"rgba(255,255,255,0.28)"},children:ce.threeD.overlays?"ON":"OFF"})]}),o.jsx("div",{className:"text-[5px] font-mono text-white/18 leading-snug text-center",children:"(em breve) estes knobs vo controlar camadas do canvas/3D  base j pronta."})]})]}),Le==="morin"&&o.jsxs("div",{className:"p-3 flex flex-col gap-3",children:[o.jsx("div",{className:"uppercase",style:{fontFamily:Fa,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.35)"},children:"COMPLEXIDADE  EDGAR MORIN"}),o.jsx("div",{style:{fontSize:7,color:"rgba(255,255,255,0.30)",lineHeight:1.5,fontFamily:Yo},children:"ndices derivados em tempo real da simulao musical, baseados na teoria da complexidade de Edgar Morin."}),[{key:"dialogica",label:"Dialgica",desc:"Coexistncia de ordem e desordem",c:"#ff6464",v:Dr.dialogica},{key:"recursivo",label:"Recursivo",desc:"Feedback: produto  produtor",c:"#64c8ff",v:Dr.recursivo},{key:"hologramatico",label:"Hologramtico",desc:"A parte contm o todo",c:"#64ffa0",v:Dr.hologramatico},{key:"sapiensDemens",label:"Sapiens / Demens",desc:"Razo vs. paixo criadora",c:"#ffc850",v:Dr.sapiensDemens},{key:"tetralogia",label:"Tetralogia",desc:"Ciclo ordemdesordeminteraesorganizao",c:"#b478ff",v:Dr.tetralogia}].map(({key:T,label:q,desc:U,c:Me,v:Ve})=>o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:2},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[o.jsx("span",{style:{fontSize:8,color:Me,fontFamily:Yo,letterSpacing:"0.06em"},children:q}),o.jsx("span",{style:{fontSize:8,color:"rgba(255,255,255,0.5)",fontFamily:Yo},children:Ve.toFixed(2)})]}),o.jsx("div",{style:{width:"100%",height:4,background:"rgba(255,255,255,0.04)",borderRadius:2},children:o.jsx("div",{style:{width:`${Ve*100}%`,height:"100%",background:Me,borderRadius:2,transition:"width 0.5s",opacity:.7}})}),o.jsx("span",{style:{fontSize:6,color:"rgba(255,255,255,0.18)",fontFamily:Yo},children:U})]},T)),o.jsx("div",{style:{borderTop:"1px dashed rgba(255,255,255,0.06)",paddingTop:8,marginTop:4},children:o.jsxs("div",{style:{fontSize:7,color:"rgba(255,255,255,0.25)",fontFamily:Yo,lineHeight:1.6},children:["Alto ",o.jsx("span",{style:{color:"#ff6464"},children:"dialgica"})," = consonncia e dissonncia coexistem.",o.jsx("br",{}),"Alto ",o.jsx("span",{style:{color:"#64c8ff"},children:"recursivo"})," = feedback musical ativo (eventos geram energia que gera eventos).",o.jsx("br",{}),"Alto ",o.jsx("span",{style:{color:"#64ffa0"},children:"hologramtico"})," = cada voz carrega a essncia do todo.",o.jsx("br",{}),o.jsx("span",{style:{color:"#ffc850"},children:"Sapiens/Demens"}),"  0.50 = equilbrio ideal entre ordem e caos.",o.jsx("br",{}),"Alto ",o.jsx("span",{style:{color:"#b478ff"},children:"tetralogia"})," = todos os plos ativos (sistema mais rico)."]})})]})]})]}),g&&((hc=n.current)==null?void 0:hc.quanta[g.qIdx])&&(()=>{var q;const T=n.current.quanta[g.qIdx];return o.jsxs("div",{className:"fixed z-[100] min-w-[148px] overflow-hidden",style:{left:g.sx+4,top:g.sy+4,fontFamily:Yo,background:"rgba(0,0,0,0.96)",border:"1px dashed rgba(255,255,255,0.06)"},onMouseLeave:()=>x(null),children:[o.jsxs("div",{className:"px-2.5 py-1.5 border-b border-dashed border-white/[0.06] flex items-center justify-between",children:[o.jsxs("span",{className:"text-[6px] font-mono uppercase tracking-widest",style:{color:ga[T.role]},children:[T.role,"  pitch ",T.pitch]}),o.jsx("button",{onClick:()=>x(null),title:"Fechar",className:"text-white/25 hover:text-white/60 text-[8px]",children:""})]}),o.jsxs("div",{className:"p-1.5 border-b border-dashed border-white/[0.06]",children:[o.jsx("div",{className:"text-[5.5px] font-mono uppercase tracking-widest text-white/22 mb-1 px-1",children:"Change Role"}),o.jsx("div",{className:"grid grid-cols-4 gap-0.5",children:["KICK","BASS","PERC","PAD","LEAD","ARP","STRINGS","CHOIR"].map(U=>o.jsx("button",{title:`Mudar para ${U}`,onClick:()=>{var Me;T.role=U,T.mutations++,T.roleLockTimer=1.5,T.hue=yy[U],(Me=n.current)==null||Me.emergent.push({type:"mutation",x:T.x,y:T.y,r:.04,alpha:1,color:ga[U]}),An(Ve=>Ve+1),x(null)},className:`text-[5.5px] uppercase py-1 px-0.5 transition-all
                      ${T.role===U?"bg-white/10":"hover:bg-white/6"}`,style:{color:T.role===U?ga[U]:"rgba(255,255,255,0.4)",borderRadius:0},children:U.slice(0,3)},U))})]}),o.jsxs("div",{className:"p-1.5 flex flex-col gap-0.5",children:[o.jsxs("div",{className:"p-1.5 border-b border-dashed border-white/[0.06]",children:[o.jsxs("div",{className:"text-[5.5px] font-mono uppercase tracking-widest text-white/22 mb-1 px-1",children:["Timbre  ",T.timbreIdx>=0?(q=Sc[T.timbreIdx])==null?void 0:q.name:"Role default"]}),o.jsxs("div",{className:"flex flex-wrap gap-0.5 max-h-16 overflow-y-auto",style:{scrollbarWidth:"none"},children:[o.jsx("button",{title:"Usar timbre padro da role",onClick:()=>{T.timbreIdx=-1,An(U=>U+1),x(null)},className:`text-[5px] px-1 py-0.5 border transition-all ${T.timbreIdx===-1?"border-white/30 text-white/70 bg-white/10":"border-white/[0.06] text-white/30 hover:text-white/60 hover:border-white/15"}`,style:{borderRadius:0},children:"Role"}),Sc.map((U,Me)=>o.jsx("button",{onClick:()=>{T.timbreIdx=Me,An(Ve=>Ve+1),x(null)},title:U.name,className:`text-[8px] py-0.5 px-0.5 border transition-all ${T.timbreIdx===Me?"border-current bg-current/15":"border-white/[0.06] hover:border-white/15"}`,style:{color:T.timbreIdx===Me?U.color:"rgba(255,255,255,0.4)",borderRadius:0},children:U.icon},Me))]})]}),[{label:"Rand Timbre",action:()=>xd(g.qIdx)},{label:"Excite",action:()=>{T.charge=1,T.recentlyFired=1}},{label:"Freeze",action:()=>{T.vx=0,T.vy=0,T.charge=.05}},{label:"Lock Phase",action:()=>{T.phaseLocked=T.phaseLocked>=0?-1:T.id}},{label:"Pitch +1",action:()=>{T.pitch=Math.min(108,T.pitch+1)}},{label:"Pitch -1",action:()=>{T.pitch=Math.max(24,T.pitch-1)}},{label:"Delete",action:()=>{const U=n.current;if(!U)return;const Me=U.quanta.indexOf(T);Me>=0&&(U.quanta.splice(Me,1),U.count--),sn(U.count)}}].map(({label:U,action:Me})=>o.jsx("button",{title:U,onClick:()=>{Me(),An(Ve=>Ve+1),x(null)},className:`text-left text-[6.5px] uppercase tracking-wider px-2 py-1 transition-all
                    ${U==="Delete"?"text-red-400/70 hover:bg-red-900/20":"text-white/45 hover:text-white/80 hover:bg-white/[0.06]"}`,style:{borderRadius:0},children:U},U))]})]})})(),I&&o.jsx("button",{onClick:()=>E(!1),title:"Press H to restore HUD",className:"fixed top-3 right-3 z-40 px-2.5 py-1 transition-all",style:{fontFamily:Yo,fontSize:7,letterSpacing:"0.12em",textTransform:"uppercase",color:"rgba(255,255,255,0.20)",background:"rgba(0,0,0,0.94)",border:"1px dashed rgba(255,255,255,0.06)"},children:"H  Show HUD"}),O&&o.jsx(cU,{currentId:b,onSelect:On,onClose:()=>L(!1)}),$&&o.jsx(nf,{id:"ml_hub",title:"Minhas composies",titleColor:"#7dd3fc",defaultX:window.innerWidth-280,defaultY:80,zIndex:25,width:260,onClose:()=>F(!1),children:o.jsx(nU,{preset:r.current,physics:ft,onLoadComposition:zc})}),ne&&!R&&o.jsx("div",{className:"fixed bottom-20 left-1/2 -translate-x-1/2 z-[6] pointer-events-none",children:o.jsxs("div",{className:"flex items-center gap-3 px-4 py-2",style:{fontFamily:Yo,background:"rgba(0,0,0,0.94)",border:"1px dashed rgba(251,191,36,0.15)"},children:[o.jsx("span",{style:{fontSize:7,color:"rgba(251,191,36,0.60)",letterSpacing:"0.12em",textTransform:"uppercase"},children:" COMPOSE"}),o.jsx("span",{style:{fontSize:7,color:"rgba(255,255,255,0.20)"},children:"Click to place  Drag = velocity   Release to run  R to restore"})]})}),Fe&&o.jsx("div",{className:"fixed top-16 left-1/2 -translate-x-1/2 z-[6] pointer-events-none",children:o.jsx("div",{className:"flex items-center gap-2 px-3 py-1",style:{fontFamily:Yo,background:"rgba(0,0,0,0.94)",border:"1px dashed rgba(255,153,68,0.15)"},children:o.jsx("span",{style:{fontSize:7,color:"rgba(255,153,68,0.55)",letterSpacing:"0.12em",textTransform:"uppercase"},children:" BALLISTIC  WALL BOUNCE  GATE NOTES ONLY"})})}),!I&&fs&&o.jsxs(nf,{id:"ml_pad",title:"PAD",titleColor:"#88ffcc88",defaultX:40,defaultY:Math.max(200,window.innerHeight-(lo?380:180)),zIndex:22,width:210,onClose:()=>To(!1),children:[o.jsx("div",{className:"flex px-1.5 pt-1.5 gap-0.5",children:ps.map((T,q)=>o.jsx("button",{onClick:()=>mi(q),title:`Root: ${T}`,className:"flex-1 transition-all",style:{height:16,fontSize:6,textAlign:"center",color:xt===q?"#88ffcc":T.includes("#")||T.includes("b")?"rgba(255,255,255,0.25)":"rgba(255,255,255,0.40)",background:xt===q?"rgba(136,255,204,0.12)":T.includes("#")||T.includes("b")?"rgba(255,255,255,0.02)":"rgba(255,255,255,0.04)",border:xt===q?"1px solid rgba(136,255,204,0.40)":"1px dashed rgba(255,255,255,0.04)"},children:T},T))}),o.jsxs("div",{className:"flex items-center px-1.5 py-1 gap-1",children:[o.jsxs("button",{onClick:()=>{const T=Object.keys(No),q=T.indexOf(At);Tr(T[(q+1)%T.length])},title:"Trocar escala (clique para ciclar)",className:"flex items-center gap-1 transition-all",style:{fontSize:7,color:"rgba(155,89,255,0.75)",letterSpacing:"0.06em",textTransform:"uppercase"},children:[No[At]," ",o.jsx(Ms,{size:7})]}),o.jsx("div",{style:{flex:1}}),o.jsxs("span",{style:{fontSize:6,color:"rgba(255,255,255,0.15)"},children:[ps[xt%12]," ",No[At]]})]}),o.jsx("div",{className:"grid gap-0.5 px-1.5 pb-1.5",style:{gridTemplateColumns:`repeat(${Math.min(dd[At].length,7)},1fr)`},children:dd[At].map((T,q)=>{const U=ps[(xt+T)%12],Me=T===0;return o.jsx("button",{onClick:()=>Ro(T),title:`${U}${Me?" (root)":""}`,className:"transition-all active:scale-95",style:{height:28,fontSize:9,textAlign:"center",color:Me?"#88ffcc":"rgba(255,255,255,0.55)",background:Me?"rgba(136,255,204,0.08)":"rgba(255,255,255,0.04)",border:Me?"1px solid rgba(136,255,204,0.25)":"1px dashed rgba(255,255,255,0.06)",fontWeight:Me?600:400},children:U},`${T}_${q}`)})}),o.jsxs("div",{className:"px-1.5 pb-1.5",children:[o.jsx("div",{className:"uppercase",style:{fontFamily:Fa,fontSize:8,letterSpacing:"0.10em",color:"rgba(55,178,218,0.28)",marginBottom:5},children:"KEYBOARD"}),o.jsx("div",{className:"grid gap-0.5",style:{gridTemplateColumns:"repeat(12, 1fr)"},children:ps.map((T,q)=>{const U=(q-xt%12+12)%12,Me=dd[At].includes(U),Ve=U===0,ht=T.includes("#")||T.includes("b");return o.jsx("button",{onClick:()=>dc(q),title:`Play ${T}${Me?` (${No[At]})`:""}  role:${mt}`,className:"transition-all active:scale-95",style:{height:18,fontSize:6.5,textAlign:"center",color:Ve?"#88ffcc":Me?"rgba(255,255,255,0.55)":"rgba(255,255,255,0.25)",background:Ve?"rgba(136,255,204,0.10)":Me?ht?"rgba(255,255,255,0.05)":"rgba(255,255,255,0.04)":"rgba(255,255,255,0.02)",border:Ve?"1px solid rgba(136,255,204,0.35)":Me?"1px dashed rgba(255,255,255,0.08)":"1px dashed rgba(255,255,255,0.04)"},children:T},T)})}),o.jsxs("div",{style:{marginTop:5,fontFamily:Yo,fontSize:6,color:"rgba(255,255,255,0.18)",lineHeight:1.45},children:["Dica: o timbre vem do ",o.jsx("span",{style:{color:"rgba(136,255,204,0.55)"},children:mt})," (mude no painel da direita)."]})]})]}),!I&&!fs&&o.jsx("button",{onClick:()=>To(!0),className:"fixed z-[22] pointer-events-auto transition-all",title:"Abrir Instrument Pad",style:{left:40,bottom:lo?262:36,width:24,height:24,background:"rgba(0,0,0,0.85)",border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(55,178,218,0.45)",fontSize:11,display:"flex",alignItems:"center",justifyContent:"center"},children:""}),!I&&o.jsxs("div",{className:"fixed left-0 right-0 z-[25] border-t border-dashed border-white/[0.06]",style:{bottom:0,background:"#000",fontFamily:Yo},children:[o.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 cursor-pointer select-none transition-colors",onClick:()=>ir(T=>!T),style:{borderBottom:lo?"1px dashed rgba(255,255,255,0.04)":"none"},children:[o.jsx("span",{style:{fontFamily:Fa,fontSize:8,letterSpacing:"0.12em",textTransform:"uppercase",color:vn?Wr:"rgba(255,255,255,0.22)"},children:"STUDIO SEQ"}),vn&&o.jsx("span",{className:"w-1.5 h-1.5 animate-pulse flex-shrink-0",style:{background:Wr}}),o.jsx("span",{style:{fontFamily:Yo,fontSize:6,color:"rgba(255,255,255,0.12)",marginLeft:"auto"},children:lo?"":""})]}),lo&&o.jsx(UV,{rows:Or,active:vn,stepCount:hn,cursor:_r,bpm:re,onToggleActive:vi,onToggleStep:Cd,onSetStepCount:E0,onToggleMute:kd,onToggleSolo:_l,onSetVel:T0,onClearRow:I0,onLoadPattern:Rd,onClearAll:Vu})]}),o.jsx("div",{className:"fixed left-4 z-40",style:{bottom:lo&&!I?264:16},children:o.jsx(km,{state:va,elapsed:$i,onStart:Ad,onStop:Uu})}),to&&o.jsx(KV,{onClose:()=>Er(!1)}),o.jsx(tU,{}),o.jsx(lC,{open:ja,items:sU,position:os,activeId:V,onSelect:uc,onClose:()=>Co(!1)}),o.jsx(lC,{open:Ya,items:iU,position:os,onSelect:Wi,onClose:()=>qo(!1)})]})},mo=280,io=175,K={EMPTY:0,WALL:1,WATER:2,SAND:3,FIRE:4,FOOD:5,OIL:6,STEAM:7,POWDER:8,GUNPOWDER:9,ICE:10,SNOW:11,MAGMA:12,GAS:13,ACID:14,SEED:15,WOOD:16,VINE:17,CLONE:18,SALT:19,METAL:20,BOMB:21},cC={[K.EMPTY]:{label:"Erase",color:"#1a2030",desc:"Clear cells",cat:"tool"},[K.WALL]:{label:"Wall",color:"#5577aa",desc:"Immovable barrier",cat:"solid"},[K.WATER]:{label:"Water",color:"#2266ff",desc:"Flows and pools",cat:"fluid"},[K.SAND]:{label:"Sand",color:"#d4a030",desc:"Falls and piles",cat:"powder"},[K.FIRE]:{label:"Fire",color:"#ff5500",desc:"Burns oil, wood, gas",cat:"gas"},[K.FOOD]:{label:"Food",color:"#00ff88",desc:"Creatures eat this",cat:"bio"},[K.OIL]:{label:"Oil",color:"#8822cc",desc:"Floats, burns wildly",cat:"fluid"},[K.STEAM]:{label:"Steam",color:"#88aacc",desc:"Hot gas  rises, fades",cat:"gas"},[K.POWDER]:{label:"Powder",color:"#ddc488",desc:"Dust  ignites and blasts",cat:"powder"},[K.GUNPOWDER]:{label:"Gunpowder",color:"#555544",desc:"Chain explosion!",cat:"powder"},[K.ICE]:{label:"Ice",color:"#aaddff",desc:"Solid  melts near heat",cat:"solid"},[K.SNOW]:{label:"Snow",color:"#ddeeff",desc:"Falls slow, melts in fire",cat:"powder"},[K.MAGMA]:{label:"Magma",color:"#ff2200",desc:"Hot heavy liquid  burns",cat:"fluid"},[K.GAS]:{label:"Gas",color:"#88ff44",desc:"Flammable gas  rises",cat:"gas"},[K.ACID]:{label:"Acid",color:"#00ffaa",desc:"Dissolves most solids",cat:"fluid"},[K.SEED]:{label:"Seed",color:"#664422",desc:"Grows into wood + vine",cat:"bio"},[K.WOOD]:{label:"Wood",color:"#8b5a2b",desc:"Solid organic  burns",cat:"solid"},[K.VINE]:{label:"Vine",color:"#2a8822",desc:"Grows and spreads",cat:"bio"},[K.CLONE]:{label:"Clone",color:"#cc44ff",desc:"Multiplies what it touches",cat:"tool"},[K.SALT]:{label:"Salt",color:"#eeeeff",desc:"Dissolves in water",cat:"powder"},[K.METAL]:{label:"Metal",color:"#8899aa",desc:"Fireproof solid conductor",cat:"solid"},[K.BOMB]:{label:"Bomb",color:"#ff8800",desc:"Explodes when ignited",cat:"tool"}},hU=[{id:"fluid",label:"Fluids",color:"#2266ff",cells:[K.WATER,K.OIL,K.MAGMA,K.ACID]},{id:"powder",label:"Powders",color:"#d4a030",cells:[K.SAND,K.POWDER,K.GUNPOWDER,K.SNOW,K.SALT]},{id:"solid",label:"Solids",color:"#5577aa",cells:[K.WALL,K.ICE,K.METAL,K.WOOD,K.BOMB]},{id:"gas",label:"Gas",color:"#ff5500",cells:[K.FIRE,K.GAS,K.STEAM]},{id:"bio",label:"Biology",color:"#00ff88",cells:[K.FOOD,K.SEED,K.VINE]},{id:"tool",label:"Tools",color:"#cc44ff",cells:[K.EMPTY,K.CLONE]}];function li(e,t,n){return e<t?t:e>n?n:e}const o6={[K.WATER]:{density:1,viscosity:.3,thermal:.45},[K.OIL]:{density:.8,viscosity:.6,thermal:.25},[K.MAGMA]:{density:1.4,viscosity:.8,thermal:.9},[K.ACID]:{density:1.1,viscosity:.4,thermal:.4},[K.WALL]:{density:3,viscosity:1,thermal:.1},[K.SAND]:{density:1.6,viscosity:1,thermal:.15},[K.ICE]:{density:.92,viscosity:1,thermal:.55},[K.METAL]:{density:5,viscosity:1,thermal:.95},[K.WOOD]:{density:.6,viscosity:1,thermal:.08},[K.SNOW]:{density:.3,viscosity:1,thermal:.2}};function qb(e){return e===K.WATER||e===K.OIL||e===K.MAGMA||e===K.ACID}class fU{constructor(){this.cols=mo,this.rows=io,this.cells=new Uint8Array(mo*io),this.heat=new Float32Array(mo*io),this.extra=new Float32Array(mo*io),this._upd=new Uint8Array(mo*io),this._heatBuf=new Float32Array(mo*io),this.fluidPressure=.6}idx(t,n){return n*this.cols+t}get(t,n){return t<0||t>=this.cols||n<0||n>=this.rows?K.WALL:this.cells[n*this.cols+t]}set(t,n,r,a=0){if(t<0||t>=this.cols||n<0||n>=this.rows)return;const i=n*this.cols+t;this.cells[i]=r,this.heat[i]=a,this.extra[i]=0,r===K.FIRE&&(this.heat[i]=.8+Math.random()*.2),r===K.STEAM&&(this.heat[i]=.3+Math.random()*.4),r===K.GAS&&(this.heat[i]=.8+Math.random()*.2),r===K.SEED&&(this.heat[i]=0),r===K.VINE&&(this.heat[i]=.5+Math.random()*.5),r===K.MAGMA&&(this.heat[i]=1),r===K.BOMB&&(this.extra[i]=0)}swap(t,n,r,a){const i=n*this.cols+t,s=a*this.cols+r,c=this.cells[i];this.cells[i]=this.cells[s],this.cells[s]=c;const l=this.heat[i];this.heat[i]=this.heat[s],this.heat[s]=l;const d=this.extra[i];this.extra[i]=this.extra[s],this.extra[s]=d}mark(t,n){this._upd[n*this.cols+t]=1}paint(t,n,r,a,i=1){const s=Math.ceil(r);for(let c=-s;c<=s;c++)for(let l=-s;l<=s;l++)if(l*l+c*c<=r*r&&Math.random()<i){const d=t+l|0,u=n+c|0,h=this.get(d,u);(a===K.EMPTY||h!==K.WALL||a===K.WALL)&&this.set(d,u,a)}}fill(t,n,r,a,i){for(let s=n;s<=a;s++)for(let c=t;c<=r;c++)this.set(c,s,i)}spawnFood(t=8){let n=0,r=0;for(;n<t&&r<t*30;){r++;const a=2+(Math.random()*(this.cols-4)|0),i=2+(Math.random()*(this.rows-5)|0);this.get(a,i)===K.EMPTY&&(this.set(a,i,K.FOOD),n++)}}_explode(t,n,r){const a=Math.ceil(r);for(let i=-a;i<=a;i++)for(let s=-a;s<=a;s++){const c=Math.sqrt(s*s+i*i);if(c>r)continue;const l=t+s,d=n+i,u=this.get(l,d);if(u===K.WALL||u===K.METAL)continue;const h=this.idx(l,d);c<r*.45?(this.cells[h]=K.EMPTY,this.heat[h]=0):(this.cells[h]=K.FIRE,this.heat[h]=1),this._upd[h]=1}}update(t){this._upd.fill(0);const n=(t&1)===0;for(let r=this.rows-2;r>=0;r--)for(let a=0;a<this.cols;a++){const i=n?a:this.cols-1-a,s=r*this.cols+i;if(!this._upd[s])switch(this.cells[s]){case K.SAND:this._sand(i,r);break;case K.WATER:this._water(i,r);break;case K.FIRE:this._fire(i,r);break;case K.OIL:this._oil(i,r);break;case K.STEAM:this._steam(i,r);break;case K.POWDER:this._powder(i,r);break;case K.GUNPOWDER:this._gunpowder(i,r);break;case K.ICE:this._ice(i,r);break;case K.SNOW:this._snow(i,r);break;case K.MAGMA:this._magma(i,r);break;case K.GAS:this._gas(i,r);break;case K.ACID:this._acid(i,r);break;case K.SEED:this._seed(i,r,t);break;case K.WOOD:this._wood(i,r,t);break;case K.VINE:this._vine(i,r);break;case K.CLONE:this._clone(i,r);break;case K.SALT:this._salt(i,r);break;case K.BOMB:this._bomb(i,r);break;case K.FOOD:this._food(i,r);break}}}_fall(t,n,r){return n+1>=this.rows?!1:r.includes(this.get(t,n+1))?(this.swap(t,n,t,n+1),this.mark(t,n+1),!0):!1}_slide(t,n,r){const a=Math.random()<.5?1:-1;for(const i of[a,-a])if(n+1<this.rows&&r.includes(this.get(t+i,n+1))&&this.get(t+i,n)===K.EMPTY)return this.swap(t,n,t+i,n+1),this.mark(t+i,n+1),!0;return!1}_spread(t,n,r){const a=Math.random()<.5?1:-1;for(const i of[a,-a])if(r.includes(this.get(t+i,n)))return this.swap(t,n,t+i,n),this.mark(t+i,n),!0;return!1}_sand(t,n){this._fall(t,n,[K.EMPTY,K.WATER,K.OIL,K.GAS])||this._slide(t,n,[K.EMPTY,K.WATER,K.GAS])}_water(t,n){if(this._fall(t,n,[K.EMPTY]))return;const r=Math.random()<.5?1:-1;if(n+1<this.rows){if(this.get(t+r,n+1)===K.EMPTY){this.swap(t,n,t+r,n+1),this.mark(t+r,n+1);return}if(this.get(t-r,n+1)===K.EMPTY){this.swap(t,n,t-r,n+1),this.mark(t-r,n+1);return}}const a=this.fluidPressure;if(a>.01){let i=0;for(let c=1;c<=6&&!(n-c<0);c++)if(this.get(t,n-c)===K.WATER)i++;else break;const s=.5+i*.08*a;if(Math.random()<s){if(i>=3&&a>.3){for(const c of[r,-r])if(this.get(t+c,n)===K.EMPTY&&this.get(t+c*2,n)===K.EMPTY){this.swap(t,n,t+c,n),this.mark(t+c,n);return}}if(this._spread(t,n,[K.EMPTY]))return}}this._spread(t,n,[K.EMPTY])}_fire(t,n){const r=this.idx(t,n);if(this.heat[r]-=.004+Math.random()*.009,this.heat[r]<=0){this.cells[r]=Math.random()<.28?K.STEAM:K.EMPTY,this.cells[r]===K.STEAM&&(this.heat[r]=.2+Math.random()*.3);return}if(n>0&&this.get(t,n-1)===K.EMPTY&&Math.random()<.6&&(this.swap(t,n,t,n-1),this.mark(t,n-1)),Math.random()<.04){const a=[[0,-1],[0,1],[-1,0],[1,0]];for(const[i,s]of a){const c=this.get(t+i,n+s),l=this.idx(t+i,n+s);if((c===K.OIL||c===K.WOOD||c===K.VINE||c===K.GAS||c===K.POWDER)&&(this.cells[l]=K.FIRE,this.heat[l]=1),c===K.GUNPOWDER&&this._explode(t+i,n+s,7),c===K.BOMB){const d=this.idx(t+i,n+s);this.extra[d]===0&&(this.extra[d]=1)}if(c===K.WATER&&Math.random()<.35){this.cells[r]=K.STEAM,this.heat[r]=.4;return}c===K.ICE&&Math.random()<.1&&(this.cells[l]=K.WATER,this.heat[l]=0)}}}_oil(t,n){if(this._fall(t,n,[K.EMPTY]))return;if(n>0&&this.get(t,n-1)===K.WATER){this.swap(t,n,t,n-1),this.mark(t,n-1);return}const r=this.fluidPressure;if(r>.01){let a=0;for(let s=1;s<=4&&!(n-s<0);s++)if(this.get(t,n-s)===K.OIL)a++;else break;const i=.2+a*.06*r;if(Math.random()<i){this._spread(t,n,[K.EMPTY]);return}}Math.random()<.35&&this._spread(t,n,[K.EMPTY])}_steam(t,n){const r=this.idx(t,n);if(this.heat[r]-=.005+Math.random()*.004,this.heat[r]<=0){this.cells[r]=K.EMPTY;return}if(n>0){const a=Math.random()<.5?1:-1;this.get(t,n-1)===K.EMPTY?(this.swap(t,n,t,n-1),this.mark(t,n-1)):this.get(t+a,n-1)===K.EMPTY?(this.swap(t,n,t+a,n-1),this.mark(t+a,n-1)):this.get(t-a,n-1)===K.EMPTY&&(this.swap(t,n,t-a,n-1),this.mark(t-a,n-1))}}_powder(t,n){if(!this._fall(t,n,[K.EMPTY,K.WATER,K.OIL])&&(this._slide(t,n,[K.EMPTY,K.WATER]),Math.random()<.03)){for(const[r,a]of[[0,-1],[0,1],[-1,0],[1,0]])if(this.get(t+r,n+a)===K.FIRE||this.get(t+r,n+a)===K.MAGMA){this._explode(t,n,4);return}}}_gunpowder(t,n){if(!this._fall(t,n,[K.EMPTY,K.WATER])&&(this._slide(t,n,[K.EMPTY,K.WATER]),Math.random()<.05))for(const[r,a]of[[0,-1],[0,1],[-1,0],[1,0]]){const i=this.get(t+r,n+a);if(i===K.FIRE||i===K.MAGMA){this._explode(t,n,9);return}}}_ice(t,n){const r=this.idx(t,n);if(Math.random()<.005)for(const[a,i]of[[0,-1],[0,1],[-1,0],[1,0]]){const s=this.get(t+a,n+i);if(s===K.FIRE||s===K.MAGMA||s===K.STEAM){this.cells[r]=K.WATER,this.heat[r]=0;return}}if(this.heat[r]>.35&&Math.random()<.04){this.cells[r]=K.WATER,this.heat[r]=0;return}if(Math.random()<.02)for(const[a,i]of[[0,-1],[0,1],[-1,0],[1,0]]){const s=t+a,c=n+i;if(s>=0&&s<this.cols&&c>=0&&c<this.rows){const l=c*this.cols+s;if(this.heat[l]>.5){this.heat[r]+=.03;break}}}}_snow(t,n){if(Math.random()<.35){if(this._fall(t,n,[K.EMPTY]))return;this._slide(t,n,[K.EMPTY])}for(const[r,a]of[[0,-1],[0,1],[-1,0],[1,0]]){const i=this.get(t+r,n+a);if((i===K.FIRE||i===K.MAGMA)&&Math.random()<.08){this.set(t,n,K.WATER);return}}}_magma(t,n){if(this.idx(t,n),Math.random()<.55){if(this._fall(t,n,[K.EMPTY,K.WATER]))return;Math.random()<.45&&this._spread(t,n,[K.EMPTY])}if(Math.random()<.06)for(const[r,a]of[[0,-1],[0,1],[-1,0],[1,0]]){const i=t+r,s=n+a,c=this.get(i,s),l=this.idx(i,s);c===K.WATER&&(this.cells[l]=K.STEAM,this.heat[l]=.5),(c===K.OIL||c===K.WOOD||c===K.VINE||c===K.GAS)&&(this.cells[l]=K.FIRE,this.heat[l]=1),c===K.ICE&&(this.cells[l]=K.WATER,this.heat[l]=0),c===K.SNOW&&(this.cells[l]=K.STEAM,this.heat[l]=.4)}}_gas(t,n){const r=this.idx(t,n);if(this.heat[r]-=.002+Math.random()*.003,this.heat[r]<=0){this.cells[r]=K.EMPTY;return}if(n>0&&Math.random()<.65){const a=Math.random()<.5?1:-1;this.get(t,n-1)===K.EMPTY?(this.swap(t,n,t,n-1),this.mark(t,n-1)):this.get(t+a,n-1)===K.EMPTY&&(this.swap(t,n,t+a,n-1),this.mark(t+a,n-1))}if(Math.random()<.03){for(const[a,i]of[[0,-1],[0,1],[-1,0],[1,0]])if(this.get(t+a,n+i)===K.FIRE||this.get(t+a,n+i)===K.MAGMA){this._explode(t,n,5);return}}}_acid(t,n){if(this._fall(t,n,[K.EMPTY]))return;const r=Math.random()<.5?1:-1;if(this.get(t+r,n+1)===K.EMPTY||this.get(t-r,n+1)===K.EMPTY?this._slide(t,n,[K.EMPTY]):this._spread(t,n,[K.EMPTY]),Math.random()<.08){const a=[[0,-1],[0,1],[-1,0],[1,0]];for(const[i,s]of a){const c=this.get(t+i,n+s);if(c===K.WALL||c===K.SAND||c===K.ICE||c===K.WOOD||c===K.METAL||c===K.VINE){const l=this.idx(t+i,n+s);if(this.cells[l]=K.EMPTY,this.heat[l]=0,Math.random()<.3){this.cells[this.idx(t,n)]=K.EMPTY;return}break}}}}_seed(t,n,r){if(this._fall(t,n,[K.EMPTY,K.WATER]))return;this._slide(t,n,[K.EMPTY]);const a=this.idx(t,n);this.heat[a]+=.004,this.heat[a]>=1&&Math.random()<.02&&(this.cells[a]=K.WOOD,this.heat[a]=.9,this.extra[a]=1)}_wood(t,n,r){const a=this.idx(t,n);for(const[i,s]of[[0,-1],[0,1],[-1,0],[1,0]]){const c=this.get(t+i,n+s);if((c===K.FIRE||c===K.MAGMA)&&Math.random()<.008){this.cells[a]=K.FIRE,this.heat[a]=.9;return}}if(this.extra[a]>0&&this.heat[a]>.2&&Math.random()<.004){this.heat[a]-=.05;const i=t+(Math.random()<.5?0:Math.random()<.5?1:-1),s=n-1;if(this.get(i,s)===K.EMPTY){this.set(i,s,K.WOOD);const c=this.idx(i,s);this.heat[c]=this.heat[a]*.85,this.extra[c]=1}}}_vine(t,n){const r=this.idx(t,n);if(this.heat[r]-=.001,!(this.heat[r]<=0)){for(const[a,i]of[[0,-1],[0,1],[-1,0],[1,0]]){const s=this.get(t+a,n+i);if(s===K.FIRE||s===K.MAGMA){this.cells[r]=K.FIRE,this.heat[r]=.9;return}}if(Math.random()<.007){const a=[[0,1],[0,-1],[-1,0],[1,0],[1,1],[-1,1]],i=a[Math.random()*a.length|0],s=t+i[0],c=n+i[1];this.get(s,c)===K.EMPTY&&(this.set(s,c,K.VINE),this.heat[this.idx(s,c)]=this.heat[r]*.8)}}}_clone(t,n){if(Math.random()>.04)return;const r=[[0,-1],[0,1],[-1,0],[1,0]];for(const[a,i]of r){const s=this.get(t+a,n+i);if(s!==K.EMPTY&&s!==K.CLONE){const c=r.filter(([l,d])=>this.get(t+l,n+d)===K.EMPTY);if(c.length>0){const[l,d]=c[Math.random()*c.length|0];this.set(t+l,n+d,s)}return}}}_salt(t,n){if(!this._fall(t,n,[K.EMPTY,K.WATER,K.OIL])){this._slide(t,n,[K.EMPTY]);for(const[r,a]of[[0,-1],[0,1],[-1,0],[1,0]])if(this.get(t+r,n+a)===K.WATER&&Math.random()<.06){const i=this.idx(t+r,n+a);this.cells[i]=K.EMPTY,this.cells[this.idx(t,n)]=K.EMPTY;return}}}_bomb(t,n){const r=this.idx(t,n);if(this.extra[r]>0){this.extra[r]+=.08,this.extra[r]>=1&&this._explode(t,n,12);return}for(const[a,i]of[[0,-1],[0,1],[-1,0],[1,0]]){const s=this.get(t+a,n+i);(s===K.FIRE||s===K.MAGMA)&&(this.extra[r]=.01)}}_food(t,n){this._fall(t,n,[K.EMPTY,K.WATER])||this._slide(t,n,[K.EMPTY])}render(t,n){const r=n*.06;for(let a=0;a<this.rows;a++)for(let i=0;i<this.cols;i++){const s=a*this.cols+i,c=s<<2,l=this.cells[s],d=this.heat[s];let u=4,h=6,m=14;switch(l){case K.WALL:{const f=(i*3+a*7&7)*3;u=38+f,h=55+f,m=75+f;break}case K.WATER:{const f=Math.sin(r+i*.35+a*.2)*15|0;u=10,h=65+f,m=195+f*.5;break}case K.SAND:{const f=(i*5+a*3&15)*4;u=165+(f>>1),h=112+(f>>2),m=38;break}case K.FIRE:{const f=li(d,0,1),g=Math.random()*50|0;u=li(210+f*45+g|0,0,255),h=li(f*90+12+(g>>2)|0,0,255),m=0;break}case K.FOOD:{const f=Math.sin(r*1.4+i*.7+a*.5)*30|0;u=0,h=li(170+f,80,255),m=li(75+(f>>1),30,150);break}case K.OIL:{const f=((i^a)&7)*5;u=55+f,h=12,m=80+f;break}case K.STEAM:{const f=li(d*2.8,0,1);u=115*f+4|0,h=138*f+6|0,m=162*f+14|0;break}case K.POWDER:{const f=(i*7+a*5&15)*3;u=205+f,h=185+f,m=140;break}case K.GUNPOWDER:{const f=((i^a)&7)*4;u=50+f,h=52+f,m=48+f;break}case K.ICE:{const f=(i*2+a&7)*4;u=140+f,h=205+f,m=255;break}case K.SNOW:{const f=(i+a&3)*8;u=215+f,h=220+f,m=235+f;break}case K.MAGMA:{const f=Math.random()*40|0;u=li(235+f,0,255),h=li(d*60+20+(f>>1)|0,0,255),m=0;break}case K.GAS:{const f=li(d*1.8,0,1);u=80*f+4|0,h=185*f+6|0,m=60*f+10|0;break}case K.ACID:{const f=Math.sin(r*1.8+i*.4)*20|0;u=0,h=li(200+f,100,255),m=li(160+f,80,220);break}case K.SEED:{const f=(i*3+a*5&7)*5;u=80+f,h=55+f,m=20;break}case K.WOOD:{const f=(i*7+a*3&15)*3;u=110+f,h=75+f,m=28;break}case K.VINE:{const f=(i+a*3&7)*5;u=18,h=105+f,m=22;break}case K.CLONE:{const f=Math.sin(r*2.5+i*.8+a*.6)*40|0;u=li(180+f,80,255),h=30,m=li(220+f,100,255);break}case K.SALT:{const f=(i+a&3)*10;u=210+f,h=210+f,m=230+f;break}case K.METAL:{const f=(i*3+a&7)*3;u=100+f,h=115+f,m=135+f;break}case K.BOMB:{const f=this.extra[s]>0,g=f?Math.random()*60|0:0;u=f?li(230+g,0,255):40,h=f?li(100+g,0,255):35,m=f?0:30;break}default:u=4+(a/this.rows*5|0),h=6+(a/this.rows*6|0),m=14+(a/this.rows*10|0)}t[c]=u,t[c+1]=h,t[c+2]=m,t[c+3]=255}}countType(t){let n=0;for(let r=0;r<this.cells.length;r++)this.cells[r]===t&&n++;return n}nearestFood(t,n,r){let a=null,i=r*r;const s=Math.ceil(r),c=Math.max(0,t-s|0),l=Math.min(this.cols-1,t+s|0),d=Math.max(0,n-s|0),u=Math.min(this.rows-1,n+s|0);for(let h=d;h<=u;h++)for(let m=c;m<=l;m++)if(this.cells[h*this.cols+m]===K.FOOD){const f=(m-t)**2+(h-n)**2;f<i&&(i=f,a={x:m,y:h})}return a}consume(t,n,r){let a=0;const i=Math.ceil(r);for(let s=-i;s<=i;s++)for(let c=-i;c<=i;c++)if(c*c+s*s<=r*r){const l=t+c|0,d=n+s|0;this.get(l,d)===K.FOOD&&(this.set(l,d,K.EMPTY),a++)}return a}isPassable(t,n){const r=this.get(t|0,n|0);return r===K.EMPTY||r===K.WATER||r===K.FOOD||r===K.OIL||r===K.GAS||r===K.STEAM}isSolid(t,n){const r=this.get(t|0,n|0);return r===K.WALL||r===K.SAND||r===K.ICE||r===K.WOOD||r===K.METAL||r===K.BOMB||r===K.SNOW||r===K.SALT||r===K.POWDER||r===K.GUNPOWDER}cellAt(t,n){return this.get(t|0,n|0)}diffuseHeat(t){if(t<.001)return;const n=this.cols,r=this.rows,a=this.heat,i=this._heatBuf,s=.08*t;i.set(a);for(let c=1;c<r-1;c++)for(let l=1;l<n-1;l++){const d=c*n+l,u=this.cells[d];if(u===K.FIRE||u===K.STEAM||u===K.GAS||u===K.SEED||u===K.VINE||u===K.EMPTY)continue;const h=o6[u],m=h?h.thermal*s:s*.5,f=(a[d-1]+a[d+1]+a[d-n]+a[d+n])*.25;i[d]=a[d]+(f-a[d])*m,i[d]<0&&(i[d]=0),i[d]>1&&(i[d]=1)}a.set(i)}clear(){this.cells.fill(0),this.heat.fill(0),this.extra.fill(0)}}const vu=[{id:"terrarium",label:"Terrarium",icon:"",desc:"Blank box  build from scratch",spawnX:30,spawnY:.6,goalX:230},{id:"flat",label:"Flat",icon:"",desc:"Open flat ground  first steps",spawnX:12,spawnY:.5,goalX:230},{id:"cave",label:"Cave",icon:"",desc:"Procedural cavern  Rain World vibes",spawnX:14,spawnY:.3,goalX:240},{id:"ramp",label:"Ramp",icon:"",desc:"Ascending terrain  test climbing",spawnX:12,spawnY:.5,goalX:230},{id:"water",label:"Water",icon:"",desc:"Flooded terrain  test swimming",spawnX:12,spawnY:.4,goalX:230},{id:"steps",label:"Steps",icon:"",desc:"Staircase obstacles  curriculum stage 3",spawnX:12,spawnY:.5,goalX:230}];function Df(e){for(let t=0;t<e.cols;t++)e.set(t,0,K.WALL),e.set(t,e.rows-1,K.WALL),e.set(t,e.rows-2,K.WALL);for(let t=0;t<e.rows;t++)e.set(0,t,K.WALL),e.set(e.cols-1,t,K.WALL)}function pU(e){e.clear(),Df(e);const t=e.rows,n=e.cols,r=Math.floor(t*.85);for(let a=1;a<n-1;a++)for(let i=0;i<3;i++)e.set(a,r+i,K.WALL)}function mU(e){e.clear(),Df(e);const t=Math.floor(e.rows*.78);for(let r=1;r<e.cols-1;r++){const a=Math.floor(Math.sin(r*.12)*1.5+Math.random()*.5);for(let i=0;i<4+a;i++)e.set(r,t+i,K.WALL)}const n=[[50,t-14,25],[130,t-22,30],[200,t-12,22]];for(const[r,a,i]of n)for(let s=r;s<r+i;s++)e.set(s,a,K.WALL);e.fill(90,t-8,125,t-1,K.WATER),e.spawnFood(20);for(let r=-2;r<=2;r++)for(let a=-2;a<=2;a++)e.set(220+a,t-6+r,K.FOOD)}function gU(e,t=Math.random()){e.clear();const n=e.cols,r=e.rows,a=SU(t);for(let d=1;d<r-1;d++)for(let u=1;u<n-1;u++)e.cells[d*n+u]=a()<.44?K.WALL:K.EMPTY;const i=new Uint8Array(n*r);for(let d=0;d<5;d++){for(let u=1;u<r-1;u++)for(let h=1;h<n-1;h++){let m=0;for(let f=-1;f<=1;f++)for(let g=-1;g<=1;g++)e.cells[(u+f)*n+(h+g)]===K.WALL&&m++;i[u*n+h]=m>=5?K.WALL:K.EMPTY}for(let u=0;u<i.length;u++)i[u]!==0&&(e.cells[u]=i[u])}Df(e);const s=Math.floor(r*.5);for(let d=s-4;d<s+4;d++)for(let u=2;u<22;u++)e.set(u,d,K.EMPTY);for(let d=s-5;d<s+5;d++)for(let u=n-22;u<n-2;u++)e.set(u,d,K.EMPTY);let c=15,l=s;for(;c<n-20;){8+(Math.floor(a()*6)|0);const d=6+(Math.floor(a()*8)|0);for(let u=-d/2;u<=d/2;u++){const h=Math.floor(l+u);if(h>1&&h<r-2)for(let m=0;m<6;m++){const f=c+m;f>1&&f<n-2&&e.set(f,h,K.EMPTY)}}c+=4+(Math.floor(a()*4)|0),l+=Math.floor((a()-.5)*5),l=Math.max(8,Math.min(r-10,l))}for(let d=0;d<6;d++){const u=20+Math.floor(a()*(n-40)),h=r-10;if(e.get(u,h)===K.EMPTY)for(let m=0;m<4;m++)for(let f=-5;f<=5;f++)e.get(u+f,h-m)===K.EMPTY&&e.set(u+f,h-m,K.WATER)}e.spawnFood(18)}function yU(e){e.clear(),Df(e);const t=e.rows,n=e.cols;for(let a=1;a<n-1;a++){const i=Math.floor(t*.82-a*(t*.35)/n);for(let s=0;s<4;s++)e.set(a,i+s,K.WALL)}const r=[[60,.62,20],[130,.5,25],[200,.38,20]];for(const[a,i,s]of r){const c=Math.floor(t*i);for(let l=a;l<a+s;l++)e.set(l,c,K.WALL)}e.spawnFood(15);for(let a=-2;a<=2;a++)for(let i=-3;i<=3;i++)e.set(220+i,Math.floor(t*.25)+a,K.FOOD)}function bU(e){e.clear(),Df(e);const t=e.rows,n=e.cols,r=Math.floor(t*.8);for(let a=1;a<n-1;a++)for(let i=0;i<3;i++)e.set(a,r+i,K.WALL);e.fill(1,Math.floor(t*.35),n-2,r-1,K.WATER),e.fill(30,Math.floor(t*.32),80,Math.floor(t*.33),K.WALL),e.fill(100,Math.floor(t*.24),160,Math.floor(t*.25),K.WALL),e.fill(180,Math.floor(t*.28),240,Math.floor(t*.29),K.WALL),e.spawnFood(18)}function xU(e){e.clear(),Df(e);const t=e.rows,n=e.cols,r=Math.floor(t*.78);for(let i=1;i<n-1;i++)for(let s=0;s<3;s++)e.set(i,r+s,K.WALL);let a=0;for(let i=30;i<n-30;i+=22){a+=6;const s=r-a;e.fill(i,s,i+22,r,K.WALL)}e.spawnFood(15)}function vU(e,t,n){const r=vu.find(a=>a.id===e)??vu[0];switch(e){case"terrarium":pU(t);break;case"flat":mU(t);break;case"cave":gU(t,n);break;case"ramp":yU(t);break;case"water":bU(t);break;case"steps":xU(t);break}return r}function Hb(e,t,n){const r=Math.floor(e.rows*n);for(let a=r;a<e.rows-2;a++)if(e.isSolid(t|0,a))return a-5;return Math.floor(e.rows*n)}function SU(e){let t=e*2654435761>>>0;return()=>(t^=t<<13,t^=t>>17,t^=t<<5,(t>>>0)/4294967296)}const a6=.1,Au=1/60,wU=8,S0=.9;let Xi=0;const Qd=[{id:"slugcat",name:"Slugcat",icon:"",segN:6,segR:[2.6,2.3,2.1,1.9,1.6,1.3],segM:[2.2,1.8,1.5,1.3,1,.8],gripIdx:[4,5],jointStiff:.45,hue:210,lineage:Xi++,species:"crawler",appendageCount:3,biolum:!0,tailFade:!0,diet:"omnivore"},{id:"centipede",name:"Centipede",icon:"",segN:10,segR:[1.6,1.8,1.8,1.8,1.8,1.8,1.8,1.8,1.8,1.4],segM:[1.4,1.2,1.2,1.2,1.2,1.2,1.2,1.2,1.2,.9],gripIdx:[1,3,5,7,9],jointStiff:.55,hue:28,lineage:Xi++,species:"centipede",appendageCount:5,biolum:!1,tailFade:!1,diet:"carnivore"},{id:"crawler",name:"Crawler",icon:"",segN:4,segR:[3.2,3,2.8,2.4],segM:[3.5,3,2.5,2],gripIdx:[2,3],jointStiff:.5,hue:340,lineage:Xi++,species:"crawler",appendageCount:2,biolum:!0,tailFade:!0,diet:"herbivore"},{id:"serpent",name:"Serpent",icon:"",segN:8,segR:[1.5,1.7,1.8,1.9,1.9,1.8,1.6,1.3],segM:[1,1,1,1,1,1,1,.8],gripIdx:[2,4,6,7],jointStiff:.35,hue:100,lineage:Xi++,species:"serpent",appendageCount:0,biolum:!0,tailFade:!0,diet:"omnivore"},{id:"spider",name:"Arachnid",icon:"",segN:5,segR:[2.8,2.5,2.2,1.9,1.5],segM:[3,2.5,2,1.5,1],gripIdx:[3,4],jointStiff:.6,hue:270,lineage:Xi++,species:"spider",appendageCount:4,biolum:!0,tailFade:!1,diet:"carnivore"},{id:"jellyfish",name:"Medusa",icon:"",segN:7,segR:[3.5,3,2.8,2.5,2,1.5,1],segM:[.6,.5,.5,.4,.3,.3,.2],gripIdx:[],jointStiff:.25,hue:185,lineage:Xi++,species:"jellyfish",appendageCount:6,biolum:!0,tailFade:!0,diet:"omnivore"},{id:"leviathan",name:"Leviathan",icon:"",segN:12,segR:[2,2.4,2.8,3,3.2,3.2,3,2.8,2.4,2,1.6,1.2],segM:[1.8,2,2.2,2.5,2.8,2.8,2.5,2.2,2,1.8,1.4,1],gripIdx:[3,5,7,9],jointStiff:.4,hue:55,lineage:Xi++,species:"serpent",appendageCount:4,biolum:!0,tailFade:!0,diet:"omnivore"},{id:"manta",name:"Manta Ray",icon:"",segN:5,segR:[2.2,2.8,3.4,2.8,1.8],segM:[.8,.9,1,.8,.5],gripIdx:[],jointStiff:.28,hue:190,lineage:Xi++,species:"swimmer",appendageCount:2,biolum:!0,tailFade:!0,diet:"omnivore"},{id:"bird",name:"Skybird",icon:"",segN:4,segR:[1.6,2,1.8,1],segM:[.28,.35,.3,.18],gripIdx:[],jointStiff:.3,hue:42,lineage:Xi++,species:"aerial",appendageCount:2,biolum:!1,tailFade:!0,diet:"carnivore"},{id:"glowworm",name:"Glowworm",icon:"",segN:11,segR:[1,1.1,1.2,1.3,1.3,1.3,1.2,1.2,1.1,1,.8],segM:[.7,.6,.6,.6,.6,.6,.6,.6,.6,.6,.5],gripIdx:[2,5,8,10],jointStiff:.38,hue:140,lineage:Xi++,species:"serpent",appendageCount:0,biolum:!0,tailFade:!0,diet:"omnivore"},{id:"starfish",name:"Starfish",icon:"",segN:5,segR:[2,1.8,1.8,1.8,1.8],segM:[2.2,1.6,1.6,1.6,1.6],gripIdx:[0,1,2,3,4],jointStiff:.52,hue:22,lineage:Xi++,species:"crawler",appendageCount:5,biolum:!0,tailFade:!1,diet:"omnivore"},{id:"dragonfly",name:"Dragonfly",icon:"",segN:3,segR:[1.2,1.5,.8],segM:[.22,.28,.16],gripIdx:[],jointStiff:.4,hue:160,lineage:Xi++,species:"aerial",appendageCount:2,biolum:!1,tailFade:!0,diet:"carnivore"},{id:"crab",name:"Crab",icon:"",segN:4,segR:[2.6,2.8,2.8,2.4],segM:[2.8,3,2.8,2.2],gripIdx:[0,1,2,3],jointStiff:.65,hue:15,lineage:Xi++,species:"spider",appendageCount:4,biolum:!1,tailFade:!1,diet:"omnivore"}];function s6(e){return 3+Math.min(4,Math.ceil((e.segN-1)/3))*2}function i6(e){const t=s6(e),n=new Float32Array(t);n[0]=1.6,n[1]=.55,n[2]=.2;const r=Math.min(4,Math.ceil((e.segN-1)/3));for(let a=0;a<r;a++)n[3+a*2]=.1+Math.random()*.05,n[3+a*2+1]=(Math.random()-.5)*.04;return n}function l6(e,t){const n=e[0],r=e[1],a=e[2],i=t.segs,s=i.length,c=Math.min(4,Math.ceil((s-1)/3)),l=MU(t),d=-a*l*.04,u=[];for(let h=0;h<s;h++){const f=3+Math.min(c-1,Math.floor(h*c/s))*2,g=e[f]??.1,x=e[f+1]??0,v=n*t.phase*60+h*r;u.push((x+g*Math.sin(v)+d)*i[h].mass)}return u}function MU(e){const t=e.segs[0],n=e.segs[e.segs.length-1];return Math.atan2(n.y-t.y,n.x-t.x)}function c6(e){let t=0,n=0;for(const r of e.segs)t+=r.x*r.mass,n+=r.mass;return t/n}function CU(e){return e.segs.filter(t=>t.gripped).length}function kU(e){const t=e.length;if(!(t<2))for(let n=0;n<t;n++){const r=e[n];if(!r.alive)continue;const a=r.segs[0];for(let i=n+1;i<t;i++){const s=e[i];if(!s.alive)continue;const c=s.segs[0],l=c.x-a.x,d=c.y-a.y,u=l*l+d*d,h=(a.r+c.r)*1.8;if(u<h*h&&u>.001){const m=Math.sqrt(u),f=h-m,g=l/m,x=d/m,v=f*.15;a.vx-=g*v,a.vy-=x*v,c.vx+=g*v,c.vy+=x*v}}}}function RU(e){if(e.energy<160||e.age<300||!e.alive||Math.random()>.15)return null;e.energy-=80;const t=e.segs[0],n=t.x+(Math.random()-.5)*10,r=t.y-2,a=e.policyParams.slice();for(let c=0;c<a.length;c++)a[c]+=(Math.random()-.5)*.08;const i={...e.bp,hue:((e.bp.hue+Math.floor((Math.random()-.5)*12))%360+360)%360,lineage:e.bp.lineage+1},s=Ou(i,n,r,a);return s.energy=80,s.generation=e.generation+1,s.facingDir=Math.random()<.5?1:-1,s}function Ou(e,t,n,r){const a=e.segR.map((i,s)=>({x:t+s*i*1.65,y:n,vx:0,vy:0,r:i,mass:e.segM[s]??1,isGrip:e.gripIdx.includes(s),gripped:!1}));return{bp:e,segs:a,phase:0,alive:!0,energy:120,age:0,startX:t,startY:n,fitness:0,policyParams:r??i6(e),lastProgress:t,stuckTimer:0,trail:[],facingDir:Math.random()<.5?1:-1,lastAteTick:0,ateAmount:0,maxAge:800+Math.floor(Math.random()*600),generation:0}}function d6(e,t,n,r=a6){const a=e.segs,i=a.length;e.age++,e.phase+=Au;const s=a[0];e.trail.push({x:s.x,y:s.y,age:0}),e.trail.length>40&&e.trail.shift();for(const w of e.trail)w.age++;if(e.age%12===0){const w=n.nearestFood(s.x,s.y,60);w&&(e.facingDir=w.x>=s.x?1:-1)}const c=e.bp.species==="aerial",l=e.bp.species==="swimmer"||e.bp.species==="jellyfish";for(let w=0;w<i;w++){const M=a[w],k=t[w]??0,j=n.cellAt(M.x|0,M.y|0)===K.WATER,I=c?r*.12:r;if(M.vy+=I*60*Au,M.vy+=k*Au*60,j&&(M.vx*=.84,M.vy*=.84,M.vy-=r*(c?1.2:l?.85:.55)*60*Au,l)){const O=(e.policyParams[0]??1.6)*e.phase*60+w*.6;M.vx+=Math.sin(O)*.035*e.facingDir*M.mass}const E=j?1:M.gripped?.84:.997;M.vx*=E,M.vy*=E,M.vx=Math.max(-S0,Math.min(S0,M.vx)),M.vy=Math.max(-S0,Math.min(S0,M.vy)),M.x+=M.vx,M.y+=M.vy}const d=Math.max(.15,Math.min(.85,e.bp.jointStiff));for(let w=0;w<5;w++)for(let M=0;M<i-1;M++){const k=a[M],R=a[M+1],j=(k.r+R.r)*.85,I=R.x-k.x,E=R.y-k.y,O=Math.sqrt(I*I+E*E);if(O<1e-4)continue;const L=(O-j)/O*d,$=k.mass+R.mass,F=R.mass/$,B=k.mass/$;k.x+=I*L*F,k.y+=E*L*F,R.x-=I*L*B,R.y-=E*L*B}for(const w of a){w.gripped=!1;const M=w.y+w.r+.5,k=w.x|0,R=M|0;if(R>=0&&R<n.rows&&n.isSolid(k,R)){let $=R;for(;$>1&&n.isSolid(k,$-1);)$--;const F=w.y+w.r-$;F>0&&F<w.r*2.5&&(w.y-=F,w.vy=Math.min(0,w.vy)*-.1,w.vx*=.76,w.gripped=w.isGrip)}const j=w.x-w.r-.5|0,I=w.x+w.r+.5|0,E=w.y|0;j>=0&&n.isSolid(j,E)&&(w.x+=.6,w.vx=Math.abs(w.vx)*.3),I<n.cols&&n.isSolid(I,E)&&(w.x-=.6,w.vx=-Math.abs(w.vx)*.3);const O=w.y-w.r-.5|0;O>=0&&n.isSolid(k,O)&&(w.y=O+w.r+1,w.vy=Math.abs(w.vy)*.25),w.x=Math.max(w.r+1,Math.min(n.cols-w.r-1,w.x)),w.y=Math.max(w.r+1,Math.min(n.rows-w.r-1,w.y));const L=n.cellAt(w.x|0,w.y|0);(L===K.FIRE||L===K.MAGMA)&&(e.energy-=.25),L===K.ACID&&(e.energy-=.08)}const u=e.policyParams[0]??1.6,h=e.policyParams[1]??.55,m=Math.max(.04,e.policyParams[3]??.1)*.55,f=a[0],g=e.phase*60;switch(e.bp.species){case"serpent":{for(let w=0;w<i;w++){const M=u*g+w*h*2.2,k=a[Math.max(0,w-1)],R=a[Math.min(i-1,w+1)],I=Math.atan2(R.y-k.y,R.x-k.x)+Math.PI/2,E=w/(i-1),O=m*(1+E*2.5)*a[w].mass;a[w].vx+=Math.cos(I)*Math.sin(M)*O,a[w].vy+=Math.sin(I)*Math.sin(M)*O,a[w].vx+=Math.max(0,Math.sin(M+.9))*m*.35*e.facingDir*a[w].mass}for(let w=1;w<i;w++)a[w].gripped&&(f.vx+=e.facingDir*.035*a[w].mass);break}case"spider":{const w=Math.sin(u*g*1.6),M=e.bp.gripIdx;for(let k=0;k<M.length;k++){const R=M[k],j=a[R],I=k%2===0,E=I?w>0:w<0;j.gripped&&E&&(f.vx+=e.facingDir*.11*j.mass,a[Math.max(0,R-1)].vy-=.018),j.isGrip&&!E&&(j.vy-=.012*Math.max(0,-Math.sin(u*g*1.6+(I?0:Math.PI))))}f.vy+=Math.sin(u*g*3.2)*.01;for(let k=0;k<i;k++)a[k].vx+=m*.15*e.facingDir*a[k].mass*Math.max(0,Math.sin(u*g+k*.6));break}case"centipede":{const w=e.bp.gripIdx;for(let M=0;M<w.length;M++){const k=w[M],R=a[k],j=u*g*1.2+M*h*1.8,I=Math.max(0,Math.sin(j));if(R.gripped&&I>.3){const E=e.facingDir*.065*R.mass*I;a[Math.max(0,k-1)].vx+=E,f.vx+=E*.25}R.isGrip&&I<.2&&(R.vy-=.018*Math.max(0,Math.sin(j+Math.PI)))}for(let M=0;M<i;M++)a[M].vy+=Math.sin(u*g*.9+M*.45)*m*.18*a[M].mass;break}case"crawler":{const w=Math.sin(u*g*.7),M=Math.floor(i/2);if(w>0){for(let R=0;R<M;R++)a[R].vx+=e.facingDir*m*1.4*a[R].mass;for(let R=M;R<i;R++)a[R].gripped&&(a[R].vx*=.65)}else{for(let R=M;R<i;R++)a[R].vx+=e.facingDir*m*1.8*a[R].mass;for(let R=0;R<M;R++)a[R].gripped&&(a[R].vx*=.65)}const k=Math.abs(Math.cos(u*g*.7))*.03;for(let R=1;R<i-1;R++){const j=1-Math.abs(R-M)/Math.max(1,M);a[R].vy-=k*j*a[R].mass}for(let R=1;R<i;R++)a[R].gripped&&(f.vx+=e.facingDir*.025*a[R].mass);break}case"jellyfish":{const w=Math.sin(u*.45*g);let M=0,k=0,R=0;for(const j of a)M+=j.x*j.mass,k+=j.y*j.mass,R+=j.mass;if(M/=R,k/=R,w>0){const j=w*.065;for(const I of a)I.vx+=(M-I.x)*j,I.vy+=(k-I.y)*j;for(const I of a)I.vy-=w*.045*I.mass;f.vx+=e.facingDir*w*.025}else{const j=Math.abs(w)*.018;for(const I of a)I.vx+=(I.x-M)*j*.5,I.vy+=(I.y-k)*j*.3}for(let j=Math.floor(i*.55);j<i;j++)a[j].vy+=.009,a[j].vx+=Math.sin(g*.6+j*.9)*.009;break}case"swimmer":{if(a.some(M=>n.cellAt(M.x|0,M.y|0)===K.WATER)){const M=Math.floor(i*.4);for(let k=M;k<i;k++){const R=u*1.8*g+k*.9,j=a[Math.max(0,k-1)],I=a[Math.min(i-1,k+1)],O=Math.atan2(I.y-j.y,I.x-j.x)+Math.PI/2,L=(k-M)/Math.max(1,i-1-M),$=m*3*a[k].mass*(.3+L*.7);a[k].vx+=Math.cos(O)*Math.sin(R)*$,a[k].vy+=Math.sin(O)*Math.sin(R)*$}f.vx+=e.facingDir*m*.55}else{const M=Math.sin(u*g*2.5);for(let k=Math.floor(i/2);k<i;k++)a[k].vy-=Math.max(0,M)*.12*a[k].mass,a[k].vx+=M*.04*e.facingDir*a[k].mass}break}case"aerial":{const w=u*g*1.1,M=Math.sin(w);if(M>-.2){const k=Math.max(0,M)*.16;for(const j of a)j.vy-=k*j.mass;const R=Math.max(0,M)*.065;for(const j of a)j.vx+=R*e.facingDir*j.mass}else for(const k of a)k.vy+=.005*k.mass;f.vy+=M*.025,f.vx+=e.facingDir*.02,a[i-1].vx-=Math.sin(w*.5)*.01*e.facingDir;break}default:{for(let w=0;w<i;w++){const M=u*g+w*h;a[w].vx+=Math.max(0,Math.sin(M))*m*e.facingDir*a[w].mass}for(let w=1;w<i;w++)a[w].gripped&&(f.vx+=e.facingDir*.06*a[w].mass,w>1&&(a[w-1].vx+=e.facingDir*.03*a[w].mass));break}}const v=n.consume(f.x,f.y,f.r*3);v>0&&(e.energy=Math.min(200,e.energy+v*50),f.vx+=e.facingDir*.04,e.lastAteTick=e.age,e.ateAmount=v),e.energy-=.015,e.energy<=0&&(e.alive=!1);const b=c6(e);Math.abs(b-e.lastProgress)<.08?(e.stuckTimer++,e.stuckTimer>80&&(e.facingDir=e.facingDir*-1,e.stuckTimer=0,e.lastProgress=b)):(e.stuckTimer=0,e.lastProgress=b)}function AU(e,t){const n=c6(e)-e.startX,r=e.alive?5:-5,a=CU(e)>0?1:-2,i=e.energy-120,s=Math.max(0,Math.min(1,e.energy/120));return t==="survive"?n*.9+r+a+s*3:t==="forage"?i*.22+n*.3+r+a:t==="climb"?(e.startY-e.segs[0].y)*1.5+r+s*2:n+r+a}class jU{constructor(t,n,r,a,i="survive"){this.candidates=[],this.evalCreature=null,this.evalIdx=0,this.evalTick=0,this.evalMaxTick=240,this.generation=0,this.bestScore=-1/0,this.bestParams=null,this.running=!1,this.popSize=12,this.eliteK=4,this._bp=t,this._grid=n,this._sx=r,this._sy=a,this._task=i;const s=s6(t);this.mean=i6(t).slice(),this.std=new Float32Array(s).fill(.35),this.std[0]=.5,this.std[1]=.4,this.std[2]=.2}start(t=12,n=4){this.popSize=t,this.evalMaxTick=n*60|0,this.running=!0,this._newRound()}stop(){this.running=!1}step(){if(!this.running)return{improved:!1};const t=performance.now();let n=!1;for(;performance.now()-t<wU;){if(!this.evalCreature||this.evalIdx>=this.candidates.length){this._update(),this._newRound(),this.generation++,n=!0;break}const r=this.candidates[this.evalIdx],a=l6(r.params,this.evalCreature);d6(this.evalCreature,a,this._grid),this.evalTick++;const i=this.evalTick>90&&this.evalCreature.stuckTimer>80;(!this.evalCreature.alive||i||this.evalTick>=this.evalMaxTick)&&(r.score=AU(this.evalCreature,this._task),r.score>this.bestScore&&(this.bestScore=r.score,this.bestParams=new Float32Array(r.params),n=!0),this.evalIdx++,this.evalIdx<this.candidates.length&&(this.evalCreature=Ou(this._bp,this._sx,this._sy,this.candidates[this.evalIdx].params),this.evalTick=0))}return{improved:n}}spawnChampion(){return this.bestParams?Ou(this._bp,this._sx,this._sy,this.bestParams.slice()):null}get currentCandidate(){return this.evalCreature}getStats(){const t=this.candidates.filter(r=>isFinite(r.score)),n=t.length>0?t.reduce((r,a)=>r+a.score,0)/t.length:0;return{generation:this.generation,bestScore:this.bestScore,avgScore:n,candidateIdx:this.evalIdx,popSize:this.popSize,running:this.running}}changeGrid(t){this._grid=t}_newRound(){if(this.candidates=Array.from({length:this.popSize},()=>({params:this._sample(),score:-1/0})),this._task==="forage"){for(let t=-20;t<=50;t+=5)for(let n=-6;n<=4;n+=3)if(Math.random()<.45){const r=this._sx+t|0,a=this._sy+n|0;r>1&&r<this._grid.cols-1&&a>1&&a<this._grid.rows-1&&this._grid.cellAt(r,a)===0&&this._grid.set(r,a,K.FOOD)}}this.evalCreature=Ou(this._bp,this._sx,this._sy,this.candidates[0].params),this.evalIdx=0,this.evalTick=0}_sample(){const t=new Float32Array(this.mean.length);for(let n=0;n<t.length;n++)t[n]=this.mean[n]+EU()*this.std[n];return t}_update(){const t=this.candidates.filter(r=>isFinite(r.score)).sort((r,a)=>a.score-r.score);if(t.length===0)return;const n=t.slice(0,Math.max(2,this.eliteK));for(let r=0;r<this.mean.length;r++){let a=0;for(const i of n)a+=i.params[r];this.mean[r]=a/n.length}for(let r=0;r<this.std.length;r++){let a=0;for(const i of n)a+=(i.params[r]-this.mean[r])**2;this.std[r]=Math.max(.008,Math.sqrt(a/n.length)*1.05+.003)}}}function EU(){let e=0,t=0;for(;!e;)e=Math.random();for(;!t;)t=Math.random();return Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*t)}let TU=1;function IU(e,t,n,r){const a=[];return n>20&&a.push("runner"),n>40&&a.push("climber"),e.segN>7&&a.push("crawler"),e.segN<=4&&a.push("heavy"),{id:`sp-${TU++}`,bp:{...e,lineage:e.lineage+1},bestParams:t.slice(),bestScore:n,generation:r,createdAt:Date.now(),tags:a}}function dC(e){let t=0;for(const n of e.segs)t+=n.mass;return t}function PU(e){const t=e.length;if(!(t<2))for(let n=0;n<t;n++){const r=e[n];if(!r.alive)continue;const a=r.bp.diet;if(a==="herbivore"){for(let i=0;i<t;i++){if(n===i)continue;const s=e[i];if(!s.alive||s.bp.diet==="herbivore")continue;const c=r.segs[0].x-s.segs[0].x,l=r.segs[0].y-s.segs[0].y,d=c*c+l*l;if(d<900&&d>.01){const u=Math.sqrt(d),h=.08/(u*.05+1);r.segs[0].vx+=c/u*h,r.segs[0].vy+=l/u*h*.5,r.facingDir=c>0?1:-1}}continue}if(a==="carnivore"||a==="omnivore"){const i=r.segs[0],s=dC(r);let c=null,l=1/0;for(let d=0;d<t;d++){if(n===d)continue;const u=e[d];if(!u.alive||dC(u)>=s*(a==="carnivore"?.95:.65))continue;const f=u.segs[0].x-i.x,g=u.segs[0].y-i.y,x=f*f+g*g;x<l&&x<2500&&(l=x,c=u)}if(c){const d=c.segs[0].x-i.x,u=c.segs[0].y-i.y,h=Math.sqrt(l);r.facingDir=d>0?1:-1;const m=.05/(h*.03+1);i.vx+=d/h*m,i.vy+=u/h*m*.5;for(const f of r.segs)for(const g of c.segs){const x=g.x-f.x,v=g.y-f.y,b=x*x+v*v,w=(f.r+g.r)*1.2;if(b<w*w){const M=f.mass*.8;if(c.energy-=M,r.energy=Math.min(200,r.energy+M*.6),b>.01){const k=Math.sqrt(b);g.vx+=x/k*.3,g.vy+=v/k*.3}r.lastAteTick=r.age,r.ateAmount=1;break}}}}}}function FU(e){const t=e.length;if(!(t<2))for(let n=0;n<t;n++){const r=e[n];if(r.alive)for(let a=n+1;a<t;a++){const i=e[a];if(!i.alive)continue;const s=r.segs[0].x-i.segs[0].x,c=r.segs[0].y-i.segs[0].y;if(!(s*s+c*c>2500))for(const l of r.segs)for(const d of i.segs){const u=d.x-l.x,h=d.y-l.y,m=u*u+h*h,f=(l.r+d.r)*.9;if(m<f*f&&m>.001){const g=Math.sqrt(m),x=f-g,v=u/g,b=h/g,w=x*.12,M=l.mass+d.mass;l.vx-=v*w*(d.mass/M),l.vy-=b*w*(d.mass/M),d.vx+=v*w*(l.mass/M),d.vy+=b*w*(l.mass/M)}}}}}function _U(e,t,n=a6){const r=e.segs,a=r.length;e.phase+=Au*.3;for(const i of r)i.vy+=n*60*Au,t.cellAt(i.x|0,i.y|0)===K.WATER?(i.vx*=.88,i.vy*=.88,i.vy-=n*.35*60*Au):(i.vx*=.992,i.vy*=.992),i.vx=Math.max(-S0,Math.min(S0,i.vx)),i.vy=Math.max(-S0,Math.min(S0,i.vy)),i.x+=i.vx,i.y+=i.vy;for(let i=0;i<2;i++)for(let s=0;s<a-1;s++){const c=r[s],l=r[s+1],d=(c.r+l.r)*1.2,u=l.x-c.x,h=l.y-c.y,m=Math.sqrt(u*u+h*h);if(m<1e-4)continue;const f=(m-d)/m*.15,g=c.mass+l.mass;c.x+=u*f*(l.mass/g),c.y+=h*f*(l.mass/g),l.x-=u*f*(c.mass/g),l.y-=h*f*(c.mass/g)}for(const i of r){i.gripped=!1,i.x=Math.max(i.r+1,Math.min(t.cols-i.r-1,i.x)),i.y=Math.max(i.r+1,Math.min(t.rows-i.r-1,i.y));const s=i.x|0,c=i.y+i.r+.5|0;c>=0&&c<t.rows&&t.isSolid(s,c)&&(i.y=c-i.r-.5,i.vy=Math.min(0,i.vy)*-.1,i.vx*=.6,i.gripped=!0)}}function NU(e,t,n,r){const a=Math.max(0,1-r/300)*.45;a<.01||Lv(e,t,n,!1,a)}function Lv(e,t,n,r=!1,a=1){const i=t.segs;if(i.length<2)return;const{hue:s,species:c,biolum:l,tailFade:d,appendageCount:u}=t.bp,h=Math.max(0,Math.min(1,t.energy/120)),m=Math.sin(t.phase*2.2)*.08+1;if(e.save(),t.trail.length>3)for(let E=0;E<t.trail.length-1;E++){const O=t.trail[E],L=Math.max(0,1-O.age/40)*.15*a;L<.01||(e.beginPath(),e.arc(O.x,O.y,i[0].r*n*.4,0,Math.PI*2),e.fillStyle=`hsla(${s},70%,55%,${L})`,e.fill())}u>0&&DU(e,t,n,a),OU(e,i,n,s,h,a,l,d,m,t.phase);for(const E of i)if(E.gripped){const O=E.r*n*.6;e.beginPath(),e.arc(E.x,E.y+E.r*n*.5,O,0,Math.PI*2),e.fillStyle=`hsla(${(s+130)%360},90%,60%,${.25*a})`,e.fill()}const f=i[0],g=i[1],x=Math.atan2(f.y-g.y,f.x-g.x),v=f.r*n*.15,b=f.r*n*.5;l&&(e.shadowColor=`hsl(${s},100%,80%)`,e.shadowBlur=v*6);const w=f.x+Math.cos(x)*b,M=f.y+Math.sin(x)*b;if(e.beginPath(),e.arc(w,M,v*m,0,Math.PI*2),e.fillStyle=`hsla(${s},60%,85%,${.7*a*h})`,e.fill(),e.shadowBlur=0,h<.35){const E=1+(.35-h)*8,O=(Math.sin(t.phase*E)*.5+.5)*.4;e.beginPath(),e.arc(f.x,f.y,f.r*n*1.2,0,Math.PI*2),e.fillStyle=`hsla(0,80%,50%,${O*a})`,e.fill()}if(h>.8&&l){const E=(h-.8)*2.5*.12;e.beginPath(),e.arc(f.x,f.y,f.r*n*2.5*m,0,Math.PI*2),e.fillStyle=`hsla(${s},80%,70%,${E*a})`,e.fill()}const k=t.age-t.lastAteTick;if(k<25&&t.lastAteTick>0){const E=Math.max(0,1-k/25),O=f.r*n*(1.8+t.ateAmount*.6)*E;e.beginPath(),e.arc(f.x,f.y,O,0,Math.PI*2),e.fillStyle=`hsla(120,90%,65%,${.18*E*a})`,e.fill();for(let L=0;L<Math.min(4,t.ateAmount*2);L++){const $=t.phase*8+L*1.57,F=O*(.5+E*.5),B=f.x+Math.cos($)*F,W=f.y+Math.sin($)*F;e.beginPath(),e.arc(B,W,.3*E,0,Math.PI*2),e.fillStyle=`hsla(100,100%,80%,${.5*E*a})`,e.fill()}}const R=f.r*n*1.8,j=f.x+Math.cos(x)*R*t.facingDir,I=f.y+Math.sin(x)*R*.3*t.facingDir;if(e.beginPath(),e.arc(j,I,v*.4,0,Math.PI*2),e.fillStyle=`hsla(${s},50%,70%,${.15*a*h})`,e.fill(),r){e.strokeStyle=`hsla(${s},80%,70%,${.4*a})`,e.lineWidth=n*.2,e.setLineDash([n*.5,n*.3]),e.beginPath();for(let E=0;E<i.length;E++){const O=i[E];E===0?e.moveTo(O.x,O.y):e.lineTo(O.x,O.y)}e.stroke(),e.setLineDash([])}e.restore()}function OU(e,t,n,r,a,i,s,c,l,d){const u=t.length;if(u<2)return;const h=[],m=[];for(let M=0;M<u;M++){const k=t[M],R=t[Math.min(M+1,u-1)],j=t[Math.max(M-1,0)],E=Math.atan2(R.y-j.y,R.x-j.x)+Math.PI/2,O=1+Math.sin(d*2.2+M*.5)*.06,L=k.r*n*.9*O;h.push({x:k.x+Math.cos(E)*L,y:k.y+Math.sin(E)*L}),m.push({x:k.x-Math.cos(E)*L,y:k.y-Math.sin(E)*L})}e.beginPath(),e.moveTo(h[0].x,h[0].y);for(let M=1;M<h.length;M++){const k=h[M-1],R=h[M];e.quadraticCurveTo(k.x,k.y,(k.x+R.x)/2,(k.y+R.y)/2)}e.lineTo(h[u-1].x,h[u-1].y);const f=t[u-1];e.quadraticCurveTo(f.x+(h[u-1].x-f.x)*.3,f.y+1,m[u-1].x,m[u-1].y);for(let M=m.length-2;M>=0;M--){const k=m[M+1],R=m[M];e.quadraticCurveTo(k.x,k.y,(k.x+R.x)/2,(k.y+R.y)/2)}const g=t[0];e.quadraticCurveTo(g.x-(g.x-m[0].x)*.3,g.y-1,h[0].x,h[0].y),e.closePath();const x=e.createLinearGradient(t[0].x,t[0].y,t[u-1].x,t[u-1].y),v=18+a*22,b=50+a*25,w=c?.35:.75;x.addColorStop(0,`hsla(${r},${b}%,${v+12}%,${.85*i})`),x.addColorStop(.4,`hsla(${r},${b}%,${v}%,${.8*i})`),x.addColorStop(1,`hsla(${(r+20)%360},${b-10}%,${v-6}%,${w*i})`),s&&(e.shadowColor=`hsl(${r},90%,65%)`,e.shadowBlur=g.r*n*2.5*a),e.fillStyle=x,e.fill(),e.shadowBlur=0,e.strokeStyle=`hsla(${r},65%,${v+20}%,${.18*i})`,e.lineWidth=n*.12,e.stroke();for(let M=1;M<u-1;M+=2){const k=t[M],R=t[M-1],j=t[M+1],E=Math.atan2(j.y-R.y,j.x-R.x)+Math.PI/2,O=k.r*n*.5;e.beginPath(),e.moveTo(k.x+Math.cos(E)*O,k.y+Math.sin(E)*O),e.lineTo(k.x-Math.cos(E)*O,k.y-Math.sin(E)*O),e.strokeStyle=`hsla(${(r+40)%360},45%,${v+15}%,${.12*i})`,e.lineWidth=n*.08,e.stroke()}}function DU(e,t,n,r){const{hue:a,species:i,appendageCount:s}=t.bp,c=t.segs,l=c.length;for(let d=0;d<s;d++){const u=Math.min(l-1,Math.floor((d+1)*l/(s+1))),h=c[u],m=c[Math.max(0,u-1)],f=c[Math.min(l-1,u+1)],x=Math.atan2(f.y-m.y,f.x-m.x)+Math.PI/2,v=h.r*n*(i==="spider"?3.5:i==="centipede"?2.2:i==="jellyfish"?3:i==="aerial"?4.5:1.8),b=Math.sin(t.phase*(i==="aerial"?9:3)+d*1.7)*.4,w=i==="jellyfish"?.3:i==="aerial"?-.5:-.2;for(const M of[-1,1]){const k=h.x+Math.cos(x)*h.r*n*.7*M,R=h.y+Math.sin(x)*h.r*n*.7*M,j=x*M+b+w,I=k+Math.cos(j)*v*.5,E=R+Math.sin(j)*v*.5,O=j+b*.6+(i==="jellyfish"?.5:i==="aerial"?-.8:-.3),L=I+Math.cos(O)*v*.5,$=E+Math.sin(O)*v*.5;e.beginPath(),e.moveTo(k,R),e.quadraticCurveTo(I,E,L,$);const F=i==="jellyfish"?.08:i==="spider"?.15:i==="aerial"?.3:.2;e.lineWidth=h.r*n*F,e.strokeStyle=`hsla(${a},45%,30%,${(i==="aerial"?.22:.5)*r})`,e.lineCap="round",e.stroke(),i==="aerial"&&(e.beginPath(),e.moveTo(k,R),e.lineTo(L,$),e.lineTo(h.x,h.y),e.closePath(),e.fillStyle=`hsla(${a},55%,60%,${.09*r})`,e.fill()),(h.isGrip||i==="spider"||i==="centipede")&&(e.beginPath(),e.arc(L,$,h.r*n*.15,0,Math.PI*2),e.fillStyle=`hsla(${(a+100)%360},60%,50%,${.4*r})`,e.fill())}}}const uC=[{id:"attract",label:"Attract",icon:"",color:"#ff88ff",desc:"Pull all creatures toward cursor"},{id:"repel",label:"Repel",icon:"",color:"#88ffcc",desc:"Push all creatures away"},{id:"feed",label:"Feed",icon:"",color:"#44ff88",desc:"Spawn food at cursor area"},{id:"shockwave",label:"Shockwave",icon:"",color:"#ffaa44",desc:"Explosive force push on creatures"},{id:"heal",label:"Heal",icon:"",color:"#88ff88",desc:"Restore energy to nearby creatures"},{id:"fire_rain",label:"Fire Rain",icon:"",color:"#ff5500",desc:"Rain fire from above at cursor"},{id:"freeze_wave",label:"Freeze Wave",icon:"",color:"#88ccff",desc:"Freeze water and cool area"},{id:"speed_boost",label:"Speed Boost",icon:"",color:"#ffff44",desc:"Temporarily boost creature speed"}],u6=[{id:"bomb",label:"Bomb",icon:"",cat:"explosive",desc:"Explodes on contact with fire",color:"#ff6622"},{id:"c4",label:"C4",icon:"",cat:"explosive",desc:"Timed explosion, massive radius",color:"#ff4444"},{id:"nuke",label:"Nuke",icon:"",cat:"explosive",desc:"Devastating chain reaction",color:"#ffcc00"},{id:"fan",label:"Fan",icon:"",cat:"force",desc:"Pushes particles & creatures",color:"#66ccff"},{id:"attractor",label:"Attractor",icon:"",cat:"force",desc:"Pulls everything nearby",color:"#ff88ff"},{id:"repulsor",label:"Repulsor",icon:"",cat:"force",desc:"Pushes everything away",color:"#88ffcc"},{id:"vortex",label:"Vortex",icon:"",cat:"force",desc:"Swirling force field",color:"#4488ff"},{id:"heater",label:"Heater",icon:"",cat:"thermal",desc:"Melts ice, boils water",color:"#ff8844"},{id:"cooler",label:"Cooler",icon:"",cat:"thermal",desc:"Freezes water, cools lava",color:"#88ccff"},{id:"lightning",label:"Lightning",icon:"",cat:"energy",desc:"Electric bolt, ignites & destroys",color:"#ffff44"},{id:"laser",label:"Laser",icon:"",cat:"energy",desc:"Focused beam cuts through matter",color:"#ff2222"},{id:"virus",label:"Virus",icon:"",cat:"bio",desc:"Spreads and consumes organic matter",color:"#88ff44"},{id:"spore",label:"Spore Cloud",icon:"",cat:"bio",desc:"Disperses spores that grow",color:"#aa88ff"},{id:"wheel",label:"Wheel",icon:"",cat:"mech",desc:"Rolling physics body",color:"#aabbcc"},{id:"ball",label:"Ball",icon:"",cat:"mech",desc:"Bouncy physics sphere",color:"#ff88aa"},{id:"box",label:"Box",icon:"",cat:"mech",desc:"Heavy physics block",color:"#88aaff"},{id:"spring",label:"Spring",icon:"",cat:"mech",desc:"Bouncy spring launcher",color:"#44ff88"},{id:"motor",label:"Motor",icon:"",cat:"mech",desc:"Spinning motor with torque",color:"#ffaa44"},{id:"blackhole",label:"Black Hole",icon:"",cat:"cosmic",desc:"Devours everything nearby",color:"#440066"},{id:"whitehole",label:"White Hole",icon:"",cat:"cosmic",desc:"Spawns random matter",color:"#ffffff"},{id:"portal_in",label:"Portal In",icon:"",cat:"cosmic",desc:"Teleports matter to portal out",color:"#ff44ff"},{id:"portal_out",label:"Portal Out",icon:"",cat:"cosmic",desc:"Receives teleported matter",color:"#44ffff"}],LU=[{id:"explosive",label:"Explosives",color:"#ff6622"},{id:"force",label:"Forces",color:"#66ccff"},{id:"thermal",label:"Thermal",color:"#ff8844"},{id:"energy",label:"Energy",color:"#ffff44"},{id:"bio",label:"Biological",color:"#88ff44"},{id:"mech",label:"Mechanical",color:"#aabbcc"},{id:"cosmic",label:"Cosmic",color:"#aa44ff"}],Wb=[{id:"tree",label:"Oak Tree",icon:"",color:"#228833",desc:"Grows tall, branches wide, drops fruit"},{id:"vine",label:"Ivy Vine",icon:"",color:"#33aa44",desc:"Invasive creeper, never stops growing"},{id:"coral",label:"Coral",icon:"",color:"#ff6688",desc:"Underwater only  needs water to grow"},{id:"mushroom",label:"Mushroom",icon:"",color:"#aa66cc",desc:"Fungi, spreads spores, grows in dark"},{id:"fern",label:"Fern",icon:"",color:"#44cc55",desc:"Fractal fronds, photosynthesizes fast"},{id:"cactus",label:"Cactus",icon:"",color:"#55aa44",desc:"Desert plant, slow growth, stores water"},{id:"kelp",label:"Giant Kelp",icon:"",color:"#228866",desc:"Aquatic, grows very tall in water"},{id:"bamboo",label:"Bamboo",icon:"",color:"#33cc33",desc:"Grows extremely fast, straight up"},{id:"moss",label:"Moss",icon:"",color:"#448833",desc:"Spreads on surfaces, needs moisture"},{id:"sunflower",label:"Sunflower",icon:"",color:"#ddaa22",desc:"Tall flower, produces seeds (food)"},{id:"lily",label:"Water Lily",icon:"",color:"#ff88bb",desc:"Floats on water, blooms flowers"},{id:"mangrove",label:"Mangrove",icon:"",color:"#337744",desc:"Roots in water/land boundary"},{id:"orchid",label:"Orchid",icon:"",color:"#cc44aa",desc:"Rare bloom, needs specific conditions"},{id:"pitcher",label:"Pitcher Plant",icon:"",color:"#44aa66",desc:"Carnivorous! Traps small creatures"},{id:"bonsai",label:"Bonsai",icon:"",color:"#557733",desc:"Compact tree, slow but elegant growth"}],Gb=[{id:"trim",label:"Trim",icon:"",color:"#ff8866",desc:"Cut back overgrown plants"},{id:"water",label:"Water",icon:"",color:"#4488ff",desc:"Water plants to boost growth"},{id:"fertilize",label:"Fertilize",icon:"",color:"#88cc44",desc:"Boost growth rate dramatically"},{id:"harvest",label:"Harvest",icon:"",color:"#ddaa44",desc:"Collect fruit/seeds from plants"}],Jc=({label:e,val:t,min:n,max:r,step:a,fmt:i,color:s="#88aaff",onChange:c})=>{const l=((t-n)/(r-n)*100).toFixed(0)+"%";return o.jsxs("div",{className:"flex flex-col gap-0.5",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-[6px] font-mono uppercase tracking-widest",style:{color:s+"70"},children:e}),o.jsx("span",{className:"text-[6.5px] font-mono",style:{color:s+"bb"},children:i?i(t):t})]}),o.jsx("input",{type:"range",min:n,max:r,step:a,value:t,onChange:d=>c(+d.target.value),className:"w-full h-[2px] appearance-none cursor-pointer rounded-full",style:{background:`linear-gradient(90deg,${s}55 ${l},rgba(255,255,255,.06) ${l})`}})]})},zU=({active:e,color:t="#88aaff",onClick:n,children:r,title:a,size:i="sm"})=>o.jsx("button",{onClick:n,title:a,className:`flex items-center justify-center gap-0.5 rounded transition-all border
      ${i==="sm"?"px-1.5 py-0.5 text-[6.5px]":"px-2 py-1 text-[7px]"} font-mono uppercase tracking-widest
      ${e?"border-current/30 bg-current/8":"border-white/[0.06] text-white/30 hover:text-white/55 hover:bg-white/[0.04]"}`,style:e?{color:t,borderColor:t+"40",background:t+"10"}:{},children:r}),hC=({label:e,open:t,onToggle:n,color:r="#88aaff",count:a})=>o.jsxs("button",{onClick:n,className:"flex items-center w-full px-2 py-1.5 gap-1 hover:bg-white/[0.03] transition-all",children:[t?o.jsx(Ms,{size:7,className:"text-white/25"}):o.jsx(hs,{size:7,className:"text-white/25"}),o.jsx("span",{className:"text-[6px] font-mono uppercase tracking-widest",style:{color:r+"70"},children:e}),a!=null&&o.jsx("span",{className:"ml-auto text-[5.5px] font-mono px-1 rounded-full",style:{color:r+"50",background:r+"0c"},children:a})]}),BU=({active:e})=>{const t=S.useRef(null),n=S.useRef(0),r=S.useRef(0),a=S.useRef(new fU),i=S.useRef(null),s=S.useRef(null),c=S.useRef([]),l=S.useRef(null),d=S.useRef([]),u=S.useRef([]),h=S.useRef([]),m=S.useRef({scale:1,panX:0,panY:0}),f=S.useRef(!1),g=S.useRef({mx:0,my:0,px:0,py:0}),x=S.useRef(1),v=S.useRef(!1),b=S.useRef({x:0,y:0}),w=S.useRef({x:0,y:0}),M=S.useRef(K.SAND),k=S.useRef(4),R=S.useRef(!0),j=S.useRef(1),I=S.useRef("inspect"),E=S.useRef("bomb"),O=S.useRef("terrarium"),L=S.useRef(Qd[0]),$=S.useRef("survive"),F=S.useRef(null),B=S.useRef(null),W=S.useRef(!1),re=S.useRef(1),oe=S.useRef(0),te=S.useRef(.5),J=S.useRef(.99),[pe,P]=S.useState(!0),[V,fe]=S.useState("terrarium"),[ye,Se]=S.useState(1),[we,ke]=S.useState(K.SAND),[De,_e]=S.useState(4),[ae,Re]=S.useState(!0),[Fe,Oe]=S.useState("elements"),[ne,nt]=S.useState("inspect"),[pt,Et]=S.useState("bomb"),[_t,Ct]=S.useState(Qd[0]),[Xe,Ut]=S.useState("survive"),[Le,Ke]=S.useState(12),[mt,an]=S.useState(null),[gn,Be]=S.useState([]),[ft,Qt]=S.useState({food:0,water:0,creatures:0,plants:0,objects:0}),[nr,_n]=S.useState(!1),[Rn,sn]=S.useState(1),[Cn,wt]=S.useState(1),[st,Zt]=S.useState(0),[Pe,ct]=S.useState(.5),[vt,xe]=S.useState(.99),[ge,Ee]=S.useState("tree"),me=S.useRef("tree"),[je,Te]=S.useState("circle"),Ae=S.useRef("circle"),[Tt,xt]=S.useState("attract"),en=S.useRef("attract"),[At,Ze]=S.useState("water"),yt=S.useRef("water"),[Mt,bn]=S.useState(.6),Pt=S.useRef(.6),[An,cr]=S.useState(.7),Tn=S.useRef(.7),[Sr,de]=S.useState(.35),$e=S.useRef(.35),et=S.useRef([]),[zt,Nt]=S.useState(30),ln=S.useRef(30),[Rt,Nn]=S.useState(null),It=S.useRef(null),[xn,Ln]=S.useState(!1),zn=S.useRef(!1),Or=S.useRef([]),wr=S.useRef([]),[vn,Gr]=S.useState({fluid:!0,powder:!1,solid:!1,gas:!1,bio:!0,tool:!1,explosive:!0,force:!0,thermal:!1,energy:!1,bio_obj:!1,mech:!1,cosmic:!1}),hn=D=>Gr(ee=>({...ee,[D]:!ee[D]}));S.useEffect(()=>{R.current=pe},[pe]),S.useEffect(()=>{M.current=we},[we]),S.useEffect(()=>{k.current=De},[De]),S.useEffect(()=>{j.current=ye},[ye]),S.useEffect(()=>{O.current=V},[V]),S.useEffect(()=>{L.current=_t},[_t]),S.useEffect(()=>{$.current=Xe},[Xe]),S.useEffect(()=>{I.current=ne},[ne]),S.useEffect(()=>{E.current=pt},[pt]),S.useEffect(()=>{me.current=ge},[ge]),S.useEffect(()=>{Ae.current=je},[je]),S.useEffect(()=>{en.current=Tt},[Tt]),S.useEffect(()=>{yt.current=At},[At]),S.useEffect(()=>{Pt.current=Mt,a.current.fluidPressure=Mt},[Mt]),S.useEffect(()=>{Tn.current=An},[An]),S.useEffect(()=>{$e.current=Sr},[Sr]),S.useEffect(()=>{zn.current=xn},[xn]),S.useEffect(()=>{ln.current=zt},[zt]),S.useEffect(()=>{re.current=Cn},[Cn]),S.useEffect(()=>{oe.current=st},[st]),S.useEffect(()=>{te.current=Pe},[Pe]),S.useEffect(()=>{J.current=vt},[vt]);const jr=S.useCallback((D,ee,Ie,Qe)=>{const X=a.current,Z=Ae.current,ce=Math.ceil(Ie);switch(Z){case"circle":X.paint(D|0,ee|0,Ie,Qe);break;case"square":for(let ue=-ce;ue<=ce;ue++)for(let be=-ce;be<=ce;be++)Math.random()<.9&&X.set(D+be|0,ee+ue|0,Qe);break;case"spray":for(let ue=0;ue<ce*3;ue++){const be=Math.random()*Math.PI*2,H=Math.random()*Ie*1.5;X.set(D+Math.cos(be)*H|0,ee+Math.sin(be)*H|0,Qe)}break;case"hline":for(let ue=-ce*2;ue<=ce*2;ue++)for(let be=-1;be<=1;be++)Math.random()<.85&&X.set(D+ue|0,ee+be|0,Qe);break;case"vline":for(let ue=-ce*2;ue<=ce*2;ue++)for(let be=-1;be<=1;be++)Math.random()<.85&&X.set(D+be|0,ee+ue|0,Qe);break}},[]),_r=S.useCallback((D,ee)=>{const Ie=en.current,Qe=c.current,X=a.current;switch(Ie){case"attract":for(const Z of Qe){const ce=D-Z.segs[0].x,ue=ee-Z.segs[0].y,be=Math.sqrt(ce*ce+ue*ue)+1;if(be<80){const H=3.5/(be*.04+1);for(const le of Z.segs)le.vx+=ce/be*H,le.vy+=ue/be*H}}break;case"repel":for(const Z of Qe){const ce=Z.segs[0].x-D,ue=Z.segs[0].y-ee,be=Math.sqrt(ce*ce+ue*ue)+1;if(be<80){const H=4.5/(be*.04+1);for(const le of Z.segs)le.vx+=ce/be*H,le.vy+=ue/be*H}}break;case"feed":for(let Z=0;Z<25;Z++){const ce=D+(Math.random()-.5)*24|0,ue=ee+(Math.random()-.5)*18|0;X.get(ce,ue)===K.EMPTY&&X.set(ce,ue,K.FOOD)}break;case"shockwave":for(const Z of Qe){const ce=Z.segs[0].x-D,ue=Z.segs[0].y-ee,be=Math.sqrt(ce*ce+ue*ue)+1;if(be<60){const H=12/(be*.06+1);for(const le of Z.segs)le.vx+=ce/be*H,le.vy+=(ue/be-.5)*H}}break;case"heal":for(const Z of Qe){const ce=Z.segs[0].x-D,ue=Z.segs[0].y-ee;ce*ce+ue*ue<1600&&(Z.energy=Math.min(200,Z.energy+8))}break;case"fire_rain":for(let Z=0;Z<15;Z++){const ce=D+(Math.random()-.5)*30|0,ue=Math.max(2,ee-10-Math.random()*30|0);X.set(ce,ue,K.FIRE)}break;case"freeze_wave":for(let Z=-14;Z<=14;Z++)for(let ce=-14;ce<=14;ce++){if(ce*ce+Z*Z>196)continue;const ue=D+ce|0,be=ee+Z|0,H=X.get(ue,be);H===K.WATER&&Math.random()<.35&&X.set(ue,be,K.ICE),H===K.FIRE&&Math.random()<.6&&X.set(ue,be,K.EMPTY),H===K.MAGMA&&Math.random()<.3&&X.set(ue,be,K.WALL)}break;case"speed_boost":for(const Z of Qe){const ce=Z.segs[0].x-D,ue=Z.segs[0].y-ee;if(ce*ce+ue*ue<1600)for(const be of Z.segs)be.vx+=Z.facingDir*2.5}break}},[]),Zn=S.useCallback(D=>{m.current=D,sn(+D.scale.toFixed(2))},[]),lo=S.useCallback((D,ee,Ie)=>{const Qe=Math.min(ee/mo,Ie/io);x.current=Qe;const{scale:X,panX:Z,panY:ce}=m.current,ue=(ee-Qe*mo)/2,be=(Ie-Qe*io)/2;D.setTransform(Qe*X,0,0,Qe*X,ue+Z,be+ce)},[]),ir=S.useCallback((D,ee,Ie)=>{const Qe=D.width,X=D.height,Z=x.current||Math.min(Qe/mo,X/io),{scale:ce,panX:ue,panY:be}=m.current,H=(Qe-Z*mo)/2,le=(X-Z*io)/2;return{x:(ee-H-ue)/(Z*ce),y:(Ie-le-be)/(Z*ce)}},[]),to=S.useCallback(D=>{var ee;vU(D,a.current),fe(D),c.current=[],u.current=[],h.current=[],a.current.spawnFood(20),r.current=0,(ee=l.current)==null||ee.stop(),l.current=null,an(null)},[]),Er=S.useCallback(D=>{const ee=a.current,Ie=D??L.current,Qe=15+Math.random()*(mo-30);let X=io*.5;for(let ce=5;ce<io-5;ce++)if(ee.isSolid(Qe|0,ce)){X=ce-4;break}X=Math.max(5,Math.min(io-15,X));const Z=Ou(Ie,Qe,X);c.current.push(Z)},[]),Eo=S.useCallback((D,ee,Ie)=>{const Qe=a.current,X=Ie??L.current;let Z=ee|0;for(let ce=ee|0;ce<io-5;ce++)if(Qe.isSolid(D|0,ce)){Z=ce-6;break}c.current.push(Ou(X,D,Z))},[]),oa=S.useCallback((D,ee,Ie)=>{const Qe={id:`obj-${Date.now()}-${Math.random().toString(36).slice(2,6)}`,type:D,x:ee,y:Ie,vx:0,vy:0,angle:0,omega:0,radius:D==="nuke"?18:D==="c4"?12:D==="blackhole"?15:8,strength:1,life:0,maxLife:D==="c4"?180:D==="lightning"?15:D==="laser"?60:-1,active:!0};u.current.push(Qe)},[]),ja=S.useCallback((D,ee,Ie)=>{const Qe={tree:"#228833",vine:"#33aa44",coral:"#ff6688",mushroom:"#aa66cc",fern:"#44cc55",cactus:"#55aa44",kelp:"#228866",bamboo:"#33cc33",moss:"#448833",sunflower:"#ddaa22",lily:"#ff88bb",mangrove:"#337744",orchid:"#cc44aa",pitcher:"#44aa66",bonsai:"#557733"};let X=Ie|0;for(let ce=Ie|0;ce<io-1;ce++)if(a.current.isSolid(ee|0,ce)){X=ce-1;break}const Z={id:`plant-${Date.now()}-${Math.random().toString(36).slice(2,6)}`,root:{x:ee,y:X,vx:0,vy:0,restDx:0,restDy:0,age:0,thickness:4,children:[],angle:-Math.PI/2,alive:!0},species:D,color:Qe[D]??"#228833",growthRate:.28+Math.random()*.2,age:0};h6(Z.root,D,a.current,0),h.current.push(Z)},[]);S.useCallback(()=>{c.current=[];const D=a.current,ee=vu.find(Z=>Z.id===O.current)??vu[0];let Ie=ee.spawnX,Qe=Hb(D,ee.spawnX,ee.spawnY);for(const Z of[ee.spawnX,mo*.25,mo*.5]){const ce=Hb(D,Z,ee.spawnY);if(ce>5&&ce<io-15){Ie=Z,Qe=ce;break}}D.spawnFood(20);const X=new jU(L.current,D,Ie,Qe,$.current);X.start(Le,4),l.current=X,an(X.getStats())},[Le]),S.useCallback(()=>{var D;(D=l.current)==null||D.stop(),an(null)},[]),S.useCallback(()=>{var ee;const D=(ee=l.current)==null?void 0:ee.spawnChampion();D&&c.current.push(D)},[]),S.useCallback(()=>{const D=l.current;if(!D||!D.bestParams)return;const ee=IU(L.current,D.bestParams,D.bestScore,D.generation);d.current=[ee,...d.current].slice(0,20),Be([...d.current])},[]);const Co=S.useCallback((D,ee)=>{const Ie=u.current,Qe=re.current,X=[];for(const Z of Ie){if(!Z.active){X.push(Z.id);continue}if(Z.life++,["ball","box","wheel","bomb","c4","nuke"].includes(Z.type)){const ce=Z.type==="box"?1.8:Z.type==="nuke"?2.5:Z.type==="bomb"||Z.type==="c4"?1.3:Z.type==="wheel"?1.1:.7,ue=Z.x|0,be=Z.y|0,H=D.get(ue,be),le=qb(H),Je=Tn.current;if(le&&Je>.01){const tt=o6[H],St=tt?tt.density:1,$t=tt?tt.viscosity:.3,rt=(St-ce)*.12*Je*Qe;Z.vy+=rt,Z.vy+=.15*Qe*.3;const Ft=1-$t*.15*Je;Z.vx*=Ft,Z.vy*=Ft;const Xt=Pt.current;if(Xt>.1){const dn=qb(D.get(ue-3,be))?1:0,kn=qb(D.get(ue+3,be))?1:0;Z.vx+=(kn-dn)*.02*Xt}}else Z.vy+=.15*Qe,Z.vx*=.995,Z.vy*=.995;Z.x+=Z.vx,Z.y+=Z.vy,Z.y>io-4&&(Z.y=io-4,Z.vy*=-.4,Z.vx*=.9),Z.x<2&&(Z.x=2,Z.vx*=-.5),Z.x>mo-2&&(Z.x=mo-2,Z.vx*=-.5),D.isSolid(Z.x|0,Z.y+2|0)&&(Z.vy*=-.3,Z.y-=1)}switch(Z.type){case"bomb":Z.life>120&&Math.abs(Z.vy)<.1&&(D.paint(Z.x|0,Z.y|0,8,K.FIRE,.7),D.paint(Z.x|0,Z.y|0,4,K.EMPTY,1),Z.active=!1);break;case"c4":Z.life>=Z.maxLife&&(D.paint(Z.x|0,Z.y|0,14,K.FIRE,.8),D.paint(Z.x|0,Z.y|0,8,K.EMPTY,1),Z.active=!1);break;case"nuke":if(Z.life>=90){for(let ce=0;ce<22;ce+=3)D.paint(Z.x|0,Z.y|0,ce,K.FIRE,.6);D.paint(Z.x|0,Z.y|0,12,K.EMPTY,1);for(const ce of ee){const ue=ce.segs[0].x-Z.x,be=ce.segs[0].y-Z.y;ue*ue+be*be<400&&(ce.energy-=100)}Z.active=!1}break;case"fan":for(const ce of ee){const ue=ce.segs[0].x-Z.x,be=ce.segs[0].y-Z.y,H=Math.sqrt(ue*ue+be*be);if(H<20){const le=.3*(1-H/20);for(const Je of ce.segs)Je.vx+=Math.cos(Z.angle)*le,Je.vy+=Math.sin(Z.angle)*le}}if(Z.life%3===0){const ce=Z.x|0,ue=Z.y|0;for(let be=-8;be<=8;be++)for(let H=-8;H<=8;H++){const le=ce+H,Je=ue+be;if(H*H+be*be>64)continue;const tt=D.get(le,Je);if(tt!==K.EMPTY&&tt!==K.WALL&&tt!==K.METAL){const St=le+Math.round(Math.cos(Z.angle)*2),$t=Je+Math.round(Math.sin(Z.angle)*2);D.get(St,$t)===K.EMPTY&&(D.set(St,$t,tt),D.set(le,Je,K.EMPTY))}}}break;case"attractor":for(const ce of ee){const ue=Z.x-ce.segs[0].x,be=Z.y-ce.segs[0].y,H=Math.sqrt(ue*ue+be*be)+1;if(H<25){const le=.08/(H*.15+1);for(const Je of ce.segs)Je.vx+=ue/H*le,Je.vy+=be/H*le}}break;case"repulsor":for(const ce of ee){const ue=ce.segs[0].x-Z.x,be=ce.segs[0].y-Z.y,H=Math.sqrt(ue*ue+be*be)+1;if(H<25){const le=.12/(H*.15+1);for(const Je of ce.segs)Je.vx+=ue/H*le,Je.vy+=be/H*le}}break;case"heater":if(Z.life%5===0){const ce=Z.x|0,ue=Z.y|0;for(let be=-6;be<=6;be++)for(let H=-6;H<=6;H++){if(H*H+be*be>36)continue;const le=D.get(ce+H,ue+be);le===K.ICE&&Math.random()<.1&&D.set(ce+H,ue+be,K.WATER),le===K.WATER&&Math.random()<.05&&D.set(ce+H,ue+be,K.STEAM),le===K.SNOW&&Math.random()<.15&&D.set(ce+H,ue+be,K.WATER)}}break;case"cooler":if(Z.life%5===0){const ce=Z.x|0,ue=Z.y|0;for(let be=-6;be<=6;be++)for(let H=-6;H<=6;H++){if(H*H+be*be>36)continue;const le=D.get(ce+H,ue+be);le===K.WATER&&Math.random()<.08&&D.set(ce+H,ue+be,K.ICE),le===K.MAGMA&&Math.random()<.1&&D.set(ce+H,ue+be,K.WALL),le===K.FIRE&&Math.random()<.2&&D.set(ce+H,ue+be,K.EMPTY),le===K.STEAM&&Math.random()<.15&&D.set(ce+H,ue+be,K.WATER)}}break;case"lightning":if(Z.life<15){const ce=Z.x|0,ue=Z.y|0;for(let be=ue;be<Math.min(io-2,ue+40);be++){const H=Math.round((Math.random()-.5)*3),le=D.get(ce+H,be);if(le===K.WALL||le===K.METAL)break;D.set(ce+H,be,K.FIRE)}}Z.life>=15&&(Z.active=!1);break;case"virus":if(Z.life%8===0){const ce=Z.x|0,ue=Z.y|0;for(let be=-3;be<=3;be++)for(let H=-3;H<=3;H++){const le=D.get(ce+H,ue+be);(le===K.WOOD||le===K.VINE||le===K.FOOD)&&Math.random()<.15&&D.set(ce+H,ue+be,K.EMPTY)}Z.x+=(Math.random()-.5)*2,Z.y+=(Math.random()-.5)*2}Z.life>600&&(Z.active=!1);break;case"blackhole":if(Z.life%2===0){const ce=Z.x|0,ue=Z.y|0;for(let be=-12;be<=12;be++)for(let H=-12;H<=12;H++){const le=Math.sqrt(H*H+be*be);if(le>12||le<1)continue;const Je=D.get(ce+H,ue+be);Je!==K.EMPTY&&Je!==K.WALL&&Math.random()<.08/le&&D.set(ce+H,ue+be,K.EMPTY)}}for(const ce of ee){const ue=Z.x-ce.segs[0].x,be=Z.y-ce.segs[0].y,H=Math.sqrt(ue*ue+be*be)+1;if(H<18){const le=.2/(H*.1+1);for(const Je of ce.segs)Je.vx+=ue/H*le,Je.vy+=be/H*le;H<3&&(ce.energy-=2)}}break;case"whitehole":if(Z.life%10===0){const ce=[K.WATER,K.SAND,K.FOOD,K.OIL,K.SNOW],ue=ce[Math.floor(Math.random()*ce.length)],be=Math.random()*Math.PI*2,H=3+Math.random()*4;D.set(Z.x+Math.cos(be)*H|0,Z.y+Math.sin(be)*H|0,ue)}break;case"spring":for(const ce of ee){const ue=ce.segs[0].x-Z.x,be=ce.segs[0].y-Z.y;if(Math.sqrt(ue*ue+be*be)<5)for(const le of ce.segs)le.vy-=2.5}break;case"vortex":{const ce=Z.x|0,ue=Z.y|0;for(const be of ee){const H=be.segs[0].x-Z.x,le=be.segs[0].y-Z.y,Je=Math.sqrt(H*H+le*le)+1;if(Je<22){const tt=.1/(Je*.12+1);for(const St of be.segs)St.vx+=-le/Je*tt,St.vy+=H/Je*tt,St.vx+=(Z.x-St.x)*.002,St.vy+=(Z.y-St.y)*.002}}if(Z.life%3===0)for(let be=-10;be<=10;be++)for(let H=-10;H<=10;H++){const le=H*H+be*be;if(le>100||le<4)continue;const Je=ce+H,tt=ue+be,St=D.get(Je,tt);if(St!==K.EMPTY&&St!==K.WALL&&St!==K.METAL){const $t=Math.sqrt(le),rt=-be/$t,Ft=H/$t,Xt=Je+Math.round(rt*1.5),dn=tt+Math.round(Ft*1.5);D.get(Xt,dn)===K.EMPTY&&(D.set(Xt,dn,St),D.set(Je,tt,K.EMPTY))}}break}case"motor":{Z.angle+=.08;for(const ce of ee){const ue=ce.segs[0].x-Z.x,be=ce.segs[0].y-Z.y,H=Math.sqrt(ue*ue+be*be);if(H<8&&H>1){const le=-be/H,Je=ue/H;for(const tt of ce.segs)tt.vx+=le*.15,tt.vy+=Je*.15}}break}case"laser":{if(Z.life<(Z.maxLife>0?Z.maxLife:60)){const ce=Z.x|0;for(let ue=0;ue<50;ue++){const be=(Z.y|0)+ue;if(be>=io-1)break;const H=D.get(ce,be);if(H===K.WALL&&Math.random()<.3)break;H!==K.EMPTY&&H!==K.METAL&&(Math.random()<.4?D.set(ce,be,K.FIRE):D.set(ce,be,K.EMPTY))}for(const ue of ee){const be=ue.segs[0];Math.abs(be.x-Z.x)<2&&be.y>Z.y&&be.y<Z.y+50&&(ue.energy-=.8)}}Z.life>=(Z.maxLife>0?Z.maxLife:60)&&(Z.active=!1);break}case"spore":{if(Z.life%15===0&&Z.life<300)for(let ce=0;ce<3;ce++){const ue=Math.random()*Math.PI*2,be=3+Math.random()*6,H=Z.x+Math.cos(ue)*be|0,le=Z.y+Math.sin(ue)*be|0;D.get(H,le)===K.EMPTY&&D.set(H,le,Math.random()<.3?K.VINE:K.SEED)}Z.x+=(Math.random()-.5)*.5,Z.y-=.1,Z.life>300&&(Z.active=!1);break}case"portal_in":{const ce=Ie.find(ue=>ue.type==="portal_out"&&ue.active);if(ce){if(Z.life%4===0){const ue=Z.x|0,be=Z.y|0;for(let H=-4;H<=4;H++)for(let le=-4;le<=4;le++){if(le*le+H*H>16)continue;const Je=ue+le,tt=be+H,St=D.get(Je,tt);if(St!==K.EMPTY&&St!==K.WALL&&St!==K.METAL&&Math.random()<.2){const $t=ce.x+le|0,rt=ce.y+H|0;D.get($t,rt)===K.EMPTY&&(D.set($t,rt,St),D.set(Je,tt,K.EMPTY))}}}for(const ue of ee){const be=ue.segs[0].x-Z.x,H=ue.segs[0].y-Z.y;if(be*be+H*H<16){const le=ce.x-Z.x,Je=ce.y-Z.y;for(const tt of ue.segs)tt.x+=le,tt.y+=Je}}}break}}}u.current=Ie.filter(Z=>Z.active)},[]),Ya=S.useCallback(D=>{for(const ee of h.current){ee.age++;const Ie=1/(1+ee.age*5e-4),Qe=ee.growthRate*Ie;Math.random()<Qe&&f6(ee.root,ee,D,0),p6(ee.root,ee,null,oe.current,re.current)}},[]);S.useEffect(()=>{if(!e){cancelAnimationFrame(n.current);return}i.current||(i.current=document.createElement("canvas"),i.current.width=mo,i.current.height=io);const D=i.current,ee=D.getContext("2d");s.current=ee.createImageData(mo,io),to("terrarium");const Ie=()=>{var Je,tt,St,$t;n.current=requestAnimationFrame(Ie);const Qe=t.current;if(!Qe)return;const X=Qe.getContext("2d");if(!X)return;(Qe.width<10||Qe.height<10)&&(Qe.width=Qe.offsetWidth||900,Qe.height=Qe.offsetHeight||600);const Z=Qe.width,ce=Qe.height,ue=r.current;if(X.clearRect(0,0,Z,ce),v.current){const{x:rt,y:Ft}=b.current,Xt=I.current;if(Xt==="paint")jr(rt,Ft,k.current,M.current);else if(Xt==="erase")jr(rt,Ft,k.current,K.EMPTY);else if(Xt==="power")_r(rt,Ft);else if((Xt==="grab"||Xt==="inspect")&&F.current){const kn=F.current.segs[0],ar=kn.x,jn=kn.y,yr=.28;kn.x+=(rt-kn.x)*yr,kn.y+=(Ft-kn.y)*yr,kn.vx=(kn.x-ar)*.6,kn.vy=(kn.y-jn)*.6}if(B.current){const dn=B.current;dn.vx+=(rt-dn.x)*.35,dn.vy+=(Ft-dn.y)*.35}}if(R.current){const rt=j.current;for(let Bt=0;Bt<rt;Bt++)a.current.update(ue+Bt);r.current+=rt;const Ft=oe.current;if(Math.abs(Ft)>.01&&ue%3===0)for(let Bt=0;Bt<io;Bt++)for(let qt=0;qt<mo;qt++){const mn=a.current.get(qt,Bt);if((mn===K.STEAM||mn===K.GAS||mn===K.FIRE)&&Math.random()<Math.abs(Ft)*.1){const dr=qt+(Ft>0?1:-1);a.current.get(dr,Bt)===K.EMPTY&&(a.current.set(dr,Bt,mn),a.current.set(qt,Bt,K.EMPTY))}}const Xt=te.current;if(ue%8===0&&Math.abs(Xt-.5)>.05){const Bt=a.current,qt=Math.max(0,(Xt-.5)*.04),mn=Math.max(0,(.5-Xt)*.04),dr=5;for(let rr=1;rr<io-1;rr+=dr)for(let Dr=1;Dr<mo-1;Dr+=dr){const ho=Dr+(Math.random()*dr|0),Vr=rr+(Math.random()*dr|0);if(ho>=mo-1||Vr>=io-1)continue;const ko=Bt.get(ho,Vr);qt>0&&(ko===K.ICE&&Math.random()<qt&&Bt.set(ho,Vr,K.WATER),ko===K.SNOW&&Math.random()<qt*1.5&&Bt.set(ho,Vr,K.WATER),ko===K.WATER&&Math.random()<qt*.3&&Bt.set(ho,Vr,K.STEAM)),mn>0&&(ko===K.WATER&&Math.random()<mn&&Bt.set(ho,Vr,K.ICE),ko===K.STEAM&&Math.random()<mn*1.5&&Bt.set(ho,Vr,K.WATER),ko===K.MAGMA&&Math.random()<mn*.5&&Bt.set(ho,Vr,K.WALL))}}if(ue%3===0&&a.current.diffuseHeat($e.current),Math.abs(Xt-.5)>.05){const Bt=Math.abs(Xt-.5)*.12;for(const qt of c.current)if(qt.alive)for(const mn of qt.segs)mn.vx+=(Math.random()-.5)*Bt,mn.vy+=(Math.random()-.5)*Bt*.6}const dn=c.current,kn=.1*re.current,ar=J.current;for(const Bt of dn){if(!Bt.alive)continue;const qt=l6(Bt.policyParams,Bt);if(d6(Bt,qt,a.current,kn),Math.abs(Ft)>.01)for(const mn of Bt.segs)mn.vx+=Ft*.025;if(ar<.998)for(const mn of Bt.segs)mn.vx*=ar,mn.vy*=ar}FU(dn),kU(dn),ue%3===0&&PU(dn);for(const Bt of dn)Bt.alive&&Bt.age>Bt.maxAge&&(Bt.energy=-1,Bt.alive=!1);if(ue%30===0&&dn.length<ln.current){const Bt=[];for(const qt of dn){if(!qt.alive)continue;const mn=RU(qt);mn&&dn.length+Bt.length<ln.current&&Bt.push(mn)}for(const qt of Bt)c.current.push(qt),wr.current.push({x:qt.segs[0].x,y:qt.segs[0].y,hue:qt.bp.hue,age:0})}for(const Bt of dn)if(!Bt.alive&&Bt.energy<=0){const qt=Bt.segs[0],mn=a.current,dr=Math.min(8,Math.floor(Bt.segs.length*1.2));for(let rr=0;rr<dr;rr++){const Dr=(Math.random()-.5)*12,ho=(Math.random()-.5)*8,Vr=qt.x+Dr|0,ko=qt.y+ho|0;mn.get(Vr,ko)===K.EMPTY&&mn.set(Vr,ko,Math.random()<.7?K.FOOD:K.SEED)}for(const rr of Bt.segs)Or.current.push({x:rr.x,y:rr.y,hue:Bt.bp.hue,age:0,r:rr.r*2.5});et.current.push({creature:Bt,deathAge:0})}c.current=dn.filter(Bt=>Bt.alive);const jn=.1*re.current;et.current=et.current.filter(Bt=>(Bt.deathAge++,Bt.deathAge>300?!1:(_U(Bt.creature,a.current,jn),!0))),Or.current=Or.current.map(Bt=>({...Bt,age:Bt.age+1})).filter(Bt=>Bt.age<30),wr.current=wr.current.map(Bt=>({...Bt,age:Bt.age+1})).filter(Bt=>Bt.age<20);const yr=It.current;if(yr&&!yr.alive&&(It.current=null,Nn(null),zn.current=!1,Ln(!1)),(Je=l.current)!=null&&Je.running&&(l.current.step(),ue%10===0&&an(l.current.getStats())),Co(a.current,c.current),Ya(a.current),ue%60===0){const Bt=a.current;for(const qt of h.current){if(qt.age<30)continue;const mn=[],dr=rr=>{rr.children.length===0&&rr.alive&&mn.push({x:rr.x,y:rr.y});for(const Dr of rr.children)dr(Dr)};dr(qt.root);for(const rr of mn)if(Math.random()<.15){const Dr=rr.x+(Math.random()-.5)*3|0,ho=rr.y+(Math.random()-.5)*3|0;Bt.get(Dr,ho)===K.EMPTY&&Bt.set(Dr,ho,K.FOOD)}}}ue%90===0&&a.current.countType(K.FOOD)<25&&a.current.spawnFood(16),ue%45===0&&Qt({food:a.current.countType(K.FOOD),water:a.current.countType(K.WATER),creatures:c.current.length,plants:h.current.length,objects:u.current.length}),ue%12===0&&It.current&&It.current.alive&&Nn({...It.current})}if(zn.current&&It.current&&It.current.alive){const rt=It.current.segs[0],Ft=x.current||Math.min(Z/mo,ce/io),{scale:Xt}=m.current,dn=Z/2-(rt.x*Ft*Xt+(Z-Ft*mo)/2),kn=ce/2-(rt.y*Ft*Xt+(ce-Ft*io)/2),ar=.06,jn=m.current.panX+(dn-m.current.panX)*ar,yr=m.current.panY+(kn-m.current.panY)*ar;m.current={...m.current,panX:jn,panY:yr}}a.current.render(s.current.data,r.current),ee.putImageData(s.current,0,0),X.save(),lo(X,Z,ce),X.imageSmoothingEnabled=!1,X.drawImage(D,0,0);for(const rt of h.current)m6(X,rt.root,rt,1);for(const rt of u.current)WU(X,rt,r.current);for(const rt of et.current)NU(X,rt.creature,1,rt.deathAge);const be=It.current;for(const rt of c.current)Lv(X,rt,1,rt===be);for(const rt of c.current){const Ft=rt.segs[0],Xt=Ft.r*3.2,dn=.6,kn=Ft.x-Xt/2,ar=Ft.y-Ft.r*2.2,jn=Math.max(0,Math.min(1,rt.energy/200));X.fillStyle="rgba(0,0,0,0.35)",X.fillRect(kn-.2,ar-.1,Xt+.4,dn+.2);const yr=jn>.6?`hsla(${rt.bp.hue},60%,50%,0.55)`:jn>.3?"rgba(220,180,40,0.55)":"rgba(220,50,40,0.6)";X.fillStyle=yr,X.fillRect(kn,ar,Xt*jn,dn)}for(const rt of Or.current){const Ft=rt.age/30,Xt=Math.max(0,1-Ft),dn=rt.r*(1+Ft*2.5);if(X.beginPath(),X.arc(rt.x,rt.y,dn,0,Math.PI*2),X.strokeStyle=`hsla(${rt.hue},80%,65%,${.5*Xt})`,X.lineWidth=.4*Xt,X.stroke(),rt.age<10){const kn=Math.max(0,1-rt.age/10)*.4;X.beginPath(),X.arc(rt.x,rt.y,rt.r*.8,0,Math.PI*2),X.fillStyle=`hsla(${rt.hue},60%,85%,${kn})`,X.fill()}}for(const rt of wr.current){const Ft=rt.age/20,Xt=Math.max(0,1-Ft),dn=2+Ft*6;X.beginPath(),X.arc(rt.x,rt.y,dn,0,Math.PI*2),X.strokeStyle=`hsla(${rt.hue},70%,70%,${.4*Xt})`,X.lineWidth=.3*Xt,X.stroke();for(let kn=0;kn<4;kn++){const ar=Ft*6+kn*1.57,jn=dn*.8;X.beginPath(),X.arc(rt.x+Math.cos(ar)*jn,rt.y+Math.sin(ar)*jn,.4*Xt,0,Math.PI*2),X.fillStyle=`hsla(120,80%,75%,${.5*Xt})`,X.fill()}}const H=(tt=l.current)==null?void 0:tt.currentCandidate;if(H&&((St=l.current)!=null&&St.running)){Lv(X,H,1,!0,.85);const rt=H.segs[0];X.font=`${2.5/m.current.scale}px monospace`,X.fillStyle="rgba(200,140,255,0.5)",X.fillText("EVOLVING",rt.x-6,rt.y-5)}if(b.current.x>0||b.current.y>0){const{x:rt,y:Ft}=b.current,Xt=k.current,dn=I.current,kn=.5/m.current.scale;if(dn==="paint"||dn==="erase"){const ar=dn==="erase"?"#ff4444":(($t=cC[M.current])==null?void 0:$t.color)??"#fff",jn=Ae.current;if(X.strokeStyle=ar+"aa",X.lineWidth=kn,X.beginPath(),jn==="circle"||jn==="spray"?X.arc(rt,Ft,Xt,0,Math.PI*2):jn==="square"?X.rect(rt-Xt,Ft-Xt,Xt*2,Xt*2):jn==="hline"?X.rect(rt-Xt*2,Ft-1,Xt*4,3):jn==="vline"&&X.rect(rt-1,Ft-Xt*2,3,Xt*4),X.stroke(),jn==="spray")for(let yr=0;yr<8;yr++){const Bt=yr/8*Math.PI*2,qt=Xt*.7;X.beginPath(),X.arc(rt+Math.cos(Bt)*qt,Ft+Math.sin(Bt)*qt,.3,0,Math.PI*2),X.fillStyle=ar+"55",X.fill()}}else if(dn==="drop")X.beginPath(),X.arc(rt,Ft,3,0,Math.PI*2),X.strokeStyle="#ffaa44aa",X.lineWidth=kn,X.setLineDash([1,1]),X.stroke(),X.setLineDash([]);else if(dn==="plant")X.beginPath(),X.arc(rt,Ft,3,0,Math.PI*2),X.strokeStyle="#44ff88aa",X.lineWidth=kn,X.setLineDash([1,1]),X.stroke(),X.setLineDash([]);else if(dn==="plant_tool"){const ar=Gb.find(yr=>yr.id===yt.current),jn=(ar==null?void 0:ar.color)??"#44ff88";X.beginPath(),X.arc(rt,Ft,8,0,Math.PI*2),X.strokeStyle=jn+"55",X.lineWidth=kn*1.5,X.setLineDash([1.5,1]),X.stroke(),X.setLineDash([]),X.beginPath(),X.arc(rt,Ft,1.5,0,Math.PI*2),X.fillStyle=jn+"aa",X.fill()}else if(dn==="power"){const ar=uC.find(Bt=>Bt.id===en.current),jn=(ar==null?void 0:ar.color)??"#ffaa44",yr=10+Math.sin(r.current*.08)*3;X.beginPath(),X.arc(rt,Ft,yr,0,Math.PI*2),X.strokeStyle=jn+"55",X.lineWidth=kn*2,X.setLineDash([2,2]),X.stroke(),X.setLineDash([]),X.beginPath(),X.arc(rt,Ft,2,0,Math.PI*2),X.fillStyle=jn+"aa",X.fill()}else if(dn==="creature"){const ar=4+Math.sin(r.current*.1)*1.5;X.beginPath(),X.arc(rt,Ft,ar,0,Math.PI*2),X.strokeStyle="#cc88ffaa",X.lineWidth=kn,X.setLineDash([1.5,1]),X.stroke(),X.setLineDash([])}else dn==="inspect"&&(X.strokeStyle="#88ffeebb",X.lineWidth=kn,X.beginPath(),X.moveTo(rt-3,Ft),X.lineTo(rt+3,Ft),X.moveTo(rt,Ft-3),X.lineTo(rt,Ft+3),X.stroke(),X.beginPath(),X.arc(rt,Ft,5,0,Math.PI*2),X.setLineDash([1,1]),X.stroke(),X.setLineDash([]))}const le=It.current;if(le&&le.alive){const rt=le.segs[0],Ft=2.5/m.current.scale;X.font=`bold ${Ft}px monospace`;const Xt=rt.x+le.segs[0].r*2+1;let dn=rt.y-5;const kn=[`${le.bp.name} (${le.bp.species})`,`HP ${le.energy.toFixed(0)} / 200`,`Age ${le.age}/${le.maxAge}  Gen ${le.generation}`,`Dir ${le.facingDir>0?"":""}  Segs ${le.segs.length}  Grip ${le.segs.filter(ar=>ar.gripped).length}`,`vX ${le.segs[0].vx.toFixed(2)}  vY ${le.segs[0].vy.toFixed(2)}`];X.fillStyle="rgba(0,0,0,0.55)",X.fillRect(Xt-.5,dn-Ft*.8,Ft*18,kn.length*Ft*1.4+Ft*.5),X.fillStyle="rgba(180,255,220,0.7)";for(const ar of kn)X.fillText(ar,Xt,dn),dn+=Ft*1.4;X.beginPath(),X.arc(rt.x,rt.y,rt.r*2+Math.sin(r.current*.15)*.5,0,Math.PI*2),X.strokeStyle=`hsla(${le.bp.hue},80%,65%,0.5)`,X.lineWidth=.5/m.current.scale,X.setLineDash([1.5,1]),X.stroke(),X.setLineDash([])}X.restore()};return n.current=requestAnimationFrame(Ie),()=>cancelAnimationFrame(n.current)},[e]),S.useEffect(()=>{const D=t.current;if(!D)return;const ee=()=>{const Ie=D.offsetWidth,Qe=D.offsetHeight;Ie>0&&Qe>0&&(D.width=Ie,D.height=Qe)};return ee(),window.addEventListener("resize",ee),()=>window.removeEventListener("resize",ee)},[e]);const qo=S.useCallback(D=>{D.currentTarget.setPointerCapture(D.pointerId);const ee=D.currentTarget,Ie=ee.getBoundingClientRect(),Qe=D.clientX-Ie.left,X=D.clientY-Ie.top;if(w.current={x:Qe,y:X},b.current=ir(ee,Qe,X),D.button===1||D.altKey)f.current=!0,g.current={mx:Qe,my:X,px:m.current.panX,py:m.current.panY};else{const Z=I.current;if(Z==="drop"){const{x:ce,y:ue}=b.current;oa(E.current,ce,ue)}else if(Z==="plant"){const{x:ce,y:ue}=b.current;ja(me.current,ce,ue)}else if(Z==="grab"){const{x:ce,y:ue}=b.current;let be=null,H=30;for(const Je of c.current)for(const tt of Je.segs){const St=tt.x-ce,$t=tt.y-ue,rt=Math.sqrt(St*St+$t*$t);rt<H&&(H=rt,be=Je)}let le={node:null,dist:900};for(const Je of h.current)B5(Je.root,ce,ue,le);le.node&&Math.sqrt(le.dist)<H?(B.current=le.node,F.current=null):(F.current=be,B.current=null),v.current=!0}else if(Z==="creature"){const{x:ce,y:ue}=b.current;Eo(ce,ue)}else if(Z==="inspect"){const{x:ce,y:ue}=b.current;let be=null,H=30;for(const le of c.current)for(const Je of le.segs){const tt=Je.x-ce,St=Je.y-ue,$t=Math.sqrt(tt*tt+St*St);$t<H&&(H=$t,be=le)}if(It.current=be,Nn(be),be&&Oe("creatures"),be)F.current=be,v.current=!0;else{const le={node:null,dist:225};for(const Je of h.current)B5(Je.root,ce,ue,le);le.node&&(B.current=le.node,v.current=!0)}}else if(Z==="plant_tool"){const{x:ce,y:ue}=b.current,be=yt.current;for(const H of h.current){const le=H.root.x-ce,Je=H.root.y-ue;if(le*le+Je*Je<400){if(be==="trim"){const tt=(St,$t)=>{$t>5&&(St.alive=!1);for(const rt of St.children)tt(rt,$t+1)};tt(H.root,0)}else if(be==="water"){H.growthRate=Math.min(.8,H.growthRate+.15);for(let tt=0;tt<3;tt++){const St=H.root.x+(Math.random()-.5)*6|0,$t=H.root.y+1+Math.random()*3|0;a.current.get(St,$t)===K.EMPTY&&a.current.set(St,$t,K.WATER)}}else if(be==="fertilize")H.growthRate=Math.min(1,H.growthRate+.3);else if(be==="harvest"){const tt=St=>{if(St.children.length===0&&St.alive&&Math.random()<.4){const $t=St.x+(Math.random()-.5)*4|0,rt=St.y+1|0;a.current.get($t,rt)===K.EMPTY&&a.current.set($t,rt,K.FOOD),St.alive=!1}for(const $t of St.children)tt($t)};tt(H.root)}}}v.current=!0}else if(Z==="power"){v.current=!0;const{x:ce,y:ue}=b.current;_r(ce,ue)}else v.current=!0}},[ir,oa,ja,Eo,_r]),os=S.useCallback(D=>{const ee=D.currentTarget,Ie=ee.getBoundingClientRect(),Qe=D.clientX-Ie.left,X=D.clientY-Ie.top;if(w.current={x:Qe,y:X},b.current=ir(ee,Qe,X),f.current){const{mx:Z,my:ce,px:ue,py:be}=g.current;Zn({...m.current,panX:ue+(Qe-Z),panY:be+(X-ce)})}if(!v.current){const{x:Z,y:ce}=b.current;let ue=!1;for(const H of c.current){for(const le of H.segs){const Je=le.x-Z,tt=le.y-ce;if(Je*Je+tt*tt<625){ue=!0;break}}if(ue)break}if(!ue){const H={node:null,dist:225};for(const le of h.current)if(B5(le.root,Z,ce,H),H.node){ue=!0;break}}W.current=ue;const be=I.current;ue&&(be==="inspect"||be==="grab"||be==="paint"||be==="erase")||be==="grab"?ee.style.cursor="grab":be==="paint"||be==="erase"?ee.style.cursor="crosshair":be==="creature"?ee.style.cursor="cell":be==="drop"||be==="plant"?ee.style.cursor="copy":be==="power"||be==="plant_tool"?ee.style.cursor="pointer":be==="inspect"?ee.style.cursor=ue?"grab":"help":ee.style.cursor=ue?"grab":"default"}},[ir,Zn]),Ho=S.useCallback(()=>{v.current=!1,f.current=!1,F.current=null,B.current=null},[]),fs=S.useCallback(D=>{D.preventDefault();const Ie=D.currentTarget.getBoundingClientRect(),Qe=D.clientX-Ie.left,X=D.clientY-Ie.top,Z=D.deltaY<0?1.12:1/1.12,ce=Math.max(.4,Math.min(5,m.current.scale*Z));Zn({scale:ce,panX:Qe-(Qe-m.current.panX)*(ce/m.current.scale),panY:X-(X-m.current.panY)*(ce/m.current.scale)})},[Zn]),To=S.useCallback(D=>{const ee=t.current;if(!ee)return;const Ie=ee.width,Qe=ee.height,X=Math.max(.4,Math.min(5,m.current.scale*D));Zn({scale:X,panX:Ie/2-(Ie/2-m.current.panX)*(X/m.current.scale),panY:Qe/2-(Qe/2-m.current.panY)*(X/m.current.scale)})},[Zn]),Xo=S.useCallback(()=>{Zn({scale:1,panX:0,panY:0})},[Zn]);S.useEffect(()=>{if(!e)return;const D=ee=>{ee.key===" "&&(ee.preventDefault(),P(Ie=>!Ie)),ee.key==="r"&&to(O.current),ee.key==="c"&&Er(),ee.key==="f"&&a.current.spawnFood(12),(ee.key==="="||ee.key==="+")&&To(1.2),ee.key==="-"&&To(1/1.2),ee.key==="0"&&Xo(),ee.key==="1"&&nt("paint"),ee.key==="2"&&nt("erase"),ee.key==="3"&&nt("grab"),ee.key==="4"&&nt("drop"),ee.key==="5"&&nt("plant"),ee.key==="6"&&nt("creature"),ee.key==="7"&&nt("power"),(ee.key==="8"||ee.key==="i")&&nt("inspect")};return window.addEventListener("keydown",D),()=>window.removeEventListener("keydown",D)},[e,to,Er,To,Xo]);const ks=[{id:"elements",icon:o.jsx(eM,{size:8}),label:"Mat"},{id:"objects",icon:o.jsx(uI,{size:8}),label:"Obj"},{id:"creatures",icon:o.jsx(hg,{size:8}),label:"Life"},{id:"plants",icon:o.jsx(fg,{size:8}),label:"Flora"},{id:"environment",icon:o.jsx($u,{size:8}),label:"Env"},{id:"ecosystem",icon:o.jsx(oS,{size:8}),label:"Eco"}];return o.jsxs("div",{style:{display:e?"flex":"none"},className:"fixed inset-0 z-0 flex flex-col overflow-hidden bg-[#020408] pt-[30px]",children:[o.jsxs("div",{className:`z-20 flex-shrink-0 flex items-center gap-1 px-2 py-1
        bg-black/70 backdrop-blur-md border-b border-white/[0.04]`,children:[o.jsx("div",{className:"flex gap-0.5",children:vu.map(D=>o.jsxs("button",{onClick:()=>to(D.id),title:D.desc,className:`flex items-center gap-1 px-1.5 py-0.5 rounded text-[6.5px] font-mono border transition-all
                ${V===D.id?"border-white/15 text-white/55 bg-white/6":"border-transparent text-white/20 hover:text-white/45 hover:bg-white/[0.03]"}`,children:[o.jsx("span",{className:"text-[8px]",children:D.icon}),o.jsx("span",{className:"hidden md:inline",children:D.label})]},D.id))}),o.jsx("div",{className:"w-px h-3.5 bg-white/8 mx-0.5"}),o.jsx("div",{className:"flex gap-0.5",children:[{id:"paint",icon:o.jsx(HP,{size:8}),label:"Paint"},{id:"erase",icon:o.jsx(M5,{size:8}),label:"Erase"},{id:"grab",icon:o.jsx(iP,{size:8}),label:"Grab"},{id:"drop",icon:o.jsx(Qp,{size:8}),label:"Drop Obj"},{id:"plant",icon:o.jsx(fg,{size:8}),label:"Plant"},{id:"creature",icon:o.jsx(hg,{size:8}),label:"Place Creature"},{id:"power",icon:o.jsx(zi,{size:8}),label:"Power Tool"},{id:"plant_tool",icon:o.jsx(fg,{size:8}),label:"Plant Tools"},{id:"inspect",icon:o.jsx(jl,{size:8}),label:"Inspect"}].map(D=>o.jsx(zU,{active:ne===D.id,color:"#cc88ff",onClick:()=>nt(D.id),title:D.label,children:D.icon},D.id))}),o.jsx("div",{className:"w-px h-3.5 bg-white/8 mx-0.5"}),o.jsx("button",{onClick:()=>P(D=>!D),className:`flex items-center gap-0.5 px-2 py-0.5 rounded text-[6.5px] font-mono uppercase tracking-widest transition-all border
            ${pe?"border-cyan-400/30 text-cyan-300/80 bg-cyan-500/8":"border-white/10 text-white/40 hover:text-white/65"}`,children:pe?o.jsxs(o.Fragment,{children:[o.jsx(md,{size:7}),"Pause"]}):o.jsxs(o.Fragment,{children:[o.jsx(sc,{size:7}),"Play"]})}),o.jsx("button",{onClick:()=>to(V),title:"Reset",className:"p-1 rounded border border-white/[0.05] text-white/25 hover:text-white/50 transition-all",children:o.jsx(El,{size:8})}),o.jsx("div",{className:"flex gap-0.5",children:[1,2,4].map(D=>o.jsxs("button",{onClick:()=>Se(D),className:`w-5 h-4 rounded text-[6px] font-mono border transition-all
                ${ye===D?"border-cyan-400/25 text-cyan-300 bg-cyan-500/6":"border-white/[0.04] text-white/20 hover:text-white/45"}`,children:[D,""]},D))}),o.jsx("div",{className:"w-px h-3.5 bg-white/8 mx-0.5"}),o.jsx("button",{onClick:()=>To(1.25),className:"p-0.5 text-white/25 hover:text-white/50",children:o.jsx(tR,{size:9})}),o.jsxs("span",{className:"text-[6px] font-mono text-white/20 w-7 text-center",children:[(Rn*100).toFixed(0),"%"]}),o.jsx("button",{onClick:()=>To(1/1.25),className:"p-0.5 text-white/25 hover:text-white/50",children:o.jsx(nR,{size:9})}),o.jsx("button",{onClick:Xo,className:"p-0.5 text-white/25 hover:text-white/50",title:"Reset view",children:o.jsx(LP,{size:8})}),o.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[o.jsxs("div",{className:"flex items-center gap-1.5 text-[6px] font-mono",children:[o.jsxs("span",{className:"text-emerald-400/40",children:[o.jsx(o2,{size:7,className:"inline"})," ",ft.food]}),o.jsxs("span",{className:"text-blue-400/40",children:[o.jsx(eM,{size:7,className:"inline"})," ",ft.water]}),o.jsxs("span",{className:"text-purple-400/40",children:[o.jsx(hg,{size:7,className:"inline"})," ",ft.creatures]}),o.jsxs("span",{className:"text-green-400/40",children:[o.jsx(fg,{size:7,className:"inline"})," ",ft.plants]}),ft.objects>0&&o.jsxs("span",{className:"text-orange-400/40",children:[o.jsx(Qp,{size:7,className:"inline"})," ",ft.objects]})]}),o.jsxs("button",{onClick:()=>_n(D=>!D),className:`flex items-center gap-0.5 px-2 py-0.5 rounded text-[6px] font-mono border border-white/[0.05]
              text-white/25 hover:text-white/50 transition-all`,children:[o.jsx(V5,{size:7})," ",gn.length]})]})]}),o.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[o.jsxs("div",{className:"relative z-20 flex-shrink-0 transition-all duration-200",style:{width:ae?174:12},children:[o.jsx("button",{onClick:()=>Re(D=>!D),className:`absolute -right-4 top-12 z-30 w-4 h-8 flex items-center justify-center
              bg-black/60 border border-white/[0.06] rounded-r text-white/25 hover:text-white/50 transition-all`,children:ae?o.jsx(ym,{size:8}):o.jsx(hs,{size:8})}),ae&&o.jsxs("div",{className:"flex flex-col h-full bg-black/65 backdrop-blur-md border-r border-white/[0.05]",children:[o.jsx("div",{className:"flex border-b border-white/[0.04] px-0.5 py-0.5 gap-0.5",children:ks.map(D=>o.jsxs("button",{onClick:()=>Oe(D.id),className:`flex-1 flex flex-col items-center gap-0.5 py-1 rounded text-[5px] font-mono transition-all
                      ${Fe===D.id?"text-white/60 bg-white/6":"text-white/18 hover:text-white/35 hover:bg-white/[0.02]"}`,children:[D.icon,o.jsx("span",{className:"uppercase tracking-widest",children:D.label})]},D.id))}),o.jsxs("div",{className:"flex-1 overflow-y-auto py-1",style:{scrollbarWidth:"none"},children:[Fe==="elements"&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"px-2 mb-1 flex flex-col gap-1",children:[o.jsx(Jc,{label:"Brush Size",val:De,min:1,max:40,step:1,fmt:D=>`${D}px`,color:"#88aaff",onChange:_e}),o.jsx("div",{className:"flex gap-0.5",children:[{id:"circle",icon:o.jsx(PI,{size:7}),label:""},{id:"square",icon:o.jsx(fF,{size:7}),label:""},{id:"spray",icon:o.jsx(Z3,{size:7}),label:""},{id:"hline",icon:o.jsx("span",{className:"text-[6px]",children:""}),label:""},{id:"vline",icon:o.jsx("span",{className:"text-[6px]",children:""}),label:""}].map(D=>o.jsx("button",{onClick:()=>Te(D.id),title:D.id,className:`flex-1 flex items-center justify-center py-0.5 rounded text-[6px] font-mono border transition-all
                              ${je===D.id?"border-blue-400/25 text-blue-300 bg-blue-500/8":"border-white/[0.04] text-white/20 hover:text-white/45"}`,children:D.icon},D.id))})]}),hU.map(D=>o.jsxs("div",{children:[o.jsx(hC,{label:D.label,color:D.color,open:vn[D.id]??!0,onToggle:()=>hn(D.id),count:D.cells.length}),(vn[D.id]??!0)&&o.jsx("div",{className:"grid grid-cols-2 gap-0.5 px-1.5 pb-1",children:D.cells.map(ee=>{const Ie=cC[ee];return o.jsxs("button",{onClick:()=>{ke(ee),nt("paint")},title:Ie.desc,className:`flex items-center gap-1 px-1 py-0.5 rounded text-[6.5px] font-mono
                                    border transition-all ${we===ee&&ne==="paint"?"bg-white/8 border-white/15":"border-transparent text-white/28 hover:bg-white/[0.04] hover:text-white/50"}`,style:{color:we===ee&&ne==="paint"?Ie.color:void 0},children:[o.jsx("span",{className:"w-1.5 h-1.5 rounded-sm flex-shrink-0",style:{background:Ie.color}}),Ie.label]},ee)})})]},D.id)),o.jsxs("div",{className:"px-2 pt-1 flex flex-col gap-0.5",children:[o.jsxs("button",{onClick:()=>a.current.spawnFood(14),className:`w-full py-1 rounded text-[6.5px] font-mono border border-emerald-400/15
                          text-emerald-300/45 hover:bg-emerald-500/6 transition-all flex items-center justify-center gap-1`,children:[o.jsx(o2,{size:7})," Scatter Food"]}),o.jsxs("button",{onClick:()=>a.current.clear(),className:`w-full py-1 rounded text-[6.5px] font-mono border border-red-400/15
                          text-red-300/35 hover:bg-red-500/6 transition-all flex items-center justify-center gap-1`,children:[o.jsx(M5,{size:7})," Clear All"]})]})]}),Fe==="objects"&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"px-2 mb-1 text-[5.5px] font-mono text-white/20",children:"Select an object then click canvas to place it."}),LU.map(D=>{const ee=u6.filter(Ie=>Ie.cat===D.id);return o.jsxs("div",{children:[o.jsx(hC,{label:D.label,color:D.color,open:vn[D.id]??(D.id==="explosive"||D.id==="force"),onToggle:()=>hn(D.id),count:ee.length}),(vn[D.id]??(D.id==="explosive"||D.id==="force"))&&o.jsx("div",{className:"grid grid-cols-2 gap-0.5 px-1.5 pb-1",children:ee.map(Ie=>o.jsxs("button",{onClick:()=>{Et(Ie.id),nt("drop")},title:Ie.desc,className:`flex items-center gap-1 px-1 py-0.5 rounded text-[6.5px] font-mono
                                    border transition-all ${pt===Ie.id&&ne==="drop"?"bg-white/8 border-white/15":"border-transparent text-white/28 hover:bg-white/[0.04] hover:text-white/50"}`,style:{color:pt===Ie.id&&ne==="drop"?Ie.color:void 0},children:[o.jsx("span",{className:"text-[8px]",children:Ie.icon}),Ie.label]},Ie.id))})]},D.id)})]}),Fe==="creatures"&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"px-2 mb-1.5",children:[o.jsxs("div",{className:"text-[5.5px] font-mono text-white/20 mb-1",children:["Pick a body plan  ",o.jsx("span",{className:"text-purple-300/50",children:"Place"}),"  click canvas. Creatures seek food automatically."]}),o.jsx("div",{className:"flex flex-col gap-0.5",children:Qd.map(D=>o.jsxs("button",{onClick:()=>{Ct(D),L.current=D},className:`flex items-center gap-1.5 px-1.5 py-1 rounded text-[6.5px] font-mono border transition-all
                              ${_t.id===D.id?"border-purple-400/20 bg-purple-500/8 text-purple-200":"border-transparent text-white/25 hover:bg-white/[0.03] hover:text-white/45"}`,children:[o.jsx("span",{className:"text-[10px] w-4 text-center",children:D.icon}),o.jsxs("div",{className:"flex-1 text-left",children:[o.jsx("div",{children:D.name}),o.jsxs("div",{className:"text-[5px] opacity-40",children:[D.segN,"seg  ",D.species,"  ",D.appendageCount,"limbs"]})]})]},D.id))})]}),o.jsxs("div",{className:"px-2 flex flex-col gap-1",children:[o.jsxs("button",{onClick:()=>nt("creature"),className:`w-full py-1.5 rounded text-[7px] font-mono border transition-all flex items-center justify-center gap-1
                          ${ne==="creature"?"border-purple-400/40 bg-purple-500/14 text-purple-200 animate-pulse":"border-purple-400/20 text-purple-300/55 hover:bg-purple-500/6"}`,children:[o.jsx(hg,{size:8}),ne==="creature"?" Click on canvas":"Place on Canvas"]}),o.jsxs("button",{onClick:()=>Er(),className:`w-full py-1 rounded text-[6.5px] font-mono border border-white/[0.06]
                          text-white/28 hover:bg-white/[0.04] transition-all flex items-center justify-center gap-1`,children:[o.jsx(ic,{size:7})," Random Spawn"]}),o.jsxs("button",{onClick:()=>{for(let D=0;D<5;D++){const ee=Qd[Math.floor(Math.random()*Qd.length)];Er(ee)}},className:`w-full py-1 rounded text-[6.5px] font-mono border border-white/[0.06]
                          text-white/28 hover:bg-white/[0.04] transition-all flex items-center justify-center gap-1`,children:[o.jsx(cf,{size:7})," Spawn Colony (5)"]}),o.jsxs("button",{onClick:()=>a.current.spawnFood(16),className:`w-full py-1 rounded text-[6.5px] font-mono border border-emerald-400/12
                          text-emerald-300/40 hover:bg-emerald-500/6 transition-all flex items-center justify-center gap-1`,children:[o.jsx(o2,{size:7})," Scatter Food"]}),o.jsxs("button",{onClick:()=>{c.current=[]},className:`w-full py-0.5 rounded text-[6px] font-mono border border-red-400/10
                          text-red-300/25 hover:bg-red-500/5 transition-all flex items-center justify-center gap-1`,children:[o.jsx(M5,{size:6})," Clear All Creatures"]})]}),o.jsx("div",{className:"px-2 pt-1",children:o.jsx(Jc,{label:"Max Population",val:zt,min:5,max:60,step:1,fmt:D=>`${D}`,color:"#cc88ff",onChange:Nt})}),ft.creatures>0&&o.jsxs("div",{className:"px-2 pt-1.5 border-t border-white/[0.04] mt-1",children:[o.jsxs("div",{className:"text-[5.5px] font-mono uppercase tracking-widest text-white/18 mb-1",children:["Census (",ft.creatures," alive)"]}),o.jsx("div",{className:"flex flex-col gap-0.5 text-[6px] font-mono",children:(()=>{const D={};for(const ee of c.current){if(!ee.alive)continue;const Ie=ee.bp.id;D[Ie]||(D[Ie]={count:0,icon:ee.bp.icon,hue:ee.bp.hue,maxGen:0}),D[Ie].count++,D[Ie].maxGen=Math.max(D[Ie].maxGen,ee.generation)}return Object.entries(D).map(([ee,Ie])=>{var Qe;return o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("span",{className:"text-white/30",children:[o.jsx("span",{className:"text-[8px] mr-0.5",children:Ie.icon}),((Qe=Qd.find(X=>X.id===ee))==null?void 0:Qe.name)??ee]}),o.jsxs("div",{className:"flex items-center gap-1",children:[Ie.maxGen>0&&o.jsxs("span",{className:"text-[4.5px] font-mono text-white/15",children:["G",Ie.maxGen]}),o.jsxs("span",{className:"px-1 rounded-full text-[5px]",style:{color:`hsl(${Ie.hue},60%,55%)`,background:`hsla(${Ie.hue},40%,30%,0.15)`},children:["",Ie.count]})]})]},ee)})})()})]}),Rt&&Rt.alive&&o.jsxs("div",{className:"px-2 pt-2 border-t border-white/[0.04] mt-1",children:[o.jsxs("div",{className:"text-[5.5px] font-mono uppercase tracking-widest text-teal-300/35 mb-1",children:[o.jsx(jl,{size:6,className:"inline mr-0.5"})," Inspecting: ",Rt.bp.name]}),o.jsxs("div",{className:"flex flex-col gap-0.5 text-[6px] font-mono",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-white/22",children:"Species"}),o.jsx("span",{className:"text-white/50",children:Rt.bp.species})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-white/22",children:"Diet"}),o.jsxs("span",{style:{color:Rt.bp.diet==="herbivore"?"#66ff88":Rt.bp.diet==="carnivore"?"#ff6666":"#ffaa44"},children:[Rt.bp.diet==="herbivore"?"":Rt.bp.diet==="carnivore"?"":""," ",Rt.bp.diet]})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-white/22",children:"Energy"}),o.jsxs("span",{style:{color:Rt.energy<40?"#ff6666":Rt.energy>120?"#66ff88":"#aacc88"},children:[Rt.energy.toFixed(0)," / 200"]})]}),o.jsx("div",{className:"w-full h-1 bg-white/5 rounded-full overflow-hidden",children:o.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${Math.min(100,Rt.energy/200*100)}%`,background:Rt.energy<40?"#ff4444":Rt.energy>120?"#44ff88":"#88aa66"}})}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-white/22",children:"Age"}),o.jsxs("span",{className:"text-white/50",children:[Rt.age," ticks"]})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-white/22",children:"Segs"}),o.jsxs("span",{className:"text-white/50",children:[Rt.segs.length," (",Rt.segs.filter(D=>D.gripped).length," gripped)"]})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-white/22",children:"Facing"}),o.jsx("span",{className:"text-white/50",children:Rt.facingDir>0?" Right":" Left"})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-white/22",children:"Vel"}),o.jsx("span",{className:"text-white/50",children:Math.sqrt(Rt.segs[0].vx**2+Rt.segs[0].vy**2).toFixed(2)})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-white/22",children:"Gen"}),o.jsxs("span",{className:"text-white/50",children:["G",Rt.generation]})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-white/22",children:"Max Age"}),o.jsxs("span",{className:"text-white/50",children:[Rt.maxAge," (",(Rt.age/Rt.maxAge*100).toFixed(0),"%)"]})]})]}),o.jsxs("div",{className:"mt-1 flex gap-0.5",children:[o.jsxs("button",{onClick:()=>{Ln(D=>!D)},className:`flex-1 py-0.5 rounded text-[5.5px] font-mono border transition-all flex items-center justify-center gap-0.5
                              ${xn?"border-cyan-400/25 text-cyan-300/70 bg-cyan-500/8":"border-white/[0.04] text-white/20 hover:text-white/40"}`,children:[o.jsx(Z3,{size:5})," ",xn?"Following":"Follow"]}),o.jsx("button",{onClick:()=>{It.current=null,Nn(null),Ln(!1)},className:"flex-1 py-0.5 rounded text-[5.5px] font-mono border border-white/[0.04] text-white/20 hover:text-white/40 transition-all",children:"Deselect"})]}),o.jsxs("div",{className:"mt-0.5 flex gap-0.5",children:[o.jsx("button",{onClick:()=>{It.current&&(It.current.energy=Math.min(200,It.current.energy+60))},className:"flex-1 py-0.5 rounded text-[5.5px] font-mono border border-emerald-400/15 text-emerald-300/40 hover:bg-emerald-500/6 transition-all",children:" Feed"}),o.jsx("button",{onClick:()=>{It.current&&(It.current.facingDir=It.current.facingDir*-1)},className:"flex-1 py-0.5 rounded text-[5.5px] font-mono border border-white/[0.04] text-white/20 hover:text-white/40 transition-all",children:" Flip"}),o.jsx("button",{onClick:()=>{It.current&&(It.current.energy=-1,It.current=null,Nn(null),Ln(!1))},className:"flex-1 py-0.5 rounded text-[5.5px] font-mono border border-red-400/12 text-red-300/25 hover:bg-red-500/6 transition-all",children:" Kill"})]})]}),o.jsxs("div",{className:"px-2 pt-2 border-t border-white/[0.04] mt-1",children:[o.jsx("div",{className:"text-[5.5px] font-mono uppercase tracking-widest text-white/18 mb-1",children:"Power Tools"}),o.jsx("div",{className:"text-[5px] font-mono text-white/15 mb-1",children:"Select power  click & drag on canvas"}),o.jsx("div",{className:"grid grid-cols-2 gap-0.5",children:uC.map(D=>o.jsxs("button",{onClick:()=>{xt(D.id),nt("power")},title:D.desc,className:`flex items-center gap-1 px-1 py-0.5 rounded text-[6px] font-mono
                              border transition-all ${Tt===D.id&&ne==="power"?"bg-white/8 border-white/15":"border-transparent text-white/28 hover:bg-white/[0.04] hover:text-white/50"}`,style:{color:Tt===D.id&&ne==="power"?D.color:void 0},children:[o.jsx("span",{className:"text-[8px]",children:D.icon}),D.label]},D.id))})]})]}),Fe==="plants"&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"px-2 mb-1.5 text-[5.5px] font-mono text-white/20",children:"Select species  click canvas to plant. Plants photosynthesize (produce food at tips)."}),o.jsx("div",{className:"flex flex-col gap-0.5 px-2 max-h-[300px] overflow-y-auto",style:{scrollbarWidth:"none"},children:Wb.map(D=>o.jsxs("button",{onClick:()=>{Ee(D.id),nt("plant")},className:`flex items-center gap-1.5 px-1.5 py-0.5 rounded text-[6px] font-mono border transition-all
                            ${ge===D.id?"border-green-400/20 bg-green-500/8 text-green-200":"border-transparent text-white/25 hover:bg-white/[0.03] hover:text-white/45"}`,children:[o.jsx("span",{className:"text-[9px]",children:D.icon}),o.jsxs("div",{className:"flex-1 text-left",children:[o.jsx("div",{children:D.label}),o.jsx("div",{className:"text-[4.5px] opacity-40",children:D.desc})]})]},D.id))}),o.jsxs("div",{className:"px-2 pt-1.5 flex flex-col gap-0.5",children:[o.jsxs("button",{onClick:()=>{const{x:D,y:ee}=b.current;ja(ge,D>0?D:mo/2,ee>0?ee:io*.7)},className:`w-full py-1.5 rounded text-[7px] font-mono border border-green-400/20
                          text-green-300/55 hover:bg-green-500/6 transition-all flex items-center justify-center gap-1`,children:[o.jsx(SF,{size:8})," Plant Here"]}),o.jsx("button",{onClick:()=>{h.current=[]},className:`w-full py-0.5 rounded text-[6px] font-mono border border-red-400/10
                          text-red-300/25 hover:bg-red-500/5 transition-all`,children:"Clear All Plants"})]}),o.jsxs("div",{className:"px-2 pt-2 border-t border-white/[0.04] mt-1",children:[o.jsx("div",{className:"text-[5.5px] font-mono uppercase tracking-widest text-white/18 mb-1",children:"Plant Care Tools"}),o.jsx("div",{className:"grid grid-cols-2 gap-0.5",children:Gb.map(D=>o.jsxs("button",{onClick:()=>{Ze(D.id),nt("plant_tool")},title:D.desc,className:`flex items-center gap-1 px-1 py-0.5 rounded text-[6px] font-mono
                              border transition-all ${At===D.id&&ne==="plant_tool"?"bg-white/8 border-white/15":"border-transparent text-white/28 hover:bg-white/[0.04] hover:text-white/50"}`,style:{color:At===D.id&&ne==="plant_tool"?D.color:void 0},children:[o.jsx("span",{className:"text-[8px]",children:D.icon}),D.label]},D.id))})]})]}),Fe==="environment"&&o.jsxs("div",{className:"px-2 flex flex-col gap-2 pt-1",children:[o.jsx(Jc,{label:"Gravity",val:Cn,min:0,max:3,step:.05,fmt:D=>`${D.toFixed(2)}g`,color:"#88aaff",onChange:D=>{wt(D),re.current=D}}),o.jsx(Jc,{label:"Wind",val:st,min:-2,max:2,step:.1,fmt:D=>D>0?`${D.toFixed(1)}`:D<0?`${Math.abs(D).toFixed(1)}`:"0",color:"#66ccff",onChange:D=>{Zt(D),oe.current=D}}),o.jsx(Jc,{label:"Temperature",val:Pe,min:0,max:1,step:.01,fmt:D=>D<.3?"Cold":D>.7?"Hot":"Mild",color:"#ff8844",onChange:D=>{ct(D),te.current=D}}),o.jsx(Jc,{label:"Drag",val:vt,min:.9,max:1,step:.001,fmt:D=>D.toFixed(3),color:"#aa88ff",onChange:D=>{xe(D),J.current=D}}),o.jsxs("div",{className:"border-t border-white/[0.04] pt-2 flex flex-col gap-2",children:[o.jsx("div",{className:"text-[5.5px] font-mono uppercase tracking-widest text-white/18 mb-0.5",children:"Physics"}),o.jsx(Jc,{label:"Fluid Pressure",val:Mt,min:0,max:1,step:.05,fmt:D=>D.toFixed(2),color:"#2266ff",onChange:D=>{bn(D),Pt.current=D,a.current.fluidPressure=D}}),o.jsx(Jc,{label:"Obj Buoyancy",val:An,min:0,max:1,step:.05,fmt:D=>D.toFixed(2),color:"#44ccaa",onChange:D=>{cr(D),Tn.current=D}}),o.jsx(Jc,{label:"Heat Diffusion",val:Sr,min:0,max:1,step:.05,fmt:D=>D.toFixed(2),color:"#ff8844",onChange:D=>{de(D),$e.current=D}})]}),o.jsxs("div",{className:"border-t border-white/[0.04] pt-2 flex flex-col gap-0.5",children:[o.jsx("div",{className:"text-[5.5px] font-mono uppercase tracking-widest text-white/18 mb-0.5",children:"Weather"}),o.jsxs("div",{className:"grid grid-cols-3 gap-0.5",children:[o.jsx("button",{onClick:()=>{const D=a.current;for(let ee=0;ee<40;ee++){const Ie=5+(Math.random()*(mo-10)|0);D.get(Ie,2)===K.EMPTY&&D.set(Ie,2,K.WATER)}},className:`py-0.5 rounded text-[6px] font-mono border border-blue-400/12
                            text-blue-300/35 hover:bg-blue-500/6 transition-all`,children:" Rain"}),o.jsx("button",{onClick:()=>{const D=a.current;for(let ee=0;ee<20;ee++){const Ie=5+(Math.random()*(mo-10)|0);D.get(Ie,2)===K.EMPTY&&D.set(Ie,2,K.SNOW)}},className:`py-0.5 rounded text-[6px] font-mono border border-blue-200/12
                            text-blue-200/30 hover:bg-blue-200/6 transition-all`,children:" Snow"}),o.jsx("button",{onClick:()=>{const D=a.current;for(let ee=0;ee<15;ee++){const Ie=5+(Math.random()*(mo-10)|0);D.set(Ie,2,K.FIRE)}},className:`py-0.5 rounded text-[6px] font-mono border border-orange-400/12
                            text-orange-300/30 hover:bg-orange-500/6 transition-all`,children:" Meteor"}),o.jsx("button",{onClick:()=>{const D=a.current;for(let ee=0;ee<10;ee++){const Ie=5+(Math.random()*(mo-10)|0);D.get(Ie,2)===K.EMPTY&&D.set(Ie,2,K.GAS)}},className:`py-0.5 rounded text-[6px] font-mono border border-green-400/12
                            text-green-300/30 hover:bg-green-500/6 transition-all`,children:" Gas Cloud"}),o.jsx("button",{onClick:()=>{const D=a.current,ee=Math.floor(io*.7);for(let Ie=ee;Ie<io-2;Ie++)for(let Qe=1;Qe<mo-1;Qe++)D.get(Qe,Ie)===K.EMPTY&&D.set(Qe,Ie,K.WATER)},className:`py-0.5 rounded text-[6px] font-mono border border-cyan-400/12
                            text-cyan-300/30 hover:bg-cyan-500/6 transition-all`,children:" Flood"}),o.jsx("button",{onClick:()=>{const D=a.current;for(let ee=0;ee<io;ee++)for(let Ie=0;Ie<mo;Ie++)D.get(Ie,ee)===K.WATER&&D.set(Ie,ee,K.EMPTY)},className:`py-0.5 rounded text-[6px] font-mono border border-red-300/12
                            text-red-300/25 hover:bg-red-400/6 transition-all`,children:" Clear Water"})]})]}),o.jsxs("div",{className:"border-t border-white/[0.04] pt-2 flex flex-col gap-1",children:[o.jsx("div",{className:"text-[5.5px] font-mono uppercase tracking-widest text-white/18 mb-0.5",children:"Presets"}),[{label:"Normal",g:1,w:0,t:.5,d:.99},{label:"Zero-G",g:0,w:0,t:.5,d:.995},{label:"Heavy",g:2.5,w:0,t:.5,d:.98},{label:"Windy",g:1,w:1.5,t:.5,d:.99},{label:"Ice World",g:1,w:.3,t:.1,d:.998},{label:"Volcanic",g:1.2,w:0,t:.9,d:.985},{label:"Moon",g:.16,w:0,t:.2,d:.998}].map(D=>o.jsx("button",{onClick:()=>{wt(D.g),Zt(D.w),ct(D.t),xe(D.d),re.current=D.g,oe.current=D.w,te.current=D.t,J.current=D.d},className:`w-full py-0.5 px-1.5 rounded text-[6px] font-mono border border-white/[0.04]
                            text-white/25 hover:bg-white/[0.04] hover:text-white/50 transition-all text-left`,children:D.label},D.label))]})]}),Fe==="ecosystem"&&o.jsxs("div",{className:"px-2 pt-1 flex flex-col gap-2",children:[o.jsx("div",{className:"text-[5.5px] font-mono text-white/25 leading-relaxed",children:"Prey/Predator ecosystem  herbivores eat plants, carnivores hunt smaller creatures. Balanced by food chain."}),o.jsxs("div",{className:"flex flex-col gap-0.5",children:[o.jsx("div",{className:"text-[5.5px] font-mono uppercase tracking-widest text-white/18 mb-0.5",children:"Diet Legend"}),o.jsxs("div",{className:"flex gap-1 text-[6px] font-mono",children:[o.jsx("span",{className:"px-1 rounded bg-green-500/10 text-green-300/60",children:" Herb"}),o.jsx("span",{className:"px-1 rounded bg-red-500/10 text-red-300/60",children:" Carn"}),o.jsx("span",{className:"px-1 rounded bg-amber-500/10 text-amber-300/60",children:" Omni"})]})]}),o.jsxs("div",{className:"border-t border-white/[0.04] pt-1.5",children:[o.jsx("div",{className:"text-[5.5px] font-mono uppercase tracking-widest text-white/18 mb-1",children:"Population by Diet"}),o.jsx("div",{className:"flex flex-col gap-0.5 text-[6px] font-mono",children:(()=>{const D={herbivore:0,carnivore:0,omnivore:0};for(const ee of c.current)ee.alive&&D[ee.bp.diet]++;return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-green-300/50",children:" Herbivores"}),o.jsx("span",{className:"text-green-300/70",children:D.herbivore})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-red-300/50",children:" Carnivores"}),o.jsx("span",{className:"text-red-300/70",children:D.carnivore})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-amber-300/50",children:" Omnivores"}),o.jsx("span",{className:"text-amber-300/70",children:D.omnivore})]}),o.jsxs("div",{className:"flex justify-between mt-1 border-t border-white/[0.03] pt-1",children:[o.jsx("span",{className:"text-white/30",children:"Total Alive"}),o.jsx("span",{className:"text-white/55",children:D.herbivore+D.carnivore+D.omnivore})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-white/20",children:"Ragdoll Corpses"}),o.jsx("span",{className:"text-white/35",children:et.current.length})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-white/20",children:"Plants"}),o.jsx("span",{className:"text-white/35",children:h.current.length})]})]})})()})]}),o.jsxs("div",{className:"border-t border-white/[0.04] pt-1.5 flex flex-col gap-0.5",children:[o.jsx("div",{className:"text-[5.5px] font-mono uppercase tracking-widest text-white/18 mb-0.5",children:"Quick Actions"}),o.jsx("button",{onClick:()=>{const D=Qd.filter(ee=>ee.diet==="herbivore");for(let ee=0;ee<3;ee++)Er(D[Math.floor(Math.random()*D.length)])},className:`w-full py-0.5 rounded text-[6px] font-mono border border-green-400/12
                          text-green-300/40 hover:bg-green-500/6 transition-all`,children:" Spawn 3 Herbivores"}),o.jsx("button",{onClick:()=>{const D=Qd.filter(ee=>ee.diet==="carnivore");for(let ee=0;ee<2;ee++)Er(D[Math.floor(Math.random()*D.length)])},className:`w-full py-0.5 rounded text-[6px] font-mono border border-red-400/12
                          text-red-300/35 hover:bg-red-500/6 transition-all`,children:" Spawn 2 Carnivores"}),o.jsx("button",{onClick:()=>{for(let D=0;D<5;D++){const ee=Wb[Math.floor(Math.random()*Wb.length)],Ie=20+Math.random()*(mo-40);ja(ee.id,Ie,io*.5)}},className:`w-full py-0.5 rounded text-[6px] font-mono border border-green-400/12
                          text-green-300/35 hover:bg-green-500/6 transition-all`,children:" Seed 5 Random Plants"}),o.jsx("button",{onClick:()=>a.current.spawnFood(30),className:`w-full py-0.5 rounded text-[6px] font-mono border border-emerald-400/12
                          text-emerald-300/35 hover:bg-emerald-500/6 transition-all`,children:" Flood Food (30)"}),o.jsx("button",{onClick:()=>{et.current=[]},className:`w-full py-0.5 rounded text-[6px] font-mono border border-white/[0.04]
                          text-white/20 hover:bg-white/[0.04] transition-all`,children:" Clear Corpses"})]}),o.jsxs("div",{className:"border-t border-white/[0.04] pt-1.5",children:[o.jsx("div",{className:"text-[5.5px] font-mono uppercase tracking-widest text-white/18 mb-0.5",children:"Plant Tools"}),o.jsx("div",{className:"text-[5px] font-mono text-white/15 mb-1",children:"Select tool  click near a plant on canvas"}),o.jsx("div",{className:"grid grid-cols-2 gap-0.5",children:Gb.map(D=>o.jsxs("button",{onClick:()=>{Ze(D.id),nt("plant_tool")},title:D.desc,className:`flex items-center gap-1 px-1 py-0.5 rounded text-[6px] font-mono
                              border transition-all ${At===D.id&&ne==="plant_tool"?"bg-white/8 border-white/15":"border-transparent text-white/28 hover:bg-white/[0.04] hover:text-white/50"}`,style:{color:At===D.id&&ne==="plant_tool"?D.color:void 0},children:[o.jsx("span",{className:"text-[8px]",children:D.icon}),D.label]},D.id))})]})]})]}),o.jsx("div",{className:"px-2 py-1.5 border-t border-white/[0.04]",children:o.jsxs("div",{className:"text-[5px] font-mono text-white/10 leading-relaxed",children:["Scroll=zoom  Alt+drag=pan  Space=pause",o.jsx("br",{}),"C=rand-spawn  F=food  R=reset  1-8=tools"]})})]})]}),o.jsxs("div",{className:"flex-1 relative overflow-hidden",children:[o.jsx("canvas",{ref:t,className:"absolute inset-0 w-full h-full",style:{imageRendering:"pixelated",cursor:ne==="grab"?"grab":ne==="paint"||ne==="erase"?"crosshair":ne==="creature"?"cell":ne==="drop"||ne==="plant"?"copy":ne==="power"||ne==="plant_tool"?"pointer":ne==="inspect"?"help":"default"},onPointerDown:qo,onPointerMove:os,onPointerUp:Ho,onPointerLeave:Ho,onWheel:fs}),!pe&&o.jsx("div",{className:`absolute top-2 left-1/2 -translate-x-1/2 z-10 pointer-events-none
              text-[7px] font-mono text-white/25 bg-black/50 px-3 py-1 rounded border border-white/8`,children:" PAUSED  Space to resume"}),Rt&&Rt.alive&&Fe!=="creatures"&&o.jsx("div",{className:`absolute bottom-3 left-3 z-10 pointer-events-auto
              px-2.5 py-1.5 rounded-lg bg-black/70 border border-teal-400/20 backdrop-blur-sm cursor-pointer`,onClick:()=>Oe("creatures"),children:o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx(jl,{size:7,className:"text-teal-300/50"}),o.jsxs("span",{className:"text-[6.5px] font-mono text-teal-200/60",children:[Rt.bp.icon," ",Rt.bp.name]}),o.jsxs("span",{className:"text-[5.5px] font-mono",style:{color:Rt.energy<40?"#ff6666":Rt.energy>120?"#66ff88":"#aacc88"},children:["",Rt.energy.toFixed(0)]})]})}),(mt==null?void 0:mt.running)&&o.jsx("div",{className:`absolute bottom-3 left-1/2 -translate-x-1/2 z-10 pointer-events-none
              px-4 py-2 rounded-lg bg-black/70 border border-purple-400/25 backdrop-blur-sm`,children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-400 animate-pulse"}),o.jsxs("div",{className:"flex flex-col gap-0.5",children:[o.jsxs("span",{className:"text-[7px] font-mono text-purple-200/80 font-bold",children:["EVOLVING  Gen ",mt.generation]}),o.jsxs("span",{className:"text-[6px] font-mono text-purple-300/50",children:["Candidate ",mt.candidateIdx+1,"/",mt.popSize,"  best ",mt.bestScore>-1/0?mt.bestScore.toFixed(1):""]})]})]})})]})]}),nr&&o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",onClick:D=>{D.target===D.currentTarget&&_n(!1)},children:o.jsxs("div",{className:`bg-[#080c14] border border-white/[0.06] rounded-xl w-[480px] max-h-[60vh]
            flex flex-col overflow-hidden`,children:[o.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-white/[0.05]",children:[o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx(V5,{size:10,className:"text-amber-400/50"}),o.jsx("span",{className:"text-[8px] font-mono uppercase tracking-widest text-white/40",children:"Species Gallery"})]}),o.jsx("button",{onClick:()=>_n(!1),className:"text-white/20 hover:text-white/50 text-[9px] font-mono",children:""})]}),o.jsxs("div",{className:"flex-1 overflow-y-auto p-2",style:{scrollbarWidth:"none"},children:[gn.length===0&&o.jsx("div",{className:"text-center text-[7px] font-mono text-white/15 py-6",children:"No species saved yet. Train in Evolve tab and save."}),o.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:gn.map(D=>o.jsxs("div",{className:"p-2 rounded bg-white/[0.02] border border-white/[0.04] flex flex-col gap-1",children:[o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx("span",{className:"text-[12px]",children:D.bp.icon}),o.jsxs("div",{children:[o.jsx("div",{className:"text-[7px] font-mono text-white/55",children:D.bp.name}),o.jsxs("div",{className:"text-[5.5px] font-mono text-white/22",children:["G",D.generation,"  ",D.bestScore.toFixed(1)]})]})]}),o.jsx("button",{onClick:()=>{const ee=vu.find(Qe=>Qe.id===O.current)??vu[0],Ie=Hb(a.current,ee.spawnX,ee.spawnY);c.current.push(Ou(D.bp,ee.spawnX,Ie,D.bestParams.slice())),_n(!1)},className:`py-0.5 rounded text-[6px] font-mono border border-cyan-400/15
                        text-cyan-300/40 hover:bg-cyan-500/6 transition-all`,children:"Adopt"})]},D.id))})]})]})})]})},vy={tree:{maxDepth:8,segLen:12,lenDecay:.82,thickDecay:.72,branchAngle:.5,angleJitter:.3,branchProb:.6,maxBranches:3,growUp:!0,needsWater:!1,trunkDepth:3},vine:{maxDepth:12,segLen:6,lenDecay:.92,thickDecay:.88,branchAngle:.55,angleJitter:.7,branchProb:.3,maxBranches:3,growUp:!1,needsWater:!1,trunkDepth:0},coral:{maxDepth:7,segLen:6,lenDecay:.82,thickDecay:.75,branchAngle:.65,angleJitter:.8,branchProb:.55,maxBranches:4,growUp:!1,needsWater:!0,trunkDepth:1},mushroom:{maxDepth:5,segLen:10,lenDecay:.5,thickDecay:.5,branchAngle:1.2,angleJitter:.35,branchProb:.85,maxBranches:5,growUp:!0,needsWater:!1,trunkDepth:3},fern:{maxDepth:8,segLen:8,lenDecay:.82,thickDecay:.78,branchAngle:.45,angleJitter:.25,branchProb:.7,maxBranches:2,growUp:!0,needsWater:!1,trunkDepth:1},cactus:{maxDepth:5,segLen:10,lenDecay:.7,thickDecay:.65,branchAngle:.25,angleJitter:.12,branchProb:.25,maxBranches:2,growUp:!0,needsWater:!1,trunkDepth:2},kelp:{maxDepth:10,segLen:8,lenDecay:.93,thickDecay:.9,branchAngle:.18,angleJitter:.12,branchProb:.15,maxBranches:2,growUp:!0,needsWater:!0,trunkDepth:5},bamboo:{maxDepth:12,segLen:10,lenDecay:.97,thickDecay:.95,branchAngle:.12,angleJitter:.05,branchProb:.08,maxBranches:2,growUp:!0,needsWater:!1,trunkDepth:9},moss:{maxDepth:4,segLen:2.5,lenDecay:.8,thickDecay:.7,branchAngle:1,angleJitter:1.2,branchProb:.75,maxBranches:5,growUp:!1,needsWater:!1,trunkDepth:0},sunflower:{maxDepth:6,segLen:12,lenDecay:.55,thickDecay:.55,branchAngle:.35,angleJitter:.06,branchProb:.08,maxBranches:2,growUp:!0,needsWater:!1,trunkDepth:5},lily:{maxDepth:4,segLen:3,lenDecay:.75,thickDecay:.65,branchAngle:.8,angleJitter:.7,branchProb:.6,maxBranches:4,growUp:!1,needsWater:!0,trunkDepth:0},mangrove:{maxDepth:8,segLen:10,lenDecay:.82,thickDecay:.72,branchAngle:.55,angleJitter:.45,branchProb:.5,maxBranches:3,growUp:!0,needsWater:!1,trunkDepth:2},orchid:{maxDepth:6,segLen:7,lenDecay:.72,thickDecay:.65,branchAngle:.45,angleJitter:.3,branchProb:.35,maxBranches:3,growUp:!0,needsWater:!1,trunkDepth:3},pitcher:{maxDepth:5,segLen:8,lenDecay:.7,thickDecay:.6,branchAngle:.7,angleJitter:.5,branchProb:.4,maxBranches:3,growUp:!0,needsWater:!1,trunkDepth:2},bonsai:{maxDepth:7,segLen:6,lenDecay:.8,thickDecay:.7,branchAngle:.55,angleJitter:.45,branchProb:.6,maxBranches:3,growUp:!0,needsWater:!1,trunkDepth:1}};function h6(e,t,n,r){const a=vy[t]??vy.tree;if(r>=a.maxDepth||e.x<2||e.x>mo-2||e.y<2||e.y>io-2||n.isSolid(e.x|0,e.y|0)||a.needsWater&&r>0&&n.cellAt(e.x|0,e.y|0)!==K.WATER)return;const i=r<a.trunkDepth,s=i?1:Math.random()<a.branchProb?1+Math.floor(Math.random()*a.maxBranches):1,c=a.segLen*Math.pow(a.lenDecay,r);for(let l=0;l<s;l++){let d=e.angle;if(i)d+=(Math.random()-.5)*a.angleJitter*.3;else if(s>1){const f=a.branchAngle,g=s>1?l/(s-1)-.5:0;d+=g*f*2+(Math.random()-.5)*a.angleJitter}else d+=(Math.random()-.5)*a.angleJitter;if(a.growUp){const f=r<a.trunkDepth?.7:.4;d=d*(1-f)+-Math.PI/2*f}const u=e.x+Math.cos(d)*c,h=e.y+Math.sin(d)*c;if(u<2||u>mo-2||h<2||h>io-2||n.isSolid(u|0,h|0))continue;const m={x:u,y:h,vx:0,vy:0,restDx:u-e.x,restDy:h-e.y,age:0,thickness:Math.max(.15,e.thickness*a.thickDecay),children:[],angle:d,alive:!0};e.children.push(m),Math.random()<.96-r*.02&&h6(m,t,n,r+1)}}function f6(e,t,n,r){if(!e.alive||r>50)return;e.age++;const a=vy[t.species]??vy.tree;if(!(a.needsWater&&r>0&&n.cellAt(e.x|0,e.y|0)!==K.WATER)){if(e.children.length===0){const i=1/(1+Math.max(0,r-a.maxDepth)*.25),s=t.growthRate*.15*i*(r<a.trunkDepth?.3:1);if(Math.random()<s){const l=a.segLen*Math.pow(a.lenDecay,r)*(.7+Math.random()*.3);let d=e.angle+(Math.random()-.5)*a.angleJitter;if(a.growUp){const m=r<a.trunkDepth?.7:.4;d=d*(1-m)+-Math.PI/2*m}const u=e.x+Math.cos(d)*l,h=e.y+Math.sin(d)*l;u>2&&u<mo-2&&h>2&&h<io-2&&!n.isSolid(u|0,h|0)&&e.children.push({x:u,y:h,vx:0,vy:0,restDx:u-e.x,restDy:h-e.y,age:0,thickness:Math.max(.12,e.thickness*a.thickDecay),children:[],angle:d,alive:!0})}if(e.age>8&&Math.random()<a.branchProb*.06&&e.children.length<a.maxBranches){const l=Math.random()<.5?-1:1,d=e.angle+l*a.branchAngle*(.6+Math.random()*.4),u=a.segLen*Math.pow(a.lenDecay,r)*.7,h=e.x+Math.cos(d)*u,m=e.y+Math.sin(d)*u;h>2&&h<mo-2&&m>2&&m<io-2&&!n.isSolid(h|0,m|0)&&e.children.push({x:h,y:m,vx:0,vy:0,restDx:h-e.x,restDy:m-e.y,age:0,thickness:Math.max(.1,e.thickness*a.thickDecay*.6),children:[],angle:d,alive:!0})}if((t.species==="sunflower"||t.species==="orchid"||t.species==="tree"||t.species==="mangrove")&&e.age>50&&Math.random()<.008){const l=e.x+(Math.random()-.5)*3|0,d=e.y+1|0;n.get(l,d)===K.EMPTY&&n.set(l,d,K.FOOD)}}r<3&&e.age%60===0&&(e.thickness=Math.min(4,e.thickness+.02));for(const i of e.children)f6(i,t,n,r+1)}}function p6(e,t,n,r,a){if(!e.alive)return;const i=t.species;if(!!n){const c=n.x+e.restDx,l=n.y+e.restDy,u=(i==="bamboo"?.55:i==="cactus"?.65:i==="tree"?.45:i==="vine"?.12:i==="kelp"?.1:i==="fern"?.35:i==="mushroom"?.5:i==="moss"?.3:i==="bonsai"?.5:i==="mangrove"?.42:i==="sunflower"?.4:.35)+e.thickness*.1;e.vx+=(c-e.x)*u,e.vy+=(l-e.y)*u;const h=(1-Math.min(1,e.thickness*.3))*.06;e.vx+=r*h;const m=i==="vine"?.025:i==="kelp"?-.008:i==="moss"?.012:.008;e.vy+=m*a;const f=t.age*.012+e.restDx*.3+e.restDy*.2;i==="kelp"||i==="coral"?e.vx+=Math.sin(f*.8+e.y*.1)*.015:i==="vine"?e.vx+=Math.sin(f*.5)*.008:i==="bamboo"?e.vx+=Math.sin(f*2)*.004:(i==="sunflower"||i==="fern")&&(e.vx+=Math.sin(f*.7)*.005,e.vy+=Math.cos(f*.5)*.002),e.vx*=.78,e.vy*=.78,e.x+=e.vx,e.y+=e.vy;const g=e.x-n.x,x=e.y-n.y,v=Math.sqrt(g*g+x*x),w=Math.sqrt(e.restDx*e.restDx+e.restDy*e.restDy)*1.4;if(v>w&&v>.1){const M=w/v;e.x=n.x+g*M,e.y=n.y+x*M}e.x=Math.max(2,Math.min(mo-2,e.x)),e.y=Math.max(2,Math.min(io-2,e.y))}for(const c of e.children)p6(c,t,e,r,a)}function B5(e,t,n,r){if(!e.alive)return;const a=e.x-t,i=e.y-n,s=a*a+i*i;s<r.dist&&(r.dist=s,r.node=e);for(const c of e.children)B5(c,t,n,r)}const $U={tree:110,vine:130,coral:340,mushroom:280,fern:120,cactus:100,kelp:155,bamboo:115,moss:105,sunflower:50,lily:330,mangrove:140,orchid:310,pitcher:135,bonsai:95};function qU(e,t,n,r,a,i,s){e.fillStyle=s;let c=Math.round(t),l=Math.round(n);const d=Math.round(r),u=Math.round(a),h=Math.abs(d-c),m=-Math.abs(u-l),f=c<d?1:-1,g=l<u?1:-1;let x=h+m;const v=Math.max(0,Math.round(i*.5));for(let b=0;b<200&&(v<=0?e.fillRect(c,l,1,1):(e.fillRect(c-v,l,1+v*2,1),e.fillRect(c,l-v,1,1+v*2)),!(c===d&&l===u));b++){const w=2*x;w>=m&&(x+=m,c+=f),w<=h&&(x+=h,l+=g)}}function m6(e,t,n,r,a=0){const i=$U[n.species]??120,s=n.species;n.age*.02;for(const c of t.children){if(!c.alive)continue;const l=Math.max(0,t.thickness*Math.pow(.88,a));let d;if(s==="mushroom"&&a<3)d=`hsl(30,20%,${22+a*3}%)`;else if(s==="cactus")d=`hsl(${i},55%,${28+a*3}%)`;else if(s==="bamboo")d=a%3===0&&a>0?`hsl(${i},30%,30%)`:`hsl(${i},50%,${32+a*2}%)`;else if(s==="coral")d=`hsl(${i+a*10},${65+a*3}%,${35+a*5}%)`;else if(s==="kelp")d=`hsl(${i},45%,${25+a*3}%)`;else{const h=Math.max(0,1-a/4),m=i*(1-h)+30*h,f=25+(1-h)*45,g=20+a*3;d=`hsl(${m},${f}%,${g}%)`}qU(e,t.x,t.y,c.x,c.y,l,d),c.children.length===0&&c.alive&&a>1&&HU(e,c.x,c.y,s,i,a,t.thickness),m6(e,c,n,r,a+1)}}function HU(e,t,n,r,a,i,s,c){const l=Math.round(t),d=Math.round(n),u=(h,m,f)=>{e.fillStyle=f,e.fillRect(Math.round(h),Math.round(m),1,1)};switch(r){case"tree":case"bonsai":case"mangrove":{const h=`hsl(${a+10},55%,32%)`,m=`hsl(${a+20},60%,40%)`,f=`hsl(${a+5},50%,28%)`;u(l,d,h),u(l-1,d,m),u(l+1,d,m),u(l,d-1,m),u(l,d+1,f),s>1&&(u(l-1,d-1,f),u(l+1,d-1,f),u(l-2,d,m),u(l+2,d,m));break}case"fern":{const h=`hsl(${a+15},60%,36%)`,m=i%2===0?1:-1;u(l,d,h),u(l+m,d-1,h),u(l+m*2,d-2,h);break}case"mushroom":{if(i>=2){const h=`hsl(${a},50%,38%)`,m=`hsl(${a+30},40%,55%)`,f=`hsl(${a-10},55%,30%)`;for(let g=-3;g<=3;g++)u(l+g,d-1,h);for(let g=-2;g<=2;g++)u(l+g,d-2,h);u(l-1,d-3,h),u(l,d-3,h),u(l+1,d-3,h),u(l-1,d-2,m),u(l+1,d-2,m),u(l-2,d,f),u(l+2,d,f)}break}case"coral":{const h=`hsl(${a},80%,60%)`;u(l,d,h),u(l+1,d,h),u(l,d-1,h),e.fillStyle=`hsla(${a},85%,65%,0.3)`,e.fillRect(l-1,d-1,3,3);break}case"sunflower":{if(i>=4){const h="hsl(50,85%,55%)",m="hsl(30,70%,22%)";u(l-2,d,h),u(l+2,d,h),u(l,d-2,h),u(l,d+2,h),u(l-1,d-1,h),u(l+1,d-1,h),u(l-1,d+1,h),u(l+1,d+1,h),u(l,d,m),u(l-1,d,m),u(l+1,d,m),u(l,d-1,m),u(l,d+1,m)}else u(l,d,`hsl(${a+60},50%,35%)`);break}case"orchid":{if(i>=3){const h=`hsl(${a},65%,58%)`,m=`hsl(${a+40},70%,68%)`;u(l,d-2,h),u(l-2,d,h),u(l+2,d,h),u(l-1,d+1,h),u(l+1,d+1,h),u(l,d,m)}break}case"vine":case"moss":{u(l,d,`hsl(${a+15},55%,36%)`),u(l+(i%2===0?1:-1),d,`hsl(${a+10},50%,32%)`);break}case"cactus":{const h="hsl(60,30%,58%)";u(l-2,d,h),u(l+2,d,h),u(l,d-2,h),u(l,d+2,h);break}case"kelp":{const h=`hsl(${a},45%,33%)`;u(l,d,h),u(l,d-1,h),u(l+1,d,h);break}case"bamboo":{const h=`hsl(${a+10},50%,38%)`;u(l-1,d,h),u(l+1,d,h),u(l-2,d-1,h),u(l+2,d-1,h);break}case"lily":{const h="hsl(140,50%,30%)";for(let m=-2;m<=2;m++)u(l+m,d,h);for(let m=-1;m<=1;m++)u(l+m,d-1,h);if(i>=2){const m=`hsl(${a},60%,62%)`;u(l,d-1,m),u(l-1,d-2,m),u(l+1,d-2,m)}break}case"pitcher":{const h=`hsl(${a},45%,33%)`,m=`hsl(${a+30},55%,43%)`;u(l-1,d,h),u(l+1,d,h),u(l-1,d-1,h),u(l+1,d-1,h),u(l-1,d-2,h),u(l+1,d-2,h),u(l-2,d-3,m),u(l-1,d-3,m),u(l,d-3,m),u(l+1,d-3,m),u(l+2,d-3,m);break}default:u(l,d,`hsl(${a+20},55%,38%)`),u(l+1,d,`hsl(${a+20},55%,38%)`)}}function WU(e,t,n){const r=u6.find(c=>c.id===t.type),a=(r==null?void 0:r.color)??"#ffffff",i=t.x,s=t.y;switch(e.save(),t.type){case"bomb":case"c4":case"nuke":{const c=Math.sin(n*.3)>0&&t.life>30;e.beginPath(),e.arc(i,s,t.type==="nuke"?3:2,0,Math.PI*2),e.fillStyle=c?"#ff0000":a+"cc",e.shadowColor=a,e.shadowBlur=4,e.fill(),e.shadowBlur=0,t.life>0&&t.type==="bomb"&&(e.beginPath(),e.arc(i,s-2.5,.5,0,Math.PI*2),e.fillStyle=`hsl(${n*20%60},100%,70%)`,e.fill());break}case"fan":{const c=n*.15;for(let l=0;l<3;l++){const d=c+l*Math.PI*2/3;e.beginPath(),e.moveTo(i,s),e.lineTo(i+Math.cos(d)*3,s+Math.sin(d)*3),e.strokeStyle=a+"88",e.lineWidth=.6,e.stroke()}e.beginPath(),e.arc(i,s,.8,0,Math.PI*2),e.fillStyle=a+"aa",e.fill();break}case"attractor":case"repulsor":{const c=Math.sin(n*.08)*2+5;e.beginPath(),e.arc(i,s,c,0,Math.PI*2),e.strokeStyle=a+"30",e.lineWidth=.3,e.stroke(),e.beginPath(),e.arc(i,s,1.5,0,Math.PI*2),e.fillStyle=a+"cc",e.shadowColor=a,e.shadowBlur=6,e.fill(),e.shadowBlur=0;break}case"heater":case"cooler":{e.beginPath(),e.arc(i,s,2,0,Math.PI*2),e.fillStyle=a+"88",e.shadowColor=a,e.shadowBlur=8,e.fill(),e.shadowBlur=0;for(let c=0;c<3;c++){const l=n*.05+c*2.1,d=3+Math.sin(n*.1+c)*1.5;e.beginPath(),e.arc(i+Math.cos(l)*d,s+Math.sin(l)*d,.4,0,Math.PI*2),e.fillStyle=a+"44",e.fill()}break}case"lightning":{e.beginPath();let c=i,l=s;for(let d=0;d<8;d++)c+=(Math.random()-.5)*3,l+=4,e.lineTo(c,l);e.strokeStyle="#ffff88",e.lineWidth=.5,e.shadowColor="#ffff00",e.shadowBlur=6,e.stroke(),e.shadowBlur=0;break}case"virus":{const c=Math.sin(n*.12)*.5+1.5;e.beginPath(),e.arc(i,s,c,0,Math.PI*2),e.fillStyle="#88ff4466",e.fill();for(let l=0;l<6;l++){const d=l*Math.PI/3+n*.02;e.beginPath(),e.moveTo(i,s),e.lineTo(i+Math.cos(d)*(c+1),s+Math.sin(d)*(c+1)),e.strokeStyle="#88ff4444",e.lineWidth=.2,e.stroke()}break}case"blackhole":{for(let l=3;l>0;l--)e.beginPath(),e.arc(i,s,l*3+Math.sin(n*.05+l)*1,0,Math.PI*2),e.strokeStyle=`rgba(80,0,120,${.15/l})`,e.lineWidth=.5,e.stroke();e.beginPath(),e.arc(i,s,2,0,Math.PI*2),e.fillStyle="#1a0028",e.shadowColor="#6600aa",e.shadowBlur=10,e.fill(),e.shadowBlur=0;break}case"whitehole":{const c=Math.sin(n*.1)*1+3;e.beginPath(),e.arc(i,s,c,0,Math.PI*2),e.strokeStyle="rgba(255,255,255,0.15)",e.lineWidth=.3,e.stroke(),e.beginPath(),e.arc(i,s,1.5,0,Math.PI*2),e.fillStyle="rgba(255,255,255,0.7)",e.shadowColor="#ffffff",e.shadowBlur=8,e.fill(),e.shadowBlur=0;break}case"spring":{for(let c=0;c<5;c++){const l=s+c*.8-2;e.beginPath(),e.moveTo(i-1.5,l),e.quadraticCurveTo(i+(c%2===0?2:-2),l+.4,i+1.5,l+.8),e.strokeStyle="#44ff8888",e.lineWidth=.3,e.stroke()}break}case"vortex":{for(let c=0;c<3;c++){const l=n*.12+c*Math.PI*2/3,d=4+c*2.5+Math.sin(n*.06)*1.5;e.beginPath(),e.arc(i,s,d,l,l+1.2),e.strokeStyle=`rgba(68,136,255,${.3-c*.08})`,e.lineWidth=.4,e.stroke()}e.beginPath(),e.arc(i,s,1.2,0,Math.PI*2),e.fillStyle="#4488ffaa",e.shadowColor="#4488ff",e.shadowBlur=6,e.fill(),e.shadowBlur=0;break}case"motor":{const c=t.angle??n*.08;e.beginPath(),e.arc(i,s,2.5,0,Math.PI*2),e.strokeStyle="#ffaa44aa",e.lineWidth=.4,e.stroke();for(let l=0;l<4;l++){const d=c+l*Math.PI/2;e.beginPath(),e.moveTo(i+Math.cos(d)*1.8,s+Math.sin(d)*1.8),e.lineTo(i+Math.cos(d)*3.5,s+Math.sin(d)*3.5),e.strokeStyle="#ffaa4488",e.lineWidth=.6,e.lineCap="round",e.stroke()}e.beginPath(),e.arc(i,s,.8,0,Math.PI*2),e.fillStyle="#ffaa44cc",e.fill();break}case"laser":{t.life<(t.maxLife>0?t.maxLife:60)&&(e.beginPath(),e.moveTo(i,s),e.lineTo(i+(Math.random()-.5)*.5,s+50),e.strokeStyle="rgba(255,30,30,0.7)",e.lineWidth=.6,e.shadowColor="#ff2222",e.shadowBlur=8,e.stroke(),e.shadowBlur=0,e.beginPath(),e.arc(i,s,1,0,Math.PI*2),e.fillStyle="#ff4444cc",e.fill());break}case"spore":{const c=Math.sin(n*.08)*.5+1.5;e.beginPath(),e.arc(i,s,c*2,0,Math.PI*2),e.fillStyle="rgba(170,136,255,0.12)",e.fill();for(let l=0;l<5;l++){const d=n*.04+l*1.25,u=c+Math.sin(d*2)*1.5;e.beginPath(),e.arc(i+Math.cos(d)*u,s+Math.sin(d)*u,.4,0,Math.PI*2),e.fillStyle="rgba(170,136,255,0.5)",e.fill()}break}case"portal_in":{for(let c=0;c<3;c++){const l=n*.15+c*2.1;e.beginPath(),e.arc(i,s,3+c+Math.sin(l)*.8,0,Math.PI*2),e.strokeStyle=`rgba(255,68,255,${.25-c*.06})`,e.lineWidth=.4,e.stroke()}e.beginPath(),e.arc(i,s,1.5,0,Math.PI*2),e.fillStyle="#ff44ff88",e.shadowColor="#ff44ff",e.shadowBlur=6,e.fill(),e.shadowBlur=0;break}case"portal_out":{for(let c=0;c<3;c++){const l=-n*.15+c*2.1;e.beginPath(),e.arc(i,s,3+c+Math.sin(l)*.8,0,Math.PI*2),e.strokeStyle=`rgba(68,255,255,${.25-c*.06})`,e.lineWidth=.4,e.stroke()}e.beginPath(),e.arc(i,s,1.5,0,Math.PI*2),e.fillStyle="#44ffff88",e.shadowColor="#44ffff",e.shadowBlur=6,e.fill(),e.shadowBlur=0;break}case"ball":{e.beginPath(),e.arc(i,s,2,0,Math.PI*2),e.fillStyle="#ff88aacc",e.shadowColor="#ff88aa",e.shadowBlur=3,e.fill(),e.shadowBlur=0,e.beginPath(),e.arc(i-.5,s-.5,.6,0,Math.PI*2),e.fillStyle="rgba(255,255,255,0.3)",e.fill();break}case"box":{e.fillStyle="#88aaffcc",e.fillRect(i-2,s-2,4,4),e.strokeStyle="#88aaff44",e.lineWidth=.3,e.strokeRect(i-2,s-2,4,4);break}case"wheel":{const c=n*.1;e.beginPath(),e.arc(i,s,2.5,0,Math.PI*2),e.strokeStyle="#aabbccaa",e.lineWidth=.5,e.stroke();for(let l=0;l<4;l++){const d=c+l*Math.PI/2;e.beginPath(),e.moveTo(i,s),e.lineTo(i+Math.cos(d)*2.3,s+Math.sin(d)*2.3),e.strokeStyle="#aabbcc66",e.lineWidth=.3,e.stroke()}e.beginPath(),e.arc(i,s,.5,0,Math.PI*2),e.fillStyle="#aabbcccc",e.fill();break}default:e.beginPath(),e.arc(i,s,2,0,Math.PI*2),e.fillStyle=a+"88",e.fill()}e.restore()}const aw=64,Uh={attractor:"#c8960a",repulsor:"#3a7fa0",channel:"#c0c8d0",barrier:"#aa2020",tunnel:"#9966cc"},mr=aw;function GU(){return{C:new Float32Array(mr*mr),A:new Float32Array(mr*mr),S:new Float32Array(mr*mr)}}let Vb=null,fC=null,pC=null;function VU(){return Vb||(Vb=new Float32Array(mr*mr),fC=new Float32Array(mr*mr),pC=new Float32Array(mr*mr)),[Vb,fC,pC]}function UU(e,t){const n=Math.max(0,Math.min(mr-1,Math.floor(e*mr)));return Math.max(0,Math.min(mr-1,Math.floor(t*mr)))*mr+n}function wc(e,t,n){const r=t*(mr-1),a=n*(mr-1),i=Math.floor(r),s=Math.floor(a),c=r-i,l=a-s,d=Math.min(s,mr-1)*mr+Math.min(i,mr-1),u=Math.min(s,mr-1)*mr+Math.min(i+1,mr-1),h=Math.min(s+1,mr-1)*mr+Math.min(i,mr-1),m=Math.min(s+1,mr-1)*mr+Math.min(i+1,mr-1);return e[d]*(1-c)*(1-l)+e[u]*c*(1-l)+e[h]*(1-c)*l+e[m]*c*l}function mC(e,t,n,r,a,i,s){const c=UU(t,n);e.C[c]=Math.min(1,e.C[c]+r*s*.012),e.A[c]=Math.min(1,e.A[c]+a*s*.008),e.S[c]=Math.min(1,e.S[c]+i*s*.008)}function YU(e,t,n,r){const[a,i,s]=VU(),c=Math.min(.8,n.diffusion*t*12),l=n.decay*t*.8,d=n.globalMix*t*.04;let u=0,h=0,m=0;for(let f=0;f<mr*mr;f++)u+=e.C[f],h+=e.A[f],m+=e.S[f];u/=mr*mr,h/=mr*mr,m/=mr*mr;for(let f=0;f<mr;f++)for(let g=0;g<mr;g++){const x=f*mr+g,v=(f>0?f-1:f)*mr+g,b=(f<mr-1?f+1:f)*mr+g,w=f*mr+(g>0?g-1:g),M=f*mr+(g<mr-1?g+1:g),k=(e.C[v]+e.C[b]+e.C[w]+e.C[M])/4,R=(e.A[v]+e.A[b]+e.A[w]+e.A[M])/4,j=(e.S[v]+e.S[b]+e.S[w]+e.S[M])/4;if(a[x]=Math.max(0,(e.C[x]*(1-c)+k*c)*(1-l)+u*d),i[x]=Math.max(0,(e.A[x]*(1-c)+R*c)*(1-l)+h*d),s[x]=Math.max(0,(e.S[x]*(1-c)+j*c)*(1-l)+m*d),r){const I=(g/mr-.5)*2,E=(f/mr-.5)*2,O=I*I+E*E;if(O<.35){const L=t*.06*(1-O/.35),$=Math.min(s[x],L);s[x]-=$,i[x]=Math.min(1,i[x]+$*.7)}}}e.C.set(a),e.A.set(i),e.S.set(s)}function KU(e){let t=0,n=0,r=0;for(let l=0;l<mr*mr;l++)t+=e.C[l],n+=e.A[l],r+=e.S[l];const a=mr*mr,i=t/a,s=n/a,c=r/a;return{meanC:i,meanA:s,meanS:c,integration:Math.max(0,Math.min(1,s-c+.5)),tension:Math.min(1,c*4)}}const XU=["plumbum","sulphur","mercurius","sal","argentum","aurum"],pm={plumbum:{label:"Chumbo",latin:"Plumbum",color:"#7888a0",glowColor:"#5a6878",symbol:"",sizeBoost:1},sulphur:{label:"Enxofre",latin:"Sulphur",color:"#e0b800",glowColor:"#ffe040",symbol:"",sizeBoost:1.15},mercurius:{label:"Mercrio",latin:"Mercurius",color:"#60c8f0",glowColor:"#90e8ff",symbol:"",sizeBoost:.88},sal:{label:"Sal",latin:"Sal",color:"#c8d0e0",glowColor:"#e8f0ff",symbol:"",sizeBoost:1.05},argentum:{label:"Prata",latin:"Argentum",color:"#80acd8",glowColor:"#b0d8ff",symbol:"",sizeBoost:1.28},aurum:{label:"Ouro",latin:"Aurum",color:"#ffc107",glowColor:"#ffe566",symbol:"",sizeBoost:1.65}},mm=[{id:"calcinatio",from:"plumbum",to:"sulphur",operation:"Calcinatio",name:"Calcinao",path:"fire",conditions:[{type:"fire",min:.33,label:" Fogo >33%"},{type:"heat",min:.42,label:" Calor >42%"}],prob:.0014,hint:" Fogo +  Calor  o chumbo calcina em enxofre amarelo."},{id:"solutio",from:"plumbum",to:"mercurius",operation:"Solutio",name:"Dissoluo",path:"water",conditions:[{type:"water",min:.36,label:" gua >36%"},{type:"cool",max:.54,label:" Calor <54%"}],prob:.0014,hint:" gua +  Calor  o chumbo dissolve em mercrio fluido."},{id:"coagulatio",from:"sulphur",to:"sal",operation:"Coagulatio",name:"Coagulao",path:"earth",conditions:[{type:"earth",min:.28,label:" Terra >28%"},{type:"cool",max:.68,label:" Calor <68%"}],prob:.0012,hint:" Terra +  Calor  o enxofre cristaliza em sal."},{id:"sublimatio",from:"mercurius",to:"sal",operation:"Sublimatio",name:"Sublimao",path:"air",conditions:[{type:"air",min:.3,label:" Ar >30%"},{type:"coherence",min:.42,label:"Coerncia >42%"}],prob:.0012,hint:" Ar  partculas coerentes sublimam de mercrio para sal."},{id:"fermentatio",from:"sal",to:"argentum",operation:"Fermentatio",name:"Fermentao",path:"earth",conditions:[{type:"balance",min:.25,label:" Elementos ~25% cada"},{type:"coherence",min:.5,label:"Coerncia >50%"},{type:"heat",min:.28,max:.78,label:" Calor 28-78%"}],prob:.001,hint:" Equilibre os 4 elementos (~25% cada) + calor moderado. Sal fermenta em Prata."},{id:"coniunctio",from:"sulphur",to:"argentum",operation:"Coniunctio",name:"Conjuno",path:"conjunction",conditions:[{type:"conjunction",label:" Enxofre + Mercrio juntos"},{type:"heat",min:.33,max:.72,label:" Calor 33-72%"}],prob:9e-4,hint:" Segredo descoberto: ter Enxofre E Mercrio juntos desencadeia a Conjuno  as Bodas Qumicas!",secret:!0},{id:"projectio",from:"argentum",to:"aurum",operation:"Projectio",name:"Projeo",path:"final",conditions:[{type:"lapis_forged",label:" Lapis Forjado"},{type:"heat",min:.58,label:" Calor >58%"},{type:"pulse_any",label:"COAGULA / SOLVE"}],prob:.0016,hint:" Forge o Lapis (alta integrao),  Calor e pressione COAGULA para a Projeo Final!"}];function g6(e){const t=Math.max(Math.abs(e.earth-.25),Math.abs(e.water-.25),Math.abs(e.air-.25),Math.abs(e.fire-.25));return Math.max(0,1-t*4)}function JU(e,t,n,r,a,i,s){const c=(()=>{switch(e.type){case"fire":return t.fire;case"water":return t.water;case"earth":return t.earth;case"air":return t.air;case"heat":return n;case"cool":return 1-n;case"balance":return g6(t);case"coherence":return i;case"lapis_forged":return r==="FORGED"?1:0;case"conjunction":return s?1:0;case"pulse_any":return a==="COAGULA"||a==="SOLVE"?1:.2;default:return 0}})(),l=e.min??0,d=e.max??1;return e.type==="lapis_forged"||e.type==="conjunction"||e.type==="pulse_any"?c:e.min!=null&&e.max!=null?c<l?Math.max(0,c/l):c>d?Math.max(0,1-(c-d)/(1-d)):1:e.min!=null?c>=l?1:Math.max(0,c/l):e.max!=null?c<=d?1:Math.max(0,1-(c-d)/(1-d)):1}function zv(e,t,n,r,a,i,s){let c=1;for(const l of e.conditions)c*=JU(l,t,n,r,a,i,s);return c}function QU(e,t,n,r,a,i,s,c){const l=Math.random();for(const d of mm){if(d.from!==e||d.id==="coniunctio"&&!c)continue;const u=zv(d,r,a,i,s,n,c);if(u<=0)continue;const h=d.prob*u*(t*.5+.5);if(l<h)return d.to}if(e==="mercurius"&&c){const d=mm.find(h=>h.id==="coniunctio"),u=zv(d,r,a,i,s,n,c);if(u>0){const h=d.prob*u*(t*.5+.5);if(Math.random()<h)return"argentum"}}switch(e){case"sulphur":if(a>.9&&r.air>.4&&Math.random()<6e-4)return"plumbum";break;case"mercurius":if(a>.88&&Math.random()<5e-4)return"plumbum";break;case"argentum":if(a<.18&&n<.25&&Math.random()<4e-4)return"sal";break;case"aurum":if(a>.97&&Math.random()<3e-5)return"argentum";break}return null}const ZU=[{id:"discover_sulphur",recipeId:"calcinatio",name:"Primeira Fasca",substance:"sulphur",threshold:1,hint:"Crie sua primeira partcula de Enxofre."},{id:"discover_mercury",recipeId:"solutio",name:"Primeira Gota",substance:"mercurius",threshold:1,hint:"Crie sua primeira partcula de Mercrio."},{id:"discover_sal",recipeId:"coagulatio",name:"Primeiro Cristal",substance:"sal",threshold:1,hint:"Cristalize Sal pela primeira vez."},{id:"discover_argentum",recipeId:"fermentatio",name:"Primeiro Brilho",substance:"argentum",threshold:1,hint:"Produza sua primeira Prata."},{id:"discover_aurum",recipeId:"projectio",name:" Grande Obra",substance:"aurum",threshold:1,hint:"Transmute Prata em Ouro. O Magistrio est completo."}];function y6(){const e=()=>({plumbum:0,sulphur:0,mercurius:0,sal:0,argentum:0,aurum:0});return{counts:e(),produced:e(),flashes:[],completedQuestIds:[],bannerLife:0,bannerText:"",bannerSubstance:null,conjunctionActive:!1,conjunctionDiscovered:!1}}function eY(e,t,n,r,a){e.produced[r]++,e.flashes.length<25&&e.flashes.push({x:t,y:n,substance:r,life:1}),a==="coniunctio"&&!e.conjunctionDiscovered&&(e.conjunctionDiscovered=!0)}function tY(e,t,n){const r={plumbum:0,sulphur:0,mercurius:0,sal:0,argentum:0,aurum:0};for(const a of t)r[a]++;e.counts=r,e.conjunctionActive=r.sulphur>=3&&r.mercurius>=3;for(let a=e.flashes.length-1;a>=0;a--)e.flashes[a].life-=n*1.5,e.flashes[a].life<=0&&e.flashes.splice(a,1);e.bannerLife>0&&(e.bannerLife-=n);for(const a of ZU)e.completedQuestIds.includes(a.id)||(e.produced[a.substance]??0)>=a.threshold&&(e.completedQuestIds.push(a.id),pm[a.substance],e.bannerLife=5,e.bannerText=a.name,e.bannerSubstance=a.substance)}const ec=()=>Math.random(),ju=()=>(Math.random()-.5)*2;function nY(e,t,n,r){let a={...e};if(n==="SOLVE"){const c=r;a={earth:a.earth*(1-c*.5),water:Math.min(1,a.water+c*.25),air:Math.min(1,a.air+c*.25),fire:a.fire}}else if(n==="COAGULA"){const c=r;a={earth:Math.min(1,a.earth+c*.3),water:a.water*(1-c*.4),air:a.air*(1-c*.2),fire:Math.min(1,a.fire+c*.15)}}const i=a.earth+a.water+a.air+a.fire;i>0&&(a.earth/=i,a.water/=i,a.air/=i,a.fire/=i);const s=t;return{diffusion:.05+a.water*.4+a.air*.15,decay:.015+a.fire*.04-a.water*.01,globalMix:.02+a.air*.12,writeGain:.5+a.fire*1.2+s*.5,cohesion:.05+a.earth*.25,maxSpeed:.012+a.fire*.022+s*.018-a.earth*.008,springStr:.05+a.earth*.25-a.water*.04,mutationRate:.02+a.fire*.15+s*.12,thresholds:.35+a.earth*.25-a.fire*.15,breathStr:.008+a.water*.022,heat:s,transformRate:s*.15+a.fire*.08,tunnelProb:0}}function rY(e,t,n){const a=Math.cos(t*3.5+n*.15)*.5+Math.cos(e*3.5*.6+n*.28)*.5,i=Math.sin(e*3.5+n*.15)*.5+Math.sin(t*3.5*.6+n*.28)*.5;return[a,i]}function oY(e,t,n,r,a,i){const s=a-n,c=i-r,l=s*s+c*c;let d=l<1e-10?0:Math.max(0,Math.min(1,((e-n)*s+(t-r)*c)/l));const u=n+d*s,h=r+d*c,m=e-u,f=t-h;return{dist:Math.sqrt(m*m+f*f),closest:[u,h],t:d}}function aY(e,t,n,r,a,i,s,c){const l=n-e,d=r-t,u=s-a,h=c-i,m=l*h-d*u;if(Math.abs(m)<1e-10)return!1;const f=((a-e)*h-(i-t)*u)/m,g=((a-e)*d-(i-t)*l)/m;return f>=0&&f<=1&&g>=0&&g<=1}function sY(e,t,n,r,a,i){let s=0,c=0,l=!1,d=null;for(const u of r){if(!u.active)continue;const{dist:h,closest:m}=oY(e.x,e.y,u.x1,u.y1,u.x2,u.y2),[f,g]=m;switch(u.type){case"attractor":{const x=.12+u.strength*.12;if(h<x&&h>.001){const v=u.strength*(1-h/x)*.06;s+=(f-e.x)/h*v,c+=(g-e.y)/h*v}break}case"repulsor":{const x=.1+u.strength*.1;if(h<x&&h>.001){const v=u.strength*(1-h/x)*.08;s-=(f-e.x)/h*v,c-=(g-e.y)/h*v}break}case"channel":{const x=.08+u.strength*.08;if(h<x){const v=u.x2-u.x1,b=u.y2-u.y1,w=Math.sqrt(v*v+b*b)+.001,M=v/w,k=b/w,R=u.strength*(1-h/x);s+=M*R*.06,c+=k*R*.06,d=[M,k]}break}case"barrier":{const x=.025+u.strength*.01;if(h<x&&h>5e-4){const v=u.strength*(1-h/x)*.15;s-=(f-e.x)/h*v,c-=(g-e.y)/h*v}if(aY(e.x,e.y,t,n,u.x1,u.y1,u.x2,u.y2)){const v=1+a*2,b=e.charge*.15*v;if(Math.random()<b)l=!0,e.tunneling=!0;else{const w=u.x2-u.x1,M=u.y2-u.y1,k=Math.sqrt(w*w+M*M)+.001,R=M/k,j=-w/k,I=e.vx*R+e.vy*j;s-=R*I*2/i*.4,c-=j*I*2/i*.4}}break}case"tunnel":{const x=.1+u.strength*.1;if(h<x){const v=u.strength*(1-h/x);e.coherence=Math.min(1,e.coherence+v*i*.8),e.charge=Math.min(1,e.charge+v*i*.4),e.tunneling=Math.random()<v*.25}break}}}return{fx:s,fy:c,tunneled:l,channelDir:d}}function iY(e,t){const n=ec();let r;const{earth:a,water:i,air:s}=t;return n<a?r="earth":n<a+i?r="water":n<a+i+s?r="air":r="fire",{id:e,element:r,substance:"plumbum",x:.15+ec()*.7,y:.15+ec()*.7,vx:ju()*.004,vy:ju()*.004,charge:.1+ec()*.6,coherence:.2+ec()*.5,valence:ju()*.5,phase:ec(),age:0,linkId:-1,linkTtl:0,tunneling:!1}}function gC(e,t,n){const r=[];for(let a=0;a<e;a++)r.push(iY(a,t));return{agents:r,count:e,field:GU(),metrics:{integrationIndex:.5,tensionIndex:.1,noveltyIndex:.3,lapisCharge:0,meanCharge:.3},lapis:{state:"DORMANT",charge:0,forgeTimer:0,crackRisk:0},elapsed:0,tick:0,pulse:{op:"NONE",strength:0,duration:0,maxDur:0},activeEvent:null,eventTimer:0,breathPhase:0,elements:{...t},heat:n,transmutation:y6()}}const ws=12;let Fp=[];function lY(e,t){if(Fp.length<ws*ws)Fp=Array.from({length:ws*ws},()=>[]);else for(let n=0;n<ws*ws;n++)Fp[n].length=0;for(let n=0;n<t;n++){const r=e[n],a=Math.max(0,Math.min(ws-1,Math.floor(r.x*ws))),i=Math.max(0,Math.min(ws-1,Math.floor(r.y*ws)));Fp[i*ws+a].push(n)}}function yC(e,t){const n=Math.max(0,Math.min(ws-1,Math.floor(e*ws))),r=Math.max(0,Math.min(ws-1,Math.floor(t*ws))),a=[];for(let i=-1;i<=1;i++)for(let s=-1;s<=1;s++){const c=n+s,l=r+i;c>=0&&c<ws&&l>=0&&l<ws&&a.push(...Fp[l*ws+c])}return a}let bC=.5;function cY(e,t,n){if(t<=0||t>.1)return;e.elapsed+=t,e.tick++;const{agents:r,count:a,field:i}=e,s=nY(e.elements,e.heat,e.pulse.op,e.pulse.strength);e.breathPhase=e.elapsed/15%1,e.pulse.op!=="NONE"&&(e.pulse.duration-=t,e.pulse.strength=Math.max(0,e.pulse.duration/e.pulse.maxDur),e.pulse.duration<=0&&(e.pulse={op:"NONE",strength:0,duration:0,maxDur:0})),lY(r,a);for(let c=0;c<a;c++){const l=r[c];l.age+=t,l.tunneling=!1,l.linkTtl>0?l.linkTtl-=t:(l.linkId=-1,l.linkTtl=0),l.phase=(l.phase+t*.067)%1;let d=0,u=0;const[h,m]=rY(l.x,l.y,e.elapsed);d+=h*.0025,u+=m*.0025;const f=Math.sin(e.breathPhase*Math.PI*2),g=l.x-.5,x=l.y-.5,v=Math.sqrt(g*g+x*x)+.001,b=-f*s.breathStr;d+=g/v*b,u+=x/v*b;const w=wc(i.A,l.x,l.y),M=wc(i.S,l.x,l.y),k=1.5/aw,R=(wc(i.A,l.x+k,l.y)-wc(i.A,l.x-k,l.y))/(2*k),j=(wc(i.A,l.x,l.y+k)-wc(i.A,l.x,l.y-k))/(2*k),I=(wc(i.S,l.x+k,l.y)-wc(i.S,l.x-k,l.y))/(2*k),E=(wc(i.S,l.x,l.y+k)-wc(i.S,l.x,l.y-k))/(2*k);switch(d+=R*Math.min(w,1)*s.cohesion*.15-I*Math.min(M,1)*.12,u+=j*Math.min(w,1)*s.cohesion*.15-E*Math.min(M,1)*.12,l.element){case"earth":d+=(.5-l.x)*s.cohesion*.015,u+=(.5-l.y)*s.cohesion*.015;break;case"air":d+=ju()*.005,u+=ju()*.005;break;case"fire":d+=ju()*.008,u+=ju()*.008;break}if(l.linkId>=0&&l.linkId<a){const B=r[l.linkId],W=B.x-l.x,re=B.y-l.y,oe=Math.sqrt(W*W+re*re)+.001,te=(oe-.06)*s.springStr;d+=W/oe*te,u+=re/oe*te}if(s.cohesion>.1){const B=yC(l.x,l.y);let W=0,re=0,oe=0;for(const te of B){if(te===c)continue;const J=r[te],pe=J.x-l.x,P=J.y-l.y,V=pe*pe+P*P;if(V<.008&&J.element===l.element&&(W+=J.x,re+=J.y,oe++,V<.0012)){const fe=Math.sqrt(V)+.001;d-=pe/fe*.012,u-=P/fe*.012}}oe>0&&(d+=(W/oe-l.x)*s.cohesion*.08,u+=(re/oe-l.y)*s.cohesion*.08)}const O=Math.pow(.92,t*60);l.vx=(l.vx+d)*O,l.vy=(l.vy+u)*O;const L=Math.sqrt(l.vx*l.vx+l.vy*l.vy);L>s.maxSpeed&&(l.vx=l.vx/L*s.maxSpeed,l.vy=l.vy/L*s.maxSpeed);const $=l.x+l.vx*t*45,F=l.y+l.vy*t*45;if(n.length>0){const B=sY(l,$,F,n,e.lapis.charge,t);if(l.vx+=B.fx,l.vy+=B.fy,B.tunneled&&(l.tunneling=!0),B.channelDir){const[W,re]=B.channelDir,oe=Math.sqrt(l.vx*l.vx+l.vy*l.vy);l.vx+=W*oe*.15,l.vy+=re*oe*.15}}l.x=l.x+l.vx*t*45,l.y=l.y+l.vy*t*45,l.x<.05&&(l.x=.05,l.vx*=-.5),l.x>.95&&(l.x=.95,l.vx*=-.5),l.y<.05&&(l.y=.05,l.vy*=-.5),l.y>.95&&(l.y=.95,l.vy*=-.5),l.charge=Math.max(0,Math.min(1,l.charge+(w-M)*t*.15)),l.coherence=Math.max(0,Math.min(1,l.coherence+(w-M-.1)*t*.08)),l.valence=Math.max(-1,Math.min(1,l.valence+(w-M)*t*.05))}if(e.tick%6===0){const c=s.thresholds*s.thresholds*.006;for(let l=0;l<a;l++){const d=r[l];if(d.linkId>=0)continue;const u=yC(d.x,d.y);for(const h of u){if(h<=l)continue;const m=r[h];if(m.linkId>=0)continue;const f=d.x-m.x,g=d.y-m.y;if(f*f+g*g>c)continue;const x=1-Math.abs(d.charge-m.charge);x>s.thresholds*.8&&ec()<s.springStr*.3&&(d.linkId=h,d.linkTtl=2+ec()*4,m.linkId=l,m.linkTtl=d.linkTtl,mC(i,(d.x+m.x)*.5,(d.y+m.y)*.5,0,x,0,s.writeGain));break}}}if(e.tick%3===0)for(let c=0;c<a;c++){const l=r[c],d=l.tunneling?.5:0,u=Math.max(0,l.valence<0?-l.valence:0)+(1-l.coherence)*.4+d*.3,h=Math.max(0,l.valence)*l.coherence+(l.tunneling?.2:0);mC(i,l.x,l.y,l.charge,h,u,s.writeGain)}if(e.tick%2===0&&YU(i,t*2,s,e.lapis.state==="FORGED"),e.tick%10===0){const c=KU(i),l=Math.min(1,Math.abs(c.integration-bC)*25);bC=c.integration,e.metrics={integrationIndex:c.integration,tensionIndex:c.tension,noveltyIndex:l,lapisCharge:e.lapis.charge,meanCharge:c.meanC}}if(dY(e,t),uY(e,t,s),s.mutationRate>.08&&e.tick%30===0){const c=Math.ceil(a*s.mutationRate*.06);for(let l=0;l<c;l++){const d=Math.floor(ec()*a),u=r[d],h=ec();h<.25?u.element="earth":h<.5?u.element="water":h<.75?u.element="air":u.element="fire"}}if(e.tick%8===0){const{elements:c,heat:l,lapis:d,pulse:u,transmutation:h}=e;let m=0,f=0;for(let x=0;x<a;x++)r[x].substance==="sulphur"&&m++,r[x].substance==="mercurius"&&f++;const g=m>=3&&f>=3;for(let x=0;x<a;x++){const v=r[x],b=QU(v.substance,v.charge,v.coherence,c,l,d.state,u.op,g);if(b!==null){const w=b==="argentum"&&g&&(v.substance==="sulphur"||v.substance==="mercurius")?"coniunctio":"generic";v.substance=b,eY(h,v.x,v.y,b,w)}}}tY(e.transmutation,e.agents.map(c=>c.substance),t)}function dY(e,t,n){const r=e.metrics,a=e.lapis,i=e.heat;switch(a.crackRisk+=t*((i>.7?(i-.7)*.3:0)+(e.activeEvent==="BURNOUT"?.05:0)),a.crackRisk=Math.max(0,Math.min(1,a.crackRisk-t*.02)),a.state){case"DORMANT":a.charge+=t*r.integrationIndex*.04,a.charge=Math.min(.4,a.charge),a.charge>.25&&r.integrationIndex>.6&&(a.state="FORMING",a.forgeTimer=0);break;case"FORMING":a.forgeTimer+=t,a.charge+=t*r.integrationIndex*.06-t*r.tensionIndex*.04,a.charge=Math.max(.2,Math.min(.85,a.charge)),a.charge>.7&&a.forgeTimer>15&&r.integrationIndex>.65&&(a.state="FORGED"),a.crackRisk>.75&&(a.state="CRACKED",a.charge*=.5);break;case"FORGED":a.charge+=t*(r.integrationIndex-.5)*.04,a.charge=Math.max(.4,Math.min(1,a.charge)),(a.crackRisk>.85||e.activeEvent==="BURNOUT")&&(a.state="CRACKED",a.charge*=.4);break;case"CRACKED":a.charge+=t*(r.integrationIndex-.5)*.025,a.charge=Math.max(.05,Math.min(.5,a.charge)),a.crackRisk-=t*.04,a.crackRisk<=0&&a.charge>.3&&r.integrationIndex>.6&&(a.state="FORMING",a.forgeTimer=0);break}e.metrics.lapisCharge=a.charge}function uY(e,t,n){if(e.activeEvent){e.eventTimer+=t,e.eventTimer>4&&(e.activeEvent=null,e.eventTimer=0);return}const r=e.metrics,a=e.heat;if(n.writeGain>1.6&&a>.7&&r.tensionIndex>.65){e.activeEvent="BURNOUT",e.eventTimer=0;for(let i=0;i<Math.ceil(e.count*.15);i++){const s=e.agents[Math.floor(ec()*e.count)];s.valence=-.5,s.coherence=Math.max(0,s.coherence-.3)}return}if(n.cohesion>.25&&r.noveltyIndex<.05&&e.elapsed>20){e.activeEvent="CRYSTALLIZATION",e.eventTimer=0;return}if(n.diffusion>.38&&r.integrationIndex<.3){e.activeEvent="DISSOLUTION",e.eventTimer=0;for(const i of e.agents)i.linkId=-1,i.linkTtl=0;return}n.globalMix>.1&&r.integrationIndex<.35&&r.noveltyIndex>.6&&(e.activeEvent="NOISE",e.eventTimer=0)}function Mc(e,t){if(e.pulse.op!=="NONE")return;const n=3.5;e.pulse={op:t,strength:1,duration:n,maxDur:n};const r=e.field,a=r.C.length;if(t==="SOLVE")for(let i=0;i<a;i++)r.S[i]=Math.min(1,r.S[i]+.08);else for(let i=0;i<a;i++)r.A[i]=Math.min(1,r.A[i]+.1)}const mp=aw,Eh={earth:"#8b7a55",water:"#3a7fa0",air:"#90b0c0",fire:"#c8561e"},hY={NIGREDO:"rgba(0,0,0,0.25)",ALBEDO:"rgba(180,190,220,0.055)",CITRINITAS:"rgba(200,160,0,0.055)",RUBEDO:"rgba(160,0,0,0.07)"},Th="rgba(200,150,12,";function Ub(e,t){const n=parseInt(e.slice(1,3),16),r=parseInt(e.slice(3,5),16),a=parseInt(e.slice(5,7),16);return`rgba(${n},${r},${a},${t.toFixed(3)})`}function rf(e,t){return e*t}function of(e,t){return e*t}function fY(e,t,n,r,a){if(t.length!==0){e.save(),e.lineCap="round";for(const i of t){if(!i.active)continue;const s=rf(i.x1,n),c=of(i.y1,r),l=rf(i.x2,n),d=of(i.y2,r),u=Uh[i.type],h=i.type==="tunnel"?.5+.5*Math.sin(a*4):i.type==="channel"?.5+.5*Math.sin(a*2.5):1;if(e.strokeStyle=u,e.lineWidth=8*i.strength,e.globalAlpha=.08*h,e.beginPath(),e.moveTo(s,c),e.lineTo(l,d),e.stroke(),e.lineWidth=1.5+i.strength,e.globalAlpha=.6*h,e.beginPath(),e.moveTo(s,c),e.lineTo(l,d),e.stroke(),i.type==="channel"){const m=(s+l)/2,f=(c+d)/2,g=l-s,x=d-c,v=Math.sqrt(g*g+x*x)+.001,b=g/v,w=x/v,M=14;e.globalAlpha=.8,e.fillStyle=u,e.beginPath(),e.moveTo(m+b*M,f+w*M),e.lineTo(m-w*6,f+b*6),e.lineTo(m+w*6,f-b*6),e.closePath(),e.fill()}if(i.type==="tunnel"){const m=Math.floor(i.strength*8+2);for(let f=0;f<m;f++){const g=(f/m+a*.3)%1,x=s+g*(l-s),v=c+g*(d-c);e.globalAlpha=.6*(.5+.5*Math.sin(a*6+f)),e.fillStyle=u,e.beginPath(),e.arc(x,v,1.5,0,Math.PI*2),e.fill()}}e.globalAlpha=.5,e.fillStyle=u,e.beginPath(),e.arc(s,c,3,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(l,d,3,0,Math.PI*2),e.fill(),i.label&&(e.font="7px monospace",e.textAlign="center",e.textBaseline="bottom",e.fillStyle=u,e.globalAlpha=.6,e.fillText(i.label,(s+l)/2,Math.min(c,d)-3))}e.restore()}}function pY(e,t,n,r,a){if(!t.active)return;const i=t.steps,s=i.length,c=22,l=r-52-c,d=Math.min(28,n*.6/s),u=d*s,h=(n-u)/2;e.save(),e.fillStyle="rgba(0,0,0,0.55)",e.strokeStyle="rgba(200,150,12,0.15)",e.lineWidth=1;const m=h-4,f=u+8;e.beginPath(),e.roundRect(m,l,f,c,4),e.fill(),e.stroke();for(let g=0;g<s;g++){const x=i[g],v=h+g*d+d/2,b=l+c/2,w=g===t.cursor,M=g===t.superStep,k=i.some((E,O)=>E.entangled===g&&O===t.cursor),R=x.active;let j="rgba(255,255,255,0.03)";if(w&&(j="rgba(200,150,12,0.18)"),M&&(j="rgba(160,90,220,0.15)"),e.fillStyle=j,e.beginPath(),e.roundRect(h+g*d+1,l+2,d-2,c-4,3),e.fill(),t.quantum&&R){const E=(c-8)*x.probability;e.fillStyle="rgba(200,150,12,0.25)",e.fillRect(h+g*d+2,l+c-4-E,d-4,E)}const I=R?w?"#f0c040":M?"#cc88ff":k?"#88ccff":"rgba(255,255,255,.45)":"rgba(255,255,255,.15)";if(e.font=`${w?8:7}px monospace`,e.textAlign="center",e.textBaseline="middle",e.fillStyle=I,e.globalAlpha=R?1:.35,e.fillText(x.label,v,b),x.op!=="NONE"&&(e.font="5px monospace",e.fillStyle=x.op==="SOLVE"?"#3a7fa0":"#c8960a",e.fillText(x.op==="SOLVE"?"":"",v,l+c-3)),w){const E=.5+.5*Math.sin(a*8);e.fillStyle=`rgba(240,192,64,${.6+E*.4})`,e.fillRect(v-1,l,2,2)}M&&(e.strokeStyle=`rgba(160,90,220,${t.superWeight*.8})`,e.lineWidth=1,e.globalAlpha=1,e.beginPath(),e.moveTo(h+g*d+2,l+2),e.lineTo(h+g*d+2,l+c-2),e.stroke()),e.globalAlpha=1}e.font="6px monospace",e.textAlign="right",e.textBaseline="middle",e.fillStyle="rgba(200,150,12,0.4)",e.fillText(`${t.bpm}bpm${t.quantum?" ":""}`,h+u+2,l+c/2),e.restore()}function mY(e,t,n,r,a,i,s,c=1,l=0,d=0){var L;const u=Math.min(window.devicePixelRatio||1,1.5),h=e.clientWidth,m=e.clientHeight;(e.width!==Math.round(h*u)||e.height!==Math.round(m*u))&&(e.width=Math.round(h*u),e.height=Math.round(m*u));const f=e.getContext("2d");f.setTransform(u,0,0,u,0,0),f.fillStyle="#08060a",f.fillRect(0,0,h,m);const g=t.heat,x=f.createRadialGradient(h/2,m/2,0,h/2,m/2,Math.max(h,m)*.6);x.addColorStop(0,`rgba(${Math.round(g*80)},${Math.round(g*40)},5,${.03+g*.08})`),x.addColorStop(.6,"rgba(20,10,5,0.03)"),x.addColorStop(1,"rgba(0,0,0,0)"),f.fillStyle=x,f.fillRect(0,0,h,m),r&&(f.fillStyle=hY[r],f.fillRect(0,0,h,m)),f.save(),f.translate(h/2+l,m/2+d),f.scale(c,c),f.translate(-h/2,-m/2),(n==="FIELD"||n==="LAPIS")&&gY(f,t.field,h,m,n==="LAPIS"?t.lapis.charge:1);const v=h/2,b=m/2,w=Math.min(h,m)*.42,M=n==="FIELD"?.25:.55;f.save(),f.lineCap="round",f.lineJoin="round";const k=1+a*.012;f.strokeStyle=Th+M+")",f.lineWidth=.8,f.beginPath(),f.arc(v,b,w*k,0,Math.PI*2),f.stroke(),f.strokeStyle=Th+M*.4+")",f.lineWidth=.4,f.beginPath(),f.arc(v,b,w*.95*k,0,Math.PI*2),f.stroke(),f.strokeStyle=Th+M*.7+")",f.lineWidth=.7,f.beginPath();for(let $=0;$<4;$++){const F=$*Math.PI/2+Math.PI/4,B=v+w*Math.cos(F),W=b+w*Math.sin(F);$===0?f.moveTo(B,W):f.lineTo(B,W)}f.closePath(),f.stroke(),f.strokeStyle=Th+M*.6+")",f.lineWidth=.7,f.beginPath();for(let $=0;$<3;$++){const F=$*Math.PI*2/3-Math.PI/2,B=v+w*Math.cos(F),W=b+w*Math.sin(F);$===0?f.moveTo(B,W):f.lineTo(B,W)}f.closePath(),f.stroke();const R=w*.12,j=t.lapis,I=j.state==="FORGED"?`rgba(255,215,0,${M*1.2})`:j.state==="CRACKED"?`rgba(180,50,0,${M*.9})`:j.state==="FORMING"?`rgba(200,160,50,${M})`:Th+M*.5+")";f.strokeStyle=I,f.lineWidth=j.state==="FORGED"?1.5:.7,f.beginPath(),f.arc(v,b,R,0,Math.PI*2),f.stroke(),f.strokeStyle=Th+M*.5+")",f.lineWidth=.5;const E=R*1.8;if(f.beginPath(),f.moveTo(v-E,b),f.lineTo(v+E,b),f.moveTo(v,b-E),f.lineTo(v,b+E),f.stroke(),j.state==="FORGED"||j.state==="FORMING"){const $=t.elapsed,F=.5+.5*Math.sin($*1.8),B=R*(2.5+F*1.5),W=f.createRadialGradient(v,b,0,v,b,B);W.addColorStop(0,`rgba(255,215,0,${j.state==="FORGED"?.18*F:.08*F})`),W.addColorStop(1,"rgba(255,215,0,0)"),f.fillStyle=W,f.beginPath(),f.arc(v,b,B,0,Math.PI*2),f.fill()}if(j.state==="CRACKED"){f.strokeStyle="rgba(200,50,0,0.4)",f.lineWidth=.6;for(let $=0;$<4;$++){const F=$*Math.PI/2+.3;f.beginPath(),f.moveTo(v,b),f.lineTo(v+Math.cos(F)*R*2.5,b+Math.sin(F)*R*2.5),f.stroke()}}if(n!=="FIELD"){const $=w*1.08,F=[{a:-Math.PI/2,s:"",color:Eh.fire},{a:Math.PI/6,s:"",color:Eh.water},{a:Math.PI*5/6,s:"",color:Eh.earth}];f.font=`${Math.round(w*.065)}px serif`,f.textAlign="center",f.textBaseline="middle";for(const B of F){const W=v+Math.cos(B.a)*$,re=b+Math.sin(B.a)*$;f.globalAlpha=M*.55,f.fillStyle=B.color,f.fillText(B.s,W,re)}f.globalAlpha=1}if(f.restore(),n!=="FIELD"){f.save(),f.lineCap="round";for(let $=0;$<t.count;$++){const F=t.agents[$];if(F.linkId<0||F.linkId>=t.count||F.linkId<=$)continue;const B=t.agents[F.linkId],W=F.linkTtl/6;f.globalAlpha=.12+W*.15,f.strokeStyle=Eh[F.element],f.lineWidth=.5+F.coherence*.6,f.beginPath(),f.moveTo(rf(F.x,h),of(F.y,m)),f.lineTo(rf(B.x,h),of(B.y,m)),f.stroke()}f.restore()}f.save();for(let $=0;$<t.count;$++){const F=t.agents[$],B=rf(F.x,h),W=of(F.y,m),re=F.substance??"plumbum",oe=pm[re],te=re==="plumbum"?Eh[F.element]:oe.color,J=re==="plumbum"?Eh[F.element]:oe.glowColor,pe=oe.sizeBoost;let P,V;switch(n){case"FIELD":case"SIGIL":P=(1.5+F.charge*1.8)*pe,V=.4+F.coherence*.5;break;case"EVENTS":P=(1.8+F.charge*2)*pe,V=.5+F.coherence*.5;break;case"LAPIS":P=(1.5+t.lapis.charge*2.5*F.charge)*pe,V=.35+t.lapis.charge*.55;break;default:P=(1.5+F.charge*1.8)*pe,V=.4+F.coherence*.5}if(re==="aurum"){const fe=.6+.4*Math.sin(t.elapsed*2.5+F.phase*Math.PI*2),ye=f.createRadialGradient(B,W,0,B,W,P*5);ye.addColorStop(0,`rgba(255,200,40,${.3*fe})`),ye.addColorStop(.4,`rgba(255,160,0,${.15*fe})`),ye.addColorStop(1,"rgba(255,140,0,0)"),f.fillStyle=ye,f.globalAlpha=V,f.beginPath(),f.arc(B,W,P*5,0,Math.PI*2),f.fill(),f.strokeStyle=`rgba(255,215,64,${.5*fe})`,f.lineWidth=.8,f.globalAlpha=.6*fe,f.beginPath(),f.arc(B,W,P*3.2,0,Math.PI*2),f.stroke()}if(re==="argentum"){const fe=f.createRadialGradient(B,W,0,B,W,P*3.5);fe.addColorStop(0,"rgba(180,210,255,0.18)"),fe.addColorStop(1,"rgba(150,180,220,0)"),f.fillStyle=fe,f.globalAlpha=V*.8,f.beginPath(),f.arc(B,W,P*3.5,0,Math.PI*2),f.fill()}if(re==="sulphur"){const fe=.7+.3*Math.sin(t.elapsed*8+F.phase*Math.PI*4);f.globalAlpha=V*.15*fe,f.fillStyle=oe.glowColor,f.beginPath(),f.arc(B,W,P*3,0,Math.PI*2),f.fill()}if(re==="mercurius"&&(f.globalAlpha=V*.12,f.fillStyle=oe.glowColor,f.beginPath(),f.arc(B,W,P*2.8,0,Math.PI*2),f.fill()),f.globalAlpha=V*.22,f.fillStyle=J,f.beginPath(),f.arc(B,W,P*2.5,0,Math.PI*2),f.fill(),f.globalAlpha=V,f.fillStyle=te,f.beginPath(),f.arc(B,W,P*.6,0,Math.PI*2),f.fill(),re==="sal"&&(f.strokeStyle=`rgba(220,228,248,${V*.6})`,f.lineWidth=.5,f.globalAlpha=V*.5,f.beginPath(),f.arc(B,W,P*1.1,0,Math.PI*2),f.stroke()),n==="LAPIS"&&t.lapis.state==="FORGED"){const fe=f.createRadialGradient(B,W,0,B,W,P*4);fe.addColorStop(0,"rgba(255,215,0,0.12)"),fe.addColorStop(1,"rgba(255,215,0,0)"),f.fillStyle=fe,f.globalAlpha=1,f.beginPath(),f.arc(B,W,P*4,0,Math.PI*2),f.fill()}f.globalAlpha=1}const O=((L=t.transmutation)==null?void 0:L.flashes)??[];for(const $ of O){if($.life<=0)continue;const F=pm[$.substance],B=rf($.x,h),W=of($.y,m),re=$.life*20,oe=$.life*.9,te=f.createRadialGradient(B,W,0,B,W,re);te.addColorStop(0,Ub(F.glowColor,oe)),te.addColorStop(.4,Ub(F.color,oe*.45)),te.addColorStop(1,"rgba(0,0,0,0)"),f.fillStyle=te,f.globalAlpha=1,f.beginPath(),f.arc(B,W,re,0,Math.PI*2),f.fill(),f.strokeStyle=Ub(F.glowColor,$.life*.55),f.lineWidth=.9*$.life,f.beginPath(),f.arc(B,W,re*1.5,0,Math.PI*2),f.stroke(),f.globalAlpha=1}if(f.restore(),fY(f,i,h,m,t.elapsed),f.restore(),t.activeEvent){const F={BURNOUT:"rgba(255,60,0,",CRYSTALLIZATION:"rgba(180,160,80,",DISSOLUTION:"rgba(40,120,200,",NOISE:"rgba(200,200,255,"}[t.activeEvent]??"rgba(200,200,200,",B=t.eventTimer,W=Math.max(0,.15-B*.04);W>0&&(f.fillStyle=F+W+")",f.fillRect(0,0,h,m)),f.save(),f.textAlign="center",f.textBaseline="top",f.font=`${Math.max(10,h*.013)}px monospace`,f.fillStyle=F+Math.max(0,.8-B*.25)+")",f.fillText(` ${t.activeEvent}`,h/2,m*.08),f.restore()}yY(f,t,h,m,r),bY(f,t,h,m),pY(f,s,h,m,t.elapsed)}function gY(e,t,n,r,a){const i=n/mp,s=r/mp;e.save();for(let c=0;c<mp;c++)for(let l=0;l<mp;l++){const d=c*mp+l,u=t.C[d],h=t.A[d],m=t.S[d];if(u<.005&&h<.005&&m<.005)continue;const f=l*i,g=c*s;u>.01&&(e.fillStyle=`rgba(200,140,0,${u*.35})`,e.fillRect(f,g,i,s)),h>.01&&(e.fillStyle=`rgba(0,150,180,${h*.35*a})`,e.fillRect(f,g,i,s)),m>.01&&(e.fillStyle=`rgba(180,40,0,${m*.3})`,e.fillRect(f,g,i,s))}e.restore()}function yY(e,t,n,r,a){const i=t.metrics,s=30,c=r-s;e.save(),e.fillStyle="rgba(5,3,8,0.7)",e.fillRect(0,c,n,s),e.strokeStyle="rgba(200,150,12,0.2)",e.lineWidth=1,e.beginPath(),e.moveTo(0,c),e.lineTo(n,c),e.stroke();const l=[{label:"Integration",val:i.integrationIndex,color:"rgba(0,180,120,"},{label:"Tension",val:i.tensionIndex,color:"rgba(200,60,0,"},{label:"Novelty",val:i.noveltyIndex,color:"rgba(160,120,220,"},{label:"Lapis",val:i.lapisCharge,color:"rgba(255,215,0,"}],d=n/l.length;e.font="7px monospace",e.textAlign="center",e.textBaseline="bottom";for(let m=0;m<l.length;m++){const f=l[m],g=m*d,x=f.val*(s-10);e.fillStyle=f.color+"0.35)",e.fillRect(g+d*.1,c+s-x-2,d*.8,x),e.fillStyle=f.color+"0.75)",e.fillRect(g+d*.3,c+s-x-2,d*.4,Math.min(x,2)),e.fillStyle=f.color+"0.6)",e.fillText(f.label.slice(0,3).toUpperCase(),g+d*.5,r-2)}const u=t.lapis.state,h={DORMANT:"#555",FORMING:"#aa8",FORGED:"#fd0",CRACKED:"#c33"};if(e.fillStyle=h[u]??"#555",e.textAlign="right",e.font="7px monospace",e.fillText(` ${u}`,n-6,r-2),a){const m={NIGREDO:"#333",ALBEDO:"#aac",CITRINITAS:"#da0",RUBEDO:"#800"};e.fillStyle=m[a],e.textAlign="left",e.fillText(` ${a}`,6,r-2)}e.restore()}function bY(e,t,n,r){const a=t.transmutation;if(!a)return;const i=a.counts,s=Math.max(1,Object.values(i).reduce((x,v)=>x+v,0)),c=Math.min(180,n*.22),l=5,d=188,u=r-28;e.fillStyle="rgba(0,0,0,0.5)",e.beginPath(),e.roundRect(d-4,u-2,c+8,l+14,3),e.fill();const h=[{sub:"plumbum",color:"#7888a0",glow:"#4a5868"},{sub:"sulphur",color:"#e0b800",glow:"#ffe040"},{sub:"mercurius",color:"#60c8f0",glow:"#90e8ff"},{sub:"sal",color:"#c8d0e0",glow:"#e8f0ff"},{sub:"argentum",color:"#80acd8",glow:"#b0d8ff"},{sub:"aurum",color:"#ffc107",glow:"#ffe566"}],m={plumbum:"",sulphur:"",mercurius:"",sal:"",argentum:"",aurum:""};let f=d;for(const{sub:x,color:v,glow:b}of h){const k=(i[x]??0)/s*c;k<1||(e.fillStyle=x==="plumbum"?"rgba(100,120,140,0.25)":v,e.globalAlpha=x==="plumbum"?.4:.85,e.fillRect(f,u,k,l),k>12&&x!=="plumbum"&&(e.fillStyle=b,e.globalAlpha=.25,e.fillRect(f,u,k,l)),f+=k)}e.globalAlpha=1,e.font="5px monospace",e.textBaseline="top";let g=d;for(const{sub:x,color:v}of h){const b=i[x]??0,M=b/s*c;if(M<8){g+=M;continue}e.textAlign="left",e.fillStyle=x==="plumbum"?"rgba(255,255,255,0.2)":v,e.globalAlpha=x==="plumbum"?.4:.7,e.fillText(`${m[x]}${b}`,g+1,u+l+2),g+=M}e.globalAlpha=1,e.textBaseline="alphabetic",a.conjunctionActive&&(e.font="5px monospace",e.fillStyle="rgba(160,80,220,0.6)",e.textAlign="left",e.fillText(" Conjuno",d,u-5))}const Su={NIGREDO:{phase:"NIGREDO",label:"Nigredo",symbol:"",color:"#2a1a1a",bgTint:"rgba(0,0,0,0.28)",mixTarget:{earth:.3,water:.35,air:.15,fire:.2},heatTarget:.55,duration:45,minIntegration:0,maxTension:1,minNovelty:.15},ALBEDO:{phase:"ALBEDO",label:"Albedo",symbol:"",color:"#c8c8d8",bgTint:"rgba(180,190,220,0.06)",mixTarget:{earth:.2,water:.45,air:.25,fire:.1},heatTarget:.3,duration:45,minIntegration:.45,maxTension:.45,minNovelty:.2},CITRINITAS:{phase:"CITRINITAS",label:"Citrinitas",symbol:"",color:"#d4aa00",bgTint:"rgba(200,160,0,0.06)",mixTarget:{earth:.2,water:.25,air:.3,fire:.25},heatTarget:.45,duration:45,minIntegration:.55,maxTension:.35,minNovelty:.3},RUBEDO:{phase:"RUBEDO",label:"Rubedo",symbol:"",color:"#8b0000",bgTint:"rgba(139,0,0,0.07)",mixTarget:{earth:.25,water:.2,air:.2,fire:.35},heatTarget:.6,duration:45,minIntegration:.6,maxTension:.4,minNovelty:.25}},xC=["NIGREDO","ALBEDO","CITRINITAS","RUBEDO"];function n5(){return{active:!1,phase:"NIGREDO",phaseIndex:0,timer:0,maxTimer:45,completed:[],lapisForged:!1}}function xY(e,t){const n=Su[e],r=t;return r.integrationIndex<n.minIntegration?{passed:!1,reason:`Integrao insuficiente (${(r.integrationIndex*100).toFixed(0)}%)`,metrics:r}:r.tensionIndex>n.maxTension?{passed:!1,reason:`Tenso excessiva (${(r.tensionIndex*100).toFixed(0)}%)  a separatio domina`,metrics:r}:r.noveltyIndex<n.minNovelty?{passed:!1,reason:"Novelty insuficiente  o sistema cristalizou",metrics:r}:{passed:!0,reason:`${n.label} consumada com sucesso`,metrics:r}}function vC(e){const t=Su[e];return{mix:t.mixTarget,heat:t.heatTarget}}function vY(e){const t=e.phaseIndex+1;return t>=xC.length?null:xC[t]}function SY(e,t,n,r,a){const{integrationIndex:i,tensionIndex:s,noveltyIndex:c}=e,d=n?{NIGREDO:10,ALBEDO:220,CITRINITAS:48,RUBEDO:0}[n]:30+t.fire*30,u=Math.max(1,Math.min(4,Math.round(1+i*3))),h=[3,4,6,8,12],m=Math.min(4,Math.round(t.air*4+t.fire*1)),f=h[m],g=Math.round(s*7+(r?2:0)),x=.6+t.fire*.25-t.earth*.15,v=.3+i*.4+e.lapisCharge*.3;return{outerR:Math.max(.3,Math.min(1,x)),rings:u,segments:f,notches:Math.min(8,g),hue:d,brightness:Math.min(1,v),cracked:a,phase:n}}function wY(e,t,n=60){e.width=e.height=n;const r=e.getContext("2d");r.clearRect(0,0,n,n),r.fillStyle="rgba(5,5,10,0.9)",r.fillRect(0,0,n,n);const a=n/2,i=n/2,s=n*.44*t.outerR,c=`hsla(${t.hue},60%,${40+t.brightness*35}%,`;r.lineCap="round",r.strokeStyle=c+"0.7)",r.lineWidth=.8,r.beginPath(),r.arc(a,i,s,0,Math.PI*2),r.stroke();for(let l=1;l<t.rings;l++){const d=s*(1-l*.2);if(d<3)break;r.globalAlpha=.5-l*.1,r.beginPath(),r.arc(a,i,d,0,Math.PI*2),r.stroke(),r.globalAlpha=1}r.strokeStyle=c+"0.45)",r.lineWidth=.5;for(let l=0;l<t.segments;l++){const d=l/t.segments*Math.PI*2;r.beginPath(),r.moveTo(a,i),r.lineTo(a+Math.cos(d)*s,i+Math.sin(d)*s),r.stroke()}if(t.notches>0){r.strokeStyle=c+"0.8)",r.lineWidth=1;for(let l=0;l<t.notches;l++){const d=l/t.notches*Math.PI*2+Math.PI*.1,u=a+Math.cos(d)*s,h=i+Math.sin(d)*s;r.beginPath(),r.moveTo(a+Math.cos(d)*(s-4),i+Math.sin(d)*(s-4)),r.lineTo(u,h),r.stroke()}}if(r.strokeStyle=c+"0.9)",r.lineWidth=1,r.beginPath(),r.moveTo(a-4,i),r.lineTo(a+4,i),r.moveTo(a,i-4),r.lineTo(a,i+4),r.stroke(),t.brightness>.6){const l=r.createRadialGradient(a,i,0,a,i,8);l.addColorStop(0,`hsla(${t.hue},80%,80%,${(t.brightness-.6)*2})`),l.addColorStop(1,"transparent"),r.fillStyle=l,r.beginPath(),r.arc(a,i,8,0,Math.PI*2),r.fill()}if(t.cracked){r.strokeStyle="rgba(200,50,0,0.6)",r.lineWidth=.7;const l=[.3,1.8,4.1];for(const d of l)r.beginPath(),r.moveTo(a,i),r.lineTo(a+Math.cos(d)*s*.9,i+Math.sin(d)*s*.9),r.stroke()}}const Ei={nigredo:["A prima matria retorna ao caos frtil.","A sombra  o tero do ser.","O chumbo dissolve-se em si mesmo.","Putrefao: primeiro sacramento do Opus.","O corvo pousou; o negro precede o branco.","Toda fixao se dissolve antes de reconstruir."],albedo:["A lua revela o que o sol consome.","A prata emerge do resduo carbonizado.","Clarificao: o campo respira com menos rudo.","O espelho se lava; o reflexo se precisa.","A gua purifica o que o fogo revelou."],citrinitas:["A aurora dora os contornos do ser emergente.","O mercrio estabiliza entre dois polos.","A integrao acende a primeira chama consciente.","Citrinitas: nem prata nem ouro  transio sagrada.","O Sol ainda no   mas o horizonte  seu."],rubedo:["O vermelho-rei encarna no campo coagulado.","Rubedo: a fixao final, a pedra quer corpo.","O ouro no  cor   estado de permanncia.","A obra encarna; o Opus se fecha neste ciclo.","O enxofre vence o mercrio; a matria se fixa."],solve:["Solve: a estrutura cede  corrente.","A dissoluo no destri  prepara.","O vnculo se afroxa para que um novo nasa.","Toda dissoluo  semente de nova forma."],coagula:["Coagula: o disperso se recolhe em forma.","A coheso escreve novos padres no campo.","O slido vence o fluido por tempo.","A pedra busca a pedra pelo peso do semelhante."],burnout:["O athanor aqueceu alm do suportvel.","O excesso de fogo carboniza o que no  fixado.","Calcinao involuntria: recuar ou aceitar o colapso."],crystallization:["A terra dominou; a novelty morreu.","Cristalizao: dogma endurecido onde havia mistrio.","O fixo prende o que devia transformar."],dissolution:["A gua venceu toda coeso; o campo se dissolve.","Sem terra, nenhuma forma persiste.","Excesso de solutio: perda de identidade do opus."],noise:["O ar em excesso transforma sinal em rudo.","A volatilizao sem terra produz disperso sem sentido.","O caos areo dissolve a ordem emergente."],lapisForged:["A Pedra Filosofal consolida-se no centro.","Lapis Philosophorum: o catalisador encarna.","A transmutao SA ativa-se pelo centro do campo.","A Pedra no  ouro   o que transforma em ouro."],lapisCracked:["A Pedra racha sob presso excessiva.","O catalisador quebra; a transmutao suspende-se.","Retorno ao Albedo ser necessrio para reconstituir."],generic:["O campo registra a passagem do tempo alqumico.","O Opus avana por suas prprias leis.","A obra caminha sem pressa, mas sem pausa.","Observe; o sistema fala antes de ser perguntado."]};function MY(e,t){const{integrationIndex:n,tensionIndex:r,noveltyIndex:a}=e,i=b6(t);return r>.6?`porque o campo S (separatio) subiu a ${(r*100).toFixed(0)}%, a coeso cedeu  tenso.`:n>.7?`porque A (affinity) excede S em ${((n-.5)*200).toFixed(0)}%, a integrao avana.`:a<.08?`porque a novelty caiu a ${(a*100).toFixed(0)}%, o sistema tende  cristalizao.`:i==="fire"?"porque o Fogo domina, a taxa de mutao aumenta e o risco cresce.":i==="water"?"porque a gua domina, a difuso absorve as estruturas mais frgeis.":i==="earth"?"porque a Terra domina, a coheso freia a volatilidade.":i==="air"?"porque o Ar domina, o campo propaga alm da sua capacidade de reter.":`porque integrao=${(n*100).toFixed(0)}% e tenso=${(r*100).toFixed(0)}%, o Opus encontra seu equilbrio momentneo.`}function b6(e){return Object.entries(e).reduce((n,r)=>r[1]>n[1]?r:n)[0]}function SC(e){return e[Math.floor(Math.random()*e.length)]}function CY(e,t,n,r,a,i){let s=[];const c=[];if(a)switch(a){case"BURNOUT":s=Ei.burnout,c.push("burnout");break;case"CRYSTALLIZATION":s=Ei.crystallization,c.push("crystallization");break;case"DISSOLUTION":s=Ei.dissolution,c.push("dissolution");break;case"NOISE":s=Ei.noise,c.push("noise");break}if(e==="lapisForged"&&(s=Ei.lapisForged,c.push("lapis","forged")),e==="lapisCracked"&&(s=Ei.lapisCracked,c.push("lapis","cracked")),s.length===0&&r)switch(r){case"NIGREDO":s=Ei.nigredo,c.push("nigredo");break;case"ALBEDO":s=Ei.albedo,c.push("albedo");break;case"CITRINITAS":s=Ei.citrinitas,c.push("citrinitas");break;case"RUBEDO":s=Ei.rubedo,c.push("rubedo");break}s.length===0&&(s=Ei.generic);const l=b6(n);c.push(l),r&&c.push(r.toLowerCase());const d=SC(s);let u=d;if(e==="phaseStart"||e==="phaseEnd"){const f=SC(r?Ei[r.toLowerCase()]??Ei.generic:Ei.generic);f!==d&&(u=`${d}
${f}`)}const h=MY(t,n),m=SY(t,n,r,a,i==="CRACKED");return{text:u,causalLine:h,glyphSpec:m,tags:c}}const kY=140;let RY=1;function wC(){return[]}function Zd(e,t,n,r,a,i,s){const c=CY(t,n,r,a,i,s),l={id:RY++,timestamp:Date.now(),text:c.text,causalLine:c.causalLine,phase:a,event:i,tags:c.tags,elements:{...r},metrics:{...n},glyphSpec:c.glyphSpec,bookmarked:!1};return e.unshift(l),e.length>kY&&e.pop(),l}function AY(e,t,n){return e.filter(r=>!(t&&!r.tags.includes(t)))}function jY(e){const t=new Date(e);return`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`}const Gp=[{id:"athanor-calm",name:"Athanor Calmo",subtitle:"Contemplao. O forno aquece devagar.",description:"Baixo risco. Contemplativo. Integrao gradual. Ideal para observao.",agentCount:400,heat:.22,elements:{earth:.35,water:.35,air:.2,fire:.1}},{id:"fermentation",name:"Fermentao",subtitle:"Nigredo forte. A obra comea na sombra.",description:"Risco mdio. A putrefao domina inicialmente.",agentCount:600,heat:.55,elements:{earth:.2,water:.35,air:.15,fire:.3}},{id:"crucible",name:"Cadinho",subtitle:"Fogo alto. Risco real. Lapis possvel.",description:"Alto fogo. Risco de burnout. Lapis pode ser forjada se integrao for sustentada.",agentCount:900,heat:.8,elements:{earth:.15,water:.15,air:.25,fire:.45}},{id:"solutio",name:"Solutio",subtitle:"Aqua dominat. A dissoluo total.",description:"gua domina. A matria se dissolve. Risco de dissolution alto.",agentCount:500,heat:.3,elements:{earth:.08,water:.65,air:.2,fire:.07}},{id:"calcinatio",name:"Calcinatio",subtitle:"Ignis consumit. A purificao pelo fogo.",description:"Fogo alto com calor moderado. Queima o impuro. Risco de burnout.",agentCount:700,heat:.7,elements:{earth:.12,water:.1,air:.18,fire:.6}},{id:"sublimatio",name:"Sublimatio",subtitle:"Aer elevat. A elevao espiritual.",description:"Ar domina. Volatilizao mxima. Risco de rudo e disperso.",agentCount:600,heat:.4,elements:{earth:.08,water:.12,air:.65,fire:.15}},{id:"coagulatio",name:"Coagulatio",subtitle:"Terra fixat. A fixao da matria.",description:"Terra domina. Fixao mxima. Risco de cristalizao prematura.",agentCount:500,heat:.28,elements:{earth:.62,water:.18,air:.1,fire:.1}},{id:"putrefactio-nigra",name:"Putrefactio Nigra",subtitle:"O negro primordial. A matria apodrece.",description:"Nigredo puro. Alta tenso. A putrefao  o incio de tudo.",agentCount:650,heat:.62,elements:{earth:.15,water:.4,air:.12,fire:.33}},{id:"distillatio-alba",name:"Distillatio Alba",subtitle:"A prata emerge. Luna illuminat.",description:"Albedo puro. gua+Terra purificam. Baixo calor. Clarificao gradual.",agentCount:450,heat:.25,elements:{earth:.25,water:.5,air:.18,fire:.07}},{id:"aurora-citrina",name:"Aurora Citrina",subtitle:"O Sol nasce. A integrao manifesta.",description:"Citrinitas. Equilbrio entre os 4 elementos com leve dominncia do Ar.",agentCount:550,heat:.42,elements:{earth:.22,water:.28,air:.32,fire:.18}},{id:"rubedo-regis",name:"Rubedo Regis",subtitle:"O Rei Vermelho encarna. Fogo fixado.",description:"Rubedo. Fogo+Terra coagulam. Lapis busca forma. Alta integrao possvel.",agentCount:650,heat:.58,elements:{earth:.28,water:.15,air:.2,fire:.37}},{id:"mercurius",name:"Mercurius",subtitle:"O mediador. Ar+gua. Fluidez do esprito.",description:"Tria Prima: Mercrio = Ar+gua. Medeia entre Enxofre e Sal. Alto globalMix.",agentCount:600,heat:.38,elements:{earth:.1,water:.4,air:.4,fire:.1}},{id:"sulphur",name:"Sulphur Vivi",subtitle:"A alma em combusto. Fogo+Ar.",description:"Tria Prima: Enxofre = Fogo+Ar. A alma ativa. Alta mutao e transformao.",agentCount:700,heat:.72,elements:{earth:.08,water:.12,air:.3,fire:.5}},{id:"sal-terrae",name:"Sal Terrae",subtitle:"O corpo fixado. Terra+gua.",description:"Tria Prima: Sal = Terra+gua. O corpo da matria. Estvel, lento, profundo.",agentCount:480,heat:.2,elements:{earth:.45,water:.4,air:.08,fire:.07}},{id:"coniunctio",name:"Coniunctio",subtitle:"Sol e Luna se unem. Fogo+gua.",description:"A conjuno dos opostos (Sol/Fogo e Luna/gua). Tenso produtiva. Lapis prxima.",agentCount:600,heat:.5,elements:{earth:.15,water:.35,air:.12,fire:.38}},{id:"separatio",name:"Separatio",subtitle:"Separa o fixo do voltil.",description:"Solve mximo. Ar+gua dominam. Desfaz estruturas para criar novas.",agentCount:600,heat:.45,elements:{earth:.08,water:.38,air:.38,fire:.16}},{id:"fixatio",name:"Fixatio",subtitle:"Fixa o voltil. Coagula mximo.",description:"Coagula forte. Terra+calor fixam o que foi volatilizado. Baixo risco.",agentCount:500,heat:.55,elements:{earth:.55,water:.12,air:.1,fire:.23}},{id:"lapis-hunt",name:"Venatione Lapidis",subtitle:"A caada  Pedra. Alta integrao.",description:"Otimizado para forjar a Lapis: integrao alta, calor moderado, terra+agua base.",agentCount:700,heat:.52,elements:{earth:.28,water:.3,air:.2,fire:.22}},{id:"multiplicatio",name:"Multiplicatio",subtitle:"A pedra se multiplica. Mximo agentes.",description:"Alta densidade. Fogo domina. Sistema altamente emergente. Caos produtivo.",agentCount:900,heat:.75,elements:{earth:.15,water:.2,air:.22,fire:.43}},{id:"via-negativa",name:"Via Negativa",subtitle:"O mnimo. Vazio contemplativo.",description:"Mnima interferncia. Poucos agentes, calor baixo. Medita sobre o vazio do campo.",agentCount:200,heat:.08,elements:{earth:.25,water:.25,air:.25,fire:.25}}];function EY(e){return Gp.find(t=>t.id===e)}function MC(){return{active:!1,cursor:0,stepDur:2.5,timer:0,quantum:!1,bpm:24,superStep:null,superWeight:0,steps:x6()}}function Xr(e,t,n={}){return{id:e,label:t,earthTarget:null,waterTarget:null,airTarget:null,fireTarget:null,heatTarget:null,op:"NONE",active:!0,probability:1,entangled:null,entangleSign:1,...n}}function x6(){return[Xr(0,""),Xr(1,"N",{earthTarget:.2,waterTarget:.35,airTarget:.15,fireTarget:.3,heatTarget:.55}),Xr(2,"",{op:"SOLVE"}),Xr(3,""),Xr(4,"A",{earthTarget:.22,waterTarget:.48,airTarget:.2,fireTarget:.1,heatTarget:.28}),Xr(5,"",{op:"COAGULA"}),Xr(6,""),Xr(7,"C",{earthTarget:.22,waterTarget:.26,airTarget:.32,fireTarget:.2,heatTarget:.42}),Xr(8,"",{op:"SOLVE"}),Xr(9,""),Xr(10,"R",{earthTarget:.28,waterTarget:.15,airTarget:.2,fireTarget:.37,heatTarget:.58}),Xr(11,"",{op:"COAGULA"}),Xr(12,"",{heatTarget:.6,probability:.7,entangled:3,entangleSign:1}),Xr(13,"",{probability:.8}),Xr(14,"",{op:"SOLVE",probability:.5,entangled:11,entangleSign:-1}),Xr(15,"",{heatTarget:.35,probability:.6})]}function TY(e,t){if(!e.active)return{stepFired:!1,firedStep:null,superActive:null,superWeight:0,elementsDelta:null,heatDelta:null,op:"NONE"};e.timer+=t;const n={stepFired:!1,firedStep:null,superActive:null,superWeight:0,elementsDelta:null,heatDelta:null,op:"NONE"};if(e.timer>=e.stepDur){e.timer=0;const r=e.steps[e.cursor];if(r.active)if(e.quantum?Math.random()<r.probability:!0){if(n.stepFired=!0,n.firedStep=r,n.op=r.op,(r.earthTarget!=null||r.waterTarget!=null||r.airTarget!=null||r.fireTarget!=null)&&(n.elementsDelta={earth:r.earthTarget??void 0,water:r.waterTarget??void 0,air:r.airTarget??void 0,fire:r.fireTarget??void 0}),r.heatTarget!=null&&(n.heatDelta=r.heatTarget),r.entangled!=null&&e.quantum){const s=e.steps[r.entangled];r.entangleSign===1?Math.random()<r.probability*.8&&(n.superActive=s,n.superWeight=.4,e.superStep=r.entangled,e.superWeight=.4):s.probability>.1&&(s.probability-=.15)}e.cursor=(e.cursor+1)%e.steps.length;let i=0;for(;!e.steps[e.cursor].active&&i<e.steps.length;)e.cursor=(e.cursor+1)%e.steps.length,i++}else{e.superStep=e.cursor,e.superWeight=.5,n.superActive=r,n.superWeight=.5,e.cursor=(e.cursor+1)%e.steps.length;let i=0;for(;!e.steps[e.cursor].active&&i<e.steps.length;)e.cursor=(e.cursor+1)%e.steps.length,i++}else e.cursor=(e.cursor+1)%e.steps.length}return e.superWeight>0&&(e.superWeight-=t*.4,e.superWeight<=0&&(e.superWeight=0,e.superStep=null)),n}const v6=[{id:"opus-classic",name:"Opus Clssico",bpm:20,quantum:!1,steps:x6()},{id:"nigredo-loop",name:"Nigredo Loop",bpm:16,quantum:!1,steps:[Xr(0,"N",{earthTarget:.15,waterTarget:.4,airTarget:.12,fireTarget:.33,heatTarget:.6}),Xr(1,"",{op:"SOLVE"}),Xr(2,""),Xr(3,"N",{fireTarget:.35,waterTarget:.38,heatTarget:.65}),Xr(4,""),Xr(5,"",{op:"SOLVE"}),Xr(6,"",{op:"COAGULA"}),Xr(7,"")]},{id:"quantum-chaos",name:"Quantum Chaos",bpm:30,quantum:!0,steps:[Xr(0,"N",{probability:.7,earthTarget:.12,fireTarget:.45,heatTarget:.7}),Xr(1,"A",{probability:.5,waterTarget:.5,heatTarget:.25,entangled:4,entangleSign:1}),Xr(2,"",{op:"SOLVE",probability:.6}),Xr(3,"",{op:"COAGULA",probability:.6,entangled:2,entangleSign:-1}),Xr(4,"C",{probability:.7,airTarget:.35,heatTarget:.4}),Xr(5,"",{heatTarget:.55,probability:.4}),Xr(6,"R",{probability:.5,fireTarget:.38,earthTarget:.28,heatTarget:.58}),Xr(7,"",{heatTarget:.3,probability:.9})]},{id:"lapis-hunt",name:"Venatione Lapidis",bpm:18,quantum:!0,steps:[Xr(0,"",{op:"COAGULA",probability:.9}),Xr(1,"A",{waterTarget:.48,earthTarget:.22,heatTarget:.28,probability:.85}),Xr(2,"",{probability:.7}),Xr(3,"C",{airTarget:.32,heatTarget:.42,probability:.8,entangled:5,entangleSign:1}),Xr(4,"",{op:"COAGULA",probability:.75}),Xr(5,"",{heatTarget:.52,probability:.65}),Xr(6,"R",{fireTarget:.35,earthTarget:.28,heatTarget:.58,probability:.7}),Xr(7,"",{heatTarget:.45,probability:.95})]}],tl={alcali:{label:"Metais Alcalinos",color:"#ff9800",dim:"#7a4800"},"alcalino-terroso":{label:"Metais Alcalino-Terrosos",color:"#ffc107",dim:"#7a5c00"},transicao:{label:"Metais de Transio",color:"#f06292",dim:"#6a2545"},lantanideo:{label:"Lantandeos",color:"#81c784",dim:"#2a5c2e"},actinineo:{label:"Actindeos",color:"#a5d6a7",dim:"#2e5c30"},"metal-representativo":{label:"Metais Representativos",color:"#4dd0e1",dim:"#1a5c65"},"semi-metal":{label:"Semi-metais",color:"#26a69a",dim:"#0f4a45"},"nao-metal":{label:"No-metais",color:"#90caf9",dim:"#2a4a6a"},halogeno:{label:"Halognios",color:"#66bb6a",dim:"#1e4a20"},"gas-nobre":{label:"Gases Nobres",color:"#9575cd",dim:"#3a2a6a"},desconhecido:{label:"Desconhecido",color:"#90a4ae",dim:"#3a4a50"}},gm=[{z:1,symbol:"H",name:"Hidrognio",cat:"nao-metal",period:1,group:1,row:1,col:1,mass:1.008,alch:" Primordial",desc:"O elemento mais abundante. Base de toda matria.",recipe:{water:[.3,1],air:[.2,.8],heat:[0,.4],ticksNeeded:2,hint:" gua + Ar. Condies primordiais  o primeiro elemento."}},{z:2,symbol:"He",name:"Hlio",cat:"gas-nobre",period:1,group:18,row:1,col:18,mass:4.003,desc:"Gs nobre raro. Inerte, incombustvel.",recipe:{air:[.6,1],heat:[0,.12],ticksNeeded:5,hint:"Ar mximo + calor mnimo. Use SUBLIMATIO para isolar."}},{z:3,symbol:"Li",name:"Ltio",cat:"alcali",period:2,group:1,row:2,col:1,mass:6.941,alch:" Inflamvel",desc:"Metal alcalino leve. Reage com gua liberando fogo.",recipe:{fire:[.4,.9],earth:[.05,.35],heat:[.3,.7],ticksNeeded:6,hint:" Fogo + pouca Terra. O fogo toca a matria slida."}},{z:4,symbol:"Be",name:"Berlio",cat:"alcalino-terroso",period:2,group:2,row:2,col:2,mass:9.012,desc:"Metal leve e rgido. Extremamente txico.",recipe:{earth:[.3,.6],fire:[.3,.6],heat:[.35,.72],ticksNeeded:8,hint:"Terra + Fogo em propores iguais, calor moderado."}},{z:5,symbol:"B",name:"Boro",cat:"semi-metal",period:2,group:13,row:2,col:13,mass:10.811,desc:"Semi-metal essencial. Cristais boratos formam gemas.",recipe:{earth:[.25,.55],air:[.25,.55],heat:[.3,.7],ticksNeeded:7,hint:"Terra + Ar equilibrados  a cristalizao do ter."}},{z:6,symbol:"C",name:"Carbono",cat:"nao-metal",period:2,group:14,row:2,col:14,mass:12.011,alch:" Quintessncia",desc:"Base da vida. Do diamante ao grafite, infinitas formas.",recipe:{earth:[.2,.5],air:[.2,.5],heat:[.2,.6],ticksNeeded:3,hint:"Terra + Ar equilibrados. A quintessncia da vida orgnica."}},{z:7,symbol:"N",name:"Nitrognio",cat:"nao-metal",period:2,group:15,row:2,col:15,mass:14.007,desc:"78% da atmosfera. Essencial para aminocidos.",recipe:{air:[.45,.95],heat:[0,.4],ticksNeeded:4,hint:"Ar dominante + baixo calor. O ar primordial inerte."}},{z:8,symbol:"O",name:"Oxignio",cat:"nao-metal",period:2,group:16,row:2,col:16,mass:15.999,alch:" Vital",desc:"Essencial  respirao e combusto.",recipe:{water:[.3,.7],air:[.2,.5],heat:[.1,.5],ticksNeeded:3,hint:"gua + Ar com calor suave  a respirao do cosmos."}},{z:9,symbol:"F",name:"Flor",cat:"halogeno",period:2,group:17,row:2,col:17,mass:18.998,desc:"O elemento mais eletronegativo. Corri quase tudo.",recipe:{air:[.3,.65],fire:[.3,.65],heat:[.25,.65],ticksNeeded:8,hint:"Ar + Fogo equilibrados. O sal do fogo celestial."}},{z:10,symbol:"Ne",name:"Nenio",cat:"gas-nobre",period:2,group:18,row:2,col:18,mass:20.18,desc:"Gs nobre que emite luz vermelha ao ionizar.",recipe:{air:[.6,1],heat:[0,.15],ticksNeeded:6,hint:"Ar mximo + calor muito baixo. SUBLIMATIO ajuda."}},{z:11,symbol:"Na",name:"Sdio",cat:"alcali",period:3,group:1,row:3,col:1,mass:22.99,alch:" Sal Voltil",desc:"Metal mole. Explode em contato com gua.",recipe:{fire:[.4,.8],earth:[.1,.4],heat:[.4,.8],ticksNeeded:6,hint:" Fogo + alguma Terra, calor mdio-alto."}},{z:12,symbol:"Mg",name:"Magnsio",cat:"alcalino-terroso",period:3,group:2,row:3,col:2,mass:24.305,desc:"Metal leve. Queima com chama branca intensa.",recipe:{earth:[.3,.6],fire:[.2,.5],heat:[.35,.72],ticksNeeded:7,hint:"Terra + Fogo, calor moderado. O brilho metlico nasce."}},{z:13,symbol:"Al",name:"Alumnio",cat:"metal-representativo",period:3,group:13,row:3,col:13,mass:26.982,desc:"O metal mais abundante na crosta terrestre.",recipe:{earth:[.4,.8],air:[.1,.3],heat:[.35,.72],ticksNeeded:7,hint:"Terra + Ar, calor moderado. A pedra que se torna metal."}},{z:14,symbol:"Si",name:"Silcio",cat:"semi-metal",period:3,group:14,row:3,col:14,mass:28.086,alch:"Areia Filosfica",desc:"Areia, vidro, chips  a pedra da era digital.",recipe:{earth:[.45,.9],fire:[.05,.25],heat:[.3,.72],ticksNeeded:7,hint:"Terra dominante + pouco Fogo. A areia cristalizada."}},{z:15,symbol:"P",name:"Fsforo",cat:"nao-metal",period:3,group:15,row:3,col:15,mass:30.974,alch:"Enxofre da Vida",desc:"Essencial ao DNA. O fsforo branco queima espontaneamente.",recipe:{earth:[.2,.5],fire:[.2,.5],heat:[.35,.72],ticksNeeded:8,hint:"Terra + Fogo equilibrados. O fsforo: luz que nasce da terra."}},{z:16,symbol:"S",name:"Enxofre",cat:"nao-metal",period:3,group:16,row:3,col:16,mass:32.065,alch:" Sulphur",desc:"O enxofre clssico dos alquimistas. Amarelo, cristalino.",recipe:{fire:[.35,.7],earth:[.2,.5],heat:[.45,.85],ticksNeeded:5,hint:" Fogo + Terra, calor elevado. O Enxofre Alqumico!"}},{z:17,symbol:"Cl",name:"Cloro",cat:"halogeno",period:3,group:17,row:3,col:17,mass:35.453,desc:"Gs verde-amarelado. Usado em piscinas e guerra qumica.",recipe:{water:[.2,.5],air:[.2,.5],fire:[.1,.4],heat:[.25,.65],ticksNeeded:8,hint:"gua + Ar + Fogo. O sal corrosivo da atmosfera."}},{z:18,symbol:"Ar",name:"Argnio",cat:"gas-nobre",period:3,group:18,row:3,col:18,mass:39.948,desc:"Gs nobre, 1% da atmosfera. Proteo em soldagem.",recipe:{air:[.55,1],heat:[0,.2],ticksNeeded:6,hint:"Ar dominante + baixo calor. O guardio inerte."}},{z:19,symbol:"K",name:"Potssio",cat:"alcali",period:4,group:1,row:4,col:1,mass:39.098,alch:"Sal Fixo",desc:"Alcalino essencial  vida. Reage violentamente com gua.",recipe:{fire:[.5,.9],earth:[.05,.3],heat:[.35,.72],ops:["SOLVE"],ticksNeeded:8,hint:" Fogo + SOLVE aplicado. O Sal Fixo se liberta."}},{z:20,symbol:"Ca",name:"Clcio",cat:"alcalino-terroso",period:4,group:2,row:4,col:2,mass:40.078,desc:"Os ossos, as conchas, o calcrio  tudo  clcio.",recipe:{earth:[.3,.65],water:[.1,.35],fire:[.15,.45],heat:[.3,.72],ticksNeeded:7,hint:"Terra + gua + algum Fogo. A pedra calcria."}},{z:21,symbol:"Sc",name:"Escndio",cat:"transicao",period:4,group:3,row:4,col:3,mass:44.956,desc:"Metal raro, leve. Usado em bicicletas de alta performance.",recipe:{earth:[.4,.75],fire:[.2,.4],heat:[.45,.82],ticksNeeded:10,hint:"Terra + Fogo, calor mdio-alto. Metal de transio leve."}},{z:22,symbol:"Ti",name:"Titnio",cat:"transicao",period:4,group:4,row:4,col:4,mass:47.867,alch:"Marte Branco",desc:"Resistente como o ao, leve como o alumnio.",recipe:{earth:[.45,.82],fire:[.1,.3],heat:[.5,.9],ticksNeeded:10,hint:"Terra dominante + calor alto. O metal dos deuses."}},{z:23,symbol:"V",name:"Vandio",cat:"transicao",period:4,group:5,row:4,col:5,mass:50.942,desc:"Metal multicolorido. Suas solues formam arco-ris.",recipe:{earth:[.4,.72],fire:[.2,.5],heat:[.5,.9],ticksNeeded:10,hint:"Terra + Fogo, calor alto. As cores do arco-ris metlico."}},{z:24,symbol:"Cr",name:"Cromo",cat:"transicao",period:4,group:6,row:4,col:6,mass:51.996,alch:"Cor do Fogo",desc:"Confere brilho ao ao inox. Esmeraldas tm cromo.",recipe:{earth:[.3,.65],fire:[.3,.65],heat:[.55,.92],ticksNeeded:12,hint:"Terra + Fogo iguais, calor alto. O espelho metlico."}},{z:25,symbol:"Mn",name:"Mangans",cat:"transicao",period:4,group:7,row:4,col:7,mass:54.938,desc:"Essencial ao ao. Cores violeta na oxidao.",recipe:{earth:[.35,.68],fire:[.25,.5],heat:[.45,.85],ticksNeeded:10,hint:"Terra + Fogo, calor moderado-alto."}},{z:26,symbol:"Fe",name:"Ferro",cat:"transicao",period:4,group:8,row:4,col:8,mass:55.845,alch:" Marte",desc:"O metal da civilizao. Desde a Idade do Ferro at hoje.",recipe:{earth:[.45,.8],fire:[.2,.5],heat:[.5,.9],ticksNeeded:8,hint:"Terra + Fogo, calor alto.  Marte forja o Ferro."}},{z:27,symbol:"Co",name:"Cobalto",cat:"transicao",period:4,group:9,row:4,col:9,mass:58.933,alch:"Cor Azul",desc:"O azul do cobalto coloriu vitrais medievais.",recipe:{earth:[.35,.65],fire:[.3,.6],heat:[.5,.9],ticksNeeded:10,hint:"Terra + Fogo iguais, calor alto. O azul profundo."}},{z:28,symbol:"Ni",name:"Nquel",cat:"transicao",period:4,group:10,row:4,col:10,mass:58.693,desc:"Moedas, ao inox, baterias. O espelho duradouro.",recipe:{earth:[.35,.68],fire:[.25,.5],heat:[.5,.9],ticksNeeded:10,hint:"Terra + Fogo, calor alto. O metal das moedas."}},{z:29,symbol:"Cu",name:"Cobre",cat:"transicao",period:4,group:11,row:4,col:11,mass:63.546,alch:" Vnus",desc:"O metal dos condutores. Verde no ar, vermelho puro.",recipe:{earth:[.3,.65],water:[.1,.3],fire:[.2,.5],heat:[.45,.85],ticksNeeded:8,hint:"Terra + gua + Fogo.  Vnus  o cobre conduz o amor."}},{z:30,symbol:"Zn",name:"Zinco",cat:"transicao",period:4,group:12,row:4,col:12,mass:65.38,alch:"Tutia",desc:"Proteo contra ferrugem. Lato = cobre + zinco.",recipe:{earth:[.35,.65],fire:[.2,.45],heat:[.45,.82],ticksNeeded:9,hint:"Terra + Fogo, calor mdio. A tutia dos alquimistas."}},{z:31,symbol:"Ga",name:"Glio",cat:"metal-representativo",period:4,group:13,row:4,col:13,mass:69.723,desc:"Derrete na palma da mo. Lquido a 29C.",recipe:{earth:[.35,.65],air:[.1,.3],heat:[.35,.72],ops:["COAGULA"],ticksNeeded:12,hint:"Terra + Ar, COAGULA. O metal que derrete nas mos."}},{z:32,symbol:"Ge",name:"Germnio",cat:"semi-metal",period:4,group:14,row:4,col:14,mass:72.63,desc:"Semicondutor. Essencial na eletrnica antiga.",recipe:{earth:[.35,.65],fire:[.2,.4],heat:[.45,.82],ops:["COAGULA"],ticksNeeded:12,hint:"Terra + Fogo + COAGULA. O semi-metal da era digital."}},{z:33,symbol:"As",name:"Arsnio",cat:"semi-metal",period:4,group:15,row:4,col:15,mass:74.922,alch:" Arsenicum",desc:"Veneno histrico. Os Brgia o usavam em vinhos.",recipe:{earth:[.25,.55],fire:[.3,.6],heat:[.45,.85],ticksNeeded:10,hint:"Terra + Fogo. O veneno dos alquimistas."}},{z:34,symbol:"Se",name:"Selnio",cat:"nao-metal",period:4,group:16,row:4,col:16,mass:78.96,desc:"No-metal vermelho. Essencial em pequenas doses.",recipe:{earth:[.2,.5],air:[.2,.45],heat:[.35,.72],ticksNeeded:10,hint:"Terra + Ar, calor moderado. O sel lunar."}},{z:35,symbol:"Br",name:"Bromo",cat:"halogeno",period:4,group:17,row:4,col:17,mass:79.904,desc:"nico no-metal lquido em temperatura ambiente.",recipe:{water:[.25,.55],air:[.2,.45],fire:[.2,.5],heat:[.35,.72],ticksNeeded:10,hint:"gua + Ar + Fogo. O halognio vermelho-alaranjado."}},{z:36,symbol:"Kr",name:"Criptnio",cat:"gas-nobre",period:4,group:18,row:4,col:18,mass:83.798,desc:"Gs nobre. Lmpadas de cripton tm luz brilhante.",recipe:{air:[.5,.9],heat:[.1,.3],ticksNeeded:8,hint:"Ar dominante + baixo calor. O gs oculto."}},{z:37,symbol:"Rb",name:"Rubdio",cat:"alcali",period:5,group:1,row:5,col:1,mass:85.468,desc:"Alcalino raro. Usado em relgios atmicos.",recipe:{fire:[.5,.9],earth:[.05,.25],heat:[.45,.82],ticksNeeded:12,hint:" Fogo muito dominante + pouca Terra."}},{z:38,symbol:"Sr",name:"Estrncio",cat:"alcalino-terroso",period:5,group:2,row:5,col:2,mass:87.62,desc:"O estrncio d a cor vermelha nos fogos de artifcio.",recipe:{earth:[.3,.62],fire:[.3,.6],heat:[.45,.85],ticksNeeded:12,hint:"Terra + Fogo, calor mdio-alto. O fogo vermelho."}},{z:39,symbol:"Y",name:"trio",cat:"transicao",period:5,group:3,row:5,col:3,mass:88.906,desc:"Metal raro em LEDs brancas e supercondutores.",recipe:{earth:[.4,.72],fire:[.25,.5],heat:[.5,.88],ticksNeeded:14,hint:"Terra + Fogo, calor alto. Metal de terras raras leves."}},{z:40,symbol:"Zr",name:"Zircnio",cat:"transicao",period:5,group:4,row:5,col:4,mass:91.224,desc:"Resistncia trmica extrema. Usado em reatores nucleares.",recipe:{earth:[.5,.85],fire:[.1,.3],heat:[.55,.92],ticksNeeded:14,hint:"Terra muito dominante + calor alto."}},{z:41,symbol:"Nb",name:"Nibio",cat:"transicao",period:5,group:5,row:5,col:5,mass:92.906,alch:"Nibio Brasileiro",desc:"Brasil tem 98% das reservas mundiais. Supercondutividade.",recipe:{earth:[.45,.78],fire:[.2,.45],heat:[.55,.92],ticksNeeded:14,hint:"Terra + Fogo, calor alto. O orgulho brasileiro!"}},{z:42,symbol:"Mo",name:"Molibdnio",cat:"transicao",period:5,group:6,row:5,col:6,mass:95.96,desc:"Ao molibdnio  usado em turbinas de avies.",recipe:{earth:[.4,.75],fire:[.25,.5],heat:[.55,.92],ticksNeeded:14,hint:"Terra + Fogo, calor alto."}},{z:43,symbol:"Tc",name:"Tecncio",cat:"transicao",period:5,group:7,row:5,col:7,mass:98,desc:"Primeiro elemento sinttico. No existe na natureza.",recipe:{earth:[.3,.6],fire:[.3,.6],heat:[.55,.92],ops:["FERMENTATIO"],ticksNeeded:18,hint:"Terra + Fogo + FERMENTATIO. Criao artificial!"}},{z:44,symbol:"Ru",name:"Rutnio",cat:"transicao",period:5,group:8,row:5,col:8,mass:101.07,desc:"Metal do grupo da platina. Extremamente duro.",recipe:{earth:[.4,.72],fire:[.3,.58],heat:[.6,.95],ticksNeeded:15,hint:"Terra + Fogo, calor muito alto."}},{z:45,symbol:"Rh",name:"Rdio",cat:"transicao",period:5,group:9,row:5,col:9,mass:102.906,desc:"O mais raro dos metais preciosos. Catalisador essencial.",recipe:{earth:[.35,.68],fire:[.3,.6],heat:[.62,.98],ticksNeeded:16,hint:"Terra + Fogo iguais, calor muito alto."}},{z:46,symbol:"Pd",name:"Paldio",cat:"transicao",period:5,group:10,row:5,col:10,mass:106.42,desc:"Catalisadores de automveis. Absorve hidrognio.",recipe:{earth:[.35,.68],fire:[.28,.58],heat:[.58,.95],ticksNeeded:15,hint:"Terra + Fogo, calor alto."}},{z:47,symbol:"Ag",name:"Prata",cat:"transicao",period:5,group:11,row:5,col:11,mass:107.868,alch:" Luna/Argentum",desc:"A Prata Lunar. Melhor condutor eltrico. Antibacteriana.",recipe:{earth:[.3,.62],fire:[.25,.52],heat:[.5,.9],opusPhase:"ALBEDO",ticksNeeded:20,hint:"Terra + Fogo + Opus ALBEDO (Brancura).  A Luna Alqumica!"}},{z:48,symbol:"Cd",name:"Cdmio",cat:"transicao",period:5,group:12,row:5,col:12,mass:112.411,desc:"Metal txico. Pigmento amarelo brilhante.",recipe:{earth:[.38,.68],fire:[.22,.48],heat:[.48,.88],ticksNeeded:13,hint:"Terra + Fogo, calor mdio-alto."}},{z:49,symbol:"In",name:"ndio",cat:"metal-representativo",period:5,group:13,row:5,col:13,mass:114.818,desc:"Metal mole e brilhante. Essencial nas telas touch.",recipe:{earth:[.38,.68],water:[.1,.3],heat:[.45,.82],ticksNeeded:12,hint:"Terra + gua, calor mdio."}},{z:50,symbol:"Sn",name:"Estanho",cat:"metal-representativo",period:5,group:14,row:5,col:14,mass:118.71,alch:" Jpiter",desc:"Metal de Jpiter. Bronze = cobre + estanho. Soldagem.",recipe:{earth:[.3,.62],water:[.1,.3],heat:[.42,.8],ticksNeeded:10,hint:"Terra + gua, calor mdio.  Jpiter  o estanho nobre."}},{z:51,symbol:"Sb",name:"Antimnio",cat:"semi-metal",period:5,group:15,row:5,col:15,mass:121.76,alch:" Antimnio",desc:"Usado pelos antigos egpcios como kohl. Semi-metal.",recipe:{earth:[.35,.65],fire:[.25,.5],heat:[.45,.85],ticksNeeded:12,hint:"Terra + Fogo, calor moderado-alto."}},{z:52,symbol:"Te",name:"Telrio",cat:"semi-metal",period:5,group:16,row:5,col:16,mass:127.6,desc:"Semi-metal raro. Cheiro de alho se inalado.",recipe:{earth:[.32,.62],fire:[.22,.48],water:[.08,.28],heat:[.45,.85],ticksNeeded:13,hint:"Terra + Fogo + pouca gua, calor alto."}},{z:53,symbol:"I",name:"Iodo",cat:"halogeno",period:5,group:17,row:5,col:17,mass:126.904,alch:"Violeta Sublime",desc:"Slido que sublima diretamente em vapor violeta.",recipe:{water:[.25,.55],air:[.12,.4],fire:[.22,.5],heat:[.35,.72],ops:["SUBLIMATIO"],ticksNeeded:12,hint:"gua + Ar + Fogo + SUBLIMATIO. O vapor violeta do iodo!"}},{z:54,symbol:"Xe",name:"Xennio",cat:"gas-nobre",period:5,group:18,row:5,col:18,mass:131.293,desc:"Gs nobre anestsico. Propulso inica espacial.",recipe:{air:[.5,.88],heat:[.12,.35],ops:["SUBLIMATIO"],ticksNeeded:12,hint:"Ar dominante + baixo calor + SUBLIMATIO. O estrangeiro gasoso."}},{z:55,symbol:"Cs",name:"Csio",cat:"alcali",period:6,group:1,row:6,col:1,mass:132.905,desc:"Metal mais reativo ao ar. Relgios atmicos de csio.",recipe:{fire:[.62,.95],earth:[.04,.2],heat:[.45,.82],ticksNeeded:15,hint:" Fogo mximo + pouca Terra. Extremamente reativo."}},{z:56,symbol:"Ba",name:"Brio",cat:"alcalino-terroso",period:6,group:2,row:6,col:2,mass:137.327,desc:"xido de brio em raios-X. Sulfato opaco para contraste.",recipe:{earth:[.32,.65],fire:[.32,.65],heat:[.52,.9],ticksNeeded:15,hint:"Terra + Fogo, calor alto."}},{z:72,symbol:"Hf",name:"Hfnio",cat:"transicao",period:6,group:4,row:6,col:4,mass:178.49,desc:"Controle de reatores nucleares. Absorve nutrons.",recipe:{earth:[.48,.82],fire:[.18,.4],heat:[.6,.95],opusPhase:"NIGREDO",ticksNeeded:22,hint:"Terra + Fogo + NIGREDO opus. O guardio dos nutrons."}},{z:73,symbol:"Ta",name:"Tntalo",cat:"transicao",period:6,group:5,row:6,col:5,mass:180.948,desc:"Biocompatvel. Usado em implantes mdicos.",recipe:{earth:[.45,.8],fire:[.22,.48],heat:[.62,.97],opusPhase:"NIGREDO",ticksNeeded:22,hint:"Terra + Fogo + NIGREDO opus. O metal imortal."}},{z:74,symbol:"W",name:"Tungstnio",cat:"transicao",period:6,group:6,row:6,col:6,mass:183.84,alch:"Espuma de Lobo",desc:"Maior ponto de fuso de todos os metais: 3422C.",recipe:{earth:[.52,.88],fire:[.32,.62],heat:[.72,1],opusPhase:"RUBEDO",ticksNeeded:25,hint:"Terra + Fogo + RUBEDO opus + calor mximo. O metal dos filamentos!"}},{z:75,symbol:"Re",name:"Rnio",cat:"transicao",period:6,group:7,row:6,col:7,mass:186.207,desc:"Metal rarssimo. Ps de turbinas supersnicas.",recipe:{earth:[.48,.82],fire:[.3,.58],heat:[.7,1],opusPhase:"RUBEDO",ticksNeeded:25,hint:"Terra + Fogo intenso + RUBEDO opus."}},{z:76,symbol:"Os",name:"smio",cat:"transicao",period:6,group:8,row:6,col:8,mass:190.23,desc:"Metal mais denso do universo. Cheiro de oznio.",recipe:{earth:[.45,.78],fire:[.35,.62],heat:[.68,1],opusPhase:"RUBEDO",ticksNeeded:25,hint:"Terra + Fogo intenso + RUBEDO opus. A densidade mxima."}},{z:77,symbol:"Ir",name:"Irdio",cat:"transicao",period:6,group:9,row:6,col:9,mass:192.217,desc:"Metal de meteorito. Fronteira K-T  extino dos dinossauros.",recipe:{earth:[.42,.78],fire:[.38,.65],heat:[.7,1],ops:["CALCINATIO"],opusPhase:"RUBEDO",ticksNeeded:28,hint:"Terra + Fogo + CALCINATIO + RUBEDO. O metal dos meteoritos."}},{z:78,symbol:"Pt",name:"Platina",cat:"transicao",period:6,group:10,row:6,col:10,mass:195.084,alch:"Prata Branca",desc:"Catalisador nobre. Joias e conversores catalticos.",recipe:{earth:[.35,.68],fire:[.35,.65],heat:[.68,1],opusPhase:"RUBEDO",ticksNeeded:25,hint:"Terra + Fogo equilibrados + RUBEDO opus. A prata branca nobre."}},{z:79,symbol:"Au",name:"Ouro",cat:"transicao",period:6,group:11,row:6,col:11,mass:196.967,alch:" Sol/Aurum",desc:"A Grande Obra. O Ouro Filosfico. A transmutao final.",recipe:{earth:[.3,.65],fire:[.3,.65],heat:[.72,1],ops:["COAGULA"],opusPhase:"RUBEDO",lapisRequired:!0,ticksNeeded:40,hint:" RUBEDO + Lapis + COAGULA + calor alto. A Grande Obra est prxima!"}},{z:80,symbol:"Hg",name:"Mercrio",cat:"transicao",period:6,group:12,row:6,col:12,mass:200.59,alch:" Mercurius",desc:"O nico metal lquido em temp. ambiente. Vivo, fluido.",recipe:{water:[.3,.65],fire:[.28,.58],heat:[.42,.82],ops:["FERMENTATIO"],ticksNeeded:12,hint:"gua + Fogo + FERMENTATIO.  O Mercrio Alqumico vivo!"}},{z:81,symbol:"Tl",name:"Tlio",cat:"metal-representativo",period:6,group:13,row:6,col:13,mass:204.383,desc:"Metal txico. Veneno favorito de assassinos.",recipe:{earth:[.35,.65],fire:[.22,.5],heat:[.52,.9],opusPhase:"NIGREDO",ticksNeeded:20,hint:"Terra + Fogo + NIGREDO opus. O metal da sombra."}},{z:82,symbol:"Pb",name:"Chumbo",cat:"metal-representativo",period:6,group:14,row:6,col:14,mass:207.2,alch:" Saturno/Plumbum",desc:"O Chumbo de Saturno. Incio da Grande Obra.",recipe:{earth:[.42,.75],fire:[.22,.48],heat:[.45,.85],ticksNeeded:8,hint:" Terra + Fogo, calor mdio. O incio  Plumbum/Saturno."}},{z:83,symbol:"Bi",name:"Bismuto",cat:"metal-representativo",period:6,group:15,row:6,col:15,mass:208.98,desc:"Cristais geomtricos iridescentes. Relativamente seguro.",recipe:{earth:[.35,.65],fire:[.3,.58],heat:[.5,.9],ticksNeeded:14,hint:"Terra + Fogo, calor alto."}},{z:84,symbol:"Po",name:"Polnio",cat:"semi-metal",period:6,group:16,row:6,col:16,mass:209,desc:"Radioativo letal. Usado no assassinato de Litvinenko.",recipe:{earth:[.22,.48],fire:[.42,.72],heat:[.72,1],opusPhase:"RUBEDO",ticksNeeded:30,hint:"Fogo dominante + RUBEDO opus + calor mximo. Radioativo!"}},{z:85,symbol:"At",name:"stato",cat:"halogeno",period:6,group:17,row:6,col:17,mass:210,desc:"O elemento mais raro que ocorre naturalmente. ~30g na Terra.",recipe:{fire:[.42,.72],air:[.2,.45],heat:[.65,1],opusPhase:"RUBEDO",ticksNeeded:32,hint:"Fogo + Ar + RUBEDO opus + calor mximo. Extremamente raro!"}},{z:86,symbol:"Rn",name:"Radnio",cat:"gas-nobre",period:6,group:18,row:6,col:18,mass:222,desc:"Gs nobre radioativo. Se acumula em pores.",recipe:{air:[.4,.85],heat:[.45,.82],opusPhase:"NIGREDO",ops:["SUBLIMATIO"],ticksNeeded:25,hint:"Ar + calor mdio + NIGREDO + SUBLIMATIO. O gs invisvel radioativo."}},{z:87,symbol:"Fr",name:"Frncio",cat:"alcali",period:7,group:1,row:7,col:1,mass:223,desc:"Metal alcalino mais instvel. Existe por milissegundos.",recipe:{fire:[.72,1],heat:[.72,1],lapisRequired:!0,ticksNeeded:45,hint:"Fogo + calor mximos + Lapis. A instabilidade extrema."}},{z:88,symbol:"Ra",name:"Rdio",cat:"alcalino-terroso",period:7,group:2,row:7,col:2,mass:226,alch:"Marie Curie",desc:"Marie Curie morreu por ele. Luminescncia nas trevas.",recipe:{earth:[.3,.62],fire:[.4,.72],heat:[.72,1],opusPhase:"CITRINITAS",ticksNeeded:30,hint:"Terra + Fogo + CITRINITAS + calor mximo. O brilho mortal."}},{z:104,symbol:"Rf",name:"Ruterfrdio",cat:"transicao",period:7,group:4,row:7,col:4,mass:267,desc:"Elemento sinttico. Criado em aceleradores.",recipe:{earth:[.4,.7],fire:[.4,.7],heat:[.8,1],lapisRequired:!0,ticksNeeded:55,hint:"Terra + Fogo intensos + Lapis + calor extremo."}},{z:105,symbol:"Db",name:"Dbnio",cat:"transicao",period:7,group:5,row:7,col:5,mass:268,desc:"Sinttico. Meia-vida de 28 horas.",recipe:{earth:[.35,.68],fire:[.42,.72],heat:[.82,1],lapisRequired:!0,ticksNeeded:58,hint:"Terra + Fogo + Lapis + calor extremo."}},{z:106,symbol:"Sg",name:"Seabrgio",cat:"transicao",period:7,group:6,row:7,col:6,mass:271,desc:"Sinttico. Homenagem a Glenn Seaborg.",recipe:{earth:[.35,.68],fire:[.42,.72],heat:[.85,1],lapisRequired:!0,ticksNeeded:60,hint:"Condies extremas + Lapis forjada."}},{z:107,symbol:"Bh",name:"Bhrio",cat:"transicao",period:7,group:7,row:7,col:7,mass:272,desc:"Sinttico. Homenagem a Niels Bohr.",recipe:{earth:[.35,.68],fire:[.45,.75],heat:[.88,1],lapisRequired:!0,ticksNeeded:62,hint:"Condies extremas + Lapis."}},{z:108,symbol:"Hs",name:"Hssio",cat:"transicao",period:7,group:8,row:7,col:8,mass:270,desc:"Sinttico. Apenas alguns tomos produzidos.",recipe:{earth:[.35,.65],fire:[.45,.75],heat:[.88,1],lapisRequired:!0,ticksNeeded:62,hint:"Condies extremas + Lapis."}},{z:109,symbol:"Mt",name:"Meitnrio",cat:"desconhecido",period:7,group:9,row:7,col:9,mass:278,desc:"Homenagem a Lise Meitner. Propriedades desconhecidas.",recipe:{earth:[.3,.65],fire:[.48,.78],heat:[.9,1],lapisRequired:!0,ticksNeeded:65,hint:"Fogo intensssimo + Lapis + calor extremo."}},{z:110,symbol:"Ds",name:"Darmstcio",cat:"desconhecido",period:7,group:10,row:7,col:10,mass:281,desc:"Produzido em 1994. Meia-vida de microssegundos.",recipe:{earth:[.3,.62],fire:[.5,.8],heat:[.9,1],lapisRequired:!0,ticksNeeded:65,hint:"Condies extremas mximas + Lapis."}},{z:111,symbol:"Rg",name:"Roentgnio",cat:"desconhecido",period:7,group:11,row:7,col:11,mass:282,desc:"Homenagem a Rntgen (raios-X). Sinttico instvel.",recipe:{earth:[.28,.6],fire:[.5,.82],heat:[.92,1],lapisRequired:!0,ticksNeeded:68,hint:"Condies mximas + Lapis forjada."}},{z:112,symbol:"Cn",name:"Coperncio",cat:"transicao",period:7,group:12,row:7,col:12,mass:285,desc:"Homenagem a Coprnico. Pode ser gasoso em temp. ambiente.",recipe:{earth:[.25,.58],fire:[.5,.82],heat:[.92,1],lapisRequired:!0,ticksNeeded:68,hint:"Condies mximas + Lapis."}},{z:113,symbol:"Nh",name:"Nihnio",cat:"metal-representativo",period:7,group:13,row:7,col:13,mass:286,desc:"Descoberto pelo Japo em 2016. O Nh do Nihon.",recipe:{earth:[.25,.58],fire:[.52,.85],heat:[.93,1],lapisRequired:!0,ticksNeeded:70,hint:"Condies mximas extremas + Lapis."}},{z:114,symbol:"Fl",name:"Flervio",cat:"metal-representativo",period:7,group:14,row:7,col:14,mass:289,desc:"Pode ser um gs nobre. Extremamente instvel.",recipe:{earth:[.22,.55],fire:[.55,.88],heat:[.95,1],lapisRequired:!0,ticksNeeded:72,hint:"Condies extremas mximas + Lapis."}},{z:115,symbol:"Mc",name:"Moscvio",cat:"metal-representativo",period:7,group:15,row:7,col:15,mass:290,desc:"Produzido em 2003. Meia-vida de 220ms.",recipe:{earth:[.2,.52],fire:[.55,.88],heat:[.95,1],lapisRequired:!0,ticksNeeded:72,hint:"Condies extremas + Lapis."}},{z:116,symbol:"Lv",name:"Livermrio",cat:"metal-representativo",period:7,group:16,row:7,col:16,mass:293,desc:"Homenagem ao Livermore Lab. Decai muito rpido.",recipe:{earth:[.18,.5],fire:[.58,.9],heat:[.96,1],lapisRequired:!0,ticksNeeded:75,hint:"Condies mximas + Lapis forjada."}},{z:117,symbol:"Ts",name:"Tenessnio",cat:"halogeno",period:7,group:17,row:7,col:17,mass:294,desc:"Produzido em 2010. Segundo mais pesado da tabela.",recipe:{fire:[.6,.92],air:[.18,.42],heat:[.96,1],lapisRequired:!0,ticksNeeded:78,hint:"Fogo + Ar + condies extremas + Lapis."}},{z:118,symbol:"Og",name:"Oganessnio",cat:"gas-nobre",period:7,group:18,row:7,col:18,mass:294,desc:"O elemento mais pesado conhecido. 5 tomos j foram criados.",recipe:{heat:[.98,1],lapisRequired:!0,ticksNeeded:100,hint:" Lapis + calor mximo absoluto. O fim da tabela peridica!"}},{z:57,symbol:"La",name:"Lantnio",cat:"lantanideo",period:6,group:null,row:8,col:3,mass:138.905,desc:"Incio dos lantandeos. Catalisadores de refino de petrleo.",recipe:{earth:[.4,.72],fire:[.22,.48],heat:[.52,.9],opusPhase:"NIGREDO",ticksNeeded:20,hint:"Terra + Fogo + NIGREDO opus. O incio das terras raras."}},{z:58,symbol:"Ce",name:"Crio",cat:"lantanideo",period:6,group:null,row:8,col:4,mass:140.116,desc:"Mais abundante dos lantandeos. Isqueiros de pederneira.",recipe:{earth:[.4,.72],fire:[.25,.5],heat:[.52,.9],opusPhase:"NIGREDO",ticksNeeded:20,hint:"Terra + Fogo + NIGREDO opus."}},{z:59,symbol:"Pr",name:"Praseodmio",cat:"lantanideo",period:6,group:null,row:8,col:5,mass:140.908,desc:"ms superpoderosos com neodmio.",recipe:{earth:[.38,.7],fire:[.25,.52],heat:[.55,.92],opusPhase:"NIGREDO",ticksNeeded:22,hint:"Terra + Fogo + NIGREDO opus."}},{z:60,symbol:"Nd",name:"Neodmio",cat:"lantanideo",period:6,group:null,row:8,col:6,mass:144.242,desc:"ms de neodmio: os mais fortes do mundo.",recipe:{earth:[.38,.7],fire:[.28,.55],heat:[.55,.92],opusPhase:"NIGREDO",ticksNeeded:22,hint:"Terra + Fogo + NIGREDO opus. O m mais forte."}},{z:61,symbol:"Pm",name:"Promcio",cat:"lantanideo",period:6,group:null,row:8,col:7,mass:145,desc:"nico lantandeo radioativo sem istopos estveis.",recipe:{earth:[.35,.68],fire:[.3,.58],heat:[.58,.95],opusPhase:"NIGREDO",ops:["FERMENTATIO"],ticksNeeded:28,hint:"Terra + Fogo + NIGREDO + FERMENTATIO. O lantandeo sinttico."}},{z:62,symbol:"Sm",name:"Samrio",cat:"lantanideo",period:6,group:null,row:8,col:8,mass:150.36,desc:"ms de samrio-cobalto. Resistentes ao calor.",recipe:{earth:[.38,.7],fire:[.28,.55],heat:[.55,.92],opusPhase:"ALBEDO",ticksNeeded:23,hint:"Terra + Fogo + ALBEDO opus."}},{z:63,symbol:"Eu",name:"Eurpio",cat:"lantanideo",period:6,group:null,row:8,col:9,mass:151.964,desc:"Faz o vermelho brilhar nas telas de TV e notas de euro.",recipe:{earth:[.35,.68],fire:[.3,.58],heat:[.58,.92],opusPhase:"ALBEDO",ticksNeeded:24,hint:"Terra + Fogo + ALBEDO opus."}},{z:64,symbol:"Gd",name:"Gadolnio",cat:"lantanideo",period:6,group:null,row:8,col:10,mass:157.25,desc:"Contraste em ressonncia magntica. Superconductividade.",recipe:{earth:[.38,.7],fire:[.3,.58],heat:[.58,.95],opusPhase:"ALBEDO",ticksNeeded:24,hint:"Terra + Fogo + ALBEDO opus."}},{z:65,symbol:"Tb",name:"Trbio",cat:"lantanideo",period:6,group:null,row:8,col:11,mass:158.925,desc:"Luz verde em telas de computador. Magnetorestrio.",recipe:{earth:[.38,.7],fire:[.32,.6],heat:[.6,.95],opusPhase:"CITRINITAS",ticksNeeded:25,hint:"Terra + Fogo + CITRINITAS opus."}},{z:66,symbol:"Dy",name:"Disprsio",cat:"lantanideo",period:6,group:null,row:8,col:12,mass:162.5,desc:'ms de motor eltrico. "Difcil de obter"  do grego.',recipe:{earth:[.38,.7],fire:[.32,.6],heat:[.6,.95],opusPhase:"CITRINITAS",ticksNeeded:25,hint:"Terra + Fogo + CITRINITAS opus. Difcil de obter!"}},{z:67,symbol:"Ho",name:"Hlmio",cat:"lantanideo",period:6,group:null,row:8,col:13,mass:164.93,desc:"Maior momento magntico de todos os elementos.",recipe:{earth:[.4,.72],fire:[.32,.6],heat:[.62,.97],opusPhase:"CITRINITAS",ticksNeeded:26,hint:"Terra + Fogo + CITRINITAS opus."}},{z:68,symbol:"Er",name:"rbio",cat:"lantanideo",period:6,group:null,row:8,col:14,mass:167.259,desc:"Amplificadores pticos de fibra. Rosa elegante.",recipe:{earth:[.4,.72],fire:[.32,.62],heat:[.62,.97],opusPhase:"CITRINITAS",ticksNeeded:26,hint:"Terra + Fogo + CITRINITAS opus."}},{z:69,symbol:"Tm",name:"Tlio",cat:"lantanideo",period:6,group:null,row:8,col:15,mass:168.934,desc:"Rarssimo. Portteis de raios-X mdicos.",recipe:{earth:[.38,.7],fire:[.35,.65],heat:[.65,1],opusPhase:"RUBEDO",ticksNeeded:30,hint:"Terra + Fogo + RUBEDO opus + calor alto."}},{z:70,symbol:"Yb",name:"Itrbio",cat:"lantanideo",period:6,group:null,row:8,col:16,mass:173.054,desc:"Relgios de preciso atmica mais exatos do mundo.",recipe:{earth:[.38,.7],fire:[.35,.65],heat:[.65,1],opusPhase:"RUBEDO",ticksNeeded:30,hint:"Terra + Fogo + RUBEDO opus."}},{z:71,symbol:"Lu",name:"Lutcio",cat:"lantanideo",period:6,group:null,row:8,col:17,mass:174.967,desc:"ltimo lantandeo. Cintiladores para PET scan.",recipe:{earth:[.4,.72],fire:[.38,.68],heat:[.68,1],opusPhase:"RUBEDO",ticksNeeded:32,hint:"Terra + Fogo + RUBEDO opus. O ltimo lantandeo."}},{z:89,symbol:"Ac",name:"Actnio",cat:"actinineo",period:7,group:null,row:9,col:3,mass:227,desc:"Incio dos actindeos. Raro e radioativo.",recipe:{earth:[.38,.7],fire:[.35,.65],heat:[.68,1],opusPhase:"RUBEDO",lapisRequired:!0,ticksNeeded:35,hint:"Terra + Fogo + RUBEDO + Lapis."}},{z:90,symbol:"Th",name:"Trio",cat:"actinineo",period:7,group:null,row:9,col:4,mass:232.038,desc:"Combustvel nuclear limpo. Mais abundante que urnio.",recipe:{earth:[.4,.75],fire:[.38,.68],heat:[.72,1],opusPhase:"RUBEDO",ticksNeeded:30,hint:"Terra + Fogo intenso + RUBEDO opus. Potncia nuclear."}},{z:91,symbol:"Pa",name:"Protactnio",cat:"actinineo",period:7,group:null,row:9,col:5,mass:231.036,desc:"Intermedirio na produo de urnio-233.",recipe:{earth:[.38,.72],fire:[.38,.68],heat:[.72,1],opusPhase:"RUBEDO",lapisRequired:!0,ticksNeeded:40,hint:"Terra + Fogo + RUBEDO + Lapis."}},{z:92,symbol:"U",name:"Urnio",cat:"actinineo",period:7,group:null,row:9,col:6,mass:238.029,desc:"A fisso nuclear. Hiroshima, Nagasaki, e energia limpa.",recipe:{earth:[.4,.75],fire:[.4,.72],heat:[.75,1],opusPhase:"RUBEDO",ticksNeeded:32,hint:"Terra + Fogo muito intenso + RUBEDO opus. A fisso nuclear!"}},{z:93,symbol:"Np",name:"Netnio",cat:"actinineo",period:7,group:null,row:9,col:7,mass:237,desc:"Primeiro transurnio sinttico descoberto.",recipe:{earth:[.35,.68],fire:[.42,.72],heat:[.78,1],lapisRequired:!0,ticksNeeded:45,hint:"Terra + Fogo intenso + Lapis."}},{z:94,symbol:"Pu",name:"Plutnio",cat:"actinineo",period:7,group:null,row:9,col:8,mass:244,desc:"Bomba atmica. Extremamente txico e radioativo.",recipe:{earth:[.35,.68],fire:[.45,.75],heat:[.82,1],lapisRequired:!0,ticksNeeded:48,hint:"Terra + Fogo + Lapis + calor extremo. Perigo nuclear!"}},{z:95,symbol:"Am",name:"Amercio",cat:"actinineo",period:7,group:null,row:9,col:9,mass:243,desc:"Detectores de fumaa. Produzido de plutnio.",recipe:{earth:[.32,.65],fire:[.45,.75],heat:[.82,1],lapisRequired:!0,ticksNeeded:50,hint:"Terra + Fogo + Lapis."}},{z:96,symbol:"Cm",name:"Crio",cat:"actinineo",period:7,group:null,row:9,col:10,mass:247,desc:"Homenagem a Pierre e Marie Curie.",recipe:{earth:[.3,.62],fire:[.48,.78],heat:[.85,1],lapisRequired:!0,ticksNeeded:52,hint:"Terra + Fogo intenso + Lapis."}},{z:97,symbol:"Bk",name:"Berqulio",cat:"actinineo",period:7,group:null,row:9,col:11,mass:247,desc:"Produzido em Berkeley, CA. Poucos microgramas feitos.",recipe:{earth:[.28,.6],fire:[.5,.82],heat:[.87,1],lapisRequired:!0,ticksNeeded:55,hint:"Condies extremas + Lapis."}},{z:98,symbol:"Cf",name:"Califrnio",cat:"actinineo",period:7,group:null,row:9,col:12,mass:251,desc:"Custo: $27 milhes/grama. Fonte de nutrons.",recipe:{earth:[.25,.58],fire:[.52,.85],heat:[.9,1],lapisRequired:!0,ticksNeeded:58,hint:"Condies extremas mximas + Lapis."}},{z:99,symbol:"Es",name:"Einstenio",cat:"actinineo",period:7,group:null,row:9,col:13,mass:252,desc:'Descoberto aps o teste nuclear "Ivy Mike" de 1952.',recipe:{earth:[.22,.55],fire:[.55,.88],heat:[.92,1],lapisRequired:!0,ticksNeeded:60,hint:"Condies extremas + Lapis."}},{z:100,symbol:"Fm",name:"Frmio",cat:"actinineo",period:7,group:null,row:9,col:14,mass:257,desc:"Homenagem a Enrico Fermi. Sinttico radioativo.",recipe:{earth:[.2,.52],fire:[.58,.9],heat:[.93,1],lapisRequired:!0,ticksNeeded:62,hint:"Condies extremas + Lapis."}},{z:101,symbol:"Md",name:"Mendelvio",cat:"actinineo",period:7,group:null,row:9,col:15,mass:258,desc:"Homenagem a Mendeleev, criador da tabela peridica.",recipe:{earth:[.18,.5],fire:[.6,.92],heat:[.95,1],lapisRequired:!0,ticksNeeded:65,hint:"Condies mximas + Lapis."}},{z:102,symbol:"No",name:"Noblio",cat:"actinineo",period:7,group:null,row:9,col:16,mass:259,desc:"Homenagem a Alfred Nobel (prmio Nobel).",recipe:{earth:[.15,.48],fire:[.62,.92],heat:[.96,1],lapisRequired:!0,ticksNeeded:68,hint:"Condies extremas mximas + Lapis."}},{z:103,symbol:"Lr",name:"Laurncio",cat:"actinineo",period:7,group:null,row:9,col:17,mass:266,desc:"ltimo actindeo. Homenagem a Ernest Lawrence.",recipe:{earth:[.15,.48],fire:[.62,.92],heat:[.97,1],lapisRequired:!0,ticksNeeded:70,hint:"Condies extremas mximas + Lapis. O ltimo actindeo!"}}],IY=new Map(gm.map(e=>[e.z,e]));function PY(e,t,n,r,a,i){const[s,c]=e.heat;if(n<s||n>c||e.lapisRequired&&i!=="FORGED"||e.opusPhase&&a!==e.opusPhase)return!1;if(e.ops){for(const d of e.ops)if(!r.has(d))return!1}const l=(d,u)=>!d||u>=d[0]&&u<=d[1];return l(e.earth,t.earth)&&l(e.water,t.water)&&l(e.air,t.air)&&l(e.fire,t.fire)}const CC=new Set([1,2,6,7,8,16,26]),FY=["alcali","alcalino-terroso","transicao","lantanideo","actinineo","metal-representativo","semi-metal","nao-metal","halogeno","gas-nobre","desconhecido"],_Y=`
@keyframes flash-solve      { 0%{opacity:.5}  70%{opacity:.1} 100%{opacity:0} }
@keyframes flash-coagula    { 0%{opacity:.55} 70%{opacity:.12} 100%{opacity:0} }
@keyframes flash-calcinatio { 0%{opacity:.7}  60%{opacity:.2} 100%{opacity:0} }
@keyframes flash-sublimatio { 0%{opacity:.5}  70%{opacity:.08} 100%{opacity:0} }
@keyframes flash-fermentatio{ 0%{opacity:.45} 70%{opacity:.1} 100%{opacity:0} }
@keyframes flash-putrefactio{ 0%{opacity:.8}  50%{opacity:.4} 100%{opacity:0} }
@keyframes flash-circulatio { 0%{opacity:.45} 70%{opacity:.08} 100%{opacity:0} }
@keyframes flash-fixatio    { 0%{opacity:.55} 70%{opacity:.12} 100%{opacity:0} }
@keyframes orbit-1 { from{transform:rotate(0deg)} to{transform:rotate(360deg)} }
@keyframes orbit-2 { from{transform:rotate(120deg)} to{transform:rotate(480deg)} }
@keyframes orbit-3 { from{transform:rotate(240deg)} to{transform:rotate(600deg)} }
@keyframes nucleus-pulse { 0%,100%{box-shadow:0 0 20px var(--el-color,#fff)} 50%{box-shadow:0 0 50px var(--el-color,#fff)} }
@keyframes modal-in { from{opacity:0;transform:scale(.9) translateY(30px)} to{opacity:1;transform:scale(1) translateY(0)} }
@keyframes badge-bounce { 0%,100%{transform:scale(1)} 40%{transform:scale(1.15)} 60%{transform:scale(.95)} }
@keyframes glow-pulse { 0%,100%{opacity:.65} 50%{opacity:1} }
@keyframes slide-in-left { from{transform:translateX(-100%);opacity:0} to{transform:translateX(0);opacity:1} }
@keyframes progress-fill { from{width:0} to{width:var(--w)} }
.alchemy-hud-enter { animation: slide-in-left .25s ease-out; }
`,NY={solve:"rgba(100,170,255,.18)",coagula:"rgba(255,150,40,.22)",calcinatio:"rgba(255,70,20,.28)",sublimatio:"rgba(120,220,255,.18)",fermentatio:"rgba(60,210,60,.18)",putrefactio:"rgba(90,0,90,.38)",circulatio:"rgba(150,70,255,.18)",fixatio:"rgba(50,180,180,.22)"},OY=[{id:"solve",label:"Solve",latin:"Solutio",icon:"",color:"#5aafff",desc:"Dissolve  dispersa partculas, separa o fixo do voltil."},{id:"coagula",label:"Coagula",latin:"Coagulatio",icon:"",color:"#ffaa30",desc:"Coagula  une partculas, solidifica o voltil em forma estvel."},{id:"calcinatio",label:"Calcinatio",latin:"Calcinatio",icon:"",color:"#ff5020",desc:"Eleva calor +35%. Purifica pela chama. Desbloqueia elementos de alta temperatura."},{id:"sublimatio",label:"Sublimatio",latin:"Sublimatio",icon:"",color:"#80e8ff",desc:"Eleva Ar, reduz Terra. O slido se torna voltil  gases nobres e halognios."},{id:"fermentatio",label:"Fermentatio",latin:"Fermentatio",icon:"",color:"#50dd50",desc:"Equilibra os 4 elementos em 25% cada  ativa Quintessncia mxima."},{id:"putrefactio",label:"Putrefactio",latin:"Putrefactio",icon:"",color:"#aa40aa",desc:"Regride tudo ao Plmbum  reinicia o ciclo alqumico."},{id:"circulatio",label:"Circulatio",latin:"Circulatio",icon:"",color:"#a060ff",desc:"Fora orbital circular  COAGULA  SOLVE em ciclo rpido."},{id:"fixatio",label:"Fixatio",latin:"Fixatio",icon:"",color:"#40cccc",desc:"Congela velocidades + reduz calor. Cristaliza o caos em ordem."}],r5={attractor:{label:"Atrator",color:Uh.attractor,icon:"",desc:"Puxa partculas  o forno absorvente"},repulsor:{label:"Repulsor",color:Uh.repulsor,icon:"",desc:"Expele partculas  o forno repelente"},channel:{label:"Canal",color:Uh.channel,icon:"",desc:"Guia o fluxo em uma direo"},barrier:{label:"Barreira",color:Uh.barrier,icon:"",desc:"Barreira quntica  pode ser tunelada"},tunnel:{label:"Tnel",color:Uh.tunnel,icon:"",desc:"Canal quntico  passagem seletiva"}},af={earth:{sym:"",label:"Terra",color:"#8b7a55",hint:"Solidez  Metais  Minerais"},water:{sym:"",label:"gua",color:"#3a7fa0",hint:"Fluidez  Hidrognio  Dissoluo"},air:{sym:"",label:"Ar",color:"#90b0c0",hint:"Volatilidade  Gases  Leveza"},fire:{sym:"",label:"Fogo",color:"#c8561e",hint:"Reatividade  Calor  Energia"}},DY=({k:e,value:t,onChange:n})=>{const r=S.useRef(null),a=S.useRef({active:!1,startAngle:0,startValue:0}),{sym:i,label:s,color:c,hint:l}=af[e],d=50,u=25,h=25,m=20,f=j=>{const I=r.current.getBoundingClientRect();return Math.atan2(j.clientY-(I.top+I.height/2),j.clientX-(I.left+I.width/2))*180/Math.PI},g=j=>{j.preventDefault(),a.current={active:!0,startAngle:f(j),startValue:t}};S.useEffect(()=>{const j=E=>{if(!a.current.active)return;const O=(f(E)-a.current.startAngle)/240;n(Math.max(.01,Math.min(1,a.current.startValue+O)))},I=()=>{a.current.active=!1};return window.addEventListener("mousemove",j),window.addEventListener("mouseup",I),()=>{window.removeEventListener("mousemove",j),window.removeEventListener("mouseup",I)}},[n]);const x=j=>[u+m*Math.cos(j*Math.PI/180),h+m*Math.sin(j*Math.PI/180)],v=150,[b,w]=x(v),[M,k]=x(v+t*240),R=t*240>180?1:0;return o.jsxs("div",{className:"flex flex-col items-center gap-0.5 select-none cursor-ns-resize",title:l,onMouseDown:g,children:[o.jsxs("svg",{ref:r,width:d,height:d,style:{filter:t>.4?`drop-shadow(0 0 ${t*4}px ${c})`:"none"},children:[o.jsx("path",{d:`M ${b} ${w} A ${m} ${m} 0 1 1 ${x(v+240)[0]} ${x(v+240)[1]}`,fill:"none",stroke:"rgba(255,255,255,.07)",strokeWidth:2.2,strokeLinecap:"round"}),t>.01&&o.jsx("path",{d:`M ${b} ${w} A ${m} ${m} 0 ${R} 1 ${M} ${k}`,fill:"none",stroke:c,strokeWidth:2.2,strokeLinecap:"round",opacity:.85}),o.jsx("text",{x:u,y:h+4,textAnchor:"middle",fill:c,fontSize:11,fontFamily:"serif",opacity:.9,children:i})]}),o.jsx("div",{style:{fontSize:6,color:c+"aa",letterSpacing:".1em",textTransform:"uppercase"},children:s}),o.jsxs("div",{style:{fontSize:6,color:c+"55",fontFamily:"monospace"},children:[Math.round(t*100),"%"]})]})},LY=({value:e,onChange:t})=>{const n=`hsl(${Math.max(0,30-e*32)},88%,52%)`;return o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:3},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsx("span",{style:{fontSize:6.5,color:"rgba(255,255,255,.3)",textTransform:"uppercase",letterSpacing:".1em"},children:" Calor do Atanor"}),o.jsxs("span",{style:{fontSize:8,fontFamily:"monospace",color:n},children:[Math.round(e*100),""]})]}),o.jsxs("div",{style:{position:"relative",height:6,background:"rgba(255,255,255,.06)",borderRadius:3,overflow:"visible"},children:[o.jsx("div",{style:{position:"absolute",left:0,top:0,height:"100%",width:`${e*100}%`,background:`linear-gradient(90deg, rgba(100,100,255,.6), ${n})`,borderRadius:3,transition:"width .05s",boxShadow:`0 0 ${e*8}px ${n}66`}}),o.jsx("input",{type:"range",min:0,max:1,step:.01,value:e,onChange:r=>t(parseFloat(r.target.value)),style:{position:"absolute",inset:0,opacity:0,cursor:"pointer",width:"100%",margin:0}})]}),o.jsxs("div",{style:{fontSize:6,color:"rgba(255,255,255,.2)",lineHeight:1.4},children:[e<.25&&"Frio  Gases nobres, elementos leves",e>=.25&&e<.55&&"Moderado  Metais de transio, sais",e>=.55&&e<.8&&"Quente  Metais pesados, lantandeos",e>=.8&&"Extremo  Actindeos, elementos sintticos, Opus RUBEDO"]})]})},zY=({entry:e,onBookmark:t})=>{const n=S.useRef(null);S.useEffect(()=>{n.current&&wY(n.current,e.glyphSpec,36)},[e.glyphSpec]);const r={NIGREDO:"#555",ALBEDO:"#aac",CITRINITAS:"#da0",RUBEDO:"#800"};return o.jsxs("div",{className:`flex gap-2 p-1.5 rounded border ${e.bookmarked?"border-amber-600/30 bg-amber-900/8":"border-white/[.04] bg-white/[.015]"}`,children:[o.jsx("canvas",{ref:n,width:36,height:36,className:"rounded flex-shrink-0"}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[o.jsxs("div",{className:"flex items-center gap-1 flex-wrap",children:[e.phase&&o.jsx("span",{className:"text-[5px] font-mono uppercase px-1 rounded",style:{color:r[e.phase]??"#888",background:r[e.phase]+"18"},children:e.phase}),e.event&&o.jsx("span",{className:"text-[5px] font-mono px-1 rounded bg-red-900/25 text-red-400",children:e.event}),o.jsx("span",{className:"text-[5px] font-mono text-white/20",children:jY(e.timestamp)})]}),o.jsx("button",{title:"Bookmark",onClick:t,className:`${e.bookmarked?"text-amber-400":"text-white/15 hover:text-amber-500/40"}`,children:o.jsx(nS,{size:7})})]}),o.jsx("p",{className:"text-[6.5px] font-serif text-white/55 leading-snug line-clamp-3 mb-0.5",children:e.text}),o.jsx("p",{className:"text-[5.5px] font-mono text-white/2 italic",children:e.causalLine})]})]})},Yb=({orbit:e,speed:t,color:n,delay:r=0})=>o.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:e*2,height:e*2,marginTop:-e,marginLeft:-e,borderRadius:"50%",border:`1px solid ${n}28`,animation:`orbit-${e%3+1} ${t}s linear infinite`,animationDelay:`${r}s`},children:o.jsx("div",{style:{position:"absolute",top:-3,left:"50%",marginLeft:-3,width:6,height:6,borderRadius:"50%",background:n,boxShadow:`0 0 8px ${n}`,animation:`glow-pulse ${t*.6}s ease-in-out infinite`}})}),BY=({data:e,onContinue:t,onReplay:n})=>{const{element:r,earth:a,water:i,air:s,fire:c,heat:l,opsUsed:d,opusPhase:u,lapisState:h,totalDiscovered:m}=e,f=tl[r.cat],[g,x]=S.useState("story"),v=S.useMemo(()=>{var k;const w=[],M=r.recipe;return M.earth&&w.push(`Terra ${Math.round(M.earth[0]*100)}-${Math.round(M.earth[1]*100)}%`),M.water&&w.push(`gua ${Math.round(M.water[0]*100)}-${Math.round(M.water[1]*100)}%`),M.air&&w.push(`Ar ${Math.round(M.air[0]*100)}-${Math.round(M.air[1]*100)}%`),M.fire&&w.push(`Fogo ${Math.round(M.fire[0]*100)}-${Math.round(M.fire[1]*100)}%`),w.push(`Calor ${Math.round(M.heat[0]*100)}-${Math.round(M.heat[1]*100)}`),(k=M.ops)!=null&&k.length&&w.push(`Ops: ${M.ops.join(", ")}`),M.opusPhase&&w.push(`Opus ${M.opusPhase}`),M.lapisRequired&&w.push("Lapis Forjada"),w},[r]),b=S.useMemo(()=>[{label:"Terra",value:a,color:af.earth.color},{label:"gua",value:i,color:af.water.color},{label:"Ar",value:s,color:af.air.color},{label:"Fogo",value:c,color:af.fire.color},{label:"Calor",value:l,color:`hsl(${Math.max(0,30-l*32)},88%,52%)`}],[a,i,s,c,l]);return o.jsx("div",{style:{position:"fixed",inset:0,zIndex:300,background:"rgba(0,0,0,.93)",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(4px)"},children:o.jsxs("div",{style:{width:520,maxWidth:"90vw",maxHeight:"90vh",background:"rgba(8,6,16,.98)",border:`1px solid ${f.color}44`,borderRadius:16,boxShadow:`0 0 60px ${f.color}22, 0 0 120px rgba(0,0,0,.8)`,display:"flex",flexDirection:"column",animation:"modal-in .4s cubic-bezier(.34,1.56,.64,1) forwards",overflow:"hidden"},children:[o.jsxs("div",{style:{background:`linear-gradient(135deg, ${f.color}18 0%, rgba(8,6,16,0) 60%)`,borderBottom:`1px solid ${f.color}25`,padding:"20px 24px 16px",display:"flex",gap:20,alignItems:"center"},children:[o.jsxs("div",{style:{position:"relative",width:90,height:90,flexShrink:0},children:[o.jsx(Yb,{orbit:38,speed:3.2,color:f.color,delay:0}),o.jsx(Yb,{orbit:28,speed:2.1,color:f.color,delay:.5}),o.jsx(Yb,{orbit:18,speed:1.4,color:f.color,delay:1}),o.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)",width:44,height:44,borderRadius:"50%",background:`radial-gradient(circle, ${f.color}40, ${f.color}12)`,border:`2px solid ${f.color}`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,color:f.color,fontFamily:"serif",fontWeight:700,animation:"nucleus-pulse 2s ease-in-out infinite","--el-color":f.color},children:r.symbol})]}),o.jsxs("div",{style:{flex:1},children:[o.jsxs("div",{style:{fontSize:9,color:`${f.color}99`,letterSpacing:".2em",textTransform:"uppercase",marginBottom:4},children:[" Elemento Descoberto  ",m,"/118"]}),o.jsx("div",{style:{fontSize:26,color:"rgba(255,255,255,.95)",fontWeight:700,lineHeight:1,marginBottom:3},children:r.name}),o.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap",marginBottom:4},children:[o.jsxs("span",{style:{fontSize:9,fontFamily:"monospace",color:"rgba(255,255,255,.45)"},children:["Z = ",r.z]}),o.jsx("span",{style:{fontSize:9,fontFamily:"monospace",color:"rgba(255,255,255,.25)"},children:""}),o.jsxs("span",{style:{fontSize:9,fontFamily:"monospace",color:"rgba(255,255,255,.45)"},children:["M = ",r.mass]}),o.jsx("span",{style:{fontSize:9,fontFamily:"monospace",color:"rgba(255,255,255,.25)"},children:""}),o.jsx("span",{style:{fontSize:9,padding:"2px 7px",borderRadius:10,background:`${f.color}22`,color:f.color,border:`1px solid ${f.color}44`},children:f.label})]}),r.alch&&o.jsxs("div",{style:{fontSize:9,color:`${f.color}77`,fontStyle:"italic"},children:[" ",r.alch]})]})]}),o.jsx("div",{style:{padding:"12px 24px 0",fontSize:11,color:"rgba(255,255,255,.65)",lineHeight:1.65},children:r.desc}),o.jsx("div",{style:{display:"flex",gap:0,borderBottom:"1px solid rgba(255,255,255,.06)",padding:"10px 24px 0",marginTop:8},children:["story","recipe","table"].map(w=>o.jsxs("button",{title:w,onClick:()=>x(w),style:{padding:"5px 12px",borderRadius:"6px 6px 0 0",cursor:"pointer",fontSize:9,fontWeight:g===w?600:400,background:g===w?`${f.color}16`:"transparent",border:`1px solid ${g===w?f.color+"33":"transparent"}`,borderBottom:`2px solid ${g===w?f.color:"transparent"}`,color:g===w?f.color:"rgba(255,255,255,.35)"},children:[w==="story"&&" Por que Aconteceu",w==="recipe"&&" Receita",w==="table"&&" Na Tabela"]},w))}),o.jsxs("div",{style:{padding:"14px 24px",flex:1,overflowY:"auto",minHeight:140},children:[g==="story"&&o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[o.jsx("div",{style:{padding:"10px 14px",borderRadius:8,background:`${f.color}0c`,border:`1px solid ${f.color}28`,fontSize:10,color:"rgba(255,255,255,.7)",lineHeight:1.7},children:r.recipe.hint}),o.jsx("div",{style:{fontSize:8,color:"rgba(255,255,255,.3)",letterSpacing:".1em",textTransform:"uppercase",marginTop:2},children:"Condies que voc criou:"}),o.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:b.map(w=>o.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:3,padding:"6px 10px",borderRadius:6,background:`${w.color}10`,border:`1px solid ${w.color}35`,minWidth:52},children:[o.jsxs("div",{style:{fontSize:14,fontFamily:"serif",color:w.color},children:[Math.round(w.value*100),"%"]}),o.jsx("div",{style:{fontSize:7,color:`${w.color}99`,textTransform:"uppercase",letterSpacing:".08em"},children:w.label}),o.jsx("div",{style:{width:"100%",height:2,background:"rgba(255,255,255,.08)",borderRadius:2},children:o.jsx("div",{style:{height:"100%",width:`${w.value*100}%`,background:w.color,borderRadius:2}})})]},w.label))}),o.jsxs("div",{style:{display:"flex",gap:4,flexWrap:"wrap",marginTop:2},children:[d.length>0&&d.slice(0,4).map(w=>o.jsxs("span",{style:{fontSize:8,padding:"3px 8px",borderRadius:10,background:"rgba(255,255,255,.06)",border:"1px solid rgba(255,255,255,.12)",color:"rgba(255,255,255,.5)"},children:[" ",w]},w)),u&&o.jsxs("span",{style:{fontSize:8,padding:"3px 8px",borderRadius:10,background:"rgba(160,80,255,.1)",border:"1px solid rgba(160,80,255,.3)",color:"rgba(200,150,255,.8)"},children:[" Opus ",u]}),h==="FORGED"&&o.jsx("span",{style:{fontSize:8,padding:"3px 8px",borderRadius:10,background:"rgba(255,200,60,.1)",border:"1px solid rgba(255,200,60,.3)",color:"rgba(255,220,100,.8)"},children:" Lapis Forjada"})]})]}),g==="recipe"&&o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[o.jsxs("div",{style:{fontSize:8.5,color:"rgba(255,255,255,.5)",lineHeight:1.65},children:["Para descobrir ",o.jsx("strong",{style:{color:f.color},children:r.name})," novamente voc precisa:"]}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[v.map((w,M)=>o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"6px 10px",borderRadius:6,background:"rgba(255,255,255,.03)",border:"1px solid rgba(255,255,255,.06)"},children:[o.jsx("span",{style:{fontSize:9,color:f.color},children:""}),o.jsx("span",{style:{fontSize:9,color:"rgba(255,255,255,.65)"},children:w})]},M)),o.jsxs("div",{style:{marginTop:4,padding:"6px 10px",borderRadius:6,background:"rgba(255,255,255,.02)",fontSize:8,color:"rgba(255,255,255,.3)",lineHeight:1.6,border:"1px solid rgba(255,255,255,.05)"},children:[" Mantenha as condies por ~",r.recipe.ticksNeeded*2,"s para a descoberta."]})]})]}),g==="table"&&o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[o.jsxs("div",{style:{fontSize:8.5,color:"rgba(255,255,255,.5)",lineHeight:1.65},children:[o.jsx("strong",{style:{color:f.color},children:r.name})," est no perodo ",o.jsx("strong",{style:{color:"rgba(255,255,255,.7)"},children:r.period}),r.group&&o.jsxs(o.Fragment,{children:[", grupo ",o.jsx("strong",{style:{color:"rgba(255,255,255,.7)"},children:r.group})]}),".  um ",o.jsx("strong",{style:{color:f.color},children:f.label}),"."]}),o.jsxs("div",{style:{padding:"8px 12px",borderRadius:8,background:`${f.color}08`,border:`1px solid ${f.color}20`,fontSize:8.5,color:"rgba(255,255,255,.55)",lineHeight:1.7},children:[r.cat==="alcali"&&"Metais Alcalinos reagem violentamente com gua liberando Hidrognio. So muito reativos  o Fogo Alqumico domina.",r.cat==="alcalino-terroso"&&"Metais Alcalino-Terrosos so menos reativos que alcalinos, mas ainda muito ativos. Terra + Fogo os invocam.",r.cat==="transicao"&&"Metais de Transio so versteis  condutores, catalticos, coloridos. Terra dominante + calor os revelam.",r.cat==="lantanideo"&&"Lantandeos so terras raras usadas em tecnologia moderna. Requerem o Opus Magnus (fase NIGREDO a RUBEDO).",r.cat==="actinineo"&&"Actindeos so radioativos. Muitos so sintticos  apenas criados em reatores. O Lapis  necessrio.",r.cat==="nao-metal"&&"No-Metais so a base da qumica orgnica e atmosfrica. Ar e gua os invocam com facilidade.",r.cat==="halogeno"&&"Halognios so reativos, formam sais. Ar + Fogo (e s vezes gua) criam as condies para eles emergirem.",r.cat==="gas-nobre"&&"Gases Nobres so inertes  no reagem. Use SUBLIMATIO com Ar dominante e baixo calor para isol-los.",r.cat==="semi-metal"&&"Semi-metais (metaloides) tm propriedades intermedirias. Terra + Ar ou Terra + Fogo os cristalizam.",r.cat==="metal-representativo"&&"Metais Representativos so estveis e versteis. Terra + calor moderado os forma.",r.cat==="desconhecido"&&"Elementos com propriedades ainda no totalmente conhecidas. So sintticos e extremamente instveis."]})]})]}),o.jsxs("div",{style:{padding:"12px 24px",borderTop:"1px solid rgba(255,255,255,.06)",display:"flex",gap:8,justifyContent:"flex-end",background:"rgba(8,6,16,.6)"},children:[o.jsxs("button",{title:"Reset",onClick:n,style:{padding:"8px 16px",borderRadius:8,cursor:"pointer",fontSize:10,background:"rgba(255,255,255,.05)",border:"1px solid rgba(255,255,255,.12)",color:"rgba(255,255,255,.5)",display:"flex",alignItems:"center",gap:5},children:[o.jsx(El,{size:11})," Replay"]}),o.jsx("button",{title:"Continuar",onClick:t,style:{padding:"8px 22px",borderRadius:8,cursor:"pointer",fontSize:11,fontWeight:700,background:`linear-gradient(135deg, ${f.color}30, ${f.color}18)`,border:`1px solid ${f.color}55`,color:f.color,display:"flex",alignItems:"center",gap:6,boxShadow:`0 0 20px ${f.color}25`},children:"Continuar a Obra "})]})]})})},$Y=({discovered:e,progress:t})=>{const[n,r]=S.useState(null),a=S.useMemo(()=>{const c=Array.from({length:9},()=>Array(18).fill(null));for(const l of gm)c[l.row-1][l.col-1]=l;return c},[]),i=S.useMemo(()=>gm.filter(c=>!e.has(c.z)&&(t.get(c.z)??0)>0).sort((c,l)=>{const d=(t.get(c.z)??0)/c.recipe.ticksNeeded;return(t.get(l.z)??0)/l.recipe.ticksNeeded-d}).slice(0,4),[e,t]),s=n?IY.get(n):null;return o.jsxs("div",{style:{padding:"8px 8px 6px",display:"flex",flexDirection:"column",gap:7},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[o.jsx("div",{style:{fontSize:6.5,color:"rgba(255,255,255,.3)",letterSpacing:".12em",textTransform:"uppercase"},children:" Tabela Peridica"}),o.jsxs("div",{style:{fontSize:9,fontFamily:"monospace",color:"rgba(255,255,255,.5)"},children:[o.jsx("span",{style:{color:"#80ff80"},children:e.size}),o.jsx("span",{style:{color:"rgba(255,255,255,.2)"},children:"/118"})]})]}),o.jsx("div",{style:{height:3,background:"rgba(255,255,255,.06)",borderRadius:2,overflow:"hidden"},children:o.jsx("div",{style:{height:"100%",width:`${e.size/118*100}%`,background:"linear-gradient(90deg,#6040c0,#80ff80)",borderRadius:2,transition:"width .5s"}})}),i.length>0&&o.jsxs("div",{style:{borderRadius:6,background:"rgba(255,200,60,.04)",border:"1px solid rgba(255,200,60,.12)",padding:"6px 8px"},children:[o.jsx("div",{style:{fontSize:6,color:"rgba(255,200,60,.65)",letterSpacing:".12em",textTransform:"uppercase",marginBottom:5},children:" Prximo da Descoberta"}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:i.map(c=>{const l=(t.get(c.z)??0)/c.recipe.ticksNeeded,d=tl[c.cat];return o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},onMouseEnter:()=>r(c.z),onMouseLeave:()=>r(null),children:[o.jsx("div",{style:{width:20,height:20,borderRadius:3,flexShrink:0,display:"flex",alignItems:"center",justifyContent:"center",fontSize:8,fontWeight:700,fontFamily:"monospace",background:`${d.color}22`,border:`1px solid ${d.color}55`,color:d.color},children:c.symbol}),o.jsxs("div",{style:{flex:1,minWidth:0},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[o.jsx("span",{style:{fontSize:7,color:"rgba(255,255,255,.55)"},children:c.name}),o.jsxs("span",{style:{fontSize:6.5,fontFamily:"monospace",color:d.color},children:[Math.round(l*100),"%"]})]}),o.jsx("div",{style:{height:2.5,background:"rgba(255,255,255,.06)",borderRadius:2,overflow:"hidden"},children:o.jsx("div",{style:{height:"100%",width:`${l*100}%`,background:d.color,borderRadius:2,transition:"width .5s"}})})]})]},c.z)})})]}),o.jsx("div",{style:{overflowX:"auto",overflowY:"visible"},children:o.jsx("div",{style:{display:"grid",gridTemplateRows:"repeat(9, 13px)",gridTemplateColumns:"6px repeat(18, 12px)",gap:1,minWidth:230},children:a.map((c,l)=>o.jsxs(on.Fragment,{children:[o.jsx("div",{style:{fontSize:5,color:"rgba(255,255,255,.18)",display:"flex",alignItems:"center",justifyContent:"flex-end",paddingRight:1,gridRow:l+1,gridColumn:1},children:l===7?"":l===8?"Ln":l===9?"An":l+1}),c.map((d,u)=>{if(!d)return o.jsx("div",{style:{gridRow:l+1,gridColumn:u+2,width:12,height:13}},u);const h=e.has(d.z),m=(t.get(d.z)??0)/d.recipe.ticksNeeded,f=tl[d.cat];return o.jsx("div",{style:{gridRow:l+1,gridColumn:u+2},onMouseEnter:()=>r(d.z),onMouseLeave:()=>r(null),children:o.jsx("div",{style:{width:12,height:13,borderRadius:1,border:"1px solid",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:4.5,fontFamily:"monospace",fontWeight:700,transition:"all .15s",background:h?`${f.color}25`:m>0?`${f.dim}18`:"rgba(255,255,255,.015)",borderColor:h?`${f.color}80`:m>0?`${f.color}${Math.round(m*160).toString(16).padStart(2,"0")}`:"rgba(255,255,255,.07)",color:h?f.color:m>0?f.dim:"rgba(255,255,255,.2)",boxShadow:h?`0 0 3px ${f.color}33`:"none",animation:m>0&&!h?"glow-pulse 1.8s ease-in-out infinite":"none"},children:d.symbol.slice(0,2)})},u)})]},l))})}),s&&o.jsxs("div",{style:{borderRadius:6,padding:"8px 10px",background:`${tl[s.cat].color}0c`,border:`1px solid ${tl[s.cat].color}33`},children:[o.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:8,marginBottom:4},children:[o.jsx("span",{style:{fontSize:20,fontFamily:"serif",fontWeight:700,lineHeight:1,color:tl[s.cat].color,opacity:e.has(s.z)?1:.4},children:s.symbol}),o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:10,color:"rgba(255,255,255,.85)",fontWeight:600},children:s.name}),o.jsxs("div",{style:{fontSize:7,color:"rgba(255,255,255,.3)",fontFamily:"monospace"},children:["Z=",s.z,"  ",tl[s.cat].label]})]}),o.jsx("div",{style:{marginLeft:"auto",fontSize:9,color:e.has(s.z)?"#80ff80":"rgba(255,255,255,.2)"},children:e.has(s.z)?"":""})]}),s.alch&&o.jsxs("div",{style:{fontSize:7,color:`${tl[s.cat].color}77`,fontStyle:"italic",marginBottom:4},children:[" ",s.alch]}),o.jsx("div",{style:{fontSize:7.5,color:"rgba(255,255,255,.55)",lineHeight:1.55,marginBottom:5},children:s.desc}),!e.has(s.z)&&o.jsxs("div",{style:{fontSize:7,color:"rgba(255,220,80,.75)",lineHeight:1.55,padding:"4px 6px",background:"rgba(255,200,60,.06)",borderRadius:4},children:[" ",s.recipe.hint]}),!e.has(s.z)&&(t.get(s.z)??0)>0&&o.jsx("div",{style:{height:3,background:"rgba(255,255,255,.06)",borderRadius:2,overflow:"hidden",marginTop:5},children:o.jsx("div",{style:{height:"100%",width:`${(t.get(s.z)??0)/s.recipe.ticksNeeded*100}%`,background:tl[s.cat].color,borderRadius:2}})})]}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"2px 6px",paddingTop:4,borderTop:"1px solid rgba(255,255,255,.05)"},children:FY.map(c=>o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:3},children:[o.jsx("div",{style:{width:7,height:7,borderRadius:1,background:`${tl[c].color}35`,border:`1px solid ${tl[c].color}55`}}),o.jsx("span",{style:{fontSize:5,color:"rgba(255,255,255,.25)"},children:tl[c].label})]},c))})]})},qY=({elements:e,heat:t,transmutation:n,quintessence:r,recipeScores:a,simSpeed:i,onElement:s,onHeat:c,onPreset:l,onSimSpeed:d})=>o.jsxs("div",{style:{padding:"8px 10px",display:"flex",flexDirection:"column",gap:10},children:[o.jsx("div",{style:{fontSize:7,color:"rgba(255,180,60,.7)",letterSpacing:".12em",textTransform:"uppercase"},children:" Atanor  Forno Alqumico"}),o.jsxs("div",{style:{fontSize:7,color:"rgba(255,255,255,.4)",lineHeight:1.6,background:"rgba(255,180,60,.04)",borderRadius:4,padding:"5px 8px",border:"1px solid rgba(255,180,60,.1)"},children:["Ajuste os ",o.jsx("strong",{style:{color:"rgba(255,200,100,.8)"},children:"4 Elementos"})," e o",o.jsx("strong",{style:{color:"rgba(255,120,60,.8)"},children:" Calor"})," para criar condies de descoberta."]}),o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:6,color:"rgba(255,255,255,.22)",letterSpacing:".12em",textTransform:"uppercase",marginBottom:4},children:"Velocidade da Simulao"}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[o.jsxs("span",{style:{fontSize:8,minWidth:16,textAlign:"right",fontFamily:"monospace",color:i<.2?"#60c8f0":i<.7?"#a0c080":"#ffa030"},children:[i<.15?"":i<.6?"":""," ",Math.round(i*100),"%"]}),o.jsx("input",{type:"range",min:.05,max:2,step:.05,value:i,onChange:u=>d(+u.target.value),style:{flex:1,accentColor:"#ffa030",cursor:"pointer"}}),o.jsx("div",{style:{display:"flex",gap:2},children:[.15,.4,1].map(u=>o.jsx("button",{title:`Velocidade ${u}x`,onClick:()=>d(u),style:{fontSize:6,padding:"1px 4px",borderRadius:2,cursor:"pointer",border:"none",background:Math.abs(i-u)<.03?"rgba(255,160,60,.25)":"rgba(255,255,255,.05)",color:Math.abs(i-u)<.03?"rgba(255,180,80,.9)":"rgba(255,255,255,.3)"},children:u===.15?"Lento":u===.4?"Mdio":"Normal"},u))})]})]}),o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:6,color:"rgba(255,255,255,.22)",letterSpacing:".12em",textTransform:"uppercase",marginBottom:5},children:"Proporo dos Elementos"}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:2,alignItems:"end"},children:Object.keys(af).map(u=>o.jsx(DY,{k:u,value:e[u],onChange:h=>s(u,h)},u))})]}),o.jsx(LY,{value:t,onChange:c}),o.jsxs("div",{children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[o.jsx("span",{style:{fontSize:6.5,color:"rgba(255,255,255,.28)",textTransform:"uppercase",letterSpacing:".08em"},children:"Quintessncia"}),o.jsxs("span",{style:{fontSize:7,fontFamily:"monospace",color:r>.7?"#ffd060":"rgba(255,255,255,.4)"},children:[Math.round(r*100),"%"]})]}),o.jsx("div",{style:{height:3,background:"rgba(255,255,255,.06)",borderRadius:2,overflow:"hidden"},children:o.jsx("div",{style:{height:"100%",width:`${r*100}%`,background:"linear-gradient(90deg,#c060ff,#ffd060)",borderRadius:2,transition:"width .4s"}})}),o.jsx("div",{style:{fontSize:6,color:"rgba(255,255,255,.22)",marginTop:2},children:"= 1 quando os 4 elementos esto a 25% cada"})]}),o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:6,color:"rgba(255,255,255,.22)",textTransform:"uppercase",letterSpacing:".08em",marginBottom:4},children:"Substncias no Atanor"}),o.jsx("div",{style:{display:"flex",gap:3,flexWrap:"wrap"},children:XU.map(u=>{const h=pm[u],m=n.counts[u]??0;return o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:3,padding:"3px 6px",borderRadius:4,background:m>0?h.color+"16":"rgba(255,255,255,.02)",border:`1px solid ${m>0?h.color+"40":"rgba(255,255,255,.05)"}`,opacity:m>0?1:.4},children:[o.jsx("span",{style:{fontSize:9,lineHeight:1},children:h.symbol}),o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:6.5,color:h.color,fontFamily:"serif",fontWeight:600},children:h.label}),o.jsx("div",{style:{fontSize:5.5,color:"rgba(255,255,255,.3)",fontFamily:"monospace"},children:m})]})]},u)})})]}),o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:6,color:"rgba(255,255,255,.22)",textTransform:"uppercase",letterSpacing:".08em",marginBottom:4},children:"Transmutaes Ativas"}),mm.map(u=>{const h=a[u.id]??0;return h<.05?null:o.jsxs("div",{style:{padding:"4px 7px",borderRadius:4,background:"rgba(255,255,255,.02)",border:`1px solid rgba(80,255,80,${(h*.3).toFixed(2)})`,marginBottom:3},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[o.jsx("span",{style:{fontSize:7.5,color:"rgba(255,255,255,.65)",fontStyle:"italic"},children:u.name}),o.jsx("div",{style:{width:35,height:3,background:"rgba(255,255,255,.06)",borderRadius:2,overflow:"hidden",marginTop:1},children:o.jsx("div",{style:{height:"100%",width:`${h*100}%`,background:"#60ff90",borderRadius:2}})})]}),o.jsx("div",{style:{fontSize:6.5,color:"rgba(255,255,255,.38)",lineHeight:1.45},children:u.hint})]},u.id)}).filter(Boolean),mm.every(u=>(a[u.id]??0)<.05)&&o.jsx("div",{style:{fontSize:7,color:"rgba(255,255,255,.18)",fontStyle:"italic"},children:"Ajuste os elementos para ativar..."})]}),o.jsxs("select",{onChange:u=>{u.target.value&&l(u.target.value)},defaultValue:"",style:{width:"100%",background:"rgba(255,255,255,.04)",border:"1px solid rgba(255,255,255,.08)",color:"rgba(255,255,255,.55)",fontSize:9,padding:"4px 6px",borderRadius:4,cursor:"pointer"},children:[o.jsx("option",{value:"",children:" Preset Alqumico "}),Gp.map(u=>o.jsxs("option",{value:u.id,children:[u.name,"  ",u.subtitle]},u.id))]})]}),HY=({opus:e,sequencer:t,onStartOpus:n,onSeqToggle:r,onSeqBpm:a,onSeqPreset:i,onSeqQuantum:s})=>{const c=[{id:"NIGREDO",sym:"",color:"#664444",label:"Nigredo",desc:"Putrefao  calor mdio, terra+gua, alta tenso"},{id:"ALBEDO",sym:"",color:"#b0b8d0",label:"Albedo",desc:"Lavagem  calor baixo, gua+ar, alta integrao"},{id:"CITRINITAS",sym:"",color:"#d4a020",label:"Citrinitas",desc:"Amarelecimento  equilbrio, calor mdio"},{id:"RUBEDO",sym:"",color:"#aa2020",label:"Rubedo",desc:"Vermelhido  fogo+terra, calor alto, grande obra"}];return o.jsxs("div",{style:{padding:"8px 10px",display:"flex",flexDirection:"column",gap:9},children:[o.jsx("div",{style:{fontSize:7,color:"rgba(255,160,80,.7)",letterSpacing:".12em",textTransform:"uppercase"},children:" Opus Magnus  A Grande Obra"}),o.jsxs("div",{style:{fontSize:7,color:"rgba(255,255,255,.4)",lineHeight:1.6,background:"rgba(160,60,255,.04)",borderRadius:4,padding:"5px 8px",border:"1px solid rgba(160,60,255,.12)"},children:["4 fases alqumicas que transformam ",o.jsx("strong",{style:{color:"rgba(180,120,255,.9)"},children:"Chumbo"})," em ",o.jsx("strong",{style:{color:"#ffd060"},children:"Ouro"}),". Cada fase exige condies especficas de elementos e mtricas."]}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:3},children:c.map((l,d)=>{const u=e.active&&e.phase===l.id,h=e.completed.includes(l.id),m=u?e.timer/e.maxTimer:h?1:0;return o.jsxs("div",{style:{padding:"5px 8px",borderRadius:5,background:u?`${l.color}18`:h?"rgba(80,220,80,.05)":"rgba(255,255,255,.02)",border:`1px solid ${u?l.color+"50":h?"rgba(80,220,80,.2)":"rgba(255,255,255,.05)"}`},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginBottom:h||u?3:0},children:[o.jsx("span",{style:{fontSize:12,color:l.color,opacity:h||u?1:.3},children:l.sym}),o.jsx("span",{style:{fontSize:8.5,color:h?"#80ff80":u?l.color:"rgba(255,255,255,.3)",fontWeight:h||u?600:400},children:l.label}),h&&o.jsx("span",{style:{fontSize:7,color:"#80ff80",marginLeft:"auto"},children:" Completo"}),u&&o.jsxs("span",{style:{fontSize:7,fontFamily:"monospace",color:l.color,marginLeft:"auto"},children:[Math.round(m*100),"%"]})]}),o.jsx("div",{style:{fontSize:6.5,color:"rgba(255,255,255,.35)",lineHeight:1.4,marginBottom:u?3:0},children:l.desc}),u&&o.jsx("div",{style:{height:2,background:"rgba(255,255,255,.06)",borderRadius:2,overflow:"hidden"},children:o.jsx("div",{style:{height:"100%",width:`${m*100}%`,background:l.color,borderRadius:2,transition:"width .5s"}})})]},l.id)})}),o.jsx("button",{title:"Iniciar Opus",onClick:n,style:{width:"100%",padding:"7px",borderRadius:6,cursor:"pointer",background:e.active?"rgba(220,60,60,.1)":"rgba(160,60,255,.14)",border:`1px solid ${e.active?"rgba(220,60,60,.3)":"rgba(160,80,255,.4)"}`,color:e.active?"rgba(255,120,120,.9)":"rgba(200,140,255,.9)",fontSize:9,letterSpacing:".08em",textTransform:"uppercase",fontWeight:600},children:e.active?` Cancelar (${e.phase})`:" Iniciar Opus Magnus"}),o.jsxs("div",{style:{borderTop:"1px solid rgba(255,255,255,.05)",paddingTop:7},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:5},children:[o.jsx("div",{style:{fontSize:6.5,color:"rgba(255,255,255,.25)",textTransform:"uppercase",letterSpacing:".08em"},children:"Sequenciador Quntico"}),o.jsx("button",{title:"Sequencer ON/OFF",onClick:r,style:{padding:"2px 8px",borderRadius:3,cursor:"pointer",fontSize:7,background:t.active?"rgba(80,220,80,.14)":"rgba(255,255,255,.04)",border:`1px solid ${t.active?"rgba(80,220,80,.35)":"rgba(255,255,255,.1)"}`,color:t.active?"rgba(120,255,120,.9)":"rgba(255,255,255,.38)"},children:t.active?" Stop":" Start"})]}),o.jsx("div",{style:{display:"flex",gap:2,marginBottom:5},children:t.steps.map((l,d)=>{const u=t.active&&t.cursor===d,h=l.op==="SOLVE"?"#5aafff":l.op==="COAGULA"?"#ffaa30":"#60ff90";return o.jsxs("div",{style:{flex:1,height:20,borderRadius:2,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:0,background:u?`${h}28`:l.active?"rgba(255,255,255,.05)":"rgba(255,255,255,.015)",border:`1px solid ${u?`${h}60`:l.active?"rgba(255,255,255,.1)":"rgba(255,255,255,.04)"}`,boxShadow:u?`0 0 5px ${h}44`:"none",transition:"all .1s"},children:[o.jsx("span",{style:{fontSize:6.5,color:u?h:"rgba(255,255,255,.28)",lineHeight:1},children:l.label}),l.active&&o.jsx("div",{style:{width:3,height:3,borderRadius:"50%",background:h,marginTop:1,opacity:.65}})]},d)})}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5},children:[o.jsx("span",{style:{fontSize:6,color:"rgba(255,255,255,.3)",minWidth:20},children:"BPM"}),o.jsx("input",{type:"range",min:30,max:300,step:1,value:t.bpm,onChange:l=>a(+l.target.value),style:{flex:1,accentColor:"#a060ff",cursor:"pointer"}}),o.jsx("span",{style:{fontSize:8,fontFamily:"monospace",color:"rgba(255,255,255,.45)",minWidth:28},children:t.bpm})]}),o.jsxs("div",{style:{display:"flex",gap:3,marginTop:4,flexWrap:"wrap"},children:[v6.map(l=>o.jsx("button",{title:l.name,onClick:()=>i(l.id),style:{padding:"2px 6px",borderRadius:3,cursor:"pointer",fontSize:6.5,background:"rgba(160,80,255,.07)",border:"1px solid rgba(160,80,255,.18)",color:"rgba(200,150,255,.65)"},children:l.id},l.id)),o.jsx("button",{title:"Quantum",onClick:s,style:{padding:"2px 6px",borderRadius:3,cursor:"pointer",fontSize:6.5,background:t.quantum?"rgba(255,200,60,.1)":"rgba(255,255,255,.03)",border:`1px solid ${t.quantum?"rgba(255,200,60,.3)":"rgba(255,255,255,.08)"}`,color:t.quantum?"rgba(255,220,100,.8)":"rgba(255,255,255,.28)"},children:" Quantum"})]})]})]})},WY=({onOp:e,opsUsed:t,bars:n,barTool:r,onBarTool:a,onDeleteBar:i,onToggleBar:s,onBarStrength:c,lens:l,onLens:d})=>{const[u,h]=S.useState(null);return o.jsxs("div",{style:{padding:"8px 10px",display:"flex",flexDirection:"column",gap:9},children:[o.jsx("div",{style:{fontSize:7,color:"rgba(255,80,200,.7)",letterSpacing:".12em",textTransform:"uppercase"},children:" Arcana  Operaes & Poderes"}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:3},children:OY.map(m=>{const f=t.has(m.id.toUpperCase());return o.jsxs("button",{title:m.name,onClick:()=>e(m.id),onMouseEnter:()=>h(m),onMouseLeave:()=>h(null),style:{padding:"5px 4px",borderRadius:5,cursor:"pointer",background:f?`${m.color}12`:"rgba(255,255,255,.03)",border:`1px solid ${f?`${m.color}40`:"rgba(255,255,255,.08)"}`,display:"flex",flexDirection:"column",alignItems:"center",gap:1.5,transition:"all .12s"},children:[o.jsx("span",{style:{fontSize:13,lineHeight:1},children:m.icon}),o.jsx("span",{style:{fontSize:6.5,color:f?m.color:"rgba(255,255,255,.45)",fontWeight:600},children:m.label}),o.jsx("span",{style:{fontSize:5.5,color:"rgba(255,255,255,.22)",fontStyle:"italic"},children:m.latin})]},m.id)})}),u&&o.jsxs("div",{style:{padding:"5px 8px",borderRadius:4,background:`${u.color}0a`,border:`1px solid ${u.color}28`,fontSize:7,color:"rgba(255,255,255,.55)",lineHeight:1.55},children:[o.jsx("strong",{style:{color:u.color},children:u.label}),"  ",u.desc]}),o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:6,color:"rgba(255,255,255,.22)",textTransform:"uppercase",letterSpacing:".08em",marginBottom:4},children:"Lente de Visualizao"}),o.jsx("div",{style:{display:"flex",gap:2},children:["SIGIL","FIELD","EVENTS","LAPIS"].map(m=>o.jsx("button",{title:m,onClick:()=>d(m),style:{flex:1,padding:"3px 2px",borderRadius:3,cursor:"pointer",fontSize:6,fontFamily:"monospace",background:l===m?"rgba(255,255,255,.09)":"rgba(255,255,255,.02)",border:`1px solid ${l===m?"rgba(255,255,255,.28)":"rgba(255,255,255,.06)"}`,color:l===m?"rgba(255,255,255,.8)":"rgba(255,255,255,.28)"},children:m},m))})]}),o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:6,color:"rgba(255,255,255,.22)",textTransform:"uppercase",letterSpacing:".08em",marginBottom:4},children:"Atanores & Barreiras"}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:2},children:Object.keys(r5).map(m=>{const f=r5[m];return o.jsxs("button",{title:f.label||f.id,onClick:()=>a(r===m?null:m),style:{padding:"4px 7px",borderRadius:4,cursor:"pointer",textAlign:"left",background:r===m?`${f.color}16`:"rgba(255,255,255,.025)",border:`1px solid ${r===m?`${f.color}50`:"rgba(255,255,255,.06)"}`,display:"flex",alignItems:"center",gap:6},children:[o.jsx("span",{style:{fontSize:10,color:f.color,opacity:r===m?1:.5},children:f.icon}),o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:7,color:r===m?f.color:"rgba(255,255,255,.4)",fontWeight:r===m?600:400},children:f.label}),o.jsx("div",{style:{fontSize:5.5,color:"rgba(255,255,255,.2)"},children:f.desc})]})]},m)})}),r&&o.jsxs("div",{style:{marginTop:4,padding:"3px 7px",borderRadius:3,background:"rgba(255,200,100,.04)",border:"1px solid rgba(255,200,100,.12)",fontSize:7,color:"rgba(255,200,80,.75)"},children:[" Arraste no canvas para criar ",r5[r].label]}),n.length>0&&o.jsx("div",{style:{marginTop:5,display:"flex",flexDirection:"column",gap:2},children:n.map(m=>{const f=r5[m.type];return o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:2,padding:"3px 6px",borderRadius:4,background:m.active?"rgba(255,255,255,.03)":"rgba(255,255,255,.01)",border:`1px solid ${m.active?"rgba(255,255,255,.08)":"rgba(255,255,255,.03)"}`,opacity:m.active?1:.45},children:[o.jsx("div",{style:{width:6,height:6,borderRadius:"50%",background:f.color,flexShrink:0}}),o.jsxs("div",{style:{flex:1,fontSize:6,color:`${f.color}bb`},children:[f.icon," ",f.label]}),o.jsx("input",{type:"range",min:.1,max:1,step:.05,value:m.strength,onChange:g=>c(m.id,+g.target.value),style:{width:36,accentColor:f.color,cursor:"pointer"}}),o.jsx("button",{title:"ON/OFF",onClick:()=>s(m.id),style:{fontSize:5.5,padding:"1px 4px",borderRadius:2,cursor:"pointer",background:"rgba(255,255,255,.05)",border:"none",color:"rgba(255,255,255,.35)"},children:m.active?"ON":"OFF"}),o.jsx("button",{title:"Remover",onClick:()=>i(m.id),style:{background:"none",border:"none",cursor:"pointer",color:"rgba(255,60,60,.5)",padding:0},children:o.jsx(il,{size:8})})]},m.id)})})]})]})},GY=({active:e})=>{var en,At;const t=S.useRef(null),n=S.useRef(null),r=S.useRef(0),a=S.useRef(0),i=S.useRef(!0),s=r6(),[c,l]=S.useState(Gp[1].elements),[d,u]=S.useState(Gp[1].heat),[h,m]=S.useState(.4),[f,g]=S.useState("SIGIL"),[x,v]=S.useState(!0),[b,w]=S.useState("atanor"),[M,k]=S.useState(!0),[R,j]=S.useState(n5()),[I,E]=S.useState(wC()),[O,L]=S.useState(!1),[$,F]=S.useState(null),[B,W]=S.useState([]),[re,oe]=S.useState(null),[te,J]=S.useState(null),pe=S.useRef(1),[P,V]=S.useState(MC()),[fe,ye]=S.useState(y6()),[Se,we]=S.useState(new Set(CC)),[ke,De]=S.useState(new Map),[_e,ae]=S.useState(null),[Re,Fe]=S.useState(new Set),[Oe,ne]=S.useState(null),nt=S.useRef(.4),pt=S.useRef(1),Et=S.useRef(null),_t=S.useRef(!1),Ct=S.useRef(new Set(CC)),Xe=S.useRef(new Map),Ut=S.useRef(new Set),Le=S.useRef(c),Ke=S.useRef(d),mt=S.useRef("SIGIL"),an=S.useRef(n5()),gn=S.useRef([]),Be=S.useRef([]),ft=S.useRef(MC()),Qt=S.useRef(null),nr=S.useRef(null);S.useEffect(()=>{Le.current=c,n.current&&(n.current.elements={...c})},[c]),S.useEffect(()=>{Ke.current=d,n.current&&(n.current.heat=d)},[d]),S.useEffect(()=>{mt.current=f},[f]),S.useEffect(()=>{an.current=R},[R]),S.useEffect(()=>{gn.current=I},[I]),S.useEffect(()=>{Be.current=B},[B]),S.useEffect(()=>{ft.current=P},[P]),S.useEffect(()=>{i.current=x},[x]),S.useEffect(()=>{nt.current=h},[h]),S.useEffect(()=>{const Ze=Gp[1];n.current=gC(Ze.agentCount,Ze.elements,Ze.heat)},[]);const _n=S.useCallback((Ze,yt)=>{l(Mt=>{const bn=Object.entries(Mt).filter(([Tn])=>Tn!==Ze),Pt=bn.reduce((Tn,[,Sr])=>Tn+Sr,0),An=Math.max(.01,1-yt);if(Pt<.001){const Tn=An/bn.length;return{...Mt,[Ze]:yt,...Object.fromEntries(bn.map(([Sr])=>[Sr,Tn]))}}const cr=An/Pt;return{...Mt,[Ze]:yt,...Object.fromEntries(bn.map(([Tn,Sr])=>[Tn,Sr*cr]))}})},[]),Rn=S.useCallback(Ze=>{const yt=Date.now();ne({type:Ze,key:yt}),nr.current&&clearTimeout(nr.current),nr.current=setTimeout(()=>ne(null),1800)},[]),sn=S.useCallback(Ze=>{if(Rn(Ze),Ut.current.add(Ze.toUpperCase()),Fe(new Set(Ut.current)),!n.current)return;const yt=n.current;switch(Ze){case"solve":Mc(yt,"SOLVE");break;case"coagula":Mc(yt,"COAGULA");break;case"calcinatio":u(Mt=>{const bn=Math.min(1,Mt+.35);return n.current&&(n.current.heat=bn),bn}),Mc(yt,"COAGULA"),Zd(gn.current,"event",yt.metrics,Le.current,an.current.active?an.current.phase:null,"BURNOUT",yt.lapis.state),E([...gn.current]);break;case"sublimatio":l(Mt=>{const bn=Math.min(.75,Mt.air+.2),Pt=Math.max(.02,Mt.earth-.15),An=Mt.fire,cr=Mt.water,Tn=Pt+cr+bn+An,Sr={earth:Pt/Tn,water:cr/Tn,air:bn/Tn,fire:An/Tn};return n.current&&(n.current.elements=Sr),Sr}),Mc(yt,"SOLVE");break;case"fermentatio":l(()=>{const Mt={earth:.25,water:.25,air:.25,fire:.25};return n.current&&(n.current.elements=Mt),Mt});break;case"putrefactio":u(Mt=>{const bn=Math.max(0,Mt-.2);return n.current&&(n.current.heat=bn),bn}),l(()=>{const Mt={earth:.3,water:.35,air:.15,fire:.2};return n.current&&(n.current.elements=Mt),Mt}),Mc(yt,"SOLVE");for(const Mt of yt.agents)Mt.substance="plumbum";Zd(gn.current,"event",yt.metrics,Le.current,an.current.active?an.current.phase:null,"DISSOLUTION",yt.lapis.state),E([...gn.current]);break;case"circulatio":Mc(yt,"COAGULA"),setTimeout(()=>{n.current&&Mc(n.current,"SOLVE")},600),setTimeout(()=>{n.current&&Mc(n.current,"COAGULA")},1200);break;case"fixatio":for(const Mt of yt.agents)Mt.vx*=.15,Mt.vy*=.15;u(Mt=>{const bn=Math.max(0,Mt-.15);return n.current&&(n.current.heat=bn),bn}),Mc(yt,"COAGULA");break}},[Rn]),Cn=S.useCallback(Ze=>{const yt=EY(Ze);yt&&(l(yt.elements),u(yt.heat),n.current=gC(yt.agentCount,yt.elements,yt.heat),j(n5()),E(wC()),W([]))},[]),wt=S.useCallback(()=>{if(R.active){j(n5()),Qt.current=null;return}if(!n.current)return;j({active:!0,phase:"NIGREDO",phaseIndex:0,timer:0,maxTimer:45,completed:[],lapisForged:!1}),Qt.current=vC("NIGREDO"),Zd(gn.current,"phaseStart",n.current.metrics,Le.current,"NIGREDO",null,n.current.lapis.state),E([...gn.current])},[R.active]),st=S.useCallback(()=>V(Ze=>({...Ze,active:!Ze.active})),[]),Zt=S.useCallback(Ze=>V(yt=>({...yt,bpm:Ze,stepDur:60/Ze})),[]),Pe=S.useCallback(Ze=>{const yt=v6.find(Mt=>Mt.id===Ze);yt&&V(Mt=>({...Mt,steps:[...yt.steps],bpm:yt.bpm,stepDur:60/yt.bpm,quantum:yt.quantum,cursor:0,timer:0}))},[]),ct=S.useCallback(()=>V(Ze=>({...Ze,quantum:!Ze.quantum})),[]);S.useEffect(()=>{const Ze=t.current;if(!Ze||!e)return;const yt=Mt=>s.handleWheel(Mt,Ze);return Ze.addEventListener("wheel",yt,{passive:!1}),()=>Ze.removeEventListener("wheel",yt)},[e,s.handleWheel]);const vt=S.useCallback(Ze=>{const yt=t.current;return oU(Ze.clientX,Ze.clientY,yt.getBoundingClientRect(),s.zoomRef.current,s.panXRef.current,s.panYRef.current)},[s.zoomRef,s.panXRef,s.panYRef]),xe=S.useCallback(Ze=>{if(Ze.button===1){s.handlePanStart(Ze);return}if(!re||Ze.button!==0)return;const[yt,Mt]=vt(Ze);J({x1:yt,y1:Mt})},[re,vt]),ge=S.useCallback(Ze=>s.handlePanMove(Ze),[s.handlePanMove]),Ee=S.useCallback(Ze=>{if(s.handlePanEnd(Ze),!te||!re)return;const[yt,Mt]=vt(Ze),bn=yt-te.x1,Pt=Mt-te.y1;Math.sqrt(bn*bn+Pt*Pt)>.02&&W(An=>[...An,{id:pe.current++,x1:te.x1,y1:te.y1,x2:yt,y2:Mt,type:re,strength:.6,active:!0}]),J(null)},[te,re,vt]);S.useEffect(()=>{if(!e)return;const Ze=yt=>{(yt.ctrlKey||yt.metaKey)&&yt.key==="="&&(yt.preventDefault(),s.zoomIn()),(yt.ctrlKey||yt.metaKey)&&yt.key==="-"&&(yt.preventDefault(),s.zoomOut()),(yt.ctrlKey||yt.metaKey)&&yt.key==="0"&&(yt.preventDefault(),s.resetView()),yt.key===" "&&!_e&&(yt.preventDefault(),v(Mt=>!Mt))};return window.addEventListener("keydown",Ze),()=>window.removeEventListener("keydown",Ze)},[e,_e]),S.useEffect(()=>{if(!e){cancelAnimationFrame(r.current);return}let Ze="DORMANT";const yt=Mt=>{var cr,Tn;if(r.current=requestAnimationFrame(yt),!t.current||!n.current)return;const bn=Math.min(.05,(Mt-a.current)/1e3);a.current=Mt;const Pt=n.current;if(i.current){if(Qt.current){const de=Qt.current;l($e=>{const et={earth:$e.earth+(de.mix.earth-$e.earth)*bn*.08,water:$e.water+(de.mix.water-$e.water)*bn*.08,air:$e.air+(de.mix.air-$e.air)*bn*.08,fire:$e.fire+(de.mix.fire-$e.fire)*bn*.08};return Pt.elements=et,et}),u($e=>{const et=$e+(de.heat-$e)*bn*.06;return Pt.heat=et,et})}if(ft.current.active){const de=TY(ft.current,bn);de.stepFired&&de.firedStep&&(de.elementsDelta&&l($e=>{const et=de.elementsDelta,zt={earth:et.earth??$e.earth,water:et.water??$e.water,air:et.air??$e.air,fire:et.fire??$e.fire};return Pt.elements=zt,zt}),de.heatDelta!=null&&u(()=>(Pt.heat=de.heatDelta,de.heatDelta)),de.op!=="NONE"&&Mc(Pt,de.op)),V({...ft.current})}if(!_t.current){const de=gm.filter($e=>!Ct.current.has($e.z)).map($e=>({el:$e,prog:(Xe.current.get($e.z)??0)/$e.recipe.ticksNeeded})).filter(({prog:$e})=>$e>.4).sort(($e,et)=>et.prog-$e.prog)[0];if(de){const $e=Math.max(.1,1-de.prog*2);pt.current+=($e-pt.current)*Math.min(1,bn*1.5);let et=.5,zt=.5,Nt=0;for(const Ln of Pt.agents){const zn=Ln.charge*Ln.coherence;zn>Nt&&(Nt=zn,et=Ln.x,zt=Ln.y)}const ln=1.3+de.prog*2.5;s.zoomRef.current+=(ln-s.zoomRef.current)*Math.min(1,bn*.6);const Rt=((cr=t.current)==null?void 0:cr.clientWidth)??900,Nn=((Tn=t.current)==null?void 0:Tn.clientHeight)??600,It=(.5-et)*Rt*s.zoomRef.current*.4,xn=(.5-zt)*Nn*s.zoomRef.current*.4;s.panXRef.current+=(It-s.panXRef.current)*Math.min(1,bn*.45),s.panYRef.current+=(xn-s.panYRef.current)*Math.min(1,bn*.45),Et.current={name:de.el.name,symbol:de.el.symbol,color:tl[de.el.cat].color,progress:de.prog,hotX:et,hotY:zt}}else pt.current+=(1-pt.current)*Math.min(1,bn*1.5),s.zoomRef.current>1.02&&(s.zoomRef.current+=(1-s.zoomRef.current)*Math.min(1,bn*.5)),(Math.abs(s.panXRef.current)>1||Math.abs(s.panYRef.current)>1)&&(s.panXRef.current*=Math.pow(.96,bn*60),s.panYRef.current*=Math.pow(.96,bn*60)),Et.current=null}const Sr=bn*nt.current*pt.current;if(cY(Pt,Sr,Be.current),Pt.tick%60===0){const de={earth:Le.current.earth,water:Le.current.water,air:Le.current.air,fire:Le.current.fire},$e=an.current.active?an.current.phase:null;for(const et of gm)if(!Ct.current.has(et.z)&&PY(et.recipe,de,Ke.current,Ut.current,$e,Pt.lapis.state)){const Nt=(Xe.current.get(et.z)??0)+1;if(Xe.current.set(et.z,Nt),Nt>=et.recipe.ticksNeeded){Ct.current.add(et.z),we(new Set(Ct.current)),De(new Map(Xe.current)),i.current=!1,v(!1);const ln={element:et,earth:Le.current.earth,water:Le.current.water,air:Le.current.air,fire:Le.current.fire,heat:Ke.current,opsUsed:Array.from(Ut.current),opusPhase:$e,lapisState:Pt.lapis.state,totalDiscovered:Ct.current.size};_t.current=!0,Et.current=null,pt.current=1,ae(ln),Zd(gn.current,"periodic",Pt.metrics,Le.current,$e,null,Pt.lapis.state),E([...gn.current]);break}}De(new Map(Xe.current))}Pt.lapis.state!==Ze&&(Pt.lapis.state==="FORGED"&&(Zd(gn.current,"lapisForged",Pt.metrics,Pt.elements,an.current.active?an.current.phase:null,null,Pt.lapis.state),E([...gn.current])),Ze=Pt.lapis.state),Pt.activeEvent&&Pt.eventTimer<.1&&(Zd(gn.current,"event",Pt.metrics,Pt.elements,an.current.active?an.current.phase:null,Pt.activeEvent,Pt.lapis.state),E([...gn.current])),an.current.active&&j(de=>{if(!de.active)return de;const $e=de.timer+bn;if($e>=de.maxTimer){const et=xY(de.phase,Pt.metrics),zt=vY(de);if(Zd(gn.current,"phaseEnd",Pt.metrics,Pt.elements,de.phase,null,Pt.lapis.state),et.passed&&zt){const Nt={...de,timer:0,phase:zt,phaseIndex:de.phaseIndex+1,completed:[...de.completed,de.phase]};return Qt.current=vC(zt),Zd(gn.current,"phaseStart",Pt.metrics,Pt.elements,zt,null,Pt.lapis.state),E([...gn.current]),Nt}else return et.passed&&!zt?(Qt.current=null,E([...gn.current]),{...de,active:!1,completed:[...de.completed,de.phase]}):(E([...gn.current]),{...de,timer:0})}return{...de,timer:$e}}),Pt.tick%20===0&&ye({...Pt.transmutation,counts:{...Pt.transmutation.counts},produced:{...Pt.transmutation.produced},flashes:[]})}const An=Math.sin(Pt.breathPhase*Math.PI*2);mY(t.current,Pt,mt.current,an.current.active?an.current.phase:null,An,Be.current,ft.current,s.zoomRef.current,s.panXRef.current,s.panYRef.current,284,Et.current)};return a.current=performance.now(),r.current=requestAnimationFrame(yt),()=>cancelAnimationFrame(r.current)},[e]);const me=g6(c),je=((en=n.current)==null?void 0:en.lapis.state)??"DORMANT",Te=S.useMemo(()=>Object.fromEntries(mm.map(Ze=>{var yt,Mt;return[Ze.id,zv(Ze,c,d,((yt=n.current)==null?void 0:yt.lapis.state)??"DORMANT",((Mt=n.current)==null?void 0:Mt.pulse.op)??"NONE",.5,fe.conjunctionActive)]})),[c,d,fe.conjunctionActive]),Ae=S.useMemo(()=>$?AY(I,$):I.slice(0,40),[I,$]),Tt=240,xt=[{id:"tabela",icon:o.jsx(iI,{size:13}),label:"Tabela",color:"#60c0ff"},{id:"atanor",icon:o.jsx(rP,{size:13}),label:"Atanor",color:"#ffa030"},{id:"opus",icon:o.jsx(Sf,{size:13}),label:"Opus",color:"#b060ff"},{id:"arcana",icon:o.jsx(zi,{size:13}),label:"Arcana",color:"#ff60c0"}];return o.jsxs("div",{className:"fixed left-0 right-0 bottom-0 z-[5]",style:{display:e?"flex":"none",top:36},children:[o.jsx("style",{children:_Y}),o.jsx("canvas",{ref:t,className:"absolute inset-0 w-full h-full block",style:{background:"#000",cursor:s.isPanning.current?"grabbing":re?"crosshair":"default"},onMouseDown:xe,onMouseMove:ge,onMouseUp:Ee,onMouseLeave:()=>s.handlePanEnd()}),Oe&&o.jsx("div",{style:{position:"fixed",inset:0,zIndex:90,pointerEvents:"none",background:NY[Oe.type],animation:`flash-${Oe.type} 1.6s ease-out forwards`}},Oe.key),fe.bannerLife>0&&fe.bannerSubstance&&(()=>{const Ze=pm[fe.bannerSubstance];return o.jsx("div",{style:{position:"fixed",top:"35%",left:"50%",transform:"translate(-50%,-50%)",zIndex:97,pointerEvents:"none",textAlign:"center"},children:o.jsxs("div",{style:{fontSize:24,letterSpacing:".15em",fontFamily:"serif",color:Ze.glowColor,opacity:Math.min(1,fe.bannerLife/2),textShadow:`0 0 30px ${Ze.color}88`},children:[Ze.symbol," ",fe.bannerText," ",Ze.symbol]})})})(),o.jsxs("div",{style:{position:"fixed",left:0,top:36,bottom:0,zIndex:20,display:"flex",pointerEvents:"none"},children:[o.jsxs("div",{style:{width:44,display:"flex",flexDirection:"column",alignItems:"center",background:"rgba(6,5,12,.97)",borderRight:"1px solid rgba(255,255,255,.05)",pointerEvents:"all",paddingTop:4},children:[xt.map(Ze=>o.jsxs("button",{title:Ze.label,onClick:()=>{b===Ze.id&&M?k(!1):(w(Ze.id),k(!0))},style:{width:36,height:36,borderRadius:6,border:"none",cursor:"pointer",margin:"2px 0",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:1.5,background:M&&b===Ze.id?`${Ze.color}18`:"transparent",boxShadow:M&&b===Ze.id?`inset 0 0 0 1px ${Ze.color}40`:"none",color:M&&b===Ze.id?Ze.color:"rgba(255,255,255,.25)",transition:"all .15s"},children:[Ze.icon,o.jsx("span",{style:{fontSize:5,letterSpacing:".08em",textTransform:"uppercase"},children:Ze.label})]},Ze.id)),o.jsx("div",{style:{width:24,height:1,background:"rgba(255,255,255,.06)",margin:"4px 0"}}),o.jsx("button",{onClick:()=>v(Ze=>!Ze),title:x?"Pausar [Espao]":"Continuar [Espao]",style:{width:36,height:28,borderRadius:5,cursor:"pointer",background:"rgba(255,255,255,.03)",border:`1px solid ${x?"rgba(255,255,255,.06)":"rgba(255,140,60,.40)"}`,color:x?"rgba(255,255,255,.28)":"rgba(255,160,80,.90)",display:"flex",alignItems:"center",justifyContent:"center",margin:"2px 0"},children:x?o.jsx(md,{size:12}):o.jsx(sc,{size:12})}),o.jsx("button",{onClick:()=>L(Ze=>!Ze),title:"Grimrio",style:{width:36,height:28,borderRadius:5,border:"none",cursor:"pointer",margin:"2px 0",background:O?"rgba(255,200,60,.1)":"transparent",color:O?"rgba(255,220,100,.8)":"rgba(255,255,255,.3)",display:"flex",alignItems:"center",justifyContent:"center"},children:o.jsx(Q3,{size:12})}),o.jsx("button",{onClick:()=>k(Ze=>!Ze),title:M?"Recolher HUD":"Expandir HUD",style:{width:36,height:28,borderRadius:5,border:"none",cursor:"pointer",margin:"2px 0",background:"transparent",color:"rgba(255,255,255,.2)",display:"flex",alignItems:"center",justifyContent:"center"},children:M?o.jsx(ym,{size:11}):o.jsx(hs,{size:11})}),o.jsxs("div",{style:{marginTop:"auto",marginBottom:8,display:"flex",flexDirection:"column",alignItems:"center",gap:3},children:[o.jsx("div",{style:{width:10,height:10,borderRadius:"50%",background:je==="FORGED"?"#ffd060":je==="FORMING"?"#a060ff":je==="CRACKED"?"#ff4040":"#333",boxShadow:je==="FORGED"?"0 0 8px #ffd060":"none"}}),o.jsxs("span",{style:{fontSize:4.5,color:"rgba(255,255,255,.2)",textTransform:"uppercase",letterSpacing:".06em",writingMode:"vertical-rl",transform:"rotate(180deg)"},children:[Se.size,"/118"]})]})]}),M&&o.jsxs("div",{className:"alchemy-hud-enter",style:{width:Tt,display:"flex",flexDirection:"column",background:"rgba(6,5,12,.97)",borderRight:"1px solid rgba(255,255,255,.05)",pointerEvents:"all",overflowY:"auto",overflowX:"hidden"},children:[o.jsx("div",{style:{padding:"6px 10px 5px",borderBottom:"1px solid rgba(255,255,255,.05)",flexShrink:0},children:o.jsxs("div",{style:{fontSize:7,letterSpacing:".14em",textTransform:"uppercase",color:((At=xt.find(Ze=>Ze.id===b))==null?void 0:At.color)??"rgba(255,255,255,.4)"},children:[b==="tabela"&&" Tabela Peridica",b==="atanor"&&" Atanor  Forno Alqumico",b==="opus"&&" Opus Magnus",b==="arcana"&&" Operaes &amp; Poderes"]})}),o.jsxs("div",{style:{flex:1},children:[b==="tabela"&&o.jsx($Y,{discovered:Se,progress:ke}),b==="atanor"&&o.jsx(qY,{elements:c,heat:d,transmutation:fe,quintessence:me,recipeScores:Te,simSpeed:h,onSimSpeed:Ze=>{m(Ze),nt.current=Ze},onElement:_n,onHeat:Ze=>{u(Ze),n.current&&(n.current.heat=Ze)},onPreset:Cn}),b==="opus"&&o.jsx(HY,{opus:R,sequencer:P,onStartOpus:wt,onSeqToggle:st,onSeqBpm:Zt,onSeqPreset:Pe,onSeqQuantum:ct}),b==="arcana"&&o.jsx(WY,{onOp:sn,opsUsed:Re,bars:B,barTool:re,onBarTool:oe,onDeleteBar:Ze=>W(yt=>yt.filter(Mt=>Mt.id!==Ze)),onToggleBar:Ze=>W(yt=>yt.map(Mt=>Mt.id===Ze?{...Mt,active:!Mt.active}:Mt)),onBarStrength:(Ze,yt)=>W(Mt=>Mt.map(bn=>bn.id===Ze?{...bn,strength:yt}:bn)),lens:f,onLens:Ze=>{g(Ze),mt.current=Ze}})]})]})]}),O&&o.jsxs("div",{style:{position:"fixed",right:0,top:36,bottom:0,width:240,zIndex:20,display:"flex",flexDirection:"column",background:"rgba(6,5,12,.97)",borderLeft:"1px solid rgba(255,255,255,.05)"},children:[o.jsxs("div",{style:{padding:"7px 10px",borderBottom:"1px solid rgba(255,255,255,.05)",display:"flex",alignItems:"center",justifyContent:"space-between",flexShrink:0},children:[o.jsxs("div",{style:{fontSize:8,color:"rgba(255,200,80,.7)",letterSpacing:".1em",textTransform:"uppercase",display:"flex",alignItems:"center",gap:5},children:[o.jsx(Q3,{size:10})," Grimrio (",I.length,")"]}),o.jsx("button",{title:"Fechar",onClick:()=>L(!1),style:{background:"none",border:"none",cursor:"pointer",color:"rgba(255,255,255,.3)"},children:o.jsx(Cs,{size:10})})]}),o.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"6px 8px",display:"flex",flexDirection:"column",gap:3},children:[Ae.length===0&&o.jsxs("div",{style:{fontSize:8,color:"rgba(255,255,255,.2)",textAlign:"center",padding:"20px 0",fontStyle:"italic"},children:["O Grimrio est vazio.",o.jsx("br",{}),"Execute operaes para registrar."]}),Ae.map(Ze=>o.jsx(zY,{entry:Ze,onBookmark:()=>E(yt=>yt.map(Mt=>Mt.id===Ze.id?{...Mt,bookmarked:!Mt.bookmarked}:Mt))},Ze.id))]})]}),o.jsx("div",{style:{position:"fixed",bottom:16,right:O?258:16,zIndex:25},children:o.jsx(n6,{zoom:s.zoom,onZoomIn:s.zoomIn,onZoomOut:s.zoomOut,onReset:s.resetView})}),R.active&&o.jsxs("div",{style:{position:"fixed",bottom:16,left:"50%",transform:"translateX(-50%)",zIndex:25,pointerEvents:"none",display:"flex",alignItems:"center",gap:8,padding:"5px 14px",borderRadius:20,background:"rgba(6,5,12,.9)",border:`1px solid ${Su[R.phase].color}44`},children:[o.jsx("span",{style:{fontSize:11,color:Su[R.phase].color},children:Su[R.phase].symbol}),o.jsxs("div",{children:[o.jsxs("div",{style:{fontSize:7.5,color:Su[R.phase].color,letterSpacing:".08em",textTransform:"uppercase"},children:["Opus: ",R.phase]}),o.jsx("div",{style:{width:110,height:2,background:"rgba(255,255,255,.07)",borderRadius:2,overflow:"hidden",marginTop:2},children:o.jsx("div",{style:{height:"100%",width:`${R.timer/R.maxTimer*100}%`,background:Su[R.phase].color,borderRadius:2,transition:"width .5s"}})})]}),o.jsxs("span",{style:{fontSize:7.5,fontFamily:"monospace",color:"rgba(255,255,255,.4)"},children:[Math.round(R.timer),"s/",R.maxTimer,"s"]})]}),!x&&!_e&&o.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%,-50%)",zIndex:30,pointerEvents:"none",textAlign:"center"},children:[o.jsx("div",{style:{fontSize:11,color:"rgba(255,255,255,.25)",letterSpacing:".2em",textTransform:"uppercase",fontFamily:"monospace"},children:" PAUSADO"}),o.jsx("div",{style:{fontSize:8,color:"rgba(255,255,255,.12)",marginTop:4},children:"Espao para continuar"})]}),_e&&o.jsx(BY,{data:_e,onContinue:()=>{_t.current=!1,pt.current=1,ae(null),v(!0),i.current=!0},onReplay:()=>{Rn("calcinatio"),setTimeout(()=>Rn("coagula"),600)}})]})};let VY=1;function Ky(){return`dna-${Date.now()}-${VY++}`}const UY={ascension:{flow:.85,entropy:.3,memory:.7,contrast:.4,coherence:.8},gravity:{flow:.4,entropy:.2,memory:.9,contrast:.7,coherence:.7},conflict:{entropy:.8,contrast:.9,fragmentation:.8,rhythm:.7,erosion:.6},harmony:{coherence:.9,entropy:.15,symmetry:.6,memory:.7,contrast:.3},ecstasy:{flow:.95,entropy:.7,contrast:.5,rhythm:.8,fragmentation:.5},silence:{flow:.1,entropy:.05,memory:.95,contrast:.1,coherence:.9},mondrian:{structure:.98,linear:1,entropy:.02,coherence:.98,fragmentation:.02,flow:.2},suprematist:{structure:.92,linear:.9,entropy:.08,coherence:.9,symmetry:.12,agentShape:"square"},action:{flow:.92,entropy:.88,fragmentation:.95,rhythm:.9,contrast:.92,erosion:.7},minimal:{flow:.12,entropy:.04,memory:.98,contrast:.8,coherence:.97,erosion:.02},glitch:{entropy:.95,fragmentation:.98,rhythm:.95,structure:.12,linear:.7},botanical:{flow:.62,entropy:.22,memory:.9,coherence:.82,structure:.18,fragmentation:.18},constellation:{structure:.08,flow:.25,entropy:.12,memory:.95,coherence:.92,agentShape:"star"},none:{}};function YY(e,t){const n=UY[t]??{};return{...e,intention:t,genes:{...e.genes,...n}}}function xo(e,t,n,r,a=1200,i="none"){return{id:Ky(),name:e,genes:t,palette:n,background:r,quantaCount:a,createdAt:Date.now(),intention:i}}const Qc=[xo("Quadro Branco",{structure:.18,flow:.55,entropy:.32,memory:.75,contrast:.6,symmetry:.05,glyphness:.06,erosion:.08,layering:.75,rhythm:.38,fragmentation:.22,coherence:.7},["#2a4a7f","#7f2a4a","#2a7f4a","#7f6a2a","#4a2a7f","#2a6a7f"],"#f8f6f0",0),xo("Mondrian Grid",{structure:.98,flow:.18,entropy:.03,memory:.4,contrast:.99,symmetry:0,glyphness:0,erosion:.6,layering:.3,rhythm:.85,fragmentation:.04,coherence:.98,linear:1,agentShape:"square"},["#e31414","#1449cc","#f5e614","#000000","#f5f5f5"],"#f5f5f5",700,"mondrian"),xo("Action Paint",{structure:.06,flow:.95,entropy:.92,memory:.35,contrast:.95,symmetry:0,glyphness:0,erosion:.72,layering:.85,rhythm:.95,fragmentation:.97,coherence:.18},["#cc1a00","#ff6600","#f0c000","#1a1a1a","#e0e0e0"],"#f0ece0",1200,"action"),xo("Ink Calligraphy",{structure:.15,flow:.88,entropy:.18,memory:.85,contrast:.7,symmetry:.05,glyphness:.18,erosion:.12,layering:.65,rhythm:.35,fragmentation:.08,coherence:.8},["#0d0a08","#3a1808","#8b4513","#5c3317"],"#f7f3e9",800),xo("Dust Cloud",{structure:.12,flow:.42,entropy:.88,memory:.22,contrast:.55,symmetry:0,glyphness:0,erosion:.62,layering:.78,rhythm:.55,fragmentation:.92,coherence:.2},["#d4c4a8","#8a7060","#4a3828","#2a1a10","#f0e0c8"],"#0e0a08",1100),xo("Watercolor Blobs",{structure:.06,flow:.42,entropy:.14,memory:.92,contrast:.05,symmetry:.12,glyphness:0,erosion:.04,layering:.96,rhythm:.18,fragmentation:.04,coherence:.94},["#d080c0","#80a0e0","#60c0a0","#e0c060","#c0a0d0"],"#f0eef8",700,"silence"),xo("Blueprint",{structure:.88,flow:.38,entropy:.06,memory:.85,contrast:.88,symmetry:.1,glyphness:0,erosion:.2,layering:.6,rhythm:.45,fragmentation:.12,coherence:.9,linear:.95,agentShape:"diamond"},["#a8d8ff","#60b0e8","#ffffff","#204070"],"#0a1a28",850),xo("Chromatic Ecstasy",{structure:.1,flow:.92,entropy:.7,memory:.4,contrast:.1,symmetry:0,glyphness:0,erosion:.3,layering:.92,rhythm:.35,fragmentation:.22,coherence:.65},["#ff2060","#2040ff","#00e8c0","#ffdd00","#e040a0"],"#030308",800,"ecstasy"),xo("Constellation",{structure:.08,flow:.22,entropy:.1,memory:.98,contrast:.7,symmetry:0,glyphness:0,erosion:.02,layering:.95,rhythm:.1,fragmentation:.08,coherence:.96,agentShape:"star"},["#ffffff","#a0c8ff","#c8a0ff","#60d0ff"],"#010308",500,"constellation"),xo("Glyph Ecology",{structure:.38,flow:.62,entropy:.3,memory:.8,contrast:.52,symmetry:.18,glyphness:.92,erosion:.18,layering:.68,rhythm:.45,fragmentation:.28,coherence:.72},["#1a4a1a","#2d7c2d","#84c884","#c8ecc8","#406040"],"#060e06",700,"harmony"),xo("Symmetry Temple",{structure:.6,flow:.42,entropy:.2,memory:.72,contrast:.75,symmetry:.98,glyphness:.28,erosion:.28,layering:.78,rhythm:.5,fragmentation:.08,coherence:.9},["#c8a020","#9030b0","#1040c0","#080818","#e0c060"],"#060410",700,"harmony"),xo("Fracture & Rift",{structure:.52,flow:.28,entropy:.68,memory:.42,contrast:.92,symmetry:.05,glyphness:0,erosion:.7,layering:.62,rhythm:.85,fragmentation:.95,coherence:.22},["#c04020","#6a3018","#e8b040","#181008"],"#060402",800,"conflict"),xo("Signal",{structure:.58,flow:.42,entropy:.4,memory:.42,contrast:.99,symmetry:0,glyphness:.05,erosion:.52,layering:.4,rhythm:.78,fragmentation:.32,coherence:.58},["#000000","#ffffff"],"#ffffff",800)],Ih=[xo("Suprematist",{structure:.95,flow:.2,entropy:.05,memory:.55,contrast:.98,symmetry:.08,glyphness:0,erosion:.65,layering:.25,rhythm:.75,fragmentation:.05,coherence:.96,linear:.9,agentShape:"square"},["#000000","#cc1414","#1430aa","#f5e010","#ffffff"],"#f0f0f0",550,"suprematist"),xo("Neon Wireframe",{structure:.82,flow:.55,entropy:.08,memory:.72,contrast:.98,symmetry:0,glyphness:0,erosion:.28,layering:.5,rhythm:.68,fragmentation:.18,coherence:.78,linear:1},["#00ffaa","#00aaff","#ff00aa"],"#000000",900),xo("Botanical",{structure:.2,flow:.62,entropy:.22,memory:.9,contrast:.48,symmetry:.08,glyphness:.12,erosion:.08,layering:.92,rhythm:.28,fragmentation:.18,coherence:.84},["#1a4a10","#2d7020","#6ab040","#a8d870","#d0f0a8","#386028"],"#040a02",900,"botanical"),xo("Psychedelic Mandala",{structure:.55,flow:.62,entropy:.32,memory:.7,contrast:.6,symmetry:.98,glyphness:.35,erosion:.2,layering:.88,rhythm:.55,fragmentation:.15,coherence:.82},["#ff2020","#ff8800","#ffff00","#00ff80","#0080ff","#8000ff"],"#040008",800,"ecstasy"),xo("Aurora Borealis",{structure:.12,flow:.88,entropy:.28,memory:.82,contrast:.3,symmetry:.05,glyphness:0,erosion:.1,layering:.95,rhythm:.25,fragmentation:.08,coherence:.78},["#00ffc0","#0080ff","#8000ff","#00ff80","#40c8ff"],"#000810",700,"ascension"),xo("Ink Storm",{structure:.28,flow:.78,entropy:.55,memory:.52,contrast:.9,symmetry:0,glyphness:.08,erosion:.4,layering:.72,rhythm:.8,fragmentation:.58,coherence:.42},["#0a0a0a","#1a1a1a","#888888","#cccccc"],"#f2f0ec",1e3,"conflict"),xo("Prism Scatter",{structure:.15,flow:.72,entropy:.55,memory:.55,contrast:.8,symmetry:0,glyphness:0,erosion:.35,layering:.88,rhythm:.62,fragmentation:.65,coherence:.48},["#ff0040","#ff8000","#ffff00","#00ff80","#00aaff","#8800ff"],"#0a0008",1100,"ecstasy"),xo("Slow Fog",{structure:.04,flow:.18,entropy:.2,memory:.98,contrast:.15,symmetry:0,glyphness:0,erosion:.02,layering:.98,rhythm:.08,fragmentation:.08,coherence:.92},["#aac8e0","#d0e8f0","#80a8c0","#e8f0f8"],"#e8f0f8",700,"silence"),xo("Glitch",{structure:.15,flow:.65,entropy:.95,memory:.18,contrast:.95,symmetry:0,glyphness:0,erosion:.78,layering:.6,rhythm:.92,fragmentation:.98,coherence:.12,linear:.72},["#ff00ff","#00ffff","#ffffff","#000000","#ff4400"],"#050505",1200,"glitch"),xo("Ancient Script",{structure:.32,flow:.4,entropy:.12,memory:.9,contrast:.62,symmetry:.08,glyphness:.98,erosion:.08,layering:.8,rhythm:.28,fragmentation:.15,coherence:.75},["#8b6914","#3d2a04","#c8a84b","#5c3d10","#e0c88a"],"#f5edd8",600,"gravity"),xo("Marble Veins",{structure:.35,flow:.55,entropy:.22,memory:.78,contrast:.65,symmetry:.05,glyphness:0,erosion:.15,layering:.85,rhythm:.28,fragmentation:.55,coherence:.6},["#c8c8c8","#888888","#e8e8f0","#9090a8","#6060a0"],"#f8f8ff",800),xo("Crystalline Lattice",{structure:.95,flow:.2,entropy:.03,memory:.9,contrast:.78,symmetry:.75,glyphness:0,erosion:.55,layering:.25,rhythm:.8,fragmentation:.05,coherence:.98,linear:.9,agentShape:"diamond"},["#a0d8ff","#60a8e0","#ffffff","#204060"],"#020810",600,"harmony"),xo("Coral Reef",{structure:.22,flow:.48,entropy:.18,memory:.88,contrast:.5,symmetry:.12,glyphness:.15,erosion:.08,layering:.9,rhythm:.3,fragmentation:.22,coherence:.82},["#ff6050","#ff9070","#ffb090","#40c0a0","#20a080","#ff4040"],"#020e0c",900,"harmony"),xo("Wabi-Sabi",{structure:.12,flow:.3,entropy:.08,memory:.96,contrast:.4,symmetry:0,glyphness:0,erosion:.04,layering:.98,rhythm:.12,fragmentation:.1,coherence:.95},["#8a7060","#c0a888","#403028","#d8c8b0","#f0e8d8"],"#f4efe8",350,"minimal"),xo("Void Static",{structure:.18,flow:.52,entropy:.9,memory:.12,contrast:.95,symmetry:0,glyphness:0,erosion:.65,layering:.55,rhythm:.7,fragmentation:.9,coherence:.18},["#ffffff","#cccccc","#888888","#000000"],"#000000",900),xo("Neon Plasma",{structure:.22,flow:.82,entropy:.45,memory:.6,contrast:.7,symmetry:.72,glyphness:0,erosion:.25,layering:.9,rhythm:.65,fragmentation:.3,coherence:.68},["#ff0080","#8000ff","#00ffff","#ff8000"],"#010006",800,"ecstasy")],kC=[xo("Constructive Score",{structure:.9,flow:.35,entropy:.08,memory:.7,contrast:.88,symmetry:.05,glyphness:0,erosion:.4,layering:.55,rhythm:.55,fragmentation:.12,coherence:.82,linear:.8,agentShape:"square"},["#e8e8e4","#c0c0b8","#404040","#808080","#1a1a1a"],"#0a0a0a",800),xo("Geometric Orchestra",{structure:.55,flow:.6,entropy:.22,memory:.75,contrast:.7,symmetry:.18,glyphness:0,erosion:.2,layering:.82,rhythm:.45,fragmentation:.2,coherence:.75},["#0080ff","#8040ff","#00c8ff","#ff4080","#40ffcc"],"#020510",900),xo("Analytical Collage",{structure:.6,flow:.28,entropy:.18,memory:.55,contrast:.75,symmetry:0,glyphness:0,erosion:.5,layering:.7,rhythm:.35,fragmentation:.45,coherence:.6,agentShape:"square"},["#e8d5b0","#b88040","#402010","#c0a060","#f0e8d0","#805020"],"#f5f0e8",700),xo("Spiritual Geometry",{structure:.3,flow:.22,entropy:.06,memory:.95,contrast:.6,symmetry:.4,glyphness:0,erosion:.05,layering:.92,rhythm:.18,fragmentation:.05,coherence:.95},["#e8e0c8","#b0a878","#404030","#d8d0a0"],"#08080a",350)];function KY(){const e=Math.random,t=["circle","brush"],n=["ascension","gravity","conflict","harmony","ecstasy","silence","mondrian","suprematist","action","minimal","glitch","botanical","constellation","none"],r=(d,u)=>d+e()*(u-d),a=e()>.5?r(.6,1):r(0,.3),i=e()>.4,s={structure:e()>.5?r(.65,1):r(0,.35),flow:e()>.4?r(.5,1):r(0,.3),entropy:e()>.5?r(.6,1):r(0,.25),memory:r(.1,1),contrast:e()>.4?r(.65,1):r(.05,.4),symmetry:e()>.6?r(.6,1):r(0,.2),glyphness:e()>.7?r(.5,1):r(0,.15),erosion:r(.02,.9),layering:r(.2,1),rhythm:r(.05,1),fragmentation:e()>.5?r(.65,1):r(0,.3),coherence:e()>.5?r(.65,1):r(.1,.45),linear:a,agentShape:i?t[Math.floor(e()*t.length)]:"circle"},c=n[Math.floor(e()*n.length)],l=e()>.55?XY():JY();return{id:Ky(),name:"Random",genes:s,intention:c,palette:Sy(4+Math.floor(e()*4)),background:l,quantaCount:Math.floor(350+e()*900),createdAt:Date.now()}}function XY(){const e=Math.floor(Math.random()*360),t=Math.floor(Math.random()*25),n=Math.floor(2+Math.random()*10);return Xy(e,t,n)}function JY(){const e=Math.floor(Math.random()*360),t=Math.floor(Math.random()*18),n=Math.floor(88+Math.random()*10);return Xy(e,t,n)}function QY(e,t,n){const r={},a=new Set([...Object.keys(e),...Object.keys(t)]);for(const i of a){if(i==="agentShape"){r[i]=n<.5?e[i]:t[i];continue}const s=e[i]??0,c=t[i]??0;e[i]===void 0&&t[i]===void 0||(r[i]=s*(1-n)+c*n)}return r}function Xy(e,t,n){n/=100,t/=100;const r=t*Math.min(n,1-n),a=i=>{const s=(i+e/30)%12,c=n-r*Math.max(Math.min(s-3,9-s,1),-1);return Math.round(255*c).toString(16).padStart(2,"0")};return`#${a(0)}${a(8)}${a(4)}`}function Sy(e=6){const t=Math.random()*360,n=Math.random(),r=[],a=Math.random()>.45,i=a?20:45,s=a?60:85;for(let c=0;c<e;c++){let l;n<.15?l=(t+c*12)%360:n<.3?l=(t+(c%2?180:0)+c*6)%360:n<.5?l=(t+c%3*120+c*4)%360:n<.65?l=(t+c%4*90)%360:n<.8?l=(t+c%2*150+c*8)%360:l=(t+c/e*360)%360;const d=c===e-1&&Math.random()>.5?10+Math.random()*20:55+Math.random()*40,u=i+Math.random()*(s-i);r.push(Xy((l+360)%360,d,u))}return r}function ZY(e,t){const n=(t()*80-40+360)%360;return e.map(r=>{const a=parseInt(r.slice(1,3),16)/255,i=parseInt(r.slice(3,5),16)/255,s=parseInt(r.slice(5,7),16)/255,c=Math.max(a,i,s),l=Math.min(a,i,s);let d=0;const u=c-l,h=(c+l)/2,m=u===0?0:u/(1-Math.abs(2*h-1));if(u!==0)switch(c){case a:d=((i-s)/u+(i<s?6:0))*60;break;case i:d=((s-a)/u+2)*60;break;case s:d=((a-i)/u+4)*60;break}return Xy((d+n)%360,m*100,h*100)})}const Kb=48;function o5(){const e=Kb*Kb;return{size:Kb,flowX:new Float32Array(e),flowY:new Float32Array(e),density:new Float32Array(e),pressure:new Float32Array(e),memory:new Float32Array(e),symbol:new Float32Array(e),mask:new Float32Array(e),interactionMatrix:new Float32Array(36)}}function eK(e){let t=Math.abs(e|0)%233280||1;return()=>(t=(t*9301+49297)%233280,t/233280)}function RC(e,t,n){const r=n%1e3,a=Math.sin(e*127.1+r*.311)*43758.5453,i=Math.sin(t*269.5+r*.183)*43758.5453;return a-Math.floor(a)-.5+(i-Math.floor(i)-.5)}function a5(e,t,n){const{structure:r,coherence:a,entropy:i,flow:s,symmetry:c}=t.genes,l=e.size,d=n%6283*.001;for(let u=0;u<l;u++)for(let h=0;h<l;h++){const m=h/l,f=u/l;let g;if(r>.8)g=Math.round(m*4*r)%4*Math.PI/2+f*s*Math.PI*.3;else if(c>.65){const v=m-.5,b=f-.5,w=Math.atan2(b,v),M=Math.sqrt(v*v+b*b);g=w+Math.PI/2+Math.sin(M*(6+a*8)+d)*s*1.5}else if(i>.8)g=RC(m+d*.1,f+d*.1,n)*Math.PI*3;else{const v=2+a*3,b=v*1.8;g=Math.sin(m*v+d)*Math.cos(f*v+d*.7)*Math.PI*2+Math.cos(m*b-f*b+d*.5)*s*Math.PI+RC(m+d*.08,f+d*.06,n)*i*Math.PI}const x=u*l+h;e.flowX[x]=Math.cos(g),e.flowY[x]=Math.sin(g)}}function e0(e,t,n=!1){const r=eK((Math.abs(t|0)^57005)%233280||1),a=new Float32Array(36),{entropy:i,coherence:s,fragmentation:c,contrast:l,rhythm:d,structure:u}=e.genes,h=[[.35,-.25,.15,-.5,.4,.05],[.3,.2,-.3,.1,-.15,.35],[.1,-.15,.25,.3,-.2,.1],[-.45,.15,-.2,-.1,.5,-.35],[.55,-.25,.15,.3,.15,0],[.05,.35,-.1,-.3,.05,.4]],m=[0,1,2,3,4,5];for(let x=m.length-1;x>0;x--){const v=Math.floor(r()*(x+1)),b=m[x];m[x]=m[v],m[v]=b}const f=r()<.5?1:-1,g=(r()-.5)*.18;for(let x=0;x<6;x++)for(let v=0;v<6;v++){const b=x===v;if(n&&!b){r(),r(),a[x*6+v]=0;continue}let w;if(n&&b)w=.65+r()*.25;else if(u>.82)w=b?.55+r()*.3:-(.12+r()*.22);else if(s>.8&&i<.28)w=b?.75+r()*.22:(r()-.72)*.18;else if(c>.85)w=b?.4+r()*.5:(r()-.5)*.08;else if(i>.82)w=(r()-.5)*2.2;else{const M=h[m[x]][m[v]]*f+g*((x-v)/5),k=(r()-.5)*i*.9,R=.35+s*.55+l*.35,j=b?0:-c*.28;w=M*R+k+j}w+=(r()-.5)*d*.12,a[x*6+v]=w}return a}function tK(e,t,n){const r=e.size,a=Math.max(0,Math.min(r-1,Math.floor(t*r))),s=Math.max(0,Math.min(r-1,Math.floor(n*r)))*r+a;return{fx:e.flowX[s],fy:e.flowY[s]}}function nK(e,t,n,r){const a=e.size,i=Math.max(0,Math.min(a-1,Math.floor(t*a))),c=Math.max(0,Math.min(a-1,Math.floor(n*a)))*a+i;e.density[c]=Math.min(1,e.density[c]+r),e.memory[c]=Math.min(1,e.memory[c]+r*.3)}function AC(e,t,n,r,a,i,s=0){const c=e.size,l=Math.ceil(r*c),d=Math.floor(t*c),u=Math.floor(n*c);for(let h=-l;h<=l;h++)for(let m=-l;m<=l;m++){const f=d+m,g=u+h;if(f<0||g<0||f>=c||g>=c)continue;const x=Math.sqrt(m*m+h*h)/(l+.1);if(x>1)continue;const v=(1-x)*(1-x)*i,b=g*c+f;switch(a){case"attractor":{const w=(d-f)/(c*.01+Math.abs(d-f)),M=(u-g)/(c*.01+Math.abs(u-g));e.flowX[b]=e.flowX[b]*(1-v*.5)+w*v*.5,e.flowY[b]=e.flowY[b]*(1-v*.5)+M*v*.5;break}case"repulsor":{const w=(f-d)/(c*.01+Math.abs(f-d)),M=(g-u)/(c*.01+Math.abs(g-u));e.flowX[b]=e.flowX[b]*(1-v*.5)+w*v*.5,e.flowY[b]=e.flowY[b]*(1-v*.5)+M*v*.5;break}case"flow_comb":e.flowX[b]=e.flowX[b]*(1-v)+Math.cos(s)*v,e.flowY[b]=e.flowY[b]*(1-v)+Math.sin(s)*v;break;case"vortex":{const w=-(g-u)/(c+1),M=(f-d)/(c+1),k=Math.sqrt(w*w+M*M)+1e-4;e.flowX[b]=e.flowX[b]*(1-v*.6)+w/k*v*.6,e.flowY[b]=e.flowY[b]*(1-v*.6)+M/k*v*.6;break}case"solve":e.density[b]*=1-v*.15,e.pressure[b]*=1-v*.2,e.memory[b]*=1-v*.05;break;case"coagula":e.density[b]=Math.min(1,e.density[b]+v*.1),e.pressure[b]=Math.min(1,e.pressure[b]+v*.15),e.memory[b]=Math.min(1,e.memory[b]+v*.08);break}}}function rK(e,t){const{memory:n,coherence:r}=t.genes,a=e.size,i=.982+n*.017,s=r*.015,c=new Float32Array(e.density);for(let l=1;l<a-1;l++)for(let d=1;d<a-1;d++){const u=l*a+d,h=c[(l-1)*a+d]+c[(l+1)*a+d]+c[l*a+(d-1)]+c[l*a+(d+1)];e.density[u]=(c[u]*(1-s)+h/4*s)*i,e.pressure[u]*=.94,e.memory[u]*=.9995}}function oK(e){let t=Math.abs(e|0)%233280||1;return()=>(t=(t*9301+49297)%233280,t/233280)}function Jy(e){const t=parseInt(e.slice(1,3),16)/255,n=parseInt(e.slice(3,5),16)/255,r=parseInt(e.slice(5,7),16)/255,a=Math.max(t,n,r),i=Math.min(t,n,r);let s=0,c=0;const l=(a+i)/2;if(a!==i){const d=a-i;switch(c=l>.5?d/(2-a-i):d/(a+i),a){case t:s=((n-r)/d+(n<r?6:0))/6;break;case n:s=((r-t)/d+2)/6;break;case r:s=((t-n)/d+4)/6;break}}return[s*360,c,l]}function jC(e,t,n=8){const r=t.length;if(r!==0)for(const a of e){const i=t[a.species%r]??t[0],[s,c,l]=Jy(i);a.hue=(s+(Math.random()-.5)*n+360)%360,a.sat=Math.max(.35,Math.min(1,c+(Math.random()-.5)*.06)),a.lit=Math.max(.15,Math.min(.88,l+(Math.random()-.5)*.04)),a.baseHue!==void 0&&(a.baseHue=s)}}const Ua=18;function S6(e){const t=Array.from({length:Ua*Ua},()=>[]);for(let n=0;n<e.length;n++){const r=e[n],a=Math.min(Ua-1,Math.max(0,Math.floor(r.x*Ua))),i=Math.min(Ua-1,Math.max(0,Math.floor(r.y*Ua)));t[i*Ua+a].push(n)}return t}function aK(e,t,n,r){if(e<n)return-Math.max(.3,Math.abs(t))*(n/(e+1e-4)-1)*3;if(e>=r)return 0;const a=(e-n)/(r-n);return t*(1-Math.abs(2*a-1))}const EC=[[.22,.22],[.78,.22],[.22,.78],[.78,.78],[.5,.22],[.5,.78]],kf=[{flowFollow:1.2,noiseScale:.6,dampOffset:.04,maxSpeedMul:1,name:"luminous"},{flowFollow:.2,noiseScale:.2,dampOffset:.14,maxSpeedMul:.35,name:"shadowed"},{flowFollow:2.8,noiseScale:.18,dampOffset:.01,maxSpeedMul:2.2,name:"flowing"},{flowFollow:.05,noiseScale:2.8,dampOffset:-.2,maxSpeedMul:3.5,name:"expander"},{flowFollow:1.5,noiseScale:.35,dampOffset:.05,maxSpeedMul:1.3,name:"magnetic"},{flowFollow:.08,noiseScale:4,dampOffset:-.3,maxSpeedMul:4.5,name:"glitch"}];function sK(e,t){const n=oK(t),r=e.quantaCount,a=[];if(r<=0)return a;const i=["DRAW","DRAW","DRAW","DRAW","FLOW","GLYPH","STAMP","ERASE"],s=[.5,.5,.5,.5,.15,e.genes.glyphness*.3,.08,.04],c=s.reduce((l,d)=>l+d,0);for(let l=0;l<r;l++){const d=Math.floor(n()*e.palette.length),u=e.palette[d]??"#888888",[h,m,f]=Jy(u);let g="DRAW";const x=n()*c;let v=0;for(let j=0;j<i.length;j++)if(v+=s[j],x<v){g=i[j];break}const b=(l%6+Math.floor(n()*2))%6,w=.003+e.genes.flow*.008,M=n()*Math.PI*2,k=kf[b]??kf[0],R=w*k.maxSpeedMul*(.5+n()*.5);a.push({x:n(),y:n(),vx:Math.cos(M)*R,vy:Math.sin(M)*R,charge:n(),ink:.4+n()*.6,mood:n(),role:g,species:b,memX:new Float32Array([n(),n(),n(),n(),n(),n()]),memY:new Float32Array([n(),n(),n(),n(),n(),n()]),memIdx:0,age:Math.floor(n()*200),hue:h+(n()-.5)*40*(1-e.genes.coherence),sat:Math.max(.05,Math.min(1,m+(n()-.5)*.25*e.genes.contrast)),lit:Math.max(.1,Math.min(.9,f+(n()-.5)*.25)),alpha:.45+n()*.55,size:.8+n()*2.5*(1+e.genes.structure*.5),glyphIndex:Math.floor(n()*32)})}return a}function TC(e,t,n,r,a,i,s,c){const l=[],d=e.palette;for(let u=0;u<i;u++){const h=Math.random,m=c>=0&&c<d.length?c:Math.floor(h()*d.length),f=d[m]??"#888888",[g,x,v]=Jy(f),b=Math.floor(h()*6),w=kf[b]??kf[0],M=Math.max(.001,Math.min(.999,t+(h()-.5)*s)),k=Math.max(.001,Math.min(.999,n+(h()-.5)*s)),R=.6+h()*1.2;l.push({x:M,y:k,vx:r*R*w.maxSpeedMul+(h()-.5)*.003,vy:a*R*w.maxSpeedMul+(h()-.5)*.003,charge:h(),ink:.7+h()*.3,mood:h(),role:"DRAW",species:b,memX:new Float32Array([M,M,M,M,M,M]),memY:new Float32Array([k,k,k,k,k,k]),memIdx:0,age:0,hue:g+(h()-.5)*30*(1-e.genes.coherence),sat:Math.max(.1,Math.min(1,x+(h()-.5)*.2)),lit:Math.max(.15,Math.min(.9,v+(h()-.5)*.15)),alpha:.6+h()*.4,size:.8+h()*2.5*(1+e.genes.structure*.5),glyphIndex:Math.floor(h()*32)})}return l}function iK(e,t,n,r,a,i,s,c=1,l=!1,d="wrap",u){const{flow:h,entropy:m,coherence:f,erosion:g,rhythm:x,fragmentation:v,structure:b}=n.genes,w=n.genes.linear??0,M=(u==null?void 0:u.rMaxMul)??1,k=(u==null?void 0:u.forceMul)??1,R=(u==null?void 0:u.dampingMul)??1,j=(u==null?void 0:u.noiseMul)??1,I=(u==null?void 0:u.maxSpeedMul)??1,E=(u==null?void 0:u.rMinMul)??1,O=(u==null?void 0:u.centerPull)??0,L=(u==null?void 0:u.quadrantMode)??!1,$=(u==null?void 0:u.quadrantStrength)??.3,F=(u==null?void 0:u.borderRepulsion)??0,B=(3e-4+Math.pow(h,1.6)*.0175)*I,W=m*m*.038*j,re=(.97-Math.pow(m,1.5)*.39)*Math.max(.5,Math.min(1.5,R)),oe=.02+Math.pow(h,1.5)*.28,te=1-g,J=x>.35?.88+.12*Math.sin(s*.07*x):1,pe=.016*E,P=(.07+v*.055+f*.025)*M,V=(.015+f*.045+n.genes.contrast*.025)*k,fe=S6(e),ye=t.interactionMatrix,Se=e.length,we=n.genes.isolation??0,ke=we>.01?Math.max(0,1-we*1.2):1,De=r.isDragging,_e=r.lastX/a,ae=r.lastY/i,Fe=Math.max(.06,r.size/Math.max(a,i)*5);for(let Oe=0;Oe<Se;Oe++){const ne=e[Oe],nt=kf[ne.species]??kf[0],{fx:pt,fy:Et}=tK(t,ne.x,ne.y),_t=w>.4?Math.max(0,1-w*.9):1,Ct=oe*nt.flowFollow*(1-m*.4)*_t,Xe=W*nt.noiseScale*_t,Ut=Math.max(.48,Math.min(.98,re+nt.dampOffset+f*.03));let Le=pt*Ct+(Math.random()-.5)*Xe,Ke=Et*Ct+(Math.random()-.5)*Xe;const mt=Math.min(Ua-1,Math.max(0,Math.floor(ne.x*Ua))),an=Math.min(Ua-1,Math.max(0,Math.floor(ne.y*Ua)));for(let Rn=-1;Rn<=1;Rn++)for(let sn=-1;sn<=1;sn++){const Cn=mt+sn,wt=an+Rn;if(Cn<0||wt<0||Cn>=Ua||wt>=Ua)continue;const st=fe[wt*Ua+Cn];for(const Zt of st){if(Zt===Oe)continue;const Pe=e[Zt];let ct=Pe.x-ne.x,vt=Pe.y-ne.y;ct>.5&&(ct-=1),ct<-.5&&(ct+=1),vt>.5&&(vt-=1),vt<-.5&&(vt+=1);const xe=Math.sqrt(ct*ct+vt*vt);if(xe<1e-4||xe>P)continue;const ge=ye[ne.species*6+Pe.species],me=ne.species===Pe.species?1:ke;if(me<=1e-4)continue;const je=aK(xe,ge,pe,P)*me;if(je===0)continue;const Te=je*V/(xe+1e-4);Le+=ct*Te,Ke+=vt*Te}}if(b>.65){const Rn=(b-.65)*1.8,sn=.04+(1-b)*.08,Cn=Math.round(ne.x/sn)*sn,wt=Math.round(ne.y/sn)*sn;Le+=(Cn-ne.x)*Rn*.15,Ke+=(wt-ne.y)*Rn*.15}if((ne.species===3||ne.species===5)&&Math.random()<x*.04&&(Le+=(Math.random()-.5)*.012,Ke+=(Math.random()-.5)*.012),O>.001&&(Le+=(.5-ne.x)*O*.003,Ke+=(.5-ne.y)*O*.003),L){const Rn=EC[ne.species]??EC[0],sn=Rn[0]-ne.x,Cn=Rn[1]-ne.y,st=Math.sqrt(sn*sn+Cn*Cn)>.28?2.8:1,Zt=$*.022*st;if(Le+=sn*Zt,Ke+=Cn*Zt,we>.3){const Pe=(we-.3)*1.5;Le+=sn*Pe*.01,Ke+=Cn*Pe*.01}}if(F>.001){const sn=F*.005;ne.x<.08&&(Le+=(.08-ne.x)*sn*4),ne.x>1-.08&&(Le-=(ne.x-(1-.08))*sn*4),ne.y<.08&&(Ke+=(.08-ne.y)*sn*4),ne.y>1-.08&&(Ke-=(ne.y-(1-.08))*sn*4)}if(w>.4){const Rn=Math.min(1,(w-.4)*1.67),sn=Math.sqrt(ne.vx*ne.vx+ne.vy*ne.vy);if(sn>2e-5){const Cn=ne.vx/sn,wt=ne.vy/sn,st=Le*Cn+Ke*wt,Zt=Le-st*Cn,Pe=Ke-st*wt;Le-=Zt*Rn*.97,Ke-=Pe*Rn*.97}}const gn=w>.4?w*.015:0,Be=Math.pow(Math.max(.01,Math.min(.9999,Ut+gn)),c);ne.vx=(ne.vx*Be+Le*c)*J,ne.vy=(ne.vy*Be+Ke*c)*J;const ft=Math.sqrt(ne.vx*ne.vx+ne.vy*ne.vy),Qt=B*nt.maxSpeedMul,nr=w>.5?Qt*(1+w*1.5):Qt;if(ft>nr){const Rn=nr/ft;ne.vx*=Rn,ne.vy*=Rn}if(d==="wrap"?(ne.x=((ne.x+ne.vx*c)%1+1)%1,ne.y=((ne.y+ne.vy*c)%1+1)%1):d==="bounce"?(ne.x+=ne.vx*c,ne.y+=ne.vy*c,ne.x<0&&(ne.x=-ne.x,ne.vx=Math.abs(ne.vx)),ne.x>1&&(ne.x=2-ne.x,ne.vx=-Math.abs(ne.vx)),ne.y<0&&(ne.y=-ne.y,ne.vy=Math.abs(ne.vy)),ne.y>1&&(ne.y=2-ne.y,ne.vy=-Math.abs(ne.vy)),ne.x=Math.max(0,Math.min(1,ne.x)),ne.y=Math.max(0,Math.min(1,ne.y))):d==="absorb"?(ne.x+=ne.vx*c,ne.y+=ne.vy*c,(ne.x<0||ne.x>1||ne.y<0||ne.y>1)&&(ne.x=.1+Math.random()*.8,ne.y=.1+Math.random()*.8,ne.vx=(Math.random()-.5)*.005,ne.vy=(Math.random()-.5)*.005)):(ne.x+=ne.vx*c,ne.y+=ne.vy*c,ne.x=Math.max(-.5,Math.min(1.5,ne.x)),ne.y=Math.max(-.5,Math.min(1.5,ne.y))),Math.sqrt(ne.vx*ne.vx+ne.vy*ne.vy)>1e-4&&n.genes.agentShape==="brush"&&(ne.angle=Math.atan2(ne.vy,ne.vx)),ne.memX[ne.memIdx]=ne.x,ne.memY[ne.memIdx]=ne.y,ne.memIdx=(ne.memIdx+1)%6,nK(t,ne.x,ne.y,.008*ne.ink),De){const Rn=_e-ne.x,sn=ae-ne.y,Cn=Math.sqrt(Rn*Rn+sn*sn)+1e-4;if(Cn<Fe){const st=(1-Cn/Fe)*r.pressure,Zt=1/Cn,Pe=r.activeToolId;if(Pe==="attract"||Pe==="attractor"){const ct=1.6/(Cn*8+1);ne.vx+=Rn*Zt*st*ct,ne.vy+=sn*Zt*st*ct}else if(Pe==="repel"||Pe==="repulsor"){const ct=1.8/(Cn*8+1);ne.vx-=Rn*Zt*st*ct,ne.vy-=sn*Zt*st*ct}else if(Pe==="vortex"){const ct=1.5/(Cn*6+1);ne.vx+=-sn*Zt*st*ct,ne.vy+=Rn*Zt*st*ct}else if(Pe==="freeze"){const ct=Math.max(0,1-st*.85);ne.vx*=ct,ne.vy*=ct}else if(Pe==="burst"){const ct=Math.random()*Math.PI*2,vt=st*nr*120/(Cn*4+1);ne.vx+=Math.cos(ct)*vt,ne.vy+=Math.sin(ct)*vt}else if(Pe==="black_hole"){const ct=st*st*2.2/(Cn+.004);ne.vx+=Rn*Zt*ct,ne.vy+=sn*Zt*ct,Cn<Fe*.12&&(ne.x=(1-ne.x+(Math.random()-.5)*.15+1)%1,ne.y=(1-ne.y+(Math.random()-.5)*.15+1)%1)}else if(Pe==="color_infect"){const ct=n.palette[r.colorIndex%n.palette.length];if(ct){const[vt,xe,ge]=Jy(ct),Ee=(vt-ne.hue+540)%360-180;ne.hue=(ne.hue+Ee*st*.15+360)%360,ne.sat=ne.sat+(xe-ne.sat)*st*.12,ne.lit=ne.lit+(ge-ne.lit)*st*.1}}else if(Pe==="size_wave")ne.size=Math.max(.2,ne.size+Math.sin(s*.08+ne.age*.05)*st*1.2);else if(Pe==="ink_flood")ne.ink=Math.min(1,ne.ink+st*.14);else if(Pe==="species_shift")Math.random()<st*.06&&(ne.species=Math.floor(Math.random()*6));else if(Pe==="pinch")ne.vx+=(_e-ne.x)*st*.35,ne.vy+=(ae-ne.y)*st*.35;else if(Pe==="scatter_burst"){const ct=1.4/(Cn*6+1);ne.vx-=Rn*Zt*st*ct,ne.vy-=sn*Zt*st*ct}else Pe==="channel"&&(ne.vx+=r.dragDX*st*.7,ne.vy+=r.dragDY*st*.7)}}l||(ne.ink=Math.max(0,ne.ink-g*.0018),ne.ink<.08&&(ne.ink=.2+Math.random()*.6*te),ne.mood+=(Math.random()-.5)*.009,ne.mood=Math.max(0,Math.min(1,ne.mood)),(ne.species===2||ne.species===5)&&(ne.hue=(ne.hue+.08)%360)),ne.age++}}function Xb(e,t,n,r,a,i,s){switch(e.globalAlpha=s,e.fillStyle=i,e.strokeStyle=i,e.beginPath(),t){case"square":e.rect(n-a,r-a,a*2,a*2),e.fill();break;case"diamond":e.moveTo(n,r-a),e.lineTo(n+a,r),e.lineTo(n,r+a),e.lineTo(n-a,r),e.closePath(),e.fill();break;case"triangle":e.moveTo(n,r-a),e.lineTo(n+a*.87,r+a*.5),e.lineTo(n-a*.87,r+a*.5),e.closePath(),e.fill();break;case"cross":{const c=a*.35;e.rect(n-c,r-a,c*2,a*2),e.fill(),e.beginPath(),e.rect(n-a,r-c,a*2,c*2),e.fill();break}case"star":{const l=a*.42;for(let d=0;d<10;d++){const u=d/10*Math.PI*2-Math.PI/2,h=d%2===0?a:l;d===0?e.moveTo(n+Math.cos(u)*h,r+Math.sin(u)*h):e.lineTo(n+Math.cos(u)*h,r+Math.sin(u)*h)}e.closePath(),e.fill();break}default:e.arc(n,r,a,0,Math.PI*2),e.fill()}}function lK(e){return(e.linear??0)>.5?"straight":e.entropy>.68&&e.memory<.5?"dust":e.structure>.7?"blocks":e.coherence>.76&&e.entropy<.32?"blobs":"lines"}function cK(e){return e<.28?1:e<.5?2:e<.66?4:e<.82?6:8}function dK(e,t,n,r,a,i,s=1,c){const{contrast:l,glyphness:d,symmetry:u}=n.genes,h=lK(n.genes),m=cK(u),f=r/2,g=a/2,x=n.genes.agentShape??"circle",v=x==="brush",b=c;for(const w of t){if(w.role==="FLOW"||w.role==="MASK"||w.ink<.04)continue;const M=w.x*r,k=w.y*a,R=[];for(let $=0;$<6;$++){const F=(w.memIdx+$)%6;R.push([w.memX[F]*r,w.memY[F]*a])}let j=!1;for(let $=1;$<6;$++)if(Math.abs(R[$][0]-R[$-1][0])>r*.18||Math.abs(R[$][1]-R[$-1][1])>a*.18){j=!0;break}if(j)continue;const I=`hsl(${w.hue.toFixed(0)},${(w.sat*100).toFixed(0)}%,${(w.lit*100).toFixed(0)}%)`,E=`hsla(${w.hue.toFixed(0)},${(w.sat*100).toFixed(0)}%,${(w.lit*100).toFixed(0)}%,0)`,O=w.ink*w.alpha,L=Math.min(.85,O*(.14+l*.52));if(v&&b){const $=w.angle??0,F=R[5],B=Math.max(3,w.size*s*8*b.lengthMul*(w.isSingleton?3:1)),W=Math.max(.4,w.size*s*b.widthMul*(.4+w.mood*.6)*(w.isSingleton?2:1)),re=Math.cos($),oe=Math.sin($),te=L*b.opacityMul*(1-b.opacityJitter*Math.random());if(b.textureBreak>0&&Math.random()<b.textureBreak)continue;e.lineCap=b.lineCap;for(let J=0;J<b.bristles;J++){const pe=b.bristleSpread>0?(J-(b.bristles-1)/2)*b.bristleSpread:0,P=-oe*pe,V=re*pe,fe=W*(1-b.widthJitter*Math.random());e.globalAlpha=Math.min(.8,te/b.bristles),e.strokeStyle=I,e.lineWidth=Math.max(.3,fe),e.beginPath(),e.moveTo(F[0]-re*B*.5+P,F[1]-oe*B*.5+V),e.lineTo(F[0]+re*B*.5+P,F[1]+oe*B*.5+V),e.stroke()}b.bleed>.05&&(e.globalAlpha=te*b.bleed*.08,e.filter="blur(4px)",e.strokeStyle=I,e.lineWidth=W*3,e.beginPath(),e.moveTo(F[0]-re*B*.4,F[1]-oe*B*.4),e.lineTo(F[0]+re*B*.4,F[1]+oe*B*.4),e.stroke(),e.filter="none"),e.lineCap="round";continue}if(w.role==="GLYPH"&&d>.12&&i%10===Math.floor(w.age%10)){const $=["","","","","","","","","","","",""];e.globalAlpha=Math.min(.9,L*1.5),e.fillStyle=I,e.font=`${Math.max(6,w.size*s*1.6)}px monospace`,e.textAlign="center",e.textBaseline="middle";for(let F=0;F<m;F++){const B=F/m*Math.PI*2,W=Math.cos(B),re=Math.sin(B),oe=M-f,te=k-g;e.fillText($[w.glyphIndex%$.length],f+oe*W-te*re,g+oe*re+te*W)}continue}for(let $=0;$<m;$++){let F=R;if(m>1){const B=$/m*Math.PI*2,W=Math.cos(B),re=Math.sin(B);F=R.map(([oe,te])=>{const J=oe-f,pe=te-g;return[f+J*W-pe*re,g+J*re+pe*W]})}switch(e.fillStyle=I,e.strokeStyle=I,e.lineCap="round",e.lineJoin="round",h){case"dust":{const B=Math.max(.3,w.size*s*.22+w.mood*.18);Xb(e,x,F[5][0],F[5][1],B,I,L*.65);break}case"blocks":{const B=Math.max(2,Math.round(w.size*s*(.8+n.genes.structure*1.3))),W=Math.round(F[5][0]/B)*B,re=Math.round(F[5][1]/B)*B,oe=n.genes.fragmentation*B*.3,te=(B-oe)/2;Xb(e,x,W+B/2,re+B/2,te,I,L*.88);break}case"blobs":{const B=Math.max(3,w.size*s*(1.8+n.genes.coherence*5)),W=e.createRadialGradient(F[5][0],F[5][1],0,F[5][0],F[5][1],B);W.addColorStop(0,I),W.addColorStop(.6,I),W.addColorStop(1,E),e.fillStyle=W,e.globalAlpha=L*.22,e.beginPath(),e.arc(F[5][0],F[5][1],B,0,Math.PI*2),e.fill(),e.fillStyle=I;break}case"straight":case"lines":default:{if(x!=="circle"){const B=Math.max(.3,w.size*s*.32);Xb(e,x,F[5][0],F[5][1],B,I,L*.78)}else{e.globalAlpha=L,e.lineWidth=Math.max(.2,w.size*s*(h==="straight"?.35:.28)*(.5+w.mood*.7)),h==="straight"&&(e.lineCap="square"),e.beginPath(),e.moveTo(F[1][0],F[1][1]);for(let B=2;B<=4;B++){const W=F[B-2],re=F[B-1],oe=F[B],te=F[Math.min(B+1,5)],J=re[0]+(oe[0]-W[0])/6,pe=re[1]+(oe[1]-W[1])/6,P=oe[0]-(te[0]-re[0])/6,V=oe[1]-(te[1]-re[1])/6;e.bezierCurveTo(J,pe,P,V,oe[0],oe[1])}e.stroke(),h==="straight"&&(e.lineCap="round")}break}}}}e.globalAlpha=1,e.globalCompositeOperation="source-over"}function IC(e,t,n,r,a,i=1,s){e.clearRect(0,0,r,a);const{contrast:c}=n.genes,l=n.genes.agentShape==="brush",d=s;for(const u of t){if(u.role==="FLOW"||u.role==="MASK")continue;const h=u.x*r,m=u.y*a,f=`hsl(${u.hue.toFixed(0)},${(u.sat*100).toFixed(0)}%,${(u.lit*100).toFixed(0)}%)`,g=Math.min(.9,u.ink*u.alpha*(.28+c*.55));if(l&&d){const x=u.angle??0,v=Math.max(2,u.size*i*6*d.lengthMul*(u.isSingleton?3:1)),b=Math.max(.5,u.size*i*d.widthMul*(.5+u.mood*.5)*(u.isSingleton?2:1)),w=Math.cos(x),M=Math.sin(x);if(e.lineCap=d.lineCap,e.lineJoin="round",d.textureBreak>0&&Math.random()<d.textureBreak)continue;const k=g*d.opacityMul*(1-d.opacityJitter*Math.random());for(let R=0;R<d.bristles;R++){const j=d.bristleSpread>0?(R-(d.bristles-1)/2)*d.bristleSpread:0,I=-M*j,E=w*j,O=b*(1-d.widthJitter*Math.random());e.globalAlpha=k/d.bristles,e.strokeStyle=f,e.lineWidth=Math.max(.3,O),e.beginPath(),e.moveTo(h-w*v*.5+I,m-M*v*.5+E),e.lineTo(h+w*v*.5+I,m+M*v*.5+E),e.stroke()}d.bleed>.05&&(e.globalAlpha=k*d.bleed*.12,e.filter="blur(3px)",e.strokeStyle=f,e.lineWidth=b*2.5,e.beginPath(),e.moveTo(h-w*v*.3,m-M*v*.3),e.lineTo(h+w*v*.3,m+M*v*.3),e.stroke(),e.filter="none")}else{const x=g;e.globalAlpha=x,e.fillStyle=f;const v=Math.max(.5,u.size*i*.38*(u.isSingleton?5:1)+u.mood*.4);e.beginPath(),e.arc(h,m,v,0,Math.PI*2),e.fill()}}e.globalAlpha=1,e.lineCap="round"}function uK(e,t,n,r,a){e.clearRect(0,0,r,a);const i=(.06+n.genes.coherence*.055)*Math.min(r,a),s=i*i,c=S6(t),{contrast:l,coherence:d}=n.genes;for(let u=0;u<t.length;u++){const h=t[u],m=h.x*r,f=h.y*a,g=Math.min(Ua-1,Math.max(0,Math.floor(h.x*Ua))),x=Math.min(Ua-1,Math.max(0,Math.floor(h.y*Ua)));for(let v=-1;v<=1;v++)for(let b=-1;b<=1;b++){const w=g+b,M=x+v;if(!(w<0||M<0||w>=Ua||M>=Ua))for(const k of c[M*Ua+w]){if(k<=u)continue;const R=t[k],j=R.x*r,I=R.y*a,E=j-m,O=I-f,L=E*E+O*O;if(L>s)continue;const F=1-Math.sqrt(L)/i,B=(h.hue+R.hue)/2,W=Math.max(.2,Math.min(.85,(h.lit+R.lit)/2)),re=F*F*(.08+l*.18)*d;e.globalAlpha=Math.min(.6,re),e.strokeStyle=`hsl(${B.toFixed(0)},${((h.sat+R.sat)/2*100).toFixed(0)}%,${(W*100).toFixed(0)}%)`,e.lineWidth=Math.max(.2,F*.9),e.beginPath(),e.moveTo(m,f),e.lineTo(j,I),e.stroke()}}}e.globalAlpha=1}function hK(e,t,n,r,a,i=1){e.clearRect(0,0,r,a);const{coherence:s,contrast:c,flow:l}=n.genes,d=(5+s*10+l*5)*i,u=n.background,m=(u.length>=7?(parseInt(u.slice(1,3),16)*.299+parseInt(u.slice(3,5),16)*.587+parseInt(u.slice(5,7),16)*.114)/255:.1)>.5;for(const f of t){if(f.ink<.08)continue;const g=f.x*r,x=f.y*a,v=f.ink*f.alpha*(.04+c*.08+(m?.03:0));if(v<.004)continue;const b=d*(.5+f.size*.08),w=m?Math.max(.1,f.lit*.72):Math.min(.9,f.lit+.15),M=`hsl(${f.hue.toFixed(0)},${Math.min(100,f.sat*120).toFixed(0)}%,${(w*100).toFixed(0)}%)`,k=`hsla(${f.hue.toFixed(0)},${(f.sat*100).toFixed(0)}%,${(w*100).toFixed(0)}%,0.3)`,R=e.createRadialGradient(g,x,0,g,x,b);R.addColorStop(0,M),R.addColorStop(.45,k),R.addColorStop(1,`hsla(${f.hue.toFixed(0)},50%,50%,0)`),e.globalAlpha=Math.min(.7,v),e.fillStyle=R,e.beginPath(),e.arc(g,x,b,0,Math.PI*2),e.fill()}e.globalAlpha=1}function fK(e,t,n,r=0){for(const s of e){for(const c of t){const l=c.x2-c.x1,d=c.y2-c.y1,u=l*l+d*d;if(u<1e-4)continue;const h=Math.max(0,Math.min(1,((s.x-c.x1)*l+(s.y-c.y1)*d)/u)),m=c.x1+h*l,f=c.y1+h*d,g=m-s.x,x=f-s.y,v=Math.sqrt(g*g+x*x)+1e-4;if(v>.12)continue;const b=1-v/.12,w=Math.sqrt(u),M=l/w,k=d/w,R=-k,j=M,I=c.type??"flow";if(I==="flow"){const E=c.strength*.08*b*b/(v*2+.005);s.vx+=g/v*E,s.vy+=x/v*E,s.vx+=M*c.strength*.014*b,s.vy+=k*c.strength*.014*b}else if(I==="pinch"){const E=c.strength*.13*b*b/(v*2+.005);s.vx+=g/v*E,s.vy+=x/v*E,s.vx*=.996,s.vy*=.996}else if(I==="shear"){const O=(s.x-m)*R+(s.y-f)*j>=0?1:-1,L=c.strength*.02*b;s.vx+=M*L*O,s.vy+=k*L*O,s.vx+=g/v*c.strength*.03*b,s.vy+=x/v*c.strength*.03*b}else if(I==="barrier"){const E=c.strength*.11*b*b/(v+.004);s.vx-=g/v*E,s.vy-=x/v*E;const O=s.vx*R+s.vy*j;Math.abs(O)>1e-4&&(s.vx-=O*R*.12,s.vy-=O*j*.12)}else if(I==="spiral"){const E=c.strength*.07*b*b/(v*2+.005);s.vx+=g/v*E,s.vy+=x/v*E;const O=(s.x-m)*R+(s.y-f)*j,L=c.strength*.04*b*(O>=0?1:-1);s.vx+=-j*L,s.vy+=R*L,s.vx+=M*c.strength*.01*b,s.vy+=k*c.strength*.01*b}else if(I==="funnel"){const E=(c.x1+c.x2)/2,O=(c.y1+c.y2)/2,L=E-s.x,$=O-s.y,F=Math.sqrt(L*L+$*$)+1e-4;if(F<.12*1.2){const B=c.strength*.06*(1-F/.144)/(F+.003);s.vx+=L/F*B,s.vy+=$/F*B}s.vx+=M*c.strength*.012*b,s.vy+=k*c.strength*.012*b}else if(I==="repulsor"){const E=c.strength*.14*b*b/(v+.004);s.vx-=g/v*E,s.vy-=x/v*E}else if(I==="attractor"){const E=c.strength*.15*b*b/(v*2+.004);s.vx+=g/v*E,s.vy+=x/v*E,s.vx+=M*c.strength*.018*b,s.vy+=k*c.strength*.018*b}else if(I==="wave"){const E=Math.sin(r*.06+s.x*20+s.y*20)*.5+.5,O=c.strength*(.02+E*.03)*b;s.vx+=R*O,s.vy+=j*O,s.vx+=M*c.strength*.008*b,s.vy+=k*c.strength*.008*b}else if(I==="orbit_line"){const E=(s.x-m)*R+(s.y-f)*j,O=c.strength*.035*b*(E>=0?1:-1);s.vx+=-j*O,s.vy+=R*O,s.vx+=g/v*c.strength*.025*b,s.vy+=x/v*c.strength*.025*b}}for(const c of n){const l=c.points;if(l.length<2)continue;let d=1/0,u=0,h=0,m=0,f=0;for(let b=0;b<l.length-1;b++){const w=l[b][0],M=l[b][1],k=l[b+1][0],R=l[b+1][1],j=k-w,I=R-M,E=j*j+I*I;if(E<1e-6)continue;const O=Math.max(0,Math.min(1,((s.x-w)*j+(s.y-M)*I)/E)),L=w+O*j,$=M+O*I,F=L-s.x,B=$-s.y,W=Math.sqrt(F*F+B*B);if(W<d){d=W,u=F,h=B;const re=Math.sqrt(E);m=j/re,f=I/re}}if(d>.06)continue;const g=1-d/.06,x=c.behavior??"stream",v=d+1e-4;if(x==="stream"){const b=c.strength*.06*g*g/(d+.003);s.vx+=u/v*b,s.vy+=h/v*b,s.vx+=m*c.strength*.022*g,s.vy+=f*c.strength*.022*g}else if(x==="orbit"){const b=-f,w=m,M=c.strength*.03*g;s.vx+=b*M,s.vy+=w*M,s.vx+=u/v*c.strength*.035*g,s.vy+=h/v*c.strength*.035*g}else{const b=.5+.5*Math.sin(r*.09+s.age*.02),w=c.strength*(.018+b*.04)*g;s.vx-=u/v*w,s.vy-=h/v*w,s.vx+=m*c.strength*.012*g,s.vy+=f*c.strength*.012*g}}}}function pK(e,t,n,r,a,i){const s=(c,l)=>{if(c.length<2)return;const d=Math.max(0,Math.min(1,l));if(e.beginPath(),e.moveTo(c[0][0],c[0][1]),d<.05||c.length<3){for(let h=1;h<c.length;h++)e.lineTo(c[h][0],c[h][1]);return}for(let h=1;h<c.length-1;h++){const[m,f]=c[h],[g,x]=c[h+1],v=m+(g-m)*(.2+d*.3),b=f+(x-f)*(.2+d*.3);e.quadraticCurveTo(m,f,v,b)}const u=c[c.length-1];e.lineTo(u[0],u[1])};e.save(),e.lineCap="round";for(const c of t){const l=c.x1*r,d=c.y1*a,u=c.x2*r,h=c.y2*a,m=c.color,f=Math.max(.6,c.thickness??1.4);e.strokeStyle=m,e.lineWidth=f*3.8*c.strength,e.globalAlpha=.06,e.beginPath(),e.moveTo(l,d),e.lineTo(u,h),e.stroke(),e.lineWidth=f,e.globalAlpha=.65;const g=c.type==="pinch"?[3,5]:c.type==="shear"?[10,3]:c.type==="barrier"?[2,2]:c.type==="spiral"?[4,2,1,2]:c.type==="funnel"?[8,4]:c.type==="repulsor"?[2,4]:c.type==="attractor"?[12,2]:c.type==="wave"?[3,3,1,3]:c.type==="orbit_line"?[5,5]:[6,4];e.setLineDash(g),e.beginPath(),e.moveTo(l,d),e.lineTo(u,h),e.stroke(),e.setLineDash([]);const x=u-l,v=h-d,b=Math.sqrt(x*x+v*v);if(b>10){const M=-v/b,k=x/b,R=Math.floor(b/16);e.lineWidth=.7,e.globalAlpha=.35;for(let j=1;j<R;j++){const I=l+x*(j/R),E=d+v*(j/R);e.beginPath(),e.moveTo(I+M*4,E+k*4),e.lineTo(I-M*4,E-k*4),e.stroke()}}const w=3;for(let M=0;M<w;M++){const k=(M/w+i*.003)%1,R=l+(u-l)*k,j=d+(h-d)*k;e.globalAlpha=.5*(.5+.5*Math.sin(i*.06+M*1.5)),e.fillStyle=m,e.beginPath(),e.arc(R,j,1.5,0,Math.PI*2),e.fill()}e.globalAlpha=.7,e.fillStyle=m,e.beginPath(),e.arc(l,d,3,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(u,h,3,0,Math.PI*2),e.fill()}for(const c of n){if(c.points.length<2)continue;const l=c.color,d=Math.max(.6,c.thickness??1.2),u=Math.max(0,Math.min(1,c.smoothness??.45)),h=c.points.map(f=>[f[0]*r,f[1]*a]);e.strokeStyle=l,e.lineWidth=d*3.2*c.strength,e.globalAlpha=.05,s(h,u),e.stroke(),e.lineWidth=d,e.globalAlpha=.55,s(h,u),e.stroke(),e.globalAlpha=.45,e.fillStyle=l;const m=c.behavior??"stream";for(let f=8;f<c.points.length-1;f+=12){const g=c.points[f][0]*r,x=c.points[f][1]*a,v=c.points[f+1][0]*r,b=c.points[f+1][1]*a,w=v-g,M=b-x,k=Math.sqrt(w*w+M*M);if(k<.5)continue;const R=w/k,j=M/k,I=m==="orbit"?5:7,E=m==="shock"?4:3;e.beginPath(),e.moveTo(g+R*I,x+j*I),e.lineTo(g-j*E,x+R*E),e.lineTo(g+j*E,x-R*E),e.closePath(),e.fill()}}e.restore()}function mK(e,t,n,r,a){if(!t.isDragging)return;const i=t.activeToolId;if(!["attract","attractor","repel","repulsor","vortex","freeze","burst","black_hole","scatter_burst","flow_paint","pinch","channel"].includes(i))return;const c=t.lastX,l=t.lastY,d=t.size;e.save();const u=.6+.4*Math.sin(a*.08);e.globalAlpha=.25*u,e.strokeStyle=i==="freeze"?"#80ddff":i==="burst"||i==="scatter_burst"?"#ff6040":i==="black_hole"?"#a040ff":i==="flow_paint"||i==="channel"?"#40b0ff":i==="pinch"?"#a060ff":"#ffffff",e.lineWidth=1.2,e.beginPath(),e.arc(c,l,d,0,Math.PI*2),e.stroke(),e.globalAlpha=.35,e.lineWidth=.8;const h=6;e.beginPath(),e.moveTo(c-h,l),e.lineTo(c+h,l),e.stroke(),e.beginPath(),e.moveTo(c,l-h),e.lineTo(c,l+h),e.stroke(),e.globalAlpha=.55,e.fillStyle=e.strokeStyle,e.beginPath(),e.arc(c,l,2,0,Math.PI*2),e.fill(),e.restore()}const gK=[{id:"trail",name:"Rastro",blendMode:"normal",opacity:1},{id:"particles",name:"Quanta",blendMode:"normal",opacity:.18},{id:"connections",name:"Conexoes",blendMode:"normal",opacity:.6},{id:"glow",name:"Brilho",blendMode:"normal",opacity:.18},{id:"post",name:"Post/FX",blendMode:"normal",opacity:0},{id:"brush",name:"Pinceis",blendMode:"normal",opacity:1}];function yK(e,t){return gK.map(n=>{const r=document.createElement("canvas");return r.width=e,r.height=t,{...n,canvas:r,visible:!0,locked:!1}})}function Q0(e,t){return e.find(n=>n.id===t)}function bK(e){if(!e.canvas)return;e.canvas.getContext("2d").clearRect(0,0,e.canvas.width,e.canvas.height)}function xK(e,t,n,r,a){e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.fillStyle=n,e.fillRect(0,0,r,a);for(const i of t)!i.visible||!i.canvas||i.opacity<=0||(e.globalAlpha=i.opacity,e.globalCompositeOperation=vK(i.blendMode),e.drawImage(i.canvas,0,0));e.globalAlpha=1,e.globalCompositeOperation="source-over",e.restore()}function vK(e){switch(e){case"add":return"lighter";case"multiply":return"multiply";case"screen":return"screen";case"overlay":return"overlay";default:return"source-over"}}function SK(e,t,n=1){if(!e.canvas)return;const r=e.canvas.getContext("2d"),{memory:a}=t.genes,i=.48+Math.pow(a,.45)*.518,s=n<=0?1:Math.pow(Math.max(.001,Math.min(.9999,i)),Math.max(.02,n));r.globalCompositeOperation="destination-in",r.globalAlpha=s,r.fillStyle="rgba(0,0,0,1)",r.fillRect(0,0,e.canvas.width,e.canvas.height),r.globalCompositeOperation="source-over",r.globalAlpha=1}function wK(e,t,n,r,a){if(!e.canvas||!t.canvas)return;const i=e.canvas.getContext("2d");i.clearRect(0,0,r,a);const{coherence:s,contrast:c}=n.genes,l=s*(1-c*.3);l>.1&&(i.save(),i.filter=`blur(${Math.round(6+s*14)}px)`,i.globalAlpha=l*.5,i.globalCompositeOperation="source-over",i.drawImage(t.canvas,0,0),i.filter="none",i.restore())}const wy=[{id:"spawn_brush",icon:"",name:"Spawn",category:"vida",description:"Pinta agentes vivos  cada trao gera quanta que ganham vida prpria",params:[{label:"Raio",key:"size",min:5,max:220,step:5},{label:"Dens.",key:"pressure",min:.05,max:1,step:.05}]},{id:"erase_agents",icon:"",name:"Apagar",category:"vida",description:"Remove quanta do campo  apaga agentes dentro do raio",params:[{label:"Raio",key:"size",min:10,max:350,step:10},{label:"Fora",key:"pressure",min:.1,max:1,step:.05}]},{id:"attract",icon:"",name:"Atrator",category:"forca",description:"Puxa quanta para o cursor  cria concentrao e densidade viva",params:[{label:"Raio",key:"size",min:10,max:300,step:5},{label:"Fora",key:"pressure",min:.05,max:1,step:.05}]},{id:"repel",icon:"",name:"Repulsor",category:"forca",description:"Expande e dispersa quanta  cria espao negativo",params:[{label:"Raio",key:"size",min:10,max:300,step:5},{label:"Fora",key:"pressure",min:.05,max:1,step:.05}]},{id:"vortex",icon:"",name:"Vrtice",category:"forca",description:"Gira quanta em torno do cursor  redemoinhos e espirais vivas",params:[{label:"Raio",key:"size",min:10,max:300,step:5},{label:"Fora",key:"pressure",min:.05,max:1,step:.05}]},{id:"freeze",icon:"",name:"Congelar",category:"forca",description:"Retarda quanta no raio  cria zonas de silncio e suspenso",params:[{label:"Raio",key:"size",min:10,max:300,step:5},{label:"Fora",key:"pressure",min:.05,max:1,step:.05}]},{id:"burst",icon:"",name:"Exploso",category:"forca",description:"Explode velocidade aleatria nos agentes  caos localizado",params:[{label:"Raio",key:"size",min:10,max:300,step:5},{label:"Fora",key:"pressure",min:.05,max:1,step:.05}]},{id:"black_hole",icon:"",name:"Buraco Negro",category:"forca",description:"Atrao extrema  os quanta chegam e so lanados ao outro lado",params:[{label:"Raio",key:"size",min:10,max:250,step:5},{label:"Fora",key:"pressure",min:.05,max:1,step:.05}]},{id:"color_infect",icon:"",name:"Infectar Cor",category:"mutar",description:"Propaga a cor ativa para os quanta no raio  contgio cromtico",params:[{label:"Raio",key:"size",min:10,max:300,step:5},{label:"Fora",key:"pressure",min:.02,max:1,step:.02}]},{id:"size_wave",icon:"",name:"Onda Tamanho",category:"mutar",description:"Modula o tamanho dos quanta em onda pulsante  textura dinmica",params:[{label:"Raio",key:"size",min:10,max:300,step:5},{label:"Ampli.",key:"pressure",min:.05,max:1,step:.05}]},{id:"ink_flood",icon:"",name:"Inundar Tinta",category:"mutar",description:"Reabastece tinta dos quanta  intensifica rastros na regio",params:[{label:"Raio",key:"size",min:10,max:300,step:5},{label:"Fora",key:"pressure",min:.05,max:1,step:.05}]},{id:"species_shift",icon:"",name:"Mudar Espcie",category:"mutar",description:'Converte espcie dos quanta  muda o "tipo" dos agentes vivos',params:[{label:"Raio",key:"size",min:10,max:300,step:5},{label:"Taxa",key:"pressure",min:.01,max:1,step:.02}]},{id:"flow_paint",icon:"",name:"Pintar Fluxo",category:"guiar",description:"Define direo do campo vetorial com o gesto  guia quanta por muito tempo",params:[{label:"Raio",key:"size",min:10,max:300,step:5},{label:"Fora",key:"pressure",min:.1,max:1,step:.05}]},{id:"channel",icon:"",name:"Canal",category:"guiar",description:"Cria corrente direcional  empurra quanta na direo do arraste",params:[{label:"Raio",key:"size",min:10,max:300,step:5},{label:"Fora",key:"pressure",min:.05,max:1,step:.05}]},{id:"pinch",icon:"",name:"Pinar",category:"guiar",description:"Comprime quanta em direo a uma linha  cria acumulaes lineares",params:[{label:"Raio",key:"size",min:10,max:350,step:5},{label:"Fora",key:"pressure",min:.05,max:1,step:.05}]},{id:"scatter_burst",icon:"",name:"Disperso",category:"guiar",description:"Explode quanta radialmente do cursor  disperso controlada",params:[{label:"Raio",key:"size",min:10,max:350,step:5},{label:"Fora",key:"pressure",min:.05,max:1,step:.05}]}];function PC(){return{activeToolId:"spawn_brush",size:40,pressure:.65,flow:.6,hardness:.6,colorIndex:0,glyphIndex:0,isDragging:!1,lastX:0,lastY:0,sizeMul:1,dragDX:0,dragDY:0}}let MK=1;function CK(){return`arch-${Date.now()}-${MK++}`}function kK(e,t,n,r){const a=e.toDataURL("image/jpeg",.7);return{id:CK(),timestamp:Date.now(),dna:{...t,genes:{...t.genes}},seed:n,thumbnail:a,gestures:r.slice(-10),pinned:!1,favorite:!1}}function Zc(e,t,n){return[{id:`grim-${Date.now()}`,timestamp:Date.now(),text:t,type:n},...e].slice(0,80)}function RK(e){const t=new Date(e),n=t.getHours().toString().padStart(2,"0"),r=t.getMinutes().toString().padStart(2,"0"),a=t.getSeconds().toString().padStart(2,"0");return`${n}:${r}:${a}`}function w6(e){let t=e;return()=>(t=(t*9301+49297)%233280,t/233280)}function AK(e){return Math.max(0,Math.min(1,e))}function M6(e,t=.25,n=8){const r=[],a=w6(e.createdAt+n);for(let i=0;i<n;i++){const s={...e.genes},c=t*(.5+a()*1.2),l=Object.keys(s),d=3+Math.floor(a()*3),u=[...l].filter(f=>f!=="linear"&&f!=="agentShape").sort(()=>a()-.5).slice(0,d);let h=c;for(const f of u){const g=s[f]??0,x=(a()-.5)*2*Math.min(h,.35);if(s[f]=AK(g+x),h-=Math.abs(x),h<=0)break}const m=a()>.6?ZY(e.palette,a):e.palette;r.push({...e,id:Ky(),genes:s,palette:m,createdAt:Date.now()+i})}return r}function jK(e,t,n=.5){const r=w6(e.createdAt^t.createdAt),a=QY(e.genes,t.genes,n+(r()-.5)*.2),i=[],s=e.palette.length>=t.palette.length?e.palette:t.palette,c=e.palette.length<t.palette.length?e.palette:t.palette;for(let l=0;l<s.length;l++)i.push(r()>.5?s[l]:c[l%c.length]??s[l]);return{id:Ky(),genes:a,intention:r()>.5?e.intention:t.intention,palette:i.slice(0,6),background:r()>.5?e.background:t.background,quantaCount:r()>.5?e.quantaCount:t.quantaCount,createdAt:Date.now(),name:`cross(${(e.name??"A").slice(0,8)},${(t.name??"B").slice(0,8)})`}}function EK(e,t=100){const n=document.createElement("canvas");n.width=n.height=t;const r=n.getContext("2d"),{genes:a,palette:i,background:s}=e;r.fillStyle=s,r.fillRect(0,0,t,t);const c=Math.max(2,Math.floor(a.layering*6+2));for(let l=0;l<c;l++){const d=i[l%i.length],u=.12+a.contrast*.45;if(r.globalAlpha=u,a.structure>.7){const h=Math.round(3+a.structure*4),m=t/h,f=t/h;for(let g=0;g<h;g++)for(let x=0;x<h;x++)(g+x+l)%3===0&&(r.fillStyle=i[(g+x+l)%i.length],r.fillRect(x*m,g*f,m*(1-a.fragmentation*.4),f))}else if(a.symmetry>.7){const h=t/2,m=t/2,f=t*(.15+l*.12),g=r.createRadialGradient(h,m,f*.1,h,m,f);g.addColorStop(0,d),g.addColorStop(1,"transparent"),r.fillStyle=g,r.fillRect(0,0,t,t)}else{const h=(a.fragmentation<.5?.5:(l+1)/(c+1))*t,m=(.3+a.flow*.4)*t,f=t*(.18+a.coherence*.3),g=r.createRadialGradient(h,m,f*.05,h,m,f);g.addColorStop(0,d+"ff"),g.addColorStop(1,d+"00"),r.fillStyle=g,r.fillRect(0,0,t,t)}}if(a.glyphness>.4){r.globalAlpha=a.glyphness*.7,r.fillStyle=i[0],r.font=`${Math.round(t*.28)}px monospace`,r.textAlign="center",r.textBaseline="middle";const l=["","","","","",""];r.fillText(l[Math.floor(a.glyphness*5)%l.length],t/2,t/2)}if(a.entropy>.4){const l=r.getImageData(0,0,t,t),d=l.data,u=a.entropy*25;for(let h=0;h<d.length;h+=4){const m=(Math.random()-.5)*u;d[h]=Math.max(0,Math.min(255,d[h]+m)),d[h+1]=Math.max(0,Math.min(255,d[h+1]+m)),d[h+2]=Math.max(0,Math.min(255,d[h+2]+m))}r.putImageData(l,0,0)}return r.globalAlpha=1,n.toDataURL("image/jpeg",.8)}function TK(e,t="metaarte"){const n=document.createElement("a");n.download=`${t}-${Date.now()}.png`,n.href=e.toDataURL("image/png"),n.click()}function IK(e,t="recipe"){const n=JSON.stringify(e,null,2),r=new Blob([n],{type:"application/json"}),a=URL.createObjectURL(r),i=document.createElement("a");i.download=`${t}-${Date.now()}.json`,i.href=a,i.click(),setTimeout(()=>URL.revokeObjectURL(a),1e3)}function PK(e){let t=Math.abs(e|0)%233280||1;return()=>(t=(t*9301+49297)%233280,t/233280)}function FK(e){const t=parseInt(e.slice(1,3),16)/255,n=parseInt(e.slice(3,5),16)/255,r=parseInt(e.slice(5,7),16)/255,a=Math.max(t,n,r),i=Math.min(t,n,r);let s=0,c=0;const l=(a+i)/2;if(a!==i){const d=a-i;switch(c=l>.5?d/(2-a-i):d/(a+i),a){case t:s=((n-r)/d+(n<r?6:0))/6;break;case n:s=((r-t)/d+2)/6;break;case r:s=((t-n)/d+4)/6;break}}return[s*360,c,l]}function ts(e,t,n,r,a=0,i=0,s){const c=s??Math.floor(t()*e.palette.length),l=e.palette[c%e.palette.length]??"#888",[d,u,h]=FK(l),m=Math.floor(t()*6),f=.003+e.genes.flow*.008,g=t()*Math.PI*2,x=f*(.5+t()*.8),v=a!==0||i!==0?a:Math.cos(g)*x,b=a!==0||i!==0?i:Math.sin(g)*x;return{x:n,y:r,vx:v,vy:b,charge:t(),ink:.5+t()*.5,mood:t(),role:"DRAW",species:m,memX:new Float32Array([n,n,n,n,n,n]),memY:new Float32Array([r,r,r,r,r,r]),memIdx:0,age:0,hue:d+(t()-.5)*30*(1-e.genes.coherence),sat:Math.max(.1,Math.min(1,u)),lit:Math.max(.15,Math.min(.9,h)),alpha:.6+t()*.4,size:.8+t()*2.5*(1+e.genes.structure*.5),glyphIndex:Math.floor(t()*32),baseHue:d}}const _K={scatter:"Scatter",grid:"Grade",hex_grid:"Grade Hex",ring:"Anel",spiral:"Espiral",galaxy:"Galxia",cross:"Cruz",diagonal:"Diagonal",sine_wave:"Onda",clusters:"Clusters",center_burst:"Exploso",edges:"Bordas",corners:"Cantos",concentric:"Concntrico",flow_lines:"Fluxos",golden_spiral:"Fibonacci",explosion:"Big Bang",yin_yang:"Yin-Yang",lattice:"Retculo",noise_bands:"Bandas"};function NK(e,t,n){const r=PK(t),a=Math.max(1,e.quantaCount),i=[];switch(n){case"scatter":{for(let s=0;s<a;s++)i.push(ts(e,r,r(),r()));break}case"grid":{const s=Math.ceil(Math.sqrt(a*1.7777777777777777)),c=Math.ceil(a/s);let l=0;for(let d=0;d<c&&l<a;d++)for(let u=0;u<s&&l<a;u++,l++){const h=(u+.5+(r()-.5)*.2)/s,m=(d+.5+(r()-.5)*.2)/c;i.push(ts(e,r,h,m,0,0,l%e.palette.length))}break}case"hex_grid":{const s=Math.ceil(Math.sqrt(a)),c=Math.ceil(a/s);let l=0;for(let d=0;d<c&&l<a;d++)for(let u=0;u<s&&l<a;u++,l++){const m=(d%2===0?0:.5/s)+(u+.5)/s+(r()-.5)*.015,f=(d+.5)/c*.9+.05+(r()-.5)*.015;i.push(ts(e,r,Math.min(.99,m),Math.min(.99,f),0,0,l%e.palette.length))}break}case"ring":{for(let s=0;s<a;s++){const c=s/a*Math.PI*2,l=.32+(r()-.5)*.06,d=.5+Math.cos(c)*l,u=.5+Math.sin(c)*l*.7,h=e.genes.flow*.006;i.push(ts(e,r,d,u,-Math.sin(c)*h,Math.cos(c)*h*.7,s%e.palette.length))}break}case"spiral":{for(let s=0;s<a;s++){const c=s/a*Math.PI*8,l=c/(Math.PI*8)*.42+.02,d=.5+Math.cos(c)*l,u=.5+Math.sin(c)*l*.75,h=.004+e.genes.flow*.004;i.push(ts(e,r,Math.max(.01,Math.min(.99,d)),Math.max(.01,Math.min(.99,u)),-Math.sin(c)*h,Math.cos(c)*h,s%e.palette.length))}break}case"galaxy":{for(let s=0;s<a;s++){const c=s%2,l=Math.floor(s/2)/(a/2)*Math.PI*5+c*Math.PI,d=l/(Math.PI*5)*.38+.03,u=(r()-.5)*.06,h=.5+Math.cos(l)*d+u,m=.5+Math.sin(l)*d*.65+u*.5,f=.003+e.genes.flow*.003;i.push(ts(e,r,Math.max(.01,Math.min(.99,h)),Math.max(.01,Math.min(.99,m)),-Math.sin(l)*f,Math.cos(l)*f,c))}break}case"cross":{const s=Math.ceil(a/4);for(let c=0;c<a;c++){const l=Math.floor(c/s),d=c%s/s;let u=.5,h=.5;const m=(r()-.5)*.04;switch(l%4){case 0:u=d*.9+.05,h=.5+m;break;case 1:u=.5+m,h=d*.9+.05;break;case 2:u=(1-d)*.9+.05,h=.5+m;break;case 3:u=.5+m,h=(1-d)*.9+.05;break}i.push(ts(e,r,u,h,0,0,l%e.palette.length))}break}case"diagonal":{const s=Math.min(8,e.palette.length);for(let c=0;c<a;c++){const l=c/a,d=Math.floor(l*s),u=l*s%1,h=u*.92+.04+(r()-.5)*.04,m=u*.85+d/s*.15+.04+(r()-.5)*.04;i.push(ts(e,r,h,Math.min(.96,m),0,0,d%e.palette.length))}break}case"sine_wave":{const s=3+Math.floor(e.genes.rhythm*5);for(let c=0;c<a;c++){const l=c/a,d=l*.92+.04,u=.5+Math.sin(l*Math.PI*2*s)*.35+(r()-.5)*.03,h=Math.cos(l*Math.PI*2*s)*.003;i.push(ts(e,r,d,u,.002,h,c%e.palette.length))}break}case"clusters":{const s=Math.max(2,Math.min(8,e.palette.length)),c=[];for(let l=0;l<s;l++)c.push([.1+r()*.8,.1+r()*.8]);for(let l=0;l<a;l++){const d=l%s,[u,h]=c[d],m=r()*Math.PI*2,f=Math.pow(r(),.5)*.12;i.push(ts(e,r,Math.max(.01,Math.min(.99,u+Math.cos(m)*f)),Math.max(.01,Math.min(.99,h+Math.sin(m)*f*.75)),0,0,d%e.palette.length))}break}case"center_burst":{for(let s=0;s<a;s++){const c=r()*Math.PI*2,l=Math.pow(r(),2)*.12,d=.004+e.genes.flow*.008;i.push(ts(e,r,.5+Math.cos(c)*l,.5+Math.sin(c)*l*.75,Math.cos(c)*d,Math.sin(c)*d,s%e.palette.length))}break}case"edges":{for(let s=0;s<a;s++){const c=r(),l=Math.floor(r()*4),d=.03+r()*.06;let u=c,h=c;switch(l){case 0:u=c,h=d;break;case 1:u=c,h=1-d;break;case 2:u=d,h=c;break;case 3:u=1-d,h=c;break}const m=e.genes.flow*.004,f=[.5-u,.5-h],g=Math.sqrt(f[0]**2+f[1]**2)+.001;i.push(ts(e,r,u,h,f[0]/g*m,f[1]/g*m,l%e.palette.length))}break}case"corners":{const s=[[.15,.15],[.85,.15],[.15,.85],[.85,.85]];for(let c=0;c<a;c++){const l=c%4,[d,u]=s[l],h=r()*.1,m=r()*Math.PI*2;i.push(ts(e,r,d+Math.cos(m)*h,u+Math.sin(m)*h*.75,0,0,l%e.palette.length))}break}case"concentric":{const s=Math.max(2,Math.min(8,e.palette.length));for(let c=0;c<a;c++){const l=c%s,d=c/a*Math.PI*2*s+l*.5,u=.06+(l+1)*(.38/s)+(r()-.5)*.02;i.push(ts(e,r,.5+Math.cos(d)*u,.5+Math.sin(d)*u*.72,0,0,l%e.palette.length))}break}case"flow_lines":{const s=8+Math.floor(e.genes.flow*12);for(let c=0;c<a;c++){const l=c%s,d=c/a*s%1,u=l/s*Math.PI*2,h=l/s*.9+.05,m=d*.85+.07+Math.sin(d*Math.PI*3+u)*.08;i.push(ts(e,r,h,Math.min(.97,m),0,.002,l%e.palette.length))}break}case"golden_spiral":{const s=(1+Math.sqrt(5))/2;for(let c=0;c<a;c++){const l=Math.sqrt(c/a)*.44,d=c*2*Math.PI/(s*s);i.push(ts(e,r,.5+Math.cos(d)*l,.5+Math.sin(d)*l*.75,0,0,c%e.palette.length))}break}case"explosion":{for(let s=0;s<a;s++){const c=s/a*Math.PI*2+r()*.3,l=(.005+r()*.015)*(1+e.genes.flow*2);i.push(ts(e,r,.5+(r()-.5)*.02,.5+(r()-.5)*.02,Math.cos(c)*l,Math.sin(c)*l*.75,s%e.palette.length))}break}case"yin_yang":{for(let s=0;s<a;s++){const c=s<a/2?0:1,l=s%(a/2)/(a/2),d=l*Math.PI*6+c*Math.PI,u=l*.35+.03,h=.5+(c===0?.1:-.1);i.push(ts(e,r,Math.max(.01,Math.min(.99,h+Math.cos(d)*u)),Math.max(.01,Math.min(.99,.5+Math.sin(d)*u*.72)),0,0,c%e.palette.length))}break}case"lattice":{const s=Math.ceil(Math.sqrt(a));let c=0;for(let l=0;l<s&&c<a;l++)for(let d=0;d<s&&c<a;d++,c++){const u=(d+.5)/s+(l%2?.25/s:0),h=(l+.5)/s*.85+.07;i.push(ts(e,r,u,h,0,0,(l+d)%e.palette.length))}break}case"noise_bands":{const s=e.palette.length;for(let c=0;c<a;c++){const l=c%s,d=(l+r())/s*.9+.05,u=r()*.9+.05;i.push(ts(e,r,u,d,0,0,l))}break}}return i.slice(0,a)}function OK(e,t,n){const r=e.size;let a=0,i=0,s=0,c=0,l=0;for(let b=0;b<r;b++)for(let w=0;w<r;w++){const M=b*r+w;if(a+=e.density[M],i+=e.pressure[M],c+=e.memory[M],w>0&&b>0){const k=e.density[M],R=e.density[b*r+(w-1)],j=e.density[(b-1)*r+w];Math.abs(k-R)+Math.abs(k-j)>.08&&s++}if(w<r/2){const k=b*r+(r-1-w);l+=Math.abs(e.density[M]-e.density[k])}}const d=r*r,u=a/d,h=i/d,m=Math.abs(u-n)*20,f=1-Math.min(1,u*5),g=s/(d*.3),x=Math.max(0,1-l/(r*r*.25*.5)),v=Math.max(0,1-m*2);return{density:Math.min(1,u*4),contrast:Math.min(1,h*3),novelty:Math.min(1,m),silenceIndex:Math.max(0,f),motifStability:v,symmetry:x,fragmentation:Math.min(1,g)}}function FC(){return{rMaxMul:1,forceMul:1,dampingMul:1,noiseMul:1,maxSpeedMul:1,rMinMul:1,centerPull:0,quadrantMode:!1,quadrantStrength:.3,borderRepulsion:.25}}const Vp=[{id:"molhado",label:"Molhado",emoji:"",lineCap:"round",opacityMul:.7,opacityJitter:.15,widthMul:1.8,widthJitter:.2,lengthMul:1.2,bristles:1,bristleSpread:0,edgeSoftness:.6,textureBreak:0,bleed:.5},{id:"seco",label:"Seco",emoji:"",lineCap:"square",opacityMul:.5,opacityJitter:.5,widthMul:1.4,widthJitter:.4,lengthMul:1,bristles:4,bristleSpread:3,edgeSoftness:0,textureBreak:.6,bleed:0},{id:"duro",label:"Duro",emoji:"",lineCap:"square",opacityMul:1,opacityJitter:0,widthMul:1,widthJitter:0,lengthMul:1,bristles:1,bristleSpread:0,edgeSoftness:0,textureBreak:0,bleed:0},{id:"macio",label:"Macio",emoji:"",lineCap:"round",opacityMul:.4,opacityJitter:.1,widthMul:2,widthJitter:.15,lengthMul:1.1,bristles:1,bristleSpread:0,edgeSoftness:.8,textureBreak:0,bleed:.2},{id:"aquarela",label:"Aquarela",emoji:"",lineCap:"round",opacityMul:.3,opacityJitter:.2,widthMul:2.5,widthJitter:.3,lengthMul:1.3,bristles:1,bristleSpread:0,edgeSoftness:.9,textureBreak:0,bleed:.8},{id:"gouache",label:"Gouache",emoji:"",lineCap:"square",opacityMul:1,opacityJitter:.05,widthMul:1.2,widthJitter:.05,lengthMul:.9,bristles:1,bristleSpread:0,edgeSoftness:0,textureBreak:0,bleed:0},{id:"nanquim",label:"Nanquim",emoji:"",lineCap:"round",opacityMul:.9,opacityJitter:.1,widthMul:.6,widthJitter:.3,lengthMul:1.4,bristles:1,bristleSpread:0,edgeSoftness:0,textureBreak:.1,bleed:0},{id:"crayon",label:"Crayon",emoji:"",lineCap:"round",opacityMul:.65,opacityJitter:.35,widthMul:1.6,widthJitter:.25,lengthMul:1,bristles:3,bristleSpread:2,edgeSoftness:0,textureBreak:.3,bleed:0},{id:"esmalte",label:"Esmalte",emoji:"",lineCap:"round",opacityMul:1,opacityJitter:0,widthMul:1.5,widthJitter:0,lengthMul:.8,bristles:1,bristleSpread:0,edgeSoftness:.3,textureBreak:0,bleed:.3},{id:"carvao",label:"Carvo",emoji:"",lineCap:"square",opacityMul:.6,opacityJitter:.3,widthMul:2.2,widthJitter:.35,lengthMul:1,bristles:3,bristleSpread:4,edgeSoftness:.1,textureBreak:.25,bleed:0},{id:"aerografo",label:"Aergrafo",emoji:"",lineCap:"round",opacityMul:.2,opacityJitter:.05,widthMul:3.5,widthJitter:.1,lengthMul:1.5,bristles:1,bristleSpread:0,edgeSoftness:1,textureBreak:0,bleed:.4},{id:"faca",label:"Faca",emoji:"",lineCap:"butt",opacityMul:.95,opacityJitter:.1,widthMul:2.8,widthJitter:.15,lengthMul:.7,bristles:1,bristleSpread:0,edgeSoftness:0,textureBreak:0,bleed:0},{id:"pena",label:"Pena",emoji:"",lineCap:"round",opacityMul:.85,opacityJitter:.2,widthMul:.4,widthJitter:.5,lengthMul:1.6,bristles:1,bristleSpread:0,edgeSoftness:0,textureBreak:.15,bleed:0},{id:"giz",label:"Giz",emoji:"",lineCap:"round",opacityMul:.55,opacityJitter:.4,widthMul:1.8,widthJitter:.3,lengthMul:1,bristles:2,bristleSpread:2,edgeSoftness:0,textureBreak:.5,bleed:0},{id:"grafite",label:"Grafite",emoji:"",lineCap:"round",opacityMul:.7,opacityJitter:.15,widthMul:.8,widthJitter:.15,lengthMul:1.1,bristles:2,bristleSpread:1,edgeSoftness:0,textureBreak:.1,bleed:0},{id:"acrilica",label:"Acrlica",emoji:"",lineCap:"round",opacityMul:.8,opacityJitter:.1,widthMul:1.3,widthJitter:.1,lengthMul:1,bristles:1,bristleSpread:0,edgeSoftness:.1,textureBreak:.05,bleed:.1}],Ys="'IBM Plex Mono', monospace",xl="#ff0084",Sl="rgba(255,255,255,0.28)",C6="rgba(255,255,255,0.5)",DK="rgba(255,255,255,0.85)",vl="rgba(255,255,255,0.06)",LK={vida:{label:"VIDA",accent:"#ff0084"},forca:{label:"FORA",accent:"#ff0084"},mutar:{label:"MUTAR",accent:"#ff0084"},guiar:{label:"GUIAR",accent:"#ff0084"}},zK=["vida","forca","mutar","guiar"],BK=[{id:"circle",icon:""},{id:"square",icon:""},{id:"diamond",icon:""},{id:"triangle",icon:""},{id:"cross",icon:"+"},{id:"star",icon:""}],$K=92;function gp({children:e}){return o.jsx("div",{style:{fontSize:7,letterSpacing:"0.16em",textTransform:"uppercase",color:Sl,textAlign:"center",fontFamily:Ys,padding:"6px 0 4px",borderTop:`1px dashed ${vl}`},children:e})}function Jb({label:e,active:t,onClick:n}){return o.jsx("button",{onClick:n,style:{flex:1,padding:"4px 2px",borderRadius:1,cursor:"pointer",fontSize:7,letterSpacing:"0.1em",textTransform:"uppercase",fontFamily:Ys,background:t?"rgba(255,0,132,0.08)":"rgba(255,255,255,0.02)",border:`1px solid ${t?"rgba(255,0,132,0.3)":vl}`,color:t?xl:Sl,transition:"all 0.12s"},children:e})}function Qb({label:e,val:t,min:n,max:r,step:a,fmt:i,onChange:s}){return o.jsxs("div",{children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[o.jsx("span",{style:{fontSize:7,color:Sl,letterSpacing:"0.12em",textTransform:"uppercase",fontFamily:Ys},children:e}),o.jsx("span",{style:{fontSize:7,color:C6,fontFamily:Ys},children:i?i(t):t.toFixed(1)})]}),o.jsx("input",{type:"range",min:n,max:r,step:a,value:t,onChange:c=>s(parseFloat(c.target.value)),style:{width:"100%",cursor:"pointer",accentColor:xl}})]})}const qK=({toolState:e,palette:t,onToolChange:n,agentShape:r,onAgentShape:a,sizeMul:i,onSizeMul:s,brushTextureId:c,onBrushTexture:l,onSpawnSingleton:d,singletonSize:u,onSingletonSize:h,simSpeed:m,onSimSpeed:f,staticAgents:g,onStaticAgents:x,isolatedSpecies:v,onIsolated:b,linear:w,onLinear:M,geoMode:k,onGeoMode:R,geoPanelOpen:j,onToggleGeoPanel:I})=>{const E=wy.find(B=>B.id===e.activeToolId),O=E==null?void 0:E.category,[L,$]=on.useState(()=>O??"vida");on.useEffect(()=>{O&&$(O)},[O]);const F=r==="brush";return o.jsx("div",{style:{width:$K,height:"100%",display:"flex",flexDirection:"column",background:"#000",borderRight:`1px solid ${vl}`,overflow:"hidden",userSelect:"none",flexShrink:0},children:o.jsxs("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:[zK.map(B=>{const W=LK[B],re=wy.filter(te=>te.category===B),oe=L===B;return o.jsxs("div",{children:[o.jsxs("button",{onClick:()=>$(B),style:{padding:"5px 0 3px",textAlign:"center",fontSize:7,letterSpacing:"0.16em",textTransform:"uppercase",color:Sl,fontFamily:Ys,border:"none",outline:"none",background:oe?"rgba(255,255,255,0.02)":"transparent",width:"100%",cursor:"pointer",borderLeft:oe?`2px solid ${xl}`:"2px solid transparent",borderBottomStyle:"dashed",borderBottomColor:vl,borderBottomWidth:1,borderTopStyle:"solid",borderTopColor:"rgba(255,255,255,0.02)",borderTopWidth:1},children:[oe?" ":" ",W.label]}),oe&&o.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:0},children:re.map(te=>{const J=e.activeToolId===te.id;return o.jsxs("button",{onClick:()=>n({activeToolId:te.id}),title:`${te.name}  ${te.description}`,style:{padding:"7px 2px 5px",border:"none",cursor:"pointer",background:J?"rgba(255,0,132,0.08)":"transparent",borderBottom:J?`1px solid ${xl}`:"1px solid transparent",display:"flex",flexDirection:"column",alignItems:"center",gap:2,transition:"all 0.1s",color:J?xl:Sl},onMouseEnter:pe=>{J||(pe.currentTarget.style.background="rgba(255,255,255,0.03)")},onMouseLeave:pe=>{J||(pe.currentTarget.style.background="transparent")},children:[o.jsx("span",{style:{fontSize:13,lineHeight:1},children:te.icon}),o.jsx("span",{style:{fontSize:6,lineHeight:1.2,textAlign:"center",letterSpacing:"0.06em",textTransform:"uppercase",fontFamily:Ys,opacity:J?1:.5,wordBreak:"break-word",maxWidth:32},children:te.name.split(" ")[0]})]},te.id)})})]},B)}),E&&E.params.length>0&&o.jsxs("div",{style:{borderTop:`1px dashed ${vl}`,padding:"5px 6px 6px",background:"rgba(255,255,255,0.01)"},children:[o.jsx("div",{style:{fontSize:7,color:xl,letterSpacing:"0.14em",textTransform:"uppercase",textAlign:"center",marginBottom:4,fontFamily:Ys},children:E.name}),E.params.map(B=>o.jsxs("div",{style:{marginBottom:5},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[o.jsx("span",{style:{fontSize:7,color:Sl,letterSpacing:"0.08em",fontFamily:Ys},children:B.label}),o.jsx("span",{style:{fontSize:7,color:C6,fontFamily:Ys},children:(e[B.key]??B.min).toFixed(B.step<.1?2:0)})]}),o.jsx("input",{type:"range",min:B.min,max:B.max,step:B.step,value:e[B.key]??B.min,onChange:W=>n({[B.key]:parseFloat(W.target.value)}),style:{width:"100%",cursor:"pointer",accentColor:xl}})]},B.key))]}),o.jsxs("div",{style:{borderTop:`1px dashed ${vl}`,padding:"5px 5px"},children:[o.jsx("div",{style:{fontSize:7,color:Sl,letterSpacing:"0.14em",textTransform:"uppercase",textAlign:"center",marginBottom:3,fontFamily:Ys},children:"COR"}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:2},children:t.slice(0,6).map((B,W)=>o.jsx("button",{onClick:()=>n({colorIndex:W}),title:B,style:{width:"100%",aspectRatio:"1",borderRadius:1,background:B,border:"none",cursor:"pointer",outline:e.colorIndex===W?"1.5px solid rgba(255,255,255,0.8)":`1px solid ${vl}`,outlineOffset:1}},W))})]}),o.jsx(gp,{children:"Forma"}),o.jsxs("div",{style:{padding:"4px 5px 0"},children:[o.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:2},children:BK.map(({id:B,icon:W})=>{const re=r===B;return o.jsx("button",{onClick:()=>a(B),title:B,style:{padding:"5px 2px",borderRadius:1,cursor:"pointer",background:re?"rgba(255,0,132,0.08)":"transparent",border:`1px solid ${re?"rgba(255,0,132,0.3)":vl}`,color:re?DK:Sl,fontSize:11,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.1s"},children:W},B)})}),o.jsxs("button",{onClick:()=>a(F?"circle":"brush"),title:"Pincel reto",style:{width:"100%",marginTop:3,padding:"5px 4px",borderRadius:1,cursor:"pointer",fontSize:7,letterSpacing:"0.1em",display:"flex",alignItems:"center",justifyContent:"center",gap:4,background:F?"rgba(255,0,132,0.1)":"rgba(255,255,255,0.02)",border:`1px solid ${F?"rgba(255,0,132,0.35)":vl}`,color:F?xl:Sl,fontFamily:Ys,textTransform:"uppercase",transition:"all 0.12s"},children:[o.jsx("span",{style:{fontSize:12},children:""}),o.jsx("span",{children:"Pincel"})]})]}),F&&o.jsxs("div",{style:{padding:"4px 5px 5px"},children:[o.jsx("div",{style:{fontSize:7,color:"rgba(255,0,132,0.5)",letterSpacing:"0.12em",textTransform:"uppercase",textAlign:"center",marginBottom:4,fontFamily:Ys},children:"Textura"}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:2},children:Vp.map(B=>{const W=c===B.id;return o.jsxs("button",{onClick:()=>l(B.id),title:B.label,style:{padding:"4px 2px",borderRadius:1,cursor:"pointer",fontSize:7,display:"flex",flexDirection:"column",alignItems:"center",gap:1,background:W?"rgba(255,0,132,0.08)":"rgba(255,255,255,0.01)",border:`1px solid ${W?"rgba(255,0,132,0.3)":vl}`,color:W?xl:Sl,fontFamily:Ys,transition:"all 0.1s"},children:[o.jsx("span",{style:{fontSize:11,lineHeight:1},children:B.emoji}),o.jsx("span",{style:{fontSize:5.5,letterSpacing:"0.06em",textTransform:"uppercase"},children:B.label})]},B.id)})})]}),o.jsx(gp,{children:"Solo"}),o.jsxs("div",{style:{padding:"4px 5px 6px",display:"flex",flexDirection:"column",gap:5},children:[o.jsx(Qb,{label:"Tamanho",val:u,min:2,max:20,step:.5,fmt:B=>`${B.toFixed(1)}x`,onChange:h}),o.jsxs("button",{onClick:d,style:{width:"100%",padding:"5px 4px",borderRadius:1,cursor:"pointer",fontSize:7,letterSpacing:"0.12em",textTransform:"uppercase",fontFamily:Ys,background:"rgba(255,0,132,0.06)",border:"1px solid rgba(255,0,132,0.25)",color:xl,display:"flex",alignItems:"center",justifyContent:"center",gap:4,transition:"all 0.12s"},children:[o.jsx("span",{style:{fontSize:12},children:""}),o.jsx("span",{children:"Spawn"})]})]}),o.jsx(gp,{children:"Agentes"}),o.jsxs("div",{style:{padding:"5px 6px 2px",display:"flex",flexDirection:"column",gap:6},children:[o.jsx(Qb,{label:"Tam.",val:i,min:.2,max:6,step:.1,fmt:B=>`${B.toFixed(1)}x`,onChange:s}),o.jsx(Qb,{label:"Tempo",val:m,min:.01,max:10,step:.01,fmt:B=>B<.1?B.toFixed(2)+"x":B.toFixed(1)+"x",onChange:f})]}),o.jsx(gp,{children:"Modos"}),o.jsxs("div",{style:{padding:"4px 5px 5px",display:"flex",flexDirection:"column",gap:3},children:[o.jsx(Jb,{label:"Fixo",active:g,onClick:x}),o.jsx(Jb,{label:"Isolado",active:v,onClick:b}),o.jsx(Jb,{label:"Rizoma",active:w,onClick:M})]}),o.jsx(gp,{children:"Geometria"}),o.jsxs("div",{style:{padding:"4px 5px 5px"},children:[o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:2},children:["fluid","geometric","hybrid","3d"].map(B=>{const W={fluid:"FLUID",geometric:"GEO",hybrid:"HYBRID","3d":"3D"},re=k===B;return o.jsx("button",{onClick:()=>R(B),style:{padding:"4px 6px",borderRadius:1,cursor:"pointer",background:re?"rgba(255,0,132,0.08)":"rgba(255,255,255,0.01)",border:`1px solid ${re?"rgba(255,0,132,0.3)":vl}`,color:re?xl:Sl,fontSize:7,textAlign:"left",letterSpacing:"0.12em",fontFamily:Ys,textTransform:"uppercase",transition:"all 0.12s"},children:W[B]},B)})}),o.jsx("button",{onClick:I,style:{width:"100%",marginTop:5,padding:"4px 0",borderRadius:1,cursor:"pointer",fontSize:7,letterSpacing:"0.1em",textTransform:"uppercase",textAlign:"center",fontFamily:Ys,background:j?"rgba(255,0,132,0.06)":"rgba(255,255,255,0.02)",border:`1px solid ${j?"rgba(255,0,132,0.25)":vl}`,color:j?xl:Sl,transition:"all 0.12s"},children:j?"GEO PARAMS ":"GEO PARAMS "})]}),o.jsx("div",{style:{height:12}})]})})},HK=["normal","add","multiply","screen","overlay"],WK=({layers:e,onChange:t,onClearLayer:n})=>o.jsxs("div",{className:"flex flex-col gap-0 overflow-y-auto",style:{background:"#000",fontFamily:"'IBM Plex Mono', monospace"},children:[o.jsx("div",{style:{padding:"10px 12px 8px",fontSize:8,letterSpacing:"0.16em",color:"#ff0084",textTransform:"uppercase",borderBottom:"1px dashed rgba(255,255,255,0.06)"},children:"LAYER STACK"}),[...e].reverse().map(r=>o.jsxs("div",{style:{padding:"8px 10px",borderBottom:"1px solid rgba(255,255,255,0.04)",background:r.visible?"transparent":"rgba(0,0,0,0.3)",opacity:r.visible?1:.5},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:5},children:[o.jsx("button",{onClick:()=>t(r.id,{visible:!r.visible}),style:{background:"none",border:"none",cursor:"pointer",color:r.visible?"rgba(255,255,255,0.6)":"rgba(255,255,255,0.15)",padding:0},children:r.visible?o.jsx(jl,{size:11,strokeWidth:1.5}):o.jsx(Xp,{size:11,strokeWidth:1.5})}),o.jsx("button",{onClick:()=>t(r.id,{locked:!r.locked}),style:{background:"none",border:"none",cursor:"pointer",color:r.locked?"rgba(255,180,60,0.7)":"rgba(255,255,255,0.2)",padding:0},children:r.locked?o.jsx($x,{size:11,strokeWidth:1.5}):o.jsx(wP,{size:11,strokeWidth:1.5})}),o.jsx("span",{style:{flex:1,fontSize:10,color:"rgba(255,255,255,0.7)",letterSpacing:"0.04em"},children:r.name}),o.jsx("button",{onClick:()=>n(r.id),title:"Limpar camada",style:{background:"none",border:"none",cursor:"pointer",color:"rgba(255,255,255,0.18)",fontSize:9,padding:0},children:"clr"})]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[o.jsx("span",{style:{fontSize:8,color:"rgba(255,255,255,0.3)",width:14},children:Math.round(r.opacity*100)}),o.jsx("input",{type:"range",min:0,max:1,step:.01,value:r.opacity,onChange:a=>t(r.id,{opacity:parseFloat(a.target.value)}),style:{flex:1,cursor:"pointer",accentColor:"rgba(255,255,255,0.4)"}}),o.jsx("select",{value:r.blendMode,onChange:a=>t(r.id,{blendMode:a.target.value}),style:{background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.08)",color:"rgba(255,255,255,0.6)",fontSize:8,padding:"1px 3px",borderRadius:3,cursor:"pointer",width:58},children:HK.map(a=>o.jsx("option",{value:a,children:a},a))})]})]},r.id))]}),_C={observation:"rgba(100,180,255,0.7)",suggestion:"rgba(180,140,255,0.7)",milestone:"rgba(100,220,140,0.7)"},GK=({archive:e,grimoire:t,onRestoreEntry:n,onDeleteEntry:r,onToggleFavorite:a,onTogglePin:i})=>{const[s,c]=S.useState("archive");return o.jsxs("div",{className:"flex flex-col h-full overflow-hidden",style:{background:"#000",fontFamily:"'IBM Plex Mono', monospace"},children:[o.jsx("div",{style:{display:"flex",borderBottom:"1px dashed rgba(255,255,255,0.06)"},children:["archive","grimoire"].map(l=>o.jsx("button",{onClick:()=>c(l),style:{flex:1,padding:"8px 0",border:"none",cursor:"pointer",background:s===l?"rgba(255,0,132,0.04)":"transparent",color:s===l?"#ff0084":"rgba(255,255,255,0.28)",fontSize:8,letterSpacing:"0.14em",textTransform:"uppercase",borderBottom:s===l?"1px solid #ff0084":"1px solid transparent",fontFamily:"'IBM Plex Mono', monospace"},children:l==="archive"?"ARCHIVE":"GRIMOIRE"},l))}),s==="archive"?o.jsx("div",{className:"flex-1 overflow-y-auto",style:{padding:"8px 6px"},children:e.length===0?o.jsxs("div",{style:{textAlign:"center",padding:"24px 12px",color:"rgba(255,255,255,0.2)",fontSize:10},children:["Nenhum snapshot salvo.",o.jsx("br",{}),"Use a camera icon para capturar."]}):o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:6},children:e.map(l=>o.jsx(VK,{entry:l,onRestore:()=>n(l),onDelete:()=>r(l.id),onFavorite:()=>a(l.id),onPin:()=>i(l.id)},l.id))})}):o.jsx("div",{className:"flex-1 overflow-y-auto",style:{padding:"8px 6px"},children:t.length===0?o.jsx("div",{style:{textAlign:"center",padding:"24px 12px",color:"rgba(255,255,255,0.2)",fontSize:10},children:"Grimoire vazio. Observacoes emergem durante a criacao."}):o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:t.map(l=>o.jsxs("div",{style:{padding:"6px 8px",borderRadius:4,background:"rgba(255,255,255,0.02)",borderLeft:`2px solid ${_C[l.type]}`},children:[o.jsxs("div",{style:{fontSize:7,color:"rgba(255,255,255,0.2)",marginBottom:2,fontFamily:"monospace"},children:[RK(l.timestamp),"  ",l.type]}),o.jsx("div",{style:{fontSize:9,color:_C[l.type],lineHeight:1.4},children:l.text})]},l.id))})})]})};function VK({entry:e,onRestore:t,onDelete:n,onFavorite:r,onPin:a}){const i=new Date(e.timestamp),s=`${i.getHours().toString().padStart(2,"0")}:${i.getMinutes().toString().padStart(2,"0")}`;return o.jsxs("div",{style:{border:"1px solid rgba(255,255,255,0.07)",borderRadius:4,background:e.pinned?"rgba(255,200,60,0.04)":"rgba(255,255,255,0.02)",overflow:"hidden"},children:[o.jsxs("div",{style:{display:"flex",gap:0},children:[o.jsx("button",{onClick:t,title:"Restaurar DNA e semente",style:{border:"none",padding:0,cursor:"pointer",flexShrink:0},children:o.jsx("img",{src:e.thumbnail,alt:"",style:{width:52,height:52,display:"block",objectFit:"cover"}})}),o.jsxs("div",{style:{flex:1,padding:"5px 7px",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:8,color:"rgba(255,255,255,0.25)",fontFamily:"monospace"},children:s}),e.dna.name&&o.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.6)",marginTop:1},children:e.dna.name}),o.jsx("div",{style:{display:"flex",gap:3,marginTop:3,flexWrap:"wrap"},children:e.dna.palette.map((c,l)=>o.jsx("div",{style:{width:10,height:10,borderRadius:2,background:c}},l))})]}),o.jsxs("div",{style:{display:"flex",gap:4,marginTop:4},children:[o.jsx("button",{onClick:r,style:{...Zb,color:e.favorite?"#f87171":"rgba(255,255,255,0.2)"},children:o.jsx(Jk,{size:10,strokeWidth:1.5})}),o.jsx("button",{onClick:a,style:{...Zb,color:e.pinned?"#fbbf24":"rgba(255,255,255,0.2)"},children:o.jsx(eR,{size:10,strokeWidth:1.5})}),o.jsx("button",{onClick:n,style:{...Zb,color:"rgba(255,255,255,0.2)",marginLeft:"auto"},children:o.jsx(il,{size:10,strokeWidth:1.5})})]})]})]}),e.gestures.length>0&&o.jsx("div",{style:{padding:"3px 7px",borderTop:"1px solid rgba(255,255,255,0.04)",fontSize:7,color:"rgba(255,255,255,0.2)",fontFamily:"monospace"},children:e.gestures.map(c=>c.toolId.replace("_"," ")).slice(0,5).join("  ")})]})}const Zb={background:"none",border:"none",cursor:"pointer",padding:0,display:"flex",alignItems:"center"};function UK(){const e=rw(),[t,n]=S.useState({connected:!1,name:"",inputMode:"auto"}),r=S.useRef("auto");return S.useEffect(()=>{const i=c=>{n(l=>({...l,connected:!0,name:c.gamepad.id.slice(0,40)}))},s=()=>{n(c=>({...c,connected:!1,name:""}))};return window.addEventListener("gamepadconnected",i),window.addEventListener("gamepaddisconnected",s),()=>{window.removeEventListener("gamepadconnected",i),window.removeEventListener("gamepaddisconnected",s)}},[]),{manager:e,status:t,inputModeRef:r,setInputMode:i=>{r.current=i,n(s=>({...s,inputMode:i}))}}}function YK(e,t){return t==="mouse"?!1:t==="controller"?e.connected:e.connected&&(Math.abs(e.axes.lx)>.05||Math.abs(e.axes.ly)>.05||e.triggers.rt>.05||e.triggers.lt>.05||Object.values(e.buttons).some(Boolean))}const KK=({cursorRef:e,color:t="rgba(80,230,140,0.92)"})=>o.jsxs("div",{ref:e,style:{position:"absolute",pointerEvents:"none",display:"none",transform:"translate(-50%, -50%)",zIndex:50},children:[o.jsx("div",{style:{position:"absolute",width:28,height:28,left:-14,top:-14,borderRadius:"50%",border:`1px solid ${t}`,opacity:.6}}),o.jsx("div",{style:{position:"absolute",left:-10,top:-.5,width:20,height:1,background:t}}),o.jsx("div",{style:{position:"absolute",top:-10,left:-.5,height:20,width:1,background:t}}),o.jsx("div",{style:{position:"absolute",width:4,height:4,left:-2,top:-2,borderRadius:"50%",background:t}})]});function s5(){return{mode:"fluid",macroStructure:0,macroGesture:.28,macroContrast:.5,macroSilence:0,macroAtmosphere:0,macroCollage:0,snapAxes:0,gridStrength:0,gridSize:40,lineMastery:0,planeCasting:0,cutWindows:0,mixPoint:.3,mixLine:.3,mixRect:.2,mixArc:.1,mixPlane:.1,shapeOpacity:.85,fillSolidity:.35,strokeWeight:1,shapeScale:1,rotationDrift:0,vignetteStr:0,grainStr:0,bloomShape:0,zDepth:1,orbitSpeed:.2,camFOV:55,depthFog:.3,light3D:.5,particleSize3D:1,glowIntensity3D:.55,waveZ:.3,showGeoShapes:!0,solidShapes3D:!1,shapeGravity:0,angleDamping:0,boundaryMode:"wrap",showBorder:!1,trails3D:!1,trailLength3D:3}}function Ph(e){e.snapAxes=Math.min(1,e.macroStructure*1.2),e.gridStrength=Math.min(1,e.macroStructure*.9),e.lineMastery=Math.min(1,e.macroStructure*.7+e.macroContrast*.3),e.planeCasting=Math.min(1,e.macroCollage*.8+e.macroSilence*.2),e.cutWindows=Math.min(1,e.macroCollage*.6)}function yp(e,t){const n=e.length;if(n===0)return;const r=Math.max(0,Math.min(8,Math.round(t.macroAtmosphere*6))),a=t.mixPoint+t.mixLine+t.mixRect+t.mixArc+t.mixPlane,i=a>0?a:1,s=t.mixPoint/i,c=s+t.mixLine/i,l=c+t.mixRect/i,d=l+t.mixArc/i,u=n-r;for(let h=0;h<n;h++){const m=e[h];if(h<r){m.kind="gradientEmitter",m.qscale===void 0&&(m.qscale=1.5+Math.random()*2.5);continue}const f=u>0?(h-r)/u:0;let g;f<s?g="point":f<c?g="line":f<l?g="rect":f<d?g="arc":g="plane",m.kind=g,m.angle===void 0&&(m.angle=Math.atan2(m.vy,m.vx)+(Math.random()-.5)*.3),m.qscale===void 0&&(m.qscale=1.2+Math.random()*2),g==="line"&&m.length===void 0&&(m.length=30+Math.random()*80),g==="arc"&&m.length===void 0&&(m.length=16+Math.random()*40),g==="rect"&&m.thickness===void 0&&(m.thickness=1+Math.random()*2),g==="plane"&&m.fillAlpha===void 0&&(m.fillAlpha=.25+Math.random()*.25),g==="rect"&&m.fillAlpha===void 0&&(m.fillAlpha=0)}}function XK(e){for(const t of e)t.kind=void 0,t.angle=void 0,t.qscale=void 0,t.length=void 0,t.thickness=void 0,t.fillAlpha=void 0,t.qBlend=void 0}function JK(e,t,n,r){const a=t.snapAxes*.12,i=t.gridStrength*.08,s=t.gridSize/Math.max(n,r),c=t.macroSilence*.004,l=(t.rotationDrift??0)*8e-4,d=t.macroGesture??.5,u=.012+d*.055,h=d*.0012,m=t.angleDamping??0,f=u*(1-m*.85),g=(t.shapeGravity??0)*6e-4;for(const x of e){const v=x.kind;if(v==="line"||v==="rect"||v==="arc"||v==="plane"){if(Math.sqrt(x.vx*x.vx+x.vy*x.vy)>5e-5){const w=Math.atan2(x.vy,x.vx),M=x.angle??0;let k=w-M;for(;k>Math.PI;)k-=Math.PI*2;for(;k<-Math.PI;)k+=Math.PI*2;x.angle=M+k*f}l>0&&(x.angle=(x.angle??0)+l*(x.species%2===0?1:-1))}if(h>1e-4&&v!=="gradientEmitter"&&v!=="point"&&v!==void 0&&(x.vx+=(Math.random()-.5)*h,x.vy+=(Math.random()-.5)*h),g>1e-5&&v!=="gradientEmitter"){const b=.5-x.x,w=.5-x.y;x.vx+=b*g,x.vy+=w*g}if(a>.001&&(v==="line"||v==="rect")){const w=((x.angle??0)%Math.PI+Math.PI)%Math.PI,M=[0,Math.PI/4,Math.PI/2,Math.PI*3/4];let k=0,R=1/0;for(const I of M){const E=Math.abs(w-I);E<R&&(R=E,k=I)}const j=k-w;x.angle=(x.angle??0)+j*a}if(i>.001&&s>.001&&(v==="rect"||v==="plane")){const b=Math.round(x.x/s)*s,w=Math.round(x.y/s)*s;x.vx+=(b-x.x)*i*.3,x.vy+=(w-x.y)*i*.3}if(c>0&&v!=="gradientEmitter"){const b=x.x-.5,w=x.y-.5,M=Math.sqrt(b*b+w*w)+.001;x.vx+=b/M*c,x.vy+=w/M*c}if(v==="line"&&t.lineMastery>.1){const b=40+t.lineMastery*140,w=x.length??30;w<b&&(x.length=w+t.lineMastery*.4)}}}function QK(e,t,n,r,a){const s=e.length;if(s===0)return;const c=a*80%s;if(t.planeCasting>.15){let l=0;for(let d=0;d<Math.min(80,s);d++){const u=e[(c+d)%s];if(u.kind==="rect"&&u.age>300&&Math.random()<t.planeCasting*.03&&(u.kind="plane",u.fillAlpha=(u.fillAlpha??.06)+.02,u.qBlend=t.macroCollage>.5?"multiply":"screen",l++,l>=2))break}}if(t.cutWindows>.1&&a%120===0){let l=0;for(let d=0;d<s&&l<2;d++){const u=e[(c+d)%s];u.kind==="plane"&&Math.random()<t.cutWindows*.15&&(u.kind="rect",l++)}}if(t.lineMastery>.3){let l=0;for(let d=0;d<s&&l<4;d++){const u=e[(c+d)%s];if(u.kind==="line"&&u.age>200){const h=60+t.lineMastery*180;(u.length??0)<h&&(u.length=(u.length??20)+t.lineMastery*1.2),l++}}}}const ZK={constructive_score:{mode:"geometric",macroStructure:.92,macroGesture:.35,macroContrast:.95,macroSilence:.6,macroAtmosphere:0,macroCollage:.1,snapAxes:.95,gridStrength:.85,gridSize:48,lineMastery:.95,planeCasting:.05,cutWindows:0,mixPoint:.02,mixLine:.8,mixRect:.12,mixArc:.04,mixPlane:.02,shapeOpacity:.92,fillSolidity:.15,strokeWeight:1.8,shapeScale:1.2,rotationDrift:0,vignetteStr:.25,grainStr:.05,bloomShape:0,zDepth:1,orbitSpeed:.2,camFOV:55,depthFog:.3,light3D:.5,particleSize3D:1,glowIntensity3D:.55,waveZ:.3},geometric_orchestra:{mode:"hybrid",macroStructure:.3,macroGesture:.7,macroContrast:.85,macroSilence:.1,macroAtmosphere:.2,macroCollage:.15,snapAxes:.2,gridStrength:.1,gridSize:32,lineMastery:.2,planeCasting:.1,cutWindows:.05,mixPoint:.08,mixLine:.1,mixRect:.08,mixArc:.7,mixPlane:.04,shapeOpacity:.8,fillSolidity:.5,strokeWeight:1.3,shapeScale:1.1,rotationDrift:.3,vignetteStr:.15,grainStr:0,bloomShape:.35,zDepth:1,orbitSpeed:.2,camFOV:55,depthFog:.3,light3D:.5,particleSize3D:1,glowIntensity3D:.55,waveZ:.3},analytical_collage:{mode:"geometric",macroStructure:.55,macroGesture:.2,macroContrast:.9,macroSilence:.55,macroAtmosphere:0,macroCollage:.95,snapAxes:.6,gridStrength:.7,gridSize:64,lineMastery:.1,planeCasting:.9,cutWindows:.7,mixPoint:.02,mixLine:.05,mixRect:.28,mixArc:.02,mixPlane:.63,shapeOpacity:.88,fillSolidity:.75,strokeWeight:.8,shapeScale:1.4,rotationDrift:0,vignetteStr:.4,grainStr:.2,bloomShape:0,zDepth:1,orbitSpeed:.2,camFOV:55,depthFog:.3,light3D:.5,particleSize3D:1,glowIntensity3D:.55,waveZ:.3},spiritual_geometry:{mode:"geometric",macroStructure:.25,macroGesture:.15,macroContrast:.8,macroSilence:.8,macroAtmosphere:.3,macroCollage:.1,snapAxes:.15,gridStrength:.05,gridSize:80,lineMastery:.3,planeCasting:.05,cutWindows:0,mixPoint:.6,mixLine:.05,mixRect:.05,mixArc:.28,mixPlane:.02,shapeOpacity:.75,fillSolidity:.6,strokeWeight:1,shapeScale:.9,rotationDrift:.5,vignetteStr:.55,grainStr:.1,bloomShape:.45,zDepth:1,orbitSpeed:.2,camFOV:55,depthFog:.3,light3D:.5,particleSize3D:1,glowIntensity3D:.55,waveZ:.3},nebula_drift:{mode:"3d",macroStructure:.05,macroGesture:.65,macroContrast:.7,macroSilence:.2,macroAtmosphere:.8,macroCollage:0,snapAxes:0,gridStrength:0,gridSize:40,lineMastery:0,planeCasting:0,cutWindows:0,mixPoint:.8,mixLine:.1,mixRect:0,mixArc:.1,mixPlane:0,shapeOpacity:.85,fillSolidity:.35,strokeWeight:1,shapeScale:1,rotationDrift:0,vignetteStr:0,grainStr:0,bloomShape:0,zDepth:1.6,orbitSpeed:.15,camFOV:55,depthFog:.55,light3D:.45,particleSize3D:1.1,glowIntensity3D:.8,waveZ:.55},crystal_lattice:{mode:"3d",macroStructure:.88,macroGesture:.2,macroContrast:.95,macroSilence:.55,macroAtmosphere:.25,macroCollage:0,snapAxes:.9,gridStrength:.85,gridSize:48,lineMastery:.9,planeCasting:0,cutWindows:0,mixPoint:.05,mixLine:.85,mixRect:.05,mixArc:.05,mixPlane:0,shapeOpacity:.92,fillSolidity:.15,strokeWeight:1.6,shapeScale:1.1,rotationDrift:0,vignetteStr:0,grainStr:0,bloomShape:0,zDepth:.85,orbitSpeed:.08,camFOV:48,depthFog:.2,light3D:.8,particleSize3D:.85,glowIntensity3D:.4,waveZ:.12},void_bloom:{mode:"3d",macroStructure:0,macroGesture:.9,macroContrast:1,macroSilence:0,macroAtmosphere:.9,macroCollage:0,snapAxes:0,gridStrength:0,gridSize:40,lineMastery:0,planeCasting:0,cutWindows:0,mixPoint:.95,mixLine:.05,mixRect:0,mixArc:0,mixPlane:0,shapeOpacity:1,fillSolidity:.35,strokeWeight:1,shapeScale:1.3,rotationDrift:0,vignetteStr:0,grainStr:0,bloomShape:0,zDepth:2,orbitSpeed:.45,camFOV:65,depthFog:.7,light3D:.6,particleSize3D:1.3,glowIntensity3D:.95,waveZ:.75},solar_wind:{mode:"3d",macroStructure:.15,macroGesture:.95,macroContrast:.85,macroSilence:.05,macroAtmosphere:.5,macroCollage:0,snapAxes:0,gridStrength:0,gridSize:40,lineMastery:.25,planeCasting:0,cutWindows:0,mixPoint:.3,mixLine:.25,mixRect:0,mixArc:.45,mixPlane:0,shapeOpacity:.88,fillSolidity:.4,strokeWeight:1.2,shapeScale:1,rotationDrift:.3,vignetteStr:0,grainStr:0,bloomShape:0,zDepth:1.2,orbitSpeed:.3,camFOV:58,depthFog:.35,light3D:.65,particleSize3D:.9,glowIntensity3D:.65,waveZ:.4},quantum_foam:{mode:"3d",macroStructure:0,macroGesture:1,macroContrast:1,macroSilence:0,macroAtmosphere:.85,macroCollage:0,snapAxes:0,gridStrength:0,gridSize:40,lineMastery:0,planeCasting:0,cutWindows:0,mixPoint:.7,mixLine:.2,mixRect:0,mixArc:.1,mixPlane:0,shapeOpacity:1,fillSolidity:.35,strokeWeight:1,shapeScale:.75,rotationDrift:0,vignetteStr:0,grainStr:0,bloomShape:0,zDepth:1.9,orbitSpeed:.6,camFOV:72,depthFog:.72,light3D:.5,particleSize3D:.65,glowIntensity3D:1,waveZ:.95},deep_field:{mode:"3d",macroStructure:.05,macroGesture:.18,macroContrast:.75,macroSilence:.6,macroAtmosphere:.35,macroCollage:0,snapAxes:0,gridStrength:0,gridSize:40,lineMastery:0,planeCasting:0,cutWindows:0,mixPoint:.92,mixLine:.04,mixRect:0,mixArc:.04,mixPlane:0,shapeOpacity:.8,fillSolidity:.35,strokeWeight:1,shapeScale:.7,rotationDrift:0,vignetteStr:0,grainStr:0,bloomShape:0,zDepth:1.4,orbitSpeed:.05,camFOV:42,depthFog:.5,light3D:.35,particleSize3D:.72,glowIntensity3D:.55,waveZ:.18},rhizome_3d:{mode:"3d",macroStructure:.7,macroGesture:.8,macroContrast:.9,macroSilence:.3,macroAtmosphere:.45,macroCollage:0,snapAxes:.6,gridStrength:.3,gridSize:40,lineMastery:.85,planeCasting:0,cutWindows:0,mixPoint:.1,mixLine:.85,mixRect:0,mixArc:.05,mixPlane:0,shapeOpacity:.92,fillSolidity:.35,strokeWeight:1.5,shapeScale:1,rotationDrift:0,vignetteStr:0,grainStr:0,bloomShape:0,zDepth:.75,orbitSpeed:.12,camFOV:52,depthFog:.15,light3D:.7,particleSize3D:.65,glowIntensity3D:.6,waveZ:.08,trails3D:!0,trailLength3D:6,showGeoShapes:!0,solidShapes3D:!1}};function Z0(e,t,n){const r=e[t];return typeof r=="number"&&isFinite(r)?r:n}function NC(e,t,n,r,a,i){if(n.macroAtmosphere<.02)return;const s=t.filter(l=>l.kind==="gradientEmitter");if(s.length===0)return;const c=.04+n.macroAtmosphere*.09;for(const l of s){const d=l.x*a,u=l.y*i,h=Math.max(40,(l.qscale??1.5)*55*n.macroAtmosphere),m=r[l.species%r.length]??"#ffffff",f=e.createRadialGradient(d,u,0,d,u,h);f.addColorStop(0,ex(m,c)),f.addColorStop(.5,ex(m,c*.4)),f.addColorStop(1,ex(m,0)),e.globalCompositeOperation="source-over",e.fillStyle=f,e.beginPath(),e.arc(d,u,h,0,Math.PI*2),e.fill()}e.globalAlpha=1,e.globalCompositeOperation="source-over"}function OC(e,t,n,r,a,i,s){e.save();const c=Math.max(.25,r.macroContrast),l=r.macroSilence,d=Z0(r,"shapeOpacity",.85),u=Z0(r,"fillSolidity",.35),h=Z0(r,"strokeWeight",1),m=Z0(r,"shapeScale",1),f=d*(.6+c*.38),g=d*u*(.28+c*.5),{symmetry:x}=n.genes,v=lX(x),b=a/2,w=i/2,M={gradientEmitter:-1,mask:-1,plane:0,rect:1,arc:2,line:3,point:4},k=[...t].sort((E,O)=>(M[E.kind??"point"]??4)-(M[O.kind??"point"]??4));for(const E of k){const O=E.kind??"point";if(O==="gradientEmitter"||O==="mask")continue;const L=E.x*a,$=E.y*i,F=`hsl(${E.hue.toFixed(0)},${Math.min(100,E.sat*100).toFixed(0)}%,${Math.min(85,E.lit*100).toFixed(0)}%)`;if(!(l>.5&&Math.random()<l*.3))for(let B=0;B<v;B++){let W=L,re=$;if(v>1){const oe=B/v*Math.PI*2,te=Math.cos(oe),J=Math.sin(oe),pe=L-b,P=$-w;W=b+pe*te-P*J,re=w+pe*J+P*te}switch(O){case"point":eX(e,W,re,E,F,f,g,a,m,h);break;case"line":tX(e,W,re,E,F,f,m,h);break;case"arc":nX(e,W,re,E,F,f,g,s,m,h);break;case"rect":rX(e,W,re,E,F,f,g,m,h);break;case"plane":oX(e,W,re,E,F,g,m);break}}}e.restore();const R=Z0(r,"bloomShape",0),j=Z0(r,"grainStr",0),I=Z0(r,"vignetteStr",0);R>.05&&aX(e,a,i,R),I>.02&&sX(e,a,i,I),j>.02&&iX(e,a,i,j,s)}function eX(e,t,n,r,a,i,s,c,l,d){const u=Math.max(2.5,r.size*(r.qscale??1)*(c/800)*l),h=r.species%5;switch(e.beginPath(),h){case 0:e.arc(t,n,u,0,Math.PI*2),e.globalAlpha=i,e.fillStyle=a,e.fill();break;case 1:e.globalAlpha=i,e.fillStyle=a,e.fillRect(t-u,n-u,u*2,u*2);break;case 2:e.moveTo(t,n-u*1.4),e.lineTo(t+u,n),e.lineTo(t,n+u*1.4),e.lineTo(t-u,n),e.closePath(),e.globalAlpha=s,e.fillStyle=a,e.fill(),e.globalAlpha=i,e.strokeStyle=a,e.lineWidth=Math.max(1.2,1*d),e.stroke();break;case 3:e.strokeStyle=a,e.lineWidth=Math.max(1.2,u*.6*d),e.lineCap="round",e.globalAlpha=i,e.moveTo(t-u,n),e.lineTo(t+u,n),e.moveTo(t,n-u),e.lineTo(t,n+u),e.stroke();break;case 4:e.moveTo(t,n-u*1.3),e.lineTo(t+u*1.1,n+u*.8),e.lineTo(t-u*1.1,n+u*.8),e.closePath(),e.globalAlpha=s,e.fillStyle=a,e.fill(),e.globalAlpha=i,e.strokeStyle=a,e.lineWidth=Math.max(1,.9*d),e.stroke();break}}function tX(e,t,n,r,a,i,s,c){const l=r.angle??0,u=Math.max(12,(r.length??40)*(r.qscale??1)*s)/2,h=Math.cos(l),m=Math.sin(l),f=Math.max(1.2,(r.thickness??1.5)*(r.qscale??1)*c);e.globalAlpha=i,e.strokeStyle=a,e.lineWidth=f,e.lineCap="round",e.globalCompositeOperation="source-over",e.beginPath(),e.moveTo(t-h*u,n-m*u),e.lineTo(t+h*u,n+m*u),e.stroke()}function nX(e,t,n,r,a,i,s,c,l,d){const u=Math.max(6,(r.length??22)*(r.qscale??1)*l),h=(r.age*.009+r.charge*.5)%(Math.PI*2),m=Math.PI*(.5+r.mood*1.2),f=h,g=h+m;e.globalAlpha=i,e.strokeStyle=a,e.lineWidth=Math.max(1.2,(r.thickness??1.8)*(r.qscale??1)*d),e.lineCap="round",e.globalCompositeOperation="source-over",e.beginPath(),e.arc(t,n,u,f,g),e.stroke(),s>.05&&m>=Math.PI&&(e.globalAlpha=s*.5,e.fillStyle=a,e.beginPath(),e.arc(t,n,u,f,g),e.closePath(),e.fill())}function rX(e,t,n,r,a,i,s,c,l){const d=Math.max(6,r.size*(r.qscale??1)*5*c),u=r.angle??0,h=Math.max(1,(r.thickness??1.5)*l),m=d,f=Math.max(4,d*(.45+r.mood*.75));e.save(),e.translate(t,n),e.rotate(u),s>.02&&(e.globalAlpha=s,e.fillStyle=a,e.fillRect(-m/2,-f/2,m,f)),e.globalAlpha=i,e.strokeStyle=a,e.lineWidth=h,e.globalCompositeOperation="source-over",e.strokeRect(-m/2,-f/2,m,f),e.restore()}function oX(e,t,n,r,a,i,s){const c=Math.max(24,r.size*(r.qscale??1)*20*s),l=Math.max(16,c*(.4+r.mood*.9)),d=r.angle??0;e.save(),e.translate(t,n),e.rotate(d);const u=Math.min(.92,i*1.6+.15);e.globalAlpha=u,e.fillStyle=a,e.globalCompositeOperation="source-over",e.fillRect(-c/2,-l/2,c,l),e.globalAlpha=Math.min(.85,u*.9),e.strokeStyle=a,e.lineWidth=.9,e.strokeRect(-c/2,-l/2,c,l),e.restore()}function aX(e,t,n,r){const a=document.createElement("canvas");a.width=t,a.height=n,a.getContext("2d").drawImage(e.canvas,0,0);const s=Math.round(4+r*18);e.save(),e.filter=`blur(${s}px)`,e.globalCompositeOperation="screen",e.globalAlpha=r*.55,e.drawImage(a,0,0),e.filter="none",e.restore()}function sX(e,t,n,r){const a=t/2,i=n/2,s=Math.sqrt(a*a+i*i),c=e.createRadialGradient(a,i,s*.25,a,i,s);c.addColorStop(0,"rgba(0,0,0,0)"),c.addColorStop(1,`rgba(0,0,0,${(r*.75).toFixed(3)})`),e.save(),e.globalCompositeOperation="source-over",e.globalAlpha=1,e.fillStyle=c,e.fillRect(0,0,t,n),e.restore()}function iX(e,t,n,r,a){if(a%2!==0)return;const i=a*1234567,s=Math.ceil(t/4),c=Math.ceil(n/4),l=r*.18;e.save(),e.globalCompositeOperation="source-over";for(let d=0;d<c;d++)for(let u=0;u<s;u++){let h=u*73856093^d*19349663^i;h=(h>>16^h)*73244475,h=h>>16^h;const m=(h&255)/255;m>.5&&(e.globalAlpha=l*(m-.5)*2,e.fillStyle=m>.75?"rgba(255,255,255,1)":"rgba(0,0,0,1)",e.fillRect(u*4,d*4,4,4))}e.restore()}function lX(e){return e<.28?1:e<.5?2:e<.66?4:e<.82?6:8}function ex(e,t){const n=e.replace("#","");if(n.length<6)return`rgba(128,128,128,${t.toFixed(4)})`;const a=parseInt(n.slice(0,2),16),i=parseInt(n.slice(2,4),16),s=parseInt(n.slice(4,6),16);return`rgba(${a},${i},${s},${t.toFixed(4)})`}function cX(e,t,n,r){const a=1/Math.tan(e*Math.PI/360),i=1/(n-r),s=new Float32Array(16);return s[0]=a/t,s[5]=a,s[10]=(r+n)*i,s[11]=-1,s[14]=2*r*n*i,s}function dX(e,t,n,r,a,i){let s=r-e,c=a-t,l=i-n;const d=Math.sqrt(s*s+c*c+l*l)||1;s/=d,c/=d,l/=d;let u=-l,h=0,m=s;const f=Math.sqrt(u*u+m*m)||1;u/=f,m/=f;const g=h*l-m*c,x=m*s-u*l,v=u*c-h*s,b=new Float32Array(16);return b[0]=u,b[1]=g,b[2]=-s,b[4]=h,b[5]=x,b[6]=-c,b[8]=m,b[9]=v,b[10]=-l,b[12]=-(u*e+h*t+m*n),b[13]=-(g*e+x*t+v*n),b[14]=s*e+c*t+l*n,b[15]=1,b}function uX(e,t){const n=new Float32Array(16);for(let r=0;r<4;r++)for(let a=0;a<4;a++){let i=0;for(let s=0;s<4;s++)i+=e[s*4+r]*t[a*4+s];n[a*4+r]=i}return n}const DC=`
attribute vec3  a_pos;
attribute vec4  a_color;
attribute float a_size;
uniform   mat4  u_mvp;
uniform   float u_ptScale;
uniform   float u_alphaScale;
varying   vec4  v_color;
void main() {
  vec4 clip    = u_mvp * vec4(a_pos, 1.0);
  gl_Position  = clip;
  float w      = max(0.12, clip.w);
  gl_PointSize = max(1.0, u_ptScale * a_size / w);
  v_color      = vec4(a_color.rgb, a_color.a * u_alphaScale);
}`,hX=`
precision mediump float;
varying vec4 v_color;
void main() {
  vec2  c  = gl_PointCoord - 0.5;
  float r2 = dot(c, c) * 4.0;
  float a  = exp(-r2 * 2.6);
  if (a < 0.005) discard;
  gl_FragColor = vec4(v_color.rgb, v_color.a * a);
}`,fX=`
precision mediump float;
varying vec4 v_color;
void main() {
  vec2  c = gl_PointCoord - 0.5;
  float r = length(c) * 2.0;
  float a = 1.0 - smoothstep(0.55, 1.0, r);
  if (a < 0.01) discard;
  gl_FragColor = vec4(v_color.rgb, v_color.a * a);
}`,pX=`
attribute vec3 a_pos;
attribute vec4 a_color;
uniform   mat4 u_mvp;
varying   vec4 v_color;
void main() {
  gl_Position = u_mvp * vec4(a_pos, 1.0);
  v_color     = a_color;
}`,mX=`
precision mediump float;
varying vec4 v_color;
void main() { gl_FragColor = v_color; }`,$5=8,al=7,Bv=7,LC=4096,Du=32e3,$v=14e3,w0=12,gX=2500;class yX{constructor(t){this.gl=null,this.glowB=null,this.crispB=null,this.lineB=null,this.ptBuf=null,this.lnBuf=null,this.triBuf=null,this.ptData=new Float32Array(LC*$5),this.lnData=new Float32Array(Du*al),this.triData=new Float32Array($v*Bv),this.theta=.4,this.phi=.22,this.radius=2.9,this.tTheta=.4,this.tPhi=.22,this.tRadius=2.9,this.lastW=0,this.lastH=0,this.dragging=!1,this.dragX=0,this.dragY=0,this.twoFingerDist=0,this._dragEndTime=0,this.canvas=t,this._md=c=>{c.button===0&&(this.dragging=!0,this.dragX=c.clientX,this.dragY=c.clientY,c.preventDefault())},this._mm=c=>{if(!this.dragging)return;const l=c.clientX-this.dragX,d=c.clientY-this.dragY;this.dragX=c.clientX,this.dragY=c.clientY,this.tTheta-=l*.006,this.tPhi=$C(this.tPhi+d*.005)},this._mu=()=>{this.dragging=!1,this._dragEndTime=performance.now()},this._mw=c=>{const l=c.deltaY>0?1.12:.89;this.tRadius=_p(this.tRadius*l,.6,9),c.preventDefault()},this._dd=c=>{c.preventDefault(),this.resetCamera()},this._ts=c=>{c.touches.length===1?(this.dragging=!0,this.dragX=c.touches[0].clientX,this.dragY=c.touches[0].clientY):c.touches.length===2&&(this.twoFingerDist=qC(c))},this._tm=c=>{if(c.touches.length===1&&this.dragging){const l=c.touches[0].clientX-this.dragX,d=c.touches[0].clientY-this.dragY;this.dragX=c.touches[0].clientX,this.dragY=c.touches[0].clientY,this.tTheta-=l*.006,this.tPhi=$C(this.tPhi+d*.005)}else if(c.touches.length===2&&this.twoFingerDist>0){const l=qC(c),d=this.twoFingerDist/Math.max(1,l);this.tRadius=_p(this.tRadius*(.5+d*.5),.6,9),this.twoFingerDist=l}c.preventDefault()},this._te=()=>{this.dragging=!1,this._dragEndTime=performance.now(),this.twoFingerDist=0};const n=t.getContext("webgl",{alpha:!0,antialias:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0});if(!n){console.warn("[MetaArt3D] WebGL unavailable");return}this.gl=n;const r=["u_mvp","u_ptScale","u_alphaScale"],a=["a_pos","a_color","a_size"],i=["u_mvp"],s=["a_pos","a_color"];this.glowB=tx(n,DC,hX,r,a),this.crispB=tx(n,DC,fX,r,a),this.lineB=tx(n,pX,mX,i,s),this.ptBuf=n.createBuffer(),this.lnBuf=n.createBuffer(),this.triBuf=n.createBuffer()}get isReady(){return!!(this.gl&&this.glowB&&this.crispB&&this.lineB)}resetCamera(){this.tTheta=.4,this.tPhi=.22,this.tRadius=2.9}attachHandlers(){const t=this.canvas;t.addEventListener("mousedown",this._md,{passive:!1}),t.addEventListener("mousemove",this._mm),t.addEventListener("mouseup",this._mu),t.addEventListener("mouseleave",this._mu),t.addEventListener("wheel",this._mw,{passive:!1}),t.addEventListener("dblclick",this._dd,{passive:!1}),t.addEventListener("touchstart",this._ts,{passive:!1}),t.addEventListener("touchmove",this._tm,{passive:!1}),t.addEventListener("touchend",this._te)}detachHandlers(){const t=this.canvas;t.removeEventListener("mousedown",this._md),t.removeEventListener("mousemove",this._mm),t.removeEventListener("mouseup",this._mu),t.removeEventListener("mouseleave",this._mu),t.removeEventListener("wheel",this._mw),t.removeEventListener("dblclick",this._dd),t.removeEventListener("touchstart",this._ts),t.removeEventListener("touchmove",this._tm),t.removeEventListener("touchend",this._te)}resize(t,n){if(t===this.lastW&&n===this.lastH)return;this.lastW=t,this.lastH=n;const r=Math.min(window.devicePixelRatio||1,2);this.canvas.width=Math.round(t*r),this.canvas.height=Math.round(n*r),this.gl&&this.gl.viewport(0,0,this.canvas.width,this.canvas.height)}render(t,n,r,a,i,s,c){const l=this.gl;if(!l||!this.isReady||!this.ptBuf||!this.lnBuf||!this.triBuf)return;const d=this.canvas.width,u=this.canvas.height;if(d===0||u===0)return;const h=this.glowB,m=this.crispB,f=this.lineB,g=(r.orbitSpeed??.2)*.0014;this.dragging||(this._dragEndTime===0||performance.now()-this._dragEndTime>gX)&&(this.tTheta+=g),this.theta+=(this.tTheta-this.theta)*.07,this.phi+=(this.tPhi-this.phi)*.06,this.radius+=(this.tRadius-this.radius)*.05;const x=r.camFOV??55,v=Math.cos(this.phi),b=this.radius*v*Math.sin(this.theta),w=this.radius*Math.sin(this.phi),M=this.radius*v*Math.cos(this.theta),k=dX(b,w,M,0,0,0),R=cX(x,d/u,.05,30),j=uX(R,k),[I,E,O]=wX(n.background??"#060608");l.clearColor(I*.35,E*.35,O*.45,1),l.clear(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT),l.disable(l.DEPTH_TEST),l.enable(l.BLEND);const L=n.genes.contrast??.5,$=n.genes.rhythm??.3,F=n.genes.entropy??.3,B=n.genes.fragmentation??.3,W=n.genes.memory??.5,re=(n.genes.linear??0)>.4,oe=n.genes.linear??0,te=r.zDepth??1,J=r.waveZ??.3,pe=r.depthFog??.3,P=r.light3D??.5,V=r.particleSize3D??1,fe=u*.026*V,ye=Math.max(0,pe-.25)*1.6,Se=Math.min(t.length,LC);let we=0;for(let nt=0;nt<Se;nt++){const pt=t[nt],Et=(pt.x-.5)*2.2,_t=(pt.y-.5)*-2.2,Ct=Rf(pt,te,J,s),Xe=Math.abs(Ct)/Math.max(.1,te),Ut=1-pe*Math.min(1,Xe);let Le=pt.lit;L>.3&&(Le=.5+(pt.lit-.5)*(1+L*1.5),Le=Math.max(.05,Math.min(.95,Le)));const Ke=1+P*(.5-Xe*.4);let[mt,an,gn]=Af(pt.hue,pt.sat,Le);mt=Math.min(1,mt*Ke),an=Math.min(1,an*Ke),gn=Math.min(1,gn*Ke);const Be=Ut*Math.min(1,pt.ink*2.8+.4),ft=Math.abs(Ct),Qt=1+ye*ft*.9,nr=1/(1+ye*ft*.55),_n=$>.2?1+.35*$*Math.sin(s*.06*$+pt.hue*.1):1,Rn=F>.15?1+((pt.age*7+13)%17/17-.5)*F*.7:1,sn=B>.5?pt.species%2===0?.55:1.45:1,Cn=Math.max(1.5,pt.size*(pt.qscale??1)*2*Qt*_n*Rn*sn),wt=Be*nr,st=we*$5;this.ptData[st]=Et,this.ptData[st+1]=_t,this.ptData[st+2]=Ct,this.ptData[st+3]=mt,this.ptData[st+4]=an,this.ptData[st+5]=gn,this.ptData[st+6]=wt,this.ptData[st+7]=Cn,we++}if(l.bindBuffer(l.ARRAY_BUFFER,this.ptBuf),l.bufferData(l.ARRAY_BUFFER,this.ptData.subarray(0,we*$5),l.DYNAMIC_DRAW),r.solidShapes3D){const nt=SX(t,Se,te,J,s,a,r,this.triData);nt>0&&(l.bindBuffer(l.ARRAY_BUFFER,this.triBuf),l.bufferData(l.ARRAY_BUFFER,this.triData.subarray(0,nt*Bv),l.DYNAMIC_DRAW),l.blendFunc(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA),l.useProgram(f.prog),l.uniformMatrix4fv(f.u.u_mvp,!1,j),zC(l,f),l.drawArrays(l.TRIANGLES,0,nt))}const ke=r.glowIntensity3D??.5,De=c?c.glow:ke>.01,_e=c!=null&&c.glow?Math.max(.3,ke):ke;De&&_e>.01&&(l.blendFunc(l.SRC_ALPHA,l.ONE),l.useProgram(h.prog),l.uniformMatrix4fv(h.u.u_mvp,!1,j),l.uniform1f(h.u.u_ptScale,fe*3.6),l.uniform1f(h.u.u_alphaScale,_e*.055),nx(l,h),l.drawArrays(l.POINTS,0,we),l.uniform1f(h.u.u_ptScale,fe*2),l.uniform1f(h.u.u_alphaScale,_e*.18),nx(l,h),l.drawArrays(l.POINTS,0,we)),l.blendFunc(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA),l.useProgram(m.prog),l.uniformMatrix4fv(m.u.u_mvp,!1,j),l.uniform1f(m.u.u_ptScale,fe),l.uniform1f(m.u.u_alphaScale,1),nx(l,m),l.drawArrays(l.POINTS,0,we);let ae=0;const Fe=(c?c.connections:!1)?Math.max(.4,_p((r.macroAtmosphere??0)*.55+_e*.35,0,.85)):_p((r.macroAtmosphere??0)*.55+(r.glowIntensity3D??.5)*.35,0,.85);Fe>.02&&Se>2&&(ae=xX(t,Se,te,J,s,Fe,this.lnData));const Oe=r.trails3D??!1,ne=r.trailLength3D??3;if((Oe||re)&&(ae=BC(t,Se,te,J,s,n,re?6:ne,re,oe,ae,this.lnData)),!Oe&&!re&&W>.55){const nt=Math.round(1+(W-.55)*10);ae=BC(t,Se,te,J,s,n,nt,!1,oe,ae,this.lnData)}r.showGeoShapes!==!1&&(ae=vX(t,Se,te,J,s,a,r,ae,this.lnData)),ae>1&&(l.bindBuffer(l.ARRAY_BUFFER,this.lnBuf),l.bufferData(l.ARRAY_BUFFER,this.lnData.subarray(0,ae*al),l.DYNAMIC_DRAW),l.blendFunc(l.SRC_ALPHA,l.ONE),l.useProgram(f.prog),l.uniformMatrix4fv(f.u.u_mvp,!1,j),zC(l,f),l.drawArrays(l.LINES,0,ae)),l.blendFunc(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA),l.flush()}dispose(){const t=this.gl;t&&([this.ptBuf,this.lnBuf,this.triBuf].forEach(n=>n&&t.deleteBuffer(n)),[this.glowB,this.crispB,this.lineB].forEach(n=>{n&&t.deleteProgram(n.prog)}),this.gl=null)}}function tx(e,t,n,r,a){const i=bX(e,t,n);if(!i)return null;const s={};for(const l of r)s[l]=e.getUniformLocation(i,l);const c={};for(const l of a)c[l]=e.getAttribLocation(i,l);return{prog:i,u:s,a:c}}function bX(e,t,n){const r=(c,l)=>{const d=e.createShader(c);return e.shaderSource(d,l),e.compileShader(d),e.getShaderParameter(d,e.COMPILE_STATUS)?d:(console.error("[MetaArt3D] Shader error:",e.getShaderInfoLog(d)),null)},a=r(e.VERTEX_SHADER,t),i=r(e.FRAGMENT_SHADER,n);if(!a||!i)return null;const s=e.createProgram();return e.attachShader(s,a),e.attachShader(s,i),e.linkProgram(s),e.getProgramParameter(s,e.LINK_STATUS)?s:(console.error("[MetaArt3D] Link error:",e.getProgramInfoLog(s)),null)}function nx(e,t){const n=$5*4,{a:r}=t,a=r.a_pos,i=r.a_color,s=r.a_size;a>=0&&(e.enableVertexAttribArray(a),e.vertexAttribPointer(a,3,e.FLOAT,!1,n,0)),i>=0&&(e.enableVertexAttribArray(i),e.vertexAttribPointer(i,4,e.FLOAT,!1,n,12)),s>=0&&(e.enableVertexAttribArray(s),e.vertexAttribPointer(s,1,e.FLOAT,!1,n,28))}function zC(e,t){const n=al*4,{a:r}=t,a=r.a_pos,i=r.a_color;a>=0&&(e.enableVertexAttribArray(a),e.vertexAttribPointer(a,3,e.FLOAT,!1,n,0)),i>=0&&(e.enableVertexAttribArray(i),e.vertexAttribPointer(i,4,e.FLOAT,!1,n,12))}function Rf(e,t,n,r){const a=(e.species/6-.5)*.55,i=(e.charge-.5)*.85,s=Math.sin(e.age*.008+e.hue*.035+r*7e-4)*n;return(i+a+s)*t}function BC(e,t,n,r,a,i,s,c,l,d,u){let h=d;const m=6,f=Math.max(1,Math.min(m-1,s)),g=Math.max(1,Math.floor(t/700)),x=c?.55+l*.35:.25+(i.genes.memory??.5)*.35;for(let v=0;v<t&&!(h>=Du-m*2-4);v+=g){const b=e[v];if(b.role==="FLOW"||b.role==="MASK"||b.ink<.04)continue;const[w,M,k]=Af(b.hue,b.sat,Math.min(.9,b.lit+(c?.15:.05))),R=b.ink*b.alpha*x;if(!(R<.01))for(let j=0;j<f&&h<Du-2;j++){const I=(b.memIdx+(m-f+j))%m,E=(b.memIdx+(m-f+j+1))%m,O=b.memX[I],L=b.memY[I],$=b.memX[E],F=b.memY[E];if(Math.abs($-O)>.15||Math.abs(F-L)>.15)continue;const B=(O-.5)*2.2,W=(L-.5)*-2.2,re=($-.5)*2.2,oe=(F-.5)*-2.2,te=Rf(b,n,r,a),J=j/f,pe=(j+1)/f,P=R*J,V=R*pe;let fe=h*al;u[fe]=B,u[fe+1]=W,u[fe+2]=te,u[fe+3]=w,u[fe+4]=M,u[fe+5]=k,u[fe+6]=P,h++,fe=h*al,u[fe]=re,u[fe+1]=oe,u[fe+2]=te,u[fe+3]=w,u[fe+4]=M,u[fe+5]=k,u[fe+6]=V,h++}}return h}function xX(e,t,n,r,a,i,s){const l=Math.max(1,Math.floor(t/600));let d=0;for(let u=0;u<t-l&&d<Du-2;u+=l){const h=e[u],m=e[u+l],f=(h.x-.5)*2.2,g=(h.y-.5)*-2.2,x=(m.x-.5)*2.2,v=(m.y-.5)*-2.2,b=x-f,w=v-g;if(b*b+w*w>.1024)continue;const M=Rf(h,n,r,a),k=Rf(m,n,r,a),R=Math.sqrt(b*b+w*w),j=i*(1-R/.32)*.5,[I,E,O]=Af(h.hue,h.sat,h.lit),[L,$,F]=Af(m.hue,m.sat,m.lit);let B=d*al;s[B]=f,s[B+1]=g,s[B+2]=M,s[B+3]=I,s[B+4]=E,s[B+5]=O,s[B+6]=j,d++,B=d*al,s[B]=x,s[B+1]=v,s[B+2]=k,s[B+3]=L,s[B+4]=$,s[B+5]=F,s[B+6]=j*.6,d++}return d}function vX(e,t,n,r,a,i,s,c,l){let d=c;const u=Math.min(.92,s.shapeOpacity??.85),h=2.2/Math.max(1,i),m=s.shapeScale??1;for(let f=0;f<t&&!(d>=Du-w0*2-10);f++){const g=e[f];if(g.kind!=="line"&&g.kind!=="arc"&&g.kind!=="rect"&&g.kind!=="plane")continue;const x=(g.x-.5)*2.2,v=(g.y-.5)*-2.2,b=Rf(g,n,r,a),[w,M,k]=Af(g.hue,g.sat,Math.min(.95,g.lit+.12));if(g.kind==="line"){const R=g.angle??0,j=(g.length??40)*h*(g.qscale??1)*m,I=Math.cos(R)*j,E=Math.sin(R)*j;let O=d*al;l[O]=x-I,l[O+1]=v-E,l[O+2]=b,l[O+3]=w,l[O+4]=M,l[O+5]=k,l[O+6]=u,d++,O=d*al,l[O]=x+I,l[O+1]=v+E,l[O+2]=b,l[O+3]=w,l[O+4]=M,l[O+5]=k,l[O+6]=u*.7,d++}else if(g.kind==="arc"){const R=(g.length??24)*h*(g.qscale??1)*m,j=g.angle??0,I=Math.PI*1.5;for(let E=0;E<w0&&d<Du-2;E++){const O=E/w0,L=(E+1)/w0,$=j+O*I,F=j+L*I,B=u*(.65+.35*(1-O));let W=d*al;l[W]=x+Math.cos($)*R,l[W+1]=v+Math.sin($)*R,l[W+2]=b,l[W+3]=w,l[W+4]=M,l[W+5]=k,l[W+6]=B,d++,W=d*al,l[W]=x+Math.cos(F)*R,l[W+1]=v+Math.sin(F)*R,l[W+2]=b,l[W+3]=w,l[W+4]=M,l[W+5]=k,l[W+6]=B*.9,d++}}else if(g.kind==="rect"||g.kind==="plane"){const R=(g.qscale??1)*m*22*h,j=R*.65,I=g.angle??0,E=Math.cos(I),O=Math.sin(I),L=g.kind==="plane"?u*.6:u*.85,$=[x+E*R-O*j,x-E*R-O*j,x-E*R+O*j,x+E*R+O*j],F=[v+O*R+E*j,v-O*R+E*j,v-O*R-E*j,v+O*R-E*j];for(let B=0;B<4&&d<Du-2;B++){const W=(B+1)%4;let re=d*al;l[re]=$[B],l[re+1]=F[B],l[re+2]=b,l[re+3]=w,l[re+4]=M,l[re+5]=k,l[re+6]=L,d++,re=d*al,l[re]=$[W],l[re+1]=F[W],l[re+2]=b,l[re+3]=w,l[re+4]=M,l[re+5]=k,l[re+6]=L*.85,d++}}}return d}function SX(e,t,n,r,a,i,s,c){let l=0;const d=2.2/Math.max(1,i),u=s.shapeScale??1,h=Math.min(.88,s.shapeOpacity??.85),m=Math.max(.35,s.fillSolidity??.5),f=(g,x,v,b,w,M,k)=>{const R=l*Bv;c[R]=g,c[R+1]=x,c[R+2]=v,c[R+3]=b,c[R+4]=w,c[R+5]=M,c[R+6]=k,l++};for(let g=0;g<t&&!(l>=$v-w0*3-8);g++){const x=e[g];if(x.kind!=="arc"&&x.kind!=="rect"&&x.kind!=="plane")continue;const v=(x.x-.5)*2.2,b=(x.y-.5)*-2.2,w=Rf(x,n,r,a),[M,k,R]=Af(x.hue,x.sat,Math.min(.88,x.lit*.9+.05));if(x.kind==="arc"){const j=(x.length??24)*d*(x.qscale??1)*u,I=x.angle??0,E=Math.PI*1.5,O=h*m*.85;for(let L=0;L<w0&&l<$v-3;L++){const $=L/w0,F=(L+1)/w0,B=I+$*E,W=I+F*E,re=O*(.6+.4*(1-$));f(v,b,w,M,k,R,O),f(v+Math.cos(B)*j,b+Math.sin(B)*j,w,M,k,R,re),f(v+Math.cos(W)*j,b+Math.sin(W)*j,w,M,k,R,re*.9)}}else if(x.kind==="rect"||x.kind==="plane"){const j=(x.qscale??1)*u*22*d,I=j*.65,E=x.angle??0,O=Math.cos(E),L=Math.sin(E),$=x.kind==="plane"?h*m*.75:h*m*.55,F=v+O*j-L*I,B=b+L*j+O*I,W=v-O*j-L*I,re=b-L*j+O*I,oe=v-O*j+L*I,te=b-L*j-O*I,J=v+O*j+L*I,pe=b+L*j-O*I;f(F,B,w,M,k,R,$),f(W,re,w,M,k,R,$*.92),f(oe,te,w,M,k,R,$*.85),f(F,B,w,M,k,R,$),f(oe,te,w,M,k,R,$*.85),f(J,pe,w,M,k,R,$*.92)}}return l}function Af(e,t,n){const r=(1-Math.abs(2*n-1))*t,a=e/60%6,i=r*(1-Math.abs(a%2-1)),s=n-r/2,c=Math.floor(a)%6;let l=0,d=0,u=0;return c===0?(l=r,d=i):c===1?(l=i,d=r):c===2?(d=r,u=i):c===3?(d=i,u=r):c===4?(l=i,u=r):(l=r,u=i),[l+s,d+s,u+s]}function wX(e){const t=e.replace("#","");return t.length<6?[.02,.02,.04]:[parseInt(t.slice(0,2),16)/255,parseInt(t.slice(2,4),16)/255,parseInt(t.slice(4,6),16)/255]}function _p(e,t,n){return e<t?t:e>n?n:e}function $C(e){return _p(e,-Math.PI*.45,Math.PI*.45)}function qC(e){const t=e.touches[0].clientX-e.touches[1].clientX,n=e.touches[0].clientY-e.touches[1].clientY;return Math.sqrt(t*t+n*n)}const rx=["L","Sh","Fl","Ex","Mg","Gl"],ox=["luminous","shadowed","flowing","expander","magnetic","glitch"],ax=["#ffd060","#7090d0","#40c8ff","#c060ff","#ff7040","#40ff90"],i5=[-.8,-.5,-.2,0,.2,.5,.8];function MX(e){const t=Math.max(-1,Math.min(1,e));if(t>.02){const n=t;return`rgba(${Math.round(20+n*12)},${Math.round(155+n*90)},${Math.round(50+n*15)},${(.28+n*.55).toFixed(2)})`}else if(t<-.02){const n=-t;return`rgba(${Math.round(160+n*85)},${Math.round(20+n*10)},${Math.round(20+n*8)},${(.28+n*.58).toFixed(2)})`}return"rgba(50,50,60,0.4)"}function CX(e){return`rgba(255,255,255,${(.4+Math.abs(Math.max(-1,Math.min(1,e)))*.5).toFixed(2)})`}function kX({matrix:e,onCellChange:t,onRandomize:n,onSymmetrize:r,onReset:a,onPreset:i}){const s=S.useRef(null),c=S.useCallback((b,w,M)=>{b.currentTarget.setPointerCapture(b.pointerId),s.current={i:w,j:M,startY:b.clientY,startVal:e[w*6+M]??0,moved:!1},b.preventDefault()},[e]),l=S.useCallback(b=>{if(!s.current)return;const w=s.current.startY-b.clientY;Math.abs(w)>3&&(s.current.moved=!0);const M=Math.max(-1,Math.min(1,s.current.startVal+w*.013));t(s.current.i,s.current.j,M)},[t]),d=S.useCallback(b=>{if(s.current&&!s.current.moved){const{i:w,j:M}=s.current,k=e[w*6+M]??0,j=(i5.reduce((I,E,O)=>Math.abs(E-k)<Math.abs(i5[I]-k)?O:I,0)+1)%i5.length;t(w,M,i5[j])}s.current=null},[e,t]),u="'IBM Plex Mono', monospace",h="#ff0084",m="rgba(255,255,255,0.28)",f="rgba(255,255,255,0.06)",g={padding:"12px 14px",display:"flex",flexDirection:"column",gap:10,fontFamily:u,color:"rgba(255,255,255,0.75)",overflowY:"auto",background:"#000"},x={fontSize:7,color:m,letterSpacing:"0.12em",textTransform:"uppercase",fontFamily:u},v={flex:1,padding:"4px 0",borderRadius:1,cursor:"pointer",fontSize:7,fontFamily:u,letterSpacing:"0.1em",background:"rgba(255,255,255,0.02)",border:`1px solid ${f}`,color:"rgba(255,255,255,0.5)",textTransform:"uppercase"};return o.jsxs("div",{style:g,children:[o.jsx("div",{style:{fontSize:8,color:h,letterSpacing:"0.16em",textTransform:"uppercase",fontWeight:400,fontFamily:u},children:"INTERACTION MATRIX"}),o.jsxs("div",{style:{fontSize:7,color:m,lineHeight:1.6,fontFamily:u},children:["Linha  emissora  Coluna  alvo",o.jsx("br",{}),o.jsx("span",{style:{color:"rgba(80,200,80,0.55)"},children:"verde = atrao"}),"  ",o.jsx("span",{style:{color:"rgba(220,80,80,0.55)"},children:"vermelho = repulso"}),o.jsx("br",{}),"Click = cicla  Drag  = contnuo"]}),o.jsxs("div",{children:[o.jsx("div",{style:{display:"flex",marginLeft:22,marginBottom:2},children:rx.map((b,w)=>o.jsx("div",{style:{flex:1,textAlign:"center",fontSize:7,fontFamily:"monospace",color:ax[w],letterSpacing:"0.04em"},children:b},w))}),Array.from({length:6},(b,w)=>o.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:1},children:[o.jsx("div",{style:{width:20,flexShrink:0,fontSize:7,fontFamily:"monospace",color:ax[w],textAlign:"right",paddingRight:2,letterSpacing:"0.04em"},children:rx[w]}),Array.from({length:6},(M,k)=>{const R=e[w*6+k]??0;return o.jsx("div",{style:{flex:1,height:25,marginLeft:1,background:MX(R),borderRadius:2,border:`1px solid rgba(255,255,255,${w===k?.28:.06})`,cursor:"ns-resize",display:"flex",alignItems:"center",justifyContent:"center",userSelect:"none",WebkitUserSelect:"none",fontSize:6,fontFamily:"monospace",color:CX(R),outline:w===k?"1px solid rgba(255,255,255,0.18)":"none",outlineOffset:"-2px"},onPointerDown:j=>c(j,w,k),onPointerMove:l,onPointerUp:d,title:`${ox[w]}  ${ox[k]}: ${R.toFixed(3)}`,children:R.toFixed(1)},k)})]},w))]}),o.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[o.jsxs("div",{style:{display:"flex",gap:3,alignItems:"center"},children:[o.jsx("div",{style:{width:10,height:6,borderRadius:1,background:"rgba(200,40,40,0.65)"}}),o.jsx("span",{style:{...x,color:"rgba(220,100,100,0.5)"},children:"repuls."})]}),o.jsxs("div",{style:{display:"flex",gap:3,alignItems:"center"},children:[o.jsx("div",{style:{width:10,height:6,borderRadius:1,background:"rgba(50,60,55,0.8)"}}),o.jsx("span",{style:{...x,color:"rgba(150,150,150,0.4)"},children:"neutro"})]}),o.jsxs("div",{style:{display:"flex",gap:3,alignItems:"center"},children:[o.jsx("div",{style:{width:10,height:6,borderRadius:1,background:"rgba(20,190,70,0.65)"}}),o.jsx("span",{style:{...x,color:"rgba(100,220,120,0.5)"},children:"atrao"})]})]}),o.jsxs("div",{children:[o.jsx("div",{style:{...x,marginBottom:5},children:"Utilitrios"}),o.jsxs("div",{style:{display:"flex",gap:3},children:[o.jsx("button",{onClick:n,style:v,title:"Gerar nova matriz aleatria",children:"Rand"}),o.jsx("button",{onClick:r,style:v,title:"Tornar a matriz simtrica (mdia AB)",children:"Sim"}),o.jsx("button",{onClick:a,style:{...v,color:"rgba(180,160,255,0.65)"},title:"Restaurar matriz calculada a partir do DNA atual",children:"DNA"})]})]}),o.jsxs("div",{children:[o.jsx("div",{style:{...x,marginBottom:5},children:"Dinmicas Pr-Definidas"}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:3},children:[{id:"chaos",icon:"",label:"Caos",desc:"repulso entre todas as espcies"},{id:"harmony",icon:"",label:"Harmonia",desc:"atrao global  grande mistura"},{id:"predator",icon:"",label:"Predador",desc:"cadeia assimtrica 012 0"},{id:"bubbles",icon:"",label:"Bolhas",desc:"self+  cross  agrupa por espcie"}].map(({id:b,icon:w,label:M,desc:k})=>o.jsxs("button",{onClick:()=>i(b),style:{textAlign:"left",padding:"5px 8px",borderRadius:4,cursor:"pointer",background:"rgba(80,100,160,0.07)",border:"1px solid rgba(100,120,200,0.15)",color:"rgba(200,210,255,0.75)",fontSize:8,width:"100%"},children:[o.jsx("span",{style:{marginRight:5,opacity:.6},children:w}),o.jsx("span",{style:{fontWeight:600},children:M}),o.jsxs("span",{style:{marginLeft:5,color:"rgba(255,255,255,0.3)",fontSize:7},children:[" ",k]})]},b))})]}),o.jsxs("div",{children:[o.jsx("div",{style:{...x,marginBottom:5},children:"Espcies"}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:3},children:rx.map((b,w)=>o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[o.jsx("div",{style:{width:7,height:7,borderRadius:"50%",flexShrink:0,background:ax[w]}}),o.jsxs("span",{style:{fontSize:7,fontFamily:"monospace",color:"rgba(255,255,255,0.3)"},children:[b,"  ",ox[w]]})]},w))})]})]})}const bf="'IBM Plex Mono', monospace",sx="#ff0084",ld="rgba(255,255,255,0.28)",Fh="rgba(255,255,255,0.06)",jc={fontSize:7,color:ld,letterSpacing:"0.12em",textTransform:"uppercase",marginBottom:1,fontFamily:bf},RX={padding:"12px 14px",display:"flex",flexDirection:"column",gap:8,fontFamily:bf,color:"rgba(255,255,255,0.75)",overflowY:"auto",background:"#000"},HC=[{key:"structure",label:"Structure",desc:"organic  geometric"},{key:"flow",label:"Flow",desc:"static  dynamic"},{key:"entropy",label:"Entropy",desc:"order  chaos"},{key:"memory",label:"Memory",desc:"ephemeral  persistent"},{key:"contrast",label:"Contrast",desc:"soft  hard"},{key:"symmetry",label:"Symmetry",desc:"none  radial"},{key:"glyphness",label:"Glyphness",desc:"none  saturated"},{key:"erosion",label:"Erosion",desc:"accumulate  erode"},{key:"layering",label:"Layering",desc:"flat  deep"},{key:"rhythm",label:"Rhythm",desc:"continuous  staccato"},{key:"fragmentation",label:"Fragmentation",desc:"unified  fragmented"},{key:"coherence",label:"Coherence",desc:"noise  coherent"},{key:"linear",label:"Linear",desc:"curves  retas (rizoma)"},{key:"isolation",label:"Isolation",desc:"interao total  espcies isoladas"}],AX=["none","ascension","gravity","conflict","harmony","ecstasy","silence","mondrian","suprematist","action","minimal","glitch","botanical","constellation"];function ed({name:e,val:t,min:n,max:r,step:a,color:i="#60b0ff",fmt:s,onChange:c}){return o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[o.jsx("span",{style:{...jc,width:72,marginBottom:0,textAlign:"right"},children:e}),o.jsx("input",{type:"range",min:n,max:r,step:a,value:t,onChange:l=>c(parseFloat(l.target.value)),style:{flex:1,cursor:"pointer",accentColor:i}}),o.jsx("span",{style:{fontSize:7,color:ld,fontFamily:bf,minWidth:32,textAlign:"right"},children:s?s(t):t.toFixed(2)})]})}function jX({name:e,val:t,color:n="#ff8060",onChange:r}){return o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:6},children:[o.jsx("span",{style:{...jc,marginBottom:0,width:72,textAlign:"right"},children:e}),o.jsx("button",{onClick:()=>r(!t),style:{flex:1,fontSize:8,padding:"3px 0",borderRadius:3,cursor:"pointer",background:t?`${n}22`:"rgba(255,255,255,0.04)",border:`1px solid ${t?`${n}55`:"rgba(255,255,255,0.1)"}`,color:t?n:"rgba(255,255,255,0.28)",fontFamily:"monospace"},children:t?" ON":" OFF"})]})}const EX=({physics:e,dna:t,onPhysics:n,onDNAGene:r,onDNAChange:a,onMutate:i,pinnedDNA:s})=>{const c=e,[l,d]=S.useState({interaction:!0,genes:!0,spatial:!1,quadrants:!1,dna:!0,presets:!1}),[u,h]=S.useState(new Set),m=v=>d(b=>({...b,[v]:!b[v]})),f=v=>{h(b=>{const w=new Set(b);return w.has(v)?w.delete(v):w.add(v),w})},g=()=>{const v={...t.genes};for(const{key:b}of HC)!u.has(b)&&b!=="linear"&&(v[b]=Math.random());a({...t,genes:v})},x=({id:v,title:b,children:w})=>o.jsxs("div",{style:{border:`1px solid ${Fh}`,borderRadius:3,overflow:"hidden"},children:[o.jsxs("button",{onClick:()=>m(v),style:{width:"100%",textAlign:"left",cursor:"pointer",background:"rgba(255,255,255,0.02)",border:"none",color:"rgba(255,255,255,0.65)",fontSize:8,letterSpacing:"0.12em",textTransform:"uppercase",fontFamily:bf,padding:"7px 8px"},children:[l[v]?" ":" ",b]}),l[v]&&o.jsx("div",{style:{padding:"8px"},children:w})]});return o.jsxs("div",{style:RX,children:[o.jsx("div",{style:{fontSize:8,color:sx,letterSpacing:"0.16em",textTransform:"uppercase",fontWeight:400,fontFamily:bf},children:"PHYSICS & BEHAVIOR"}),o.jsxs(x,{id:"interaction",title:"Interao",children:[o.jsx("div",{style:{...jc,color:"rgba(100,180,255,0.6)",marginBottom:3},children:"Interao PL"}),o.jsx(ed,{name:"Raio Max",val:c.rMaxMul,min:.3,max:3,step:.05,color:"#60b0ff",fmt:v=>v.toFixed(2)+"x",onChange:v=>n({rMaxMul:v})}),o.jsx(ed,{name:"Raio Min",val:c.rMinMul,min:.3,max:3,step:.05,color:"#80c0ff",fmt:v=>v.toFixed(2)+"x",onChange:v=>n({rMinMul:v})}),o.jsx(ed,{name:"Fora",val:c.forceMul,min:.05,max:5,step:.05,color:"#ff9060",fmt:v=>v.toFixed(2)+"x",onChange:v=>n({forceMul:v})}),o.jsx(ed,{name:"Amortec.",val:c.dampingMul,min:.3,max:1.5,step:.02,color:"#a0d0ff",fmt:v=>v.toFixed(2)+"x",onChange:v=>n({dampingMul:v})}),o.jsx(ed,{name:"Velocidade",val:c.maxSpeedMul,min:.1,max:5,step:.05,color:"#60ffa0",fmt:v=>v.toFixed(2)+"x",onChange:v=>n({maxSpeedMul:v})}),o.jsx(ed,{name:"Rudo",val:c.noiseMul,min:0,max:5,step:.05,color:"#ffaa60",fmt:v=>v.toFixed(2)+"x",onChange:v=>n({noiseMul:v})})]}),o.jsx(x,{id:"genes",title:"Genes",children:o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:6},children:HC.map(({key:v,label:b,desc:w})=>{const M=u.has(v);return o.jsxs("div",{children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:2},children:[o.jsx("button",{onClick:()=>f(v),style:{border:"none",background:"none",cursor:"pointer",color:M?sx:ld,fontSize:8,fontFamily:bf,padding:0},children:M?"":""}),o.jsx("span",{style:{...jc,marginBottom:0,flex:1},children:b}),o.jsx("span",{style:{fontSize:7,color:ld},children:(t.genes[v]??0).toFixed(2)})]}),o.jsx("input",{type:"range",min:0,max:1,step:.01,disabled:M,value:t.genes[v]??0,onChange:k=>r(v,parseFloat(k.target.value)),style:{width:"100%",cursor:M?"not-allowed":"pointer",accentColor:"#c0a0ff",opacity:M?.4:1}}),o.jsx("div",{style:{fontSize:7,color:"rgba(255,255,255,0.18)",marginTop:1},children:w})]},v)})})}),o.jsxs(x,{id:"spatial",title:"Espacial",children:[o.jsx("div",{style:{...jc,color:"rgba(120,220,160,0.6)",marginBottom:3},children:"Espacial"}),o.jsx(ed,{name:"Atrao Centro",val:c.centerPull,min:0,max:1,step:.02,color:"#60ffa0",fmt:v=>v.toFixed(2),onChange:v=>n({centerPull:v})}),o.jsx(ed,{name:"Rep. Borda",val:c.borderRepulsion,min:0,max:1,step:.02,color:"#ff8060",fmt:v=>v.toFixed(2),onChange:v=>n({borderRepulsion:v})})]}),o.jsxs(x,{id:"quadrants",title:"Quadrantes",children:[o.jsx("div",{style:{...jc,color:"rgba(255,180,80,0.6)",marginBottom:3},children:"Quadrantes"}),o.jsx(jX,{name:"Modo Quad.",val:c.quadrantMode,color:"#ffaa40",onChange:v=>n({quadrantMode:v})}),c.quadrantMode&&o.jsx(ed,{name:"Fora Quad.",val:c.quadrantStrength,min:0,max:1,step:.02,color:"#ffaa40",fmt:v=>v.toFixed(2),onChange:v=>n({quadrantStrength:v})}),c.quadrantMode&&o.jsxs("div",{style:{fontSize:7,color:"rgba(255,180,80,0.4)",lineHeight:1.5,background:"rgba(255,140,0,0.06)",borderRadius:4,padding:"5px 8px"},children:[o.jsx("b",{children:"Esp. 0"}),"   TL  ",o.jsx("b",{children:"1"}),"   TR  ",o.jsx("b",{children:"2"}),"   BL",o.jsx("br",{}),o.jsx("b",{children:"3"}),"   BR  ",o.jsx("b",{children:"4"}),"   Top  ",o.jsx("b",{children:"5"}),"   Bot",o.jsx("br",{}),"Combine com Isolamento > 0.5 para segregao total."]})]}),o.jsxs(x,{id:"dna",title:"DNA / Recipe",children:[o.jsx("div",{style:{...jc,marginBottom:5},children:"Intention"}),o.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:3,marginBottom:8},children:AX.map(v=>o.jsx("button",{onClick:()=>a(YY(t,v)),style:{padding:"2px 6px",borderRadius:2,cursor:"pointer",fontSize:7,textTransform:"capitalize",border:`1px solid ${t.intention===v?"rgba(255,0,132,0.45)":Fh}`,background:t.intention===v?"rgba(255,0,132,0.08)":"transparent",color:t.intention===v?"rgba(255,255,255,0.85)":ld},children:v},v))}),o.jsx("div",{style:{...jc,marginBottom:3},children:"Quanta"}),o.jsx("input",{type:"range",min:0,max:3e3,step:1,value:t.quantaCount,onChange:v=>a({...t,quantaCount:parseInt(v.target.value,10)}),style:{width:"100%",cursor:"pointer",accentColor:sx,marginBottom:6}}),o.jsx("div",{style:{...jc,marginBottom:3},children:"Palette"}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,marginBottom:8,flexWrap:"wrap"},children:[t.palette.map((v,b)=>o.jsx("input",{type:"color",value:v,onChange:w=>{const M=[...t.palette];M[b]=w.target.value,a({...t,palette:M})},style:{width:20,height:20,padding:0,border:"none",cursor:"pointer",background:"none"}},b)),o.jsx("input",{type:"color",value:t.background,onChange:v=>a({...t,background:v.target.value}),style:{width:20,height:20,padding:0,border:"none",cursor:"pointer",background:"none"}}),o.jsx("button",{onClick:()=>a({...t,palette:Sy(t.palette.length)}),style:{padding:"2px 6px",borderRadius:2,cursor:"pointer",fontSize:7,border:`1px solid ${Fh}`,background:"rgba(255,255,255,0.03)",color:ld},children:"RAND"})]}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[o.jsx("button",{onClick:g,style:{padding:"5px 7px",textAlign:"left",borderRadius:2,cursor:"pointer",border:`1px solid ${Fh}`,background:"rgba(255,255,255,0.03)",color:ld,fontSize:8},children:"Randomize Genes"}),o.jsx("button",{onClick:()=>i(M6(t,.28,8)),style:{padding:"5px 7px",textAlign:"left",borderRadius:2,cursor:"pointer",border:`1px solid ${Fh}`,background:"rgba(255,255,255,0.03)",color:ld,fontSize:8},children:"Mutate (8 variants)"}),o.jsxs("button",{disabled:!s,onClick:()=>s&&a(jK(t,s)),style:{padding:"5px 7px",textAlign:"left",borderRadius:2,cursor:s?"pointer":"not-allowed",border:`1px solid ${Fh}`,background:"rgba(255,255,255,0.03)",color:s?ld:"rgba(255,255,255,0.15)",fontSize:8},children:["Crossbreed ",s?`+ ${(s.name??"pinned").slice(0,12)}`:"(pin first)"]})]})]}),o.jsxs(x,{id:"presets",title:"Presets Rpidos",children:[o.jsx("div",{style:{...jc,marginBottom:6,color:"rgba(255,255,255,0.35)"},children:"Presets Rpidos"}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[{name:"Equilibrado",desc:"Fsica neutra, boa para explorar",apply:()=>n({rMaxMul:1,forceMul:1,dampingMul:1,noiseMul:1,maxSpeedMul:1,rMinMul:1,borderRepulsion:.25,centerPull:0})},{name:"Atrao Lenta",desc:"Clusters lentos e estveis",apply:()=>n({rMaxMul:1.5,forceMul:.5,dampingMul:1.3,noiseMul:.3,maxSpeedMul:.4,rMinMul:.8,borderRepulsion:.4})},{name:"Explosivo",desc:"Agentes rpidos e caticos",apply:()=>n({rMaxMul:.8,forceMul:3,dampingMul:.7,noiseMul:2.5,maxSpeedMul:3.5,rMinMul:1.2,borderRepulsion:.3})},{name:"Bolhas",desc:"Espcies em clusters segregados",apply:()=>n({rMaxMul:1.2,forceMul:1.8,dampingMul:1.1,noiseMul:.5,maxSpeedMul:.8,rMinMul:.6,borderRepulsion:.5,centerPull:.2})},{name:"Quadrantes ON",desc:"Cada espcie no seu territrio",apply:()=>n({quadrantMode:!0,quadrantStrength:.7,borderRepulsion:.4})}].map(v=>o.jsxs("button",{onClick:v.apply,style:{textAlign:"left",padding:"5px 7px",borderRadius:4,cursor:"pointer",background:"rgba(60,120,200,0.07)",border:"1px solid rgba(80,150,255,0.15)",color:"rgba(180,210,255,0.8)",fontSize:8},children:[o.jsx("div",{style:{fontWeight:600,marginBottom:1},children:v.name}),o.jsx("div",{style:{fontSize:7,color:"rgba(255,255,255,0.3)"},children:v.desc})]},v.name))})]})]})},TX=["Luminoso","Sombra","Fluxo","Expanso","Magntico","Glitch"],IX=[{id:"circle",icon:"",label:"Ponto"},{id:"brush",icon:"",label:"Pincel"},{id:"square",icon:"",label:"Quad."},{id:"diamond",icon:"",label:"Diam."},{id:"triangle",icon:"",label:"Tri."},{id:"star",icon:"",label:"Estrela"}],PX={padding:"12px 14px",display:"flex",flexDirection:"column",gap:10,fontFamily:"'IBM Plex Mono', monospace",color:"rgba(255,255,255,0.75)",overflowY:"auto",background:"#000"},Ns={fontSize:7,color:"rgba(255,255,255,0.28)",letterSpacing:"0.14em",textTransform:"uppercase",marginBottom:5,fontFamily:"'IBM Plex Mono', monospace"};function yl({icon:e,label:t,color:n,desc:r,onClick:a}){return o.jsxs("button",{onClick:a,title:r,style:{flex:1,padding:"7px 4px",borderRadius:4,cursor:"pointer",border:`1px solid ${n}33`,background:`${n}11`,color:`${n}cc`,fontSize:8,letterSpacing:"0.06em",textTransform:"uppercase",display:"flex",flexDirection:"column",alignItems:"center",gap:3,transition:"all 0.1s"},onMouseEnter:i=>i.currentTarget.style.background=`${n}22`,onMouseLeave:i=>i.currentTarget.style.background=`${n}11`,children:[o.jsx("span",{style:{fontSize:14},children:e}),o.jsx("span",{children:t})]})}const FX=({dna:e,palette:t,onRecolorSpecies:n,onRandomPalette:r,onSetAllShape:a,brushTextureId:i,onBrushTexture:s,onDNAGene:c,onChaosInject:l,onFreezeAll:d,onPulseAll:u,onScatterAll:h,onShockAll:m,onMagnetizeAll:f,onImplodeAll:g,onTurboAll:x,onHueRotate:v,onSatShift:b,onLitShift:w,onSizeAll:M,onRespawn:k,guideStroke:R,guideCurvature:j,guideColor:I,guideLineMode:E,guidePathMode:O,autoGuidesPreset:L,autoGuidesRandom:$,onGuideStroke:F,onGuideCurvature:B,onGuideColor:W,onGuideLineMode:re,onGuidePathMode:oe,onGuideClear:te,onGuideGenerate:J,onGuideStyleRandom:pe,onToggleAutoGuidesPreset:P,onToggleAutoGuidesRandom:V,onExplodeAll:fe,onBlackHoleAll:ye,onHarmonizeAll:Se,onVortexAll:we,onRepelAll:ke,onAttractAll:De,onCalmAll:_e,onFluxAll:ae,onActivateBrush:Re})=>{const[Fe,Oe]=S.useState(30),[ne,nt]=S.useState(2.4),[pt,Et]=S.useState(2.8),_t=Xe=>Re(Xe,ne,190),Ct=Xe=>Re(Xe,pt,220);return o.jsxs("div",{style:PX,children:[o.jsx("div",{style:{fontSize:8,color:"#ff0084",letterSpacing:"0.16em",textTransform:"uppercase",fontWeight:400,fontFamily:"'IBM Plex Mono', monospace"},children:"POWERS & INTERVENTIONS"}),o.jsxs("div",{children:[o.jsx("div",{style:Ns,children:"Intervenes Rpidas"}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:6},children:[o.jsx("span",{style:{...Ns,marginBottom:0,minWidth:70},children:"Fora"}),o.jsx("input",{type:"range",min:1.4,max:5,step:.1,value:ne,onChange:Xe=>nt(parseFloat(Xe.target.value)),style:{flex:1,cursor:"pointer",accentColor:"#ff7a60"}}),o.jsxs("span",{style:{fontSize:8,color:"rgba(255,255,255,0.45)",minWidth:28},children:[ne.toFixed(1),"x"]})]}),o.jsxs("div",{style:{display:"flex",gap:4,flexWrap:"wrap"},children:[o.jsx(yl,{icon:"",label:"Caos",color:"#ff6040",desc:"Injeta entropia mxima por 2s",onClick:()=>{l(ne),_t("burst")}}),o.jsx(yl,{icon:"",label:"Freeze",color:"#60c0ff",desc:"Congela todos os agentes",onClick:()=>{d(ne),_t("freeze")}}),o.jsx(yl,{icon:"",label:"Pulso",color:"#ffd060",desc:"Exploso de velocidade em todos",onClick:()=>{u(ne),_t("burst")}}),o.jsx(yl,{icon:"",label:"Scatter",color:"#c060ff",desc:"Disperso centrfuga",onClick:()=>{h(ne),_t("scatter_burst")}}),o.jsx(yl,{icon:"",label:"Shock",color:"#60d0ff",desc:"Onda de choque em anel",onClick:()=>{m(ne),_t("channel")}}),o.jsx(yl,{icon:"",label:"Magnet",color:"#80ffb0",desc:"Magnetiza trajetrias",onClick:()=>{f(ne),_t("attract")}}),o.jsx(yl,{icon:"",label:"Implode",color:"#b080ff",desc:"Colapso para o centro",onClick:()=>{g(ne),_t("black_hole")}}),o.jsx(yl,{icon:"",label:"Turbo",color:"#ffb060",desc:"Impulso de velocidade global",onClick:()=>{x(ne),_t("burst")}}),o.jsx(yl,{icon:"",label:"Respawn",color:"#60ff90",desc:"Respawna com novo padro",onClick:k})]})]}),o.jsxs("div",{children:[o.jsx("div",{style:Ns,children:"Fora Live"}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:6},children:[o.jsx("span",{style:{...Ns,marginBottom:0,minWidth:70},children:"Fora"}),o.jsx("input",{type:"range",min:1.6,max:6,step:.1,value:pt,onChange:Xe=>Et(parseFloat(Xe.target.value)),style:{flex:1,cursor:"pointer",accentColor:"#ff55b0"}}),o.jsxs("span",{style:{fontSize:8,color:"rgba(255,255,255,0.45)",minWidth:28},children:[pt.toFixed(1),"x"]})]}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:4},children:[o.jsx("button",{onClick:()=>{fe(pt),Ct("burst")},style:{padding:"6px 4px",borderRadius:3,cursor:"pointer",border:"1px solid rgba(255,140,120,0.35)",background:"rgba(255,110,80,0.12)",color:"#ffb09a",fontSize:8,textTransform:"uppercase"},children:"Explodir"}),o.jsx("button",{onClick:()=>{ye(pt),Ct("black_hole")},style:{padding:"6px 4px",borderRadius:3,cursor:"pointer",border:"1px solid rgba(180,120,255,0.35)",background:"rgba(160,80,255,0.14)",color:"#d3b2ff",fontSize:8,textTransform:"uppercase"},children:"Buraco"}),o.jsx("button",{onClick:()=>{Se(pt),Ct("freeze")},style:{padding:"6px 4px",borderRadius:3,cursor:"pointer",border:"1px solid rgba(120,220,170,0.35)",background:"rgba(80,190,140,0.12)",color:"#a8e7c9",fontSize:8,textTransform:"uppercase"},children:"Harmonia"}),o.jsx("button",{onClick:()=>{we(pt),Ct("vortex")},style:{padding:"6px 4px",borderRadius:3,cursor:"pointer",border:"1px solid rgba(120,190,255,0.35)",background:"rgba(80,140,255,0.12)",color:"#b9d4ff",fontSize:8,textTransform:"uppercase"},children:"Vrtice"}),o.jsx("button",{onClick:()=>{ke(pt),Ct("repel")},style:{padding:"6px 4px",borderRadius:3,cursor:"pointer",border:"1px solid rgba(255,160,120,0.35)",background:"rgba(255,120,80,0.12)",color:"#ffc2a8",fontSize:8,textTransform:"uppercase"},children:"Repelir"}),o.jsx("button",{onClick:()=>{De(pt),Ct("attract")},style:{padding:"6px 4px",borderRadius:3,cursor:"pointer",border:"1px solid rgba(120,220,255,0.35)",background:"rgba(80,180,255,0.12)",color:"#b6e3ff",fontSize:8,textTransform:"uppercase"},children:"Atrair"}),o.jsx("button",{onClick:()=>{_e(pt),Ct("freeze")},style:{padding:"6px 4px",borderRadius:3,cursor:"pointer",border:"1px solid rgba(160,220,180,0.35)",background:"rgba(120,200,150,0.12)",color:"#c0f0d2",fontSize:8,textTransform:"uppercase"},children:"Calma"}),o.jsx("button",{onClick:()=>{ae(pt),Ct("channel")},style:{padding:"6px 4px",borderRadius:3,cursor:"pointer",border:"1px solid rgba(220,160,255,0.35)",background:"rgba(200,120,255,0.12)",color:"#e0c5ff",fontSize:8,textTransform:"uppercase"},children:"Fluxo"})]})]}),o.jsxs("div",{children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},children:[o.jsx("span",{style:Ns,children:"Cor por Espcie"}),o.jsx("button",{onClick:r,style:{fontSize:8,padding:"2px 8px",borderRadius:3,cursor:"pointer",border:"1px solid rgba(255,200,100,0.3)",background:"rgba(255,200,100,0.08)",color:"rgba(255,210,120,0.8)",letterSpacing:"0.06em",textTransform:"uppercase"},children:" Rand"})]}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:5},children:TX.map((Xe,Ut)=>{const Le=t[Ut%t.length]??"#888888";return o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[o.jsx("div",{style:{width:8,height:8,borderRadius:"50%",background:Le,flexShrink:0,border:"1px solid rgba(255,255,255,0.15)"}}),o.jsxs("span",{style:{fontSize:8,color:"rgba(255,255,255,0.45)",flex:1},children:[Ut," ",Xe]}),o.jsx("input",{type:"color",value:Le.startsWith("#")?Le:"#888888",onChange:Ke=>n(Ut,Ke.target.value),style:{width:28,height:20,padding:0,border:"1px solid rgba(255,255,255,0.15)",borderRadius:3,cursor:"pointer",background:"none"}})]},Ut)})})]}),o.jsxs("div",{children:[o.jsx("div",{style:Ns,children:"Rotao de Matiz (Todos)"}),o.jsxs("div",{style:{display:"flex",gap:5,alignItems:"center"},children:[o.jsx("input",{type:"range",min:0,max:180,step:5,value:Fe,onChange:Xe=>Oe(parseInt(Xe.target.value)),style:{flex:1,cursor:"pointer",accentColor:"#ff80c0"}}),o.jsxs("span",{style:{fontSize:8,color:"rgba(255,255,255,0.4)",fontFamily:"monospace",minWidth:30},children:["+",Fe,""]}),o.jsx("button",{onClick:()=>v(Fe),style:{padding:"4px 10px",borderRadius:3,cursor:"pointer",border:"1px solid rgba(255,100,180,0.3)",background:"rgba(255,100,180,0.1)",color:"rgba(255,150,200,0.9)",fontSize:8,letterSpacing:"0.06em",textTransform:"uppercase"},children:"Apply"})]}),o.jsx("div",{style:{display:"flex",gap:4,marginTop:4,flexWrap:"wrap"},children:[15,30,60,90,120,180].map(Xe=>o.jsxs("button",{onClick:()=>v(Xe),style:{padding:"3px 7px",borderRadius:3,cursor:"pointer",fontSize:7,border:"1px solid rgba(255,255,255,0.1)",background:"rgba(255,255,255,0.04)",color:"rgba(255,255,255,0.5)"},children:["+",Xe,""]},Xe))})]}),o.jsxs("div",{children:[o.jsx("div",{style:Ns,children:"Luminncia & Saturao"}),o.jsx("div",{style:{display:"flex",gap:4},children:[{icon:"",label:"-Sat",color:"#8080a0",onClick:()=>b(-.15)},{icon:"",label:"+Sat",color:"#ff80ff",onClick:()=>b(.15)},{icon:"",label:"-Lit",color:"#404060",onClick:()=>w(-.1)},{icon:"",label:"+Lit",color:"#ffe060",onClick:()=>w(.1)}].map(Xe=>o.jsxs("button",{onClick:Xe.onClick,style:{flex:1,padding:"5px 2px",borderRadius:3,cursor:"pointer",border:`1px solid ${Xe.color}33`,background:`${Xe.color}11`,color:`${Xe.color}cc`,fontSize:7,letterSpacing:"0.04em",display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:[o.jsx("span",{style:{fontSize:12},children:Xe.icon}),o.jsx("span",{style:{textTransform:"uppercase"},children:Xe.label})]},Xe.label))})]}),o.jsxs("div",{children:[o.jsx("div",{style:Ns,children:"Tamanho Global"}),o.jsx("div",{style:{display:"flex",gap:4},children:[{label:"0.5",mul:.5},{label:"0.75",mul:.75},{label:"1.25",mul:1.25},{label:"2",mul:2}].map(Xe=>o.jsx("button",{onClick:()=>M(Xe.mul),style:{flex:1,padding:"5px 2px",borderRadius:3,cursor:"pointer",border:"1px solid rgba(255,255,255,0.1)",background:"rgba(255,255,255,0.04)",color:"rgba(255,255,255,0.55)",fontSize:8,fontFamily:"monospace"},children:Xe.label},Xe.label))})]}),o.jsxs("div",{children:[o.jsx("div",{style:Ns,children:"Forma Global"}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:3},children:IX.map(Xe=>o.jsxs("button",{onClick:()=>a(Xe.id),style:{padding:"5px 3px",borderRadius:3,cursor:"pointer",border:"1px solid rgba(255,255,255,0.1)",background:"rgba(255,255,255,0.04)",color:"rgba(255,255,255,0.6)",fontSize:8,display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:[o.jsx("span",{style:{fontSize:13},children:Xe.icon}),o.jsx("span",{style:{fontSize:6,letterSpacing:"0.04em",textTransform:"uppercase"},children:Xe.label})]},Xe.id))})]}),o.jsxs("div",{children:[o.jsx("div",{style:Ns,children:"Textura do Pincel (Global)"}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:3},children:Vp.map(Xe=>{const Ut=i===Xe.id;return o.jsxs("button",{onClick:()=>s(Xe.id),title:Xe.label,style:{padding:"4px 2px",borderRadius:3,cursor:"pointer",background:Ut?"rgba(255,200,80,0.16)":"rgba(255,255,255,0.03)",border:`1px solid ${Ut?"rgba(255,200,80,0.4)":"rgba(255,255,255,0.07)"}`,color:Ut?"rgba(255,210,100,0.9)":"rgba(255,255,255,0.35)",fontSize:7,display:"flex",flexDirection:"column",alignItems:"center",gap:1},children:[o.jsx("span",{style:{fontSize:11,lineHeight:1},children:Xe.emoji}),o.jsx("span",{style:{fontSize:5,textTransform:"uppercase",letterSpacing:"0.03em"},children:Xe.label})]},Xe.id)})})]}),o.jsxs("div",{children:[o.jsx("div",{style:Ns,children:"Guide Powers"}),o.jsxs("div",{style:{display:"flex",gap:4,flexWrap:"wrap",marginBottom:6},children:[o.jsx(yl,{icon:"",label:"Gerar",color:"#60b0ff",desc:"Gera guias criativos automticos",onClick:J}),o.jsx(yl,{icon:"",label:"Limpar",color:"#ff7070",desc:"Remove todos os guias e canais",onClick:te}),o.jsx(yl,{icon:"",label:"Style",color:"#b080ff",desc:"Randomiza cor, espessura e curvatura dos guias",onClick:pe})]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:5},children:[o.jsx("span",{style:{...Ns,marginBottom:0,minWidth:66},children:"Cor"}),o.jsx("input",{type:"color",value:I,onChange:Xe=>W(Xe.target.value),style:{width:28,height:20,padding:0,border:"1px solid rgba(255,255,255,0.15)",borderRadius:3,cursor:"pointer",background:"none"}}),o.jsx("span",{style:{fontSize:7,color:"rgba(255,255,255,0.4)",fontFamily:"monospace"},children:I})]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:4},children:[o.jsx("span",{style:{...Ns,marginBottom:0,minWidth:66},children:"Espessura"}),o.jsx("input",{type:"range",min:.6,max:3.2,step:.05,value:R,onChange:Xe=>F(parseFloat(Xe.target.value)),style:{flex:1,cursor:"pointer",accentColor:"#60b0ff"}}),o.jsx("span",{style:{fontSize:8,color:"rgba(255,255,255,0.45)",minWidth:30,fontFamily:"monospace"},children:R.toFixed(2)})]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:6},children:[o.jsx("span",{style:{...Ns,marginBottom:0,minWidth:66},children:"Curvatura"}),o.jsx("input",{type:"range",min:0,max:1,step:.01,value:j,onChange:Xe=>B(parseFloat(Xe.target.value)),style:{flex:1,cursor:"pointer",accentColor:"#b080ff"}}),o.jsx("span",{style:{fontSize:8,color:"rgba(255,255,255,0.45)",minWidth:30,fontFamily:"monospace"},children:j.toFixed(2)})]}),o.jsxs("div",{style:{display:"flex",gap:5},children:[o.jsxs("button",{onClick:P,style:{flex:1,padding:"4px 6px",borderRadius:3,cursor:"pointer",fontSize:7,border:`1px solid ${L?"rgba(96,176,255,0.45)":"rgba(255,255,255,0.1)"}`,background:L?"rgba(96,176,255,0.12)":"rgba(255,255,255,0.03)",color:L?"rgba(160,220,255,0.95)":"rgba(255,255,255,0.45)",textTransform:"uppercase",letterSpacing:"0.05em"},children:["Preset Auto ",L?"ON":"OFF"]}),o.jsxs("button",{onClick:V,style:{flex:1,padding:"4px 6px",borderRadius:3,cursor:"pointer",fontSize:7,border:`1px solid ${$?"rgba(176,128,255,0.45)":"rgba(255,255,255,0.1)"}`,background:$?"rgba(176,128,255,0.12)":"rgba(255,255,255,0.03)",color:$?"rgba(220,200,255,0.95)":"rgba(255,255,255,0.45)",textTransform:"uppercase",letterSpacing:"0.05em"},children:["Random Auto ",$?"ON":"OFF"]})]}),o.jsxs("div",{style:{marginTop:7},children:[o.jsx("div",{style:{...Ns,marginBottom:4},children:"Modo Linha"}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:3},children:[["flow","Flow"],["pinch","Pinch"],["shear","Shear"],["barrier","Barra"],["spiral","Spiral"],["funnel","Funil"],["repulsor","Repel"],["attractor","Atrai"],["wave","Onda"],["orbit_line","rbita"]].map(([Xe,Ut])=>o.jsx("button",{onClick:()=>re(Xe),style:{padding:"3px 1px",borderRadius:3,cursor:"pointer",fontSize:7,border:`1px solid ${E===Xe?"rgba(255,0,132,0.4)":"rgba(255,255,255,0.1)"}`,background:E===Xe?"rgba(255,0,132,0.12)":"rgba(255,255,255,0.03)",color:E===Xe?"rgba(255,180,220,0.95)":"rgba(255,255,255,0.45)"},children:Ut},Xe))})]}),o.jsxs("div",{style:{marginTop:7},children:[o.jsx("div",{style:{...Ns,marginBottom:4},children:"Modo Canal"}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:3},children:[["stream","Fluxo"],["orbit","rbita"],["shock","Pulso"]].map(([Xe,Ut])=>o.jsx("button",{onClick:()=>oe(Xe),style:{padding:"4px 2px",borderRadius:3,cursor:"pointer",fontSize:7,border:`1px solid ${O===Xe?"rgba(255,0,132,0.4)":"rgba(255,255,255,0.1)"}`,background:O===Xe?"rgba(255,0,132,0.12)":"rgba(255,255,255,0.03)",color:O===Xe?"rgba(255,180,220,0.95)":"rgba(255,255,255,0.45)"},children:Ut},Xe))})]})]}),o.jsxs("div",{children:[o.jsx("div",{style:Ns,children:"Injees de Gene"}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[{label:"Entropia MAX",icon:"",key:"entropy",val:.95,color:"#ff6040"},{label:"Entropia MIN",icon:"",key:"entropy",val:.05,color:"#60c0ff"},{label:"Fluxo MAX",icon:"",key:"flow",val:.95,color:"#40b0ff"},{label:"Coheso MAX",icon:"",key:"coherence",val:.95,color:"#80ffb0"},{label:"Isolamento MAX",icon:"",key:"isolation",val:1,color:"#ff8040"},{label:"Isolamento OFF",icon:"",key:"isolation",val:0,color:"#80c0ff"}].map(Xe=>o.jsxs("button",{onClick:()=>c(Xe.key,Xe.val),style:{padding:"5px 8px",borderRadius:4,cursor:"pointer",background:`${Xe.color}0d`,border:`1px solid ${Xe.color}25`,color:`${Xe.color}bb`,fontSize:8,textAlign:"left",display:"flex",alignItems:"center",gap:6,letterSpacing:"0.04em"},children:[o.jsx("span",{children:Xe.icon}),o.jsx("span",{children:Xe.label})]},`${Xe.key}-${Xe.val}`))})]})]})},bp="metaArtLab";function _X({dna:e,seed:t,onLoadPreset:n,onLoadArte:r}){const{user:a}=vm(),i=(a==null?void 0:a.id)??null,[s,c]=S.useState([]),[l,d]=S.useState([]),[u,h]=S.useState(!1),[m,f]=S.useState(""),g=async()=>{h(!0);try{const b=await fS(bp,i);c(Array.isArray(b.presets)?b.presets:[]),d(Array.isArray(b.saves)?b.saves:[])}finally{h(!1)}};S.useEffect(()=>{g()},[i]);const x=b=>new Date(b).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),v={section:{marginBottom:12,padding:8,background:"rgba(255,255,255,0.03)",borderRadius:6,border:"1px solid rgba(255,255,255,0.06)"},label:{fontSize:9,color:"rgba(255,255,255,0.5)",letterSpacing:"0.08em",textTransform:"uppercase",marginBottom:6},row:{display:"flex",alignItems:"center",gap:6,padding:"4px 0",borderBottom:"1px solid rgba(255,255,255,0.04)"},input:{flex:1,background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:4,padding:"4px 8px",color:"#fff",fontSize:10},btn:{background:"none",border:"none",cursor:"pointer",padding:4,color:"rgba(255,255,255,0.5)"},btnPrimary:{background:"rgba(255,0,132,0.2)",border:"1px solid rgba(255,0,132,0.4)",borderRadius:4,padding:"4px 8px",color:"#ff80b3",fontSize:9,cursor:"pointer",display:"flex",alignItems:"center",gap:4}};return o.jsxs("div",{style:{padding:8,fontFamily:"'IBM Plex Mono', monospace"},children:[o.jsxs("div",{style:{...v.section,marginBottom:10},children:[o.jsxs("div",{style:{...v.label,display:"flex",alignItems:"center",gap:4},children:[i?o.jsx(rS,{size:9,color:"#60a5fa"}):null,"Meus presets e artes ",i?"(conta)":"(local)"]}),o.jsx("div",{style:v.row,children:o.jsx("input",{type:"text",placeholder:"Nome",value:m,onChange:b=>f(b.target.value),style:v.input})}),o.jsxs("div",{style:{display:"flex",gap:6,marginTop:6},children:[o.jsxs("button",{type:"button",onClick:()=>{const b=m.trim()||e.name||"Preset",w={id:`pre_${Date.now()}_${Math.random().toString(36).slice(2,7)}`,name:b,timestamp:Date.now(),dna:{...e}};Z5(bp,"presets",w,i),c(M=>[...M,w]),f("")},style:v.btnPrimary,children:[o.jsx(Jp,{size:10})," Salvar preset"]}),o.jsxs("button",{type:"button",onClick:()=>{const b=m.trim()||e.name||"Arte",w={id:`art_${Date.now()}_${Math.random().toString(36).slice(2,7)}`,name:b,timestamp:Date.now(),dna:{...e},seed:t};Z5(bp,"saves",w,i),d(M=>[...M,w]),f("")},style:v.btnPrimary,children:[o.jsx(Jp,{size:10})," Salvar arte"]})]})]}),o.jsxs("div",{style:v.section,children:[o.jsx("div",{style:v.label,children:"Presets"}),u&&o.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.4)"},children:"Carregando..."}),o.jsxs("div",{style:{maxHeight:120,overflowY:"auto"},children:[s.length===0&&!u&&o.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.3)"},children:"Nenhum."}),s.map(b=>o.jsxs("div",{style:v.row,children:[o.jsxs("div",{style:{flex:1,minWidth:0},children:[o.jsx("div",{style:{fontSize:10,color:"rgba(255,255,255,0.9)",overflow:"hidden",textOverflow:"ellipsis"},children:b.name}),o.jsxs("div",{style:{fontSize:8,color:"rgba(255,255,255,0.35)",display:"flex",alignItems:"center",gap:4},children:[o.jsx(Bu,{size:8})," ",x(b.timestamp)]})]}),o.jsx("button",{title:"Carregar",onClick:()=>n(b.dna),style:v.btn,children:o.jsx(Tu,{size:12,className:"text-green-400"})}),o.jsx("button",{title:"Excluir",onClick:()=>{ey(bp,"presets",b.id,i),c(w=>w.filter(M=>M.id!==b.id))},style:v.btn,children:o.jsx(il,{size:12,className:"text-red-400"})})]},b.id))]})]}),o.jsxs("div",{style:v.section,children:[o.jsx("div",{style:v.label,children:"Artes salvas"}),o.jsxs("div",{style:{maxHeight:120,overflowY:"auto"},children:[l.length===0&&!u&&o.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.3)"},children:"Nenhuma."}),l.map(b=>o.jsxs("div",{style:v.row,children:[o.jsxs("div",{style:{flex:1,minWidth:0},children:[o.jsx("div",{style:{fontSize:10,color:"rgba(255,255,255,0.9)",overflow:"hidden",textOverflow:"ellipsis"},children:b.name}),o.jsxs("div",{style:{fontSize:8,color:"rgba(255,255,255,0.35)"},children:[o.jsx(Bu,{size:8})," ",x(b.timestamp)]})]}),o.jsx("button",{title:"Carregar",onClick:()=>r(b.dna,b.seed),style:v.btn,children:o.jsx(Tu,{size:12,className:"text-green-400"})}),o.jsx("button",{title:"Excluir",onClick:()=>{ey(bp,"saves",b.id,i),d(w=>w.filter(M=>M.id!==b.id))},style:v.btn,children:o.jsx(il,{size:12,className:"text-red-400"})})]},b.id))]})]})]})}const NX={dialogica:0,recursivo:0,hologramatico:0,sapiensDemens:.5,tetralogia:0};function OX(e,t){const n=e.length;if(n<3)return NX;let r=0,a=0,i=0,s=0,c=0,l=0;for(let ye=0;ye<n;ye++){const Se=e[ye];r+=Se.vx,a+=Se.vy;const we=Math.sqrt(Se.vx*Se.vx+Se.vy*Se.vy);i+=we,s+=we*we,c+=Se.x,l+=Se.y}const d=i/n,u=Math.sqrt(Math.max(0,s/n-d*d)),h=c/n,m=l/n,f=Math.sqrt((r/n)**2+(a/n)**2),g=d>.001?Math.min(1,f/d):0;let x=0;for(let ye=0;ye<n;ye++){const Se=e[ye];x+=(Se.x-h)**2+(Se.y-m)**2}const v=Math.min(1,Math.sqrt(x/n)*3),b=new Set;for(let ye=0;ye<n;ye++)b.add(Math.floor(e[ye].hue/30));const w=Math.min(1,b.size/8),M=t.genes,k=g*.4+M.structure*.3+M.coherence*.3,R=Math.min(1,u*8)*.4+M.entropy*.3+M.fragmentation*.3,j=Math.min(1,Math.min(k,R)*2.5),I=M.flow*.35+M.memory*.35+Math.min(1,d*4)*.3,E=Math.min(1,u*6+M.entropy*.3),O=Math.min(1,I*E*3),L=1-Math.abs(v-.45)*2,$=Math.min(1,L*.35+w*.35+M.coherence*.3),F=M.structure*.25+M.coherence*.25+g*.25+M.memory*.25,B=M.entropy*.25+M.erosion*.25+M.fragmentation*.25+Math.min(1,u*6)*.25,W=F+B||1,re=F/W,oe=M.structure*.5+g*.5,te=M.entropy*.5+Math.min(1,u*6)*.5,J=M.flow*.4+Math.min(1,d*4)*.3+w*.3,pe=M.coherence*.4+M.memory*.3+(1-M.fragmentation)*.3,P=Math.min(oe,te,J,pe),V=Math.max(oe,te,J,pe)||1,fe=Math.min(1,P/V*2+P*.5);return{dialogica:j,recursivo:O,hologramatico:$,sapiensDemens:re,tetralogia:fe}}const eo="'IBM Plex Mono', monospace",nl="#ff0084",ix="#000",l5="rgba(255,255,255,0.02)",ui="rgba(255,255,255,0.06)",Bo="rgba(255,255,255,0.28)",c5="rgba(255,255,255,0.5)",wu="rgba(255,255,255,0.85)",Cc=[{key:"pulse",prompt:"Qual ritmo interno voc quer para esta sesso?",options:[{label:"Silncio",value:.1},{label:"Respirao lenta",value:.3},{label:"Ritmo vivo",value:.55},{label:"Pulsao intensa",value:.78},{label:"xtase",value:.95}]},{key:"order",prompt:"Hoje sua forma pede ordem ou caos?",options:[{label:"Caos total",value:.05},{label:"Ruptura",value:.25},{label:"Equilbrio",value:.5},{label:"Arquitetura",value:.75},{label:"Geometria rgida",value:.95}]},{key:"heat",prompt:"Qual temperatura emocional da paleta?",options:[{label:"Fria",value:.1},{label:"Neutra-fria",value:.3},{label:"Mista",value:.5},{label:"Neutra-quente",value:.7},{label:"Incandescente",value:.9}]},{key:"surrender",prompt:"Quanto controle voc quer manter?",options:[{label:"Controle total",value:.1},{label:"Direo firme",value:.3},{label:"Coautoria",value:.55},{label:"Fluxo livre",value:.78},{label:"Entrega total",value:.95}]},{key:"memory",prompt:"Voc quer rastro/memria longa na composio?",options:[{label:"Quase nenhum",value:.1},{label:"Curto",value:.3},{label:"Mdio",value:.5},{label:"Longo",value:.75},{label:"Profundo",value:.95}]},{key:"gesture",prompt:"O gesto deve ser mais trao ou massa?",options:[{label:"Ponto/massa",value:.1},{label:"Forma curta",value:.3},{label:"Hbrido",value:.5},{label:"Trao fluido",value:.75},{label:"Caligrafia",value:.95}]}];function DX({geoParams:e,onParamChange:t,onApplyPreset:n}){const r=iS(),[a,i]=on.useState(!1),s=e,c={padding:"12px 14px",display:"flex",flexDirection:"column",gap:10,fontFamily:eo},l={fontSize:8,color:Bo,letterSpacing:"0.12em",textTransform:"uppercase",marginBottom:1,fontFamily:eo},d={strokeWeight:[.1,3],shapeScale:[.1,3],particleSize3D:[.1,3],zDepth:[0,2],camFOV:[20,90],shapeGravity:[0,1],angleDamping:[0,1],trailLength3D:[1,6]},u=(h,m,f="#60ff90")=>{const g=s[h],x=typeof g=="number"&&isFinite(g)?g:0,[v,b]=d[h]??[0,1];return o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[o.jsx("span",{style:{...l,width:62,marginBottom:0,textAlign:"right"},children:m}),o.jsx("input",{type:"range",min:v,max:b,step:b>1?.05:.01,value:x,onChange:w=>t(h,parseFloat(w.target.value)),style:{flex:1,cursor:"pointer",accentColor:f}}),o.jsx("span",{style:{fontSize:7,color:Bo,fontFamily:eo,minWidth:28,textAlign:"right"},children:x.toFixed(2)})]},h)};return s.mode==="geometric"||s.mode==="hybrid"||s.mode,o.jsxs("div",{style:{...c,color:"rgba(255,255,255,0.75)",overflowY:"auto"},children:[o.jsx("div",{style:{fontSize:8,color:nl,letterSpacing:"0.16em",textTransform:"uppercase",fontWeight:400,fontFamily:eo},children:"COMPOSITOR GESTALT"}),o.jsxs("div",{children:[o.jsx("div",{style:l,children:r("Modo","Mode")}),o.jsx("div",{style:{display:"flex",gap:3,flexWrap:"wrap"},children:["fluid","geometric","hybrid","3d"].map(h=>o.jsx("button",{title:h,onClick:()=>t("mode",h),style:{flex:1,minWidth:42,padding:"4px 0",borderRadius:1,cursor:"pointer",fontSize:7,fontFamily:eo,letterSpacing:"0.1em",textTransform:"uppercase",background:s.mode===h?"rgba(255,0,132,0.08)":"rgba(255,255,255,0.02)",border:`1px solid ${s.mode===h?"rgba(255,0,132,0.3)":ui}`,color:s.mode===h?nl:Bo},children:h==="fluid"?"FLUID":h==="geometric"?"GEO":h==="hybrid"?"HYBRID":"3D"},h))})]}),s.mode==="3d"&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:5},children:[o.jsx("div",{style:{...l,marginBottom:3,color:"rgba(200,130,255,0.75)"},children:r(" Cmera & Espao"," Camera & Space")}),u("zDepth","Z-Depth","#c080ff"),u("orbitSpeed","rbita","#a060ff"),u("camFOV","FOV","#8060ff"),u("depthFog","Fog","#607090")]}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:5},children:[o.jsx("div",{style:{...l,marginBottom:3,color:"rgba(200,130,255,0.75)"},children:r(" Luz & Glow"," Light & Glow")}),u("light3D","Luz","#ffd060"),u("particleSize3D","Pt Size","#a0ffa0"),u("glowIntensity3D","Glow","#80c0ff"),u("waveZ","Z-Wave","#ff80c0"),u("fillSolidity","Fill Solid","#ffcc60"),u("shapeScale","Scale","#a0ffa0")]}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:5},children:[o.jsx("div",{style:{...l,marginBottom:3,color:"rgba(200,130,255,0.75)"},children:r(" Conexes & Overlays"," Connections & Overlays")}),u("macroAtmosphere","Conexes","#ff80c0"),u("macroGesture","Flow","#60c0ff"),o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:6},children:[o.jsx("span",{style:{...l,marginBottom:0,width:60},children:r("Rastros","Trails")}),o.jsx("button",{title:`Trails 3D: ${s.trails3D?"ON":"OFF"}`,onClick:()=>t("trails3D",!s.trails3D),style:{flex:1,fontSize:8,padding:"3px 0",borderRadius:3,cursor:"pointer",background:s.trails3D?"rgba(80,200,255,0.18)":"rgba(255,255,255,0.04)",border:`1px solid ${s.trails3D?"rgba(80,200,255,0.45)":"rgba(255,255,255,0.1)"}`,color:s.trails3D?"rgba(160,230,255,0.95)":"rgba(255,255,255,0.28)",fontFamily:"monospace"},children:s.trails3D?" ON":" OFF"})]}),s.trails3D&&u("trailLength3D","Trail Len","#80d0ff")]}),o.jsxs("div",{style:{fontSize:7,color:"rgba(200,130,255,0.4)",lineHeight:1.65,background:"rgba(140,60,255,0.06)",borderRadius:4,padding:"6px 8px"},children:[o.jsx("div",{style:{color:"rgba(200,130,255,0.6)",marginBottom:3,fontSize:8},children:" DNA  3D"}),o.jsx("div",{children:"Memory  auto-rastros  Entropy  jitter"}),o.jsx("div",{children:"Contrast  luminncia  Rhythm  pulso"}),o.jsx("div",{children:"Frag.  escala alternada  Linear  Rizoma"})]}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:5},children:[o.jsx("div",{style:{...l,marginBottom:2,color:"rgba(200,130,255,0.75)"},children:" Formas Geo"}),o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:6},children:[o.jsx("span",{style:{...l,marginBottom:0,width:60},children:"Wireframe"}),o.jsx("button",{title:`Geo Shapes: ${s.showGeoShapes!==!1?"ON":"OFF"}`,onClick:()=>t("showGeoShapes",s.showGeoShapes===!1),style:{flex:1,fontSize:8,padding:"3px 0",borderRadius:3,cursor:"pointer",background:s.showGeoShapes!==!1?"rgba(160,80,255,0.18)":"rgba(255,255,255,0.04)",border:`1px solid ${s.showGeoShapes!==!1?"rgba(200,100,255,0.45)":"rgba(255,255,255,0.1)"}`,color:s.showGeoShapes!==!1?"rgba(220,170,255,0.95)":"rgba(255,255,255,0.28)",fontFamily:"monospace"},children:s.showGeoShapes!==!1?" ON":" OFF"})]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:6},children:[o.jsx("span",{style:{...l,marginBottom:0,width:60},children:r("Slido 3D","3D Solid")}),o.jsx("button",{title:`Solid 3D: ${s.solidShapes3D?"ON":"OFF"}`,onClick:()=>t("solidShapes3D",!s.solidShapes3D),style:{flex:1,fontSize:8,padding:"3px 0",borderRadius:3,cursor:"pointer",background:s.solidShapes3D?"rgba(255,160,60,0.18)":"rgba(255,255,255,0.04)",border:`1px solid ${s.solidShapes3D?"rgba(255,200,80,0.45)":"rgba(255,255,255,0.1)"}`,color:s.solidShapes3D?"rgba(255,220,150,0.95)":"rgba(255,255,255,0.28)",fontFamily:"monospace"},children:s.solidShapes3D?" ON":" OFF"})]}),o.jsxs("div",{style:{fontSize:7,color:"rgba(255,255,255,0.2)",lineHeight:1.5},children:["Slido: preenche rect/plane/arc com tringulos.",o.jsx("br",{}),"Ajusta Fill Solid para controlar a opacidade."]})]}),o.jsxs("div",{children:[o.jsx("div",{style:{...l,marginBottom:5,color:"rgba(200,130,255,0.6)"},children:r("Presets 3D","3D Presets")}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[{key:"nebula_drift",name:"Nebula Drift",desc:"rbita lenta  glow volumtrico  nvoa"},{key:"crystal_lattice",name:"Crystal Lattice",desc:"Estrutura  linhas frias  luz dura"},{key:"void_bloom",name:"Void Bloom",desc:"Vazio  exploso aditiva  rbita rpida"},{key:"solar_wind",name:"Solar Wind",desc:"Fluxo  arcos 3D  vento solar"},{key:"quantum_foam",name:"Quantum Foam",desc:"Turbulncia mxima  glow total  caos"},{key:"deep_field",name:"Deep Field",desc:"Campo estelar  deriva lenta  Hubble"},{key:"rhizome_3d",name:"Rizoma 3D",desc:"Linhas retas  rastros neon  rede viva"}].map(({key:h,name:m,desc:f})=>o.jsxs("button",{title:m,onClick:()=>n(h),style:{textAlign:"left",padding:"6px 8px",borderRadius:1,cursor:"pointer",background:"rgba(255,0,132,0.04)",border:"1px solid rgba(255,0,132,0.15)",color:wu,fontSize:8,fontFamily:eo},children:[o.jsx("div",{style:{fontWeight:400,marginBottom:2,letterSpacing:"0.06em"},children:m}),o.jsx("div",{style:{fontSize:7,color:Bo},children:f})]},h))})]}),o.jsxs("div",{style:{fontSize:8,color:"rgba(160,100,255,0.4)",lineHeight:1.65,borderTop:"1px solid rgba(160,80,255,0.12)",paddingTop:8},children:[" drag  rbita  scroll  zoom",o.jsx("br",{})," 2 dedos  pinch-zoom"]})]}),(s.mode==="geometric"||s.mode==="hybrid")&&o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[o.jsx("div",{style:{...l,marginBottom:4,color:"rgba(160,240,160,0.5)"},children:"Macros"}),u("macroStructure","Structure","#c0a0ff"),u("macroGesture","Gesture","#60c0ff"),u("macroContrast","Contrast","#ffd060"),u("macroSilence","Silence","#80ffa0"),u("macroAtmosphere","Atmosphere","#ff80c0"),u("macroCollage","Collage","#ff9060")]}),(s.mode==="geometric"||s.mode==="hybrid")&&o.jsxs("div",{children:[o.jsx("div",{style:{...l,marginBottom:6,color:"rgba(100,200,255,0.6)"},children:" Fsica das Formas"}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:5},children:[o.jsxs("div",{style:{fontSize:7,color:"rgba(255,255,255,0.22)",lineHeight:1.5,marginBottom:2},children:["Gesture  velocidade autnoma das formas (linha, arco, rect, plano).",o.jsx("br",{}),"Gravity  atrai formas para o centro. Ang.Damp  congela ngulo."]}),u("shapeGravity","Gravity","#ffaa40"),u("angleDamping","Ang. Damp","#80d0ff")]})]}),(s.mode==="geometric"||s.mode==="hybrid")&&o.jsxs("div",{children:[o.jsx("div",{style:{...l,marginBottom:6},children:"Primitive Mix"}),["mixPoint","mixLine","mixRect","mixArc","mixPlane"].map((h,m)=>{const f=[" Point"," Line"," Rect"," Arc"," Plane"],g=["#888","#60c0ff","#ffd060","#ff80c0","#c0a0ff"];return u(h,f[m],g[m])})]}),(s.mode==="geometric"||s.mode==="hybrid")&&o.jsxs("div",{children:[o.jsx("div",{style:{...l,marginBottom:6,color:"rgba(255,200,100,0.6)"},children:"Composio & FX"}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:5},children:[u("shapeOpacity","Opacity","#ffffff"),u("fillSolidity","Fill Solid","#ffcc60"),u("strokeWeight","Stroke W.","#60d0ff"),u("shapeScale","Scale","#a0ffa0"),u("rotationDrift","Rot. Drift","#ff80ff"),u("bloomShape","Bloom","#80c0ff"),u("vignetteStr","Vignette","#888888"),u("grainStr","Grain","#cccccc")]})]}),(s.mode==="geometric"||s.mode==="hybrid")&&o.jsxs("div",{children:[o.jsxs("button",{title:a?"Fechar avanado":"Abrir avanado",onClick:()=>i(h=>!h),style:{width:"100%",background:"none",border:"1px solid rgba(255,255,255,0.07)",borderRadius:4,padding:"4px 8px",cursor:"pointer",color:"rgba(255,255,255,0.3)",fontSize:8,display:"flex",alignItems:"center",justifyContent:"space-between",letterSpacing:"0.08em"},children:[o.jsx("span",{children:"AVANADO"}),o.jsx("span",{children:a?"":""})]}),a&&o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:5,marginTop:8},children:[u("snapAxes","Snap Axes","#c0a0ff"),u("gridStrength","Grid Str.","#ffd060"),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[o.jsx("span",{style:{...l,width:62,marginBottom:0,textAlign:"right"},children:"Grid Size"}),o.jsx("input",{type:"range",min:8,max:80,step:4,value:s.gridSize,onChange:h=>t("gridSize",parseInt(h.target.value)),style:{flex:1,cursor:"pointer",accentColor:"#ffd060"}}),o.jsxs("span",{style:{fontSize:8,color:"rgba(255,255,255,0.4)",fontFamily:"monospace",minWidth:28,textAlign:"right"},children:[s.gridSize,"px"]})]}),u("lineMastery","Line Mst.","#60ff90"),u("planeCasting","Planes","#ff9060"),u("cutWindows","Cut Win.","#ff6060")]})]}),s.mode!=="3d"&&o.jsxs("div",{children:[o.jsx("div",{style:{...l,marginBottom:6},children:"Presets Geomtricos"}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[{key:"constructive_score",name:"Constructive Score",desc:"Linhas longas + grade + tenso"},{key:"geometric_orchestra",name:"Geometric Orchestra",desc:"Arcos + diagonais + halos"},{key:"analytical_collage",name:"Analytical Collage",desc:"Recortes + planos + colagem"},{key:"spiritual_geometry",name:"Spiritual Geometry",desc:"Minimal + aura + silncio"}].map(({key:h,name:m,desc:f})=>o.jsxs("button",{title:m,onClick:()=>n(h),style:{textAlign:"left",padding:"6px 8px",borderRadius:1,cursor:"pointer",background:"rgba(255,0,132,0.04)",border:"1px solid rgba(255,0,132,0.15)",color:wu,fontSize:8,fontFamily:eo},children:[o.jsx("div",{style:{fontWeight:400,marginBottom:2,letterSpacing:"0.06em"},children:m}),o.jsx("div",{style:{fontSize:7,color:Bo},children:f})]},h))})]}),(s.mode==="geometric"||s.mode==="hybrid")&&o.jsx("div",{style:{fontSize:8,color:"rgba(255,255,255,0.22)",lineHeight:1.55,borderTop:"1px solid rgba(255,255,255,0.06)",paddingTop:8},children:s.mode==="geometric"?"Modo Geomtrico: quanta renderizam como primitivas (linha, arco, retngulo, plano). Compositor Gestalt aplica snap-de-eixos, grade, crescimento de linhas e planos translcidos.":"Modo Hbrido: traos fluidos + primitivas geomtricas sobrepostos. Atmosphere + halos ativos."})]})}function LX({card:e,selected:t,onSelect:n,onFavorite:r,onPin:a,onDiscard:i,onMutateFrom:s}){return o.jsxs("div",{style:{border:`1px solid ${t?"rgba(255,0,132,0.3)":ui}`,borderRadius:1,overflow:"hidden",cursor:"pointer",background:t?"rgba(255,0,132,0.04)":"rgba(255,255,255,0.01)"},children:[o.jsx("img",{src:e.thumbnail,alt:e.label,onClick:n,style:{width:"100%",aspectRatio:"1",display:"block",objectFit:"cover"}}),o.jsxs("div",{style:{padding:"4px 5px"},children:[o.jsx("div",{style:{fontSize:7,color:Bo,marginBottom:3,fontFamily:eo,letterSpacing:"0.1em"},children:e.label}),o.jsxs("div",{style:{display:"flex",gap:3,justifyContent:"space-between"},children:[o.jsx("button",{onClick:r,title:"Favoritar",style:{...d5,color:e.favorite?nl:Bo},children:o.jsx(Jk,{size:9,strokeWidth:1.2})}),o.jsx("button",{onClick:a,title:"Pinnar DNA",style:{...d5,color:e.pinned?nl:Bo},children:o.jsx(eR,{size:9,strokeWidth:1.2})}),o.jsx("button",{onClick:s,title:"Mutar a partir deste",style:{...d5},children:o.jsx(wf,{size:9,strokeWidth:1.2})}),o.jsx("button",{onClick:i,title:"Descartar",style:{...d5},children:o.jsx(il,{size:9,strokeWidth:1.2})})]})]})]})}const d5={background:"none",border:"none",cursor:"pointer",padding:0,color:Bo,display:"flex",alignItems:"center"},zX=({active:e})=>{var Qs,As;const t=S.useRef(null),n=S.useRef(null),r=S.useRef(null),a=S.useRef(0),i=S.useRef(0),s=S.useRef(Qc[0]),c=S.useRef([]),l=S.useRef(o5()),d=S.useRef([]),u=S.useRef(Date.now()),h=S.useRef(0),[m,f]=S.useState(Qc[0]),[g,x]=S.useState([]),[v,b]=S.useState(PC()),[w,M]=S.useState("physics"),[k,R]=S.useState(!1),[j,I]=S.useState(!1),[E,O]=S.useState([]),[L,$]=S.useState([]),[F,B]=S.useState([]),[W,re]=S.useState(null),[oe,te]=S.useState(null),[J,pe]=S.useState(null),[P,V]=S.useState({connections:!1,glow:!1,pulse:!1}),[fe,ye]=S.useState({W:window.innerWidth,H:window.innerHeight}),[Se,we]=S.useState(1),[ke,De]=S.useState(1),[_e,ae]=S.useState(0),[Re,Fe]=S.useState("scatter"),[Oe,ne]=S.useState(!1),[nt,pt]=S.useState(!1),[Et,_t]=S.useState(!0),[Ct,Xe]=S.useState(0),[Ut,Le]=S.useState({pulse:.55,order:.5,heat:.5,surrender:.55,memory:.65,gesture:.6}),Ke=S.useRef(!1),mt=S.useRef([]),an=S.useRef([]),gn=S.useRef(null),Be=S.useRef([]),[ft,Qt]=S.useState(0),[nr,_n]=S.useState(1.3),[Rn,sn]=S.useState(.45),[Cn,wt]=S.useState("#40b0ff"),[st,Zt]=S.useState("flow"),[Pe,ct]=S.useState("stream"),[vt,xe]=S.useState(!0),[ge,Ee]=S.useState(!0),me=S.useRef(1.3),je=S.useRef(.45),Te=S.useRef("#40b0ff"),Ae=S.useRef("flow"),Tt=S.useRef("stream"),xt=S.useRef(PC()),en=S.useRef(null),At=S.useRef(!1),Ze=S.useRef({connections:!1,glow:!1,pulse:!1}),yt=S.useRef([]),[Mt,bn]=S.useState(s5()),Pt=S.useRef(s5()),[An,cr]=S.useState(()=>Array(36).fill(0)),[Tn,Sr]=S.useState(FC()),de=S.useRef(FC()),[$e,et]=S.useState("molhado"),zt=S.useRef(Vp[0]),[Nt,ln]=S.useState(6),Rt=S.useRef({dialogica:0,recursivo:0,hologramatico:0,sapiensDemens:.5,tetralogia:0}),[Nn,It]=S.useState(Rt.current),[xn,Ln]=S.useState(!1),zn=S.useRef(0),Or=S.useRef(1),wr=S.useRef(1),vn=S.useRef("scatter"),Gr=S.useRef(!1),hn=S.useRef(!1),jr=S.useCallback(G=>[...Qc,...Ih].find(ve=>ve.name===G)??Qc[0],[]),_r=S.useCallback(G=>{const he=G.order>.84?"Mondrian Grid":G.order>.7?"Blueprint":G.surrender>.82&&G.pulse>.7?"Action Paint":G.memory>.82&&G.pulse<.35?"Slow Fog":G.heat>.75?"Chromatic Ecstasy":G.gesture>.78?"Ink Calligraphy":G.surrender<.3?"Signal":"Quadro Branco",ve=jr(he),He=["#ff5d3d","#ff9e2c","#ffd166","#ff3d8f","#b13dff","#592a20"],ut=["#46c2ff","#7ad3ff","#6ef2d1","#70a5ff","#3457ff","#173046"],pn=G.heat,cn=pn>=.5?He:ut,Jt=Math.abs(pn-.5)*2,Pn=ve.palette.map((Wn,Yn)=>Yn%2===0&&Jt>.2?cn[Yn%cn.length]:Wn),Hn={...ve.genes};Hn.flow=Math.max(.02,Math.min(.98,(Hn.flow??.5)*.55+G.pulse*.45)),Hn.entropy=Math.max(.02,Math.min(.98,(Hn.entropy??.4)*.5+(1-G.order)*.5)),Hn.memory=Math.max(.02,Math.min(.99,(Hn.memory??.6)*.55+G.memory*.45)),Hn.coherence=Math.max(.05,Math.min(.98,(Hn.coherence??.6)*.55+G.order*.45)),Hn.fragmentation=Math.max(.02,Math.min(.98,(Hn.fragmentation??.4)*.6+(1-G.order)*.4)),Hn.rhythm=Math.max(.02,Math.min(.98,(Hn.rhythm??.5)*.55+G.pulse*.45)),Hn.linear=Math.max(0,Math.min(1,(Hn.linear??.4)*.6+G.order*.4));const Ir={...ve,id:`${ve.id}-ritual-${Date.now()}`,name:`Ritual: ${ve.name??"Quadro Branco"}`,palette:Pn,genes:Hn,quantaCount:0,background:"#ffffff",createdAt:Date.now()},Ur=G.order>.75?"grid":G.surrender>.8?"explosion":G.gesture>.72?"flow_lines":"scatter",qr=G.gesture>.72?"flow_paint":G.surrender>.8?"spawn_brush":G.order>.72?"channel":"spawn_brush",tn=Math.max(.35,Math.min(1.45,.45+G.pulse*.95)),Fn=Math.max(.55,Math.min(1.8,.75+G.gesture*.8));return{dna:Ir,spawn:Ur,tool:qr,speed:tn,size:Fn}},[jr]),Zn=S.useRef(null),[lo,ir]=S.useState("idle"),[to,Er]=S.useState(0);S.useEffect(()=>(Zn.current=new Nf(ir),()=>{var G;return(G=Zn.current)==null?void 0:G.dispose()}),[]),S.useEffect(()=>{if(lo!=="recording")return;const G=setInterval(()=>{var he;return Er(((he=Zn.current)==null?void 0:he.elapsed)??0)},500);return()=>clearInterval(G)},[lo]);const Eo=S.useCallback(G=>{var ve;const he=s.current;(ve=Zn.current)==null||ve.start(()=>[t.current],()=>({labName:`Meta-Arte: ${he.name??"untitled"}`,lines:[`quanta:${he.genes.particleCount??"?"}  flow:${(he.genes.flowStrength??0).toFixed(2)}`]}),30,void 0,{format:(G==null?void 0:G.format)??"auto",quality:(G==null?void 0:G.quality)??"standard"})},[]),oa=S.useCallback(()=>{var G;(G=Zn.current)==null||G.stop()},[]),{status:ja,inputModeRef:Co,setInputMode:Ya}=UK(),qo=S.useRef({x:.5,y:.5}),os=S.useRef(null),[Ho,fs]=S.useState(!0),[To,Xo]=S.useState({connected:!1,name:"",axes:{lx:0,ly:0,rx:0,ry:0},triggers:{lt:0,rt:0},buttons:{},justPressed:{},justReleased:{}}),[ks,D]=S.useState(!1),ee=S.useRef(Ho);S.useEffect(()=>{ee.current=Ho},[Ho]);const Ie=S.useRef(0),Qe=["spawn_brush","erase_agents","ink_brush","attractor","repulsor","flow_comb","vortex","glyph_stamp"],X=S.useRef(0),Z=j?0:92,ce=j||w===null?0:240;Math.max(200,fe.W-Z-ce),Math.max(200,fe.H-40-36);const[ue,be]=S.useState(()=>({w:Math.max(200,typeof window<"u"?window.innerWidth-Z:800),h:Math.max(200,typeof window<"u"?window.innerHeight-40-36:600)})),H=S.useRef(ue);S.useEffect(()=>{H.current=ue},[ue]),S.useEffect(()=>{const G=()=>ye({W:window.innerWidth,H:window.innerHeight});return window.addEventListener("resize",G),()=>window.removeEventListener("resize",G)},[]),S.useEffect(()=>{const G=Math.max(200,fe.W-Z),he=Math.max(200,fe.H-40-36);be(ve=>ve.w===G&&ve.h===he?ve:{w:G,h:he}),H.current={w:G,h:he}},[fe.W,fe.H,Z]),S.useEffect(()=>{s.current=m},[m]),S.useEffect(()=>{xt.current=v},[v]),S.useEffect(()=>{At.current=k},[k]),S.useEffect(()=>{Ze.current=P},[P]),S.useEffect(()=>{Or.current=Se},[Se]),S.useEffect(()=>{wr.current=ke},[ke]),S.useEffect(()=>{vn.current=Re},[Re]),S.useEffect(()=>{Gr.current=Oe},[Oe]),S.useEffect(()=>{hn.current=nt},[nt]),S.useEffect(()=>{Pt.current=Mt},[Mt]),S.useEffect(()=>{de.current=Tn},[Tn]),S.useEffect(()=>{me.current=nr},[nr]),S.useEffect(()=>{je.current=Rn},[Rn]),S.useEffect(()=>{Te.current=Cn},[Cn]),S.useEffect(()=>{Ae.current=st},[st]),S.useEffect(()=>{Tt.current=Pe},[Pe]),S.useEffect(()=>{const G=Vp.find(he=>he.id===$e)??Vp[0];zt.current=G},[$e]);const le=S.useCallback((G,he)=>{const{w:ve,h:He}=H.current;s.current=G,u.current=he;const ut=o5();a5(ut,G,he),ut.interactionMatrix=e0(G,he),l.current=ut,c.current=G.quantaCount>0?NK(G,he,vn.current):[];const pn=Pt.current;pn.mode!=="fluid"&&c.current.length>0&&(Ph(pn),yp(c.current,pn)),ae(c.current.length),cr(Array.from(ut.interactionMatrix));const cn=yK(ve,He);d.current=cn,x(cn.map(Jt=>({...Jt})))},[]);S.useEffect(()=>{e&&le(s.current,Date.now())},[e]),S.useEffect(()=>{e&&(Ke.current||(Xe(0),_t(!0)))},[e]),S.useEffect(()=>{if(!e)return;const G=rw(),he=.013;let ve=!1,He=!1,ut=!1,pn=!1,cn=!1,Jt=!1,Pn=!1,Hn=!1,Ir=0;const Ur=()=>{a.current=requestAnimationFrame(Ur);const qr=t.current;if(!qr)return;const tn=qr.getContext("2d");if(!tn)return;const Fn=qr.width,Wn=qr.height,Yn=G.poll(),co=YK(Yn,Co.current);if(Yn.connected){qo.current.x=Math.max(0,Math.min(1,qo.current.x+Yn.axes.lx*he)),qo.current.y=Math.max(0,Math.min(1,qo.current.y+Yn.axes.ly*he));const hr=os.current;if(hr&&(hr.style.display=co?"block":"none",hr.style.left=`${qo.current.x*100}%`,hr.style.top=`${qo.current.y*100}%`),co){const Vo=qo.current.x,$a=qo.current.y,aa=xt.current;if(Yn.triggers.rt>.08){const fr=Yn.triggers.rt,Oo=Math.max(1,Math.round(fr*aa.pressure*aa.size*.12)),qa=aa.size/Math.max(Fn,Wn)*.4,Po=Yn.axes.lx*.004*fr,uc=Yn.axes.ly*.004*fr,Wi=TC(s.current,Vo,$a,Po,uc,Oo,qa,aa.colorIndex),cl=Pt.current;cl.mode!=="fluid"&&Wi.length>0&&(Ph(cl),yp(Wi,cl)),c.current=[...c.current,...Wi].slice(-4e3);const Gi=performance.now();Gi-Ir>80&&(G.rumble(fr*.2,40,.6,.4),Ir=Gi)}if(Yn.triggers.lt>.2){const fr=aa.size/Math.max(Fn,Wn)*.65,Oo=fr*fr;c.current=c.current.filter(qa=>{const Po=qa.x-Vo,uc=qa.y-$a;return Po*Po+uc*uc>Oo})}if(Math.abs(Yn.axes.ry)>.15&&b(fr=>{const Oo={...fr,size:Math.max(5,Math.min(180,fr.size-Yn.axes.ry*2))};return xt.current=Oo,Oo}),Yn.buttons.lb&&!pn&&(X.current=(X.current-1+Qe.length)%Qe.length,b(fr=>{const Oo={...fr,activeToolId:Qe[X.current]};return xt.current=Oo,Oo}),G.rumble(.15,40,.5,.5)),Yn.buttons.rb&&!cn&&(X.current=(X.current+1)%Qe.length,b(fr=>{const Oo={...fr,activeToolId:Qe[X.current]};return xt.current=Oo,Oo}),G.rumble(.15,40,.5,.5)),Yn.buttons.dpadLeft&&!Pn){const fr=[...Qc,...Ih];Ie.current=(Ie.current-1+fr.length)%fr.length,Ft(fr[Ie.current]),G.rumble(.12,35,.5,.5)}if(Yn.buttons.dpadRight&&!Hn){const fr=[...Qc,...Ih];Ie.current=(Ie.current+1)%fr.length,Ft(fr[Ie.current]),G.rumble(.12,35,.5,.5)}Yn.buttons.y&&!Jt&&(Bt(),G.rumble(.3,80,.4,.6)),Yn.buttons.a&&!He&&fs(fr=>!fr),Yn.buttons.start&&!ve&&D(fr=>!fr),Yn.buttons.select&&!ut&&I(fr=>!fr),i.current%4===0&&Xo({...Yn})}ve=Yn.buttons.start,He=Yn.buttons.a,ut=Yn.buttons.select,pn=Yn.buttons.lb,cn=Yn.buttons.rb,Jt=Yn.buttons.y,Pn=Yn.buttons.dpadLeft,Hn=Yn.buttons.dpadRight}else{const hr=os.current;hr&&(hr.style.display="none")}const Ao=At.current,as=Or.current,Zo=Pt.current,Io=Zo.mode,Zs=!Ao&&as>=1?Math.max(1,Math.round(as)):1,ms=Ao?0:as<1?as:1;if(!Ao){for(let Vo=0;Vo<Zs;Vo++){const $a=i.current+Vo;iK(c.current,l.current,s.current,xt.current,Fn,Wn,$a,ms,Gr.current,Pt.current.boundaryMode??"wrap",de.current),(mt.current.length>0||an.current.length>0)&&fK(c.current,mt.current,an.current,i.current),Io!=="fluid"&&JK(c.current,Zo,Fn,Wn),rK(l.current,s.current)}if(i.current+=Zs,Io!=="fluid"&&(zn.current++,zn.current>=30&&(zn.current=0,QK(c.current,Zo,Fn,Wn,i.current))),i.current%90===0){const Vo=OK(l.current,c.current,h.current);h.current=Vo.density,pe(Vo),ae(c.current.length),Rt.current=OX(c.current,s.current),It(Rt.current)}}const Ja=i.current;if(Io==="3d"){!r.current&&n.current&&(r.current=new yX(n.current),r.current.attachHandlers()),r.current&&(r.current.resize(Fn,Wn),r.current.render(c.current,s.current,Zo,Fn,Wn,Ja,Ze.current));for(const hr of d.current)hr.canvas&&hr.canvas.getContext("2d").clearRect(0,0,hr.canvas.width,hr.canvas.height)}else{const hr=Q0(d.current,"trail"),Vo=c.current.length>0;if(hr!=null&&hr.canvas){const Po=hr.canvas.getContext("2d");Io==="geometric"&&Vo?Po.clearRect(0,0,Fn,Wn):(!Ao&&Vo&&(SK(hr,s.current,ms),(Io==="fluid"||Io==="hybrid")&&dK(Po,c.current,s.current,Fn,Wn,Ja,wr.current,zt.current)),Io!=="fluid"&&Zo.macroAtmosphere>.05&&NC(Po,c.current,Zo,s.current.palette,Fn,Wn))}const $a=Q0(d.current,"particles");if($a!=null&&$a.canvas){$a.opacity=Io==="geometric"?1:Io==="hybrid"?.85:.18;const Po=$a.canvas.getContext("2d");Io==="fluid"?IC(Po,c.current,s.current,Fn,Wn,wr.current,zt.current):Io==="hybrid"?(IC(Po,c.current,s.current,Fn,Wn,wr.current*.35,zt.current),OC(Po,c.current,s.current,Zo,Fn,Wn,Ja)):(Po.clearRect(0,0,Fn,Wn),OC(Po,c.current,s.current,Zo,Fn,Wn,Ja))}const aa=Q0(d.current,"connections");if(aa!=null&&aa.canvas)if(Ze.current.connections){const Po=aa.canvas.getContext("2d");uK(Po,c.current,s.current,Fn,Wn)}else aa.canvas.getContext("2d").clearRect(0,0,Fn,Wn);const fr=Q0(d.current,"glow");if(fr!=null&&fr.canvas)if(Io==="geometric")fr.canvas.getContext("2d").clearRect(0,0,Fn,Wn);else if(Ze.current.glow&&(Ao||Ja%2===0)){const Po=fr.canvas.getContext("2d");hK(Po,c.current,s.current,Fn,Wn,wr.current)}else Ze.current.glow||fr.canvas.getContext("2d").clearRect(0,0,Fn,Wn);const Oo=Q0(d.current,"trail"),qa=Q0(d.current,"post");qa!=null&&qa.canvas&&(Io==="geometric"?qa.canvas.getContext("2d").clearRect(0,0,Fn,Wn):Oo&&(Ao||Ja%8===0)&&wK(qa,Oo,s.current,Fn,Wn))}xK(tn,d.current,s.current.background,Fn,Wn);const Ba=Pt.current;if(Ba.showBorder){tn.save();const hr=Ba.boundaryMode??"wrap",Vo=hr==="bounce"?"rgba(60,140,255,0.7)":hr==="absorb"?"rgba(255,80,60,0.7)":hr==="open"?"rgba(255,255,255,0.12)":"rgba(255,255,255,0.22)";if(tn.strokeStyle=Vo,tn.lineWidth=hr==="open"?1:2,tn.globalAlpha=1,hr==="wrap"?tn.setLineDash([6,5]):tn.setLineDash([]),tn.strokeRect(1,1,Fn-2,Wn-2),hr!=="open"){tn.lineWidth=1,tn.globalAlpha=.55;const $a=16;[[0,0],[Fn,0],[0,Wn],[Fn,Wn]].forEach(([aa,fr])=>{const Oo=aa===0?1:-1,qa=fr===0?1:-1;tn.beginPath(),tn.moveTo(aa+Oo*$a,fr),tn.lineTo(aa,fr),tn.lineTo(aa,fr+qa*$a),tn.stroke()})}tn.setLineDash([]),tn.restore()}const Pl=i.current;if((mt.current.length>0||an.current.length>0)&&pK(tn,mt.current,an.current,Fn,Wn,Pl),gn.current){const hr=gn.current,Vo=Ae.current??hr.type,$a=Vo==="barrier"?"#ff7070":Vo==="shear"?"#ffd060":Vo==="pinch"?"#a060ff":"#40b0ff",aa=Vo==="barrier"?[2,2]:Vo==="shear"?[10,3]:Vo==="pinch"?[3,5]:[5,4];tn.save(),tn.strokeStyle=$a,tn.lineWidth=1.2,tn.globalAlpha=.6,tn.setLineDash(aa),tn.beginPath(),tn.moveTo(hr.x1*Fn,hr.y1*Wn),tn.lineTo(hr.x2*Fn,hr.y2*Wn),tn.stroke(),tn.setLineDash([]),tn.globalAlpha=.8,tn.fillStyle=tn.strokeStyle,tn.beginPath(),tn.arc(hr.x1*Fn,hr.y1*Wn,3,0,Math.PI*2),tn.fill(),tn.beginPath(),tn.arc(hr.x2*Fn,hr.y2*Wn,3,0,Math.PI*2),tn.fill(),tn.restore()}if(Be.current.length>1){tn.save(),tn.strokeStyle="rgba(255,255,255,0.4)",tn.lineWidth=1.2,tn.setLineDash([3,4]),tn.lineCap="round",tn.beginPath(),tn.moveTo(Be.current[0][0]*Fn,Be.current[0][1]*Wn);for(let hr=1;hr<Be.current.length;hr++)tn.lineTo(Be.current[hr][0]*Fn,Be.current[hr][1]*Wn);tn.stroke(),tn.setLineDash([]),tn.restore()}mK(tn,xt.current,Fn,Wn,Pl)};return a.current=requestAnimationFrame(Ur),()=>{cancelAnimationFrame(a.current),r.current&&(r.current.detachHandlers(),r.current.dispose(),r.current=null)}},[e]);const Je=S.useCallback((G,he,ve,He,ut,pn)=>{const cn=xt.current;if(cn.activeToolId==="spawn_brush"){const Jt=G/ut,Pn=he/pn,Hn=G-ve,Ir=he-He,Ur=Math.sqrt(Hn*Hn+Ir*Ir)+.001,qr=cn.pressure*.007,tn=Hn/Ur*qr,Fn=Ir/Ur*qr,Wn=Math.max(1,Math.round(cn.pressure*cn.size*.18)),Yn=cn.size/Math.max(ut,pn)*.55,co=TC(s.current,Jt,Pn,tn,Fn,Wn,Yn,cn.colorIndex),Ao=Pt.current;Ao.mode!=="fluid"&&co.length>0&&(Ph(Ao),yp(co,Ao)),c.current=[...c.current,...co].slice(-4e3),ae(c.current.length)}else if(cn.activeToolId==="erase_agents"){const Jt=G/ut,Pn=he/pn,Hn=cn.size/Math.max(ut,pn)*.75,Ir=Hn*Hn,Ur=c.current.length;c.current=c.current.filter(qr=>{const tn=qr.x-Jt,Fn=qr.y-Pn;return tn*tn+Fn*Fn>Ir}),c.current.length!==Ur&&ae(c.current.length)}},[]),tt=S.useCallback(G=>{G.currentTarget.setPointerCapture(G.pointerId),en.current=G.pointerId;const he=G.currentTarget.getBoundingClientRect(),ve=G.currentTarget.width||ue.w,He=G.currentTarget.height||ue.h,ut=he.width>0?ve/he.width:1,pn=he.height>0?He/he.height:1,cn=(G.clientX-he.left)*ut,Jt=(G.clientY-he.top)*pn;b(Pn=>{const Hn={...Pn,isDragging:!0,lastX:cn,lastY:Jt};return xt.current=Hn,(Pn.activeToolId==="spawn_brush"||Pn.activeToolId==="erase_agents")&&Je(cn,Jt,cn,Jt,ve,He),["attractor","repulsor","flow_comb","vortex","solve","coagula"].includes(Pn.activeToolId)&&AC(l.current,cn/ve,Jt/He,Pn.size/Math.max(ve,He),Pn.activeToolId,Pn.pressure,Math.atan2(0,1)),(Pn.activeToolId==="flow_paint"||Pn.activeToolId==="pinch")&&(gn.current={x1:cn/ve,y1:Jt/He,x2:cn/ve,y2:Jt/He,type:Pn.activeToolId==="flow_paint"?"flow":"pinch"}),Pn.activeToolId==="channel"&&(Be.current=[[cn/ve,Jt/He]]),["ink_brush","dust_brush","glow_brush","eraser","mask_brush","glyph_stamp"].includes(Pn.activeToolId),yt.current.push({toolId:Pn.activeToolId,x:cn,y:Jt,size:Pn.size,timestamp:Date.now()}),yt.current.length>100&&yt.current.shift(),Hn})},[ue.w,ue.h,Je]),St=S.useCallback(G=>{if(!xt.current.isDragging)return;const he=G.currentTarget.getBoundingClientRect(),ve=G.currentTarget.width||ue.w,He=G.currentTarget.height||ue.h,ut=he.width>0?ve/he.width:1,pn=he.height>0?He/he.height:1,cn=(G.clientX-he.left)*ut,Jt=(G.clientY-he.top)*pn,Pn=xt.current.lastX,Hn=xt.current.lastY;b(Ir=>{const Ur=cn-Pn,qr=Jt-Hn,tn=Math.sqrt(Ur*Ur+qr*qr)+1e-4,Fn={...Ir,lastX:cn,lastY:Jt,dragDX:Ur/tn,dragDY:qr/tn};if(xt.current=Fn,(Ir.activeToolId==="spawn_brush"||Ir.activeToolId==="erase_agents")&&Je(cn,Jt,Pn,Hn,ve,He),["attractor","repulsor","flow_comb","vortex","solve","coagula"].includes(Ir.activeToolId)){const Wn=Math.atan2(Jt-Hn,cn-Pn);AC(l.current,cn/ve,Jt/He,Ir.size/Math.max(ve,He),Ir.activeToolId,Ir.pressure*.5,Wn)}if((Ir.activeToolId==="flow_paint"||Ir.activeToolId==="pinch")&&gn.current&&(gn.current.x2=cn/ve,gn.current.y2=Jt/He),Ir.activeToolId==="channel"&&Be.current.length>0){const Wn=Be.current[Be.current.length-1],Yn=cn/ve-Wn[0],co=Jt/He-Wn[1];Yn*Yn+co*co>3e-5&&Be.current.push([cn/ve,Jt/He])}return Fn})},[ue.w,ue.h,Je]),$t=S.useCallback(G=>{const he=(G==null?void 0:G.currentTarget)??t.current,ve=(G==null?void 0:G.pointerId)??en.current;if(he&&ve!==null&&ve!==void 0)try{typeof he.hasPointerCapture=="function"&&he.hasPointerCapture(ve)&&he.releasePointerCapture(ve)}catch{}en.current=null;const He=xt.current;if((He.activeToolId==="flow_paint"||He.activeToolId==="pinch")&&gn.current){const ut=gn.current,pn=ut.x2-ut.x1,cn=ut.y2-ut.y1;if(pn*pn+cn*cn>.001){const Jt=Te.current||(s.current.palette[xt.current.colorIndex%s.current.palette.length]??"#40b0ff");mt.current.push({id:`gl-${Date.now()}-${Math.random().toString(36).slice(2,6)}`,x1:ut.x1,y1:ut.y1,x2:ut.x2,y2:ut.y2,type:Ae.current||ut.type,color:Jt,strength:He.pressure,thickness:me.current}),Qt(mt.current.length+an.current.length)}gn.current=null}if(He.activeToolId==="channel"&&Be.current.length>2){const ut=Te.current||(s.current.palette[xt.current.colorIndex%s.current.palette.length]??"#40b0ff");an.current.push({id:`ch-${Date.now()}-${Math.random().toString(36).slice(2,6)}`,points:[...Be.current],color:ut,strength:He.pressure,thickness:me.current,smoothness:je.current,behavior:Tt.current}),Qt(mt.current.length+an.current.length)}Be.current=[],b(ut=>{const pn={...ut,isDragging:!1};return xt.current=pn,pn})},[]),rt=S.useCallback(G=>{if(f(G),s.current=G,G.quantaCount!==c.current.length){if(G.quantaCount>c.current.length){const he=sK({...G,quantaCount:G.quantaCount-c.current.length},u.current+Date.now());c.current=[...c.current,...he]}else c.current=c.current.slice(0,G.quantaCount);ae(c.current.length)}},[]),Ft=S.useCallback(G=>{const he={...G};rt(he),a5(l.current,he,u.current);const ve=e0(he,u.current);l.current.interactionMatrix=ve,cr(Array.from(ve)),vt&&(qt(),dr("preset",he)),$(He=>Zc(He,`DNA: ${G.name??"?"}`,"milestone"))},[rt,vt]),Xt=S.useCallback((G,he)=>{bn(ve=>{const He={...ve,[G]:he};Ph(He),Pt.current=He;const ut=G;return(ut==="mode"||ut.startsWith("mix")||ut==="macroAtmosphere")&&c.current.length>0&&(He.mode==="fluid"?XK(c.current):yp(c.current,He)),ut==="mode"&&he!=="3d"&&r.current&&(r.current.detachHandlers(),r.current.dispose(),r.current=null),He})},[]),dn=S.useCallback(G=>{Xt("mode",G),M(G!=="fluid"?"geo":"physics")},[Xt]),kn=S.useCallback((G,he)=>{if(G==="mode"){dn(he);return}Xt(G,he)},[dn,Xt]);S.useEffect(()=>{const G=he=>{he.key==="Escape"&&I(!1)};return window.addEventListener("keydown",G),()=>window.removeEventListener("keydown",G)},[]),S.useEffect(()=>{fetch("http://127.0.0.1:7859/ingest/0abf9fcf-b217-4f00-9c34-3f0a1bb469c8",{method:"POST",headers:{"Content-Type":"application/json","X-Debug-Session-Id":"4659b2"},body:JSON.stringify({sessionId:"4659b2",runId:"repro-2",hypothesisId:"H0",location:"MetaArtLab.tsx:1525",message:"metaart_mount_ping",data:{active:e},timestamp:Date.now()})}).catch(()=>{})},[e]);const ar=S.useCallback((G,he)=>{const ve=ZK[G];if(!ve)return;const He={...s5(),...ve};Ph(He),Pt.current=He,bn(He),He.mode!=="3d"&&r.current&&(r.current.detachHandlers(),r.current.dispose(),r.current=null),he?(f(he),le(he,Date.now())):c.current.length>0&&He.mode!=="fluid"&&yp(c.current,He)},[le]),jn=S.useCallback(()=>{const G=LV();if(!G){$(He=>Zc(He,"Nenhum snapshot do MusicLab encontrado","observation")),M("physics");return}const he=$V(G);V(he.overlays);const ve={...s5(),...he.geo};Ph(ve),Pt.current=ve,bn(ve),ve.mode!=="3d"&&r.current&&(r.current.detachHandlers(),r.current.dispose(),r.current=null),f(he.dna),le(he.dna,he.seed),M("physics"),$(He=>Zc(He,`Importado do MusicLab: ${G.preset.name}  ${G.preset.bpm}bpm  ${G.preset.root} ${G.preset.scale}`,"milestone"))},[le]),yr=S.useCallback(G=>{const he=G.length>0?G:M6(s.current,.28,8),ve=he.map((He,ut)=>({id:`vit-${Date.now()}-${ut}`,dna:He,thumbnail:EK(He,96),pinned:!1,favorite:!1,seed:u.current+ut*7919,label:`M${ut+1}`}));B(ve),M("vitrine"),$(He=>Zc(He,`${he.length} variantes geradas`,"suggestion"))},[]),Bt=S.useCallback(()=>{const G=Pt.current.mode==="3d"?n.current??t.current:t.current;if(!G)return;const he=kK(G,s.current,u.current,yt.current);O(ve=>[he,...ve].slice(0,50)),M("archive"),$(ve=>Zc(ve,"snapshot capturado","milestone"))},[]),qt=S.useCallback(()=>{mt.current=[],an.current=[],gn.current=null,Be.current=[],Qt(0)},[]),mn=S.useCallback(G=>{mt.current.length>0&&(mt.current=mt.current.map(he=>({...he,color:G.color??he.color,thickness:G.thickness??he.thickness,type:G.lineMode??he.type}))),an.current.length>0&&(an.current=an.current.map(he=>({...he,color:G.color??he.color,thickness:G.thickness??he.thickness,smoothness:G.smoothness??he.smoothness,behavior:G.pathMode??he.behavior})))},[]),dr=S.useCallback((G,he)=>{const ve=he??s.current,He=Te.current||(ve.palette[0]??"#40b0ff"),ut=ve.palette[Math.floor(Math.random()*Math.max(1,ve.palette.length))]??He,pn=Math.max(.6,me.current),cn=Math.max(0,Math.min(1,je.current)),Jt=G==="random"?3+Math.floor(Math.random()*3):1+Math.floor(Math.random()*2),Pn=G==="random"?1+Math.floor(Math.random()*2):1,Hn=[],Ir=["flow","pinch","shear","barrier","spiral","funnel","repulsor","attractor","wave","orbit_line"],Ur=["stream","orbit","shock"];for(let tn=0;tn<Jt;tn++){const Fn=Math.floor(Math.random()*4),Wn=.16+Math.random()*.22;let Yn=Math.random(),co=Math.random();Fn===0&&(Yn=.02,co=Math.random()),Fn===1&&(Yn=.98,co=Math.random()),Fn===2&&(Yn=Math.random(),co=.02),Fn===3&&(Yn=Math.random(),co=.98);const Ao=Math.max(.03,Math.min(.97,Yn+(.5-Yn)*Wn+(Math.random()-.5)*.45)),as=Math.max(.03,Math.min(.97,co+(.5-co)*Wn+(Math.random()-.5)*.45));Hn.push({id:`agl-${Date.now()}-${tn}-${Math.random().toString(36).slice(2,6)}`,x1:Yn,y1:co,x2:Ao,y2:as,type:G==="random"?Ir[Math.floor(Math.random()*Ir.length)]:Ae.current??"flow",color:tn%2===0?He:ut,strength:.5+Math.random()*.45,thickness:pn*(.8+Math.random()*.55)})}const qr=[];for(let tn=0;tn<Pn;tn++){const Fn=[],Wn=.08+Math.random()*.84,Yn=.08+Math.random()*.84,co=Math.random()*Math.PI*2,Ao=10+Math.floor(Math.random()*10),as=.04+cn*.12;for(let Zo=0;Zo<Ao;Zo++){const Io=Zo/(Ao-1),Zs=Wn+Math.cos(co)*(Io-.5)*(.45+Math.random()*.18),ms=Yn+Math.sin(co)*(Io-.5)*(.45+Math.random()*.18),Ja=Math.sin(Io*Math.PI*2+tn)*as,Ba=Math.max(.02,Math.min(.98,Zs+Math.cos(co+Math.PI/2)*Ja)),Pl=Math.max(.02,Math.min(.98,ms+Math.sin(co+Math.PI/2)*Ja));Fn.push([Ba,Pl])}qr.push({id:`ach-${Date.now()}-${tn}-${Math.random().toString(36).slice(2,6)}`,points:Fn,color:tn%2===0?ut:He,strength:.46+Math.random()*.4,thickness:pn*(.85+Math.random()*.5),smoothness:cn,behavior:G==="random"?Ur[Math.floor(Math.random()*Ur.length)]:Tt.current??"stream"})}mt.current=[...mt.current,...Hn],an.current=[...an.current,...qr],Qt(mt.current.length+an.current.length)},[]),rr=S.useCallback(()=>{for(const he of d.current)he.canvas&&(he.id==="trail"||he.id==="brush")&&he.canvas.getContext("2d").clearRect(0,0,he.canvas.width,he.canvas.height);c.current=[],ae(0),yt.current=[];const G=o5();a5(G,s.current,u.current),G.interactionMatrix=e0(s.current,u.current),l.current=G,cr(Array.from(G.interactionMatrix)),$(he=>Zc(he,"tela limpa  reincio do gesto","observation"))},[]),Dr=S.useCallback((G,he)=>{G&&(f(G),s.current=G);for(const He of d.current){if(!He.canvas)continue;He.canvas.getContext("2d").clearRect(0,0,He.canvas.width,He.canvas.height)}c.current=[],ae(0),yt.current=[];const ve=o5();a5(ve,s.current,u.current),ve.interactionMatrix=e0(s.current,u.current),l.current=ve,cr(Array.from(ve.interactionMatrix)),qt(),R(!1),At.current=!1,$(He=>Zc(He,he??"blank canvas  tela viva para pintura em tempo real","milestone"))},[qt]),ho=S.useCallback(()=>{Dr(void 0,"blank canvas  tela viva para pintura em tempo real")},[Dr]),Vr=S.useCallback(()=>{const G=_r(Ut);Fe(G.spawn),vn.current=G.spawn,b(he=>{const ve={...he,activeToolId:G.tool};return xt.current=ve,ve}),we(G.speed),Or.current=G.speed,De(G.size),wr.current=G.size,Dr(G.dna,`ritual aplicado  ${G.dna.name??"preset espiritual"}`),Ke.current=!0,_t(!1)},[_r,Ut,Dr]),ko=S.useCallback((G,he)=>{d.current=d.current.map(ve=>ve.id===G?{...ve,...he}:ve),x(d.current.map(ve=>({...ve})))},[]),Ea=S.useCallback(G=>{const he=Q0(d.current,G);he&&bK(he)},[]),no=S.useCallback(G=>{re(G.id),rt(G.dna)},[rt]),go=S.useCallback(G=>{B(he=>{const ve=he.find(He=>He.id===G);return ve&&te(ve.dna),he.map(He=>He.id===G?{...He,pinned:!He.pinned}:He)})},[]),qs=S.useCallback(G=>{rt(G.dna),u.current=G.seed,$(he=>Zc(he,"snapshot restaurado","observation"))},[rt]),Ka=S.useCallback(G=>{rt(G),le(G,u.current)},[rt,le]),Jo=S.useCallback((G,he)=>{rt(G),u.current=he,le(G,he)},[rt,le]),La=S.useCallback(()=>{const G=KY();f(G),s.current=G,qt(),le(G,Date.now()),ge&&dr("random",G),$(he=>Zc(he,"DNA completamente aleatorio gerado","milestone"))},[le,ge,qt,dr]),za=S.useCallback(()=>{const G=s.current,he=t.current;(he==null?void 0:he.width)??ue.w,(he==null?void 0:he.height)??ue.h;const ve=G.palette,He=Math.floor(Math.random()*ve.length),ut=ve[He]??"#ff88cc",[pn,cn,Jt]=window.__metaHexToHSL?window.__metaHexToHSL(ut):[300,.8,.6],Pn=parseInt(ut.slice(1,3),16)/255,Hn=parseInt(ut.slice(3,5),16)/255,Ir=parseInt(ut.slice(5,7),16)/255,Ur=Math.max(Pn,Hn,Ir),qr=Math.min(Pn,Hn,Ir);let tn=0;const Fn=Ur-qr;Fn!==0&&(Ur===Pn?tn=((Hn-Ir)/Fn+(Hn<Ir?6:0))/6:Ur===Hn?tn=((Ir-Pn)/Fn+2)/6:tn=((Pn-Hn)/Fn+4)/6);const Wn=(Ur+qr)/2,Yn=Ur===qr?0:Wn>.5?Fn/(2-Ur-qr):Fn/(Ur+qr),co={x:.5+(Math.random()-.5)*.1,y:.5+(Math.random()-.5)*.1,vx:(Math.random()-.5)*.004,vy:(Math.random()-.5)*.004,charge:.5,ink:1,mood:.5,role:"DRAW",species:He%6,memX:new Float32Array([.5,.5,.5,.5,.5,.5]),memY:new Float32Array([.5,.5,.5,.5,.5,.5]),memIdx:0,age:0,hue:tn*360,sat:Yn,lit:Wn,alpha:1,size:Nt*3,glyphIndex:0,isSingleton:!0,angle:0};c.current=[...c.current,co],ae(c.current.length)},[ue.w,ue.h,Nt]),Rs=S.useCallback((G,he)=>{const ve=parseInt(he.slice(1,3),16)/255,He=parseInt(he.slice(3,5),16)/255,ut=parseInt(he.slice(5,7),16)/255,pn=Math.max(ve,He,ut),cn=Math.min(ve,He,ut);let Jt=0;const Pn=pn-cn;Pn!==0&&(pn===ve?Jt=((He-ut)/Pn+(He<ut?6:0))/6:pn===He?Jt=((ut-ve)/Pn+2)/6:Jt=((ve-He)/Pn+4)/6);const Hn=(pn+cn)/2,Ir=pn===cn?0:Hn>.5?Pn/(2-pn-cn):Pn/(pn+cn),Ur=[...s.current.palette];Ur[G%Ur.length]=he;const qr={...s.current,palette:Ur};f(qr),s.current=qr;for(const tn of c.current)tn.species===G&&(tn.hue=Jt*360+(Math.random()-.5)*8,tn.sat=Math.max(.2,Math.min(1,Ir+(Math.random()-.5)*.05)),tn.lit=Math.max(.15,Math.min(.85,Hn+(Math.random()-.5)*.04)))},[]),Qo=S.useCallback(G=>{const he={...s.current,genes:{...s.current.genes,agentShape:G}};f(he),s.current=he},[]),vo=S.useCallback(()=>{const G=Math.max(1,ue.w),he=Math.max(1,ue.h),ve=xt.current.lastX/G,He=xt.current.lastY/he;return Number.isFinite(ve)&&Number.isFinite(He)&&ve>=0&&ve<=1&&He>=0&&He<=1?{cx:ve,cy:He}:{cx:.5,cy:.5}},[ue.w,ue.h]),va=S.useCallback((G,he,ve,He)=>{fetch("http://127.0.0.1:7859/ingest/0abf9fcf-b217-4f00-9c34-3f0a1bb469c8",{method:"POST",headers:{"Content-Type":"application/json","X-Debug-Session-Id":"4659b2"},body:JSON.stringify({sessionId:"4659b2",runId:G,hypothesisId:he,location:"MetaArtLab.tsx:1900",message:ve,data:He,timestamp:Date.now()})}).catch(()=>{})},[]),Js=S.useCallback((G=2.4)=>{va("repro-1","H3","handler_enter_chaos",{k:G,quanta:c.current.length});const he=s.current.genes.entropy,ve={...s.current,genes:{...s.current.genes,entropy:1}};f(ve),s.current=ve;const He=Math.max(1,G);for(const ut of c.current)ut.vx+=(Math.random()-.5)*.09*He,ut.vy+=(Math.random()-.5)*.09*He;setTimeout(()=>{const ut={...s.current,genes:{...s.current.genes,entropy:he}};f(ut),s.current=ut},2e3)},[va]),$i=S.useCallback((G=2.4)=>{va("repro-1","H3","handler_enter_freeze",{k:G,quanta:c.current.length});const he=Math.max(0,1-Math.max(1,G)*.35);for(const ve of c.current)ve.vx*=he,ve.vy*=he},[va]),pi=S.useCallback((G=2.4)=>{const he=Math.max(1,G);for(const ve of c.current){const He=Math.random()*Math.PI*2,ut=(.03+Math.random()*.05)*he;ve.vx+=Math.cos(He)*ut,ve.vy+=Math.sin(He)*ut}},[]),ps=S.useCallback((G=2.4)=>{const he=Math.max(1,G),{cx:ve,cy:He}=vo();for(const ut of c.current)ut.vx-=(ve-ut.x)*.12*he,ut.vy-=(He-ut.y)*.12*he},[vo]),No=S.useCallback((G=2.8)=>{const he=Math.max(1,G),{cx:ve,cy:He}=vo();va("repro-1","H3","handler_enter_explode",{k:G,s:he,cx:ve,cy:He,quanta:c.current.length});for(const ut of c.current){const pn=ut.x-ve,cn=ut.y-He,Jt=Math.sqrt(pn*pn+cn*cn)+1e-4,Pn=(.06+Math.random()*.08)*he/(Jt*5+1);ut.vx+=pn/Jt*Pn,ut.vy+=cn/Jt*Pn}},[vo,va]),mi=S.useCallback((G=2.8)=>{const he=Math.max(1,G),{cx:ve,cy:He}=vo();va("repro-1","H3","handler_enter_black_hole",{k:G,s:he,cx:ve,cy:He,quanta:c.current.length});for(const ut of c.current){const pn=ve-ut.x,cn=He-ut.y,Jt=Math.sqrt(pn*pn+cn*cn)+1e-4,Pn=.09*he/(Jt*4+.015);ut.vx+=pn/Jt*Pn,ut.vy+=cn/Jt*Pn,ut.vx+=-cn/Jt*.02*he,ut.vy+=pn/Jt*.02*he,Jt<.04&&(ut.x=(1-ut.x+(Math.random()-.5)*.08+1)%1,ut.y=(1-ut.y+(Math.random()-.5)*.08+1)%1)}},[vo,va]),Tr=S.useCallback((G=2.8)=>{const he=Math.max(1,G);va("repro-1","H3","handler_enter_harmonize",{k:G,s:he,quanta:c.current.length});const ve={...s.current,genes:{...s.current.genes,coherence:Math.min(1,(s.current.genes.coherence??.5)+.28*he),entropy:Math.max(0,(s.current.genes.entropy??.5)-.24*he),flow:Math.min(1,(s.current.genes.flow??.5)+.15*he)}};f(ve),s.current=ve;const He=new Float32Array(36);for(let ut=0;ut<6;ut++)for(let pn=0;pn<6;pn++)He[ut*6+pn]=.25+Math.random()*.4;l.current.interactionMatrix=He,cr(Array.from(He));for(const ut of c.current)ut.vx*=.72,ut.vy*=.72},[va]),bd=S.useCallback((G=2.4)=>{const he=Math.max(1,G),{cx:ve,cy:He}=vo();for(const ut of c.current){const pn=ut.x-ve,cn=ut.y-He,Jt=Math.sqrt(pn*pn+cn*cn)+1e-4,Pn=Math.sin(Math.min(1,Jt*18)*Math.PI),Hn=.1*he*Pn/(Jt*4+1);ut.vx+=pn/Jt*Hn,ut.vy+=cn/Jt*Hn}},[vo]),Lc=S.useCallback((G=2.4)=>{const he=Math.max(1,G);for(const ve of c.current){const He=Math.atan2(ve.vy,ve.vx);ve.vx+=Math.cos(He)*.02*he,ve.vy+=Math.sin(He)*.02*he}},[]),ll=S.useCallback((G=2.4)=>{const he=Math.max(1,G),{cx:ve,cy:He}=vo();for(const ut of c.current){const pn=ve-ut.x,cn=He-ut.y;ut.vx+=pn*.11*he,ut.vy+=cn*.11*he}},[vo]),gi=S.useCallback((G=2.4)=>{const he=Math.max(1,G);for(const ve of c.current)ve.vx*=1.25+.35*he,ve.vy*=1.25+.35*he},[]),Wo=S.useCallback((G=2.8)=>{const he=Math.max(1,G),{cx:ve,cy:He}=vo();for(const ut of c.current){const pn=ut.x-ve,cn=ut.y-He,Jt=Math.sqrt(pn*pn+cn*cn)+1e-4,Pn=.1*he/(Jt*5+1);ut.vx+=-cn/Jt*Pn,ut.vy+=pn/Jt*Pn}},[vo]),qi=S.useCallback((G=2.8)=>No(G*1.1),[No]),cc=S.useCallback((G=2.8)=>ll(G*1.1),[ll]),Xa=S.useCallback((G=2.8)=>{const he=Math.max(1,G),ve=Math.max(.4,1-.22*he);for(const He of c.current)He.vx*=ve,He.vy*=ve},[]),Hi=S.useCallback((G=2.8)=>{const he=Math.max(1,G),{cx:ve,cy:He}=vo();for(const ut of c.current){const pn=ve-ut.x,cn=He-ut.y,Jt=Math.sqrt(pn*pn+cn*cn)+1e-4;ut.vx+=pn/Jt*.03*he+-cn/Jt*.02*he,ut.vy+=cn/Jt*.03*he+pn/Jt*.02*he}},[vo]),xd=S.useCallback((G,he,ve)=>{b(He=>{const ut={...He,activeToolId:G,pressure:Math.max(.2,Math.min(6,he)),size:Math.max(20,Math.min(360,ve))};return xt.current=ut,ut})},[]),Ro=S.useCallback(G=>{for(const He of c.current)He.hue=(He.hue+G+360)%360;const he=s.current.palette.map(He=>{const ut=parseInt(He.slice(1,3),16)/255,pn=parseInt(He.slice(3,5),16)/255,cn=parseInt(He.slice(5,7),16)/255,Jt=Math.max(ut,pn,cn),Pn=Math.min(ut,pn,cn);let Hn=0;const Ir=Jt-Pn;Ir!==0&&(Jt===ut?Hn=((pn-cn)/Ir+(pn<cn?6:0))*60:Jt===pn?Hn=((cn-ut)/Ir+2)*60:Hn=((ut-pn)/Ir+4)*60);const Ur=(Hn+G+360)%360,qr=(Jt+Pn)/2,tn=Jt===Pn?0:qr>.5?Ir/(2-Jt-Pn):Ir/(Jt+Pn),Fn=Ur/360,Wn=tn,Yn=qr,co=(ms,Ja,Ba)=>(Ba<0&&(Ba+=1),Ba>1&&(Ba-=1),Ba<1/6?ms+(Ja-ms)*6*Ba:Ba<1/2?Ja:Ba<2/3?ms+(Ja-ms)*(2/3-Ba)*6:ms),Ao=Yn<.5?Yn*(1+Wn):Yn+Wn-Yn*Wn,as=2*Yn-Ao,Zo=Math.round(co(as,Ao,Fn+1/3)*255),Io=Math.round(co(as,Ao,Fn)*255),Zs=Math.round(co(as,Ao,Fn-1/3)*255);return`#${Zo.toString(16).padStart(2,"0")}${Io.toString(16).padStart(2,"0")}${Zs.toString(16).padStart(2,"0")}`}),ve={...s.current,palette:he};f(ve),s.current=ve},[]),dc=S.useCallback(G=>{for(const he of c.current)he.sat=Math.max(.05,Math.min(1,he.sat+G))},[]),On=S.useCallback(G=>{for(const he of c.current)he.lit=Math.max(.05,Math.min(.95,he.lit+G))},[]),zc=S.useCallback(G=>{for(const he of c.current)he.size=Math.max(.3,Math.min(30,he.size*G))},[]),yi=S.useCallback((G,he)=>{const ve={...s.current,genes:{...s.current.genes,[G]:he}};if(f(ve),s.current=ve,G==="isolation"){const He=e0(ve,u.current,he>.5);l.current.interactionMatrix=He,cr(Array.from(He))}},[]),Bc=S.useCallback((G,he,ve)=>{l.current.interactionMatrix[G*6+he]=ve,cr(He=>{const ut=[...He];return ut[G*6+he]=ve,ut})},[]),vd=S.useCallback(()=>{const G=e0(s.current,Date.now());l.current.interactionMatrix=G,cr(Array.from(G))},[]),Go=S.useCallback(()=>{const G=l.current.interactionMatrix,he=Array.from(G);for(let ve=0;ve<6;ve++)for(let He=ve+1;He<6;He++){const ut=(G[ve*6+He]+G[He*6+ve])/2;G[ve*6+He]=ut,G[He*6+ve]=ut,he[ve*6+He]=ut,he[He*6+ve]=ut}cr(he)},[]),bi=S.useCallback(()=>{const G=e0(s.current,u.current);l.current.interactionMatrix=G,cr(Array.from(G))},[]),Sd=S.useCallback(G=>{const he=new Float32Array(36);switch(G){case"chaos":for(let ve=0;ve<6;ve++)for(let He=0;He<6;He++)he[ve*6+He]=ve===He?0:-(.4+Math.random()*.4);break;case"harmony":for(let ve=0;ve<6;ve++)for(let He=0;He<6;He++)he[ve*6+He]=.25+Math.random()*.45;break;case"predator":for(let ve=0;ve<6;ve++)for(let He=0;He<6;He++){const ut=(He-ve+6)%6;ut===0?he[ve*6+He]=.55:ut===1?he[ve*6+He]=.7:ut===5?he[ve*6+He]=-.6:he[ve*6+He]=(Math.random()-.5)*.2}break;case"bubbles":for(let ve=0;ve<6;ve++)for(let He=0;He<6;He++)he[ve*6+He]=ve===He?.7+Math.random()*.25:-(.35+Math.random()*.3);break}l.current.interactionMatrix=he,cr(Array.from(he))},[]),xi=S.useCallback(G=>{V(he=>{const ve={...he,[G]:!he[G]};return Ze.current=ve,ve})},[]);if(!e)return null;const yn=wy.find(G=>G.id===v.activeToolId),wd=G=>({...Ti,color:G?wu:Bo,background:G?"rgba(255,0,132,0.06)":"transparent",borderBottom:G?`1px solid ${nl}`:"1px solid transparent",borderRadius:1,padding:"3px 5px"});return o.jsxs("div",{style:{position:"fixed",inset:0,zIndex:250,display:"flex",flexDirection:"column",paddingTop:j?0:36,background:ix,fontFamily:eo},children:[!j&&o.jsxs("div",{style:{height:38,display:"flex",alignItems:"center",gap:5,padding:"0 12px",borderBottom:`1px solid ${ui}`,background:ix,flexShrink:0,zIndex:2},children:[o.jsxs("select",{value:"",onChange:G=>{const he=G.target.value,ve={"Nebula Drift":"nebula_drift","Crystal Lattice":"crystal_lattice","Void Bloom":"void_bloom","Solar Wind":"solar_wind","Quantum Foam":"quantum_foam","Deep Field":"deep_field","Rizoma 3D":"rhizome_3d"};if(ve[he]){ar(ve[he]);return}const ut=[...Qc,...Ih,...kC].find(pn=>pn.name===he);if(ut){Ft(ut);const cn={"Constructive Score":"constructive_score","Geometric Orchestra":"geometric_orchestra","Analytical Collage":"analytical_collage","Spiritual Geometry":"spiritual_geometry"}[ut.name??""];cn&&ar(cn)}},style:{background:l5,border:`1px solid ${ui}`,color:c5,fontSize:9,padding:"3px 8px",borderRadius:2,cursor:"pointer",fontFamily:eo,letterSpacing:"0.04em"},children:[o.jsx("option",{value:"",children:"PRESET"}),o.jsx("optgroup",{label:"Principais",children:Qc.map(G=>o.jsx("option",{value:G.name??"",children:G.name},G.name))}),o.jsx("optgroup",{label:"Extra",children:Ih.map(G=>o.jsx("option",{value:G.name??"",children:G.name},G.name))}),o.jsx("optgroup",{label:" Geomtrico",children:kC.map(G=>o.jsxs("option",{value:G.name??"",children:[" ",G.name]},G.name))}),o.jsx("optgroup",{label:" 3D",children:["Nebula Drift","Crystal Lattice","Void Bloom","Solar Wind","Quantum Foam","Deep Field","Rizoma 3D"].map(G=>o.jsxs("option",{value:G,children:[" ",G]},G))})]}),o.jsx("select",{value:Re,onChange:G=>{const he=G.target.value;Fe(he),vn.current=he},title:"Padro inicial dos agentes",style:{background:l5,border:`1px solid ${ui}`,color:Bo,fontSize:8,padding:"3px 6px",borderRadius:2,cursor:"pointer",maxWidth:90,fontFamily:eo,letterSpacing:"0.04em"},children:Object.entries(_K).map(([G,he])=>o.jsx("option",{value:G,children:he},G))}),o.jsx(xp,{}),o.jsx("button",{onClick:()=>R(G=>!G),title:k?"Continuar":"Pausar",style:Ti,children:k?o.jsx(sc,{size:12,strokeWidth:1.5}):o.jsx(md,{size:12,strokeWidth:1.5})}),o.jsx("button",{onClick:ho,title:"Tela em branco viva (limpa tudo e continua em tempo real)",style:{...Ti,color:"#fff",fontSize:8,letterSpacing:"0.08em",fontFamily:eo},children:"BLANK"}),o.jsx("button",{onClick:rr,title:"Limpar tela",style:Ti,children:o.jsx(El,{size:12,strokeWidth:1.5})}),ft>0&&o.jsxs("button",{onClick:qt,title:"Limpar guias e canais",style:{...Ti,color:nl,background:"rgba(255,0,132,0.06)",border:"1px solid rgba(255,0,132,0.2)",borderRadius:1,padding:"2px 6px"},children:[o.jsx(Cs,{size:9,strokeWidth:1.2}),o.jsxs("span",{style:{fontSize:7,letterSpacing:"0.1em",fontFamily:eo},children:["GUIAS (",ft,")"]})]}),o.jsx("button",{onClick:()=>le(s.current,Date.now()),title:"Resetar simulao (novo seed, posies resetadas)",style:Ti,children:o.jsx(wf,{size:12,strokeWidth:1.5})}),o.jsx("button",{onClick:La,title:"Gerar DNA completamente aleatorio",style:{...Ti,color:nl},children:o.jsx("span",{style:{fontSize:8,letterSpacing:"0.08em",fontFamily:eo},children:"RAND"})}),o.jsx("button",{onClick:()=>{const G=Sy(Math.max(4,s.current.palette.length)),he={...s.current,palette:G};f(he),s.current=he,jC(c.current,G)},title:"Gerar paleta aleatoria e recolorir agentes",style:{...Ti,color:"rgba(255,0,132,0.6)"},children:o.jsx("span",{style:{fontSize:8,letterSpacing:"0.08em",fontFamily:eo},children:"CLR"})}),o.jsx(xp,{}),o.jsxs("select",{value:Mt.boundaryMode??"wrap",onChange:G=>Xt("boundaryMode",G.target.value),title:"Modo de bordas do canvas",style:{background:l5,border:`1px solid ${ui}`,color:Bo,fontSize:8,padding:"3px 6px",borderRadius:2,cursor:"pointer",fontFamily:eo},children:[o.jsx("option",{value:"wrap",children:" Wrap"}),o.jsx("option",{value:"bounce",children:" Bounce"}),o.jsx("option",{value:"absorb",children:" Absorb"}),o.jsx("option",{value:"open",children:" Open"})]}),o.jsx("button",{onClick:()=>Xt("showBorder",!Mt.showBorder),title:"Exibir borda do canvas",style:{...Ti,color:Mt.showBorder?wu:Bo,background:Mt.showBorder?"rgba(255,0,132,0.06)":"transparent",borderRadius:1,padding:"2px 4px",borderBottom:Mt.showBorder?`1px solid ${nl}`:"1px solid transparent"},children:o.jsx("span",{style:{fontSize:8},children:""})}),o.jsx(xp,{}),o.jsxs("button",{onClick:()=>xi("connections"),title:"Conexoes entre quanta",style:wd(P.connections),children:[o.jsx(Qk,{size:12,strokeWidth:1.5}),o.jsx("span",{style:{fontSize:8,marginLeft:2},children:"CON"})]}),o.jsxs("button",{onClick:()=>xi("glow"),title:"Brilho aditivo",style:wd(P.glow),children:[o.jsx(zi,{size:12,strokeWidth:1.5}),o.jsx("span",{style:{fontSize:8,marginLeft:2},children:"BRILHO"})]}),o.jsx("button",{onClick:()=>Ln(G=>!G),title:"ndices de Complexidade (Morin)",style:wd(xn),children:o.jsx("span",{style:{fontSize:8},children:"MORIN"})}),o.jsx(xp,{}),o.jsx("button",{onClick:jn,title:"Importar snapshot do MusicLab (gera capa)",style:{...Ti,color:"rgba(55,178,218,0.65)"},children:o.jsx(Kp,{size:12,strokeWidth:1.5})}),o.jsx("button",{onClick:Bt,title:"Snapshot",style:Ti,children:o.jsx(Vk,{size:12,strokeWidth:1.5})}),o.jsx("button",{onClick:()=>{const G=Pt.current.mode==="3d"?n.current??t.current:t.current;G&&TK(G,s.current.name??"metaarte-3d")},title:"Export PNG (captura canvas ativo  2D ou WebGL 3D)",style:Ti,children:o.jsx(aS,{size:12,strokeWidth:1.5})}),o.jsx(km,{state:lo,elapsed:to,onStart:Eo,onStop:oa,showOptions:!0,className:"ml-1"}),o.jsx("button",{onClick:()=>IK(s.current,s.current.name??"recipe"),title:"Export DNA JSON",style:Ti,children:o.jsx(oS,{size:12,strokeWidth:1.5})}),o.jsx(xp,{}),o.jsxs("span",{style:{fontSize:8,color:Bo,fontFamily:eo,letterSpacing:"0.08em"},children:["Q:",o.jsx("span",{style:{color:_e===0?nl:c5,marginLeft:2},children:_e})]}),o.jsx("div",{style:{flex:1}}),o.jsx("span",{style:{fontSize:9,color:Bo,letterSpacing:"0.1em",fontFamily:eo,textTransform:"uppercase"},children:m.name??"custom"}),o.jsx("button",{onClick:()=>I(G=>!G),title:"Modo Cinematico",style:Ti,children:o.jsx(Zk,{size:12,strokeWidth:1.5})}),o.jsxs("select",{value:w??"",onChange:G=>M(G.target.value||null),title:"Painel lateral",style:{background:l5,border:`1px solid ${ui}`,color:Bo,fontSize:8,padding:"3px 6px",borderRadius:2,cursor:"pointer",fontFamily:eo,letterSpacing:"0.08em",minWidth:118},children:[o.jsx("option",{value:"",children:"PAINEL: OFF"}),o.jsx("option",{value:"layers",children:"LAYERS"}),o.jsx("option",{value:"archive",children:"ARCHIVE"}),o.jsx("option",{value:"vitrine",children:"VITRINE"}),o.jsx("option",{value:"matrix",children:"MATRIX"}),o.jsx("option",{value:"physics",children:"PHYSICS & BEHAVIOR"}),o.jsx("option",{value:"powers",children:"POWERS"}),o.jsx("option",{value:"geo",children:"GEOMETRY"}),o.jsx("option",{value:"hub",children:"HUB"})]})]}),j&&o.jsxs("button",{title:"Sair modo cinema (ESC)",onClick:()=>I(!1),style:{position:"fixed",top:10,right:10,zIndex:1e3,background:"rgba(0,0,0,0.82)",border:"1px solid rgba(255,255,255,0.14)",borderRadius:2,padding:"6px 12px",cursor:"pointer",color:"rgba(255,255,255,0.7)",display:"flex",alignItems:"center",gap:6,fontSize:9,fontFamily:eo,letterSpacing:"0.14em",textTransform:"uppercase",boxShadow:"0 6px 18px rgba(0,0,0,0.45)"},children:[o.jsx(Cs,{size:11,strokeWidth:1.6})," VOLTAR ",o.jsx("span",{style:{opacity:.55,fontSize:8},children:"ESC"})]}),o.jsxs("div",{style:{flex:1,display:"flex",overflow:"hidden",position:"relative"},children:[!j&&o.jsx("div",{style:{position:"relative",zIndex:15},children:o.jsx(qK,{toolState:v,palette:m.palette,onToolChange:G=>b(he=>{const ve={...he,...G};return xt.current=ve,ve}),agentShape:m.genes.agentShape??"circle",onAgentShape:G=>{const he={...m,genes:{...m.genes,agentShape:G}};f(he),s.current=he},brushTextureId:$e,onBrushTexture:G=>et(G),onSpawnSingleton:za,singletonSize:Nt,onSingletonSize:ln,sizeMul:ke,onSizeMul:G=>{De(G),wr.current=G},simSpeed:Se,onSimSpeed:G=>{we(G),Or.current=G},staticAgents:Oe,onStaticAgents:()=>ne(G=>(Gr.current=!G,!G)),isolatedSpecies:nt,onIsolated:()=>{const G=!hn.current;pt(G),hn.current=G;const he=e0(s.current,u.current,G);l.current.interactionMatrix=he,cr(Array.from(he))},linear:(m.genes.linear??0)>.5,onLinear:()=>{const G=m.genes.linear??0,he={...m,genes:{...m.genes,linear:G>.5?0:1}};f(he),s.current=he},geoMode:Mt.mode,onGeoMode:dn,geoPanelOpen:w==="geo",onToggleGeoPanel:()=>M(G=>G==="geo"?null:"geo")})}),o.jsxs("div",{style:{flex:1,position:"relative",overflow:"hidden",minWidth:0,zIndex:1},children:[o.jsx("canvas",{ref:t,width:ue.w,height:ue.h,style:{display:"block",width:"100%",height:"100%",cursor:(yn==null?void 0:yn.cursor)??"crosshair",visibility:Mt.mode==="3d"?"hidden":"visible",position:"absolute",inset:0},onPointerDown:tt,onPointerMove:St,onPointerUp:$t,onPointerCancel:$t,onPointerLeave:$t},"meta-art-main-canvas"),o.jsx("canvas",{ref:n,style:{display:"block",width:"100%",height:"100%",position:"absolute",inset:0,pointerEvents:Mt.mode==="3d"?"auto":"none",opacity:Mt.mode==="3d"?1:0,transition:"opacity 0.35s ease",background:"transparent"}}),Mt.mode==="3d"&&!j&&o.jsxs("div",{style:{position:"absolute",top:10,left:"50%",transform:"translateX(-50%)",display:"flex",alignItems:"center",gap:6},children:[o.jsxs("div",{style:{padding:"4px 12px",borderRadius:1,background:"rgba(0,0,0,0.6)",border:`1px solid ${ui}`,fontSize:7,color:Bo,letterSpacing:"0.12em",textTransform:"uppercase",display:"flex",alignItems:"center",gap:7,pointerEvents:"none",fontFamily:eo},children:[o.jsx(Kp,{size:10,strokeWidth:1.2}),o.jsx("span",{children:"3D  DRAG=ORBIT  SCROLL=ZOOM"})]}),o.jsxs("button",{onClick:()=>{var G;return(G=r.current)==null?void 0:G.resetCamera()},title:"Reset cmera",style:{padding:"3px 8px",borderRadius:1,cursor:"pointer",background:"rgba(0,0,0,0.6)",border:`1px solid ${ui}`,fontSize:7,color:Bo,letterSpacing:"0.1em",textTransform:"uppercase",display:"flex",alignItems:"center",gap:4,fontFamily:eo},children:[o.jsx(El,{size:9,strokeWidth:1.2}),o.jsx("span",{children:"CAM"})]})]}),Mt.mode==="3d"&&Mt.showBorder&&(()=>{const G=Mt.boundaryMode??"wrap",he=G==="bounce"?"rgba(60,140,255,0.7)":G==="absorb"?"rgba(255,80,60,0.7)":G==="open"?"rgba(255,255,255,0.12)":"rgba(255,255,255,0.22)",ve=G==="open"?1:2,He=G==="wrap",ut=G!=="open",pn=16,cn=[{top:0,left:0,bt:ve,bl:ve,bb:0,br:0},{top:0,right:0,bt:ve,br:ve,bb:0,bl:0},{bottom:0,left:0,bb:ve,bl:ve,bt:0,br:0},{bottom:0,right:0,bb:ve,br:ve,bt:0,bl:0}];return o.jsxs("div",{style:{position:"absolute",inset:0,pointerEvents:"none",zIndex:5},children:[o.jsx("div",{style:{position:"absolute",inset:1,border:`${ve}px ${He?"dashed":"solid"} ${he}`,boxSizing:"border-box"}}),ut&&cn.map((Jt,Pn)=>o.jsx("div",{style:{position:"absolute",width:pn,height:pn,...Jt.top!==void 0?{top:Jt.top}:{},...Jt.bottom!==void 0?{bottom:Jt.bottom}:{},...Jt.left!==void 0?{left:Jt.left}:{},...Jt.right!==void 0?{right:Jt.right}:{},borderTop:Jt.bt>0?`${Jt.bt}px solid ${he}`:"none",borderBottom:Jt.bb>0?`${Jt.bb}px solid ${he}`:"none",borderLeft:Jt.bl>0?`${Jt.bl}px solid ${he}`:"none",borderRight:Jt.br>0?`${Jt.br}px solid ${he}`:"none",opacity:.55}},Pn)),o.jsx("div",{style:{position:"absolute",bottom:6,left:"50%",transform:"translateX(-50%)",padding:"2px 8px",borderRadius:8,background:G==="bounce"?"rgba(30,80,200,0.18)":G==="absorb"?"rgba(200,40,30,0.18)":"rgba(255,255,255,0.06)",border:`1px solid ${he}`,fontSize:7,color:he,letterSpacing:"0.12em",textTransform:"uppercase"},children:G})]},"3d-border-overlay")})(),!j&&o.jsx("div",{style:{position:"absolute",bottom:10,left:"50%",transform:"translateX(-50%)",pointerEvents:"none"},children:o.jsxs("div",{style:{padding:"4px 14px",borderRadius:1,background:"rgba(0,0,0,0.6)",border:`1px solid ${ui}`,fontSize:8,color:Bo,letterSpacing:"0.1em",fontFamily:eo,textTransform:"uppercase"},children:[yn==null?void 0:yn.name,"  ",yn==null?void 0:yn.description]})}),J&&!j&&o.jsx("div",{style:{position:"absolute",bottom:10,right:10,display:"flex",flexDirection:"column",gap:3,pointerEvents:"none"},children:[{label:"DENS",v:J.density,c:"rgba(255,255,255,0.4)"},{label:"CNTR",v:J.contrast,c:"rgba(255,255,255,0.3)"},{label:"SLNC",v:J.silenceIndex,c:"rgba(255,255,255,0.25)"}].map(({label:G,v:he,c:ve})=>o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[o.jsx("span",{style:{fontSize:7,color:Bo,width:28,textAlign:"right",letterSpacing:"0.1em",fontFamily:eo},children:G}),o.jsx("div",{style:{width:50,height:1,background:"rgba(255,255,255,0.06)"},children:o.jsx("div",{style:{width:`${he*100}%`,height:"100%",background:ve,transition:"width 0.5s"}})})]},G))}),xn&&!j&&o.jsxs("div",{style:{position:"absolute",top:8,left:8,display:"flex",flexDirection:"column",gap:3,pointerEvents:"none",background:"rgba(0,0,0,0.55)",padding:"8px 12px",borderRadius:2,border:"1px solid rgba(255,255,255,0.06)"},children:[o.jsx("div",{style:{fontSize:7,color:nl,letterSpacing:"0.14em",fontFamily:eo,marginBottom:2},children:"MORIN"}),[{key:"dialogica",label:"DIALG",c:"rgba(255,100,100,0.7)",v:Nn.dialogica},{key:"recursivo",label:"RECURS",c:"rgba(100,200,255,0.7)",v:Nn.recursivo},{key:"hologramatico",label:"HOLOGR",c:"rgba(100,255,160,0.7)",v:Nn.hologramatico},{key:"sapiensDemens",label:"SAP/DEM",c:"rgba(255,200,80,0.7)",v:Nn.sapiensDemens},{key:"tetralogia",label:"TETRAL",c:"rgba(180,120,255,0.7)",v:Nn.tetralogia}].map(({key:G,label:he,c:ve,v:He})=>o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5},children:[o.jsx("span",{style:{fontSize:6,color:Bo,width:32,textAlign:"right",letterSpacing:"0.08em",fontFamily:eo},children:he}),o.jsx("div",{style:{width:60,height:3,background:"rgba(255,255,255,0.04)",borderRadius:1},children:o.jsx("div",{style:{width:`${He*100}%`,height:"100%",background:ve,borderRadius:1,transition:"width 0.5s"}})}),o.jsx("span",{style:{fontSize:6,color:Bo,width:18,fontFamily:eo},children:He.toFixed(2)})]},G))]}),!j&&(P.connections||P.glow)&&o.jsxs("div",{style:{position:"absolute",top:8,right:8,display:"flex",flexDirection:"column",gap:2,pointerEvents:"none"},children:[P.connections&&o.jsx("div",{style:{fontSize:7,color:Bo,letterSpacing:"0.12em",fontFamily:eo},children:"CON "}),P.glow&&o.jsx("div",{style:{fontSize:7,color:Bo,letterSpacing:"0.12em",fontFamily:eo},children:"GLOW "})]}),o.jsx(KK,{cursorRef:os}),o.jsx(Jj,{ctrl:To,toolName:(yn==null?void 0:yn.name)??"",presetName:m.name??"",radius:v.size/180,intensity:To.triggers.rt,quantaCount:_e,showHUD:Ho}),ja.connected&&o.jsxs("div",{style:{position:"absolute",top:8,left:8,display:"flex",alignItems:"center",gap:5,zIndex:20},children:[o.jsx("div",{style:{width:5,height:5,borderRadius:"50%",background:"rgba(80,220,120,0.7)",flexShrink:0}}),o.jsx("span",{style:{fontSize:7,color:"rgba(80,220,120,0.55)",letterSpacing:"0.08em"},children:"CTRL"}),o.jsx("button",{onClick:()=>{const G=["auto","controller","mouse"],he=Co.current,ve=G[(G.indexOf(he)+1)%G.length];Ya(ve)},title:"Modo de input: auto / controller / mouse",style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(80,220,120,0.3)",borderRadius:3,padding:"1px 5px",cursor:"pointer",fontSize:7,color:"rgba(80,220,120,0.7)",letterSpacing:"0.1em",textTransform:"uppercase"},children:ja.inputMode})]})]}),!j&&w!==null&&o.jsxs("div",{style:{width:ce,flexShrink:0,display:"flex",flexDirection:"column",borderLeft:`1px solid ${ui}`,background:ix,overflowY:"auto",position:"relative",zIndex:15},children:[w==="layers"&&o.jsx(WK,{layers:g,onChange:ko,onClearLayer:Ea}),w==="archive"&&o.jsx(GK,{archive:E,grimoire:L,onRestoreEntry:qs,onDeleteEntry:G=>O(he=>he.filter(ve=>ve.id!==G)),onToggleFavorite:G=>O(he=>he.map(ve=>ve.id===G?{...ve,favorite:!ve.favorite}:ve)),onTogglePin:G=>{O(ve=>ve.map(He=>He.id===G?{...He,pinned:!He.pinned}:He));const he=E.find(ve=>ve.id===G);he&&te(he.dna)}}),w==="geo"&&o.jsx(DX,{geoParams:Mt,onParamChange:kn,onApplyPreset:ar}),w==="matrix"&&o.jsx(kX,{matrix:An,onCellChange:Bc,onRandomize:vd,onSymmetrize:Go,onReset:bi,onPreset:Sd}),w==="vitrine"&&o.jsx(BX,{vitrine:F,selectedId:W,onSelect:no,onFavorite:G=>B(he=>he.map(ve=>ve.id===G?{...ve,favorite:!ve.favorite}:ve)),onPin:go,onDiscard:G=>B(he=>he.filter(ve=>ve.id!==G)),onMutateFrom:G=>{const he=F.find(ve=>ve.id===G);he&&yr(Array.from({length:8},(ve,He)=>({...he.dna,id:`mut-${Date.now()}-${He}`})))},onNewMutate:()=>yr([]),currentDNA:m}),(w==="physics"||w==="dna")&&o.jsx(EX,{physics:Tn,dna:m,onPhysics:G=>{Sr(he=>{const ve={...he,...G};return de.current=ve,ve})},onDNAGene:yi,onDNAChange:rt,onMutate:yr,pinnedDNA:oe}),w==="powers"&&o.jsx(FX,{dna:m,palette:m.palette,onRecolorSpecies:Rs,onRandomPalette:()=>{const G=Sy(Math.max(4,s.current.palette.length)),he={...s.current,palette:G};f(he),s.current=he,jC(c.current,G)},onSetAllShape:Qo,brushTextureId:$e,onBrushTexture:G=>et(G),onDNAGene:yi,onChaosInject:Js,onFreezeAll:$i,onPulseAll:pi,onScatterAll:ps,onShockAll:bd,onMagnetizeAll:Lc,onImplodeAll:ll,onTurboAll:gi,onHueRotate:Ro,onSatShift:dc,onLitShift:On,onSizeAll:zc,onRespawn:()=>le(s.current,Date.now()),guideStroke:nr,guideCurvature:Rn,guideColor:Cn,guideLineMode:st,guidePathMode:Pe,autoGuidesPreset:vt,autoGuidesRandom:ge,onGuideStroke:G=>{_n(G),me.current=G,mn({thickness:G})},onGuideCurvature:G=>{sn(G),je.current=G,mn({smoothness:G})},onGuideColor:G=>{wt(G),Te.current=G,mn({color:G})},onGuideLineMode:G=>{Zt(G),Ae.current=G,mn({lineMode:G})},onGuidePathMode:G=>{ct(G),Tt.current=G,mn({pathMode:G})},onGuideClear:qt,onGuideGenerate:()=>dr("random"),onGuideStyleRandom:()=>{const G=s.current.palette[Math.floor(Math.random()*Math.max(1,s.current.palette.length))]??"#40b0ff",he=.8+Math.random()*2.3,ve=Math.random(),He=["flow","pinch","shear","barrier","spiral","funnel","repulsor","attractor","wave","orbit_line"][Math.floor(Math.random()*10)],ut=["stream","orbit","shock"][Math.floor(Math.random()*3)];wt(G),_n(he),sn(ve),Zt(He),ct(ut),Te.current=G,me.current=he,je.current=ve,Ae.current=He,Tt.current=ut,mn({color:G,thickness:he,smoothness:ve,lineMode:He,pathMode:ut})},onToggleAutoGuidesPreset:()=>xe(G=>!G),onToggleAutoGuidesRandom:()=>Ee(G=>!G),onExplodeAll:No,onBlackHoleAll:mi,onHarmonizeAll:Tr,onVortexAll:Wo,onRepelAll:qi,onAttractAll:cc,onCalmAll:Xa,onFluxAll:Hi,onActivateBrush:xd}),w==="hub"&&o.jsx(_X,{dna:m,seed:u.current,onLoadPreset:Ka,onLoadArte:Jo})]})]}),Et&&o.jsx("div",{style:{position:"fixed",inset:0,zIndex:120,background:"radial-gradient(circle at 50% 30%, rgba(24,18,36,0.92), rgba(0,0,0,0.96))",display:"flex",alignItems:"center",justifyContent:"center",padding:20},children:o.jsxs("div",{style:{width:"min(640px, 94vw)",border:`1px solid ${ui}`,background:"rgba(0,0,0,0.76)",borderRadius:4,padding:"16px 16px 14px",fontFamily:eo},children:[o.jsx("div",{style:{fontSize:8,letterSpacing:"0.18em",color:nl,textTransform:"uppercase"},children:"Ritual de Entrada"}),o.jsx("div",{style:{fontSize:11,color:wu,marginTop:8,lineHeight:1.5},children:(Qs=Cc[Ct])==null?void 0:Qs.prompt}),o.jsxs("div",{style:{fontSize:8,color:Bo,marginTop:4},children:["Etapa ",Ct+1,"/",Cc.length,"  define preset inicial, DNA e paleta sobre quadro branco."]}),o.jsx("div",{style:{marginTop:12,display:"grid",gridTemplateColumns:"1fr",gap:6},children:(As=Cc[Ct])==null?void 0:As.options.map(G=>o.jsx("button",{onClick:()=>{const he=Cc[Ct].key;Le(ve=>({...ve,[he]:G.value}))},style:{textAlign:"left",padding:"7px 10px",borderRadius:2,border:`1px solid ${Math.abs(Ut[Cc[Ct].key]-G.value)<.001?"rgba(255,0,132,0.45)":ui}`,background:Math.abs(Ut[Cc[Ct].key]-G.value)<.001?"rgba(255,0,132,0.09)":"rgba(255,255,255,0.02)",color:Math.abs(Ut[Cc[Ct].key]-G.value)<.001?wu:c5,cursor:"pointer",fontSize:9,letterSpacing:"0.04em",fontFamily:eo},children:G.label},`${Cc[Ct].key}-${G.label}`))}),o.jsxs("div",{style:{marginTop:14,display:"flex",justifyContent:"space-between",gap:8},children:[o.jsx("button",{onClick:()=>{Ke.current=!0,_t(!1)},style:{border:`1px solid ${ui}`,background:"rgba(255,255,255,0.02)",color:Bo,padding:"6px 10px",fontSize:8,letterSpacing:"0.12em",textTransform:"uppercase",cursor:"pointer",fontFamily:eo},children:"Pular ritual"}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{onClick:()=>Xe(G=>Math.max(0,G-1)),disabled:Ct===0,style:{border:`1px solid ${ui}`,background:Ct===0?"rgba(255,255,255,0.01)":"rgba(255,255,255,0.02)",color:Ct===0?"rgba(255,255,255,0.2)":c5,padding:"6px 10px",fontSize:8,letterSpacing:"0.12em",textTransform:"uppercase",cursor:Ct===0?"default":"pointer",fontFamily:eo},children:"Voltar"}),Ct<Cc.length-1?o.jsx("button",{onClick:()=>Xe(G=>Math.min(Cc.length-1,G+1)),style:{border:"1px solid rgba(255,0,132,0.35)",background:"rgba(255,0,132,0.08)",color:nl,padding:"6px 10px",fontSize:8,letterSpacing:"0.12em",textTransform:"uppercase",cursor:"pointer",fontFamily:eo},children:"Continuar"}):o.jsx("button",{onClick:Vr,style:{border:"1px solid rgba(255,0,132,0.45)",background:"rgba(255,0,132,0.15)",color:wu,padding:"6px 10px",fontSize:8,letterSpacing:"0.12em",textTransform:"uppercase",cursor:"pointer",fontFamily:eo},children:"Iniciar quadro vivo"})]})]})]})}),o.jsx(Qj,{open:ks,onClose:()=>D(!1),ctrl:To,presetsSection:{label:"Presets",items:[...Qc,...Ih],getLabel:G=>G.name??"?",onSelect:G=>Ft(G)},toolsSection:{label:"Ferramentas",items:Qe,getLabel:G=>{var he;return((he=wy.find(ve=>ve.id===G))==null?void 0:he.name)??G},onSelect:G=>b(he=>{const ve={...he,activeToolId:G};return xt.current=ve,ve})}})]})};function BX({vitrine:e,selectedId:t,onSelect:n,onFavorite:r,onPin:a,onDiscard:i,onMutateFrom:s,onNewMutate:c,currentDNA:l}){return o.jsxs("div",{style:{padding:"10px 8px",display:"flex",flexDirection:"column",gap:8,fontFamily:eo},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[o.jsx("span",{style:{fontSize:8,color:nl,letterSpacing:"0.16em",textTransform:"uppercase"},children:"VITRINE"}),o.jsx("button",{title:"Nova mutao",onClick:c,style:{fontSize:7,padding:"2px 8px",borderRadius:1,cursor:"pointer",border:"1px solid rgba(255,0,132,0.2)",background:"rgba(255,0,132,0.04)",color:"rgba(255,0,132,0.6)",fontFamily:eo,letterSpacing:"0.1em",textTransform:"uppercase"},children:"+ GERAR"})]}),e.length===0?o.jsx("div",{style:{fontSize:8,color:Bo,textAlign:"center",padding:"20px 0",letterSpacing:"0.06em"},children:"Use MUTATE no painel DNA."}):o.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:5},children:e.map(d=>o.jsx(LX,{card:d,selected:t===d.id,onSelect:()=>n(d),onFavorite:()=>r(d.id),onPin:()=>a(d.id),onDiscard:()=>i(d.id),onMutateFrom:()=>s(d.id)},d.id))})]})}const Ti={background:"none",border:"none",cursor:"pointer",padding:"3px 5px",color:Bo,display:"flex",alignItems:"center",gap:2,borderRadius:1,fontFamily:eo,fontSize:8};function xp(){return o.jsx("div",{style:{width:1,height:16,background:"rgba(255,255,255,0.06)",flexShrink:0,margin:"0 2px"}})}const Rr=64;function Am(e){let t=e>>>0;return()=>{t+=1831565813;let n=t;return n=Math.imul(n^n>>>15,n|1),n^=n+Math.imul(n^n>>>7,n|61),((n^n>>>14)>>>0)/4294967296}}function $X(){const e=Rr*Rr;return{N:new Float32Array(e),L:new Float32Array(e),R:new Float32Array(e),size:Rr}}function k6(e,t){const n=Math.min(Rr-1,Math.max(0,Math.floor(e*Rr))),r=Math.min(Rr-1,Math.max(0,Math.floor(t*Rr)));return n+r*Rr}function lx(e,t,n){return e[k6(t,n)]}const jf={STABLE_ORDER:"#5aff8a",POLARIZED:"#ffce5a",CONFLICT:"#ff9a3c",CRISIS:"#ff5a5a",EXCEPTION:"#c05aff",RECOVERY:"#4a9eff"},Ef={STABLE_ORDER:"Ordem Estvel",POLARIZED:"Polarizado",CONFLICT:"Conflito",CRISIS:"Crise",EXCEPTION:"Exceo",RECOVERY:"Recuperao"};function cx(e=0){return{cohesion:.5,polarization:.3,conflictRate:.1,inequality:.3,legitimacyMean:.5,normMean:.4,scarcity:.3,volatility:.2,t:e}}const xf=.07,R6=Math.ceil(1/xf)+1;function qX(e){const t=new Map;for(let n=0;n<e.length;n++){const r=e[n],a=Math.floor(r.x/xf),i=Math.floor(r.y/xf),s=a+i*R6;let c=t.get(s);c||(c=[],t.set(s,c)),c.push(n)}return t}function HX(e,t,n,r){const a=[],i=Math.ceil(r/xf),s=Math.floor(t/xf),c=Math.floor(n/xf);for(let l=-i;l<=i;l++)for(let d=-i;d<=i;d++){const u=s+l+(c+d)*R6,h=e.get(u);if(h)for(const m of h)a.push(m)}return a}function WX(e,t,n,r){const a=n%2,i=Math.floor(n/2),s=.2,c=.2,l=a===0?.25:.75,d=i===0?.25:.75;return{x:Math.max(.01,Math.min(.99,l+(t()-.5)*s*2)),y:Math.max(.01,Math.min(.99,d+(t()-.5)*c*2)),vx:(t()-.5)*.02,vy:(t()-.5)*.02,factionId:n,wealth:.3+t()*.4,belief:.4+t()*.3,fear:t()*.2,status:t()*.5,id:e}}function GX(e,t,n){const r=Rr*Rr;for(let a=0;a<r;a++)e.N[a]=Math.max(0,Math.min(1,n.nBaseline+(t()-.5)*n.nNoise)),e.L[a]=Math.max(0,Math.min(1,n.lBaseline+(t()-.5)*n.lNoise)),e.R[a]=Math.max(0,Math.min(1,n.rBaseline+(t()-.5)*n.rNoise))}function VX(e){const t=Am(e.seed),n=$X();GX(n,t,e);const r=[];for(let i=0;i<e.agentCount;i++){const s=i%e.factionCount;r.push(WX(i,t,s))}for(let i=r.length-1;i>0;i--){const s=Math.floor(t()*(i+1));[r[i],r[s]]=[r[s],r[i]]}for(let i=0;i<e.agentCount;i++)r[i].factionId=i%e.factionCount,r[i].id=i;const a=Array.from({length:e.factionCount},()=>({x:.5,y:.5,count:0}));return{agents:r,field:n,agentCount:e.agentCount,factionCount:e.factionCount,t:0,seed:e.seed,conflictAccum:0,conflictDecay:0,centroids:a}}function sw(e){const t={N:new Float32Array(e.field.N),L:new Float32Array(e.field.L),R:new Float32Array(e.field.R),size:e.field.size};return{agents:e.agents.map(r=>({...r})),field:t,agentCount:e.agentCount,factionCount:e.factionCount,t:e.t,seed:e.seed,conflictAccum:e.conflictAccum,conflictDecay:e.conflictDecay,centroids:e.centroids.map(r=>({...r}))}}function My(e){return e<0?e+1:e>=1?e-1:e}function Al(e){return e>.5?e-1:e<-.5?e+1:e}function UX(e){const{agents:t,factionCount:n,centroids:r}=e;for(let a=0;a<n;a++)r[a].x=0,r[a].y=0,r[a].count=0;for(const a of t){const i=r[a.factionId];i.x+=a.x,i.y+=a.y,i.count++}for(let a=0;a<n;a++){const i=r[a];i.count>0?(i.x/=i.count,i.y/=i.count):(i.x=.5,i.y=.5)}}const u5=.065,WC=.03,YX=.45,KX=.55,XX=.012,JX=.0015,QX=.008,GC=.88,dx=.012,ZX=.014,VC=.08,eJ=.004,tJ=.018,UC=.18,nJ=.35,rJ=.15;function oJ(e,t,n,r){const a=k6(t,n);e[a]=Math.max(0,Math.min(1,e[a]+r))}function aJ(e,t,n){const r=Math.min(Rr-1,Math.max(0,Math.floor(t*Rr))),a=Math.min(Rr-1,Math.max(0,Math.floor(n*Rr))),i=Math.min(Rr-1,r+1),s=Math.max(0,r-1),c=Math.min(Rr-1,a+1),l=Math.max(0,a-1),d=(e[i+a*Rr]-e[s+a*Rr])*.5,u=(e[r+c*Rr]-e[r+l*Rr])*.5;return[d,u]}function A6(e,t,n){const{agents:r,field:a}=e;let i=0;const s=qX(r);for(let c=0;c<r.length;c++){const l=r[c];let d=0,u=0;const h=lx(a.R,l.x,l.y),m=lx(a.N,l.x,l.y),f=lx(a.L,l.x,l.y),[g,x]=aJ(a.R,l.x,l.y);d+=g*UC,u+=x*UC;const v=HX(s,l.x,l.y,u5);for(const M of v){if(M===c)continue;const k=r[M],R=Al(k.x-l.x),j=Al(k.y-l.y),I=R*R+j*j;if(I===0||I>u5*u5)continue;const E=Math.sqrt(I),O=1-E/u5,L=R/E,$=j/E;if(l.factionId===k.factionId){const F=YX*O*(.5+l.belief*.5);if(d+=F*L,u+=F*$,n()<QX*t){const B=k.wealth-l.wealth;l.wealth=Math.max(0,Math.min(1,l.wealth+B*.05*(1+f)))}}else{const F=.25+.75*m,B=KX*O*F;if(d-=B*L,u-=B*$,E<WC*2&&(l.fear=Math.min(1,l.fear+.015*O)),E<WC&&(i++,l.status>k.status&&k.wealth>.05)){const W=Math.min(k.wealth*.02,.01);l.wealth=Math.min(1,l.wealth+W)}}}d-=l.fear*l.vx*.2,u-=l.fear*l.vy*.2;const b=h*XX*t;l.wealth=Math.min(1,l.wealth+b),oJ(a.R,l.x,l.y,-b*.4),l.wealth=Math.max(0,l.wealth-JX*t),l.fear=Math.max(0,l.fear-.008*t),l.vx=(l.vx+d*t)*GC,l.vy=(l.vy+u*t)*GC;const w=Math.sqrt(l.vx*l.vx+l.vy*l.vy);w>dx&&(l.vx=l.vx/w*dx,l.vy=l.vy/w*dx),l.x=My(l.x+l.vx),l.y=My(l.y+l.vy)}e.conflictAccum+=i,e.conflictDecay=e.conflictDecay*.92+i*.08,e.t+=t}function j6(e,t,n,r){const{field:a,agents:i}=e,s=Rr,c=s*s,l=new Float32Array(c);for(let u=0;u<s;u++)for(let h=0;h<s;h++){const m=h+u*s,f=[a.R[(h-1+s)%s+u*s],a.R[(h+1)%s+u*s],a.R[h+(u-1+s)%s*s],a.R[h+(u+1)%s*s]],g=(f[0]+f[1]+f[2]+f[3])/4;let x=a.R[m];x+=ZX*t,x=x*(1-VC)+g*VC,l[m]=Math.max(0,Math.min(1,x))}a.R.set(l);for(let u=0;u<c;u++)a.N[u]=a.N[u]+(r-a.N[u])*eJ*t,a.N[u]=Math.max(0,Math.min(1,a.N[u]));const d=n*.4*t;for(let u=0;u<s;u++)for(let h=0;h<s;h++){const m=h+u*s,f=a.R[m],g=a.N[m],x=Math.max(0,f*.6+(1-Math.max(0,g-.6)*1.2)*.3+.1);a.L[m]=a.L[m]+(x-a.L[m])*tJ*t,a.L[m]=Math.max(0,Math.min(1,a.L[m]-d*.05))}UX(e)}function sJ(e,t,n,r){const{agents:a,field:i}=e;for(let s=0;s<Rr;s++)for(let c=0;c<Rr;c++){const l=(c+.5)/Rr,d=(s+.5)/Rr,u=Al(l-t),h=Al(d-n),m=u*u+h*h;if(m<r*r){const f=1-Math.sqrt(m)/r,g=c+s*Rr;i.L[g]=Math.min(1,i.L[g]+nJ*f*.01)}}for(const s of a){const c=Al(s.x-t),l=Al(s.y-n),d=c*c+l*l;if(d<r*r){const u=1-Math.sqrt(d)/r;s.fear=Math.max(0,s.fear-rJ*u*.02),s.belief=Math.min(1,s.belief+.01*u)}}}function E6(e){if(e.length===0)return 0;const t=e.map(i=>i.wealth).sort((i,s)=>i-s),n=t.length;let r=0,a=0;for(let i=0;i<n;i++)r+=(2*(i+1)-n-1)*t[i],a+=t[i];return a===0?0:Math.max(0,Math.min(1,r/(n*a)))}function qv(e,t){const{agents:n,field:r,factionCount:a,centroids:i}=e;if(n.length===0)return{cohesion:.5,polarization:.3,conflictRate:0,inequality:0,legitimacyMean:.5,normMean:.5,scarcity:.5,volatility:0,t:e.t};const s=new Array(a).fill(0),c=new Array(a).fill(0);for(const $ of n){const F=i[$.factionId];if(F.count===0)continue;const B=Al($.x-F.x),W=Al($.y-F.y);s[$.factionId]+=Math.sqrt(B*B+W*W),c[$.factionId]++}let l=0,d=0;for(let $=0;$<a;$++)c[$]>0&&(l+=s[$]/c[$],d++);const u=d>0?l/d:.5,h=Math.max(0,Math.min(1,1-u/.35));let m=0,f=0;for(let $=0;$<a;$++)for(let F=$+1;F<a;F++){const B=i[$],W=i[F];if(B.count===0||W.count===0)continue;const re=Al(B.x-W.x),oe=Al(B.y-W.y);m+=Math.sqrt(re*re+oe*oe),f++}const g=f>0?m/f:.3,x=Math.max(0,Math.min(1,g/.6)),v=Math.max(0,Math.min(1,t/(n.length*.015))),b=E6(n),w=Rr*Rr;let M=0,k=0,R=0;for(let $=0;$<w;$++)M+=r.L[$],k+=r.N[$],R+=r.R[$];const j=M/w,I=k/w,E=Math.max(0,1-R/w);let O=0;for(const $ of n)O+=Math.sqrt($.vx*$.vx+$.vy*$.vy);const L=Math.max(0,Math.min(1,O/n.length/.012));return{cohesion:h,polarization:x,conflictRate:v,inequality:b,legitimacyMean:j,normMean:I,scarcity:E,volatility:L,t:e.t}}function Cy(e,t){const{conflictRate:n,inequality:r,legitimacyMean:a,normMean:i,polarization:s,cohesion:c}=e;if(n>.55||r>.65&&a<.28)return"CRISIS";if(i>.72&&n<.18&&r>.35)return"EXCEPTION";if(t){const l=t.conflictRate>.4||t.inequality>.6&&t.legitimacyMean<.35,d=n<t.conflictRate-.05||a>t.legitimacyMean+.03;if(l&&d)return"RECOVERY"}return n>.3||s>.55&&n>.18?"CONFLICT":s>.5||c>.5&&s>.35?"POLARIZED":"STABLE_ORDER"}const YC={STABLE_ORDER:["Coeso elevada sustenta a estrutura vigente.","As faces mantm distncia segura; a ordem prevalece.","Recursos equilibrados favorecem a cooperao intragrupal.","A legitimidade consolidada amortece tenses latentes.","Um equilbrio frgil mas funcional persiste no sistema."],POLARIZED:["Centralidades divergem: os grupos se afastam progressivamente.","A polarizao avana enquanto a confiana intermedia enfraquece.","Fronteiras identitrias se cristalizam nas regies de contato.","O abismo entre faces aprofunda-se sem ruptura imediata.","Grupos fecham-se sobre si mesmos; a heterofilia declina."],CONFLICT:["Incidentes de contato hostil aceleram na fronteira entre grupos.","A frequncia de conflito supera a capacidade de mediao.","Tenso converte-se em ao: confrontos se multiplicam.","O limiar de violncia foi cruzado; a volatilidade sobe.","Recursos disputados intensificam os embates interfaccionais."],CRISIS:["O sistema entra em colapso de coeso: mltiplos pontos de ruptura.","Desigualdade extrema destri a legitimidade institucional.","A espiral conflito-medo realimenta instabilidade global.","Crise total: previsibilidade histrica colapsa.","Todos os vetores apontam deteriorao simultnea."],EXCEPTION:["A norma se impe pela fora: ordem visvel, liberdade restrita.","Alta coero suprime o conflito sem resolver a desigualdade subjacente.","O estado de exceo normaliza-se gradualmente no tecido social.","Controle formal cresce enquanto legitimidade orgnica murcha.","Superfcie estvel; profundidade sob presso acumulada."],RECOVERY:["Sinais de recuperao: conflito cede, confiana reaparece lentamente.","Aps a crise, redistribuio emergente reduz tenses agudas.","O sistema busca novo equilbrio sobre as runas do anterior.","A legitimidade ressurge  frgil, condicional, ainda incerta.","Recuperao em curso: trajetria depende das intervenes subsequentes."]};function iJ(e,t){if(!t)return"Condies iniciais ainda em transio.";const n=e.conflictRate-t.conflictRate,r=e.inequality-t.inequality,a=e.legitimacyMean-t.legitimacyMean,i=e.normMean-t.normMean,s=e.polarization-t.polarization,c=e.cohesion-t.cohesion,l=e.scarcity-t.scarcity,d=[];return Math.abs(n)>.04&&d.push(n>0?"conflito elevou-se":"conflito recuou"),Math.abs(r)>.03&&d.push(r>0?"desigualdade avanou":"desigualdade reduziu"),Math.abs(a)>.03&&d.push(a>0?"legitimidade cresceu":"legitimidade caiu"),Math.abs(i)>.05&&d.push(i>0?"coero normativa aumentou":"presso normativa recuou"),Math.abs(s)>.05&&d.push(s>0?"polarizao acentuou-se":"polarizao amenizou"),Math.abs(c)>.04&&d.push(c>0?"coeso interna fortaleceu":"coeso interna fragmentou"),Math.abs(l)>.04&&d.push(l>0?"escassez de recursos agravou":"abundncia de recursos melhorou"),r>.03&&a<-.02?"Desigualdade crescente erodiu a legitimidade institucional.":n>.05&&r>.02?"Disputa por recursos amplificou a desigualdade via conflito.":i>.06&&n<-.04?"Aumento coercitivo da norma suprimiu conflito visvel  a curto prazo.":a>.05&&n<-.03?"Recuperao de legitimidade amorteceu o ciclo de conflito.":e.normMean>.7&&e.inequality>.55?"A exceo se normalizou: ordem crescente, liberdade declinante.":d.length===0?"Tendncias se mantm estveis; sem mudana discernvel.":d.length===1?`${ux(d[0])}.`:d.length===2?`${ux(d[0])} enquanto ${d[1]}.`:`${ux(d[0])}, ${d[1]} e ${d[2]}.`}function ux(e){return e.charAt(0).toUpperCase()+e.slice(1)}function KC(e,t){const n=Math.floor(t)%e.length;return e[Math.max(0,n)]}function lJ(e,t,n,r,a){const i=YC[e]??YC.STABLE_ORDER,s=r&&a?`Ato aplicado: ${a}. ${KC(i,t.t)}`:KC(i,t.t),c=iJ(t,n);return{headline:s,causal:c}}function td(e,t){for(let n=0;n<e.length;n++)e[n]=Math.max(0,Math.min(1,e[n]+t))}function cJ(e,t,n,r,a){for(let i=0;i<Rr;i++)for(let s=0;s<Rr;s++){const c=(s+.5)/Rr,l=(i+.5)/Rr,d=Al(c-t),u=Al(l-n),h=Math.sqrt(d*d+u*u);if(h<r){const m=1-h/r,f=s+i*Rr;e[f]=Math.max(0,Math.min(1,e[f]+a*m))}}}const Hv=[{id:"redistribute",name:"Redistribute",description:"Transferncia de riqueza: reduz desigualdade, drena R temporariamente.",cost:.15,cooldownSeconds:45,durationSeconds:30,color:"#5aff8a"},{id:"austerity",name:"Austerity",description:"Contrao fiscal: R aumenta curto prazo, desigualdade sobe.",cost:.05,cooldownSeconds:40,durationSeconds:25,color:"#ffce5a"},{id:"propaganda",name:"Propaganda Broadcast",description:"Boost de L para faco 0; polarizao cresce no longo prazo.",cost:.1,cooldownSeconds:35,durationSeconds:20,color:"#ff9a3c"},{id:"emergency_decree",name:"Emergency Decree",description:"N sobe fortemente; conflito cai curto prazo, risco EXCEPTION.",cost:.08,cooldownSeconds:60,durationSeconds:35,color:"#c05aff"},{id:"open_commons",name:"Open Commons",description:"R acessvel a todos; cooperao sobe, status de elites cai.",cost:.12,cooldownSeconds:38,durationSeconds:28,color:"#4a9eff"},{id:"taboo_wall",name:"Taboo Wall",description:"Fronteira simblica: coeso interna , conflito interfaccional .",cost:.06,cooldownSeconds:42,durationSeconds:40,color:"#ff5a5a"},{id:"ritual_unity",name:"Ritual of Unity",description:"Polarizao cai; custa wealth coletivo e fadiga.",cost:.18,cooldownSeconds:50,durationSeconds:25,color:"#ffd4f0"},{id:"amnesty",name:"Amnesty",description:"Medo cai, L sobe; transgresso curto prazo pode subir.",cost:.07,cooldownSeconds:35,durationSeconds:22,color:"#a0ffee"}];function T6(e,t,n){const{agents:r,field:a}=e,i=n*.016;switch(t){case"redistribute":{const s=r.map(d=>d.wealth).sort((d,u)=>d-u),c=s[Math.floor(s.length*.25)],l=s[Math.floor(s.length*.75)];for(const d of r)d.wealth>l&&(d.wealth=Math.max(c,d.wealth-.002*n)),d.wealth<c&&(d.wealth=Math.min(l,d.wealth+.002*n));td(a.R,-.003*i);break}case"austerity":{td(a.R,.006*i);for(const s of r){const c=s.status*.004*i;s.wealth=Math.min(1,s.wealth+c)}break}case"propaganda":{const s=e.centroids[0].x,c=e.centroids[0].y;cJ(a.L,s,c,.35,.008*i);for(const l of r)l.factionId===0?l.belief=Math.min(1,l.belief+.003*i):l.fear=Math.min(1,l.fear+.001*i);break}case"emergency_decree":{td(a.N,.015*i);for(const s of r)s.vx*=.97,s.vy*=.97,s.fear=Math.min(1,s.fear+.005*i);break}case"open_commons":{td(a.R,.01*i);for(const s of r)s.status=s.status*(1-.005*i)+.5*.005*i;td(a.L,.005*i);break}case"taboo_wall":{td(a.N,.006*i);for(const s of r)s.belief=Math.min(1,s.belief+.003*i*(s.factionId===0?1:-.5));break}case"ritual_unity":{for(const s of r)s.vx+=(.5-s.x)*.001*i,s.vy+=(.5-s.y)*.001*i,s.wealth=Math.max(0,s.wealth-.001*i),s.fear=Math.max(0,s.fear-.005*i);td(a.L,.008*i);break}case"amnesty":{for(const s of r)s.fear=Math.max(0,s.fear-.01*i),s.belief=Math.min(1,s.belief+.002*i);td(a.L,.01*i),td(a.N,-.004*i);break}}}function dJ(e,t,n){const a={redistribute:"austerity",austerity:"redistribute",propaganda:"amnesty",emergency_decree:"amnesty",open_commons:"austerity",taboo_wall:"ritual_unity",ritual_unity:"taboo_wall",amnesty:"emergency_decree"}[t]??t;T6(e,a,n)}const hx=[{id:"late_empire",name:"Late Empire",description:"Legitimidade alta, desigualdade crescente, norma coercitiva.",color:"#c05aff",worldOpts:{agentCount:300,factionCount:4,nBaseline:.6,lBaseline:.72,rBaseline:.45,nNoise:.15,lNoise:.1,rNoise:.2},nBaseline:.6,sceneDuration:30,expectedRegime:"Ordem inicial  Polarizao  Exceo"},{id:"frontier_republic",name:"Frontier Republic",description:"Norma fraca, recursos irregulares, alta mobilidade.",color:"#5aff8a",worldOpts:{agentCount:280,factionCount:4,nBaseline:.22,lBaseline:.5,rBaseline:.4,nNoise:.3,lNoise:.25,rNoise:.4},nBaseline:.22,sceneDuration:25,expectedRegime:"Conflito moderado  Ordem instvel"},{id:"discipline_state",name:"Discipline State",description:"N muito alto, L estvel; risco de Exceo rpida.",color:"#ff5a5a",worldOpts:{agentCount:320,factionCount:4,nBaseline:.82,lBaseline:.6,rBaseline:.38,nNoise:.08,lNoise:.12,rNoise:.18},nBaseline:.82,sceneDuration:30,expectedRegime:"Ordem forada  Exceo  Crise"},{id:"trade_league",name:"Trade League",description:"R alto, desigualdade sobe via prosperidade, L via comrcio.",color:"#ffce5a",worldOpts:{agentCount:260,factionCount:3,nBaseline:.3,lBaseline:.62,rBaseline:.75,nNoise:.12,lNoise:.15,rNoise:.15},nBaseline:.3,sceneDuration:35,expectedRegime:"Ordem estvel  Polarizao econmica"}],uJ=.28,I6=45,P6=.28,XC=8e-4;function hJ(){return{active:!1,x:.5,y:.5,charisma:0,age:0,radius:P6,factionId:0}}function fJ(e,t,n,r){return!t||e.active?!1:Am(n^r*2654435769)()<uJ}function pJ(e,t){const n=Am(t^Date.now());return{active:!0,x:.1+n()*.8,y:.1+n()*.8,charisma:.75+n()*.25,age:0,radius:P6,factionId:Math.floor(n()*e.factionCount)}}function mJ(e,t,n){if(!e.active)return!1;e.age+=n;const r=e.age*.3;return e.x=My(e.x+Math.cos(r)*XC),e.y=My(e.y+Math.sin(r*1.3)*XC),sJ(t,e.x,e.y,e.radius),e.age>I6?(e.active=!1,!1):!0}function fx(e){if(!e.active)return 0;const t=Math.min(1,e.age/I6),n=Math.sin(t*Math.PI);return e.charisma*n*.65}const gJ=.12,yJ=120,JC=6,px=3,bJ=8,xJ=45,F6=80,vJ=30,SJ=120,wJ=4,MJ=30;function iw(e,t){const n=sw(e);return n.agents.length>t&&(n.agents=n.agents.slice(0,t),n.agentCount=t),n}function CJ(e,t){return{baseSnapshot:iw(e,F6),rolloutsDone:0,totalRollouts:bJ,horizonSeconds:xJ,results:[],baseSeed:(e.seed^Math.floor(e.t*1e3+66))>>>0,nBaseline:t}}function kJ(e,t){return{baseSnapshot:iw(e,yJ),rolloutsDone:0,totalRollouts:vJ,horizonSeconds:SJ,results:[],baseSeed:(e.seed^Math.floor(e.t*1e3+153))>>>0,nBaseline:t}}function QC(e,t){return{baseSnapshot:iw(e,F6),rolloutsDone:0,totalRollouts:wJ,horizonSeconds:MJ,results:[],baseSeed:(e.seed^Math.floor(e.t*1e3+171))>>>0,nBaseline:t}}function _6(e,t){const n=e.baseSeed+e.rolloutsDone*2654435769>>>0,r=Am(n),a=sw(e.baseSnapshot);a.seed=n;const i=.04;for(let b=0;b<a.field.N.length;b++)a.field.N[b]=Math.max(0,Math.min(1,a.field.N[b]+(r()-.5)*i)),a.field.L[b]=Math.max(0,Math.min(1,a.field.L[b]+(r()-.5)*i)),a.field.R[b]=Math.max(0,Math.min(1,a.field.R[b]+(r()-.5)*i));for(const b of a.agents)b.vx+=(r()-.5)*.003,b.vy+=(r()-.5)*.003;const s=[],c=[],l=[],d=[];let u=0,h=0,m=0;const f=a.t;for(;a.t-f<e.horizonSeconds;){if(a.conflictAccum=0,A6(a,gJ,r),m+=a.conflictAccum,a.t-h>=px){const b=RJ(a.agents.map(w=>w.wealth));j6(a,px,b,t),h=a.t}if(a.t-u>=JC){const b=m/JC,w=qv(a,b);s.push(w),c.push(w.conflictRate),l.push(w.inequality),d.push(w.legitimacyMean),u=a.t,m=0}}const g=m/Math.max(1,px),x=qv(a,g);s.length===0&&s.push(x),c.push(x.conflictRate),l.push(x.inequality),d.push(x.legitimacyMean);const v=Cy(x,s.length>1?s[s.length-2]:null);return{metrics:s,finalPhase:v,conflictLine:c,inequalityLine:l,legitimacyLine:d,seed:n}}function ZC(e,t,n){const r=Math.min(e.rolloutsDone+n,e.totalRollouts);for(let a=e.rolloutsDone;a<r;a++)e.results.push(_6(e,t)),e.rolloutsDone++;return e.rolloutsDone>=e.totalRollouts}function ek(e,t,n){const r=performance.now();for(;e.rolloutsDone<e.totalRollouts&&(e.results.push(_6(e,t)),e.rolloutsDone++,!(performance.now()-r>n)););return e.rolloutsDone>=e.totalRollouts}function h5(e,t,n){const{results:r}=e;if(r.length===0)return{trajectories:[],probability:{},confidence:0,generatedAt:Date.now(),isMuleActive:t};const a={};for(const m of r)a[m.finalPhase]=(a[m.finalPhase]??0)+1;const i={};for(const[m,f]of Object.entries(a))i[m]=f/r.length;const s=r.map(m=>m.conflictLine[m.conflictLine.length-1]??0),c=s.reduce((m,f)=>m+f,0)/s.length,l=s.reduce((m,f)=>m+(f-c)**2,0)/s.length;let d=Math.max(0,Math.min(1,1-l*8));d=Math.max(0,d-n);const u=new Map;for(const m of r)u.has(m.finalPhase)||u.set(m.finalPhase,[]),u.get(m.finalPhase).push(m);const h=[];for(const[,m]of u)if(h.push(m[0]),h.length>=7)break;return{trajectories:h,probability:i,confidence:d,generatedAt:Date.now(),isMuleActive:t}}function RJ(e){if(e.length===0)return 0;const t=[...e].sort((i,s)=>i-s),n=t.length;let r=0,a=0;for(let i=0;i<n;i++)r+=(2*(i+1)-n-1)*t[i],a+=t[i];return a===0?0:Math.max(0,Math.min(1,r/(n*a)))}function mx({label:e,value:t,color:n}){return o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx("span",{style:{color:"rgba(255,255,255,0.45)",fontSize:9,width:30,flexShrink:0},children:e}),o.jsx("div",{style:{flex:1,height:3,background:"rgba(255,255,255,0.08)",borderRadius:2,overflow:"hidden"},children:o.jsx("div",{style:{width:`${t*100}%`,height:"100%",background:n,borderRadius:2,transition:"width 0.3s"}})})]})}const AJ=({frames:e,selected:t,onSelect:n})=>{const r=S.useRef(null);return S.useEffect(()=>{var a;(a=r.current)==null||a.scrollIntoView({behavior:"smooth",block:"nearest"})},[e.length]),e.length===0?o.jsx("div",{style:{padding:"16px 12px",color:"rgba(255,255,255,0.25)",fontSize:11},children:"Aguardando primeira cena..."}):o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6,padding:"8px 6px",overflowY:"auto",maxHeight:"100%"},children:[e.map((a,i)=>{const s=t===i,c=jf[a.phaseLabel]??"#ffffff",l=!!a.isAct;return o.jsxs("div",{onClick:()=>n(i),style:{padding:"8px 10px",borderRadius:5,cursor:"pointer",background:s?"rgba(255,255,255,0.07)":"rgba(255,255,255,0.025)",border:`1px solid ${s?c+"55":"rgba(255,255,255,0.05)"}`,transition:"all 0.15s"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:5},children:[l&&o.jsx("span",{style:{fontSize:8,padding:"1px 4px",borderRadius:3,background:"rgba(255,200,90,0.18)",color:"#ffce5a",textTransform:"uppercase",letterSpacing:"0.06em",flexShrink:0},children:"Ato"}),o.jsx("span",{style:{fontSize:9,padding:"1px 5px",borderRadius:3,background:c+"22",color:c,textTransform:"uppercase",letterSpacing:"0.06em",flexShrink:0},children:Ef[a.phaseLabel]}),o.jsxs("span",{style:{fontSize:9,color:"rgba(255,255,255,0.35)",marginLeft:"auto"},children:["A",a.act,"C",a.scene]})]}),o.jsx("p",{style:{fontSize:10.5,color:"rgba(255,255,255,0.82)",lineHeight:1.35,marginBottom:4,margin:"0 0 5px"},children:a.headline}),o.jsx("p",{style:{fontSize:9.5,color:"rgba(255,255,255,0.45)",fontStyle:"italic",lineHeight:1.3,margin:"0 0 6px"},children:a.causal}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:3},children:[o.jsx(mx,{label:"Cnflto",value:a.metrics.conflictRate,color:"#ff5a5a"}),o.jsx(mx,{label:"Desig",value:a.metrics.inequality,color:"#ffce5a"}),o.jsx(mx,{label:"Legit",value:a.metrics.legitimacyMean,color:"#5aff8a"})]})]},i)}),o.jsx("div",{ref:r})]})};function N6(e,t){const n=[];if(!t)return e.inequality>.5&&n.push({label:"Inequality",direction:"high",color:"#ffce5a",magnitude:e.inequality}),e.conflictRate>.3&&n.push({label:"Conflict",direction:"high",color:"#ff5a5a",magnitude:e.conflictRate}),e.legitimacyMean<.35&&n.push({label:"Legitimacy",direction:"low",color:"#5aff8a",magnitude:1-e.legitimacyMean}),e.normMean>.65&&n.push({label:"Norm",direction:"high",color:"#c05aff",magnitude:e.normMean}),e.polarization>.45&&n.push({label:"Polarization",direction:"high",color:"#ff9a3c",magnitude:e.polarization}),e.scarcity>.5&&n.push({label:"Scarcity",direction:"high",color:"#ff7788",magnitude:e.scarcity}),n.sort((a,i)=>i.magnitude-a.magnitude),n.slice(0,3);const r=[{label:"Inequality",val:e.inequality-t.inequality,abs:e.inequality,color:"#ffce5a"},{label:"Conflict",val:e.conflictRate-t.conflictRate,abs:e.conflictRate,color:"#ff5a5a"},{label:"Legitimacy",val:e.legitimacyMean-t.legitimacyMean,abs:e.legitimacyMean,color:"#5aff8a"},{label:"Polarization",val:e.polarization-t.polarization,abs:e.polarization,color:"#ff9a3c"},{label:"Norm",val:e.normMean-t.normMean,abs:e.normMean,color:"#c05aff"},{label:"Scarcity",val:e.scarcity-t.scarcity,abs:e.scarcity,color:"#ff7788"}];r.sort((a,i)=>{const s=Math.abs(a.val)*2+(a.abs>.6||a.abs<.25?.1:0);return Math.abs(i.val)*2+(i.abs>.6||i.abs<.25?.1:0)-s});for(let a=0;a<Math.min(3,r.length);a++){const i=r[a];(Math.abs(i.val)>.015||i.abs>.55||i.abs<.2)&&n.push({label:i.label,direction:i.val>=0?"up":"down",color:i.color,magnitude:Math.abs(i.val)})}return n.slice(0,3)}function jJ(e,t,n){return n&&n.confidence<.35?"Futuro aberto: bifurcacao iminente (alta variancia).":t==="CRISIS"?e.inequality>.6&&e.scarcity>.5?"Atrator de crise: desigualdade e escassez dominam.":"Crise sistemica: multiplos vetores convergem para ruptura.":t==="EXCEPTION"?e.normMean>.7&&e.legitimacyMean<.45?"Ordem por coercao: N alto e L caindo -- excecao normalizante.":"Estado de excecao: controle formal substitui legitimidade organica.":t==="CONFLICT"?e.polarization>.5?"Conflito polarizado: faccoes em trajetoria de colisao.":"Tensao em escalada: limiar de violencia cruzado.":t==="POLARIZED"?e.cohesion>.5?"Coesao interna alta mas distancia interfaccional cresce.":"Polarizacao em curso: fronteiras identitarias cristalizam.":t==="RECOVERY"?"Recuperacao fragil: trajetoria depende das proximas intervencoes.":e.inequality>.45?"Ordem aparente com desigualdade latente -- equilbrio instvel.":e.legitimacyMean>.65?"Equilibrio sustentado por legitimidade: janela de oportunidade.":"Sistema estavel: dinmicas internas dentro de parametros."}function EJ(e,t,n){const r=[],a=N6(e,t);for(const i of a){const s=i.direction==="up"||i.direction==="high"?"subiu":"caiu";r.push(`${i.label} ${s} -- correlacao com regime detectada.`)}return n&&n.confidence<.4&&r.push("Confianca baixa: variancia alta entre rollouts sugere bifurcacao."),e.inequality>.55&&e.legitimacyMean<.4&&r.push("Desigualdade alta + legitimidade baixa: padrao de crise historico."),r.length<3&&r.push("Tente inverter o ato para ver o contrafactual."),r.slice(0,4)}function Wv(e){const t=n=>e[n]??0;return{order:t("STABLE_ORDER")+t("RECOVERY")*.6,conflict:t("POLARIZED")*.5+t("CONFLICT"),crisis:t("CRISIS")+t("EXCEPTION")*.65+t("POLARIZED")*.1}}function gx({label:e,value:t,color:n}){return o.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:3},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"baseline"},children:[o.jsx("span",{style:{fontSize:10,color:n+"cc"},children:e}),o.jsxs("span",{style:{fontSize:12,color:n,fontFamily:"monospace"},children:[Math.round(t*100),"%"]})]}),o.jsx("div",{style:{height:6,background:"rgba(255,255,255,0.06)",borderRadius:3,overflow:"hidden"},children:o.jsx("div",{style:{width:`${Math.min(100,t*100)}%`,height:"100%",background:`linear-gradient(90deg, ${n}88, ${n})`,borderRadius:3,transition:"width 0.6s ease"}})})]})}function TJ({chip:e}){const t=e.direction==="up"?"":e.direction==="down"?"":e.direction==="high"?"":"";return o.jsxs("span",{style:{fontSize:9,padding:"2px 6px",borderRadius:4,background:e.color+"18",color:e.color,display:"inline-flex",alignItems:"center",gap:2,border:`1px solid ${e.color}33`,whiteSpace:"nowrap"},children:[e.label,t]})}function IJ({compare:e}){const{withAct:t,withoutAct:n,cardId:r}=e,a=Wv(t.probability),i=Wv(n.probability),s=[{label:"Order",val:a.order-i.order,color:"#5aff8a"},{label:"Conflict",val:a.conflict-i.conflict,color:"#ff9a3c"},{label:"Crisis",val:a.crisis-i.crisis,color:"#ff5a5a"}].filter(c=>Math.abs(c.val)>.01);return s.length===0?null:o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"4px 8px",background:"rgba(255,206,90,0.06)",borderRadius:4,border:"1px solid rgba(255,206,90,0.15)"},children:[o.jsx(zi,{size:10,strokeWidth:1.5,color:"#ffce5a"}),o.jsx("span",{style:{fontSize:9,color:"rgba(255,255,255,0.5)"},children:"Delta:"}),s.map(c=>{const l=c.val>=0?"+":"",d=c.label==="Order"&&c.val>0||c.label!=="Order"&&c.val<0;return o.jsxs("span",{style:{fontSize:9.5,fontFamily:"monospace",color:d?"#5aff8a":"#ff8888"},children:[c.label," ",l,Math.round(c.val*100),"%"]},c.label)})]})}function yx({values:e,color:t,width:n=100,height:r=28}){if(e.length<2)return null;const a=Math.max(...e,.01),i=e.map((s,c)=>{const l=c/(e.length-1)*n,d=r-s/a*(r-4)-2;return`${l.toFixed(1)},${d.toFixed(1)}`}).join(" ");return o.jsxs("svg",{width:n,height:r,style:{display:"block"},children:[o.jsx("polyline",{points:i,fill:"none",stroke:t,strokeWidth:1.5,strokeLinejoin:"round",opacity:.85}),o.jsx("circle",{cx:n,cy:r-e[e.length-1]/a*(r-4)-2,r:2,fill:t})]})}function bx(e,t){const n=e.trajectories;if(n.length===0)return[];const r=n[0][t].length,a=[];for(let i=0;i<r;i++){const s=n.map(c=>c[t][i]??0);a.push(s.reduce((c,l)=>c+l,0)/s.length)}return a}const PJ=({metrics:e,prevMetrics:t,phase:n,oracleResult:r,deepResult:a,isAutoRunning:i,isDeepRunning:s,deepProgress:c,jiangEnabled:l,onToggleJiang:d,onRunDeep:u,autoCompare:h,autoCompareVisible:m,muleActive:f})=>{const[g,x]=S.useState(!1),[v,b]=S.useState(!1),w=a??r,M=w?Wv(w.probability):null,k=N6(e,t),R=jf[n],j=l?jJ(e,n,w):"",I=l?EJ(e,t,w):[];return o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:0,fontSize:10},children:[o.jsxs("div",{style:{padding:"8px 12px",display:"flex",alignItems:"center",gap:8,borderBottom:"1px solid rgba(255,255,255,0.06)",background:"rgba(0,0,0,0.15)"},children:[o.jsx("span",{style:{fontSize:9,padding:"2px 7px",borderRadius:4,background:R+"22",color:R,textTransform:"uppercase",letterSpacing:"0.08em",flexShrink:0},children:Ef[n]}),o.jsxs("div",{style:{flex:"0 0 60px"},children:[o.jsx("div",{style:{height:4,background:"rgba(255,255,255,0.07)",borderRadius:2,overflow:"hidden"},children:o.jsx("div",{style:{width:`${((w==null?void 0:w.confidence)??0)*100}%`,height:"100%",background:((w==null?void 0:w.confidence)??0)>.6?"#5aff8a":((w==null?void 0:w.confidence)??0)>.3?"#ffce5a":"#ff5a5a",borderRadius:2,transition:"width 0.5s"}})}),o.jsxs("div",{style:{fontSize:8,color:"rgba(255,255,255,0.35)",marginTop:1,textAlign:"center"},children:["Conf ",Math.round(((w==null?void 0:w.confidence)??0)*100),"%"]})]}),o.jsx("div",{style:{display:"flex",gap:4,flexWrap:"wrap",flex:1},children:k.map((E,O)=>o.jsx(TJ,{chip:E},O))}),f&&o.jsx("span",{style:{fontSize:8,padding:"1px 5px",borderRadius:3,background:"rgba(192,90,255,0.15)",color:"#c05aff"},children:"MULE"}),i&&o.jsx("div",{style:{width:6,height:6,borderRadius:3,background:"#4a9eff",opacity:.7,animation:"pulse 1.2s ease-in-out infinite"}})]}),o.jsxs("div",{style:{padding:"8px 12px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:[M?o.jsxs("div",{style:{display:"flex",gap:10,marginBottom:l?6:0},children:[o.jsx(gx,{label:"Order",value:M.order,color:"#5aff8a"}),o.jsx(gx,{label:"Conflict",value:M.conflict,color:"#ff9a3c"}),o.jsx(gx,{label:"Crisis",value:M.crisis,color:"#ff5a5a"})]}):o.jsxs("div",{style:{padding:"8px 0",color:"rgba(255,255,255,0.25)",fontSize:10,display:"flex",alignItems:"center",gap:6},children:[o.jsx("div",{style:{width:6,height:6,borderRadius:3,background:"rgba(74,158,255,0.4)",animation:i?"pulse 1.2s ease-in-out infinite":"none"}}),i?"Oraculo calculando...":"Oraculo aguardando dados..."]}),l&&j&&o.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:6,padding:"5px 8px",marginTop:4,background:"rgba(160,255,238,0.04)",borderRadius:4,border:"1px solid rgba(160,255,238,0.12)"},children:[o.jsx(Gk,{size:12,strokeWidth:1.5,color:"#a0ffee",style:{flexShrink:0,marginTop:1}}),o.jsxs("div",{style:{flex:1},children:[o.jsx("span",{style:{fontSize:10,color:"#a0ffee",lineHeight:"1.35"},children:j}),o.jsx("button",{onClick:()=>b(E=>!E),style:{marginLeft:6,fontSize:8,color:"rgba(160,255,238,0.55)",background:"none",border:"none",cursor:"pointer",padding:0,textDecoration:"underline",textUnderlineOffset:2},children:v?"fechar":"Why?"}),v&&I.length>0&&o.jsx("div",{style:{marginTop:4,display:"flex",flexDirection:"column",gap:2},children:I.map((E,O)=>o.jsxs("div",{style:{fontSize:9,color:"rgba(160,255,238,0.5)",lineHeight:1.3},children:["- ",E]},O))})]})]}),m&&h&&o.jsx("div",{style:{marginTop:5},children:o.jsx(IJ,{compare:h})}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,marginTop:6},children:[o.jsxs("button",{onClick:d,style:{fontSize:9,padding:"2px 7px",borderRadius:3,cursor:"pointer",background:l?"rgba(160,255,238,0.1)":"rgba(255,255,255,0.03)",border:`1px solid ${l?"rgba(160,255,238,0.35)":"rgba(255,255,255,0.08)"}`,color:l?"#a0ffee":"rgba(255,255,255,0.35)",display:"flex",alignItems:"center",gap:4},children:[o.jsx(jl,{size:9,strokeWidth:1.5}),"Jiang ",l?"On":"Off"]}),o.jsxs("button",{onClick:u,disabled:s,style:{fontSize:9,padding:"2px 7px",borderRadius:3,cursor:s?"default":"pointer",background:s?"rgba(74,158,255,0.08)":"rgba(74,158,255,0.12)",border:`1px solid ${s?"rgba(74,158,255,0.15)":"rgba(74,158,255,0.35)"}`,color:s?"rgba(74,158,255,0.5)":"#4a9eff",display:"flex",alignItems:"center",gap:4},children:[o.jsx(zi,{size:9,strokeWidth:1.5}),s?`Deep ${Math.round(c*100)}%`:"Deep Forecast"]}),o.jsx("div",{style:{flex:1}}),o.jsxs("button",{onClick:()=>x(E=>!E),style:{fontSize:8,color:"rgba(255,255,255,0.3)",background:"none",border:"none",cursor:"pointer",padding:0,display:"flex",alignItems:"center",gap:3},children:["Advanced ",g?o.jsx(Uk,{size:10,strokeWidth:1.5}):o.jsx(Ms,{size:10,strokeWidth:1.5})]})]})]}),g&&o.jsxs("div",{style:{padding:"8px 12px",borderBottom:"1px solid rgba(255,255,255,0.06)",display:"flex",flexDirection:"column",gap:8},children:[w&&o.jsxs("div",{children:[o.jsxs("div",{style:{fontSize:8.5,color:"rgba(255,255,255,0.3)",textTransform:"uppercase",letterSpacing:"0.06em",marginBottom:4},children:["Distribuicao de regimes (",w.trajectories.length," rollouts)"]}),Object.entries(w.probability).sort((E,O)=>O[1]-E[1]).map(([E,O])=>{const L=jf[E]??"#888";return o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginBottom:2},children:[o.jsx("span",{style:{fontSize:8.5,color:L,width:75,flexShrink:0},children:Ef[E]}),o.jsx("div",{style:{flex:1,height:4,background:"rgba(255,255,255,0.06)",borderRadius:2,overflow:"hidden"},children:o.jsx("div",{style:{width:`${O*100}%`,height:"100%",background:L,borderRadius:2}})}),o.jsxs("span",{style:{fontSize:8,color:"rgba(255,255,255,0.4)",width:26,textAlign:"right"},children:[Math.round(O*100),"%"]})]},E)})]}),w&&w.trajectories.length>0&&o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:8.5,color:"rgba(255,255,255,0.3)",textTransform:"uppercase",letterSpacing:"0.06em",marginBottom:5},children:"Tendencias"}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8},children:[o.jsxs("div",{children:[o.jsx(yx,{values:bx(w,"conflictLine"),color:"#ff5a5a",width:80,height:26}),o.jsx("div",{style:{fontSize:8,color:"rgba(255,255,255,0.3)",marginTop:1},children:"Conflito"})]}),o.jsxs("div",{children:[o.jsx(yx,{values:bx(w,"inequalityLine"),color:"#ffce5a",width:80,height:26}),o.jsx("div",{style:{fontSize:8,color:"rgba(255,255,255,0.3)",marginTop:1},children:"Desig."})]}),o.jsxs("div",{children:[o.jsx(yx,{values:bx(w,"legitimacyLine"),color:"#5aff8a",width:80,height:26}),o.jsx("div",{style:{fontSize:8,color:"rgba(255,255,255,0.3)",marginTop:1},children:"Legit."})]})]})]}),w&&o.jsxs("div",{style:{padding:"5px 8px",borderRadius:4,background:"rgba(255,255,255,0.02)",border:"1px solid rgba(255,255,255,0.05)"},children:[o.jsxs("div",{style:{fontSize:8.5,color:"rgba(255,255,255,0.35)",textTransform:"uppercase",letterSpacing:"0.06em",marginBottom:4,display:"flex",alignItems:"center",gap:4},children:[o.jsx(Yk,{size:9,strokeWidth:1.5}),"Porque esta previsao?"]}),k.map((E,O)=>{const L=E.direction==="up"||E.direction==="high"?"subiu":"caiu";return o.jsxs("div",{style:{fontSize:9,color:"rgba(255,255,255,0.45)",lineHeight:1.35,marginBottom:2},children:[o.jsx("span",{style:{color:E.color},children:E.label})," ",L," -- correlacao com regime detectada."]},O)}),w.confidence<.4&&o.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.4)",lineHeight:1.35,marginTop:2},children:"Confianca baixa: variancia alta entre rollouts sugere bifurcacao."})]}),o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:8.5,color:"rgba(255,255,255,0.3)",textTransform:"uppercase",letterSpacing:"0.06em",marginBottom:4},children:"Metricas completas"}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:3},children:[{label:"Conflito",val:e.conflictRate,color:"#ff5a5a"},{label:"Desigualdade",val:e.inequality,color:"#ffce5a"},{label:"Legitimidade",val:e.legitimacyMean,color:"#5aff8a"},{label:"Norma",val:e.normMean,color:"#c05aff"},{label:"Coesao",val:e.cohesion,color:"#4a9eff"},{label:"Polarizacao",val:e.polarization,color:"#ff9a3c"},{label:"Escassez",val:e.scarcity,color:"#ff7788"},{label:"Volatilidade",val:e.volatility,color:"#ffd4f0"}].map(E=>o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[o.jsx("span",{style:{fontSize:8,color:"rgba(255,255,255,0.35)",width:60,flexShrink:0},children:E.label}),o.jsx("div",{style:{flex:1,height:3,background:"rgba(255,255,255,0.06)",borderRadius:2,overflow:"hidden"},children:o.jsx("div",{style:{width:`${E.val*100}%`,height:"100%",background:E.color,borderRadius:2}})}),o.jsx("span",{style:{fontSize:8,color:E.color,fontFamily:"monospace",width:22,textAlign:"right",flexShrink:0},children:Math.round(E.val*100)})]},E.label))})]})]})]})},FJ=({cardCooldowns:e,activeInterventions:t,currentT:n,onApply:r})=>o.jsx("div",{style:{display:"flex",gap:6,padding:"6px 10px",overflowX:"auto",alignItems:"flex-start"},children:Hv.map(a=>{const i=e[a.id]??0,s=n<i,c=Math.max(0,i-n),l=t.some(h=>h.cardId===a.id),d=t.find(h=>h.cardId===a.id),u=d?1-(d.endT-n)/(d.endT-d.startT):0;return o.jsx(_J,{card:a,onCooldown:s,remainCooldown:c,isActive:l,activeProgress:u,onApply:()=>r(a.id)},a.id)})});function _J({card:e,onCooldown:t,remainCooldown:n,isActive:r,activeProgress:a,onApply:i}){const s=!t&&!r,c=e.color;return o.jsxs("div",{onClick:s?i:void 0,title:e.description,style:{flexShrink:0,width:110,padding:"7px 8px",borderRadius:6,cursor:s?"pointer":"default",background:r?`${c}18`:t?"rgba(255,255,255,0.02)":"rgba(255,255,255,0.04)",border:`1px solid ${r?c+"55":t?"rgba(255,255,255,0.05)":c+"33"}`,opacity:t&&!r?.45:1,transition:"all 0.15s",position:"relative",overflow:"hidden"},children:[r&&o.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:`${a*100}%`,height:2,background:c,borderRadius:"0 0 6px 6px",transition:"width 0.5s"}}),o.jsx("div",{style:{fontSize:10,color:r?c:"rgba(255,255,255,0.8)",marginBottom:3,lineHeight:1.2},children:e.name}),o.jsx("div",{style:{fontSize:8.5,color:"rgba(255,255,255,0.4)",lineHeight:1.25,marginBottom:5,overflow:"hidden",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:e.description}),r?o.jsxs("div",{style:{fontSize:8,color:c,textTransform:"uppercase",letterSpacing:"0.06em"},children:["Ativo ",Math.round(a*100),"%"]}):t?o.jsxs("div",{style:{fontSize:8,color:"rgba(255,255,255,0.3)",textTransform:"uppercase",letterSpacing:"0.06em"},children:["Cd: ",n.toFixed(0),"s"]}):o.jsxs("div",{style:{fontSize:8,color:c,textTransform:"uppercase",letterSpacing:"0.06em",display:"flex",justifyContent:"space-between"},children:[o.jsx("span",{children:"Aplicar"}),o.jsxs("span",{style:{opacity:.6},children:["-",Math.round(e.cost*100),"R"]})]})]})}const tk=[{id:"late_empire_decay",name:"Late Empire Decay",description:"Legitimidade alta inercial, desigualdade crescente, norma coercitiva. Observe a transicao lenta de ordem para excecao.",color:"#c05aff",worldOpts:{agentCount:320,factionCount:4,nBaseline:.62,lBaseline:.72,rBaseline:.42,nNoise:.14,lNoise:.1,rNoise:.22},nBaseline:.62,sceneDuration:30,focusMetrics:["inequality","legitimacyMean","normMean"],expectedArc:"Ordem Estavel -> Polarizacao -> Excecao -> Crise"},{id:"inequality_spiral",name:"Inequality Spiral",description:"Recursos concentrados, mobilidade nula. A desigualdade alimenta conflito que alimenta desigualdade.",color:"#ffce5a",worldOpts:{agentCount:300,factionCount:4,nBaseline:.35,lBaseline:.45,rBaseline:.3,nNoise:.2,lNoise:.18,rNoise:.35},nBaseline:.35,sceneDuration:25,focusMetrics:["inequality","conflictRate","scarcity"],suggestedActs:["redistribute","open_commons"],actInterval:40,expectedArc:"Conflito Moderado -> Crise -> (Redistribuicao?) -> Recuperacao Fragil"},{id:"exception_trap",name:"Exception Trap",description:"N altissimo, conflito suprimido artificialmente. Ordem aparente, liberdade zero. Quanto tempo ate a ruptura?",color:"#ff5a5a",worldOpts:{agentCount:300,factionCount:4,nBaseline:.85,lBaseline:.55,rBaseline:.35,nNoise:.06,lNoise:.12,rNoise:.2},nBaseline:.85,sceneDuration:30,focusMetrics:["normMean","legitimacyMean","conflictRate"],suggestedActs:["amnesty"],actInterval:50,expectedArc:"Excecao -> Excecao Prolongada -> Crise Subita"},{id:"propaganda_polarization",name:"Propaganda Polarization",description:"Uma faccao domina a narrativa. Observe a coesao interna subir enquanto a distancia interfaccional cresce.",color:"#ff9a3c",worldOpts:{agentCount:280,factionCount:4,nBaseline:.4,lBaseline:.5,rBaseline:.5,nNoise:.15,lNoise:.2,rNoise:.15},nBaseline:.4,sceneDuration:25,focusMetrics:["polarization","cohesion","conflictRate"],suggestedActs:["propaganda","taboo_wall"],actInterval:35,expectedArc:"Polarizacao -> Conflito -> Crise ou Excecao"},{id:"commons_experiment",name:"Commons Experiment",description:"Recursos abundantes e abertos. A cooperacao emerge ou a tragedia dos comuns se instala?",color:"#5aff8a",worldOpts:{agentCount:260,factionCount:3,nBaseline:.25,lBaseline:.6,rBaseline:.8,nNoise:.12,lNoise:.15,rNoise:.1},nBaseline:.25,sceneDuration:30,focusMetrics:["scarcity","inequality","legitimacyMean"],suggestedActs:["open_commons","ritual_unity"],actInterval:45,expectedArc:"Ordem Estavel -> Polarizacao Economica -> ?"},{id:"border_war",name:"Border War",description:"Faccoes proximas, R disputado nas fronteiras. Conflito localizado que pode escalar.",color:"#4a9eff",worldOpts:{agentCount:340,factionCount:4,nBaseline:.3,lBaseline:.48,rBaseline:.38,nNoise:.25,lNoise:.2,rNoise:.3},nBaseline:.3,sceneDuration:22,focusMetrics:["conflictRate","polarization","volatility"],suggestedActs:["emergency_decree","taboo_wall"],actInterval:30,expectedArc:"Conflito -> Crise -> Excecao ou Recuperacao"},{id:"trade_boom_bust",name:"Trade Boom/Bust",description:"R alto mas volatil. Prosperidade gera desigualdade que gera instabilidade que drena R.",color:"#ffd4f0",worldOpts:{agentCount:260,factionCount:3,nBaseline:.3,lBaseline:.65,rBaseline:.78,nNoise:.12,lNoise:.14,rNoise:.25},nBaseline:.3,sceneDuration:35,focusMetrics:["inequality","scarcity","legitimacyMean"],suggestedActs:["austerity","redistribute"],actInterval:40,expectedArc:"Ordem -> Polarizacao Economica -> Conflito -> Boom/Bust"},{id:"anomaly_stress_test",name:"Anomaly Stress Test",description:"O Mulo ativado desde o inicio. Como o sistema lida com um agente carismatico imprevisivel?",color:"#a0ffee",worldOpts:{agentCount:300,factionCount:4,nBaseline:.45,lBaseline:.55,rBaseline:.5,nNoise:.18,lNoise:.18,rNoise:.2},nBaseline:.45,sceneDuration:28,focusMetrics:["legitimacyMean","cohesion","conflictRate"],expectedArc:"Imprevisivel: O Mulo distorce todas as previsoes."}],NJ=({onSelect:e,onClose:t})=>{const[n,r]=S.useState(null);return o.jsxs("div",{style:{position:"absolute",inset:0,background:"rgba(7,7,18,0.92)",backdropFilter:"blur(12px)",zIndex:50,display:"flex",flexDirection:"column",fontFamily:"monospace"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"12px 16px",borderBottom:"1px solid rgba(255,255,255,0.08)"},children:[o.jsx(Sf,{size:14,strokeWidth:1.5,color:"rgba(255,255,255,0.6)"}),o.jsx("span",{style:{fontSize:12,color:"rgba(255,255,255,0.7)",flex:1},children:"Scenarios"}),o.jsxs("span",{style:{fontSize:9,color:"rgba(255,255,255,0.3)"},children:[tk.length," cenarios"]}),o.jsx("button",{onClick:t,style:{background:"none",border:"none",cursor:"pointer",padding:2,color:"rgba(255,255,255,0.4)"},children:o.jsx(Cs,{size:14,strokeWidth:1.5})})]}),o.jsx("div",{style:{flex:1,overflowY:"auto",padding:"12px 16px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,alignContent:"start"},children:tk.map(a=>{const i=n===a.id;return o.jsxs("div",{onMouseEnter:()=>r(a.id),onMouseLeave:()=>r(null),onClick:()=>e(a),style:{padding:"10px 12px",borderRadius:6,cursor:"pointer",background:i?`${a.color}12`:"rgba(255,255,255,0.025)",border:`1px solid ${i?a.color+"44":"rgba(255,255,255,0.06)"}`,transition:"all 0.15s",display:"flex",flexDirection:"column",gap:4},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[o.jsx("div",{style:{width:6,height:6,borderRadius:3,background:a.color,flexShrink:0}}),o.jsx("span",{style:{fontSize:10.5,color:i?a.color:"rgba(255,255,255,0.8)",lineHeight:1.2},children:a.name}),i&&o.jsx(hs,{size:10,color:a.color,style:{marginLeft:"auto"}})]}),o.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.4)",lineHeight:1.3},children:a.description}),o.jsx("div",{style:{fontSize:8.5,color:"rgba(255,255,255,0.3)",fontStyle:"italic",lineHeight:1.25},children:a.expectedArc}),o.jsxs("div",{style:{display:"flex",gap:3,flexWrap:"wrap"},children:[a.focusMetrics.map(s=>o.jsx("span",{style:{fontSize:7.5,padding:"1px 4px",borderRadius:2,background:"rgba(255,255,255,0.05)",color:"rgba(255,255,255,0.35)",textTransform:"uppercase",letterSpacing:"0.04em"},children:s},s)),a.suggestedActs&&o.jsxs("span",{style:{fontSize:7.5,padding:"1px 4px",borderRadius:2,background:"rgba(255,206,90,0.08)",color:"rgba(255,206,90,0.5)",display:"flex",alignItems:"center",gap:2},children:[o.jsx(sc,{size:7,strokeWidth:1.5}),"auto-play"]})]})]},a.id)})}),o.jsx("div",{style:{padding:"8px 16px",borderTop:"1px solid rgba(255,255,255,0.06)",fontSize:9,color:"rgba(255,255,255,0.25)"},children:"Selecione um cenario. Voce pode brincar livremente apos iniciar."})]})},f5=[[74,158,255],[255,90,90],[90,255,138],[255,206,90]];function OJ(e,t,n,r,a,i){const s=e.getContext("2d");if(!s)return;const c=e.width,l=e.height;s.fillStyle="#000",s.fillRect(0,0,c,l);const d=t.world;if(i){const f=s.createImageData(Rr,Rr);for(let v=0;v<Rr*Rr;v++){const b=d.field.R[v];if(b>.5){const w=(b-.5)*2;f.data[v*4+0]=90,f.data[v*4+1]=255,f.data[v*4+2]=138,f.data[v*4+3]=Math.round(w*30)}}const g=document.createElement("canvas");g.width=Rr,g.height=Rr,g.getContext("2d").putImageData(f,0,0),s.save(),s.imageSmoothingEnabled=!0,s.drawImage(g,0,0,c,l),s.restore()}if(a){const f=s.createImageData(Rr,Rr);for(let v=0;v<Rr*Rr;v++){const b=d.field.N[v],w=d.field.L[v],M=Math.max(0,b*.7-w*.4);if(M>.15){const k=(M-.15)*3;f.data[v*4+0]=255,f.data[v*4+1]=60,f.data[v*4+2]=60,f.data[v*4+3]=Math.round(Math.min(1,k)*22)}}const g=document.createElement("canvas");g.width=Rr,g.height=Rr,g.getContext("2d").putImageData(f,0,0),s.save(),s.imageSmoothingEnabled=!0,s.drawImage(g,0,0,c,l),s.restore()}if(n!=="off"){const f=n==="R"?d.field.R:n==="L"?d.field.L:d.field.N,g={R:[90,255,138],L:[74,158,255],N:[255,90,90]},[x,v,b]=g[n],w=s.createImageData(Rr,Rr);for(let R=0;R<Rr*Rr;R++){const j=f[R];w.data[R*4+0]=x,w.data[R*4+1]=v,w.data[R*4+2]=b,w.data[R*4+3]=Math.round(j*55)}const M=document.createElement("canvas");M.width=Rr,M.height=Rr,M.getContext("2d").putImageData(w,0,0),s.save(),s.imageSmoothingEnabled=!1,s.drawImage(M,0,0,c,l),s.restore()}for(let f=0;f<d.factionCount;f++){const g=d.centroids[f];if(g.count===0)continue;const x=g.x*c,v=g.y*l,[b,w,M]=f5[f%f5.length],k=s.createRadialGradient(x,v,0,x,v,55);k.addColorStop(0,`rgba(${b},${w},${M},0.12)`),k.addColorStop(1,`rgba(${b},${w},${M},0)`),s.fillStyle=k,s.beginPath(),s.arc(x,v,55,0,Math.PI*2),s.fill()}for(const f of d.agents){const g=f.x*c,x=f.y*l,[v,b,w]=f5[f.factionId%f5.length],M=.55+f.wealth*.45;s.fillStyle=`rgba(${v},${b},${w},${M.toFixed(2)})`,s.beginPath(),s.arc(g,x,2.2+f.status*1.2,0,Math.PI*2),s.fill()}if(t.mule.active){const f=t.mule.x*c,g=t.mule.y*l,x=1+Math.sin(t.world.t*3)*.2;s.strokeStyle="rgba(192,90,255,0.25)",s.lineWidth=1,s.beginPath(),s.arc(f,g,t.mule.radius*c*x,0,Math.PI*2),s.stroke();const v=s.createRadialGradient(f,g,0,f,g,7*x);v.addColorStop(0,"rgba(255,255,255,0.95)"),v.addColorStop(.4,"rgba(192,90,255,0.8)"),v.addColorStop(1,"rgba(192,90,255,0)"),s.fillStyle=v,s.beginPath(),s.arc(f,g,7*x,0,Math.PI*2),s.fill()}if(t.world.conflictDecay>2){const f=Math.min(.08,t.world.conflictDecay*.003);s.fillStyle=`rgba(255,90,90,${f})`,s.fillRect(0,0,c,l)}const u=t.world.t;for(const f of t.eventPings){const g=u-f.t;if(g<0||g>f.duration)continue;const x=g/f.duration,v=1-x,b=8+x*25,w=f.x*c,M=f.y*l;s.strokeStyle=f.color+Math.round(v*100).toString(16).padStart(2,"0"),s.lineWidth=1.5,s.beginPath(),s.arc(w,M,b,0,Math.PI*2),s.stroke(),x<.6&&(s.font="9px monospace",s.fillStyle=f.color+Math.round(v*200).toString(16).padStart(2,"0"),s.fillText(f.label,w+b+4,M+3))}const h=Cy(t.metrics,t.prevMetrics),m=jf[h];s.font="11px monospace",s.fillStyle=m+"cc",s.fillText(Ef[h],10,l-12),s.font="10px monospace",s.fillStyle="rgba(255,255,255,0.35)",s.fillText(`A${t.currentAct} C${t.currentScene} T${d.t.toFixed(0)}s`,10,l-28)}function _h({label:e,value:t,color:n}){return o.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:3},children:[o.jsx("div",{style:{width:36,height:4,background:"rgba(255,255,255,0.07)",borderRadius:2,overflow:"hidden"},children:o.jsx("div",{style:{width:`${t*100}%`,height:"100%",background:n,borderRadius:2}})}),o.jsx("span",{style:{fontSize:8.5,color:"rgba(255,255,255,0.4)"},children:e}),o.jsx("span",{style:{fontSize:9,color:n,fontFamily:"monospace"},children:(t*100).toFixed(0)})]})}const nk=8,DJ=({active:e})=>{const t=S.useRef(null),n=S.useRef(0),r=S.useRef(null),a=S.useRef(null);S.useRef(0),S.useRef(null);const[i,s]=S.useState(!0),[c,l]=S.useState(0),[d,u]=S.useState(hx[0]),[h,m]=S.useState(30),[f,g]=S.useState("off"),[x,v]=S.useState(!1),[b,w]=S.useState(null),[M,k]=S.useState(!1),[R,j]=S.useState(!0),[I,E]=S.useState(!0),[O,L]=S.useState(!0),[$,F]=S.useState(cx()),[B,W]=S.useState(null),[re,oe]=S.useState([]),[te,J]=S.useState("STABLE_ORDER"),[pe,P]=S.useState(!1),[V,fe]=S.useState(null),[ye,Se]=S.useState(null),[we,ke]=S.useState(!1),[De,_e]=S.useState(!1),[ae,Re]=S.useState(0),[Fe,Oe]=S.useState(null),[ne,nt]=S.useState(!1),[pt,Et]=S.useState(!0),[_t,Ct]=S.useState({}),[Xe,Ut]=S.useState([]),[Le,Ke]=S.useState(0),mt=S.useRef(0),an=S.useRef(0),gn=S.useRef("STABLE_ORDER"),Be=S.useCallback((Pe,ct,vt)=>{const xe=ct??Date.now()^Math.floor(Math.random()*4294967295),ge=Am(xe);a.current=ge;const me={world:VX({...Pe.worldOpts,seed:xe}),metrics:cx(),prevMetrics:null,history:[],activeInterventions:[],cardCooldowns:{},mule:hJ(),currentAct:1,currentScene:0,sceneT:0,sceneDuration:Pe.sceneDuration,lastMacroT:0,macroTickInterval:1.5,forecastResult:null,forecastRunning:!1,forecastJob:null,counterfactualResults:null,anomalyEnabled:vt??!1,lastAnomalyCheck:0,autoForecastResult:null,autoForecastJob:null,autoForecastRunning:!1,lastAutoForecastT:-nk,autoForecastCooldown:nk,autoCompareResult:null,autoCompareExpiry:0,jiangLensEnabled:!0,eventPings:[]};r.current=me,F(cx()),W(null),oe([]),J("STABLE_ORDER"),P(!1),fe(null),Se(null),Oe(null),nt(!1),Ct({}),Ut([]),ke(!1),_e(!1),Re(0),w(null),Ke(0),gn.current="STABLE_ORDER"},[]);S.useEffect(()=>{Be(hx[0])},[Be]);const ft=S.useCallback((Pe,ct,vt,xe)=>{const ge=r.current;if(!ge)return;const Ee={x:vt??.5,y:xe??.5,label:Pe,color:ct,t:ge.world.t,duration:3};ge.eventPings.push(Ee),ge.eventPings=ge.eventPings.filter(me=>ge.world.t-me.t<me.duration+1)},[]);S.useEffect(()=>{if(!e){cancelAnimationFrame(n.current);return}let Pe=0;const ct=vt=>{if(n.current=requestAnimationFrame(ct),Pe===0){Pe=vt;return}const xe=Math.min((vt-Pe)/1e3,.05);Pe=vt,mt.current++,vt-an.current>=1e3&&(l(mt.current),mt.current=0,an.current=vt);const ge=r.current;if(!ge)return;if(ge.forecastJob&&ge.forecastRunning){const me=ek(ge.forecastJob,ge.forecastJob.nBaseline,6);if(Re(ge.forecastJob.rolloutsDone/ge.forecastJob.totalRollouts),me){const je=fx(ge.mule),Te=h5(ge.forecastJob,ge.mule.active,je);ge.forecastResult=Te,ge.forecastRunning=!1,ge.forecastJob=null,Se(Te),_e(!1),Re(1),ge.autoForecastResult=Te,fe(Te)}}if(ge.autoForecastJob&&ge.autoForecastRunning&&!ge.forecastRunning&&ek(ge.autoForecastJob,ge.autoForecastJob.nBaseline,4)){const je=fx(ge.mule),Te=h5(ge.autoForecastJob,ge.mule.active,je);ge.autoForecastResult=Te,ge.autoForecastRunning=!1,ge.autoForecastJob=null,ge.lastAutoForecastT=ge.world.t,fe(Te),ke(!1)}if(!i){nr(ge);return}const Ee=xe;ge.activeInterventions=ge.activeInterventions.filter(me=>me.endT>ge.world.t);for(const me of ge.activeInterventions){const je=(ge.world.t-me.startT)/(me.endT-me.startT),Te=Math.sin(je*Math.PI);T6(ge.world,me.cardId,Te)}if(ge.mule.active&&(mJ(ge.mule,ge.world,Ee),ge.mule.active||(P(!1),ft("Mule expired","#c05aff",ge.mule.x,ge.mule.y))),A6(ge.world,Ee,a.current),ge.world.t-ge.lastMacroT>=ge.macroTickInterval){const me=ge.world.t-ge.lastMacroT,je=E6(ge.world.agents);j6(ge.world,me,je,d.nBaseline);const Te=ge.world.conflictAccum/Math.max(.01,me);ge.world.conflictAccum=0;const Ae=qv(ge.world,Te);ge.prevMetrics=ge.metrics,ge.metrics=Ae,ge.lastMacroT=ge.world.t,F({...Ae}),W(ge.prevMetrics?{...ge.prevMetrics}:null);const Tt=Cy(Ae,ge.prevMetrics);if(J(Tt),Tt!==gn.current){const xt=ge.world.centroids[0];ft(`Phase: ${Ef[Tt]}`,jf[Tt],xt.x,xt.y),gn.current=Tt}}ge.sceneT+=Ee,ge.sceneT>=ge.sceneDuration&&(Qt(ge),ge.sceneT=0),x&&!ge.mule.active&&ge.world.t-ge.lastAnomalyCheck>ge.sceneDuration&&(ge.lastAnomalyCheck=ge.world.t,fJ(ge.mule,x,ge.world.seed,ge.currentScene)&&(ge.mule=pJ(ge.world,ge.world.seed^ge.currentScene),P(!0),ft("Anomaly: The Mule","#c05aff",ge.mule.x,ge.mule.y))),!ge.autoForecastRunning&&!ge.forecastRunning&&ge.world.t-ge.lastAutoForecastT>=ge.autoForecastCooldown&&(ge.autoForecastJob=CJ(ge.world,d.nBaseline),ge.autoForecastRunning=!0,ke(!0)),ge.autoCompareExpiry>0&&ge.world.t>ge.autoCompareExpiry&&nt(!1),ge.eventPings=ge.eventPings.filter(me=>ge.world.t-me.t<me.duration+1),Ke(ge.world.t),Ut([...ge.activeInterventions]),nr(ge)};return n.current=requestAnimationFrame(ct),()=>cancelAnimationFrame(n.current)},[e,i,x,d,f,R,I]);function Qt(Pe){var je;const ct=Cy(Pe.metrics,Pe.prevMetrics),vt=Pe.activeInterventions.length>0?(je=Hv.find(Te=>Te.id===Pe.activeInterventions[0].cardId))==null?void 0:je.name:void 0,xe=!!vt,{headline:ge,causal:Ee}=lJ(ct,Pe.metrics,Pe.prevMetrics,xe,vt),me={act:Pe.currentAct,scene:Pe.currentScene,t:Pe.world.t,phaseLabel:ct,metrics:{...Pe.metrics},headline:ge,causal:Ee,isAct:xe,actName:vt};Pe.history.push(me),Pe.currentScene++,Pe.currentScene%4===0&&Pe.currentAct++,oe([...Pe.history]),Pe.lastAutoForecastT=Pe.world.t-Pe.autoForecastCooldown-1}function nr(Pe){const ct=t.current;ct&&OJ(ct,Pe,f,!0,R,I)}const _n=S.useCallback(Pe=>{const ct=r.current;if(!ct)return;const vt=Hv.find(me=>me.id===Pe);if(!vt)return;const xe=ct.cardCooldowns[Pe]??0;if(ct.world.t<xe||ct.activeInterventions.some(me=>me.cardId===Pe))return;const ge={cardId:Pe,startT:ct.world.t,endT:ct.world.t+vt.durationSeconds,strength:1};ct.activeInterventions.push(ge),ct.cardCooldowns[Pe]=ct.world.t+vt.durationSeconds+vt.cooldownSeconds,Ct({...ct.cardCooldowns}),Ut([...ct.activeInterventions]);const Ee=ct.world.centroids[0];if(ft(`Act: ${vt.name}`,vt.color,Ee.x,Ee.y),ct.lastAutoForecastT=ct.world.t-ct.autoForecastCooldown-1,O)try{const me=QC(ct.world,d.nBaseline);for(;me.rolloutsDone<me.totalRollouts;)ZC(me,me.nBaseline,4);const je=sw(ct.world);dJ(je,Pe,.3);const Te=QC(je,d.nBaseline);for(;Te.rolloutsDone<Te.totalRollouts;)ZC(Te,Te.nBaseline,4);const Ae=fx(ct.mule),Tt=h5(me,ct.mule.active,Ae),xt=h5(Te,ct.mule.active,Ae),en={withAct:Tt,withoutAct:xt,cardId:Pe,appliedAt:ct.world.t};ct.autoCompareResult=en,ct.autoCompareExpiry=ct.world.t+5,Oe(en),nt(!0)}catch{}},[d,ft,O]),Rn=S.useCallback(()=>{const Pe=r.current;if(!Pe||Pe.forecastRunning)return;const ct=kJ(Pe.world,d.nBaseline);Pe.forecastJob=ct,Pe.forecastRunning=!0,_e(!0),Re(0)},[d]),sn=S.useCallback(Pe=>{u(Pe),m(Pe.sceneDuration),Be(Pe)},[Be]),Cn=S.useCallback(Pe=>{const ct={id:Pe.id,name:Pe.name,description:Pe.description,color:Pe.color,worldOpts:Pe.worldOpts,nBaseline:Pe.nBaseline,sceneDuration:Pe.sceneDuration,expectedRegime:Pe.expectedArc};u(ct),m(Pe.sceneDuration);const vt=Pe.id==="anomaly_stress_test";Be(ct,void 0,vt),vt&&v(!0),k(!1)},[Be]),wt=S.useCallback(()=>{Be(d)},[d,Be]);if(S.useEffect(()=>{r.current&&(r.current.anomalyEnabled=x)},[x]),S.useEffect(()=>{r.current&&(r.current.sceneDuration=h)},[h]),!e)return null;const st=Ef[te],Zt=jf[te];return o.jsxs("div",{style:{position:"fixed",inset:0,top:36,background:"#000",display:"flex",flexDirection:"column",fontFamily:"monospace"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"6px 12px",background:"rgba(0,0,0,0.4)",borderBottom:"1px solid rgba(255,255,255,0.06)",flexShrink:0,flexWrap:"wrap"},children:[o.jsxs("button",{title:"Play",onClick:()=>s(Pe=>!Pe),style:{padding:"4px 10px",borderRadius:4,cursor:"pointer",background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.12)",color:"rgba(255,255,255,0.85)",display:"flex",alignItems:"center",gap:5},children:[i?o.jsx(md,{size:11,strokeWidth:1.5}):o.jsx(sc,{size:11,strokeWidth:1.5}),o.jsx("span",{style:{fontSize:10},children:i?"Pausar":"Rodar"})]}),o.jsxs("button",{title:"Pausar",onClick:wt,style:{padding:"4px 10px",borderRadius:4,cursor:"pointer",background:"rgba(255,255,255,0.04)",border:"1px solid rgba(255,255,255,0.08)",color:"rgba(255,255,255,0.55)",display:"flex",alignItems:"center",gap:5},children:[o.jsx(El,{size:10,strokeWidth:1.5}),o.jsx("span",{style:{fontSize:10},children:"Reset"})]}),o.jsx("div",{style:{width:1,height:18,background:"rgba(255,255,255,0.08)"}}),hx.map(Pe=>o.jsx("button",{title:"Pular",onClick:()=>sn(Pe),style:{padding:"3px 9px",borderRadius:4,cursor:"pointer",fontSize:9.5,background:d.id===Pe.id?`${Pe.color}22`:"transparent",border:`1px solid ${d.id===Pe.id?Pe.color+"55":"rgba(255,255,255,0.08)"}`,color:d.id===Pe.id?Pe.color:"rgba(255,255,255,0.45)",textTransform:"uppercase",letterSpacing:"0.06em"},children:Pe.name},Pe.id)),o.jsxs("button",{title:"Reiniciar",onClick:()=>k(!0),style:{padding:"3px 9px",borderRadius:4,cursor:"pointer",fontSize:9.5,background:"rgba(160,255,238,0.06)",border:"1px solid rgba(160,255,238,0.2)",color:"#a0ffee",display:"flex",alignItems:"center",gap:4,textTransform:"uppercase",letterSpacing:"0.06em"},children:[o.jsx(Sf,{size:10,strokeWidth:1.5}),"Scenarios"]}),o.jsx("div",{style:{width:1,height:18,background:"rgba(255,255,255,0.08)"}}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5},children:[o.jsx("span",{style:{fontSize:9,color:"rgba(255,255,255,0.35)"},children:"Cena"}),[20,30,60].map(Pe=>o.jsxs("button",{title:"Anterior",onClick:()=>m(Pe),style:{padding:"2px 7px",borderRadius:3,cursor:"pointer",fontSize:9,background:h===Pe?"rgba(255,255,255,0.1)":"transparent",border:`1px solid ${h===Pe?"rgba(255,255,255,0.2)":"rgba(255,255,255,0.06)"}`,color:h===Pe?"rgba(255,255,255,0.8)":"rgba(255,255,255,0.35)"},children:[Pe,"s"]},Pe))]}),o.jsx("div",{style:{width:1,height:18,background:"rgba(255,255,255,0.08)"}}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[o.jsx("span",{style:{fontSize:9,color:"rgba(255,255,255,0.35)"},children:"Campo"}),["off","R","L","N"].map(Pe=>o.jsx("button",{title:"Prximo",onClick:()=>g(Pe),style:{padding:"2px 7px",borderRadius:3,cursor:"pointer",fontSize:9,background:f===Pe?"rgba(255,255,255,0.1)":"transparent",border:`1px solid ${f===Pe?"rgba(255,255,255,0.2)":"rgba(255,255,255,0.06)"}`,color:f===Pe?Pe==="R"?"#5aff8a":Pe==="L"?"#4a9eff":Pe==="N"?"#ff5a5a":"rgba(255,255,255,0.7)":"rgba(255,255,255,0.35)"},children:Pe==="off"?"Off":Pe},Pe))]}),o.jsx("div",{style:{width:1,height:18,background:"rgba(255,255,255,0.08)"}}),o.jsx("button",{onClick:()=>j(Pe=>!Pe),title:"Tensao: N alto + L baixo = overlay vermelho sutil",style:{padding:"2px 7px",borderRadius:3,cursor:"pointer",fontSize:9,background:R?"rgba(255,90,90,0.1)":"transparent",border:`1px solid ${R?"rgba(255,90,90,0.3)":"rgba(255,255,255,0.06)"}`,color:R?"#ff5a5a":"rgba(255,255,255,0.35)"},children:"Tens"}),o.jsx("button",{onClick:()=>E(Pe=>!Pe),title:"Hotspots de recurso R",style:{padding:"2px 7px",borderRadius:3,cursor:"pointer",fontSize:9,background:I?"rgba(90,255,138,0.1)":"transparent",border:`1px solid ${I?"rgba(90,255,138,0.3)":"rgba(255,255,255,0.06)"}`,color:I?"#5aff8a":"rgba(255,255,255,0.35)"},children:"R"}),o.jsx("div",{style:{width:1,height:18,background:"rgba(255,255,255,0.08)"}}),o.jsxs("button",{title:"Fechar",onClick:()=>v(Pe=>!Pe),style:{padding:"3px 9px",borderRadius:4,cursor:"pointer",fontSize:9.5,display:"flex",alignItems:"center",gap:5,background:x?"rgba(192,90,255,0.15)":"rgba(255,255,255,0.03)",border:`1px solid ${x?"rgba(192,90,255,0.45)":"rgba(255,255,255,0.08)"}`,color:x?"#c05aff":"rgba(255,255,255,0.35)"},children:[o.jsx(MF,{size:10,strokeWidth:1.5}),o.jsxs("span",{children:["Mule ",x?"On":"Off"]})]}),o.jsxs("button",{onClick:()=>L(Pe=>!Pe),title:"Auto-Compare: mostra delta apos cada ato",style:{padding:"2px 7px",borderRadius:3,cursor:"pointer",fontSize:9,background:O?"rgba(255,206,90,0.08)":"transparent",border:`1px solid ${O?"rgba(255,206,90,0.25)":"rgba(255,255,255,0.06)"}`,color:O?"#ffce5a":"rgba(255,255,255,0.35)"},children:["Cmp ",O?"On":"Off"]}),pe&&o.jsx("span",{style:{fontSize:9,padding:"2px 7px",borderRadius:3,background:"rgba(192,90,255,0.18)",color:"#c05aff"},children:"MULE ATIVA"}),o.jsxs("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center",gap:8},children:[o.jsx("span",{style:{fontSize:9,padding:"2px 7px",borderRadius:3,background:`${Zt}18`,color:Zt,textTransform:"uppercase",letterSpacing:"0.06em"},children:st}),o.jsxs("span",{style:{fontSize:9,color:"rgba(255,255,255,0.3)"},children:[c,"fps"]}),o.jsxs("span",{style:{fontSize:9,color:"rgba(255,255,255,0.25)",fontFamily:"monospace"},children:["T",Le.toFixed(0),"s"]})]})]}),o.jsxs("div",{style:{flex:1,display:"flex",overflow:"hidden",minHeight:0,position:"relative"},children:[o.jsxs("div",{style:{flex:"1 1 65%",position:"relative",overflow:"hidden"},children:[o.jsx("canvas",{ref:t,width:900,height:600,style:{width:"100%",height:"100%",display:"block",imageRendering:"pixelated"}}),o.jsxs("div",{style:{position:"absolute",bottom:14,right:14,display:"flex",gap:14,background:"rgba(0,0,0,0.55)",backdropFilter:"blur(6px)",borderRadius:6,padding:"7px 12px",border:"1px solid rgba(255,255,255,0.07)"},children:[o.jsx(_h,{label:"Cnflto",value:$.conflictRate,color:"#ff5a5a"}),o.jsx(_h,{label:"Desig",value:$.inequality,color:"#ffce5a"}),o.jsx(_h,{label:"Legit",value:$.legitimacyMean,color:"#5aff8a"}),o.jsx(_h,{label:"Norma",value:$.normMean,color:"#c05aff"}),o.jsx(_h,{label:"Coes",value:$.cohesion,color:"#4a9eff"}),o.jsx(_h,{label:"Polar",value:$.polarization,color:"#ff9a3c"})]}),De&&o.jsxs("div",{style:{position:"absolute",top:12,left:"50%",transform:"translateX(-50%)",padding:"6px 14px",borderRadius:6,background:"rgba(7,7,18,0.85)",border:"1px solid rgba(74,158,255,0.25)",backdropFilter:"blur(6px)",display:"flex",alignItems:"center",gap:8},children:[o.jsx("div",{style:{width:8,height:8,borderRadius:4,background:"#4a9eff",opacity:.8,animation:"pulse 1s ease-in-out infinite"}}),o.jsxs("span",{style:{fontSize:10,color:"#4a9eff"},children:["Deep Forecast ",Math.round(ae*100),"%"]}),o.jsx("div",{style:{width:60,height:3,background:"rgba(255,255,255,0.06)",borderRadius:2,overflow:"hidden"},children:o.jsx("div",{style:{width:`${ae*100}%`,height:"100%",background:"#4a9eff",borderRadius:2,transition:"width 0.3s"}})})]})]}),o.jsxs("div",{style:{flex:"0 0 310px",display:"flex",flexDirection:"column",background:"rgba(0,0,0,0.3)",borderLeft:"1px solid rgba(255,255,255,0.06)",overflow:"hidden"},children:[o.jsx("div",{style:{overflowY:"auto",flexShrink:0,maxHeight:"55%",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:o.jsx(PJ,{metrics:$,prevMetrics:B,phase:te,oracleResult:V,deepResult:ye,isAutoRunning:we,isDeepRunning:De,deepProgress:ae,jiangEnabled:pt,onToggleJiang:()=>Et(Pe=>!Pe),onRunDeep:Rn,autoCompare:Fe,autoCompareVisible:ne,muleActive:pe})}),o.jsxs("div",{style:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column"},children:[o.jsxs("div",{style:{padding:"6px 12px 4px",fontSize:9.5,color:"rgba(255,255,255,0.35)",textTransform:"uppercase",letterSpacing:"0.08em",borderBottom:"1px solid rgba(255,255,255,0.05)",flexShrink:0},children:["Linha do Tempo (",re.length," cenas)"]}),o.jsx("div",{style:{flex:1,overflowY:"auto"},children:o.jsx(AJ,{frames:re,selected:b,onSelect:w})})]})]}),M&&o.jsx(NJ,{onSelect:Cn,onClose:()=>k(!1)})]}),o.jsxs("div",{style:{flexShrink:0,background:"rgba(0,0,0,0.45)",borderTop:"1px solid rgba(255,255,255,0.06)"},children:[o.jsx("div",{style:{padding:"4px 10px 2px",fontSize:9,color:"rgba(255,255,255,0.3)",textTransform:"uppercase",letterSpacing:"0.07em"},children:"Atos Historicos"}),o.jsx(FJ,{cardCooldowns:_t,activeInterventions:Xe,currentT:Le,onApply:_n})]}),o.jsx("style",{children:`
        @keyframes pulse {
          0%, 100% { opacity: 0.4; transform: scale(1); }
          50% { opacity: 1; transform: scale(1.2); }
        }
      `})]})},Gv=180,Mo=30,jm=160,xx=3,ky=3.5,LJ={organismToIntensity:.38,visibility:.7,noise:.07,density:.32,multiplicidade:.42,linhasDeFuga:.28,territorializacao:.15,reterritorializacao:.35,hubs:.22,esquecimento:.12},lw={bgColor:"#000000",nodeColor:"#e0e0e0",entryColor:"#ffffff",hubColor:"#b0b0b0",hotColor:"#ffffff",linkColor:"#2a2a2a",flightColor:"#555555",labelColor:"#ffffff",glowIntensity:0,nodeSize:.48,linkOpacity:.6,linkWidth:.38,showLabels:!1,labelSize:.3,relSizeScale:.55,connSizeScale:.55,relDistScale:.5},Nh={rotX:.22,rotY:0,rotZ:0,zoom:1,fov:.55,zSpread:500,fog:.55,autoRotate:!1,autoSpeed:.18,panX:0,panY:0},rk=[{name:"Open Rhizome",description:"Multiplas entradas, baixa hierarquia, rede respira e se espalha.",params:{organismToIntensity:.65,visibility:.75,noise:.18,density:.6,multiplicidade:.85,linhasDeFuga:.55,territorializacao:.3,reterritorializacao:.25,hubs:.1,esquecimento:.28}},{name:"Territorial Clusters",description:"Territorios fortes e consolidados. Assentamentos e bordas claras.",params:{organismToIntensity:.6,visibility:.7,noise:.1,density:.7,multiplicidade:.55,linhasDeFuga:.2,territorializacao:.85,reterritorializacao:.75,hubs:.25,esquecimento:.18}},{name:"Line of Flight",description:"Pontes longas surgem o tempo todo. Saltos e conexoes improvaveis.",params:{organismToIntensity:.72,visibility:.8,noise:.22,density:.5,multiplicidade:.75,linhasDeFuga:.9,territorializacao:.35,reterritorializacao:.28,hubs:.18,esquecimento:.22}},{name:"Forgetting Storm",description:"Poda agressiva. Ruinas e renascimentos continuos.",params:{organismToIntensity:.55,visibility:.65,noise:.15,density:.6,multiplicidade:.6,linhasDeFuga:.4,territorializacao:.55,reterritorializacao:.4,hubs:.25,esquecimento:.92}},{name:"Hub Temptation",description:"A rede tenta virar tronco. Hubs crescem, mas entradas ainda competem.",params:{organismToIntensity:.6,visibility:.75,noise:.1,density:.65,multiplicidade:.55,linhasDeFuga:.22,territorializacao:.55,reterritorializacao:.55,hubs:.88,esquecimento:.22}},{name:"Anti-Hierarchy",description:"Sem troncos. Muitas entradas e pontes leves, sempre distribuido.",params:{organismToIntensity:.7,visibility:.8,noise:.22,density:.58,multiplicidade:.92,linhasDeFuga:.38,territorializacao:.3,reterritorializacao:.18,hubs:0,esquecimento:.38}},{name:"Crystal Garden",description:"Rede estavel, quase mineral. Crescimento lento e coesao alta.",params:{organismToIntensity:.5,visibility:.6,noise:.05,density:.42,multiplicidade:.38,linhasDeFuga:.08,territorializacao:.72,reterritorializacao:.88,hubs:.28,esquecimento:.08}},{name:"Schizo Drift",description:"Alta deriva e novidade. Instavel, multiplo e eletrico.",params:{organismToIntensity:.82,visibility:.88,noise:.38,density:.72,multiplicidade:.88,linhasDeFuga:.75,territorializacao:.22,reterritorializacao:.12,hubs:.12,esquecimento:.58}},{name:"Vacuum Explorers",description:"Nos solitarios navegam o vazio ate serem capturados por linhas de fuga.",params:{organismToIntensity:.75,visibility:.78,noise:.28,density:.45,multiplicidade:.5,linhasDeFuga:.8,territorializacao:.18,reterritorializacao:.2,hubs:.08,esquecimento:.35}}],zJ=[{key:"organismToIntensity",label:"Intensidade"},{key:"visibility",label:"Visibilidade"},{key:"noise",label:"Rudo / Deriva"},{key:"density",label:"Densidade"},{key:"multiplicidade",label:"Multiplicidade",tooltip:"Multiplica pontos de entrada. Mais = mais inicios, mais territorios, menos centro unico."},{key:"linhasDeFuga",label:"Linhas de Fuga",tooltip:"Fora que atrai nos para conexoes de longa distancia. Nodes navegam o vacuo ate serem capturados."},{key:"territorializacao",label:"Territorializacao",tooltip:"Puxa formacoes para territorios. Mais = clusters; menos = deriva livre."},{key:"reterritorializacao",label:"Reterritorializacao",tooltip:"Consolida ligacoes locais. Mais = cristalizacao; menos = rede solta."},{key:"hubs",label:"Hubs",tooltip:"Tendencia a hierarquia por anexacao preferencial. Mais = troncos; menos = distribuicao."},{key:"esquecimento",label:"Esquecimento",tooltip:"Poda e renova. Mais = cortes e renascimentos; menos = acumulo e saturacao."}],O6=`
You are an epistemological cartographer building a RHIZOMATIC knowledge graph. Given the topic "{TOPIC}", generate a map with {COUNT} nodes.
Depth level: {DEPTH} (shallow=key concepts only, medium=includes sub-concepts and people, deep=includes edge cases, controversies, and peripheral thinkers).

Return a JSON array of node objects with this EXACT structure:
[
  {
    "label": "ConceptOrPersonName",
    "description": "One-sentence description of this concept or person and their relation to the topic",
    "category": "CategoryName",
    "isEntry": true,
    "relevance": 0.95,
    "popularity": 0.80,
    "directLink": true,
    "connections": ["OtherConceptLabel", ...],
    "typedEdges": [
      { "target": "OtherConceptLabel", "strength": 0.85, "relation": "influences" },
      { "target": "AnotherConcept",    "strength": 0.40, "relation": "contrasts" }
    ]
  }
]

EDGE RELATION TYPES (use exactly these strings):
- "influences"  A shaped B's thinking or development
- "contrasts"  A opposes, tensions with, or challenges B
- "bridges"  A connects disparate domains (LINE OF FLIGHT  cross-cluster unexpected link)
- "extends"  A builds upon or develops from B
- "contains"  A subsumes or includes B
- "co_occurs"  A and B frequently appear together in discourse
- "method_for"  A is a methodology used to study/approach B
- "example_of"  A is an instance or case study of B
- "critiques"  A fundamentally challenges B's premises
- "related"  generic semantic proximity

FIELD RULES:
- label: short (1-4 words). Include PEOPLE (thinkers, artists, scientists) by name.
- description: one sentence, factual, no invented bibliography
- category: group into 3-6 thematic categories
- relevance: 0..1  how central to "{TOPIC}" (1.0=core, 0.1=tangential). A concept that appears in many discussions of this topic should have HIGH relevance.
- popularity: 0..1  cultural/academic prominence (1.0=extremely well-known)
- directLink: true if directly connected to the central topic
- isEntry: mark 3-5 nodes as true (main entry points to navigate the map)
- connections: 2-6 other node labels (MUST be meaningful semantic connections, never random)
- typedEdges: for EACH connection, specify the target label, connection strength (0..1), and relation type. Strength should reflect how tightly coupled the concepts are in real academic/intellectual discourse.

STRUCTURAL RULES:
1. Ensure the network is FULLY CONNECTED (no isolated nodes)
2. Include at least 2-3 BRIDGE edges (relation="bridges") connecting different categories  these are LINES OF FLIGHT
3. Connection strength should vary meaningfully: core relationships = 0.7-1.0, peripheral = 0.2-0.5
4. If a concept is referenced by MANY other nodes, it should have HIGH relevance (it's a hub)
5. Create real CLUSTERS via category  nodes in the same category should be more densely connected

Return ONLY the JSON array, no other text.
`.trim(),D6=`
You are an academic genealogist. For the topic "{TOPIC}", list {COUNT} key PEOPLE  researchers, thinkers, artists, scientists, philosophers, and activists  directly associated with this field.
Depth: {DEPTH}.

Return a JSON array:
[
  {
    "label": "Person Name",
    "description": "One sentence: who they are and their contribution to {TOPIC}",
    "category": "their field or school (e.g. 'critical theory', 'biology', 'art')",
    "isEntry": true/false,
    "relevance": 0.0-1.0,
    "popularity": 0.0-1.0,
    "directLink": true/false,
    "connections": ["Name of intellectual influence or collaborator", ...],
    "typedEdges": [
      { "target": "Other Person", "strength": 0.85, "relation": "influences" },
      { "target": "Another Person", "strength": 0.60, "relation": "contrasts" }
    ]
  }
]

EDGE RELATION TYPES: "influences", "contrasts", "bridges", "extends", "co_occurs", "critiques", "related"

Rules:
- ONLY real people (no concepts, no movements as nodes)
- label = person's name (1-3 words)
- connections = other people in this list who influenced, collaborated, or debated with this person
- typedEdges: specify relationship TYPE and STRENGTH for each connection. Use "influences" for teacherstudent, "contrasts" for intellectual opponents, "bridges" for cross-disciplinary links, "co_occurs" for collaborators
- isEntry = true for 3-5 most central figures
- relevance: if this person is cited/referenced by MANY others in this list, they should have HIGH relevance
- ensure all names are connected (no isolated people)

Return ONLY the JSON array.
`.trim(),L6=`
You are a philosophical cartographer specializing in the work of a single thinker.
Map the intellectual universe of "{TOPIC}"  their key concepts, major works, influences, and legacy  as {COUNT} nodes.
Depth: {DEPTH}.

Return a JSON array:
[
  {
    "label": "Concept or Book Title",
    "description": "One sentence: what this is within {TOPIC}'s thought",
    "category": "core concept / major work / influence / student/heir / debate",
    "isEntry": true/false,
    "relevance": 0.0-1.0,
    "popularity": 0.0-1.0,
    "directLink": true/false,
    "connections": ["Related concept or work", ...],
    "typedEdges": [
      { "target": "RelatedConcept", "strength": 0.90, "relation": "extends" },
      { "target": "InfluentialWork", "strength": 0.70, "relation": "contains" }
    ]
  }
]

EDGE RELATION TYPES: "influences", "contrasts", "bridges", "extends", "contains", "co_occurs", "method_for", "example_of", "critiques", "related"

Rules:
- Include: key concepts, book/article titles (short), people who influenced them, students/heirs
- isEntry = true for the 3-5 most central concepts
- typedEdges: specify how each concept RELATES to others. "extends" for developments, "contains" for subsumption, "influences" for genealogy, "bridges" for cross-domain leaps
- connections must be meaningful (not random)
- relevance: concepts that are referenced by MANY other nodes should have HIGH relevance
- label max 4 words

Return ONLY the JSON array.
`.trim(),z6=`
You are a curriculum designer and expert in "{TOPIC}".
Create an optimal STUDY PATH of {COUNT} steps to master this topic from beginner to advanced.
Depth: {DEPTH}.

Return a JSON array ORDERED from first to last step:
[
  {
    "label": "Step Name",
    "description": "One sentence: what to study here and why it comes at this point",
    "category": "foundation / theory / method / advanced / practice",
    "isEntry": true/false,
    "relevance": 0.0-1.0,
    "popularity": 0.0-1.0,
    "directLink": true/false,
    "order": 1,
    "connections": ["Next step", "prerequisite step", ...],
    "typedEdges": [
      { "target": "Next Step", "strength": 0.90, "relation": "extends" },
      { "target": "Prerequisite", "strength": 0.80, "relation": "contains" }
    ]
  }
]

EDGE RELATION TYPES: "extends" (unlocks/builds-upon), "contains" (prerequisite), "bridges" (cross-domain leap), "co_occurs" (parallel study), "related"

Rules:
- order: integer starting at 1, increasing through the array
- The first 1-3 nodes are foundational (isEntry=true)
- connections should reflect prerequisites AND what this unlocks
- typedEdges: use "extends" for sequential progression, "contains" for prerequisites, "bridges" for unexpected cross-domain connections
- Each step connects to at least 2 others (prev/next or branching)
- label is a short name for this learning step

Return ONLY the JSON array.
`.trim(),B6=`
You are a scholar of academic disputes and intellectual history.
For "{TOPIC}", map the main CONTROVERSIES, tensions, competing schools, and unresolved debates as {COUNT} nodes.
Depth: {DEPTH}.

Return a JSON array:
[
  {
    "label": "Controversy or School Name",
    "description": "One sentence: what this debate or school is about",
    "category": "school / debate / tension / person / concept",
    "isEntry": true/false,
    "relevance": 0.0-1.0,
    "popularity": 0.0-1.0,
    "directLink": true/false,
    "connections": ["Opposing view", "related debate", ...],
    "typedEdges": [
      { "target": "Opposing School", "strength": 0.90, "relation": "contrasts" },
      { "target": "Related Debate", "strength": 0.60, "relation": "co_occurs" }
    ]
  }
]

EDGE RELATION TYPES: "contrasts" (opposition), "influences" (genealogy), "bridges" (cross-domain), "extends" (development), "critiques" (challenge), "co_occurs" (parallel), "related"

Rules:
- Include: opposing schools, key debates, contested figures, paradigm conflicts
- typedEdges: use "contrasts" for oppositions, "critiques" for challenges, "bridges" for surprising connections across domains, "influences" for genealogy of ideas
- connection strength should reflect intensity of the debate (0.9 = central dispute, 0.3 = tangential)
- isEntry = true for the 3-5 central fault lines
- Make tensions visible in the graph structure

Return ONLY the JSON array.
`.trim(),$6=`
You are a semantic indexer. For "{TOPIC}", generate a dense keyword/concept cloud of {COUNT} terms  the essential vocabulary to understand, search, and navigate this field.
Depth: {DEPTH}.

Return a JSON array:
[
  {
    "label": "Keyword",
    "description": "One sentence definition in context of {TOPIC}",
    "category": "term / method / entity / process / property",
    "isEntry": true/false,
    "relevance": 0.0-1.0,
    "popularity": 0.0-1.0,
    "directLink": true/false,
    "connections": ["Semantically related keyword", ...],
    "typedEdges": [
      { "target": "RelatedTerm", "strength": 0.80, "relation": "co_occurs" },
      { "target": "ParentConcept", "strength": 0.70, "relation": "contains" }
    ]
  }
]

EDGE RELATION TYPES: "co_occurs" (semantic proximity), "contains" (parent/child), "contrasts" (antonym/opposition), "extends" (specialization), "bridges" (cross-domain), "related"

Rules:
- labels are single words or short technical terms (1-2 words)
- connections = semantic proximity (synonyms, antonyms, parent/child concepts)
- typedEdges: use "co_occurs" for terms that frequently appear together, "contains" for hierarchy, "contrasts" for antonyms, "bridges" for cross-domain links
- strength should reflect co-occurrence frequency in academic literature (1.0 = always together, 0.2 = occasional)
- isEntry = true for 3-5 most fundamental terms
- high density: each node connects to 3-6 others

Return ONLY the JSON array.
`.trim();function BJ(e){switch(e){case"names_only":return D6;case"person_theory":return L6;case"study_order":return z6;case"controversies":return B6;case"keywords":return $6;default:return O6}}const eu={concepts:O6,names_only:D6,person_theory:L6,study_order:z6,controversies:B6,keywords:$6},vf={concepts:{icon:"",label:"Conceitos",hint:"Conceitos + pessoas misturados"},names_only:{icon:"",label:"S Nomes",hint:"Apenas pesquisadores e pensadores"},person_theory:{icon:"",label:"Teoria/Autor",hint:"Conceitos, obras e legado de um autor"},study_order:{icon:"",label:"Ordem Estudo",hint:"Caminho sequencial de aprendizado"},controversies:{icon:"",label:"Controvrsias",hint:"Debates, tenses e escolas opostas"},keywords:{icon:"",label:"Keywords",hint:"Vocabulrio essencial denso"}},vx={default:"#00ff66",philosophy:"#a78bfa",science:"#38bdf8",mathematics:"#fb923c",history:"#fbbf24",art:"#f472b6",politics:"#4ade80",economics:"#34d399",psychology:"#c084fc",biology:"#86efac",physics:"#60a5fa",category0:"#00ff66",category1:"#a78bfa",category2:"#38bdf8",category3:"#fb923c",category4:"#fbbf24",category5:"#f472b6"};function q6(e){if(!e)return vx.default;const t=e.toLowerCase();for(const a of Object.keys(vx))if(t.includes(a))return vx[a];let n=0;for(let a=0;a<e.length;a++)n=n*31+e.charCodeAt(a)&16777215;return`hsl(${n%360},70%,60%)`}function $J(e){if(e.apiKey)return e.apiKey;if(typeof window<"u"){const t=window.__APP_CONFIG__;if(t!=null&&t.OPENAI_API_KEY)return t.OPENAI_API_KEY;const n=pS();if(n)return n}return null}async function qJ(e,t,n,r=20){var h,m,f;const a=new AbortController,i=Math.max(9e4,r*1800),s=setTimeout(()=>a.abort(),i),c=Math.min(8e3,Math.max(4e3,r*280)),l=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":e,"anthropic-version":"2023-06-01"},body:JSON.stringify({model:t,max_tokens:c,messages:[{role:"user",content:n}]}),signal:a.signal});if(clearTimeout(s),!l.ok){let g=`Anthropic API error (${l.status})`;try{const x=await l.json();(h=x.error)!=null&&h.message&&(g=x.error.message)}catch{}throw new Error(g)}const u=(f=(m=(await l.json()).content)==null?void 0:m[0])==null?void 0:f.text;if(!u)throw new Error("Resposta vazia da API Anthropic.");return u}async function HJ(e,t,n,r,a,i){var v,b,w,M;const s=Math.min(16e3,Math.max(4e3,a*300)),c=Math.max(9e4,a*1800),l=new AbortController,d=setTimeout(()=>l.abort(),c),u=await fetch(`${t}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({model:n,messages:[{role:"user",content:r}],temperature:.7,max_tokens:s,stream:!0}),signal:l.signal});if(clearTimeout(d),!u.ok){let k=`API error (${u.status})`;try{const R=await u.json();(v=R.error)!=null&&v.message&&(k=R.error.message)}catch{}throw u.status===401?new Error("API key invlida. Verifique a chave em Settings."):u.status===429?new Error("Limite de requisies excedido. Aguarde."):new Error(k)}const h=u.body.getReader(),m=new TextDecoder;let f="",g=0;function x(){let k=0,R=0;for(;k<f.length;){const j=f.indexOf("{",k);if(j===-1)break;let I=0,E=-1,O=!1,L=!1;for(let $=j;$<f.length;$++){const F=f[$];if(L){L=!1;continue}if(F==="\\"&&O){L=!0;continue}if(F==='"'){O=!O;continue}if(!O&&(F==="{"&&I++,F==="}"&&(I--,I===0))){E=$;break}}if(E===-1)break;if(R++,R>g)try{const $=JSON.parse(f.slice(j,E+1));$&&typeof $.label=="string"&&$.label.trim()&&(g++,i({label:String($.label).trim(),description:$.description?String($.description):void 0,category:$.category?String($.category).toLowerCase():"default",isEntry:!!$.isEntry,connections:Array.isArray($.connections)?$.connections.filter(F=>typeof F=="string").map(F=>String(F).trim()):[],typedEdges:H6($.typedEdges),relevance:typeof $.relevance=="number"?Math.max(0,Math.min(1,$.relevance)):.5,popularity:typeof $.popularity=="number"?Math.max(0,Math.min(1,$.popularity)):.5,directLink:!!($.directLink??$.isEntry)}))}catch{}k=E+1}}try{for(;;){const{done:k,value:R}=await h.read();if(k)break;const j=m.decode(R,{stream:!0});for(const I of j.split(`
`)){const E=I.trim();if(!E.startsWith("data:"))continue;const O=E.slice(5).trim();if(O==="[DONE]")return;try{const $=((M=(w=(b=JSON.parse(O).choices)==null?void 0:b[0])==null?void 0:w.delta)==null?void 0:M.content)??"";f+=$,x()}catch{}}}}finally{h.releaseLock()}}const WJ=new Set(["influences","contrasts","bridges","extends","contains","co_occurs","method_for","example_of","critiques","related"]);function H6(e){if(!Array.isArray(e))return;const t=[];for(const n of e){if(!n||typeof n!="object"||typeof n.target!="string")continue;const r=WJ.has(n.relation)?n.relation:"related",a=typeof n.strength=="number"?Math.max(0,Math.min(1,n.strength)):.5;t.push({target:n.target.trim(),strength:a,relation:r})}return t.length>0?t:void 0}function GJ(e){let t=e.trim();const n=t.match(/```(?:json)?\s*([\s\S]*?)```/);n&&(t=n[1].trim());const r=t.indexOf("["),a=t.lastIndexOf("]");if(r===-1||a===-1||a<=r)throw new Error("Nenhum array JSON encontrado na resposta.");t=t.slice(r,a+1);let i;try{i=JSON.parse(t)}catch{i=[];const s=/\{[\s\S]*?\}/g;let c;for(;(c=s.exec(t))!==null;)try{i.push(JSON.parse(c[0]))}catch{}}if(!Array.isArray(i))throw new Error("Resposta no  um array JSON.");return i.filter(s=>s&&typeof s.label=="string"&&s.label.trim()).map(s=>({label:String(s.label).trim(),description:s.description?String(s.description):void 0,category:s.category?String(s.category).toLowerCase():"default",isEntry:!!s.isEntry,connections:Array.isArray(s.connections)?s.connections.filter(c=>typeof c=="string").map(c=>String(c).trim()):[],typedEdges:H6(s.typedEdges),relevance:typeof s.relevance=="number"?Math.max(0,Math.min(1,s.relevance)):.5,popularity:typeof s.popularity=="number"?Math.max(0,Math.min(1,s.popularity)):.5,directLink:!!(s.directLink??s.isEntry),order:typeof s.order=="number"?s.order:void 0}))}async function ok(e,t,n){const r=$J(e);if(!r){const l=VJ(e);for(let d=0;d<l.nodes.length;d++)await new Promise(u=>setTimeout(u,80)),t(l.nodes[d],d);n(l.nodes.length);return}const i=BJ(e.llmMode).replace(/{TOPIC}/g,e.topic).replace("{COUNT}",String(e.nodeCount)).replace("{DEPTH}",e.depth);let s=0;const c=l=>t(l,s++);try{if(e.provider==="anthropic"){const l=e.modelId||"claude-3-5-haiku-20241022",d=await qJ(r,l,i,e.nodeCount);for(const u of GJ(d))c(u)}else{const l=e.provider==="ollama",d=l?"http://localhost:11434/v1":"https://api.openai.com/v1",u=e.modelId||(l?"llama3.2":"gpt-4o-mini");await HJ(l?r||"ollama":r,d,u,i,e.nodeCount,c)}}catch(l){throw l instanceof Error&&l.name==="AbortError"?new Error("Timeout. Tente um mapa menor."):l instanceof Error&&l.message.includes("Failed to fetch")?new Error("Erro de conexo. Verifique sua internet e a chave de API."):l}n(s)}function ak(e,t,n,r,a,i,s,c,l,d,u){if(e.nodes.length>=Gv)return null;if(d!=null&&d.has(t.label)){const B=d.get(t.label);if(t.connections&&d)for(const W of t.connections){const re=d.get(W);if(re&&re.id!==B.id&&!B.connections.has(re.id)){const oe=.35+Math.random()*.3;B.connections.set(re.id,oe),re.connections.set(B.id,oe)}}return B}const h=55,m=c??a*.5,f=l??i*.5,g=Math.min(a,i),x=t.relevance??(t.isEntry?.85:.5),v=t.popularity??.5,b=c!==void 0;let w;const M=Math.PI*(3-Math.sqrt(5));if(t.category&&t.category!=="default"&&u){if(!u.has(t.category)){const te=u.size,J=Math.max(6,u.size+3);u.set(t.category,te/J*Math.PI*2)}const B=u.get(t.category),re=e.nodes.filter(te=>te.category===t.category).length*M;w=B+re*.35+(Math.random()-.5)*.12}else w=n*M+(Math.random()-.5)*.18;const k=b?.12:.18,R=b?.4:.52,j=r>1?Math.sqrt(n/(r-1)):.5,I=k+j*(R-k)+(.5-x)*.1,E=g*Math.min(R,Math.max(k,I))+(Math.random()-.5)*(g*.06),O=Math.max(h,Math.min(a-h,m+Math.cos(w)*E)),L=Math.max(h,Math.min(i-h,f+Math.sin(w)*E)),$={id:e.nextId++,x:O,y:L,vx:(Math.random()-.5)*10,vy:(Math.random()-.5)*10,heat:.55+v*.45,isEntry:t.isEntry??!1,age:0,connections:new Map,label:t.label,description:t.description,connectionsLabels:t.connections,category:t.category,relevance:x,popularity:v,userPlaced:!1};e.nodes.push($);const F=new Map;if(t.typedEdges)for(const B of t.typedEdges)F.set(B.target.toLowerCase(),B);if(d&&(d.set(t.label,$),t.connections))for(const B of t.connections){const W=d.get(B);if(W&&W.id!==$.id&&!$.connections.has(W.id)){const re=F.get(B.toLowerCase()),oe=re?re.strength:.35+Math.random()*.3;$.connections.set(W.id,oe),W.connections.set($.id,oe),re&&($.edgeTypes||($.edgeTypes=new Map),W.edgeTypes||(W.edgeTypes=new Map),$.edgeTypes.set(W.id,re.relation),W.edgeTypes.set($.id,re.relation))}}if(s!==void 0){const B=e.nodes.find(W=>W.id===s);if(B&&!$.connections.has(s)&&(t.isEntry??!1)){const re=.35+x*.15;$.connections.set(s,re),B.connections.set($.id,re)}}return $}function VJ(e){const t=e.topic.toLowerCase();let n;if(t.includes("deleuze")||t.includes("guattari")||t.includes("rizoma")||t.includes("rhizome"))n=sk.slice(0,Math.min(e.nodeCount,sk.length));else{const r=Math.min(e.nodeCount,16),a=["conceptual","methodological","historical","applied","theoretical"];n=Array.from({length:r},(i,s)=>({label:s===0?e.topic:`${e.topic} ${["fundamentos","contexto","mtodo","prtica","teoria","histria","crtica","extenses","variantes","debates","aplicaes","influncias","correntes","escolas","obras"][s]||`N ${s}`}`,isEntry:s<4,category:a[s%a.length],connections:s===0?Array.from({length:Math.min(4,r-1)},(c,l)=>`${e.topic} ${["fundamentos","contexto","mtodo","prtica","teoria"][l]}`):[e.topic,s>1?`${e.topic} ${["fundamentos","contexto","mtodo","prtica","teoria","histria","crtica","extenses","variantes","debates","aplicaes","influncias","correntes","escolas","obras"][s-1]}`:e.topic]}))}return{nodes:n,title:`${e.topic} [DEMO  configure API key]`,description:"Demo sem API key. Configure VITE_RHIZOME_LLM_API_KEY para usar LLM real.",generatedAt:Date.now()}}const sk=[{label:"Rizoma",category:"philosophy",isEntry:!0,relevance:.95,popularity:.9,description:"Modelo de pensamento no-hierrquico",connections:["Plat","Linhas de Fuga","Multiplicidade","Anti-Genealogia"],typedEdges:[{target:"Plat",strength:.9,relation:"co_occurs"},{target:"Linhas de Fuga",strength:.85,relation:"contains"},{target:"Multiplicidade",strength:.88,relation:"contains"},{target:"Anti-Genealogia",strength:.75,relation:"extends"}]},{label:"Plat",category:"philosophy",relevance:.8,popularity:.75,description:"Regio de intensidade contnua",connections:["Rizoma","Territrios","Corpo sem rgos"],typedEdges:[{target:"Rizoma",strength:.9,relation:"co_occurs"},{target:"Territrios",strength:.65,relation:"contrasts"},{target:"Corpo sem rgos",strength:.8,relation:"co_occurs"}]},{label:"Linhas de Fuga",category:"philosophy",isEntry:!0,relevance:.92,popularity:.85,description:"Movimento de desterritorializao",connections:["Rizoma","Devir","Multiplicidade","Esquizo"],typedEdges:[{target:"Rizoma",strength:.85,relation:"contains"},{target:"Devir",strength:.8,relation:"influences"},{target:"Multiplicidade",strength:.7,relation:"co_occurs"},{target:"Esquizo",strength:.6,relation:"bridges"}]},{label:"Territrios",category:"philosophy",relevance:.7,popularity:.65,description:"Zonas de estabilidade e identidade",connections:["Plat","Reterritorializao","Desterritorializao"],typedEdges:[{target:"Plat",strength:.65,relation:"contrasts"},{target:"Reterritorializao",strength:.9,relation:"co_occurs"},{target:"Desterritorializao",strength:.92,relation:"contrasts"}]},{label:"Multiplicidade",category:"philosophy",isEntry:!0,relevance:.88,popularity:.8,description:"Dimenso que escapa  unidade",connections:["Rizoma","Devir","Anti-Genealogia"],typedEdges:[{target:"Rizoma",strength:.88,relation:"contains"},{target:"Devir",strength:.75,relation:"co_occurs"},{target:"Anti-Genealogia",strength:.7,relation:"extends"}]},{label:"Devir",category:"philosophy",relevance:.82,popularity:.78,description:"Processo sem origem nem fim",connections:["Linhas de Fuga","Multiplicidade","Mquina de Guerra"],typedEdges:[{target:"Linhas de Fuga",strength:.8,relation:"influences"},{target:"Multiplicidade",strength:.75,relation:"co_occurs"},{target:"Mquina de Guerra",strength:.55,relation:"bridges"}]},{label:"Corpo sem rgos",category:"philosophy",relevance:.78,popularity:.72,description:"Plano de imanncia e intensidade",connections:["Plat","Esquizo","Intensidade"],typedEdges:[{target:"Plat",strength:.8,relation:"co_occurs"},{target:"Esquizo",strength:.75,relation:"influences"},{target:"Intensidade",strength:.85,relation:"contains"}]},{label:"Esquizo",category:"philosophy",relevance:.65,popularity:.6,description:"Processo esquizofrnico como modelo crtico",connections:["Linhas de Fuga","Corpo sem rgos","Anti-dipo"],typedEdges:[{target:"Linhas de Fuga",strength:.6,relation:"bridges"},{target:"Corpo sem rgos",strength:.75,relation:"influences"},{target:"Anti-dipo",strength:.9,relation:"co_occurs"}]},{label:"Anti-dipo",category:"philosophy",isEntry:!0,relevance:.9,popularity:.88,description:"Crtica  triangulao familiar",connections:["Esquizo","Mquinas Desejantes","Capitalismo"],typedEdges:[{target:"Esquizo",strength:.9,relation:"co_occurs"},{target:"Mquinas Desejantes",strength:.85,relation:"contains"},{target:"Capitalismo",strength:.8,relation:"critiques"}]},{label:"Mquinas Desejantes",category:"philosophy",relevance:.72,popularity:.65,description:"Produo desejante como mquina",connections:["Anti-dipo","Capitalismo","Intensidade"],typedEdges:[{target:"Anti-dipo",strength:.85,relation:"contains"},{target:"Capitalismo",strength:.55,relation:"contrasts"},{target:"Intensidade",strength:.6,relation:"co_occurs"}]},{label:"Capitalismo",category:"politics",relevance:.68,popularity:.75,description:"Axiomtica do capital",connections:["Anti-dipo","Reterritorializao","Mquinas Desejantes"],typedEdges:[{target:"Anti-dipo",strength:.8,relation:"critiques"},{target:"Reterritorializao",strength:.7,relation:"influences"},{target:"Mquinas Desejantes",strength:.55,relation:"contrasts"}]},{label:"Reterritorializao",category:"philosophy",relevance:.62,popularity:.55,description:"Recaptura aps linha de fuga",connections:["Territrios","Capitalismo","Estado"],typedEdges:[{target:"Territrios",strength:.9,relation:"co_occurs"},{target:"Capitalismo",strength:.7,relation:"influences"},{target:"Estado",strength:.65,relation:"co_occurs"}]},{label:"Desterritorializao",category:"philosophy",relevance:.75,popularity:.7,description:"Abandono do territrio",connections:["Territrios","Devir","Nmade"],typedEdges:[{target:"Territrios",strength:.92,relation:"contrasts"},{target:"Devir",strength:.7,relation:"co_occurs"},{target:"Nmade",strength:.75,relation:"influences"}]},{label:"Mquina de Guerra",category:"politics",relevance:.6,popularity:.55,description:"Exterior ao Estado, nmade",connections:["Devir","Nmade","Estado"],typedEdges:[{target:"Devir",strength:.55,relation:"bridges"},{target:"Nmade",strength:.8,relation:"co_occurs"},{target:"Estado",strength:.9,relation:"contrasts"}]},{label:"Nmade",category:"philosophy",isEntry:!0,relevance:.72,popularity:.68,description:"Pensamento e movimento sem fixao",connections:["Mquina de Guerra","Desterritorializao","Espao Liso"],typedEdges:[{target:"Mquina de Guerra",strength:.8,relation:"co_occurs"},{target:"Desterritorializao",strength:.75,relation:"influences"},{target:"Espao Liso",strength:.85,relation:"co_occurs"}]},{label:"Estado",category:"politics",relevance:.58,popularity:.7,description:"Mquina de captura e estriagem",connections:["Mquina de Guerra","Reterritorializao","Espao Estriado"],typedEdges:[{target:"Mquina de Guerra",strength:.9,relation:"contrasts"},{target:"Reterritorializao",strength:.65,relation:"co_occurs"},{target:"Espao Estriado",strength:.85,relation:"co_occurs"}]},{label:"Espao Liso",category:"philosophy",relevance:.55,popularity:.5,description:"Espao nmade e intensivo",connections:["Nmade","Devir","Intensidade"],typedEdges:[{target:"Nmade",strength:.85,relation:"co_occurs"},{target:"Devir",strength:.6,relation:"co_occurs"},{target:"Intensidade",strength:.65,relation:"bridges"}]},{label:"Espao Estriado",category:"philosophy",relevance:.5,popularity:.45,description:"Espao sedentrio e mtrico",connections:["Estado","Reterritorializao"],typedEdges:[{target:"Estado",strength:.85,relation:"co_occurs"},{target:"Reterritorializao",strength:.7,relation:"co_occurs"}]},{label:"Intensidade",category:"philosophy",relevance:.65,popularity:.6,description:"Diferena em si, sem negao",connections:["Corpo sem rgos","Espao Liso","Mquinas Desejantes"],typedEdges:[{target:"Corpo sem rgos",strength:.85,relation:"contains"},{target:"Espao Liso",strength:.65,relation:"bridges"},{target:"Mquinas Desejantes",strength:.6,relation:"co_occurs"}]},{label:"Anti-Genealogia",category:"philosophy",relevance:.55,popularity:.45,description:"Rejeio da origem e da rvore",connections:["Rizoma","Multiplicidade","Plat"],typedEdges:[{target:"Rizoma",strength:.75,relation:"extends"},{target:"Multiplicidade",strength:.7,relation:"extends"},{target:"Plat",strength:.5,relation:"co_occurs"}]}];function ik(e){const t=e.nodes;if(t.length<3)return;const n=new Map;for(const m of t){n.has(m.id)||n.set(m.id,new Set);for(const[f]of m.connections)n.get(m.id).add(f)}const r=new Map;for(const m of t)r.set(m.id,0);for(const m of t){const f=[],g=new Map,x=new Map,v=new Map;for(const M of t)g.set(M.id,[]),x.set(M.id,0),v.set(M.id,-1);x.set(m.id,1),v.set(m.id,0);const b=[m.id];for(;b.length>0;){const M=b.shift();f.push(M);for(const k of n.get(M)||[])v.get(k)<0&&(b.push(k),v.set(k,v.get(M)+1)),v.get(k)===v.get(M)+1&&(x.set(k,x.get(k)+x.get(M)),g.get(k).push(M))}const w=new Map;for(const M of t)w.set(M.id,0);for(;f.length>0;){const M=f.pop();for(const k of g.get(M))w.set(k,w.get(k)+x.get(k)/x.get(M)*(1+w.get(M)));M!==m.id&&r.set(M,r.get(M)+w.get(M))}}const a=t.length;if(a>2){const m=2/((a-1)*(a-2));for(const[f,g]of r)r.set(f,g*m)}const i=new Map;for(const m of t){const f=new Map,g=[m.id];for(f.set(m.id,0);g.length>0;){const b=g.shift();for(const w of n.get(b)||[])f.has(w)||(f.set(w,f.get(b)+1),g.push(w))}let x=0,v=0;for(const[b,w]of f)b!==m.id&&w>0&&(x+=w,v++);i.set(m.id,v>0?v/x:0)}const s=new Map;for(const m of t)s.set(m.id,m.id);let c=!0,l=0;for(;c&&l<10;){c=!1,l++;for(const m of t){const f=new Map;for(const v of n.get(m.id)||[]){const b=s.get(v);f.set(b,(f.get(b)||0)+(m.connections.get(v)||1))}let g=s.get(m.id),x=f.get(g)||0;for(const[v,b]of f)b>x&&(x=b,g=v);g!==s.get(m.id)&&(s.set(m.id,g),c=!0)}}const d=Math.max(...t.map(m=>m.connections.size),1),u=new Set(t.filter(m=>m.connections.size/d>=.6).map(m=>m.id)),h=new Set;for(const m of t){if((r.get(m.id)||0)<.2)continue;const g=new Set;for(const[x]of m.connections){const v=s.get(x);v!==void 0&&g.add(v)}g.size>=2&&h.add(m.id)}for(const m of t)if(m.betweenness=r.get(m.id)??0,m.closeness=i.get(m.id)??0,m.communityId=s.get(m.id),m.isHub=u.has(m.id),m.isBridge=h.has(m.id),m.mentionCount===void 0&&(m.mentionCount=m.connections.size),m.computedRelevance===void 0&&m.relevance!==void 0){const f=Math.min(m.connections.size/10,1);m.computedRelevance=Math.min(1,(m.relevance??.5)*.35+(m.betweenness??0)*.25+(m.closeness??0)*.2+f*.2)}}function UJ(e){const t=new Set(e.nodes.filter(n=>n.label&&!n.userPlaced).map(n=>n.id));if(t.size!==0){e.nodes=e.nodes.filter(n=>!t.has(n.id));for(const n of e.nodes)for(const r of t)n.connections.delete(r)}}function W6(e){let t=Math.abs(e|0)%2147483647||1;return{next(){return t=t*16807%2147483647,(t-1)/2147483646},getState(){return t},setState(n){t=n}}}function ba(e,t,n){return e+(t-e)*n}function Lu(e,t,n){return e<t?t:e>n?n:e}function Qy(e,t){const n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)}function R0(e,t,n,r){const a=e-n,i=t-r;return Math.sqrt(a*a+i*i)}function Ry(e){const t=e()||1e-4,n=e();return Math.sqrt(-2*Math.log(t))*Math.cos(2*Math.PI*n)}function Vv(e){return e.connections.size}function Uv(e,t,n,r){const a=W6(n),i=[];let s=0;const c=[{x:e*.25,y:t*.35},{x:e*.75,y:t*.35},{x:e*.5,y:t*.72}];for(let d=0;d<xx;d++)i.push({id:s++,x:c[d].x,y:c[d].y,vx:(a.next()-.5)*15,vy:(a.next()-.5)*15,heat:1,isEntry:!0,age:0,connections:new Map});for(let d=0;d<i.length;d++)for(let u=d+1;u<i.length;u++)if(a.next()<.55){const h=.4+a.next()*.2;i[d].connections.set(i[u].id,h),i[u].connections.set(i[d].id,h)}const l=14;for(let d=0;d<l;d++){const u=a.next()<.3;let h,m;if(u)h=Mo+a.next()*(e-2*Mo),m=Mo+a.next()*(t-2*Mo);else{const g=Math.floor(a.next()*xx),x=i[g],v=70;h=Lu(x.x+Ry(a.next.bind(a))*v,Mo,e-Mo),m=Lu(x.y+Ry(a.next.bind(a))*v,Mo,t-Mo)}const f={id:s++,x:h,y:m,vx:(a.next()-.5)*30,vy:(a.next()-.5)*30,heat:.4+a.next()*.4,isEntry:!1,age:0,connections:new Map};if(!u){let g=i[0],x=1/0;for(let b=0;b<xx;b++){const w=R0(f.x,f.y,i[b].x,i[b].y);w<x&&(x=w,g=i[b])}const v=.4+a.next()*.4;f.connections.set(g.id,v),g.connections.set(f.id,v)}i.push(f)}return{nodes:i,nextId:s,params:{...r},aesthetics:{...lw},growthTimer:0,entryTimer:0,forgetTimer:0,reterritTimer:0,seed:n,rngState:a.getState()}}function G6(e,t,n,r,a,i){const s={id:e.nextId++,x:Lu(t,Mo,r-Mo),y:Lu(n,Mo,a-Mo),vx:(Math.random()-.5)*25,vy:(Math.random()-.5)*25,heat:1,isEntry:!1,age:0,connections:new Map,label:i,userPlaced:!0};if(e.nodes.length>0){let c=null,l=1/0;for(const d of e.nodes){const u=R0(s.x,s.y,d.x,d.y);u<l&&(l=u,c=d)}if(c){const d=.55+Math.random()*.3;s.connections.set(c.id,d),c.connections.set(s.id,d),c.heat=Math.min(1,c.heat+.6)}if(e.nodes.length>1&&l<200){let d=null,u=1/0;for(const h of e.nodes){if(s.connections.has(h.id))continue;const m=R0(s.x,s.y,h.x,h.y);m<u&&m<300&&(u=m,d=h)}if(d){const h=.35+Math.random()*.3;s.connections.set(d.id,h),d.connections.set(s.id,h)}}}return e.nodes.push(s),s}function V6(e,t,n,r){const a=Math.min(r,.033),i=e.params,s=W6(0);s.setState(e.rngState);const c=s.next.bind(s),l=ba(9,2,i.multiplicidade),d=ba(1.8,.35,i.multiplicidade);e.entryTimer+=a,e.growthTimer+=a,e.forgetTimer+=a,e.reterritTimer+=a;for(const h of e.nodes)h.age+=a;if(e.entryTimer>=l){e.entryTimer=0;const h=Math.floor(1+i.multiplicidade*2),m=e.nodes.filter(f=>f.isEntry);for(let f=0;f<h&&!(e.nodes.length>=Gv);f++){let g=Mo+c()*(t-2*Mo),x=Mo+c()*(n-2*Mo),v=0;for(let M=0;M<14;M++){const k=Mo+c()*(t-2*Mo),R=Mo+c()*(n-2*Mo);let j=1/0;for(const I of m){const E=R0(I.x,I.y,k,R);E<j&&(j=E)}if(j>180){g=k,x=R;break}j>v&&(v=j,g=k,x=R)}const b={id:e.nextId++,x:g,y:x,vx:(c()-.5)*20,vy:(c()-.5)*20,heat:1,isEntry:!0,age:0,connections:new Map},w=1+Math.floor(c()*3);for(let M=0;M<w&&e.nodes.length>0;M++){let k=null,R=-1;for(let j=0;j<4;j++){const I=e.nodes[Math.floor(c()*e.nodes.length)];if(b.connections.has(I.id))continue;const O=1/(R0(I.x,I.y,b.x,b.y)+1);O>R&&(R=O,k=I)}if(k){const j=.4+c()*.3;b.connections.set(k.id,j),k.connections.set(b.id,j)}}e.nodes.push(b),m.push(b)}}if(e.growthTimer>=d){e.growthTimer=0;const h=Math.floor(1+i.density*2);for(let m=0;m<h&&!(e.nodes.length>=Gv||e.nodes.length===0);m++){let f;if(i.hubs>0&&e.nodes.length>0){const M=ba(.2,1.4,i.hubs);let k=e.nodes[Math.floor(c()*e.nodes.length)],R=Math.pow(Vv(k)+1,M);for(let j=1;j<6;j++){const I=e.nodes[Math.floor(c()*e.nodes.length)],E=Math.pow(Vv(I)+1,M);E>R&&(R=E,k=I)}f=k}else f=e.nodes[Math.floor(c()*e.nodes.length)];if(!f)break;const g=ba(110,30,i.territorializacao),x=Lu(f.x+Ry(c)*g,Mo,t-Mo),v=Lu(f.y+Ry(c)*g,Mo,n-Mo),b={id:e.nextId++,x,y:v,vx:(c()-.5)*40,vy:(c()-.5)*40,heat:.6+c()*.3,isEntry:!1,age:0,connections:new Map},w=.4+c()*.4;if(b.connections.set(f.id,w),f.connections.set(b.id,w),c()<i.reterritorializacao*.55&&e.nodes.length>1){let M=null,k=1/0;const R=Math.min(14,e.nodes.length);for(let j=0;j<R;j++){const I=e.nodes[Math.floor(c()*e.nodes.length)];if(I.id===f.id||I.id===b.id)continue;const E=R0(I.x,I.y,b.x,b.y);E<k&&(k=E,M=I)}if(M){const j=.3+c()*.3;b.connections.set(M.id,j),M.connections.set(b.id,j)}}e.nodes.push(b)}i.reterritorializacao>0&&lk(e,c)}e.reterritTimer>=.5&&(e.reterritTimer=0,i.reterritorializacao>0&&lk(e,c)),YJ(e,t,n,a,c),c()<i.linhasDeFuga*.1&&KJ(e,c),e.forgetTimer>=1&&(e.forgetTimer=0,XJ(e));const u=ba(80,220,i.linhasDeFuga);for(const h of e.nodes){if(h.pinned){h.vx=0,h.vy=0;continue}h.x+=h.vx*a,h.y+=h.vy*a,h.x<Mo&&(h.vx*=-.55,h.x=Mo),h.x>t-Mo&&(h.vx*=-.55,h.x=t-Mo),h.y<Mo&&(h.vy*=-.55,h.y=Mo),h.y>n-Mo&&(h.vy*=-.55,h.y=n-Mo);const m=Math.sqrt(h.vx*h.vx+h.vy*h.vy);m>u&&(h.vx=h.vx/m*u,h.vy=h.vy/m*u),h.heat=Lu(h.heat*(1-a*.22),0,1)}e.rngState=s.getState()}function YJ(e,t,n,r,a){var f;const i=e.params,s=e.nodes,c=s.filter(g=>g.isEntry),l=new Map;for(const g of s)l.set(g.id,g);for(const g of s){if(g.pinned)continue;const x=ba(.96,.88,i.linhasDeFuga*.4+i.noise*.3);g.vx*=x,g.vy*=x;const v=Vv(g),b=v===0?3.5:v===1?1.8:1,w=i.noise*18*b;g.vx+=(a()*2-1)*w,g.vy+=(a()*2-1)*w,g.isEntry&&(g.vx+=(a()*2-1)*i.noise*10,g.vy+=(a()*2-1)*i.noise*10);for(const[M,k]of g.connections){const R=l.get(M);if(!R)continue;const j=R.x-g.x,I=R.y-g.y,E=Math.sqrt(j*j+I*I)||.001,O=g.category&&R.category&&g.category.toLowerCase()===R.category.toLowerCase(),F=((f=g.edgeTypes)==null?void 0:f.get(M))==="bridges"||E>jm,B=F?ba(280,500,i.linhasDeFuga):O?ba(60,140,1-i.territorializacao):ba(180,380,1-i.territorializacao),W=F?ba(4,14,i.linhasDeFuga)*k:O?ba(14,35,i.reterritorializacao)*k:ba(4,12,i.reterritorializacao)*k*.5,re=E-B,oe=j/E*W*re*r*.5,te=I/E*W*re*r*.5;g.vx+=oe,g.vy+=te}if(i.territorializacao>0&&!g.isEntry&&c.length>0){let M=c[0],k=1/0;for(const R of c){const j=R0(R.x,R.y,g.x,g.y);j<k&&(k=j,M=R)}if(k>80&&k<600){const R=i.territorializacao*10,j=M.x-g.x,I=M.y-g.y,E=1/k;g.vx+=j*E*R*r,g.vy+=I*E*R*r}}}for(let g=0;g<c.length;g++)for(let x=g+1;x<c.length;x++){const v=c[g],b=c[x];if(v.pinned&&b.pinned)continue;const w=b.x-v.x,M=b.y-v.y,k=Math.sqrt(w*w+M*M);if(k<300&&k>.01){const R=(1-k/300)*140*i.territorializacao,j=1/k;v.pinned||(v.vx-=w*j*R*r,v.vy-=M*j*R*r),b.pinned||(b.vx+=w*j*R*r,b.vy+=M*j*R*r)}}const d=s.length,u=Math.min(500,d*(d-1)/2);for(let g=0;g<u;g++){const x=Math.floor(a()*d),v=Math.floor(a()*d);if(x===v)continue;const b=s[x],w=s[v];if(b.pinned&&w.pinned)continue;const M=w.x-b.x,k=w.y-b.y,R=Math.sqrt(M*M+k*k),j=b.category&&w.category&&b.category.toLowerCase()===w.category.toLowerCase(),I=j?55:120,E=j?60:160;if(R<I&&R>.01){const O=(1-R/I)*E,L=1/R;b.pinned||(b.vx-=M*L*O*r,b.vy-=k*L*O*r),w.pinned||(w.vx+=M*L*O*r,w.vy+=k*L*O*r)}}const h=ba(50,120,i.linhasDeFuga),m=i.linhasDeFuga*.05;if(!e.searchMode)for(let g=0;g<Math.min(10,d);g++){const x=Math.floor(a()*d),v=s[x];if(v.connections.size>0)continue;const b=Math.floor(a()*d),w=s[b];if(b===x||w===v)continue;const k=v.category&&w.category&&v.category.toLowerCase()===w.category.toLowerCase()?m*4:m*.2;if(R0(v.x,v.y,w.x,w.y)<h&&a()<k){const j=.3+a()*.4;v.connections.set(w.id,j),w.connections.set(v.id,j),v.heat=Math.min(1,v.heat+.5),w.heat=Math.min(1,w.heat+.3)}}}function KJ(e,t){const n=e.nodes;if(!(n.length<2))for(let r=0;r<12;r++){const a=n[Math.floor(t()*n.length)],i=n[Math.floor(t()*n.length)];if(a.id===i.id||a.pinned&&i.pinned||e.searchMode&&(a.category&&i.category&&a.category.toLowerCase()===i.category.toLowerCase()||!a.category||!i.category))continue;const s=Qy(a,i);if(s>jm&&!a.connections.has(i.id)){const c=.2+t()*.3;a.connections.set(i.id,c),i.connections.set(a.id,c),a.heat=Math.min(1,a.heat+.45),i.heat=Math.min(1,i.heat+.45),a.edgeTypes||(a.edgeTypes=new Map),i.edgeTypes||(i.edgeTypes=new Map),a.edgeTypes.set(i.id,"bridges"),i.edgeTypes.set(a.id,"bridges");const l=15+t()*20,d=i.x-a.x,u=i.y-a.y,h=1/(s||1);a.pinned||(a.vx-=d*h*l*.4,a.vy-=u*h*l*.4),i.pinned||(i.vx+=d*h*l*.4,i.vy+=u*h*l*.4);return}}}function lk(e,t){const n=e.params,r=e.nodes,a=Math.min(35,r.length);for(let i=0;i<a;i++){const s=r[Math.floor(t()*r.length)],c=[],l=Math.min(14,r.length);for(let d=0;d<l;d++){const u=r[Math.floor(t()*r.length)];if(u.id===s.id)continue;const h=Qy(s,u);c.length<2?(c.push({node:u,dist:h}),c.sort((m,f)=>m.dist-f.dist)):h<c[1].dist&&(c[1]={node:u,dist:h},c.sort((m,f)=>m.dist-f.dist))}for(const{node:d}of c)if(t()<n.reterritorializacao*.55){if(s.connections.has(d.id)){const u=Math.min(1,s.connections.get(d.id)+.05);s.connections.set(d.id,u),d.connections.set(s.id,u)}else if(!e.searchMode&&s.category&&d.category&&s.category.toLowerCase()===d.category.toLowerCase()&&t()<.3){const h=.2+t()*.25;s.connections.set(d.id,h),d.connections.set(s.id,h)}}}}function XJ(e){var a;const t=e.params;if(t.esquecimento<=0)return;const n=new Map;for(const i of e.nodes)n.set(i.id,i);for(const i of e.nodes){const s=[];for(const[c,l]of i.connections){const d=l*(1-t.esquecimento*.09);d<.07?s.push(c):i.connections.set(c,d)}for(const c of s)i.connections.delete(c),(a=n.get(c))==null||a.connections.delete(i.id)}let r=0;e.nodes=e.nodes.filter(i=>r>=4?!0:!i.isEntry&&!i.userPlaced&&i.connections.size===0?(r++,!1):!0)}function Yv(e){const t=e.nodes,n=t.length;if(n===0)return{nodeCount:0,entryCount:0,longLinkCount:0,avgDegree:0,hubness:0,isolatedCount:0};let r=0,a=0,i=0,s=0;const c=new Set,l=t.filter(d=>d.isEntry).length;for(const d of t){const u=d.connections.size;r+=u,u>a&&(a=u),u===0&&!d.isEntry&&s++;for(const[h]of d.connections){const m=d.id<h?`${d.id}-${h}`:`${h}-${d.id}`;if(!c.has(m)){c.add(m);const f=t.find(g=>g.id===h);f&&Qy(d,f)>jm&&i++}}}return{nodeCount:n,entryCount:l,longLinkCount:i,avgDegree:r/n,hubness:a/Math.max(1,n),isolatedCount:s}}function Kv(e,t,n,r,a){var j,I;const i=t.params,s=t.aesthetics,c=t.nodes;if(e.fillStyle=s.bgColor,e.fillRect(0,0,n,r),c.length===0)return;const l=new Map;for(const E of c)l.set(E.id,E);const d=[],u=new Set;for(const E of c)for(const[O,L]of E.connections){const $=E.id<O?`${E.id}-${O}`:`${O}-${E.id}`;if(u.has($))continue;u.add($);const F=l.get(O);if(!F)continue;const B=Qy(E,F),W=((j=E.edgeTypes)==null?void 0:j.get(O))??((I=F.edgeTypes)==null?void 0:I.get(E.id)),re=W==="bridges"||B>jm;d.push({a:E,b:F,w:L,d:B,isLong:re,relation:W})}d.sort((E,O)=>O.w-E.w);const h=d.filter(E=>E.relation==="bridges"||E.isLong),m=d.filter(E=>E.relation!=="bridges"&&!E.isLong),f=.25,g=m.filter(E=>E.w>=f).slice(0,100),x=[...h,...g],v={influences:"#a78bfa",contrasts:"#ef4444",bridges:"#f472b6",extends:"#60a5fa",contains:"#4ade80",co_occurs:s.linkColor,method_for:"#fbbf24",example_of:"#fb923c",critiques:"#f87171",related:s.linkColor},b=ba(.5,3,s.linkWidth),w=s.linkOpacity;e.lineCap="round";for(const E of x){const O=E.relation?v[E.relation]??s.linkColor:s.linkColor;if(E.isLong||E.relation==="bridges"){const L=Math.min(.95,.3+E.w*.6);e.strokeStyle=E.relation==="bridges"?v.bridges:s.flightColor,e.lineWidth=b*(1.2+E.w*.8),e.globalAlpha=L*w*(.6+s.glowIntensity*.4),e.shadowColor=e.strokeStyle,e.shadowBlur=6*s.glowIntensity,e.beginPath(),e.moveTo(E.a.x,E.a.y),e.lineTo(E.b.x,E.b.y),e.stroke(),e.shadowBlur=0}else E.relation==="contrasts"||E.relation==="critiques"?(e.strokeStyle=O,e.lineWidth=b*.8,e.globalAlpha=w*E.w*.8,e.setLineDash([4,3]),e.beginPath(),e.moveTo(E.a.x,E.a.y),e.lineTo(E.b.x,E.b.y),e.stroke(),e.setLineDash([])):E.relation==="influences"||E.relation==="extends"?(e.strokeStyle=O,e.lineWidth=b*(.8+E.w*.5),e.globalAlpha=w*E.w,e.beginPath(),e.moveTo(E.a.x,E.a.y),e.lineTo(E.b.x,E.b.y),e.stroke()):(e.strokeStyle=O,e.lineWidth=b,e.globalAlpha=w*E.w,e.beginPath(),e.moveTo(E.a.x,E.a.y),e.lineTo(E.b.x,E.b.y),e.stroke())}e.globalAlpha=1;const M=ba(.4,2,s.nodeSize),k=ba(.1,2.5,s.connSizeScale??.5),R=.4+i.organismToIntensity*.6;for(const E of c){const O=Math.min(E.connections.size,20),$=1+(E.relevance??.5)*ba(0,1.6,s.relSizeScale??.5),F=(ky+O*.38*i.hubs*2*k)*M*$;let B;if(E.category?B=q6(E.category):E.isEntry?B=s.entryColor:O>=6&&i.hubs>.1?B=s.hubColor:E.heat>.6?B=s.hotColor:B=s.nodeColor,s.glowIntensity>.05&&(e.globalAlpha=.1*R*s.glowIntensity,e.fillStyle=B,e.shadowColor=B,e.shadowBlur=14,e.beginPath(),e.arc(E.x,E.y,F*4,0,Math.PI*2),e.fill(),e.shadowBlur=0,e.globalAlpha=.22*R*s.glowIntensity,e.beginPath(),e.arc(E.x,E.y,F*2,0,Math.PI*2),e.fill()),e.globalAlpha=(.65+E.heat*.35)*R,e.fillStyle=B,e.beginPath(),e.arc(E.x,E.y,F,0,Math.PI*2),e.fill(),E.isBridge){const W=Math.sin(E.age*3)*.15+.35;e.globalAlpha=W*R,e.strokeStyle="#f472b6",e.lineWidth=1.5,e.beginPath(),e.arc(E.x,E.y,F+6,0,Math.PI*2),e.stroke(),e.globalAlpha=W*.5*R,e.beginPath(),e.arc(E.x,E.y,F+10,0,Math.PI*2),e.stroke()}if(E.isHub&&!E.isBridge&&(e.globalAlpha=.25*R,e.strokeStyle=s.hubColor,e.lineWidth=2,e.beginPath(),e.arc(E.x,E.y,F+5,0,Math.PI*2),e.stroke()),E.isEntry&&(e.globalAlpha=.18*R,e.strokeStyle=s.entryColor,e.lineWidth=1,e.beginPath(),e.arc(E.x,E.y,F+4.5,0,Math.PI*2),e.stroke()),E.userPlaced&&E.age<3){const W=Math.sin(E.age*6)*.4+.6;e.globalAlpha=.5*W*R,e.strokeStyle="#ffffff",e.lineWidth=1,e.beginPath(),e.arc(E.x,E.y,F+7,0,Math.PI*2),e.stroke()}}if(s.showLabels){const E=t.nodes.filter(O=>O.label);if(E.length>0){const O=ba(6,10,s.labelSize),L=E.map(F=>{const B=F.connections.size,W=Math.min(1,B/10*.45+F.heat*.4+(F.isEntry?.25:0)+(F.isAnchor?.4:0)),re=Math.round(O+W*2.5),oe=re*F.label.length*.52,te=3,J=ky*ba(.6,2.2,s.nodeSize)*(.6+F.heat*.7),pe=F.x-oe/2-te,P=F.y+J+2;return{n:F,importance:W,fs:re,lx:pe,ly:P,lw:oe+te*2,lh:re+2,degraded:!1}});L.sort((F,B)=>B.importance-F.importance);const $=[];for(const F of L){const B=$.some(W=>W.importance>F.importance*.6&&F.lx<W.x+W.w+2&&F.lx+F.lw>W.x-2&&F.ly<W.y+W.h+2&&F.ly+F.lh>W.y-2);F.degraded=B,$.push({x:F.lx,y:F.ly,w:F.lw,h:F.lh,importance:F.importance})}e.textAlign="center",e.textBaseline="top";for(const F of L){const B=F.degraded?Math.max(5,F.fs-2):F.fs;if(e.font=`${B}px system-ui, sans-serif`,F.degraded){const W=.2+F.importance*.25;e.globalAlpha=W,e.fillStyle=s.labelColor,e.fillText(F.n.label,F.n.x,F.ly+1)}else{const W=e.measureText(F.n.label).width,re=3,oe=F.n.x-W/2-re,te=F.ly,J=W+re*2,pe=B+2,P=3;e.globalAlpha=.52+F.importance*.28,e.fillStyle="rgba(0,0,0,0.78)",e.beginPath(),e.moveTo(oe+P,te),e.lineTo(oe+J-P,te),e.quadraticCurveTo(oe+J,te,oe+J,te+P),e.lineTo(oe+J,te+pe-P),e.quadraticCurveTo(oe+J,te+pe,oe+J-P,te+pe),e.lineTo(oe+P,te+pe),e.quadraticCurveTo(oe,te+pe,oe,te+pe-P),e.lineTo(oe,te+P),e.quadraticCurveTo(oe,te,oe+P,te),e.closePath(),e.fill(),e.globalAlpha=.7+F.importance*.28,e.fillStyle=s.labelColor,e.fillText(F.n.label,F.n.x,F.ly+1)}}e.textBaseline="alphabetic"}}e.globalAlpha=1,e.textAlign="left"}function U6(e,t,n,r,a,i){var F,B;const s=t.aesthetics,c=t.params,l=t.nodes;if(e.fillStyle=s.bgColor,e.fillRect(0,0,n,r),l.length===0)return;const d=n/2+a.panX,u=r/2+a.panY,m=Math.min(n,r)*a.fov+300,f=new Map;for(const W of l)f.set(W.id,W);const g=Math.cos(a.rotY),x=Math.sin(a.rotY),v=Math.cos(a.rotX),b=Math.sin(a.rotX),w=Math.cos(a.rotZ),M=Math.sin(a.rotZ);function k(W){const re=W.connections.size,te=(Math.min(1,re/8*.5+W.heat*.45+(W.isEntry?.2:0)+(W.isAnchor?.4:0)+((W.relevance??.5)-.5)*.3)-.5)*a.zSpread+Math.sin(W.id*2.39996)*a.zSpread*.33;let J=W.x-n/2,pe=W.y-r/2,P=te;const V=J*g+P*x,fe=-J*x+P*g,ye=pe*v-fe*b,Se=pe*b+fe*v,we=V*w-ye*M,ke=V*M+ye*w,De=m/(Se+m)*a.zoom,_e=d+we*De,ae=u+ke*De,Re=Math.max(0,Math.min(1,(Se+a.zSpread)/(a.zSpread*2))),Fe=a.fog>0?1-a.fog+a.fog*Math.max(.08,Re):1,Oe=Math.max(.15,De/m*2.2);return{n:W,px:_e,py:ae,pz:Se,scale:Oe,alpha:Fe}}const R=l.map(k);R.sort((W,re)=>W.pz-re.pz);const j=new Map;for(const W of R)j.set(W.n.id,W);const I=new Set,E=ba(.4,2.5,s.linkWidth),O={influences:"#a78bfa",contrasts:"#ef4444",bridges:"#f472b6",extends:"#60a5fa",contains:"#4ade80",co_occurs:s.linkColor,method_for:"#fbbf24",example_of:"#fb923c",critiques:"#f87171",related:s.linkColor};for(const W of R)for(const[re,oe]of W.n.connections){const te=W.n.id<re?`${W.n.id}-${re}`:`${re}-${W.n.id}`;if(I.has(te))continue;I.add(te);const J=j.get(re);if(!J)continue;const pe=(W.alpha+J.alpha)/2,P=((F=W.n.edgeTypes)==null?void 0:F.get(re))??((B=J.n.edgeTypes)==null?void 0:B.get(W.n.id)),V=P==="bridges"||Math.hypot(W.n.x-J.n.x,W.n.y-J.n.y)>jm,fe=P?O[P]??s.linkColor:s.linkColor;e.globalAlpha=s.linkOpacity*pe*oe*.85,e.strokeStyle=V?s.flightColor:fe,e.lineWidth=E*(.7+pe*.5),(P==="contrasts"||P==="critiques")&&(e.setLineDash([3,2]),e.strokeStyle=fe),e.beginPath(),e.moveTo(W.px,W.py),e.lineTo(J.px,J.py),e.stroke(),e.setLineDash([])}const L=ba(.4,2,s.nodeSize),$=ba(.1,2.5,s.connSizeScale??.5);for(const W of R){const{n:re}=W,oe=Math.min(re.connections.size,20),J=1+(re.relevance??.5)*ba(0,1.6,s.relSizeScale??.5),pe=(ky+oe*.38*c.hubs*2*$)*L*W.scale*J;let P;re.category?P=q6(re.category):re.isAnchor||re.isEntry?P=s.entryColor:oe>=6?P=s.hubColor:re.heat>.6?P=s.hotColor:P=s.nodeColor,s.glowIntensity>.05&&(e.globalAlpha=.09*W.alpha*s.glowIntensity,e.fillStyle=P,e.shadowColor=P,e.shadowBlur=14,e.beginPath(),e.arc(W.px,W.py,pe*3.5,0,Math.PI*2),e.fill(),e.shadowBlur=0),e.globalAlpha=(.5+re.heat*.4)*W.alpha,e.fillStyle=P,e.beginPath(),e.arc(W.px,W.py,Math.max(1.2,pe),0,Math.PI*2),e.fill(),(re.isEntry||re.isAnchor)&&(e.globalAlpha=.18*W.alpha,e.strokeStyle=s.entryColor,e.lineWidth=.8,e.beginPath(),e.arc(W.px,W.py,Math.max(2,pe+4.5),0,Math.PI*2),e.stroke())}if(s.showLabels){e.textAlign="center",e.textBaseline="top";const W=R.filter(oe=>oe.n.label).map(oe=>{const te=oe.n.connections.size,J=Math.min(1,te/8*.45+oe.n.heat*.35+(oe.n.isEntry?.3:0)+(oe.n.isAnchor?.5:0)+((oe.n.relevance??.5)-.5)*.4);return{p3:oe,importance:J}}).filter(({importance:oe})=>oe>.28).sort((oe,te)=>te.importance-oe.importance),re=ba(6,10,s.labelSize);for(const{p3:oe,importance:te}of W){const J=Math.round(re+te*2.5+oe.scale*1.5);e.font=`${J}px system-ui, sans-serif`;const pe=oe.n.connections.size,P=(ky+pe*.38)*L*oe.scale,V=oe.py+Math.max(2,P)+2,fe=e.measureText(oe.n.label).width,ye=3;e.globalAlpha=Math.min(.9,oe.alpha*(.5+te*.4)),e.fillStyle="rgba(0,0,0,0.78)",e.fillRect(oe.px-fe/2-ye,V,fe+ye*2,J+2),e.globalAlpha=Math.min(1,oe.alpha*(.65+te*.3)),e.fillStyle=s.labelColor,e.fillText(oe.n.label,oe.px,V+1)}e.textBaseline="alphabetic"}e.globalAlpha=1,e.textAlign="left"}function JJ(e){try{const n={nodes:e.nodes.map(r=>({...r,connections:Array.from(r.connections.entries())})),nextId:e.nextId,params:e.params,aesthetics:e.aesthetics,seed:e.seed,rngState:e.rngState};return JSON.stringify(n)}catch(t){return console.error("Failed to create snapshot:",t),""}}function QJ(e,t,n){try{const r=JSON.parse(e);return{nodes:r.nodes.map(s=>({...s,connections:new Map(s.connections)})),nextId:r.nextId,params:r.params,aesthetics:r.aesthetics||lw,growthTimer:0,entryTimer:0,forgetTimer:0,reterritTimer:0,seed:r.seed,rngState:r.rngState}}catch(r){return console.error("Failed to restore from snapshot:",r),null}}const ck=Object.freeze(Object.defineProperty({__proto__:null,addNodeAtPosition:G6,computeRhizomeMetrics:Yv,createRhizomeState:Uv,createSnapshot:JJ,renderRhizome:Kv,renderRhizome3D:U6,restoreFromSnapshot:QJ,tickRhizome:V6},Symbol.toStringTag,{value:"Module"})),dk="'Doto', monospace",Ca="'IBM Plex Mono', monospace";function ZJ({folders:e,onCreateFolder:t,onDeleteFolder:n,onSelectCard:r,onRemoveCard:a,onMoveCard:i,onClose:s}){const[c,l]=S.useState(new Set),[d,u]=S.useState(!1),[h,m]=S.useState(""),[f,g]=S.useState(""),[x,v]=S.useState(340),[b,w]=S.useState(!1),[M,k]=S.useState(null),[R,j]=S.useState(null),I=S.useRef(null),E=L=>{const $=new Set(c);$.has(L)?$.delete(L):$.add(L),l($)},O=()=>{h.trim()&&(t(h.trim(),f.trim()||void 0),m(""),g(""),u(!1))};return S.useEffect(()=>{if(!b)return;const L=F=>{const B=Math.max(280,Math.min(600,F.clientX));v(B)},$=()=>{w(!1)};return document.addEventListener("mousemove",L),document.addEventListener("mouseup",$),()=>{document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",$)}},[b]),o.jsxs(o.Fragment,{children:[o.jsxs("div",{ref:I,style:{position:"absolute",top:0,left:0,width:x,height:"100%",background:"rgba(0,0,0,0.97)",backdropFilter:"blur(8px)",borderRight:"1px dashed rgba(255,255,255,0.06)",display:"flex",flexDirection:"column",overflow:"hidden",zIndex:50,boxShadow:"6px 0 32px rgba(0,0,0,0.4)"},children:[o.jsxs("div",{style:{padding:"16px 18px",borderBottom:"1px dashed rgba(255,255,255,0.06)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx(lf,{size:14,strokeWidth:1.5,style:{color:"rgba(255,255,255,0.45)"}}),o.jsx("span",{style:{fontFamily:dk,fontSize:11,color:"rgba(255,255,255,0.85)",letterSpacing:"0.08em",textTransform:"uppercase"},children:"COLEES"})]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[o.jsx("button",{onClick:()=>u(L=>!L),style:{background:"rgba(255,255,255,0.05)",border:"1px dashed rgba(255,255,255,0.06)",borderRadius:1,padding:"4px 6px",cursor:"pointer",color:"rgba(255,255,255,0.65)",fontFamily:Ca,letterSpacing:"0.06em",textTransform:"uppercase",display:"flex",alignItems:"center",transition:"all 0.15s"},onMouseEnter:L=>{L.currentTarget.style.background="rgba(255,255,255,0.08)",L.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},onMouseLeave:L=>{L.currentTarget.style.background="rgba(255,255,255,0.05)",L.currentTarget.style.borderColor="rgba(255,255,255,0.06)"},title:"Nova pasta",children:o.jsx(Iy,{size:11,strokeWidth:1.5})}),o.jsx("button",{onClick:L=>{L.preventDefault(),L.stopPropagation(),s()},style:{background:"rgba(255,255,255,0.05)",border:"1px dashed rgba(255,255,255,0.06)",borderRadius:1,padding:"4px 6px",cursor:"pointer",color:"rgba(255,255,255,0.45)",fontFamily:Ca,display:"flex",alignItems:"center",transition:"all 0.15s"},onMouseEnter:L=>{L.currentTarget.style.background="rgba(255,255,255,0.08)",L.currentTarget.style.borderColor="rgba(255,255,255,0.1)",L.currentTarget.style.color="rgba(255,255,255,0.65)"},onMouseLeave:L=>{L.currentTarget.style.background="rgba(255,255,255,0.05)",L.currentTarget.style.borderColor="rgba(255,255,255,0.06)",L.currentTarget.style.color="rgba(255,255,255,0.45)"},title:"Fechar",children:o.jsx(Cs,{size:12,strokeWidth:2})})]})]}),o.jsx(x0,{children:d&&o.jsx($o.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{borderBottom:"1px dashed rgba(255,255,255,0.06)",overflow:"hidden"},children:o.jsxs("div",{style:{padding:"12px 14px",display:"flex",flexDirection:"column",gap:8},children:[o.jsx("input",{type:"text",placeholder:"Nome da coleo",value:h,onChange:L=>m(L.target.value),onKeyDown:L=>{L.key==="Enter"&&O()},style:{width:"100%",padding:"6px 8px",borderRadius:1,fontSize:10,fontFamily:Ca,background:"rgba(255,255,255,0.05)",border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.85)",outline:"none"},autoFocus:!0}),o.jsx("input",{type:"text",placeholder:"Descrio (opcional)",value:f,onChange:L=>g(L.target.value),onKeyDown:L=>{L.key==="Enter"&&O()},style:{width:"100%",padding:"6px 8px",borderRadius:1,fontSize:9,fontFamily:Ca,background:"rgba(255,255,255,0.03)",border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.65)",outline:"none"}}),o.jsx("button",{onClick:O,style:{width:"100%",padding:"5px 0",borderRadius:1,fontSize:8,fontFamily:Ca,background:"rgba(255,255,255,0.05)",border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.65)",cursor:"pointer",letterSpacing:"0.06em",textTransform:"uppercase",transition:"all 0.15s"},onMouseEnter:L=>{L.currentTarget.style.background="rgba(255,255,255,0.08)",L.currentTarget.style.borderColor="rgba(255,255,255,0.1)"},onMouseLeave:L=>{L.currentTarget.style.background="rgba(255,255,255,0.05)",L.currentTarget.style.borderColor="rgba(255,255,255,0.06)"},children:"Criar"})]})})}),o.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"8px 0"},children:[e.length===0&&!d&&o.jsxs("div",{style:{padding:"24px 20px",textAlign:"center",fontSize:8,fontFamily:Ca,color:"rgba(255,255,255,0.45)",lineHeight:1.5},children:["Nenhuma coleo ainda.",o.jsx("br",{}),"Clique ",o.jsx("span",{style:{color:"rgba(255,255,255,0.65)"},children:"+"})," para criar."]}),e.map(L=>{const $=c.has(L.id);return o.jsxs("div",{style:{marginBottom:2},children:[o.jsxs("div",{style:{padding:"8px 14px",display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",transition:"all 0.15s"},onClick:()=>E(L.id),onMouseEnter:F=>F.currentTarget.style.background="rgba(255,255,255,0.05)",onMouseLeave:F=>F.currentTarget.style.background="transparent",children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:7,flex:1},children:[$?o.jsx(Ms,{size:10,strokeWidth:1.5,style:{color:"rgba(255,255,255,0.45)"}}):o.jsx(hs,{size:10,strokeWidth:1.5,style:{color:"rgba(255,255,255,0.45)"}}),o.jsx(lf,{size:12,strokeWidth:1.5,style:{color:L.color||"rgba(255,255,255,0.45)"}}),o.jsxs("div",{style:{flex:1},children:[o.jsx("div",{style:{fontFamily:Ca,fontSize:10,color:"rgba(255,255,255,0.65)"},children:L.name}),L.description&&o.jsx("div",{style:{fontFamily:Ca,fontSize:8,color:"rgba(255,255,255,0.45)",marginTop:1},children:L.description})]}),o.jsx("span",{style:{fontSize:8,color:"rgba(255,255,255,0.22)",fontFamily:Ca},children:L.cards.length})]}),o.jsx("button",{onClick:F=>{F.stopPropagation(),n(L.id)},style:{background:"none",border:"none",cursor:"pointer",color:"rgba(255,255,255,0.2)",padding:3,display:"flex",alignItems:"center"},onMouseEnter:F=>F.currentTarget.style.color="rgba(239,68,68,0.7)",onMouseLeave:F=>F.currentTarget.style.color="rgba(255,255,255,0.2)",title:"Deletar pasta",children:o.jsx(il,{size:10,strokeWidth:1.5})})]}),o.jsx(x0,{children:$&&o.jsx($o.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden",paddingLeft:32},children:L.cards.length===0?o.jsx("div",{style:{padding:"8px 12px",fontSize:8,fontFamily:Ca,color:"rgba(255,255,255,0.22)",fontStyle:"italic"},children:"Vazio"}):L.cards.map(F=>{const B=M===F.id;return o.jsxs("div",{style:{marginBottom:4},children:[o.jsxs("div",{style:{padding:"6px 10px",margin:"2px 8px 2px 0",borderRadius:1,cursor:"pointer",background:B?"rgba(255,255,255,0.08)":"rgba(255,255,255,0.05)",border:`1px dashed ${B?"rgba(255,255,255,0.1)":"rgba(255,255,255,0.06)"}`,display:"flex",alignItems:"center",justifyContent:"space-between",transition:"all 0.15s"},onClick:()=>k(B?null:F.id),onMouseEnter:W=>{B||(W.currentTarget.style.background="rgba(255,255,255,0.08)",W.currentTarget.style.borderColor="rgba(255,255,255,0.1)")},onMouseLeave:W=>{B||(W.currentTarget.style.background="rgba(255,255,255,0.05)",W.currentTarget.style.borderColor="rgba(255,255,255,0.06)")},children:[o.jsx("div",{style:{flex:1,minWidth:0},children:o.jsx("div",{style:{fontFamily:Ca,fontSize:9,color:"rgba(255,255,255,0.65)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:F.label})}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[o.jsx("button",{onClick:W=>{W.stopPropagation(),j({folderId:L.id,card:F})},style:{background:"none",border:"none",cursor:"pointer",color:"rgba(255,255,255,0.15)",padding:2,display:"flex",alignItems:"center"},onMouseEnter:W=>W.currentTarget.style.color="rgba(124,58,237,0.6)",onMouseLeave:W=>W.currentTarget.style.color="rgba(255,255,255,0.15)",title:"Mover para outra pasta",children:o.jsx(OP,{size:9,strokeWidth:1.5})}),o.jsx("button",{onClick:W=>{W.stopPropagation(),r(F)},style:{background:"none",border:"none",cursor:"pointer",color:"rgba(255,255,255,0.15)",padding:2,display:"flex",alignItems:"center"},onMouseEnter:W=>W.currentTarget.style.color="rgba(34,197,94,0.7)",onMouseLeave:W=>W.currentTarget.style.color="rgba(255,255,255,0.15)",title:"Abrir snapshot",children:o.jsx(sS,{size:9,strokeWidth:1.5})}),o.jsx("button",{onClick:W=>{W.stopPropagation(),a(L.id,F.id)},style:{background:"none",border:"none",cursor:"pointer",color:"rgba(255,255,255,0.15)",padding:2,display:"flex",alignItems:"center"},onMouseEnter:W=>W.currentTarget.style.color="rgba(239,68,68,0.6)",onMouseLeave:W=>W.currentTarget.style.color="rgba(255,255,255,0.15)",title:"Remover",children:o.jsx(il,{size:8,strokeWidth:1.5})})]})]}),o.jsx(x0,{children:B&&o.jsxs($o.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden",margin:"0 8px 0 0",padding:"8px 10px",background:"rgba(0,0,0,0.5)",borderRadius:1,border:"1px dashed rgba(255,255,255,0.06)"},children:[F.description&&o.jsxs("div",{style:{marginBottom:8},children:[o.jsx("div",{style:{fontFamily:Ca,fontSize:7,color:"rgba(255,255,255,0.22)",marginBottom:3,textTransform:"uppercase",letterSpacing:"0.08em"},children:"Descrio"}),o.jsx("div",{style:{fontFamily:Ca,fontSize:8,color:"rgba(255,255,255,0.65)",lineHeight:1.4},children:F.description})]}),F.tags&&F.tags.length>0&&o.jsxs("div",{style:{marginBottom:8},children:[o.jsxs("div",{style:{fontFamily:Ca,fontSize:7,color:"rgba(255,255,255,0.22)",marginBottom:4,textTransform:"uppercase",letterSpacing:"0.08em",display:"flex",alignItems:"center",gap:4},children:[o.jsx(yF,{size:7}),"Tags"]}),o.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:4},children:F.tags.map((W,re)=>o.jsx("span",{style:{fontFamily:Ca,fontSize:7,padding:"2px 6px",borderRadius:1,background:"rgba(255,255,255,0.05)",border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.65)"},children:W},re))})]}),F.links&&F.links.length>0&&o.jsxs("div",{style:{marginBottom:8},children:[o.jsx("div",{style:{fontFamily:Ca,fontSize:7,color:"rgba(255,255,255,0.22)",marginBottom:4,textTransform:"uppercase",letterSpacing:"0.08em"},children:"Links"}),F.links.map((W,re)=>o.jsxs("a",{href:W,target:"_blank",rel:"noopener noreferrer",style:{display:"block",fontFamily:Ca,fontSize:8,color:"rgba(255,255,255,0.65)",textDecoration:"none",marginBottom:2,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},onMouseEnter:oe=>oe.currentTarget.style.color="rgba(255,255,255,0.85)",onMouseLeave:oe=>oe.currentTarget.style.color="rgba(255,255,255,0.65)",children:[" ",W]},re))]}),F.connections&&F.connections.length>0&&o.jsxs("div",{children:[o.jsxs("div",{style:{fontFamily:Ca,fontSize:7,color:"rgba(255,255,255,0.22)",marginBottom:4,textTransform:"uppercase",letterSpacing:"0.08em"},children:["Conexes (",F.connections.length,")"]}),o.jsx("div",{style:{fontFamily:Ca,fontSize:7,color:"rgba(255,255,255,0.45)",lineHeight:1.4},children:F.connections.join(", ")})]})]})})]},F.id)})})})]},L.id)})]}),o.jsx("div",{style:{position:"absolute",top:0,right:0,width:6,height:"100%",cursor:"ew-resize",background:b?"rgba(255,255,255,0.08)":"transparent",transition:"all 0.15s"},onMouseDown:()=>w(!0),onMouseEnter:L=>{b||(L.currentTarget.style.background="rgba(255,255,255,0.05)")},onMouseLeave:L=>{b||(L.currentTarget.style.background="transparent")}})]}),o.jsx(x0,{children:R&&o.jsx($o.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(8px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:100},onClick:()=>j(null),children:o.jsxs($o.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:L=>L.stopPropagation(),style:{background:"rgba(0,0,0,0.97)",border:"1px dashed rgba(255,255,255,0.06)",borderRadius:1,padding:"20px 24px",minWidth:300,maxWidth:400},children:[o.jsxs("div",{style:{fontFamily:dk,fontSize:12,color:"rgba(255,255,255,0.85)",marginBottom:12},children:['Mover "',R.card.label,'"']}),o.jsx("div",{style:{fontFamily:Ca,fontSize:8,color:"rgba(255,255,255,0.45)",marginBottom:16,letterSpacing:"0.08em",textTransform:"uppercase"},children:"Escolha a pasta de destino:"}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:6,marginBottom:16},children:e.filter(L=>L.id!==R.folderId).map(L=>o.jsxs("button",{onClick:()=>{i(R.folderId,L.id,R.card.id),j(null)},style:{padding:"8px 12px",borderRadius:1,background:"rgba(255,255,255,0.05)",border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.65)",fontFamily:Ca,fontSize:10,cursor:"pointer",textAlign:"left",display:"flex",alignItems:"center",gap:8,letterSpacing:"0.06em",transition:"all 0.15s"},onMouseEnter:$=>{$.currentTarget.style.background="rgba(255,255,255,0.08)",$.currentTarget.style.borderColor="rgba(255,255,255,0.1)",$.currentTarget.style.color="rgba(255,255,255,0.85)"},onMouseLeave:$=>{$.currentTarget.style.background="rgba(255,255,255,0.05)",$.currentTarget.style.borderColor="rgba(255,255,255,0.06)",$.currentTarget.style.color="rgba(255,255,255,0.65)"},children:[o.jsx(lf,{size:12,strokeWidth:1.5,style:{color:L.color||"rgba(255,255,255,0.45)"}}),o.jsx("span",{style:{fontFamily:Ca},children:L.name})]},L.id))}),o.jsx("button",{onClick:()=>j(null),style:{width:"100%",padding:"6px",borderRadius:1,background:"rgba(255,255,255,0.05)",border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.45)",fontFamily:Ca,fontSize:8,cursor:"pointer",letterSpacing:"0.06em",textTransform:"uppercase",transition:"all 0.15s"},onMouseEnter:L=>{L.currentTarget.style.background="rgba(255,255,255,0.08)",L.currentTarget.style.borderColor="rgba(255,255,255,0.1)",L.currentTarget.style.color="rgba(255,255,255,0.65)"},onMouseLeave:L=>{L.currentTarget.style.background="rgba(255,255,255,0.05)",L.currentTarget.style.borderColor="rgba(255,255,255,0.06)",L.currentTarget.style.color="rgba(255,255,255,0.45)"},children:"Cancelar"})]})})})]})}const eQ="https://api.are.na/v2";class uk{constructor(t){this.token=t.accessToken}async request(t,n="GET",r){const a=this.token.replace(/^Bearer\s+/i,"").trim(),i={Authorization:`Bearer ${a}`,"Content-Type":"application/json"},s={method:n,headers:i};r&&(s.body=JSON.stringify(r));const c=`${eQ}${t}`;console.log(`[Are.na API] ${n} ${c}`,"Token:",a.substring(0,10)+"...");const l=await fetch(c,s);if(!l.ok){let d=`Are.na API error: ${l.status}`;try{const u=await l.json();u.message&&(d+=` - ${u.message}`),console.error("[Are.na API] Error response:",u)}catch{d+=` ${l.statusText}`}throw console.error(`[Are.na API] ${n} ${c} failed:`,d),new Error(d)}return l.json()}async getChannels(){return(await this.request("/users/me/channels?per=100")).channels||[]}async createChannel(t,n=!1){return await this.request("/channels","POST",{title:t,status:n?"public":"private"})}async addLinkToChannel(t,n,r){return await this.request(`/channels/${t}/blocks`,"POST",{source:n,title:r})}async addTextToChannel(t,n,r){return await this.request(`/channels/${t}/blocks`,"POST",{content:n,title:r})}async getChannel(t){const n=await this.request(`/channels/${t}`);return{channel:n,blocks:n.contents||[]}}}function Y6(){return localStorage.getItem("arena_access_token")}function tQ(e){localStorage.setItem("arena_access_token",e)}function nQ(){localStorage.removeItem("arena_access_token")}function vp(){return!!Y6()}function rQ({onClose:e,onSaveToChannel:t}){const[n,r]=S.useState(""),[a,i]=S.useState(!1),[s,c]=S.useState(!1),[l,d]=S.useState([]),[u,h]=S.useState(""),[m,f]=S.useState(!1),g=n.trim().length>20&&!n.includes(" ");S.useEffect(()=>{const w=Y6();w&&(r(w),c(!0),x(w))},[]);const x=async w=>{try{const k=await new uk({accessToken:w}).getChannels();d(k)}catch(M){console.warn("Failed to load channels:",M)}},v=async()=>{if(n.trim()){i(!0),h("");try{const M=await new uk({accessToken:n.trim()}).getChannels();tQ(n.trim()),c(!0),d(M)}catch(w){const M=w instanceof Error?w.message:"Token invlido ou erro de conexo";h(M),console.error("Are.na connection error:",w)}finally{i(!1)}}},b=()=>{nQ(),r(""),c(!1),d([])};return o.jsxs("div",{style:{position:"fixed",inset:0,zIndex:999,background:"rgba(0,0,0,0.75)",backdropFilter:"blur(8px)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:e,children:[o.jsxs($o.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},style:{width:480,maxHeight:"75vh",background:"rgba(10,8,18,0.95)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:12,overflow:"hidden",boxShadow:"0 24px 80px rgba(0,0,0,0.7)",display:"flex",flexDirection:"column"},onClick:w=>w.stopPropagation(),children:[o.jsxs("div",{style:{padding:"18px 22px",borderBottom:"1px solid rgba(255,255,255,0.08)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[o.jsx("div",{style:{width:28,height:28,borderRadius:6,background:"linear-gradient(135deg, rgba(196,181,253,0.15), rgba(124,58,237,0.15))",border:"1px solid rgba(196,181,253,0.25)",display:"flex",alignItems:"center",justifyContent:"center"},children:o.jsx(sS,{size:14,strokeWidth:1.5,style:{color:"rgba(196,181,253,0.8)"}})}),o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:12,color:"rgba(255,255,255,0.85)",fontWeight:600},children:"Conectar Are.na"}),o.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.35)",marginTop:2},children:"Salve cards diretamente nos seus channels"})]})]}),o.jsx("button",{onClick:e,style:{background:"none",border:"none",color:"rgba(255,255,255,0.3)",cursor:"pointer",fontSize:18,padding:0,lineHeight:1},children:""})]}),o.jsx("div",{style:{flex:1,overflowY:"auto",padding:"20px 22px"},children:s?o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:14},children:[o.jsxs("div",{style:{padding:"12px 14px",borderRadius:8,background:"rgba(34,197,94,0.1)",border:"1px solid rgba(34,197,94,0.3)",display:"flex",alignItems:"center",gap:10},children:[o.jsx(zx,{size:14,strokeWidth:1.5,style:{color:"rgba(34,197,94,0.9)"}}),o.jsxs("div",{style:{flex:1},children:[o.jsx("div",{style:{fontSize:10,color:"rgba(34,197,94,0.95)",fontWeight:500},children:"Conectado ao Are.na"}),o.jsxs("div",{style:{fontSize:8,color:"rgba(34,197,94,0.7)",marginTop:2},children:[l.length," channels encontrados"]})]}),o.jsx("button",{onClick:b,style:{background:"none",border:"none",color:"rgba(239,68,68,0.6)",cursor:"pointer",fontSize:9,textDecoration:"underline"},children:"Desconectar"})]}),o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.4)",textTransform:"uppercase",letterSpacing:"0.06em",marginBottom:8},children:"Seus Channels"}),l.length>0?o.jsx("div",{style:{maxHeight:240,overflowY:"auto",display:"flex",flexDirection:"column",gap:4},children:l.map(w=>o.jsxs("div",{style:{padding:"8px 12px",borderRadius:6,background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.06)",cursor:"pointer",transition:"all 0.15s"},onMouseEnter:M=>{M.currentTarget.style.background="rgba(124,58,237,0.1)",M.currentTarget.style.borderColor="rgba(124,58,237,0.25)"},onMouseLeave:M=>{M.currentTarget.style.background="rgba(255,255,255,0.03)",M.currentTarget.style.borderColor="rgba(255,255,255,0.06)"},children:[o.jsx("div",{style:{fontSize:10,color:"rgba(255,255,255,0.75)"},children:w.title}),o.jsxs("div",{style:{fontSize:8,color:"rgba(255,255,255,0.3)",marginTop:2},children:[w.length," blocks  ",w.public?"pblico":"privado"]})]},w.id))}):o.jsxs("div",{style:{padding:"20px 16px",borderRadius:6,background:"rgba(255,255,255,0.02)",border:"1px dashed rgba(255,255,255,0.1)",textAlign:"center"},children:[o.jsx("div",{style:{fontSize:10,color:"rgba(255,255,255,0.4)",marginBottom:8},children:"Nenhum channel encontrado"}),o.jsx("a",{href:"https://www.are.na/new",target:"_blank",rel:"noopener noreferrer",style:{display:"inline-block",padding:"6px 12px",borderRadius:5,fontSize:9,fontWeight:600,background:"rgba(124,58,237,0.2)",border:"1px solid rgba(124,58,237,0.4)",color:"rgba(196,181,253,0.9)",textDecoration:"none",cursor:"pointer"},children:"+ Criar primeiro channel"})]})]})]}):o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:14},children:[o.jsxs("div",{style:{background:"rgba(59,130,246,0.08)",border:"1px solid rgba(59,130,246,0.2)",borderRadius:8,padding:"12px 14px"},children:[o.jsx("div",{style:{fontSize:10,color:"rgba(147,197,253,0.95)",marginBottom:8,fontWeight:600},children:" Como obter seu token:"}),o.jsxs("div",{style:{fontSize:9,color:"rgba(255,255,255,0.65)",lineHeight:1.6,marginBottom:6},children:["1. Abra"," ",o.jsx("a",{href:"https://dev.are.na/oauth/applications",target:"_blank",rel:"noopener noreferrer",style:{color:"rgba(147,197,253,0.95)",textDecoration:"underline",fontWeight:600},children:"dev.are.na/oauth/applications"})," ","(faa login primeiro)"]}),o.jsxs("div",{style:{fontSize:9,color:"rgba(255,255,255,0.65)",lineHeight:1.6,marginBottom:6},children:["2. Role at ",o.jsx("strong",{style:{color:"rgba(147,197,253,0.9)"},children:'"Generate a Personal Access Token"'})]}),o.jsxs("div",{style:{fontSize:9,color:"rgba(255,255,255,0.65)",lineHeight:1.6,marginBottom:6},children:["3. Clique em ",o.jsx("strong",{style:{color:"rgba(147,197,253,0.9)"},children:'"Generate token"'})," e copie o cdigo gerado"]}),o.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.65)",lineHeight:1.6,marginBottom:8},children:'4. Cole o token abaixo (apenas o cdigo, sem "Bearer")'}),o.jsx("div",{style:{fontSize:8,color:"rgba(255,180,0,0.8)",lineHeight:1.5,background:"rgba(255,180,0,0.08)",padding:"6px 8px",borderRadius:4,border:"1px solid rgba(255,180,0,0.2)"},children:" Use apenas o token alfanumrico gerado"})]}),o.jsxs("div",{children:[o.jsx("label",{style:{fontSize:9,color:"rgba(255,255,255,0.5)",display:"block",marginBottom:6,fontWeight:500},children:"Personal Access Token"}),o.jsxs("div",{children:[o.jsx("input",{type:"text",placeholder:"ex: abc123def456ghi789jkl...",value:n,onChange:w=>{r(w.target.value),h("")},onKeyDown:w=>{w.key==="Enter"&&g&&v()},autoComplete:"off",spellCheck:!1,style:{width:"100%",padding:"10px 12px",borderRadius:6,fontSize:11,background:"rgba(255,255,255,0.04)",border:`1px solid ${n.length>0&&!g?"rgba(255,180,0,0.4)":"rgba(255,255,255,0.12)"}`,color:"#fff",outline:"none",fontFamily:"monospace"}}),n.length>0&&!g&&o.jsx("div",{style:{fontSize:8,color:"rgba(255,180,0,0.8)",marginTop:6,lineHeight:1.4},children:" Token parece muito curto ou contm espaos"}),n.toLowerCase().includes("bearer")&&o.jsx("div",{style:{fontSize:8,color:"rgba(239,68,68,0.8)",marginTop:6,lineHeight:1.4},children:' Remova "Bearer" do token - cole apenas o cdigo'})]})]}),u&&o.jsxs("div",{style:{padding:"12px 14px",borderRadius:6,background:"rgba(239,68,68,0.1)",border:"1px solid rgba(239,68,68,0.3)"},children:[o.jsx("div",{style:{fontSize:10,color:"rgba(239,68,68,0.95)",fontWeight:600,marginBottom:6},children:" Falha na autenticao"}),o.jsx("div",{style:{fontSize:9,color:"rgba(239,68,68,0.85)",lineHeight:1.4,marginBottom:8},children:u}),u.includes("401")&&o.jsxs("div",{children:[o.jsxs("div",{style:{fontSize:9,color:"rgba(255,255,255,0.6)",marginBottom:8,lineHeight:1.5},children:[" ",o.jsx("strong",{style:{color:"rgba(255,255,255,0.8)"},children:"Possveis causas:"}),o.jsx("br",{})," Token incorreto ou invlido",o.jsx("br",{})," Token expirado ou revogado",o.jsx("br",{}),' Formato incorreto (no inclua "Bearer")']}),o.jsx("a",{href:"https://dev.are.na/oauth/applications",target:"_blank",rel:"noopener noreferrer",style:{display:"inline-block",padding:"6px 10px",borderRadius:5,fontSize:9,fontWeight:600,background:"rgba(239,68,68,0.2)",border:"1px solid rgba(239,68,68,0.4)",color:"rgba(252,165,165,0.95)",textDecoration:"none"},children:" Gerar novo token"})]}),u.includes("404")&&o.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.6)",lineHeight:1.5},children:" Endpoint no encontrado. Verifique sua conexo de internet."})]}),o.jsx("button",{onClick:v,disabled:a||!g,style:{width:"100%",padding:"10px 0",borderRadius:7,fontSize:11,fontWeight:600,background:a||!g?"rgba(255,255,255,0.05)":"rgba(124,58,237,0.25)",border:`1px solid ${a||!g?"rgba(255,255,255,0.08)":"rgba(124,58,237,0.45)"}`,color:a||!g?"rgba(255,255,255,0.3)":"rgba(196,181,253,0.95)",cursor:a||!g?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:8},children:a?o.jsxs(o.Fragment,{children:[o.jsx(vP,{size:12,strokeWidth:1.5,style:{animation:"spin 1s linear infinite"}}),"Conectando..."]}):o.jsxs(o.Fragment,{children:[o.jsx(zx,{size:12,strokeWidth:1.5}),"Conectar"]})}),o.jsxs("button",{onClick:()=>f(!m),style:{width:"100%",padding:"8px 0",background:"none",border:"none",color:"rgba(255,255,255,0.4)",fontSize:9,cursor:"pointer",textAlign:"center",textDecoration:"underline"},children:[m?"":""," Problemas para conectar?"]}),m&&o.jsxs("div",{style:{padding:"12px 14px",borderRadius:6,background:"rgba(147,51,234,0.08)",border:"1px solid rgba(147,51,234,0.2)"},children:[o.jsx("div",{style:{fontSize:9,color:"rgba(196,181,253,0.95)",fontWeight:600,marginBottom:8},children:" Checklist de verificao:"}),o.jsxs("div",{style:{fontSize:9,color:"rgba(255,255,255,0.65)",lineHeight:1.7,marginLeft:4},children:["1. Faa login no ",o.jsx("strong",{style:{color:"rgba(196,181,253,0.9)"},children:"Are.na"})," antes de gerar o token",o.jsx("br",{}),"2. Use a seo ",o.jsx("strong",{style:{color:"rgba(196,181,253,0.9)"},children:'"Generate a Personal Access Token"'}),' (no "OAuth Applications")',o.jsx("br",{}),"3. Copie ",o.jsx("strong",{style:{color:"rgba(196,181,253,0.9)"},children:"apenas"}),' o cdigo gerado (sem espaos ou "Bearer")',o.jsx("br",{}),"4. O token deve ter pelo menos 40 caracteres alfanumricos",o.jsx("br",{}),"5. Se continuar falhando, tente gerar um novo token"]})]})]})})]}),o.jsx("style",{children:`
        @keyframes spin {
          to { transform: rotate(360deg); }
        }
      `})]})}const oQ="'Doto', monospace",ia="'IBM Plex Mono', monospace",aQ={influences:{icon:"",color:"#a78bfa"},contrasts:{icon:"",color:"#ef4444"},bridges:{icon:"",color:"#f472b6"},extends:{icon:"",color:"#60a5fa"},contains:{icon:"",color:"#4ade80"},co_occurs:{icon:"",color:"#94a3b8"},method_for:{icon:"",color:"#fbbf24"},example_of:{icon:"",color:"#fb923c"},critiques:{icon:"",color:"#f87171"},related:{icon:"",color:"#64748b"}};function sQ({node:e,allNodes:t,score:n,onClose:r,onSaveCard:a,onSendToArena:i,onExpand:s}){const c=Array.from(e.connections.keys()).map(l=>t.find(d=>d.id===l)).filter(Boolean);return o.jsxs($o.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},style:{position:"fixed",top:80,right:20,width:320,maxHeight:"calc(100vh - 120px)",background:"rgba(10,8,18,0.95)",backdropFilter:"blur(24px)",border:"1px dashed rgba(255,255,255,0.06)",borderRadius:1,boxShadow:"0 16px 48px rgba(0,0,0,0.5)",display:"flex",flexDirection:"column",overflow:"hidden",zIndex:100},children:[o.jsxs("div",{style:{padding:"14px 16px",borderBottom:"1px dashed rgba(255,255,255,0.06)",display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:10},children:[o.jsxs("div",{style:{flex:1,minWidth:0},children:[o.jsx("div",{style:{fontFamily:oQ,fontSize:13,color:"rgba(255,255,255,0.85)",fontWeight:600,lineHeight:1.3},children:e.label||`Node ${e.id}`}),o.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:4,marginTop:4},children:[e.category&&o.jsx("div",{style:{display:"inline-block",padding:"2px 6px",borderRadius:1,fontSize:7,background:"rgba(124,58,237,0.15)",border:"1px dashed rgba(124,58,237,0.35)",color:"rgba(196,181,253,0.8)",textTransform:"uppercase",letterSpacing:"0.08em",fontFamily:ia},children:e.category}),e.isBridge&&o.jsx("div",{style:{display:"inline-block",padding:"2px 6px",borderRadius:1,fontSize:7,background:"rgba(244,114,182,0.15)",border:"1px dashed rgba(244,114,182,0.35)",color:"rgba(244,114,182,0.9)",textTransform:"uppercase",letterSpacing:"0.08em",fontFamily:ia},children:"BRIDGE"}),e.isHub&&o.jsx("div",{style:{display:"inline-block",padding:"2px 6px",borderRadius:1,fontSize:7,background:"rgba(251,191,36,0.15)",border:"1px dashed rgba(251,191,36,0.35)",color:"rgba(251,191,36,0.9)",textTransform:"uppercase",letterSpacing:"0.08em",fontFamily:ia},children:"HUB"}),e.mentionCount!==void 0&&e.mentionCount>0&&o.jsxs("div",{style:{display:"inline-block",padding:"2px 6px",borderRadius:1,fontSize:7,background:"rgba(96,165,250,0.12)",border:"1px dashed rgba(96,165,250,0.30)",color:"rgba(96,165,250,0.85)",textTransform:"uppercase",letterSpacing:"0.08em",fontFamily:ia},children:[e.mentionCount,"x CITED"]})]})]}),o.jsx("button",{onClick:r,style:{background:"none",border:"none",fontFamily:ia,color:"rgba(255,255,255,0.45)",cursor:"pointer",fontSize:16,padding:0,lineHeight:1,transition:"all 0.15s"},children:""})]}),o.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"14px 16px"},children:[e.description&&o.jsx("div",{style:{fontFamily:ia,fontSize:10,color:"rgba(255,255,255,0.45)",lineHeight:1.5,marginBottom:14},children:e.description}),n&&o.jsxs("div",{style:{marginBottom:14,padding:"10px 12px",borderRadius:1,background:"rgba(255,255,255,0.03)",border:"1px dashed rgba(255,255,255,0.06)"},children:[o.jsxs("div",{style:{fontFamily:ia,fontSize:8,color:"rgba(255,255,255,0.22)",textTransform:"uppercase",letterSpacing:"0.08em",marginBottom:8,display:"flex",alignItems:"center",gap:5},children:[o.jsx($P,{size:9,strokeWidth:1.5}),"Mtricas de Rede"]}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[o.jsx("span",{style:{fontFamily:ia,fontSize:9,color:"rgba(255,255,255,0.45)"},children:"Relevncia"}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[o.jsx("div",{style:{width:60,height:4,borderRadius:1,background:"rgba(255,255,255,0.1)",overflow:"hidden"},children:o.jsx("div",{style:{width:`${n.relevance*100}%`,height:"100%",background:"linear-gradient(90deg, rgba(124,58,237,0.6), rgba(196,181,253,0.8))"}})}),o.jsxs("span",{style:{fontSize:9,color:"rgba(255,255,255,0.65)",fontFamily:ia,minWidth:28},children:[(n.relevance*100).toFixed(0),"%"]})]})]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[o.jsxs("span",{style:{fontFamily:ia,fontSize:9,color:"rgba(255,255,255,0.45)"},children:["Ponte ",n.isBridge&&""]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[o.jsx("div",{style:{width:60,height:4,borderRadius:1,background:"rgba(255,255,255,0.1)",overflow:"hidden"},children:o.jsx("div",{style:{width:`${n.betweenness*100}%`,height:"100%",background:"linear-gradient(90deg, rgba(251,191,36,0.6), rgba(251,191,36,0.9))"}})}),o.jsxs("span",{style:{fontSize:9,color:"rgba(255,255,255,0.65)",fontFamily:ia,minWidth:28},children:[(n.betweenness*100).toFixed(0),"%"]})]})]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[o.jsx("span",{style:{fontFamily:ia,fontSize:9,color:"rgba(255,255,255,0.45)"},children:"Centralidade"}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[o.jsx("div",{style:{width:60,height:4,borderRadius:1,background:"rgba(255,255,255,0.1)",overflow:"hidden"},children:o.jsx("div",{style:{width:`${Math.min(n.closeness*100,100)}%`,height:"100%",background:"linear-gradient(90deg, rgba(34,197,94,0.6), rgba(34,197,94,0.9))"}})}),o.jsxs("span",{style:{fontSize:9,color:"rgba(255,255,255,0.65)",fontFamily:ia,minWidth:28},children:[(Math.min(n.closeness,1)*100).toFixed(0),"%"]})]})]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[o.jsxs("span",{style:{fontFamily:ia,fontSize:9,color:"rgba(255,255,255,0.45)"},children:["Conexes ",n.isHub&&""]}),o.jsx("span",{style:{fontSize:9,color:"rgba(255,255,255,0.65)",fontFamily:ia},children:n.degree})]}),o.jsxs("div",{style:{marginTop:4,paddingTop:8,borderTop:"1px dashed rgba(255,255,255,0.06)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[o.jsx("span",{style:{fontFamily:ia,fontSize:9,color:"rgba(255,255,255,0.45)",fontWeight:500},children:"Score Total"}),o.jsx("div",{style:{padding:"2px 7px",borderRadius:1,background:"rgba(124,58,237,0.2)",border:"1px dashed rgba(124,58,237,0.35)",fontSize:9,color:"rgba(196,181,253,0.95)",fontFamily:ia,fontWeight:600},children:(n.combined*100).toFixed(0)})]})]})]}),c.length>0&&o.jsxs("div",{style:{marginBottom:14},children:[o.jsxs("div",{style:{fontFamily:ia,fontSize:8,color:"rgba(255,255,255,0.22)",textTransform:"uppercase",letterSpacing:"0.08em",marginBottom:7},children:["Conexes (",c.length,")"]}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:3},children:[c.slice(0,12).map(l=>{var m,f;const d=((m=e.edgeTypes)==null?void 0:m.get(l.id))??((f=l.edgeTypes)==null?void 0:f.get(e.id)),u=d?aQ[d]:void 0,h=e.connections.get(l.id)??0;return o.jsxs("div",{style:{padding:"5px 8px",borderRadius:1,background:"rgba(255,255,255,0.02)",border:"1px dashed rgba(255,255,255,0.06)",fontSize:9,fontFamily:ia,color:"rgba(255,255,255,0.65)",cursor:"pointer",transition:"all 0.15s",display:"flex",alignItems:"center",justifyContent:"space-between",gap:6},onClick:()=>s(l),onMouseEnter:g=>{g.currentTarget.style.background="rgba(124,58,237,0.08)",g.currentTarget.style.borderColor="rgba(124,58,237,0.2)"},onMouseLeave:g=>{g.currentTarget.style.background="rgba(255,255,255,0.02)",g.currentTarget.style.borderColor="rgba(255,255,255,0.06)"},children:[o.jsx("span",{style:{flex:1,minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:l.label||`Node ${l.id}`}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,flexShrink:0},children:[u&&o.jsxs("span",{style:{fontSize:7,color:u.color,fontFamily:ia,opacity:.8},children:[u.icon," ",d]}),o.jsxs("span",{style:{fontSize:7,color:"rgba(255,255,255,0.25)",fontFamily:ia},children:[(h*100).toFixed(0),"%"]})]})]},l.id)}),c.length>12&&o.jsxs("div",{style:{fontFamily:ia,fontSize:8,color:"rgba(255,255,255,0.22)",marginTop:2,fontStyle:"italic"},children:["+",c.length-12," mais"]})]})]}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:5},children:[o.jsxs("button",{onClick:()=>a(e),style:{width:"100%",padding:"8px 12px",borderRadius:1,fontSize:10,fontFamily:ia,fontWeight:500,background:"rgba(124,58,237,0.15)",border:"1px dashed rgba(124,58,237,0.35)",color:"rgba(196,181,253,0.9)",letterSpacing:"0.06em",textTransform:"uppercase",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:7,transition:"all 0.15s"},onMouseEnter:l=>{l.currentTarget.style.background="rgba(124,58,237,0.25)",l.currentTarget.style.borderColor="rgba(124,58,237,0.5)"},onMouseLeave:l=>{l.currentTarget.style.background="rgba(124,58,237,0.15)",l.currentTarget.style.borderColor="rgba(124,58,237,0.35)"},children:[o.jsx(nS,{size:11,strokeWidth:1.5}),"Salvar em Coleo"]}),o.jsxs("button",{onClick:()=>i(e),style:{width:"100%",padding:"8px 12px",borderRadius:1,fontSize:10,fontFamily:ia,fontWeight:500,background:"rgba(255,255,255,0.04)",border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.65)",letterSpacing:"0.06em",textTransform:"uppercase",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:7,transition:"all 0.15s"},onMouseEnter:l=>{l.currentTarget.style.background="rgba(255,255,255,0.08)",l.currentTarget.style.borderColor="rgba(255,255,255,0.12)"},onMouseLeave:l=>{l.currentTarget.style.background="rgba(255,255,255,0.04)",l.currentTarget.style.borderColor="rgba(255,255,255,0.06)"},children:[o.jsx(sS,{size:11,strokeWidth:1.5}),"Enviar ao Are.na"]}),o.jsxs("button",{onClick:()=>s(e),style:{width:"100%",padding:"8px 12px",borderRadius:1,fontSize:10,fontFamily:ia,fontWeight:500,background:"rgba(255,255,255,0.04)",border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.65)",letterSpacing:"0.06em",textTransform:"uppercase",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:7,transition:"all 0.15s"},onMouseEnter:l=>{l.currentTarget.style.background="rgba(255,255,255,0.08)",l.currentTarget.style.borderColor="rgba(255,255,255,0.12)"},onMouseLeave:l=>{l.currentTarget.style.background="rgba(255,255,255,0.04)",l.currentTarget.style.borderColor="rgba(255,255,255,0.06)"},children:[o.jsx(zi,{size:11,strokeWidth:1.5}),"Expandir Rizoma"]})]})]})]})}function iQ({folders:e,onSelect:t,onCreateFolder:n,onClose:r}){const[a,i]=S.useState(!1),[s,c]=S.useState(""),[l,d]=S.useState(""),u=()=>{s.trim()&&(n(s.trim(),l.trim()||void 0),c(""),d(""),i(!1))};return o.jsx($o.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:200},onClick:r,children:o.jsxs($o.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:h=>h.stopPropagation(),style:{background:"rgba(10,8,20,0.95)",border:"1px solid rgba(255,255,255,0.15)",borderRadius:8,padding:"20px 24px",minWidth:340,maxWidth:420,maxHeight:"80vh",display:"flex",flexDirection:"column"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:16},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx(lf,{size:16,strokeWidth:1.5,style:{color:"rgba(196,181,253,0.6)"}}),o.jsx("div",{style:{fontSize:13,color:"rgba(255,255,255,0.9)",fontWeight:600},children:"Salvar em Coleo"})]}),o.jsx("button",{onClick:r,style:{background:"none",border:"none",cursor:"pointer",color:"rgba(255,255,255,0.4)",padding:4,display:"flex",alignItems:"center"},children:o.jsx(Cs,{size:14,strokeWidth:1.5})})]}),o.jsxs("button",{onClick:()=>i(h=>!h),style:{padding:"8px 12px",borderRadius:6,background:a?"rgba(124,58,237,0.2)":"rgba(124,58,237,0.1)",border:`1px solid ${a?"rgba(124,58,237,0.4)":"rgba(124,58,237,0.25)"}`,color:"rgba(196,181,253,0.9)",fontSize:10,cursor:"pointer",display:"flex",alignItems:"center",gap:6,marginBottom:12,fontWeight:500},children:[o.jsx(Iy,{size:11,strokeWidth:1.5}),"Nova Coleo"]}),o.jsx(x0,{children:a&&o.jsx($o.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden",marginBottom:12},children:o.jsxs("div",{style:{padding:12,borderRadius:6,background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.08)",display:"flex",flexDirection:"column",gap:8},children:[o.jsx("input",{type:"text",placeholder:"Nome da coleo",value:s,onChange:h=>c(h.target.value),onKeyDown:h=>{h.key==="Enter"&&u()},style:{width:"100%",padding:"7px 10px",borderRadius:4,fontSize:10,background:"rgba(255,255,255,0.04)",border:"1px solid rgba(255,255,255,0.1)",color:"#fff",outline:"none"},autoFocus:!0}),o.jsx("input",{type:"text",placeholder:"Descrio (opcional)",value:l,onChange:h=>d(h.target.value),onKeyDown:h=>{h.key==="Enter"&&u()},style:{width:"100%",padding:"7px 10px",borderRadius:4,fontSize:9,background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",color:"rgba(255,255,255,0.7)",outline:"none"}}),o.jsx("button",{onClick:u,style:{width:"100%",padding:"6px 0",borderRadius:4,fontSize:9,background:"rgba(124,58,237,0.25)",border:"1px solid rgba(124,58,237,0.4)",color:"rgba(196,181,253,0.95)",cursor:"pointer",fontWeight:500,letterSpacing:"0.05em"},children:"Criar e Salvar Aqui"})]})})}),o.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.5)",marginBottom:10},children:"Escolha uma coleo existente:"}),o.jsx("div",{style:{flex:1,overflowY:"auto",display:"flex",flexDirection:"column",gap:6,marginBottom:16},children:e.length===0?o.jsxs("div",{style:{padding:"24px 20px",textAlign:"center",fontSize:9,color:"rgba(255,255,255,0.25)",lineHeight:1.5},children:["Nenhuma coleo ainda.",o.jsx("br",{}),"Crie uma nova acima."]}):e.map(h=>o.jsxs("button",{onClick:()=>t(h.id),style:{padding:"10px 12px",borderRadius:6,background:"rgba(124,58,237,0.1)",border:"1px solid rgba(124,58,237,0.25)",color:"rgba(196,181,253,0.9)",fontSize:10,cursor:"pointer",textAlign:"left",display:"flex",alignItems:"center",gap:10,transition:"all 0.15s"},onMouseEnter:m=>{m.currentTarget.style.background="rgba(124,58,237,0.2)",m.currentTarget.style.borderColor="rgba(124,58,237,0.4)"},onMouseLeave:m=>{m.currentTarget.style.background="rgba(124,58,237,0.1)",m.currentTarget.style.borderColor="rgba(124,58,237,0.25)"},children:[o.jsx(lf,{size:13,strokeWidth:1.5,style:{color:h.color||"rgba(196,181,253,0.6)"}}),o.jsxs("div",{style:{flex:1},children:[o.jsx("div",{style:{fontWeight:500},children:h.name}),h.description&&o.jsx("div",{style:{fontSize:8,color:"rgba(255,255,255,0.4)",marginTop:2},children:h.description})]}),o.jsx("span",{style:{fontSize:8,color:"rgba(255,255,255,0.3)",background:"rgba(255,255,255,0.05)",padding:"2px 6px",borderRadius:3,fontFamily:"monospace"},children:h.cards.length})]},h.id))}),o.jsx("button",{onClick:r,style:{width:"100%",padding:"7px",borderRadius:4,background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.5)",fontSize:9,cursor:"pointer"},children:"Cancelar"})]})})}const K6="rhizome_folders_v1",X6="saved_rhizomes_v1";function Oi(){try{const e=localStorage.getItem(K6);return e?JSON.parse(e):[]}catch{return[]}}function Gu(e){try{localStorage.setItem(K6,JSON.stringify(e)),Ec(()=>Promise.resolve().then(()=>J5),void 0).then(t=>{t.saveFoldersToBackend(e).catch(n=>{console.warn("Backend sync failed:",n)})})}catch(t){console.warn("Failed to save folders:",t)}}function J6(e,t){const n={id:`folder_${Date.now()}_${Math.random().toString(36).slice(2,9)}`,name:e,description:t,cards:[],createdAt:Date.now(),updatedAt:Date.now(),isPublic:!1},r=Oi();return r.push(n),Gu(r),n}function Q6(e){const n=Oi().filter(r=>r.id!==e);Gu(n)}function Z6(e,t){const n=Oi(),r=n.find(a=>a.id===e);r&&(r.cards.some(i=>i.label===t.label||i.url&&i.url===t.url)||(r.cards.push(t),r.updatedAt=Date.now(),Gu(n)))}function eE(e,t){const n=Oi(),r=n.find(a=>a.id===e);r&&(r.cards=r.cards.filter(a=>a.id!==t),r.updatedAt=Date.now(),Gu(n))}function tE(e,t,n){const r=Oi(),a=r.find(s=>s.id===e),i=r.find(s=>s.id===t);if(a&&i){const s=a.cards.find(c=>c.id===n);s&&(a.cards=a.cards.filter(c=>c.id!==n),a.updatedAt=Date.now(),i.cards.find(c=>c.id===n)||(i.cards.push(s),i.updatedAt=Date.now()),Gu(r))}}function Ay(){try{const e=localStorage.getItem(X6);return e?JSON.parse(e):[]}catch{return[]}}function nE(e){try{localStorage.setItem(X6,JSON.stringify(e)),Ec(()=>Promise.resolve().then(()=>J5),void 0).then(t=>{t.saveRhizomesToBackend(e).catch(n=>{console.warn("Backend sync failed:",n)})})}catch(t){console.warn("Failed to save rhizomes:",t)}}function lQ(e,t,n,r,a,i){const s={id:`rhizome_${Date.now()}_${Math.random().toString(36).slice(2,9)}`,title:e,description:t,topic:n,nodeCount:r,snapshot:a,savedAt:Date.now(),folderId:i},c=Ay();return c.push(s),nE(c),s}function rE(e,t,n,r,a,i){return{id:`card_${Date.now()}_${Math.random().toString(36).slice(2,9)}`,label:e,description:t,category:n,tags:a??(n?[n]:[]),connections:r,links:i,savedAt:Date.now(),source:"rhizome"}}const Sx=Object.freeze(Object.defineProperty({__proto__:null,addCardToFolder:Z6,createCardFromNode:rE,createFolder:J6,deleteFolder:Q6,loadFolders:Oi,loadSavedRhizomes:Ay,moveCardBetweenFolders:tE,removeCardFromFolder:eE,saveFolders:Gu,saveRhizome:lQ,saveSavedRhizomes:nE},Symbol.toStringTag,{value:"Module"}));function cw(e){const t=new Map;for(const n of e){t.has(n.id)||t.set(n.id,new Set);for(const[r]of n.connections)t.get(n.id).add(r)}return t}function cQ(e,t,n){const r=new Map,a=[e];for(r.set(e,0);a.length>0;){const i=a.shift(),s=t.get(i)||new Set;for(const c of s)r.has(c)||(r.set(c,r.get(i)+1),a.push(c))}return r}function oE(e){new Map(e.map(a=>[a.id,a]));const t=cw(e),n=new Map;for(const a of e)n.set(a.id,0);for(const a of e){const i=[],s=new Map,c=new Map,l=new Map;for(const h of e)s.set(h.id,[]),c.set(h.id,0),l.set(h.id,-1);c.set(a.id,1),l.set(a.id,0);const d=[a.id];for(;d.length>0;){const h=d.shift();i.push(h);const m=t.get(h)||new Set;for(const f of m)l.get(f)<0&&(d.push(f),l.set(f,l.get(h)+1)),l.get(f)===l.get(h)+1&&(c.set(f,c.get(f)+c.get(h)),s.get(f).push(h))}const u=new Map;for(const h of e)u.set(h.id,0);for(;i.length>0;){const h=i.pop();for(const m of s.get(h)){const f=c.get(m)/c.get(h)*(1+u.get(h));u.set(m,u.get(m)+f)}h!==a.id&&n.set(h,n.get(h)+u.get(h))}}const r=e.length;if(r>2){const a=2/((r-1)*(r-2));for(const[i,s]of n)n.set(i,s*a)}return n}function dQ(e){new Map(e.map(r=>[r.id,r]));const t=cw(e),n=new Map;for(const r of e){const a=cQ(r.id,t);let i=0,s=0;for(const[c,l]of a)c!==r.id&&l>0&&(i+=l,s++);s>0?n.set(r.id,s/i):n.set(r.id,0)}return n}function uQ(e){new Map(e.map(i=>[i.id,i]));const t=cw(e),n=new Map;for(const i of e)n.set(i.id,i.id);let r=!0,a=0;for(;r&&a<10;){r=!1,a++;for(const i of e){const s=t.get(i.id)||new Set,c=new Map;for(const u of s){const h=n.get(u),m=i.connections.get(u)||1;c.set(h,(c.get(h)||0)+m)}let l=n.get(i.id),d=c.get(l)||0;for(const[u,h]of c)h>d&&(d=h,l=u);l!==n.get(i.id)&&(n.set(i.id,l),r=!0)}}return n}function hQ(e,t=.7){const n=e.map(a=>a.connections.size),r=Math.max(...n,1);return e.filter(a=>a.connections.size/r>=t)}function fQ(e){const t=oE(e),n=uQ(e),r=[];for(const a of e){if((t.get(a.id)||0)<.3)continue;const s=new Set;for(const[c]of a.connections){const l=n.get(c);l!==void 0&&s.add(l)}s.size>=2&&r.push(a)}return r}function pQ(e){const t=oE(e),n=dQ(e),r=new Set(fQ(e).map(s=>s.id)),a=new Set(hQ(e,.6).map(s=>s.id)),i=new Map;for(const s of e){const c=t.get(s.id)||0,l=n.get(s.id)||0,d=s.connections.size,u=s.relevance||.5,h=Math.max(...e.map(g=>g.connections.size),1),m=d/h,f=u*.4+c*.3+l*.2+m*.1;i.set(s.id,{nodeId:s.id,relevance:u,betweenness:c,closeness:l,degree:d,combined:f,isBridge:r.has(s.id),isHub:a.has(s.id)})}return i}const dw="'Doto', monospace",Ko="'IBM Plex Mono', monospace",mQ=[{name:"Mono Dark",swatch:"#e0e0e0",ae:{bgColor:"#000000",nodeColor:"#e0e0e0",entryColor:"#ffffff",hubColor:"#b0b0b0",hotColor:"#ffffff",linkColor:"#2a2a2a",flightColor:"#555555",labelColor:"#ffffff",glowIntensity:0}},{name:"Mono Light",swatch:"#111111",ae:{bgColor:"#f0f0f0",nodeColor:"#111111",entryColor:"#000000",hubColor:"#444444",hotColor:"#222222",linkColor:"#cccccc",flightColor:"#888888",labelColor:"#111111",glowIntensity:0}},{name:"Cyber",swatch:"#00ff66",ae:{bgColor:"#000000",nodeColor:"#00ff66",entryColor:"#d8f2ff",hubColor:"#3aa3ff",hotColor:"#ff9b3a",linkColor:"#00ff66",flightColor:"#ff3bd5",labelColor:"#ffffff"}},{name:"Violet",swatch:"#a78bfa",ae:{bgColor:"#05020e",nodeColor:"#a78bfa",entryColor:"#f0e6ff",hubColor:"#ec4899",hotColor:"#fbbf24",linkColor:"#7c3aed",flightColor:"#f472b6",labelColor:"#ffffff"}},{name:"Ochre",swatch:"#fbbf24",ae:{bgColor:"#0a0800",nodeColor:"#fbbf24",entryColor:"#fff7ed",hubColor:"#f97316",hotColor:"#ef4444",linkColor:"#d97706",flightColor:"#fb923c",labelColor:"#ffffff"}},{name:"Arctic",swatch:"#38bdf8",ae:{bgColor:"#00060f",nodeColor:"#38bdf8",entryColor:"#e0f2fe",hubColor:"#818cf8",hotColor:"#34d399",linkColor:"#0ea5e9",flightColor:"#a78bfa",labelColor:"#ffffff"}},{name:"Blood",swatch:"#ef4444",ae:{bgColor:"#040000",nodeColor:"#ef4444",entryColor:"#fef2f2",hubColor:"#f87171",hotColor:"#fbbf24",linkColor:"#dc2626",flightColor:"#fb923c",labelColor:"#ffffff"}}];function Ji({label:e,value:t,min:n=0,max:r=1,step:a=.01,tooltip:i,onChange:s}){const[c,l]=S.useState(!1);return o.jsxs("div",{style:{marginBottom:6},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:2,position:"relative"},children:[o.jsxs("span",{style:{fontSize:9,color:"rgba(255,255,255,0.45)",letterSpacing:"0.06em",textTransform:"uppercase",fontFamily:Ko,display:"flex",alignItems:"center",gap:4},children:[e,i&&o.jsx("span",{style:{cursor:"help",display:"flex",alignItems:"center"},onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),children:o.jsx(uP,{size:8,strokeWidth:1.5,style:{opacity:.25}})})]}),o.jsx("span",{style:{fontSize:8,color:"rgba(255,255,255,0.22)",fontFamily:Ko},children:t.toFixed(a<.1?2:0)}),c&&i&&o.jsx("div",{style:{position:"absolute",left:0,top:-44,zIndex:200,background:"rgba(0,0,0,0.97)",border:"1px dashed rgba(255,255,255,0.08)",borderRadius:1,padding:"5px 8px",fontSize:8,maxWidth:220,color:"rgba(255,255,255,0.55)",lineHeight:1.5,pointerEvents:"none",fontFamily:Ko},children:i})]}),o.jsx("input",{type:"range",min:n,max:r,step:a,value:t,onChange:d=>s(parseFloat(d.target.value)),style:{width:"100%",height:2,accentColor:"#10d45b",cursor:"pointer"}})]})}function tu({title:e,open:t,onToggle:n,children:r,accent:a="rgba(255,255,255,0.18)"}){return o.jsxs("div",{style:{borderTop:"1px dashed rgba(255,255,255,0.06)",paddingTop:10,marginTop:10},children:[o.jsxs("button",{title:"Expandir",onClick:n,style:{background:"none",border:"none",cursor:"pointer",color:a,fontSize:11,display:"flex",alignItems:"center",gap:5,padding:0,letterSpacing:"0.08em",textTransform:"uppercase",width:"100%",textAlign:"left",fontFamily:dw},children:[t?o.jsx(Ms,{size:9}):o.jsx(hs,{size:9}),e]}),t&&o.jsx("div",{style:{marginTop:10},children:r})]})}function t0({label:e,value:t,onChange:n}){return o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:5},children:[o.jsx("span",{style:{fontSize:8,color:"rgba(255,255,255,0.38)",letterSpacing:"0.06em",textTransform:"uppercase",fontFamily:Ko},children:e}),o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:4,cursor:"pointer"},children:[o.jsx("div",{style:{width:18,height:18,borderRadius:1,background:t,border:"1px dashed rgba(255,255,255,0.12)",flexShrink:0}}),o.jsx("input",{type:"color",value:t,onChange:r=>n(r.target.value),style:{opacity:0,position:"absolute",width:18,height:18,cursor:"pointer"}})]})]})}function gQ({recState:e,elapsed:t,onStart:n,onStop:r,actualFmt:a}){const[i,s]=S.useState("auto"),[c,l]=S.useState("standard"),d=Nj(),u=h=>({padding:"3px 6px",borderRadius:1,fontSize:8,fontFamily:Ko,cursor:"pointer",background:h?"rgba(16,212,91,0.12)":"rgba(255,255,255,0.03)",border:`1px dashed ${h?"rgba(16,212,91,0.35)":"rgba(255,255,255,0.06)"}`,color:h?"rgba(255,255,255,0.80)":"rgba(255,255,255,0.30)",letterSpacing:"0.04em",textTransform:"uppercase",marginRight:3,marginBottom:3});return e==="saving"?o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"6px 0"},children:[o.jsx("span",{style:{width:6,height:6,borderRadius:"50%",background:"#fbbf24",animation:"pulse 1s infinite"}}),o.jsx("span",{style:{fontSize:9,color:"rgba(251,191,36,0.6)",fontFamily:"monospace",letterSpacing:"0.06em"},children:"SALVANDO"})]}):e==="recording"?o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:5},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[o.jsx("span",{style:{width:7,height:7,borderRadius:2,background:"#ef4444",animation:"pulse 0.8s infinite"}}),o.jsx("span",{style:{fontSize:10,color:"#ef4444",fontFamily:"monospace"},children:YS(t)}),o.jsx("span",{style:{fontSize:8,color:"rgba(239,68,68,0.5)",letterSpacing:"0.08em"},children:a})]}),o.jsxs("button",{title:"Parar gravao",onClick:r,style:{width:"100%",padding:"5px 0",borderRadius:4,background:"rgba(239,68,68,0.15)",border:"1px solid rgba(239,68,68,0.35)",color:"rgba(239,68,68,0.8)",fontSize:10,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:4},children:[o.jsx("span",{children:""})," Parar Gravao"]})]}):o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:7},children:[o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:8,color:"rgba(255,255,255,0.22)",letterSpacing:"0.07em",textTransform:"uppercase",marginBottom:4},children:"Formato"}),o.jsx("div",{style:{display:"flex",flexWrap:"wrap"},children:["auto","webm","mp4","mov"].map(h=>o.jsxs("button",{title:uy[h],style:u(i===h),onClick:()=>s(h),children:[uy[h],(h==="mp4"||h==="mov")&&!d&&o.jsx("span",{style:{fontSize:7,color:"rgba(251,191,36,0.5)",marginLeft:2},children:"*"})]},h))}),(i==="mp4"||i==="mov")&&!d&&o.jsxs("div",{style:{fontSize:8,color:"rgba(251,191,36,0.5)",lineHeight:1.4,marginTop:2},children:["* Seu browser no suporta MP4 nativo. Ser salvo como WebM.",o.jsx("br",{}),"Converta: ",o.jsx("span",{style:{fontFamily:"monospace"},children:"ffmpeg -i rec.webm out.mp4"})]})]}),o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:8,color:"rgba(255,255,255,0.22)",letterSpacing:"0.07em",textTransform:"uppercase",marginBottom:4},children:"Qualidade"}),o.jsx("div",{style:{display:"flex",flexWrap:"wrap"},children:["draft","standard","high","ultra"].map(h=>o.jsx("button",{title:h,style:u(c===h),onClick:()=>l(h),children:h},h))})]}),o.jsxs("button",{title:"Iniciar gravao",onClick:()=>n(i,c),style:{width:"100%",padding:"6px 0",borderRadius:4,background:"rgba(124,58,237,0.18)",border:"1px solid rgba(124,58,237,0.35)",color:"rgba(196,181,253,0.85)",fontSize:10,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:5},children:[o.jsx(TF,{size:10,strokeWidth:1.5}),"Iniciar Gravao"]})]})}function yQ({onClose:e}){const t=Object.keys(vf),[n,r]=S.useState("concepts"),[a,i]=S.useState(()=>({concepts:eu.concepts,names_only:eu.names_only,person_theory:eu.person_theory,study_order:eu.study_order,controversies:eu.controversies,keywords:eu.keywords})),s=()=>{for(const l of t)eu[l]=a[l];e()},c=vf[n];return o.jsx("div",{style:{position:"fixed",inset:0,zIndex:999,background:"rgba(0,0,0,0.82)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:e,children:o.jsxs("div",{style:{width:680,maxHeight:"85vh",display:"flex",flexDirection:"column",background:"#000",border:"1px dashed rgba(255,255,255,0.06)",borderRadius:1,overflow:"hidden",boxShadow:"0 24px 80px rgba(0,0,0,0.6)"},onClick:l=>l.stopPropagation(),children:[o.jsxs("div",{style:{padding:"14px 18px",borderBottom:"1px dashed rgba(255,255,255,0.06)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx($u,{size:12,strokeWidth:1.5,style:{color:"rgba(196,181,253,0.7)"}}),o.jsx("span",{style:{fontSize:11,color:"rgba(255,255,255,0.7)",letterSpacing:"0.06em"},children:"EDITOR DE PROMPTS"})]}),o.jsx("button",{title:"Fechar",onClick:e,style:{background:"none",border:"none",color:"rgba(255,255,255,0.3)",cursor:"pointer",fontSize:16},children:""})]}),o.jsxs("div",{style:{display:"flex",flex:1,overflow:"hidden"},children:[o.jsx("div",{style:{width:140,borderRight:"1px solid rgba(255,255,255,0.06)",padding:"8px 0",flexShrink:0,overflowY:"auto"},children:t.map(l=>{const d=vf[l],u=l===n;return o.jsxs("button",{title:l,onClick:()=>r(l),style:{width:"100%",padding:"8px 14px",textAlign:"left",border:"none",borderLeft:`2px solid ${u?"rgba(196,181,253,0.7)":"transparent"}`,background:u?"rgba(255,255,255,0.04)":"none",color:u?"rgba(255,255,255,0.8)":"rgba(255,255,255,0.35)",cursor:"pointer",fontSize:10,display:"flex",alignItems:"center",gap:7,transition:"all 0.1s"},children:[o.jsx("span",{style:{fontFamily:"monospace",fontSize:11,opacity:.7},children:d.icon}),o.jsx("span",{children:d.label})]},l)})}),o.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",padding:"12px 16px",overflow:"hidden"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:11,color:"rgba(255,255,255,0.65)"},children:c.label}),o.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.28)",marginTop:2},children:c.hint})]}),o.jsx("div",{style:{display:"flex",gap:6},children:o.jsxs("div",{style:{fontSize:8,color:"rgba(255,255,255,0.22)",fontFamily:"monospace",alignSelf:"center"},children:["{TOPIC}"," ","{COUNT}"," ","{DEPTH}"]})})]}),o.jsx("textarea",{value:a[n],onChange:l=>i(d=>({...d,[n]:l.target.value})),style:{flex:1,resize:"none",fontFamily:"'IBM Plex Mono', monospace",fontSize:10,background:"rgba(255,255,255,0.03)",border:"1px dashed rgba(255,255,255,0.06)",borderRadius:1,padding:"10px 12px",color:"rgba(255,255,255,0.7)",outline:"none",lineHeight:1.6,minHeight:280}})]})]}),o.jsxs("div",{style:{padding:"10px 18px",borderTop:"1px dashed rgba(255,255,255,0.06)",display:"flex",justifyContent:"flex-end",gap:8},children:[o.jsx("button",{onClick:e,style:{padding:"6px 14px",borderRadius:1,background:"none",border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.35)",fontSize:10,cursor:"pointer"},children:"Cancelar"}),o.jsxs("button",{title:"Configuraes",onClick:s,style:{padding:"6px 16px",borderRadius:1,background:"rgba(16,212,91,0.08)",border:"1px dashed rgba(16,212,91,0.35)",color:"rgba(16,212,91,0.9)",fontSize:10,cursor:"pointer",display:"flex",alignItems:"center",gap:6},children:[o.jsx($u,{size:9,strokeWidth:1.5}),"Salvar Prompts"]})]})]})})}const hk=[{id:"gpt-5",label:"GPT-5           frontier",group:"GPT-5"},{id:"gpt-5-mini",label:"GPT-5 mini      rpido ",group:"GPT-5"},{id:"gpt-4.5-preview",label:"GPT-4.5         qualidade",group:"GPT-4.5"},{id:"gpt-4.1-nano",label:"GPT-4.1 nano    ultra-rpido ",group:"GPT-4.1"},{id:"gpt-4.1-mini",label:"GPT-4.1 mini    rpido ",group:"GPT-4.1"},{id:"gpt-4.1",label:"GPT-4.1         qualidade",group:"GPT-4.1"},{id:"gpt-4o-mini",label:"GPT-4o mini     rpido ",group:"GPT-4o"},{id:"gpt-4o",label:"GPT-4o          qualidade",group:"GPT-4o"},{id:"o4-mini",label:"o4-mini         raciocnio ",group:"Raciocnio"},{id:"o3-mini",label:"o3-mini         raciocnio",group:"Raciocnio"},{id:"o3",label:"o3              raciocnio+",group:"Raciocnio"},{id:"gpt-3.5-turbo",label:"GPT-3.5         legado",group:"Legado"}];function bQ({onGenerate:e,onClear:t,hasLLMNodes:n,onOpenPromptEditor:r,provider:a,setProvider:i,apiKey:s,setApiKey:c,modelId:l,setModelId:d,llmMode:u,setLlmMode:h}){const m=iS(),[f,g]=S.useState(""),[x,v]=S.useState("medium"),[b,w]=S.useState(22),[M,k]=S.useState(!1),R={width:"100%",padding:"5px 7px",borderRadius:1,fontSize:10,background:"rgba(255,255,255,0.04)",border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.7)",outline:"none",fontFamily:"'IBM Plex Mono', monospace",boxSizing:"border-box"},j={fontSize:8,color:"rgba(255,255,255,0.28)",letterSpacing:"0.07em",textTransform:"uppercase",marginBottom:3,display:"block"},I=()=>{if(!f.trim())return;const L={topic:f.trim(),depth:x,nodeCount:b,provider:a,apiKey:s||void 0,modelId:l||void 0,llmMode:u};e(L)},E=Object.keys(vf),O=vf[u];return o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[o.jsxs("div",{style:{position:"relative"},children:[o.jsx("input",{style:{...R,padding:"9px 38px 9px 12px",fontSize:11,borderRadius:7,border:"1px solid rgba(255,255,255,0.13)",background:"rgba(255,255,255,0.05)",color:"#fff",transition:"border-color 0.15s"},placeholder:"Tpico, conceito, pessoa...",value:f,onChange:L=>g(L.target.value),onKeyDown:L=>{L.key==="Enter"&&I()},onFocus:L=>L.currentTarget.style.borderColor="rgba(196,181,253,0.45)",onBlur:L=>L.currentTarget.style.borderColor="rgba(255,255,255,0.13)"}),o.jsx("button",{onClick:I,style:{position:"absolute",right:5,top:"50%",transform:"translateY(-50%)",background:"rgba(124,58,237,0.35)",border:"1px solid rgba(124,58,237,0.5)",borderRadius:5,padding:"3px 7px",cursor:"pointer",color:"rgba(196,181,253,0.9)",display:"flex",alignItems:"center"},title:"Gerar Rizoma (Enter)",children:o.jsx(ic,{size:10,strokeWidth:1.5})})]}),o.jsxs("div",{children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:5},children:[o.jsx("span",{style:j,children:"Modo"}),o.jsxs("button",{onClick:r,title:"Editar prompts",style:{background:"none",border:"none",cursor:"pointer",color:"rgba(255,255,255,0.22)",display:"flex",alignItems:"center",gap:3,fontSize:8,padding:0},onMouseEnter:L=>L.currentTarget.style.color="rgba(196,181,253,0.6)",onMouseLeave:L=>L.currentTarget.style.color="rgba(255,255,255,0.22)",children:[o.jsx($u,{size:8,strokeWidth:1.5})," prompts"]})]}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:3},children:E.map(L=>{const $=vf[L],F=L===u;return o.jsxs("button",{onClick:()=>h(L),title:$.hint,style:{padding:"5px 7px",borderRadius:5,cursor:"pointer",textAlign:"left",background:F?"rgba(124,58,237,0.2)":"rgba(255,255,255,0.02)",border:`1px solid ${F?"rgba(124,58,237,0.5)":"rgba(255,255,255,0.06)"}`,color:F?"rgba(196,181,253,0.92)":"rgba(255,255,255,0.35)",fontSize:9,display:"flex",alignItems:"center",gap:5,transition:"all 0.12s"},onMouseEnter:B=>{F||(B.currentTarget.style.borderColor="rgba(255,255,255,0.14)",B.currentTarget.style.color="rgba(255,255,255,0.55)")},onMouseLeave:B=>{F||(B.currentTarget.style.borderColor="rgba(255,255,255,0.06)",B.currentTarget.style.color="rgba(255,255,255,0.35)")},children:[o.jsx("span",{style:{fontFamily:"monospace",fontSize:10},children:$.icon}),$.label]},L)})}),o.jsx("div",{style:{fontSize:8,color:"rgba(196,181,253,0.4)",marginTop:4,fontStyle:"italic"},children:O.hint})]}),o.jsxs("div",{style:{display:"flex",gap:6},children:[o.jsxs("div",{style:{flex:1},children:[o.jsx("span",{style:j,children:m("Profundidade","Depth")}),o.jsx("div",{style:{display:"flex",gap:2},children:["shallow","medium","deep"].map(L=>o.jsx("button",{title:`${m("Profundidade","Depth")} ${L}`,onClick:()=>v(L),style:{flex:1,padding:"3px 0",borderRadius:3,fontSize:8,cursor:"pointer",fontFamily:"monospace",background:x===L?"rgba(124,58,237,0.25)":"rgba(255,255,255,0.03)",border:`1px solid ${x===L?"rgba(124,58,237,0.45)":"rgba(255,255,255,0.07)"}`,color:x===L?"rgba(196,181,253,0.9)":"rgba(255,255,255,0.28)",transition:"all 0.1s"},children:L==="shallow"?m("Raso","Shallow"):L==="medium"?m("Mdio","Medium"):m("Fundo","Deep")},L))})]}),o.jsxs("div",{style:{width:60},children:[o.jsx("span",{style:j,children:m("Ns","Nodes")}),o.jsx("input",{type:"number",min:8,max:60,value:b,onChange:L=>w(Math.max(8,Math.min(60,parseInt(L.target.value)||18))),style:{...R,width:"100%",padding:"3px 6px",textAlign:"center"}})]})]}),o.jsxs("div",{children:[o.jsxs("button",{title:"Expandir",onClick:()=>k(L=>!L),style:{background:"none",border:"none",cursor:"pointer",color:"rgba(255,255,255,0.25)",fontSize:9,display:"flex",alignItems:"center",gap:4,padding:0,letterSpacing:"0.05em"},onMouseEnter:L=>L.currentTarget.style.color="rgba(255,255,255,0.5)",onMouseLeave:L=>L.currentTarget.style.color="rgba(255,255,255,0.25)",children:[M?o.jsx(Ms,{size:8}):o.jsx(hs,{size:8}),"Modelo / API Key"]}),M&&o.jsxs("div",{style:{marginTop:7,display:"flex",flexDirection:"column",gap:6},children:[o.jsxs("div",{children:[o.jsx("span",{style:j,children:"Provedor"}),o.jsxs("select",{value:a,onChange:L=>i(L.target.value),style:{...R,cursor:"pointer"},children:[o.jsx("option",{value:"openai",children:"OpenAI"}),o.jsx("option",{value:"anthropic",children:"Anthropic (Claude)"}),o.jsx("option",{value:"ollama",children:"Ollama (local)"}),o.jsx("option",{value:"custom",children:"Custom endpoint"})]})]}),o.jsxs("div",{children:[o.jsx("span",{style:j,children:"Modelo"}),a==="openai"?o.jsx("select",{value:l||"gpt-4.1-mini",onChange:L=>d(L.target.value),style:{...R,cursor:"pointer"},children:[...new Set(hk.map($=>$.group))].map($=>o.jsx("optgroup",{label:$,children:hk.filter(F=>F.group===$).map(F=>o.jsx("option",{value:F.id,children:F.label},F.id))},$))}):o.jsx("input",{style:R,placeholder:a==="anthropic"?"claude-3-5-haiku-20241022":a==="ollama"?"llama3.2":"model-id",value:l,onChange:L=>d(L.target.value)})]}),o.jsxs("div",{children:[o.jsxs("span",{style:j,children:["API Key ",a==="ollama"?"(no necessria)":""]}),o.jsx("input",{style:R,type:"password",placeholder:a==="openai"?"sk-...":a==="anthropic"?"sk-ant-...":"(no necessria)",value:s,onChange:L=>c(L.target.value)}),o.jsx("div",{style:{fontSize:7,color:"rgba(255,255,255,0.18)",marginTop:2},children:"Chave processada localmente. Streaming ativo para OpenAI."})]})]})]}),o.jsxs("div",{style:{display:"flex",gap:5},children:[o.jsxs("button",{title:"Gerar rizoma",onClick:I,style:{flex:1,padding:"8px 0",borderRadius:6,cursor:"pointer",background:"rgba(124,58,237,0.22)",border:"1px solid rgba(124,58,237,0.45)",color:"rgba(196,181,253,0.9)",fontSize:10,display:"flex",alignItems:"center",justifyContent:"center",gap:6,transition:"all 0.12s"},onMouseEnter:L=>{L.currentTarget.style.background="rgba(124,58,237,0.35)",L.currentTarget.style.borderColor="rgba(124,58,237,0.65)"},onMouseLeave:L=>{L.currentTarget.style.background="rgba(124,58,237,0.22)",L.currentTarget.style.borderColor="rgba(124,58,237,0.45)"},children:[o.jsx(ic,{size:10,strokeWidth:1.5}),"Gerar Rizoma"]}),n&&o.jsx("button",{title:"Limpar",onClick:t,style:{padding:"8px 10px",borderRadius:6,cursor:"pointer",background:"rgba(239,68,68,0.06)",border:"1px solid rgba(239,68,68,0.18)",color:"rgba(239,68,68,0.55)",display:"flex",alignItems:"center",transition:"all 0.12s"},onMouseEnter:L=>{L.currentTarget.style.background="rgba(239,68,68,0.14)",L.currentTarget.style.borderColor="rgba(239,68,68,0.35)"},onMouseLeave:L=>{L.currentTarget.style.background="rgba(239,68,68,0.06)",L.currentTarget.style.borderColor="rgba(239,68,68,0.18)"},children:o.jsx(il,{size:9,strokeWidth:1.5})})]})]})}function xQ({node:e,allNodes:t,onClose:n,onExpand:r,onSave:a}){const i=e.connectionsLabels?e.connectionsLabels:Array.from(e.connections.keys()).map(u=>{var h;return(h=t.find(m=>m.id===u))==null?void 0:h.label}).filter(Boolean),s=e.category?(()=>{const u={philosophy:"#a78bfa",science:"#38bdf8",mathematics:"#fb923c",history:"#fbbf24",art:"#f472b6",politics:"#4ade80",economics:"#34d399",psychology:"#c084fc",biology:"#86efac",physics:"#60a5fa",default:"#00ff66"},h=e.category.toLowerCase();for(const[f,g]of Object.entries(u))if(h.includes(f))return g;let m=0;for(let f=0;f<e.category.length;f++)m=m*31+e.category.charCodeAt(f)&16777215;return`hsl(${m%360},70%,60%)`})():"#00ff66",c=encodeURIComponent(e.label??""),l=(e.category??"").toLowerCase(),d=[{label:"Wikipedia",icon:"W",url:`https://en.wikipedia.org/wiki/Special:Search?search=${c}`,color:"#e2e8f0"},{label:"Scholar",icon:"",url:`https://scholar.google.com/scholar?q=${c}`,color:"#60a5fa"},{label:"YouTube",icon:"",url:`https://www.youtube.com/results?search_query=${c}`,color:"#f87171"}];return l.includes("philos")||l.includes("concept")||l.includes("theory")||l.includes("method")?d.push({label:"SEP",icon:"",url:`https://plato.stanford.edu/search/searcher.py?query=${c}`,color:"#a78bfa"}):l.includes("physic")||l.includes("math")||l.includes("science")||l.includes("bio")?d.push({label:"arXiv",icon:"",url:`https://arxiv.org/search/?query=${c}&searchtype=all`,color:"#fb923c"}):l.includes("histor")||l.includes("art")||l.includes("cultur")?d.push({label:"JSTOR",icon:"J",url:`https://www.jstor.org/action/doBasicSearch?Query=${c}`,color:"#fbbf24"}):d.push({label:"Google",icon:"",url:`https://www.google.com/search?q=${c}`,color:"#4ade80"}),o.jsxs("div",{style:{position:"absolute",bottom:20,left:20,width:280,background:"rgba(0,0,0,0.97)",border:`1px dashed ${s}35`,borderRadius:1,padding:"14px 16px",zIndex:100,fontFamily:Ko,boxShadow:`0 0 24px ${s}15`},children:[o.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",marginBottom:8},children:[o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:14,color:"#fff",marginBottom:4,lineHeight:1.2,fontFamily:dw,letterSpacing:"0.04em"},children:e.label}),e.category&&o.jsx("div",{style:{display:"inline-block",fontSize:7,padding:"2px 6px",borderRadius:1,background:`${s}15`,border:`1px dashed ${s}40`,color:s,letterSpacing:"0.08em",textTransform:"uppercase"},children:e.category})]}),o.jsx("button",{title:"Fechar",onClick:n,style:{background:"none",border:"none",color:"rgba(255,255,255,0.3)",cursor:"pointer",padding:2,fontSize:14,lineHeight:1},children:""})]}),e.description&&o.jsx("div",{style:{fontSize:9,color:"rgba(255,255,255,0.55)",lineHeight:1.6,marginBottom:10,padding:"6px 8px",background:"rgba(255,255,255,0.03)",borderRadius:1,borderLeft:`2px dashed ${s}50`},children:e.description}),i.length>0&&o.jsxs("div",{style:{marginBottom:10},children:[o.jsxs("div",{style:{fontSize:7,color:"rgba(255,255,255,0.25)",letterSpacing:"0.08em",textTransform:"uppercase",marginBottom:5},children:["Conexes (",i.length,")"]}),o.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:3},children:[i.slice(0,8).map(u=>o.jsx("span",{style:{fontSize:7,padding:"2px 6px",borderRadius:1,background:"rgba(255,255,255,0.04)",border:"1px dashed rgba(255,255,255,0.08)",color:"rgba(255,255,255,0.50)"},children:u},u)),i.length>8&&o.jsxs("span",{style:{fontSize:7,color:"rgba(255,255,255,0.22)",padding:"2px 4px"},children:["+",i.length-8]})]})]}),o.jsxs("div",{style:{marginBottom:10},children:[o.jsx("div",{style:{fontSize:7,color:"rgba(255,255,255,0.25)",letterSpacing:"0.08em",textTransform:"uppercase",marginBottom:6,fontFamily:Ko},children:"Explorar"}),o.jsx("div",{style:{display:"flex",gap:4,flexWrap:"wrap"},children:d.map(u=>o.jsxs("a",{href:u.url,target:"_blank",rel:"noopener noreferrer",title:`Pesquisar "${e.label}" no ${u.label}`,style:{display:"inline-flex",alignItems:"center",gap:4,padding:"3px 8px",borderRadius:1,background:`${u.color}0A`,border:`1px dashed ${u.color}25`,color:u.color,fontSize:8,textDecoration:"none",cursor:"pointer",fontFamily:Ko,letterSpacing:"0.05em",textTransform:"uppercase"},onMouseEnter:h=>{h.currentTarget.style.background=`${u.color}25`,h.currentTarget.style.borderColor=`${u.color}60`},onMouseLeave:h=>{h.currentTarget.style.background=`${u.color}12`,h.currentTarget.style.borderColor=`${u.color}30`},children:[o.jsx("span",{style:{fontFamily:"monospace",fontSize:10,lineHeight:1,opacity:.85},children:u.icon}),u.label]},u.label))})]}),o.jsxs("button",{title:"Expandir n",onClick:()=>{r(e),n()},style:{marginTop:8,marginBottom:6,width:"100%",padding:"7px 0",borderRadius:1,cursor:"pointer",fontFamily:Ko,background:"rgba(124,58,237,0.10)",border:"1px dashed rgba(124,58,237,0.35)",color:"rgba(196,181,253,0.85)",fontSize:9,display:"flex",alignItems:"center",justifyContent:"center",gap:6,transition:"all 0.15s",letterSpacing:"0.04em",textTransform:"uppercase"},onMouseEnter:u=>{u.currentTarget.style.background="rgba(124,58,237,0.22)",u.currentTarget.style.borderColor="rgba(124,58,237,0.55)"},onMouseLeave:u=>{u.currentTarget.style.background="rgba(124,58,237,0.10)",u.currentTarget.style.borderColor="rgba(124,58,237,0.35)"},children:[o.jsx(ic,{size:9,strokeWidth:1.5}),"Expandir  ",o.jsxs("span",{style:{maxWidth:120,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:['"',e.label,'"']})]}),o.jsxs("button",{title:"Salvar n",onClick:()=>a(e),style:{marginBottom:8,width:"100%",padding:"6px 0",borderRadius:1,cursor:"pointer",fontFamily:Ko,background:"rgba(34,197,94,0.08)",border:"1px dashed rgba(34,197,94,0.25)",color:"rgba(134,239,172,0.80)",fontSize:9,display:"flex",alignItems:"center",justifyContent:"center",gap:6,transition:"all 0.15s",letterSpacing:"0.04em",textTransform:"uppercase"},onMouseEnter:u=>{u.currentTarget.style.background="rgba(34,197,94,0.16)",u.currentTarget.style.borderColor="rgba(34,197,94,0.45)"},onMouseLeave:u=>{u.currentTarget.style.background="rgba(34,197,94,0.08)",u.currentTarget.style.borderColor="rgba(34,197,94,0.25)"},children:[o.jsx(nS,{size:9,strokeWidth:1.5}),tr("Salvar em Coleo","Save to Collection")]}),o.jsxs("div",{style:{fontSize:8,color:"rgba(255,255,255,0.18)",lineHeight:1.5,borderTop:"1px solid rgba(255,255,255,0.06)",paddingTop:8,fontStyle:"italic"},children:[tr(" Descries geradas pela LLM  "," LLM-generated descriptions  "),o.jsx("b",{style:{color:"rgba(251,191,36,0.45)"},children:tr("verifique fontes primrias","verify primary sources")}),"."]})]})}const vQ=({active:e})=>{var To,Xo,ks;const t=iS(),n=S.useRef(null),r=S.useRef(0),a=S.useRef(null),i=S.useRef(0),[s,c]=S.useState({...LJ}),[l,d]=S.useState({...lw}),[u,h]=S.useState(null),[m,f]=S.useState({W:window.innerWidth,H:window.innerHeight}),[g,x]=S.useState(!1),[v,b]=S.useState(!1),[w,M]=S.useState("idle"),[k,R]=S.useState(""),[j,I]=S.useState(""),[E,O]=S.useState(""),[L,$]=S.useState(null),[F,B]=S.useState(!1),[W,re]=S.useState(!1),[oe,te]=S.useState(!1),[J,pe]=S.useState(!1),{user:P,signOut:V,setUser:fe}=vm();S.useEffect(()=>{P!=null&&P.accessToken&&hf(P.accessToken)},[P]);const ye=S.useRef({...Nh}),[Se,we]=S.useState({...Nh}),ke=S.useRef({active:!1,startX:0,startY:0,startRotX:0,startRotY:0,startRotZ:0,isRoll:!1}),De=S.useRef(0),_e=S.useRef(""),[ae,Re]=S.useState(!1),[Fe,Oe]=S.useState(!1),[ne,nt]=S.useState(!1),[pt,Et]=S.useState(!0),[_t,Ct]=S.useState(!1),Xe=S.useRef(null),[Ut,Le]=S.useState("idle"),[Ke,mt]=S.useState(0),[an,gn]=S.useState("WebM"),[Be,ft]=S.useState([]),[Qt,nr]=S.useState([]),[_n,Rn]=S.useState(!1),[sn,Cn]=S.useState(!1),[wt,st]=S.useState(null),[Zt,Pe]=S.useState(new Map),[ct,vt]=S.useState("openai"),[xe,ge]=S.useState(""),[Ee,me]=S.useState("gpt-4.1-mini");S.useEffect(()=>{const D=pS();D&&(ge(D),Mt.current=D)},[]);const[je,Te]=S.useState("concepts"),Ae=S.useRef(s),Tt=S.useRef(l),xt=S.useRef(!1),en=S.useRef(!1),At=S.useRef(!1),Ze=S.useRef("idle"),yt=S.useRef("openai"),Mt=S.useRef(""),bn=S.useRef("gpt-4.1-mini"),Pt=S.useRef({zoom:1,panX:0,panY:0}),[An,cr]=S.useState(1),Tn=S.useRef({active:!1,startX:0,startY:0,startPanX:0,startPanY:0,moved:!1});S.useEffect(()=>{Ae.current=s},[s]),S.useEffect(()=>{Tt.current=l},[l]),S.useEffect(()=>{en.current=W},[W]),S.useEffect(()=>{Ze.current=w},[w]),S.useEffect(()=>{yt.current=ct},[ct]),S.useEffect(()=>{Mt.current=xe},[xe]),S.useEffect(()=>{bn.current=Ee},[Ee]);const Sr=250,de=36,$e=Math.max(200,m.W-Sr),et=Math.max(200,m.H-de);S.useEffect(()=>{const D=()=>f({W:window.innerWidth,H:window.innerHeight});return window.addEventListener("resize",D),()=>window.removeEventListener("resize",D)},[]),S.useEffect(()=>{const D=n.current;D&&(D.width!==$e||D.height!==et)&&(D.width=$e,D.height=et)},[$e,et]),S.useEffect(()=>(Xe.current=new Nf(D=>{Le(D),D==="idle"&&mt(0)}),()=>{var D;return(D=Xe.current)==null?void 0:D.dispose()}),[]),S.useEffect(()=>{if(Ut!=="recording")return;const D=setInterval(()=>{var ee;return mt(((ee=Xe.current)==null?void 0:ee.elapsed)??0)},500);return()=>clearInterval(D)},[Ut]);const zt=S.useCallback((D,ee,Ie)=>{const Qe=Ie??Date.now(),X=Uv($e,et,Qe,D);ee&&(X.aesthetics={...ee}),a.current=X,i.current=0,xt.current=!1,b(!1),I(""),R(""),M("idle"),$(null),B(!1)},[$e,et]);S.useEffect(()=>{e&&zt(Ae.current,Tt.current)},[e]),S.useEffect(()=>{ft(Oi()),Ec(()=>Promise.resolve().then(()=>J5),void 0).then(D=>{D.loadFoldersFromBackend().then(ee=>{if(ee.length>0){const Ie=Oi(),Qe=[...ee];for(const X of Ie){const Z=Qe.findIndex(ce=>ce.id===X.id);Z>=0?X.updatedAt>Qe[Z].updatedAt&&(Qe[Z]=X):Qe.push(X)}ft(Qe),Gu(Qe)}}).catch(ee=>{console.error("[RhizomeLab] Failed to load folders from backend:",ee)})}).catch(D=>{console.error("[RhizomeLab] Failed to import rhizome backend:",D)})},[]),S.useEffect(()=>{nr(Ay()),Ec(()=>Promise.resolve().then(()=>J5),void 0).then(D=>{D.loadRhizomesFromBackend().then(ee=>{if(ee.length>0){const Ie=Ay(),Qe=[...ee];for(const X of Ie){const Z=Qe.findIndex(ce=>ce.id===X.id);Z>=0?X.savedAt>Qe[Z].savedAt&&(Qe[Z]=X):Qe.push(X)}Ec(async()=>{const{saveSavedRhizomes:X}=await Promise.resolve().then(()=>Sx);return{saveSavedRhizomes:X}},void 0).then(({saveSavedRhizomes:X})=>{nr(Qe),X(Qe)})}}).catch(ee=>{console.error("[RhizomeLab] Failed to load rhizomes from backend:",ee)})}).catch(D=>{console.error("[RhizomeLab] Failed to import rhizome backend:",D)})},[]),S.useEffect(()=>{if(!a.current||a.current.nodes.length===0){Pe(new Map);return}const D=pQ(a.current.nodes);Pe(D)},[(To=a.current)==null?void 0:To.nodes.length]),S.useEffect(()=>{if(!e)return;let D=0;const ee=Ie=>{r.current=requestAnimationFrame(ee);const Qe=n.current,X=a.current;if(!Qe||!X)return;const Z=Qe.getContext("2d");if(!Z)return;i.current===0&&(i.current=Ie);const ce=(Ie-i.current)/1e3;if(i.current=Ie,ce<=0||ce>.5)return;X.params=Ae.current,X.aesthetics=Tt.current,xt.current?(X.entryTimer=0,X.growthTimer=0,X.forgetTimer=0,X.reterritTimer=0,X.searchMode=!0):X.searchMode=!1;const ue=Qe.width,be=Qe.height;V6(X,ue,be,ce);const H=Pt.current;if(en.current){Z.setTransform(1,0,0,1,0,0);const le=ye.current;le.autoRotate&&(le.rotY+=ce*le.autoSpeed);try{U6(Z,X,ue,be,le),At.current=!1}catch(Je){At.current||(console.error("[RhizomeLab] 3D render failed, falling back to 2D:",Je),At.current=!0),en.current=!1,re(!1),Z.setTransform(H.zoom,0,0,H.zoom,H.panX,H.panY),Kv(Z,X,ue,be)}}else{Z.setTransform(H.zoom,0,0,H.zoom,H.panX,H.panY);try{Kv(Z,X,ue,be)}catch(le){console.error("[RhizomeLab] 2D render error:",le)}}Z.setTransform(1,0,0,1,0,0);try{SQ(Z,X,ue,H.zoom)}catch{}D++,D>=30&&(D=0,h(Yv(X)),b(X.nodes.some(le=>le.label&&!le.userPlaced)))};return r.current=requestAnimationFrame(ee),()=>cancelAnimationFrame(r.current)},[e]);const Nt=S.useCallback((D,ee)=>{const Ie=n.current;if(!Ie)return{x:0,y:0};const Qe=Ie.getBoundingClientRect(),X=Ie.width/Qe.width,Z=Ie.height/Qe.height,ce=Pt.current;return{x:((D-Qe.left)*X-ce.panX)/ce.zoom,y:((ee-Qe.top)*Z-ce.panY)/ce.zoom}},[]),ln=S.useCallback((D,ee,Ie)=>{const Qe=n.current;if(!Qe)return;const X=Qe.getBoundingClientRect(),Z=Qe.width/X.width,ce=Qe.height/X.height,ue=(D-X.left)*Z,be=(ee-X.top)*ce,H=Pt.current,le=H.zoom,Je=Math.max(.1,Math.min(16,le*Ie));if(Math.abs(Je-le)>.001){const tt=Je/le;Pt.current={zoom:Je,panX:ue-(ue-H.panX)*tt,panY:be-(be-H.panY)*tt},cr(parseFloat(Je.toFixed(2)))}},[]),Rt=S.useCallback(()=>{const D=n.current,ee=a.current;if(!D||!ee||ee.nodes.length===0){Pt.current={zoom:1,panX:0,panY:0},cr(1);return}let Ie=1/0,Qe=1/0,X=-1/0,Z=-1/0;for(const le of ee.nodes)le.x<Ie&&(Ie=le.x),le.y<Qe&&(Qe=le.y),le.x>X&&(X=le.x),le.y>Z&&(Z=le.y);const ce=80,ue=X-Ie+ce*2,be=Z-Qe+ce*2,H=Math.max(.15,Math.min(6,Math.min(D.width/ue,D.height/be)));Pt.current={zoom:H,panX:D.width/2-(Ie+X)/2*H,panY:D.height/2-(Qe+Z)/2*H},cr(parseFloat(H.toFixed(2)))},[]);S.useEffect(()=>{if(!e)return;const D=ee=>{ee.target instanceof HTMLInputElement||ee.target instanceof HTMLTextAreaElement||((ee.key==="f"||ee.key==="F")&&Rt(),(ee.key==="="||ee.key==="+")&&ln($e/2,et/2,1.25),(ee.key==="-"||ee.key==="_")&&ln($e/2,et/2,.8),ee.key==="0"&&(Pt.current={zoom:1,panX:0,panY:0},cr(1)))};return window.addEventListener("keydown",D),()=>window.removeEventListener("keydown",D)},[e,Rt,ln,$e,et]),S.useEffect(()=>{const D=n.current;if(!D||!e)return;const ee=Ie=>{if(Ie.preventDefault(),en.current){const X=Ie.deltaY<0?1.12:.89,Z=Math.max(.1,Math.min(5,ye.current.zoom*X));ye.current.zoom=Z;return}const Qe=Ie.ctrlKey?Ie.deltaY<0?1.06:.94:Ie.deltaY<0?1.18:.845;ln(Ie.clientX,Ie.clientY,Qe)};return D.addEventListener("wheel",ee,{passive:!1}),()=>D.removeEventListener("wheel",ee)},[e,ln]);const Nn=S.useCallback(D=>{if(g)return;if(en.current){ke.current={active:!0,startX:D.clientX,startY:D.clientY,startRotX:ye.current.rotX,startRotY:ye.current.rotY,startRotZ:ye.current.rotZ,isRoll:D.shiftKey||D.button===1};return}const ee=n.current;if(!ee)return;const Ie=ee.getBoundingClientRect();Tn.current={active:!0,startX:(D.clientX-Ie.left)*(ee.width/Ie.width),startY:(D.clientY-Ie.top)*(ee.height/Ie.height),startPanX:Pt.current.panX,startPanY:Pt.current.panY,moved:!1}},[g]),It=S.useCallback(D=>{if(en.current){const be=ke.current;if(!be.active)return;const H=D.clientX-be.startX,le=D.clientY-be.startY,Je=.005;be.isRoll?ye.current.rotZ=be.startRotZ+H*Je:(ye.current.rotY=be.startRotY+H*Je,ye.current.rotX=Math.max(-Math.PI/2+.05,Math.min(Math.PI/2-.05,be.startRotX+le*Je))),Tn.current.moved=!0;return}const ee=Tn.current;if(!ee.active)return;const Ie=n.current;if(!Ie)return;const Qe=Ie.getBoundingClientRect(),X=(D.clientX-Qe.left)*(Ie.width/Qe.width),Z=(D.clientY-Qe.top)*(Ie.height/Qe.height),ce=X-ee.startX,ue=Z-ee.startY;(Math.abs(ce)>4||Math.abs(ue)>4)&&(ee.moved=!0),ee.moved&&(Pt.current={...Pt.current,panX:ee.startPanX+ce,panY:ee.startPanY+ue})},[]),xn=S.useCallback(()=>{Tn.current.active=!1,ke.current.active=!1},[]),Ln=S.useCallback(()=>{en.current&&(ye.current={...Nh},we({...Nh}))},[]),zn=S.useCallback(D=>{if(Tn.current.moved){Tn.current.moved=!1;return}if(!a.current)return;if(en.current){const ce=n.current;if(!ce)return;const ue=ce.getBoundingClientRect(),be=ce.width/ue.width,H=ce.height/ue.height,le=(D.clientX-ue.left)*be,Je=(D.clientY-ue.top)*H,tt=ye.current,St=ce.width,$t=ce.height,rt=St/2+tt.panX,Ft=$t/2+tt.panY,dn=Math.min(St,$t)*tt.fov+300,kn=Math.cos(tt.rotY),ar=Math.sin(tt.rotY),jn=Math.cos(tt.rotX),yr=Math.sin(tt.rotX),Bt=Math.cos(tt.rotZ),qt=Math.sin(tt.rotZ);let mn=null,dr=28;for(const rr of a.current.nodes){const Dr=rr.connections.size,Vr=(Math.min(1,Dr/8*.5+rr.heat*.45+(rr.isEntry?.2:0)+(rr.isAnchor?.4:0))-.5)*tt.zSpread+Math.sin(rr.id*2.39996)*tt.zSpread*.33,ko=rr.x-St/2,Ea=rr.y-$t/2,no=Vr,go=ko*kn+no*ar,qs=-ko*ar+no*kn,Ka=Ea*jn-qs*yr,Jo=Ea*yr+qs*jn,La=go*Bt-Ka*qt,za=go*qt+Ka*Bt,Rs=dn/(Jo+dn)*tt.zoom,Qo=rt+La*Rs,vo=Ft+za*Rs,va=Qo-le,Js=vo-Je,$i=Math.sqrt(va*va+Js*Js);$i<dr&&(dr=$i,mn=rr)}$(mn!=null&&mn.label?mn:null);return}const{x:ee,y:Ie}=Nt(D.clientX,D.clientY);if(g){G6(a.current,ee,Ie,$e,et),h(Yv(a.current));return}const Qe=Math.max(6,Math.min(32,22/Pt.current.zoom));let X=null,Z=Qe;for(const ce of a.current.nodes){const ue=ce.x-ee,be=ce.y-Ie,H=Math.sqrt(ue*ue+be*be);H<Z&&(Z=H,X=ce)}$(X!=null&&X.label?X:null)},[g,$e,et,Nt]),Or=S.useCallback(D=>{const ee=rk[D];if(!ee)return;const Ie={...ee.params};c(Ie),Ae.current=Ie,zt(Ie,Tt.current)},[zt]),wr=S.useCallback((D,ee)=>{c(Ie=>{const Qe={...Ie,[D]:ee};return Ae.current=Qe,a.current&&(a.current.params=Qe),Qe})},[]),vn=S.useCallback((D,ee)=>{d(Ie=>{const Qe={...Ie,[D]:ee};return Tt.current=Qe,a.current&&(a.current.aesthetics=Qe),Qe})},[]),Gr=S.useCallback(D=>{d(ee=>{const Ie={...ee,...D};return Tt.current=Ie,a.current&&(a.current.aesthetics=Ie),Ie})},[]),hn=S.useCallback(()=>{const D=n.current;if(!D)return;const ee=D.toDataURL("image/png"),Ie=document.createElement("a");Ie.href=ee,Ie.download=`rhizome-${Date.now()}.png`,Ie.click()},[]),jr=S.useCallback((D,ee)=>{const Ie=Xe.current;if(!Ie)return;const Qe=Ae.current;Ie.start(()=>[n.current],()=>({labName:"Rhizome Lab",lines:[`intensidade:${Qe.organismToIntensity.toFixed(2)}  ruido:${Qe.noise.toFixed(2)}`,`l.fuga:${Qe.linhasDeFuga.toFixed(2)}  territ:${Qe.territorializacao.toFixed(2)}`,`hubs:${Qe.hubs.toFixed(2)}  esquec:${Qe.esquecimento.toFixed(2)}`]}),30,void 0,{format:D,quality:ee}),gn(Ie.actualFmt)},[]),_r=S.useCallback(()=>{var D;(D=Xe.current)==null||D.stop()},[]),Zn=S.useCallback((D,ee)=>{J6(D,ee),ft(Oi())},[]),lo=S.useCallback(D=>{Q6(D),ft(Oi())},[]),ir=S.useCallback((D,ee)=>{const Ie=D.connectionsLabels?[...D.connectionsLabels]:Array.from(D.connections.keys()).map(ue=>{var be,H;return(H=(be=a.current)==null?void 0:be.nodes.find(le=>le.id===ue))==null?void 0:H.label}).filter(Boolean),Qe=encodeURIComponent(D.label||""),X=[`https://en.wikipedia.org/wiki/Special:Search?search=${Qe}`,`https://scholar.google.com/scholar?q=${Qe}`],Z=D.category?[D.category]:[],ce=rE(D.label||`Node ${D.id}`,D.description,D.category,Ie.length>0?Ie:void 0,Z.length>0?Z:void 0,X);ee?(Z6(ee,ce),ft(Oi()),a.current&&Ec(async()=>{const{createSnapshot:ue}=await Promise.resolve().then(()=>ck);return{createSnapshot:ue}},void 0).then(({createSnapshot:ue})=>{Ec(async()=>{const{saveRhizome:be,loadSavedRhizomes:H,saveSavedRhizomes:le}=await Promise.resolve().then(()=>Sx);return{saveRhizome:be,loadSavedRhizomes:H,saveSavedRhizomes:le}},void 0).then(({saveRhizome:be,loadSavedRhizomes:H,saveSavedRhizomes:le})=>{const Je=ue(a.current);if(Je){const tt=be(D.label||`Rizoma ${Date.now()}`,D.description||"",j||D.label||"Untitled",a.current.nodes.length,Je,ee);console.log("Saved rhizome snapshot:",tt.title)}})}),st(null)):st({node:D,card:ce})},[Be,j]),to=S.useCallback((D,ee)=>{eE(D,ee),ft(Oi())},[]),Er=S.useCallback((D,ee,Ie)=>{tE(D,ee,Ie),ft(Oi())},[]),Eo=S.useCallback(D=>{console.log("Card selected:",D),Ec(async()=>{const{loadSavedRhizomes:ee}=await Promise.resolve().then(()=>Sx);return{loadSavedRhizomes:ee}},void 0).then(({loadSavedRhizomes:ee})=>{const Qe=ee().find(X=>X.title===D.label||X.topic===D.label);Qe&&Qe.snapshot?Ec(async()=>{const{restoreFromSnapshot:X}=await Promise.resolve().then(()=>ck);return{restoreFromSnapshot:X}},void 0).then(({restoreFromSnapshot:X})=>{const Z=X(Qe.snapshot,$e,et);Z&&(a.current=Z,i.current=0,I(Qe.title),B(!0),xt.current=!0,console.log("Restored rhizome from snapshot:",Qe.title))}):D.url&&window.open(D.url,"_blank")})},[$e,et]),oa=S.useCallback(D=>{vp()?console.log("Send to Arena:",D):Rn(!0)},[]),ja=S.useCallback(D=>{const ee={topic:D.label||`Node ${D.id}`,depth:"medium",nodeCount:18,provider:yt.current,apiKey:Mt.current||void 0,modelId:bn.current||void 0,llmMode:je};Co(ee)},[je]),Co=S.useCallback(async D=>{M("loading"),Ze.current="loading",De.current=performance.now()/1e3,_e.current=D.topic,O(D.topic),R("Conectando  LLM..."),I(D.topic),$(null),Tt.current={...Tt.current,showLabels:!0},d(ce=>({...ce,showLabels:!0}));const ee=Uv($e,et,Date.now(),Ae.current);ee.aesthetics={...Tt.current},ee.nodes=[],ee.nextId=0;const Ie={id:ee.nextId++,x:$e/2,y:et/2,vx:0,vy:0,heat:1,isEntry:!0,age:0,connections:new Map,label:D.topic,description:"Tema central do mapa rizomtico",category:void 0,pinned:!0,userPlaced:!1,isAnchor:!0};ee.nodes.push(Ie),ee.searchMode=!0,a.current=ee,i.current=0,xt.current=!0,B(!0),b(!1),Pt.current={zoom:1,panX:0,panY:0},cr(1);const Qe=new Map;Qe.set(D.topic,Ie);const X=new Map;let Z=0;try{await ok(D,(ce,ue)=>{a.current&&(Z++,R(` ${Z} ns...`),ak(a.current,ce,ue,D.nodeCount,$e,et,Ie.id,void 0,void 0,Qe,X))},ce=>{a.current&&ik(a.current),b(!0),R(` ${ce} conceitos  ${D.topic}`),M("done"),Ze.current="done"})}catch(ce){M("error"),Ze.current="error",R(`Erro: ${ce.message}`)}},[$e,et,vn]),Ya=S.useCallback(()=>{a.current&&(UJ(a.current),xt.current=!1,B(!1),b(!1),I(""),R(""),M("idle"),$(null),vn("showLabels",!1))},[vn]),qo=S.useCallback(async D=>{if(!a.current||Ze.current==="loading")return;M("loading"),Ze.current="loading",De.current=performance.now()/1e3,_e.current=D.label??"",R(` Expandindo "${D.label}"...`),$(null);const ee={topic:D.label??"",depth:"medium",nodeCount:20,provider:yt.current,apiKey:Mt.current||void 0,modelId:bn.current||void 0,llmMode:"concepts"},Ie=a.current;xt.current=!0,B(!0),vn("showLabels",!0);const Qe=new Map;for(const be of Ie.nodes)be.label&&Qe.set(be.label,be);const X=new Map,Z=Math.PI*(3-Math.sqrt(5)),ce=[];for(const be of Ie.nodes)be.category&&be.category!=="default"&&!ce.includes(be.category)&&(X.set(be.category,ce.length*Z*2.5),ce.push(be.category));let ue=0;try{await ok(ee,(be,H)=>{a.current&&(ue++,R(` "${D.label}"  ${ue} ns`),ak(a.current,be,H,ee.nodeCount,$e,et,D.id,D.x,D.y,Qe,X))},be=>{a.current&&ik(a.current),b(!0),R(` ${be} ns de "${D.label}"`),M("done"),Ze.current="done"})}catch(be){M("error"),R(be.message),Ze.current="error"}},[$e,et,vn]);if(!e)return null;const os="rgba(16,212,91,0.65)",Ho="rgba(16,212,91,0.55)",fs={width:"100%",padding:"4px 7px",borderRadius:1,fontSize:10,background:"rgba(255,255,255,0.04)",border:"1px dashed rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.65)",outline:"none",fontFamily:"'IBM Plex Mono', monospace",boxSizing:"border-box",cursor:"pointer"};return o.jsxs("div",{style:{position:"fixed",inset:0,zIndex:5,display:"flex",flexDirection:"column",paddingTop:de,background:"#000",fontFamily:"'IBM Plex Mono', monospace"},children:[o.jsxs("div",{style:{flex:1,display:"flex",overflow:"hidden",position:"relative"},children:[o.jsxs("div",{style:{flex:1,position:"relative",overflow:"hidden"},children:[o.jsx("canvas",{ref:n,width:$e,height:et,style:{display:"block",width:"100%",height:"100%",cursor:g?"crosshair":W&&ke.current.active?"grabbing":"grab"},onClick:zn,onDoubleClick:Ln,onMouseDown:Nn,onMouseMove:It,onMouseUp:xn,onMouseLeave:xn}),o.jsxs("div",{style:{position:"absolute",top:12,left:12,display:"flex",gap:6,zIndex:50},children:[o.jsxs("button",{onClick:()=>{console.log(" Boto colees clicado, estado atual:",sn),Cn(D=>!D)},title:sn?"Esconder Colees":"Mostrar Colees",style:{padding:"6px 12px",borderRadius:1,fontFamily:Ko,background:sn?"rgba(16,212,91,0.10)":"rgba(0,0,0,0.92)",border:`1px dashed ${sn?"rgba(16,212,91,0.35)":"rgba(255,255,255,0.10)"}`,color:sn?"rgba(16,212,91,0.90)":"rgba(255,255,255,0.55)",fontSize:9,cursor:"pointer",display:"flex",alignItems:"center",gap:6,backdropFilter:"blur(8px)",transition:"all 0.15s",letterSpacing:"0.06em",textTransform:"uppercase"},onMouseEnter:D=>{sn||(D.currentTarget.style.background="rgba(16,212,91,0.08)",D.currentTarget.style.borderColor="rgba(16,212,91,0.25)",D.currentTarget.style.color="rgba(16,212,91,0.85)")},onMouseLeave:D=>{sn||(D.currentTarget.style.background="rgba(0,0,0,0.92)",D.currentTarget.style.borderColor="rgba(255,255,255,0.10)",D.currentTarget.style.color="rgba(255,255,255,0.55)")},children:[o.jsx(lf,{size:10,strokeWidth:1.5})," ",sn?"Esconder":"Colees"]}),o.jsxs("button",{onClick:()=>Rn(!0),title:"Conectar Are.na",style:{padding:"5px 10px",borderRadius:1,fontFamily:Ko,background:vp()?"rgba(34,197,94,0.10)":"rgba(0,0,0,0.88)",border:`1px dashed ${vp()?"rgba(34,197,94,0.30)":"rgba(255,255,255,0.08)"}`,color:vp()?"rgba(34,197,94,0.90)":"rgba(255,255,255,0.45)",fontSize:8,cursor:"pointer",display:"flex",alignItems:"center",gap:5,backdropFilter:"blur(8px)",letterSpacing:"0.06em",textTransform:"uppercase"},children:[vp()?"":""," Are.na"]}),o.jsx("button",{onClick:()=>{P?(hf(null),V()):pe(!0)},title:P?`${P.email}  Clique para sair`:"Entrar para sincronizar colees",style:{padding:"5px 10px",borderRadius:1,fontFamily:Ko,background:P?"rgba(96,165,250,0.10)":"rgba(0,0,0,0.88)",border:`1px dashed ${P?"rgba(96,165,250,0.30)":"rgba(255,255,255,0.08)"}`,color:P?"rgba(147,197,253,0.90)":"rgba(255,255,255,0.40)",fontSize:8,cursor:"pointer",display:"flex",alignItems:"center",gap:5,backdropFilter:"blur(8px)",transition:"all 0.15s",letterSpacing:"0.04em"},children:P?` ${P.name||P.email.split("@")[0]}`:" Login"})]}),J&&o.jsx(CR,{onClose:()=>pe(!1),onAuthChange:D=>{fe(D),hf(D.accessToken),pe(!1)}}),sn&&o.jsx(ZJ,{folders:Be,onCreateFolder:Zn,onDeleteFolder:lo,onSelectCard:Eo,onRemoveCard:to,onMoveCard:Er,onClose:()=>Cn(!1)}),o.jsxs("div",{style:{position:"absolute",bottom:16,right:16,display:"flex",flexDirection:"column",gap:3,zIndex:50},children:[o.jsxs("div",{style:{textAlign:"center",fontSize:7,fontFamily:Ko,color:"rgba(255,255,255,0.22)",letterSpacing:"0.08em",marginBottom:2},children:[Math.round(An*100),"%"]}),o.jsx("button",{onClick:()=>ln($e/2,et/2,1.35),title:"Zoom In (+)",style:{width:28,height:28,borderRadius:1,border:"1px dashed rgba(255,255,255,0.10)",background:"rgba(0,0,0,0.88)",color:"rgba(255,255,255,0.45)",fontSize:14,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",lineHeight:1,fontFamily:Ko},children:"+"}),o.jsx("button",{onClick:Rt,title:"Encaixar tudo na tela (F)",style:{width:28,height:28,borderRadius:1,border:"1px dashed rgba(255,255,255,0.10)",background:"rgba(0,0,0,0.88)",color:"rgba(255,255,255,0.35)",fontSize:10,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:Ko},children:""}),o.jsx("button",{onClick:()=>ln($e/2,et/2,.74),title:"Zoom Out (-)",style:{width:28,height:28,borderRadius:1,border:"1px dashed rgba(255,255,255,0.10)",background:"rgba(0,0,0,0.88)",color:"rgba(255,255,255,0.45)",fontSize:16,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",lineHeight:1,fontFamily:Ko},children:""}),o.jsx("button",{onClick:()=>{Pt.current={zoom:1,panX:0,panY:0},cr(1)},title:"Reset zoom 1:1",style:{width:28,height:28,borderRadius:1,border:"1px dashed rgba(255,255,255,0.06)",background:"rgba(0,0,0,0.88)",color:"rgba(255,255,255,0.22)",fontSize:7,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:Ko,letterSpacing:"0.06em"},children:"1:1"})]}),g&&o.jsx("div",{style:{position:"absolute",top:8,left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.80)",border:"1px dashed rgba(16,212,91,0.30)",borderRadius:1,padding:"4px 12px",fontSize:8,color:"rgba(16,212,91,0.75)",fontFamily:Ko,letterSpacing:"0.08em",pointerEvents:"none",textTransform:"uppercase"},children:"+ clique no canvas para adicionar n"}),W&&!L&&o.jsxs("div",{style:{position:"absolute",top:8,left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.75)",border:"1px dashed rgba(56,189,248,0.18)",borderRadius:1,padding:"4px 14px",fontSize:7,color:"rgba(56,189,248,0.45)",fontFamily:Ko,pointerEvents:"none",backdropFilter:"blur(4px)",display:"flex",gap:10,alignItems:"center",letterSpacing:"0.06em",textTransform:"uppercase"},children:[o.jsx("span",{children:"drag = rbita"}),o.jsx("span",{style:{opacity:.3},children:"|"}),o.jsx("span",{children:"scroll = zoom"}),o.jsx("span",{style:{opacity:.3},children:"|"}),o.jsx("span",{children:"click = inspecionar"}),o.jsx("span",{style:{opacity:.3},children:"|"}),o.jsx("span",{children:"dbl-click = reset"})]}),w==="done"&&j&&o.jsxs("div",{style:{position:"absolute",bottom:14,left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.80)",border:"1px dashed rgba(255,255,255,0.08)",borderRadius:1,padding:"4px 14px",fontSize:8,color:"rgba(255,255,255,0.40)",fontFamily:Ko,pointerEvents:"none",whiteSpace:"nowrap",backdropFilter:"blur(6px)",letterSpacing:"0.06em",textTransform:"uppercase"},children:[" ",j]}),L&&o.jsx(xQ,{node:L,allNodes:((Xo=a.current)==null?void 0:Xo.nodes)??[],onClose:()=>$(null),onExpand:qo,onSave:ir}),!g&&v&&!L&&o.jsxs("div",{style:{position:"absolute",top:8,right:8,fontSize:8,color:"rgba(255,255,255,0.18)",fontFamily:"monospace",pointerEvents:"none",textAlign:"right",lineHeight:1.7},children:["scroll  zoom",o.jsx("br",{}),"drag  pan",o.jsx("br",{}),"F  fit all",o.jsx("br",{}),"click  inspect"]})]}),o.jsxs("div",{style:{width:Sr,flexShrink:0,overflow:"auto",borderLeft:"1px dashed rgba(255,255,255,0.06)",background:"rgba(0,0,0,0.99)",padding:"12px 14px",scrollbarWidth:"thin",fontFamily:Ko},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:14,borderBottom:"1px dashed rgba(255,255,255,0.06)",paddingBottom:10},children:[o.jsx("div",{style:{fontSize:13,letterSpacing:"0.1em",textTransform:"uppercase",color:"rgba(255,255,255,0.50)",fontFamily:dw},children:"Rhizome Lab"}),o.jsxs("div",{style:{display:"flex",gap:4,alignItems:"center"},children:[u&&o.jsxs("div",{style:{fontSize:7,color:"rgba(255,255,255,0.18)",fontFamily:"monospace"},children:[u.nodeCount,"n"]}),o.jsxs("button",{onClick:()=>re(D=>!D),title:W?"Voltar para 2D":"Modo 3D",style:{padding:"3px 7px",borderRadius:1,cursor:"pointer",fontSize:8,fontFamily:Ko,background:W?"rgba(56,189,248,0.12)":"rgba(255,255,255,0.03)",border:`1px dashed ${W?"rgba(56,189,248,0.35)":"rgba(255,255,255,0.08)"}`,color:W?"rgba(56,189,248,0.85)":"rgba(255,255,255,0.3)",display:"flex",alignItems:"center",gap:4,transition:"all 0.15s",letterSpacing:"0.06em",textTransform:"uppercase"},onMouseEnter:D=>{W||(D.currentTarget.style.borderColor="rgba(56,189,248,0.3)",D.currentTarget.style.color="rgba(56,189,248,0.6)")},onMouseLeave:D=>{W||(D.currentTarget.style.borderColor="rgba(255,255,255,0.08)",D.currentTarget.style.color="rgba(255,255,255,0.3)")},children:[o.jsx(Kp,{size:8,strokeWidth:1.5})," 3D"]})]})]}),o.jsxs(tu,{title:t("Pesquisa Epistmica","Epistemic Search"),open:pt,onToggle:()=>Et(D=>!D),accent:"rgba(16,212,91,0.65)",children:[o.jsx(bQ,{onGenerate:Co,onClear:Ya,hasLLMNodes:v,onOpenPromptEditor:()=>te(!0),provider:ct,setProvider:D=>{vt(D),yt.current=D},apiKey:xe,setApiKey:D=>{ge(D),Mt.current=D,oD(D)},modelId:Ee,setModelId:D=>{me(D),bn.current=D},llmMode:je,setLlmMode:D=>{Te(D)}}),k&&w!=="idle"&&o.jsx("div",{style:{marginTop:7,fontSize:8,lineHeight:1.5,color:w==="done"?"rgba(74,222,128,0.7)":w==="error"?"rgba(248,113,113,0.7)":"rgba(251,191,36,0.6)",fontFamily:"monospace"},children:k})]}),o.jsxs("div",{style:{display:"flex",gap:4,marginBottom:0},children:[o.jsxs("button",{title:t("Visualizar","View"),onClick:()=>x(!1),style:{flex:1,padding:"5px 0",borderRadius:1,fontSize:8,cursor:"pointer",fontFamily:Ko,background:g?"rgba(255,255,255,0.02)":"rgba(255,255,255,0.06)",border:`1px dashed ${g?"rgba(255,255,255,0.06)":"rgba(255,255,255,0.15)"}`,color:g?"rgba(255,255,255,0.25)":"rgba(255,255,255,0.65)",display:"flex",alignItems:"center",justifyContent:"center",gap:4,transition:"all 0.15s",letterSpacing:"0.06em",textTransform:"uppercase"},children:[o.jsx(jl,{size:9,strokeWidth:1.5})," ",t("Observar","Observe")]}),o.jsxs("button",{title:t("Adicionar","Add"),onClick:()=>x(!0),style:{flex:1,padding:"5px 0",borderRadius:1,fontSize:8,cursor:"pointer",fontFamily:Ko,background:g?"rgba(124,58,237,0.12)":"rgba(255,255,255,0.02)",border:`1px dashed ${g?"rgba(124,58,237,0.35)":"rgba(255,255,255,0.06)"}`,color:g?"rgba(196,181,253,0.80)":"rgba(255,255,255,0.25)",display:"flex",alignItems:"center",justifyContent:"center",gap:4,transition:"all 0.15s",letterSpacing:"0.06em",textTransform:"uppercase"},children:[o.jsx(Iy,{size:9,strokeWidth:1.5})," ",t("N","Node")]}),o.jsxs("select",{value:"",onChange:D=>{const ee=parseInt(D.target.value,10);isNaN(ee)||Or(ee)},style:{...fs,flex:1.4,fontSize:8,padding:"4px 4px"},children:[o.jsx("option",{value:"",children:t("Preset","Preset")}),rk.map((D,ee)=>o.jsx("option",{value:ee,children:D.name},D.name))]})]}),o.jsx(tu,{title:F?t("Dinmica do Mapa","Map Dynamics"):t("Fsica","Physics"),open:ae,onToggle:()=>Re(D=>!D),accent:os,children:(F?wQ:zJ).map(D=>o.jsx(Ji,{label:D.label,value:s[D.key],tooltip:D.tooltip,onChange:ee=>wr(D.key,ee)},D.key))}),W&&o.jsxs(tu,{title:"Espao 3D",open:!0,onToggle:()=>{},accent:"rgba(56,189,248,0.65)",children:[o.jsx("div",{style:{fontSize:8,color:"rgba(255,255,255,0.28)",marginBottom:8,lineHeight:1.6},children:"Drag = rbita  Shift+drag = roll  Scroll = zoom  Dbl-click = reset"}),o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[o.jsx("span",{style:{fontSize:9,color:"rgba(255,255,255,0.45)"},children:"Auto-rotao"}),o.jsx("button",{title:"Auto-rotao",onClick:()=>{const D=!ye.current.autoRotate;ye.current.autoRotate=D,we(ee=>({...ee,autoRotate:D}))},style:{padding:"2px 10px",borderRadius:4,cursor:"pointer",fontSize:8,background:Se.autoRotate?"rgba(56,189,248,0.18)":"rgba(255,255,255,0.03)",border:`1px solid ${Se.autoRotate?"rgba(56,189,248,0.45)":"rgba(255,255,255,0.08)"}`,color:Se.autoRotate?"rgba(56,189,248,0.9)":"rgba(255,255,255,0.3)"},children:Se.autoRotate?"ON":"OFF"})]}),o.jsx(Ji,{label:"Velocidade Rotao",value:Se.autoSpeed/.8,tooltip:"Velocidade da auto-rotao em modo automtico",onChange:D=>{ye.current.autoSpeed=D*.8,we(ee=>({...ee,autoSpeed:D*.8}))}}),o.jsx(Ji,{label:"Campo Visual (FOV)",value:(Se.fov-.2)/1.3,tooltip:"Perspectiva: baixo = teleobjetiva, alto = grande angular",onChange:D=>{const ee=.2+D*1.3;ye.current.fov=ee,we(Ie=>({...Ie,fov:ee}))}}),o.jsx(Ji,{label:"Profundidade Z",value:(Se.zSpread-40)/460,tooltip:"Quo espalhados os ns ficam no eixo de profundidade",onChange:D=>{const ee=40+D*460;ye.current.zSpread=ee,we(Ie=>({...Ie,zSpread:ee}))}}),o.jsx(Ji,{label:"Nvoa de Profundidade",value:Se.fog,tooltip:"Ns distantes ficam mais escuros e transparentes",onChange:D=>{ye.current.fog=D,we(ee=>({...ee,fog:D}))}}),o.jsx("button",{title:"Resetar cmera",onClick:()=>{ye.current={...Nh},we({...Nh})},style:{marginTop:6,width:"100%",padding:"4px 0",borderRadius:4,cursor:"pointer",fontSize:8,letterSpacing:"0.05em",background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",color:"rgba(255,255,255,0.3)"},children:" Resetar cmera"})]}),F&&o.jsxs(tu,{title:"Semntica Visual",open:!0,onToggle:()=>{},accent:"rgba(196,181,253,0.65)",children:[o.jsx("div",{style:{fontSize:8,color:"rgba(255,255,255,0.28)",marginBottom:8,lineHeight:1.6},children:"Como dados da LLM afetam o visual do rizoma."}),o.jsx(Ji,{label:"Relevncia  Tamanho",value:l.relSizeScale,tooltip:"Ns mais relevantes para o tema ficam visualmente maiores",onChange:D=>vn("relSizeScale",D)}),o.jsx(Ji,{label:"Conexes  Tamanho",value:l.connSizeScale,tooltip:"Ns com mais conexes (hubs) crescem mais",onChange:D=>vn("connSizeScale",D)}),o.jsx(Ji,{label:"Relevncia  Distncia",value:l.relDistScale,tooltip:"Ns relevantes ficam mais perto do centro; perifricos se afastam",onChange:D=>vn("relDistScale",D)})]}),o.jsxs(tu,{title:"Esttica",open:Fe,onToggle:()=>Oe(D=>!D),accent:Ho,children:[o.jsxs("div",{style:{marginBottom:10},children:[o.jsx("div",{style:{fontSize:7,color:"rgba(255,255,255,0.22)",letterSpacing:"0.08em",textTransform:"uppercase",marginBottom:6,fontFamily:Ko},children:"Paletas"}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:3},children:mQ.map(D=>o.jsxs("button",{title:D.name,onClick:()=>Gr(D.ae),style:{display:"flex",alignItems:"center",gap:8,width:"100%",padding:"5px 8px",borderRadius:1,cursor:"pointer",border:"1px dashed rgba(255,255,255,0.06)",background:"rgba(255,255,255,0.02)",transition:"all 0.15s",textAlign:"left"},onMouseEnter:ee=>{ee.currentTarget.style.background="rgba(255,255,255,0.06)",ee.currentTarget.style.borderColor="rgba(255,255,255,0.15)"},onMouseLeave:ee=>{ee.currentTarget.style.background="rgba(255,255,255,0.02)",ee.currentTarget.style.borderColor="rgba(255,255,255,0.06)"},children:[o.jsxs("div",{style:{display:"flex",borderRadius:1,overflow:"hidden",flexShrink:0,border:"1px solid rgba(255,255,255,0.10)"},children:[o.jsx("div",{style:{width:10,height:12,background:D.ae.bgColor??"#000"}}),o.jsx("div",{style:{width:10,height:12,background:D.swatch}})]}),o.jsx("span",{style:{fontSize:8,color:"rgba(255,255,255,0.45)",letterSpacing:"0.05em",fontFamily:Ko,textTransform:"uppercase"},children:D.name})]},D.name))})]}),o.jsx(t0,{label:"Background",value:l.bgColor,onChange:D=>vn("bgColor",D)}),o.jsx(t0,{label:"Ns normais",value:l.nodeColor,onChange:D=>vn("nodeColor",D)}),o.jsx(t0,{label:"Entradas",value:l.entryColor,onChange:D=>vn("entryColor",D)}),o.jsx(t0,{label:"Hubs",value:l.hubColor,onChange:D=>vn("hubColor",D)}),o.jsx(t0,{label:"Ns ativos",value:l.hotColor,onChange:D=>vn("hotColor",D)}),o.jsx(t0,{label:"Links",value:l.linkColor,onChange:D=>vn("linkColor",D)}),o.jsx(t0,{label:"Linhas de Fuga",value:l.flightColor,onChange:D=>vn("flightColor",D)}),o.jsx(t0,{label:"Labels",value:l.labelColor,onChange:D=>vn("labelColor",D)}),o.jsxs("div",{style:{marginTop:8},children:[o.jsx(Ji,{label:"Glow",value:l.glowIntensity,onChange:D=>vn("glowIntensity",D)}),o.jsx(Ji,{label:"Tamanho ns",value:l.nodeSize,onChange:D=>vn("nodeSize",D)}),o.jsx(Ji,{label:"Opac. links",value:l.linkOpacity,onChange:D=>vn("linkOpacity",D)}),o.jsx(Ji,{label:"Esp. links",value:l.linkWidth,onChange:D=>vn("linkWidth",D)})]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:6,marginBottom:6},children:[o.jsx("span",{style:{fontSize:10,color:"rgba(255,255,255,0.45)"},children:"Mostrar Labels"}),o.jsx("button",{title:`Labels: ${l.showLabels?"ON":"OFF"}`,onClick:()=>vn("showLabels",!l.showLabels),style:{padding:"3px 8px",borderRadius:3,fontSize:9,cursor:"pointer",background:l.showLabels?"rgba(0,255,102,0.15)":"rgba(255,255,255,0.04)",border:`1px solid ${l.showLabels?"rgba(0,255,102,0.35)":"rgba(255,255,255,0.08)"}`,color:l.showLabels?"rgba(0,255,102,0.85)":"rgba(255,255,255,0.3)"},children:l.showLabels?"ON":"OFF"})]}),l.showLabels&&o.jsx(Ji,{label:"Tamanho labels",value:l.labelSize,onChange:D=>vn("labelSize",D)}),o.jsxs("button",{title:"Exportar PNG",onClick:hn,style:{marginTop:6,width:"100%",padding:"5px 0",borderRadius:4,cursor:"pointer",background:"rgba(255,255,255,0.04)",border:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.5)",fontSize:10,display:"flex",alignItems:"center",justifyContent:"center",gap:5},children:[o.jsx(Vk,{size:10,strokeWidth:1.5}),"Exportar Frame PNG"]})]}),o.jsx(tu,{title:"Gravao",open:ne,onToggle:()=>nt(D=>!D),accent:"rgba(239,68,68,0.55)",children:o.jsx(gQ,{recState:Ut,elapsed:Ke,actualFmt:an,onStart:jr,onStop:_r})}),o.jsxs(tu,{title:"Debug / Mtricas",open:_t,onToggle:()=>Ct(D=>!D),children:[u&&o.jsx("div",{style:{marginBottom:8},children:[{label:"Ns",v:u.nodeCount},{label:"Entradas",v:u.entryCount},{label:"Links longos",v:u.longLinkCount},{label:"Isolados",v:u.isolatedCount},{label:"Grau mdio",v:u.avgDegree.toFixed(2)},{label:"Hubness",v:u.hubness.toFixed(3)}].map(D=>o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:9,color:"rgba(255,255,255,0.32)",marginBottom:3},children:[o.jsx("span",{children:D.label}),o.jsx("span",{style:{fontFamily:"monospace",color:"rgba(255,255,255,0.5)"},children:D.v})]},D.label))}),o.jsxs("button",{title:"Reset",onClick:()=>zt(Ae.current,Tt.current),style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:5,padding:"5px 0",borderRadius:4,cursor:"pointer",background:"rgba(255,255,255,0.04)",border:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.45)",fontSize:10},children:[o.jsx(El,{size:10,strokeWidth:1.5}),"Reset (novo seed)"]})]})]})]}),oe&&o.jsx(yQ,{onClose:()=>te(!1)}),L&&o.jsx(sQ,{node:L,allNodes:((ks=a.current)==null?void 0:ks.nodes)||[],score:Zt.get(L.id),onClose:()=>$(null),onSaveCard:D=>ir(D),onSendToArena:D=>oa(D),onExpand:D=>ja(D)}),_n&&o.jsx(rQ,{onClose:()=>Rn(!1)}),wt&&o.jsx(iQ,{folders:Be,onSelect:D=>{ir(wt.node,D)},onCreateFolder:(D,ee)=>{Zn(D,ee);const Ie=Oi(),Qe=Ie[Ie.length-1];Qe&&ir(wt.node,Qe.id)},onClose:()=>st(null)})]})};function SQ(e,t,n,r=1){const a=t.nodes;if(a.length===0)return;const i=a.filter(c=>c.isEntry).length,s=a.filter(c=>c.connections.size===0&&!c.isEntry).length;e.save(),e.font="9px monospace",e.fillStyle="rgba(255,255,255,0.20)",e.fillText(`nodes:${a.length}  entries:${i}  isolated:${s}`,10,14),e.restore()}const wQ=[{key:"territorializacao",label:"Coeso ao Centro",tooltip:"Quo fortemente os conceitos so puxados de volta ao tema central. Alto = mapa compacto; baixo = conceitos se dispersam livremente."},{key:"linhasDeFuga",label:"Disperso Semntica",tooltip:"Conceitos tangenciais se distanciam do centro. Alto = conceitos perifricos voam para longe; baixo = tudo fica prximo."},{key:"noise",label:"Deriva Conceitual",tooltip:"Quanto os ns derivam aleatoriamente no espao epistmico. Alto = layout mais catico; baixo = posies estveis."},{key:"hubs",label:"Popularidade / Hub",tooltip:"Conceitos populares e muito conectados crescem mais. Alto = figuras centrais dominam visualmente; baixo = igualdade entre ns."},{key:"reterritorializacao",label:"Re-Conexo",tooltip:"Fora que cria novas conexes entre conceitos prximos. Alto = rede densa e interligada; baixo = conexes esparsas."},{key:"esquecimento",label:"Filtragem",tooltip:"Conexes fracas desaparecem com o tempo. Alto = apenas relaes fortes sobrevivem (mapa mais limpo); baixo = acumulo de conexes."},{key:"visibility",label:"Visibilidade"}],wx=Math.PI*2;function MQ(e){const{quanta:t}=e;if(!t.length)return Xv();const n=t.length,r=8,a=new Float32Array(r*r);for(const pe of t){const P=Math.min(r-1,Math.floor(pe.x*r)),V=Math.min(r-1,Math.floor(pe.y*r));a[V*r+P]++}const i=r*r;let s=0,c=0;for(let pe=0;pe<i;pe++)s+=a[pe];const l=s/i;for(let pe=0;pe<i;pe++){const P=a[pe]-l;c+=P*P}const d=Math.min(1,Math.sqrt(c/i)/(n/i+1));let u=0,h=0;for(const pe of t)u+=Math.sin(pe.phase),h+=Math.cos(pe.phase);const m=Math.sqrt(u*u+h*h)/n;let f=0,g=0;for(const pe of t)f+=pe.coherence,g+=pe.coherence*pe.coherence;const x=f/n,v=Math.min(1,Math.sqrt(Math.max(0,g/n-x*x)));let b=0;const w=.5;for(const pe of t)pe.coherence*pe.scribeAffinity>w&&b++;b=b/n;const M=a.slice(0,i/4).reduce((pe,P)=>pe+P,0),k=a.slice(i/4,i/2).reduce((pe,P)=>pe+P,0),R=a.slice(i/2,3*i/4).reduce((pe,P)=>pe+P,0),j=a.slice(3*i/4).reduce((pe,P)=>pe+P,0),I=Math.max(M,k,R,j,1),E=1-(Math.abs(M-j)+Math.abs(k-R))/(2*I);let O=0,L=0;for(const pe of t)O+=pe.vx,L+=pe.vy;const $=(Math.atan2(L/n,O/n)%wx+wx)%wx,F=Math.min(1,e.recentEventCount/20);let B=0;if(e.snapshots.length>=2){const pe=e.snapshots[e.snapshots.length-2],P=e.snapshots[e.snapshots.length-1];pe&&P&&(B=Math.abs(P.syncIndex-pe.syncIndex)+Math.abs(P.coherenceMean-pe.coherenceMean)*.5,B=Math.min(1,B*4))}let W=0,re=0;for(const pe of t)pe.intent<-.2?W++:pe.intent>.2&&re++;const oe=Math.min(1,Math.abs(W-re)/(n*.3)),J=Array.from(a).filter(pe=>pe<.5).length/i;return{densityMean:Math.min(1,l/(n/i)),densityVariance:d,syncIndex:m,coherenceMean:x,coherenceVariance:v,loopCount:b,symmetryIndex:Math.max(0,Math.min(1,E)),polarityAxis:$,eventRate:F,noveltyIndex:B,tensionIndex:oe,silenceIndex:J,slot13:0,slot14:0}}function CQ(e,t){if(!e.length)return Xv();let n=0;const r={syncIndex:0,coherenceMean:0,loopCount:0,eventRate:0};for(let a=0;a<e.length;a++){const i=(a+1)**t,s=e[a];r.syncIndex+=s.syncIndex*i,r.coherenceMean+=s.coherenceMean*i,r.loopCount+=s.loopCount*i,r.eventRate+=s.eventRate*i,n+=i}return n===0?Xv():(r.syncIndex/=n,r.coherenceMean/=n,r.loopCount/=n,r.eventRate/=n,{densityMean:.5,densityVariance:.3,syncIndex:Math.min(1,r.syncIndex),coherenceMean:Math.min(1,r.coherenceMean),coherenceVariance:.2,loopCount:Math.min(1,r.loopCount),symmetryIndex:.5,polarityAxis:0,eventRate:Math.min(1,r.eventRate),noveltyIndex:.3,tensionIndex:.2,silenceIndex:.4,slot13:0,slot14:0})}function Np(e,t){const n=MQ(e);if(t.timeScope<.05)return n;const r=Math.max(1,Math.round(t.timeScope*e.snapshots.length)),a=e.snapshots.slice(-r),i=CQ(a,1.5),s=t.timeScope;return kQ(n,i,s)}function kQ(e,t,n){const r=(a,i)=>a*(1-n)+i*n;return{densityMean:r(e.densityMean,t.densityMean),densityVariance:r(e.densityVariance,t.densityVariance),syncIndex:r(e.syncIndex,t.syncIndex),coherenceMean:r(e.coherenceMean,t.coherenceMean),coherenceVariance:r(e.coherenceVariance,t.coherenceVariance),loopCount:r(e.loopCount,t.loopCount),symmetryIndex:r(e.symmetryIndex,t.symmetryIndex),polarityAxis:e.polarityAxis,eventRate:r(e.eventRate,t.eventRate),noveltyIndex:r(e.noveltyIndex,t.noveltyIndex),tensionIndex:r(e.tensionIndex,t.tensionIndex),silenceIndex:r(e.silenceIndex,t.silenceIndex),slot13:0,slot14:0}}function Xv(){return{densityMean:0,densityVariance:0,syncIndex:0,coherenceMean:0,coherenceVariance:0,loopCount:0,symmetryIndex:.5,polarityAxis:0,eventRate:0,noveltyIndex:0,tensionIndex:0,silenceIndex:1,slot13:0,slot14:0}}const Jv=Math.PI*2,aE=.5,sE=.5,iE=.28,lE=.095,cE=.345,fk=.44,pk=.03;function RQ(e){return function(){e|=0,e=e+1831565813|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}function AQ(e){return e.charge<.2?lE:e.scribeAffinity>.72?cE+(e.scribeAffinity-.72)*.15:iE}function Mx(e){const t=RQ(e.seed^3735884340),n=e.agentCount,r=[];for(let a=0;a<n;a++){const i=t(),s=t(),c=(t()-.5)*2,l=i<.2?lE:s>.72?cE:iE,d=t()*Jv,u=(t()-.5)*.06,h=l+u,m=aE+Math.cos(d)*h,f=sE+Math.sin(d)*h,g=.006+t()*.006,x=c>0?1:-1,v=-Math.sin(d)*g*x,b=Math.cos(d)*g*x;r.push({id:a,x:m,y:f,vx:v,vy:b,phase:t()*Jv,phaseVel:.5+t()*1.5,charge:i,coherence:t()*.3,intent:c,ink:.4+t()*.5,scribeAffinity:s})}return{quanta:r,strokes:[],flowGrid:{w:1,h:1,vx:new Float32Array(1),vy:new Float32Array(1)},tick:0,time:0,snapshots:[],snapshotInterval:2,lastSnapshotTime:0,recentEventCount:0,prevObservables:null}}function jQ(e,t){const n={time:e.time,densityGrid:new Float32Array(256),syncIndex:t.syncIndex,coherenceMean:t.coherenceMean,loopCount:t.loopCount,eventRate:t.eventRate};for(const r of e.quanta){const a=Math.min(15,Math.floor(r.x*16)),i=Math.min(15,Math.floor(r.y*16));n.densityGrid[i*16+a]++}e.snapshots.push(n),e.snapshots.length>60&&e.snapshots.shift(),e.lastSnapshotTime=e.time}function EQ(e,t,n,r){n=Math.min(n,.04),e.time+=n,e.tick++;const{quanta:a}=e,i=n*60,s=.55+t.loopThreshold*.3,c=t.dance*.007,l=t.entrainment,d=16,u=new Array(d*d).fill(null).map(()=>[]);for(const m of a){const f=Math.min(d-1,Math.max(0,Math.floor(m.x*d))),g=Math.min(d-1,Math.max(0,Math.floor(m.y*d)));u[g*d+f].push(m)}function h(m,f){const g=Math.ceil(f*d)+1,x=Math.max(0,Math.floor(m.x*d)-g),v=Math.min(d-1,Math.floor(m.x*d)+g),b=Math.max(0,Math.floor(m.y*d)-g),w=Math.min(d-1,Math.floor(m.y*d)+g),M=[];for(let k=b;k<=w;k++)for(let R=x;R<=v;R++)for(const j of u[k*d+R]){if(j===m)continue;const I=j.x-m.x,E=j.y-m.y;I*I+E*E<f*f&&M.push(j)}return M}for(const m of r)if(!(m.duration<=0)){m.duration-=n;for(const f of a){const g=f.x-m.targetX,x=f.y-m.targetY,v=g*g+x*x;if(v>m.radius*m.radius)continue;const b=(1-Math.sqrt(v)/m.radius)*m.strength*n;switch(m.kind){case"CONVERGE":f.intent=Math.max(-1,f.intent-b*3),f.coherence=Math.min(1,f.coherence+b*2),f.vx-=g*b*4,f.vy-=x*b*4;break;case"DIVERGE":f.intent=Math.min(1,f.intent+b*3),f.coherence=Math.max(0,f.coherence-b*2),f.vx+=g*b*3,f.vy+=x*b*3;break;case"SILENCE":f.vx*=1-b*4,f.vy*=1-b*4,f.ink=Math.max(0,f.ink-b*2);break;case"AMPLIFY":f.ink=Math.min(1,f.ink+b*3),f.scribeAffinity=Math.min(1,f.scribeAffinity+b*2);break;case"CUT":{const w=Math.sqrt(v)+1e-5;v<m.radius*.3*(m.radius*.3)&&(f.vx+=g/w*b*5,f.vy+=x/w*b*5);break}}}}for(const m of a){m.phase=(m.phase+m.phaseVel*n*(.6+t.dance*1.4))%Jv;const f=m.x-aE,g=m.y-sE,x=Math.sqrt(f*f+g*g)+1e-7,v=Math.atan2(g,f),b=Math.sin(e.time*1.2+v*2)*.012+Math.sin(e.time*.7+v*3+m.phase)*.006+Math.sin(e.time*2.1+m.id*.3)*.004,w=f/x,M=g/x,k=-M,R=w,j=AQ(m)+b,E=-(x-j)*s*(.7+.3*Math.cos(e.time*.5+m.id*.1));m.vx+=w*E*i,m.vy+=M*E*i;const O=m.intent<0?1:-.4+m.scribeAffinity*.6,L=1+Math.sin(e.time*.8+v*1.5)*t.dance*.4,$=c*(.4+m.coherence*.6)*L;m.vx+=k*$*O*i,m.vy+=R*$*O*i;const F=h(m,.1);if(F.length>0){let re=0,oe=0;for(const P of F)re+=Math.sin(P.phase),oe+=Math.cos(P.phase);const J=Math.atan2(re/F.length,oe/F.length)-m.phase,pe=Math.cos(J);m.phase+=J*l*n*.9,m.coherence=Math.min(1,m.coherence+(pe>.55?.025:-.012)*n*5);for(const P of F){const V=P.x-m.x,fe=P.y-m.y,ye=Math.sqrt(V*V+fe*fe)+1e-6,we=Math.cos(P.phase-m.phase)*8e-4*(1+m.coherence)*t.dance;ye>.012&&ye<.08&&(m.vx+=V/ye*we*i,m.vy+=fe/ye*we*i),ye<.015&&(m.vx-=V/ye*.0015*i,m.vy-=fe/ye*.0015*i)}}else m.coherence=Math.max(0,m.coherence-.008*n);if(x>fk){const re=(x-fk)*.6;m.vx-=w*re*i,m.vy-=M*re*i}if(x<pk){const re=(pk-x)*.5;m.vx+=w*re*i,m.vy+=M*re*i}m.scribeAffinity>.78&&x>j*.85&&Math.sin(m.phase*3)>.85&&(m.vx+=w*.003*m.scribeAffinity*i,m.vy+=M*.003*m.scribeAffinity*i);const B=Math.sqrt(m.vx*m.vx+m.vy*m.vy),W=.022;B>W&&(m.vx=m.vx/B*W,m.vy=m.vy/B*W),m.vx*=.984,m.vy*=.984,m.x=Math.max(.02,Math.min(.98,m.x+m.vx*i)),m.y=Math.max(.02,Math.min(.98,m.y+m.vy*i)),m.ink=Math.min(1,m.ink+.025*n)}if(e.time-e.lastSnapshotTime>=e.snapshotInterval){const m=Np(e,t);jQ(e,m)}}function TQ(e,t){let n=null,r=null;try{n=new OffscreenCanvas(e,t),r=n.getContext("2d",{alpha:!0})}catch{}return{offscreen:n,offCtx:r,width:e,height:t,lastFadeTime:0}}function IQ(e,t,n){const{quanta:r}=e,a=60-t.inkDecay*30,i=[];for(const s of e.strokes)s.age+=n,s.alpha=Math.max(0,1-s.age/s.maxAge),s.age<s.maxAge&&i.push(s);e.strokes=i;for(const s of r){const c=s.coherence*s.scribeAffinity;if(c<.35||s.ink<.25||Math.random()>c*.04*n*60)continue;const l=3+Math.floor(c*8),d=[{x:s.x,y:s.y}];let u=s.x,h=s.y;for(let m=1;m<l;m++)u+=s.vx*.6/60,h+=s.vy*.6/60,d.push({x:(u%1+1)%1,y:(h%1+1)%1});e.strokes.push({points:d,thickness:1.5+c*3.5,alpha:.6+s.ink*.35,age:0,maxAge:a*(.7+s.scribeAffinity*.3)}),s.ink=Math.max(0,s.ink-.06*c)}e.strokes.length>800&&(e.strokes=e.strokes.slice(e.strokes.length-800))}const nu=Math.PI*2;function PQ(e){let t=2166136261;for(const n of e){const r=Math.round(n*100);t^=r,t=t*16777619>>>0}return t.toString(16).padStart(8,"0")}function Vl(e){return e=e^e<<13,e=e^e>>7,e=e^e<<17,(e>>>0)/4294967296}function ru(e,t){return Math.round(Math.max(0,Math.min(1,e))*t)/t}function FQ(e,t,n,r=""){const a=ru(e.syncIndex,10),i=ru(e.coherenceMean,8),s=ru(e.loopCount,8),c=ru(e.symmetryIndex,6),l=ru(e.tensionIndex,6),d=ru(e.noveltyIndex,6),u=ru(e.densityMean,8),h=Math.round(e.polarityAxis/nu*8)/8,m=[a,i,s,c,l,d,u,h],f=PQ(m),g=`glyph_${f}_${r||Date.now()}`,x=.7+a*.2,v=t==="heptapod"||t==="recursive"?.07+i*.09:.05+u*.07,b=Math.max(0,e.tensionIndex*.4+e.noveltyIndex*.2),w={radius:x,thickness:v,roughness:b};let M;t==="recursive"?M=2+Math.round(s*3+c*2):M=1+Math.round(s*2);const k=[];for(let F=0;F<M;F++){let B;t==="recursive"?B=Math.pow(.618033988749895,F+1):B=(F+1)/(M+1),k.push({radius:x*(.15+B*.55),thickness:v*(.5+F*.1),phaseOffset:t==="recursive"?Vl(m[F%m.length]*1e3+F)*nu+F*Math.PI*.382:Vl(m[F%m.length]*1e3+F)*nu})}let R;t==="heptapod"||t==="recursive"?R=1+Math.round(l*1):R=Math.round((l+d)*.5*3);const j=[];for(let F=0;F<Math.min(3,R);F++){const B=F/Math.max(1,R)*nu,W=(Vl(m[5]*1e3+F*77)-.5)*.5;j.push({angle:B+W,depth:.4+l*.5,width:.18+Vl(F*113)*.14})}let I;t==="linear"?I=0:t==="recursive"?I=Math.round(c*5+2):t==="heptapod"?I=Math.round(c*3+1):I=Math.round(e.eventRate*4);const E=[];for(let F=0;F<I;F++){const B=F/I*nu+Vl(F*200)*.5,W=t==="recursive"?.15+Vl(F*300+1)*1.2:.3+Vl(F*300+1)*.8;E.push({startAngle:B,endAngle:B+W,radius:x*(t==="recursive"?.2+Vl(F*400)*.65:.5+Vl(F*400)*.35),thickness:v*.6})}const O=Math.round(t==="heptapod"||t==="recursive"?(1-e.silenceIndex)*e.densityMean*6:e.densityMean*3),L=[];for(let F=0;F<Math.min(6,O);F++)L.push({angle:F/Math.max(1,O)*nu+Vl(F*500)*nu*.3,radius:.3+Vl(F*600)*.55,size:.4+e.densityMean*.6,alpha:.4+e.coherenceMean*.5});const $={angle:e.polarityAxis,strength:Math.min(1,e.syncIndex*1.5)};return{outerRing:w,innerRings:k,notches:j,arcs:E,blots:L,axis:$,signatureHash:f,observables:e,timestamp:n,id:g}}const M0=Math.PI*2;function p5(e,t,n,r){return e<.33?t:e<.67?n:r}function _Q(e){const t=Math.round((e%M0+M0)%M0/M0*8)%8;return["E","NE","N","NW","W","SW","S","SE"][t]}function NQ(e){return e<.4?"low":e<.7?"med":"high"}function dE(e){const t=e.observables,n=1+e.innerRings.length,r=e.notches.length,a=e.arcs.length,i=e.blots.length,s=NQ(t.symmetryIndex),c=_Q(t.polarityAxis),l=p5(t.densityMean,"sparse","normal","dense"),d=p5(t.coherenceMean,"chaos","mixed","coherent"),u=p5(t.tensionIndex,"calm","mid","tense"),h=p5(t.noveltyIndex,"stale","shifting","novel"),m=[`R${n}`,...r>0?[`N${r}`]:[],...a>0?[`A${a}`]:[],...i>0?[`B${i}`]:[],`SYM_${s.toUpperCase()}`,`AX_${c}`,`DEN_${l.toUpperCase()}`,`COH_${d.toUpperCase()}`,`TEN_${u.toUpperCase()}`,`NOV_${h.toUpperCase()}`],f=[n/4,r/5,a/4,i/6,t.symmetryIndex,(t.polarityAxis%M0+M0)%M0/M0,t.densityMean,t.coherenceMean,t.tensionIndex,t.noveltyIndex,t.syncIndex,t.loopCount,t.silenceIndex,t.eventRate];return{ringCount:n,notchCount:r,arcCount:a,blotCount:i,symmetryBin:s,axisBin:c,densityBin:l,coherenceBin:d,tensionBin:u,noveltyBin:h,tokens:m,embedding:f}}function OQ(e,t){if(e.length!==t.length)return 0;let n=0,r=0,a=0;for(let i=0;i<e.length;i++)n+=e[i]*t[i],r+=e[i]*e[i],a+=t[i]*t[i];return n/(Math.sqrt(r)*Math.sqrt(a)+1e-8)}function DQ(e){const t=new Set(e);return t.has("COH_COHERENT")&&t.has("SYM_HIGH")?"CONVERGE":t.has("COH_CHAOS")||t.has("TEN_TENSE")?"DIVERGE":t.has("DEN_SPARSE")&&t.has("NOV_STALE")?"SILENCE":t.has("DEN_DENSE")&&t.has("COH_COHERENT")?"AMPLIFY":t.has("N3")||t.has("N4")||t.has("N5")?"CUT":"CONVERGE"}function LQ(e,t,n,r){const a=dE(e),i=DQ(a.tokens),s=r.speakIntensity,c=.12+s*.18+a.ringCount*.02,l=2+s*6+a.arcCount*.5;return{glyphId:e.id,kind:i,strength:.3+s*.7,radius:c,duration:l,targetX:t,targetY:n,timestamp:Date.now()}}const mk={CONVERGE:{label:"UNIR",color:"#60c0ff",desc:"Alinha fases, favorece loops e sincronizao"},DIVERGE:{label:"DISPERSAR",color:"#ff6060",desc:"Fragmenta, repele, reduz coerncia"},SILENCE:{label:"SILENCIAR",color:"#80ff80",desc:"Acalma velocidades, reduz depsito de tinta"},AMPLIFY:{label:"AMPLIFICAR",color:"#ffd060",desc:"Intensifica escrita e tinta, aumenta loops"},CUT:{label:"CORTAR",color:"#ff80ff",desc:"Cria fronteira local por tempo limitado"}};function zQ(e,t){const n=t.filter(i=>i.status==="accepted").length,r=t.length>0?n/t.length:0,a=t.length>0?t.reduce((i,s)=>i+s.confidence,0)/t.length:0;return{sync:e.syncIndex,coherence:e.coherenceMean,novelty:e.noveltyIndex,loopDensity:e.loopCount,lexiconHealth:r,lexiconSize:t.length,avgConfidence:a}}const uE=[{id:"first_contact",name:"First Contact",emoji:"",description:"Anel limpo e estvel. Glifos bem formados. LLM ativo.",params:{agentCount:720,seed:127473,timeScope:.12,dance:.42,entrainment:.72,inkDecay:.25,loopThreshold:.86,speakIntensity:.65,dictionaryMode:"heptapod",llmAutoRefine:!0,preset:"first_contact"}},{id:"two_rings",name:"Two Rings",emoji:"",description:"Dois anis concntricos visveis  leitura no-linear.",params:{agentCount:600,seed:41651,timeScope:.2,dance:.34,entrainment:.62,inkDecay:.2,loopThreshold:.78,speakIntensity:.55,dictionaryMode:"heptapod",llmAutoRefine:!0,preset:"two_rings"}},{id:"glossolalia",name:"Glossolalia",emoji:"",description:"Muitos glifos  anel turb, splatters frequentes, lxico cresce rpido.",params:{agentCount:900,seed:24837,timeScope:.22,dance:.6,entrainment:.3,inkDecay:.55,loopThreshold:.5,speakIntensity:.72,dictionaryMode:"experimental",llmAutoRefine:!1,preset:"glossolalia"}},{id:"true_names",name:"True Names",emoji:"",description:"Anel denso e imvel. Poucos glifos nicos, Speak potente.",params:{agentCount:480,seed:30583,timeScope:.05,dance:.2,entrainment:.9,inkDecay:.15,loopThreshold:.92,speakIntensity:.95,dictionaryMode:"heptapod",llmAutoRefine:!0,preset:"true_names"}},{id:"nonlinear_time",name:"Nonlinear Time",emoji:"",description:"TimeScope alto  anel holstico, glifos estveis e cclicos.",params:{agentCount:650,seed:61680,timeScope:.78,dance:.44,entrainment:.54,inkDecay:.12,loopThreshold:.68,speakIntensity:.5,dictionaryMode:"heptapod",llmAutoRefine:!1,preset:"nonlinear_time"}}],Cx=uE[0].params,xa=Math.PI*2;function ya(e){const t=Math.sin(e*9301+49297)*233280;return t-Math.floor(t)}function hE(e,t){const n=(e%xa+xa)%xa;for(const r of t){const a=(r.angle%xa+xa)%xa,i=r.width*.22;if(Math.abs((n-a+Math.PI*3)%xa-Math.PI)<i)return!0}return!1}function fE(e,t,n){let r=1;r+=.2*Math.sin(e*xa*3+t*.011),r+=.12*Math.sin(e*xa*5+t*.023),r+=.07*Math.sin(e*xa*8+t*.037);for(const a of n){const i=(a.angle%xa+xa)%xa,s=e*xa,c=Math.abs((s-i+Math.PI*3)%xa-Math.PI);if(c<a.width*2.5){const l=c/(a.width*2.5);r*=.18+.82*l}}return Math.max(.05,r)}function gk(e,t,n,r,a,i,s,c=!1){if(r<=1)return;const l=c?60:r<40?100:r<80?160:220,d=r*.105,u=c?[{widthMult:1,alpha:.88,rOff:0}]:[{widthMult:2,alpha:.09,rOff:1.2},{widthMult:1.35,alpha:.22,rOff:.4},{widthMult:1,alpha:.91,rOff:0},{widthMult:.45,alpha:.52,rOff:-.5}];for(const h of u)for(let m=0;m<l;m++){const f=m/l,g=(m+1)/l,x=f*xa-Math.PI/2,v=g*xa-Math.PI/2;if(hE(x,a))continue;const b=fE(f,s,a),w=s+m*7+h.rOff*1e3,M=s+(m+1)*7+h.rOff*1e3,k=i>.01?(ya(w)-.5)*i*r*.14:0,R=i>.01?(ya(M)-.5)*i*r*.14:0,j=Math.max(.1,r+h.rOff+k),I=Math.max(.1,r+h.rOff+R);e.beginPath(),e.moveTo(t+Math.cos(x)*j,n+Math.sin(x)*j),e.lineTo(t+Math.cos(v)*I,n+Math.sin(v)*I),e.lineWidth=Math.max(.5,d*h.widthMult*b),e.strokeStyle=`rgba(8,5,2,${h.alpha})`,e.lineCap="round",e.stroke()}}function BQ(e,t,n,r,a,i){const s=r*(.14+ya(i)*.18),c=Math.max(.5,s*(.28+ya(i+1)*.22));e.beginPath(),e.arc(t,n,c,0,xa),e.fillStyle="rgba(6,4,2,0.96)",e.fill();for(let d=0;d<4;d++){const u=a+(ya(i+d*3+10)-.5)*Math.PI*.6,h=c*(.35+ya(i+d*3+11)*.55),m=Math.max(.4,c*(.35+ya(i+d*3+12)*.65));e.beginPath(),e.arc(t+Math.cos(u)*h,n+Math.sin(u)*h,m,0,xa),e.fillStyle=`rgba(6,4,2,${.72+ya(i+d*3+13)*.24})`,e.fill()}const l=3+Math.floor(ya(i+2)*6);for(let d=0;d<l;d++){const h=ya(i+d*7+20)>.18?a:a+Math.PI,m=(ya(i+d*7+21)-.5)*Math.PI*.9,f=h+m,g=s*(.7+ya(i+d*7+22)*2.8),x=Math.max(.4,s*(.035+ya(i+d*7+23)*.1)),v=.5+ya(i+d*7+24)*.46,b=(ya(i+d*7+25)-.5)*.8,w=g*(.3+ya(i+d*7+26)*.35),M=t+Math.cos(f+b)*w,k=n+Math.sin(f+b)*w,R=t+Math.cos(f)*g,j=n+Math.sin(f)*g;e.beginPath(),e.moveTo(t,n),e.quadraticCurveTo(M,k,R,j),e.lineWidth=x,e.strokeStyle=`rgba(6,4,2,${v})`,e.lineCap="round",e.stroke();const I=Math.max(.3,x*(1+ya(i+d*7+27)*1.8));if(e.beginPath(),e.arc(R,j,I,0,xa),e.fillStyle=`rgba(6,4,2,${v*.88})`,e.fill(),g>s*.85&&ya(i+d*7+28)>.42){const E=1+Math.floor(ya(i+d*7+29)*2);for(let O=0;O<E;O++){const L=.42+ya(i+d*7+O*31+30)*.38,$=1-L,F=$*$*t+2*$*L*M+L*L*R,B=$*$*n+2*$*L*k+L*L*j,W=f+(ya(i+d*7+O*31+31)-.5)*Math.PI*.75,re=g*(.14+ya(i+d*7+O*31+32)*.32);e.beginPath(),e.moveTo(F,B),e.lineTo(F+Math.cos(W)*re,B+Math.sin(W)*re),e.lineWidth=Math.max(.3,x*.55),e.strokeStyle=`rgba(6,4,2,${v*.65})`,e.stroke()}}}}function yk(e,t,n,r,a,i,s,c){if(r<=1)return;const l=r<40?100:r<80?160:220,d=r*.105,u=[{widthMult:2,alpha:.07,rOff:1.5},{widthMult:1.35,alpha:.18,rOff:.6},{widthMult:1,alpha:.88,rOff:0},{widthMult:.45,alpha:.45,rOff:-.6}];for(const h of u)for(let m=0;m<l;m++){const f=m/l,g=(m+1)/l,x=f*xa-Math.PI/2,v=g*xa-Math.PI/2;if(hE(x,a))continue;const b=fE(f,s,a),w=c*1.8+s*.001,M=.85+.15*Math.sin(x*3+w)+.1*Math.sin(x*5-w*.7)+.05*Math.sin(x*8+w*1.3),k=Math.sin(c*.9+x*2)*r*.015+Math.sin(c*1.7+x*4)*r*.008,R=s+m*7+h.rOff*1e3,j=s+(m+1)*7+h.rOff*1e3,I=i>.01?(ya(R)-.5)*i*r*.14:0,E=i>.01?(ya(j)-.5)*i*r*.14:0,O=Math.max(.1,r+h.rOff+I+k),L=Math.max(.1,r+h.rOff+E+k);e.beginPath(),e.moveTo(t+Math.cos(x)*O,n+Math.sin(x)*O),e.lineTo(t+Math.cos(v)*L,n+Math.sin(v)*L),e.lineWidth=Math.max(.5,d*h.widthMult*b*M),e.strokeStyle=`rgba(8,5,2,${h.alpha*M})`,e.lineCap="round",e.stroke()}}function qu(e,t,n,r,a,i={}){if(a<=2)return;const{alpha:s=1,skipBackground:c=!1,fast:l=a<32,animated:d=!1,time:u=0}=i,h=(parseInt(t.signatureHash.slice(0,8),16)||1)>>>0,m=Math.max(2,a*Math.max(.55,t.outerRing.radius));if(e.save(),e.globalAlpha=s,c||(e.beginPath(),e.arc(n,r,a*1.08,0,xa),e.fillStyle="rgba(250,248,244,0.97)",e.fill(),l||(e.beginPath(),e.arc(n,r,a*1.08,0,xa),e.strokeStyle="rgba(190,180,165,0.25)",e.lineWidth=.8,e.stroke())),d&&!l?yk(e,n,r,m,t.notches,t.outerRing.roughness,h,u):gk(e,n,r,m,t.notches,t.outerRing.roughness,h,l),!l&&t.innerRings.length>0)for(let g=0;g<t.innerRings.length;g++){const x=t.innerRings[g],v=Math.max(2,a*Math.max(.2,x.radius)),b=d?u*.5*(g%2===0?1:-1)+x.phaseOffset:x.phaseOffset;e.save(),e.translate(n,r),e.rotate(b),e.translate(-n,-r),d?yk(e,n,r,v,[],t.outerRing.roughness*.5,h+g*999+7777,u):gk(e,n,r,v,[],t.outerRing.roughness*.5,h+g*999+7777,!1),e.restore()}const f=l?Math.min(1,t.notches.length):t.notches.length;for(let g=0;g<f;g++){const v=t.notches[g].angle+(d?Math.sin(u*.6+g*1.2)*.06:0),b=m+(d?Math.sin(u*1.1+g)*a*.02:0),w=n+Math.cos(v)*b,M=r+Math.sin(v)*b;BQ(e,w,M,a,v,h+g*4001)}e.restore()}function $Q({spec:e,lexEntry:t,selected:n,onClick:r,onSpeak:a}){const i=S.useRef(null),s=S.useRef(0),c=S.useRef(0),l=54;S.useEffect(()=>{let h=!0;const m=()=>{if(!h)return;const f=i.current;if(f){const g=f.getContext("2d");g&&(g.clearRect(0,0,l,l),c.current+=.016,qu(g,e,l/2,l/2,l*.44,{alpha:.96,animated:n,time:c.current}))}s.current=requestAnimationFrame(m)};return m(),()=>{h=!1,cancelAnimationFrame(s.current)}},[e,n]);const d=(t==null?void 0:t.confidence)??0,u=d>.7?"#2a9a50":d>.4?"#b07a10":"#aa3020";return o.jsxs("div",{title:t?`${t.gloss}  conf ${Math.round(d*100)}%`:e.signatureHash.slice(0,8),style:{position:"relative",cursor:"pointer",flexShrink:0,borderRadius:6,border:n?"2px solid rgba(40,30,20,0.6)":"1px solid rgba(180,170,155,0.45)",overflow:"hidden",background:"rgba(250,248,244,0.97)",transition:"border-color 0.2s, transform 0.15s",transform:n?"scale(1.07)":"scale(1)"},onClick:r,onDoubleClick:a,children:[o.jsx("div",{style:{filter:"none"},children:o.jsx("canvas",{ref:i,width:l,height:l,style:{display:"block"}})}),t&&o.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,background:"rgba(248,244,238,0.88)",fontSize:7,color:"rgba(40,30,20,0.7)",textAlign:"center",padding:"1px 2px",letterSpacing:"0.05em",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},children:t.gloss}),o.jsx("div",{style:{position:"absolute",top:3,right:3,width:4,height:4,borderRadius:"50%",background:t?u:"rgba(100,90,80,0.2)"}})]})}function qQ({glyphs:e,lexicon:t,selectedId:n,onSelect:r,onSpeak:a}){const i=new Map(t.map(s=>[s.signatureHash,s]));return o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"6px 10px",borderTop:"1px solid rgba(160,150,135,0.2)",overflowX:"auto",overflowY:"hidden",scrollbarWidth:"thin",scrollbarColor:"rgba(100,80,60,0.2) transparent",minHeight:70,background:"rgba(248,245,240,0.97)"},children:[o.jsx("div",{style:{fontSize:7,color:"rgba(100,85,65,0.45)",letterSpacing:"0.15em",textTransform:"uppercase",flexShrink:0,paddingRight:4,writingMode:"vertical-rl"},children:"STREAM"}),e.length===0&&o.jsx("div",{style:{fontSize:9,color:"rgba(100,85,65,0.4)",letterSpacing:"0.1em",padding:"0 10px"},children:"aguardando glifos..."}),[...e].reverse().map(s=>o.jsx($Q,{spec:s,lexEntry:i.get(s.signatureHash),selected:n===s.id,onClick:()=>r(s),onSpeak:()=>a(s)},s.id))]})}function HQ({spec:e,size:t=140}){const n=S.useRef(null),r=S.useRef(0),a=S.useRef(0);return S.useEffect(()=>{let i=!0;const s=()=>{if(!i)return;const c=n.current;if(c){const l=c.getContext("2d");l&&(l.clearRect(0,0,t,t),a.current+=.016,qu(l,e,t/2,t/2,t*.46,{alpha:.96,animated:!0,time:a.current}))}r.current=requestAnimationFrame(s)};return s(),()=>{i=!1,cancelAnimationFrame(r.current)}},[e,t]),o.jsx("canvas",{ref:n,width:t,height:t,style:{display:"block",borderRadius:8,boxShadow:"0 2px 12px rgba(0,0,0,0.25)"}})}function WQ({spec:e,entry:t,allEntries:n,llmLoading:r,onAskLLM:a,onAccept:i,onEdit:s,onLink:c,onClose:l,onSpeak:d}){const[u,h]=S.useState(null),[m,f]=S.useState(""),[g,x]=S.useState(""),[v,b]=S.useState(!1),w={position:"absolute",top:60,right:8,zIndex:30,width:280,background:"rgba(8,6,20,0.97)",border:"1px solid rgba(160,80,255,0.25)",borderRadius:10,padding:14,fontFamily:"system-ui, sans-serif",color:"rgba(230,220,210,0.9)",backdropFilter:"blur(12px)",boxShadow:"0 4px 32px rgba(0,0,0,0.6)",maxHeight:"calc(100vh - 140px)",overflowY:"auto"},M={fontSize:8,letterSpacing:"0.14em",textTransform:"uppercase",color:"rgba(160,80,255,0.7)",marginBottom:2},k={fontSize:11,color:"rgba(235,225,210,0.85)",marginBottom:10,lineHeight:1.5},R=(t==null?void 0:t.confidence)??0,j=Math.round(R*100),I=R>.7?"#80ff80":R>.4?"#ffd060":"#ff8060",E=g.length>0?n.filter(O=>O.gloss.toLowerCase().includes(g.toLowerCase())&&O.glyphId!==e.id).slice(0,5):[];return o.jsxs("div",{style:w,children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:12},children:[o.jsxs("div",{children:[o.jsxs("div",{style:{fontSize:7,color:"rgba(160,80,255,0.5)",letterSpacing:"0.12em"},children:["HEPTAPOD  ",e.signatureHash.slice(0,8)]}),o.jsx("div",{style:{fontSize:15,color:"rgba(242,232,215,0.95)",marginTop:2},children:(t==null?void 0:t.gloss)??""}),t&&o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,marginTop:3},children:[o.jsx("div",{style:{width:5,height:5,borderRadius:"50%",background:I}}),o.jsxs("span",{style:{fontSize:8,color:I},children:[j,"% conf"]}),t.status==="accepted"&&o.jsx(G5,{size:9,color:"#80ff80"}),t.needs_verification&&o.jsx(Bu,{size:9,color:"#ffd060"})]})]}),o.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center"},children:[o.jsx("button",{onClick:()=>d(e),style:{fontSize:8,padding:"3px 8px",borderRadius:5,cursor:"pointer",background:"rgba(160,80,255,0.15)",border:"1px solid rgba(160,80,255,0.3)",color:"rgba(200,160,255,0.9)",letterSpacing:"0.1em"},children:"SPEAK"}),o.jsx("button",{onClick:l,style:{background:"none",border:"none",cursor:"pointer",color:"rgba(255,255,255,0.3)"},children:o.jsx(Cs,{size:12})})]})]}),o.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:12},children:o.jsx(HQ,{spec:e,size:130})}),o.jsx("div",{style:M,children:"Tokens"}),o.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:3,marginBottom:10},children:[e.observables&&((t==null?void 0:t.tokens)??[]).map(O=>o.jsx("span",{style:{fontSize:8,padding:"1px 5px",borderRadius:3,background:"rgba(160,80,255,0.12)",border:"1px solid rgba(160,80,255,0.2)",color:"rgba(200,170,255,0.8)"},children:O},O)),!t&&e.id&&o.jsx("span",{style:{fontSize:8,color:"rgba(255,255,255,0.25)"},children:"sem verbete ainda"})]}),t&&o.jsxs(o.Fragment,{children:[o.jsx("div",{style:M,children:"Definio"}),u==="definition"?o.jsx("textarea",{value:m,onChange:O=>f(O.target.value),onBlur:()=>{s(e.id,"definition",m),h(null)},autoFocus:!0,style:{width:"100%",fontSize:10,background:"rgba(0,0,0,0.5)",border:"1px solid rgba(160,80,255,0.3)",color:"rgba(235,225,210,0.9)",borderRadius:4,padding:4,resize:"vertical",minHeight:50}}):o.jsx("div",{style:k,onClick:()=>{h("definition"),f(t.definition)},children:t.definition||""}),o.jsx("div",{style:M,children:"Uso"}),o.jsx("div",{style:k,children:t.usage||""}),t.contrasts.length>0&&o.jsxs(o.Fragment,{children:[o.jsx("div",{style:M,children:"Contrasta com"}),o.jsx("div",{style:{...k,display:"flex",flexWrap:"wrap",gap:3},children:t.contrasts.map(O=>o.jsx("span",{style:{fontSize:9,padding:"1px 5px",borderRadius:3,background:"rgba(255,80,60,0.1)",border:"1px solid rgba(255,80,60,0.2)",color:"rgba(255,140,120,0.8)"},children:O},O))})]}),t.examples.length>0&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{style:M,children:["Ocorrncias (",t.frequency,")"]}),o.jsx("div",{style:{fontSize:9,color:"rgba(200,190,180,0.6)",marginBottom:10},children:t.examples.slice(-3).map((O,L)=>o.jsxs("div",{children:[" ",new Date(O.timestamp).toLocaleTimeString()]},L))})]}),t.tags.length>0&&o.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:3,marginBottom:10},children:t.tags.map(O=>o.jsxs("span",{style:{fontSize:7,padding:"1px 5px",borderRadius:3,background:"rgba(60,160,255,0.1)",border:"1px solid rgba(60,160,255,0.2)",color:"rgba(120,180,255,0.7)"},children:["#",O]},O))})]}),o.jsxs("div",{style:{display:"flex",gap:5,flexWrap:"wrap",marginTop:4},children:[o.jsxs("button",{onClick:()=>a(e,t),disabled:r,style:{flex:1,fontSize:8,padding:"4px 6px",borderRadius:5,cursor:r?"wait":"pointer",background:r?"rgba(160,80,255,0.05)":"rgba(160,80,255,0.14)",border:"1px solid rgba(160,80,255,0.3)",color:"rgba(200,160,255,0.9)",display:"flex",alignItems:"center",justifyContent:"center",gap:4,opacity:r?.5:1},children:[o.jsx(ic,{size:9}),r?"Pensando":"Ask LLM"]}),t&&o.jsxs(o.Fragment,{children:[o.jsxs("button",{onClick:()=>i(e.id),style:{fontSize:8,padding:"4px 7px",borderRadius:5,cursor:"pointer",background:t.status==="accepted"?"rgba(80,200,80,0.15)":"rgba(255,255,255,0.06)",border:"1px solid rgba(80,200,80,0.25)",color:"rgba(140,220,140,0.9)",display:"flex",alignItems:"center",gap:3},children:[o.jsx(G5,{size:9}),t.status==="accepted"?"Aceito":"Aceitar"]}),o.jsxs("button",{onClick:()=>b(!v),style:{fontSize:8,padding:"4px 7px",borderRadius:5,cursor:"pointer",background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.1)",color:"rgba(200,200,200,0.8)",display:"flex",alignItems:"center",gap:3},children:[o.jsx(Qk,{size:9}),"Link"]})]})]}),v&&o.jsxs("div",{style:{marginTop:8},children:[o.jsx("input",{value:g,onChange:O=>x(O.target.value),placeholder:"buscar gloss",style:{width:"100%",fontSize:9,padding:"3px 6px",borderRadius:4,boxSizing:"border-box",background:"rgba(0,0,0,0.5)",border:"1px solid rgba(160,80,255,0.2)",color:"rgba(235,225,210,0.85)",outline:"none"}}),E.map(O=>o.jsx("div",{onClick:()=>{c(e.id,O.gloss),b(!1),x("")},style:{padding:"4px 6px",cursor:"pointer",fontSize:9,color:"rgba(200,190,180,0.8)",borderBottom:"1px solid rgba(255,255,255,0.04)"},children:O.gloss},O.glyphId))]})]})}const pE="heptapod_lexicon_v1",GQ="heptapod_sessions_v1";function ou(e){try{localStorage.setItem(pE,JSON.stringify(e))}catch{}}function VQ(){try{const e=localStorage.getItem(pE);return e?JSON.parse(e):[]}catch{return[]}}function UQ(){try{const e=localStorage.getItem(GQ);return e?JSON.parse(e):[]}catch{return[]}}function YQ(e,t){const n={version:1,exportedAt:new Date().toISOString(),lexicon:e,sessions:t},r=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),a=URL.createObjectURL(r),i=document.createElement("a");i.href=a,i.download=`heptapod_grimoire_${Date.now()}.json`,i.click(),URL.revokeObjectURL(a)}function KQ(e,t,n){const r=new FileReader;r.onload=a=>{var i;try{const s=JSON.parse((i=a.target)==null?void 0:i.result);if(!Array.isArray(s.lexicon))throw new Error("Invalid format");t(s)}catch(s){n(s.message)}},r.readAsText(e)}function bk(e,t){const n=e.findIndex(r=>r.glyphId===t.glyphId);if(n>=0){const r=[...e];return r[n]={...r[n],...t,lastUpdated:Date.now()},r}return[...e,{...t,lastUpdated:Date.now()}]}function XQ({entry:e,onClick:t}){const n=S.useRef(null),r=36;on.useEffect(()=>{const s=n.current;if(!s)return;const c=s.getContext("2d");c&&(c.clearRect(0,0,r,r),c.fillStyle="rgba(0,0,0,0.5)",c.fillRect(0,0,r,r),qu(c,e.miniGlyphSpec,r/2,r/2,r*.43,{alpha:.88}))},[e.miniGlyphSpec,r]);const a=e.confidence,i=a>.7?"#80ff80":a>.4?"#ffd060":"#ff8060";return o.jsxs("div",{onClick:t,style:{display:"flex",alignItems:"center",gap:8,padding:"6px 10px",cursor:"pointer",borderBottom:"1px solid rgba(255,255,255,0.04)",transition:"background 0.15s"},onMouseEnter:s=>s.currentTarget.style.background="rgba(160,80,255,0.07)",onMouseLeave:s=>s.currentTarget.style.background="transparent",children:[o.jsx("canvas",{ref:n,width:r,height:r,style:{borderRadius:4,flexShrink:0}}),o.jsxs("div",{style:{flex:1,minWidth:0},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5},children:[o.jsx("span",{style:{fontSize:11,color:"rgba(242,232,215,0.92)",fontWeight:500},children:e.gloss||"(sem gloss)"}),e.status==="accepted"?o.jsx(G5,{size:9,color:"#80ff80"}):o.jsx(Bu,{size:9,color:"rgba(255,255,255,0.2)"})]}),o.jsx("div",{style:{fontSize:9,color:"rgba(200,190,180,0.6)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.definition||e.tokens.slice(0,4).join("  ")}),o.jsxs("div",{style:{display:"flex",gap:6,marginTop:2},children:[o.jsxs("span",{style:{fontSize:7,color:i},children:[Math.round(a*100),"%"]}),o.jsxs("span",{style:{fontSize:7,color:"rgba(255,255,255,0.2)"},children:[e.frequency,""]}),e.tags.slice(0,2).map(s=>o.jsxs("span",{style:{fontSize:7,color:"rgba(100,160,255,0.6)"},children:["#",s]},s))]})]})]})}function JQ({entries:e,clusters:t,sessions:n,onSelect:r,onClose:a,onImport:i}){const[s,c]=S.useState(""),[l,d]=S.useState("recent"),[u,h]=S.useState(null),m=S.useRef(null),f=S.useMemo(()=>{let v=[...e];if(u&&(v=v.filter(b=>b.clusterId===u)),s.trim()){const b=s.toLowerCase();v=v.filter(w=>w.gloss.toLowerCase().includes(b)||w.definition.toLowerCase().includes(b)||w.tags.some(M=>M.toLowerCase().includes(b))||w.tokens.some(M=>M.toLowerCase().includes(b)))}return v.sort((b,w)=>l==="confidence"?w.confidence-b.confidence:l==="frequency"?w.frequency-b.frequency:w.lastUpdated-b.lastUpdated),v},[e,s,l,u]),g={position:"fixed",top:0,right:0,bottom:0,width:320,zIndex:50,background:"rgba(6,4,18,0.98)",borderLeft:"1px solid rgba(160,80,255,0.2)",display:"flex",flexDirection:"column",fontFamily:"system-ui, sans-serif",backdropFilter:"blur(16px)",boxShadow:"-4px 0 40px rgba(0,0,0,0.7)"},x=["#a070ff","#60c0ff","#ff8060","#80ff80","#ffd060"];return o.jsxs("div",{style:g,children:[o.jsxs("div",{style:{padding:"12px 14px 8px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10},children:[o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:8,letterSpacing:"0.18em",color:"rgba(160,80,255,0.6)",textTransform:"uppercase"},children:"Grimrio Heptapod"}),o.jsxs("div",{style:{fontSize:13,color:"rgba(242,232,215,0.9)",marginTop:1},children:[e.length," verbetes"]})]}),o.jsxs("div",{style:{display:"flex",gap:5},children:[o.jsx("button",{onClick:()=>YQ(e,n),title:"Exportar JSON",style:{background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:5,padding:"4px 6px",cursor:"pointer",color:"rgba(200,200,200,0.7)"},children:o.jsx(aS,{size:11})}),o.jsx("button",{onClick:()=>{var v;return(v=m.current)==null?void 0:v.click()},title:"Importar JSON",style:{background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:5,padding:"4px 6px",cursor:"pointer",color:"rgba(200,200,200,0.7)"},children:o.jsx(Tu,{size:11})}),o.jsx("input",{ref:m,type:"file",accept:".json",style:{display:"none"},onChange:v=>{var w;const b=(w=v.target.files)==null?void 0:w[0];b&&KQ(b,M=>i(M.lexicon),M=>alert(M)),v.target.value=""}}),o.jsx("button",{onClick:a,style:{background:"none",border:"none",cursor:"pointer",color:"rgba(255,255,255,0.3)"},children:o.jsx(Cs,{size:13})})]})]}),o.jsxs("div",{style:{position:"relative"},children:[o.jsx(nF,{size:10,style:{position:"absolute",left:8,top:"50%",transform:"translateY(-50%)",color:"rgba(255,255,255,0.2)"}}),o.jsx("input",{value:s,onChange:v=>c(v.target.value),placeholder:"buscar gloss, tag, token",style:{width:"100%",fontSize:10,padding:"5px 8px 5px 24px",borderRadius:5,background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,255,255,0.1)",color:"rgba(235,225,210,0.85)",outline:"none",boxSizing:"border-box"}})]})]}),t.length>0&&o.jsxs("div",{style:{padding:"6px 14px",borderBottom:"1px solid rgba(255,255,255,0.04)",display:"flex",gap:5,flexWrap:"wrap"},children:[o.jsx("button",{onClick:()=>h(null),style:{fontSize:8,padding:"2px 7px",borderRadius:10,cursor:"pointer",background:u?"rgba(255,255,255,0.05)":"rgba(160,80,255,0.2)",border:`1px solid ${u?"rgba(255,255,255,0.08)":"rgba(160,80,255,0.4)"}`,color:u?"rgba(200,200,200,0.5)":"rgba(200,160,255,0.9)"},children:"todos"}),t.map((v,b)=>o.jsxs("button",{onClick:()=>h(u===v.id?null:v.id),style:{fontSize:8,padding:"2px 7px",borderRadius:10,cursor:"pointer",background:u===v.id?`${x[b%x.length]}22`:"rgba(255,255,255,0.05)",border:`1px solid ${u===v.id?x[b%x.length]+"55":"rgba(255,255,255,0.08)"}`,color:x[b%x.length]+"cc"},children:[v.label," (",v.members.length,")"]},v.id))]}),o.jsxs("div",{style:{padding:"4px 14px",borderBottom:"1px solid rgba(255,255,255,0.04)",display:"flex",gap:5,alignItems:"center"},children:[o.jsx(aI,{size:9,style:{color:"rgba(255,255,255,0.2)"}}),["confidence","recent","frequency"].map(v=>o.jsx("button",{onClick:()=>d(v),style:{fontSize:7,padding:"1px 6px",borderRadius:3,cursor:"pointer",background:l===v?"rgba(160,80,255,0.15)":"transparent",border:`1px solid ${l===v?"rgba(160,80,255,0.3)":"transparent"}`,color:l===v?"rgba(200,160,255,0.9)":"rgba(200,200,200,0.35)",textTransform:"uppercase",letterSpacing:"0.08em"},children:v},v)),o.jsx("span",{style:{marginLeft:"auto",fontSize:7,color:"rgba(255,255,255,0.2)"},children:f.length})]}),o.jsxs("div",{style:{flex:1,overflowY:"auto",scrollbarWidth:"thin",scrollbarColor:"rgba(160,80,255,0.15) transparent"},children:[f.length===0&&o.jsx("div",{style:{padding:20,fontSize:10,color:"rgba(255,255,255,0.2)",textAlign:"center"},children:e.length===0?"Dicionrio vazio  Listen por 1 minuto!":"Nenhum resultado."}),f.map(v=>o.jsx(XQ,{entry:v,onClick:()=>r(v)},v.glyphId))]})]})}var C0={};function mE(){var e;if(typeof process<"u"&&(C0!=null&&C0.OPENAI_API_KEY))return C0.OPENAI_API_KEY;if(typeof window<"u"){if((e=window.__APP_CONFIG__)!=null&&e.OPENAI_API_KEY)return window.__APP_CONFIG__.OPENAI_API_KEY;const t=pS();if(t)return t}return null}function QQ(){var e;return typeof process<"u"&&(C0!=null&&C0.OPENAI_MODEL)?C0.OPENAI_MODEL:typeof window<"u"&&((e=window.__APP_CONFIG__)!=null&&e.OPENAI_MODEL)?window.__APP_CONFIG__.OPENAI_MODEL??"gpt-4o-mini":"gpt-4o-mini"}async function gE(e,t=2e4){var i,s,c;const n=mE();if(!n)throw new Error("OPENAI_API_KEY no configurada. Defina em process.env.OPENAI_API_KEY ou window.__APP_CONFIG__.OPENAI_API_KEY");const r=new AbortController,a=setTimeout(()=>r.abort(),t);try{const l=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({model:QQ(),messages:e,temperature:.3,max_tokens:512,response_format:{type:"json_object"}}),signal:r.signal});if(!l.ok){const u=await l.text().catch(()=>l.statusText);throw new Error(`OpenAI ${l.status}: ${u}`)}return((c=(s=(i=(await l.json()).choices)==null?void 0:i[0])==null?void 0:s.message)==null?void 0:c.content)??""}finally{clearTimeout(a)}}function ZQ(){return mE()!==null}function eZ({status:e,events:t,lastRationale:n,onConfigKey:r}){const[a,i]=S.useState(!0),[s,c]=S.useState(!1),[l,d]=S.useState(""),u=ZQ(),h=e.state==="ok"?"#80ff80":e.state==="loading"?"#ffd060":e.state==="error"?"#ff6060":"rgba(255,255,255,0.2)",m={background:"rgba(6,4,18,0.92)",border:"1px solid rgba(160,80,255,0.2)",borderRadius:8,margin:"0 0 0 0",fontFamily:"system-ui, sans-serif",overflow:"hidden"},f={display:"flex",alignItems:"center",gap:7,padding:"7px 10px",cursor:"pointer",borderBottom:a?"1px solid rgba(255,255,255,0.05)":"none"};return o.jsxs("div",{style:m,children:[o.jsxs("div",{style:f,onClick:()=>i(!a),children:[o.jsx(ic,{size:11,color:"rgba(200,160,255,0.7)"}),o.jsx("span",{style:{fontSize:9,letterSpacing:"0.14em",textTransform:"uppercase",color:"rgba(200,160,255,0.8)",flex:1},children:"Lexicgrafo LLM"}),o.jsx("div",{style:{width:6,height:6,borderRadius:"50%",background:h}}),a?o.jsx(Ms,{size:10,color:"rgba(255,255,255,0.3)"}):o.jsx(hs,{size:10,color:"rgba(255,255,255,0.3)"})]}),a&&o.jsxs("div",{style:{padding:"8px 10px"},children:[!u&&!s&&o.jsxs("div",{style:{marginBottom:8},children:[o.jsxs("div",{style:{fontSize:9,color:"#ffd060",marginBottom:4,display:"flex",gap:4,alignItems:"center"},children:[o.jsx(RI,{size:10}),"OPENAI_API_KEY no configurada"]}),o.jsxs("button",{onClick:()=>c(!0),style:{fontSize:8,padding:"3px 8px",borderRadius:4,cursor:"pointer",background:"rgba(255,200,60,0.12)",border:"1px solid rgba(255,200,60,0.3)",color:"rgba(255,220,120,0.9)",display:"flex",alignItems:"center",gap:4},children:[o.jsx(pP,{size:9})," Configurar key temporria"]})]}),s&&o.jsxs("div",{style:{marginBottom:8},children:[o.jsx("input",{value:l,onChange:g=>d(g.target.value),placeholder:"sk-",type:"password",style:{width:"100%",fontSize:9,padding:"4px 6px",borderRadius:4,boxSizing:"border-box",background:"rgba(0,0,0,0.6)",border:"1px solid rgba(255,200,60,0.3)",color:"rgba(255,230,150,0.9)",outline:"none"}}),o.jsxs("div",{style:{display:"flex",gap:4,marginTop:4},children:[o.jsx("button",{onClick:()=>{r(l),c(!1),d("")},style:{fontSize:8,padding:"3px 8px",borderRadius:4,cursor:"pointer",background:"rgba(80,200,80,0.15)",border:"1px solid rgba(80,200,80,0.3)",color:"rgba(140,220,140,0.9)"},children:"Salvar"}),o.jsx("button",{onClick:()=>c(!1),style:{fontSize:8,padding:"3px 8px",borderRadius:4,cursor:"pointer",background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.1)",color:"rgba(200,200,200,0.5)"},children:"Cancelar"})]}),o.jsx("div",{style:{fontSize:7,color:"rgba(255,200,60,0.5)",marginTop:4,lineHeight:1.4},children:" A key no  enviada a servidores externos alm da OpenAI API. Figma Make no  indicado para coletar dados sensveis."})]}),u&&e.state==="idle"&&o.jsxs("div",{style:{fontSize:9,color:"rgba(140,220,140,0.6)",marginBottom:6,display:"flex",gap:4,alignItems:"center"},children:[o.jsx(G5,{size:9}),'Pronto  clique "Ask LLM" em qualquer glifo']}),e.state==="loading"&&o.jsx("div",{style:{fontSize:9,color:"#ffd060",marginBottom:6},children:" Consultando lexicgrafo"}),e.state==="error"&&o.jsxs("div",{style:{fontSize:9,color:"#ff8060",marginBottom:6,lineHeight:1.4},children:[" ",e.lastError]}),n&&o.jsxs("div",{style:{marginBottom:8},children:[o.jsx("div",{style:{fontSize:7,color:"rgba(160,80,255,0.5)",letterSpacing:"0.1em",textTransform:"uppercase",marginBottom:3},children:"ltimo raciocnio"}),o.jsx("div",{style:{fontSize:9,color:"rgba(210,200,190,0.7)",lineHeight:1.5,borderLeft:"2px solid rgba(160,80,255,0.25)",paddingLeft:6},children:n})]}),t.length>0&&o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:7,color:"rgba(255,255,255,0.2)",letterSpacing:"0.1em",textTransform:"uppercase",marginBottom:4},children:"Eventos recentes"}),t.slice(-5).reverse().map(g=>o.jsxs("div",{style:{fontSize:8,color:"rgba(200,190,180,0.6)",marginBottom:2,display:"flex",gap:5},children:[o.jsx("span",{style:{color:"rgba(160,80,255,0.5)",flexShrink:0},children:g.kind==="GLYPH_SHIFT"?"":g.kind==="PATTERN_STABLE"?"":g.kind==="SPEAK_EFFECT"?"":""}),o.jsx("span",{children:g.description})]},g.id))]})]})]})}const au={fontSize:8,padding:"3px 8px",borderRadius:4,cursor:"pointer",letterSpacing:"0.1em",textTransform:"uppercase",display:"flex",alignItems:"center",gap:4},yE={display:"flex",alignItems:"center",gap:6,marginBottom:4};function su({label:e,value:t,min:n=0,max:r=1,step:a=.01,onChange:i}){return o.jsxs("div",{style:yE,children:[o.jsx("span",{style:{fontSize:7,color:"rgba(200,190,180,0.5)",width:70,letterSpacing:"0.08em",textTransform:"uppercase",flexShrink:0},children:e}),o.jsx("input",{type:"range",min:n,max:r,step:a,value:t,onChange:s=>i(parseFloat(s.target.value)),style:{flex:1,height:2,accentColor:"rgba(160,80,255,0.8)",cursor:"pointer"}}),o.jsx("span",{style:{fontSize:7,color:"rgba(200,190,180,0.4)",width:24,textAlign:"right"},children:t.toFixed(2)})]})}const xk=[{id:"listen",label:"Listen",icon:o.jsx(VI,{size:9}),color:"#60c0ff"},{id:"speak",label:"Speak",icon:o.jsx(TP,{size:9}),color:"#ffd060"},{id:"train",label:"Train",icon:o.jsx(Gk,{size:9}),color:"#80ff80"}],tZ=[{id:"world",label:"World",color:"#60c0ff"},{id:"glyphs",label:"Glyphs",color:"#e0d8cc"},{id:"events",label:"Events",color:"#ff8060"},{id:"map",label:"Map",color:"#80ff90"},{id:"phase",label:"Phase",color:"#a070ff"},{id:"meaning",label:"Meaning",color:"#ffd060"}];function nZ({params:e,mode:t,lens:n,running:r,onParams:a,onMode:i,onLens:s,onReset:c,onOpenLexicon:l,onPreset:d,onToggleRunning:u}){var v;const[h,m]=S.useState(!1),f={display:"flex",flexDirection:"column",gap:0,background:"rgba(6,4,18,0.95)",borderRight:"1px solid rgba(255,255,255,0.05)",width:200,flexShrink:0,fontFamily:"system-ui, sans-serif",overflowY:"auto",scrollbarWidth:"none",padding:"10px 0"},g={padding:"6px 10px 4px",borderBottom:"1px solid rgba(255,255,255,0.04)"},x={fontSize:7,color:"rgba(160,80,255,0.5)",letterSpacing:"0.14em",textTransform:"uppercase",marginBottom:5};return o.jsxs("div",{style:f,children:[o.jsxs("div",{style:{padding:"2px 10px 8px"},children:[o.jsx("div",{style:{fontSize:7,letterSpacing:"0.18em",color:"rgba(160,80,255,0.5)",textTransform:"uppercase"},children:"Language Lab"}),o.jsx("div",{style:{fontSize:11,color:"rgba(242,232,215,0.85)"},children:"Heptapod "})]}),o.jsxs("div",{style:g,children:[o.jsx("div",{style:x,children:"Preset"}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:2},children:uE.map(b=>o.jsxs("button",{onClick:()=>d(b),style:{...au,background:e.preset===b.id?"rgba(160,80,255,0.15)":"rgba(255,255,255,0.04)",border:`1px solid ${e.preset===b.id?"rgba(160,80,255,0.35)":"rgba(255,255,255,0.07)"}`,color:e.preset===b.id?"rgba(200,160,255,0.9)":"rgba(200,190,180,0.5)",textAlign:"left",justifyContent:"flex-start",width:"100%"},children:[o.jsx("span",{children:b.emoji}),o.jsx("span",{style:{fontSize:8},children:b.name})]},b.id))})]}),o.jsxs("div",{style:g,children:[o.jsx("div",{style:x,children:"Modo"}),o.jsx("div",{style:{display:"flex",gap:3},children:xk.map(b=>o.jsx("button",{onClick:()=>i(b.id),title:b.label,style:{...au,flex:1,justifyContent:"center",background:t===b.id?`${b.color}22`:"rgba(255,255,255,0.04)",border:`1px solid ${t===b.id?b.color+"55":"rgba(255,255,255,0.07)"}`,color:t===b.id?b.color:"rgba(200,190,180,0.4)",padding:"4px 4px"},children:b.icon},b.id))}),o.jsx("div",{style:{fontSize:8,color:"rgba(200,190,180,0.4)",textAlign:"center",marginTop:3},children:(v=xk.find(b=>b.id===t))==null?void 0:v.label})]}),o.jsxs("div",{style:g,children:[o.jsx("div",{style:x,children:"Mapa Semntico"}),o.jsxs("select",{value:e.dictionaryMode,onChange:b=>a({dictionaryMode:b.target.value}),style:{width:"100%",fontSize:9,padding:"3px 4px",borderRadius:4,cursor:"pointer",background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,255,255,0.1)",color:"rgba(200,190,180,0.8)",outline:"none"},children:[o.jsx("option",{value:"linear",children:"Linear"}),o.jsx("option",{value:"heptapod",children:"Heptapod"}),o.jsx("option",{value:"recursive",children:"Recursive"}),o.jsx("option",{value:"experimental",children:"Experimental"})]})]}),o.jsxs("div",{style:g,children:[o.jsx("div",{style:x,children:"Fsica"}),o.jsx(su,{label:"Agents",value:e.agentCount,min:100,max:1200,step:50,onChange:b=>a({agentCount:Math.round(b)})}),o.jsx(su,{label:"Dance",value:e.dance,onChange:b=>a({dance:b})}),o.jsx(su,{label:"Entrainment",value:e.entrainment,onChange:b=>a({entrainment:b})}),o.jsx(su,{label:"Ring Spring",value:e.loopThreshold,onChange:b=>a({loopThreshold:b})}),o.jsx(su,{label:"InkDecay",value:e.inkDecay,onChange:b=>a({inkDecay:b})}),o.jsx(su,{label:"TimeScope",value:e.timeScope,onChange:b=>a({timeScope:b})}),t==="speak"&&o.jsx(su,{label:"Intensity",value:e.speakIntensity,onChange:b=>a({speakIntensity:b})})]}),o.jsxs("div",{style:g,children:[o.jsxs("div",{style:x,children:[o.jsx(jl,{size:8,style:{display:"inline",marginRight:4}}),"Lens"]}),o.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:3},children:tZ.map(b=>o.jsx("button",{onClick:()=>s(b.id),style:{...au,background:n===b.id?`${b.color}22`:"rgba(255,255,255,0.04)",border:`1px solid ${n===b.id?b.color+"55":"rgba(255,255,255,0.06)"}`,color:n===b.id?b.color:"rgba(200,190,180,0.35)",fontSize:7,padding:"3px 7px"},children:b.label},b.id))})]}),o.jsxs("div",{style:{padding:"8px 10px",display:"flex",flexDirection:"column",gap:5},children:[o.jsxs("button",{onClick:l,style:{...au,background:"rgba(160,80,255,0.12)",border:"1px solid rgba(160,80,255,0.25)",color:"rgba(200,160,255,0.9)",justifyContent:"center",padding:"5px 8px"},children:[o.jsx(Sf,{size:10}),"Abrir Grimrio"]}),o.jsxs("div",{style:{display:"flex",gap:4},children:[o.jsxs("button",{onClick:u,style:{...au,flex:1,justifyContent:"center",background:r?"rgba(255,200,60,0.1)":"rgba(80,200,80,0.1)",border:`1px solid ${r?"rgba(255,200,60,0.25)":"rgba(80,200,80,0.25)"}`,color:r?"rgba(255,220,120,0.8)":"rgba(140,220,140,0.8)",padding:"4px"},children:[r?"":""," ",r?"Pausa":"Play"]}),o.jsx("button",{onClick:c,title:"Reset simulao",style:{...au,background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.09)",color:"rgba(200,190,180,0.5)",padding:"4px 7px"},children:o.jsx(wf,{size:9})})]})]}),o.jsxs("div",{style:{padding:"0 10px 8px"},children:[o.jsxs("button",{onClick:()=>m(!h),style:{...au,background:"none",border:"none",color:"rgba(200,190,180,0.3)",width:"100%",justifyContent:"flex-start",padding:"4px 0"},children:[o.jsx($u,{size:9}),"Avanado",h?o.jsx(Ms,{size:9}):o.jsx(hs,{size:9})]}),h&&o.jsxs("div",{style:{background:"rgba(0,0,0,0.3)",borderRadius:5,padding:"8px 8px 4px",border:"1px solid rgba(255,255,255,0.06)",marginTop:4},children:[o.jsxs("div",{style:{...yE,marginBottom:6},children:[o.jsx("span",{style:{fontSize:7,color:"rgba(200,190,180,0.4)",width:60,textTransform:"uppercase",letterSpacing:"0.08em"},children:"Seed"}),o.jsx("input",{type:"number",value:e.seed,onChange:b=>a({seed:parseInt(b.target.value)||0}),style:{flex:1,fontSize:8,padding:"2px 4px",borderRadius:3,background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,255,255,0.1)",color:"rgba(200,190,180,0.8)",outline:"none"}})]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginTop:4},children:[o.jsx("input",{type:"checkbox",id:"autorefine",checked:e.llmAutoRefine,onChange:b=>a({llmAutoRefine:b.target.checked}),style:{accentColor:"rgba(160,80,255,0.8)"}}),o.jsx("label",{htmlFor:"autorefine",style:{fontSize:8,color:"rgba(200,190,180,0.5)",letterSpacing:"0.08em",textTransform:"uppercase",cursor:"pointer"},children:"LLM Auto-Refine"})]})]})]})]})}function tc(e){return typeof e=="string"}function rZ(e){return typeof e=="number"&&isFinite(e)}function Up(e){return Array.isArray(e)}function Qv(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function oZ(e){if(!Qv(e))return{ok:!1,error:"Not an object"};const t=e.gloss,n=e.definition,r=e.usage,a=e.contrasts,i=e.tags,s=e.confidence,c=e.needs_verification,l=e.rationale;return tc(t)?tc(n)?tc(r)?Up(a)?Up(i)?rZ(s)?typeof c!="boolean"?{ok:!1,error:"needs_verification must be boolean"}:tc(l)?{ok:!0,data:{gloss:t.slice(0,60),definition:n.slice(0,200),usage:r.slice(0,200),contrasts:a.filter(tc).map(d=>d.slice(0,40)),tags:i.filter(tc).map(d=>d.slice(0,30)),confidence:Math.max(0,Math.min(1,s)),needs_verification:c,rationale:l.slice(0,300)}}:{ok:!1,error:"Missing rationale"}:{ok:!1,error:"confidence must be number"}:{ok:!1,error:"tags must be array"}:{ok:!1,error:"contrasts must be array"}:{ok:!1,error:"Missing usage"}:{ok:!1,error:"Missing definition"}:{ok:!1,error:"Missing gloss"}}function aZ(e){if(!Qv(e))return{ok:!1,error:"Not an object"};const t=e.clusters,n=e.bridges,r=e.notes;return Up(t)?Up(n)?tc(r)?{ok:!0,data:{clusters:t.filter(Qv).map(i=>({id:tc(i.id)?i.id:String(Math.random()),label:tc(i.label)?i.label:"cluster",members:Up(i.members)?i.members.filter(tc):[]})),bridges:n.filter(tc),notes:r.slice(0,400)}}:{ok:!1,error:"Missing notes"}:{ok:!1,error:"bridges must be array"}:{ok:!1,error:"clusters must be array"}}function bE(e){try{const t=e.replace(/^```[a-z]*\n?/,"").replace(/\n?```$/,"").trim();return JSON.parse(t)}catch{return null}}const xE=`Voc  um lexicgrafo de uma linguagem experimental chamada Heptapod.
Voc APENAS pode inferir significado a partir de:
- Tokens/forma do glifo fornecidos
- Mtricas observadas no mundo (fsica simulada)
- Efeito real aps aplicar o glifo (Speak)
- Labels humanos (se fornecidos)

Nunca afirme fatos externos ou invenes. Retorne SOMENTE JSON vlido conforme o schema solicitado.
Seja conciso, operacional e verificvel. Confidence < 0.5  needs_verification: true.`;async function sZ(e,t,n,r,a){var u,h,m,f;const i=n?`Efeito aps Speak  antes: sync=${(u=n.before.syncIndex)==null?void 0:u.toFixed(2)} coh=${(h=n.before.coherenceMean)==null?void 0:h.toFixed(2)} | depois: sync=${(m=n.after.syncIndex)==null?void 0:m.toFixed(2)} coh=${(f=n.after.coherenceMean)==null?void 0:f.toFixed(2)}`:"Sem dados de Speak ainda.",s=r!=null&&r.length?`Labels do usurio: ${r.join(", ")}`:"Nenhum label humano ainda.",c=a!=null&&a.length?`Glosses existentes no dicionrio: ${a.slice(0,12).join(", ")}`:"",l=`
Glifo: ${e.glyphId}
Tokens/features: ${e.tokens.join(", ")}
Observveis: sync=${t.syncIndex.toFixed(2)} coherence=${t.coherenceMean.toFixed(2)} tension=${t.tensionIndex.toFixed(2)} novelty=${t.noveltyIndex.toFixed(2)} loops=${t.loopCount.toFixed(2)} silence=${t.silenceIndex.toFixed(2)}
${i}
${s}
${c}
Definio prvia: "${e.gloss}"  "${e.definition}"

Retorne JSON com campos: gloss (13 palavras), definition (12 frases), usage (1 frase), contrasts (array strings), tags (array), confidence (0..1), needs_verification (bool), rationale (12 frases).`;let d="";for(let g=0;g<2;g++)try{const x=await gE([{role:"system",content:xE},{role:"user",content:l}],2e4),v=bE(x),b=oZ(v);if(b.ok)return b.data;d=b.error}catch(x){d=x.message}throw new Error(`LLM refine failed: ${d}`)}async function iZ(e){if(e.length<3)throw new Error("Dicionrio muito pequeno para clusterizar");const t=e.slice(0,30).map(a=>({id:a.glyphId,gloss:a.gloss,tokens:a.tokens.slice(0,6).join(" "),confidence:a.confidence.toFixed(2)})),n=`
Dicionrio Heptapod (${t.length} entradas):
${t.map(a=>`- id=${a.id} gloss="${a.gloss}" tokens=[${a.tokens}] conf=${a.confidence}`).join(`
`)}

Identifique 25 clusters temticos/funcionais. Retorne JSON com:
clusters (array de {id, label, members: [glyphId...]}),
bridges (glyphIds que conectam clusters),
notes (1 frase geral).`;let r="";for(let a=0;a<2;a++)try{const i=await gE([{role:"system",content:xE},{role:"user",content:n}],2e4),s=bE(i),c=aZ(s);if(c.ok)return c.data;r=c.error}catch(i){r=i.message}throw new Error(`LLM cluster failed: ${r}`)}const n0=Math.PI*2,lZ=1.1;function cZ({active:e}){const t=S.useRef(null),n=S.useRef(null),r=S.useRef(Mx(Cx)),a=S.useRef({...Cx}),i=S.useRef([]),s=S.useRef(TQ(800,600)),c=S.useRef(0),l=S.useRef(0),d=S.useRef(null),u=S.useRef(0),h=S.useRef(0),m=S.useRef("listen"),f=S.useRef("world"),g=S.useRef(!0),x=S.useRef(""),[v,b]=S.useState({...Cx}),[w,M]=S.useState("listen"),[k,R]=S.useState("world"),[j,I]=S.useState(!0),[E,O]=S.useState([]),[L,$]=S.useState(null),[F,B]=S.useState(()=>VQ()),[W,re]=S.useState([]),[oe,te]=S.useState(()=>UQ()),[J,pe]=S.useState([]),[P,V]=S.useState({state:"idle"}),[fe,ye]=S.useState(""),[Se,we]=S.useState(!1),[ke,De]=S.useState(null),[_e,ae]=S.useState(null),[Re,Fe]=S.useState({w:800,h:600}),[Oe,ne]=S.useState(0),nt=S.useRef(F);nt.current=F;const pt=S.useRef(W);pt.current=W,S.useEffect(()=>{var Pe;const wt=(Pe=t.current)==null?void 0:Pe.parentElement;if(!wt)return;const st=(ct,vt)=>{const xe=Math.max(1,Math.floor(ct)),ge=Math.max(1,Math.floor(vt));Fe({w:xe,h:ge}),s.current.width=xe,s.current.height=ge};st(wt.clientWidth,wt.clientHeight);const Zt=new ResizeObserver(ct=>{for(const vt of ct)st(vt.contentRect.width,vt.contentRect.height)});return Zt.observe(wt),()=>Zt.disconnect()},[]),S.useEffect(()=>{a.current=v},[v]),S.useEffect(()=>{m.current=w},[w]),S.useEffect(()=>{f.current=k},[k]),S.useEffect(()=>{g.current=j},[j]);const Et=S.useCallback(wt=>{const st=dE(wt);return{glyphId:wt.id,signatureHash:wt.signatureHash,miniGlyphSpec:wt,gloss:`${st.densityBin}-${st.coherenceBin}`,definition:"",usage:"",contrasts:[],tokens:st.tokens,embedding:st.embedding,examples:[{timestamp:wt.timestamp,snapshotMetrics:wt.observables}],confidence:0,status:"tentative",lastUpdated:Date.now(),tags:[],clusterId:"",frequency:1}},[]),_t=S.useCallback(()=>{const wt=r.current,st=a.current,Zt=m.current,Pe=Np(wt,st),ct=FQ(Pe,st.dictionaryMode,Date.now());O(me=>[...me,ct].slice(-12));const vt=nt.current,xe=vt.find(me=>me.signatureHash===ct.signatureHash);let ge;if(xe){const me={...xe,frequency:xe.frequency+1,examples:[...xe.examples.slice(-4),{timestamp:ct.timestamp,snapshotMetrics:Pe}],lastUpdated:Date.now()};ge=vt.map(je=>je.glyphId===xe.glyphId?me:je),xe.frequency%3===0&&pe(je=>[...je.slice(-19),{id:Date.now().toString(),kind:"PATTERN_STABLE",timestamp:Date.now(),description:`Padro "${xe.gloss||xe.signatureHash.slice(0,6)}" reforado (${me.frequency})`}])}else{const me=Et(ct);ge=[...vt,me].slice(-200),pe(je=>[...je.slice(-19),{id:Date.now().toString(),kind:"GLYPH_SHIFT",timestamp:Date.now(),description:`Novo glifo: ${ct.signatureHash.slice(0,8)}  ${me.tokens.slice(0,3).join(" ")}`}]),st.llmAutoRefine&&Xe(ct,me,Pe,ge).catch(()=>{})}B(ge),ou(ge);const Ee=zQ(Pe,ge);if(ae(Ee),ne(Pe.coherenceMean),Zt==="train"){const me=ge.filter(je=>je.confidence<.4&&je.frequency>=2).sort((je,Te)=>je.confidence-Te.confidence)[0];me&&!ke&&De({spec:me.miniGlyphSpec,question:`"${me.tokens.slice(0,3).join(", ")}"  esse glifo significa mais:`})}d.current=Pe},[Et,ke]),Ct=S.useRef(_t);Ct.current=_t;const Xe=S.useCallback(async(wt,st,Zt,Pe)=>{V({state:"loading"});try{const ct=Pe.filter(me=>me.gloss&&me.glyphId!==st.glyphId).map(me=>me.gloss),vt=d.current,ge=await sZ(st,Zt,vt?{before:vt,after:Zt}:void 0,[],ct);ye(ge.rationale);const Ee={...st,gloss:ge.gloss,definition:ge.definition,usage:ge.usage,contrasts:ge.contrasts,tags:ge.tags,confidence:ge.confidence,status:ge.needs_verification?"tentative":st.status,lastUpdated:Date.now()};B(me=>{const je=bk(me,Ee);return ou(je),je}),V({state:"ok"})}catch(ct){V({state:"error",lastError:ct.message})}},[]),Ut=S.useCallback((wt,st)=>{const Zt=Np(r.current,a.current),Pe=st??Et(wt),ct=nt.current;Xe(wt,Pe,Zt,ct)},[Et,Xe]),Le=S.useCallback((wt,st,Zt)=>{const Pe=r.current,ct=a.current;let vt=.5,xe=.5;if(Pe.quanta.length){let me=0,je=0;for(const Te of Pe.quanta)me+=Te.x,je+=Te.y;vt=me/Pe.quanta.length,xe=je/Pe.quanta.length}const ge=LQ(wt,st??vt,Zt??xe,ct);i.current.push(ge);const Ee=Np(Pe,ct);pe(me=>[...me.slice(-19),{id:Date.now().toString(),kind:"SPEAK_EFFECT",timestamp:Date.now(),description:`Speak: ${mk[ge.kind].label} r=${ge.radius.toFixed(2)} dur=${ge.duration.toFixed(1)}s`}]),{...Ee},setTimeout(()=>{const me=Np(r.current,a.current);B(je=>{const Te=je.findIndex(Tt=>Tt.glyphId===wt.id);if(Te<0)return je;const Ae=je[Te];return a.current.llmAutoRefine&&Xe(wt,Ae,me,je),je})},3e3)},[Xe]),Ke=S.useCallback(wt=>{if(m.current!=="speak")return;const st=t.current;if(!st)return;const Zt=st.getBoundingClientRect(),Pe=(wt.clientX-Zt.left)*(st.width/Zt.width),ct=(wt.clientY-Zt.top)*(st.height/Zt.height),vt=Math.min(st.width,st.height),xe=(st.width-vt)*.5,ge=(st.height-vt)*.5,Ee=(Pe-xe)/vt,me=(ct-ge)/vt,je=L??E[E.length-1];je&&Le(je,Ee,me)},[L,E,Le]),mt=S.useCallback(wt=>{ke&&(B(st=>{const Zt=st.findIndex(xe=>xe.glyphId===ke.spec.id);if(Zt<0)return st;const Pe=st[Zt],ct={...Pe,confidence:Math.min(1,Pe.confidence+.25),tags:[...new Set([...Pe.tags,wt.toLowerCase()])],lastUpdated:Date.now()},vt=bk(st,ct);return ou(vt),vt}),De(null))},[ke]),an=S.useCallback(async()=>{const wt=nt.current;if(!(wt.length<3)){V({state:"loading"});try{const st=await iZ(wt),Zt=["#a070ff","#60c0ff","#ff8060","#80ff80","#ffd060"],Pe=st.clusters.map((ct,vt)=>({id:ct.id,label:ct.label,members:ct.members,color:Zt[vt%Zt.length]}));re(Pe),B(ct=>{const vt=new Map;for(const xe of st.clusters)for(const ge of xe.members)vt.set(ge,xe.id);return ct.map(xe=>({...xe,clusterId:vt.get(xe.glyphId)??xe.clusterId}))}),V({state:"ok",lastOutput:st.notes})}catch(st){V({state:"error",lastError:st.message})}}},[]);S.useEffect(()=>{if(!e)return;const wt=t.current,st=n.current;if(!wt||!st)return;let Zt=0;c.current=performance.now();const Pe=ct=>{h.current=requestAnimationFrame(Pe);const vt=(ct-c.current)/1e3,xe=Math.min(vt>0?vt:.016,.05);if(c.current=ct,u.current+=xe,!g.current){const Tn=wt.width,Sr=wt.height;if(Tn<2||Sr<2||!wt.getContext("2d"))return;const $e=gn.current;if($e.length>0){const et=$e[$e.length-1],zt=st.getContext("2d");zt.clearRect(0,0,st.width,st.height);const Nt=Math.min(st.width,st.height)*.44;qu(zt,et,st.width/2,st.height/2,Nt,{alpha:.96,animated:!0,time:u.current})}return}const ge=r.current,Ee=a.current,me=i.current;EQ(ge,Ee,xe,me),i.current=me.filter(Tn=>Tn.duration>0),IQ(ge,Ee,xe),l.current+=xe,l.current>=lZ&&(l.current=0,Ct.current());const je=wt.width,Te=wt.height,Ae=wt.getContext("2d"),Tt=f.current,xt=Math.min(je,Te),en=(je-xt)*.5,At=(Te-xt)*.5,Ze=en+xt*.5,yt=At+xt*.5,Mt=xt*.47,bn=Mt*.97,Pt=bn*bn;if(Zt===0?(Ae.fillStyle="rgb(248,245,240)",Ae.fillRect(0,0,je,Te)):(Ae.fillStyle="rgba(248,245,240,0.92)",Ae.fillRect(0,0,je,Te)),Ae.save(),Ae.beginPath(),Ae.arc(Ze,yt,bn,0,n0),Ae.clip(),Tt==="meaning")dZ(Ae,nt.current,pt.current,je,Te);else{const Tn=ge.quanta,Sr=Tn.length;if(Tt==="world"||Tt==="glyphs"){const de=u.current;Ae.lineCap="round";for(let $e=0;$e<Sr;$e++){const et=Tn[$e],zt=en+et.x*xt,Nt=At+et.y*xt,ln=zt-Ze,Rt=Nt-yt;if(!(ln*ln+Rt*Rt>Pt))for(let Nn=$e+1;Nn<Sr;Nn++){const It=Tn[Nn],xn=It.x-et.x,Ln=It.y-et.y,zn=xn*xn+Ln*Ln,Or=.035;if(zn>Or*Or)continue;const wr=Math.sqrt(zn),vn=Math.cos(et.phase-It.phase);if(vn<.3)continue;const Gr=en+It.x*xt,hn=At+It.y*xt,jr=(1-wr/Or)*vn*.35,_r=(et.coherence+It.coherence)*.5,Zn=Math.round(10+(1-_r)*30);Ae.beginPath(),Ae.moveTo(zt,Nt);const lo=(zt+Gr)*.5,ir=(Nt+hn)*.5,to=-(hn-Nt)*.15*Math.sin(de*2+$e*.1),Er=(Gr-zt)*.15*Math.sin(de*2+$e*.1);Ae.quadraticCurveTo(lo+to,ir+Er,Gr,hn),Ae.strokeStyle=`rgba(${Zn},${Zn},${Zn},${jr.toFixed(3)})`,Ae.lineWidth=.6+_r*.8,Ae.stroke()}}for(let $e=0;$e<Sr;$e++){const et=Tn[$e],zt=en+et.x*xt,Nt=At+et.y*xt,ln=zt-Ze,Rt=Nt-yt;if(ln*ln+Rt*Rt>Pt)continue;const Nn=Math.sqrt(ln*ln+Rt*Rt)/bn,It=Math.max(0,1-Nn*Nn*2.5),xn=Math.max(0,Math.min(1,et.coherence)),Ln=1+Math.sin(et.phase+de*1.5)*.25*xn,zn=Math.max(.5,(1.6+xn*1.2)*Ln),Or=Math.min(.94,(.42+xn*.5+et.ink*.1)*It);Ae.globalAlpha=Or;const wr=Math.sqrt(et.vx*et.vx+et.vy*et.vy),vn=Math.round(6+(1-xn)*42);if(Ae.fillStyle=`rgb(${vn},${vn},${vn})`,wr>5e-4){const Gr=Math.max(zn,Math.min(zn*5,wr*xt*14)),hn=et.vx/wr,jr=et.vy/wr;Ae.save(),Ae.strokeStyle=Ae.fillStyle,Ae.lineWidth=zn*1.8,Ae.lineCap="round",Ae.beginPath(),Ae.moveTo(zt-hn*Gr*.25,Nt-jr*Gr*.25),Ae.lineTo(zt+hn*Gr*.75,Nt+jr*Gr*.75),Ae.stroke(),Ae.restore()}else Ae.beginPath(),Ae.arc(zt,Nt,zn,0,n0),Ae.fill()}Ae.globalAlpha=1}if(Tt==="events"){for(const de of Tn){const $e=en+de.x*xt,et=At+de.y*xt,zt=$e-Ze,Nt=et-yt;if(zt*zt+Nt*Nt>Pt)continue;const ln=Math.max(0,de.coherence),Rt=Math.abs(de.intent),Nn=Math.round(30+Math.max(0,de.intent)*200),It=Math.round(20+(1-Rt)*100),xn=Math.round(30+Math.max(0,-de.intent)*220);Ae.globalAlpha=Math.min(.9,.35+ln*.55+Rt*.25),Ae.fillStyle=`rgb(${Nn},${It},${xn})`,Ae.beginPath(),Ae.arc($e,et,Math.max(.5,1.4+ln*.8),0,n0),Ae.fill()}Ae.globalAlpha=1}if(Tt==="map"){const $e=new Float32Array(4096);for(const Nt of Tn){const ln=Math.min(63,Math.max(0,Math.floor(Nt.x*64))),Rt=Math.min(63,Math.max(0,Math.floor(Nt.y*64)));$e[Rt*64+ln]+=Nt.ink*(.5+Math.max(0,Nt.coherence)*.5)}let et=.01;for(let Nt=0;Nt<4096;Nt++)$e[Nt]>et&&(et=$e[Nt]);const zt=xt/64;for(let Nt=0;Nt<64;Nt++)for(let ln=0;ln<64;ln++){const Rt=$e[Nt*64+ln]/et;if(Rt<.03)continue;const Nn=en+(ln+.5)*zt,It=At+(Nt+.5)*zt;if((Nn-Ze)*(Nn-Ze)+(It-yt)*(It-yt)>Pt)continue;const Ln=Math.round(Rt<.5?Rt*2*30:30+(Rt-.5)*2*60),zn=Math.round(Rt*180),Or=Math.round(60+Rt*180);Ae.fillStyle=`rgb(${Ln},${zn},${Or})`,Ae.globalAlpha=Math.min(.95,Rt*1.2),Ae.fillRect(Nn-zt*.5,It-zt*.5,zt,zt)}Ae.globalAlpha=1}if(Tt==="phase"){for(const de of Tn){const $e=en+de.x*xt,et=At+de.y*xt,zt=$e-Ze,Nt=et-yt;if(zt*zt+Nt*Nt>Pt)continue;const ln=Math.max(0,de.coherence),Rt=Math.round((de.phase/n0*360+ge.time*18)%360),Nn=Math.round(28+ln*38);Ae.globalAlpha=Math.max(.05,.22+ln*.72),Ae.fillStyle=`hsl(${Rt},82%,${Nn}%)`,Ae.beginPath(),Ae.arc($e,et,Math.max(.4,1.2+ln*1.2),0,n0),Ae.fill()}Ae.globalAlpha=1}}Ae.restore();const An=Ae.createRadialGradient(Ze,yt,Mt*.72,Ze,yt,Mt*1.02);if(An.addColorStop(0,"rgba(248,245,240,0)"),An.addColorStop(.6,"rgba(248,245,240,0.04)"),An.addColorStop(.84,"rgba(248,245,240,0.75)"),An.addColorStop(1,"rgba(248,245,240,0.99)"),Ae.fillStyle=An,Ae.fillRect(0,0,je,Te),Ae.save(),Ae.beginPath(),Ae.arc(Ze,yt,bn,0,n0),Ae.strokeStyle="rgba(140,130,118,0.20)",Ae.lineWidth=1.2,Ae.stroke(),Ae.restore(),i.current.length>0){Ae.save(),Ae.beginPath(),Ae.arc(Ze,yt,bn,0,n0),Ae.clip();for(const Tn of i.current){const Sr=mk[Tn.kind];Ae.save(),Ae.strokeStyle=Sr.color,Ae.lineWidth=1.5,Ae.globalAlpha=Math.min(.8,Tn.duration/8*.7),Ae.setLineDash([4,4]);const de=en+Tn.targetX*xt,$e=At+Tn.targetY*xt;Ae.beginPath(),Ae.arc(de,$e,Math.max(1,Tn.radius*xt),0,n0),Ae.stroke(),Ae.setLineDash([]),Ae.restore()}Ae.restore()}const cr=gn.current;if(cr.length>0){const Tn=cr[cr.length-1],Sr=st.getContext("2d");Sr.clearRect(0,0,st.width,st.height);const de=Math.min(st.width,st.height)*.44;qu(Sr,Tn,st.width/2,st.height/2,de,{alpha:.96,animated:!0,time:u.current}),x.current=Tn.id}Zt++};return h.current=requestAnimationFrame(Pe),()=>cancelAnimationFrame(h.current)},[e]);const gn=S.useRef([]);S.useEffect(()=>{gn.current=E},[E]);const Be=S.useCallback(wt=>{b(st=>{const Zt={...st,...wt};return a.current=Zt,Zt})},[]),ft=S.useCallback(wt=>{const st={...wt.params};b(st),a.current=st,r.current=Mx(st),i.current=[],O([])},[]),Qt=S.useCallback(()=>{r.current=Mx(a.current),i.current=[],O([]),pe([]),l.current=0},[]),nr=S.useCallback(wt=>{B(st=>{const Zt=st.map(Pe=>Pe.glyphId===wt?{...Pe,status:"accepted",lastUpdated:Date.now()}:Pe);return ou(Zt),Zt})},[]),_n=S.useCallback((wt,st,Zt)=>{B(Pe=>{const ct=Pe.map(vt=>vt.glyphId===wt?{...vt,[st]:Zt,lastUpdated:Date.now()}:vt);return ou(ct),ct})},[]),Rn=S.useCallback((wt,st)=>{B(Zt=>{const Pe=Zt.map(ct=>ct.glyphId===wt?{...ct,contrasts:[...new Set([...ct.contrasts,st])],lastUpdated:Date.now()}:ct);return ou(Pe),Pe})},[]),sn=S.useCallback(wt=>{typeof window<"u"&&(window.__APP_CONFIG__={...window.__APP_CONFIG__,OPENAI_API_KEY:wt}),V({state:"idle"})},[]),Cn=L?nt.current.find(wt=>wt.glyphId===L.id)??null:null;return e?o.jsxs("div",{style:{position:"fixed",inset:0,top:38,display:"flex",flexDirection:"column",background:"#040210",fontFamily:"system-ui, sans-serif",zIndex:1},children:[o.jsxs("div",{style:{flex:1,display:"flex",overflow:"hidden",minHeight:0},children:[o.jsx(nZ,{params:v,mode:w,lens:k,running:j,onParams:Be,onMode:wt=>{M(wt),m.current=wt},onLens:wt=>{R(wt),f.current=wt},onReset:Qt,onOpenLexicon:()=>we(!0),onPreset:ft,onToggleRunning:()=>I(wt=>{const st=!wt;return g.current=st,st})}),o.jsxs("div",{style:{flex:1,position:"relative",display:"flex",flexDirection:"column",minWidth:0},children:[o.jsxs("div",{style:{flex:1,position:"relative",overflow:"hidden",background:"#f8f5f0"},children:[o.jsx("canvas",{ref:t,width:Re.w,height:Re.h,style:{position:"absolute",inset:0,display:"block",cursor:w==="speak"?"crosshair":"default"},onClick:Ke}),(()=>{const wt=Math.max(0,Math.pow(1-Oe,1.8)*14).toFixed(1);return o.jsxs("div",{style:{position:"absolute",top:12,right:12,borderRadius:14,overflow:"hidden",border:"1px solid rgba(180,170,155,0.4)",boxShadow:"0 4px 24px rgba(0,0,0,0.18)",transition:"filter 0.8s ease",filter:`blur(${wt}px)`},children:[o.jsx("canvas",{ref:n,width:140,height:140,style:{display:"block"}}),_e&&o.jsxs("div",{style:{position:"absolute",bottom:0,left:0,right:0,background:"rgba(250,248,244,0.9)",textAlign:"center",fontSize:7,color:"rgba(60,45,30,0.5)",letterSpacing:"0.1em",padding:"2px 0 3px"},children:["sync ",_e.sync.toFixed(2),"  coh ",_e.coherence.toFixed(2)]})]})})(),w==="speak"&&o.jsx("div",{style:{position:"absolute",top:10,left:"50%",transform:"translateX(-50%)",padding:"4px 14px",borderRadius:20,background:"rgba(255,200,60,0.1)",border:"1px solid rgba(255,200,60,0.25)",fontSize:8,color:"rgba(255,220,120,0.8)",letterSpacing:"0.12em",textTransform:"uppercase",pointerEvents:"none"},children:"SPEAK  clique no canvas para emitir  duplo-clique no glifo no stream"}),w==="train"&&ke&&o.jsx(uZ,{spec:ke.spec,question:ke.question,onChoice:mt,onSkip:()=>De(null)}),_e&&o.jsx("div",{style:{position:"absolute",bottom:8,left:8,display:"flex",flexDirection:"column",gap:2,pointerEvents:"none"},children:[{label:"sync",v:_e.sync,c:"#60c0ff"},{label:"cohere",v:_e.coherence,c:"#a070ff"},{label:"loop",v:_e.loopDensity,c:"#ffd060"},{label:"novel",v:_e.novelty,c:"#ff8060"}].map(({label:wt,v:st,c:Zt})=>o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[o.jsx("span",{style:{fontSize:7,color:"rgba(255,255,255,0.2)",width:36,textAlign:"right",letterSpacing:"0.07em",textTransform:"uppercase"},children:wt}),o.jsx("div",{style:{width:50,height:2.5,background:"rgba(255,255,255,0.07)",borderRadius:2},children:o.jsx("div",{style:{width:`${Math.min(100,st*100)}%`,height:"100%",background:Zt,borderRadius:2,transition:"width 0.5s"}})})]},wt))}),o.jsxs("div",{style:{position:"absolute",top:8,left:"50%",transform:"translateX(-50%)",padding:"2px 10px",borderRadius:10,background:"rgba(0,0,0,0.4)",border:"1px solid rgba(255,255,255,0.06)",fontSize:7,color:"rgba(255,255,255,0.25)",letterSpacing:"0.14em",textTransform:"uppercase",pointerEvents:"none"},children:[k,"  ",v.preset.replace("_"," "),"  ",v.agentCount," quanta"]})]}),o.jsx(qQ,{glyphs:E,lexicon:F,selectedId:(L==null?void 0:L.id)??null,onSelect:$,onSpeak:wt=>Le(wt)})]}),o.jsxs("div",{style:{width:210,flexShrink:0,display:"flex",flexDirection:"column",borderLeft:"1px solid rgba(255,255,255,0.05)",background:"rgba(4,2,14,0.95)",overflowY:"auto",scrollbarWidth:"none",padding:"8px 0",gap:0},children:[o.jsx(eZ,{status:P,events:J,lastRationale:fe,onConfigKey:sn}),F.length>=3&&o.jsx("div",{style:{padding:"8px 10px 4px"},children:o.jsx("button",{title:"Executar",onClick:an,disabled:P.state==="loading",style:{width:"100%",fontSize:8,padding:"4px",borderRadius:5,cursor:"pointer",background:"rgba(160,80,255,0.1)",border:"1px solid rgba(160,80,255,0.2)",color:"rgba(200,160,255,0.7)",letterSpacing:"0.1em",textTransform:"uppercase",opacity:P.state==="loading"?.5:1},children:"Clusterizar Lexicon"})}),_e&&o.jsxs("div",{style:{padding:"8px 10px",borderTop:"1px solid rgba(255,255,255,0.04)",marginTop:4},children:[o.jsx("div",{style:{fontSize:7,letterSpacing:"0.14em",color:"rgba(160,80,255,0.45)",textTransform:"uppercase",marginBottom:5},children:"Lexicon"}),o.jsxs("div",{style:{fontSize:9,color:"rgba(200,190,180,0.6)",lineHeight:1.7},children:[o.jsxs("div",{children:[_e.lexiconSize," verbetes"]}),o.jsxs("div",{children:[Math.round(_e.lexiconHealth*100),"% aceitos"]}),o.jsxs("div",{children:["conf mdia ",_e.avgConfidence.toFixed(2)]})]})]})]})]}),Se&&o.jsx(JQ,{entries:F,clusters:W,sessions:oe,onSelect:wt=>{$(wt.miniGlyphSpec),we(!1)},onClose:()=>we(!1),onImport:wt=>{B(wt),ou(wt)}}),L&&o.jsx(WQ,{spec:L,entry:Cn,allEntries:F,llmLoading:P.state==="loading",onAskLLM:Ut,onAccept:nr,onEdit:_n,onLink:Rn,onClose:()=>$(null),onSpeak:Le})]}):null}function dZ(e,t,n,r,a){if(t.length===0)return;const i=Math.min(t.length,60),s=t.slice(0,i),c=Math.ceil(Math.sqrt(i)),l=Math.min(r,a)/(c+1),d=(r-(c-1)*l)/2,u=(a-(Math.ceil(i/c)-1)*l)/2,h=new Map,m=["#a070ff","#60c0ff","#ff8060","#80ff80","#ffd060"];n.forEach((g,x)=>h.set(g.id,m[x%m.length]));const f=.75;for(let g=0;g<s.length;g++)for(let x=g+1;x<s.length;x++){const v=OQ(s[g].embedding,s[x].embedding);if(v<f)continue;const b=d+g%c*l,w=u+Math.floor(g/c)*l,M=d+x%c*l,k=u+Math.floor(x/c)*l;e.save(),e.strokeStyle="rgba(160,80,255,0.2)",e.lineWidth=(v-f)*4,e.beginPath(),e.moveTo(b,w),e.lineTo(M,k),e.stroke(),e.restore()}for(let g=0;g<s.length;g++){const x=s[g],v=d+g%c*l,b=u+Math.floor(g/c)*l,w=18+x.confidence*8;h.get(x.clusterId),qu(e,x.miniGlyphSpec,v,b,w,{alpha:.55+x.confidence*.4}),x.gloss&&(e.fillStyle="rgba(230,220,210,0.45)",e.font="7px system-ui",e.textAlign="center",e.fillText(x.gloss.slice(0,10),v,b+w+9))}}function uZ({spec:e,question:t,onChoice:n,onSkip:r}){const a=S.useRef(null),i=S.useRef(0),s=S.useRef(0),c=80;S.useEffect(()=>{let u=!0;const h=()=>{var f;if(!u)return;const m=(f=a.current)==null?void 0:f.getContext("2d");m&&(m.clearRect(0,0,c,c),i.current+=.02,qu(m,e,c/2,c/2,c*.44,{alpha:.9,animated:!0,time:i.current})),s.current=requestAnimationFrame(h)};return h(),()=>{u=!1,cancelAnimationFrame(s.current)}},[e]);const l=["UNIR","CORTAR","ABRIR","SILENCIAR"],d={UNIR:"#60c0ff",CORTAR:"#ff8060",ABRIR:"#80ff80",SILENCIAR:"#a070ff"};return o.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(4,2,12,0.7)",backdropFilter:"blur(6px)",zIndex:20},children:o.jsxs("div",{style:{background:"rgba(8,6,20,0.96)",border:"1px solid rgba(160,80,255,0.3)",borderRadius:14,padding:"20px 24px",maxWidth:340,textAlign:"center"},children:[o.jsx("div",{style:{fontSize:7,color:"rgba(160,80,255,0.5)",letterSpacing:"0.16em",textTransform:"uppercase",marginBottom:10},children:"Training  Active Learning"}),o.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:14},children:o.jsx("canvas",{ref:a,width:c,height:c,style:{background:"rgba(0,0,0,0.4)",borderRadius:8}})}),o.jsx("div",{style:{fontSize:10,color:"rgba(230,220,210,0.85)",marginBottom:14,lineHeight:1.5},children:t}),o.jsx("div",{style:{display:"flex",gap:6,justifyContent:"center",flexWrap:"wrap"},children:l.map(u=>o.jsx("button",{title:u,onClick:()=>n(u),style:{fontSize:9,padding:"5px 12px",borderRadius:6,cursor:"pointer",background:`${d[u]}18`,border:`1px solid ${d[u]}55`,color:d[u],letterSpacing:"0.1em",textTransform:"uppercase"},children:u},u))}),o.jsx("button",{title:"Pular",onClick:r,style:{marginTop:12,fontSize:8,background:"none",border:"none",cursor:"pointer",color:"rgba(200,190,180,0.3)",letterSpacing:"0.1em"},children:"PULAR"})]})})}const Oh=[{id:"select",icon:"",label:"Scry",color:"#94a3b8",desc:"Inspect any element on the Tree"},{id:"drag",icon:"",label:"Drag",color:"#e2e8f0",desc:"Move sephiroth and paths"},{id:"invoke",icon:"",label:"Invoke",color:"#ffd060",desc:"Channel energy into a sephirah"},{id:"banish",icon:"",label:"Banish",color:"#ff6040",desc:"Dispel blockages and excess"},{id:"trace",icon:"",label:"Trace",color:"#60c0ff",desc:"Draw the Lightning Flash path"},{id:"seal",icon:"",label:"Seal",color:"#34d399",desc:"Lock energy into crystalline form"},{id:"transmute",icon:"",label:"Transmute",color:"#a78bfa",desc:"Alchemical transformation of forces"},{id:"portal",icon:"",label:"Portal",color:"#f472b6",desc:"Open a gateway between worlds"}],Eu=[{id:"kether",num:1,label:"Kether",labelHeb:"",meaning:"The Crown",pillar:"balance",nx:.5,ny:.04,color:"#f0ece0",planet:"Primum Mobile",element:"Spirit",gdGrade:"10=1 Ipsissimus",divineName:"Eheieh",archangel:"Metatron"},{id:"chokmah",num:2,label:"Chokmah",labelHeb:"",meaning:"Wisdom",pillar:"mercy",nx:.83,ny:.17,color:"#d0c8a0",planet:"Fixed Stars / Zodiac",element:"Fire (primal)",gdGrade:"9=2 Magus",divineName:"Yah",archangel:"Ratziel"},{id:"binah",num:3,label:"Binah",labelHeb:"",meaning:"Understanding",pillar:"severity",nx:.17,ny:.17,color:"#303048",planet:"Saturn",element:"Water (primal)",gdGrade:"8=3 Magister Templi",divineName:"YHVH Elohim",archangel:"Tzaphkiel"},{id:"chesed",num:4,label:"Chesed",labelHeb:"",meaning:"Mercy",pillar:"mercy",nx:.83,ny:.4,color:"#6090d0",planet:"Jupiter",element:"Water",gdGrade:"7=4 Adeptus Exemptus",divineName:"El",archangel:"Tzadkiel"},{id:"geburah",num:5,label:"Geburah",labelHeb:"",meaning:"Severity",pillar:"severity",nx:.17,ny:.4,color:"#c03030",planet:"Mars",element:"Fire",gdGrade:"6=5 Adeptus Major",divineName:"Elohim Gibor",archangel:"Khamael"},{id:"tiphereth",num:6,label:"Tiphareth",labelHeb:"",meaning:"Beauty",pillar:"balance",nx:.5,ny:.52,color:"#e8c830",planet:"Sol",element:"Air",gdGrade:"5=6 Adeptus Minor",divineName:"YHVH Eloah va-Daath",archangel:"Raphael"},{id:"netzach",num:7,label:"Netzach",labelHeb:"",meaning:"Victory",pillar:"mercy",nx:.83,ny:.65,color:"#50a840",planet:"Venus",element:"Fire (lesser)",gdGrade:"4=7 Philosophus",divineName:"YHVH Tzabaoth",archangel:"Haniel"},{id:"hod",num:8,label:"Hod",labelHeb:"",meaning:"Splendour",pillar:"severity",nx:.17,ny:.65,color:"#b06820",planet:"Mercury",element:"Water (lesser)",gdGrade:"3=8 Practicus",divineName:"Elohim Tzabaoth",archangel:"Michael"},{id:"yesod",num:9,label:"Yesod",labelHeb:"",meaning:"The Foundation",pillar:"balance",nx:.5,ny:.78,color:"#8060c0",planet:"Luna",element:"Air (astral)",gdGrade:"2=9 Theoricus",divineName:"Shaddai El Chai",archangel:"Gabriel"},{id:"malkuth",num:10,label:"Malkuth",labelHeb:"",meaning:"The Kingdom",pillar:"balance",nx:.5,ny:.94,color:"#806040",planet:"Earth",element:"Earth",gdGrade:"1=10 Zelator",divineName:"Adonai ha-Aretz",archangel:"Sandalphon"}],Cl=new Map(Eu.map(e=>[e.id,e])),zu=[{pathId:11,from:"kether",to:"chokmah",arcanaId:0,hebrewLetter:"",pillarBias:"mercy",attribution:"Air (Element)"},{pathId:12,from:"kether",to:"binah",arcanaId:1,hebrewLetter:"",pillarBias:"severity",attribution:"Mercury (Planet)"},{pathId:13,from:"kether",to:"tiphereth",arcanaId:2,hebrewLetter:"",pillarBias:"balance",attribution:"Luna (Planet)"},{pathId:14,from:"chokmah",to:"binah",arcanaId:3,hebrewLetter:"",pillarBias:"all",attribution:"Venus (Planet)"},{pathId:15,from:"chokmah",to:"tiphereth",arcanaId:4,hebrewLetter:"",pillarBias:"mercy",attribution:"Aries (Zodiac)"},{pathId:16,from:"chokmah",to:"chesed",arcanaId:5,hebrewLetter:"",pillarBias:"mercy",attribution:"Taurus (Zodiac)"},{pathId:17,from:"binah",to:"tiphereth",arcanaId:6,hebrewLetter:"",pillarBias:"balance",attribution:"Gemini (Zodiac)"},{pathId:18,from:"binah",to:"geburah",arcanaId:7,hebrewLetter:"",pillarBias:"severity",attribution:"Cancer (Zodiac)"},{pathId:19,from:"chesed",to:"geburah",arcanaId:8,hebrewLetter:"",pillarBias:"all",attribution:"Leo (Zodiac)"},{pathId:20,from:"chesed",to:"tiphereth",arcanaId:9,hebrewLetter:"",pillarBias:"mercy",attribution:"Virgo (Zodiac)"},{pathId:21,from:"chesed",to:"netzach",arcanaId:10,hebrewLetter:"",pillarBias:"mercy",attribution:"Jupiter (Planet)"},{pathId:22,from:"geburah",to:"tiphereth",arcanaId:11,hebrewLetter:"",pillarBias:"balance",attribution:"Libra (Zodiac)"},{pathId:23,from:"geburah",to:"hod",arcanaId:12,hebrewLetter:"",pillarBias:"severity",attribution:"Water (Element)"},{pathId:24,from:"tiphereth",to:"netzach",arcanaId:13,hebrewLetter:"",pillarBias:"mercy",attribution:"Scorpio (Zodiac)"},{pathId:25,from:"tiphereth",to:"yesod",arcanaId:14,hebrewLetter:"",pillarBias:"balance",attribution:"Sagittarius (Zodiac)"},{pathId:26,from:"tiphereth",to:"hod",arcanaId:15,hebrewLetter:"",pillarBias:"severity",attribution:"Capricorn (Zodiac)"},{pathId:27,from:"netzach",to:"hod",arcanaId:16,hebrewLetter:"",pillarBias:"all",attribution:"Mars (Planet)"},{pathId:28,from:"netzach",to:"yesod",arcanaId:17,hebrewLetter:"",pillarBias:"mercy",attribution:"Aquarius (Zodiac)"},{pathId:29,from:"netzach",to:"malkuth",arcanaId:18,hebrewLetter:"",pillarBias:"mercy",attribution:"Pisces (Zodiac)"},{pathId:30,from:"hod",to:"yesod",arcanaId:19,hebrewLetter:"",pillarBias:"balance",attribution:"Sol (Planet)"},{pathId:31,from:"hod",to:"malkuth",arcanaId:20,hebrewLetter:"",pillarBias:"severity",attribution:"Fire (Element)"},{pathId:32,from:"yesod",to:"malkuth",arcanaId:21,hebrewLetter:"",pillarBias:"balance",attribution:"Saturn (Planet) / Earth"}],q5=new Map(zu.map(e=>[e.pathId,e]));new Map(zu.map(e=>[e.arcanaId,e.pathId]));const vk={mercy:["chokmah","chesed","netzach"],severity:["binah","geburah","hod"]},vE=[{id:0,canonicalName:"The Fool",hebrewLetter:"",symbol:"",pillarAffinity:"all",pathId:11,operator:{primary:"OPEN_GATE",secondary:"DIVERGE",magnitude:.72,reversed:{primary:"CLOSE_GATE",secondary:"DELAY",costFactor:.3}}},{id:1,canonicalName:"The Magician",hebrewLetter:"",symbol:"",pillarAffinity:"mercy",pathId:12,operator:{primary:"AMPLIFY",magnitude:.8,reversed:{primary:"SILENCE",secondary:"SLOW",costFactor:.25}}},{id:2,canonicalName:"The High Priestess",hebrewLetter:"",symbol:"",pillarAffinity:"balance",pathId:13,operator:{primary:"SILENCE",secondary:"MEMORY",magnitude:.7,reversed:{primary:"DIVERGE",secondary:"SHOCK",costFactor:.35}}},{id:3,canonicalName:"The Empress",hebrewLetter:"",symbol:"",pillarAffinity:"mercy",pathId:14,operator:{primary:"AMPLIFY",secondary:"OPEN_GATE",magnitude:.75,reversed:{primary:"CLOSE_GATE",secondary:"SLOW",costFactor:.2}}},{id:4,canonicalName:"The Emperor",hebrewLetter:"",symbol:"",pillarAffinity:"severity",pathId:15,operator:{primary:"CLOSE_GATE",secondary:"CONVERGE",magnitude:.78,reversed:{primary:"DIVERGE",secondary:"SHOCK",costFactor:.3}}},{id:5,canonicalName:"The Hierophant",hebrewLetter:"",symbol:"",pillarAffinity:"balance",pathId:16,operator:{primary:"RITUAL_PULSE",magnitude:.65,reversed:{primary:"DIVERGE",costFactor:.35}}},{id:6,canonicalName:"The Lovers",hebrewLetter:"",symbol:"",pillarAffinity:"all",pathId:17,operator:{primary:"BRIDGE",secondary:"CONVERGE",magnitude:.72,reversed:{primary:"CUT",secondary:"DIVERGE",costFactor:.4}}},{id:7,canonicalName:"The Chariot",hebrewLetter:"",symbol:"",pillarAffinity:"severity",pathId:18,operator:{primary:"OPEN_GATE",secondary:"SPEED",magnitude:.75,reversed:{primary:"DELAY",secondary:"CLOSE_GATE",costFactor:.3}}},{id:8,canonicalName:"Strength",hebrewLetter:"",symbol:"",pillarAffinity:"balance",pathId:19,operator:{primary:"BALANCE",magnitude:.8,reversed:{primary:"DIVERGE",secondary:"SHOCK",costFactor:.35}}},{id:9,canonicalName:"The Hermit",hebrewLetter:"",symbol:"",pillarAffinity:"balance",pathId:20,operator:{primary:"SILENCE",secondary:"SLOW",magnitude:.65,reversed:{primary:"OPEN_GATE",secondary:"DIVERGE",costFactor:.2}}},{id:10,canonicalName:"Wheel of Fortune",hebrewLetter:"",symbol:"",pillarAffinity:"all",pathId:21,operator:{primary:"SHOCK",magnitude:.6,reversed:{primary:"DELAY",secondary:"LOOP",costFactor:.3}}},{id:11,canonicalName:"Justice",hebrewLetter:"",symbol:"",pillarAffinity:"balance",pathId:22,operator:{primary:"BALANCE",secondary:"CLOSE_GATE",magnitude:.78,reversed:{primary:"DIVERGE",secondary:"LOOP",costFactor:.35}}},{id:12,canonicalName:"The Hanged Man",hebrewLetter:"",symbol:"",pillarAffinity:"severity",pathId:23,operator:{primary:"DELAY",secondary:"MEMORY",magnitude:.65,reversed:{primary:"SPEED",secondary:"OPEN_GATE",costFactor:.25}}},{id:13,canonicalName:"Death",hebrewLetter:"",symbol:"",pillarAffinity:"severity",pathId:24,operator:{primary:"CUT",magnitude:.85,reversed:{primary:"LOOP",secondary:"CLOSE_GATE",costFactor:.45}}},{id:14,canonicalName:"Temperance",hebrewLetter:"",symbol:"",pillarAffinity:"balance",pathId:25,operator:{primary:"BALANCE",secondary:"STABILIZE",magnitude:.8,reversed:{primary:"SHOCK",secondary:"DIVERGE",costFactor:.3}}},{id:15,canonicalName:"The Devil",hebrewLetter:"",symbol:"",pillarAffinity:"severity",pathId:26,operator:{primary:"CONVERGE",secondary:"LOOP",magnitude:.75,reversed:{primary:"OPEN_GATE",secondary:"DIVERGE",costFactor:.4}}},{id:16,canonicalName:"The Tower",hebrewLetter:"",symbol:"",pillarAffinity:"all",pathId:27,operator:{primary:"SHOCK",magnitude:.9,reversed:{primary:"STABILIZE",secondary:"CLOSE_GATE",costFactor:.2}}},{id:17,canonicalName:"The Star",hebrewLetter:"",symbol:"",pillarAffinity:"mercy",pathId:28,operator:{primary:"CONVERGE",magnitude:.6,reversed:{primary:"DIVERGE",secondary:"SILENCE",costFactor:.25}}},{id:18,canonicalName:"The Moon",hebrewLetter:"",symbol:"",pillarAffinity:"balance",pathId:29,operator:{primary:"LOOP",secondary:"DELAY",magnitude:.65,reversed:{primary:"CLARIFY",secondary:"CUT",costFactor:.35}}},{id:19,canonicalName:"The Sun",hebrewLetter:"",symbol:"",pillarAffinity:"mercy",pathId:30,operator:{primary:"CLARIFY",secondary:"AMPLIFY",magnitude:.8,reversed:{primary:"SILENCE",secondary:"CLOSE_GATE",costFactor:.2}}},{id:20,canonicalName:"Judgement",hebrewLetter:"",symbol:"",pillarAffinity:"balance",pathId:31,operator:{primary:"REVIEW",magnitude:.75,reversed:{primary:"LOOP",secondary:"DELAY",costFactor:.35}}},{id:21,canonicalName:"The World",hebrewLetter:"",symbol:"",pillarAffinity:"all",pathId:32,operator:{primary:"INTEGRATE",magnitude:.85,reversed:{primary:"CUT",secondary:"DIVERGE",costFactor:.4}}}],y0=new Map(vE.map(e=>[e.id,e])),hZ={id:"rws",label:"RiderWaiteSmith",description:"Imaginal narrative tradition. Story-rich, symbol-dense, accessible.",tradition:"Golden Dawn (A.E. Waite / Pamela Colman Smith)",mentorTone:"imaginal",bias:{operators:{}},majors:{0:{name:"The Fool",keywords:["leap","potential","spirit"],tone:"imaginal",microNote:"Spirit descending into matter  pure potential before the first step."},1:{name:"The Magician",keywords:["will","channel","As Above"],tone:"imaginal",microNote:`Mercury's power  "As Above, So Below." Focus of the adept.`},2:{name:"The High Priestess",keywords:["mystery","veil","memory"],tone:"imaginal",microNote:"Guardian of the veil between Kether and Tiphareth. Lunar gnosis."},3:{name:"The Empress",keywords:["abundance","venus","creation"],tone:"imaginal",microNote:"Venus bridges Chokmah and Binah  primal creative force."},4:{name:"The Emperor",keywords:["structure","aries","authority"],tone:"logical",microNote:"Aries fire of will forging order from chaos."},5:{name:"The Hierophant",keywords:["tradition","taurus","initiation"],tone:"ritual",microNote:"Hierophant of the Mysteries  the inner teacher transmits."},6:{name:"The Lovers",keywords:["union","gemini","choice"],tone:"imaginal",microNote:"Alchemical marriage of opposites. The path of discernment."},7:{name:"The Chariot",keywords:["triumph","cancer","willpower"],tone:"logical",microNote:"The victorious charioteer masters opposing forces."},8:{name:"Strength",keywords:["fortitude","leo","taming"],tone:"imaginal",microNote:"The lion and the maiden  mastery through love, not force."},9:{name:"The Hermit",keywords:["solitude","virgo","lantern"],tone:"imaginal",microNote:"Inner light illuminating the solitary path."},10:{name:"Wheel of Fortune",keywords:["cycle","jupiter","karma"],tone:"imaginal",microNote:"Jupiter's wheel turns  cycles of fortune and karma."},11:{name:"Justice",keywords:["balance","libra","truth"],tone:"logical",microNote:"Ma'at's scales  cosmic equilibrium enacted."},12:{name:"The Hanged Man",keywords:["surrender","water","inversion"],tone:"ritual",microNote:"Suspension between worlds  seeing from the Other Side."},13:{name:"Death",keywords:["transformation","scorpio","rebirth"],tone:"imaginal",microNote:"Scorpionic death of form  the alchemical nigredo."},14:{name:"Temperance",keywords:["alchemy","sagittarius","blend"],tone:"imaginal",microNote:"The Angel of Art  blending fire and water in the Great Work."},15:{name:"The Devil",keywords:["shadow","capricorn","bondage"],tone:"imaginal",microNote:"Chains of matter  recognise them to transcend."},16:{name:"The Tower",keywords:["lightning","mars","revelation"],tone:"imaginal",microNote:"The Lightning Flash destroys false structures."},17:{name:"The Star",keywords:["hope","aquarius","guidance"],tone:"imaginal",microNote:"Nuit pours forth the waters of life. Stellar consciousness."},18:{name:"The Moon",keywords:["illusion","pisces","threshold"],tone:"imaginal",microNote:"Astral tides and deception  the path through darkness."},19:{name:"The Sun",keywords:["clarity","sol","illumination"],tone:"imaginal",microNote:"Tiphareth's radiance  the inner sun fully revealed."},20:{name:"Judgement",keywords:["awakening","fire","resurrection"],tone:"ritual",microNote:"The trumpet calls  the dead rise in spiritual rebirth."},21:{name:"The World",keywords:["completion","saturn","wholeness"],tone:"imaginal",microNote:"Saturn's completion  the dancer in the cosmic mandala."}}},fZ={id:"marseille",label:"Marseille",description:"Structural-archetype tradition. Precise, architectural, classical.",tradition:"French esoteric tradition (Eliphas Lvi / Papus)",mentorTone:"logical",bias:{operators:{CLOSE_GATE:1.1,CUT:1.1,BALANCE:1.1}},majors:{0:{name:"Le Mat",keywords:["errance","zero","departure"],tone:"logical",microNote:"The unmapped wanderer at the edge of the Abyss."},1:{name:"Le Bateleur",keywords:["skill","tools","craft"],tone:"logical",microNote:"The artisan of the elements  mastery of the table."},2:{name:"La Papesse",keywords:["secret","book","threshold"],tone:"logical",microNote:"Hidden knowledge guarded behind the temple veil."},3:{name:"L'Impratrice",keywords:["reign","fertility","form"],tone:"logical",microNote:"Fertile form generating structure across worlds."},4:{name:"L'Empereur",keywords:["empire","law","stone"],tone:"logical",microNote:"Architected order  the cubic stone of foundation."},5:{name:"Le Pape",keywords:["keys","rite","transmission"],tone:"ritual",microNote:"Ritual transmission between inner and outer orders."},6:{name:"L'Amoureux",keywords:["choice","fork","duality"],tone:"logical",microNote:"The crossroads where the adept must choose."},7:{name:"Le Chariot",keywords:["movement","mastery","direction"],tone:"logical",microNote:"Directed force traversing the path between pillars."},8:{name:"La Justice",keywords:["sword","scales","measure"],tone:"logical",microNote:"Structural equilibration  the blade of discernment."},9:{name:"L'Ermite",keywords:["retreat","lamp","patience"],tone:"logical",microNote:"Solitary watchman with the lamp of Hermes."},10:{name:"La Roue de Fortune",keywords:["cycle","reversal","fate"],tone:"logical",microNote:"The wheel turns  ascent and descent are one motion."},11:{name:"La Force",keywords:["endurance","gentleness","grip"],tone:"logical",microNote:"Silent mastery of the inner beast through patience."},12:{name:"Le Pendu",keywords:["inversion","waiting","release"],tone:"ritual",microNote:"Suspended between worlds  memory deepens."},13:{name:"L'Arcane sans nom",keywords:["scythe","passage","harvest"],tone:"logical",microNote:"The unnamed force reaping what is no longer needed."},14:{name:"La Temprance",keywords:["flow","mixing","measure"],tone:"logical",microNote:"Steady blending of opposing currents."},15:{name:"Le Diable",keywords:["chains","shadow","attraction"],tone:"logical",microNote:"Bound by material attachment  the shadow is the teacher."},16:{name:"La Maison-Dieu",keywords:["lightning","collapse","opening"],tone:"logical",microNote:"The House of God struck open by divine fire."},17:{name:"L'toile",keywords:["hope","pouring","star"],tone:"logical",microNote:"Patient coherence poured into the great work."},18:{name:"La Lune",keywords:["illusion","drift","nocturne"],tone:"logical",microNote:"Nocturnal ambiguity  the path through the waters."},19:{name:"Le Soleil",keywords:["clarity","bloom","day"],tone:"logical",microNote:"Diurnal clarity  the twin pillars illuminated."},20:{name:"Le Jugement",keywords:["awakening","review","trumpet"],tone:"ritual",microNote:"Review and consolidation at the threshold of rebirth."},21:{name:"Le Monde",keywords:["totality","dance","completion"],tone:"logical",microNote:"Total integration as cosmic dance."}}},pZ={id:"thoth",label:"Thoth",description:"Alchemical-energetic tradition. Transformative, intense, esoteric.",tradition:"Thelemic tradition (Aleister Crowley / Frieda Harris)",mentorTone:"ritual",bias:{operators:{AMPLIFY:1.1,SHOCK:1.1,LOOP:1.1}},majors:{0:{name:"The Fool",keywords:["spirit","limitless","aethyr"],tone:"ritual",microNote:"Pure spirit before manifestation  Aleph, the breath."},1:{name:"The Magus",keywords:["mercury","logos","power"],tone:"ritual",microNote:"The Word as focused operator  Beth, the house of the Magus."},2:{name:"The Priestess",keywords:["moon","silver","gnosis"],tone:"ritual",microNote:"Lunar gnosis behind the veil of Paroketh."},3:{name:"The Empress",keywords:["venus","daleth","gateway"],tone:"ritual",microNote:"Venus as the luminous gateway of creation."},4:{name:"The Emperor",keywords:["aries","heh","vision"],tone:"logical",microNote:"Constituting Intelligence  the window of sight."},5:{name:"The Hierophant",keywords:["taurus","vau","nail"],tone:"ritual",microNote:"The Nail that fixes spirit into form  inner teaching."},6:{name:"The Lovers",keywords:["gemini","zayin","sword"],tone:"ritual",microNote:"The Sword that divides and reunites  alchemical solve."},7:{name:"The Chariot",keywords:["cancer","grail","triumph"],tone:"ritual",microNote:"The Holy Grail borne across the Abyss."},8:{name:"Lust",keywords:["leo","babalon","ecstasy"],tone:"ritual",microNote:"Babalon rides the Beast  creative fire unleashed."},9:{name:"The Hermit",keywords:["virgo","yod","seed"],tone:"ritual",microNote:"The Seed of Light hidden in the darkness of the earth."},10:{name:"Fortune",keywords:["jupiter","kaph","wheel"],tone:"ritual",microNote:"Jupiter's wheel  the three gunas in rotation."},11:{name:"Adjustment",keywords:["libra","lamed","equilibrium"],tone:"logical",microNote:"Adjustment of all imbalance  the Daughter of the Lords."},12:{name:"The Hanged Man",keywords:["water","mem","sacrifice"],tone:"ritual",microNote:"Redemption through water  the drowned god rises."},13:{name:"Death",keywords:["scorpio","nun","putrefaction"],tone:"ritual",microNote:"Putrefactio  the alchemical black dissolves false form."},14:{name:"Art",keywords:["sagittarius","samekh","opus"],tone:"ritual",microNote:"The Art of transmutation  rainbow of the Great Work."},15:{name:"The Devil",keywords:["capricorn","ayin","matter"],tone:"ritual",microNote:"Lord of the Gates of Matter  creative energy in chains."},16:{name:"The Tower",keywords:["mars","peh","destruction"],tone:"ritual",microNote:"War-engine of Mars  the lightning flash liberates."},17:{name:"The Star",keywords:["aquarius","tzaddi","nuit"],tone:"ritual",microNote:'Nuit reveals herself  "Every man and every woman is a star."'},18:{name:"The Moon",keywords:["pisces","qoph","midnight"],tone:"ritual",microNote:"Midnight sun behind the gates of dream and illusion."},19:{name:"The Sun",keywords:["sol","resh","glory"],tone:"ritual",microNote:"Ra-Hoor-Khuit in full radiance  the crowned child."},20:{name:"The Aeon",keywords:["fire","shin","horus"],tone:"ritual",microNote:"The Aeon of Horus  the crowned and conquering child."},21:{name:"The Universe",keywords:["saturn","tav","completion"],tone:"ritual",microNote:"Saturn's cosmic dance  the Universe as complete temple."}}},SE=[hZ,fZ,pZ],H5=new Map(SE.map(e=>[e.id,e]));function mZ(e,t){return{id:e,charge:.3,coherence:.2,tension:.15,openness:.5,memory:.1,...t}}function gZ(e){return{pathId:e,flow:.2,blockage:.1,pulseAcc:0,recentOps:[]}}function wE(e){const t=new Map;for(const a of Eu)t.set(a.id,mZ(a.id));const n=t.get("malkuth");n.charge=.55,n.openness=.65;const r=new Map;for(const a of zu)r.set(a.pathId,gZ(a.pathId));return{sephirot:t,paths:r,tick:0,time:0,globalCoherence:.2,globalTension:.15,expansionAccum:0,severityAccum:0,events:[],novelty:0,veilsEnabled:e.veilsEnabled,pillarsEnabled:e.pillarsEnabled}}function kx(e,t){Object.assign(e,wE(t))}function yZ(e){return vk.mercy.includes(e)?{mercy:.12,severity:0}:vk.severity.includes(e)?{mercy:0,severity:.12}:{mercy:.06,severity:.06}}function uw(e){let t=0,n=0,r=0;for(const i of e.sephirot.values())t+=i.coherence,n+=i.tension,r++;const a=e.globalCoherence;e.globalCoherence=t/r,e.globalTension=n/r,e.novelty=Math.abs(e.globalCoherence-a)*10}function bZ(e,t,n){e.time+=t,e.tick++;const r=n.ritualIntensity??.5,a=n.astralClarity??.5;for(const l of e.sephirot.values()){const d=yZ(l.id),u=e.pillarsEnabled?d.mercy*.08:0,h=e.pillarsEnabled?d.severity*.08:0;l.charge=nn(l.charge-.005*t+u*t*.5),l.coherence=nn(l.coherence-.003*t+u*t+h*t*.5+a*.002*t),l.tension=nn(l.tension-.004*t+h*t),l.openness=nn(l.openness+(.5-l.openness)*.01*t),l.memory=nn(l.memory-.002*t)}for(const l of e.paths.values())l.pulseAcc+=t,l.blockage=nn(l.blockage-.005*t),l.flow=nn(l.flow+(.2-l.flow)*.01*t),l.recentOps.length>3&&(l.recentOps=l.recentOps.slice(-3));const i=e.sephirot.get("chesed"),s=e.sephirot.get("geburah");i.charge>.7?e.expansionAccum+=t:e.expansionAccum=Math.max(0,e.expansionAccum-t*.5),s.tension>.7?e.severityAccum+=t:e.severityAccum=Math.max(0,e.severityAccum-t*.5),e.expansionAccum>18&&(e.expansionAccum=0,Yp(e,"DISSOLUTION","Chesed overflow: Mercy without Severity dissolves form. Apply Banish or Seal to restore balance.")),e.severityAccum>18&&(e.severityAccum=0,Yp(e,"CRYSTALLIZATION","Geburah excess: Severity crystallises the astral field. Invoke or open gates to restore flow."));const c=[...e.sephirot.values()].reduce((l,d)=>l+d.openness,0)/10;if(e.globalCoherence>.6&&c>.6&&r>.4&&Math.random()<t*.05){Yp(e,"GREAT_WORK_PULSE","The Great Work resonates  a pulse of alchemical harmony radiates through the Tree.");for(const l of e.sephirot.values())l.charge=nn(l.charge+.02),l.coherence=nn(l.coherence+.01)}uw(e)}function xZ(e,t,n){const r=y0.get(t.arcanaId);if(!r)return;const a=H5.get(t.lensId),i=(a==null?void 0:a.bias.operators)??{},s=t.reversed?r.operator.reversed:r.operator,l=((t.reversed?r.operator.reversed.costFactor:r.operator.magnitude)??.7)*(n.strictness*.4+.6)*(1+(n.ritualIntensity??.5)*.3);if(t.targetType==="sephirah"){const d=e.sephirot.get(t.targetId);d&&(Rx(d,s.primary,l,i),s.secondary&&Rx(d,s.secondary,l*.5,i),t.reversed&&(d.tension=nn(d.tension+r.operator.reversed.costFactor*.3)))}else if(t.targetType==="path"){const d=e.paths.get(t.targetId);d&&(wk(d,s.primary,l,i),s.secondary&&wk(d,s.secondary,l*.5,i))}else{const d=l*.35;for(const u of e.sephirot.values())Rx(u,s.primary,d,i)}uw(e),e.veilsEnabled&&vZ(e)}function Sk(e,t,n,r,a){const i=a.ritualIntensity??.5;if(r==="sephirah"){const s=e.sephirot.get(n);if(!s)return;switch(t){case"invoke":s.charge=nn(s.charge+.15*i),s.openness=nn(s.openness+.08*i);break;case"banish":s.tension=nn(s.tension-.15*i),s.blockage&&(s.memory=nn(s.memory-.05)),s.memory=nn(s.memory-.08*i);break;case"seal":s.coherence=nn(s.coherence+.12*i),s.openness=nn(s.openness-.06*i);break;case"transmute":const c=Math.max(s.tension-.3,0);s.tension=nn(s.tension-c*.6),s.charge=nn(s.charge+c*.4),s.coherence=nn(s.coherence+c*.2);break;case"portal":s.openness=nn(s.openness+.2*i),s.charge=nn(s.charge+.1*i),s.tension=nn(s.tension+.05*i);break;case"trace":s.charge=nn(s.charge+.08*i),s.coherence=nn(s.coherence+.05*i);break}}else{const s=e.paths.get(n);if(!s)return;switch(t){case"invoke":s.flow=nn(s.flow+.15*i),s.blockage=nn(s.blockage-.08*i);break;case"banish":s.blockage=nn(s.blockage-.2*i),s.flow=nn(s.flow+.05*i);break;case"seal":s.blockage=nn(s.blockage+.12*i);break;case"transmute":s.flow=nn(s.flow+.1*i),s.blockage=nn(s.blockage*(1-.3*i));break;case"portal":s.flow=nn(s.flow+.2*i),s.blockage=nn(s.blockage-.15*i);break;case"trace":s.flow=nn(s.flow+.12*i);break}}uw(e)}function ME(e,t){return t[e]??1}function Rx(e,t,n,r){const a=n*ME(t,r);switch(t){case"OPEN_GATE":e.openness=nn(e.openness+a*.5);break;case"CLOSE_GATE":e.openness=nn(e.openness-a*.4);break;case"AMPLIFY":e.charge=nn(e.charge+a*.6),e.coherence=nn(e.coherence+a*.2);break;case"SILENCE":e.tension=nn(e.tension-a*.4),e.charge=nn(e.charge-a*.2);break;case"CONVERGE":e.coherence=nn(e.coherence+a*.5);break;case"DIVERGE":e.coherence=nn(e.coherence-a*.3),e.tension=nn(e.tension+a*.2);break;case"CUT":e.memory=nn(e.memory-a*.6),e.tension=nn(e.tension-a*.3);break;case"BALANCE":e.tension=nn(e.tension-a*.4),e.coherence=nn(e.coherence+a*.3);break;case"SHOCK":e.tension=nn(e.tension+a*.5),e.charge=nn(e.charge+a*.4);break;case"LOOP":e.memory=nn(e.memory+a*.4);break;case"MEMORY":e.memory=nn(e.memory+a*.5);break;case"STABILIZE":e.tension=nn(e.tension*(1-a*.3)),e.coherence=nn(e.coherence+a*.2);break;case"CLARIFY":e.coherence=nn(e.coherence+a*.4),e.tension=nn(e.tension-a*.3);break;case"REVIEW":e.memory=nn(e.memory+a*.3),e.coherence=nn(e.coherence+a*.2);break;case"INTEGRATE":e.coherence=nn(e.coherence+a*.5),e.memory=nn(e.memory+a*.3),e.tension=nn(e.tension*(1-a*.4));break;case"SPEED":e.openness=nn(e.openness+a*.3);break;case"SLOW":e.openness=nn(e.openness-a*.2),e.memory=nn(e.memory+a*.2);break;case"DELAY":e.openness=nn(e.openness-a*.3),e.memory=nn(e.memory+a*.4);break;case"BRIDGE":e.openness=nn(e.openness+a*.4),e.coherence=nn(e.coherence+a*.2);break;case"RITUAL_PULSE":e.charge=nn(e.charge+a*.3),e.memory=nn(e.memory+a*.2);break;case"INVOKE":e.charge=nn(e.charge+a*.5),e.openness=nn(e.openness+a*.3);break;case"BANISH":e.tension=nn(e.tension-a*.5),e.memory=nn(e.memory-a*.3);break;case"TRANSMUTE":{const i=Math.max(e.tension-.3,0)*a;e.tension=nn(e.tension-i),e.charge=nn(e.charge+i*.5),e.coherence=nn(e.coherence+i*.3);break}case"SEAL":e.coherence=nn(e.coherence+a*.4),e.openness=nn(e.openness-a*.2);break}}function wk(e,t,n,r){const a=n*ME(t,r);switch(e.recentOps=[...e.recentOps.slice(-2),t],t){case"OPEN_GATE":e.flow=nn(e.flow+a*.5),e.blockage=nn(e.blockage-a*.3);break;case"CLOSE_GATE":e.flow=nn(e.flow-a*.4);break;case"CUT":e.blockage=nn(e.blockage+a*.5),e.flow=nn(e.flow-a*.4);break;case"AMPLIFY":e.flow=nn(e.flow+a*.6);break;case"DELAY":e.blockage=nn(e.blockage+a*.4);break;case"SPEED":e.flow=nn(e.flow+a*.6),e.blockage=nn(e.blockage-a*.2);break;case"RITUAL_PULSE":e.pulseAcc=0,e.flow=nn(e.flow+a*.3);break;case"INVOKE":e.flow=nn(e.flow+a*.5),e.blockage=nn(e.blockage-a*.2);break;case"BANISH":e.blockage=nn(e.blockage-a*.5),e.flow=nn(e.flow+a*.1);break;case"TRANSMUTE":e.flow=nn(e.flow+a*.3),e.blockage=nn(e.blockage*(1-a*.4));break;case"SEAL":e.blockage=nn(e.blockage+a*.3);break;default:e.flow=nn(e.flow+a*.2);break}}function vZ(e){const t=["kether","chokmah","binah","chesed","geburah"];for(const r of t){const a=e.sephirot.get(r);e.globalCoherence<.45&&a.charge>.65&&(a.charge=.65,Yp(e,"VEIL_BREACH",`Veil of Paroketh: insufficient coherence (${(e.globalCoherence*100).toFixed(0)}%) to sustain charge in ${r}. Strengthen the lower Tree first.`))}const n=e.sephirot.get("kether");e.globalTension>.55&&n.charge>.5&&(n.charge=.5,Yp(e,"VEIL_BREACH",`Veil of the Abyss: tension too high (${(e.globalTension*100).toFixed(0)}%) to access Kether. Purify the astral before attempting the crossing.`))}function Yp(e,t,n){e.events=[...e.events.slice(-19),{id:Date.now().toString(),kind:t,timestamp:Date.now(),description:n}]}function nn(e){return Math.max(0,Math.min(1,e))}function Ul(e){let t=0,n=0,r=0;for(const a of e.sephirot.values())t+=a.memory,n+=a.openness,r++;return{coherence:e.globalCoherence,tension:e.globalTension,memory:t/r,openness:n/r,novelty:e.novelty}}let Ax=Date.now();function Mk(){return Ax=Ax*1664525+1013904223&4294967295,(Ax>>>0)/4294967295}function Sp(e,t=[]){const n=Array.from({length:22},(a,i)=>i).filter(a=>!t.includes(a)),r=[];for(;r.length<e&&n.length>0;){const a=Math.floor(Mk()*n.length);r.push({id:n[a],reversed:Mk()<.25}),n.splice(a,1)}return r}const SZ=[{id:"neophyte",name:"Neophyte Awakening",emoji:"",description:"Enter at Malkuth. First steps on the path. Gentle, exploratory.",recommendedLens:"rws",drawRate:3,strictness:.35,veilsEnabled:!1,pillarsEnabled:!0,gdGrade:"0=0 Neophyte",ritualTheme:"Purification and dedication",initialState:{malkuth:{charge:.6,coherence:.3,tension:.1,openness:.65,memory:.15},yesod:{charge:.25,coherence:.15,openness:.45},tiphereth:{charge:.1,coherence:.1,openness:.3}}},{id:"middlepillar",name:"Middle Pillar Ritual",emoji:"",description:"Kether to Malkuth along the axis of equilibrium. Classic GD practice.",recommendedLens:"rws",drawRate:3,strictness:.5,veilsEnabled:!0,pillarsEnabled:!0,gdGrade:"2=9 Theoricus",ritualTheme:"Equilibrium and circulation of light",initialState:{kether:{charge:.4,coherence:.55,tension:.05,openness:.5,memory:.25},tiphereth:{charge:.5,coherence:.45,tension:.15,openness:.6},yesod:{charge:.45,coherence:.35,tension:.15,openness:.55},malkuth:{charge:.55,coherence:.3,tension:.15,openness:.65}}},{id:"lbrp",name:"Lesser Banishing",emoji:"",description:"Cleanse the astral temple. High structure, Marseille precision.",recommendedLens:"marseille",drawRate:3,strictness:.7,veilsEnabled:!1,pillarsEnabled:!0,gdGrade:"1=10 Zelator",ritualTheme:"Banishing and protection",initialState:{geburah:{charge:.5,coherence:.4,tension:.3,openness:.4},binah:{charge:.35,coherence:.35,tension:.2},malkuth:{charge:.55,coherence:.4,tension:.2}}},{id:"alchemical",name:"Alchemical Great Work",emoji:"",description:"Solve et Coagula. Thoth lens. High energy transformative flux.",recommendedLens:"thoth",drawRate:5,strictness:.35,veilsEnabled:!1,pillarsEnabled:!1,gdGrade:"5=6 Adeptus Minor",ritualTheme:"Nigredo, Albedo, Rubedo  the alchemical stages",initialState:{netzach:{charge:.7,coherence:.2,tension:.4,openness:.8},chesed:{charge:.6,coherence:.25,tension:.3},tiphereth:{charge:.55,coherence:.3,tension:.25}}},{id:"astralvision",name:"Astral Scrying",emoji:"",description:"Yesod-centred dreamwork. Moon cycles, memory loops, subtle visions.",recommendedLens:"rws",drawRate:4,strictness:.3,veilsEnabled:!1,pillarsEnabled:!0,gdGrade:"2=9 Theoricus",ritualTheme:"Lunar scrying and astral travel",initialState:{yesod:{charge:.65,coherence:.15,tension:.2,memory:.55,openness:.6},hod:{charge:.4,coherence:.2,tension:.25,memory:.35},netzach:{charge:.45,coherence:.15,tension:.3,memory:.3}}},{id:"abysscrossing",name:"Crossing the Abyss",emoji:"",description:"Maximum challenge. Veils on, high tension. Dare the Dweller on the Threshold.",recommendedLens:"thoth",drawRate:5,strictness:.9,veilsEnabled:!0,pillarsEnabled:!0,gdGrade:"8=3 Magister Templi",ritualTheme:"Dissolution of ego at the Abyss",initialState:{geburah:{charge:.8,tension:.6,coherence:.1,openness:.25},binah:{charge:.7,tension:.5,coherence:.15,openness:.3},malkuth:{charge:.65,tension:.45,coherence:.2,openness:.35}}},{id:"rosecross",name:"Rose Cross Meditation",emoji:"",description:"Tiphareth-centred heart ritual. Balance, beauty, and the inner sun.",recommendedLens:"rws",drawRate:4,strictness:.45,veilsEnabled:!1,pillarsEnabled:!0,gdGrade:"5=6 Adeptus Minor",ritualTheme:"The Rosy Cross  union of opposites at the heart",initialState:{tiphereth:{charge:.65,coherence:.5,tension:.1,openness:.7,memory:.3},chesed:{charge:.4,coherence:.35,tension:.15},geburah:{charge:.4,coherence:.35,tension:.15},netzach:{charge:.35,coherence:.25,openness:.55},hod:{charge:.35,coherence:.25,openness:.55}}},{id:"elemental",name:"Elemental Initiation",emoji:"",description:"Journey through Earth, Water, Air, Fire. Four lower grades in sequence.",recommendedLens:"marseille",drawRate:4,strictness:.55,veilsEnabled:!1,pillarsEnabled:!0,gdGrade:"1=10 to 4=7",ritualTheme:"Elemental grades and purification",initialState:{malkuth:{charge:.55,coherence:.35,tension:.15,openness:.5},yesod:{charge:.4,coherence:.25,tension:.2,openness:.5},hod:{charge:.35,coherence:.2,tension:.25,openness:.45},netzach:{charge:.35,coherence:.2,tension:.25,openness:.45}}}],jx={deckLens:"rws",preset:"neophyte",veilsEnabled:!1,pillarsEnabled:!0,drawRate:3,strictness:.4,ritualIntensity:.5,astralClarity:.5,speed:1},la=Math.PI*2,jy=540,Ey=900,na=26;function Tc(e){return e*jy-jy*.5}function Ic(e){return e*Ey-Ey*.5}function CE(e,t,n,r){const a=(e+n)/2,i=(t+r)/2,s=Math.sqrt(a*a+i*i)+1,c=22;return{x:a+a/s*c,y:i+i/s*c}}function W5(e,t,n,r,a,i,s){const c=1-e;return{x:c*c*t+2*c*e*r+e*e*i,y:c*c*n+2*c*e*a+e*e*s}}const kE="tol_grimoire_v3";function wZ(){try{return JSON.parse(localStorage.getItem(kE)??"[]")}catch{return[]}}function Ck(e){try{localStorage.setItem(kE,JSON.stringify(e.slice(-60)))}catch{}}function MZ(e,t){return e==="mercy"||t==="mercy"?[80,150,255]:e==="severity"||t==="severity"?[220,70,60]:[220,185,80]}const CZ={kether:{world:"Atziluth  Archetypal Plane",plane:"The Limitless Light / LVX",divineName:'Eheieh  "I Am"',archangel:"Metatron  Angel of the Presence",gdGrade:"10=1 Ipsissimus",planet:"Primum Mobile  the First Swirlings",body:"Crown of the Head (Sahasrara)",color:"#f0ece0",summary:"The Crown  point of first emanation from the Limitless Light. Beyond thought, beyond form.",spiritual:'Kether is the first point where the Infinite concentrates itself to create. It is pure undifferentiated consciousness  the "I" before any experience. The Ipsissimus grade represents unity with the All. As the Emerald Tablet teaches: that which is Above is as that which is Below  and Kether is the ultimate Above. It cannot be grasped by the mind, only touched through the deepest meditation.',lightningFlash:"Kether is the SOURCE of the Lightning Flash. The Limitless Light (LVX) descends from the unmanifest, striking like lightning through all 10 Sephiroth until it grounds in Malkuth. This is the descent of spirit into matter  the Great Work begins here.",serpentOfWisdom:"When the Serpent of Wisdom returns, Kether RECEIVES it back, completing the sacred cycle. The light returns to its origin, transformed by the full experience of Creation. This is the completion of the Great Work  the Magnum Opus.",practice:"Observe how Kether's charge flows to Chokmah and Binah. Apply INVOKE or CLARIFY to initiate the Lightning Flash. High coherence in Kether means the descending light flows freely."},chokmah:{world:"Atziluth  Archetypal Plane",plane:"The Zodiac / Fixed Stars",divineName:"Yah  the first flash of awareness",archangel:"Ratziel  Secret of God",gdGrade:"9=2 Magus",planet:"Fixed Stars / Zodiac",body:"Right hemisphere  creative intuition",color:"#d0c8a0",summary:"Wisdom  the primal flash of existence, the dynamic force from which all possibility emerges.",spiritual:'Chokmah is the Supernal Father  primal masculine force, the first differentiation. In the Magus grade, one wields the Word of creation. It is Wisdom not as knowledge but as the raw flash of insight, the lightning-bolt of inspiration. On the Pillar of Mercy, it represents unlimited expansive force. "Every man and every woman is a star"  Chokmah is the stellar force within.',lightningFlash:"Receives the Lightning Flash from Kether as an unfiltered ray  immediate, blazing. On the Pillar of Mercy, Chokmah transmits this fire to Binah (which gives it form) and to Chesed (which expands it). It is the Supernal Father.",serpentOfWisdom:'Reflects the Serpent of Wisdom back to Kether: all wisdom gathered through manifestation returns to the source, enriching the Divine Mind. The Wisdom that descended returns as deep gnosis  "As Above, So Below."',practice:"INVOKE and AMPLIFY at Chokmah expand the flow on the Pillar of Mercy. Observe how its charge feeds Chesed below. High charge here accelerates the Lightning Flash."},binah:{world:"Atziluth  Archetypal Plane",plane:"Saturnian Sphere",divineName:"YHVH Elohim  the formative divine principle",archangel:"Tzaphkiel  Beholder of God",gdGrade:"8=3 Magister Templi",planet:"Saturn  limitation, form and time",body:"Left hemisphere  structure and reason",color:"#5055a0",summary:"Understanding  the Great Mother, the womb in which all forms are gestated. Across the Abyss.",spiritual:"Binah is the Supernal Mother who gives birth to all forms. She is both Aima (the Bright Mother) and Ama (the Dark Mother). The Magister Templi has crossed the Abyss and surrendered all to the Cup of Babalon. Saturn gives her dominion over time and boundary  without Binah, nothing could take shape, and therefore nothing could exist. She is the Great Sea, the root of Water.",lightningFlash:'Receives the Lightning Flash from Kether and Chokmah. Binah "gives birth" to forms: here the formless light gains structure that will descend through the worlds. It is the first "No" that creates boundaries and makes existence possible.',serpentOfWisdom:'Receiving the Serpent of Wisdom from below, Binah recognizes the completed patterns  full "understanding" of the cycle. She seals the comprehension before passing it to Kether: all experience understood and integrated.',practice:"MEMORY and SEAL at Binah crystallize patterns. CLOSE_GATE here creates structuring limitation. High coherence in Binah means stable forms flowing through the Tree."},chesed:{world:"Beriah  Creative Plane",plane:"Jovian Sphere",divineName:"El  God of Grace and Abundance",archangel:"Tzadkiel  Righteousness of God",gdGrade:"7=4 Adeptus Exemptus",planet:"Jupiter  expansion, blessing and abundance",body:"Right arm  the arm that gives",color:"#6090d0",summary:"Mercy  unconditional love, expansion and divine grace. The benevolent King.",spiritual:"Chesed is divine love in its most generous form  the Adeptus Exemptus embodies this masterful compassion. The archetype of the benevolent ruler who gives freely. In the Golden Dawn, this is where the Adept begins to command the forces below with wisdom. Without Geburah to balance it, Chesed would become infinite indulgence, dissolving all structure.",lightningFlash:"Receives the Lightning Flash from the Supernals via direct path. On the Pillar of Mercy, Chesed expands the flow of light, making it more accessible and abundant for the lower Sephiroth.",serpentOfWisdom:"Chesed reflects the ascending Serpent as accumulated love and compassion  all experience of giving and receiving returns as gratitude to the Creator. Human love is the ascending light  divine grace reflected back.",practice:"AMPLIFY at Chesed expands flow for the entire Mercy column. Balance with Geburah via path 19 (Strength/Lust). High charge here benefits Netzach and Tiphereth."},geburah:{world:"Beriah  Creative Plane",plane:"Martian Sphere",divineName:"Elohim Gibor  God of Strength and Judgment",archangel:"Khamael  Burner of God",gdGrade:"6=5 Adeptus Major",planet:"Mars  strength, courage and delimitation",body:"Left arm  the arm that cuts",color:"#c03030",summary:"Severity  strength, justice and the necessary limitation that gives meaning to existence.",spiritual:'Geburah is the divine principle of restriction and justice. What Chesed expands, Geburah delimits. The Adeptus Major wields the Sword of discernment. Also called Pachad (Fear) or Din (Judgment)  not cruelty, but precision. As the alchemists say, solve et coagula: Geburah is the "solve," the dissolution of the unnecessary.',lightningFlash:'Receives the Lightning Flash from Binah and Chesed. Geburah "cuts" and refines the light, removing what is not essential  like the smith forging steel with fire and hammer. The light passing through Geburah becomes more concentrated and powerful.',serpentOfWisdom:'Geburah reflects the ascending Serpent as discernment and clarity. The power to distinguish, to judge wisely, to say "no" when needed  all returns to the Source as purity. What was pruned was limiting growth.',practice:"CUT and BANISH at Geburah remove blockages. SHOCK for strong interventions. High tension here may indicate excessive severity  balance with Chesed via path 19."},tiphereth:{world:"Beriah  Creative Plane",plane:"Solar Sphere",divineName:"YHVH Eloah va-Daath  the Mediator",archangel:"Raphael  Healer of God",gdGrade:"5=6 Adeptus Minor",planet:"Sun  the center, beauty, harmony",body:"Heart and chest  the vital center",color:"#e8c830",summary:"Beauty  heart of the Tree, point of perfect balance between the Lightning Flash and the Serpent of Wisdom.",spiritual:'Tiphereth is the Sun of the Tree of Life  the center where ALL forces equilibrate. It is the meeting point of the descending Lightning Flash and the ascending Serpent of Wisdom. The Adeptus Minor stands at the crossroads of the universe. It corresponds to the solar archetype  Osiris, the Christos, the resurrected King. The Great Work of the Golden Dawn centers here: "To know, to will, to dare, to keep silence."',lightningFlash:"Tiphereth is the CENTER of the descending flow. All light from Kether, Chokmah, Binah, Chesed and Geburah converges here  like sunlight illuminating all planets from the center.",serpentOfWisdom:'Tiphereth is the TURNING POINT of the Serpent of Wisdom. Here the light received from Netzach, Hod and Yesod is transmuted and elevated. The heart that has integrated all experience of the lower worlds begins the great return. This is the "Fiat LVX" of the ascending light.',practice:"BALANCE and INTEGRATE at Tiphereth affect the entire Tree. This is the most important hub. AMPLIFY here has global effect. Observe how its charge synchronizes with Kether above and Yesod below."},netzach:{world:"Yetzirah  Formative Plane",plane:"Venusian Sphere",divineName:"YHVH Tzabaoth  Lord of Hosts",archangel:"Haniel  Grace of God",gdGrade:"4=7 Philosophus",planet:"Venus  beauty, desire, instinct and nature",body:"Right hip  the generative force",color:"#50a840",summary:"Victory  instinct, emotion, the force of nature and the persistence of divine desire.",spiritual:'Netzach is the realm of emotions, wild nature, sensory beauty and instinct. The Philosophus grade explores the fire of desire and passion. It is where the nature deities dwell  archetypes, elementals, natural forces. The "victory" is the persistence of divine will to manifest. In astral vision, Netzach reveals the green ray of creative force.',lightningFlash:'Receives the Lightning Flash from Chesed, Tiphereth and partially from Geburah. Here the light becomes emotional and instinctive  it is the "feeling" of Creation, the divine pleasure in its works.',serpentOfWisdom:"Netzach reflects the ascending Serpent as love for creation, beauty and instinctive gratitude. The purest emotions  awe, ecstasy, love of life  flow back to the Source. Human desire for the Divine is the ascending Serpent of Netzach.",practice:"INVOKE at Netzach releases creative expression and emotional flow. AMPLIFY here empowers the entire lower Mercy column. Observe how it feeds Hod via path 27 (The Tower)."},hod:{world:"Yetzirah  Formative Plane",plane:"Mercurial Sphere",divineName:"Elohim Tzabaoth  God of Form and Order",archangel:"Michael  Who is like God",gdGrade:"3=8 Practicus",planet:"Mercury  communication, reason and analysis",body:"Left hip  analytical precision",color:"#b06820",summary:"Splendor  intellect, language, analysis and the gift of naming. The domain of ceremonial magic.",spiritual:"Hod is the rational faculty, the gift of language and analysis. The Practicus works with the Water element and the structured mind. It is where magicians and scientists operate  transforming experience into structured knowledge. Hod is the seat of ceremonial magic in the Golden Dawn system  ritual, formulae, vibration of divine names. It complements Netzach: where Netzach feels, Hod analyzes.",lightningFlash:"Receives the Lightning Flash from Geburah, Tiphereth and Netzach. Here the light gains precision and articulation  becoming thought, language, intellectual form.",serpentOfWisdom:"Hod reflects the ascending Serpent as structured comprehension  maps, models and languages returning to the Divine. All human knowledge is the ascending light of Hod: the human mind reflecting the cosmic mind back to the Source.",practice:"CLARIFY and MEMORY at Hod structure intellectual patterns. BRIDGE connects Hod to Netzach for balancing reason and emotion. High memory here means consolidated cognitive patterns."},yesod:{world:"Yetzirah  Formative Plane",plane:"Lunar Sphere",divineName:"Shaddai El Chai  the Almighty Living God",archangel:"Gabriel  Strength of God",gdGrade:"2=9 Theoricus",planet:"Moon  reflection, the unconscious and cycles",body:"Reproductive organs  the vital foundation",color:"#8060c0",summary:"The Foundation  the astral plane, the collective unconscious, the mould of reality.",spiritual:"Yesod is the intermediate plane between spirit and matter  the astral light. The Theoricus explores this lunar realm of vision and imagination. It is the foundation upon which Malkuth rests. It corresponds to the astral body, dreams and the Akashic memory. The Moon governs Yesod: cycles, tides, the hidden rhythm of reality. In astral travel, Yesod is the first sphere encountered.",lightningFlash:'Receives the Lightning Flash from Tiphereth, Netzach and Hod. Here spiritual light compresses into etheric patterns that will manifest in Malkuth. Yesod is the "mould" of physical reality  everything in Malkuth first exists in Yesod.',serpentOfWisdom:"Yesod reflects the ascending Serpent as collective memory and dreams  all human experience accumulates here before being elevated. It is the great reservoir of ascending light: it purifies and concentrates the returning current before sending it to Tiphereth.",practice:"MEMORY at Yesod strengthens the foundation of the entire Tree. RITUAL_PULSE creates waves affecting Malkuth and Tiphereth simultaneously. High coherence here means Malkuth manifests clearly."},malkuth:{world:"Assiah  Material Plane",plane:"The Sphere of the Elements",divineName:"Adonai ha-Aretz  Lord of Earth",archangel:"Sandalphon  Co-Brother",gdGrade:"1=10 Zelator",planet:"Earth  the physical world fully manifest",body:"The feet and base  connection to earth",color:"#806040",summary:"The Kingdom  the physical world, the lowest point and simultaneously the starting point of the return.",spiritual:'Malkuth is the world we inhabit  the kingdom of matter, body and the senses. The Zelator stands at the gate of the mysteries. It is where all spiritual light manifests as concrete reality. It is both the lowest point of descent and the STARTING POINT of the Serpent of Wisdom. "The stone the builders rejected has become the cornerstone." In the Hermetic tradition, matter is not fallen  it is Spirit made dense. The Great Work begins in Malkuth.',lightningFlash:'Malkuth is the FINAL DESTINATION of the Lightning Flash. All divine light, after traversing the 10 Sephiroth, manifests here as physical reality. When Malkuth is "full" of charge, the Lightning Flash has completed its journey of descent.',serpentOfWisdom:"Malkuth is the SOURCE of the Serpent of Wisdom! When Malkuth's charge reaches fullness, conscious matter recognizes its divine origin and light begins to reflect upward. When Malkuth exceeds 50% charge, VIOLET PARTICLES begin to RISE through the Tree  the ascending Serpent in action. This symbolizes spiritual awakening, the beginning of the Great Work  the Magnum Opus.",practice:"Watch Malkuth with special attention. When its charge rises, the Serpent of Wisdom activates  violet particles ascend the Tree. Apply RITUAL_PULSE here to create return waves. AMPLIFY accelerates the ascent. This is the point of greatest spiritual significance."}},kZ={title:"The Limitless Light  LVX",text:'Before Kether, there is the Ain Soph Aur: the Limitless Light. It is the absolute unconditioned, beyond any form or description. In the Hermetic tradition, this is the source of all  the hidden root from which the Tree springs. "That which is Above is as that which is Below, and that which is Below is as that which is Above, to accomplish the miracle of the One Thing."  The Emerald Tablet.'},RZ={title:"Lightning Flash   Descending Light",text:"The Lightning Flash descends from the Limitless Light through all 10 Sephiroth. Each Sephirah receives, transforms and passes the current onward. The descent ends in Malkuth  spirit fully manifest as matter. In visualization: golden/colored particles descending along the paths. This is the involutionary current  the descent of the divine into manifestation."},AZ={title:"Serpent of Wisdom   Ascending Light",text:"When the Lightning Flash reaches Malkuth, matter awakens to its divine origin and reflects light back upward  the Serpent of Wisdom. This ascending current returns purified by the complete experience of Creation. It is the foundation of all spiritual practice: the adept as a mirror reflecting light back to the Source. In visualization: violet particles rising along the paths. This is the evolutionary current  the Great Work of return."},jZ={title:"The Great Work  Magnum Opus",text:'When the Lightning Flash and the Serpent of Wisdom flow in simultaneous equilibrium  light descending and returning in harmony  the Great Work is accomplished. Each conscious act that elevates light from matter to spirit is an act of alchemy. The Tree in perfect balance represents the completed Magnum Opus. As the alchemists say: "Visita Interiora Terrae Rectificando Invenies Occultum Lapidem"  V.I.T.R.I.O.L.'},EZ=[{name:"Atziluth",heb:"",meaning:"Archetypal",sephirot:"Kether, Chokmah, Binah",desc:"The world of archetypes  divine emanation in its purest form. Here the light is nearly identical to the Source. The realm of the Supernals, beyond the Abyss."},{name:"Beriah",heb:"",meaning:"Creative",sephirot:"Chesed, Geburah, Tiphereth",desc:"The creative world  archetypal forces differentiated into patterns. The realm of the Adept grades. Here the Great Work is consciously undertaken."},{name:"Yetzirah",heb:"",meaning:"Formative",sephirot:"Netzach, Hod, Yesod",desc:"The astral/formative world  etheric patterns that mould physical reality. The realm of astral vision, ceremonial magic and elemental forces."},{name:"Assiah",heb:"",meaning:"Material",sephirot:"Malkuth",desc:"The manifest physical world  action, matter, the kingdom we inhabit. The starting point of the Great Work and the ground of the Temple."}],kk=[{id:"q1",text:"How drawn are you to structure vs. flow?",low:"Pure flow",high:"Pure structure",target:"strictness"},{id:"q2",text:"Do you seek clarity or embrace mystery?",low:"Deep mystery",high:"Crystal clarity",target:"astralClarity"},{id:"q3",text:"How intense is your inner fire?",low:"Gentle ember",high:"Blazing inferno",target:"ritualIntensity"},{id:"q4",text:"Are you more earthly or celestial?",low:"Rooted in earth",high:"Dwelling in stars",target:"earthCelestial"},{id:"q5",text:"Do you seek power or wisdom?",low:"Wisdom alone",high:"Power to act",target:"powerWisdom"},{id:"q6",text:"How open are your inner gates?",low:"Sealed tight",high:"Wide open",target:"openness"},{id:"q7",text:"Do you favor mercy or justice?",low:"Pure mercy",high:"Strict justice",target:"mercyJustice"},{id:"q8",text:"How deep is your memory of past lives?",low:"Blank slate",high:"Ancient soul",target:"memory"},{id:"q9",text:"Are you drawn to the sun or moon?",low:"Silver moon",high:"Golden sun",target:"sunMoon"},{id:"q10",text:"How ready are you to cross the Abyss?",low:"Not yet",high:"I am prepared",target:"abyssCrossing"}],Rk={sephiroth:!0,paths:!0,orYashar:!0,orChozer:!0,pillars:!0,aura:!0,particles:!0,veils:!0};function TZ({active:e}){var Pt,An,cr,Tn,Sr;const[t,n]=S.useState({...jx}),r=S.useRef({...jx}),a=S.useRef(wE(jx)),[i,s]=S.useState(()=>Ul(a.current)),[c,l]=S.useState(!0),d=S.useRef(!0),u=S.useRef(0),h=S.useRef(0),m=S.useRef(null),[f,g]=S.useState({w:800,h:600}),[x,v]=S.useState(!1),b=S.useRef({zoom:1,px:0,py:0}),w=S.useRef({active:!1,sx:0,sy:0,opx:0,opy:0}),M=S.useRef(new Map),k=S.useRef(new Map),R=S.useRef(new Map),j=S.useRef(new Map),I=S.useRef(new Map),E=S.useRef({level:0,greatWorkPulse:0,greatWorkFlash:0,lightningFlashLevel:0}),[O,L]=S.useState({level:0,greatWorkPulse:0,greatWorkFlash:0,lightningFlashLevel:0}),$=S.useRef([]),F=S.useRef(new Map),B=S.useRef(new Map),[W,re]=S.useState(null),[oe,te]=S.useState(null),[J,pe]=S.useState({x:0,y:0}),[P,V]=S.useState(null),[fe,ye]=S.useState(null),[Se,we]=S.useState([]),[ke,De]=S.useState(null),[_e,ae]=S.useState([]),[Re,Fe]=S.useState(()=>wZ()),[Oe,ne]=S.useState("journey"),[nt,pt]=S.useState(!1),Et=S.useRef([]),_t=S.useRef(Ul(a.current)),[Ct,Xe]=S.useState("select"),[Ut,Le]=S.useState({...Rk}),Ke=S.useRef({...Rk}),[mt,an]=S.useState(!1),[gn,Be]=S.useState(()=>{const de={};for(const $e of kk)de[$e.id]=.5;return de});S.useEffect(()=>{Ke.current=Ut},[Ut]);const ft=S.useCallback(de=>{Le($e=>({...$e,[de]:!$e[de]}))},[]),Qt=S.useCallback(()=>{const de=M.current,$e=k.current,et=R.current;de.clear(),$e.clear(),et.clear(),j.current.clear(),I.current.clear();for(const zt of Eu){const Nt=8+Math.round(Math.random()*4);de.set(zt.id,Array.from({length:Nt},(ln,Rt)=>({angle:Rt/Nt*la+Math.random()*.3,angVel:(.5+Math.random()*.6)*(Math.random()>.5?1:-1),radius:na*1.4+Math.random()*na*.6,alpha:.4+Math.random()*.5})))}for(const zt of zu)$e.set(zt.pathId,[]),et.set(zt.pathId,[]),j.current.set(zt.pathId,Math.random()),I.current.set(zt.pathId,Math.random()*.5)},[]);S.useEffect(()=>{Qt()},[]),S.useEffect(()=>{var Nt;const de=(Nt=m.current)==null?void 0:Nt.parentElement;if(!de)return;const $e=(ln,Rt)=>g({w:Math.max(1,Math.floor(ln)),h:Math.max(1,Math.floor(Rt))});$e(de.clientWidth,de.clientHeight);const et=globalThis.ResizeObserver;if(!et){const ln=()=>$e(de.clientWidth,de.clientHeight);return addEventListener("resize",ln),()=>removeEventListener("resize",ln)}const zt=new et(ln=>{for(const Rt of ln)$e(Rt.contentRect.width,Rt.contentRect.height)});return zt.observe(de),()=>zt.disconnect()},[x]),S.useEffect(()=>{r.current=t},[t]),S.useEffect(()=>{d.current=c},[c]),S.useEffect(()=>{if(!e)return;let de=0;const $e=et=>{u.current=requestAnimationFrame($e);const zt=Math.min((et-h.current)/1e3,.1);h.current=et;const Nt=zt*r.current.speed;d.current&&(bZ(a.current,Nt,r.current),a.current.events.length>0&&ae(ln=>{const Rt=[...ln,...a.current.events].slice(-40);return a.current.events=[],Rt}),de%25===0&&s(Ul(a.current)));for(const[ln,Rt]of F.current)F.current.set(ln,Rt+Nt);for(const[ln,Rt]of B.current)B.current.set(ln,Rt+Nt);nr(Nt,a.current),$.current=$.current.map(ln=>({...ln,age:ln.age+Nt})).filter(ln=>ln.age<ln.life),de%20===0&&L({...E.current});try{FZ(m.current,a.current,r.current,b.current,$.current,M.current,k.current,R.current,E.current,P,fe,F.current,B.current,Ke.current)}catch(ln){console.error("[TreeOfLife] render error:",ln)}de++};return h.current=performance.now(),u.current=requestAnimationFrame($e),()=>cancelAnimationFrame(u.current)},[e,P,fe]);function nr(de,$e){var Or,wr;const et=M.current,zt=k.current,Nt=R.current;for(const vn of Eu){const Gr=et.get(vn.id);if(!Gr)continue;const hn=$e.sephirot.get(vn.id),jr=.6+hn.charge*.8+hn.tension*.4;for(const _r of Gr)_r.angle+=_r.angVel*jr*de,_r.radius=na*(1.4+hn.coherence*.5)+Math.sin(_r.angle*3)*4,_r.alpha=.25+hn.charge*.5}const ln=$e.sephirot.get("malkuth"),Rt=$e.sephirot.get("kether"),Nn=$e.sephirot.get("tiphereth"),It=Math.max(0,ln.charge-.35)*(1/.65),xn=E.current;xn.level=xn.level+(It-xn.level)*de*.8;const Ln=(Rt.charge+(((Or=$e.sephirot.get("chokmah"))==null?void 0:Or.charge)??0)+(((wr=$e.sephirot.get("binah"))==null?void 0:wr.charge)??0))/3;xn.lightningFlashLevel=xn.lightningFlashLevel+(Ln-xn.lightningFlashLevel)*de*.6;const zn=xn.level>.4&&xn.lightningFlashLevel>.4?Math.min(xn.level,xn.lightningFlashLevel)*Nn.coherence:0;xn.greatWorkPulse=xn.greatWorkPulse+(zn-xn.greatWorkPulse)*de*.5,xn.greatWorkFlash>0&&(xn.greatWorkFlash=Math.max(0,xn.greatWorkFlash-de)),xn.greatWorkPulse>.6&&Math.random()<de*.3&&(xn.greatWorkFlash=1.2,$.current.push({kind:"ripple",wx:Tc(.5),wy:Ic(.52),color:"#c080ff",age:0,life:2,r:200}));for(const vn of zu){const Gr=$e.paths.get(vn.pathId),hn=zt.get(vn.pathId),jr=Gr.flow,Zn=1-Gr.blockage;for(let to=hn.length-1;to>=0;to--){const Er=hn[to];if(Er.t+=Er.speed*de,Er.t>Zn){hn.splice(to,1);const Eo=$e.sephirot.get(vn.to);Eo&&(Eo.charge=Math.min(1,Eo.charge+.008))}}if(jr>.05){const to=1/(jr*5+.5),Er=j.current.get(vn.pathId)+de;j.current.set(vn.pathId,Er),Er>to&&hn.length<14&&(j.current.set(vn.pathId,0),hn.push({t:0,speed:.18+jr*.22+(Math.random()-.5)*.05,size:1.8+jr*2+Math.random()*1.2,energy:.5+jr*.5}))}const lo=Nt.get(vn.pathId),ir=xn.level*jr;for(let to=lo.length-1;to>=0;to--){const Er=lo[to];if(Er.t+=Er.speed*de,Er.t>1){lo.splice(to,1);const Eo=$e.sephirot.get(vn.from);Eo&&(Eo.coherence=Math.min(1,Eo.coherence+.004))}}if(ir>.08){const to=1/(ir*4+.3),Er=I.current.get(vn.pathId)+de;I.current.set(vn.pathId,Er),Er>to&&lo.length<10&&(I.current.set(vn.pathId,0),lo.push({t:0,speed:.12+ir*.18+(Math.random()-.5)*.04,size:1.5+ir*1.8+Math.random()*1,energy:.4+ir*.5}))}}}const _n=S.useCallback((de,$e,et)=>{const zt={arcanaId:de.id,reversed:de.reversed,targetType:$e,targetId:et,timestamp:Date.now(),lensId:r.current.deckLens};_t.current=Ul(a.current),xZ(a.current,zt,r.current),Et.current.push(zt),De(null),s(Ul(a.current));const Nt=y0.get(de.id);Rn(Nt.operator.primary,$e,et),setTimeout(()=>sn(),500)},[]);function Rn(de,$e,et){let zt=0,Nt=0;if($e==="sephirah"){const It=Cl.get(et);zt=Tc(It.nx),Nt=Ic(It.ny),F.current.set(et,0)}else if($e==="path"){const It=q5.get(et),xn=Cl.get(It.from),Ln=Cl.get(It.to);zt=(Tc(xn.nx)+Tc(Ln.nx))/2,Nt=(Ic(xn.ny)+Ic(Ln.ny))/2,B.current.set(et,0)}else for(const It of Eu)F.current.set(It.id,0);const Rt={AMPLIFY:"#ffd060",SHOCK:"#ff6040",CUT:"#ff4040",OPEN_GATE:"#60ff90",CLOSE_GATE:"#ff8060",BALANCE:"#60d0ff",CONVERGE:"#a060ff",CLARIFY:"#ffffff",INTEGRATE:"#c0ff80",SILENCE:"#6080ff",RITUAL_PULSE:"#ff80ff",INVOKE:"#ffd060",BANISH:"#ff6040",TRANSMUTE:"#a78bfa",SEAL:"#34d399"}[de]??"#c0c0ff",Nn=de==="SHOCK"?"burst":de==="CUT"?"dissolve":"ripple";$.current.push({kind:Nn,wx:zt,wy:Nt,color:Rt,age:0,life:1.2,r:60})}const sn=S.useCallback(()=>{if(Et.current.length===0)return;const de=Ul(a.current),$e=_t.current,et=[...Et.current];Et.current=[];const zt=H5.get(r.current.deckLens),Nt=et[0],ln=Nt?zt.majors[Nt.arcanaId]:null,Rt=Nt!=null&&Nt.reversed?" (inv)":"",Nn=ln?`${ln.name}${Rt}  ${Nt.targetType==="global"?"global":Nt.targetId}. ${ln.keywords.join(", ")}. Coh ${(de.coherence*100).toFixed(0)}%, Ten ${(de.tension*100).toFixed(0)}%.`:"Session recorded.",It={id:Date.now().toString(),timestamp:Date.now(),lens:r.current.deckLens,preset:r.current.preset,cards:et,snapshot:de,deltas:{coherence:de.coherence-$e.coherence,tension:de.tension-$e.tension,memory:de.memory-$e.memory,openness:de.openness-$e.openness,novelty:de.novelty-$e.novelty},tags:et.flatMap(xn=>{const Ln=y0.get(xn.arcanaId);return Ln?[xn.reversed?Ln.operator.reversed.primary:Ln.operator.primary]:[]}),text:Nn};Fe(xn=>{const Ln=[...xn,It];return Ck(Ln),Ln})},[]),Cn=(de,$e,et,zt)=>({x:(de-et/2-b.current.px)/b.current.zoom,y:($e-zt/2-b.current.py)/b.current.zoom}),wt=S.useCallback(de=>{de.preventDefault();const $e=m.current;if(!$e)return;const et=$e.getBoundingClientRect(),zt=de.clientX-et.left,Nt=de.clientY-et.top,ln=$e.width,Rt=$e.height,Nn=de.deltaY<0?1.13:1/1.13,It=Math.max(.2,Math.min(4,b.current.zoom*Nn)),xn=zt-ln/2-(zt-ln/2-b.current.px)*It/b.current.zoom,Ln=Nt-Rt/2-(Nt-Rt/2-b.current.py)*It/b.current.zoom;b.current={zoom:It,px:xn,py:Ln}},[]),st=S.useCallback(de=>{de.button===0&&(w.current={active:!0,sx:de.clientX,sy:de.clientY,opx:b.current.px,opy:b.current.py})},[]),Zt=S.useCallback(de=>{const $e=m.current;if(!$e)return;const et=$e.getBoundingClientRect(),zt=(de.clientX-et.left)*($e.width/et.width),Nt=(de.clientY-et.top)*($e.height/et.height);if(w.current.active){const Ln=de.clientX-w.current.sx,zn=de.clientY-w.current.sy;b.current={...b.current,px:w.current.opx+Ln,py:w.current.opy+zn}}const ln=$e.width,Rt=$e.height,Nn=Cn(zt,Nt,ln,Rt);pe({x:de.clientX,y:de.clientY});let It=null,xn=null;for(const Ln of Eu){const zn=Nn.x-Tc(Ln.nx),Or=Nn.y-Ic(Ln.ny);if(zn*zn+Or*Or<(na+8)*(na+8)){It=Ln.id;break}}if(!It)for(const Ln of zu){const zn=Cl.get(Ln.from),Or=Cl.get(Ln.to),wr=Tc(zn.nx),vn=Ic(zn.ny),Gr=Tc(Or.nx),hn=Ic(Or.ny),jr=CE(wr,vn,Gr,hn);for(let _r=0;_r<=10;_r++){const Zn=W5(_r/10,wr,vn,jr.x,jr.y,Gr,hn),lo=Nn.x-Zn.x,ir=Nn.y-Zn.y;if(lo*lo+ir*ir<80){xn=Ln.pathId;break}}if(xn!==null)break}re(It),te(xn)},[]),Pe=S.useCallback(de=>{const $e=w.current.active&&(Math.abs(de.clientX-w.current.sx)>5||Math.abs(de.clientY-w.current.sy)>5);if(w.current.active=!1,$e)return;const et=Ct;et==="select"||et==="drag"?W?ke?(_n(ke,"sephirah",W),V(W),ye(null)):(V(W===P?null:W),ye(null),ne("journey")):oe!==null?ke?(_n(ke,"path",oe),ye(oe),V(null)):(ye(oe===fe?null:oe),V(null),ne("journey")):(V(null),ye(null)):W?(Sk(a.current,et,W,"sephirah",r.current),F.current.set(W,0),Rn(et.toUpperCase(),"sephirah",W),s(Ul(a.current)),V(W),ye(null)):oe!==null&&(Sk(a.current,et,oe,"path",r.current),B.current.set(oe,0),Rn(et.toUpperCase(),"path",oe),s(Ul(a.current)),ye(oe),V(null))},[W,oe,ke,P,fe,_n,Ct]),ct=S.useCallback(()=>{kx(a.current,r.current),Qt(),E.current={level:0,greatWorkPulse:0,greatWorkFlash:0,lightningFlashLevel:0},s(Ul(a.current)),V(null),ye(null),we(Sp(r.current.drawRate)),De(null)},[Qt]),vt=S.useCallback(de=>{const $e={...r.current,preset:de.id,drawRate:de.drawRate,strictness:de.strictness,veilsEnabled:de.veilsEnabled,pillarsEnabled:de.pillarsEnabled};n($e),r.current=$e,kx(a.current,$e);for(const[et,zt]of Object.entries(de.initialState)){const Nt=a.current.sephirot.get(et);Nt&&Object.assign(Nt,zt)}Qt(),s(Ul(a.current)),we(Sp($e.drawRate))},[Qt]),xe=S.useCallback(de=>{n($e=>{const et={...$e,...de};return r.current=et,a.current.veilsEnabled=et.veilsEnabled,a.current.pillarsEnabled=et.pillarsEnabled,et})},[]),ge=S.useCallback(()=>{const de=gn,$e={...r.current,preset:"mystical_journey",strictness:de.q1,astralClarity:de.q2,ritualIntensity:de.q3,veilsEnabled:de.q10>.6,pillarsEnabled:!0,speed:1};n($e),r.current=$e,kx(a.current,$e);const et=a.current,zt=et.sephirot.get("malkuth");zt.charge=.3+(1-de.q4)*.5,zt.openness=de.q6;const Nt=et.sephirot.get("kether");Nt.charge=.2+de.q4*.5;const ln=et.sephirot.get("chokmah");ln.charge=.2+(1-de.q5)*.4;const Rt=et.sephirot.get("geburah");Rt.charge=.2+de.q5*.4,Rt.tension=de.q7*.3;const Nn=et.sephirot.get("chesed");Nn.charge=.2+(1-de.q7)*.4;const It=et.sephirot.get("tiphereth");It.charge=.2+de.q9*.4;const xn=et.sephirot.get("yesod");xn.charge=.2+(1-de.q9)*.4;for(const Ln of et.sephirot.values())Ln.openness=Math.max(Ln.openness,de.q6*.6),Ln.memory=Math.max(Ln.memory,de.q8*.4);if(de.q10>.5){const Ln=et.sephirot.get("binah");Ln.tension=de.q10*.3}Qt(),s(Ul(a.current)),we(Sp($e.drawRate)),an(!1)},[gn,Qt]);if(S.useEffect(()=>{we(Sp(t.drawRate))},[]),!e)return null;const Ee=H5.get(t.deckLens)??H5.get("rws"),me=P?Cl.get(P):null,je=P?a.current.sephirot.get(P):null,Te=fe!==null?q5.get(fe):null,Ae=Te?y0.get(Te.arcanaId):null,Tt=Ae?Ee.majors[Ae.id]:null,xt=W&&W!==P?Cl.get(W):null,en=oe!==null&&oe!==fe?q5.get(oe):null,At=x?{position:"fixed",inset:0,zIndex:100}:{position:"fixed",inset:0,top:38,zIndex:1},Ze=Math.round(O.level*100),yt=Math.round(O.lightningFlashLevel*100),Mt=Math.round(O.greatWorkPulse*100),bn=[{key:"sephiroth",label:"Sephiroth",icon:""},{key:"paths",label:"Paths",icon:""},{key:"orYashar",label:"Lightning Flash ",icon:""},{key:"orChozer",label:"Serpent ",icon:""},{key:"pillars",label:"Pillars",icon:""},{key:"aura",label:"Aura",icon:""},{key:"particles",label:"Particles",icon:""},{key:"veils",label:"Veils",icon:""}];return o.jsxs("div",{style:{...At,display:"flex",flexDirection:"column",background:"#000",fontFamily:"system-ui, sans-serif"},children:[mt&&o.jsx("div",{style:{position:"fixed",inset:0,zIndex:200,background:"rgba(0,0,0,0.85)",backdropFilter:"blur(8px)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>an(!1),children:o.jsxs("div",{onClick:de=>de.stopPropagation(),style:{width:440,maxHeight:"85vh",overflowY:"auto",background:"rgba(10,6,30,0.98)",border:"1px solid rgba(180,120,255,0.3)",borderRadius:12,padding:"24px 28px",boxShadow:"0 20px 60px rgba(100,40,180,0.3)"},children:[o.jsx("div",{style:{fontSize:16,color:"rgba(240,230,210,0.95)",marginBottom:4,fontWeight:500},children:"Mystical Journey"}),o.jsx("div",{style:{fontSize:9,color:"rgba(180,160,200,0.5)",marginBottom:16,lineHeight:1.5},children:"Answer these questions to create a personalized Tree configuration. Let your intuition guide you  there are no wrong answers."}),kk.map(de=>o.jsxs("div",{style:{marginBottom:14},children:[o.jsx("div",{style:{fontSize:9,color:"rgba(210,195,240,0.8)",marginBottom:6},children:de.text}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx("span",{style:{fontSize:7,color:"rgba(180,160,200,0.4)",width:60,textAlign:"right",flexShrink:0},children:de.low}),o.jsx("input",{type:"range",min:0,max:1,step:.01,value:gn[de.id],onChange:$e=>Be(et=>({...et,[de.id]:parseFloat($e.target.value)})),style:{flex:1,height:3,accentColor:"#a78bfa",cursor:"pointer"}}),o.jsx("span",{style:{fontSize:7,color:"rgba(180,160,200,0.4)",width:60,flexShrink:0},children:de.high})]})]},de.id)),o.jsxs("div",{style:{display:"flex",gap:8,marginTop:16},children:[o.jsx("button",{title:"Aplicar respostas da jornada",onClick:ge,style:{flex:1,padding:"8px 14px",borderRadius:6,cursor:"pointer",background:"rgba(160,100,255,0.2)",border:"1px solid rgba(180,120,255,0.5)",color:"rgba(220,200,255,0.95)",fontSize:10,letterSpacing:"0.08em"},children:"Begin the Journey"}),o.jsx("button",{title:"Cancelar jornada",onClick:()=>an(!1),style:{padding:"8px 14px",borderRadius:6,cursor:"pointer",background:"rgba(255,255,255,0.04)",border:"1px solid rgba(255,255,255,0.1)",color:"rgba(180,165,150,0.5)",fontSize:10},children:"Cancel"})]})]})}),o.jsxs("div",{style:{flex:1,display:"flex",overflow:"hidden",minHeight:0},children:[o.jsxs("div",{style:{width:210,flexShrink:0,overflowY:"auto",scrollbarWidth:"none",background:"rgba(0,0,0,0.97)",borderRight:"1px solid rgba(255,255,255,0.05)",display:"flex",flexDirection:"column",padding:"10px 0"},children:[o.jsxs("div",{style:{padding:"0 12px 8px"},children:[o.jsx("div",{style:{fontSize:6.5,color:"rgba(180,120,255,0.5)",letterSpacing:"0.2em",textTransform:"uppercase"},children:"Tree of Life"}),o.jsx("div",{style:{fontSize:13,color:"rgba(240,230,210,0.9)"},children:"Hermetic Qabalah  Tarot"}),o.jsx("div",{style:{fontSize:7.5,color:"rgba(180,160,200,0.4)",marginTop:2},children:"Journey through the 10 Sephiroth & 22 Paths"})]}),o.jsx(nd,{}),o.jsxs(iu,{label:"Ritual Tools",children:[o.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:3},children:Oh.map(de=>o.jsx("button",{onClick:()=>Xe(de.id),title:de.desc,style:{width:30,height:28,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:5,cursor:"pointer",fontSize:13,background:Ct===de.id?`${de.color}25`:"rgba(255,255,255,0.025)",border:Ct===de.id?`1px solid ${de.color}80`:"1px solid rgba(255,255,255,0.06)",color:Ct===de.id?de.color:"rgba(180,165,150,0.35)",transition:"all 0.15s"},children:de.icon},de.id))}),o.jsx("div",{style:{fontSize:6,color:"rgba(180,160,200,0.35)",marginTop:4},children:((Pt=Oh.find(de=>de.id===Ct))==null?void 0:Pt.desc)??""})]}),o.jsx(nd,{}),o.jsxs("div",{style:{padding:"6px 10px 8px"},children:[o.jsx("div",{style:{fontSize:6.5,color:"rgba(180,120,255,0.4)",letterSpacing:"0.14em",textTransform:"uppercase",marginBottom:6},children:"Flow of Light"}),o.jsxs("div",{style:{marginBottom:5},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[o.jsx("span",{style:{fontSize:7,color:"rgba(220,185,80,0.7)",letterSpacing:"0.05em"},children:" Lightning Flash"}),o.jsxs("span",{style:{fontSize:7,color:"rgba(220,185,80,0.8)",fontFamily:"monospace"},children:[yt,"%"]})]}),o.jsx("div",{style:{height:3,background:"rgba(255,255,255,0.06)",borderRadius:2},children:o.jsx("div",{style:{width:`${yt}%`,height:"100%",borderRadius:2,transition:"width 0.4s",background:"linear-gradient(90deg, #c0a040, #ffe080)"}})})]}),o.jsxs("div",{style:{marginBottom:5},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[o.jsx("span",{style:{fontSize:7,color:"rgba(160,90,255,0.7)",letterSpacing:"0.05em"},children:" Serpent of Wisdom"}),o.jsxs("span",{style:{fontSize:7,color:Ze>30?"#c080ff":"rgba(160,90,255,0.5)",fontFamily:"monospace"},children:[Ze,"%"]})]}),o.jsx("div",{style:{height:3,background:"rgba(255,255,255,0.06)",borderRadius:2},children:o.jsx("div",{style:{width:`${Ze}%`,height:"100%",borderRadius:2,transition:"width 0.4s",background:"linear-gradient(90deg, #6020c0, #c080ff)"}})})]}),o.jsxs("div",{style:{padding:"4px 7px",borderRadius:5,marginTop:4,background:Mt>40?"rgba(96,20,128,0.15)":"rgba(255,255,255,0.02)",border:`1px solid ${Mt>40?"rgba(180,100,255,0.3)":"rgba(255,255,255,0.05)"}`,transition:"all 0.5s"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[o.jsx("span",{style:{fontSize:7,color:Mt>40?"rgba(210,170,255,0.8)":"rgba(170,155,140,0.35)",letterSpacing:"0.05em"},children:" The Great Work"}),o.jsxs("span",{style:{fontSize:7,fontFamily:"monospace",color:Mt>40?"#e0c0ff":"rgba(170,155,140,0.3)"},children:[Mt,"%"]})]}),o.jsx("div",{style:{height:3,background:"rgba(255,255,255,0.06)",borderRadius:2},children:o.jsx("div",{style:{width:`${Mt}%`,height:"100%",borderRadius:2,transition:"width 0.5s",background:"linear-gradient(90deg, #8040e0, #e0b0ff, #ffe080)"}})}),Mt<10&&o.jsx("div",{style:{fontSize:6,color:"rgba(160,145,130,0.3)",marginTop:3},children:"Raise Malkuth to activate the Serpent of Wisdom"}),Mt>40&&o.jsx("div",{style:{fontSize:6.5,color:"rgba(210,170,255,0.7)",marginTop:3},children:"Magnum Opus in progress  lights in harmony"})]})]}),o.jsx(nd,{}),o.jsx(iu,{label:"Overlays",children:o.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:2},children:bn.map(de=>o.jsxs("button",{onClick:()=>ft(de.key),title:de.label,style:{padding:"2px 6px",borderRadius:4,cursor:"pointer",fontSize:7,display:"flex",alignItems:"center",gap:3,background:Ut[de.key]?"rgba(180,120,255,0.12)":"rgba(255,255,255,0.02)",border:`1px solid ${Ut[de.key]?"rgba(180,120,255,0.3)":"rgba(255,255,255,0.06)"}`,color:Ut[de.key]?"rgba(210,185,255,0.85)":"rgba(170,155,140,0.3)"},children:[o.jsx("span",{style:{fontSize:9},children:de.icon})," ",de.label]},de.key))})}),o.jsx(nd,{}),o.jsx(iu,{label:"Tarot Lens",hint:"Changes vocabulary and emphasis. Base mechanics identical.",children:SE.map(de=>o.jsx(_Z,{active:t.deckLens===de.id,label:de.label,desc:de.description.slice(0,42)+"",onClick:()=>xe({deckLens:de.id})},de.id))}),o.jsx(nd,{}),o.jsxs(iu,{label:"Journey Presets",children:[o.jsx("button",{title:"Iniciar jornada mstica",onClick:()=>an(!0),style:{width:"100%",padding:"5px 8px",marginBottom:4,borderRadius:5,cursor:"pointer",background:"linear-gradient(135deg, rgba(160,80,255,0.12), rgba(220,180,60,0.08))",border:"1px solid rgba(180,120,255,0.3)",color:"rgba(220,200,255,0.85)",fontSize:8,letterSpacing:"0.08em",textAlign:"left"},children:" Mystical Journey Questionnaire"}),SZ.map(de=>o.jsxs("button",{title:`${de.name}: ${de.desc}`,onClick:()=>vt(de),style:{display:"flex",alignItems:"flex-start",gap:5,width:"100%",padding:"4px 8px",marginBottom:2,borderRadius:4,cursor:"pointer",textAlign:"left",background:t.preset===de.id?"rgba(96,20,128,0.18)":"rgba(255,255,255,0.025)",border:`1px solid ${t.preset===de.id?"rgba(180,120,255,0.35)":"rgba(255,255,255,0.05)"}`,color:t.preset===de.id?"rgba(210,180,255,0.9)":"rgba(180,165,150,0.45)"},children:[o.jsx("span",{style:{fontSize:11,flexShrink:0,marginTop:1},children:de.emoji}),o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:8},children:de.name}),o.jsxs("div",{style:{fontSize:6,opacity:.55},children:[de.description.slice(0,38),""]})]})]},de.id))]}),o.jsx(nd,{}),o.jsxs(iu,{label:"Parameters",children:[o.jsx(wp,{label:"Strictness",value:t.strictness,onChange:de=>xe({strictness:de})}),o.jsx(wp,{label:"Ritual Int.",value:t.ritualIntensity,onChange:de=>xe({ritualIntensity:de})}),o.jsx(wp,{label:"Astral Clar.",value:t.astralClarity,onChange:de=>xe({astralClarity:de})}),o.jsx(wp,{label:"Draw",value:(t.drawRate-3)/2,onChange:de=>xe({drawRate:Math.round(de*2+3)}),display:`${t.drawRate} cards`}),o.jsx(Ak,{label:"Pillars",active:t.pillarsEnabled,hint:"Field bias from the 3 pillars",onChange:de=>xe({pillarsEnabled:de})}),o.jsx(Ak,{label:"Veils",active:t.veilsEnabled,hint:"Coherence thresholds for upper sephiroth",onChange:de=>xe({veilsEnabled:de})})]}),o.jsx(nd,{}),o.jsx(iu,{label:"Speed",children:o.jsx(wp,{label:"Speed",value:(t.speed-.25)/2.75,onChange:de=>xe({speed:Math.round((de*2.75+.25)*100)/100}),display:`${t.speed.toFixed(2)}x`})}),o.jsx(nd,{}),o.jsxs(iu,{label:"Global State",children:[o.jsx(m5,{label:"Coherence",v:i.coherence,c:"#60c0ff"}),o.jsx(m5,{label:"Tension",v:i.tension,c:"#ff7050"}),o.jsx(m5,{label:"Memory",v:i.memory,c:"#a070ff"}),o.jsx(m5,{label:"Openness",v:i.openness,c:"#50d080"})]}),o.jsx(nd,{}),o.jsxs("div",{style:{padding:"6px 10px",display:"flex",flexDirection:"column",gap:4},children:[o.jsxs("div",{style:{display:"flex",gap:3},children:[o.jsx(Ex,{onClick:()=>l(de=>!de),c:c?"#ffd060":"#60c080",children:c?o.jsxs(o.Fragment,{children:[o.jsx(md,{size:9}),"Pause"]}):o.jsxs(o.Fragment,{children:[o.jsx(sc,{size:9}),"Play"]})}),o.jsxs(Ex,{onClick:ct,c:"#7070a0",children:[o.jsx(wf,{size:9}),"Reset"]})]}),o.jsxs(Ex,{onClick:()=>we(Sp(t.drawRate)),c:"#c0a0ff",children:[o.jsx(zi,{size:9})," Draw ",t.drawRate," Cards"]})]}),o.jsxs("div",{style:{padding:"0 10px 6px"},children:[o.jsxs("button",{title:nt?"Fechar avanado":"Grimrio & configurao",onClick:()=>pt(!nt),style:{display:"flex",alignItems:"center",gap:4,width:"100%",fontSize:7,background:"none",border:"none",cursor:"pointer",color:"rgba(180,165,150,0.3)",letterSpacing:"0.1em",textTransform:"uppercase"},children:[o.jsx($u,{size:8})," Advanced ",nt?o.jsx(Ms,{size:8}):o.jsx(hs,{size:8})]}),nt&&o.jsxs("div",{style:{background:"rgba(0,0,0,0.35)",borderRadius:4,padding:"8px",border:"1px solid rgba(255,255,255,0.06)",marginTop:3},children:[o.jsxs("div",{style:{fontSize:6.5,color:"rgba(180,165,150,0.35)",lineHeight:1.6},children:["Lens: ",o.jsx("b",{style:{color:"rgba(200,165,255,0.7)"},children:t.deckLens}),o.jsx("br",{}),"Preset: ",o.jsx("b",{style:{color:"rgba(200,165,255,0.7)"},children:t.preset}),o.jsx("br",{}),"Chapters: ",Re.length]}),o.jsx("button",{title:"Limpar grimrio",onClick:()=>{Fe([]),Ck([])},style:{marginTop:5,fontSize:7,background:"rgba(255,50,30,0.08)",border:"1px solid rgba(255,50,30,0.18)",borderRadius:3,padding:"2px 6px",cursor:"pointer",color:"rgba(255,110,90,0.55)"},children:"Clear Grimoire"})]})]})]}),o.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",minWidth:0,position:"relative"},children:[o.jsxs("div",{style:{flex:1,position:"relative",overflow:"hidden",background:"#000"},children:[o.jsx("canvas",{ref:m,width:f.w,height:f.h,style:{position:"absolute",inset:0,display:"block",cursor:w.current.active?"grabbing":Ct!=="select"&&Ct!=="drag"?"crosshair":W||oe!==null?"pointer":"grab"},onWheel:de=>{de.preventDefault(),wt(de)},onMouseDown:st,onMouseMove:Zt,onMouseUp:Pe,onMouseLeave:()=>{w.current.active=!1,re(null),te(null)}}),o.jsxs("div",{style:{position:"absolute",top:8,left:"50%",transform:"translateX(-50%)",padding:"3px 14px",borderRadius:12,background:"rgba(0,0,0,0.55)",border:"1px solid rgba(96,20,128,0.3)",fontSize:7,color:"rgba(200,175,255,0.6)",letterSpacing:"0.14em",textTransform:"uppercase",pointerEvents:"none"},children:[Ee.label,"  ",t.preset,t.veilsEnabled?"  Veils ON":"",t.pillarsEnabled?"  Pillars":""]}),Ze>20&&o.jsxs("div",{style:{position:"absolute",top:8,left:12,padding:"3px 8px",borderRadius:8,background:"rgba(48,10,64,0.75)",border:"1px solid rgba(96,20,128,0.5)",fontSize:7,color:"rgba(200,150,255,0.9)",letterSpacing:"0.08em",pointerEvents:"none",backdropFilter:"blur(4px)",boxShadow:"0 0 12px rgba(160,80,255,0.2)"},children:[" Serpent of Wisdom ",Ze,"%"]}),Ct!=="select"&&o.jsxs("div",{style:{position:"absolute",top:8,right:Ze>20?12:"auto",left:Ze>20?"auto":12,padding:"3px 8px",borderRadius:8,background:"rgba(0,0,0,0.65)",border:`1px solid ${((An=Oh.find(de=>de.id===Ct))==null?void 0:An.color)??"#888"}60`,fontSize:7,color:((cr=Oh.find(de=>de.id===Ct))==null?void 0:cr.color)??"#888",letterSpacing:"0.08em",pointerEvents:"none"},children:[(Tn=Oh.find(de=>de.id===Ct))==null?void 0:Tn.icon," ",(Sr=Oh.find(de=>de.id===Ct))==null?void 0:Sr.label]}),O.greatWorkFlash>0&&o.jsx("div",{style:{position:"absolute",inset:0,pointerEvents:"none",background:`rgba(96,20,128,${O.greatWorkFlash*.05})`,transition:"background 0.3s"}}),o.jsx("div",{style:{position:"absolute",bottom:12,left:12,display:"flex",flexDirection:"column",gap:4},children:[{label:"Zoom in",ico:o.jsx(tR,{size:12}),action:()=>{b.current={...b.current,zoom:Math.min(4,b.current.zoom*1.25)}}},{label:"Zoom out",ico:o.jsx(nR,{size:12}),action:()=>{b.current={...b.current,zoom:Math.max(.2,b.current.zoom*.8)}}},{label:"Reset view",ico:o.jsx(wf,{size:11}),action:()=>{b.current={zoom:1,px:0,py:0}}},{label:x?"Exit fullscreen":"Fullscreen",ico:o.jsx(Zk,{size:11}),action:()=>v(de=>!de)}].map(({label:de,ico:$e,action:et},zt)=>o.jsx("button",{title:de,onClick:et,style:{width:28,height:28,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:6,cursor:"pointer",background:"rgba(0,0,0,0.55)",border:"1px solid rgba(255,255,255,0.08)",color:"rgba(200,185,255,0.6)"},children:$e},zt))}),ke&&o.jsx("button",{title:"Jogar carta selecionada",onClick:()=>_n(ke,"global","global"),style:{position:"absolute",top:8,right:12,padding:"4px 14px",borderRadius:6,cursor:"pointer",background:"rgba(255,200,60,0.12)",border:"1px solid rgba(255,200,60,0.3)",fontSize:8,color:"rgba(255,220,100,0.9)",letterSpacing:"0.1em"},children:" Apply Globally"}),(me||Te)&&o.jsxs("div",{style:{position:"absolute",bottom:8,left:"50%",transform:"translateX(-50%)",padding:"8px 16px",borderRadius:10,maxWidth:380,background:"rgba(6,3,20,0.92)",border:"1px solid rgba(180,120,255,0.3)",fontSize:8,color:"rgba(220,210,195,0.85)",textAlign:"center",pointerEvents:"none",backdropFilter:"blur(8px)"},children:[me&&je&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{style:{fontSize:11,color:"rgba(210,185,255,0.95)",letterSpacing:"0.05em"},children:[me.label,o.jsx("span",{style:{fontSize:7.5,color:"rgba(180,160,240,0.5)",marginLeft:6},children:me.labelHeb})]}),o.jsxs("div",{style:{fontSize:7.5,color:"rgba(180,165,200,0.6)",marginBottom:5},children:[me.meaning,"  Pillar of ",me.pillar==="mercy"?"Mercy":me.pillar==="severity"?"Severity":"Balance"]}),o.jsx("div",{style:{display:"flex",justifyContent:"center",gap:8},children:[{l:"Charge",v:je.charge,c:"#ffd060"},{l:"Coh",v:je.coherence,c:"#60c0ff"},{l:"Tension",v:je.tension,c:"#ff7050"},{l:"Memory",v:je.memory,c:"#a070ff"}].map(({l:de,v:$e,c:et})=>o.jsxs("div",{style:{textAlign:"center"},children:[o.jsx("div",{style:{fontSize:6,color:"rgba(180,165,200,0.5)",letterSpacing:"0.1em"},children:de}),o.jsxs("div",{style:{fontSize:10,color:et},children:[Math.round($e*100),"%"]})]},de))}),me.id==="malkuth"&&Ze>20&&o.jsx("div",{style:{marginTop:4,fontSize:7,color:"#c080ff"},children:" Serpent Active  light ascending to Source"}),ke&&o.jsx("div",{style:{marginTop:4,color:"rgba(255,220,80,0.8)"},children:" Click to apply card"})]}),Te&&Ae&&Tt&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{style:{fontSize:11,color:"rgba(210,185,255,0.95)"},children:[Tt.name,o.jsxs("span",{style:{fontSize:7.5,color:"rgba(180,160,240,0.5)",marginLeft:6},children:[Ae.hebrewLetter,"  Path ",fe]})]}),o.jsxs("div",{style:{fontSize:7.5,color:"rgba(180,165,200,0.6)",marginBottom:3},children:[Te.from,"  ",Te.to]}),o.jsx("div",{style:{fontSize:7.5,marginBottom:3},children:Tt.keywords.join("  ")}),o.jsxs("div",{style:{fontSize:7,color:"rgba(200,185,165,0.5)"},children:["Op: ",Ae.operator.primary,Ae.operator.secondary?` + ${Ae.operator.secondary}`:""," "," ",Tt.microNote]}),ke&&o.jsx("div",{style:{marginTop:4,color:"rgba(255,220,80,0.8)"},children:" Click to apply card"})]})]}),(xt||en)&&o.jsxs("div",{style:{position:"fixed",left:J.x+14,top:J.y-10,padding:"5px 10px",borderRadius:6,zIndex:10,background:"rgba(8,4,22,0.9)",border:"1px solid rgba(180,120,255,0.2)",fontSize:8,color:"rgba(220,210,200,0.85)",pointerEvents:"none",maxWidth:200,backdropFilter:"blur(6px)"},children:[xt&&o.jsxs(o.Fragment,{children:[o.jsx("b",{style:{color:"rgba(210,185,255,0.9)"},children:xt.label}),"  ",xt.meaning,o.jsx("br",{}),o.jsxs("span",{style:{fontSize:7,color:"rgba(180,160,200,0.55)"},children:[xt.planet,"  ",xt.pillar==="mercy"?" Mercy":xt.pillar==="severity"?" Severity":"| Balance",ke?"  Click to apply":"  Click to explore "]})]}),en&&(()=>{const de=y0.get(en.arcanaId),$e=Ee.majors[de.id];return o.jsxs(o.Fragment,{children:[o.jsx("b",{style:{color:"rgba(210,185,255,0.9)"},children:$e.name}),o.jsx("br",{}),o.jsxs("span",{style:{fontSize:7,color:"rgba(180,160,200,0.5)"},children:[de.hebrewLetter,"  ",$e.keywords.join(", ")]})]})})()]})]}),o.jsxs("div",{style:{flexShrink:0,display:"flex",alignItems:"center",gap:5,padding:"8px 12px",borderTop:"1px solid rgba(255,255,255,0.05)",background:"rgba(3,1,12,0.97)",overflowX:"auto",scrollbarWidth:"thin",minHeight:108},children:[o.jsx("div",{style:{fontSize:6.5,color:"rgba(200,170,255,0.3)",letterSpacing:"0.15em",textTransform:"uppercase",flexShrink:0,writingMode:"vertical-rl"},children:"HAND"}),Se.map((de,$e)=>{const et=y0.get(de.id),zt=Ee.majors[de.id],Nt=(ke==null?void 0:ke.id)===de.id&&(ke==null?void 0:ke.reversed)===de.reversed;return o.jsx("div",{onClick:()=>De(Nt?null:de),style:{flexShrink:0,width:58,borderRadius:8,overflow:"hidden",cursor:"pointer",userSelect:"none",border:Nt?"2px solid rgba(255,220,80,0.8)":de.reversed?"1px solid rgba(255,70,50,0.3)":"1px solid rgba(180,120,255,0.2)",background:"rgba(8,4,24,0.98)",transform:Nt?"translateY(-10px) scale(1.05)":"none",transition:"transform 0.2s, border-color 0.2s",boxShadow:Nt?"0 4px 20px rgba(255,220,80,0.2)":"none"},children:o.jsx(NZ,{ar:et,ld:zt,reversed:de.reversed})},`${de.id}-${$e}`)}),o.jsx("div",{style:{flexShrink:0,marginLeft:4,fontSize:7,color:"rgba(160,145,200,0.2)",maxWidth:70,lineHeight:1.5},children:ke?" click on node or path":"Select a card"})]})]}),o.jsxs("div",{style:{width:250,flexShrink:0,display:"flex",flexDirection:"column",borderLeft:"1px solid rgba(255,255,255,0.05)",background:"rgba(3,1,14,0.97)"},children:[o.jsx("div",{style:{display:"flex",borderBottom:"1px solid rgba(255,255,255,0.05)"},children:[{id:"journey",label:"Journey",ico:""},{id:"grimoire",label:"Grimoire",ico:""},{id:"glossary",label:"Glossary",ico:""}].map(de=>o.jsxs("button",{title:de.label,onClick:()=>ne(de.id),style:{flex:1,padding:"7px 3px",fontSize:7,border:"none",cursor:"pointer",letterSpacing:"0.08em",textTransform:"uppercase",background:Oe===de.id?"rgba(180,120,255,0.1)":"transparent",borderBottom:Oe===de.id?"2px solid rgba(180,120,255,0.5)":"2px solid transparent",color:Oe===de.id?"rgba(210,180,255,0.9)":"rgba(170,155,140,0.3)"},children:[de.ico," ",de.label]},de.id))}),o.jsxs("div",{style:{flex:1,overflowY:"auto",scrollbarWidth:"thin",padding:"8px 10px"},children:[Oe==="journey"&&o.jsx(IZ,{selectedSeph:P,selectedPath:fe,snap:i,params:t,events:_e,serpentSnap:O,lens:Ee}),Oe==="grimoire"&&o.jsxs("div",{children:[o.jsxs("div",{style:{fontSize:6.5,color:"rgba(180,120,255,0.4)",letterSpacing:"0.12em",textTransform:"uppercase",marginBottom:6},children:["Grimoire  ",Re.length," chapters"]}),Re.length===0&&o.jsx("div",{style:{fontSize:7.5,color:"rgba(170,155,140,0.3)",padding:"10px 0"},children:"Play cards to record chapters automatically."}),[...Re].reverse().slice(0,24).map(de=>o.jsxs("div",{style:{marginBottom:7,padding:"6px 8px",borderRadius:5,background:"rgba(255,255,255,0.02)",border:"1px solid rgba(180,120,255,0.09)"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[o.jsxs("span",{style:{fontSize:6,color:"rgba(180,120,255,0.5)",letterSpacing:"0.1em"},children:[de.lens.toUpperCase(),"  ",new Date(de.timestamp).toLocaleTimeString()]}),o.jsx("span",{style:{fontSize:6,color:"rgba(170,155,140,0.4)"},children:de.tags.slice(0,2).join(", ")})]}),o.jsx("div",{style:{fontSize:7.5,color:"rgba(210,200,185,0.7)",lineHeight:1.45},children:de.text}),o.jsxs("div",{style:{display:"flex",gap:4,marginTop:3,flexWrap:"wrap"},children:[o.jsx(Tx,{label:"coh",delta:de.deltas.coherence}),o.jsx(Tx,{label:"ten",delta:de.deltas.tension,invert:!0}),o.jsx(Tx,{label:"mem",delta:de.deltas.memory})]})]},de.id))]}),Oe==="glossary"&&o.jsxs("div",{children:[o.jsxs("div",{style:{fontSize:6.5,color:"rgba(180,120,255,0.4)",letterSpacing:"0.12em",textTransform:"uppercase",marginBottom:6},children:["Glossary  ",Ee.label]}),vE.map(de=>{const $e=Ee.majors[de.id];return o.jsx("div",{style:{marginBottom:5,padding:"4px 7px",borderRadius:4,background:"rgba(255,255,255,0.02)",border:"1px solid rgba(255,255,255,0.04)"},children:o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5},children:[o.jsx("span",{style:{fontSize:14,color:"rgba(220,210,195,0.65)",width:18,flexShrink:0},children:de.symbol}),o.jsxs("div",{style:{flex:1},children:[o.jsx("span",{style:{fontSize:7.5,color:"rgba(220,210,195,0.82)",fontWeight:500},children:$e.name}),o.jsx("span",{style:{fontSize:6,color:"rgba(180,120,255,0.5)",marginLeft:4},children:de.hebrewLetter}),o.jsxs("div",{style:{fontSize:6,color:"rgba(170,155,200,0.45)"},children:[$e.keywords.join("  "),"  ",de.operator.primary]})]})]})},de.id)})]})]})]})]})]})}function IZ({selectedSeph:e,selectedPath:t,snap:n,params:r,events:a,serpentSnap:i,lens:s}){const[c,l]=S.useState(!1),[d,u]=S.useState(!1),[h,m]=S.useState(!0),f=e?CZ[e]:null,g=e?Cl.get(e):null,x=t!==null?q5.get(t):null,v=x?y0.get(x.arcanaId):null,b=v&&s?s.majors[v.id]:null,w={fontSize:7.5,color:"rgba(200,190,175,0.7)",lineHeight:1.55,marginBottom:6},M={fontSize:7,color:"rgba(180,120,255,0.55)",letterSpacing:"0.12em",textTransform:"uppercase",marginBottom:4,marginTop:8},k={padding:"7px 9px",borderRadius:6,marginBottom:6,background:"rgba(255,255,255,0.025)",border:"1px solid rgba(180,120,255,0.1)"},R={padding:"7px 9px",borderRadius:6,marginBottom:6,background:"rgba(100,30,180,0.07)",border:"1px solid rgba(160,80,255,0.2)"},j={padding:"7px 9px",borderRadius:6,marginBottom:6,background:"rgba(180,140,30,0.07)",border:"1px solid rgba(220,180,60,0.2)"};if(e&&f&&g){const I=e==="malkuth";return o.jsxs("div",{children:[o.jsxs("div",{style:{...k,border:`1px solid ${g.color}40`,background:`${g.color}0a`,marginBottom:8},children:[o.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:8,marginBottom:3},children:[o.jsx("span",{style:{fontSize:16,color:g.color,filter:`drop-shadow(0 0 6px ${g.color}80)`},children:""}),o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:13,color:"rgba(240,235,220,0.95)",fontWeight:500},children:g.label}),o.jsxs("div",{style:{fontSize:8,color:"rgba(200,185,255,0.5)"},children:[g.labelHeb,"  Sephirah ",g.num]})]})]}),o.jsx("div",{style:{fontSize:7.5,color:"rgba(200,190,170,0.6)",marginBottom:3},children:f.divineName}),o.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[o.jsxs("span",{style:{fontSize:6.5,padding:"2px 6px",borderRadius:10,background:"rgba(255,255,255,0.05)",color:"rgba(200,185,170,0.5)"},children:[" ",f.world]}),o.jsxs("span",{style:{fontSize:6.5,padding:"2px 6px",borderRadius:10,background:"rgba(255,255,255,0.05)",color:"rgba(200,185,170,0.5)"},children:[" ",g.planet]}),o.jsxs("span",{style:{fontSize:6.5,padding:"2px 6px",borderRadius:10,background:"rgba(255,255,255,0.05)",color:"rgba(200,185,170,0.5)"},children:[" ",f.gdGrade]})]}),o.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap",marginTop:4},children:[o.jsxs("span",{style:{fontSize:6.5,padding:"2px 6px",borderRadius:10,background:"rgba(255,255,255,0.05)",color:"rgba(200,185,170,0.5)"},children:[" ",f.archangel]}),o.jsxs("span",{style:{fontSize:6.5,padding:"2px 6px",borderRadius:10,background:"rgba(255,255,255,0.05)",color:"rgba(200,185,170,0.5)"},children:[" ",f.body]})]})]}),o.jsx("div",{style:M,children:"Spiritual Meaning"}),o.jsx("div",{style:w,children:f.spiritual}),o.jsxs("div",{style:j,children:[o.jsx("div",{style:{fontSize:7,color:"rgba(220,185,80,0.7)",letterSpacing:"0.1em",marginBottom:4},children:" LIGHTNING FLASH  Descending Light"}),o.jsx("div",{style:w,children:f.lightningFlash})]}),o.jsxs("div",{style:{...R,border:I&&i.level>.2?"1px solid rgba(160,80,255,0.5)":"1px solid rgba(160,80,255,0.2)",boxShadow:I&&i.level>.2?"0 0 12px rgba(160,80,255,0.15)":"none"},children:[o.jsx("div",{style:{fontSize:7,color:"rgba(160,90,255,0.8)",letterSpacing:"0.1em",marginBottom:4},children:" SERPENT OF WISDOM  Ascending Light"}),o.jsx("div",{style:w,children:f.serpentOfWisdom}),I&&i.level>.15&&o.jsxs("div",{style:{fontSize:7,padding:"4px 7px",borderRadius:4,marginTop:4,background:"rgba(160,80,255,0.12)",border:"1px solid rgba(160,80,255,0.3)",color:"rgba(210,160,255,0.9)"},children:[" Serpent active (",Math.round(i.level*100),"%)  violet particles ascending"]})]}),o.jsx("div",{style:M,children:"In the Simulation"}),o.jsx("div",{style:{...k,borderColor:"rgba(100,180,255,0.15)",background:"rgba(60,120,200,0.05)"},children:o.jsx("div",{style:w,children:f.practice})}),o.jsx("div",{style:{fontSize:6,color:"rgba(160,145,130,0.3)",marginTop:8,textAlign:"center"},children:"Click another Sephirah to explore  Click empty space to return"})]})}if(t!==null&&x&&v&&b){const I=Cl.get(x.from),E=Cl.get(x.to);return o.jsxs("div",{children:[o.jsxs("div",{style:{...k,marginBottom:8},children:[o.jsxs("div",{style:{fontSize:11,color:"rgba(210,185,255,0.95)",marginBottom:3},children:[v.symbol," ",b.name]}),o.jsxs("div",{style:{fontSize:7.5,color:"rgba(180,165,200,0.6)",marginBottom:5},children:["Path ",t,"  Letter ",v.hebrewLetter,"  ",x.attribution]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,fontSize:7.5},children:[o.jsx("span",{style:{color:I.color},children:I.label}),o.jsx("span",{style:{color:"rgba(200,185,165,0.4)"},children:""}),o.jsx("span",{style:{color:E.color},children:E.label})]})]}),o.jsx("div",{style:M,children:"This Path"}),o.jsxs("div",{style:w,children:["Path ",t," connects ",o.jsx("b",{style:{color:I.color},children:I.label})," (",I.meaning,") to ",o.jsx("b",{style:{color:E.color},children:E.label})," (",E.meaning,"). In the Hermetic tradition, each of the 22 paths is governed by a Major Arcana and a Hebrew letter. Attribution: ",x.attribution,"."]}),o.jsxs("div",{style:j,children:[o.jsx("div",{style:{fontSize:7,color:"rgba(220,185,80,0.7)",marginBottom:3},children:" Lightning Flash on this Path"}),o.jsxs("div",{style:w,children:["Light descends from ",o.jsx("b",{style:{color:"rgba(200,185,165,0.7)"},children:I.label})," to ",o.jsx("b",{style:{color:"rgba(200,185,165,0.7)"},children:E.label}),". The arcanum ",o.jsx("b",{style:{color:"rgba(210,185,255,0.8)"},children:b.name})," regulates the quality of this transmission."]})]}),o.jsxs("div",{style:R,children:[o.jsx("div",{style:{fontSize:7,color:"rgba(160,90,255,0.8)",marginBottom:3},children:" Serpent of Wisdom on this Path"}),o.jsxs("div",{style:w,children:["When the Serpent is active, violet particles ascend from ",o.jsx("b",{style:{color:"rgba(200,185,165,0.7)"},children:E.label})," to ",o.jsx("b",{style:{color:"rgba(200,185,165,0.7)"},children:I.label}),"  the light returns purified by experience. As Above, So Below."]})]}),o.jsxs("div",{style:M,children:["Arcanum  ",b.name]}),o.jsxs("div",{style:k,children:[o.jsx("div",{style:{fontSize:7.5,color:"rgba(220,210,195,0.75)",marginBottom:3},children:b.keywords.join("  ")}),o.jsx("div",{style:{fontSize:7,color:"rgba(180,165,145,0.55)"},children:b.microNote})]}),o.jsx("div",{style:M,children:"Magical Operator"}),o.jsxs("div",{style:{...k,borderColor:"rgba(255,200,80,0.2)",background:"rgba(180,140,30,0.04)"},children:[o.jsxs("div",{style:{fontSize:8,color:"rgba(220,190,90,0.8)",marginBottom:2},children:[v.operator.primary,v.operator.secondary?` + ${v.operator.secondary}`:""]}),o.jsxs("div",{style:{fontSize:7,color:"rgba(180,165,145,0.55)"},children:["Reversed: ",v.operator.reversed.primary]})]})]})}return o.jsxs("div",{children:[o.jsxs("div",{style:{padding:"8px 10px",borderRadius:7,marginBottom:8,background:i.greatWorkPulse>.3?"linear-gradient(135deg, rgba(180,120,30,0.08), rgba(120,40,200,0.08))":"rgba(255,255,255,0.02)",border:i.greatWorkPulse>.3?"1px solid rgba(180,120,255,0.25)":"1px solid rgba(255,255,255,0.05)",transition:"all 0.5s"},children:[o.jsx("div",{style:{fontSize:7,color:"rgba(200,175,255,0.5)",letterSpacing:"0.12em",textTransform:"uppercase",marginBottom:5},children:"State of Light"}),o.jsxs("div",{style:{display:"flex",gap:8,marginBottom:5},children:[o.jsxs("div",{style:{flex:1,textAlign:"center"},children:[o.jsx("div",{style:{fontSize:8,color:"rgba(220,185,80,0.7)",marginBottom:2},children:" Lightning Flash"}),o.jsxs("div",{style:{fontSize:14,color:"#ffe080",fontFamily:"monospace"},children:[Math.round(i.lightningFlashLevel*100),"%"]})]}),o.jsx("div",{style:{width:1,background:"rgba(255,255,255,0.06)"}}),o.jsxs("div",{style:{flex:1,textAlign:"center"},children:[o.jsx("div",{style:{fontSize:8,color:"rgba(160,90,255,0.7)",marginBottom:2},children:" Serpent"}),o.jsxs("div",{style:{fontSize:14,color:"#c080ff",fontFamily:"monospace"},children:[Math.round(i.level*100),"%"]})]}),o.jsx("div",{style:{width:1,background:"rgba(255,255,255,0.06)"}}),o.jsxs("div",{style:{flex:1,textAlign:"center"},children:[o.jsx("div",{style:{fontSize:8,color:"rgba(200,160,255,0.7)",marginBottom:2},children:" Great Work"}),o.jsxs("div",{style:{fontSize:14,color:i.greatWorkPulse>.3?"#e8c0ff":"rgba(200,185,165,0.3)",fontFamily:"monospace"},children:[Math.round(i.greatWorkPulse*100),"%"]})]})]}),i.greatWorkPulse<.1&&o.jsx("div",{style:{fontSize:7,color:"rgba(170,155,140,0.35)",textAlign:"center"},children:"Raise Malkuth to awaken the Serpent of Wisdom "}),i.greatWorkPulse>.3&&o.jsx("div",{style:{fontSize:7.5,color:"rgba(210,170,255,0.8)",textAlign:"center"},children:" The Great Work  Magnum Opus in progress"})]}),o.jsxs("div",{style:{padding:"6px 8px",borderRadius:5,marginBottom:8,background:"rgba(180,120,255,0.06)",border:"1px solid rgba(180,120,255,0.15)"},children:[o.jsx("div",{style:{fontSize:7,color:"rgba(200,175,255,0.6)",letterSpacing:"0.1em",textTransform:"uppercase",marginBottom:5},children:"How to Play"}),[["1","Click a Sephirah or path to explore its meaning"],["2","Draw cards and apply them to modulate the flows"],["3","Observe the Lightning Flash (gold ) and Serpent (violet )"],["4","Raise Malkuth to activate the Serpent of Wisdom  the ascent"],["","Seek equilibrium: The Great Work"]].map(([I,E])=>o.jsxs("div",{style:{display:"flex",gap:6,marginBottom:3,alignItems:"flex-start"},children:[o.jsx("span",{style:{fontSize:7,color:"rgba(180,120,255,0.5)",width:12,flexShrink:0,marginTop:.5},children:I}),o.jsx("span",{style:{fontSize:7,color:"rgba(200,190,175,0.65)",lineHeight:1.4},children:E})]},I))]}),o.jsxs("div",{style:{marginBottom:6},children:[o.jsxs("button",{title:d?"Ocultar Luz & Lore":"Luz & Lore",onClick:()=>u(!d),style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"5px 8px",borderRadius:5,cursor:"pointer",background:"rgba(180,120,60,0.06)",border:"1px solid rgba(220,185,80,0.15)",color:"rgba(220,185,80,0.7)",fontSize:7.5,letterSpacing:"0.08em"},children:[o.jsx("span",{children:" Lightning Flash & Serpent  The Cycle of Light"}),d?o.jsx(Ms,{size:10}):o.jsx(hs,{size:10})]}),d&&o.jsx("div",{style:{padding:"6px 8px",background:"rgba(0,0,0,0.2)",borderRadius:"0 0 5px 5px",border:"1px solid rgba(220,185,80,0.1)",borderTop:"none"},children:[kZ,RZ,AZ,jZ].map((I,E)=>o.jsxs("div",{style:{marginBottom:E<3?8:0},children:[o.jsx("div",{style:{fontSize:7.5,color:E<2?"rgba(220,185,80,0.8)":E===2?"rgba(160,90,255,0.8)":"rgba(200,160,255,0.8)",marginBottom:3},children:I.title}),o.jsx("div",{style:{fontSize:7,color:"rgba(190,180,165,0.65)",lineHeight:1.5},children:I.text})]},E))})]}),o.jsxs("div",{style:{marginBottom:6},children:[o.jsxs("button",{title:c?"Ocultar Mundos":"Mundos",onClick:()=>l(!c),style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"5px 8px",borderRadius:5,cursor:"pointer",background:"rgba(80,120,200,0.06)",border:"1px solid rgba(100,150,220,0.15)",color:"rgba(120,170,255,0.7)",fontSize:7.5,letterSpacing:"0.08em"},children:[o.jsx("span",{children:" The Four Worlds (Hermetic Planes)"}),c?o.jsx(Ms,{size:10}):o.jsx(hs,{size:10})]}),c&&o.jsx("div",{style:{padding:"6px 8px",background:"rgba(0,0,0,0.2)",borderRadius:"0 0 5px 5px",border:"1px solid rgba(100,150,220,0.1)",borderTop:"none"},children:EZ.map((I,E)=>o.jsxs("div",{style:{marginBottom:E<3?8:0},children:[o.jsxs("div",{style:{display:"flex",gap:5,alignItems:"baseline",marginBottom:2},children:[o.jsx("span",{style:{fontSize:8,color:"rgba(200,185,165,0.85)"},children:I.name}),o.jsx("span",{style:{fontSize:7,color:"rgba(180,120,255,0.5)"},children:I.heb}),o.jsxs("span",{style:{fontSize:6.5,color:"rgba(160,150,135,0.5)"},children:[" ",I.meaning]})]}),o.jsxs("div",{style:{fontSize:6.5,color:"rgba(160,145,130,0.5)",marginBottom:2},children:["Sephiroth: ",I.sephirot]}),o.jsx("div",{style:{fontSize:7,color:"rgba(190,180,165,0.6)",lineHeight:1.45},children:I.desc})]},I.name))})]}),o.jsxs("div",{style:{padding:"6px 8px",borderRadius:5,marginBottom:8,background:"rgba(255,255,255,0.02)",border:"1px solid rgba(255,255,255,0.05)"},children:[o.jsx("div",{style:{fontSize:7,color:"rgba(200,175,255,0.45)",letterSpacing:"0.1em",textTransform:"uppercase",marginBottom:5},children:"Current State"}),o.jsx(PZ,{snap:n,params:r,serpent:i})]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginBottom:5,cursor:"pointer"},onClick:()=>m(I=>!I),children:[o.jsx("div",{style:{fontSize:7,color:"rgba(200,175,255,0.4)",letterSpacing:"0.1em",textTransform:"uppercase",flex:1},children:"Events"}),h?o.jsx(Ms,{size:9,color:"rgba(180,120,255,0.4)"}):o.jsx(hs,{size:9,color:"rgba(180,120,255,0.4)"})]}),h&&o.jsxs(o.Fragment,{children:[a.length===0&&o.jsx("div",{style:{fontSize:7.5,color:"rgba(170,155,140,0.3)"},children:"No events yet. Play cards to activate."}),[...a].reverse().slice(0,12).map(I=>o.jsxs("div",{style:{marginBottom:5,padding:"4px 7px",borderRadius:4,background:"rgba(255,255,255,0.025)",borderLeft:`2px solid ${I.kind==="DISSOLUTION"?"#60c0ff":I.kind==="CRYSTALLIZATION"?"#ffd060":I.kind==="VEIL_BREACH"?"#ff6040":I.kind==="GREAT_WORK_PULSE"?"#e0c0ff":I.kind==="GRADE_ADVANCEMENT"?"#50d080":I.kind==="QLIPHOTIC_WARNING"?"#ff4040":"rgba(180,120,255,0.4)"}`},children:[o.jsx("div",{style:{fontSize:6,color:"rgba(180,120,255,0.5)",marginBottom:1},children:I.kind}),o.jsx("div",{style:{fontSize:7.5,color:"rgba(210,200,185,0.65)",lineHeight:1.4},children:I.description})]},I.id))]}),o.jsxs("div",{style:{fontSize:6.5,color:"rgba(160,145,130,0.25)",marginTop:10,textAlign:"center",lineHeight:1.6},children:["Click any Sephirah or path",o.jsx("br",{}),"to explore its spiritual meaning"]})]})}function PZ({snap:e,params:t,serpent:n}){const r=[];return e.coherence>.6&&r.push({text:" High coherence  Lightning Flash flowing well."}),e.coherence<.25&&r.push({text:" Low coherence  system dispersed."}),e.tension>.55&&r.push({text:" High tension  risk of CRYSTALLIZATION."}),e.tension<.15&&r.push({text:" Minimal tension  system stable."}),e.memory>.5&&r.push({text:" High memory  patterns consolidated."}),e.openness>.65&&r.push({text:" High openness  paths easily traversed."}),t.veilsEnabled&&r.push({text:" Veils active  coherence required for upper gates."}),n.level>.3&&r.push({text:" Serpent of Wisdom active  light ascending.",color:"#c080ff"}),n.greatWorkPulse>.4&&r.push({text:" The Great Work  Magnum Opus in progress!",color:"#e0c0ff"}),r.length||r.push({text:"System in neutral state. Play cards to begin."}),o.jsx(o.Fragment,{children:r.map((a,i)=>o.jsx("div",{style:{fontSize:7.5,color:a.color??"rgba(200,190,175,0.65)",lineHeight:1.45,marginBottom:2},children:a.text},i))})}function FZ(e,t,n,r,a,i,s,c,l,d,u,h,m,f){if(!e)return;const g=e.getContext("2d");if(!g)return;const x=e.width,v=e.height,b=t.time;g.fillStyle="#050210",g.fillRect(0,0,x,v);const w=g.createRadialGradient(x/2,v/2,0,x/2,v/2,Math.max(x,v)*.7);if(w.addColorStop(0,"rgba(20,10,60,0.4)"),w.addColorStop(.5,"rgba(8,4,30,0.3)"),w.addColorStop(1,"rgba(0,0,0,0)"),g.fillStyle=w,g.fillRect(0,0,x,v),l.greatWorkPulse>.2){const M=g.createRadialGradient(x/2,v/2,0,x/2,v/2,Math.max(x,v)*.5);M.addColorStop(0,`rgba(160,80,255,${l.greatWorkPulse*.06})`),M.addColorStop(1,"rgba(0,0,0,0)"),g.fillStyle=M,g.fillRect(0,0,x,v)}g.save();for(let M=0;M<120;M++){const k=(M*18731+5)%x,R=(M*37311+17)%v,j=.04+M%7*.015+Math.sin(b*.5+M)*.01;g.fillStyle=`rgba(220,215,255,${j})`,g.fillRect(k,R,1.2,1.2)}if(g.restore(),g.save(),g.translate(x/2+r.px,v/2+r.py),g.scale(r.zoom,r.zoom),f.pillars&&n.pillarsEnabled){const M=[[-200,0,200,"rgba(180,40,40,0.06)"],[200,0,200,"rgba(40,80,200,0.06)"],[0,0,160,"rgba(200,170,60,0.05)"]];for(const[k,R,j,I]of M){const E=g.createRadialGradient(k,R,0,k,R,j*3);E.addColorStop(0,I),E.addColorStop(1,"rgba(0,0,0,0)"),g.fillStyle=E,g.fillRect(-jy,-Ey*.6,jy*2,Ey*1.2)}}if(f.paths)for(const M of zu){const k=Cl.get(M.from),R=Cl.get(M.to);if(!k||!R)continue;const j=Tc(k.nx),I=Ic(k.ny),E=Tc(R.nx),O=Ic(R.ny),L=CE(j,I,E,O),$=t.paths.get(M.pathId);if(!$)continue;const F=$.flow,B=$.blockage,W=u===M.pathId,re=m.get(M.pathId)??99,oe=Math.max(0,1-re/2),[te,J,pe]=MZ(k.pillar,R.pillar);g.save();const P=()=>{g.beginPath(),g.moveTo(j,I),g.quadraticCurveTo(L.x,L.y,E,O),g.stroke()};g.strokeStyle=`rgba(${te},${J},${pe},${.04+F*.06+oe*.12})`,g.lineWidth=12+oe*8,g.filter="blur(4px)",P(),g.filter="none",g.strokeStyle=`rgba(${te},${J},${pe},${.08+F*.12+oe*.2})`,g.lineWidth=4,P(),B>.3&&g.setLineDash([5,5]),g.strokeStyle=W?`rgba(255,220,80,${.4+F*.4})`:`rgba(${te},${J},${pe},${.2+F*.4+oe*.3})`,g.lineWidth=W?2:.6+F*1.4,P(),g.setLineDash([]),f.orChozer&&l.level>.15&&(g.strokeStyle=`rgba(140,60,255,${l.level*.06*F})`,g.lineWidth=6,g.filter="blur(2px)",P(),g.filter="none");const V=W5(.5,j,I,L.x,L.y,E,O);g.fillStyle=`rgba(${te},${J},${pe},${.3+F*.25})`,g.font=`${Math.round(10+F*3)}px serif`,g.textAlign="center",g.textBaseline="middle";const fe=y0.get(M.arcanaId);if(fe&&g.fillText(fe.hebrewLetter,V.x,V.y),f.orYashar){const ye=s.get(M.pathId)??[];for(const Se of ye){const we=W5(Se.t,j,I,L.x,L.y,E,O),ke=Math.min(Se.t*5,(1-Se.t)*5,1),De=Se.energy*ke,_e=Se.size*(1+B*.5);g.filter="blur(3px)";const ae=g.createRadialGradient(we.x,we.y,0,we.x,we.y,_e*3);ae.addColorStop(0,`rgba(${te},${J},${pe},${De*.5})`),ae.addColorStop(1,`rgba(${te},${J},${pe},0)`),g.fillStyle=ae,g.beginPath(),g.arc(we.x,we.y,_e*3,0,la),g.fill(),g.filter="none",g.fillStyle=`rgba(${te+60},${J+60},${pe+60},${De})`,g.beginPath(),g.arc(we.x,we.y,_e,0,la),g.fill()}}if(f.orChozer){const ye=c.get(M.pathId)??[];for(const Se of ye){const we=W5(1-Se.t,j,I,L.x,L.y,E,O),ke=Math.min(Se.t*5,(1-Se.t)*5,1),De=Se.energy*ke*l.level,_e=Se.size;g.filter="blur(3px)";const ae=g.createRadialGradient(we.x,we.y,0,we.x,we.y,_e*3.5);ae.addColorStop(0,`rgba(160,80,255,${De*.6})`),ae.addColorStop(1,"rgba(100,40,200,0)"),g.fillStyle=ae,g.beginPath(),g.arc(we.x,we.y,_e*3.5,0,la),g.fill(),g.filter="none",g.fillStyle=`rgba(200,140,255,${De})`,g.beginPath(),g.arc(we.x,we.y,_e*.8,0,la),g.fill(),g.fillStyle=`rgba(240,220,255,${De*.6})`,g.beginPath(),g.arc(we.x,we.y,_e*.3,0,la),g.fill()}}g.restore()}if(f.sephiroth)for(const M of Eu){const k=Tc(M.nx),R=Ic(M.ny),j=t.sephirot.get(M.id),I=d===M.id,E=h.get(M.id)??99,O=Math.max(0,1-E/2.5),L=M.color,[$,F,B]=[parseInt(L.slice(1,3),16),parseInt(L.slice(3,5),16),parseInt(L.slice(5,7),16)],W=M.id==="malkuth",re=M.id==="kether";if(g.save(),f.aura&&W&&l.level>.2){const te=na*(4+l.level*4);g.filter="blur(8px)";const J=g.createRadialGradient(k,R,na,k,R,te);J.addColorStop(0,`rgba(140,60,220,${l.level*.3})`),J.addColorStop(1,"rgba(100,30,180,0)"),g.fillStyle=J,g.beginPath(),g.arc(k,R,te,0,la),g.fill(),g.filter="none"}if(f.aura&&re&&l.level>.4){const te=l.greatWorkPulse;g.filter="blur(6px)";const J=g.createRadialGradient(k,R,na,k,R,na*5);J.addColorStop(0,`rgba(200,160,255,${te*.25})`),J.addColorStop(1,"rgba(180,120,255,0)"),g.fillStyle=J,g.beginPath(),g.arc(k,R,na*5,0,la),g.fill(),g.filter="none"}if(f.aura){const te=na*(3+j.charge*3+O*2),J=g.createRadialGradient(k,R,na*.5,k,R,te);J.addColorStop(0,`rgba(${$},${F},${B},${j.charge*.25+O*.35})`),J.addColorStop(.4,`rgba(${$},${F},${B},${j.charge*.08})`),J.addColorStop(1,"rgba(0,0,0,0)"),g.fillStyle=J,g.filter="blur(2px)",g.beginPath(),g.arc(k,R,te,0,la),g.fill(),g.filter="none"}if(f.particles){const te=i.get(M.id)??[];for(const J of te){const pe=k+Math.cos(J.angle)*J.radius,P=R+Math.sin(J.angle)*J.radius;g.fillStyle=`rgba(${$+40},${F+40},${B+40},${J.alpha*j.charge})`,g.beginPath(),g.arc(pe,P,1.5+j.charge*1.5,0,la),g.fill()}}const oe=g.createRadialGradient(k-na*.25,R-na*.25,2,k,R,na);if(oe.addColorStop(0,`rgba(${$},${F},${B},${.35+j.charge*.35+O*.2})`),oe.addColorStop(1,`rgba(${$},${F},${B},${.06+j.charge*.1})`),g.fillStyle=oe,g.beginPath(),g.arc(k,R,na,0,la),g.fill(),j.tension>.1){const te=.4+Math.sin(b*4+M.num)*.3;g.strokeStyle=`rgba(220,60,40,${j.tension*te})`,g.lineWidth=1,g.beginPath(),g.arc(k,R,na*(.8+j.tension*.4),0,la),g.stroke()}if(j.coherence>.1&&(g.strokeStyle=`rgba(80,180,255,${j.coherence*.4})`,g.lineWidth=.8,g.beginPath(),g.arc(k,R,na*1.15,0,la*j.coherence),g.stroke()),W&&l.level>.1){const te=.5+Math.sin(b*2)*.3;g.strokeStyle=`rgba(160,80,255,${l.level*te*.8})`,g.lineWidth=1.5+l.level*1.5,g.beginPath(),g.arc(k,R,na*1.3,0,la),g.stroke()}if(re&&l.greatWorkPulse>.2){const te=.5+Math.sin(b*1.5)*.4;g.strokeStyle=`rgba(200,150,255,${l.greatWorkPulse*te*.9})`,g.lineWidth=2,g.beginPath(),g.arc(k,R,na*1.5,0,la),g.stroke()}O>0&&(g.strokeStyle=`rgba(255,220,80,${O*.7})`,g.lineWidth=2+O*2,g.beginPath(),g.arc(k,R,na*(1+O*.5),0,la),g.stroke()),I&&(g.strokeStyle="rgba(255,220,80,0.9)",g.lineWidth=2.5,g.beginPath(),g.arc(k,R,na+3,0,la),g.stroke()),g.strokeStyle=I?"rgba(255,220,80,0.5)":`rgba(${$},${F},${B},${.3+j.coherence*.4})`,g.lineWidth=I?1.5:.8,g.beginPath(),g.arc(k,R,na,0,la),g.stroke(),g.fillStyle=`rgba(240,235,220,${.6+j.coherence*.3})`,g.font=`${Math.round(na*.52)}px system-ui`,g.textAlign="center",g.textBaseline="middle",g.fillText(M.label,k,R),g.fillStyle=`rgba(${$+30},${F+30},${B+30},0.4)`,g.font=`${Math.round(na*.42)}px serif`,g.fillText(M.num.toString(),k,R+na*1.4),g.restore()}for(const M of a){const k=Math.max(0,1-M.age/M.life),R=M.age/M.life;if(g.save(),M.kind==="ripple")g.strokeStyle=M.color+Math.round(k*255).toString(16).padStart(2,"0"),g.lineWidth=2*k,g.beginPath(),g.arc(M.wx,M.wy,M.r*R,0,la),g.stroke(),R>.3&&(g.strokeStyle=M.color+Math.round(k*.5*255).toString(16).padStart(2,"0"),g.lineWidth=1,g.beginPath(),g.arc(M.wx,M.wy,M.r*R*1.6,0,la),g.stroke());else if(M.kind==="burst"){for(let I=0;I<12;I++){const E=I/12*la+R,O=M.r*.3,L=M.r*R;g.strokeStyle=M.color+Math.round(k*200).toString(16).padStart(2,"0"),g.lineWidth=1.5*k,g.beginPath(),g.moveTo(M.wx+Math.cos(E)*O,M.wy+Math.sin(E)*O),g.lineTo(M.wx+Math.cos(E)*L,M.wy+Math.sin(E)*L),g.stroke()}g.filter="blur(3px)";const j=g.createRadialGradient(M.wx,M.wy,0,M.wx,M.wy,M.r*.5);j.addColorStop(0,M.color+Math.round(k*180).toString(16).padStart(2,"0")),j.addColorStop(1,M.color+"00"),g.fillStyle=j,g.beginPath(),g.arc(M.wx,M.wy,M.r*.5,0,la),g.fill(),g.filter="none"}else if(M.kind==="flash")g.filter="blur(8px)",g.fillStyle=M.color+Math.round(k*180).toString(16).padStart(2,"0"),g.beginPath(),g.arc(M.wx,M.wy,M.r*.8,0,la),g.fill(),g.filter="none";else if(M.kind==="dissolve")for(let j=0;j<8;j++){const I=j/8*la,E=M.r*.7*R,O=Math.cos(I)*E,L=Math.sin(I)*E;g.fillStyle=M.color+Math.round(k*180).toString(16).padStart(2,"0"),g.beginPath(),g.arc(M.wx+O,M.wy+L,3*k,0,la),g.fill()}g.restore()}if(g.restore(),f.pillars&&n.pillarsEnabled&&(g.save(),g.font="9px system-ui",g.textAlign="center",g.fillStyle="rgba(180,40,40,0.20)",g.save(),g.translate(18,v/2),g.rotate(-Math.PI/2),g.fillText("SEVERITY",0,0),g.restore(),g.fillStyle="rgba(40,80,200,0.20)",g.save(),g.translate(x-18,v/2),g.rotate(Math.PI/2),g.fillText("MERCY",0,0),g.restore(),g.restore()),l.level>.05){g.save();const M=80,k=4,R=x-M-12,j=v-14;g.fillStyle="rgba(0,0,0,0.4)",g.fillRect(R-2,j-2,M+4,k+4),g.fillStyle=`rgba(140,60,220,${l.level*.6})`,g.fillRect(R,j,M*l.level,k),g.fillStyle=`rgba(200,150,255,${l.level*.9})`,g.font="7px system-ui",g.textAlign="right",g.fillText(` Serpent ${Math.round(l.level*100)}%`,x-12,j-4),g.restore()}}function nd(){return o.jsx("div",{style:{height:1,background:"rgba(255,255,255,0.04)",margin:"3px 0"}})}function iu({label:e,hint:t,children:n}){return o.jsxs("div",{style:{padding:"6px 10px 4px"},title:t,children:[o.jsx("div",{style:{fontSize:6.5,color:"rgba(180,120,255,0.4)",letterSpacing:"0.14em",textTransform:"uppercase",marginBottom:5},children:e}),n]})}function _Z({label:e,desc:t,active:n,onClick:r}){return o.jsxs("button",{title:e,onClick:r,style:{display:"flex",flexDirection:"column",width:"100%",padding:"4px 8px",marginBottom:2,borderRadius:4,cursor:"pointer",textAlign:"left",background:n?"rgba(180,120,255,0.12)":"rgba(255,255,255,0.025)",border:`1px solid ${n?"rgba(180,120,255,0.35)":"rgba(255,255,255,0.05)"}`,color:n?"rgba(210,185,255,0.95)":"rgba(175,160,145,0.45)"},children:[o.jsx("span",{style:{fontSize:8.5,letterSpacing:"0.05em"},children:e}),o.jsx("span",{style:{fontSize:6,opacity:.5,letterSpacing:"0.04em",lineHeight:1.3},children:t})]})}function wp({label:e,value:t,onChange:n,display:r}){return o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginBottom:4},children:[o.jsx("span",{style:{fontSize:6.5,color:"rgba(185,175,160,0.45)",width:58,textTransform:"uppercase",letterSpacing:"0.07em"},children:e}),o.jsx("input",{type:"range",min:0,max:1,step:.01,value:t,onChange:a=>n(parseFloat(a.target.value)),style:{flex:1,height:2,accentColor:"rgba(180,120,255,0.8)",cursor:"pointer"}}),o.jsx("span",{style:{fontSize:6.5,color:"rgba(185,175,160,0.4)",width:28,textAlign:"right"},children:r??t.toFixed(2)})]})}function Ak({label:e,active:t,hint:n,onChange:r}){return o.jsxs("div",{title:n,style:{display:"flex",alignItems:"center",gap:6,marginBottom:4,cursor:"pointer"},onClick:()=>r(!t),children:[o.jsx("div",{style:{width:22,height:12,borderRadius:6,position:"relative",background:t?"rgba(180,120,255,0.6)":"rgba(255,255,255,0.1)",transition:"background 0.2s"},children:o.jsx("div",{style:{position:"absolute",top:2,left:t?12:2,width:8,height:8,borderRadius:"50%",background:"white",transition:"left 0.2s"}})}),o.jsx("span",{style:{fontSize:7.5,textTransform:"uppercase",letterSpacing:"0.08em",color:t?"rgba(210,185,255,0.8)":"rgba(175,160,145,0.4)"},children:e})]})}function m5({label:e,v:t,c:n}){return o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginBottom:3},children:[o.jsx("span",{style:{fontSize:6.5,color:"rgba(185,175,160,0.45)",width:52,textTransform:"uppercase",letterSpacing:"0.06em"},children:e}),o.jsx("div",{style:{flex:1,height:3,background:"rgba(255,255,255,0.06)",borderRadius:2},children:o.jsx("div",{style:{width:`${Math.round(t*100)}%`,height:"100%",background:n,borderRadius:2,transition:"width 0.4s"}})}),o.jsxs("span",{style:{fontSize:6.5,color:"rgba(185,175,160,0.4)",width:24,textAlign:"right"},children:[Math.round(t*100),"%"]})]})}function Ex({onClick:e,c:t,children:n,title:r}){return o.jsx("button",{title:r,onClick:e,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:4,padding:"4px 5px",borderRadius:4,cursor:"pointer",fontSize:8,textTransform:"uppercase",letterSpacing:"0.07em",background:`${t}15`,border:`1px solid ${t}40`,color:t},children:n})}function Tx({label:e,delta:t,invert:n=!1}){const a=(n?t<0:t>0)?"#50b870":"#b05050";return Math.abs(t)<.005?null:o.jsxs("span",{style:{fontSize:6,padding:"1px 4px",borderRadius:3,background:`${a}15`,border:`1px solid ${a}35`,color:a},children:[e," ",t>0?"+":"",(t*100).toFixed(0),"%"]})}function NZ({ar:e,ld:t,reversed:n}){const a={logical:"#60c0ff",imaginal:"#c090ff",ritual:"#ffd060"}[t.tone]??"#b0a8c0";return o.jsxs("div",{style:{padding:"6px 4px",textAlign:"center",background:"linear-gradient(155deg, rgba(18,12,38,0.95), rgba(8,5,20,0.98))",minHeight:88,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:3,transform:n?"rotate(180deg)":"none"},children:[o.jsx("div",{style:{fontSize:22,color:a,lineHeight:1,filter:`drop-shadow(0 0 4px ${a}80)`},children:e.symbol}),o.jsx("div",{style:{fontSize:6.5,color:"rgba(225,215,200,0.88)",lineHeight:1.2,fontWeight:500},children:t.name}),o.jsx("div",{style:{fontSize:5.5,color:"rgba(180,165,200,0.5)",lineHeight:1.3},children:t.keywords.join(`
`)}),n&&o.jsx("div",{style:{fontSize:5,color:"rgba(255,90,70,0.6)",letterSpacing:"0.08em"},children:"INV"})]})}const Il=64;function Ix(){return{organismo:.5,intensidade:.5,hierarquia:.5,rigidez:.5,desorganizacao:.3,crueldade:.5,antiHabito:.3,multiplicidade:.3,linhasDeFuga:.3,territorializacao:.5,reterritorializacao:.3,hubs:.3,esquecimento:.2,ruido:.25,densidade:.5}}function OZ(e){return Math.min(1,Math.max(0,(1-e.organismo)*.25+e.intensidade*.15+e.desorganizacao*.2+(1-e.hierarquia)*.15+e.linhasDeFuga*.1+e.ruido*.1+e.antiHabito*.05))}function DZ(e){return{organismo:.85-e*.75,intensidade:.15+e*.75,hierarquia:.8-e*.7,rigidez:.75-e*.6,desorganizacao:.05+e*.8,crueldade:.6-e*.3,antiHabito:.05+e*.7,multiplicidade:.1+e*.6,linhasDeFuga:.05+e*.75,territorializacao:.7-e*.45,reterritorializacao:.5-e*.3,hubs:.5-e*.3,esquecimento:.1+e*.4,ruido:.1+e*.45,densidade:.5}}function RE(e){return Math.min(1,Math.max(0,e.organismo*.35+e.hierarquia*.3+e.rigidez*.2+(1-e.desorganizacao)*.15))}function LZ(){const e=Il*Il;return{consistency:new Float32Array(e),territory:new Float32Array(e),size:Il}}const Px=[{id:"select",icon:"",label:"Selecionar",color:"#94a3b8",desc:"Inspecionar qualquer elemento"},{id:"arrastar",icon:"",label:"Arrastar",color:"#e2e8f0",desc:"Arrastar orgaos, nos, zonas"},{id:"criarIntensidade",icon:"",label:"Criar Afetos",color:"#fbbf24",desc:"Criar particulas de intensidade"},{id:"criarOrgao",icon:"",label:"Criar Orgao",color:"#60a5fa",desc:"Adicionar orgao ao corpo"},{id:"criarNoRizoma",icon:"",label:"Criar No",color:"#34d399",desc:"Adicionar no ao rizoma"},{id:"criarEntrada",icon:"",label:"Criar Entrada",color:"#6ee7b7",desc:"Adicionar portal de entrada"},{id:"criarZona",icon:"",label:"Criar Zona",color:"#a78bfa",desc:"Criar zona de afeto"},{id:"remover",icon:"",label:"Remover",color:"#ef4444",desc:"Remover orgao/no/zona mais proximo"},{id:"empurrar",icon:"",label:"Empurrar",color:"#f472b6",desc:"Empurrar tudo para fora"},{id:"puxar",icon:"",label:"Puxar",color:"#a78bfa",desc:"Atrair tudo para o cursor"},{id:"sopro",icon:"",label:"Sopro",color:"#fbbf24",desc:"Injetar ruido local"},{id:"selo",icon:"",label:"Selo",color:"#34d399",desc:"Aumentar traco territorial"},{id:"rasura",icon:"",label:"Rasura",color:"#ef4444",desc:"Apagar campos localmente"},{id:"fuga",icon:"",label:"Fuga",color:"#a78bfa",desc:"Burst de fuga"},{id:"gradiente",icon:"",label:"Gradiente",color:"#60a5fa",desc:"Pintar plano de consistencia"}];function zZ(){return{fps:60,nAffects:0,nOrgans:0,nRhizomeNodes:0,nRhizomeEdges:0,hubDominance:0,plateauScore:0,plateauLabel:"Indeterminado",fieldEntropy:.5,memoryLoad:0,K:.5,meanIntensity:.5,ruptureRate:0,crueltyPressure:0}}const sf=Math.PI*2,Zv=28,jk=400;function BZ(e){const t=[],n=8+Math.round(e.organismo*12),r={v:0};for(let c=0;c<n;c++){const l=c/n*sf,d=.15+Math.random()*.35;t.push({id:r.v++,x:Math.cos(l)*d,y:Math.sin(l)*d,vx:0,vy:0,radius:.03+Math.random()*.04,importance:.3+Math.random()*.7,connections:[],hue:200+c/n*50,health:.8+Math.random()*.2})}for(let c=0;c<n;c++){const l=(c+1)%n;if(t[c].connections.includes(t[l].id)||(t[c].connections.push(t[l].id),t[l].connections.push(t[c].id)),e.hierarquia>.3&&Math.random()<e.hierarquia*.3){const d=Math.floor(Math.random()*n);d!==c&&!t[c].connections.includes(t[d].id)&&(t[c].connections.push(t[d].id),t[d].connections.push(t[c].id))}}const a=50+Math.round(e.densidade*200),i=[];for(let c=0;c<a;c++){const l=Math.random()*sf,d=.1+Math.random()*.5,u=Math.cos(l)*d,h=Math.sin(l)*d;i.push({x:u,y:h,vx:(Math.random()-.5)*.005,vy:(Math.random()-.5)*.005,intensity:.3+Math.random()*.5,hue:Math.random()*360,phase:Math.random()*sf,life:600+Math.floor(Math.random()*1200),trailX:new Array(Zv).fill(u),trailY:new Array(Zv).fill(h)})}const s=[];for(let c=0;c<3;c++)s.push({x:(Math.random()-.5)*.8,y:(Math.random()-.5)*.8,vx:(Math.random()-.5)*.002,vy:(Math.random()-.5)*.002,radius:.15+Math.random()*.15,strength:.3+Math.random()*.5,hue:c*120,pulse:Math.random()*sf});return{organs:t,affects:i,zones:s,events:[],nextId:r.v,crueltyAccum:0,ruptureCount:0}}function $Z(e,t,n,r,a){a=Math.min(a,.04);const{organs:i,affects:s,zones:c,events:l}=e,d=new Map;for(const g of i)d.set(g.id,g);for(const g of i){let x=0,v=0;for(const w of g.connections){const M=d.get(w);if(!M)continue;const k=M.x-g.x,R=M.y-g.y,j=Math.sqrt(k*k+R*R)+.001,I=.12+(1-t.rigidez)*.15,E=(j-I)*t.rigidez*2;x+=k/j*E,v+=R/j*E}for(const w of i){if(w.id===g.id)continue;const M=w.x-g.x,k=w.y-g.y,R=M*M+k*k;if(R<.04&&R>1e-6){const j=Math.sqrt(R);x-=M/j*.08/(j+.01),v-=k/j*.08/(j+.01)}}t.ruido>.01&&(x+=Math.sin(r*.8+g.id*2.1)*t.ruido*.02,v+=Math.cos(r*.8+g.id*1.7)*t.ruido*.02),g.health=Math.max(.05,g.health-t.desorganizacao*.002*a+t.organismo*.001*a),g.health=Math.min(1,g.health),g.vx=(g.vx+x*a)*.96,g.vy=(g.vy+v*a)*.96;const b=Math.sqrt(g.vx*g.vx+g.vy*g.vy);b>.004&&(g.vx=g.vx/b*.004,g.vy=g.vy/b*.004),g.x+=g.vx,g.y+=g.vy,g.x=Math.max(-.9,Math.min(.9,g.x)),g.y=Math.max(-.9,Math.min(.9,g.y))}if(t.desorganizacao>.1&&Math.random()<t.desorganizacao*.02*a){const g=Math.floor(Math.random()*i.length),x=i[g];if(x&&x.connections.length>1){const v=Math.floor(Math.random()*x.connections.length),b=x.connections[v];x.connections.splice(v,1);const w=d.get(b);if(w){const M=w.connections.indexOf(x.id);M>=0&&w.connections.splice(M,1)}if(t.antiHabito>.2&&Math.random()<t.antiHabito){const M=i.filter(k=>k.id!==x.id&&!x.connections.includes(k.id));if(M.length>0){const k=M[Math.floor(Math.random()*M.length)];x.connections.push(k.id),k.connections.push(x.id),l.push({time:r,x:(x.x+k.x)*.5,y:(x.y+k.y)*.5,type:"reconexao",message:"Reconexo anti-hbito",color:"#a78bfa",ttl:120})}}}}for(const g of c)g.pulse+=a*2,g.x+=g.vx,g.y+=g.vy,(g.x<-.85||g.x>.85)&&(g.vx*=-1),(g.y<-.85||g.y>.85)&&(g.vy*=-1),g.x=Math.max(-.9,Math.min(.9,g.x)),g.y=Math.max(-.9,Math.min(.9,g.y)),g.vx+=(Math.random()-.5)*5e-4,g.vy+=(Math.random()-.5)*5e-4,g.vx*=.98,g.vy*=.98;for(let g=s.length-1;g>=0;g--){const x=s[g];if(x.life--,x.life<=0){s.splice(g,1);continue}x.phase+=a*(.6+x.intensity*.8);let v=0,b=0;for(const I of c){const E=I.x-x.x,O=I.y-x.y,L=Math.sqrt(E*E+O*O)+.001;if(L<I.radius){const $=I.strength*(1-L/I.radius)*.1;v+=E/L*$,b+=O/L*$,x.intensity=Math.min(1,x.intensity+I.strength*.01*a),x.hue+=(I.hue-x.hue)*.01*a}}v+=Math.sin(r*1.2+g*1.3)*t.ruido*.02,b+=Math.cos(r*1.2+g*.9)*t.ruido*.02;const w=Math.sin(x.phase)*t.intensidade*.02;x.intensity=Math.max(.05,Math.min(1,x.intensity+w*a));const M=Il,k=Math.max(0,Math.min(M-1,(x.x+1)*.5*M|0)),R=Math.max(0,Math.min(M-1,(x.y+1)*.5*M|0));n.consistency[R*M+k]=Math.min(1,n.consistency[R*M+k]+x.intensity*.035*a),x.vx=(x.vx+v*a)*.975,x.vy=(x.vy+b*a)*.975;const j=Math.sqrt(x.vx*x.vx+x.vy*x.vy);j>.006&&(x.vx=x.vx/j*.006,x.vy=x.vy/j*.006),x.x+=x.vx,x.y+=x.vy,x.x=Math.max(-.95,Math.min(.95,x.x)),x.y=Math.max(-.95,Math.min(.95,x.y)),x.trailX.push(x.x),x.trailY.push(x.y),x.trailX.length>Zv&&(x.trailX.shift(),x.trailY.shift())}const u=50+Math.round(t.densidade*300);for(;s.length<u&&s.length<jk;){const g=Math.random()*sf,x=.1+Math.random()*.4,v=Math.cos(g)*x,b=Math.sin(g)*x;s.push({x:v,y:b,vx:(Math.random()-.5)*.005,vy:(Math.random()-.5)*.005,intensity:.2+Math.random()*.4,hue:Math.random()*360,phase:Math.random()*sf,life:400+Math.floor(Math.random()*800),trailX:[v],trailY:[b]})}let h=0;const m=s.length>0?s.reduce((g,x)=>g+x.intensity,0)/s.length:0;h+=m*t.intensidade*.05*a,h+=s.length/jk*t.densidade*.03*a,e.crueltyAccum=Math.min(1,e.crueltyAccum+h);const f=.3+(1-t.crueldade)*.5;if(e.crueltyAccum>f){e.crueltyAccum=0,e.ruptureCount++;let g=0,x=0;if(c.length>0){const v=c[Math.floor(Math.random()*c.length)];g=v.x,x=v.y}for(const v of s){const b=v.x-g,w=v.y-x,M=b*b+w*w;if(M<.09&&M>1e-6){const k=Math.sqrt(M),R=(1-k/.3)*.04;v.vx+=b/k*R,v.vy+=w/k*R,v.intensity=Math.min(1,v.intensity+.3)}}for(const v of i){const b=v.x-g,w=v.y-x;if(b*b+w*w<.15&&v.connections.length>1){v.connections.pop(),v.health=Math.max(.05,v.health-.2);break}}l.push({time:r,x:g,y:x,type:"ruptura",message:`Ruptura  crueldade excedeu limiar (${e.ruptureCount})`,color:"#ef4444",ttl:180})}for(let g=l.length-1;g>=0;g--)l[g].ttl--,l[g].ttl<=0&&l.splice(g,1)}const Ek=150;function qZ(){const e=[];for(let t=0;t<3;t++){const n=t/3*Math.PI*2+Math.random()*.3,r=.25+Math.random()*.15;e.push({id:t,x:Math.cos(n)*r,y:Math.sin(n)*r,vx:0,vy:0,isEntry:!0,connections:[],heat:.8+Math.random()*.2,age:0,territory:.3})}return e[0].connections.push(1),e[1].connections.push(0,2),e[2].connections.push(1),{nodes:e,nextId:3,growthTimer:0,flightEdges:[]}}function HZ(e,t,n,r,a){a=Math.min(a,.04);const{nodes:i}=e;if(i.length===0)return;const s=new Map;for(const d of i)s.set(d.id,d);e.growthTimer+=a;const c=.8-t.multiplicidade*.5;if(e.growthTimer>c&&i.length<Ek){e.growthTimer=0;let d;if(t.hubs>.4&&Math.random()<t.hubs){let f=i[0],g=i[0].connections.length;for(const x of i)x.connections.length>g&&(f=x,g=x.connections.length);d=f}else d=i[Math.floor(Math.random()*i.length)];const u=Math.random()*Math.PI*2,h=.06+Math.random()*.08,m={id:e.nextId++,x:d.x+Math.cos(u)*h,y:d.y+Math.sin(u)*h,vx:0,vy:0,isEntry:!1,connections:[d.id],heat:d.heat*.7+Math.random()*.3,age:0,territory:t.territorializacao*.5};if(m.x=Math.max(-.9,Math.min(.9,m.x)),m.y=Math.max(-.9,Math.min(.9,m.y)),d.connections.push(m.id),i.push(m),t.multiplicidade>.5&&Math.random()<(t.multiplicidade-.5)*.15){const f=1+Math.floor(Math.random()*2);for(let g=0;g<f&&i.length<Ek;g++){const x=Math.random()*Math.PI*2,v=.3+Math.random()*.3,b={id:e.nextId++,x:Math.cos(x)*v,y:Math.sin(x)*v,vx:0,vy:0,isEntry:!0,connections:[],heat:.7+Math.random()*.3,age:0,territory:.2};let w=i[0],M=999;for(const k of i){const R=(k.x-b.x)**2+(k.y-b.y)**2;R<M&&(w=k,M=R)}b.connections.push(w.id),w.connections.push(b.id),i.push(b)}}}if(e.flightEdges=[],t.linhasDeFuga>.1&&Math.random()<t.linhasDeFuga*.04*a&&i.length>4){const d=i[Math.floor(Math.random()*i.length)];let u=null,h=0;for(const m of i){if(m.id===d.id||d.connections.includes(m.id))continue;const f=(m.x-d.x)**2+(m.y-d.y)**2;f>h&&(u=m,h=f)}u&&h>.04&&(d.connections.push(u.id),u.connections.push(d.id),e.flightEdges.push({from:d.id,to:u.id,heat:1,isFlight:!0}))}if(t.esquecimento>.1&&Math.random()<t.esquecimento*.03*a){const d=i.filter(u=>!u.isEntry&&u.heat<.3&&u.connections.length>0);if(d.length>0){const u=d[Math.floor(Math.random()*d.length)];if(u.connections.length>0){const h=u.connections.pop(),m=s.get(h);if(m){const f=m.connections.indexOf(u.id);f>=0&&m.connections.splice(f,1)}}}}for(let d=i.length-1;d>=0;d--){const u=i[d];!u.isEntry&&u.connections.length===0&&u.age>60&&i.splice(d,1)}const l=.015;for(let d=0;d<i.length;d++){const u=i[d];u.age++;let h=0,m=0;const f=Math.max(1,i.length/40|0);for(let b=0;b<i.length;b+=f){if(b===d)continue;const w=i[b],M=w.x-u.x,k=w.y-u.y,R=M*M+k*k;if(R<l&&R>1e-6){const j=Math.sqrt(R),I=.003/(j+.005);h-=M/j*I,m-=k/j*I}}for(const b of u.connections){const w=s.get(b);if(!w)continue;const M=w.x-u.x,k=w.y-u.y,R=Math.sqrt(M*M+k*k)+.001,j=.08+(1-t.territorializacao)*.05,I=(R-j)*.5;h+=M/R*I,m+=k/R*I}t.reterritorializacao>.2&&Math.sqrt(u.x*u.x+u.y*u.y)>.3&&(h-=u.x*t.reterritorializacao*.05,m-=u.y*t.reterritorializacao*.05),h+=Math.sin(r*2+u.id*1.7)*t.ruido*.02,m+=Math.cos(r*2+u.id*2.3)*t.ruido*.02;const g=Il,x=Math.max(0,Math.min(g-1,(u.x+1)*.5*g|0)),v=Math.max(0,Math.min(g-1,(u.y+1)*.5*g|0));if(n.territory[v*g+x]=Math.min(1,n.territory[v*g+x]+u.territory*.05*a),u.heat=Math.max(.05,u.heat-.002*a),u.connections.length>0&&Math.random()<.05){const b=u.connections[Math.floor(Math.random()*u.connections.length)],w=s.get(b);if(w){const M=(u.heat-w.heat)*.1;u.heat-=M*.5,w.heat+=M*.5}}u.vx=(u.vx+h*a)*.88,u.vy=(u.vy+m*a)*.88,u.x+=u.vx,u.y+=u.vy,u.x=Math.max(-.92,Math.min(.92,u.x)),u.y=Math.max(-.92,Math.min(.92,u.y))}}function hw(e){const t=[],n=new Set,r=new Map;for(const a of e.nodes)r.set(a.id,a);for(const a of e.nodes)for(const i of a.connections){const s=a.id<i?`${a.id}-${i}`:`${i}-${a.id}`;if(n.has(s))continue;n.add(s);const c=r.get(i);if(!c)continue;const l=e.flightEdges.some(d=>d.from===a.id&&d.to===i||d.from===i&&d.to===a.id);t.push({from:a.id,to:i,heat:(a.heat+c.heat)*.5,isFlight:l})}return t}function WZ(e){if(e.length<2)return 0;let t=0,n=0;for(const a of e)a.connections.length>t&&(t=a.connections.length),n+=a.connections.length;const r=n/e.length;return r>0?Math.min(1,t/(r*3)):0}function Tk(e){return{cso:BZ(e),rhizome:qZ(),fields:LZ(),time:0,tick:0}}function GZ(e,t,n){const r=Il*Il,a=Il,i=(1-t.territorializacao*.5-t.reterritorializacao*.3)*.03*n,s=.004*n;for(let c=0;c<r;c++)e.territory[c]=Math.max(0,e.territory[c]-i),e.consistency[c]=Math.max(0,e.consistency[c]-s);if(t.territorializacao>.2){const c=t.territorializacao*.012*n;for(let l=1;l<a-1;l++)for(let d=1;d<a-1;d++){const u=l*a+d,h=(e.territory[u-1]+e.territory[u+1]+e.territory[u-a]+e.territory[u+a])*.25;e.territory[u]+=(h-e.territory[u])*c}}}function VZ(e,t,n){n=Math.min(n,.04),e.time+=n,e.tick++,$Z(e.cso,t,e.fields,e.time,n),HZ(e.rhizome,t,e.fields,e.time,n),GZ(e.fields,t,n)}function Ik(e,t,n,r,a,i=.15){const{fields:s,cso:c}=e,l=Il;switch(t){case"criarIntensidade":{const d=5+Math.floor(a.densidade*10);for(let u=0;u<d&&c.affects.length<500;u++){const h=Math.random()*Math.PI*2,m=Math.random()*i*.6;c.affects.push({x:n+Math.cos(h)*m,y:r+Math.sin(h)*m,vx:(Math.random()-.5)*.008,vy:(Math.random()-.5)*.008,intensity:.5+Math.random()*.4,hue:Math.random()*360,phase:Math.random()*Math.PI*2,life:600+Math.floor(Math.random()*800),trailX:[n],trailY:[r]})}break}case"empurrar":{for(const d of e.rhizome.nodes){const u=d.x-n,h=d.y-r,m=u*u+h*h;if(m<i*i&&m>1e-6){const f=Math.sqrt(m);d.vx+=u/f*.01*(1-f/i),d.vy+=h/f*.01*(1-f/i)}}for(const d of c.affects){const u=d.x-n,h=d.y-r,m=u*u+h*h;if(m<i*i&&m>1e-6){const f=Math.sqrt(m),g=(1-f/i)*.03;d.vx+=u/f*g,d.vy+=h/f*g}}for(const d of c.organs){const u=d.x-n,h=d.y-r,m=u*u+h*h;if(m<i*i&&m>1e-6){const f=Math.sqrt(m);d.vx+=u/f*.008*(1-f/i),d.vy+=h/f*.008*(1-f/i)}}break}case"puxar":{for(const d of c.organs){const u=n-d.x,h=r-d.y,m=u*u+h*h;if(m<i*2*(i*2)&&m>1e-6){const f=Math.sqrt(m),g=Math.min(.01,.003/(f+.01));d.vx+=u/f*g,d.vy+=h/f*g}}for(const d of e.rhizome.nodes){const u=n-d.x,h=r-d.y,m=u*u+h*h;if(m<i*2*(i*2)&&m>1e-6){const f=Math.sqrt(m),g=Math.min(.01,.003/(f+.01));d.vx+=u/f*g,d.vy+=h/f*g}}for(const d of c.affects){const u=n-d.x,h=r-d.y,m=u*u+h*h;if(m<i*2*(i*2)&&m>1e-6){const f=Math.sqrt(m),g=Math.min(.02,.005/(f+.01));d.vx+=u/f*g,d.vy+=h/f*g}}break}case"sopro":{for(const d of c.affects){const u=d.x-n,h=d.y-r;u*u+h*h<i*i&&(d.vx+=(Math.random()-.5)*.025,d.vy+=(Math.random()-.5)*.025,d.intensity=Math.min(1,d.intensity+.15))}for(const d of c.organs){const u=d.x-n,h=d.y-r;u*u+h*h<i*i&&(d.vx+=(Math.random()-.5)*.01,d.vy+=(Math.random()-.5)*.01)}break}case"selo":{const d=(n+1)*.5*l|0,u=(r+1)*.5*l|0,h=Math.max(1,i*.5*l|0);for(let m=-h;m<=h;m++)for(let f=-h;f<=h;f++){const g=d+f,x=u+m;if(g<0||g>=l||x<0||x>=l||f*f+m*m>h*h)continue;const v=1-Math.sqrt(f*f+m*m)/h;s.territory[x*l+g]=Math.min(1,s.territory[x*l+g]+.7*v)}break}case"rasura":{const d=(n+1)*.5*l|0,u=(r+1)*.5*l|0,h=Math.max(1,i*.5*l|0);for(let m=-h;m<=h;m++)for(let f=-h;f<=h;f++){const g=d+f,x=u+m;if(g<0||g>=l||x<0||x>=l||f*f+m*m>h*h)continue;const v=x*l+g;s.territory[v]=0,s.consistency[v]=0}break}case"fuga":{for(const d of c.affects){const u=d.x-n,h=d.y-r,m=u*u+h*h;if(m<i*i&&m>1e-6){const f=Math.sqrt(m),g=(1-f/i)*.04;d.vx+=u/f*g,d.vy+=h/f*g}}for(const d of e.rhizome.nodes){const u=d.x-n,h=d.y-r,m=u*u+h*h;if(m<i*i&&m>1e-6){const f=Math.sqrt(m);d.vx+=u/f*.015*(1-f/i),d.vy+=h/f*.015*(1-f/i)}}break}case"criarOrgao":{const d=c.nextId++,u={id:d,x:n,y:r,vx:0,vy:0,radius:.03+Math.random()*.04,importance:.3+Math.random()*.5,connections:[],hue:200+Math.random()*50,health:1};let h=null,m=1/0;for(const f of c.organs){const g=Math.sqrt((f.x-n)**2+(f.y-r)**2);g<m&&(m=g,h=f)}h&&m<.5&&(u.connections.push(h.id),h.connections.push(d)),c.organs.push(u),c.events.push({time:e.time,x:n,y:r,type:"nascimento",message:"Novo orgao criado",color:"#60a5fa",ttl:120});break}case"criarNoRizoma":{const d=e.rhizome.nextId++,u={id:d,x:n,y:r,vx:0,vy:0,isEntry:!1,connections:[],heat:.5,age:0,territory:.3};let h=null,m=1/0;for(const f of e.rhizome.nodes){const g=Math.sqrt((f.x-n)**2+(f.y-r)**2);g<m&&(m=g,h=f)}h&&m<.5&&(u.connections.push(h.id),h.connections.push(d)),e.rhizome.nodes.push(u);break}case"criarEntrada":{const d=e.rhizome.nextId++,u={id:d,x:n,y:r,vx:0,vy:0,isEntry:!0,connections:[],heat:.8,age:0,territory:.1};let h=null,m=1/0;for(const f of e.rhizome.nodes){const g=Math.sqrt((f.x-n)**2+(f.y-r)**2);g<m&&(m=g,h=f)}h&&m<.6&&(u.connections.push(h.id),h.connections.push(d)),e.rhizome.nodes.push(u),c.events.push({time:e.time,x:n,y:r,type:"nascimento",message:"Nova entrada rizomatica",color:"#34d399",ttl:120});break}case"criarZona":{c.zones.push({x:n,y:r,vx:(Math.random()-.5)*.002,vy:(Math.random()-.5)*.002,radius:.12+Math.random()*.15,strength:.4+Math.random()*.4,hue:Math.random()*360,pulse:Math.random()*Math.PI*2});break}case"remover":{let d="",u=-1,h=.1;for(let m=0;m<c.organs.length;m++){const f=c.organs[m],g=Math.sqrt((f.x-n)**2+(f.y-r)**2);g<h&&(h=g,d="organ",u=m)}for(let m=0;m<e.rhizome.nodes.length;m++){const f=e.rhizome.nodes[m],g=Math.sqrt((f.x-n)**2+(f.y-r)**2);g<h&&(h=g,d="rnode",u=m)}for(let m=0;m<c.zones.length;m++){const f=c.zones[m],g=Math.sqrt((f.x-n)**2+(f.y-r)**2);g<h&&(h=g,d="zone",u=m)}if(d==="organ"&&u>=0){const m=c.organs[u];for(const f of c.organs)f.connections=f.connections.filter(g=>g!==m.id);c.organs.splice(u,1),c.events.push({time:e.time,x:n,y:r,type:"dissolucao",message:"Orgao removido",color:"#ef4444",ttl:120})}else if(d==="rnode"&&u>=0){const m=e.rhizome.nodes[u];for(const f of e.rhizome.nodes)f.connections=f.connections.filter(g=>g!==m.id);e.rhizome.nodes.splice(u,1),c.events.push({time:e.time,x:n,y:r,type:"dissolucao",message:"No rizoma removido",color:"#ef4444",ttl:120})}else d==="zone"&&u>=0&&(c.zones.splice(u,1),c.events.push({time:e.time,x:n,y:r,type:"dissolucao",message:"Zona removida",color:"#ef4444",ttl:120}));break}case"gradiente":{const d=(n+1)*.5*l|0,u=(r+1)*.5*l|0,h=Math.max(1,i*.75*l|0);for(let m=-h;m<=h;m++)for(let f=-h;f<=h;f++){const g=d+f,x=u+m;if(g<0||g>=l||x<0||x>=l||f*f+m*m>h*h)continue;const v=1-Math.sqrt(f*f+m*m)/h;s.consistency[x*l+g]=Math.min(1,s.consistency[x*l+g]+.5*v)}break}}}function UZ(e,t,n){const{cso:r,rhizome:a,fields:i}=e,s=r.affects.length;let c=0;for(const R of r.affects)c+=R.intensity;const l=s>0?c/s:0,d=WZ(a.nodes),u=hw(a),h=Il*Il;let m=0,f=0;for(let R=0;R<h;R++)m+=i.consistency[R],f+=i.territory[R];const g=f/h;let x=0;const v=m+f;if(v>.01){for(let R=0;R<h;R++){const j=(i.consistency[R]+i.territory[R])/v;j>1e-6&&(x-=j*Math.log2(j))}x=Math.min(1,x/Math.log2(h))}const b=RE(t),w=[1-Math.abs(l-.5)*.5,d>.1?1-Math.abs(d-.5):.3,Math.min(1,s/100)],M=Math.max(0,w.reduce((R,j)=>R+j,0)/w.length);let k="Indeterminado";return M>.45&&(b>.65&&d>.4?k="Captura (Proto-Estado)":b<.25&&l>.5?k="Simbiose Vibrante":t.linhasDeFuga>.5?k="Nomadismo":d>.5&&t.linhasDeFuga>.3?k="Metstase":g>.2&&b>.4?k="Reterritorializao":t.desorganizacao>.6&&l>.6?k="Delrio Controlado":k="Simbiose Vibrante"),{fps:n,nAffects:s,nOrgans:r.organs.length,nRhizomeNodes:a.nodes.length,nRhizomeEdges:u.length,hubDominance:d,plateauScore:M,plateauLabel:k,fieldEntropy:x,memoryLoad:g,K:b,meanIntensity:l,ruptureRate:r.ruptureCount,crueltyPressure:r.crueltyAccum}}const Hu=Math.PI*2;function $s(e,t,n,r=1){return`hsla(${e|0},${t*100|0}%,${n*100|0}%,${r})`}function YZ(e,t,n,r,a,i,s,c,l,d,u={zoom:1,panX:0,panY:0},h){e.clearRect(0,0,t,n),e.fillStyle="#040408",e.fillRect(0,0,t,n);const m=t*.5+u.panX,f=n*.5+u.panY,g=Math.min(t,n)*.47*u.zoom;s.has("heatConsistency")&&Pk(e,m,f,g,i.consistency,220,.5,d),s.has("heatTerritory")&&Pk(e,m,f,g,i.territory,30,.55,d),s.has("cso")&&(XZ(e,m,f,g,r.zones,d),tee(e,m,f,g,r.events,d)),s.has("afetos")&&(JZ(e,m,f,g,r.affects),QZ(e,m,f,g,r.affects,d)),(s.has("connections")||s.has("cso"))&&(ZZ(e,m,f,g,r.organs,c),eee(e,m,f,g,r.organs,c,d)),s.has("rizoma")&&(nee(e,m,f,g,a,l),ree(e,m,f,g,a.nodes,d)),s.has("flights")&&oee(e,m,f,g,a,l,d),h&&KZ(e,t,n,h,d)}function KZ(e,t,n,r,a){const i=.6+Math.sin(a*.3)*.15;e.save(),e.font="600 11px 'Doto', monospace",e.textAlign="center",e.fillStyle=`rgba(99,102,241,${.35*i})`,e.fillText(r.plateauLabel,t*.5,40),e.font="500 8px 'IBM Plex Mono', monospace",e.fillStyle="rgba(255,255,255,0.15)",e.fillText(`K=${r.K.toFixed(2)}  intensidade=${r.meanIntensity.toFixed(2)}`,t*.5,54),e.restore()}function Pk(e,t,n,r,a,i,s,c){const l=Il,d=r*2/l,u=r*2/l,h=t-r,m=n-r;for(let f=0;f<l;f++)for(let g=0;g<l;g++){const x=a[f*l+g];if(x<.003)continue;const v=Math.sin(c*1.2+g*.2+f*.2)*.05+1;e.globalAlpha=Math.min(s,x*s*v),e.fillStyle=$s(i+x*20,.6+x*.3,.15+x*.35),e.fillRect(h+g*d,m+f*u,d+.5,u+.5)}e.globalAlpha=1}function XZ(e,t,n,r,a,i){for(const s of a){const c=t+s.x*r,l=n+s.y*r,u=s.radius*r*(1+Math.sin(s.pulse+i*1.5)*.08),h=e.createRadialGradient(c,l,0,c,l,u);h.addColorStop(0,$s(s.hue,.7,.5,s.strength*.12)),h.addColorStop(.7,$s(s.hue,.5,.3,s.strength*.06)),h.addColorStop(1,"transparent"),e.fillStyle=h,e.fillRect(c-u,l-u,u*2,u*2)}}function JZ(e,t,n,r,a){e.lineCap="round",e.lineJoin="round";for(const i of a){const s=i.trailX.length;if(!(s<2))for(let c=1;c<s;c++){const l=c/s;e.beginPath(),e.moveTo(t+i.trailX[c-1]*r,n+i.trailY[c-1]*r),e.lineTo(t+i.trailX[c]*r,n+i.trailY[c]*r),e.lineWidth=(.4+i.intensity*1.2)*l,e.strokeStyle=$s(i.hue,.5,.45,(.03+i.intensity*.06)*l),e.stroke()}}}function QZ(e,t,n,r,a,i){for(const s of a){const c=t+s.x*r,l=n+s.y*r,d=1+Math.sin(s.phase+i*.6)*.12,u=(1+s.intensity*2)*d;s.intensity>.3&&(e.beginPath(),e.arc(c,l,u*3.5,0,Hu),e.fillStyle=$s(s.hue,.5,.5,s.intensity*.03),e.fill()),e.beginPath(),e.arc(c,l,u,0,Hu),e.fillStyle=$s(s.hue,.6,.5+s.intensity*.15,.35+s.intensity*.3),e.fill()}}function ZZ(e,t,n,r,a,i){const s=new Map;for(const l of a)s.set(l.id,l);const c=new Set;e.lineCap="round";for(const l of a)for(const d of l.connections){const u=l.id<d?`${l.id}-${d}`:`${d}-${l.id}`;if(c.has(u))continue;c.add(u);const h=s.get(d);if(!h)continue;const m=t+l.x*r,f=n+l.y*r,g=t+h.x*r,x=n+h.y*r,v=(l.importance+h.importance)*.5;e.lineWidth=.5+v*2.5*i.hierarquia;const b=(l.health+h.health)*.5;e.globalAlpha=b*.5,e.strokeStyle=$s((l.hue+h.hue)*.5,.4,.5),e.beginPath(),e.moveTo(m,f),e.lineTo(g,x),e.stroke()}e.globalAlpha=1}function eee(e,t,n,r,a,i,s){for(const c of a){const l=t+c.x*r,d=n+c.y*r,u=c.radius*r*(.8+c.importance*.4),h=c.health*(.3+i.organismo*.6);e.beginPath(),e.arc(l,d,u,0,Hu),e.strokeStyle=$s(c.hue,.5,.6,h*.6),e.lineWidth=1.5,e.globalAlpha=h,e.stroke();const m=e.createRadialGradient(l,d,0,l,d,u);if(m.addColorStop(0,$s(c.hue,.6,.55,h*.35)),m.addColorStop(1,"transparent"),e.fillStyle=m,e.fill(),c.importance>.5){const f=1+Math.sin(s*2+c.id)*.2;e.beginPath(),e.arc(l,d,u*.3*f,0,Hu),e.fillStyle=$s(c.hue,.7,.7,h*.5),e.fill()}}e.globalAlpha=1}function tee(e,t,n,r,a,i){for(const s of a){const c=t+s.x*r,l=n+s.y*r,d=1-s.ttl/180,u=5+d*30,h=Math.max(0,1-d*1.2);if(e.beginPath(),e.arc(c,l,u,0,Hu),e.strokeStyle=s.color,e.lineWidth=2-d*1.5,e.globalAlpha=h*.4,e.stroke(),s.type==="ruptura"){const m=u*.6;for(let f=0;f<4;f++){const g=f/4*Hu+i*3;e.beginPath(),e.moveTo(c,l),e.lineTo(c+Math.cos(g)*m,l+Math.sin(g)*m),e.lineWidth=1,e.globalAlpha=h*.3,e.strokeStyle=s.color,e.stroke()}}}e.globalAlpha=1}function nee(e,t,n,r,a,i,s){const c=new Map;for(const l of a.nodes)c.set(l.id,l);e.lineCap="round";for(const l of i){if(l.isFlight)continue;const d=c.get(l.from),u=c.get(l.to);if(!d||!u)continue;const h=t+d.x*r,m=n+d.y*r,f=t+u.x*r,g=n+u.y*r,x=l.heat>.5?$s(50+l.heat*30,.7,.5+l.heat*.2,.25+l.heat*.2):$s(200,.3,.4,.15+l.heat*.15);e.lineWidth=.6+l.heat*1.5,e.strokeStyle=x,e.beginPath();const v=(h+f)*.5+(g-m)*.08,b=(m+g)*.5-(f-h)*.08;e.moveTo(h,m),e.quadraticCurveTo(v,b,f,g),e.stroke()}}function ree(e,t,n,r,a,i){for(const s of a){const c=t+s.x*r,l=n+s.y*r,d=2+s.heat*3;if(s.isEntry){const u=1+Math.sin(i*2+s.id)*.15,h=d*1.5*u;e.save(),e.translate(c,l),e.rotate(Math.PI/4),e.beginPath(),e.rect(-h,-h,h*2,h*2),e.strokeStyle=$s(160,.8,.6,.6),e.lineWidth=1.5,e.stroke(),e.fillStyle=$s(160,.6,.5,.15),e.fill(),e.restore()}else e.beginPath(),e.arc(c,l,d,0,Hu),e.fillStyle=$s(200+s.heat*40,.5,.4+s.heat*.3,.3+s.heat*.4),e.fill()}}function oee(e,t,n,r,a,i,s){const c=new Map;for(const l of a.nodes)c.set(l.id,l);e.lineCap="round",e.setLineDash([4,6]),e.lineDashOffset=-s*20;for(const l of i){if(!l.isFlight)continue;const d=c.get(l.from),u=c.get(l.to);if(!d||!u)continue;const h=t+d.x*r,m=n+d.y*r,f=t+u.x*r,g=n+u.y*r;e.lineWidth=1.5,e.strokeStyle=$s(280,.8,.6,.5),e.beginPath(),e.moveTo(h,m),e.lineTo(f,g),e.stroke();const x=(h+f)*.5,v=(m+g)*.5,b=Math.atan2(g-m,f-h);e.setLineDash([]),e.beginPath(),e.moveTo(x+Math.cos(b)*5,v+Math.sin(b)*5),e.lineTo(x+Math.cos(b+2.5)*4,v+Math.sin(b+2.5)*4),e.lineTo(x+Math.cos(b-2.5)*4,v+Math.sin(b-2.5)*4),e.closePath(),e.fillStyle=$s(280,.8,.6,.4),e.fill(),e.setLineDash([4,6])}e.setLineDash([]),e.lineDashOffset=0}const g5=[{id:"organismo-puro",name:"Organismo Puro",icon:"",description:"Hierarquia mxima. rgos rgidos, zero plasticidade.",plateauRef:"Plat 6  28 de novembro de 1947: Como criar para si um Corpo sem rgos",theory:'O organismo  o inimigo do CsO. Deleuze e Guattari descrevem como o corpo se organiza em rgos com funes fixas, criando uma hierarquia que captura os fluxos de intensidade. O organismo puro  o corpo totalmente estratificado: cada parte tem funo, cada fluxo tem direo. "Os estratos so atos de captura, so como buracos negros ou ocluses que se esforam para reter tudo o que estiver ao alcance." Observe como os rgos mantm posies rgidas e as conexes so espessas   o corpo enquanto mquina funcional, antes de qualquer linha de fuga.',params:{organismo:.95,intensidade:.1,hierarquia:.9,rigidez:.9,desorganizacao:.02,crueldade:.8,antiHabito:.02,multiplicidade:.05,linhasDeFuga:.02,territorializacao:.85,reterritorializacao:.7,hubs:.75,esquecimento:.02,ruido:.05,densidade:.3},overlays:["cso","afetos","connections","heatTerritory"]},{id:"estratos-geologicos",name:"Estratos Geolgicos",icon:"",description:"Camadas sedimentares. Territrios profundos, sem mobilidade.",plateauRef:"Plat 3  10.000 a.C.: A geologia da moral",theory:'"A geologia da moral" descreve como a matria se organiza em estratos  camadas de sedimentao que capturam os fluxos. O estrato  dupla articulao: contedo e expresso. Deleuze e Guattari distinguem trs grandes estratos: o fsico-qumico, o orgnico e o antropomrfico. Cada camada se deposita sobre a anterior, endurecendo, territorializando. O campo de territrio (mbar) mostra essa sedimentao: a memria encarnada na matria, o passado que se recusa a soltar.',params:{organismo:.85,intensidade:.15,hierarquia:.8,rigidez:.85,desorganizacao:.05,crueldade:.75,antiHabito:.03,multiplicidade:.08,linhasDeFuga:.03,territorializacao:.9,reterritorializacao:.65,hubs:.6,esquecimento:.03,ruido:.08,densidade:.35},overlays:["cso","afetos","heatTerritory","connections"]},{id:"aparelho-estado",name:"Aparelho de Estado",icon:"",description:"Captura estatal. Hubs dominantes capturam todos os fluxos.",plateauRef:"Plat 13  7000 a.C.: Aparelho de captura",theory:'"Aparelho de captura" analisa como o Estado opera por captura: os fluxos que circulam livremente so interceptados, codificados, sobrecodificados. O Estado no nasce da guerra  precede a guerra, opera por antecipao. Os hubs no rizoma so pontos de captura que centralizam conexes, criando hierarquia onde havia multiplicidade. "O Estado  soberania. Mas a soberania s reina sobre aquilo que  capaz de interiorizar." Observe como poucos ns dominam toda a rede   a centralizao como mecanismo de poder.',params:{organismo:.8,intensidade:.2,hierarquia:.85,rigidez:.75,desorganizacao:.08,crueldade:.65,antiHabito:.05,multiplicidade:.15,linhasDeFuga:.05,territorializacao:.7,reterritorializacao:.6,hubs:.9,esquecimento:.05,ruido:.1,densidade:.4},overlays:["rizoma","connections","heatTerritory"]},{id:"sobrecodificacao",name:"Sobrecodificao",icon:"",description:"Cdigos sobre cdigos. Rigidez extrema com presso interna.",plateauRef:"Plat 5  587 a.C.  70 d.C.: Sobre alguns regimes de signos",theory:'"Sobre alguns regimes de signos" descreve como os cdigos se empilham: signos sobre signos, interpretaes sobre interpretaes. A sobrecodificao  o excesso de estratificao  quando o sistema produz mais regulao do que pode suportar, gerando presso interna. O regime significante  paranico: tudo faz signo, tudo remete a um centro de significncia. Observe a tenso: as conexes so rgidas, mas a crueldade se acumula  a presso que vai explodir est ali, latente.',params:{organismo:.85,intensidade:.25,hierarquia:.8,rigidez:.8,desorganizacao:.1,crueldade:.7,antiHabito:.05,multiplicidade:.1,linhasDeFuga:.08,territorializacao:.75,reterritorializacao:.55,hubs:.65,esquecimento:.05,ruido:.12,densidade:.45},overlays:["cso","afetos","connections"]},{id:"maquina-despotica",name:"Mquina Desptica",icon:"",description:"Significante desptico. Um centro irradia ordem totalitria.",plateauRef:"Plat 13  7000 a.C.: Aparelho de captura",theory:'O dspota  o significante mestre que subordina todos os fluxos a um centro nico. Em "Aparelho de captura", Deleuze e Guattari mostram como a mquina desptica opera por sobrecodificao total: um ponto irradia ordem sobre todos os outros, apagando a multiplicidade. "O dspota faz a terra, o territrio, depender de sua unidade superior transcendente."  a forma mais extrema de captura: hub dominante, hierarquia mxima, territrio como propriedade do centro.',params:{organismo:.9,intensidade:.15,hierarquia:.9,rigidez:.85,desorganizacao:.03,crueldade:.8,antiHabito:.02,multiplicidade:.05,linhasDeFuga:.02,territorializacao:.8,reterritorializacao:.75,hubs:.85,esquecimento:.02,ruido:.05,densidade:.35},overlays:["connections","heatTerritory","cso","afetos"]},{id:"fissura-inicial",name:"Fissura Inicial",icon:"",description:"Primeiras rachaduras. rgos comeam a perder rigidez.",plateauRef:'Plat 8  1874: Trs novelas, ou "O que se passou?"',theory:'"Trs novelas" explora as linhas que compem uma vida: a linha molar (segmentos rgidos), a linha molecular (fissuras) e a linha de fuga. A fissura inicial  o primeiro tremor molecular  algo se moveu sob a superfcie antes que a estrutura perceba. "Alguma coisa se passou, mas no sei dizer exatamente o qu." Observe como a rigidez comea a ceder: os rgos j no mantm suas posies com a mesma firmeza, as intensidades comeam a circular com mais liberdade.',params:{organismo:.7,intensidade:.3,hierarquia:.65,rigidez:.6,desorganizacao:.2,crueldade:.55,antiHabito:.15,multiplicidade:.15,linhasDeFuga:.1,territorializacao:.6,reterritorializacao:.45,hubs:.5,esquecimento:.1,ruido:.18,densidade:.45},overlays:["cso","afetos","connections"]},{id:"tremor-organico",name:"Tremor Orgnico",icon:"",description:"Vibrao interna. Intensidades crescem dentro da estrutura.",plateauRef:"Plat 6  28 de novembro de 1947: Como criar para si um Corpo sem rgos",theory:'No plat do CsO, Deleuze e Guattari descrevem como as intensidades comeam a percorrer o corpo antes que a organizao se dissolva. O tremor  a vibrao molecular que precede a desestratificao  os afetos crescem dentro da estrutura sem ainda romp-la. "As intensidades se produzem em um spatium ele mesmo intensivo, que no comporta distncias nem medidas." Ative a camada de Consistncia (azul) para ver as intensidades se acumulando nos interstcios da organizao.',params:{organismo:.65,intensidade:.4,hierarquia:.55,rigidez:.55,desorganizacao:.25,crueldade:.5,antiHabito:.2,multiplicidade:.2,linhasDeFuga:.15,territorializacao:.5,reterritorializacao:.4,hubs:.4,esquecimento:.12,ruido:.22,densidade:.5},overlays:["cso","afetos","heatConsistency"]},{id:"erosao-territorial",name:"Eroso Territorial",icon:"",description:"Territrios se dissolvem lentamente. Memria enfraquece.",plateauRef:"Plat 11  1837: Acerca do ritornelo",theory:'"Do ritornelo" descreve como o territrio se forma e se dissolve. O territrio no  um espao geogrfico   um ato expressivo, um motivo que marca e organiza. A eroso territorial  a desterritorializao lenta: as marcas que definem o territrio comeam a se apagar, a memria enfraquece, os limites se tornam porosos. "O territrio  o produto de uma territorializao dos meios e dos ritmos." Observe o campo de territrio (mbar) se dissolvendo gradualmente.',params:{organismo:.55,intensidade:.4,hierarquia:.5,rigidez:.45,desorganizacao:.3,crueldade:.45,antiHabito:.25,multiplicidade:.25,linhasDeFuga:.2,territorializacao:.35,reterritorializacao:.3,hubs:.35,esquecimento:.25,ruido:.25,densidade:.5},overlays:["heatTerritory","cso","afetos"]},{id:"primeira-ruptura",name:"Primeira Ruptura",icon:"",description:"Crueldade excede limiar. Primeira ruptura violenta.",plateauRef:"Plat 9  1933: Micropoltica e segmentaridade",theory:'"Micropoltica e segmentaridade" distingue entre segmentaridade dura (molar) e flexvel (molecular). A primeira ruptura  o momento em que a crueldade acumulada  intensidades reprimidas dentro da organizao  excede o limiar e rompe a estrutura molar. "Tudo  poltico, mas toda poltica  ao mesmo tempo macropoltica e micropoltica." O anel de ruptura (vermelho) marca o ponto onde a acumulao se tornou insustentvel   o evento, a singularidade que muda tudo.',params:{organismo:.6,intensidade:.5,hierarquia:.5,rigidez:.45,desorganizacao:.35,crueldade:.25,antiHabito:.3,multiplicidade:.2,linhasDeFuga:.25,territorializacao:.4,reterritorializacao:.3,hubs:.35,esquecimento:.15,ruido:.3,densidade:.55},overlays:["cso","afetos","connections","flights"]},{id:"descodificacao",name:"Descodificao",icon:"",description:"Cdigos se soltam. Anti-hbito comea a dominar.",plateauRef:"Plat 5  587 a.C.  70 d.C.: Sobre alguns regimes de signos",theory:'A descodificao  o processo inverso da sobrecodificao: os cdigos se soltam, os signos perdem suas referncias fixas. O anti-hbito comea a dominar  cada conexo pode ser re-feita de forma improvvel, cada signo pode significar outra coisa. "Os fluxos descodificados escorrem por todos os lados, atravessam as muralhas." Observe como CsO e Rizoma comeam a coexistir: a hierarquia orgnica e o grafo acntrico ocupam o mesmo espao, criando tenso produtiva.',params:{organismo:.5,intensidade:.5,hierarquia:.4,rigidez:.4,desorganizacao:.4,crueldade:.4,antiHabito:.4,multiplicidade:.3,linhasDeFuga:.3,territorializacao:.35,reterritorializacao:.25,hubs:.3,esquecimento:.2,ruido:.3,densidade:.55},overlays:["cso","afetos","rizoma"]},{id:"desterritorializacao",name:"Desterritorializao",icon:"",description:"Fuga ativa dos territrios. Conexes se rompem.",plateauRef:"Plat 14  1440: O liso e o estriado",theory:'"O liso e o estriado" descreve dois espaos: o estriado (organizado, medido, territorizado) e o liso (aberto, intensivo, nmade). A desterritorializao  a passagem do estriado ao liso  o abandono ativo dos territrios. "O espao liso  percorrido por um trao que no tem comeo nem fim, que passa entre os pontos." As linhas de fuga (traos pontilhados roxos) mostram essa travessia: conexes improvveis que perfuram o espao estriado.',params:{organismo:.4,intensidade:.55,hierarquia:.3,rigidez:.3,desorganizacao:.5,crueldade:.35,antiHabito:.5,multiplicidade:.35,linhasDeFuga:.6,territorializacao:.2,reterritorializacao:.15,hubs:.2,esquecimento:.3,ruido:.35,densidade:.55},overlays:["flights","cso","afetos","rizoma"]},{id:"nomadismo",name:"Nomadismo",icon:"",description:"Mquina de guerra nmade. Mobilidade constante.",plateauRef:"Plat 12  1227: Tratado de nomadologia  A mquina de guerra",theory:'"Tratado de nomadologia" ope a mquina de guerra nmade ao aparelho de Estado. O nmade no  quem viaja, mas quem ocupa o espao liso: sem territrio fixo, sem hierarquia, mobilidade como modo de existncia. "O nmade tem um territrio, segue trajetos costumeiros, vai de um ponto a outro, no ignora os pontos. Mas a questo  que o ponto existe apenas como ponto de passagem." As partculas de intensidade (afetos) vagam sem destino fixo, e as linhas de fuga conectam os pontos mais distantes.',params:{organismo:.3,intensidade:.55,hierarquia:.2,rigidez:.2,desorganizacao:.5,crueldade:.4,antiHabito:.6,multiplicidade:.5,linhasDeFuga:.7,territorializacao:.1,reterritorializacao:.1,hubs:.15,esquecimento:.4,ruido:.45,densidade:.5},overlays:["cso","afetos","rizoma","flights"]},{id:"linhas-de-fuga",name:"Linhas de Fuga",icon:"",description:"Escape puro. Conexes improvveis dominam.",plateauRef:"Plat 9  1933: Micropoltica e segmentaridade",theory:'As linhas de fuga so o terceiro tipo de linha em "Micropoltica": nem molares (segmentos rgidos) nem moleculares (fissuras), so linhas de ruptura absoluta. Conexes improvveis entre pontos distantes que abrem o espao para o novo. "Uma linha de fuga j  algo complexo, e os perigos que comporta so mltiplos." O escape criativo que desorganiza todos os estratos  mas que tambm pode se destruir, virar linha de abolio. Observe a proliferao de linhas tracejadas roxas no espao.',params:{organismo:.25,intensidade:.6,hierarquia:.15,rigidez:.15,desorganizacao:.6,crueldade:.35,antiHabito:.65,multiplicidade:.55,linhasDeFuga:.9,territorializacao:.08,reterritorializacao:.05,hubs:.15,esquecimento:.35,ruido:.4,densidade:.55},overlays:["flights","rizoma","heatConsistency","afetos"]},{id:"devir-animal",name:"Devir-Animal",icon:"",description:"Transformao molecular. Fronteiras de tipo se dissolvem.",plateauRef:"Plat 10  1730: Devir-intenso, devir-animal, devir-imperceptvel...",theory:'"Devir-intenso, devir-animal" descreve como as fronteiras entre espcies, entre tipos, se dissolvem em processos moleculares. No  imitao nem semelhana:  entrar na zona de indiscernibilidade onde as identidades fixas se transformam. "Devir , a partir das formas que se tem, do sujeito que se , extrair partculas entre as quais se instauram relaes de velocidade e lentido mais prximas daquilo em que se est devindo." As partculas de hue variado mostram essa dissoluo de fronteiras de tipo.',params:{organismo:.3,intensidade:.65,hierarquia:.2,rigidez:.15,desorganizacao:.55,crueldade:.3,antiHabito:.55,multiplicidade:.45,linhasDeFuga:.55,territorializacao:.2,reterritorializacao:.1,hubs:.2,esquecimento:.25,ruido:.4,densidade:.6},overlays:["cso","afetos","heatConsistency"]},{id:"devir-imperceptivel",name:"Devir-Imperceptvel",icon:"",description:"Dissoluo gradual. Partculas perdem identidade.",plateauRef:"Plat 10  1730: Devir-intenso, devir-animal, devir-imperceptvel...",theory:'O devir-imperceptvel  o limite de todos os devires: dissolver-se no mundo, tornar-se partcula entre partculas, perder a identidade sem perder a singularidade. "Fazer como todo mundo"  mas de forma que esse "todo mundo" j no signifique nada de molar. "Reduzir-se a uma ou vrias linhas abstratas que vo se continuar e se conjugar com outras, para produzir imediatamente, diretamente, um mundo." Observe a baixa densidade, o esquecimento alto  o sistema se dissolve mantendo apenas vestgios de consistncia.',params:{organismo:.15,intensidade:.45,hierarquia:.1,rigidez:.1,desorganizacao:.7,crueldade:.3,antiHabito:.7,multiplicidade:.3,linhasDeFuga:.5,territorializacao:.1,reterritorializacao:.05,hubs:.1,esquecimento:.5,ruido:.35,densidade:.4},overlays:["cso","afetos","heatConsistency"]},{id:"cso-pulsante",name:"CsO Pulsante",icon:"",description:"Intensidades dominam. Pulso vital sem hierarquia.",plateauRef:"Plat 6  28 de novembro de 1947: Como criar para si um Corpo sem rgos",theory:'O CsO no  o corpo destrudo, mas o corpo liberado da organizao. Em "28 de novembro de 1947",  descrito como superfcie de intensidades puras: sem rgos que distribuam funes, restam apenas pulsaes, fluxos, afetos que percorrem uma superfcie sem estratificao. "O CsO  o que resta quando tudo foi retirado. E o que se retira  justamente o fantasma, o conjunto de significncias e subjetivaes." As zonas pulsantes mostram regies de intensidade que modulam os afetos sem organiz-los.',params:{organismo:.1,intensidade:.9,hierarquia:.1,rigidez:.1,desorganizacao:.8,crueldade:.3,antiHabito:.75,multiplicidade:.4,linhasDeFuga:.5,territorializacao:.1,reterritorializacao:.08,hubs:.1,esquecimento:.3,ruido:.45,densidade:.7},overlays:["cso","afetos","heatConsistency"]},{id:"cso-profundo",name:"CsO Profundo",icon:"",description:"Plano de consistncia pleno. Zero especializao.",plateauRef:"Plat 6  28 de novembro de 1947: Como criar para si um Corpo sem rgos",theory:'O plano de consistncia  o CsO levado ao limite: zero especializao, pura imanncia. Cada intensidade circula sem obstculo, sem hierarquia, sem memria. O perigo aqui  o CsO vazio  a catatonia, o corpo esvaziado que nada mais produz. "Tipos ou gneros de CsO: existem CsO vazios, cancerosos, totalitrios, fascistas." Deleuze e Guattari insistem: o CsO  desejo, no destruio.  preciso faz-lo com prudncia. As linhas de fuga e o plano de consistncia (azul) coexistem num espao sem centro.',params:{organismo:.05,intensidade:.85,hierarquia:.05,rigidez:.05,desorganizacao:.9,crueldade:.25,antiHabito:.85,multiplicidade:.5,linhasDeFuga:.6,territorializacao:.05,reterritorializacao:.03,hubs:.05,esquecimento:.35,ruido:.5,densidade:.65},overlays:["cso","afetos","heatConsistency","flights"]},{id:"plano-imanencia",name:"Plano de Imanncia",icon:"",description:"Pura imanncia. Sem transcendncia, puro fluxo.",plateauRef:"Plat 15  Concluso: Regras concretas e mquinas abstratas",theory:'Na concluso de Mil Plats, o plano de imanncia  apresentado como o horizonte de todos os agenciamentos: o campo transcendental sem transcendncia, onde tudo coexiste sem hierarquia. "O plano de imanncia ou de consistncia no  um plano no sentido de um programa, um desgnio, mesmo que virtual. Tambm no  um plano no sentido de nvel ou dimenso.  o plano de proliferao, de povoamento, de contgio." Puro fluxo, sem sujeito, sem objeto  apenas relaes de velocidade e lentido entre partculas.',params:{organismo:.05,intensidade:.8,hierarquia:.05,rigidez:.05,desorganizacao:.85,crueldade:.2,antiHabito:.8,multiplicidade:.55,linhasDeFuga:.55,territorializacao:.05,reterritorializacao:.03,hubs:.05,esquecimento:.3,ruido:.55,densidade:.75},overlays:["cso","afetos","heatConsistency"]},{id:"ovo-intenso",name:"Ovo Intenso",icon:"",description:"O ovo como CsO: superfcie pr-organizacional de intensidades.",plateauRef:"Plat 6  28 de novembro de 1947: Como criar para si um Corpo sem rgos",theory:'O ovo  a metfora do CsO em estado germinal: superfcie pr-organizacional percorrida por intensidades, gradientes, limiares. Antes de haver rgos, h apenas zonas de intensidade que definem o que o corpo pode. "O ovo intenso  definido por eixos e vetores, gradientes e limiares, tendncias dinmicas com mutao de energia." O ovo intenso  potncia pura  observe como a alta densidade de afetos preenche o espao de forma homognea, sem hierarquia, como uma superfcie vibrante.',params:{organismo:.08,intensidade:.95,hierarquia:.05,rigidez:.05,desorganizacao:.85,crueldade:.2,antiHabito:.8,multiplicidade:.35,linhasDeFuga:.4,territorializacao:.08,reterritorializacao:.05,hubs:.05,esquecimento:.2,ruido:.4,densidade:.8},overlays:["cso","afetos","heatConsistency"]},{id:"delirio-controlado",name:"Delrio Controlado",icon:"",description:"Caos produtivo. Rupturas frequentes geram novos padres.",plateauRef:"Plat 6  28 de novembro de 1947: Como criar para si um Corpo sem rgos",theory:'Deleuze e Guattari advertem:  preciso prudncia ao criar o CsO. No se desmonta a organizao com golpes de martelo. "Lodged on the stratum, an experimentation on a body without organs can be carried out only prudently." O delrio controlado  a desestratificao prudente  rupturas frequentes mas administrveis, caos produtivo que gera novos padres sem aniquilar. A crueldade est baixa (rupturas fceis) mas a multiplicidade e as linhas de fuga mantm o sistema produtivo, no destrutivo.',params:{organismo:.15,intensidade:.9,hierarquia:.12,rigidez:.1,desorganizacao:.8,crueldade:.12,antiHabito:.85,multiplicidade:.65,linhasDeFuga:.7,territorializacao:.08,reterritorializacao:.05,hubs:.1,esquecimento:.4,ruido:.55,densidade:.8},overlays:["cso","afetos","flights","heatConsistency"]},{id:"rizoma-nascente",name:"Rizoma Nascente",icon:"",description:"Primeiras conexes. Multiplicidade baixa, crescimento lento.",plateauRef:"Plat 1  Introduo: Rizoma",theory:'A introduo de Mil Plats apresenta o rizoma como modelo anti-hierrquico: sem comeo nem fim, sem centro, mltiplas entradas. "O rizoma conecta um ponto qualquer a outro ponto qualquer, e cada um de seus traos no remete necessariamente a traos de mesma natureza." O rizoma nascente so as primeiras conexes  qualquer ponto pode conectar a qualquer outro, mas o crescimento ainda  tmido. Os diamantes verdes marcam as entradas: portais por onde o rizoma pode ser acessado.',params:{organismo:.45,intensidade:.35,hierarquia:.35,rigidez:.35,desorganizacao:.25,crueldade:.45,antiHabito:.2,multiplicidade:.2,linhasDeFuga:.15,territorializacao:.4,reterritorializacao:.3,hubs:.25,esquecimento:.1,ruido:.2,densidade:.45},overlays:["rizoma","connections","afetos"]},{id:"rizoma-proliferante",name:"Rizoma Proliferante",icon:"",description:"Crescimento explosivo. Novas entradas surgem constantemente.",plateauRef:"Plat 1  Introduo: Rizoma",theory:"Os seis princpios do rizoma: 1 e 2  conexo e heterogeneidade: qualquer ponto pode conectar a qualquer outro. 3  multiplicidade: no h unidade que sirva de piv, no h sujeito nem objeto. 4  ruptura assignificante: pode ser cortado e recomear. 5 e 6  cartografia e decalcomania: o rizoma faz mapa, no decalque. Quando a multiplicidade se intensifica, novas entradas surgem constantemente  o sistema cresce por proliferao, no por diviso hierrquica.",params:{organismo:.3,intensidade:.5,hierarquia:.2,rigidez:.2,desorganizacao:.5,crueldade:.4,antiHabito:.5,multiplicidade:.85,linhasDeFuga:.4,territorializacao:.25,reterritorializacao:.15,hubs:.3,esquecimento:.15,ruido:.35,densidade:.55},overlays:["rizoma","cso","afetos"]},{id:"maquina-guerra",name:"Mquina de Guerra",icon:"",description:"Rizoma como arma. Conexes improvveis destroem hierarquias.",plateauRef:"Plat 12  1227: Tratado de nomadologia  A mquina de guerra",theory:'A mquina de guerra  exterior ao Estado: no nasce para fazer guerra, mas para criar espao liso. "A mquina de guerra  a inveno dos nmades (enquanto se conjuga com a mquina de guerra nmade)." Em "Tratado de nomadologia", o rizoma se torna arma  conexes improvveis que destroem hierarquias, linhas de fuga que dissolvem os aparelhos de captura. A guerra  o resultado quando o Estado se apropria da mquina de guerra, no sua essncia. Observe a proliferao de linhas de fuga (roxas) e a ausncia de hubs dominantes.',params:{organismo:.2,intensidade:.65,hierarquia:.1,rigidez:.1,desorganizacao:.7,crueldade:.25,antiHabito:.7,multiplicidade:.6,linhasDeFuga:.85,territorializacao:.1,reterritorializacao:.05,hubs:.1,esquecimento:.3,ruido:.5,densidade:.6},overlays:["rizoma","flights","cso","afetos"]},{id:"rizoma-frio",name:"Rizoma Frio",icon:"",description:"Esquecimento ativo. Estruturas se formam e dissolvem.",plateauRef:"Plat 1  Introduo: Rizoma",theory:'O rizoma no  eterno  um de seus princpios  a ruptura assignificante: pode ser cortado em qualquer ponto e recomear segundo outra de suas linhas. "Todo rizoma compreende linhas de segmentaridade segundo as quais ele  estratificado, territorializado, organizado, significado, atribudo, etc.; mas compreende tambm linhas de desterritorializao pelas quais ele foge sem parar." O rizoma frio  o esquecimento ativo: estruturas se formam e dissolvem, a poda  to essencial quanto o crescimento.',params:{organismo:.4,intensidade:.25,hierarquia:.35,rigidez:.35,desorganizacao:.3,crueldade:.5,antiHabito:.2,multiplicidade:.3,linhasDeFuga:.2,territorializacao:.35,reterritorializacao:.25,hubs:.3,esquecimento:.8,ruido:.2,densidade:.35},overlays:["rizoma","connections"]},{id:"rede-acentrada",name:"Rede Acentrada",icon:"",description:"Sem hierarquia, sem hubs. Igualdade radical de conexes.",plateauRef:"Plat 1  Introduo: Rizoma",theory:'O rizoma como rede acentrada se ope tanto  rvore (modelo hierrquico) quanto ao fascculo (falso rizoma com centro oculto). "Diferentemente das rvores ou de suas razes, o rizoma conecta um ponto qualquer com outro ponto qualquer." Sem hubs, sem hierarquia: igualdade radical de conexes, onde nenhum ponto domina os outros. Observe como a Hub Dominance nos diagnsticos fica prxima de zero   a rede distribuda em sua forma mais pura, sem captura.',params:{organismo:.2,intensidade:.45,hierarquia:.1,rigidez:.15,desorganizacao:.55,crueldade:.4,antiHabito:.5,multiplicidade:.5,linhasDeFuga:.45,territorializacao:.2,reterritorializacao:.15,hubs:.02,esquecimento:.25,ruido:.35,densidade:.5},overlays:["rizoma","cso","afetos"]},{id:"simbiose-vibrante",name:"Simbiose Vibrante",icon:"",description:"Equilbrio dinmico. Todas as camadas coexistem em harmonia.",plateauRef:"Plat 10  1730: Devir-intenso, devir-animal, devir-imperceptvel...",theory:'A simbiose vibrante  o plat como estado: um equilbrio dinmico onde todas as camadas coexistem sem que uma domine. Como Deleuze e Guattari definem: "Um plat no  um ponto culminante; tampouco est no topo ou no fundo de algo.  uma regio contnua de intensidades, vibrando sobre si mesma, sem orientao para um ponto culminante ou uma finalidade exterior." Este  o conceito que nomeia o livro inteiro  cada captulo  um plat, uma regio de intensidade autossuficiente. Observe todas as camadas ativas coexistindo.',params:{organismo:.45,intensidade:.55,hierarquia:.4,rigidez:.35,desorganizacao:.35,crueldade:.45,antiHabito:.35,multiplicidade:.4,linhasDeFuga:.35,territorializacao:.35,reterritorializacao:.3,hubs:.3,esquecimento:.2,ruido:.3,densidade:.55},overlays:["cso","afetos","rizoma","heatConsistency"]},{id:"metastase",name:"Metstase",icon:"",description:"Hubs capturam mas linhas de fuga proliferam. Tenso mxima.",plateauRef:"Plat 13  7000 a.C.: Aparelho de captura + Plat 12  Nomadologia",theory:'A metstase  o ponto de tenso mxima entre captura e fuga: os hubs tentam centralizar enquanto linhas de fuga proliferam.  o momento em que o aparelho de captura e a mquina de guerra coexistem em conflito aberto, sem resoluo. "O Estado no para de produzir e de reproduzir segmentos ideais, e a mquina de guerra no para de fazer explodir esses segmentos." No h sntese dialtica aqui  apenas coexistncia tensa, processos que se parasitam mutuamente.',params:{organismo:.5,intensidade:.6,hierarquia:.45,rigidez:.4,desorganizacao:.45,crueldade:.3,antiHabito:.5,multiplicidade:.55,linhasDeFuga:.6,territorializacao:.3,reterritorializacao:.2,hubs:.65,esquecimento:.2,ruido:.4,densidade:.6},overlays:["rizoma","flights","cso","afetos"]},{id:"reterritorializacao",name:"Reterritorializao",icon:"",description:"Recaptura gradual. Memria reconstri territrios perdidos.",plateauRef:"Plat 11  1837: Acerca do ritornelo",theory:'"Do ritornelo" mostra que toda desterritorializao  acompanhada de reterritorializao: no se pode fugir sem recriar algum tipo de territrio. "A desterritorializao, por sua vez, deve ser pensada como potncia perfeitamente positiva, que tem seus graus e seus limiares (epistrato) e que sempre  relativa, tendo um reverso, uma reterritorializao." A memria reconstri, o hbito se refaz, mas nunca identicamente  repetio com diferena. O campo de territrio (mbar) cresce de volta, mas com outra configurao.',params:{organismo:.6,intensidade:.35,hierarquia:.55,rigidez:.5,desorganizacao:.15,crueldade:.5,antiHabito:.1,multiplicidade:.2,linhasDeFuga:.1,territorializacao:.7,reterritorializacao:.8,hubs:.45,esquecimento:.08,ruido:.15,densidade:.45},overlays:["heatTerritory","connections","afetos"]},{id:"agenciamento",name:"Agenciamento",icon:"",description:"Composio maqunica. rgos + intensidades + rizoma coexistem.",plateauRef:"Plat 15  Concluso: Regras concretas e mquinas abstratas",theory:'O agenciamento  o conceito central de Mil Plats: composio de corpos (agenciamento maqunico de corpos) e enunciados (agenciamento coletivo de enunciao). "Um agenciamento comporta dois segmentos: um de contedo, o outro de expresso."  a unidade mnima do pensamento deleuziano: nem sujeito nem objeto, mas a composio que os atravessa. Todo agenciamento tem uma ponta territorial (reterritorializao) e uma ponta de fuga (desterritorializao). Observe como todas as camadas coexistem: rgos, intensidades, rizoma  agenciadas, no fundidas.',params:{organismo:.5,intensidade:.5,hierarquia:.45,rigidez:.4,desorganizacao:.4,crueldade:.4,antiHabito:.4,multiplicidade:.45,linhasDeFuga:.4,territorializacao:.4,reterritorializacao:.3,hubs:.35,esquecimento:.2,ruido:.3,densidade:.55},overlays:["cso","afetos","rizoma","connections"]},{id:"ritornelo",name:"Ritornelo",icon:"",description:"Repetio com diferena. Ciclos de territorializao e fuga.",plateauRef:"Plat 11  1837: Acerca do ritornelo",theory:'"Do ritornelo"  talvez o plat mais musical: um motivo sonoro que marca territrio, que organiza o caos em cosmos. Deleuze e Guattari descrevem trs momentos: 1) traar um centro no caos (a criana que cantarola no escuro), 2) organizar um espao em torno desse centro (o territrio como ato expressivo), 3) abrir-se ao cosmos (a linha de fuga do territrio). "O ritornelo  o contedo propriamente musical, o bloco de contedo prprio da msica." O ciclo  territorializar, desterritorializar, reterritorializar   o ritmo fundamental, repetio que nunca retorna ao mesmo.',params:{organismo:.55,intensidade:.5,hierarquia:.45,rigidez:.4,desorganizacao:.35,crueldade:.4,antiHabito:.35,multiplicidade:.35,linhasDeFuga:.45,territorializacao:.55,reterritorializacao:.5,hubs:.35,esquecimento:.25,ruido:.3,densidade:.5},overlays:["cso","afetos","heatTerritory","flights"]}],ca="'IBM Plex Mono', monospace",y5="'Doto', monospace",ea="#6366f1",Fk=e=>Math.min(1,Math.max(0,e)),aee=()=>Math.random().toString(36).slice(2,8),_k=[{key:"organismo",label:"Organismo",color:"#f472b6"},{key:"intensidade",label:"Intensidade",color:"#fbbf24"},{key:"hierarquia",label:"Hierarquia",color:"#fb923c"},{key:"rigidez",label:"Rigidez",color:"#ef4444"},{key:"desorganizacao",label:"Desorganizacao",color:"#a78bfa"},{key:"crueldade",label:"Crueldade",color:"#dc2626"},{key:"antiHabito",label:"Anti-habito",color:"#818cf8"}],Nk=[{key:"multiplicidade",label:"Multiplicidade",color:"#34d399"},{key:"linhasDeFuga",label:"Linhas de Fuga",color:"#a78bfa"},{key:"territorializacao",label:"Territorializacao",color:"#f97316"},{key:"reterritorializacao",label:"Reterritorializacao",color:"#fb923c"},{key:"hubs",label:"Hubs",color:"#60a5fa"},{key:"esquecimento",label:"Esquecimento",color:"#94a3b8"}],see=[{key:"ruido",label:"Ruido",color:"#38bdf8"},{key:"densidade",label:"Densidade",color:"#6ee7b7"}],iee=[{key:"cso",label:"CsO"},{key:"afetos",label:"Afetos"},{key:"rizoma",label:"Rizoma"},{key:"heatConsistency",label:"Consistencia"},{key:"heatTerritory",label:"Territorio"},{key:"connections",label:"Conexoes"},{key:"flights",label:"Fugas"}],lee={afeto:{title:"AFETO (Intensidade)",desc:"Particula de intensidade que percorre o CsO. Fluxo de desejo sem organizacao.",color:"#fbbf24"},orgao:{title:"ORGAO (Estrato)",desc:"No da hierarquia organica. Conectado por springs. Saude diminui com desorganizacao.",color:"#60a5fa"},"no-rizoma":{title:"NO RIZOMA (Multiplicidade)",desc:"Ponto do grafo acentrico. Diamantes verdes = entradas. Heat = atividade local.",color:"#34d399"},zona:{title:"ZONA DE AFETO",desc:"Campo movel que modula intensidades. Atrai afetos, mistura hues, deposita consistencia.",color:"#a78bfa"}},cee=[.1,.25,.5,1,2,3];function Fx(e,t,n){e=(e%360+360)%360;const r=(1-Math.abs(2*n-1))*t,a=r*(1-Math.abs(e/60%2-1)),i=n-r/2;let s=0,c=0,l=0;return e<60?(s=r,c=a):e<120?(s=a,c=r):e<180?(c=r,l=a):e<240?(c=a,l=r):e<300?(s=a,l=r):(s=r,l=a),[s+i,c+i,l+i]}function dee(e,t){const n=[],r=[],a=new Map;if(t.has("cso")||t.has("connections")){for(const i of e.cso.organs){const s=n.length;a.set("o"+i.id,s);const[c,l,d]=Fx(i.hue,.5,.55);n.push({nx:i.x,ny:i.y,z:i.importance*.5,r:c,g:l,b:d})}for(const i of e.cso.organs){const s=a.get("o"+i.id);if(s!==void 0)for(const c of i.connections){const l=a.get("o"+c);l!==void 0&&s<l&&r.push({a:s,b:l})}}}if(t.has("afetos"))for(const i of e.cso.affects){const[s,c,l]=Fx(i.hue,.6,.5+i.intensity*.15);n.push({nx:i.x,ny:i.y,z:i.intensity*.3,r:s,g:c,b:l})}if(t.has("rizoma")){for(const s of e.rhizome.nodes){const c=n.length;a.set("r"+s.id,c);const[l,d,u]=Fx(160+s.heat*40,.6,.45+s.heat*.2);n.push({nx:s.x,ny:s.y,z:s.heat*.4+.05,r:l,g:d,b:u})}const i=hw(e.rhizome);for(const s of i){const c=a.get("r"+s.from),l=a.get("r"+s.to);c!==void 0&&l!==void 0&&r.push({a:c,b:l})}}return{particles:n,links:r}}const uee=({active:e})=>{var ct,vt;const[t,n]=S.useState(!0),[r,a]=S.useState(Ix),[i,s]=S.useState("cso"),[c,l]=S.useState("select"),[d,u]=S.useState(new Set(["cso","afetos","rizoma","connections"])),[h,m]=S.useState(zZ),[f,g]=S.useState(""),[x,v]=S.useState(null),[b,w]=S.useState(!0),[M,k]=S.useState(1),[R,j]=S.useState(1),[I,E]=S.useState("2d"),[O,L]=S.useState(()=>{try{const xe=localStorage.getItem("mp_snapshots");return xe?JSON.parse(xe):[]}catch{return[]}}),$=S.useRef(null),F=S.useRef(null),B=S.useRef(null),W=S.useRef({..._u,showTrails:!0,trailLen:8,showBonds:!0,ptSize:4,camera:{yaw:.55,pitch:.48,dist:3,panX:0,panY:0}}),re=S.useRef(Tk(Ix())),oe=S.useRef(r),te=S.useRef(t),J=S.useRef(c),pe=S.useRef(d),P=S.useRef([]),V=S.useRef(h),fe=S.useRef(0),ye=S.useRef(0),Se=S.useRef([]),we=S.useRef(0),ke=S.useRef(0),De=S.useRef({zoom:1,panX:0,panY:0}),_e=S.useRef(!1),ae=S.useRef({x:0,y:0,vpx:0,vpy:0}),Re=S.useRef(R),Fe=S.useRef(I),Oe=S.useRef(null),[ne,nt]=S.useState(!1),[pt,Et]=S.useState(0),[_t,Ct]=S.useState([]);oe.current=r,te.current=t,J.current=c,pe.current=d,Re.current=R,Fe.current=I;const Xe=S.useCallback(xe=>{re.current=Tk(xe),P.current=[],v(null)},[]),Ut=S.useCallback(xe=>{const ge=g5.find(Ee=>Ee.id===xe);ge&&(a({...ge.params}),u(new Set(ge.overlays)),g(xe),Xe(ge.params))},[Xe]),Le=OZ(r),Ke=S.useCallback(xe=>{a(DZ(xe)),g("")},[]),mt=S.useCallback(xe=>{u(ge=>{const Ee=new Set(ge);return Ee.has(xe)?Ee.delete(xe):Ee.add(xe),Ee})},[]),an=S.useCallback((xe,ge)=>{const Ee=$.current;if(!Ee)return null;const me=Ee.getBoundingClientRect(),je=De.current,Te=Ee.width*.5+je.panX,Ae=Ee.height*.5+je.panY,Tt=Math.min(Ee.width,Ee.height)*.47*je.zoom;return{wx:(xe-me.left-Te)/Tt,wy:(ge-me.top-Ae)/Tt}},[]),gn=S.useCallback(xe=>{if(xe.preventDefault(),xe.stopPropagation(),Fe.current==="3d"){const Te=W.current.camera;Te.dist=Math.max(1,Math.min(10,Te.dist+(xe.deltaY>0?.2:-.2)));return}const ge=De.current,Ee=xe.deltaY>0?.92:1.08,me=Math.max(.25,Math.min(5,ge.zoom*Ee)),je=$.current;if(je){const Te=je.getBoundingClientRect(),Ae=xe.clientX-Te.left-je.width*.5,Tt=xe.clientY-Te.top-je.height*.5,xt=me/ge.zoom;ge.panX=Ae-(Ae-ge.panX)*xt,ge.panY=Tt-(Tt-ge.panY)*xt}ge.zoom=me,k(me)},[]),Be=S.useCallback((xe,ge)=>{const Ee=re.current;let me=.08,je=null;for(const Te of Ee.cso.organs){const Ae=Math.sqrt((Te.x-xe)**2+(Te.y-ge)**2);Ae<me&&(me=Ae,je={type:"orgao",id:Te.id,x:Te.x,y:Te.y,importance:Te.importance,health:Te.health,nConns:Te.connections.length,hue:Te.hue})}for(const Te of Ee.rhizome.nodes){const Ae=Math.sqrt((Te.x-xe)**2+(Te.y-ge)**2);Ae<me&&(me=Ae,je={type:"no-rizoma",id:Te.id,x:Te.x,y:Te.y,heat:Te.heat,territory:Te.territory,isEntry:Te.isEntry,nConns:Te.connections.length})}for(const Te of Ee.cso.zones){const Ae=Math.sqrt((Te.x-xe)**2+(Te.y-ge)**2);Ae<Te.radius&&Ae<me+.05&&(je={type:"zona",x:Te.x,y:Te.y,strength:Te.strength,hue:Te.hue,radius:Te.radius},me=Ae)}for(const Te of Ee.cso.affects){const Ae=Math.sqrt((Te.x-xe)**2+(Te.y-ge)**2);Ae<Math.min(me,.04)&&(me=Ae,je={type:"afeto",x:Te.x,y:Te.y,intensity:Te.intensity,hue:Te.hue,life:Te.life})}v(je)},[]),ft=S.useCallback(xe=>{if(xe.button===1||xe.button===0&&xe.altKey){if(xe.preventDefault(),_e.current=!0,Fe.current==="3d")ae.current={x:xe.clientX,y:xe.clientY,vpx:W.current.camera.yaw,vpy:W.current.camera.pitch};else{const me=De.current;ae.current={x:xe.clientX,y:xe.clientY,vpx:me.panX,vpy:me.panY}}return}if(Fe.current==="3d")return;const ge=an(xe.clientX,xe.clientY);if(!ge)return;const Ee=J.current;if(Ee==="select"){Be(ge.wx,ge.wy);return}if(Ee==="arrastar"){const me=re.current;let je=.1,Te=null;for(let Ae=0;Ae<me.cso.organs.length;Ae++){const Tt=me.cso.organs[Ae],xt=Math.sqrt((Tt.x-ge.wx)**2+(Tt.y-ge.wy)**2);xt<je&&(je=xt,Te={type:"organ",idx:Ae})}for(let Ae=0;Ae<me.rhizome.nodes.length;Ae++){const Tt=me.rhizome.nodes[Ae],xt=Math.sqrt((Tt.x-ge.wx)**2+(Tt.y-ge.wy)**2);xt<je&&(je=xt,Te={type:"rnode",idx:Ae})}for(let Ae=0;Ae<me.cso.zones.length;Ae++){const Tt=me.cso.zones[Ae],xt=Math.sqrt((Tt.x-ge.wx)**2+(Tt.y-ge.wy)**2);xt<je&&(je=xt,Te={type:"zone",idx:Ae})}Oe.current=Te;return}Ik(re.current,Ee,ge.wx,ge.wy,oe.current,.15)},[an,Be]),Qt=S.useCallback(xe=>{if(_e.current){if(Fe.current==="3d"){const me=W.current.camera;me.yaw=ae.current.vpx+(xe.clientX-ae.current.x)*.005,me.pitch=Math.max(.1,Math.min(1.4,ae.current.vpy-(xe.clientY-ae.current.y)*.005))}else{const me=De.current;me.panX=ae.current.vpx+(xe.clientX-ae.current.x),me.panY=ae.current.vpy+(xe.clientY-ae.current.y)}return}if(xe.buttons!==1||Fe.current==="3d")return;const ge=J.current;if(ge==="select")return;if(ge==="arrastar"&&Oe.current){const me=an(xe.clientX,xe.clientY);if(!me)return;const je=re.current,Te=Oe.current;Te.type==="organ"&&je.cso.organs[Te.idx]?(je.cso.organs[Te.idx].x=me.wx,je.cso.organs[Te.idx].y=me.wy,je.cso.organs[Te.idx].vx=0,je.cso.organs[Te.idx].vy=0):Te.type==="rnode"&&je.rhizome.nodes[Te.idx]?(je.rhizome.nodes[Te.idx].x=me.wx,je.rhizome.nodes[Te.idx].y=me.wy,je.rhizome.nodes[Te.idx].vx=0,je.rhizome.nodes[Te.idx].vy=0):Te.type==="zone"&&je.cso.zones[Te.idx]&&(je.cso.zones[Te.idx].x=me.wx,je.cso.zones[Te.idx].y=me.wy);return}const Ee=an(xe.clientX,xe.clientY);Ee&&Ik(re.current,ge,Ee.wx,Ee.wy,oe.current,.15)},[an]),nr=S.useCallback(()=>{_e.current=!1,Oe.current=null},[]),_n=S.useCallback(()=>{const xe=V.current,ge={id:aee(),label:xe.plateauLabel,timestamp:Date.now(),params:{...oe.current},K:xe.K,metrics:{...xe}};L(Ee=>{const me=[ge,...Ee].slice(0,6);return localStorage.setItem("mp_snapshots",JSON.stringify(me)),me})},[]),Rn=S.useCallback(xe=>{a({...xe.params}),g("")},[]),sn=S.useCallback(()=>{De.current={zoom:1,panX:0,panY:0},k(1)},[]),Cn=[{q:"Como voce se sente em relacao a estrutura e ordem na sua vida?",low:"Caos total",high:"Tudo organizado",params:["organismo","hierarquia"]},{q:"Qual a intensidade dos seus sentimentos agora?",low:"Amortecido",high:"Muito intenso",params:["intensidade","crueldade"]},{q:"Quanto desejo de romper padroes voce sente?",low:"Nenhum",high:"Quero destruir tudo",params:["desorganizacao","antiHabito"]},{q:"Como voce se sente em relacao a rigidez das suas conexoes?",low:"Tudo fluido",high:"Muito rigido",params:["rigidez"]},{q:"Quanta vontade de fugir, de escapar voce sente?",low:"Estou bem aqui",high:"Preciso sair",params:["linhasDeFuga"]},{q:"Quao conectado(a) voce se sente com diferentes mundos/pessoas?",low:"Isolado",high:"Hiperconectado",params:["multiplicidade","hubs"]},{q:"Quanto territorio voce quer marcar, defender?",low:"Sou nomade",high:"Defendo meu espaco",params:["territorializacao","reterritorializacao"]},{q:"Quanta turbulencia, ruido mental voce sente?",low:"Mente clara",high:"Muito ruido",params:["ruido"]},{q:"Quao povoado e o seu mundo interno?",low:"Vazio",high:"Transbordando",params:["densidade"]},{q:"Quanto voce quer esquecer, deixar ir?",low:"Guardo tudo",high:"Quero apagar",params:["esquecimento"]}],wt=S.useCallback(()=>{const xe=Ix(),ge=_t,Ee=Cn;for(let me=0;me<Ee.length&&me<ge.length;me++){const je=ge[me];for(const Te of Ee[me].params)xe[Te]=je}a(xe),g(""),Xe(xe),nt(!1),Et(0),Ct([])},[_t,Xe]);if(S.useEffect(()=>{if(!e||I!=="3d")return;const xe=F.current;if(!xe)return;B.current||(B.current=new nw(xe));const ge=xe.parentElement;ge&&B.current.resize(ge.clientWidth,ge.clientHeight)},[e,I]),S.useEffect(()=>{if(!e)return;let xe=!1;ye.current=performance.now();const ge=Ee=>{if(xe)return;const me=Ee-ye.current;ye.current=Ee;const je=Math.min(me*.001,.04)*Re.current;if(Se.current.push(me),Se.current.length>60&&Se.current.shift(),te.current&&VZ(re.current,oe.current,je),we.current+=me,we.current>125){we.current=0;const Te=Se.current.reduce((xt,en)=>xt+en,0)/Se.current.length,Ae=Te>0?1e3/Te:60,Tt=UZ(re.current,oe.current,Ae);V.current=Tt,m(Tt)}if(ke.current+=me,ke.current>200&&(ke.current=0,(pe.current.has("rizoma")||pe.current.has("flights"))&&(P.current=hw(re.current.rhizome))),Fe.current==="2d"){const Te=$.current;if(Te){const Ae=Te.getContext("2d");if(Ae){const Tt=V.current;YZ(Ae,Te.width,Te.height,re.current.cso,re.current.rhizome,re.current.fields,pe.current,oe.current,P.current,re.current.time,De.current,{plateauLabel:Tt.plateauLabel,K:Tt.K,meanIntensity:Tt.meanIntensity})}}}else{const Te=B.current;if(Te&&Te.isReady){const{particles:Ae,links:Tt}=dee(re.current,pe.current);Te.render(Ae,W.current,void 0,Tt)}}fe.current=requestAnimationFrame(ge)};return fe.current=requestAnimationFrame(ge),()=>{xe=!0,cancelAnimationFrame(fe.current)}},[e]),S.useEffect(()=>{if(!e)return;const xe=()=>{const ge=$.current;if(ge){const me=ge.parentElement;me&&(ge.width=me.clientWidth,ge.height=me.clientHeight)}const Ee=F.current;if(Ee&&B.current){const me=Ee.parentElement;me&&B.current.resize(me.clientWidth,me.clientHeight)}};return xe(),window.addEventListener("resize",xe),()=>window.removeEventListener("resize",xe)},[e]),S.useEffect(()=>{var Ee;if(!e)return;const xe=(Ee=$.current)==null?void 0:Ee.parentElement;if(!xe)return;const ge=me=>{me.preventDefault()};return xe.addEventListener("wheel",ge,{passive:!1}),()=>xe.removeEventListener("wheel",ge)},[e]),!e)return null;const st=RE(r),Zt=i==="cso"?_k:i==="rizoma"?Nk:[..._k,...Nk],Pe=x?lee[x.type]:null;return o.jsxs("div",{className:"fixed inset-0 flex",style:{fontFamily:ca,background:"#040408",color:"rgba(255,255,255,0.88)"},children:[o.jsxs("div",{className:"flex-1 relative",style:{minWidth:0},children:[o.jsx("canvas",{ref:$,onWheel:gn,onMouseDown:ft,onMouseMove:Qt,onMouseUp:nr,onMouseLeave:nr,onContextMenu:xe=>xe.preventDefault(),style:{width:"100%",height:"100%",cursor:c!=="select"?"crosshair":"pointer",display:I==="2d"?"block":"none"}}),o.jsx("canvas",{ref:F,onWheel:gn,onMouseDown:ft,onMouseMove:Qt,onMouseUp:nr,onMouseLeave:nr,onContextMenu:xe=>xe.preventDefault(),style:{width:"100%",height:"100%",display:I==="3d"?"block":"none"}}),o.jsxs("div",{style:{position:"absolute",top:56,right:312,display:"flex",gap:2},children:[o.jsx("button",{onClick:()=>E("2d"),title:"Visualizao 2D",style:{background:I==="2d"?"rgba(99,102,241,0.2)":"rgba(0,0,0,0.6)",border:I==="2d"?`1px solid ${ea}`:"1px solid rgba(255,255,255,0.1)",borderRadius:3,padding:"3px 8px",cursor:"pointer",fontSize:7.5,fontWeight:600,color:I==="2d"?ea:"rgba(255,255,255,0.4)",fontFamily:ca},children:"2D"}),o.jsx("button",{onClick:()=>E("3d"),title:"Visualizao 3D",style:{background:I==="3d"?"rgba(99,102,241,0.2)":"rgba(0,0,0,0.6)",border:I==="3d"?`1px solid ${ea}`:"1px solid rgba(255,255,255,0.1)",borderRadius:3,padding:"3px 8px",cursor:"pointer",fontSize:7.5,fontWeight:600,color:I==="3d"?ea:"rgba(255,255,255,0.4)",fontFamily:ca},children:"3D"})]}),o.jsxs("div",{style:{position:"absolute",top:56,left:12,display:"flex",gap:2,alignItems:"center"},children:[o.jsx("span",{style:{fontSize:6.5,color:"rgba(255,255,255,0.25)",fontFamily:ca},children:"VEL"}),cee.map(xe=>o.jsxs("button",{onClick:()=>j(xe),title:`Velocidade ${xe}x`,style:{background:R===xe?"rgba(99,102,241,0.2)":"rgba(0,0,0,0.6)",border:R===xe?`1px solid ${ea}`:"1px solid rgba(255,255,255,0.08)",borderRadius:3,padding:"2px 5px",cursor:"pointer",fontSize:7,color:R===xe?ea:"rgba(255,255,255,0.35)",fontFamily:ca},children:[xe,"x"]},xe))]}),I==="2d"&&o.jsxs("div",{style:{position:"absolute",bottom:12,right:312,background:"rgba(0,0,0,0.75)",borderRadius:4,padding:"3px 8px",fontSize:7,color:"rgba(255,255,255,0.35)",fontFamily:ca,pointerEvents:"none"},children:[(M*100).toFixed(0),"% | alt+arraste = pan | scroll = zoom"]}),I==="3d"&&o.jsx("div",{style:{position:"absolute",bottom:12,right:312,background:"rgba(0,0,0,0.75)",borderRadius:4,padding:"3px 8px",fontSize:7,color:"rgba(255,255,255,0.35)",fontFamily:ca,pointerEvents:"none"},children:"3D | alt+arraste = orbitar | scroll = distancia"}),M!==1&&I==="2d"&&o.jsx("button",{onClick:sn,title:"Resetar zoom",style:{position:"absolute",bottom:30,right:312,background:"rgba(0,0,0,0.75)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:4,padding:"3px 8px",cursor:"pointer",fontSize:7,color:ea,fontFamily:ca},children:"Reset zoom"}),c!=="select"&&o.jsxs("div",{style:{position:"absolute",bottom:12,left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.85)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:6,padding:"4px 14px",fontSize:8.5,color:"rgba(255,255,255,0.5)",fontFamily:ca,pointerEvents:"none"},children:[(ct=Px.find(xe=>xe.id===c))==null?void 0:ct.icon," ",(vt=Px.find(xe=>xe.id===c))==null?void 0:vt.label]}),x&&Pe&&o.jsx(nf,{id:"mp_inspect",title:Pe.title,titleColor:Pe.color,defaultX:12,defaultY:80,zIndex:40,width:220,children:o.jsxs("div",{style:{padding:"6px 10px",fontSize:8,color:"rgba(255,255,255,0.7)",fontFamily:ca},children:[o.jsx("div",{style:{fontSize:7,color:"rgba(255,255,255,0.35)",marginBottom:5,lineHeight:1.4},children:Pe.desc}),o.jsxs("div",{style:{borderTop:"1px solid rgba(255,255,255,0.06)",paddingTop:4},children:[x.type==="afeto"&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{children:["Intensidade: ",o.jsx("span",{style:{color:"#fbbf24"},children:x.intensity.toFixed(2)})]}),o.jsxs("div",{children:["Hue: ",o.jsx("span",{style:{color:`hsl(${x.hue},70%,60%)`},children:x.hue.toFixed(0)})]}),o.jsxs("div",{children:["Vida: ",o.jsx("span",{style:{color:"#6ee7b7"},children:x.life})]})]}),x.type==="orgao"&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{children:["Importancia: ",o.jsx("span",{style:{color:"#60a5fa"},children:x.importance.toFixed(2)})]}),o.jsxs("div",{children:["Saude: ",o.jsx("span",{style:{color:x.health>.5?"#6ee7b7":"#ef4444"},children:x.health.toFixed(2)})]}),o.jsxs("div",{children:["Conexoes: ",o.jsx("span",{style:{color:"#fb923c"},children:x.nConns})]})]}),x.type==="no-rizoma"&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{children:["Heat: ",o.jsx("span",{style:{color:"#fbbf24"},children:x.heat.toFixed(2)})]}),o.jsxs("div",{children:["Territorio: ",o.jsx("span",{style:{color:"#f97316"},children:x.territory.toFixed(2)})]}),o.jsxs("div",{children:["Entrada: ",o.jsx("span",{style:{color:x.isEntry?"#34d399":"#94a3b8"},children:x.isEntry?"Sim":"Nao"})]}),o.jsxs("div",{children:["Conexoes: ",o.jsx("span",{style:{color:"#60a5fa"},children:x.nConns})]})]}),x.type==="zona"&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{children:["Forca: ",o.jsx("span",{style:{color:"#a78bfa"},children:x.strength.toFixed(2)})]}),o.jsxs("div",{children:["Raio: ",o.jsx("span",{style:{color:"#60a5fa"},children:x.radius.toFixed(3)})]})]}),o.jsxs("div",{style:{color:"rgba(255,255,255,0.20)",marginTop:2},children:["(",x.x.toFixed(3),", ",x.y.toFixed(3),")"]})]})]})}),o.jsx(nf,{id:"mp_legend",title:"LEGENDA",titleColor:"rgba(255,255,255,0.25)",defaultX:12,defaultY:Math.max(200,window.innerHeight-200),zIndex:35,width:160,children:o.jsxs("div",{style:{padding:"4px 8px 6px",fontSize:6.5,fontFamily:ca,color:"rgba(255,255,255,0.35)",lineHeight:1.7},children:[o.jsxs("div",{children:[o.jsx("span",{style:{color:"#60a5fa"},children:""})," Orgaos (estratificacao)"]}),o.jsxs("div",{children:[o.jsx("span",{style:{color:"#fbbf24"},children:""})," Afetos (intensidades)"]}),o.jsxs("div",{children:[o.jsx("span",{style:{color:"#34d399"},children:""})," Nos rizoma (entradas)"]}),o.jsxs("div",{children:[o.jsx("span",{style:{color:"#60a5fa"},children:""})," Conexoes rizoma"]}),o.jsxs("div",{children:[o.jsx("span",{style:{color:"#a78bfa"},children:"- -"})," Linhas de fuga"]}),o.jsxs("div",{children:[o.jsx("span",{style:{color:"rgba(99,102,241,0.5)"},children:""})," Consistencia (azul)"]}),o.jsxs("div",{children:[o.jsx("span",{style:{color:"rgba(251,191,36,0.5)"},children:""})," Territorio (ambar)"]}),o.jsx("div",{style:{marginTop:2,color:"rgba(255,255,255,0.15)"},children:"clique = inspecionar"})]})}),re.current.cso.events.length>0&&o.jsx("div",{style:{position:"absolute",top:80,right:312,maxWidth:240,pointerEvents:"none"},children:re.current.cso.events.slice(-4).map((xe,ge)=>o.jsxs("div",{style:{fontSize:7.5,color:xe.color,fontFamily:ca,background:"rgba(0,0,0,0.7)",padding:"2px 6px",borderRadius:3,marginBottom:2,opacity:Math.min(1,xe.ttl/60)},children:[xe.type==="ruptura"?"!":xe.type==="reconexao"?"~":"*"," ",xe.message]},ge))})]}),o.jsxs("div",{className:"flex-shrink-0 overflow-y-auto",style:{width:300,borderLeft:"1px solid rgba(255,255,255,0.06)",background:"rgba(0,0,0,0.93)",padding:"52px 10px 16px"},children:[o.jsx("div",{style:{fontFamily:y5,fontSize:15,fontWeight:700,color:ea,marginBottom:1},children:"MIL PLATOS"}),o.jsx("div",{style:{fontSize:8,color:"rgba(255,255,255,0.30)",marginBottom:6,lineHeight:1.4},children:"Clique em qualquer elemento para inspecionar. Scroll = zoom. Alt+arraste = pan."}),o.jsxs("div",{style:{display:"flex",gap:4,marginBottom:6},children:[o.jsx(b5,{label:t?"II":">",onClick:()=>n(!t)}),o.jsx(b5,{label:"R",onClick:()=>Xe(r)}),o.jsx("div",{style:{flex:1}}),o.jsx(b5,{label:"+ Plato",onClick:_n}),o.jsx(b5,{label:"Jornada",onClick:()=>{nt(!0),Et(0),Ct([])}})]}),o.jsx(lu,{label:"EIXO CsO"}),o.jsxs("div",{style:{fontSize:7,color:"rgba(255,255,255,0.25)",display:"flex",justifyContent:"space-between",marginBottom:2},children:[o.jsx("span",{children:"Corpo c/ Orgaos"}),o.jsx("span",{children:"CsO"})]}),o.jsx("input",{type:"range",min:0,max:1,step:.01,value:Le,onChange:xe=>Ke(parseFloat(xe.target.value)),style:{width:"100%",accentColor:ea}}),o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[o.jsxs("span",{style:{fontSize:8,color:ea},children:[(Le*100).toFixed(0),"% CsO"]}),o.jsxs("span",{style:{fontSize:8,color:"#f472b6"},children:["K=",st.toFixed(2)]})]}),o.jsx("div",{style:{display:"flex",gap:2,marginBottom:4},children:["cso","rizoma","platos"].map(xe=>o.jsx("button",{onClick:()=>s(xe),title:xe==="cso"?"Corpo sem rgos":xe==="rizoma"?"Rizoma":"Plats",style:{flex:1,padding:"3px 0",borderRadius:3,cursor:"pointer",fontSize:7.5,fontWeight:600,fontFamily:ca,textTransform:"uppercase",background:i===xe?"rgba(99,102,241,0.15)":"rgba(255,255,255,0.03)",border:i===xe?`1px solid ${ea}`:"1px solid rgba(255,255,255,0.06)",color:i===xe?ea:"rgba(255,255,255,0.4)"},children:xe==="cso"?"CsO":xe==="rizoma"?"Rizoma":"Platos"},xe))}),o.jsx(lu,{label:i==="cso"?"PARAMETROS CsO":i==="rizoma"?"PARAMETROS RIZOMA":"TODOS OS PARAMETROS"}),Zt.map(xe=>o.jsx(Ok,{label:xe.label,color:xe.color,value:r[xe.key],onChange:ge=>{a(Ee=>({...Ee,[xe.key]:ge})),g("")}},xe.key)),see.map(xe=>o.jsx(Ok,{label:xe.label,color:xe.color,value:r[xe.key],onChange:ge=>{a(Ee=>({...Ee,[xe.key]:ge})),g("")}},xe.key)),o.jsx(lu,{label:"INTERVENCOES"}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",gap:2,marginBottom:6},children:Px.map(xe=>o.jsxs("button",{onClick:()=>l(xe.id),title:xe.desc,style:{background:c===xe.id?"rgba(255,255,255,0.10)":"rgba(255,255,255,0.02)",border:c===xe.id?`1px solid ${xe.color}`:"1px solid rgba(255,255,255,0.05)",borderRadius:3,padding:"3px 2px",cursor:"pointer",fontSize:7,color:c===xe.id?xe.color:"rgba(255,255,255,0.4)",textAlign:"center",fontFamily:ca,lineHeight:1.3},children:[o.jsx("div",{style:{fontSize:11},children:xe.icon}),xe.label]},xe.id))}),o.jsx(lu,{label:"CAMADAS"}),o.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:2,marginBottom:6},children:iee.map(xe=>o.jsx("button",{onClick:()=>mt(xe.key),title:xe.label,style:{background:d.has(xe.key)?"rgba(99,102,241,0.12)":"rgba(255,255,255,0.02)",border:d.has(xe.key)?`1px solid ${ea}`:"1px solid rgba(255,255,255,0.05)",borderRadius:3,padding:"2px 6px",cursor:"pointer",fontSize:7,color:d.has(xe.key)?ea:"rgba(255,255,255,0.35)",fontFamily:ca},children:xe.label},xe.key))}),o.jsx(lu,{label:"DIAGNOSTICOS"}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1px 8px",marginBottom:4},children:[o.jsx(Dh,{label:"FPS",value:h.fps.toFixed(0),color:"#6ee7b7"}),o.jsx(Dh,{label:"Afetos",value:`${h.nAffects}`,color:"#fbbf24"}),o.jsx(Dh,{label:"Orgaos",value:`${h.nOrgans}`,color:"#60a5fa"}),o.jsx(Dh,{label:"Nos",value:`${h.nRhizomeNodes}`,color:"#34d399"}),o.jsx(Dh,{label:"Arestas",value:`${h.nRhizomeEdges}`,color:"#60a5fa"}),o.jsx(Dh,{label:"Rupturas",value:`${h.ruptureRate}`,color:"#ef4444"})]}),o.jsx(Mp,{label:"Hub Dominance",value:h.hubDominance,color:"#f472b6"}),o.jsx(Mp,{label:"Crueldade",value:h.crueltyPressure,color:"#ef4444"}),o.jsx(Mp,{label:"Intensidade",value:h.meanIntensity,color:"#fbbf24"}),o.jsx(Mp,{label:"Entropia",value:h.fieldEntropy,color:"#38bdf8"}),o.jsx(Mp,{label:"Memoria",value:h.memoryLoad,color:"#f97316"}),o.jsxs("div",{style:{textAlign:"center",padding:"4px 6px",margin:"4px 0",background:"rgba(99,102,241,0.06)",border:"1px solid rgba(99,102,241,0.10)",borderRadius:4},children:[o.jsx("div",{style:{fontSize:6.5,color:"rgba(255,255,255,0.25)",textTransform:"uppercase",letterSpacing:1},children:"Plato"}),o.jsx("div",{style:{fontSize:10,fontFamily:y5,fontWeight:600,color:ea},children:h.plateauLabel})]}),f&&(()=>{const xe=g5.find(ge=>ge.id===f);return xe!=null&&xe.theory?o.jsxs("div",{style:{margin:"6px 0",padding:"8px 10px",background:"rgba(99,102,241,0.04)",border:"1px solid rgba(99,102,241,0.10)",borderRadius:5},children:[o.jsx("div",{style:{fontSize:6.5,fontWeight:600,color:"rgba(255,255,255,0.22)",textTransform:"uppercase",letterSpacing:1.5,marginBottom:4,fontFamily:ca,borderBottom:"1px solid rgba(255,255,255,0.03)",paddingBottom:2},children:"TEORIA"}),xe.plateauRef&&o.jsx("div",{style:{fontSize:7.5,color:ea,fontWeight:600,marginBottom:5,fontFamily:y5,lineHeight:1.3},children:xe.plateauRef}),o.jsx("div",{style:{fontSize:7.5,color:"rgba(255,255,255,0.50)",lineHeight:1.55,fontFamily:ca,textAlign:"justify"},children:xe.theory})]}):null})(),O.length>0&&o.jsxs(o.Fragment,{children:[o.jsx(lu,{label:"PLATOS CAPTURADOS"}),O.map(xe=>o.jsxs("button",{onClick:()=>Rn(xe),title:`Carregar: ${xe.label}`,style:{width:"100%",padding:"3px 5px",borderRadius:3,cursor:"pointer",background:"rgba(255,255,255,0.02)",border:"1px solid rgba(255,255,255,0.05)",color:"rgba(255,255,255,0.55)",fontSize:7,fontFamily:ca,textAlign:"left",marginBottom:2},children:[o.jsx("strong",{style:{color:ea},children:xe.label}),o.jsxs("span",{style:{color:"rgba(255,255,255,0.25)",marginLeft:4},children:["K=",xe.K.toFixed(2)]})]},xe.id))]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",cursor:"pointer",marginTop:6},onClick:()=>w(!b),children:[o.jsx(lu,{label:`PRESETS (${g5.length})`}),o.jsx("span",{style:{fontSize:10,color:"rgba(255,255,255,0.25)",marginLeft:"auto",marginTop:4},children:b?"v":">"})]}),b&&o.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2,marginTop:2},children:g5.map(xe=>o.jsxs("button",{onClick:()=>Ut(xe.id),title:`${xe.name}: ${xe.description}`,style:{background:f===xe.id?"rgba(99,102,241,0.12)":"rgba(255,255,255,0.02)",border:f===xe.id?`1px solid ${ea}`:"1px solid rgba(255,255,255,0.04)",borderRadius:3,padding:"4px 4px 3px",cursor:"pointer",textAlign:"left"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:3,marginBottom:1},children:[o.jsx("span",{style:{fontSize:10},children:xe.icon}),o.jsx("span",{style:{fontSize:7,fontWeight:500,color:f===xe.id?ea:"rgba(255,255,255,0.55)"},children:xe.name})]}),o.jsx("div",{style:{fontSize:6,color:"rgba(255,255,255,0.20)",lineHeight:1.2},children:xe.description})]},xe.id))}),ne&&o.jsx("div",{style:{position:"fixed",inset:0,zIndex:100,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.85)"},children:o.jsxs("div",{style:{background:"rgba(10,10,20,0.98)",border:"1px solid rgba(99,102,241,0.2)",borderRadius:8,padding:"24px 32px",maxWidth:460,width:"90%",fontFamily:ca},children:[o.jsx("div",{style:{fontFamily:y5,fontSize:14,fontWeight:700,color:ea,marginBottom:4},children:"JORNADA CsO"}),o.jsxs("div",{style:{fontSize:7.5,color:"rgba(255,255,255,0.3)",marginBottom:16},children:["Pergunta ",pt+1," de ",Cn.length]}),pt<Cn.length?o.jsxs(o.Fragment,{children:[o.jsx("div",{style:{fontSize:10,color:"rgba(255,255,255,0.8)",marginBottom:16,lineHeight:1.5},children:Cn[pt].q}),o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:7,color:"rgba(255,255,255,0.3)",marginBottom:4},children:[o.jsx("span",{children:Cn[pt].low}),o.jsx("span",{children:Cn[pt].high})]}),o.jsx("input",{type:"range",min:0,max:1,step:.05,value:_t[pt]??.5,onChange:xe=>{const ge=parseFloat(xe.target.value);Ct(Ee=>{const me=[...Ee];return me[pt]=ge,me})},style:{width:"100%",accentColor:ea,marginBottom:16}}),o.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[pt>0&&o.jsx("button",{onClick:()=>Et(xe=>xe-1),title:"Voltar  pergunta anterior",style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:4,padding:"6px 16px",cursor:"pointer",color:"rgba(255,255,255,0.5)",fontSize:9,fontFamily:ca},children:"Voltar"}),o.jsx("button",{onClick:()=>{_t[pt]===void 0&&Ct(xe=>{const ge=[...xe];return ge[pt]=.5,ge}),Et(xe=>xe+1)},title:"Prximo passo",style:{background:"rgba(99,102,241,0.15)",border:"1px solid "+ea,borderRadius:4,padding:"6px 16px",cursor:"pointer",color:ea,fontSize:9,fontFamily:ca,fontWeight:600},children:pt<Cn.length-1?"Proximo":"Gerar CsO"})]})]}):o.jsxs(o.Fragment,{children:[o.jsx("div",{style:{fontSize:10,color:"rgba(255,255,255,0.7)",marginBottom:16,lineHeight:1.5},children:"Seu Corpo sem Orgaos esta pronto. Clique para gerar a simulacao personalizada."}),o.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[o.jsx("button",{onClick:()=>nt(!1),title:"Cancelar jornada",style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:4,padding:"6px 16px",cursor:"pointer",color:"rgba(255,255,255,0.5)",fontSize:9,fontFamily:ca},children:"Cancelar"}),o.jsx("button",{onClick:wt,title:"Gerar seu Corpo sem rgos",style:{background:"rgba(99,102,241,0.15)",border:"1px solid "+ea,borderRadius:4,padding:"6px 16px",cursor:"pointer",color:ea,fontSize:9,fontFamily:ca,fontWeight:600},children:"Gerar meu CsO"})]})]})]})})]})]})},lu=({label:e})=>o.jsx("div",{style:{fontSize:6.5,fontWeight:600,color:"rgba(255,255,255,0.22)",textTransform:"uppercase",letterSpacing:1.5,marginBottom:3,marginTop:6,fontFamily:ca,borderBottom:"1px solid rgba(255,255,255,0.03)",paddingBottom:2},children:e}),Ok=({label:e,color:t,value:n,onChange:r})=>o.jsxs("div",{style:{marginBottom:3},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:7,marginBottom:1},children:[o.jsx("span",{style:{color:t},children:e}),o.jsx("span",{style:{color:"rgba(255,255,255,0.35)"},children:n.toFixed(2)})]}),o.jsx("input",{type:"range",min:0,max:1,step:.01,value:n,onChange:a=>r(parseFloat(a.target.value)),style:{width:"100%",height:3,accentColor:t}})]}),Dh=({label:e,value:t,color:n})=>o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:7,marginBottom:1},children:[o.jsx("span",{style:{color:"rgba(255,255,255,0.35)"},children:e}),o.jsx("span",{style:{color:n,fontWeight:500},children:t})]}),Mp=({label:e,value:t,color:n})=>o.jsxs("div",{style:{marginBottom:2},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:6.5,marginBottom:1},children:[o.jsx("span",{style:{color:"rgba(255,255,255,0.30)"},children:e}),o.jsxs("span",{style:{color:n},children:[(Fk(t)*100).toFixed(0),"%"]})]}),o.jsx("div",{style:{height:2.5,background:"rgba(255,255,255,0.05)",borderRadius:2,overflow:"hidden"},children:o.jsx("div",{style:{height:"100%",width:`${Fk(t)*100}%`,background:n,borderRadius:2,transition:"width 0.15s"}})})]}),b5=({label:e,onClick:t})=>o.jsx("button",{onClick:t,title:e,style:{background:"rgba(255,255,255,0.04)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:3,padding:"3px 8px",cursor:"pointer",color:ea,fontSize:10,fontFamily:ca},children:e}),hee="/assets/devices-for-intuition-logo-transparent-DNEVPbpC.png",ka="'IBM Plex Mono', monospace",c0="'Doto', monospace",fee=[{id:"complexityLife",num:"01.",symbol:"",tag:"FOUNDATION",tagColor:"#ffd400",statusKey:"lab_status_alpha",enabled:!0},{id:"metaArtLab",num:"02.",symbol:"",tag:"GENERATIVE ART",tagColor:"#ff0084",statusKey:"lab_status_experimental",enabled:!0},{id:"psycheLab",num:"03.",symbol:"",tag:"NEURAL FIELDS",tagColor:"#8b5cf6",statusKey:"lab_status_alpha",enabled:!0},{id:"musicLab",num:"04.",symbol:"",tag:"INSTRUMENT",tagColor:"#37b2da",statusKey:"lab_status_alpha",enabled:!0},{id:"rhizomeLab",num:"05.",symbol:"",tag:"EPISTEMIC SEARCH",tagColor:"#10d45b",statusKey:"lab_status_alpha",enabled:!0},{id:"alchemyLab",num:"06.",symbol:"",tag:"ALCHEMY + CHEMISTRY",tagColor:"#d6552d",statusKey:"lab_status_alpha",enabled:!0},{id:"treeOfLife",num:"07.",symbol:"",tag:"HERMETIC QABALAH",tagColor:"#601480",statusKey:"lab_status_alpha",enabled:!0},{id:"sociogenesis",num:"08.",symbol:"",tag:"SOCIOLOGIA",tagColor:"#9f1111",statusKey:"lab_status_experimental",enabled:!0},{id:"milPlatos",num:"09.",symbol:"",tag:"CsO LENS",tagColor:"#6366f1",statusKey:"lab_status_experimental",enabled:!0},{id:"languageLab",num:"10.",symbol:"",tag:"",tagColor:"#191919",statusKey:"",enabled:!1},{id:"asimovTheater",num:"11.",symbol:"",tag:"",tagColor:"#191919",statusKey:"",enabled:!1},{id:"physicsSandbox",num:"12.",symbol:"",tag:"",tagColor:"#141414",statusKey:"",enabled:!1}],_x={t:[[0,1],[1,1],[2,1],[1,0],[1,2],[1,3],[1,4]],four:[[0,0],[0,1],[0,2],[1,2],[2,0],[2,1],[2,2],[2,3],[2,4]],p:[[0,0],[0,1],[0,2],[0,3],[0,4],[1,0],[1,2],[2,0],[2,1],[2,2]]};function pee({onComplete:e}){const t=S.useRef(!1);S.useEffect(()=>{const a=setTimeout(()=>{t.current||(t.current=!0,e())},4200);return()=>clearTimeout(a)},[e]);const n={hidden:{scale:0,opacity:0},visible:a=>({scale:1,opacity:1,transition:{delay:.3+a*.07,type:"spring",stiffness:120,damping:18,mass:1.2}}),exit:a=>({scale:0,opacity:0,y:-8+Math.random()*-16,x:(Math.random()-.5)*20,transition:{delay:a*.025,duration:.9,ease:[.4,0,.2,1]}})},r=(a,i)=>o.jsx("div",{className:"relative",style:{width:60,height:100},children:a.map(([s,c],l)=>o.jsx($o.div,{custom:l+i*5,variants:n,initial:"hidden",animate:"visible",exit:"exit",className:"absolute rounded-full bg-white",style:{width:10,height:10,left:s*20+1,top:c*20+1,boxShadow:"0 0 6px rgba(255,255,255,0.3)"}},`${i}-${l}`))});return o.jsx($o.div,{className:"fixed inset-0 flex items-center justify-center z-50 pointer-events-none",initial:{opacity:1},exit:{opacity:0,transition:{duration:1.2,ease:[.4,0,.2,1]}},children:o.jsxs("div",{className:"flex gap-8",children:[r(_x.t,0),r(_x.four,1),r(_x.p,2)]})})}function AE(e){return Math.min(1,Math.max(0,e))}function x5(e,t,n){const r=AE(n),a=h=>[parseInt(h.slice(0,2),16),parseInt(h.slice(2,4),16),parseInt(h.slice(4,6),16)],[i,s,c]=a(e.replace("#","")),[l,d,u]=a(t.replace("#",""));return`rgb(${Math.round(i+(l-i)*r)},${Math.round(s+(d-s)*r)},${Math.round(c+(u-c)*r)})`}const mee=[{at:0,x:50,y:28,s:1,o:1,cr:0,sr:0,tr:0,cp:0,dec:0},{at:.12,x:50,y:28,s:1,o:1,cr:0,sr:0,tr:0,cp:0,dec:0},{at:.22,x:38,y:40,s:.82,o:.6,cr:14,sr:-16,tr:10,cp:0,dec:0},{at:.3,x:38,y:40,s:.78,o:.5,cr:24,sr:-22,tr:16,cp:.4,dec:0},{at:.38,x:50,y:48,s:.36,o:.5,cr:0,sr:0,tr:0,cp:1,dec:0},{at:.44,x:50,y:48,s:.38,o:.4,cr:0,sr:0,tr:0,cp:1,dec:.3},{at:.52,x:50,y:46,s:.45,o:.18,cr:40,sr:-55,tr:80,cp:1,dec:.8},{at:.58,x:50,y:44,s:.55,o:0,cr:80,sr:-110,tr:160,cp:1,dec:1}];function gee(e){const t=mee;if(e<=t[0].at)return t[0];if(e>=t[t.length-1].at)return t[t.length-1];for(let n=0;n<t.length-1;n++){const r=t[n],a=t[n+1];if(e>=r.at&&e<=a.at){const i=(e-r.at)/(a.at-r.at),s=i*i*(3-2*i),c=l=>r[l]+(a[l]-r[l])*s;return{at:e,x:c("x"),y:c("y"),s:c("s"),o:c("o"),cr:c("cr"),sr:c("sr"),tr:c("tr"),cp:c("cp"),dec:c("dec")}}}return t[t.length-1]}function yee({scrollTarget:e}){const t=S.useRef(null),n=S.useRef(null),r=S.useRef(null),a=S.useRef(0),i=S.useRef(0);return S.useEffect(()=>{let s;i.current=performance.now();const c=l=>{a.current+=(e.current-a.current)*.09;const d=gee(a.current);if(!r.current||!n.current||!t.current){s=requestAnimationFrame(c);return}if(d.o<.005){r.current.style.display="none",s=requestAnimationFrame(c);return}r.current.style.display="",r.current.style.opacity=String(d.o),n.current.style.left=`${d.x}%`,n.current.style.top=`${d.y}%`,n.current.style.transform=`translate(-50%,-50%) scale(${d.s})`;const u=(l-i.current)/1e3,h=d.dec,m=1+h*3,f=d.cr+Math.sin(u*.3*m)*(12+h*35)+u*4*m,g=d.sr+Math.cos(u*.22*m)*(10+h*30)-u*3*m,x=d.tr+Math.sin(u*.28*m+1.2)*(14+h*45)+u*3.5*m,v=Math.sin(u*.18*m+2.4)*(8+h*22)-u*2.5*m,b=1.5,w=h*h,M=Math.sin(u*.23+.5)*(b+w*20)-w*12,k=Math.cos(u*.19+1)*(b*.8+w*14)-w*10,R=Math.cos(u*.26+2)*(b+w*18)+w*14,j=Math.sin(u*.21+.3)*(b*.7+w*16)+w*8,I=Math.sin(u*.3+3)*(b*1.2+w*20)+w*6,E=Math.cos(u*.17+1.5)*(b+w*22)+w*16,O=Math.cos(u*.24+.8)*(b*.9+w*15)-w*8,L=Math.sin(u*.2+2.5)*(b*.6+w*18)-w*14,$=.55+d.cp*.55,F=x5("#888888","#37B2DA",d.cp),B=x5("#888888","#FF0084",d.cp),W=x5("#888888","#FFD500",d.cp),re=x5("#888888","#14801A",d.cp),te=t.current.querySelectorAll(":scope > g");te[0].setAttribute("transform",`rotate(${f} 50 50) translate(${M} ${k})`);const J=te[0].firstElementChild;J.setAttribute("stroke",F),J.setAttribute("stroke-width",String($)),J.style.opacity=String(1-h*.35),te[1].setAttribute("transform",`rotate(${g} 50 50) translate(${R} ${j})`);const pe=te[1].firstElementChild;pe.setAttribute("stroke",B),pe.setAttribute("stroke-width",String($)),pe.style.opacity=String(1-h*.35),te[2].setAttribute("transform",`rotate(${x} 50 50) translate(${I} ${E})`);const P=te[2].firstElementChild;P.setAttribute("stroke",W),P.setAttribute("stroke-width",String($)),P.style.opacity=String(1-h*.35),te[3].setAttribute("transform",`rotate(${v} 50 50) translate(${O} ${L})`);const V=te[3].firstElementChild;V.setAttribute("stroke",re),V.setAttribute("stroke-width",String($)),V.style.opacity=String(1-h*.45),s=requestAnimationFrame(c)};return s=requestAnimationFrame(c),()=>cancelAnimationFrame(s)},[e]),o.jsx("div",{ref:r,className:"fixed inset-0 z-[1] pointer-events-none",children:o.jsx("div",{ref:n,className:"absolute",style:{width:400,height:400,left:"50%",top:"28%",transform:"translate(-50%,-50%)"},children:o.jsxs("svg",{ref:t,viewBox:"0 0 100 100",className:"w-full h-full",children:[o.jsx("g",{children:o.jsx("circle",{cx:"50",cy:"50",r:"46",fill:"none",stroke:"#888",strokeWidth:"0.55"})}),o.jsx("g",{children:o.jsx("rect",{x:"17.5",y:"17.5",width:"65",height:"65",fill:"none",stroke:"#888",strokeWidth:"0.55"})}),o.jsx("g",{children:o.jsx("path",{d:"M50 26.2 L82.5 82.5 L17.5 82.5 Z",fill:"none",stroke:"#888",strokeWidth:"0.55"})}),o.jsx("g",{children:o.jsx("circle",{cx:"50",cy:"63.7",r:"18.8",fill:"none",stroke:"#888",strokeWidth:"0.55"})})]})})})}function bee({active:e}){const t=S.useRef(null),n=S.useRef([]),r=S.useRef(null),a=S.useRef(null),i=S.useRef({x:0,y:0,has:!1,down:!1}),s=S.useRef({a:[],r:[]}),c=S.useRef([]);return S.useEffect(()=>{const l=t.current;if(!l)return;const d=l.getContext("2d");if(!d)return;const u=()=>{const M=l.parentElement,k=(M==null?void 0:M.clientWidth)??innerWidth,R=(M==null?void 0:M.clientHeight)??innerHeight;l.width=Math.floor(k*devicePixelRatio),l.height=Math.floor(R*devicePixelRatio),l.style.width=`${k}px`,l.style.height=`${R}px`,d.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0)},h=()=>{u();const M=l.clientWidth,k=l.clientHeight,R=4,j=Array.from({length:R},()=>Array(R).fill(0)),I=Array.from({length:R},()=>Array(R).fill(0));for(let B=0;B<R;B++)for(let W=0;W<R;W++){const re=(Math.random()*2-1)*(.55+Math.random()*.35);j[B][W]=Math.max(-1,Math.min(1,re)),I[B][W]=80+Math.random()*120}s.current={a:j,r:I};const E=120,O=Math.max(6,Math.floor(M/E)),L=Math.max(6,Math.floor(k/E));c.current=Array.from({length:O*L},()=>[]);const $=Math.max(180,Math.min(420,Math.floor(M*k/4800))),F=[];for(let B=0;B<$;B++){const W=B%4,re=Math.random()*M,oe=Math.random()*k,te=Math.random()*Math.PI*2,J=.3+Math.random()*.9;F.push({x:re,y:oe,vx:Math.cos(te)*J,vy:Math.sin(te)*J,z:.4+Math.random()*1.2,ph:Math.random()*Math.PI*2,t:W})}n.current=F,a.current=null},m=(M,k)=>{const R=Math.hypot(M.vx,M.vy)||.001;R>k&&(M.vx=M.vx/R*k,M.vy=M.vy/R*k)},f=(M,k,R,j,I)=>{const E=Math.max(0,Math.min(R-1,Math.floor(M/I)));return Math.max(0,Math.min(j-1,Math.floor(k/I)))*R+E},g=M=>{a.current||(a.current=M);const k=l.clientWidth,R=l.clientHeight,j=n.current,I=s.current;d.clearRect(0,0,k,R);const E=120,O=Math.max(6,Math.floor(k/E)),L=Math.max(6,Math.floor(R/E)),$=c.current;if($.length!==O*L)c.current=Array.from({length:O*L},()=>[]);else for(let te=0;te<$.length;te++)$[te].length=0;for(let te=0;te<j.length;te++){const J=j[te],pe=f(J.x,J.y,O,L,E);c.current[pe].push(te)}const F=i.current,B=.3,W=1,re=1;for(let te=0;te<j.length;te++){const J=j[te],pe=f(J.x,J.y,O,L,E),P=pe%O,V=Math.floor(pe/O);let fe=0,ye=0;for(let ke=-1;ke<=1;ke++)for(let De=-1;De<=1;De++){const _e=P+De,ae=V+ke;if(_e<0||ae<0||_e>=O||ae>=L)continue;const Re=c.current[ae*O+_e];for(let Fe=0;Fe<Re.length;Fe++){const Oe=Re[Fe];if(Oe===te)continue;const ne=j[Oe],nt=ne.x-J.x,pt=ne.y-J.y,Et=nt*nt+pt*pt;if(Et<1e-6)continue;const _t=Math.sqrt(Et),Ct=I.r[J.t][ne.t];if(_t>=Ct)continue;const Xe=_t/Ct;let Ut=0;Xe<B?Ut=(Xe/B-1)*W:Ut=I.a[J.t][ne.t]*(1-Math.abs(1+B-2*Xe)/(1-B));const Le=1/(_t+.001);fe+=nt*Le*Ut,ye+=pt*Le*Ut}}if(F.has){const ke=F.x-J.x,De=F.y-J.y,_e=Math.hypot(ke,De)||.001,Re=Math.max(0,1-_e/520),Fe=F.down?60:95,Oe=(F.down?.008:.004)*Re,ne=(_e-Fe)*Oe;fe+=ke/_e*ne,ye+=De/_e*ne;const nt=(F.down?.3:.18)*Re*Re;fe+=-De/_e*nt,ye+=ke/_e*nt}const Se=M*.001;J.z=.45+1.1*(.5+.5*Math.sin(Se*.7+J.ph)),fe+=Math.sin(Se*1.7+J.ph*1.3)*.04,ye+=Math.cos(Se*1.4+J.ph*1.1)*.04;const we=.55+J.z*.55;if(J.vx=(J.vx+fe*.75*we)*.984,J.vy=(J.vy+ye*.75*we)*.984,F.has){const ke=F.x-J.x,De=F.y-J.y,_e=Math.hypot(ke,De)||.001,Re=1-Math.max(0,1-_e/420)*.045;J.vx*=Re,J.vy*=Re}m(J,3.2*we),J.x+=J.vx*re,J.y+=J.vy*re,J.x<-40&&(J.x+=k+80),J.x>k+40&&(J.x-=k+80),J.y<-40&&(J.y+=R+80),J.y>R+40&&(J.y-=R+80)}const oe=j.map((te,J)=>J).sort((te,J)=>j[te].z-j[J].z);for(let te=0;te<oe.length;te++){const J=j[oe[te]],pe=J.z,P=1.2+pe*1.6,V=AE(.06+pe*.14);if(V<=.001)continue;const fe=P*5,ye=d.createRadialGradient(J.x,J.y,0,J.x,J.y,fe);ye.addColorStop(0,`rgba(255,255,255,${.04*V})`),ye.addColorStop(.4,`rgba(255,255,255,${.012*V})`),ye.addColorStop(1,"rgba(0,0,0,0)"),d.fillStyle=ye,d.beginPath(),d.arc(J.x,J.y,fe,0,Math.PI*2),d.fill(),d.fillStyle=`rgba(255,255,255,${V})`,d.beginPath(),d.arc(J.x,J.y,P,0,Math.PI*2),d.fill()}e&&(r.current=requestAnimationFrame(g))};e&&(h(),r.current=requestAnimationFrame(g));const x=()=>u();addEventListener("resize",x);const v=M=>{const k=l.getBoundingClientRect();i.current.x=M.clientX-k.left,i.current.y=M.clientY-k.top,i.current.has=!0},b=()=>{i.current.down=!0,i.current.has=!0},w=()=>{i.current.down=!1};return addEventListener("pointermove",v,{passive:!0}),addEventListener("pointerdown",b,{passive:!0}),addEventListener("pointerup",w,{passive:!0}),addEventListener("pointercancel",w,{passive:!0}),()=>{removeEventListener("resize",x),removeEventListener("pointermove",v),removeEventListener("pointerdown",b),removeEventListener("pointerup",w),removeEventListener("pointercancel",w),r.current&&cancelAnimationFrame(r.current)}},[e]),o.jsx("canvas",{ref:t,className:"absolute inset-0 w-full h-full",style:{opacity:.65}})}function Nx({onClick:e}){const t=["#FF0084","#FFD500","#37B2DA","#14801A","#601480","#f97316","#8b5cf6"];return o.jsx($o.div,{className:"flex gap-1.5 cursor-pointer group justify-center",whileHover:{gap:"10px"},onClick:e,children:["D","E","V","I","C","E","S"].map((n,r)=>o.jsx($o.div,{className:"w-9 h-9 md:w-10 md:h-10 rounded-full flex items-center justify-center bg-zinc-800 border border-transparent group-hover:border-white/20 transition-all",whileHover:{scale:1.15,backgroundColor:t[r%t.length]},children:o.jsx("span",{className:"font-bold text-sm text-white/50 group-hover:text-white transition-colors",style:{fontFamily:c0},children:n})},r))})}function xee({user:e,onAuthChange:t,onEnterLab:n,onOpenAdmin:r,adminMode:a=!1}){const{t:i,locale:s,setLocale:c}=bm(),[l,d]=S.useState(!1),[u,h]=S.useState(!1),m=S.useRef(null),f=S.useRef(0),g=S.useRef(null),x=S.useMemo(()=>fee.map(w=>({...w,name:i(`lab_${w.id}_name`),description:i(`lab_${w.id}_desc`),statusLabel:w.statusKey?i(w.statusKey):""})),[i]),v=()=>{const w=m.current;w&&(f.current=w.scrollTop/Math.max(1,w.scrollHeight-w.clientHeight))},b=()=>{var w;return(w=document.getElementById("labs-section"))==null?void 0:w.scrollIntoView({behavior:"smooth"})};return o.jsxs("div",{className:"fixed inset-0 bg-black text-white overflow-hidden",children:[o.jsx(bee,{active:!0}),(()=>{const w=!!r,M=!e;return!w&&!M?null:o.jsxs("div",{className:"fixed top-3 right-3 z-20 flex items-center gap-2",children:[o.jsxs("select",{value:s,onChange:k=>c(k.target.value),title:s==="en"?"English":"Portugus (Brasil)",className:"px-2 py-2 rounded-xl border border-dashed border-white/15 bg-black/60 hover:bg-white/5 transition-colors cursor-pointer focus:outline-none",style:{fontFamily:ka,fontSize:10,letterSpacing:"0.2em",textTransform:"uppercase",color:"rgba(255,255,255,0.45)"},children:[o.jsx("option",{value:"pt-BR",style:{background:"#000",color:"#fff"},children:"PT"}),o.jsx("option",{value:"en",style:{background:"#000",color:"#fff"},children:"EN"})]}),M&&o.jsx("button",{onClick:()=>h(!0),className:"px-3 py-2 rounded-xl border border-dashed border-white/15 bg-black/60 hover:bg-white/5 transition-colors",style:{fontFamily:ka,fontSize:10,letterSpacing:"0.2em",textTransform:"uppercase",color:"rgba(255,255,255,0.45)"},title:i("home_entrar_title"),children:i("home_entrar")}),w&&o.jsx("button",{onClick:r,className:"px-3 py-2 rounded-xl border border-dashed border-white/15 bg-black/60 hover:bg-white/5 transition-colors",style:{fontFamily:ka,fontSize:10,letterSpacing:"0.2em",textTransform:"uppercase",color:a?"#f59e0b":"rgba(255,255,255,0.45)"},title:i(a?"home_admin_title":"home_admin_title_off"),children:i(a?"home_admin_on":"home_admin")})]})})(),o.jsx(x0,{children:!l&&o.jsx(pee,{onComplete:()=>d(!0)})}),l&&o.jsx(yee,{scrollTarget:f}),o.jsxs($o.div,{ref:m,onScroll:v,className:"h-full w-full overflow-y-auto overflow-x-hidden relative z-10 snap-y snap-mandatory scroll-smooth",initial:{opacity:0},animate:{opacity:l?1:0},transition:{duration:.9,ease:"easeOut"},children:[o.jsxs("section",{className:"h-[100svh] snap-start flex flex-col items-center justify-center px-6",children:[o.jsx("div",{style:{flex:"1 1 0",minHeight:"12vh"}}),o.jsx($o.div,{className:"w-[min(92vw,1040px)]",initial:{opacity:0,y:18},whileInView:{opacity:1,y:0},viewport:{once:!0,amount:.5},transition:{duration:1,delay:.15},children:o.jsx("img",{src:hee,alt:"Devices for Intuition",draggable:!1,loading:"eager",className:"w-full h-auto select-none",style:{filter:"drop-shadow(0 0 18px rgba(255,255,255,0.10))"}})}),o.jsx($o.p,{className:"mt-5 text-zinc-500 text-[10px] md:text-xs tracking-[0.5em] text-center",style:{fontFamily:ka},initial:{opacity:0},whileInView:{opacity:1},viewport:{once:!0},transition:{delay:.45,duration:.7},children:i("home_alphaTest")}),e?o.jsxs(o.Fragment,{children:[o.jsxs($o.p,{style:{marginTop:16,fontSize:10,color:"rgba(255,255,255,0.45)",letterSpacing:"0.08em",textTransform:"uppercase",fontFamily:ka},initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:[i("home_hello")," ",e.name||e.email.split("@")[0]]}),o.jsx($o.div,{className:"mt-8",initial:{opacity:0},whileInView:{opacity:1},viewport:{once:!0},transition:{delay:.55,duration:.6},children:o.jsx(Nx,{onClick:b})})]}):o.jsx($o.div,{className:"mt-8",initial:{opacity:0},whileInView:{opacity:1},viewport:{once:!0},transition:{delay:.55,duration:.6},children:o.jsx(Nx,{onClick:b})}),o.jsx("div",{style:{flex:"1.6 1 0",minHeight:"16vh"}})]}),o.jsx("section",{className:"h-[100svh] snap-start flex items-center px-6 lg:px-16 py-16",children:o.jsxs($o.div,{className:"w-full max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-[1fr_auto] gap-10 lg:gap-16 items-center",initial:{opacity:0,y:28},whileInView:{opacity:1,y:0},viewport:{amount:.4},transition:{duration:1},children:[o.jsxs("div",{className:"space-y-5 text-center lg:text-left",children:[o.jsx("p",{className:"text-zinc-500 text-[10px] tracking-[0.35em] uppercase",style:{fontFamily:ka},children:i("home_devicesTag")}),o.jsx("h2",{className:"text-[clamp(30px,5.6vw,72px)] leading-[0.92] uppercase",style:{fontFamily:c0},children:i("home_projectTitle")}),o.jsx("p",{className:"text-zinc-400 text-[11px] md:text-xs leading-relaxed uppercase max-w-lg mx-auto lg:mx-0",style:{fontFamily:ka},children:i("home_projectDesc")}),o.jsxs("div",{className:"text-zinc-500 text-[10px] md:text-[11px] leading-relaxed uppercase max-w-lg mx-auto lg:mx-0",style:{fontFamily:ka},children:[o.jsx("a",{href:"https://www.are.na/luiz-murara/recursividade",target:"_blank",rel:"noreferrer",className:"underline decoration-white/15 hover:decoration-white/40 transition-colors",style:{color:"rgba(255,255,255,0.55)"},children:i("home_biblio_thesis")}),o.jsx("span",{style:{margin:"0 10px",color:"rgba(255,255,255,0.18)"},children:""}),o.jsx("a",{href:"https://www.are.na/luiz-murara/devices-for-intuition",target:"_blank",rel:"noreferrer",className:"underline decoration-white/15 hover:decoration-white/40 transition-colors",style:{color:"rgba(255,255,255,0.55)"},children:i("home_biblio_bibliography")})]}),o.jsx("p",{className:"text-zinc-500 text-[10px] md:text-[11px] leading-relaxed uppercase max-w-lg mx-auto lg:mx-0 pt-2",style:{fontFamily:ka},children:i("home_projectDesc2")})]}),o.jsxs("div",{className:"text-center lg:text-right space-y-2 lg:pr-4",children:[o.jsx("p",{className:"text-zinc-500 text-[10px] tracking-[0.3em] uppercase",style:{fontFamily:ka},children:i("home_toolsAre")}),o.jsx("p",{className:"text-white text-[clamp(32px,5vw,64px)] uppercase leading-none",style:{fontFamily:c0},children:i("home_lenses")})]})]})}),o.jsx("section",{ref:g,className:"h-[100svh] snap-start relative overflow-hidden flex items-center px-6 py-16",children:o.jsxs($o.div,{className:"relative z-10 w-full max-w-5xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-16 items-center",initial:{opacity:0,y:24},whileInView:{opacity:1,y:0},viewport:{amount:.35},transition:{duration:1},children:[o.jsxs("div",{className:"space-y-4 text-center lg:text-left",children:[o.jsx("h3",{className:"text-[clamp(24px,4vw,42px)] uppercase",style:{fontFamily:c0},children:i("home_algorithm")}),o.jsx("p",{className:"text-zinc-400 text-[11px] md:text-xs leading-relaxed uppercase max-w-sm mx-auto lg:mx-0",style:{fontFamily:ka},children:i("home_algorithmDesc")}),o.jsx("p",{className:"text-zinc-600 text-[9px] tracking-[0.2em] uppercase pt-1",style:{fontFamily:ka},children:i("home_simBackground")})]}),o.jsxs("div",{className:"flex flex-col items-center lg:items-end gap-2",style:{fontFamily:c0},children:[o.jsx("span",{className:"text-[#FFD500] text-[clamp(14px,2vw,22px)] uppercase",children:i("home_field")}),o.jsx("span",{className:"text-zinc-500 text-[clamp(14px,2vw,22px)]",children:""}),o.jsxs("div",{className:"flex items-center gap-2 whitespace-nowrap flex-wrap justify-center lg:justify-end",children:[o.jsx("span",{className:"text-[#14801A] text-[clamp(14px,2vw,22px)] uppercase",children:i("home_agents")}),o.jsx("span",{className:"text-zinc-500 text-[clamp(14px,2vw,22px)]",children:""}),o.jsx("span",{className:"text-[#FF0084] text-[clamp(14px,2vw,22px)] uppercase",children:i("home_interactions")})]}),o.jsx("span",{className:"text-zinc-500 text-[clamp(14px,2vw,22px)]",children:""}),o.jsx("span",{className:"text-[#FFD500] text-[clamp(14px,2vw,22px)] uppercase",children:i("home_field")}),o.jsx("span",{className:"text-zinc-400 text-[clamp(11px,1.5vw,16px)] normal-case mt-1",children:i("home_recursivity")})]})]})}),o.jsx("section",{className:"h-[100svh] snap-start flex flex-col items-center justify-center px-6 py-16",children:o.jsxs($o.div,{className:"max-w-5xl w-full text-center space-y-10",initial:{opacity:0,y:24},whileInView:{opacity:1,y:0},viewport:{amount:.45},transition:{duration:1},children:[o.jsx("p",{className:"text-zinc-300 text-[clamp(15px,2.5vw,34px)] leading-[1.4] uppercase tracking-[0.1em]",style:{fontFamily:c0},children:i("home_manifesto1")}),o.jsx("p",{className:"text-zinc-300 text-[clamp(15px,2.5vw,34px)] leading-[1.4] uppercase tracking-[0.1em]",style:{fontFamily:c0},children:i("home_manifesto2")}),o.jsxs("div",{className:"pt-6 flex flex-col items-center gap-5",children:[o.jsx(Nx,{onClick:b}),o.jsx("p",{className:"text-zinc-600 text-[10px] tracking-[0.25em] uppercase",style:{fontFamily:ka},children:i("home_toolsAvailable")}),o.jsx("p",{className:"text-zinc-700 text-[9px] tracking-[0.15em] uppercase",style:{fontFamily:ka},children:i("home_freeAlpha")})]})]})}),o.jsxs("section",{id:"labs-section",className:"snap-start pb-24 pt-16 px-4 md:px-12 max-w-[1600px] mx-auto w-full",children:[o.jsxs("div",{className:"mb-16 border-b border-dashed border-white/10 pb-4",children:[o.jsx("h3",{className:"text-zinc-500 text-sm tracking-widest",style:{fontFamily:ka},children:i("home_availableTools")}),!e&&o.jsx("p",{style:{marginTop:8,fontSize:9,color:"rgba(255,255,255,0.35)",letterSpacing:"0.1em",textTransform:"uppercase",fontFamily:ka},children:i("home_entrarToAccess")})]}),o.jsxs("div",{className:"grid gap-0",children:[x.map((w,M)=>o.jsxs($o.div,{initial:{opacity:0,y:14},whileInView:{opacity:1,y:0},viewport:{once:!0,amount:.2},transition:{delay:M*.04,duration:.5},className:`group border-t border-dashed border-white/10 py-8 grid grid-cols-1 md:grid-cols-12 gap-6 items-start transition-colors ${e?"hover:bg-white/5 cursor-pointer":"opacity-70 cursor-default"} ${!w.enabled&&!a?"opacity-40":""}`,onClick:()=>{if(!e){h(!0);return}(w.enabled||a)&&n(w.id)},children:[o.jsx("div",{className:"col-span-1 md:col-span-1 text-2xl text-zinc-600 font-light",style:{fontFamily:ka},children:w.num}),o.jsxs("div",{className:"col-span-1 md:col-span-4 flex items-center gap-4",children:[o.jsx("span",{className:"text-3xl filter grayscale group-hover:grayscale-0 transition-all",style:{color:w.tagColor},children:w.symbol}),o.jsx("h4",{className:"text-2xl md:text-3xl font-light uppercase tracking-tight",style:{fontFamily:c0},children:w.name})]}),o.jsxs("div",{className:"col-span-1 md:col-span-3 flex flex-col gap-2",children:[w.tag&&o.jsxs("span",{className:"text-[10px] tracking-widest uppercase font-bold",style:{color:w.tagColor,fontFamily:ka},children:["[",w.tag,"]"]}),o.jsx("span",{className:"text-[10px] text-zinc-600 tracking-widest uppercase",style:{fontFamily:ka},children:!w.enabled&&!a?w.statusLabel||i("home_locked"):w.statusLabel||""})]}),o.jsx("div",{className:"col-span-1 md:col-span-4",children:o.jsx("p",{className:"text-xs text-zinc-400 leading-relaxed uppercase",style:{fontFamily:ka},children:w.description})})]},w.id)),o.jsx("div",{className:"border-t border-dashed border-white/10"})]})]}),o.jsxs("footer",{className:"py-24 text-center snap-start",children:[o.jsx("div",{className:"flex justify-center gap-2 mb-8",children:["D","E","V","I","C","E","S"].map((w,M)=>o.jsx("div",{className:"w-6 h-6 rounded-full bg-zinc-900 text-zinc-600 flex items-center justify-center text-[10px] font-bold",style:{fontFamily:ka},children:w},M))}),o.jsx("p",{className:"text-zinc-700 text-[10px] tracking-widest uppercase",style:{fontFamily:ka},children:i("home_footer")}),o.jsx("a",{href:"mailto:frans@radical.vision",className:"inline-block mt-3 text-zinc-500 text-[10px] tracking-widest uppercase hover:text-zinc-300 transition-colors",style:{fontFamily:ka},children:"frans@radical.vision"})]})]}),u&&o.jsx(CR,{onClose:()=>h(!1),onAuthChange:w=>{t==null||t(w),setTimeout(()=>h(!1),0)}})]})}class vee extends on.Component{constructor(){super(...arguments),this.state={error:null},this.reset=()=>{this.setState({error:null})}}static getDerivedStateFromError(t){return{error:t}}componentDidCatch(t,n){var r,a;(a=(r=this.props).onError)==null||a.call(r,t,n)}componentDidUpdate(t){if(!this.state.error)return;const n=t.resetKeys??[],r=this.props.resetKeys??[];See(n,r)||this.reset()}render(){var n,r;const{error:t}=this.state;return t?((r=(n=this.props).fallbackRender)==null?void 0:r.call(n,{error:t,reset:this.reset}))??null:this.props.children}}function See(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Object.is(e[n],t[n]))return!1;return!0}function wee(){return{assumptions:[],blindspots:[],uncertainties:[],uncertainty_level:.5,scale:"meso",risk_ethics:[],speculativeNodes:[]}}const Mee=["System is observable via aggregate metrics.","Emergence is not pre-programmed; it arises from local rules."],Cee=["Initial conditions and random seed affect long-term outcome.","Observer intervention changes the system (second-order)."],kee=["Exact prediction of emergent patterns.","Boundary between noise and signal."];function Ree(e,t){const{entropy:n=.5,stability:r=.5,clustering:a=.5,scaleHint:i}=t,s=n*.4+(1-r)*.4+(1-a)*.2;e.uncertainty_level=Math.max(0,Math.min(1,s)),i&&(e.scale=i),e.assumptions.length===0&&(e.assumptions=[...Mee]),e.blindspots.length===0&&(e.blindspots=[...Cee]),e.uncertainties.length===0&&(e.uncertainties=[...kee])}function Aee(e){if(!e||typeof e!="object")return!1;const t=e;return Array.isArray(t.assumptions)&&Array.isArray(t.blindspots)&&Array.isArray(t.uncertainties)&&typeof t.uncertainty_level=="number"&&t.uncertainty_level>=0&&t.uncertainty_level<=1&&(t.scale==="micro"||t.scale==="meso"||t.scale==="macro")&&Array.isArray(t.risk_ethics)}const jee=100;function Eee(){return{enabled:!0,entropyThresholdHigh:.85,clusteringThresholdHigh:.9,dominanceThreshold:.75,stabilityThresholdSec:8,maxInterventionsPerMinute:6}}function Tee(){return{config:Eee(),log:[],lastInterventionTime:0,interventionCountThisMinute:0,minuteWindowStart:Date.now()}}function v5(e){const t=Date.now();return t-e.minuteWindowStart>=6e4&&(e.minuteWindowStart=t,e.interventionCountThisMinute=0),e.interventionCountThisMinute>=e.config.maxInterventionsPerMinute?!1:(e.interventionCountThisMinute++,e.lastInterventionTime=t,!0)}function S5(e,t,n){e.log.unshift({timestamp:Date.now(),reason:n,kind:t}),e.log.length>jee&&e.log.pop()}function Iee(e,t,n){const r={};if(!e.config.enabled)return r;const a=e.config;return t.entropy>=a.entropyThresholdHigh&&v5(e)&&(r.addNoise=.03,S5(e,"addNoise",`Entropy high (${(t.entropy*100).toFixed(0)}%)`)),t.stabilityDuration>=a.stabilityThresholdSec&&v5(e)&&(r.dampenForces=.92,S5(e,"dampenForces",`Stable too long (${t.stabilityDuration.toFixed(1)}s)`)),t.dominance>=a.dominanceThreshold&&v5(e)&&(r.pruneDominantCluster=!0,S5(e,"pruneDominantCluster",`Dominance high (${(t.dominance*100).toFixed(0)}%)`)),t.clustering>=a.clusteringThresholdHigh&&v5(e)&&(r.rebalanceAttraction=-.05,S5(e,"rebalanceAttraction",`Clustering high (${(t.clustering*100).toFixed(0)}%)`)),r}const Pee={NIGREDO:"High entropy, low coherence  dissolution, chaos.",ALBEDO:"Cluster formation rising  whitening, purification.",CITRINITAS:"Specialization rising, variance narrowing  yellowing.",RUBEDO:"Metastable coherence, high stability  reddening, completion."};function Fee(e){const{entropy:t,coherence:n,clustering:r,specialization:a,stabilityDuration:i}=e;let s="NIGREDO",c=.5,l="";return t>.7&&n<.3?(s="NIGREDO",c=Math.min(1,t-.5+(.5-n)),l=`Entropy ${(t*100).toFixed(0)}%, coherence ${(n*100).toFixed(0)}%`):r>.5&&r>t?(s="ALBEDO",c=Math.min(1,r*1.2),l=`Clustering ${(r*100).toFixed(0)}%`):a>.5&&n>.4?(s="CITRINITAS",c=Math.min(1,(a+n)/2),l=`Specialization ${(a*100).toFixed(0)}%, coherence ${(n*100).toFixed(0)}%`):i>5&&n>.5?(s="RUBEDO",c=Math.min(1,i/10*.5+n*.5),l=`Stable ${i.toFixed(1)}s, coherence ${(n*100).toFixed(0)}%`):l=`Entropy ${(t*100).toFixed(0)}%, clustering ${(r*100).toFixed(0)}%`,{phase:s,confidence:Math.max(.1,Math.min(1,c)),reason:l||Pee[s],metricsSnapshot:{...e}}}const _ee=[{id:"complexity_morin",name:"Complexity (Morin)",description:"Dialogic, recursion, hologrammatic principle.",highlightMetrics:["entropy","clustering","coherence","emergence"],edgeStyle:"organic",explanationPrefix:"From a complexity perspective: "},{id:"genealogy_foucault",name:"Genealogy (Foucault)",description:"Power, knowledge, discontinuity.",highlightMetrics:["dominance","clustering","tension","persistence"],edgeStyle:"hierarchical",explanationPrefix:"Genealogically: "},{id:"psyche_jung",name:"Psyche (Jung)",description:"Archetypes, shadow, individuation.",highlightMetrics:["coherence","valence","archetype_activity","shadow"],edgeStyle:"flow",explanationPrefix:"In psychic terms: "},{id:"rhizome_dg",name:"Rhizome (Deleuze/Guattari)",description:"Connection, heterogeneity, multiplicity.",highlightMetrics:["diversity","connections","plateaus","lines_of_flight"],edgeStyle:"neutral",explanationPrefix:"Rhizomatically: "},{id:"anthropoetics_morin",name:"Anthropoetics (Morin)",description:"Human condition, uncertainty, ethics.",highlightMetrics:["uncertainty","risk","ethics","scale"],edgeStyle:"organic",explanationPrefix:"Anthropoetically: "}],Nee="complexity_morin";function Oee(e){const{activeArchetypeCount:t=0,nodeCount:n=0,reinforcingLinksRatio:r=0,clusterPersistence:a=0,metricStability:i=.5}=e,s=Math.min(1,t/12*.5+Math.min(1,n/500)*.5),c=r*.6+a*.4,l=Math.min(1,(1-i)*.4+s*.3+c*.3);return{hallucination_probability:Math.max(0,Math.min(1,l)),symbolic_overload_index:Math.max(0,Math.min(1,s)),confirmation_bias_score:Math.max(0,Math.min(1,c))}}function Dee(e){const{currentPhase:t="unknown",dominantMetric:n="none",assumptions:r=[]}=e,a=[];return a.push({hypothesis:`System is in ${t} phase.`,counter_hypothesis:"Phase may be observer-dependent or scale-dependent.",contradiction:"Same metrics can support multiple narratives."}),a.push({hypothesis:`${n} drives the dynamics.`,counter_hypothesis:"Correlation may be confounded by a hidden variable.",contradiction:"Dominant metric might be effect rather than cause."}),r.length>0&&a.push({hypothesis:r[0],counter_hypothesis:"Inverse or boundary case may hold under different conditions.",contradiction:"Assumptions define the observable; changing them changes the world."}),a.push({hypothesis:"Model is sufficient for prediction.",counter_hypothesis:"Black swans and phase transitions limit predictability.",contradiction:"Complex systems are inherently uncertain."}),a}function Lee(e){const t=[],n=[];if(e.knowledgeState&&(Aee(e.knowledgeState)||t.push("KnowledgeState schema validation failed."),(e.knowledgeState.uncertainty_level<0||e.knowledgeState.uncertainty_level>1)&&t.push("KnowledgeState.uncertainty_level out of range [0,1].")),e.lastPhaseResult&&(e.lastPhaseResult.confidence<0||e.lastPhaseResult.confidence>1)&&t.push("computePhase confidence out of range [0,1]."),e.observerState){const r=e.observerState.log;for(let a=1;a<r.length;a++)if(r[a].timestamp>r[a-1].timestamp){t.push("Observer log must be time-ordered (newest first).");break}}if(e.lastIndices){const r=e.lastIndices;for(const[a,i]of Object.entries(r))(typeof i!="number"||i<0||i>1)&&t.push(`Anti-illusion index "${a}" out of range [0,1]: ${i}`)}return{ok:t.length===0,errors:t,warnings:n}}const zee=()=>({enabled:!0,strength:.25,intervalFrames:10,smoothing:.85,chaosClamp:.75,recursivity:.8}),Tf={entropyLike:0,clustering:0,conflict:0,diversity:0,stagnation:0,energy:0},jE={chokhmah:0,binah:0,chesed:0,gevurah:0,tiferet:0},Ty={force:0,drag:0,entropy:0,beta:0,rmax:0,mutationRate:0},eS=()=>({config:zee(),metrics:{...Tf},activations:{...jE},modulation:{...Ty},metricsHistory:[],historyMaxLen:20,phase:0,phaseLabel:"Bloom",frameCounter:0,runawayCounter:0}),Os=16,Bee=500;function nc(e,t,n){return e+(t-e)*n}function Bs(e){return Math.max(0,Math.min(1,e))}function Lh(e,t){return Math.max(-t,Math.min(t,e))}function $ee(e,t){const n=e.count;if(n===0)return{...Tf};const r=Math.max(1,t.typesCount),a=Math.max(1,Math.floor(n/Bee));let i=0;const s=new Uint16Array(Os*Os*r),c=new Uint16Array(Os*Os);let l=0,d=0;const u=new Float32Array(r);for(let O=0;O<n;O+=a){const L=e.type[O];if(L===fd)continue;const $=Math.min(Os-1,Math.max(0,Math.floor((e.x[O]+1)*.5*Os))),B=Math.min(Os-1,Math.max(0,Math.floor((e.y[O]+1)*.5*Os)))*Os+$,W=Math.min(r-1,Math.max(0,L));s[B*r+W]++,c[B]++,W<r&&u[W]++;const re=Math.sqrt(e.vx[O]*e.vx[O]+e.vy[O]*e.vy[O]);l+=re,re>t.speedClamp*.55&&d++,i++}if(i===0)return{...Tf};let h=0,m=0;const f=Math.log2(Math.max(2,r));for(let O=0;O<Os*Os;O++){const L=c[O];if(L===0)continue;m++;let $=0;for(let F=0;F<r;F++){const B=s[O*r+F];if(B>0){const W=B/L;$-=W*Math.log2(W)}}h+=$/f}const g=m>0?Bs(h/m):0,x=i/(Os*Os);let v=0;for(let O=0;O<Os*Os;O++){const L=c[O]-x;v+=L*L}v/=Os*Os;const b=Math.max(1,x*x*6),w=Bs(v/b),M=Bs(d/i*2.2),k=Math.max(1,i*.02);let R=0;for(let O=0;O<r;O++)u[O]>=k&&R++;const j=r>1?Bs(R/r):1,I=l/i,E=Bs(I/Math.max(.001,t.speedClamp));return{entropyLike:g,clustering:w,conflict:M,diversity:j,stagnation:0,energy:E}}function qee(e){const t=e.length;if(t<4)return 0;const n=e.slice(-Math.min(5,t)),r=e.slice(-Math.min(10,t),-Math.min(5,t));if(r.length===0)return 0;const a=Dk(n),i=Dk(r),s=(Math.abs(a.entropyLike-i.entropyLike)+Math.abs(a.clustering-i.clustering)+Math.abs(a.conflict-i.conflict)+Math.abs(a.diversity-i.diversity)+Math.abs(a.energy-i.energy))/5;return Bs(1-s*4)}function Dk(e){const t=e.length;if(t===0)return{...Tf};const n={...Tf};for(const r of e)n.entropyLike+=r.entropyLike,n.clustering+=r.clustering,n.conflict+=r.conflict,n.diversity+=r.diversity,n.energy+=r.energy,n.stagnation+=r.stagnation;return{entropyLike:n.entropyLike/t,clustering:n.clustering/t,conflict:n.conflict/t,diversity:n.diversity/t,energy:n.energy/t,stagnation:n.stagnation/t}}function Hee(e,t,n){const{entropyLike:r,clustering:a,conflict:i,diversity:s,stagnation:c}=e;let l=0,d=0,u=0,h=0;if(c>.5){const k=c-.5;l+=k*1.2,u+=k*.7}if(i>.6){const k=i-.6;d+=k*1.5,h+=k*1}r<.45&&(l+=(.45-r)*1.3),r>.7&&(h+=(r-.7)*1.4,d+=(r-.7)*.6),s<.3&&(l+=(.3-s)*1.5),a>.7&&(h+=(a-.7)*1.2),a<.3&&(u+=(.3-a)*1.2);const m=Math.max(0,Math.abs(r-.575)-.125),f=Math.max(0,Math.abs(i-.4)-.2),g=Math.max(0,Math.abs(s-.6)-.3),x=Math.max(0,Math.abs(a-.5)-.2),v=(m+f+g+x)*.25,b=Bs(v*2.5),w={chokhmah:Bs(l),binah:Bs(d),chesed:Bs(u),gevurah:Bs(h),tiferet:b},M=Bs(1-n);return{chokhmah:nc(t.chokhmah,w.chokhmah,M),binah:nc(t.binah,w.binah,M),chesed:nc(t.chesed,w.chesed,M),gevurah:nc(t.gevurah,w.gevurah,M),tiferet:nc(t.tiferet,w.tiferet,M)}}const Wee=.016,Gee=.025,Vee=.01;function Uee(e,t){const{stagnation:n,conflict:r}=e.metrics,a=Math.max(.004,Wee+Gee*n-Vee*r);e.phase=(e.phase+a*t)%1,e.phase<.25?e.phaseLabel="Bloom":e.phase<.5?e.phaseLabel="Consolidate":e.phase<.75?e.phaseLabel="Prune":e.phaseLabel="Renew"}function Yee(e,t,n,r){const a=t*Math.PI*2,i=n*.3,s=Math.sin(a)*i,c=Math.cos(a)*i*.8,l=Bs(e.chesed+s),d=Bs(e.gevurah-s),u=Bs(e.chokhmah+c),h=Bs(e.binah-c),m=.2*Math.min(1,r)*Math.min(1,n),f=Lh((l-d)*.55,m),g=Lh((h-u)*.45,m),x=Lh(u*.35,m),v=Lh((d-l)*.18,m),b=Lh((l-d)*.12,m),w=Lh(u*.4,m);return{force:f,drag:g,entropy:x,beta:v,rmax:b,mutationRate:w}}function Kee(e,t){const n={force:e.force,drag:e.drag,entropy:e.entropy,beta:e.beta,rmax:e.rmax,mutationRate:e.mutationRate};return e.force=Math.max(.05,e.force*(1+t.force)),e.drag=Math.max(.05,Math.min(10,e.drag*(1+t.drag))),e.entropy=Math.max(0,Math.min(.05,e.entropy*(1+t.entropy)+Math.abs(t.entropy)*.001)),e.beta=Math.max(.05,Math.min(.95,e.beta*(1+t.beta))),e.rmax=Math.max(.04,Math.min(.5,e.rmax*(1+t.rmax))),e.mutationRate=Math.max(0,Math.min(.01,e.mutationRate*(1+t.mutationRate))),n}function Xee(e,t){e.force=t.force,e.drag=t.drag,e.entropy=t.entropy,e.beta=t.beta,e.rmax=t.rmax,e.mutationRate=t.mutationRate}function Jee(e,t,n,r,a){if(e.frameCounter++,!e.config.enabled){e.modulation={...Ty};return}if(e.frameCounter<e.config.intervalFrames)return;e.frameCounter=0;const i=e.config,s=i.intervalFrames*(1/60),c=Math.max(0,Math.min(1,i.recursivity??1)),l=(a==null?void 0:a.observerPresence)??0,d=l>0&&c>0?i.strength*Math.max(.05,1-l*c*.85):i.strength,u=$ee(t,n);e.metricsHistory.push({...u}),e.metricsHistory.length>e.historyMaxLen&&e.metricsHistory.shift(),u.stagnation=qee(e.metricsHistory);const h=Bs(1-i.smoothing*.5),m=e.metrics;if(e.metrics={entropyLike:nc(m.entropyLike,u.entropyLike,h),clustering:nc(m.clustering,u.clustering,h),conflict:nc(m.conflict,u.conflict,h),diversity:nc(m.diversity,u.diversity,h),stagnation:nc(m.stagnation,u.stagnation,h),energy:nc(m.energy,u.energy,h)},e.metrics.conflict>.95||e.metrics.energy>.97){if(e.runawayCounter++,e.runawayCounter>4){e.modulation={...Ty},e.runawayCounter=0;return}}else e.runawayCounter=Math.max(0,e.runawayCounter-1);e.activations=Hee(e.metrics,e.activations,i.smoothing),Uee(e,s),e.modulation=Yee(e.activations,e.phase,d,i.chaosClamp)}function Qee(e){e.metricsHistory=[],e.metrics={...Tf},e.activations={...jE},e.modulation={...Ty},e.phase=0,e.phaseLabel="Bloom",e.runawayCounter=0,e.frameCounter=0}const Ox=!0;function Zee(){const e=["particleLife","energy","field","genes","metamorphosis","reconfig","mitosis","archetypes","feedbackLens","render"],t={};for(const n of e)t[n]={ms:0,active:!0};return t}const ete=.12;function Op(e,t,n){const r=e[t];r.ms=r.ms+ete*(n-r.ms)}function tte(e,t=3){return Object.keys(e).map(r=>({id:r,ms:e[r].ms})).sort((r,a)=>a.ms-r.ms).slice(0,t)}function EE(){return{births:0,deaths:0,mutations:0,deathsByStarvation:0,deathsByAge:0,deathsByCollision:0,deathsByPredation:0,windowMs:0,lastRates:{birthsPerSec:0,deathsPerSec:0,mutationsPerSec:0,deathsByStarvation:0,deathsByAge:0,deathsByCollision:0,deathsByPredation:0}}}const nte=1e3;function rte(e,t,n,r,a){if(e.births+=n,e.deaths+=r,e.mutations+=a,e.windowMs+=t,e.windowMs>=nte){const i=e.windowMs/1e3;e.lastRates={birthsPerSec:e.births/i,deathsPerSec:e.deaths/i,mutationsPerSec:e.mutations/i,deathsByStarvation:e.deathsByStarvation/i,deathsByAge:e.deathsByAge/i,deathsByCollision:e.deathsByCollision/i,deathsByPredation:e.deathsByPredation/i},e.births=0,e.deaths=0,e.mutations=0,e.deathsByStarvation=0,e.deathsByAge=0,e.deathsByCollision=0,e.deathsByPredation=0,e.windowMs=0}}function TE(e){return{perturbacao:e.chokhmah,autoOrganizacao:e.binah,amplificacao:e.chesed,regulacao:e.gevurah,coerencia:e.tiferet}}function IE(e){return{variedade:e.entropyLike,coesao:e.clustering,atrito:e.conflict,resiliencia:e.diversity,persistencia:e.stagnation,metabolismo:e.energy}}const ote={Expanso:"#50ff90",Estruturao:"#60d0ff",Seleo:"#ff6050",Reorganizao:"#c080ff"},ate={Expanso:"",Estruturao:"",Seleo:"",Reorganizao:""},ste={Expanso:"Loops de reforo dominantes. Crescimento, diversificao.",Estruturao:"Auto-organizao emergindo. Padres se consolidam.",Seleo:"Presso seletiva alta. Loops de balano freiam o crescimento.",Reorganizao:"Perturbao  crise  nova ordem. Motor de emergncia e renovao."};function ite(e){return{Bloom:"Expanso",Consolidate:"Estruturao",Prune:"Seleo",Renew:"Reorganizao"}[e]}function Lk(){const e=eS();return{feedback:e,metrics:IE(e.metrics),forces:TE(e.activations),systemPhase:"Expanso",modulation:{force:0,drag:0,entropy:0,beta:0,rmax:0,mutationRate:0},moduleTelemetry:Zee(),vitalRates:EE().lastRates,systemHealth:1,emergenceIndex:0,morin:{dialogica:0,recursivo:0,hologramatico:0,sapiensDemens:.5,tetralogia:0}}}function lte(e){const t=e.resiliencia,n=e.metabolismo,r=Math.max(0,e.atrito-.6)*2,a=e.persistencia>.7?(e.persistencia-.7)*1.5:0,i=t*.45+n*.3-r*.15-a*.1;return Math.max(0,Math.min(1,i))}function cte(e){const t=e.variedade*.35+e.coesao*.35+(1-e.persistencia)*.3;return Math.max(0,Math.min(1,t))}function dte(e,t){const n=Math.min(e.amplificacao,e.regulacao)*2,r=Math.min(e.perturbacao,e.autoOrganizacao)*2,a=Math.min(1,n*.5+r*.5),i=(e.perturbacao+e.autoOrganizacao+e.amplificacao+e.regulacao+e.coerencia)/5,s=1-t.persistencia,c=Math.min(1,i*s*3),l=Math.min(1,t.coesao*.35+t.variedade*.35+t.metabolismo*.3),d=e.autoOrganizacao+e.coerencia+e.regulacao,u=e.perturbacao+e.amplificacao+t.atrito,h=d+u||1,m=d/h,f=e.regulacao,g=e.perturbacao,x=t.metabolismo,v=e.autoOrganizacao,b=Math.min(f,g,x,v),w=Math.max(f,g,x,v)||1,M=Math.min(1,b/w*2+b*.5);return{dialogica:a,recursivo:c,hologramatico:l,sapiensDemens:m,tetralogia:M}}function ute(e,t,n,r,a){const i=performance.now();Jee(e.feedback,t,n,r,a),Op(e.moduleTelemetry,"feedbackLens",performance.now()-i),e.metrics=IE(e.feedback.metrics),e.forces=TE(e.feedback.activations),e.systemPhase=ite(e.feedback.phaseLabel),e.modulation=e.feedback.modulation,e.systemHealth=lte(e.metrics),e.emergenceIndex=cte(e.metrics),e.morin=dte(e.forces,e.metrics)}const Xl="'Doto', monospace",so="'IBM Plex Mono', monospace",zo="#37b2da",_a="rgba(255,255,255,0.18)",wl="rgba(255,255,255,0.32)";function r0({label:e,open:t,onToggle:n,accent:r}){return o.jsxs("div",{onClick:n,style:{display:"flex",alignItems:"center",gap:4,fontFamily:Xl,fontSize:9,letterSpacing:"0.10em",textTransform:"uppercase",color:r??_a,marginBottom:t?7:0,cursor:"pointer",userSelect:"none"},children:[t?o.jsx(Ms,{size:8}):o.jsx(hs,{size:8}),e]})}function rd({label:e,value:t,color:n,hint:r}){const a=Math.round(t*100);return o.jsxs("div",{style:{marginBottom:4},title:r,children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:1.5},children:[o.jsx("span",{style:{fontFamily:so,fontSize:9,color:_a,letterSpacing:"0.05em"},children:e}),o.jsxs("span",{style:{fontFamily:so,fontSize:9,color:n+"bb"},children:[a,"%"]})]}),o.jsx("div",{style:{height:2,background:"rgba(255,255,255,0.04)"},children:o.jsx("div",{style:{height:"100%",width:`${a}%`,background:`linear-gradient(90deg,${n}55,${n}aa)`,transition:"width 0.3s"}})})]})}function od({label:e,value:t,color:n,hint:r}){const a=Math.round(t*100);return o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginBottom:4},title:r,children:[o.jsx("span",{style:{fontFamily:so,fontSize:9,color:wl,width:78,flexShrink:0,letterSpacing:"0.03em"},children:e}),o.jsx("div",{style:{flex:1,height:2,background:"rgba(255,255,255,0.04)"},children:o.jsx("div",{style:{height:"100%",width:`${a}%`,background:`linear-gradient(90deg,${n}55,${n}aa)`,transition:"width 0.25s"}})}),o.jsxs("span",{style:{fontFamily:so,fontSize:9,color:n+"99",width:22,textAlign:"right",flexShrink:0},children:[a,"%"]})]})}function Lo({icon:e,label:t,hint:n,value:r,min:a,max:i,step:s,display:c,onChange:l}){return o.jsxs("div",{style:{marginBottom:7},title:n,children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2,alignItems:"center"},children:[o.jsxs("span",{style:{fontFamily:so,fontSize:9,color:wl,letterSpacing:"0.05em",textTransform:"uppercase",display:"flex",alignItems:"center",gap:4},children:[e&&o.jsx("span",{style:{fontSize:10},children:e}),t]}),o.jsx("span",{style:{fontFamily:so,fontSize:9,color:`${zo}99`},children:c??r.toFixed(2)})]}),o.jsx("input",{type:"range",min:a,max:i,step:s,value:r,onChange:d=>l(parseFloat(d.target.value)),style:{width:"100%",height:2,accentColor:zo,cursor:"pointer"}})]})}function cu({label:e,hint:t,checked:n,onChange:r}){return o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:6},title:t,children:[o.jsx("span",{style:{fontFamily:so,fontSize:9,color:wl,letterSpacing:"0.05em",textTransform:"uppercase"},children:e}),o.jsx("input",{type:"checkbox",checked:n,onChange:a=>r(a.target.checked),style:{width:14,height:14,accentColor:zo,cursor:"pointer"}})]})}function kc({label:e,value:t,unit:n,color:r}){return o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:3.5},children:[o.jsx("span",{style:{fontFamily:so,fontSize:9,color:_a},children:e}),o.jsxs("span",{style:{fontFamily:so,fontSize:9.5,color:r??wl},children:[typeof t=="number"?t.toFixed(1):t,n&&o.jsx("span",{style:{color:_a,fontSize:8,marginLeft:2},children:n})]})]})}function hte({lensState:e,fps:t,agentCount:n,vitalRates:r,moduleTelemetry:a,onConfigChange:i,onResetMemory:s,microConfig:c,onMicroChange:l,fieldConfig:d,onFieldChange:u,life:h,onLifeChange:m,reconfigConfig:f,onReconfigChange:g,maintainPopulation:x,onMaintainPopulationChange:v,targetParticleCount:b,onTargetParticleCountChange:w,observerPresenceManual:M=0,onObserverPresenceManualChange:k,r1:R}){var Le,Ke,mt,an,gn;const[j,I]=S.useState(()=>{try{const Be=localStorage.getItem("complexityPanelOpen");return Be===null?!0:Be==="1"}catch{return!0}});S.useEffect(()=>{try{localStorage.setItem("complexityPanelOpen",j?"1":"0")}catch{}},[j]);const[E,O]=S.useState(!0),[L,$]=S.useState(!1),[F,B]=S.useState(!1),[W,re]=S.useState(!0),[oe,te]=S.useState(!0),[J,pe]=S.useState(!0),[P,V]=S.useState(!1),[fe,ye]=S.useState(!0),[Se,we]=S.useState(!1),{feedback:ke,metrics:De,forces:_e,systemPhase:ae,modulation:Re,systemHealth:Fe,emergenceIndex:Oe,morin:ne}=e,nt=ke.config,pt=ote[ae],Et=ate[ae],_t=ste[ae],Ct=tte(a,3),Xe=t>=50?"#60ff90":t>=30?"#ffc840":"#ff6050",Ut=r.birthsPerSec-r.deathsPerSec;return o.jsxs("div",{"data-ui-overlay":"true",style:{position:"absolute",bottom:72,left:8,zIndex:30,width:240,maxHeight:"calc(100vh - 160px)",background:"rgba(6,8,12,0.96)",border:`1px dashed ${nt.enabled?`${zo}22`:"rgba(255,255,255,0.06)"}`,transition:"border-color 0.3s",display:"flex",flexDirection:"column"},children:[o.jsxs("div",{onClick:()=>I(Be=>!Be),style:{display:"flex",alignItems:"center",gap:6,padding:"7px 10px",cursor:"pointer",flexShrink:0,background:nt.enabled?`${zo}04`:"transparent",borderBottom:j?"1px dashed rgba(255,255,255,0.05)":"none"},children:[o.jsx("span",{style:{fontSize:10,color:nt.enabled?zo:_a},children:""}),o.jsxs("div",{style:{flex:1},children:[o.jsx("div",{style:{fontFamily:Xl,fontSize:9,color:nt.enabled?`${zo}cc`:"rgba(255,255,255,0.35)",letterSpacing:"0.08em",textTransform:"uppercase"},children:"Sistema Complexo"}),o.jsx("div",{style:{fontFamily:so,fontSize:8,color:"rgba(255,255,255,0.16)",letterSpacing:"0.04em"},children:"Retroao  Emergncia  Autopoiese"})]}),nt.enabled&&o.jsxs("div",{title:_t,style:{fontFamily:so,fontSize:8.5,padding:"1px 5px",background:`${pt}0c`,color:pt,border:`1px dashed ${pt}30`,letterSpacing:"0.04em"},children:[Et," ",ae]}),j?o.jsx(Ms,{size:10,style:{color:_a}}):o.jsx(hs,{size:10,style:{color:_a}})]}),j&&o.jsxs("div",{style:{overflowY:"auto",flex:1},children:[o.jsxs("div",{style:{padding:"8px 10px",borderBottom:"1px dashed rgba(255,255,255,0.04)"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5},children:[o.jsx("button",{onClick:()=>i({enabled:!nt.enabled}),style:{fontFamily:so,fontSize:9,padding:"3px 8px",cursor:"pointer",background:nt.enabled?`${zo}0c`:"transparent",border:`1px dashed ${nt.enabled?`${zo}40`:"rgba(255,255,255,0.08)"}`,color:nt.enabled?`${zo}cc`:"rgba(255,255,255,0.30)",letterSpacing:"0.06em",textTransform:"uppercase"},children:nt.enabled?" ATIVO":" INATIVO"}),nt.enabled&&o.jsx("button",{onClick:s,title:"Limpa memria e reinicia fase",style:{fontFamily:so,fontSize:9,padding:"3px 6px",cursor:"pointer",background:"transparent",border:"1px dashed rgba(255,255,255,0.06)",color:_a,letterSpacing:"0.05em"},children:""}),o.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:4},children:[o.jsxs("div",{title:"Sade sistmica",style:{fontFamily:so,fontSize:8.5,padding:"2px 4px",background:`rgba(${Fe>.6?"80,255,130":Fe>.35?"255,200,80":"255,80,80"},0.06)`,border:`1px dashed rgba(${Fe>.6?"80,255,130":Fe>.35?"255,200,80":"255,80,80"},0.25)`,color:Fe>.6?"#60ff90":Fe>.35?"#ffc840":"#ff6050"},children:[" ",Math.round(Fe*100),"%"]}),o.jsxs("div",{title:"ndice de emergncia",style:{fontFamily:so,fontSize:8.5,padding:"2px 4px",background:`${zo}06`,border:`1px dashed ${zo}20`,color:`${zo}bb`},children:[" ",Math.round(Oe*100),"%"]})]})]}),nt.enabled&&o.jsx("div",{style:{marginTop:7},children:o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5},children:[o.jsx("span",{style:{fontFamily:so,fontSize:8,color:_a,textTransform:"uppercase",letterSpacing:"0.08em"},children:"Fase"}),o.jsx("div",{style:{flex:1,height:2,background:"rgba(255,255,255,0.04)"},children:o.jsx("div",{style:{height:"100%",width:`${ke.phase%1*100}%`,background:`linear-gradient(90deg,${pt}55,${pt}aa)`,transition:"width 0.3s"}})}),o.jsxs("span",{style:{fontFamily:so,fontSize:8.5,color:pt,padding:"1px 4px",background:`${pt}0c`,border:`1px dashed ${pt}22`},children:[Et," ",ae]})]})})]}),o.jsxs("div",{style:{padding:"8px 10px",borderBottom:"1px dashed rgba(255,255,255,0.04)"},children:[o.jsx(r0,{label:"Telemetria",open:E,onToggle:()=>O(Be=>!Be)}),E&&o.jsxs("div",{children:[o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"2px 8px",marginBottom:6},children:[o.jsx(kc,{label:"FPS",value:Math.round(t),color:Xe}),o.jsx(kc,{label:"Agentes",value:n}),o.jsx(kc,{label:"Nascimentos",value:r.birthsPerSec.toFixed(1),unit:"/s",color:"#60ff90"}),o.jsx(kc,{label:"Mortes",value:r.deathsPerSec.toFixed(1),unit:"/s",color:"#ff7060"}),o.jsx(kc,{label:"Mutaes",value:r.mutationsPerSec.toFixed(1),unit:"/s",color:"#c080ff"}),o.jsx(kc,{label:"Balano",value:Ut>=0?`+${Ut.toFixed(1)}`:Ut.toFixed(1),unit:"/s",color:Ut>=0?"#60ff90":"#ff7060"})]}),o.jsxs("div",{children:[o.jsx("div",{style:{fontFamily:Xl,fontSize:8,color:"rgba(255,255,255,0.14)",marginBottom:3,letterSpacing:"0.09em",textTransform:"uppercase"},children:"Mdulos (ms/frame)"}),Ct.map(({id:Be,ms:ft})=>o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2.5},children:[o.jsx("span",{style:{fontFamily:so,fontSize:9,color:_a},children:Be}),o.jsxs("span",{style:{fontFamily:so,fontSize:9,color:ft>5?"#ff7060":ft>2?"#ffc840":`${zo}99`},children:[ft.toFixed(2)," ms"]})]},Be))]})]})]}),o.jsxs("div",{style:{padding:"8px 10px",borderBottom:"1px dashed rgba(255,255,255,0.04)"},children:[o.jsx(r0,{label:"Estado Emergente",open:L,onToggle:()=>$(Be=>!Be)}),L&&o.jsxs("div",{children:[o.jsx(rd,{label:"Variedade",value:De.variedade,color:"#c080ff",hint:"Diversidade de tipos no espao. Alta variedade = alto potencial de resilincia (Lei de Ashby)."}),o.jsx(rd,{label:"Coeso",value:De.coesao,color:"#60d0ff",hint:"Aglomerao espacial. Nicho emergindo  padro de auto-organizao local."}),o.jsx(rd,{label:"Atrito",value:De.atrito,color:"#ff6050",hint:"Presso competitiva. Fora de seleo ativa: loop de balano."}),o.jsx(rd,{label:"Resilincia",value:De.resiliencia,color:"#50ff90",hint:"Frao de espcies ativas. Diversidade = capacidade de absorver perturbao."}),o.jsx(rd,{label:"Persistncia",value:De.persistencia,color:"#ffd060",hint:"Homeostase. Alta persistncia = sistema estagnado (derive para baixa performance)."}),o.jsx(rd,{label:"Metabolismo",value:De.metabolismo,color:"#80c0ff",hint:"Fluxo de energia cintica. Stocks e flows  vitalidade do sistema."}),o.jsx("div",{style:{height:1,background:"rgba(255,255,255,0.05)",margin:"6px 0"}}),o.jsxs("div",{style:{marginBottom:0},children:[o.jsx("div",{style:{fontFamily:Xl,fontSize:8,color:_a,marginBottom:5,letterSpacing:"0.09em",textTransform:"uppercase"},children:"Foras Ativas"}),o.jsx(od,{label:"Perturbao",value:_e.perturbacao,color:"#e0c860",hint:"Desordem criativa. Injeta imprevisibilidade  motor de emergncia."}),o.jsx(od,{label:"Auto-Org",value:_e.autoOrganizacao,color:"#6090e0",hint:"Consolida estruturas espontneas. Padro sem controle externo."}),o.jsx(od,{label:"Amplificao",value:_e.amplificacao,color:"#50e080",hint:"Loop de reforo R. Crescimento se auto-alimenta."}),o.jsx(od,{label:"Regulao",value:_e.regulacao,color:"#e05050",hint:"Loop de balano B. Freia runaway."}),o.jsx(od,{label:"Coerncia",value:_e.coerencia,color:"#d4a060",hint:"Sade global. O todo  mais do que a soma das partes."})]}),nt.enabled&&o.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:3,marginTop:5},children:[{k:"force",v:Re.force},{k:"drag",v:Re.drag},{k:"entrop",v:Re.entropy},{k:"beta",v:Re.beta},{k:"rmax",v:Re.rmax},{k:"mut",v:Re.mutationRate}].map(({k:Be,v:ft})=>{const Qt=Math.abs(ft)<.01?"rgba(255,255,255,0.14)":ft>=0?"#70e080":"#e07070";return o.jsxs("div",{style:{fontFamily:so,fontSize:8,padding:"1px 3px",background:`${Qt}0c`,border:`1px dashed ${Qt}22`,color:Qt},children:[Be," ",ft>=0&&Math.abs(ft)>.001?"+":"",(ft*100).toFixed(1),"%"]},Be)})})]})]}),o.jsxs("div",{style:{padding:"8px 10px",borderBottom:"1px dashed rgba(255,255,255,0.04)"},children:[o.jsx(r0,{label:"Morin  Complexidade",open:fe,onToggle:()=>ye(Be=>!Be),accent:"#00d4aa88"}),fe&&o.jsxs("div",{children:[o.jsx(od,{label:"Dialgica",value:ne.dialogica,color:"#c080ff",hint:"Co-presena de foras antagnicas (R+B loops). Alto = opostos coexistem produtivamente."}),o.jsx(od,{label:"Recursivo",value:ne.recursivo,color:"#60d0ff",hint:"Loop recursivo: efeito se torna causa. Produto  tambm produtor. O sistema modifica a si mesmo."}),o.jsx(od,{label:"Hologramtico",value:ne.hologramatico,color:"#50e080",hint:"Cada parte contm a lgica do todo. Correlao entre dinmica local e padro global."}),o.jsx(od,{label:"Tetralogia",value:ne.tetralogia,color:"#e0c860",hint:"Ordem  Desordem  Interaes  Organizao. Alto = todos os 4 polos ativos e ciclando."}),o.jsx("div",{style:{height:1,background:"rgba(255,255,255,0.05)",margin:"6px 0"}}),o.jsxs("div",{style:{marginBottom:4},title:"Razo construtivo/destrutivo. 0.5 = equilbrio sapiens-demens.",children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:3},children:[o.jsx("span",{style:{fontFamily:so,fontSize:9,color:wl,letterSpacing:"0.03em"},children:"Sapiens  Demens"}),o.jsxs("span",{style:{fontFamily:so,fontSize:9,color:Math.abs(ne.sapiensDemens-.5)<.15?"#00d4aa":"#ffc840"},children:[(ne.sapiensDemens*100).toFixed(0),"%"]})]}),o.jsxs("div",{style:{position:"relative",height:6,background:"rgba(255,255,255,0.04)",borderRadius:3},children:[o.jsx("div",{style:{position:"absolute",left:"50%",top:0,width:1,height:6,background:"rgba(255,255,255,0.15)"}}),o.jsx("div",{style:{position:"absolute",left:`${ne.sapiensDemens*100}%`,top:"50%",transform:"translate(-50%, -50%)",width:8,height:8,borderRadius:"50%",background:Math.abs(ne.sapiensDemens-.5)<.15?"#00d4aa":ne.sapiensDemens>.65?"#60d0ff":"#ff6050",border:"1px solid rgba(255,255,255,0.20)",transition:"left 0.3s"}}),o.jsx("div",{style:{position:"absolute",left:4,top:8,fontFamily:so,fontSize:7,color:"#ff605080"},children:"Demens"}),o.jsx("div",{style:{position:"absolute",right:4,top:8,fontFamily:so,fontSize:7,color:"#60d0ff80"},children:"Sapiens"})]})]})]})]}),o.jsxs("div",{style:{padding:"8px 10px",borderBottom:"1px dashed rgba(255,255,255,0.04)"},children:[o.jsx(r0,{label:"Interao",open:W,onToggle:()=>re(Be=>!Be),accent:`${zo}88`}),W&&o.jsxs("div",{children:[o.jsx(Lo,{icon:"",label:"Acoplamento",hint:"Raio de interao entre agentes. Alto acoplamento = mais interconexes. (rmax)",value:c.rmax,min:.04,max:.5,step:.01,onChange:Be=>l({rmax:Be})}),o.jsx(Lo,{icon:"",label:"Fora de Atrao",hint:"Magnitude das foras de atrao/repulso. Amplitude dos loops de interao. (force)",value:c.force,min:.2,max:4,step:.05,onChange:Be=>l({force:Be})}),o.jsx(Lo,{icon:"",label:"Viscosidade",hint:"Arrasto exponencial (drag). Alto = movimento mais contido; baixo = mais cintico.",value:c.drag,min:.1,max:5,step:.1,onChange:Be=>l({drag:Be})}),o.jsx(Lo,{icon:"",label:"Limite de Velocidade",hint:"Clamp de velocidade (speedClamp). Controla quanto energia cintica pode acumular.",value:c.speedClamp,min:.02,max:.5,step:.01,onChange:Be=>l({speedClamp:Be})}),o.jsx(Lo,{icon:"",label:"Limiar Auto-Org",hint:"Raio central de repulso (beta). Controla quando agentes se organizam em estruturas vs. se dispersam.",value:c.beta,min:.05,max:.95,step:.01,onChange:Be=>l({beta:Be})}),o.jsx(Lo,{icon:"",label:"Repulso Central",hint:"Intensidade da repulso no ncleo (coreRepel). Alto = evita colapso; baixo = favorece aglomerao.",value:c.coreRepel,min:.2,max:2,step:.05,onChange:Be=>l({coreRepel:Be})}),o.jsx(Lo,{icon:"",label:"Entropia",hint:"Rudo injetado por frame. Alta entropia = perturbao criativa. Baixa = sistema determinstico.",value:c.entropy,min:0,max:1,step:.01,display:c.entropy.toFixed(2),onChange:Be=>l({entropy:Be})}),o.jsx(Lo,{icon:"",label:"Dialgica",hint:"Intensidade da dependncia circular entre tipos. Cria tenso ordem/desordem  opostos que coexistem.",value:c.circularDependency,min:0,max:1,step:.01,onChange:Be=>l({circularDependency:Be})}),o.jsx(cu,{label:"Foras Sigil (Bond/Rift)",hint:"Usa sigilBond/sigilRift como foras causais na microdinmica (toggle).",checked:c.enableSigilForces!==!1,onChange:Be=>l({enableSigilForces:Be})})]})]}),o.jsxs("div",{style:{padding:"8px 10px",borderBottom:"1px dashed rgba(255,255,255,0.04)"},children:[o.jsx(r0,{label:"Metabolismo",open:oe,onToggle:()=>te(Be=>!Be),accent:`${zo}88`}),oe&&o.jsxs("div",{children:[o.jsxs("div",{style:{marginBottom:8},children:[o.jsx("div",{style:{fontFamily:Xl,fontSize:8,color:_a,marginBottom:5,letterSpacing:"0.09em",textTransform:"uppercase"},children:"Vida (toggles)"}),o.jsx(cu,{label:"Comida",hint:"Ativa ns de recurso (food). Sem isso, a dinmica fica mais 'fsica' e menos metablica.",checked:h.foodEnabled,onChange:Be=>m({foodEnabled:Be})}),o.jsx(cu,{label:"Energia",hint:"Ativa o sistema de energia/reproduo. Sem energia, no h seleo por custo/ganho.",checked:h.energyEnabled,onChange:Be=>m({energyEnabled:Be})}),o.jsx(cu,{label:"Reconfig",hint:"Ativa mutao macro (reconfig) em janelas  til para phase shifts e novidades.",checked:h.reconfigEnabled,onChange:Be=>m({reconfigEnabled:Be})}),o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:6},children:[o.jsx("span",{style:{fontFamily:so,fontSize:9,color:wl,letterSpacing:"0.05em",textTransform:"uppercase"},children:"Modo"}),o.jsxs("select",{value:h.mode,onChange:Be=>m({mode:Be.target.value}),style:{fontFamily:so,fontSize:9,color:"rgba(255,255,255,0.55)",background:"rgba(255,255,255,0.03)",border:"1px dashed rgba(255,255,255,0.08)",padding:"2px 6px"},children:[o.jsx("option",{value:"OFF",children:"OFF"}),o.jsx("option",{value:"METABOLIC",children:"METABLICO"}),o.jsx("option",{value:"EVOLUTIVE",children:"EVOLUTIVO"}),o.jsx("option",{value:"FULL",children:"COMPLETO"})]})]})]}),o.jsx(Lo,{icon:"",label:"Taxa de Absoro",hint:"Velocidade de ganho de energia ao interagir com outros. Stocks e flows: taxa de entrada no estoque de energia.",value:h.energyFeedRate,min:.005,max:.15,step:.005,display:h.energyFeedRate.toFixed(3),onChange:Be=>m({energyFeedRate:Be})}),o.jsx(Lo,{icon:"",label:"Custo Metablico",hint:"Decaimento de energia por frame. Presso de seleo: agentes de baixo custo sobrevivem mais. (energyDecay)",value:h.energyDecay,min:5e-4,max:.01,step:5e-4,display:h.energyDecay.toFixed(4),onChange:Be=>m({energyDecay:Be})}),o.jsx(Lo,{icon:"",label:"Limiar de Reproduo",hint:"Energia necessria para se reproduzir. Alto limiar = seleo mais rgida. (reproductionThreshold)",value:h.energyReproThreshold,min:.5,max:5,step:.1,onChange:Be=>m({energyReproThreshold:Be})}),o.jsx(Lo,{icon:"",label:"Capacidade de Suporte",hint:"Nmero mximo de agentes. Define o teto do estoque populacional. (targetParticleCount)",value:b,min:100,max:3e3,step:50,display:`${b}`,onChange:Be=>w(Math.round(Be))}),o.jsx(cu,{label:"Manter Populao",hint:"Se desligado, a populao pode oscilar (nascimentos/mortes alteram o total). Se ligado, o sistema fora o total at a capacidade alvo.",checked:x,onChange:v}),o.jsx(Lo,{icon:"",label:"Mutao",hint:"Dial de mutao [0..1]. Alto = tipos evoluem rapidamente, baixa estabilidade. (mutationDial)",value:h.mutationDial,min:0,max:1,step:.01,onChange:Be=>m({mutationDial:Be})}),o.jsxs("div",{style:{marginTop:6,padding:"6px 8px",background:"rgba(255,255,255,0.02)",border:"1px dashed rgba(255,255,255,0.05)"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontFamily:so,fontSize:8.5,color:_a},children:[o.jsx("span",{children:"mutationRate"}),o.jsx("span",{style:{color:wl},children:h.mutationRate.toFixed(5)})]}),o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontFamily:so,fontSize:8.5,color:_a},children:[o.jsx("span",{children:"typeStability"}),o.jsx("span",{style:{color:wl},children:h.typeStability.toFixed(3)})]}),o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontFamily:so,fontSize:8.5,color:_a},children:[o.jsx("span",{children:"mutationAmount"}),o.jsx("span",{style:{color:wl},children:h.mutationAmount.toFixed(3)})]})]})]})]}),o.jsxs("div",{style:{padding:"8px 10px",borderBottom:"1px dashed rgba(255,255,255,0.04)"},children:[o.jsx(r0,{label:"Retroalimentao",open:J,onToggle:()=>pe(Be=>!Be),accent:`${zo}88`}),J&&o.jsxs("div",{children:[o.jsx(Lo,{icon:"",label:"Fora dos Loops",hint:"Intensidade dos loops de feedback. 0 = sistema aberto. 1 = retroao mxima nos parmetros. (strength)",value:nt.strength,min:0,max:1,step:.01,onChange:Be=>i({strength:Be})}),o.jsx(Lo,{icon:"",label:"Atraso Sistmico",hint:"Delay entre causa e efeito do loop de feedback. Atrasos longos  instabilidade e oscilaes. (intervalFrames)",value:nt.intervalFrames,min:1,max:60,step:1,display:`${nt.intervalFrames} fr`,onChange:Be=>i({intervalFrames:Math.round(Be)})}),o.jsx(Lo,{icon:"",label:"Memria do Sistema",hint:"Inrcia do loop de feedback. Alta memria = sistema 'lembra' perturbaes. Correlato de histria acumulada. (smoothing)",value:nt.smoothing,min:0,max:.99,step:.01,onChange:Be=>i({smoothing:Be})}),o.jsx(Lo,{icon:"",label:"Regulao Mxima",hint:"Teto da autorregulao. Limita quanto os loops de balano podem comprimir os parmetros. (chaosClamp)",value:nt.chaosClamp,min:0,max:1,step:.01,onChange:Be=>i({chaosClamp:Be})}),o.jsx(Lo,{icon:"",label:"Recursividade (2 ordem)",hint:"Quanto a presena do observador (voc) reduz a modulao automtica. 0 = sistema sempre no mximo. 1 = observador no loop: quando voc interage, o sistema 'cede' e modula menos.",value:nt.recursivity??.8,min:0,max:1,step:.05,onChange:Be=>i({recursivity:Be})}),k&&o.jsx(Lo,{icon:"",label:"Presena do observador",hint:"Simula observador ativo (0 = s brush/lens contam). Suba para ver a modulao automtica cair sem usar o brush  efeito da 2 ordem.",value:M,min:0,max:1,step:.05,onChange:k}),o.jsx("div",{style:{height:1,background:"rgba(255,255,255,0.05)",margin:"8px 0"}}),o.jsx("div",{style:{fontFamily:Xl,fontSize:8,color:_a,marginBottom:5,letterSpacing:"0.09em",textTransform:"uppercase"},children:"Macro (Reconfig / Matriz)"}),o.jsx(Lo,{icon:"",label:"Intervalo",hint:"Intervalo entre ticks de reconfigurao (operadores macro: mutao de matriz, especiao, instituio).",value:f.interval,min:.5,max:12,step:.5,display:`${f.interval.toFixed(1)}s`,onChange:Be=>g({interval:Be})}),o.jsx(Lo,{icon:"",label:"Especiao",hint:"Probabilidade do operador de especiao quando h clusters estveis.",value:f.speciationRate,min:0,max:1,step:.05,onChange:Be=>g({speciationRate:Be})}),o.jsx(Lo,{icon:"",label:"Instituio",hint:"Probabilidade do operador de instituio (artefatos semnticos) quando h oscilao/mythic.",value:f.institutionRate,min:0,max:1,step:.05,onChange:Be=>g({institutionRate:Be})}),o.jsx(kc,{label:"Mutao matriz (chance)",value:f.mutationStrength,color:"rgba(255,255,255,0.55)"})]})]}),o.jsxs("div",{style:{padding:"8px 10px"},children:[o.jsx(r0,{label:"Campo / Ambiente",open:P,onToggle:()=>V(Be=>!Be),accent:`${zo}88`}),P&&o.jsxs("div",{children:[o.jsx(Lo,{icon:"",label:"Recursividade",hint:"Fora com que o campo alimenta de volta os agentes. Efeito se torna causa: agentes modificam o campo que os modifica. (influenceStrength)",value:d.influenceStrength,min:0,max:2,step:.05,onChange:Be=>u({influenceStrength:Be})}),o.jsx(Lo,{icon:"",label:"Hologramtico",hint:"Intensidade do depsito local no campo global. Cada parte escreve o todo. O trace local emerge como padro global. (depositStrength)",value:d.depositStrength,min:0,max:3,step:.05,onChange:Be=>u({depositStrength:Be})}),o.jsx(Lo,{icon:"",label:"Difuso do Campo",hint:"Velocidade de difuso do campo espacial. Alta difuso = efeitos locais se propagam rapidamente. (diffusion)",value:d.diffusion,min:.01,max:.5,step:.01,onChange:Be=>u({diffusion:Be})}),o.jsx(Lo,{icon:"",label:"Decaimento do Campo",hint:"Velocidade de decaimento das memrias de campo. Baixo decay = campo tem memria longa. (decay)",value:d.decay,min:.001,max:.1,step:.001,display:d.decay.toFixed(3),onChange:Be=>u({decay:Be})})]})]}),(R==null?void 0:R.adminMode)&&o.jsxs("div",{style:{padding:"8px 10px",borderBottom:"1px dashed rgba(255,255,255,0.04)"},children:[o.jsx(r0,{label:"Patch R1",open:Se,onToggle:()=>we(Be=>!Be),accent:`${zo}88`}),Se&&o.jsxs("div",{children:[R.flags&&Object.keys(R.flags).map(Be=>o.jsx(cu,{label:Be.replace("R1_","").replace(/_/g," "),hint:"",checked:!!R.flags[Be],onChange:ft=>R.onFlagChange(Be,ft)},Be)),R.onRunSelfCheck&&o.jsxs("div",{style:{marginTop:8},children:[o.jsx("button",{type:"button",onClick:R.onRunSelfCheck,style:{width:"100%",padding:"6px 8px",fontFamily:so,fontSize:9,letterSpacing:"0.05em",background:"rgba(55,178,218,0.08)",border:"1px dashed rgba(55,178,218,0.3)",color:zo,cursor:"pointer"},children:"Run Self-Check"}),R.selfCheckResult&&o.jsx("div",{style:{marginTop:4,fontFamily:so,fontSize:9,color:R.selfCheckResult.ok?"#60ff90":"#ff8060"},children:R.selfCheckResult.ok?" OK":` ${R.selfCheckResult.errors.length} erro(s)`})]}),R.knowledgeState&&((Le=R.flags)==null?void 0:Le.R1_MORIN_ENGINE)&&o.jsxs(o.Fragment,{children:[o.jsx("div",{style:{height:1,background:"rgba(255,255,255,0.05)",margin:"8px 0"}}),o.jsx("div",{style:{fontFamily:Xl,fontSize:8,color:_a,marginBottom:4,letterSpacing:"0.09em",textTransform:"uppercase"},children:"Epistemologia"}),o.jsx(kc,{label:"Incerteza",value:`${(R.knowledgeState.uncertainty_level*100).toFixed(0)}%`,color:zo+"99"}),o.jsx(kc,{label:"Escala",value:R.knowledgeState.scale}),R.knowledgeState.assumptions.slice(0,2).map((Be,ft)=>o.jsxs("div",{style:{fontFamily:so,fontSize:8,color:wl,marginBottom:2},children:[" ",Be]},ft))]}),R.observerState&&((Ke=R.flags)==null?void 0:Ke.R1_OBSERVER)&&o.jsxs(o.Fragment,{children:[o.jsx("div",{style:{height:1,background:"rgba(255,255,255,0.05)",margin:"8px 0"}}),o.jsx("div",{style:{fontFamily:Xl,fontSize:8,color:_a,marginBottom:4,letterSpacing:"0.09em",textTransform:"uppercase"},children:"Observer (2 ordem)"}),o.jsx(cu,{label:"Ativo",hint:"",checked:R.observerState.config.enabled,onChange:Be=>{var ft;return(ft=R.onObserverConfigChange)==null?void 0:ft.call(R,{enabled:Be})}}),o.jsx(Lo,{icon:"",label:"Limiar entropia",hint:"",value:R.observerState.config.entropyThresholdHigh,min:.5,max:1,step:.05,onChange:Be=>{var ft;return(ft=R.onObserverConfigChange)==null?void 0:ft.call(R,{entropyThresholdHigh:Be})}}),o.jsx(Lo,{icon:"",label:"Limiar dominncia",hint:"",value:R.observerState.config.dominanceThreshold,min:.5,max:1,step:.05,onChange:Be=>{var ft;return(ft=R.onObserverConfigChange)==null?void 0:ft.call(R,{dominanceThreshold:Be})}}),R.observerState.log.slice(0,8).map((Be,ft)=>o.jsxs("div",{style:{fontFamily:so,fontSize:8,color:_a,marginBottom:1},children:[Be.kind,": ",Be.reason]},ft))]}),R.phaseResult&&((mt=R.flags)==null?void 0:mt.R1_ALCHEMICAL_PHASES)&&o.jsxs(o.Fragment,{children:[o.jsx("div",{style:{height:1,background:"rgba(255,255,255,0.05)",margin:"8px 0"}}),o.jsx("div",{style:{fontFamily:Xl,fontSize:8,color:_a,marginBottom:4,letterSpacing:"0.09em",textTransform:"uppercase"},children:"Fase alqumica"}),o.jsx(kc,{label:R.phaseResult.phase,value:`${(R.phaseResult.confidence*100).toFixed(0)}%`,color:zo+"99"}),o.jsx("div",{style:{fontFamily:so,fontSize:8,color:wl},children:R.phaseResult.reason})]}),((an=R.flags)==null?void 0:an.R1_LENS_SYSTEM)&&R.lensOptions&&R.lensId&&R.onLensChange&&o.jsxs(o.Fragment,{children:[o.jsx("div",{style:{height:1,background:"rgba(255,255,255,0.05)",margin:"8px 0"}}),o.jsx("div",{style:{fontFamily:Xl,fontSize:8,color:_a,marginBottom:4,letterSpacing:"0.09em",textTransform:"uppercase"},children:"Lente"}),o.jsx("select",{value:R.lensId,onChange:Be=>R.onLensChange(Be.target.value),style:{width:"100%",padding:4,fontFamily:so,fontSize:9,background:"rgba(0,0,0,0.3)",border:"1px dashed rgba(255,255,255,0.1)",color:zo},children:R.lensOptions.map(Be=>o.jsx("option",{value:Be.id,children:Be.name},Be.id))})]}),R.indices&&((gn=R.flags)==null?void 0:gn.R1_ANTI_ILLUSION)&&o.jsxs(o.Fragment,{children:[o.jsx("div",{style:{height:1,background:"rgba(255,255,255,0.05)",margin:"8px 0"}}),o.jsx("div",{style:{fontFamily:Xl,fontSize:8,color:_a,marginBottom:4,letterSpacing:"0.09em",textTransform:"uppercase"},children:"Anti-iluso"}),o.jsx(rd,{label:"Alucinao (heur.)",value:R.indices.hallucination_probability,color:zo,hint:""}),o.jsx(rd,{label:"Sobrecarga simblica",value:R.indices.symbolic_overload_index,color:zo,hint:""}),o.jsx(rd,{label:"Vis confirmao",value:R.indices.confirmation_bias_score,color:zo,hint:""}),R.onGenerateCounterMap&&o.jsx("button",{type:"button",onClick:R.onGenerateCounterMap,style:{width:"100%",marginTop:4,padding:"4px 8px",fontFamily:so,fontSize:8,background:"rgba(55,178,218,0.08)",border:"1px dashed rgba(55,178,218,0.25)",color:zo,cursor:"pointer"},children:"Gerar contra-mapa"}),R.counterMap&&R.counterMap.length>0&&o.jsx("div",{style:{marginTop:4,maxHeight:120,overflow:"auto"},children:R.counterMap.slice(0,4).map((Be,ft)=>o.jsxs("div",{style:{fontFamily:so,fontSize:8,color:wl,marginBottom:4},children:[o.jsx("span",{style:{color:zo},children:""})," ",Be.counter_hypothesis]},ft))})]})]})]})]})]})}const fte=32,pte=32;function mte(){return{enabled:!1,resourceMode:"FIELD_DERIVED",resourceRegen:.06,resourceHarvest:.08,metabolism:.015,claimGain:.12,claimDecay:.02,claimDiffusion:.08,giniAlert:.45}}function gte(){const e=fte,t=pte,n=e*t;return{R:new Float32Array(n).fill(.25),R_static:new Float32Array(n).fill(.25),claimOwner:new Int16Array(n).fill(-1),claimStrength:new Float32Array(n),tmp:new Float32Array(n),gridW:e,gridH:t}}function yte(){return{meanEnergy:.5,gini:0,scarcityRatio:0,dominantGroup:-1,territoryShare:0,fatigueCount:0,famineConsecutive:0}}function PE(e,t,n,r){const a=Math.max(0,Math.min(n-1,Math.floor((e+1)*.5*n)));return Math.max(0,Math.min(r-1,Math.floor((t+1)*.5*r)))*n+a}function bte(e,t,n,r){const a=Math.max(0,Math.min(n-1,Math.floor((e+1)*.5*n)));return Math.max(0,Math.min(r-1,Math.floor((t+1)*.5*r)))*n+a}function xte(e,t,n){const{R:r,R_static:a,gridW:i,gridH:s}=e,c=i*s;a.fill(.08);const l=5;for(let d=0;d<l;d++){const u=n.next()*(i-2)+1,h=n.next()*(s-2)+1,m=2.5+n.next()*4.5,f=.55+n.next()*.45;for(let g=0;g<s;g++)for(let x=0;x<i;x++){const v=x-u,b=g-h,w=v*v+b*b,M=f*Math.exp(-w/(2*m*m)),k=g*i+x;a[k]=Math.min(1,a[k]+M)}}for(let d=0;d<c;d++)r[d]=a[d];e.claimOwner.fill(-1),e.claimStrength.fill(0)}function vte(e,t,n,r){const{R:a,R_static:i,gridW:s,gridH:c}=e;if(t.resourceMode==="FIELD_DERIVED"&&n){const l=n.width,d=n.height;for(let u=0;u<c;u++)for(let h=0;h<s;h++){const m=Math.floor(h/s*l),g=Math.floor(u/c*d)*l+m,x=n.cohesion[g]||0,v=n.scarcity[g]||0,b=n.tension[g]||0,w=u*s+h,M=Math.max(0,Math.min(1,i[w]*.5+.2+x*.35-v*.28-b*.12));a[w]+=(M-a[w])*r*.4+t.resourceRegen*r*(1-a[w]),a[w]<0&&(a[w]=0),a[w]>1&&(a[w]=1)}}else{const l=s*c,d=t.resourceRegen*r;for(let u=0;u<l;u++)a[u]+=d*(i[u]-a[u])*2,a[u]<0&&(a[u]=0),a[u]>1&&(a[u]=1)}}const Ste=.22,zk=.92;function wte(e,t,n,r,a){const{R:i,gridW:s,gridH:c}=e;for(let l=0;l<n.count;l++){n.energy[l]===0&&(n.energy[l]=1),n.energy[l]-=t.metabolism*a;const d=PE(n.x[l],n.y[l],s,c),u=i[d];if(u>Ste){let h=1;if(r){const f=bte(n.x[l],n.y[l],r.width,r.height),g=r.cohesion.length-1,x=f>g?g:f;h+=r.cohesion[x]*.2-r.tension[x]*.2}const m=t.resourceHarvest*u*h*a;n.energy[l]+=m,i[d]-=m*.55,i[d]<0&&(i[d]=0)}n.energy[l]<.1&&(n.vx[l]*=zk,n.vy[l]*=zk),n.energy[l]<0&&(n.energy[l]=0),n.energy[l]>1&&(n.energy[l]=1)}}const Mte=.01,Cte=.004;function kte(e,t,n,r,a){const i=n.lastTickTime;for(const s of n.rituals){const c=n.totems.find(h=>h.id===s.totemId);if(!c||!((i-s.bornAt)%s.periodSec/s.periodSec<s.dutyCycle))continue;const u=c.radius*c.radius;for(let h=0;h<r.count;h++){const m=r.x[h]-c.pos.x,f=r.y[h]-c.pos.y;m*m+f*f<u&&(r.energy[h]-=Mte*a*s.intensity,r.energy[h]<0&&(r.energy[h]=0))}}for(const s of n.totems){if(s.kind==="ARCHIVE")continue;const c=s.radius*s.radius;for(let l=0;l<r.count;l++){const d=r.x[l]-s.pos.x,u=r.y[l]-s.pos.y;d*d+u*u<c&&(r.energy[l]-=Cte*a*s.strength,r.energy[l]<0&&(r.energy[l]=0))}}}function Rte(e,t,n,r,a){const{claimOwner:i,claimStrength:s,tmp:c,gridW:l,gridH:d}=e,u=l*d,h=Math.max(0,1-t.claimDecay*a);for(let f=0;f<u;f++)s[f]*=h;for(let f=0;f<n.count;f++){const g=PE(n.x[f],n.y[f],l,d),x=r?r.memeId[f]:n.type[f];i[g]<0||i[g]===x?(i[g]=x,s[g]=Math.min(1,s[g]+t.claimGain*a)):(s[g]=Math.max(0,s[g]-t.claimGain*a*.6),s[g]<.08&&(i[g]=x,s[g]=.08))}c.fill(0);const m=t.claimDiffusion*a*.06;for(let f=0;f<d;f++)for(let g=0;g<l;g++){const x=f*l+g;if(s[x]<.06)continue;const v=i[x],b=s[x]*m,w=f>0?(f-1)*l+g:-1,M=f<d-1?(f+1)*l+g:-1,k=g>0?f*l+(g-1):-1,R=g<l-1?f*l+(g+1):-1;for(const j of[w,M,k,R])j<0||i[j]>=0||(i[j]=v,c[j]+=b)}for(let f=0;f<u;f++)s[f]=Math.min(1,s[f]+c[f]),s[f]<.015&&(i[f]=-1,s[f]=0)}function Ate(e,t,n,r){const{R:a,claimOwner:i,gridW:s,gridH:c}=e,l=s*c,d=n.count,u=[];if(d===0)return{metrics:{...r},events:u};const h=Math.max(1,Math.floor(d/200)),m=[];let f=0;for(let O=0;O<d;O+=h){const L=n.energy[O];m.push(L),L<.1&&f++}const g=m.length,x=g>0?m.reduce((O,L)=>O+L,0)/g:.5;m.sort((O,L)=>O-L);let v=0;if(g>1){let O=0;const L=m.reduce(($,F)=>$+F,0);for(let $=0;$<g;$++)O+=(2*($+1)-g-1)*m[$];v=L>0?Math.max(0,Math.min(1,O/(g*L))):0}let b=0;for(let O=0;O<l;O++)a[O]<.25&&b++;const w=b/l,M=new Map;let k=0;for(let O=0;O<l;O++){const L=i[O];L>=0&&(M.set(L,(M.get(L)||0)+1),k++)}let R=-1,j=0;M.forEach((O,L)=>{O>j&&(j=O,R=L)});const I=k>0?j/k:0,E=x<.2?r.famineConsecutive+1:0;return E===3&&u.push({icon:"",message:`FAMINE  energy critically low (${(x*100).toFixed(0)}%)`,color:"#ef4444"}),v>r.gini+.05&&v>.4&&u.push({icon:"",message:`INEQUALITY SPIKE  Gini ${v.toFixed(2)}`,color:"#fbbf24"}),R!==r.dominantGroup&&R>=0&&u.push({icon:"",message:`TERRITORY SHIFT  group ${R} now dominant`,color:"#a78bfa"}),{metrics:{meanEnergy:x,gini:v,scarcityRatio:w,dominantGroup:R,territoryShare:I,fatigueCount:f,famineConsecutive:E},events:u}}const jte=.2,w5=.15,Bk=12;function Ete(e,t,n=!1,r){const a=e.count;if(a===0)return{cohesion:0,segregation:0,borderStrength:0,volatility:0,ritualSync:0,phase:"DISPERSED"};const i=Math.max(10,Math.floor(a*jte)),s=Math.floor(a/i);let c=0;for(let j=0;j<a;j+=s){let I=0;const E=e.x[j],O=e.y[j],L=w5*w5;for(let $=0;$<a;$++){if(j===$)continue;const F=e.x[$]-E,B=e.y[$]-O;F*F+B*B<L&&I++}c+=I}const l=c/i,d=Math.min(1,l/8);let u=0,h=0;for(let j=0;j<a;j+=s){const I=e.x[j],E=e.y[j],O=e.type[j],L=w5*w5;for(let $=0;$<a;$++){if(j===$)continue;const F=e.x[$]-I,B=e.y[$]-E;F*F+B*B<L&&(h++,e.type[$]===O&&u++)}}const m=h>0?u/h:0,f=new Map;for(let j=0;j<a;j++){const I=Math.floor((e.x[j]+1)*Bk/2),E=Math.floor((e.y[j]+1)*Bk/2),O=`${I},${E}`;f.has(O)||f.set(O,{count:0,types:new Map});const L=f.get(O);L.count++;const $=e.type[j];L.types.set($,(L.types.get($)||0)+1)}let g=0,x=0;for(const[j,I]of f.entries()){const[E,O]=j.split(","),L=parseInt(E),$=parseInt(O);let F=0;for(const[B,W]of[[-1,0],[1,0],[0,-1],[0,1]]){const re=`${L+B},${$+W}`,oe=f.get(re);if(oe){const te=I.types.size,J=oe.types.size;F+=Math.abs(te-J)}}g+=F,x++}const v=x>0?Math.min(1,g/(x*4)):0;let b=0;for(let j=0;j<a;j++){const I=Math.sqrt(e.vx[j]*e.vx[j]+e.vy[j]*e.vy[j]);b+=I}const w=b/a,M=Math.min(1,w*20);let k=0;if(n&&r){let j=0,I=0;const E=.25*.25;for(let O=0;O<a;O++){const L=e.x[O]-r.x,$=e.y[O]-r.y,F=L*L+$*$;if(F<E&&F>.001){const B=Math.sqrt(F),W=-$/B,re=L/B,oe=e.vx[O]*W+e.vy[O]*re;j+=Math.abs(oe),I++}}I>0&&(k=Math.min(1,j/I*15))}const R=Tte(d,m,v,M,k);return{cohesion:d,segregation:m,borderStrength:v,volatility:M,ritualSync:k,phase:R}}function Tte(e,t,n,r,a){return a>.6?"RITUALIZED":r>.7&&e<.3?"COLLAPSE":t>.7&&n>.5?"SEGREGATED":e>.6&&t<.5?"CLUSTER":r>.5&&e>.4?"SWARM":"DISPERSED"}let Pi=null;const Rc={borderFormed:.6,borderDissolved:.3,ritualPeak:.65,cohesionSpike:.7,volatilitySpike:.75};function Ite(e){Pi={lastPhase:e.phase,lastObs:e,phaseStability:0,history:[{time:0,obs:e}]}}function Pte(e,t){if(!Pi)return Ite(e),[];const n=[],r=Pi.lastObs;if(e.phase!==Pi.lastPhase?Pi.phaseStability=0:Pi.phaseStability++,Pi.phaseStability===2&&e.phase!==r.phase&&n.push({time:t,kind:"PHASE_SHIFT",title:`Phase Shift: ${r.phase}  ${e.phase}`,detail:`System transitioned to ${e.phase}`,icon:"",tags:["phase","transition"],evidence:{phase:e.phase,cohesion:e.cohesion,volatility:e.volatility}}),r.borderStrength<Rc.borderFormed&&e.borderStrength>=Rc.borderFormed&&n.push({time:t,kind:"BORDER_FORMED",title:"Borders Crystallizing",detail:`Border strength: ${(e.borderStrength*100).toFixed(0)}%`,icon:"",tags:["border","structure"],evidence:{borderStrength:e.borderStrength,segregation:e.segregation}}),r.borderStrength>=Rc.borderDissolved&&e.borderStrength<Rc.borderDissolved&&n.push({time:t,kind:"BORDER_DISSOLVED",title:"Borders Dissolving",detail:"Types mixing - boundaries eroding",icon:"",tags:["border","mixing"],evidence:{borderStrength:e.borderStrength}}),e.ritualSync>0&&r.ritualSync<Rc.ritualPeak&&e.ritualSync>=Rc.ritualPeak&&n.push({time:t,kind:"RITUAL_SYNC_PEAK",title:"Ritual Synchronization",detail:`Sync: ${(e.ritualSync*100).toFixed(0)}% - coordinated motion`,icon:"",tags:["ritual","sync"],evidence:{ritualSync:e.ritualSync,volatility:e.volatility}}),r.cohesion<Rc.cohesionSpike&&e.cohesion>=Rc.cohesionSpike&&n.push({time:t,kind:"COHESION_SPIKE",title:"High Cohesion Achieved",detail:"Tight clustering formed",icon:"",tags:["cohesion","cluster"],evidence:{cohesion:e.cohesion}}),r.volatility<Rc.volatilitySpike&&e.volatility>=Rc.volatilitySpike&&n.push({time:t,kind:"VOLATILITY_SPIKE",title:"Turbulence Spike",detail:"System entering chaotic regime",icon:"",tags:["volatility","chaos"],evidence:{volatility:e.volatility}}),Pi.history.length>=3){const a=Pi.history.slice(-3);a.every((s,c)=>c===0||s.obs.cohesion>a[c-1].obs.cohesion)&&r.cohesion<.4&&e.cohesion>=.4&&n.push({time:t,kind:"RECOVERY",title:"System Recovery",detail:"Cohesion rebuilding after collapse",icon:"",tags:["recovery","cohesion"],evidence:{cohesion:e.cohesion}})}return Pi.lastPhase=e.phase,Pi.lastObs=e,Pi.history.push({time:t,obs:e}),Pi.history.length>10&&Pi.history.shift(),n}const $k="t4p_admin_mode_v1",Fte="morin2026";function _te({onUnlock:e}){const[t,n]=on.useState(""),[r,a]=on.useState(!1),i=s=>{s.preventDefault(),t.trim().toLowerCase()==="meadow2026"?e():(a(!0),setTimeout(()=>a(!1),1500))};return o.jsx("div",{style:{position:"fixed",inset:0,zIndex:50,background:"radial-gradient(ellipse at 50% 40%, #0c0a18 0%, #040308 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",fontFamily:"system-ui, sans-serif"},children:o.jsxs("div",{style:{textAlign:"center",maxWidth:340,padding:"0 20px"},children:[o.jsx("div",{style:{fontSize:36,marginBottom:16,color:"rgba(124,111,205,0.6)",filter:"drop-shadow(0 0 12px rgba(124,111,205,0.3))"},children:""}),o.jsx("div",{style:{fontSize:13,letterSpacing:"0.18em",textTransform:"uppercase",color:"rgba(255,255,255,0.6)",marginBottom:6},children:"Asimov Theater"}),o.jsx("div",{style:{fontSize:10,color:"rgba(255,255,255,0.3)",marginBottom:24},children:"Acesso restrito. Insira a senha para continuar."}),o.jsxs("form",{onSubmit:i,style:{display:"flex",gap:8},children:[o.jsx("input",{type:"password",value:t,onChange:s=>n(s.target.value),placeholder:"Senha...",autoFocus:!0,style:{flex:1,padding:"8px 12px",borderRadius:6,background:"rgba(255,255,255,0.05)",border:r?"1px solid rgba(255,80,80,0.5)":"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.8)",fontSize:12,outline:"none",fontFamily:"monospace",transition:"border-color 0.2s"}}),o.jsx("button",{type:"submit",style:{padding:"8px 16px",borderRadius:6,cursor:"pointer",background:"rgba(124,111,205,0.15)",border:"1px solid rgba(124,111,205,0.3)",color:"rgba(124,111,205,0.9)",fontSize:11,letterSpacing:"0.08em",textTransform:"uppercase"},children:"Entrar"})]}),r&&o.jsx("div",{style:{marginTop:12,fontSize:10,color:"rgba(255,80,80,0.7)"},children:"Senha incorreta."})]})})}function Nte({onUnlock:e,onClose:t}){const{t:n}=bm(),[r,a]=on.useState(""),[i,s]=on.useState(!1),c=l=>{l.preventDefault(),r.trim().toLowerCase()===Fte?e():(s(!0),setTimeout(()=>s(!1),1200))};return o.jsx("div",{style:{position:"fixed",inset:0,zIndex:60,background:"rgba(0,0,0,0.82)",backdropFilter:"blur(8px)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",fontFamily:"system-ui, sans-serif"},children:o.jsxs("div",{style:{width:"min(420px, 92vw)",background:"rgba(8,6,14,0.98)",border:"1px dashed rgba(245,158,11,0.35)",borderRadius:14,padding:"18px 18px",boxShadow:"0 24px 90px rgba(0,0,0,0.7)"},children:[o.jsx("div",{style:{fontSize:11,letterSpacing:"0.18em",textTransform:"uppercase",color:"rgba(245,158,11,0.9)",marginBottom:8,fontFamily:"monospace"},children:n("adminGate_title")}),o.jsx("div",{style:{fontSize:10,color:"rgba(255,255,255,0.45)",lineHeight:1.6,marginBottom:14},children:n("adminGate_desc")}),o.jsxs("form",{onSubmit:c,style:{display:"flex",gap:8},children:[o.jsx("input",{type:"password",value:r,onChange:l=>a(l.target.value),placeholder:n("adminGate_placeholder"),autoFocus:!0,style:{flex:1,padding:"9px 12px",borderRadius:10,background:"rgba(255,255,255,0.04)",border:i?"1px solid rgba(255,80,80,0.55)":"1px solid rgba(255,255,255,0.12)",color:"rgba(255,255,255,0.82)",fontSize:12,outline:"none",fontFamily:"monospace",transition:"border-color 0.2s"}}),o.jsx("button",{type:"submit",style:{padding:"9px 14px",borderRadius:10,cursor:"pointer",background:"rgba(245,158,11,0.15)",border:"1px dashed rgba(245,158,11,0.35)",color:"rgba(245,158,11,0.92)",fontSize:11,letterSpacing:"0.10em",textTransform:"uppercase",fontFamily:"monospace"},children:n("adminGate_submit")})]}),o.jsx("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:12},children:o.jsx("button",{onClick:t,style:{padding:"7px 10px",borderRadius:10,cursor:"pointer",background:"rgba(255,255,255,0.04)",border:"1px dashed rgba(255,255,255,0.12)",color:"rgba(255,255,255,0.55)",fontSize:10,letterSpacing:"0.10em",textTransform:"uppercase",fontFamily:"monospace"},children:n("adminGate_close")})})]})})}const Ote=()=>{const{t:e}=bm(),t=lS(),n=S.useRef(null),r=S.useRef(null),a=S.useRef(null),i=S.useRef(null),[s,c]=S.useState({width:window.innerWidth,height:window.innerHeight});S.useEffect(()=>{const Y=it=>(it??"").replace(/\s+/g," ").trim(),ze=it=>Y(it).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),Ye=it=>{const Yt=ze(it),Ue=Dt=>Yt.includes(Dt);return Ue("speed")||Ue("veloc")?"controla a escala temporal de atualizao (taxa de variao por tick).":Ue("bpm")?"controla a frequncia temporal musical (batidas por minuto).":Ue("volume")||Ue("master")?"controla ganho/amplitude de sada.":Ue("autonomy")?"aumenta quanto o agente segue objetivo prprio em vez do fluxo local.":Ue("cohes")?"aumenta atrao intra-grupo e compactao de clusters.":Ue("aggress")?"eleva probabilidade de interao hostil com out-group.":Ue("trust")?"eleva abertura para influncia social local.":Ue("need")?"eleva drive de pertencimento e busca por coeso.":Ue("conform")?"puxa estado individual em direo  norma local.":Ue("empathy")?"aumenta contagio afetivo entre vizinhos.":Ue("mobility")?"aumenta chance de troca de grupo (migrao social).":Ue("contagion")?"acelera difuso de memes/ideias.":Ue("hierarchy")?"amplifica peso de status/charisma na influncia.":Ue("innov")?"injeta mutao ideolgica espontnea.":Ue("cooperat")?"aumenta redistribuio de riqueza entre pares.":Ue("inertia")?"resiste mudanas culturais/ideolgicas.":Ue("scarcity")?"modula regenerao de recurso (escassez ecolgica).":Ue("panoptic")?"intensifica efeito de vigilncia em medo/conformidade.":Ue("boids.al")||Ue("alignment")?"alinha vetores de movimento entre vizinhos.":Ue("boids.co")||Ue("cohesion")?"puxa movimento ao centro de massa local.":Ue("wander")?"injeta rudo exploratrio estocstico na navegao.":Ue("impulsert")||Ue("impulse")?"frequncia de kicks de movimento no linear.":Ue("impulsest")?"magnitude dos kicks impulsivos.":Ue("overshoot")?"permite passar do alvo para gerar vai-e-volta.":Ue("zigzag")?"adiciona componente lateral ao steering.":Ue("bondrate")?"taxa de formao de laos/famlias por macroTick.":Ue("birthmem")||Ue("memory")||Ue("memoria")?"peso da memria de origem no vetor de deciso.":Ue("entangle")?"coerncia relacional acumulada por encontros e laos.":Ue("percepc")?"fidelidade do modelo interno ao campo social observado.":Ue("etica")||Ue("ethic")?"auto-limitao cooperativa; freia hybris e agresso.":Ue("compreens")||Ue("understand")?"aprendizado intergrupal por contato no hostil.":Ue("hybris")?"cegueira por poder/status (overconfidence).":Ue("fervor")?"excitao coletiva irracional (sapiensdemens).":Ue("eco saude")||Ue("eco health")?"integridade ambiental do campo de recursos.":Ue("cohesion")?"grau de compactao espacial e social dos grupos.":Ue("polariz")?"distncia ideolgica mdia entre grupos.":Ue("conflict")?"taxa de hostilidade ativa na populao.":Ue("consensus")?"alinhamento ideolgico global do sistema.":Ue("ameaca")||Ue("threat")?"presso por risco/hostilidade na deciso local.":Ue("recurso")||Ue("resource")?"presso de escassez/forrageamento na deciso.":Ue("social")?"presso de pertencimento e acoplamento intra-grupo.":Ue("transgress")?"fora de explorao de tabu/novidade.":Ue("trickster")?"state.archetypeStrength[4]. Peso do TRICKSTER no flowField e em archetypeTransformQuantum (charge, valence, coherence, arousal, inhibition).":Ue("destroyer")?"state.archetypeStrength[11]. Peso do DESTROYER no flowField e em archetypeTransformQuantum.":Ue("wise")&&Ue("one")?"state.archetypeStrength[8]. Peso do WISE_ONE no flowField e em archetypeTransformQuantum.":Ue("persona")?"state.archetypeStrength[1]. Peso do PERSONA no flowField e em archetypeTransformQuantum.":Ue("shadow")?"state.archetypeStrength[2]. Peso do SHADOW no flowField e em archetypeTransformQuantum.":Ue("anima")?"state.archetypeStrength[3]. Peso do ANIMA no flowField e em archetypeTransformQuantum.":Ue("hero")?"state.archetypeStrength[5]. Peso do HERO no flowField e em archetypeTransformQuantum.":Ue("mother")?"state.archetypeStrength[6]. Peso do MOTHER no flowField e em archetypeTransformQuantum.":Ue("father")?"state.archetypeStrength[7]. Peso do FATHER no flowField e em archetypeTransformQuantum.":Ue("child")?"state.archetypeStrength[9]. Peso do CHILD no flowField e em archetypeTransformQuantum.":Ue("lover")?"state.archetypeStrength[10]. Peso do LOVER no flowField e em archetypeTransformQuantum.":Ue("self")?"state.archetypeStrength[0]. Peso do SELF no flowField e em archetypeTransformQuantum (charge, valence, coherence, arousal, inhibition).":null},We=it=>{const Yt=Y(it.getAttribute("aria-label"));if(Yt)return Yt;const Ue=Y(it.id);if(Ue){const Jr=document.querySelector(`label[for="${CSS.escape(Ue)}"]`),zr=Y(Jr==null?void 0:Jr.textContent);if(zr)return zr}const Dt=it.closest("label"),wn=Y(Dt==null?void 0:Dt.textContent);if(wn)return wn;const Wt=it.parentElement,Kn=Wt==null?void 0:Wt.previousElementSibling,ro=Y(Kn==null?void 0:Kn.textContent);if(ro)return ro;const Gn=Y(Wt==null?void 0:Wt.textContent);return Gn?Gn.slice(0,48):"Slider"},jt=it=>{const Yt=We(it),Ue=Ye(Yt)??"parmetro numrico do slider (sem mapeamento semntico em cdigo).",Dt=Y(it.min)||"0",wn=Y(it.max)||"1",Wt=Y(it.step)||"auto",Kn=Y(it.value);return`${Yt}: ${Ue} v=${Kn} (${Dt}..${wn}, step ${Wt})`},Ge=it=>{it.title=jt(it)},at=it=>{const Yt=it.target;if(!Yt)return;if(Yt instanceof HTMLInputElement&&Yt.type==="range"){Ge(Yt);return}let Ue=Yt;for(let Dt=0;Ue&&Dt<4;Dt++,Ue=Ue.parentElement){const wn=Y(Ue.textContent);if(!wn||wn.length>48)continue;const Wt=wn.replace(/[\d.%\-+/()\s]+$/g,"").trim();if(!Wt)continue;const Kn=Ye(Wt);if(Kn){Ue.title=`${Wt}: ${Kn}`;break}}},dt=it=>{const Yt=it.target;Yt&&Yt instanceof HTMLInputElement&&Yt.type==="range"&&Ge(Yt)};return document.querySelectorAll('input[type="range"]').forEach(Ge),document.addEventListener("pointerover",at,!0),document.addEventListener("change",dt,!0),()=>{document.removeEventListener("pointerover",at,!0),document.removeEventListener("change",dt,!0)}},[]);const l=S.useRef(iD()),d=S.useRef(new mu(Date.now())),u=S.useRef(mD(1e3)),h=S.useRef(gD()),m=S.useRef($l(4)),f=S.useRef($l(4)),g=S.useRef(ap(48,27)),x=S.useRef(ND()),v=S.useRef(N2(64)),b=S.useRef({field:RD(VM()),cfg:VM()}),[w,M]=S.useState(!1),k=S.useRef(!1);S.useEffect(()=>{k.current=w},[w]);const[R,j]=S.useState({size:64,diffusion:{nutrient:.15,tension:.12,memory:.1,entropy:.15,sigilBond:.04,sigilRift:.05,sigilBloom:.03,sigilOath:.06},decay:{nutrient:.08,tension:.12,memory:.03,entropy:.1,sigilBond:.9,sigilRift:1.2,sigilBloom:.7,sigilOath:.8},injection:{nutrientFromFood:.35,nutrientFromAgents:0,tensionFromCrowding:.5,memoryFromMotion:.25,entropyFromInstability:.3},clamps:{nutrient:{min:0,max:1},tension:{min:0,max:1},memory:{min:0,max:1},entropy:{min:0,max:1},sigilBond:{min:0,max:1},sigilRift:{min:0,max:1},sigilBloom:{min:0,max:1},sigilOath:{min:0,max:1}},delays:{nutrient:.2,tension:.3,memory:.5,entropy:.25,sigilBond:.15,sigilRift:.12,sigilBloom:.18,sigilOath:.2}}),I=S.useRef(LD()),E=S.useRef(zD()),O=S.useRef(tL()),L=S.useRef(nL()),$=S.useRef(nz()),F=S.useRef(eS()),[B,W]=S.useState(()=>({...eS()})),re=S.useRef(Lk()),oe=S.useRef(EE()),te=S.useRef({observerPresence:0}),[J,pe]=S.useState(0),P=S.useRef(0);S.useEffect(()=>{P.current=J},[J]);const[V,fe]=S.useState(()=>Lk()),ye=S.useRef(Sq()),[Se]=S.useState({baseRate:.002,entropyGain:.01,step:.08}),we=S.useRef(0),ke=S.useRef(0),De=S.useRef({births:0,deaths:0}),_e=S.useRef(Iq()),ae=S.useRef(_q(32,32)),[Re,Fe]=S.useState(Nq()),Oe=S.useRef(Re);S.useEffect(()=>{Oe.current=Re},[Re]);const ne=S.useRef([]),[nt,pt]=S.useState([]),Et=S.useRef([]),_t=S.useRef(0),Ct=S.useRef(0),Xe=S.useRef({}),[Ut,Le]=S.useState(()=>nb(jq)),Ke=S.useRef(Ut);S.useEffect(()=>{Ke.current=Ut},[Ut]);const mt=S.useRef(Tq()),[an,gn]=S.useState(mt.current),Be=S.useRef(FD()),ft=TL(),[Qt,nr]=S.useState({totalBeats:0,totalSpeciations:0,totalInstitutions:0,totalMutations:0,totalMitosis:0,totalMetamorphosis:0,peakParticleCount:0,peakDiversity:0,peakTension:0,peakCohesion:0,simulationStartTime:Date.now()}),_n=S.useRef({stableClusters:0,borderStrength:0,oscillation:0,scarcityCrisis:!1,noveltyBurst:!1,avgTension:0,avgCohesion:0,avgScarcity:0,avgNovelty:0,avgMythic:0}),Rn=S.useRef(null),sn=S.useRef(0),Cn=6,wt=S.useRef(null),st=S.useRef(null),Zt=S.useRef(null),[Pe,ct]=S.useState("2D"),[vt,xe]=S.useState(_u),ge=S.useRef(null),Ee=S.useRef(null),me=S.useRef({mode:"2D",cfg:_u}),je=S.useRef({active:!1,lastX:0,lastY:0,shift:!1}),Te=S.useRef(null),[Ae,Tt]=S.useState("idle"),[xt,en]=S.useState(0),At=S.useRef({zoom:1,panX:0,panY:0}),Ze=S.useRef({active:!1,lastX:0,lastY:0}),yt=S.useRef(new Set),[Mt,bn]=S.useState(1),[Pt,An]=S.useState(!1),[cr,Tn]=S.useState(!1),[Sr,de]=S.useState(!1),[$e,et]=S.useState(!1),[zt,Nt]=S.useState("tension"),[ln,Rt]=S.useState(0),[Nn,It]=S.useState(0),[xn,Ln]=S.useState(!1),[zn,Or]=S.useState(!1),[wr,vn]=S.useState(!1),[Gr,hn]=S.useState("Orbit"),[jr,_r]=S.useState(Date.now()),[Zn,lo]=S.useState(null),[ir,to]=S.useState(3.5),[Er,Eo]=S.useState(.96),[oa,ja]=S.useState(0),[Co,Ya]=S.useState(0),[qo,os]=S.useState("dots"),[Ho,fs]=S.useState(8),[To,Xo]=S.useState(2),[ks,D]=S.useState(null),ee=S.useRef(0),[Ie,Qe]=S.useState(!0),[X,Z]=S.useState(.07),[ce,ue]=S.useState(.1),be=S.useRef(Ie),H=S.useRef(X),le=S.useRef(ce);be.current=Ie,H.current=X,le.current=ce;const[Je,tt]=S.useState(!1),[St,$t]=S.useState(20),[rt,Ft]=S.useState(.1),[Xt,dn]=S.useState(""),kn=S.useRef(FL("poetic")),[ar,jn]=S.useState("poetic"),[yr,Bt]=S.useState([]),qt=S.useRef({name:"Gnese",since:0,reason:"init"}),[mn,dr]=S.useState(!1),[rr,Dr]=S.useState("random"),[ho,Vr]=S.useState(0),[ko,Ea]=S.useState(0),[no,go]=S.useState(0),[qs,Ka]=S.useState(0),Jo=S.useRef({simMs:0,renderMs:0,frames:0}),[La,za]=S.useState("pulse"),Rs=S.useRef(1),[Qo,vo]=S.useState(!1),[va,Js]=S.useState(!1),$i=S.useRef(hD()),[pi,ps]=S.useState("FAST"),[No,mi]=S.useState(80),[Tr,bd]=S.useState(25),[Lc,ll]=S.useState(50),[gi,Wo]=S.useState(.3),[qi,cc]=S.useState(!1),Xa=pq(),{user:Hi,setUser:xd}=vm();S.useEffect(()=>{Hi!=null&&Hi.accessToken?hf(Hi.accessToken):hf(null)},[Hi]);const[Ro,dc]=S.useState(!0),[On,zc]=S.useState("complexityLife"),yi=S.useRef(On),[Bc,vd]=S.useState(!1),[Go,bi]=S.useState(()=>{try{return localStorage.getItem($k)==="1"}catch{return!1}}),[Sd,xi]=S.useState(!1),yn=S.useRef(A4()),[wd,Qs]=S.useState(0),As=S.useRef({cursorX:-1,cursorY:-1}),G=S.useRef({width:0,height:0,valid:!1});S.useEffect(()=>{yi.current=On},[On]),S.useEffect(()=>{if(On!=="metaArtLab")return;const Y=n.current;if(!Y)return;const ze=new Set;typeof Ot.current.id=="number"&&Ot.current.id>=0&&ze.add(Ot.current.id),ze.add(1);for(const Ye of ze)try{Y.hasPointerCapture(Ye)&&Y.releasePointerCapture(Ye)}catch{}Ot.current.down=!1,Ot.current.id=-1},[On]);const he=S.useRef(gte()),ve=S.useRef(mte()),He=S.useRef(yte()),ut=S.useRef(!1),[pn,cn]=S.useState(ve.current),[Jt,Pn]=S.useState(He.current),[Hn,Ir]=S.useState(0),Ur=S.useRef(wee()),qr=S.useRef(Tee()),[tn,Fn]=S.useState(null),[Wn,Yn]=S.useState(Nee),co=S.useRef({hallucination_probability:0,symbolic_overload_index:0,confirmation_bias_score:0}),[Ao,as]=S.useState(co.current),Zo=S.useRef(0),[Io,Zs]=S.useState(null),[ms,Ja]=S.useState(null),Ba=S.useRef(null),Pl=S.useRef(0),[hr,Vo]=S.useState("off"),[$a,aa]=S.useState(null),[fr,Oo]=S.useState([]),qa=S.useRef(!1),[Po,uc]=S.useState("BOND"),[Wi,cl]=S.useState("NO_ENTER"),[Gi,Em]=S.useState("GATHER"),Fl=S.useRef(0),Md=S.useRef(0),vi=S.useRef([]),Cd=S.useRef(0),E0=["complexityLife","metaArtLab","musicLab","rhizomeLab","alchemyLab","treeOfLife","sociogenesis","psycheLab","milPlatos"],kd=["complexityLife","metaArtLab","musicLab","rhizomeLab","alchemyLab","treeOfLife","sociogenesis","psycheLab","milPlatos","languageLab","asimovTheater","physicsSandbox"],_l=S.useCallback(Y=>Go?!0:E0.includes(Y),[Go]),T0=Go?kd:E0,[I0,Rd]=S.useState("radial-gradient(circle, #000000 0%, #000000 100%)"),[Vu,Ad]=S.useState(!1),[Uu,Yu]=S.useState(!1),Ku=fz({setFieldHeatmap:et,setTrails:de,fieldHeatmap:$e,trails:Sr,onSpeedChange:Y=>{l.current.speed=Y,It(ze=>ze+1)},isPaused:()=>Uu,onPauseToggle:()=>Yu(Y=>!Y),onNewUniverse:()=>{q(Date.now())},onApplyRecipe:Y=>{const ze=Yh.find(Ye=>Ye.id===Y);ze&&T(ze,!0)},timeSpeed:l.current.speed,canvasRef:n}),ei=dz(Ku,Y=>On==="complexityLife"?cz(Y,e):lz(Y,e));S.useEffect(()=>{if(Xa.latestAchievement){const Y=Xa.latestAchievement;ft.push({t:l.current.elapsed,type:"achievement",title:`${Y.icon} ${Y.name}`,sigil:Y.icon,detail:Y.description,meta:Y})}},[Xa.latestAchievement]);const ss=S.useRef(300),[Si,wi]=S.useState(300),[ti,js]=S.useState(!0),Ot=S.useRef({down:!1,id:-1,x:0,y:0,prevX:0,prevY:0,cursorX:0,cursorY:0,shift:!1,alt:!1,mode:"PULSE",pointerType:"mouse",moved:!1,downWX:0,downWY:0,downRadiusWorld:0}),jd=S.useRef({points:new Map,active:!1,wasPinching:!1,startDist:0,startZoom:1,startPanX:0,startPanY:0,startMX:0,startMY:0});S.useEffect(()=>(Te.current=new Nf(Tt),()=>{var Y;return(Y=Te.current)==null?void 0:Y.dispose()}),[]),S.useEffect(()=>{if(Ae!=="recording"){en(0);return}const Y=setInterval(()=>{var ze;return en(((ze=Te.current)==null?void 0:ze.elapsed)??0)},500);return()=>clearInterval(Y)},[Ae]),S.useEffect(()=>{const Y=a.current;if(!Y)return;const ze=()=>{const Ue=i.current;if(!Ue)return;const{zoom:Dt,panX:wn,panY:Wt}=At.current;Ue.style.transform=`translate(${wn}px,${Wt}px) scale(${Dt})`,Ue.style.transformOrigin="50% 50%"},Ye=Ue=>{var oo;if(On!=="complexityLife")return;const Dt=Ue.target;if((oo=Dt==null?void 0:Dt.closest)!=null&&oo.call(Dt,"[data-ui-overlay]"))return;Ue.preventDefault();const wn=Y.getBoundingClientRect(),Wt=Ue.clientX-wn.left-wn.width/2,Kn=Ue.clientY-wn.top-wn.height/2,ro=At.current,Gn=Ue.deltaY>0?1/1.12:1.12,Jr=Math.max(.12,Math.min(14,ro.zoom*Gn)),zr=Jr/ro.zoom;At.current={zoom:Jr,panX:Wt+(ro.panX-Wt)*zr,panY:Kn+(ro.panY-Kn)*zr},ze(),bn(Jr),An(Math.abs(At.current.panX)>2||Math.abs(At.current.panY)>2)},We=Ue=>{On==="complexityLife"&&(Ue.button!==1&&Ue.button!==2||(Ze.current={active:!0,lastX:Ue.clientX,lastY:Ue.clientY},Ue.button===1&&Ue.preventDefault()))},jt=Ue=>{if(!Ze.current.active)return;const Dt=Ue.clientX-Ze.current.lastX,wn=Ue.clientY-Ze.current.lastY;Ze.current.lastX=Ue.clientX,Ze.current.lastY=Ue.clientY,At.current={...At.current,panX:At.current.panX+Dt,panY:At.current.panY+wn},ze(),An(!0)},Ge=()=>{Ze.current.active=!1,An(Math.abs(At.current.panX)>2||Math.abs(At.current.panY)>2)},at=Ue=>{var Wt;if(On!=="complexityLife")return;const Dt=(Wt=document.activeElement)==null?void 0:Wt.tagName;if(Dt==="INPUT"||Dt==="TEXTAREA"||Dt==="SELECT")return;const wn=Ue.key;["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(wn)&&(yt.current.add(wn),Ue.preventDefault()),wn==="Home"&&(At.current={zoom:1,panX:0,panY:0},ze(),bn(1),An(!1))},dt=Ue=>{yt.current.delete(Ue.key)},it=Ue=>{On==="complexityLife"&&Ue.preventDefault()},Yt=setInterval(()=>{if(yt.current.size===0)return;const Ue=6/At.current.zoom,{panX:Dt,panY:wn,zoom:Wt}=At.current;let Kn=Dt,ro=wn;yt.current.has("ArrowLeft")&&(Kn+=Ue),yt.current.has("ArrowRight")&&(Kn-=Ue),yt.current.has("ArrowUp")&&(ro+=Ue),yt.current.has("ArrowDown")&&(ro-=Ue),At.current={zoom:Wt,panX:Kn,panY:ro},ze()},16);return Y.addEventListener("wheel",Ye,{passive:!1}),Y.addEventListener("mousedown",We),Y.addEventListener("contextmenu",it),window.addEventListener("mousemove",jt),window.addEventListener("mouseup",Ge),window.addEventListener("keydown",at),window.addEventListener("keyup",dt),()=>{clearInterval(Yt),Y.removeEventListener("wheel",Ye),Y.removeEventListener("mousedown",We),Y.removeEventListener("contextmenu",it),window.removeEventListener("mousemove",jt),window.removeEventListener("mouseup",Ge),window.removeEventListener("keydown",at),window.removeEventListener("keyup",dt)}},[On]),S.useEffect(()=>{const Y=n.current,ze=r.current;if(!Y||!ze)return;wt.current=sL(Y),i2(jr),wt.current||(st.current=Y.getContext("2d")),Zt.current=ze.getContext("2d"),ft.push({t:0,type:"system",title:" MetaLifeLab Started",sigil:"",detail:"System initialized and ready",meta:{version:"1.0"}});const Ye=()=>{if(a.current){const at=a.current.getBoundingClientRect();c({width:at.width,height:at.height})}else c({width:window.innerWidth,height:window.innerHeight});G.current.valid=!1},We=new ResizeObserver(()=>Ye());a.current&&We.observe(a.current);const jt=()=>{document.hidden||(G.current.valid=!1)};document.addEventListener("visibilitychange",jt),Ye();const Ge=at=>{var Yt,Ue;if(at.defaultPrevented)return;const dt=(Yt=document.activeElement)==null?void 0:Yt.tagName,it=(Ue=document.activeElement)==null?void 0:Ue.isContentEditable;if(!(dt==="INPUT"||dt==="TEXTAREA"||dt==="SELECT"||it))if(at.key==="h"||at.key==="H"){if(yi.current==="musicLab")return;Ln(Dt=>!Dt)}else at.key==="Tab"?(at.preventDefault(),Or(Dt=>!Dt)):at.key===" "?(at.preventDefault(),l.current.running=!l.current.running,It(Dt=>Dt+1)):at.key==="1"?(l.current.speed=1,It(Dt=>Dt+1)):at.key==="2"?(l.current.speed=2,It(Dt=>Dt+1)):at.key==="3"?(l.current.speed=3,It(Dt=>Dt+1)):at.key==="4"?(l.current.speed=5,It(Dt=>Dt+1)):(at.key==="s"||at.key==="S")&&Fe(Dt=>Dt.enabled?Dt.showOverlay?(vn(!1),{...Dt,showOverlay:!1}):(vn(!1),{...Dt,enabled:!1,showOverlay:!1}):(vn(!0),{...Dt,enabled:!0,showOverlay:!0}))};return window.addEventListener("resize",Ye),window.addEventListener("keydown",Ge),()=>{We.disconnect(),window.removeEventListener("resize",Ye),window.removeEventListener("keydown",Ge),document.removeEventListener("visibilitychange",jt)}},[]),S.useEffect(()=>{if(Ro)return;const Y=requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(a.current){const ze=a.current.getBoundingClientRect();ze.width>0&&ze.height>0&&c(Ye=>Ye.width===ze.width&&Ye.height===ze.height?Ye:{width:ze.width,height:ze.height})}})});return()=>cancelAnimationFrame(Y)},[Ro]),S.useEffect(()=>{me.current.mode=Pe,me.current.cfg=vt},[Pe,vt]),S.useEffect(()=>{const Y=ge.current;if(!Y)return;Ee.current=new nw(Y);const{width:ze,height:Ye}=s;return Ee.current.resize(ze,Ye),()=>{var We;(We=Ee.current)==null||We.dispose(),Ee.current=null}},[]),S.useEffect(()=>{var Y;(Y=Ee.current)==null||Y.resize(s.width,s.height)},[s]),S.useEffect(()=>{const Y=ge.current;if(!Y)return;const ze=Ge=>{je.current={active:!0,lastX:Ge.clientX,lastY:Ge.clientY,shift:Ge.shiftKey}},Ye=Ge=>{if(!je.current.active)return;const at=Ge.clientX-je.current.lastX,dt=Ge.clientY-je.current.lastY;je.current.lastX=Ge.clientX,je.current.lastY=Ge.clientY;const it=me.current.cfg;je.current.shift||Ge.shiftKey?me.current.cfg={...it,camera:{...it.camera,panX:it.camera.panX+at*.002,panY:it.camera.panY+dt*.002}}:me.current.cfg={...it,camera:{...it.camera,yaw:it.camera.yaw+at*.008,pitch:k0(it.camera.pitch+dt*.008,.04,Math.PI/2-.04)}},xe({...me.current.cfg})},We=()=>{je.current.active=!1},jt=Ge=>{Ge.preventDefault();const at=me.current.cfg;me.current.cfg={...at,camera:{...at.camera,dist:k0(at.camera.dist*(1+Ge.deltaY*.001),.5,8)}},xe({...me.current.cfg})};return Y.addEventListener("mousedown",ze),Y.addEventListener("mousemove",Ye),Y.addEventListener("mouseup",We),Y.addEventListener("mouseleave",We),Y.addEventListener("wheel",jt,{passive:!1}),()=>{Y.removeEventListener("mousedown",ze),Y.removeEventListener("mousemove",Ye),Y.removeEventListener("mouseup",We),Y.removeEventListener("mouseleave",We),Y.removeEventListener("wheel",jt)}},[]),S.useEffect(()=>{vD((Y,ze)=>{const Ye=v.current,We=Ai(Ye,"nutrient",Y,ze),jt=Ai(Ye,"tension",Y,ze),Ge=Ai(Ye,"memory",Y,ze),at=Ai(Ye,"entropy",Y,ze),dt=Ai(Ye,"sigilBond",Y,ze),it=Ai(Ye,"sigilRift",Y,ze),Yt=Ai(Ye,"sigilBloom",Y,ze),Ue=Ai(Ye,"sigilOath",Y,ze),Dt=Math.max(0,Math.min(1,1-We)),wn=Math.max(0,Math.min(1,Ge*.9-at*.7)),Wt=Math.max(0,Math.min(1,jt*.8+at*.8));return{nutrient:We,tension:jt,memory:Ge,entropy:at,scarcity:Dt,cohesion:wn,volatility:Wt,sigilBond:dt,sigilRift:it,sigilBloom:Yt,sigilOath:Ue}}),SD((Y,ze)=>{const Ye=Oe.current;if(!Ye.enabled)return{bond:0,rift:0,bloom:0,oath:0};const We=Tj(ae.current,Y,ze);return{bond:We.bond*Ye.influence,rift:We.rift*Ye.influence,bloom:We.bloom*Ye.influence,oath:We.oath*Ye.influence}}),wD((Y,ze,Ye,We)=>{const jt=Oe.current;jt.enabled&&Oq(ae.current,ze,Ye,Y,We*jt.deposit)})},[]),S.useEffect(()=>{let Y,ze=0,Ye=0;const We=jt=>{var P0,zf,dl,F0,Ju,Bf,Tm,Nl;if(document.hidden){Y=requestAnimationFrame(We);return}if(Ro||On!=="complexityLife"&&On!=="sociogenesis")return;if(!l.current.running){Ed(),Y=requestAnimationFrame(We);return}if(ze++,ze>=240){const bt=l.current.fps,Lt=Date.now();Ye=pD(bt,Lt,Ye,u.current.count,(Sn,lr)=>{u.current.count=Sn,ss.current=Sn,wi(Sn),gr(` Performance: ${Sn} partculas (${lr})`,{duration:3e3,style:{background:"#1a1a2e",color:"#94a3b8",border:"1px solid #334155",fontSize:"11px"}})}),ze=0}l.current.maxStepsPerFrame=$i.current.maxStepsPerFrame;const Ge=Math.max(.5,Number.isFinite(E.current.interval)?E.current.interval:3),{stepCount:at,fieldTick:dt,reconfigTick:it}=cD(l.current,jt,Ge),Yt=performance.now();for(let bt=0;bt<at;bt++){h.current.dt=ud;const Lt=Ke.current;h.current.foodEnabled=Lt.foodEnabled,h.current.foodRatio=Lt.foodRatio,h.current.energyEnabled=Lt.energyEnabled,h.current.energyDecay=Lt.energyDecay,h.current.energyFeedRate=Lt.energyFeedRate,h.current.energyReproThreshold=Lt.energyReproThreshold,h.current.metamorphosisEnabled=Lt.mode==="EVOLUTIVE"||Lt.mode==="FULL",h.current.mutationRate=Lt.mutationRate,h.current.typeStability=Lt.typeStability,E.current.mutationStrength=Lt.reconfigEnabled?Lt.reconfigRate:0,I.current.mutationAmount=Lt.reconfigAmount;const Sn=re.current,lr=Sn.feedback.config.enabled,Mn=lr?Kee(h.current,Sn.feedback.modulation):null,En=performance.now();(zf=(P0=b.current)==null?void 0:P0.cfg)!=null&&zf.enabled?UM(u.current,h.current,m.current,(Un,qn)=>{const fn=jp(g.current,Un,qn);return{tension:fn.tension*x.current.influenceStrength,cohesion:fn.cohesion*x.current.influenceStrength,scarcity:fn.scarcity*x.current.influenceStrength}},d.current,l.current.tick,b.current):zp(u.current,h.current,m.current,(Un,qn)=>{const fn=jp(g.current,Un,qn);return{tension:fn.tension*x.current.influenceStrength,cohesion:fn.cohesion*x.current.influenceStrength,scarcity:fn.scarcity*x.current.influenceStrength}},d.current,l.current.tick),Op(Sn.moduleTelemetry,"particleLife",performance.now()-En),lr&&Mn&&Xee(h.current,Mn)}{const bt=Ke.current,Lt=Be.current;if(Lt.enabled=h.current.energyEnabled,Lt.enabled){Lt.baseDecay=bt.energyDecay,Lt.feedRate=bt.energyFeedRate,Lt.reproductionThreshold=bt.energyReproThreshold,Lt.mutationChance=.02+bt.mutationDial*.18,Lt.deathThreshold=.18+(1-bt.mutationDial)*.12;const Sn=performance.now(),lr=_D(u.current,m.current,Lt,d.current,u.current.maxCount);Op(lensState.moduleTelemetry,"energy",performance.now()-Sn);const Mn=lr.births??0,En=lr.deaths??0;Mn&&(mt.current.births+=Mn,De.current.births+=Mn),En&&(mt.current.deaths+=En,De.current.deaths+=En),rte(oe.current,1e3/60,Mn,En,0)}}const Ue=v.current,Dt=Math.max(1,Math.floor(u.current.count/150));for(let bt=0;bt<u.current.count;bt+=Dt){const Lt=u.current.x[bt],Sn=u.current.y[bt],lr=u.current.vx[bt],Mn=u.current.vy[bt],En=Math.sqrt(lr*lr+Mn*Mn);Tg(Ue,"memory",Lt,Sn,R.injection.memoryFromMotion*En*.08),Tg(Ue,"entropy",Lt,Sn,R.injection.entropyFromInstability*Math.max(0,En-.15)*.08),u.current.type[bt]===fd&&Tg(Ue,"nutrient",Lt,Sn,R.injection.nutrientFromFood*.08)}const wn=at*ud;{const bt=performance.now();hz(Ue,R,wn),Op(re.current.moduleTelemetry,"field",performance.now()-bt)}{const bt=performance.now();Aq(u.current,(Lt,Sn)=>{const lr=v.current,Mn=Ai(lr,"nutrient",Lt,Sn),En=Ai(lr,"tension",Lt,Sn),Un=Ai(lr,"memory",Lt,Sn),qn=Ai(lr,"entropy",Lt,Sn),fn=Math.max(0,Math.min(1,1-Mn)),Qr=Math.max(0,Math.min(1,Un*.9-qn*.7)),Sa=Math.max(0,Math.min(1,En*.8+qn*.8));return{nutrient:Mn,tension:En,memory:Un,entropy:qn,scarcity:fn,cohesion:Qr,volatility:Sa}},wn,Se,d.current),Op(re.current.moduleTelemetry,"genes",performance.now()-bt)}const Wt=l.current.elapsed;if(Wt-we.current>15){we.current=Wt;const bt=Rq(u.current,200);if(bt){const Lt=o8(Ue),Sn={volatility:Lt.volatility,scarcity:Lt.scarcity,cohesion:Lt.cohesion},lr=wq(ye.current,Wt,bt.centroid,Sn);if(lr){const Mn=Fq(lr.notes),En=(d.current.next()-.5)*1.5,Un=(d.current.next()-.5)*1.5;k4(_e.current,En,Un,lr.sigil,Mn,lr.name,6),ft.push({t:Wt,type:"beat",title:`${lr.sigil} Novo Arqutipo: ${lr.name}`,sigil:lr.sigil,detail:`Uma nova espcie emergiu atravs de especiao gentica!

Condies de nascimento: ${lr.notes.join(", ")}
Perfil gentico:
   Gene A (Atrao): ${lr.genes.a.toFixed(2)}
   Gene B (Mobilidade): ${lr.genes.b.toFixed(2)}
   Gene C (Coeso): ${lr.genes.c.toFixed(2)}
   Gene D (Sensibilidade): ${lr.genes.d.toFixed(2)}

Contexto do campo:
   Volatilidade: ${(Sn.volatility*100).toFixed(0)}%
   Escassez: ${(Sn.scarcity*100).toFixed(0)}%
   Coeso: ${(Sn.cohesion*100).toFixed(0)}%`,meta:{archetype:lr,signal:Sn}}),nr(qn=>({...qn,totalSpeciations:qn.totalSpeciations+1}))}}}if(Wt-ke.current>15){ke.current=Wt;const bt=De.current;(bt.births>5||bt.deaths>5)&&ft.push({t:Wt,type:"system",title:"Dinmica Populacional",sigil:bt.births>bt.deaths?"+":"-",detail:`Mudanas na populao nos ltimos 15 segundos:

+ Nascimentos: ${bt.births} novos agentes
- Mortes: ${bt.deaths} agentes eliminados
 Saldo: ${bt.births-bt.deaths>0?"+":""}${bt.births-bt.deaths}

Populao atual: ${u.current.count} agentes`}),De.current.births=0,De.current.deaths=0}if(Oe.current.enabled&&(Dq(ae.current,Oe.current,wn),Wt-Ct.current>3)){Ct.current=Wt;const bt=ae.current,Lt=bt.width*bt.height;let Sn=0,lr=0,Mn=0,En=0,Un=0,qn=0,fn=0,Qr=0;for(let Sa=0;Sa<Lt;Sa++){const sa=bt.bond[Sa],Vi=bt.rift[Sa],Es=bt.bloom[Sa],Ts=bt.oath[Sa];Sn+=sa,lr+=Vi,Mn+=Es,En+=Ts,sa>Un&&(Un=sa),Vi>qn&&(qn=Vi),Es>fn&&(fn=Es),Ts>Qr&&(Qr=Ts)}console.debug("[Sigils]",{avgBond:(Sn/Lt).toFixed(3),avgRift:(lr/Lt).toFixed(3),avgBloom:(Mn/Lt).toFixed(3),avgOath:(En/Lt).toFixed(3),maxBond:Un.toFixed(2),maxRift:qn.toFixed(2),maxBloom:fn.toFixed(2),maxOath:Qr.toFixed(2),archetypes:Et.current.length,influence:Oe.current.influence.toFixed(2),deposit:Oe.current.deposit.toFixed(2)})}if(Oe.current.enabled&&(ne.current=zq(ne.current,u.current,wn,Wt),Wt-_t.current>1.5)){_t.current=Wt;for(const bt of ne.current){const Lt=$q(bt,g.current,ae.current);if(Lt&&!Et.current.find(Sn=>Sn.id===bt.id)){const Sn=qq(bt,Lt,Wt);Et.current=[Sn,...Et.current].slice(0,60),pt([...Et.current]),gh(O.current,{time:Wt,type:"speciation",message:`${Sn.sigil} Archetype emerged: ${Sn.name}`,sigil:Sn.sigil});const lr=Sn.kind==="VINCULO"?"#64c8ff":Sn.kind==="RUPTURA"?"#ff6478":Sn.kind==="FLORESCER"?"#78ff8c":Sn.kind==="JURAMENTO"?"#c8b4ff":"#ffffff";k4(_e.current,Sn.locus.x,Sn.locus.y,Sn.sigil,lr,Sn.name,6),nr(Mn=>({...Mn,totalSpeciations:Mn.totalSpeciations+1}))}}}const Kn=te.current,ro=Ot.current.cursorX>=0&&Ot.current.cursorY>=0,Gn=Ot.current.down?1:k.current&&ro?.45:Math.max(0,Kn.observerPresence*.96);if(Kn.observerPresence=Math.max(Gn,P.current),ute(re.current,u.current,h.current,1/Math.max(1,l.current.fps||60),Kn),F.current=re.current.feedback,ee.current++,ee.current>=20){ee.current=0;const bt=re.current;fe({feedback:bt.feedback,metrics:{...bt.metrics},forces:{...bt.forces},systemPhase:bt.systemPhase,modulation:{...bt.modulation},moduleTelemetry:bt.moduleTelemetry,vitalRates:{...oe.current.lastRates},systemHealth:bt.systemHealth,emergenceIndex:bt.emergenceIndex,morin:{...bt.morin}}),W({config:{...bt.feedback.config},metrics:{...bt.feedback.metrics},activations:{...bt.feedback.activations},modulation:{...bt.feedback.modulation},metricsHistory:bt.feedback.metricsHistory,historyMaxLen:bt.feedback.historyMaxLen,phase:bt.feedback.phase,phaseLabel:bt.feedback.phaseLabel,frameCounter:bt.feedback.frameCounter,runawayCounter:bt.feedback.runawayCounter});const Lt=o8(Ue);D(Lt);const Sn=Fv();if(Sn.R1_MORIN_ENGINE){const qn=Ur.current;Ree(qn,{entropy:((dl=bt.metrics)==null?void 0:dl.atrito)??bt.feedback.metrics.entropyLike,diversity:((F0=bt.metrics)==null?void 0:F0.resiliencia)??bt.feedback.metrics.diversity,stability:1-(bt.feedback.metrics.conflict??0),clustering:bt.feedback.metrics.clustering,scaleHint:"meso"})}if(Sn.R1_OBSERVER){const qn=qr.current;l.current.elapsed;const fn=bt.feedback.metrics.diversity>0?1/Math.max(1,bt.feedback.metrics.diversity*4):.5,Qr=Iee(qn,{entropy:bt.feedback.metrics.entropyLike,clustering:bt.feedback.metrics.clustering,dominance:fn,stabilityDuration:Zo.current});if(Qr.dampenForces!=null&&h.current&&(h.current.force*=Qr.dampenForces,h.current.force=Math.max(.05,h.current.force)),Qr.addNoise!=null&&h.current&&(h.current.entropy=Math.min(.05,(h.current.entropy??0)+Qr.addNoise*.01)),Qr.rebalanceAttraction!=null&&((Ju=m.current)!=null&&Ju.attract)){const Sa=m.current;for(let sa=0;sa<Sa.attract.length;sa++)for(let Vi=0;Vi<(((Bf=Sa.attract[sa])==null?void 0:Bf.length)??0);Vi++)Sa.attract[sa][Vi]!==void 0&&(Sa.attract[sa][Vi]=Math.max(-1,Math.min(1,Sa.attract[sa][Vi]+Qr.rebalanceAttraction)))}Zo.current=bt.feedback.metrics.stagnation>.6?Zo.current+20/60:0}if(Sn.R1_ALCHEMICAL_PHASES){const qn=Fee({entropy:bt.feedback.metrics.entropyLike,coherence:1-bt.feedback.metrics.conflict,clustering:bt.feedback.metrics.clustering,specialization:bt.feedback.metrics.diversity*(1-bt.feedback.metrics.entropyLike),stabilityDuration:Zo.current});Fn(qn)}if(Sn.R1_ANTI_ILLUSION){const qn=((Nl=(Tm=ye.current)==null?void 0:Tm.list)==null?void 0:Nl.length)??0,fn=Oee({activeArchetypeCount:qn,nodeCount:u.current.count,reinforcingLinksRatio:bt.feedback.metrics.clustering,clusterPersistence:bt.feedback.metrics.stagnation,metricStability:1-Math.abs(bt.feedback.metrics.entropyLike-.5)*2});co.current=fn,as(fn)}gn({...mt.current}),mt.current.births=Math.floor(mt.current.births*.6),mt.current.deaths=Math.floor(mt.current.deaths*.6),mt.current.mutations=Math.floor(mt.current.mutations*.6);const lr=l.current.elapsed,Mn=LL(lr,{scarcity:Lt.scarcity,cohesion:Lt.cohesion,volatility:Lt.volatility},qt.current);Mn&&(qt.current=Mn,kn.current.currentArc=Mn.name,ft.push({t:lr,type:"system",title:` ${Mn.name}`,sigil:"",detail:Mn.reason,meta:Mn})),kn.current.tone=ar;const En=NL({t:lr,loops:{scarcity:Lt.scarcity,cohesion:Lt.cohesion,volatility:Lt.volatility,avgNutrient:Lt.avgNutrient,avgTension:Lt.avgTension,avgMemory:Lt.avgMemory,avgEntropy:Lt.avgEntropy},events:ft.events.slice(0,6)},kn.current);En&&(Bt(qn=>[En,...qn].slice(0,120)),ft.push({t:lr,type:"pattern",title:En.title,sigil:"",detail:En.text,meta:{tags:En.tags}}));const Un=Lt.scarcity;for(let qn=0;qn<u.current.count;qn+=Dt*2){const fn=u.current.x[qn],Qr=u.current.y[qn];Tg(Ue,"tension",fn,Qr,R.injection.tensionFromCrowding*Un*.05)}}const zr=performance.now()-Yt;if(dt){DD(u.current,g.current,x.current.depositStrength),OD(g.current,x.current);for(const bt of I.current.artifacts)bt.effect.type==="field"&&bt.effect.fieldMod&&Ep(g.current,bt.x,bt.y,bt.effect.fieldMod.layer,bt.effect.fieldMod.delta)}if(it){const bt=I2(u.current,h.current.typesCount);nr(Lt=>({...Lt,peakParticleCount:Math.max(Lt.peakParticleCount,u.current.count),peakTension:Math.max(Lt.peakTension,_n.current.avgTension),peakCohesion:Math.max(Lt.peakCohesion,_n.current.avgCohesion),peakDiversity:Math.max(Lt.peakDiversity,bt)}))}if(it){_n.current=qD(u.current,g.current),I.current.field=g.current;const bt=HD(u.current,h.current,m.current,I.current,_n.current,E.current.mutationStrength,E.current.speciationRate,E.current.institutionRate,d.current,l.current.elapsed),Lt=ZD(g.current,_n.current,Rn.current);Rn.current=Lt;const Sn=l.current.elapsed,lr=XD(Lt,Sn);if(lr.length>0&&Sn-sn.current>=Cn&&(eL(lr,{micro:u.current,microConfig:h.current,matrix:m.current,field:g.current,reconfig:I.current,reconfigConfig:E.current,rng:d.current,time:Sn}),sn.current=Sn),bt){gh(O.current,bt),nr(En=>({...En,totalBeats:En.totalBeats+1,totalSpeciations:En.totalSpeciations+(bt.type==="speciation"?1:0),totalInstitutions:En.totalInstitutions+(bt.type==="institution"?1:0),totalMutations:En.totalMutations+(bt.type==="mutation"?1:0)}));const Mn=ML(bt,_n.current);ft.push({t:l.current.elapsed,type:"beat",title:Mn.title,sigil:bt.sigil,detail:Mn.description,meta:{beatType:bt.type,typesCount:h.current.typesCount,mood:Mn.mood,significance:Mn.significance}});{const En=l.current.elapsed,Un=`beat:${bt.type}`,qn=bt.type==="institution"?25:bt.type==="speciation"?18:10,fn=Xe.current[Un]??-1e9;En-fn>=qn&&(Xe.current[Un]=En,gr.success(Mn.title,{description:Mn.description,duration:3500}))}Cg(L.current,h.current,m.current,f.current,I.current,l.current.elapsed),It(En=>En+1)}if(Zn&&Zn.mitosisRate>.01&&u.current.count<1200){const Mn=QL(Zn.mitosisRate),En=ez(u.current,m.current,Mn,d.current);if(En.success&&En.message){nr(qn=>({...qn,totalMitosis:qn.totalMitosis+1}));const Un=kL(En.parentSize||50,En.childrenCount||2,l.current.elapsed);ft.push({t:l.current.elapsed,type:"mitosis",title:Un.title,sigil:"",detail:Un.description,meta:{childrenCreated:En.childrenCount||0,particleCount:u.current.count,mood:Un.mood,significance:Un.significance}});{const qn=l.current.elapsed,fn="mitosis",Qr=Xe.current[fn]??-1e9;qn-Qr>=12&&(Xe.current[fn]=qn,gr.success(Un.title,{description:Un.description,duration:3500}))}}}}Je&&xL(u.current,St),Pq(_e.current,l.current.elapsed);let oo=!1;if(On==="sociogenesis"&&vi.current.length>0){for(const bt of vi.current)bt.particleIndex<u.current.count&&(bt.x=u.current.x[bt.particleIndex],bt.y=u.current.y[bt.particleIndex]);DH(u.current,vi.current,yn.current.config.influenceGain*yn.current.config.simSpeed)}if(On==="sociogenesis"&&uH(yn.current,l.current.elapsed)){yn.current.lastTickTime=l.current.elapsed,!qa.current&&u.current.count>0&&(qa.current=!0,Gq(u.current,yn.current.culture,yn.current.cultureConfig.memeCount));const bt=cH(yn.current,u.current,l.current.elapsed);if(bt.length>0){for(const Lt of bt){yn.current.chronicle.unshift(Lt),gh(O.current,{time:l.current.elapsed,type:"institution",message:`${Lt.icon} ${Lt.message}`,sigil:Lt.icon});const Sn=Lt.cause.includes("crossed")?"#ef4444":Lt.cause.includes("Case")?"#fbbf24":"#94a3b8";Wl(l.current.elapsed,`${Lt.icon} ${Lt.message}`,Sn)}oo=!0}if(qa.current&&yn.current.cultureConfig.enabled){const Lt=l.current.elapsed,Sn=yn.current.config.cadenceSec/yn.current.config.simSpeed,lr=Vq(Lt,u.current,yn.current.culture,yn.current.cultureConfig,d.current,(fn,Qr)=>({a:Ai(v.current,"memory",fn,Qr),s:Ai(v.current,"tension",fn,Qr)}));for(const fn of lr){const Qr=fn.type==="CONVERSION_WAVE"?"->":fn.type==="CULT_DOMINANCE"?"*":"x",Sa=fn.type==="CULT_DOMINANCE"?"#ffd166":fn.type==="SCHISM_WARNING"?"#ef476f":"#06d6a0";if(fn.type!=="CULT_DOMINANCE"||yn.current.chronicle.length===0||!yn.current.chronicle[0].message.includes("DOMINANCE")){const sa={time:Lt,icon:Qr,message:`${fn.type.replace(/_/g," ")}: ${fn.evidence}`,cause:fn.evidence,consequence:fn.type==="CULT_DOMINANCE"?"Cultural homogenization":"Cultural flux"};yn.current.chronicle.unshift(sa),Wl(Lt,`${Qr} ${fn.evidence}`,Sa)}(fn.wx!==0||fn.wy!==0)&&qd(fn.wx,fn.wy,fn.type==="CULT_DOMINANCE"?"*":"->",Sa,Lt,5)}const Mn=Xq(Sn,u.current,yn.current.culture,yn.current,Lt);for(const fn of Mn){const Qr="#c084fc";yn.current.chronicle.find(sa=>sa.icon===""&&Lt-sa.time<15)||(yn.current.chronicle.unshift({time:Lt,icon:"",message:`LEADER EMERGES: ${fn.evidence}`,cause:fn.evidence,consequence:"Accelerates meme spread in local area"}),Wl(Lt,` LEADER: ${fn.evidence}`,Qr),qd(fn.wx,fn.wy,"LEADER",Qr,Lt,6))}const En=Ij(u.current,yn.current.culture,yn.current.cultureConfig.memeCount);aa(En);const Un=Jq(u.current,yn.current.culture,5);Oo(Un),oo=!0;const qn=80;yn.current.chronicle.length>qn&&(yn.current.chronicle.length=qn)}if(l.current.elapsed-Fl.current>10&&(Fl.current=l.current.elapsed,SH(yn.current,u.current,l.current.elapsed),oo=!0),l.current.elapsed-Cd.current>8&&(Cd.current=l.current.elapsed,vi.current=OH(u.current,yn.current,l.current.elapsed)),yn.current.tribes.length>0&&NH(m.current,yn.current),hr!=="off"&&_H(m.current,hr,yn.current),yn.current.config.autoEmergence&&FH(Md.current,l.current.elapsed)){Md.current=l.current.elapsed;const Lt=yn.current.totems.length,Sn=yn.current.taboos.length,lr=yn.current.rituals.length;AH(yn.current,u.current,l.current.elapsed);const Mn=l.current.elapsed;for(let En=Lt;En<yn.current.totems.length;En++){const Un=yn.current.totems[En],qn=Un.kind==="BOND"?"#5ac8fa":Un.kind==="RIFT"?"#ff6b6b":Un.kind==="ORACLE"?"#c084fc":"#94a3b8";qd(Un.pos.x,Un.pos.y,`${Un.kind} totem`,qn,Mn),Wl(Mn,`Totem emerged: ${Un.name} (${Un.kind})`,qn)}for(let En=Sn;En<yn.current.taboos.length;En++){const Un=yn.current.taboos[En],qn=Un.kind==="NO_ENTER"?"#ef4444":"#f97316";qd(Un.pos.x,Un.pos.y,`${Un.kind.replace("_"," ")} zone`,qn,Mn),Wl(Mn,`Taboo emerged: ${Un.kind.replace("_"," ")} boundary`,qn)}for(let En=lr;En<yn.current.rituals.length;En++){const Un=yn.current.rituals[En],qn=yn.current.totems.find(fn=>fn.id===Un.totemId);qn&&(qd(qn.pos.x,qn.pos.y,`${Un.kind} ritual`,"#34d399",Mn),Wl(Mn,`Ritual emerged: ${Un.kind} at ${qn.name}`,"#34d399"))}oo=!0}}if(On==="sociogenesis"){const bt=l.current.elapsed-Pl.current;if(bt>=2){const Lt=l.current.elapsed,Sn=yn.current.rituals.find(fn=>(Lt-fn.bornAt)%fn.periodSec/fn.periodSec<fn.dutyCycle),lr=!!Sn,Mn=Sn?yn.current.totems.find(fn=>fn.id===Sn.totemId):void 0,En=Mn?Mn.pos:void 0,Un=Ete(u.current,h.current.typesCount,lr,En);Ba.current=Un;const qn=Pte(Un,l.current.elapsed);for(const fn of qn){yn.current.chronicle.unshift({time:fn.time,icon:fn.icon,message:fn.title,cause:fn.detail,consequence:`Phase: ${Un.phase}`});const Qr=fn.kind==="PHASE_SHIFT"?"#a78bfa":fn.kind==="VOLATILITY_SPIKE"?"#fbbf24":fn.kind==="COHESION_SPIKE"?"#34d399":fn.kind==="BORDER_FORMED"?"#f97316":"#94a3b8";Wl(fn.time,`${fn.icon} ${fn.title}`,Qr)}if(Pl.current=l.current.elapsed,oo=!0,ve.current.enabled){const fn=bt;ut.current||(ut.current=!0,xte(he.current,ve.current,d.current)),vte(he.current,ve.current,g.current,fn),wte(he.current,ve.current,u.current,g.current,fn),Rte(he.current,ve.current,u.current,yn.current.culture,fn);const{metrics:Qr,events:Sa}=Ate(he.current,ve.current,u.current,He.current);He.current=Qr;for(const sa of Sa)yn.current.chronicle.unshift({time:Lt,icon:sa.icon,message:sa.message,cause:"Economy engine",consequence:""}),Wl(Lt,`${sa.icon} ${sa.message}`,sa.color);Pn({...Qr}),oo=!0}}}if(On==="sociogenesis"&&ve.current.enabled&&yn.current.rituals.length>0){const bt=yn.current.config.cadenceSec/yn.current.config.simSpeed;kte(he.current,ve.current,yn.current,u.current,bt)}if(oo&&Qs(bt=>bt+1),BD(I.current,ud),l.current.tick%600===0){const bt=new Map;for(let Mn=0;Mn<u.current.count;Mn++){const En=u.current.archetypeId[Mn];bt.set(En,(bt.get(En)||0)+1)}const Lt=Array.from(bt.entries()).map(([Mn,En])=>{const Un=ye.current.list.find(qn=>qn.id===Mn);return{id:(Un==null?void 0:Un.sigil)||"?",age:l.current.elapsed-((Un==null?void 0:Un.bornAt)||0),stability:.5,particleCount:En}}),Sn=CL(_n.current,u.current.count,l.current.elapsed);if(l.current.tick%3600===0&&l.current.elapsed>10){const Mn=RL(Sn);dn(Mn),ft.push({t:l.current.elapsed,type:"system",title:" Estado do Universo",sigil:"",detail:Mn,meta:{stability:Sn.score.toFixed(2),entropy:Sn.entropy.toFixed(2),complexity:Sn.complexity.toFixed(2),resilience:Sn.resilience.toFixed(2)}})}const lr=ft.events.slice(-10).map(Mn=>Mn.title);Xa.checkAchievements({currentTime:l.current.elapsed,particleCount:u.current.count,typesCount:h.current.typesCount,organisms:Lt,stabilityScore:Sn.score,entropyLevel:Sn.entropy,recentEvents:lr,configSummary:Zn?Eg(Zn):"N/A",borderStrength:_n.current.borderStrength,stableClusters:_n.current.stableClusters,oscillation:_n.current.oscillation,diversityIndex:I2(u.current,h.current.typesCount),avgTension:_n.current.avgTension,avgCohesion:_n.current.avgCohesion,totalBeats:Qt.totalBeats,totalSpeciations:Qt.totalSpeciations,totalMutations:Qt.totalMutations,totalMitosis:Qt.totalMitosis,peakParticleCount:Qt.peakParticleCount})}if(ti&&l.current.tick%30===0){const bt=u.current.count,Lt=ss.current;if(bt<Lt){const Sn=Math.min(10,Lt-bt);for(let lr=0;lr<Sn;lr++){let Mn;if(h.current.foodEnabled){const En=Math.floor(Lt*h.current.foodRatio);Array.from(u.current.type.slice(0,bt)).filter(qn=>qn===255).length<En&&d.current.next()<.5?Mn=255:Mn=d.current.int(0,h.current.typesCount-1)}else Mn=d.current.int(0,h.current.typesCount-1);HM(u.current,d.current.next()*2-1,d.current.next()*2-1,Mn,d.current)}}else if(bt>Lt){const Sn=Math.min(10,bt-Lt);u.current.count-=Sn}}const Uo=performance.now();Ed(),me.current.mode==="3D"&&On!=="psycheLab"&&Xu();const Hs=performance.now()-Uo,Lf=_R();Jo.current.simMs+=zr,Jo.current.renderMs+=Hs,Jo.current.frames+=1,Jo.current.frames>=60&&(Vr(Jo.current.simMs/Jo.current.frames),Ea(Jo.current.renderMs/Jo.current.frames),go(Lf.neighborsChecked),Ka(Lf.interactionsApplied),Jo.current.simMs=0,Jo.current.renderMs=0,Jo.current.frames=0),Y=requestAnimationFrame(We)};return Y=requestAnimationFrame(We),()=>{cancelAnimationFrame(Y)}},[Sr,$e,zt,s,ir,Er,oa,Co,qo,Ho,Zn,To,pi,rr,Ie,Je,On,hr,Ro]);const Xu=S.useCallback(()=>{const Y=Ee.current;if(!(Y!=null&&Y.isReady))return;const{mode:ze,cfg:Ye}=me.current;if(ze!=="3D"||On==="psycheLab")return;const We=u.current,jt=[],Ge=h.current.typesCount,at=On==="sociogenesis"?yn.current:null;for(let dt=0;dt<We.count;dt++){const it=eV(We.vx[dt],We.vy[dt],We.energy[dt],We.geneA[dt],We.age[dt],Ye.zVar);let[Yt,Ue,Dt]=ZG(We.type[dt],Ge);if(at&&On==="sociogenesis"){const wn=at.culture.memeId[dt]??0,Wt=Ni[wn%Ni.length]??"#aaa";Yt=parseInt(Wt.slice(1,3),16)/255,Ue=parseInt(Wt.slice(3,5),16)/255,Dt=parseInt(Wt.slice(5,7),16)/255,Ye.zVar==="prestige"?jt.push({nx:We.x[dt],ny:We.y[dt],z:k0(at.culture.prestige[dt],0,1),r:Yt,g:Ue,b:Dt}):jt.push({nx:We.x[dt],ny:We.y[dt],z:it,r:Yt,g:Ue,b:Dt});continue}jt.push({nx:We.x[dt],ny:We.y[dt],z:it,r:Yt,g:Ue,b:Dt})}Y.render(jt,Ye)},[On]),Ed=S.useCallback(()=>{var Ye,We,jt;const Y=n.current,ze=r.current;if(!(!Y||!ze)){if(wt.current)lL(wt.current,{pointSize:ir,fade:Er,glow:oa,paletteIndex:Co}),dL(wt.current,u.current,h.current.typesCount,s.width,s.height);else if(st.current){const Ge=Sr&&!Ie&&!Je;hL(st.current,u.current,s.width,s.height,Ge,qo,Ho,$i.current.renderQuality,To)}if(Zt.current||(Zt.current=ze.getContext("2d")),Zt.current){const Ge=Zt.current,at=Math.min(window.devicePixelRatio||1,1.5),dt=s.width,it=s.height,Yt=Math.floor(dt*at),Ue=Math.floor(it*at);if((ze.width!==Yt||ze.height!==Ue)&&(ze.width=Yt,ze.height=Ue,Ge.setTransform(at,0,0,at,0,0)),Ge.clearRect(0,0,dt,it),$e){const Wt={tension:"tension",cohesion:"memory",scarcity:"nutrient",novelty:"entropy",mythic:"sigilBond"}[zt]??"tension";pL(Ge,v.current,Wt,dt,it,1.2)}if(mL(Ge,I.current.artifacts,dt,it),be.current){const wn={maxDistance:H.current,opacity:le.current,thickness:1.5};vL(Ge,u.current,wn,Co,dt,it)}if(Je){const wn={opacity:rt};SL(Ge,u.current,wn,Co)}if(Oe.current.enabled&&Oe.current.showOverlay&&bL(Ge,_e.current.pings,dt,it),Oe.current.enabled&&Oe.current.showOverlay&&wL(Ge,ae.current,Oe.current,dt,it),On==="sociogenesis"){if(fH(Ge,yn.current,dt,it,l.current.elapsed,u.current,hr),w&&((We=(Ye=b.current)==null?void 0:Ye.cfg)!=null&&We.enabled)&&((jt=b.current)!=null&&jt.field)&&zR(Ge,b.current.field,dt,it),hr==="economy"&&ve.current.enabled&&wH(Ge,he.current,He.current,dt,it),hr==="territory"&&ve.current.enabled&&MH(Ge,he.current,dt,it),vi.current.length>0&&hr!=="culture"){const wn=kl[Co%kl.length]||kl[0];LH(Ge,vi.current,dt,it,wn)}As.current.cursorX>=0&&As.current.cursorY>=0&&vH(Ge,yn.current.tool,As.current.cursorX,As.current.cursorY,dt,it,yn.current.tool==="TOTEM"?Po:yn.current.tool==="TABOO"?Wi:yn.current.tool==="RITUAL"?Gi:void 0)}if(Ot.current.cursorX>0&&Ot.current.cursorY>0&&(qi||Ot.current.down)&&gL(Ge,Ot.current.cursorX,Ot.current.cursorY,No,Ot.current.mode),xn){const wn=O.current.beats[O.current.beats.length-1];yL(Ge,u.current.count,h.current.typesCount,wn?wn.message.substring(0,20):"None",dt,it)}}}},[Sr,$e,zt,s,No,xn,ir,Er,oa,Co,qo,Ho,To,Ie,X,ce,Je,St,rt,wr,On,Po,Wi,Gi,qi,hr,w]),So=()=>{nr({totalBeats:0,totalSpeciations:0,totalInstitutions:0,totalMutations:0,totalMitosis:0,totalMetamorphosis:0,peakParticleCount:0,peakDiversity:0,peakTension:0,peakCohesion:0,simulationStartTime:Date.now()})},$c=Y=>{const ze=PD[Y];So(),On==="sociogenesis"&&(yn.current=A4(),Qs(Ye=>Ye+1)),ze.showSigils&&(Fe(Ye=>({...Ye,enabled:!0,showOverlay:!0})),vn(!0)),ft.push({t:l.current.elapsed,type:"system",title:`Preset Loaded: ${ze.name}`,sigil:"",detail:`${ze.typesCount} types, ${ze.particleCount} particles`,meta:{preset:ze.name}}),h.current.typesCount=ze.typesCount,Object.assign(h.current,ze.config),m.current=$l(ze.typesCount),ze.matrixInit(m.current),f.current=$l(ze.typesCount),di(m.current,f.current),h.current.circularDependency>0&&ql(m.current,h.current.circularDependency),hn(ze.name),u.current.count=0,t8(),y2(u.current,ze.particleCount,d.current,ze.typesCount,Ke.current.foodEnabled,Ke.current.foodRatio);for(let Ye=0;Ye<u.current.count;Ye++){const We=d.current.next()*Math.PI*2,jt=d.current.next()*.008;u.current.vx[Ye]=Math.cos(We)*jt,u.current.vy[Ye]=Math.sin(We)*jt}ss.current=ze.particleCount,wi(ze.particleCount),g.current=ap(48,27),v.current=N2(64),O.current.beats=[],I.current.artifacts=[],L.current.snapshots=[],Cg(L.current,h.current,m.current,f.current,I.current,l.current.elapsed),l.current.running=!0,It(Ye=>Ye+1),gr.success(`${ze.name} | ${ze.typesCount} types | ${ze.particleCount} particles`)},qc=Y=>{Le(ze=>nb({...ze,...Y}))},hc=Y=>{const ze=Yh.find(Ye=>Ye.id===Y);ze?T(ze,!1):gr.error(`Preset ${Y} not found`)},T=(Y,ze=!1)=>{So(),ft.push({t:l.current.elapsed,type:"system",title:`Creative Preset: ${Y.name}`,sigil:"",detail:Y.description,meta:{preset:Y.name,seed:Y.seed}}),d.current=new mu(Y.seed),_r(Y.seed),i2(Y.seed),h.current.typesCount=Y.typesCount,Object.assign(h.current,Y.micro),Object.assign(x.current,Y.field),Object.assign(E.current,Y.reconfig),Y.matrix?m.current=YF(Y.matrix.style,Y.typesCount,d.current,h.current.rmax):(m.current=$l(Y.typesCount),x2(m.current,d.current,h.current.rmax)),f.current=$l(Y.typesCount),di(m.current,f.current),h.current.circularDependency&&h.current.circularDependency>0&&ql(m.current,h.current.circularDependency),hn(Y.name),(Y.id.includes("sigil")||Y.id.includes("archetype"))&&(Fe(We=>({...We,enabled:!0,showOverlay:!0})),vn(!0),gr.info("Sigil Overlay Ativado",{description:"Observe os smbolos emergentes aparecerem nos campos!",duration:4e3})),ze&&(localStorage.getItem("guide_completed")||(Tn(!0),setTimeout(()=>Tn(!1),1e4))),u.current.count=0,t8();const Ye=Math.min(Y.particleCount,800);y2(u.current,Ye,d.current,Y.typesCount,Ke.current.foodEnabled,Ke.current.foodRatio),ss.current=Ye,wi(Ye);for(let We=0;We<u.current.count;We++){const jt=d.current.next()*Math.PI*2,Ge=d.current.next()*.01;u.current.vx[We]=Math.cos(jt)*Ge,u.current.vy[We]=Math.sin(jt)*Ge,h.current.energyEnabled&&(u.current.energy[We]=1.2)}g.current=ap(48,27),v.current=N2(64),O.current.beats=[],I.current.artifacts=[],L.current.snapshots=[],Cg(L.current,h.current,m.current,f.current,I.current,l.current.elapsed),l.current.running=!0,It(We=>We+1),uq(),gr.success(Y.name,{description:Y.description})},q=Y=>{_r(Y),d.current=new mu(Y),i2(Y),gr.info(`Seed updated: ${Y}`)},U=Y=>{fD($i.current,Y),ps(Y),gr.info(`Quality: ${Y}`,{description:`Max steps: ${$i.current.maxStepsPerFrame}`,duration:2e3}),It(ze=>ze+1)},Me=Y=>{Dr(Y);const ze=zL.find(Ye=>Ye.id===Y);if(ze){const Ye=u.current.count,{positions:We,types:jt}=BL(ze,Ye,h.current.typesCount,2,2);u.current.count=Ye;for(let Ge=0;Ge<Ye;Ge++)u.current.x[Ge]=We[Ge*2]-1,u.current.y[Ge]=We[Ge*2+1]-1,u.current.type[Ge]=jt[Ge],u.current.vx[Ge]=0,u.current.vy[Ge]=0,u.current.energy[Ge]=1;It(Ge=>Ge+1),gr.info(ze.name,{description:ze.description,duration:3e3})}else{const Ye=u.current.count;u.current.count=0,WM(u.current,Ye,Y,d.current,h.current.typesCount,Ke.current.foodEnabled,Ke.current.foodRatio);for(let We=0;We<u.current.count;We++)u.current.vx[We]=0,u.current.vy[We]=0,u.current.energy[We]=1;It(We=>We+1),gr.info(`Spawn: ${Y}`,{description:"Particles repositioned",duration:2e3})}},Ve=(Y,ze)=>{So(),ft.push({t:l.current.elapsed,type:"system",title:"New DNA Applied",sigil:"",detail:`${Y.speciesCount} species, ${Y.matrixMode} matrix`,meta:{seed:ze,matrixMode:Y.matrixMode}}),d.current=new mu(ze),_r(ze),lo(Y),_L(kn.current,ze),qt.current={name:"Gnese",since:0,reason:"init"},Bt([]);const Ye=1200;let We=Y.speciesCount*Y.particlesPerSpecies;console.log(` DNA: ${Y.speciesCount} species  ${Y.particlesPerSpecies} = ${We} particles`),We>Ye&&(console.warn(` ULTRA CAP: ${We}  ${Ye} particles`),We=Ye),h.current.typesCount=Y.speciesCount,h.current.beta=Y.beta,h.current.coreRepel=Y.coreRepel,h.current.rmax=Y.rmax,h.current.force=Y.forceGain,h.current.drag=Y.drag,h.current.speedClamp=Y.speedClamp,h.current.useDrag=!0,h.current.kernelMode="classic",m.current=$L(Y.speciesCount,Y.matrixMode,Y.matrixSparsity,Y.radiusSpread,d.current),f.current=$l(Y.speciesCount),di(m.current,f.current),os(Y.renderMode),Eo(Y.trailsFade),Ya(Y.paletteId),Dr(Y.spawnPattern),u.current.count=0,WM(u.current,We,Y.spawnPattern,d.current,Y.speciesCount,Ke.current.foodEnabled,Ke.current.foodRatio);for(let jt=0;jt<u.current.count;jt++){const Ge=d.current.next()*Math.PI*2,at=d.current.next()*.01;u.current.vx[jt]=Math.cos(Ge)*at,u.current.vy[jt]=Math.sin(Ge)*at,u.current.energy[jt]=1}ss.current=We,wi(We),g.current=ap(48,27),O.current.beats=[],I.current.artifacts=[],L.current.snapshots=[],h.current.energyEnabled=Y.energyEnabled,Y.metamorphosisEnabled!==void 0&&(h.current.metamorphosisEnabled=Y.metamorphosisEnabled),Y.mutationRate!==void 0&&(h.current.mutationRate=Y.mutationRate),Y.typeStability!==void 0&&(h.current.typeStability=Y.typeStability),l.current.tick=0,l.current.elapsed=0,l.current.running=!0,It(jt=>jt+1),gr.success("DNA Applied",{description:Eg(Y),duration:4e3})},ht=Y=>{const ze=Date.now(),Ye=XL(Y,ze);Ve(Ye,ze),hn(Y.charAt(0).toUpperCase()+Y.slice(1)),Y==="darwin"&&setTimeout(()=>{gr.success("Evoluo Ativa",{description:"Observe partculas mudando de cor (tipo), crescendo com energia e pulsando ao evoluir.",duration:7e3})},1500)},kt=()=>{const Y=Date.now();let ze=av(Y);ze=JL(ze,d.current),Ve(ze,Y),hn("Chaos"),gr("CHAOS SEED",{description:"Extreme randomization applied",duration:3e3})},Ht=()=>{const Y=Date.now(),ze=av(Y);Ve(ze,Y),hn("New Universe"),ft.push({t:0,type:"system",title:" Sistema de Arqutipos Ativo",sigil:"",detail:`O MetaLifeLab agora observa a evoluo gentica dos agentes!

 Como funciona:
 Cada partcula possui 4 genes (A, B, C, D) que influenciam seu comportamento
 Os genes mutam gradualmente atravs de campos de entropia
 Quando genes divergem o suficiente, uma nova ESPCIE emerge (arqutipo)
 Cada arqutipo recebe um nome, sigil nico e perfil gentico

 Especiao acontece a cada ~10 segundos se as condies forem adequadas.
Aguarde... novas espcies podem surgir a qualquer momento!`})},$n=()=>{const Y=Date.now();d.current=new mu(Y),_r(Y);const ze=d.current.int(0,5),Ye=d.current.int(3,7),We=d.current.int(1500,3e3);if(h.current.typesCount=Ye,h.current.rmax=.1+d.current.next()*.08,h.current.force=.9+d.current.next()*.6,h.current.friction=.9+d.current.next()*.06,h.current.speedClamp=.08+d.current.next()*.08,h.current.entropy=d.current.next()*.001,m.current=$l(Ye),ze===0){for(let Ge=0;Ge<Ye;Ge++)for(let at=0;at<Ye;at++){const dt=(at-Ge+Ye)%Ye;dt===0?m.current.attract[Ge][at]=.2+d.current.next()*.3:dt===1?m.current.attract[Ge][at]=.5+d.current.next()*.4:dt===Ye-1?m.current.attract[Ge][at]=-.5-d.current.next()*.3:m.current.attract[Ge][at]=-.2+d.current.next()*.3,m.current.radius[Ge][at]=h.current.rmax*(.7+d.current.next()*.4),m.current.falloff[Ge][at]=1+d.current.next()*.5}hn("Orbital"),gr.info("Orbital regime",{description:"Cyclic attraction patterns"})}else if(ze===1){for(let Ge=0;Ge<Ye;Ge++)for(let at=0;at<Ye;at++)Ge===at?m.current.attract[Ge][at]=.4+d.current.next()*.3:m.current.attract[Ge][at]=-.3-d.current.next()*.4,m.current.radius[Ge][at]=h.current.rmax*(.6+d.current.next()*.5),m.current.falloff[Ge][at]=.9+d.current.next()*.6;hn("Clustering"),gr.info("Clustering regime",{description:"Tribal segregation"})}else if(ze===2){for(let Ge=0;Ge<Ye;Ge++){const at=(Ge+1)%Ye;for(let dt=0;dt<Ye;dt++)dt===at||dt===Ge?m.current.attract[Ge][dt]=.6+d.current.next()*.3:m.current.attract[Ge][dt]=-.2-d.current.next()*.3,m.current.radius[Ge][dt]=h.current.rmax*(.7+d.current.next()*.4),m.current.falloff[Ge][dt]=1.2+d.current.next()*.4}v2(m.current),hn("Symbiotic"),gr.info("Symbiotic regime",{description:"Paired dependencies"})}else if(ze===3){x2(m.current,d.current,h.current.rmax),v2(m.current);for(let Ge=0;Ge<Ye;Ge++)for(let at=0;at<Ye;at++)m.current.attract[Ge][at]*=.7;hn("Wave"),gr.info("Wave regime",{description:"Symmetric oscillations"})}else if(ze===4){const Ge=d.current.int(0,Ye-1);for(let at=0;at<Ye;at++)for(let dt=0;dt<Ye;dt++)dt===Ge?m.current.attract[at][dt]=.5+d.current.next()*.4:at===Ge?m.current.attract[at][dt]=-.3+d.current.next()*.2:at===dt?m.current.attract[at][dt]=.3+d.current.next()*.2:m.current.attract[at][dt]=-.4-d.current.next()*.3,m.current.radius[at][dt]=h.current.rmax*(.6+d.current.next()*.5),m.current.falloff[at][dt]=1.1+d.current.next()*.5;hn("Hierarchy"),gr.info("Hierarchy regime",{description:"Dominant center structure"})}else{const Ge=Math.max(2,Math.floor(Ye/2));for(let at=0;at<Ye;at++){const dt=Math.floor(at/Ge);for(let it=0;it<Ye;it++){const Yt=Math.floor(it/Ge);at===it?m.current.attract[at][it]=.4+d.current.next()*.2:dt===Yt?m.current.attract[at][it]=.2+d.current.next()*.3:m.current.attract[at][it]=-.4-d.current.next()*.3,m.current.radius[at][it]=h.current.rmax*(.7+d.current.next()*.4),m.current.falloff[at][it]=1+d.current.next()*.6}}hn("Fractal"),gr.info("Fractal regime",{description:"Nested communities"})}f.current=$l(Ye),di(m.current,f.current),h.current.circularDependency>0&&ql(m.current,h.current.circularDependency),u.current.count=0;const jt=Math.min(800,We);y2(u.current,jt,d.current,Ye,Ke.current.foodEnabled,Ke.current.foodRatio);for(let Ge=0;Ge<u.current.count;Ge++){const at=d.current.next()*Math.PI*2,dt=d.current.next()*.01;u.current.vx[Ge]=Math.cos(at)*dt,u.current.vy[Ge]=Math.sin(at)*dt}ss.current=We,wi(We),x.current.diffusion=.12+d.current.next()*.08,x.current.decay=.025+d.current.next()*.02,x.current.influenceStrength=.5+d.current.next()*.8,E.current.mutationStrength=.05+d.current.next()*.15,E.current.speciationRate=.3+d.current.next()*.4,E.current.institutionRate=.15+d.current.next()*.35,g.current=ap(48,27),O.current.beats=[],I.current.artifacts=[],L.current.snapshots=[],Cg(L.current,h.current,m.current,f.current,I.current,l.current.elapsed),l.current.running=!0,It(Ge=>Ge+1)},In=Y=>l_(u.current,h.current,m.current,f.current,g.current,x.current,I.current,E.current,O.current,Y),er=Y=>{c_(Y,u.current,h.current,m.current,f.current,g.current,x.current,I.current,E.current,O.current),It(ze=>ze+1),gr.success(`Loaded: ${Y.name}`)},pr=Y=>{const ze=$.current.organisms.find(We=>We.id===Y);if(!ze)return;const Ye=oz(ze,u.current,0,0,1);Ye>0?gr.success(`Summoned: ${ze.name}`,{description:`${Ye} particles spawned`}):gr.error("Failed to summon organism",{description:"Particle limit reached"})},Mr=Y=>{az($.current,Y)&&(gr.success("Organism deleted"),It(Ye=>Ye+1))},Fr=(Y,ze)=>{sz($.current,Y,ze)&&It(We=>We+1)},uo=(Y,ze,Ye)=>{const We=n.current;if(!We)return;We.getBoundingClientRect();const jt=window.devicePixelRatio||1,Ge=Y*jt,at=ze*jt,dt=Ye*jt,it=160,Yt=document.createElement("canvas");Yt.width=it,Yt.height=it;const Ue=Yt.getContext("2d");if(!Ue)return;const Dt=Math.max(0,Ge-dt),wn=Math.max(0,at-dt),Wt=Math.min(We.width-Dt,dt*2),Kn=Math.min(We.height-wn,dt*2);Ue.fillStyle="#0a0a0f",Ue.fillRect(0,0,it,it);const ro=it/(dt*2),Gn=(it-Wt*ro)/2,Jr=(it-Kn*ro)/2;try{return Ue.drawImage(We,Dt,wn,Wt,Kn,Gn,Jr,Wt*ro,Kn*ro),Yt.toDataURL("image/png")}catch(zr){console.error("Failed to capture thumbnail:",zr);return}},ha=(Y,ze)=>{const Ye=n.current;if(!Ye)return[0,0];const We=Ye.getBoundingClientRect(),jt=(Y-We.left)/We.width*2-1,Ge=-((ze-We.top)/We.height*2-1);return[jt,Ge]},Ta=S.useCallback((Y,ze,Ye)=>{const We=yn.current,jt=We.tool;if(jt==="SELECT"){let Ge=.04,at=null;for(const dt of We.totems){const it=(dt.pos.x-Y)**2+(dt.pos.y-ze)**2;it<Ge&&(Ge=it,at={type:"totem",id:dt.id})}for(const dt of We.taboos){const it=(dt.pos.x-Y)**2+(dt.pos.y-ze)**2;it<Ge&&(Ge=it,at={type:"taboo",id:dt.id})}We.selected=at,Qs(dt=>dt+1);return}if(jt==="TOTEM"){if(We.totems.length>=We.config.maxTotems){gr.warning("Max totems reached");return}const Ge=Po,at=Pj(Ge),dt={id:pd(We,"totem"),kind:Ge,pos:{x:Y,y:ze},radius:.15,strength:.8,pinned:!0,bornAt:l.current.elapsed,name:at};We.totems.push(dt);const it=Fc("TOTEM_FOUNDED",{kind:Ge,name:at},l.current.elapsed);We.chronicle.unshift(it),gh(O.current,{time:l.current.elapsed,type:"institution",message:`${it.icon} ${it.message}`,sigil:it.icon});const Yt=Ge==="BOND"?"#5ac8fa":Ge==="RIFT"?"#ff6b6b":Ge==="ORACLE"?"#c084fc":"#94a3b8";qd(Y,ze,`${Ge} placed`,Yt,l.current.elapsed),Wl(l.current.elapsed,`Totem placed: ${at} (${Ge})`,Yt),Qs(Ue=>Ue+1);return}if(jt==="TABOO"){const Ge=Wi;let at;if(Ge==="NO_MIX"){const Ue=new Map;for(let wn=0;wn<u.current.count;wn++)if((u.current.x[wn]-Y)**2+(u.current.y[wn]-ze)**2<.04){const Kn=u.current.type[wn];Ue.set(Kn,(Ue.get(Kn)||0)+1)}let Dt=0;for(const[wn,Wt]of Ue)Wt>Dt&&(Dt=Wt,at=wn)}const dt={id:pd(We,"taboo"),kind:Ge,pos:{x:Y,y:ze},radius:.12,intensity:.7,targetType:at,bornAt:l.current.elapsed};We.taboos.push(dt);const it=Fc("TABOO_DECLARED",{kind:Ge},l.current.elapsed);We.chronicle.unshift(it),gh(O.current,{time:l.current.elapsed,type:"institution",message:`${it.icon} ${it.message}`,sigil:it.icon});const Yt=Ge==="NO_ENTER"?"#ef4444":"#f97316";qd(Y,ze,`${Ge.replace("_"," ")} taboo`,Yt,l.current.elapsed),Wl(l.current.elapsed,`Taboo declared: ${Ge.replace("_"," ")}`,Yt),Qs(Ue=>Ue+1);return}if(jt==="RITUAL"){let Ge=null,at=.06;for(const Dt of We.totems){const wn=(Dt.pos.x-Y)**2+(Dt.pos.y-ze)**2;wn<at&&(at=wn,Ge=Dt)}if(!Ge){gr.warning("Click on a totem to create a ritual");return}if(We.rituals.length>=We.config.maxRituals){gr.warning("Max rituals reached");return}const dt=We.rituals.find(Dt=>Dt.totemId===Ge.id);let it=Gi;if(dt){if(dt.kind===Gi){const wn=["GATHER","PROCESSION","OFFERING"],Wt=wn.indexOf(dt.kind);it=wn[(Wt+1)%wn.length]}dt.kind=it;const Dt=Fc("RITUAL_STARTED",{kind:it,totemName:Ge.name},l.current.elapsed);We.chronicle.unshift(Dt),Qs(wn=>wn+1),gr.success(`Ritual changed to ${it}`,{duration:2e3});return}const Yt={id:pd(We,"ritual"),kind:it,totemId:Ge.id,periodSec:8,dutyCycle:.4,intensity:.7,bornAt:l.current.elapsed};We.rituals.push(Yt);const Ue=Fc("RITUAL_STARTED",{kind:it,totemName:Ge.name},l.current.elapsed);We.chronicle.unshift(Ue),gh(O.current,{time:l.current.elapsed,type:"institution",message:`${Ue.icon} ${Ue.message}`,sigil:Ue.icon}),qd(Ge.pos.x,Ge.pos.y,`${it} ritual`,"#34d399",l.current.elapsed),Wl(l.current.elapsed,`Ritual started: ${it} at ${Ge.name}`,"#34d399"),Qs(Dt=>Dt+1);return}},[Po,Wi,Gi]),Qa=Y=>{const ze=n.current;if(!ze)return;Y.preventDefault(),ze.setPointerCapture(Y.pointerId);const Ye=ze.getBoundingClientRect();if(Ot.current.down=!0,Ot.current.id=Y.pointerId,Ot.current.pointerType=Y.pointerType||"mouse",Ot.current.moved=!1,Ot.current.x=Y.clientX,Ot.current.y=Y.clientY,Ot.current.prevX=Y.clientX,Ot.current.prevY=Y.clientY,Ot.current.cursorX=Y.clientX-Ye.left,Ot.current.cursorY=Y.clientY-Ye.top,Ot.current.shift=Y.shiftKey,Ot.current.alt=Y.altKey,Ot.current.pointerType==="touch"&&On==="complexityLife"){const at=jd.current;if(at.points.set(Y.pointerId,{x:Y.clientX,y:Y.clientY}),at.points.size===2){const dt=Array.from(at.points.values()),it=dt[0].x-dt[1].x,Yt=dt[0].y-dt[1].y,Ue=Math.sqrt(it*it+Yt*Yt),Dt=(dt[0].x+dt[1].x)*.5,wn=(dt[0].y+dt[1].y)*.5,Wt=a.current,Kn=Wt?Wt.getBoundingClientRect():Ye,ro=Dt-Kn.left-Kn.width/2,Gn=wn-Kn.top-Kn.height/2;at.active=!0,at.wasPinching=!0,at.startDist=Math.max(1,Ue),at.startZoom=At.current.zoom,at.startPanX=At.current.panX,at.startPanY=At.current.panY,at.startMX=ro,at.startMY=Gn,Ot.current.down=!1,Ot.current.id=-1;return}}if(On==="sociogenesis"){const[at,dt]=ha(Y.clientX,Y.clientY);Ta(at,dt,Y.shiftKey);return}qi?Ot.current.mode="CAPTURE":Y.altKey?Ot.current.mode="ERASE":Y.shiftKey?Ot.current.mode="SEED":Ot.current.mode=La.toUpperCase();const[We,jt]=ha(Y.clientX,Y.clientY),Ge=No/Math.min(Ye.width,Ye.height)*2;if(Ot.current.downWX=We,Ot.current.downWY=jt,Ot.current.downRadiusWorld=Ge,Ot.current.pointerType!=="touch")if(Ot.current.mode==="CAPTURE"){const at=uo(Y.clientX-Ye.left,Y.clientY-Ye.top,No),dt=rz($.current,u.current,We,jt,Ge,h.current.typesCount,Co,jr,at);dt?(gr.success(`Captured: ${dt.name}`,{description:`${dt.particles.length} particles`}),It(it=>it+1)):gr.error("No particles in capture area")}else Ot.current.mode==="PULSE"?Mg(u.current,We,jt,Ge,50*(Tr/100)):Ot.current.mode==="WHITE-HOLE"?(S2(u.current,We,jt,Ge,250*(Tr/100)),mh(g.current,We,jt,Ge*.5,500*(Tr/100),0)):Ot.current.mode==="BLACK-HOLE"?(w2(u.current,We,jt,Ge,250*(Tr/100)),mh(g.current,We,jt,Ge*.5,0,500*(Tr/100))):Ot.current.mode==="WIND"?Mg(u.current,We,jt,Ge,25*(Tr/100)):Ot.current.mode==="VORTEX"?M2(u.current,We,jt,Ge,80*(Tr/100)):Ot.current.mode==="FREEZE"?C2(u.current,We,jt,Ge,Math.min(.98,.6*(Tr/100))):Ot.current.mode==="CHAOS"?k2(u.current,We,jt,Ge,80*(Tr/100)):Ot.current.mode==="QUAKE"?R2(u.current,We,jt,Ge,80*(Tr/100),l.current.elapsed):Ot.current.mode==="NOVA"?(A2(u.current,We,jt,Ge,500*(Tr/100),Rs.current),Rs.current=Rs.current===0?1:0):Ot.current.mode==="MAGNETIZE"?j2(u.current,We,jt,Ge,.4*(Tr/100),ln):Ot.current.mode==="ERASE"&&b2(u.current,We,jt,Ge,1)},is=Y=>{const ze=n.current;if(!ze)return;const Ye=ze.getBoundingClientRect();if(Y.pointerType==="touch"&&On==="complexityLife"){const it=jd.current;if(it.points.has(Y.pointerId)&&it.points.set(Y.pointerId,{x:Y.clientX,y:Y.clientY}),it.active&&it.points.size>=2){const Yt=Array.from(it.points.values()),Ue=Yt[0].x-Yt[1].x,Dt=Yt[0].y-Yt[1].y,Wt=Math.sqrt(Ue*Ue+Dt*Dt)/Math.max(1,it.startDist),Kn=a.current,ro=Kn?Kn.getBoundingClientRect():Ye,Gn=(Yt[0].x+Yt[1].x)*.5,Jr=(Yt[0].y+Yt[1].y)*.5,zr=Gn-ro.left-ro.width/2,oo=Jr-ro.top-ro.height/2,Uo=Math.max(.12,Math.min(14,it.startZoom*Wt)),ni=Uo/it.startZoom;At.current={zoom:Uo,panX:zr+(it.startPanX-it.startMX)*ni,panY:oo+(it.startPanY-it.startMY)*ni};const Hs=i.current;Hs&&(Hs.style.transform=`translate(${At.current.panX}px,${At.current.panY}px) scale(${At.current.zoom})`,Hs.style.transformOrigin="50% 50%"),bn(Uo),An(Math.abs(At.current.panX)>2||Math.abs(At.current.panY)>2);return}}if(On==="sociogenesis"&&(As.current.cursorX=Y.clientX-Ye.left,As.current.cursorY=Y.clientY-Ye.top),qi||Ot.current.down?(Ot.current.cursorX=Y.clientX-Ye.left,Ot.current.cursorY=Y.clientY-Ye.top,qi&&(Ot.current.mode="CAPTURE")):(Ot.current.cursorX=-1,Ot.current.cursorY=-1),!Ot.current.down||Ot.current.id!==Y.pointerId)return;if(Y.pointerType==="touch"&&!Ot.current.moved){const it=Y.clientX-Ot.current.x,Yt=Y.clientY-Ot.current.y;it*it+Yt*Yt>36&&(Ot.current.moved=!0)}const[We,jt]=ha(Y.clientX,Y.clientY),[Ge,at]=ha(Ot.current.prevX,Ot.current.prevY),dt=No/Math.min(Ye.width,Ye.height)*2;if(Ot.current.mode==="WIND"){const it=We-Ge,Yt=jt-at;kD(u.current,We,jt,dt,it*500*(Tr/100),Yt*500*(Tr/100))}else if(Ot.current.mode==="PULSE")Mg(u.current,We,jt,dt,50*(Tr/100));else if(Ot.current.mode==="WHITE-HOLE")S2(u.current,We,jt,dt,250*(Tr/100)),mh(g.current,We,jt,dt*.5,400*(Tr/100),0);else if(Ot.current.mode==="BLACK-HOLE")w2(u.current,We,jt,dt,250*(Tr/100)),mh(g.current,We,jt,dt*.5,0,400*(Tr/100));else if(Ot.current.mode==="VORTEX")M2(u.current,We,jt,dt,80*(Tr/100));else if(Ot.current.mode==="FREEZE")C2(u.current,We,jt,dt,Math.min(.98,.6*(Tr/100)));else if(Ot.current.mode==="CHAOS")k2(u.current,We,jt,dt,80*(Tr/100));else if(Ot.current.mode==="QUAKE")R2(u.current,We,jt,dt,80*(Tr/100),l.current.elapsed);else if(Ot.current.mode==="NOVA")A2(u.current,We,jt,dt,500*(Tr/100),Rs.current);else if(Ot.current.mode==="MAGNETIZE")j2(u.current,We,jt,dt,.25*(Tr/100),ln);else if(Ot.current.mode==="SEED"){const it=Math.max(1,Math.floor(Lc/30));for(let Yt=0;Yt<it;Yt++)HM(u.current,We+(d.current.next()-.5)*dt*.5,jt+(d.current.next()-.5)*dt*.5,ln,d.current)}else Ot.current.mode==="ERASE"&&b2(u.current,We,jt,dt,gi*.3);Ot.current.prevX=Y.clientX,Ot.current.prevY=Y.clientY},fa=Y=>{const ze=n.current;if(ze&&Ot.current.id===Y.pointerId&&ze.releasePointerCapture(Y.pointerId),Y.pointerType==="touch"&&On==="complexityLife"){const Ye=jd.current;Ye.points.delete(Y.pointerId),Ye.points.size<2&&(Ye.active=!1),Ye.points.size===0&&(Ye.wasPinching=!1)}if(Ot.current.pointerType==="touch"&&!Ot.current.moved&&!jd.current.wasPinching){const Ye=Ot.current.downWX,We=Ot.current.downWY,jt=Ot.current.downRadiusWorld||0;On!=="sociogenesis"&&(Ot.current.mode==="PULSE"?Mg(u.current,Ye,We,jt,50*(Tr/100)):Ot.current.mode==="WHITE-HOLE"?(S2(u.current,Ye,We,jt,250*(Tr/100)),mh(g.current,Ye,We,jt*.5,400*(Tr/100),0)):Ot.current.mode==="BLACK-HOLE"?(w2(u.current,Ye,We,jt,250*(Tr/100)),mh(g.current,Ye,We,jt*.5,0,400*(Tr/100))):Ot.current.mode==="VORTEX"?M2(u.current,Ye,We,jt,80*(Tr/100)):Ot.current.mode==="FREEZE"?C2(u.current,Ye,We,jt,Math.min(.98,.6*(Tr/100))):Ot.current.mode==="CHAOS"?k2(u.current,Ye,We,jt,80*(Tr/100)):Ot.current.mode==="QUAKE"?R2(u.current,Ye,We,jt,80*(Tr/100),l.current.elapsed):Ot.current.mode==="NOVA"?(A2(u.current,Ye,We,jt,500*(Tr/100),Rs.current),Rs.current=Rs.current===0?1:0):Ot.current.mode==="MAGNETIZE"?j2(u.current,Ye,We,jt,.25*(Tr/100),ln):Ot.current.mode==="ERASE"&&b2(u.current,Ye,We,jt,gi*.3))}Ot.current.down=!1,Ot.current.cursorX=-1,Ot.current.cursorY=-1},Ia=Y=>{fa(Y)},Lr=S.useCallback(Y=>{var ze;(ze=Te.current)==null||ze.start(()=>Pe==="3D"?[n.current,r.current,ge.current]:[n.current,r.current],()=>({labName:"Complexity Life Lab",lines:[`partculas: ${u.current.count}    espcies: ${h.current.typesCount}`,`qualidade: ${pi}    fps: ${Math.round(l.current.fps)}`,Zn?`dna: ${Eg(Zn).slice(0,28)}`:`regime: ${Gr}`]}),30,void 0,{format:(Y==null?void 0:Y.format)??"auto",quality:(Y==null?void 0:Y.quality)??"standard"})},[Pe,pi,Zn,Gr]),Za=S.useCallback(()=>{var Y;return(Y=Te.current)==null?void 0:Y.stop()},[]);return o.jsxs("div",{className:"w-full h-screen overflow-hidden flex",style:{background:I0},children:[o.jsxs("div",{ref:a,className:"flex-1 relative overflow-hidden",style:{display:Ro?"none":void 0,pointerEvents:On==="metaArtLab"?"none":"auto"},children:[o.jsxs("div",{ref:i,className:"absolute inset-0",style:{willChange:"transform"},children:[o.jsx("canvas",{ref:n,className:"absolute inset-0 cursor-crosshair",style:{width:"100%",height:"100%",touchAction:"none",pointerEvents:On==="metaArtLab"?"none":"auto"},onPointerDown:Qa,onPointerMove:is,onPointerUp:fa,onPointerCancel:Ia}),o.jsx("canvas",{ref:r,className:"absolute inset-0 pointer-events-none",style:{width:"100%",height:"100%",zIndex:1}}),o.jsx("canvas",{ref:ge,className:"absolute inset-0",style:{width:"100%",height:"100%",display:Pe==="3D"&&On!=="psycheLab"?"block":"none",pointerEvents:Pe==="3D"&&On!=="psycheLab"?"auto":"none",cursor:"grab"}})]}),On==="complexityLife"&&o.jsx(km,{state:Ae,elapsed:xt,onStart:Lr,onStop:Za,showOptions:!0,className:"absolute bottom-4 right-4 z-20"}),On==="complexityLife"&&Ox&&o.jsx(hte,{lensState:V,fps:l.current.fps??60,agentCount:u.current.count,vitalRates:V.vitalRates,moduleTelemetry:V.moduleTelemetry,microConfig:{...h.current},fieldConfig:{...x.current},life:Ke.current,reconfigConfig:{...E.current},maintainPopulation:ti,onMaintainPopulationChange:js,targetParticleCount:Si,onMicroChange:Y=>{Object.assign(h.current,Y)},onFieldChange:Y=>{Object.assign(x.current,Y)},onLifeChange:Y=>{Le(ze=>nb({...ze,...Y}))},onReconfigChange:Y=>{Object.assign(E.current,Y)},onTargetParticleCountChange:Y=>{ss.current=Y,wi(Y)},onConfigChange:Y=>{Object.assign(re.current.feedback.config,Y),fe(ze=>({...ze,feedback:{...ze.feedback,config:{...re.current.feedback.config}}}))},onResetMemory:()=>{Qee(re.current.feedback),fe(Y=>({...Y,feedback:{...Y.feedback,config:{...re.current.feedback.config},metrics:{...re.current.feedback.metrics},activations:{...re.current.feedback.activations},modulation:{...re.current.feedback.modulation},phase:re.current.feedback.phase,phaseLabel:re.current.feedback.phaseLabel}}))},observerPresenceManual:J,onObserverPresenceManualChange:pe,r1:Go?{adminMode:!0,flags:Fv(),onFlagChange:(Y,ze)=>{kG(Y,ze),Ir(Ye=>Ye+1)},knowledgeState:Ur.current,observerState:qr.current,onObserverConfigChange:Y=>{Object.assign(qr.current.config,Y),Ir(ze=>ze+1)},phaseResult:tn??void 0,lensId:Wn,onLensChange:Yn,lensOptions:_ee.map(Y=>({id:Y.id,name:Y.name})),indices:Ao,counterMap:Io??void 0,onGenerateCounterMap:()=>Zs(Dee({currentPhase:tn==null?void 0:tn.phase,dominantMetric:"clustering",assumptions:Ur.current.assumptions})),selfCheckResult:ms??void 0,onRunSelfCheck:()=>Ja(Lee({knowledgeState:Ur.current,observerState:qr.current,lastPhaseResult:tn?{phase:tn.phase,confidence:tn.confidence}:void 0,lastIndices:co.current}))}:void 0}),On==="complexityLife"&&!Ox,On==="complexityLife"&&(Mt<.99||Mt>1.01||Pt)&&o.jsxs("div",{className:"absolute bottom-4 left-4 z-20 flex flex-col items-start gap-1 pointer-events-auto",children:[o.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1",style:{background:"rgba(0,0,0,0.92)",border:"1px dashed rgba(255,255,255,0.06)"},children:[o.jsx("span",{className:"text-[8px] font-mono text-white/30 uppercase tracking-widest",children:"zoom"}),o.jsxs("span",{className:"text-[9px] font-mono text-cyan-300/70",children:[Mt.toFixed(2),""]})]}),o.jsx("button",{onClick:()=>{At.current={zoom:1,panX:0,panY:0},i.current&&(i.current.style.transform=""),bn(1),An(!1)},className:"px-2 py-0.5 text-[8px] font-mono text-white/35 hover:text-white/70 transition-colors",style:{background:"rgba(0,0,0,0.85)",border:"1px dashed rgba(255,255,255,0.06)"},children:"[Home] reset"}),o.jsx("div",{className:"px-1.5 py-0.5",style:{background:"rgba(0,0,0,0.70)",border:"1px dashed rgba(255,255,255,0.04)"},children:o.jsx("span",{className:"text-[7px] font-mono text-white/18",children:"roda=zoom  rclique+drag=pan  =nav"})})]})]}),!xn&&!Ro&&o.jsxs(o.Fragment,{children:[o.jsx(UF,{running:l.current.running,speed:l.current.speed,fps:l.current.fps,trails:Sr,fieldHeatmap:$e,canUndo:LR(L.current),particleCount:u.current.count,speciesCount:h.current.typesCount,mode:On==="sociogenesis"?yn.current.tool:Ot.current.mode,regime:Gr,circularDependency:h.current.circularDependency,dnaString:Zn?Eg(Zn):void 0,simQuality:pi,simMs:ho,renderMs:ko,neighborsChecked:no,interactionsApplied:qs,narrativeStatus:Xt,activeLab:On,availableLabs:T0,adminMode:Go,onOpenAdmin:()=>xi(!0),socioStats:On==="sociogenesis"?{totems:yn.current.totems.length,taboos:yn.current.taboos.length,rituals:yn.current.rituals.length,tribes:yn.current.tribes.length,openCases:yn.current.cases.filter(Y=>Y.status==="OPEN").length}:void 0,onGoHome:()=>dc(!0),onLabChange:Y=>{if(!_l(Y)){gr.info("Tool trancada",{description:"Ative Admin Mode (morin2026) para acessar.",duration:2500}),xi(!0);return}zc(Y),dc(!1);const ze={complexityLife:["Complexity Life Lab","Particle life simulation"],sociogenesis:["Sociogenesis Tool","Place totems, declare taboos, bind rituals"],psycheLab:["Psyche Lab","Neural fields & consciousness dynamics"],musicLab:["Music Lab","Synesthetic Quanta Instrument"],alchemyLab:["Alchemy Lab","Transmutation  The Great Work"],metaArtLab:["Meta-Arte Tool","Experimental Spiritual Photoshop"],rhizomeLab:["Rhizome Lab","Heuristic-Exact  Rede rizomatica viva"],asimovTheater:["Asimov Theater","Psychohistory  Previsao por agentes complexos"],languageLab:["Language Lab","Heptapod  Linguagem no-linear viva"],physicsSandbox:["Physics Sandbox","Build Robot  Live Learning via CEM"]},[Ye,We]=ze[Y]??[Y,""];gr.info(Ye,{description:We,duration:2e3})},onTogglePlay:()=>{l.current.running=!l.current.running,It(Y=>Y+1)},onStep:()=>{var ze,Ye;h.current.dt=ud;const Y=Ke.current;h.current.foodEnabled=Y.foodEnabled,h.current.foodRatio=Y.foodRatio,h.current.energyEnabled=Y.energyEnabled,h.current.energyDecay=Y.energyDecay,h.current.energyFeedRate=Y.energyFeedRate,h.current.energyReproThreshold=Y.energyReproThreshold,h.current.metamorphosisEnabled=Y.mode==="EVOLUTIVE"||Y.mode==="FULL",h.current.mutationRate=Y.mutationRate,h.current.typeStability=Y.typeStability,I.current.mutationAmount=Y.reconfigAmount,E.current.mutationStrength=Y.reconfigEnabled?Y.reconfigRate:0,(Ye=(ze=b.current)==null?void 0:ze.cfg)!=null&&Ye.enabled?UM(u.current,h.current,m.current,(We,jt)=>{const Ge=jp(g.current,We,jt);return{tension:Ge.tension*x.current.influenceStrength,cohesion:Ge.cohesion*x.current.influenceStrength,scarcity:Ge.scarcity*x.current.influenceStrength}},d.current,l.current.tick,b.current):zp(u.current,h.current,m.current,(We,jt)=>{const Ge=jp(g.current,We,jt);return{tension:Ge.tension*x.current.influenceStrength,cohesion:Ge.cohesion*x.current.influenceStrength,scarcity:Ge.scarcity*x.current.influenceStrength}},d.current,l.current.tick),l.current.tick++,l.current.elapsed+=ud,It(We=>We+1)},onSetSpeed:Y=>{l.current.speed=Y,It(ze=>ze+1)},onReset:()=>{$c(0)},onToggleTrails:()=>de(Y=>!Y),onToggleFieldHeatmap:()=>et(Y=>!Y),fieldLayer:zt,onFieldLayerChange:Y=>Nt(Y),hideUI:xn,onToggleHideUI:()=>Ln(Y=>!Y),onUndo:()=>{rL(L.current,h.current,m.current,f.current,I.current)&&(gr.info("Undone"),It(Y=>Y+1))},onOpenGuide:()=>{try{Tn(!1),ei.startGuide()}catch(Y){console.error("[App] onOpenGuide failed",Y)}},achievementCount:Xa.unlockedCount,onOpenAchievements:()=>Js(!0),onOpenWorldLog:()=>vo(!0),onOpenChronicle:()=>dr(!0),viewMode:Pe,onViewModeToggle:()=>ct(Y=>Y==="2D"?"3D":"2D")}),Pe==="3D"&&On!=="psycheLab"&&o.jsx(Xj,{activeLab:On,config:vt,onChange:Y=>xe(ze=>({...ze,...Y})),onReset:()=>xe(_u)}),!Ro&&On==="sociogenesis"&&o.jsx(BW,{onLeave:()=>zc("complexityLife")}),!1,!zn&&On==="complexityLife"&&o.jsx(sD,{hideCoreControls:Ox,microConfig:{...h.current},fieldConfig:{...x.current},reconfigConfig:{...E.current},matrix:m.current,chronicle:O.current,artifacts:I.current.artifacts,diversity:I2(u.current,h.current.typesCount),clusterCount:_n.current.stableClusters,borderStrength:_n.current.borderStrength,avgTension:_n.current.avgTension,avgCohesion:_n.current.avgCohesion,avgScarcity:_n.current.avgScarcity,brushRadius:No,brushStrength:Tr,seedRate:Lc,eraseRate:gi,selectedType:ln,selectedPower:La,targetParticleCount:Si,fps:l.current.fps,particleCount:u.current.count,onBrushRadiusChange:mi,onBrushStrengthChange:bd,onSeedRateChange:ll,onEraseRateChange:Wo,onSelectedTypeChange:Rt,onSelectedPowerChange:za,onTargetParticleCountChange:Y=>{ss.current=Y,wi(Y)},onSaveSnapshot:In,onLoadSnapshot:er,pointSize:ir,fadeFactor:Er,glowIntensity:oa,paletteIndex:Co,onPointSizeChange:to,onFadeFactorChange:Eo,onGlowIntensityChange:ja,onPaletteIndexChange:Y=>{var Ye;Ya(Y);const ze=((Ye=kl[Y%kl.length])==null?void 0:Ye.name)||`Paleta ${Y}`;if(Y===kl.length-1){const We=a_(jr);gr.success(`${ze}: ${We}`,{duration:2500})}else gr.success(ze,{duration:1500})},trails:Sr,fieldHeatmap:$e,onToggleTrails:()=>de(Y=>!Y),onToggleFieldHeatmap:()=>et(Y=>!Y),onMicroChange:Y=>{var ze,Ye,We,jt;if(Y.metamorphosisEnabled!==void 0&&Y.metamorphosisEnabled!==h.current.metamorphosisEnabled&&Y.metamorphosisEnabled===!0&&gr.success("Metamorfose Ativada",{description:"Partculas agora evoluem e mudam de tipo! Observe anis dourados ao mutar e tamanhos variando com energia.",duration:6e3}),Y.typesCount!==void 0&&Y.typesCount!==h.current.typesCount){const Ge=h.current.typesCount,at=Math.max(2,Math.min(16,Y.typesCount));if(h.current.typesCount=at,at>Ge)Zx(m.current,at,d.current,h.current.rmax),Zx(f.current,at,d.current,h.current.rmax);else if(at<Ge){const it=$l(at),Yt=$l(at);for(let Ue=0;Ue<at;Ue++)for(let Dt=0;Dt<at;Dt++)m.current.attract[Ue]&&m.current.attract[Ue][Dt]!==void 0&&(it.attract[Ue][Dt]=m.current.attract[Ue][Dt],it.radius[Ue][Dt]=m.current.radius[Ue][Dt],it.falloff[Ue][Dt]=((Ye=(ze=m.current.falloff)==null?void 0:ze[Ue])==null?void 0:Ye[Dt])??1.2),f.current.attract[Ue]&&f.current.attract[Ue][Dt]!==void 0&&(Yt.attract[Ue][Dt]=f.current.attract[Ue][Dt],Yt.radius[Ue][Dt]=f.current.radius[Ue][Dt],Yt.falloff[Ue][Dt]=((jt=(We=f.current.falloff)==null?void 0:We[Ue])==null?void 0:jt[Dt])??1.2);m.current=it,f.current=Yt}di(m.current,f.current),h.current.circularDependency>0&&ql(m.current,h.current.circularDependency);let dt=0;for(let it=0;it<u.current.count;it++){const Yt=u.current.type[it];(Yt===255||Yt>=0&&Yt<at)&&(dt!==it&&(u.current.x[dt]=u.current.x[it],u.current.y[dt]=u.current.y[it],u.current.vx[dt]=u.current.vx[it],u.current.vy[dt]=u.current.vy[it],u.current.type[dt]=u.current.type[it],u.current.energy[dt]=u.current.energy[it]),dt++)}u.current.count=dt,ln>=at&&Rt(0),gr.success(`Archetypes: ${Ge}  ${at}`),It(it=>it+1)}if(Y.circularDependency!==void 0){Object.assign(h.current,Y),di(f.current,m.current),ql(m.current,Y.circularDependency),Y.circularDependency>0?gr.success(`Circular Drive: ${Math.round(Y.circularDependency*100)}%`,{description:"Cyclical attraction layer applied"}):gr.info("Circular Drive disabled",{description:"Reverted to base matrix"}),It(Ge=>Ge+1);return}Object.assign(h.current,Y),It(Ge=>Ge+1)},onFieldChange:Y=>{Object.assign(x.current,Y),It(ze=>ze+1)},onReconfigChange:Y=>{Object.assign(E.current,Y),It(ze=>ze+1)},onMatrixChange:Y=>{di(Y,m.current),di(m.current,f.current),h.current.circularDependency>0&&ql(m.current,h.current.circularDependency),It(ze=>ze+1)},onMatrixRandomize:()=>{x2(m.current,d.current,h.current.rmax),di(m.current,f.current),h.current.circularDependency>0&&ql(m.current,h.current.circularDependency),It(Y=>Y+1)},onMatrixSoften:()=>{yD(m.current),di(m.current,f.current),h.current.circularDependency>0&&ql(m.current,h.current.circularDependency),It(Y=>Y+1)},onMatrixSymmetrize:()=>{v2(m.current),di(m.current,f.current),h.current.circularDependency>0&&ql(m.current,h.current.circularDependency),It(Y=>Y+1)},onMatrixInvert:()=>{bD(m.current),di(m.current,f.current),h.current.circularDependency>0&&ql(m.current,h.current.circularDependency),It(Y=>Y+1)},onMatrixNormalize:()=>{xD(m.current),di(m.current,f.current),h.current.circularDependency>0&&ql(m.current,h.current.circularDependency),It(Y=>Y+1)},onLoadPreset:$c,onRandomizeAll:$n,onApplyRecipe:ht,onNewUniverse:Ht,onChaosSeed:kt,onLoadCreativePreset:hc,renderMode:qo,streakLength:Ho,onRenderModeChange:os,onStreakLengthChange:fs,simQuality:pi,dotSize:To,onSimQualityChange:U,onDotSizeChange:Xo,spawnPattern:rr,onSpawnPatternChange:Me,onBackgroundClick:()=>Ad(!0),showBonds:Ie,bondsDistance:X,bondsOpacity:ce,showTrails:Je,trailsLength:St,trailsOpacity:rt,onShowBondsChange:Qe,onBondsDistanceChange:Z,onBondsOpacityChange:ue,onShowTrailsChange:tt,onTrailsLengthChange:$t,onTrailsOpacityChange:Ft,organisms:$.current.organisms,onSpawnOrganism:pr,onDeleteOrganism:Mr,onRenameOrganism:Fr,captureMode:qi,onCaptureModeChange:cc,archetypes:ye.current,microState:u.current,showSigils:wr,onToggleSigils:()=>vn(Y=>!Y),fieldCellCount:h.current.typesCount*h.current.typesCount,artifactCount:I.current.artifacts.length,speciesCount:h.current.typesCount,currentSeed:jr,onLoadSeed:q,stats:Qt,life:Ut,onLifeChange:qc,lifeStats:an,sigilConfig:Re,onSigilConfigChange:Y=>Fe(ze=>{const Ye={...ze,...Y};return vn(!!(Ye.enabled&&Ye.showOverlay)),Ye}),archetypesDetected:nt,archetypeRegistry:ye.current,onClearSigils:()=>{ae.current.bond.fill(0),ae.current.rift.fill(0),ae.current.bloom.fill(0),ae.current.oath.fill(0),gr.info(" Sigils limpos",{duration:2e3})}})]}),o.jsx(oV,{active:!Ro&&On==="psycheLab",viewMode:Pe,view3DConfig:vt,onView3DConfigChange:Y=>xe(ze=>({...ze,...Y}))}),o.jsx(uU,{active:!Ro&&On==="musicLab"}),o.jsx(GY,{active:!Ro&&On==="alchemyLab"}),o.jsx(zX,{active:!Ro&&On==="metaArtLab"}),o.jsx(vQ,{active:!Ro&&On==="rhizomeLab"}),!Ro&&On==="asimovTheater"&&!Bc&&!Go?o.jsx(_te,{onUnlock:()=>vd(!0)}):o.jsx(DJ,{active:!Ro&&On==="asimovTheater"&&(Bc||Go)}),o.jsx(cZ,{active:!Ro&&On==="languageLab"}),o.jsx(vee,{resetKeys:[Ro,On],fallbackRender:({error:Y,reset:ze})=>Ro||On!=="treeOfLife"?null:o.jsx("div",{style:{position:"fixed",inset:0,zIndex:500,background:"rgba(0,0,0,0.92)",color:"rgba(255,255,255,0.9)",display:"flex",alignItems:"center",justifyContent:"center",padding:24,fontFamily:"system-ui, sans-serif"},children:o.jsxs("div",{style:{width:720,maxWidth:"95vw"},children:[o.jsx("div",{style:{fontSize:16,letterSpacing:"0.08em",textTransform:"uppercase",marginBottom:10},children:"Tree of Life falhou ao carregar"}),o.jsx("div",{style:{fontSize:12,color:"rgba(255,255,255,0.7)",lineHeight:1.5},children:"O lab disparou um erro de runtime. Voc pode tentar novamente ou voltar para a Home."}),o.jsxs("div",{style:{display:"flex",gap:10,marginTop:14},children:[o.jsx("button",{onClick:()=>ze(),style:{padding:"10px 12px",borderRadius:10,border:"1px solid rgba(255,255,255,0.18)",background:"rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.9)",cursor:"pointer"},children:"Tentar novamente"}),o.jsx("button",{onClick:()=>{ze(),dc(!0)},style:{padding:"10px 12px",borderRadius:10,border:"1px solid rgba(255,255,255,0.18)",background:"rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.9)",cursor:"pointer"},children:"Voltar pra Home"})]}),o.jsx("div",{style:{marginTop:16,padding:12,borderRadius:12,border:"1px dashed rgba(255,255,255,0.14)",background:"rgba(0,0,0,0.35)",fontFamily:"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace",fontSize:11,color:"rgba(255,255,255,0.75)",whiteSpace:"pre-wrap",lineHeight:1.45,maxHeight:"40vh",overflow:"auto"},children:String((Y==null?void 0:Y.stack)??(Y==null?void 0:Y.message)??Y)})]})}),children:o.jsx(TZ,{active:!Ro&&On==="treeOfLife"})}),o.jsx(BU,{active:!Ro&&On==="physicsSandbox"}),o.jsx(uee,{active:!Ro&&On==="milPlatos"}),o.jsx(XT,{position:"bottom-right",theme:"dark"}),o.jsx(gq,{achievement:Xa.latestAchievement,onDismiss:Xa.dismissLatest}),va&&o.jsx(mq,{achievements:Xa.achievements,onClose:()=>Js(!1),onClearAll:()=>{Xa.clearAll()}}),Qo&&o.jsx(IL,{events:ft.events,visible:Qo,onClose:()=>vo(!1)}),o.jsx(PL,{isOpen:mn,onClose:()=>dr(!1),paragraphs:yr,currentArc:qt.current.name,tone:ar,setTone:jn}),Vu&&o.jsx(bq,{currentBg:I0,onBgChange:Y=>{Rd(Y),Ad(!1)},onClose:()=>Ad(!1)}),!Ro&&xn&&t&&o.jsx("button",{type:"button",onClick:()=>Ln(!1),"aria-label":"Abrir menu",className:"fixed z-[910] flex items-center justify-center rounded-full border-2 border-dashed shadow-lg active:scale-95 transition-transform",style:{width:56,height:56,bottom:"max(20px, env(safe-area-inset-bottom))",right:"max(20px, env(safe-area-inset-right))",background:"rgba(0,0,0,0.92)",borderColor:"rgba(255,212,0,0.5)",color:"#ffd400",boxShadow:"0 4px 24px rgba(0,0,0,0.5)"},children:o.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),o.jsx("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),o.jsx("line",{x1:"3",y1:"18",x2:"21",y2:"18"})]})}),o.jsx(vq,{targetSelector:"[data-guide-button]",show:cr&&ei.mode==="hidden"}),!Ro&&ei.mode==="welcome"&&o.jsx(lq,{onStart:()=>{Tn(!1);const Y=Yh[Math.floor(d.current.next()*Yh.length)];T(Y,!0),ei.startGuide()},onSkip:()=>{Tn(!1),A5(),ei.skipGuide()}}),ei.mode==="active"&&ei.guideState&&o.jsx(iq,{guideState:ei.guideState,onComplete:()=>{A5(),ei.hideGuide(),gr.success("Guide completed!",{description:"You earned all badges"})},onSkip:()=>{A5(),ei.skipGuide()}}),Ro&&o.jsx(xee,{user:Hi,onAuthChange:xd,onEnterLab:Y=>{if(!Hi){gr.info("Entre ou cadastre-se para acessar as ferramentas.",{duration:3e3});return}if(!_l(Y)){gr.info("Tool trancada",{description:"Ative Admin Mode (morin2026) para acessar.",duration:2500}),xi(!0);return}zc(Y),dc(!1)},onOpenAdmin:()=>xi(!0),adminMode:Go}),Sd&&o.jsx(Nte,{onClose:()=>xi(!1),onUnlock:()=>{bi(!0);try{localStorage.setItem($k,"1")}catch{}xi(!1),gr.success(e("toast_adminActivated"),{description:e("toast_adminDesc"),duration:2e3})}})]})},FE=document.getElementById("root");if(!FE)throw new Error("Root element not found");ST.createRoot(FE).render(o.jsx(on.StrictMode,{children:o.jsx(WF,{children:o.jsx(Ote,{})})}));export{ga as R,o as j,S as r};
